[{"tags": ["c", "gcc", "compilation", "macros"], "comments": [{"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1565824713, "post_id": 57503077, "comment_id": 101475090, "body": "You can use <code>gcc -E</code> to save the preprocessor output to a file. But the preprocessor doesn&#39;t perform the arithmetic, you&#39;ll just see <code>(0x00000000u + (0x00040000u - ((uint32)(0) * 0x00000100u) - (64u)))</code>"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1565824797, "post_id": 57503077, "comment_id": 101475106, "body": "Couldn&#39;t you add an option to your program to make it print this data to a file? Then run the program with the option."}, {"owner": {"reputation": 1191, "user_id": 695669, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/88453f3dc25b37e1c4046aeb54cfb1d8?s=128&d=identicon&r=PG", "display_name": "jliu83", "link": "https://stackoverflow.com/users/695669/jliu83"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1565824911, "post_id": 57503077, "comment_id": 101475126, "body": "This is an embedded processor."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1565824981, "post_id": 57503077, "comment_id": 101475134, "body": "You don&#39;t have to run it on the embedded machine, the value of that macro is the same everywhere."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1565826405, "post_id": 57503077, "comment_id": 101475383, "body": "@Barmar: Building for a different target may cause some expressions to evaluate differently. A better solution is to generate inline assembly with GCC\u2019s <code>__asm__</code> feature and include an operand with the <code>i</code> constraint, which is for immediate integer operands, as in <code>__asm__(&quot;#Use this value: %[foo]&quot; : : [foo] &quot;i&quot; (MD_BTLDB_APP_VERSION_OFFSET(0)));</code>. Then compiling with <code>-S</code> and searching the generated assembly for the \u201cUse this\u201d line shows something like \u201c##Use this value: $262080\u201d. (The exact format may differ depending on target\u2014\u201c$\u201d could be \u201c#\u201d, the comment marker could differ, and so on.)"}], "answers": [{"comments": [{"owner": {"reputation": 1191, "user_id": 695669, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/88453f3dc25b37e1c4046aeb54cfb1d8?s=128&d=identicon&r=PG", "display_name": "jliu83", "link": "https://stackoverflow.com/users/695669/jliu83"}, "edited": false, "score": 0, "creation_date": 1566265113, "post_id": 57507316, "comment_id": 101592774, "body": "What an answer!  Thank you for the thorough explanation."}], "tags": [], "owner": {"reputation": 1171, "user_id": 1863511, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r7rhQ.jpg?s=128&g=1", "display_name": "Nikita Malyavin", "link": "https://stackoverflow.com/users/1863511/nikita-malyavin"}, "is_accepted": true, "score": 2, "last_activity_date": 1565866641, "last_edit_date": 1565866641, "creation_date": 1565859913, "answer_id": 57507316, "question_id": 57503077, "link": "https://stackoverflow.com/questions/57503077/printing-the-expanded-macro-to-a-file-during-compile-time/57507316#57507316", "title": "Printing the expanded macro to a file during compile time", "body": "<p>I can't see how did you get <code>0x0003ffd6</code>, because I get <code>0x3ffc0</code>. Whatever.</p>\n\n<p>Here I am going to describe three different methods of getting the result of expanded macro evaluation.</p>\n\n<h1>1. A <code>#pragma message</code> approach.</h1>\n\n<p>First, let's learn how to expand macros. This is done with double scan, you can read more about it at <a href=\"https://github.com/pfultz2/Cloak/wiki/C-Preprocessor-tricks,-tips,-and-idioms\" rel=\"nofollow noreferrer\">C Preprocessor tricks, tips, and idioms</a>.</p>\n\n<p>Suppose we have file expand.c:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\ntypedef uint32_t uint32;\n\n#define MD_BTLDB_APP_VERSION_OFFSET(x)\\\n    (0x00000000u + (0x00040000u - ((uint32)(x) * 0x00000100u) - (64u)))\n\n#define STR(...) STR_(__VA_ARGS__)\n#define STR_(...) # __VA_ARGS__\n\n#pragma message \"Value of MD_BTLDB_APP_VERSION_OFFSET(0) is \" \\\n    STR(MD_BTLDB_APP_VERSION_OFFSET(0))\n\nint main() {\n    printf(\"%d\\n\", MD_BTLDB_APP_VERSION_OFFSET(0));\n}\n</code></pre>\n\n<p>After compiling, you'll have a complete expansion of a macro. You can duplicate it to a file with tee:</p>\n\n<pre><code>$ gcc expand.c 2&gt;&amp;1 | tee output\nexpand.c:11:9: note: #pragma message: Value of MD_BTLDB_APP_VERSION_OFFSET(0) is (0x00000000u + (0x00040000u - ((uint32)(0) * 0x00000100u) - (64u)))\n   11 | #pragma message \"Value of MD_BTLDB_APP_VERSION_OFFSET(0) is \" \\\n      |         ^~~~~~~\n</code></pre>\n\n<p>Secondly, we need to catch out the expression. I will do it with sed:</p>\n\n<pre><code>$ pattern='.*note: \\#pragma message: Value of MD_BTLDB_APP_VERSION_OFFSET\\(0\\) is'\n$ sed -E -ne \"s/$pattern (.*)/\\1/p\" output\n(0 + 0x00000000u + (0x00040000u - ((uint32)(0) * 0x00000100u) - (64u)))\n</code></pre>\n\n<p><code>-n</code> suppresses the default output and <code>p</code> in the end of expression prints out only the matched string.</p>\n\n<p>At last, evaluate the expression. I'd do it with python, or with bash directly, since they both support hex digits. But anyway, first we need to stripe out <code>(uint32)</code> conversions and <code>u</code> suffices specific to C and C++:</p>\n\n<pre><code>$ expr=$(sed -E -e 's/\\(uint32\\)//g' \\\n                -e 's/([0-9a-f]+)u/\\1/g' \\\n                -ne \"s/$pattern (.*)/\\1/p\" output)\n$ printf \"0x%016x\\n\" $(($expr))\n0x000000000003ffc0\n</code></pre>\n\n<p>That's it!</p>\n\n<h1>2. Evaluation with host compiler.</h1>\n\n<p>Another way is to first get an output of cross-compiler <code>gcc -E</code>, e.g.</p>\n\n<pre><code>$ CC_CROSS=arm-noeabi-gcc\n$ expr=$($CC_CROSS -E -xc - &lt;&lt;EOF\n#include \"your_header.h\"\nMD_BTLDB_APP_VERSION_OFFSET(0)\nEOF | tail -n 1)\n</code></pre>\n\n<p>And then evaluate the expression with host compiler:</p>\n\n<pre><code>$ gcc -o get_md_btldb -xc - &lt;&lt;EOF\n#include &lt;stdio.h&gt;\nint main(){ printf(\"%p\", $expr); }\nEOF\n$ ./get_md_btldb\n</code></pre>\n\n<p>Should work as well, but didn't give it a try.</p>\n\n<h1>3. Take the value out of the binary directly!</h1>\n\n<p>Let's put a constant in your translation unit <code>value.c</code>:</p>\n\n<pre><code>typedef uint32_t uint32;\n\n#define MD_BTLDB_APP_VERSION_OFFSET(x) \\\n    (0x00000000u + (0x00040000u - ((uint32)(x) * 0x00000100u) - (64u)))\n\nuintptr_t MD_BTLDB_APP_VERSION_OFFSET_VALUE = MD_BTLDB_APP_VERSION_OFFSET(0);\n</code></pre>\n\n<p>Now if you compile it to an object file, you will have a symbol in there:</p>\n\n<pre><code>$ gcc -c value.c\n$ objdump -t -s -j.data value.o \n\nvalue.o:     file format elf64-x86-64\n\nSYMBOL TABLE:\n0000000000000000 l    d  .data  0000000000000000 .data\n0000000000000000 g     O .data  0000000000000008 MD_BTLDB_APP_VERSION_OFFSET_VALUE\n\n\nContents of section .data:\n 0000 c0ff0300 00000000                    ........    \n</code></pre>\n\n<p>There it is, <code>c0ff0300 00000000</code>, written in little-endian format.\nAnd the line </p>\n\n<pre><code>0000000000000000 g     O .data  0000000000000008 MD_BTLDB_APP_VERSION_OFFSET_VALUE\n</code></pre>\n\n<p>Means that symbol <code>MD_BTLDB_APP_VERSION_OFFSET_VALUE</code>'s value is lying at offset 0 in the section <code>.data</code> and has size 8. You can take it now there.</p>\n\n<p>But it is easier to look at the disassembly:</p>\n\n<pre><code>$ gcc -S value.s\n$ cat value.s\n    .file   \"value.c\"\n    .text\n    .globl  MD_BTLDB_APP_VERSION_OFFSET_VALUE\n    .data\n    .align 8\n    .type   MD_BTLDB_APP_VERSION_OFFSET_VALUE, @object\n    .size   MD_BTLDB_APP_VERSION_OFFSET_VALUE, 8\nMD_BTLDB_APP_VERSION_OFFSET_VALUE:\n    .quad   262080\n    .ident  \"GCC: (GNU) 9.1.0\"\n    .section    .note.GNU-stack,\"\",@progbits\n</code></pre>\n\n<p>The value goes right after the <code>MD_BTLDB_APP_VERSION_OFFSET_VALUE</code> label:</p>\n\n<pre><code>MD_BTLDB_APP_VERSION_OFFSET_VALUE:\n    .quad   262080\n</code></pre>\n\n<p>Take it:</p>\n\n<pre><code>grep -A 1 -e 'MD_BTLDB_APP_VERSION_OFFSET_VALUE:' value.s\\\n | tail -n 1 | awk '{print $2;}'\n | xargs printf \"%016x\"\n\n000000000003ffc0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3116, "user_id": 2498790, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/991601e5d41d9d84ab7e196382ea8108?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/2498790/alex"}, "is_accepted": false, "score": 1, "last_activity_date": 1565863039, "creation_date": 1565863039, "answer_id": 57507922, "question_id": 57503077, "link": "https://stackoverflow.com/questions/57503077/printing-the-expanded-macro-to-a-file-during-compile-time/57507922#57507922", "title": "Printing the expanded macro to a file during compile time", "body": "<p>First of all, to know certain bootloader addresses during the build phase is a common problem, you could try to add <code>-Xlinker -Map=output.map</code> to the gcc options and check if in the generated<code>.map</code> file there are the addresses that interest you.</p>\n\n<p>Otherwise, you could have macro results compiled into a new section in the generated file, extract them with objcopy and / or some shell commands, and then remove the section from the compiled file (see comments in the example).</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\n\n/**\n *\n * compile to a.out\n *    gcc -Wall -O2 addr.c\n * extract the section to a file (as raw binary) or dump on stdout:\n *    objcopy a.out /dev/null --dump-section .addrsec=/dev/stdout &gt;addrsec.bin\n *    objcopy a.out /dev/null --dump-section .addrsec=/dev/stdout | od -t x4 -An\n * remove the section:\n *    objcopy --remove-section .addrsec a.out\n *\n **/\n\n#define MD_BTLDB_APP_VERSION_OFFSET(x) (0x00000000u + (0x00040000u - ((uint32_t)(x) * 0x00000100u) - (64u)))\n\n#define TEST_0 MD_BTLDB_APP_VERSION_OFFSET(0)\n#define TEST_1 MD_BTLDB_APP_VERSION_OFFSET(1)\n\nuint32_t addrvar[] __attribute__((section(\".addrsec\"))) = { TEST_0, TEST_1 };\n\nint main(int argc, char **argv)\n{\n    printf(\"0x%08X\\n\", TEST_0);\n    printf(\"0x%08X\\n\", TEST_1);\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 1191, "user_id": 695669, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/88453f3dc25b37e1c4046aeb54cfb1d8?s=128&d=identicon&r=PG", "display_name": "jliu83", "link": "https://stackoverflow.com/users/695669/jliu83"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "accepted_answer_id": 57507316, "answer_count": 2, "score": 2, "last_activity_date": 1565866641, "creation_date": 1565823887, "question_id": 57503077, "link": "https://stackoverflow.com/questions/57503077/printing-the-expanded-macro-to-a-file-during-compile-time", "title": "Printing the expanded macro to a file during compile time", "body": "<p>I'd like to get the result of a macro to be printed to a file at compile time for a gcc compiler.  I'd like to know if this is possible.  Example below:</p>\n\n<pre><code>#define MD_BTLDB_APP_VERSION_OFFSET(x) \n</code></pre>\n\n<p>expands to </p>\n\n<pre><code>(0x00000000u + (0x00040000u - ((uint32)(x) * 0x00000100u) - (64u)))\n</code></pre>\n\n<p>which computes to</p>\n\n<pre><code>0x0003ffd6\n</code></pre>\n\n<p>for </p>\n\n<pre><code>MD_BTLDB_APP_VERSION_OFFSET(0)\n</code></pre>\n\n<p>This is the address for some meta data for a bootloader, and I'd like to be able to use this address outside of runtime.</p>\n\n<p>I've looked at #pragma message, but this only outputs the value to the gcc output, and not to a file.  It also has the inconvenience of having many other compiler messages mixed in.  Any hints or creative solutions welcomed.</p>\n"}, {"tags": ["c", "arrays", "for-loop"], "comments": [{"owner": {"reputation": 349, "user_id": 7705781, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e8308f92d2142ecd3051f48d941bbad?s=128&d=identicon&r=PG&f=1", "display_name": "mdasari", "link": "https://stackoverflow.com/users/7705781/mdasari"}, "edited": false, "score": 2, "creation_date": 1565820602, "post_id": 57502558, "comment_id": 101474278, "body": "The problem is &quot;\\n&quot; in scanf. Remove \\n in all scanfs. It will work as you expected."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1565820708, "post_id": 57502558, "comment_id": 101474301, "body": "You don&#39;t need the <code>temp</code> variable, you can scan directly into the array: <code>scanf(&quot;%lf&quot;, &amp;grades[loop])</code>"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1565842166, "post_id": 57502558, "comment_id": 101477841, "body": "As it stands, you don&#39;t really need the <code>grades</code> array.  If you are later planning to &#39;return the grades&#39;, you are going to run into several problems, one of them being that <code>return grades;</code> would be attempting to return a pointer to a local variable that is no longer valid once the function exits.  Another problem will be how to communicate with the calling code how many entries are in the array.  The issues are resolvable \u2014 dynamic memory allocation with <code>malloc()</code> and a pointer to a length variable, for example \u2014 but it will be easy to astray."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 11596552, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PDU1Oi0vY5k/AAAAAAAAAAI/AAAAAAAAABw/dSHBl8o8uwg/photo.jpg?sz=128", "display_name": "dtb", "link": "https://stackoverflow.com/users/11596552/dtb"}, "edited": false, "score": 0, "creation_date": 1565831177, "post_id": 57502836, "comment_id": 101476123, "body": "Thanks you so much guys and declaring the array like how i did is alright too?"}], "tags": [], "owner": {"reputation": 21, "user_id": 7038367, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca525e7ddbf7c83393897526cae8d74?s=128&d=identicon&r=PG&f=1", "display_name": "Ketul", "link": "https://stackoverflow.com/users/7038367/ketul"}, "is_accepted": false, "score": 1, "last_activity_date": 1565829957, "last_edit_date": 1565829957, "creation_date": 1565821735, "answer_id": 57502836, "question_id": 57502558, "link": "https://stackoverflow.com/questions/57502558/array-issues-declaring/57502836#57502836", "title": "Array: issues declaring", "body": "<p>The problem is you are using '\\n' inside scanf. Also you can get rid of additional variables.\nHere is the modified code:</p>\n\n<pre><code>double enter_quiz_grades() {\n\n    int quiz_amount, i;\n    printf(\"Enter number of quiz grades to enter:\");\n    scanf(\"%d\", &amp;quiz_amount);\n    printf(\"You typed %d students\\n\",quiz_amount);\n    double temp = 0;\n    double grades[quiz_amount];\n\n    for (i = 0; i &lt; quiz_amount; i++)\n    {\n        printf(\"loop is %d\\n\", i);\n        printf(\"Enter grade for quiz %d: \", i + 1);\n        scanf(\"%lf\", &amp;grades[i]);\n        printf(\"%lf\\n\",grades[i]);\n    }\n\n    return 0.0;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8291, "user_id": 78712, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f013348849105a2186c162e211502544?s=128&d=identicon&r=PG", "display_name": "elcuco", "link": "https://stackoverflow.com/users/78712/elcuco"}, "is_accepted": false, "score": 0, "last_activity_date": 1565854256, "creation_date": 1565854256, "answer_id": 57506228, "question_id": 57502558, "link": "https://stackoverflow.com/questions/57502558/array-issues-declaring/57506228#57506228", "title": "Array: issues declaring", "body": "<p>Just a small detail, not strictly related to the original question:</p>\n\n<pre><code>double grades[quiz_amount];\n</code></pre>\n\n<p>This creates an array, sized at runtime, from a variable. If this variable is read from somewhere, this can lead to a malicious user giving it a very high (or ngative!) value, and you are in big problems. The linux kernel is removing them from the source for this exact reason (as this syntax creates the array in the stack - attacker can modify the return address). Make this a dynamic array allocated on the heap (<code>malloc()</code>).</p>\n\n<p><a href=\"https://www.phoronix.com/scan.php?page=news_item&amp;px=Linux-Kills-The-VLA\" rel=\"nofollow noreferrer\">https://www.phoronix.com/scan.php?page=news_item&amp;px=Linux-Kills-The-VLA</a></p>\n"}], "owner": {"reputation": 25, "user_id": 11596552, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PDU1Oi0vY5k/AAAAAAAAAAI/AAAAAAAAABw/dSHBl8o8uwg/photo.jpg?sz=128", "display_name": "dtb", "link": "https://stackoverflow.com/users/11596552/dtb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1565854256, "creation_date": 1565819794, "last_edit_date": 1565832314, "question_id": 57502558, "link": "https://stackoverflow.com/questions/57502558/array-issues-declaring", "title": "Array: issues declaring", "body": "<p>I've been trying to convert my python to C code and it's my first time using C.</p>\n\n<p>Basically I want it to ask how many grades I will input and then put them in an array. The problem is that the amount keeps putting in the array. I thought that I could declare the size of the array after asking how many grades I was inputting but I think that's the problem. I am not sure how else to do it. I have a lot of <code>printf</code>s I was using for debugging.</p>\n\n<p>Any Suggestions?</p>\n\n<pre><code>double enter_quiz_grades()\n{\n\n    int quiz_amount,loop,i;\n    printf(\"Enter number of quiz grades to enter:\");\n    scanf(\" %d \\n\", &amp;quiz_amount);\n    printf(\"You typed %d students\\n\",quiz_amount);\n    double temp=0;\n    double grades[quiz_amount];\n\n    for (loop = 0; loop&lt;quiz_amount;loop++)\n    {\n        printf(\"loop is %d\", loop);\n        i = loop+1;\n        printf(\"Enter grade for quiz %d: \",i);\n        scanf(\"%lf\\n\", &amp;temp);\n        grades[loop] = temp;\n        printf(\"%lf\",grades[loop]);\n    }\n    return 0.0; \n}\n</code></pre>\n"}, {"tags": ["c", "assembly", "x86-64"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1565818390, "post_id": 57502347, "comment_id": 101473652, "body": "Do you have a unit test that can verify it works correctly?"}, {"owner": {"reputation": 136, "user_id": 6775917, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c43f82f80eb04cea3ba5f3bc25ec1acd?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Rodriguez", "link": "https://stackoverflow.com/users/6775917/benjamin-rodriguez"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1565818652, "post_id": 57502347, "comment_id": 101473736, "body": "I don&#39;t I guess I could run my c code and see what the output is but I don&#39;t know how to run the assembly with the same arguments to see if the output of both matches."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1565818716, "post_id": 57502347, "comment_id": 101473754, "body": "What&#39;s the point of <code>x = a[i] + 1;</code> since you immediately overwrite it with <code>x = a[i]</code>?"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 2, "creation_date": 1565818769, "post_id": 57502347, "comment_id": 101473770, "body": "The whole loop is equivalent to just <code>x = a[n-1];</code>"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1565818803, "post_id": 57502347, "comment_id": 101473778, "body": "You can always stuff this inside a C wrapper to test it. Just saying."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1565818900, "post_id": 57502347, "comment_id": 101473803, "body": "My comment assumes that your C translation is correct, which is actually your question. I don&#39;t know assembly well enough to know if it actually is."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1565818993, "post_id": 57502347, "comment_id": 101473839, "body": "I suspect there should be <code>else</code>"}, {"owner": {"reputation": 136, "user_id": 6775917, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c43f82f80eb04cea3ba5f3bc25ec1acd?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Rodriguez", "link": "https://stackoverflow.com/users/6775917/benjamin-rodriguez"}, "edited": false, "score": 0, "creation_date": 1565819022, "post_id": 57502347, "comment_id": 101473849, "body": "haha yeah I missed the else there after the if statement"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565831322, "post_id": 57502347, "comment_id": 101476154, "body": "What is <code>$o</code>? Global variable?"}, {"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 3, "creation_date": 1565831647, "post_id": 57502347, "comment_id": 101476201, "body": "@JL2210 : pretty sure that was a transcription error and was meant to be <code>$0</code>"}], "answers": [{"comments": [{"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1565831918, "post_id": 57503793, "comment_id": 101476241, "body": "Think you mean <code>tmp</code> and not <code>reg_rcx</code>"}, {"owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "reply_to_user": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1565831959, "post_id": 57503793, "comment_id": 101476244, "body": "@MichaelPetch thank you, classic copy pasting error :&#39;)"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565832012, "post_id": 57503793, "comment_id": 101476255, "body": "Assuming that this is on some non-absurd platforms, the use of <code>long</code> is correct. Otherwise, <code>long long</code> can be used."}, {"owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 3, "creation_date": 1565832259, "post_id": 57503793, "comment_id": 101476293, "body": "@JL2210 I decided not to use <code>long</code> since it is platform dependent, and you cannot infer data types from raw assembly that easily. <code>int64_t</code> is correct, <code>long</code> <i>may be correct</i>."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 4, "creation_date": 1565837635, "post_id": 57503793, "comment_id": 101477217, "body": "@JL2210 and Marco: the function args arrived in RDI and RSI, so this is the x86-64 System V ABI.  <code>long</code> is a 64-bit type there, unlike in Windows x64.  (LP64 vs. LLP64).  <a href=\"https://en.wikipedia.org/wiki/64-bit_computing#64-bit_data_models\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/64-bit_computing#64-bit_data_models</a>.  But yes, <code>int64_t</code> is much better and has no dependency on little details like this.  A DeathStation 9000 C implementation on x86-64 might have <code>long long</code> being a 128-bit type.  But if the optional type <code>int64_t</code> exists at all, it&#39;s required to be exactly 64 bits, no padding, and 2&#39;s complement.  (Signed overflow is still UB though.)"}], "tags": [], "owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "is_accepted": true, "score": 9, "last_activity_date": 1566003221, "last_edit_date": 1566003221, "creation_date": 1565831763, "answer_id": 57503793, "question_id": 57502347, "link": "https://stackoverflow.com/questions/57502347/is-my-conversion-from-assembly-to-c-code-correct/57503793#57503793", "title": "Is my conversion from assembly to c code correct?", "body": "<p>First of all, there seems to be an error in your assembly: looks like <code>$o</code> should be <code>$0</code> (zero).</p>\n\n<p>Your C code is almost correct, there are some errors: </p>\n\n<ol>\n<li><p>The order of the branches generated by the <code>jl .L3</code> instruction is quite significant, in fact, if <code>%rax &lt; %rcx</code> the branch is taken, and the instruction <code>movq  %rax, %rcx</code> is ignored. On the other hand, if the branch is NOT taken, then that move is executed <em>before</em> stepping into <code>.L3</code>. So you basically swapped the two branches in your C code.</p></li>\n<li><p>The value of <code>a[i]</code> is not used directly every time, but it is saved in the <code>%rcx</code> register before being used. Both <code>movq  %rax, %rcx</code> and <code>movq (%rsi, %rdx, 8), %rcx</code> assign to <code>%rcx</code>, then the value is passed from <code>%rcx</code> to <code>%rax</code>, so <code>%rcx</code> should be treated as a different variable. This means that writing <code>x = a[i] + 1;</code> is wrong. It should be: </p>\n\n<pre><code>tmp = a[i];\n/* ... */\nx = tmp + 1; \n</code></pre></li>\n</ol>\n\n<p>The resulting C code should be something like this:</p>\n\n<pre><code>int64_t looper(int64_t n, int64_t *arr) {\n    int64_t result; // rax\n    int64_t tmp;    // rcx\n    int64_t i;      // rdx\n\n    result = 0;\n\n    for (i = 0; i &lt; n; i++) {\n        tmp = arr[i];\n\n        if (result &gt;= tmp)\n            tmp = result;\n\n        result = tmp + 1;\n    }\n\n    return result;\n}\n</code></pre>\n\n<p>As an addition, compiling your binary using <code>as -o prog prog.s</code> and then disassembling with Radare2 gives this rather simple control flow graph:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>    looper ();\n        0x08000040      mov eax, 0\n        0x08000045      mov edx, 0\n    ,=&lt; 0x0800004a      jmp 0x8000060\n    |\n    |   ; JMP XREF from 0x08000063 (looper)\n  .---&gt; 0x0800004c      mov rcx, qword [rsi + rdx*8]\n  | |   0x08000050      cmp rax, rcx\n,=====&lt; 0x08000053      jl 0x8000058\n| | |   0x08000055      mov rcx, rax\n| | |\n| | |   ; JMP XREF from 0x08000053 (looper)\n`-----&gt; 0x08000058      lea rax, qword [rcx + 1]\n  | |   0x0800005c      add rdx, 1\n  | |\n  | |   ; JMP XREF from 0x0800004a (looper)\n  | `-&gt; 0x08000060      cmp rdx, rdi\n  `===&lt; 0x08000063      jl 0x800004c\n        0x08000065      ret\n</code></pre>\n"}], "owner": {"reputation": 136, "user_id": 6775917, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c43f82f80eb04cea3ba5f3bc25ec1acd?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Rodriguez", "link": "https://stackoverflow.com/users/6775917/benjamin-rodriguez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 57503793, "answer_count": 1, "score": 5, "last_activity_date": 1566003221, "creation_date": 1565818289, "last_edit_date": 1565832454, "question_id": 57502347, "link": "https://stackoverflow.com/questions/57502347/is-my-conversion-from-assembly-to-c-code-correct", "title": "Is my conversion from assembly to c code correct?", "body": "<p>I have a problem that asks to convert assembly code to C code.</p>\n\n<p>I've made an attempt to convert the code and I think I got it mostly right but I am confused by the <code>leaq</code> instruction.</p>\n\n<pre><code>looper:\n   movl  $o, %eax\n   movl  $o, %edx\n   jmp   .L2\n\n.L4:\n   movq  (%rsi, %rdx, 8), %rcx\n   cmpq  %rcx, %rax\n   jl    .L3\n   movq  %rax, %rcx\n\n.L3:\n   leaq  1(%rcx), %rax\n   addq  $1, %rdx\n\n.L2:\n   cmpq  %rdi, %rdx\n   jl    .L4\n   rep ret\n</code></pre>\n\n<p>Here is the C code that I got:</p>\n\n<pre><code>long looper(long n, long *a) {\n  long i;\n  long x = 0;\n\n  for (i = 0; i &lt; n; i++) {\n    if (x &lt; a[i]) {\n      x = a[i] + 1;\n    }\n    x = a[i];\n  }\n\n  return x;\n}\n</code></pre>\n"}, {"tags": ["c", "file", "memory", "fopen", "dynamic-memory-allocation"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565839390, "post_id": 57502003, "comment_id": 101477449, "body": "Using <code>else if (press == 0x71)</code> is a gruesome way of writing <code>else if (press == &#39;q&#39;)</code>.  Also, the first time you use it, the variable <code>press</code> is uninitialized \u2014 you should make sure it is initialized before you compare it with <code>&#39;\\n&#39;</code> (not <code>0x0a</code>).  Character constants make your code clearer."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565839554, "post_id": 57502003, "comment_id": 101477461, "body": "You&#39;re elapsed time calculation is not entirely robust; the nanoseconds could rollover so that the end value of <code>tv_nsec</code> is smaller than the start value."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565839853, "post_id": 57502003, "comment_id": 101477496, "body": "Note that using <code>open()</code> on a file does <i>not</i> cause it to be read from disk.  You need a read or write operation for that."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565840573, "post_id": 57502003, "comment_id": 101477596, "body": "You don&#39;t show the PID of the process that&#39;s reading or writing the file.  Once you&#39;ve modified the file once, it doesn&#39;t change again \u2014 you continue writing <code>7</code> (control-G) bytes (or, at least, one of your loops does that).  Your code is quite big and laden with not very relevant comments.  If I&#39;m reading it correctly, you&#39;ve only got one thumping big <code>main()</code> function \u2014 functions were invented for a purpose."}, {"owner": {"reputation": 43, "user_id": 8703310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6fd2f509db40fd45c4411d240ae979c?s=128&d=identicon&r=PG&f=1", "display_name": "Tdizzle", "link": "https://stackoverflow.com/users/8703310/tdizzle"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565850069, "post_id": 57502003, "comment_id": 101479255, "body": "Hi @JonathanLeffler, thanks for all the edits. The only thing I have to add to your comments is that I have an fread function. I am going to clean up the code later. This is purely testing. I did create functions for reading in the file later, hoping that reading the file in a separate function would remove the file contents from memory, but it didn&#39;t show anything different."}, {"owner": {"reputation": 43, "user_id": 8703310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6fd2f509db40fd45c4411d240ae979c?s=128&d=identicon&r=PG&f=1", "display_name": "Tdizzle", "link": "https://stackoverflow.com/users/8703310/tdizzle"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565852982, "post_id": 57502003, "comment_id": 101480099, "body": "and @JonathanLeffler, you&#39;re right. Sometimes the write time is a negative value, like  -961296345ns. Can you explain how this happens?"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565932344, "post_id": 57502003, "comment_id": 101505866, "body": "Consider two times about 1 millisecond apart \u2014 (1) <code>(struct timespec){ .tv_sec = 123456788, .tv_nsec = 999888777 }</code> and (2) <code>(struct timespec){ .tv_sec = 123456789, .tv_nsec = 000777666 }</code>.  When you subtract the <code>tv_nsec</code> value of (1) from the <code>tv_nsec</code> value of (2), you end up with a large negative value because you&#39;ve not taken into account the change in the seconds value.  That&#39;s how you get the large negative value.  Fixing that is a bit harder \u2014 you need to write a function that will do the job, leaving you with a value <code>(struct timespec){ .tv_sec = 0, .tv_nsec = 888889 }</code>."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565932692, "post_id": 57502003, "comment_id": 101505929, "body": "You might find some semi-relevant macros in <code>&#47;usr&#47;include&#47;sys&#47;time.h</code> for <code>timeradd()</code> and <code>timersub()</code> \u2014 they&#39;re semi-relevant because if they exist, they&#39;re for <code>struct timeval</code> rather than <code>struct timespec</code>.  They seem to originate in BSD Unix."}, {"owner": {"reputation": 43, "user_id": 8703310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6fd2f509db40fd45c4411d240ae979c?s=128&d=identicon&r=PG&f=1", "display_name": "Tdizzle", "link": "https://stackoverflow.com/users/8703310/tdizzle"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1566029217, "post_id": 57502003, "comment_id": 101534037, "body": "@JonathanLeffler I&#39;m going to try this out... totalTime = ((end.tv_sec - start.tv_sec) * (1000000000)) + (end.tv_nsec - start.tv_nsec);"}], "owner": {"reputation": 43, "user_id": 8703310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6fd2f509db40fd45c4411d240ae979c?s=128&d=identicon&r=PG&f=1", "display_name": "Tdizzle", "link": "https://stackoverflow.com/users/8703310/tdizzle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565839674, "creation_date": 1565816510, "last_edit_date": 1565839674, "question_id": 57502003, "link": "https://stackoverflow.com/questions/57502003/how-do-i-clear-memory-of-files-data-while-the-program-that-runs-it-is-still-run", "title": "How do I clear memory of file&#39;s data while the program that runs it is still running", "body": "<p>I have a program that is supposed to detect if the same memory data is already loaded into memory by recording the write time of data put into memory.</p>\n\n<p>How it works: <a href=\"https://www.linux-kvm.org/page/KSM\" rel=\"nofollow noreferrer\">KSM</a> (tool of Linux) saves memory by using the same memory location for duplicated copies of data to save some memory. When this data gets written after it has been combined with a copy, the two data segments must split back up again because they would become different. This is essentially creating a new copy, then writing to it. This process of creating a new copy then writing to it takes significantly longer to write to as opposed to writing to memory that is not combined. This write time is recorded, and thus shows if there is another data source within memory that matches what I am writing to. </p>\n\n<p>Problem: I cannot find out how to dump a file from memory after I open it. I have tried the file descriptor method of opening a file with <code>open()</code> and then closing it with <code>clone()</code> (<code>close()</code>?) as well as currently using <code>fopen()</code> and <code>fclose()</code>. I have a program that runs in the host environment and uploads the file to memory, then later writes to it to detect KSM file merging. I have a virtual environment that runs its own program that just opens the file, essentially uploading it to memory just by opening it. These programs will both upload the file to memory at the same time, then writing to the memory location the file is uploaded to with show if they have merged based on the write time. The thing is, just running the program in the host environment, I am detecting KSM-merging. I have narrowed it down to most likely being the file itself still being in memory after I open it and combining with a copy of the file made in the program. Unfortunately there is no way around making a copy of the file that I know of. I need to used a certain function, <code>madvise()</code>, in order to upload from host environment to work with KSM tool. Can someone help me with a for sure way to remove the file from memory?</p>\n\n<p>As mentioned, I have tried to used file descriptor method of opening a file, with <code>open()</code> and <code>close()</code>. I am currently running <code>fopen()</code> and <code>fclose()</code>. I have set the pointer of the file to NULL after calling <code>fclose()</code> as well. I am uploading an <code>.mp3</code> file. When calling <code>memset()</code>, then value uploaded is the byte itself. I have added 7 to value, for every byte upload, to see if it is the file being opened in the program. The tests show no sign of duplication when I do this. It proves that the KSM-duplication that is being detected is isolated from the program. I have also created a byte array of the file, then reversed the order of the bytes, then uploaded to memory, in order to get rid of the possibility of the array containing the bytes to be merging with the upload. Here is my code...</p>\n\n<pre><code>//\n// Created by Taylor on 8/2/2019.\n//\n\n//#include &lt;iostream&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;time.h&gt;\n#include &lt;sys/mman.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/stat.h&gt;\n\n\nint main(int argc, const char *argv[]){\n\n  if(argc &lt; 2){\n    printf(\"Must input a file name after running program.\\n\\nExample: [User@somewhere] ./RunProg &lt;filename&gt;\\n\");\n  }\n\n\n//    int fd;\n//    struct stat statbuf;\n//\n//    fd = open(argv[1], O_RDONLY, S_IRUSR | S_IRGRP);\n//    if (fd == -1)\n//    {\n//        printf(\"failed to open %s\\n\", argv[1]);\n//        exit(EXIT_FAILURE);\n//    }\n//\n//    if (fstat(fd, &amp;statbuf) == -1)\n//    {\n//        printf(\"failed to fstat %s\\n\", argv[1]);\n//        exit(EXIT_FAILURE);\n//    }\n\n    /*Thank you, user1274193, from stackoverflow.com*/\n\n\n//    long filesize = fileSize(argv[1]);\n//    char *byteArray = fileByteArray(argv[1]);\n\n\n    FILE *fileptr;\n    char *byteArrayx;\n    long filesize;\n\n    fileptr = fopen(argv[1], \"rb\");  // Open the file in binary mode\n    fseek(fileptr, 0, SEEK_END);          // Jump to the end of the file\n    filesize = ftell(fileptr);             // Get the current byte offset in the file\n    rewind(fileptr);                      // Jump back to the beginning of the file\n    printf(\"\\n\\nfilesize: %d \\n\\n\", filesize);\n\n    byteArrayx = (char *)malloc((filesize)*sizeof(char)); // Enough memory for file + \\0\n    fread(byteArrayx, filesize, 1, fileptr); // Read in the entire file\n    printf(\"First 10 bytes of file: \");\n    for (int z = 0; z &lt; 10; z++){\n        printf(\" %d \", (unsigned) byteArrayx[z]);\n    }\n    printf(\"\\n\");\n\n    char *byteArray = (char *)malloc((filesize)*sizeof(char));\n\n\n    //Array created so byteArray does not combine with page_1 array\n    //reversed order ensures no combination.\n    int ref = 0;\n    for (int y = filesize; y &gt; 0; y--){\n        byteArray[ref] = byteArrayx[y-1];\n        ref++;\n    }\n    fclose(fileptr); // Close the file\n    fileptr = NULL;\n    for (int z = 0; z &lt; filesize; z++){\n        byteArrayx[z] = 0;\n    }\n    free(byteArrayx);\n\n\n    struct timespec start, end;\n    long lSize;\n    //int filesize = statbuf.st_size;\n\n    size_t p_size = sysconf(_SC_PAGE_SIZE);\n    int pagesize = p_size;\n    int pages;\n    long writeDur;\n    char c;\n    void **pages_1 = (void **)calloc( pages, sizeof(void *));\n    printf(\"\\nFile size: %d bytes\\n\", filesize);\n    printf(\"\\nPage size: %d bytes\\n\", pagesize);\n    if ((filesize/pagesize * pagesize) &lt; filesize){\n        pages = filesize/pagesize + 1;\n    }\n    else pages = filesize/pagesize;\n\n    printf(\"\\nNumber of pages: %d\\n\", pages);\n\n//    char *byteArray = malloc(filesize);\n//\n//    for(int i = 0; i &lt; filesize; i++){\n//        read(fd, &amp;c, 1);\n//        byteArray[i] = c;\n//    }\n\n    //debugging purposes\n    //printf(\"\\nFinished Array\\n\");\n\n\n\n\n    for(int i = 0; i &lt; pages; i++){\n        pages_1[i] = mmap(NULL, p_size, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0);\n        //printf(\"\\nOn Page: %d\\n\", i);\n        for(int ii = 0; ii &lt; p_size; ii++){\n            //printf(\"\\nOn Byte: %d\\n\", (i*p_size)+ii);\n            if (((i*p_size)+ii) &lt; filesize ){\n                memset(pages_1[i] + ii, (unsigned) (byteArray[    ((   ((i*p_size)+ii) - (filesize - 1)) * -1)     ]), 1);\n                //memset(pages_1[i] + ii, 888, 1);\n                printf(\" %d \",  (byteArray[    ((   ((i*p_size)+ii) - (filesize - 1)) * -1)     ]));\n            }\n        }\n        madvise(pages_1[i], p_size, MADV_MERGEABLE);\n    }\n\n    printf(\"\\nUploaded file %s to memory....\\n\", argv[1]);\n    for (int z = 0; z &lt; filesize; z++){\n        byteArray[z] = 0;\n    }\n    free(byteArray);\n    //removes array so it is not in memory\n    //to be combined with other pages made in pages_1\n    //!!!pages_1 should be the only block representing the file in memory!!!\n\n\n\n\n//    if (close(fd) == -1)\n//    {\n//        printf(\"failed to fclose %s\\n\", argv[1]);\n//        exit(EXIT_FAILURE);\n//    }\n    printf(\"\\n%s has finished uploading.\\n\", argv[1]);\n\n\n    sleep(130);\n    printf(\"An adequate amount of time for merging has passed. \\n Please press enter to test. \\n Please press \\\"q\\\" then enter to quit program. \\n\");\n\n\n    char press;\n\n    while(1){\n\n        if (press == 0x0a){\n            clock_gettime(CLOCK_REALTIME, &amp;start);\n            for(int i = 0; i &lt; pages; i++){\n                //printf(\"\\nOn Page %d\\n\", i + 1);\n                memset(pages_1[i],7,1);\n            }\n            clock_gettime(CLOCK_REALTIME, &amp;end);\n            printf(\"\\nWrite time after upload took: %dns\\n\", end.tv_nsec - start.tv_nsec);\n        }\n\n        else if (press == 0x71){\n            break;\n        }\n\n        press = getchar();\n\n    }\n\n    free(pages_1);\n\n    return 0;\n}\n\n\n</code></pre>\n\n<p>When I run this program, I should not see a large number indicated combined memory after hitting enter once, yet I do. The value shown after hitting enter twice is what is to be expected after just hitting enter once. </p>\n\n<p>Results:</p>\n\n<pre><code>Write time after upload took: 1436862ns\nWrite time after upload took: 51896ns\nWrite time after upload took: 44083ns\nWrite time after upload took: 18412ns\nWrite time after upload took: 18217ns\nWrite time after upload took: 38242ns\nWrite time after upload took: 20739ns\n</code></pre>\n"}, {"tags": ["c", "cubic-spline"], "comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 1, "creation_date": 1565815970, "post_id": 57501317, "comment_id": 101472972, "body": "I stopped counting after 6 outright bugs and highly questionable - even for the mid 90&#39;s - bits of code in the first listing alone. I wouldn&#39;t use this as an example of how to write C."}, {"owner": {"reputation": 1365, "user_id": 5133472, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/8OSVZ.jpg?s=128&g=1", "display_name": "Mtl Dev", "link": "https://stackoverflow.com/users/5133472/mtl-dev"}, "reply_to_user": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1565820942, "post_id": 57501317, "comment_id": 101474361, "body": "Thanks,your comments and second eyes appreciated.  Strange as the publication seemed so well written and presented!"}], "answers": [{"comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565816843, "post_id": 57501495, "comment_id": 101473201, "body": "I think I would have gone with uniform <code>for (i = 1; i &lt; num_pnts - 1; i++)</code> for the loop controls."}, {"owner": {"reputation": 1365, "user_id": 5133472, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/8OSVZ.jpg?s=128&g=1", "display_name": "Mtl Dev", "link": "https://stackoverflow.com/users/5133472/mtl-dev"}, "edited": false, "score": 0, "creation_date": 1565818915, "post_id": 57501495, "comment_id": 101473811, "body": "Thanks. It seems rather strange indeed that such an (apparently) well thought, and and well documented, algorithm would be accompanied by such bad coding?"}, {"owner": {"reputation": 5092, "user_id": 5481471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf6efc50461d3521db348bf483652040?s=128&d=identicon&r=PG&f=1", "display_name": "G. Sliepen", "link": "https://stackoverflow.com/users/5481471/g-sliepen"}, "edited": false, "score": 0, "creation_date": 1565897196, "post_id": 57501495, "comment_id": 101498292, "body": "Everyone can make mistakes, even people two orders of magnitude smarter than you or me. The coding style actually looks bad in general now, but was very typical of the late nineties. It&#39;s what you would find in widely published books like <a href=\"https://en.wikipedia.org/wiki/Numerical_Recipes\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Numerical_Recipes</a>. Very condensed. Combined with the fact that compilers were not that strict 20 years ago, it might have actually run and produced a reasonable result on the author&#39;s computer."}], "tags": [], "owner": {"reputation": 5092, "user_id": 5481471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf6efc50461d3521db348bf483652040?s=128&d=identicon&r=PG&f=1", "display_name": "G. Sliepen", "link": "https://stackoverflow.com/users/5481471/g-sliepen"}, "is_accepted": true, "score": 3, "last_activity_date": 1565814944, "last_edit_date": 1565814944, "creation_date": 1565813978, "answer_id": 57501495, "question_id": 57501317, "link": "https://stackoverflow.com/questions/57501317/does-this-published-cubic-spline-extrema-code-have-errors/57501495#57501495", "title": "Does this published Cubic Spline Extrema code have errors?", "body": "<p>Yes, those are actual mistakes. The array <code>diag</code> is allocated using <code>malloc()</code>. The pointer is to the start of the allocated region. By evaluating <code>diag[i - 1]</code> when <code>i</code> equals <code>0</code>, it access outside the bounds of the allocated array.</p>\n\n<p>It looks like the code meant to have the for loop start from 1, as you correctly tried. Indeed, then <code>diag[i - 2]</code> is also wrong. Since the <code>main_diag[]</code> array is filled starting from index <code>0</code>, I think that was the intent for the secondary diagonal as well. So I think the second and third loops should have been:</p>\n\n<pre><code>for (i = 0; i &lt; num_pnts - 1; i++) {\n  diag[i] = x[i + 1] - x[i];\n  assert(diag[i] &gt; 0);\n}\n\n/* compute right hand side of equation */\nfor (i = 1; i &lt; num_pnts - 1; i++) {\n  right[i - 1] = 6.0 * ((y[i + 1] - y[i]) / diag[i] - (y[i] - y[i - 1]) / diag[i - 1]);\n}\n</code></pre>\n\n<p>Accessing out of bounds doesn't necessarily result in a segmentation fault, it merely is undefined behaviour. It depends on the compiler and the implementation of <code>malloc()</code> whether memory right outside the bounds of the allocated memory is valid or not. And even if the memory was accessible, <code>diag[i - 2]</code> is on the right hand of a division operator, so if the memory at that location contained a zero, it would have caused a division by zero. So it might have crashed with a compiler from 1999 just as well.</p>\n\n<p>It would be best if you can figure out what formulas were supposed to be implemented, and then check whether the code is correct or not.</p>\n"}], "owner": {"reputation": 1365, "user_id": 5133472, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/8OSVZ.jpg?s=128&g=1", "display_name": "Mtl Dev", "link": "https://stackoverflow.com/users/5133472/mtl-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 57501495, "answer_count": 1, "score": 2, "last_activity_date": 1566174653, "creation_date": 1565813017, "last_edit_date": 1566174653, "question_id": 57501317, "link": "https://stackoverflow.com/questions/57501317/does-this-published-cubic-spline-extrema-code-have-errors", "title": "Does this published Cubic Spline Extrema code have errors?", "body": "<p>I am attempting to implement the <a href=\"http://mikecourtney.tripod.com/extrema/CubicPaper.html\" rel=\"nofollow noreferrer\">Cublic Spline Extrema Algorithm</a> published in 1996.  </p>\n\n<p>I am not an accomplished programmer, and it is clear the author is, and is an order of magnitude or two smarter than I.  However when I try and compile this, it seg faults on a simple out-of-bounds array access.  I find it hard to believe that this algorithm was published with what seems, to me, to be a trivial mistake. Thus, I conclude the misunderstanding is likely to be mine and not the authors. (e.g perhaps he was using a trick I am unaware of that may have worked in c 20 years ago...).</p>\n\n<p>The first segfault happens here, with an attempt to access <code>diag[-1]</code>:</p>\n\n<pre><code>float *diag;      /* ptr to matrix diagonal array */\nfor (i = 0; i &lt; num_pnts - 1; i++){\n    diag[i-1] = x[i+1] - x[i];\n    assert(diag[i-1] &gt; 0);}\n</code></pre>\n\n<p>And, if I fix the above for loop to start at<code>1</code>, then another segfault will occur at the next loop, for a similir reason, (<code>diag[i-2]--&gt;diag[-1]</code>)</p>\n\n<pre><code>for (i = 1; i &lt; num_pnts - 1; i++)\nright[i-1] = 6.0 * ((y[i+1]-y[i])/diag[i-1]-(y[i]-y[i-1])/diag[i-2]);\n</code></pre>\n\n<p><a href=\"https://web.archive.org/web/20140810220152/http://collaboration.cmc.ec.gc.ca/science/rpn/biblio/ddj/Website/articles/DDJ/1996/9604/9604c/9604c.htm\" rel=\"nofollow noreferrer\">A link to the full source code is here</a></p>\n\n<p>So my question is, this algorithm is published by a very accomplished individual, not a first year CS student.  So while these look like errors to me (and indeed, segfault on a 2019 system), is there something else going on here I am missing? e.g would this OOB error have had a different result with a 1996 c compiler or something?</p>\n\n<p>Question: are these actually mistakes?</p>\n"}, {"tags": ["c", "initialization", "openmp"], "comments": [{"owner": {"reputation": 20828, "user_id": 620382, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bf285996e4e7188feac84786a47d9f3a?s=128&d=identicon&r=PG", "display_name": "Zulan", "link": "https://stackoverflow.com/users/620382/zulan"}, "edited": false, "score": 1, "creation_date": 1565855557, "post_id": 57501096, "comment_id": 101480915, "body": "For future reference, please don&#39;t omit the memory allocation. This means the code is not easily reproducible (see <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>)."}], "answers": [{"comments": [{"owner": {"reputation": 20828, "user_id": 620382, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bf285996e4e7188feac84786a47d9f3a?s=128&d=identicon&r=PG", "display_name": "Zulan", "link": "https://stackoverflow.com/users/620382/zulan"}, "edited": false, "score": 1, "creation_date": 1565821902, "post_id": 57502555, "comment_id": 101474576, "body": "You are right about the error, but <code>firstprivate(filterpart)</code> is <b>not</b> the solution here. This would just copy the (outer) pointer and thus a huge race condition. You need to explicitly allocate memory for each thread."}, {"owner": {"reputation": 20828, "user_id": 620382, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bf285996e4e7188feac84786a47d9f3a?s=128&d=identicon&r=PG", "display_name": "Zulan", "link": "https://stackoverflow.com/users/620382/zulan"}, "edited": false, "score": 0, "creation_date": 1565854981, "post_id": 57502555, "comment_id": 101480712, "body": "BTW the standard actually <i>clearly specifies</i> how <code>private</code> variables are (not) initialized: &quot;The new list item is initialized, or has an undefined initial value, as if it had been locally declared without an initializer.&quot;"}], "tags": [], "owner": {"reputation": 62, "user_id": 11919338, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fe3423d87c9d2e84facbbce9f3da7ef?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey Zavodchenkov", "link": "https://stackoverflow.com/users/11919338/alexey-zavodchenkov"}, "is_accepted": false, "score": -2, "last_activity_date": 1565819781, "creation_date": 1565819781, "answer_id": 57502555, "question_id": 57501096, "link": "https://stackoverflow.com/questions/57501096/uninitialize-warning-in-openmp/57502555#57502555", "title": "Uninitialize warning in OpenMP", "body": "<p>In the <a href=\"https://www.openmp.org/wp-content/uploads/OpenMP3.1.pdf\" rel=\"nofollow noreferrer\">OpenMP 3.1</a>  documentation (but it is probably correct for later versions) it isn't specified that the <code>private</code> clause will initialize a variable with earlier assigned value. What you are looking for is the<code>firstprivate</code> clause.</p>\n"}, {"tags": [], "owner": {"reputation": 20828, "user_id": 620382, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bf285996e4e7188feac84786a47d9f3a?s=128&d=identicon&r=PG", "display_name": "Zulan", "link": "https://stackoverflow.com/users/620382/zulan"}, "is_accepted": false, "score": 2, "last_activity_date": 1565855500, "creation_date": 1565855500, "answer_id": 57506461, "question_id": 57501096, "link": "https://stackoverflow.com/questions/57501096/uninitialize-warning-in-openmp/57506461#57506461", "title": "Uninitialize warning in OpenMP", "body": "<p>Your compiler is right, <code>filterpart</code> is uninitialized - as are private variables in OpenMP. But that's not the full story. You are handling (double) pointers here, OpenMP data-sharing only cares about the (outer) pointer, not the memory pointed to. For private data that is accessed through pointer types, you must manually take care of the private allocations for each thread.</p>\n\n<p>In general, it is much easier to reason about variables in parallel regions if you declare them <em>as locally as possible</em>. Then you typically don't have to bother about manually specifying data-sharing (private/shared). In your example this looks like:</p>\n\n<pre><code>float **model_tmp, **model; // coming from the outside, shared. Check for race conditions\n\n#pragma omp parallel for\nfor (int j=1;j&lt;=NYG;j++){ \n    for (int i=1;i&lt;=NXG;i++){ \n        float **filterpart;\n        /* Omit the memory allocation, and initialize the element to 0.0 here */\n        for (int ii=-hfs;ii&lt;=hfs;ii++){\n            for (int jj=-hfs;jj&lt;=hfs;jj++){\n                filterpart[ii+hfs+1][jj+hfs+1] = model_tmp[j+jj][i+ii];\n            }\n        }\n        model[j-1][i-1] = median2d(filterpart,abs(filt_grid),abs(filt_grid));\n    }\n}\n</code></pre>\n\n<p>Now it is much easier to see that this code is correct. But there is a <em>potential</em> performance issue due to repeated memory allocation for <code>filterpart</code>. If that turns out to have an impact on your performance, you can transform the code as follows:</p>\n\n<pre><code>#pragma omp parallel\n{\n    float **filterpart;\n    /* Omit the memory allocation, but why would you initialize the elements? */\n\n    #pragma omp for\n    for (int j=1;j&lt;=NYG;j++){ \n        for (int i=1;i&lt;=NXG;i++){ \n            for (int ii=-hfs;ii&lt;=hfs;ii++){\n                for (int jj=-hfs;jj&lt;=hfs;jj++){\n                    filterpart[ii+hfs+1][jj+hfs+1] = model_tmp[j+jj][i+ii];\n                }\n            }\n            model[j-1][i-1] = median2d(filterpart,abs(filt_grid),abs(filt_grid));\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11890028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02796b834bf531fa3ed0e2ad1ce760ef?s=128&d=identicon&r=PG&f=1", "display_name": "clduan11", "link": "https://stackoverflow.com/users/11890028/clduan11"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1565855500, "creation_date": 1565812029, "question_id": 57501096, "link": "https://stackoverflow.com/questions/57501096/uninitialize-warning-in-openmp", "title": "Uninitialize warning in OpenMP", "body": "<p>I have a code snippet which uses OpenMP to parallel the \"for loop\" :</p>\n\n<pre><code>float **filterpart=NULL, **model_tmp, **model;\n\n/* Omit the memory allocation, and initialize the element to 0.0 here */\n\n#ifdef _OPENMP\n#pragma omp parallel for default(none) \\\nprivate(i,j,ii,jj,filterpart) \\\nshared(NYG,NXG,hfs,model_tmp,model,filt_grid)\n#endif\n    for (j=1;j&lt;=NYG;j++){ \n        for (i=1;i&lt;=NXG;i++){ \n                for (ii=-hfs;ii&lt;=hfs;ii++){\n                    for (jj=-hfs;jj&lt;=hfs;jj++){\n                        filterpart[ii+hfs+1][jj+hfs+1] = model_tmp[j+jj][i+ii];\n                    }\n                }\n\n                model[j-1][i-1] = median2d(filterpart,abs(filt_grid),abs(filt_grid));\n\n        }\n    }\n</code></pre>\n\n<p>But when I compiled it, it says:\n<code>warning: \u2018filterpart\u2019 may be used uninitialized in this function [-Wmaybe-uninitialized]</code></p>\n\n<p>I have initialized at the beginning to <code>NULL</code>, and each element to <code>0.0</code> in this code. Does anybody know what's wrong here?</p>\n"}, {"tags": ["c", "singly-linked-list"], "comments": [{"owner": {"reputation": 324, "user_id": 7456666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e34d6d134601f768d81fb0b8eb73ab2e?s=128&d=identicon&r=PG&f=1", "display_name": "YouKnowWhoIAm", "link": "https://stackoverflow.com/users/7456666/youknowwhoiam"}, "edited": false, "score": 0, "creation_date": 1565808677, "post_id": 57500276, "comment_id": 101470341, "body": "Intially <code>prev</code> is NULL, so reaching Null-&gt;next leads to error"}, {"owner": {"reputation": 324, "user_id": 7456666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e34d6d134601f768d81fb0b8eb73ab2e?s=128&d=identicon&r=PG&f=1", "display_name": "YouKnowWhoIAm", "link": "https://stackoverflow.com/users/7456666/youknowwhoiam"}, "edited": false, "score": 0, "creation_date": 1565808844, "post_id": 57500276, "comment_id": 101470400, "body": "Also handle cases like what If there is only one Node then your newHead returns null. Take more examples and put them on paper"}, {"owner": {"reputation": 310, "user_id": 6941400, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/srsn4.jpg?s=128&g=1", "display_name": "Anshuman Kumar", "link": "https://stackoverflow.com/users/6941400/anshuman-kumar"}, "edited": false, "score": 0, "creation_date": 1565808930, "post_id": 57500276, "comment_id": 101470438, "body": "Hey @tnxy, try out what I have commented and see the link that was provided.  Let me know if it works."}], "answers": [{"comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1565808518, "post_id": 57500385, "comment_id": 101470282, "body": "This does not seem to address the actual question of what is wrong with the OP&#39;s code."}, {"owner": {"reputation": 324, "user_id": 7456666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e34d6d134601f768d81fb0b8eb73ab2e?s=128&d=identicon&r=PG&f=1", "display_name": "YouKnowWhoIAm", "link": "https://stackoverflow.com/users/7456666/youknowwhoiam"}, "edited": false, "score": 1, "creation_date": 1565808974, "post_id": 57500385, "comment_id": 101470449, "body": "Justing posting code is not acceptable, please read guidelines before answering a question and provide some examples of why you chose this,  Also the question asks what is the problem with a piece of code not a code that works for some K"}], "tags": [], "owner": {"reputation": 72, "user_id": 9586444, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ik99U-OP8V4/AAAAAAAAAAI/AAAAAAAAABk/wA2qyemjOCw/photo.jpg?sz=128", "display_name": "Utsav Patel", "link": "https://stackoverflow.com/users/9586444/utsav-patel"}, "is_accepted": false, "score": 0, "last_activity_date": 1565808308, "creation_date": 1565808308, "answer_id": 57500385, "question_id": 57500276, "link": "https://stackoverflow.com/questions/57500276/how-to-reverse-a-linked-list-in-pairs/57500385#57500385", "title": "How to reverse a linked list in pairs", "body": "<pre><code>Node *reverse (Node *head, int k)  \n{  \n    Node* current = head;  \n    Node* next = NULL;  \n    Node* prev = NULL;  \n    int count = 0;  \n    while (current != NULL &amp;&amp; count &lt; k)  \n    {  \n        next = current-&gt;next;  \n        current-&gt;next = prev;  \n        prev = current;  \n        current = next;  \n        count++;  \n    }  \n    if (next != NULL)  \n    head-&gt;next = reverse(next, k);  \n    return prev;  \n} \n</code></pre>\n\n<p>pass the value of k is 2</p>\n"}, {"tags": [], "owner": {"reputation": 310, "user_id": 6941400, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/srsn4.jpg?s=128&g=1", "display_name": "Anshuman Kumar", "link": "https://stackoverflow.com/users/6941400/anshuman-kumar"}, "is_accepted": false, "score": 0, "last_activity_date": 1565809361, "last_edit_date": 1565809361, "creation_date": 1565808822, "answer_id": 57500484, "question_id": 57500276, "link": "https://stackoverflow.com/questions/57500276/how-to-reverse-a-linked-list-in-pairs/57500484#57500484", "title": "How to reverse a linked list in pairs", "body": "<pre><code>void pairWiseSwap(struct Node* head) \n{ \n    struct Node* temp = head; \n\n    /* Traverse further only if there are at-least two nodes left */\n    while (temp != NULL &amp;&amp; temp-&gt;next != NULL) { \n        /* Swap data of node with its next node's data */\n        swap(&amp;temp-&gt;data, &amp;temp-&gt;next-&gt;data); \n\n        /* Move temp by 2 for the next pair */\n        temp = temp-&gt;next-&gt;next; \n    } \n} \n</code></pre>\n\n<p>Sourced from <a href=\"https://www.geeksforgeeks.org/pairwise-swap-elements-of-a-given-linked-list/\" rel=\"nofollow noreferrer\">GeeksForGeeks</a>.</p>\n\n<p>As for what is the error, it has been pointed out that prev is already NULL.</p>\n\n<pre><code> ListNode *current = head,*newHead = NULL,*temp = NULL,*prev = NULL;\n .\n .\n prev-&gt;next = temp;\n\n</code></pre>\n\n<p>We can't have NULL->next as it will throw a segmentation fault.</p>\n"}, {"comments": [{"owner": {"reputation": 41, "user_id": 5950826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243902298e48a8ec39eda070076e35f9?s=128&d=identicon&r=PG&f=1", "display_name": "tnxy", "link": "https://stackoverflow.com/users/5950826/tnxy"}, "edited": false, "score": 0, "creation_date": 1565849891, "post_id": 57500569, "comment_id": 101479207, "body": "ListNode fake_head = { .next = head };Can you explain me this line. I am unfamiliar with the syntax"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 41, "user_id": 5950826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243902298e48a8ec39eda070076e35f9?s=128&d=identicon&r=PG&f=1", "display_name": "tnxy", "link": "https://stackoverflow.com/users/5950826/tnxy"}, "edited": false, "score": 0, "creation_date": 1565869181, "post_id": 57500569, "comment_id": 101485776, "body": "@tnxy, <code>ListNode fake_head</code> declares an object of type <code>ListNode</code> (as opposed to a pointer to one).  The rest of that line specifies an <i>initializer</i> for <code>fake_head</code>.  The whole thing is analogous to <code>int x = 1;</code>.  The initializer syntax for a structure type requires bounding curly braces (<code>{}</code>), and within I have used a <i>designated initializer</i> to specify the initial value of the <code>next</code> member by name instead of by declaration order."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 1, "last_activity_date": 1565809786, "last_edit_date": 1565809786, "creation_date": 1565809271, "answer_id": 57500569, "question_id": 57500276, "link": "https://stackoverflow.com/questions/57500276/how-to-reverse-a-linked-list-in-pairs/57500569#57500569", "title": "How to reverse a linked list in pairs", "body": "<blockquote>\n  <p>what is wrong in my code.</p>\n</blockquote>\n\n<p>The main problem I see is here:</p>\n\n<blockquote>\n<pre><code>            prev-&gt;next = temp;\n</code></pre>\n</blockquote>\n\n<p>On the first iteration of the loop, <code>prev</code> is still <code>NULL</code> at that point, so you're performing a null-pointer dereference.</p>\n\n<p>You can resolve that issue and also remove the special case for the list head by introducing a synthetic head node in front of the real nodes:</p>\n\n<pre><code>ListNode* reverseListInPairs(ListNode *head) {\n    ListNode fake_head = { .next = head };\n    ListNode *prev = &amp;fake_head;\n    ListNode *current = head;\n\n    while (current != NULL &amp;&amp; current-&gt;next != NULL) {\n        ListNode *temp = current-&gt;next;\n\n        current-&gt;next = current-&gt;next-&gt;next;\n        temp-&gt;next = current;\n        prev-&gt;next = temp;\n\n        prev = current;\n        current = current-&gt;next;\n    }\n\n    return fake_head.next;\n}\n</code></pre>\n\n<p>I've stuck as close as possible to your original code there, but personally, I'd tighten it up a little further.  In particular, you don't need to maintain both <code>current</code> and <code>prev</code> across iterations; just the latter would be sufficient.</p>\n\n<pre><code>ListNode* reverseListInPairs(ListNode *head) {\n    ListNode fake_head = { .next = head };\n    ListNode *prev = &amp;fake_head;\n\n    while (prev-&gt;next &amp;&amp; prev-&gt;next-&gt;next) {\n        ListNode *first = prev-&gt;next;\n        ListNode *second = first-&gt;next;\n\n        prev-&gt;next = second;\n        first-&gt;next = second-&gt;next;\n        second-&gt;next = first;\n\n        prev = first;\n    }\n\n    return fake_head.next;\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 5950826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/243902298e48a8ec39eda070076e35f9?s=128&d=identicon&r=PG&f=1", "display_name": "tnxy", "link": "https://stackoverflow.com/users/5950826/tnxy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 1, "accepted_answer_id": 57500569, "answer_count": 3, "score": 0, "last_activity_date": 1565809786, "creation_date": 1565807746, "question_id": 57500276, "link": "https://stackoverflow.com/questions/57500276/how-to-reverse-a-linked-list-in-pairs", "title": "How to reverse a linked list in pairs", "body": "<p>I want to reverse a linked list in pair such that if the list is 1->2->3->4->X\nthen it should output the following 2->1->4->3->X</p>\n\n<p>I have tried to solve this problem but it doesn't seem to run. Guys, can you please help me with what is wrong in my code.</p>\n\n<pre><code>ListNode* reverseListInPairs(ListNode *head){\n        ListNode *current = head,*newHead = NULL,*temp = NULL,*prev = NULL;\n        while(current != NULL &amp;&amp; current-&gt;next != NULL){\n\n            temp = current-&gt;next;\n            current-&gt;next = current-&gt;next-&gt;next;\n            temp-&gt;next = current;\n            prev-&gt;next = temp;\n            prev = current;\n            current = current-&gt;next;\n            if(newHead == NULL){\n                newHead = temp;\n            }\n        }\n        return newHead;\n    }\n</code></pre>\n"}, {"tags": ["c", "x86-64", "long-double"], "answers": [{"tags": [], "owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": true, "score": 3, "last_activity_date": 1565837382, "last_edit_date": 1565837382, "creation_date": 1565836656, "answer_id": 57504247, "question_id": 57499986, "link": "https://stackoverflow.com/questions/57499986/how-to-get-the-mantissa-of-an-80-bit-long-double-as-an-int-on-x86-64/57504247#57504247", "title": "How to get the mantissa of an 80-bit long double as an int on x86-64", "body": "<p>x86's float and integer endianness is little-endian, so the significand (aka mantissa) is the low 64 bits of an 80-bit x87 <code>long double</code>.</p>\n\n<p>In assembly, you just load the normal way, like <code>mov rax, [rdi]</code>.</p>\n\n<p>Unlike IEEE binary32 (<code>float</code>) or binary64 (<code>double</code>), 80-bit long double stores the leading 1 in the significand <em>explicitly</em>.  (Or <code>0</code> for subnormal).  <a href=\"https://en.wikipedia.org/wiki/Extended_precision#x86_extended_precision_format\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Extended_precision#x86_extended_precision_format</a></p>\n\n<p><strong>So the unsigned integer value (magnitude) of the true significand is the same as what's actually stored in the object-representation.</strong></p>\n\n<p>If you want signed <code>int</code>, too bad; including the sign bit it would be 65 bits but <code>int</code> is only 32-bit on any x86 C implementation.</p>\n\n<p>If you want <code>int64_t</code>, you could maybe right shift by 1 to discard the low bit, making room for a sign bit.  Then do 2's complement negation if the sign bit was set, leaving you with a signed 2's complement representation of the significand value divided by 2.  (IEEE FP uses sign/magnitude with a sign bit at the top of the bit-pattern)</p>\n\n<hr>\n\n<p>In C/C++, yes you need to type-pun, e.g. with a union or <code>memcpy</code>.  All C implementations on x86 / x86-64 that expose 80-bit floating point at all use a 12 or 16-byte type with the 10-byte value at the bottom.</p>\n\n<p>Beware that MSVC uses <code>long double</code> = <code>double</code>, a 64-bit float, so check <a href=\"https://en.cppreference.com/w/c/types/limits\" rel=\"nofollow noreferrer\"><code>LDBL_MANT_DIG</code></a> from <code>float.h</code>, or <code>sizeof(long double)</code>.  All 3 <code>static_assert()</code> statements trigger on MSVC, so they all did their job and saved us from copying a whole binary64 <code>double</code> (sign/exp/mantissa) into our <code>uint64_t</code>.</p>\n\n<pre><code>// valid C11 and C++11\n#include &lt;float.h&gt;  // float numeric-limit macros\n#include &lt;stdint.h&gt;\n#include &lt;assert.h&gt;  // C11 static assert\n#include &lt;string.h&gt;  // memcpy\n\n// inline\nuint64_t ldbl_mant(long double x)\n{\n    // we can assume CHAR_BIT = 8 when targeting x86, unless you care about DeathStation 9000 implementations.\n    static_assert( sizeof(long double) &gt;= 10, \"x87 long double must be &gt;= 10 bytes\" );\n    static_assert( LDBL_MANT_DIG == 64, \"x87 long double significand must be 64 bits\" );\n\n    uint64_t retval;\n    memcpy(&amp;retval, &amp;x, sizeof(retval));\n    static_assert( sizeof(retval) &lt; sizeof(x), \"uint64_t should be strictly smaller than long double\" ); // sanity check for wrong types\n    return retval;\n}\n</code></pre>\n\n<p>This <a href=\"https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAKxAEZSAbAQwDtRkBSAJgCFufSAZ1QBXYskwgA5AHoZAagBuTBnnTyAwrVrzW6jf37aOABgCC3AMx4WyBiKzyOljQDMGqJgQB0CZ9nl5OXl3TwJ5FhEAW0xiPGQAWlUownkopmRiVEFTCy5rW3tHZw1BAnwWHz9LbFyrGzsHTCcXJkFBWKr/QOCtHTKveN12zrr8hqLmkrK4tl9uoIUYqOQABwBPOvMRGwIANgAWAH1whnQAIwYj9MqIDzZ5dFFL5oAPAEo6gHY%2Bc0CehQAd2ayFYw0E0WaGgAEmYAEpHHgASQAKi0ACLyAAc8kBCEwLHkBCYxGAmAINmA8leWL2pHkIhYDEw7Xk61E8lBxGaTHOonC6MwXgQAGViRTUISAJwmWXyPBRVbMmKVQaSwTeXL/eQDCnII5tDrEAgQHV4ABemFQrjukqpTxEL3eLVqlkxtBM9O4XBpX3k93tz2ZaREZXk5ymNWc7pM4fWBBZ3vkn0svzM2t18QNI2NpoAMuieHmjgBZMwAORRR3RSIA4hjo/JDl6uD6sX6A48g81BHhgCw8K54noQ2GI02DuHCDlW8nnGmtf8dpVDid5NyCMoGPPF4Flmt1hBuHsN1uW3tXvTe5brRBTyp3im0xnxVnDZ1TderTb7wxnSUzRvG0PhbLhl32Y5wkEBBRDOcMewIOJkAIBh1h1dIGGZYgiQQMFOwdF4kyfRYdVYQg0OQfFkAAaxCEhcSyB4CHWVZEz%2Bf4NzEQlfx3cwOC%2BdFcikd5GGkABWKRSBYaQTEk1BpAMXh%2BB1URxCmfJaEkggZOEkTqJASwvm8PYvhMsSTClMSuD2bRaC4USpAOSSojoWUpJ00h5KkSTBBAT1tKkWSRLgWAYEQFBUEVPAsPISg0CirCQGAKV7KHBgE2IXyIHODzzhsEl1mkTTSHilUCAAeSZQrAskrAbmAZkPPwblkLwRQWQ8zBXkwZARATIrJN2TAGA81RzmIAqNAwSQpGKxCFR0kTmDYFBDF4Rg8HOXzYBYJgYhAPlsgIUh2uIIqTOE0gIF2/bXCiY7TvE2VdM81YJRYXypASV5kHkBJyssP6AHUVAYHzVIkOglvEyTpJqzzpBpPYEkOeRgGQX6pW8Lh5AgXBCHoqx6E0SLVmi2InA051FL4XgtMWkT8SYLAzogPSDNobwTC%2BSwuAOGUDh5rFha%2BL4HKc0gXPM9z4a8ny/NIAKgqusKICQeKyZiigIA18mzuS1LooyrKcvhvLduIaritKgkKqqprMHqxr4eanqKXaz7ZNILqer6mbiqGkb4bGibLamrABsVuIXJqpbWHYNaBDG7aoBuyRDrKE7YnOr5LuuvbJDuh7s6kcygpE1A3rwdVpG%2B37/sBhIQcwv6ol58GxEh2hodL2GPK8pGUcndHMex3H8aIbCifpKaEopqwuGpxP6djxmhRZyge4lqXPThr25aEBWlZe/TLE57nef5kxBcsYX2zFoPLD72XpBX5WQqgVX1dJvXYp1n/Ep2HjliNyaVjaUFNl7c2BVI420qJVVCDsnYzS9q7VqHtOrdV6v1Wag1KjDVGptUO6xw7%2By0tHRajB46rSUutZO8B877QzsXM6s0LrBTTiAIuWdWFlxepXd6n065/QBsDUGHc1JQwchJGW%2B9Ea0iHpyZaVIsRcy5uPfAk9KZnxngA%2Be%2BRLBL1oTwN%2BJ8ObYzEuLZyIB%2BbeClPYhxjjHGyLkq/Q%2B/lKEfzVhFOeZBta60AcokBnowGxBNrlfKltYGRTKgg6qqDHbx2dqgvALV3YdXhj7bBZDyD4KDl7EOk1pqR3mjHZWyiaG0yTptFOjD06oCOjwnOedOHcMeqXZ6j5XqCNrqIpuoNW7tyEBDSQ3dpHPzkVIQeqMgEPFUSYdReNNGEw0ro3x2iDhGKqaYrpTMN5sysZLGxWMnGnIcS4hG3l3GKwZqQU%2BnMuCWMfhM1xVzj5dKDlwaxHpd79zce8kSp1eyShsUAA%3D%3D\" rel=\"nofollow noreferrer\">compiles efficiently on gcc/clang/ICC <strong>(on Godbolt)</strong></a> to just one instruction as a stand-alone function (because the calling convention passes <code>long double</code> in memory).  After inlining into code with a <code>long double</code> in an x87 register, it will presumably compile to a TBYTE x87 store and an integer reload.</p>\n\n<pre><code>## gcc/clang/ICC -O3 for x86-64\nldbl_mant:\n  mov rax, QWORD PTR [rsp+8]\n  ret\n</code></pre>\n\n<p>For 32-bit, gcc has a weird redundant-copy missed-optimization bug which ICC and clang don't have; they just do the 2 loads from the function arg without copying first.</p>\n\n<pre><code># GCC -m32 -O3  copies for no reason\nldbl_mant:\n  sub esp, 28\n  fld TBYTE PTR [esp+32]            # load the stack arg\n  fstp TBYTE PTR [esp]              # store a local\n  mov eax, DWORD PTR [esp]\n  mov edx, DWORD PTR [esp+4]        # return uint64_t in edx:eax\n  add esp, 28\n  ret\n</code></pre>\n\n<p>C99 makes union type-punning well-defined behaviour, and so does GNU C++.  I think MSVC defines it too.</p>\n\n<p>But <code>memcpy</code> is always portable so that might be an even better choice, and it's easier to read in this case where we just want one element.</p>\n\n<p>If you also want the exponent and sign bit, a union between a struct and <code>long double</code> might be good, except that padding for alignment at the end of the struct will make it bigger.  It's unlikely that there'd be padding after a <code>uint64_t</code> member before a <code>uint16_t</code> member, though.  But I'd worry about <code>:1</code> and <code>:15</code> bitfields, because IIRC it's implementation-defined which order the members of a bitfield are stored in.</p>\n"}], "owner": {"reputation": 1763, "user_id": 788488, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/135a741141d72d3374028e2c6bb77114?s=128&d=identicon&r=PG", "display_name": "meisel", "link": "https://stackoverflow.com/users/788488/meisel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 57504247, "answer_count": 1, "score": 0, "last_activity_date": 1565837382, "creation_date": 1565806323, "last_edit_date": 1565836937, "question_id": 57499986, "link": "https://stackoverflow.com/questions/57499986/how-to-get-the-mantissa-of-an-80-bit-long-double-as-an-int-on-x86-64", "title": "How to get the mantissa of an 80-bit long double as an int on x86-64", "body": "<p><code>frexpl</code> won't work because it keeps the mantissa as part of a long double. Can I use type punning, or would that be dangerous? Is there another way?</p>\n"}, {"tags": ["c++", "c", "libc", "libstdc++"], "comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1565804860, "post_id": 57499615, "comment_id": 101468816, "body": "You might be better off posting this on GitHub as a patchelf issue. Also what version are you using?"}, {"owner": {"reputation": 228, "user_id": 8365526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a91811f965b369b7ce83c056f4df139?s=128&d=identicon&r=PG&f=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/8365526/andy"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1565806291, "post_id": 57499615, "comment_id": 101469379, "body": "You think this is a bug? I&#39;m using patchelf 0.9, which is the latest version avaialble via Ubuntu 18.04&#39;s package repositories."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1565806318, "post_id": 57499615, "comment_id": 101469399, "body": "I don&#39;t know but I do think it&#39;s worth trying 0.10 if you can build a copy."}, {"owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "edited": false, "score": 2, "creation_date": 1565810910, "post_id": 57499615, "comment_id": 101471161, "body": "You need to use <code>ldd</code> from the custom glibc for testing, not system <code>ldd</code> (which will always use the system loader). Did you patch your glibc with multiarch path support? Upstream glibc doesn&#39;t have that."}], "answers": [{"comments": [{"owner": {"reputation": 228, "user_id": 8365526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a91811f965b369b7ce83c056f4df139?s=128&d=identicon&r=PG&f=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/8365526/andy"}, "edited": false, "score": 1, "creation_date": 1565813883, "post_id": 57500916, "comment_id": 101472242, "body": "glibc-2.23_install/bin/ldd suggested all executables I tried were &quot;not a dynamic execuatable&quot; (not sure what that is about), but I was able to work through your resolution half-blind to symlink  libstdc++.so.6 and one other library that were missing from glibc-2.23_install."}], "tags": [], "owner": {"reputation": 162629, "user_id": 50617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YFykQ.png?s=128&g=1", "display_name": "Employed Russian", "link": "https://stackoverflow.com/users/50617/employed-russian"}, "is_accepted": true, "score": 1, "last_activity_date": 1565810978, "creation_date": 1565810978, "answer_id": 57500916, "question_id": 57499615, "link": "https://stackoverflow.com/questions/57499615/libstdc-so-not-found-when-using-patchelf-and-alternate-glibc-version/57500916#57500916", "title": "libstdc++.so not found when using patchelf and alternate glibc version", "body": "<blockquote>\n  <p>Can you explain why this is happening?</p>\n</blockquote>\n\n<p>Your <code>/path_to/glibc-2.23_install/lib/ld-2.23.so</code> does <em>not</em> look in <code>/usr/lib/x86_64-linux-gnu</code>, and thus doesn't find <code>/usr/lib/x86_64-linux-gnu/libstdc++.so.6</code>.</p>\n\n<p>You should learn to <em>never</em> use <code>ldd</code> on your patched binary, as it will lie to you. Instead, use <code>/path_to/glibc-2.23_install/bin/ldd</code>, and it should tell you the same thing (that it can't find <code>libstdc++.so.6</code>).</p>\n\n<blockquote>\n  <p>What do I need to do?</p>\n</blockquote>\n\n<p>You need to arrange for <code>libstdc++.so.6</code> to be found someplace where <code>/path_to/glibc-2.23_install/lib/ld-2.23.so</code> is <em>actually</em> looking.</p>\n\n<p>Something like:</p>\n\n<pre><code>ln -s /usr/lib/x86_64-linux-gnu/libstdc++.so.6 /path_to/glibc-2.23_install/lib\n</code></pre>\n\n<p>should do the trick. You will likely need to repeat this for <code>libgcc_s.so.1</code> as well.</p>\n"}], "owner": {"reputation": 228, "user_id": 8365526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a91811f965b369b7ce83c056f4df139?s=128&d=identicon&r=PG&f=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/8365526/andy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 414, "favorite_count": 1, "accepted_answer_id": 57500916, "answer_count": 1, "score": 1, "last_activity_date": 1565810978, "creation_date": 1565804569, "last_edit_date": 1565805439, "question_id": 57499615, "link": "https://stackoverflow.com/questions/57499615/libstdc-so-not-found-when-using-patchelf-and-alternate-glibc-version", "title": "libstdc++.so not found when using patchelf and alternate glibc version", "body": "<p>I am working on a system with a system wide glibc 2.27 and am using pathelf to patch some executable to a customized version of glibc 2.23. The executables are compiled with a custom version of LLVM. This has been working fine on C programs, but doesn't work on C++ programs.</p>\n\n<pre><code># cp Xalan_base.cc-v2 Xalan_base.cc-v2_patched\n# /usr/bin/patchelf --set-interpreter /path_to/glibc-2.23_install/lib/ld-2.23.so --set-rpath /path_to/glibc-2.23_install/lib Xalan_base.cc-v2_patched\n# ./Xalan_base.cc-v2_patched -v t5.xml xalanc.xsl\n/path_to/Xalan_base.cc-v2_patched: error while loading shared libraries: libstdc++.so.6: cannot open shared object file: No such file or directory\n# ldd Xalan_base.cc-v2\n        linux-vdso.so.1 (0x00007ffe9efb8000)\n        libstdc++.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007f8db1524000)\n        libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f8db1186000)\n        libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007f8db0f6e000)\n        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f8db0b7d000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f8db18ad000)\n# ldd Xalan_base.cc-v2_patched\n        linux-vdso.so.1 (0x00007ffe08b7c000)\n        libstdc++.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007f43a5af0000)\n        libm.so.6 =&gt; /path_to/glibc-2.23_install/lib/libm.so.6 (0x00007f43a57eb000)\n        libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007f43a55d3000)\n        libc.so.6 =&gt; /path_to/glibc-2.23_install/lib/libc.so.6 (0x00007f43a5233000)\n        /path_to/glibc-2.23_install/lib/ld-2.23.so =&gt; /lib64/ld-linux-x86-64.so.2 (0x00007f43a5e79000)\n# ls -lah /usr/lib/x86_64-linux-gnu/libstdc++.so.6\nlrwxrwxrwx 1 root root 19 May  8 08:51 /usr/lib/x86_64-linux-gnu/libstdc++.so.6 -&gt; libstdc++.so.6.0.25\n</code></pre>\n\n<p>As I understand, libstdc++ is a compiler library. I'm not seeing any paths to my LLVM installation here, and those I do see all appear valid.</p>\n\n<p>Can you explain why this is happening? What do I need to do?</p>\n"}, {"tags": ["c", "arrays", "pointers", "unary-operator", "postfix-operator"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 3, "creation_date": 1565803353, "post_id": 57499301, "comment_id": 101468222, "body": "It&#39;s the same as <code>-(p[1])</code> which is the same as <code>-(array[2])</code>."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 7, "creation_date": 1565804520, "post_id": 57499301, "comment_id": 101468659, "body": "The riddle has two levels: to understand it, first you must know that <code>a[5] == 5[a]</code>. But if you haven&#39;t also memorized C&#39;s less-than-intuitive precedence rules, or if you don&#39;t remember that C treats <code>-1</code> as an application of the unary minus operator (instead of treating it as a single token and an intrinsically negative constant), you might be fooled into thinking that <code>-1[p]</code> is the same as <code>p[-1]</code> rather than <code>-(p[1])</code>."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 3, "creation_date": 1565805048, "post_id": 57499301, "comment_id": 101468891, "body": "And of course it binds lower than indexing because otherwise the sane looking <code>-p[1]</code> would try to negate a pointer ..."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1565807017, "post_id": 57499301, "comment_id": 101469716, "body": "@EugeneSh. I was about to vote for the <code>a[5] == 5[a]</code> one as a dup, too, but it really only covers half of this question.  I&#39;d say the surprising precedence here is equally significant."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "reply_to_user": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1565807403, "post_id": 57499301, "comment_id": 101469853, "body": "@SteveSummit I am not sure why precedence is so surprising and deserves a whole 5-answer question. Yes, it can be a bit confusing, but it is a very basic thing, especially given the results of the code execution.."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565817981, "post_id": 57499301, "comment_id": 101473528, "body": "@JL2210 Unlike how it is in more sensible languages, C programmers actually need to be able to solve these kinds of riddles in order to do their actual jobs."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 0, "creation_date": 1565821765, "post_id": 57499301, "comment_id": 101474544, "body": "@zwol But the least a programmer could do would be to write <code>-(1[p])</code> or <code>-p[1]</code> if it wasn&#39;t obvious."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 12, "last_activity_date": 1565803391, "creation_date": 1565803391, "answer_id": 57499356, "question_id": 57499301, "link": "https://stackoverflow.com/questions/57499301/what-is-1p-when-p-points-to-an-array-of-int-index/57499356#57499356", "title": "What is &#39;-1[p]&#39; when p points to an array (of int) index?", "body": "<p>First thing to figure out is the precedence. Namely <code>[]</code> has higher precedence than unary operators, so <code>-1[p]</code> is equal to <code>-(1[p])</code>, not <code>(-1)[p]</code>. So we're taking the result of <code>1[p]</code> and negating it.</p>\n\n<p><code>x[y]</code> is equal to <code>*(x+y)</code>, so <code>1[p]</code> is equal to <code>*(1+p)</code>, which is equal to <code>*(p+1)</code>, which is equal to <code>p[1]</code>.</p>\n\n<p>So we're taking the element one after where <code>p</code> points, so the third element of <code>array</code>, i.e. 3, and then negating it, which gives us <code>-3</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "is_accepted": false, "score": 6, "last_activity_date": 1565803772, "last_edit_date": 1565803772, "creation_date": 1565803433, "answer_id": 57499363, "question_id": 57499301, "link": "https://stackoverflow.com/questions/57499301/what-is-1p-when-p-points-to-an-array-of-int-index/57499363#57499363", "title": "What is &#39;-1[p]&#39; when p points to an array (of int) index?", "body": "<p>This</p>\n\n<pre><code>int array[] = {1, 2, 3};\n</code></pre>\n\n<p>looks like</p>\n\n<pre><code>array[0]   array[1]  array[2]\n --------------------------\n|     1   |    2    |   3  | \n --------------------------\n 0x100     0x104     0x108   &lt;-- lets assume 0x100 is base address of array\narray\n</code></pre>\n\n<p>Next when you do like </p>\n\n<pre><code>int *p = &amp;array[1];\n</code></pre>\n\n<p>the integer pointer <code>p</code> points to address  of <code>array[1]</code> i.e <code>0x104</code>. It looks like</p>\n\n<pre><code>array[0]   array[1]  array[2]\n --------------------------\n|     1   |    2    |   3  | \n --------------------------\n 0x100     0x104     0x108   &lt;-- lets assume 0x100 is base address of array\n             |\n            p holds 0x104\n</code></pre>\n\n<p>And when you do like</p>\n\n<pre><code>x = -1[p]\n</code></pre>\n\n<p><code>-1[p]</code> is equivalent to <code>-(1[p])</code> i.e <code>-(p[1])</code>. it looks like</p>\n\n<pre><code>-(p[1]) ==&gt; -(*(p + 1*4)) /* p holds points to array[1] i.e 0x104 */\n        ==&gt; -(*(0x104 + 4))\n        ==&gt; -(*(0x108)) ==&gt; value at 0x108 is 3\n        ==&gt; prints -3\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 184, "user_id": 5568042, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PNaB0Adj6tk/AAAAAAAAAAI/AAAAAAAADwo/k9o6Hf190Z4/photo.jpg?sz=128", "display_name": "Jordan Motta", "link": "https://stackoverflow.com/users/5568042/jordan-motta"}, "is_accepted": false, "score": 2, "last_activity_date": 1565803674, "last_edit_date": 1565803674, "creation_date": 1565803559, "answer_id": 57499383, "question_id": 57499301, "link": "https://stackoverflow.com/questions/57499301/what-is-1p-when-p-points-to-an-array-of-int-index/57499383#57499383", "title": "What is &#39;-1[p]&#39; when p points to an array (of int) index?", "body": "<p>What happens here is really interesting.</p>\n\n<p>p[n] means <code>*(p+n)</code>. Thats why you see 3, because \"p\" points to array[1] which is 2, and -p[1] is interpreted as <code>-(*(p+1))</code> which is -3.</p>\n"}, {"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 10, "last_activity_date": 1565806492, "last_edit_date": 1565806492, "creation_date": 1565804464, "answer_id": 57499595, "question_id": 57499301, "link": "https://stackoverflow.com/questions/57499301/what-is-1p-when-p-points-to-an-array-of-int-index/57499595#57499595", "title": "What is &#39;-1[p]&#39; when p points to an array (of int) index?", "body": "<p>According to the C Standard (6.5.2 Postfix operators) the subscript operator is defined the following way</p>\n\n<pre><code>postfix-expression [ expression ]\n</code></pre>\n\n<p>So before the square brackets there shall be a postfix expression.</p>\n\n<p>In this expression statement</p>\n\n<pre><code>x = -1[p];\n</code></pre>\n\n<p>there is used the postfix expression <code>1</code> (that is at the same time a primary expression), the postfix expression <code>1[p]</code> (that is the subscript operator) and the unary operator <code>-</code> Take into account that when the compiler splits a program into tokens then integer constants are considered as tokens themselves without the minus. minus is a separate token.</p>\n\n<p>So the statement can be rewritten like</p>\n\n<pre><code>x = -( 1[p] );\n</code></pre>\n\n<p>because a postfix expression has a higher priority than an unary expression.</p>\n\n<p>Let's consider at first the postfix sub-expression <code>1[p]</code></p>\n\n<p>According to the C Standard (6.5.2.1 Array subscripting)</p>\n\n<blockquote>\n  <p>2 A postfix expression followed by an expression in square brackets []\n  is a subscripted designation of an element of an array object. The\n  definition of the subscript operator [] is that E1[E2] is identical to\n  (*((E1)+(E2))). Because of the conversion rules that apply to the\n  binary + operator, if E1 is an array object (equivalently, a pointer\n  to the initial element of an array object) and E2 is an integer,\n  E1[E2] designates the E2-th element of E1 (counting from zero).</p>\n</blockquote>\n\n<p>So this sub-expression evaluates like <code>*( ( 1 ) + ( p ) )</code> and is the same as <code>*( ( p ) + ( 1 ) ).</code></p>\n\n<p>Thus the above statement</p>\n\n<pre><code>x = -1[p];\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>x = -p[1];\n</code></pre>\n\n<p>and will yield <code>-3</code>, because the pointer <code>p</code> points to the second element of the array due to the statement</p>\n\n<pre><code>int *p = &amp;array[1];\n</code></pre>\n\n<p>and then the expression <code>p[1]</code> yields the value of the element after the second element of the array. Then the unary operator <code>-</code> is applied.</p>\n"}, {"tags": [], "owner": {"reputation": 389, "user_id": 9782020, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YckaC.png?s=128&g=1", "display_name": "LunarLambda", "link": "https://stackoverflow.com/users/9782020/lunarlambda"}, "is_accepted": false, "score": 28, "last_activity_date": 1565804836, "creation_date": 1565804836, "answer_id": 57499686, "question_id": 57499301, "link": "https://stackoverflow.com/questions/57499301/what-is-1p-when-p-points-to-an-array-of-int-index/57499686#57499686", "title": "What is &#39;-1[p]&#39; when p points to an array (of int) index?", "body": "<p>I'm the person that made this \"riddle\" (see <a href=\"https://twitter.com/Lun_rLambda/status/1161595413255872512\" rel=\"noreferrer\">my Twitter post</a>)</p>\n\n<p>So! What's up with -1[p]?</p>\n\n<p>ISO C actually defines [] to be symmetrical, meaning <code>x[y]</code> is the same as <code>y[x]</code>, where x and y are both expressions.</p>\n\n<p>Naively, we could jump to the conclusion that <code>-1[p]</code> is therefore <code>p[-1]</code> and so <code>x = 1</code>,\nHowever, -1 is actually the unary minus operator applied to the constant 1, and unary minus has a lower precedence than []</p>\n\n<p>So, <code>-1[p]</code> is <code>-(p[1])</code>, which yields -3.</p>\n\n<p>This can lead to funky looking snippets like this one, too:</p>\n\n<p><code>sizeof(char)[\"abc\"] /* yields 'b' */</code></p>\n"}], "owner": {"reputation": 461, "user_id": 6399201, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/qcYFD.jpg?s=128&g=1", "display_name": "Erik Stroeken", "link": "https://stackoverflow.com/users/6399201/erik-stroeken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3230, "favorite_count": 3, "closed_date": 1565816966, "answer_count": 5, "score": 22, "last_activity_date": 1565806492, "creation_date": 1565803106, "last_edit_date": 1565805082, "question_id": 57499301, "link": "https://stackoverflow.com/questions/57499301/what-is-1p-when-p-points-to-an-array-of-int-index", "closed_reason": "Duplicate", "title": "What is &#39;-1[p]&#39; when p points to an array (of int) index?", "body": "<p>Today I stumbled over a C riddle that got a new surprise for me.</p>\n\n<p>I didn't think that -1[p] in the example below would compile, but it did. In fact, x ends up to be -3.</p>\n\n<pre><code>    int x;\n    int array[] = {1, 2, 3};\n    int *p = &amp;array[1];\n    x = -1[p]\n</code></pre>\n\n<p>I searched the internet for something like -1[pointer] but couldn't find anything. Okay, it is difficult to enter the correct search query, I admit. Who knows why -1[p] compiles and X becomes -3?</p>\n"}, {"tags": ["c", "linux", "system-calls", "printk"], "comments": [{"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1565803678, "post_id": 57499217, "comment_id": 101468339, "body": "It would help if you put a newline on the end of the messages, e.g. <code>pr_info(&quot;DECREMENTING ROOT FROM %d\\n&quot;, root-&gt;delta_time)</code>. If you absolutely must append to a previous message that had no newline, use <code>pr_cont</code> for the continuation instead of <code>pr_info</code>."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1565803912, "post_id": 57499217, "comment_id": 101468424, "body": "Also, <code>printk(&quot;[%d] &quot;, pos-&gt;delta_time);</code> could result in confusing kernel log output, because the number in square brackets will be interpreted as a log importance level. Use <code>printk(KERN_INFO &quot;[%d] &quot;, pos-&gt;delta_time);</code> to prevent that. And if you must continue a previous <code>printk</code> that has no newline, use <code>printk(KERN_CONT &quot;</code> for the continuation."}], "answers": [{"tags": [], "owner": {"reputation": 166, "user_id": 7339492, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e0d8c6fc1b0f6943ad1d1434e5eea1b?s=128&d=identicon&r=PG&f=1", "display_name": "O.logN", "link": "https://stackoverflow.com/users/7339492/o-logn"}, "is_accepted": false, "score": 1, "last_activity_date": 1565814220, "creation_date": 1565814220, "answer_id": 57501548, "question_id": 57499217, "link": "https://stackoverflow.com/questions/57499217/printk-works-in-some-functions-but-not-all/57501548#57501548", "title": "printk works in some functions but not all", "body": "<p>If code of dq_update() is really executed, then probably you call printk with too low priority. Either increase kernel log level by running \"echo 8 > /proc/sys/kernel/printk\" from root shell, or add log level to printk() calls like:\nprintk(KERN_EMERG \"Important message\");\nYou can see list of possible log level values in :\n<a href=\"https://github.com/torvalds/linux/blob/master/include/linux/kern_levels.h\" rel=\"nofollow noreferrer\">include/linux/kern_levels.h</a></p>\n"}], "owner": {"reputation": 99, "user_id": 11385838, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xoXUtYRTYo0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3resbs7bRF5B4D2sgiIbuHM9JxSfYg/mo/photo.jpg?sz=128", "display_name": "Ramsey Alsheikh", "link": "https://stackoverflow.com/users/11385838/ramsey-alsheikh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565814220, "creation_date": 1565802713, "question_id": 57499217, "link": "https://stackoverflow.com/questions/57499217/printk-works-in-some-functions-but-not-all", "title": "printk works in some functions but not all", "body": "<p>I am writing a system call for the Linux kernel, and as of yet it's not working as I intended it to (no surprise there). I'm trying to use <code>printk</code> messages to debug it in one function, but they arent working. Yet, the ones in a separate function do work. </p>\n\n<p>I've tried using <code>pr_info</code> instead of <code>printk</code>, but that hasn't worked. I've used <code>mdelay</code> instead of <code>msleep</code>, which didn't help. </p>\n\n<p>printk doesn't work in <code>dq_update</code> (called in <code>sys_delta</code>), but it does work in <code>dq_print</code>.</p>\n\n<pre><code>typedef struct _delta_entry\n{\n    struct task_struct *task;\n    struct list_head list;\n    int delta_time;\n} delta_entry;\n</code></pre>\n\n<pre><code>void dq_print(delta_entry* head)\n{\n    delta_entry* pos;\n    printk(\"dq_print: \");\n\n    list_for_each_entry(pos, &amp;head-&gt;list, list)\n    {\n        printk(\"[%d] \", pos-&gt;delta_time);\n    }\n\n    printk(\"\\n\");\n}\n</code></pre>\n\n<pre><code>void dq_update(struct list_head *delta_queue)\n{\n    //find and store the root\n    delta_entry *root = list_entry(delta_queue -&gt; prev, delta_entry, list);\n\n    //decrement its delta time\n    pr_info(\"DECREMENTING ROOT FROM %d\", root-&gt;delta_time);\n    root -&gt; delta_time -= 1;\n    pr_info(\"DONE DECREMENTING ROOT: AT %d\", root-&gt;delta_time);\n\n    //remove it if its waiting is done, and any subsequent processes that were waiting for the same time\n    for (root; root-&gt;delta_time &lt;= 0 &amp;&amp; root != delta_queue; root = list_entry(root-&gt;list.prev, delta_entry, list))\n    {\n    wake_up_process(root-&gt;task);\n        delta_queue -&gt; prev = delta_queue -&gt; prev -&gt; prev;\n    delta_queue -&gt; prev -&gt; next = delta_queue;\n    }\n}\n</code></pre>\n\n<pre><code>asmlinkage long sys_delta(void)\n{\n    int sleep_times[] = {532, 58, 542, 573, 924, 379, 753, 183, 268, 254, 803, 188, 794, 936, 976, 585, 755, 189, 905, 880, 911, 396, 889, 348, 629, 515, 830, 107, 452, 47, 857, 650, 14, 524, 548,                     476, 551, 953, 366, 572, 419, 450, 134, 748, 944, 904, 557, 651, 788, 92, 982, 901, 11, 5, 72, 798, 447, 658, 843, 445, 204, 380, 392, 385, 199, 426, 474, 139, 404, 274, 511,                      74, 540, 244, 827, 330, 342, 598, 487, 206, 606, 261, 81, 772, 603, 323, 920, 430, 67, 316, 706, 801, 716, 307, 703, 657, 228, 712, 434, 898};\n\n    delta_entry head = {NULL, LIST_HEAD_INIT(head.list), NULL};\n\n    delta_entry entries[100];\n    int i;\n\n\n    for (i = 0; i &lt; 100; i++)\n    {\n        delta_entry de = {make_thread(sleep_times[i]), LIST_HEAD_INIT(de.list), sleep_times[i]};\n        entries[i] = de;\n        dq_add(&amp;entries[i], entries[i].delta_time, &amp;head);\n    }\n\n    i = 1;\n\n    do\n    {\n        mdelay(1);\n        dq_update(&amp;head.list);\n        i++;\n    }\n    while (dq_size(&amp;head.list) &gt; 0);\n\n\n    dq_print(&amp;head);\n\n    return 0;\n\n}\n</code></pre>\n\n<p>I know this is a lot of code, sorry if I posted too much or if this question is a bad one. Thank you for your help!</p>\n"}, {"tags": ["c", "algorithm"], "comments": [{"owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 1, "creation_date": 1565801877, "post_id": 57498965, "comment_id": 101467661, "body": "You could write the array backwards and then just strdup it I guess, but what specifically is wrong with your current solution? What would make another solution better?"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1565802047, "post_id": 57498965, "comment_id": 101467728, "body": "<a href=\"https://codereview.stackexchange.com\">Code Review</a> is a better site to ask for comments on working code."}, {"owner": {"reputation": 2202, "user_id": 8911175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2000c44d0ba4a2642e8846064a77ee34?s=128&d=identicon&r=PG&f=1", "display_name": "taurus05", "link": "https://stackoverflow.com/users/8911175/taurus05"}, "edited": false, "score": 1, "creation_date": 1565802351, "post_id": 57498965, "comment_id": 101467843, "body": "Better in terms of space or time? The complexity of your current code is log(n), which is good in terms of time. You can make it more space efficient, by creating dynamic array, and then swapping 1st half of the array with second half. There is no need to create a fixed length array. Try using realloc."}, {"owner": {"reputation": 161, "user_id": 6443097, "user_type": "registered", "profile_image": "https://graph.facebook.com/1715557505351547/picture?type=large", "display_name": "yasara malshan", "link": "https://stackoverflow.com/users/6443097/yasara-malshan"}, "edited": false, "score": 0, "creation_date": 1565802823, "post_id": 57498965, "comment_id": 101468019, "body": "thank for feedbacks &amp; what is the shortest way to write &quot;char arr[] = &quot;00000000000000000000000000000000&quot;; &quot; (something like: &#39;0&#39;*32) , because it is much lengthy"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565802871, "post_id": 57498965, "comment_id": 101468037, "body": "What is \u201cbetter\u201d? Faster in general? Faster on a particular machine? Smaller source code? Smaller executable code? Easier code to understand? Well documented and specified code? Code that supports negative values? For what purpose do you \u201cneed\u201d a better solution?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 2, "creation_date": 1565803003, "post_id": 57498965, "comment_id": 101468078, "body": "Your current code does not need to initialize the array at all because it does not use any element of the array before assigning a value to it with <code>arr[pos] = element;</code>. So it could just use <code>char arr[32];</code> or, better for portability, <code>char arr[sizeof(int) * CHAR_BIT];</code>. (<code>CHAR_BIT</code> is defined in <code>&lt;limits.h&gt;</code>.)"}, {"owner": {"reputation": 161, "user_id": 6443097, "user_type": "registered", "profile_image": "https://graph.facebook.com/1715557505351547/picture?type=large", "display_name": "yasara malshan", "link": "https://stackoverflow.com/users/6443097/yasara-malshan"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565803507, "post_id": 57498965, "comment_id": 101468278, "body": "thanks @EricPostpischil . in here, &#39;better&#39; means Smaller source code. &amp; I don&#39;t consider negative values."}], "answers": [{"tags": [], "owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "is_accepted": true, "score": 2, "last_activity_date": 1565803855, "creation_date": 1565803855, "answer_id": 57499453, "question_id": 57498965, "link": "https://stackoverflow.com/questions/57498965/what-is-the-best-way-to-convert-an-integer-into-a-bitstring-in-c/57499453#57499453", "title": "what is the best way to convert an integer into a bitstring in C", "body": "<p>You can avoid the memory copy and let the compiler unroll the loop by using a fixed number of iterations:</p>\n\n<pre><code>char* int_to_bin(unsigned n) {\n    unsigned size = sizeof(n) * CHAR_BIT;\n    char* str = malloc(size + 1);\n    str[size] = 0;\n    while(size--) {\n        str[size] = '0' + (n &amp; 1);\n        n &gt;&gt;= 1;\n    }\n    return str;\n}\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 6443097, "user_type": "registered", "profile_image": "https://graph.facebook.com/1715557505351547/picture?type=large", "display_name": "yasara malshan", "link": "https://stackoverflow.com/users/6443097/yasara-malshan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "closed_date": 1565803868, "accepted_answer_id": 57499453, "answer_count": 1, "score": -1, "last_activity_date": 1565803855, "creation_date": 1565801497, "question_id": 57498965, "link": "https://stackoverflow.com/questions/57498965/what-is-the-best-way-to-convert-an-integer-into-a-bitstring-in-c", "closed_reason": "Opinion-based", "title": "what is the best way to convert an integer into a bitstring in C", "body": "<p>I need to convert an integer into a bit string in C. I have written a function to achieve this (example) &amp; need to know a better solution for it.</p>\n\n<p>eg:</p>\n\n<pre><code>char* int_to_bin(int n)\n{\n    char arr[] = \"00000000000000000000000000000000\"; // 32 zeros , coz int =&gt; 32 bit\n    int pos = 0;\n    while(n!=0)\n    {\n       char element = (n%2==0)?'0':'1';\n       arr[pos] = element;\n       n /= 2;\n       pos++;\n    }\n    char *str = malloc(sizeof(char)*(pos+1)); // need to malloc for future use\n    for(int i = 0; i&lt;pos; i++) // get the reverse\n    {\n       *(str+i) = arr[pos-1-i];\n    }\n    *(str+pos) = '\\0';\n    return str;\n}\n</code></pre>\n"}, {"tags": ["c", "pointers", "memory-management", "dynamic-memory-allocation", "realloc"], "comments": [{"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 3, "creation_date": 1565799737, "post_id": 57498538, "comment_id": 101466769, "body": "C is pass-by-value, so the value of the variable list will never be changed by the function call itself."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 2, "creation_date": 1565799802, "post_id": 57498538, "comment_id": 101466808, "body": "@ThomasJager I think he means the memory pointed to by it, since he compares to the source argument to <code>memcpy()</code>."}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1565799967, "post_id": 57498538, "comment_id": 101466887, "body": "OT: The conversion specifier <code>p</code> is defined for  <code>void</code>-pointers only so you need to cast all pointer to <code>(void*)</code> t have their values printed, else UB is invoked."}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 1, "creation_date": 1565800006, "post_id": 57498538, "comment_id": 101466910, "body": "Consider the argument passed to <code>realloc</code> similar with passing it to <code>free</code>. Only in a <code>realloc</code> <i>failure</i> case (which you should check for anyway) is its value <i>prior</i> to the call still meaningful."}, {"owner": {"reputation": 310, "user_id": 6719353, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bgXrn.png?s=128&g=1", "display_name": "cmwt", "link": "https://stackoverflow.com/users/6719353/cmwt"}, "edited": false, "score": 0, "creation_date": 1565812353, "post_id": 57498538, "comment_id": 101471644, "body": "I guess the question I wanted to ask was &quot;Would <code>realloc</code> be better if its first argument was <code>void** ptr_to_ptr</code>?&quot; Then it would be able to change the address based on the situation. I am not sure if I should ask the above question as a separate question."}], "answers": [{"comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1565804869, "post_id": 57498581, "comment_id": 101468820, "body": "I don&#39;t follow how <code>const</code> for the pointed-to space should be considered semantically correct, since one of the things you cannot do with a pointer to <code>const</code> is free it."}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1565804965, "post_id": 57498581, "comment_id": 101468854, "body": "@JohnBollinger: Sorry, I meant the status of <i>not having</i> <code>const</code>. I&#39;ll clarify."}], "tags": [], "owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "is_accepted": false, "score": 1, "last_activity_date": 1565805036, "last_edit_date": 1565805036, "creation_date": 1565799801, "answer_id": 57498581, "question_id": 57498538, "link": "https://stackoverflow.com/questions/57498538/does-realloc-mutate-its-arguments/57498581#57498581", "title": "Does realloc mutate its arguments", "body": "<p>First of all, formally, <code>realloc</code> frees the memory pointed to by its first argument after allocating a new object and copying the contents. As such, semantically it's absolutely correct that the pointed-to type not be <code>const</code> qualified. In limited cases, the new object's address may be the same as the old object's address, but a correct program largely can't even see this (comparing against the old pointer is undefined behavior), much less depend on it.</p>\n\n<p>Secondly, I think you're confusing the <code>const</code>-ness of the argument type and the pointed-to type. <code>const</code> on argument types makes no sense whatsoever (and is ignored by the language, except in the implementation of the called function where it makes the local variable receiving the argument constant) since arguments are always <strong>values</strong>, not references to some object in the caller. Of course <code>realloc</code> can't change the <strong>value</strong> of the caller's pointer variable you pass to it. However, due to any use of invalid pointers being undefined behavior, your program can (because UB allows anything) exhibit behavior <em>as if</em> the caller's copy had been modified. For example, comparing it for equality with the new pointer may give inconsistent results. The <code>const</code> on <code>memcpy</code>'s <code>src</code> makes a pointer-to-<code>const</code> type, not a <code>const</code> type.</p>\n"}, {"tags": [], "owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "is_accepted": false, "score": 1, "last_activity_date": 1565800487, "last_edit_date": 1565800487, "creation_date": 1565799906, "answer_id": 57498612, "question_id": 57498538, "link": "https://stackoverflow.com/questions/57498538/does-realloc-mutate-its-arguments/57498612#57498612", "title": "Does realloc mutate its arguments", "body": "<p><code>realloc()</code> can free the memory that its argument points to, if it can't reuse the same memory. I think this is considered to be like a mutation (since it effectively destroys it completely).</p>\n\n<p>Semantically, <code>realloc()</code> is equivalent to:</p>\n\n<pre><code>void *realloc(void *ptr, size_t size) {\n  void *result = malloc(size);\n  if (result &amp;&amp; ptr) {\n    memcpy(result, ptr, min(size, _allocation_size(ptr)));\n    free(ptr);\n  }\n  return result;\n}\n</code></pre>\n\n<p>where <code>_allocation_size()</code> is some internal function of the C runtime that determines the size of a dynamic memory allocation.</p>\n\n<p>Since the argument to <code>free()</code> is not declared <code>const void *</code>, neither is the first argument to <code>realloc()</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565806772, "post_id": 57499067, "comment_id": 101469586, "body": "Note that the <code>oldptr = realloc(oldptr, newsize);</code>  idiom is an incipient memory leak \u2014 if the <code>realloc()</code> fails and <code>oldptr</code> contained the only reference to the memory, it has just been zapped with a null pointer.  The <code>newptr = realloc(oldptr, newsize);</code> idiom is correct, as you say (without really explaining why it is correct)."}], "tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": true, "score": 2, "last_activity_date": 1565806982, "last_edit_date": 1565806982, "creation_date": 1565802046, "answer_id": 57499067, "question_id": 57498538, "link": "https://stackoverflow.com/questions/57498538/does-realloc-mutate-its-arguments/57499067#57499067", "title": "Does realloc mutate its arguments", "body": "<p>The function does not change the original pointer because it deals with a copy of the pointer. That is the pointer is not passed by reference.</p>\n\n<p>Consider the following program</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(void) \n{\n    int *p = malloc( sizeof( int ) );\n    *p = 10;\n\n    printf( \"Before p = %p\\n\", ( void * )p );\n\n    char *q = realloc( p, 2 * sizeof( int ) );\n\n    printf( \"After  p = %p\\n\", ( void * )p );\n\n    free( q );\n\n    return 0;\n}\n</code></pre>\n\n<p>Its output is</p>\n\n<pre><code>Before p = 0x5644bcfde260\nAfter  p = 0x5644bcfde260\n</code></pre>\n\n<p>As you see the pointer p was not changed.</p>\n\n<p>However the new pointer <code>q</code> can have the same value as pointer p had before the call of realloc.</p>\n\n<p>From the C Standard (7.22.3.5 The realloc function)</p>\n\n<blockquote>\n  <p>4 The realloc function returns a pointer to the new object (<strong>which\n  may have the same value as a pointer to the old object</strong>), or a null\n  pointer if the new object could not be allocated.</p>\n</blockquote>\n\n<p>Of course if you will write</p>\n\n<pre><code>    p = realloc( p, 2 * sizeof( int ) );\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>    char *q = realloc( p, 2 * sizeof( int ) );\n</code></pre>\n\n<p>then it is evident that in general the new value of pointer <code>p</code> can differ from the old value of <code>p</code> (though can be the same according to the quote). For example if the function was unable to reallocate memory. In this case a memory leak will occur provided that initial value of the pointer <code>p</code> was not equal to <code>NULL</code>. Because in this case (when the initial value of the pointer was not equal to <code>NULL</code>) the address of the early allocated memory will be lost.</p>\n\n<p>The old memory is not deallocated if a new memory extent can not be\nallocated because the function needs to copy the old content to the\nnew extent of memory.</p>\n\n<p>From the C Standard (7.22.3.5 The realloc function)</p>\n\n<blockquote>\n  <p>If memory for the new object cannot be allocated, the old object is\n  not deallocated and its value is unchanged.</p>\n</blockquote>\n\n<p>Pay attention to that this call</p>\n\n<pre><code>mem = realloc(list, 0);\n</code></pre>\n\n<p>does not necessary return NULL.</p>\n\n<p>From the C Standard (7.22.3 Memory management functions)</p>\n\n<blockquote>\n  <p>If the size of the space requested is zero, the behavior is\n  implementation-defined: either a null pointer is returned, or the\n  behavior is as if the size were some nonzero value, except that the\n  returned pointer shall not be used to access an object.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "is_accepted": false, "score": 1, "last_activity_date": 1565805385, "last_edit_date": 1565805385, "creation_date": 1565803152, "answer_id": 57499308, "question_id": 57498538, "link": "https://stackoverflow.com/questions/57498538/does-realloc-mutate-its-arguments/57499308#57499308", "title": "Does realloc mutate its arguments", "body": "<p>I'm not entirely sure what you mean by \"Does <code>realloc</code> mutate its first argument?\".</p>\n\n<p>It certainly doesn't change the value of the pointer in the caller -- no C function can do that.</p>\n\n<p>But does it alter the value of the pointed-to memory?  That's a trickier question.</p>\n\n<p>As far as the programmer is concerned, you hand <code>realloc</code> a pointer to M bytes, and it returns you a (possibly different) pointer to N bytes.</p>\n\n<p>If it hands you back the same pointer (meaning that it was able to do the reallocation \"in place\"), and if N &ge; M, it definitely does not touch the M former bytes.</p>\n\n<p>If it hands you back the same pointer but N &lt; M (that is, if you reallocated the region smaller), you're no longer allowed to access or even ask about the bytes beyond M, so it's particularly hard to say whether they were modified.  (But in fact, they might well have been modified, in the process of marking them unused, and available for future allocation).</p>\n\n<p>Finally, if <code>realloc</code> hands you back a different pointer, the M former bytes are \"gone\" -- again, you're no longer allowed to access them, so it's hard to say if they were modified, but they probably were, because all of them are now available for future allocation.</p>\n\n<p>But in any case: the pointer you hand to <code>realloc</code> is a pointer into the heap, and <code>realloc</code> definitely alters the heap as it does its work, so yes, I think it's safe to say that <code>realloc</code> mutates its first argument, which therefore should not be declared <code>const</code>.  (Even in the first case I discussed, where <code>realloc</code> \"definitely did not touch the M former bytes\", it probably did still adjust some nearby data structures, to record the new allocation.)</p>\n\n<p>And, finally, if by \"mutate\" you mean the sort of thing that C++ programs are allowed to do when member variables are declared <code>mutable</code> -- that is, a change happens behind the scenes to some data structure referenced by a pointer that was otherwise qualified <code>const</code> -- well, yes, that's not too far off from what <code>realloc</code> does.  <em>If</em> <code>realloc's</code> first argument were <code>const</code>, and <em>if</em> the modifications <code>realloc</code> did perform were to data structures qualified as <code>mutable</code>, then I suppose this would work -- but also <em>if</em> we were talking about C++.</p>\n\n<p>But of course we're not talking about C++; we're talking about C, which doesn't even have the <code>mutable</code> qualifier.</p>\n\n<p>(I'd say <code>memcpy</code> isn't a counterexample, because it doesn't do anything that even remotely smells like writing to any data structures associated with its second argument.)</p>\n"}, {"tags": [], "owner": {"reputation": 4522, "user_id": 5157478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bBcym.png?s=128&g=1", "display_name": "Frankie_C", "link": "https://stackoverflow.com/users/5157478/frankie-c"}, "is_accepted": false, "score": 0, "last_activity_date": 1565878248, "last_edit_date": 1565878248, "creation_date": 1565805823, "answer_id": 57499885, "question_id": 57498538, "link": "https://stackoverflow.com/questions/57498538/does-realloc-mutate-its-arguments/57499885#57499885", "title": "Does realloc mutate its arguments", "body": "<blockquote>\n  <p>Does realloc mutate its first argument?</p>\n</blockquote>\n\n<p>If you mean change the value of the variable passed as parameter the answer is no. The point isn't related to the specific <code>realloc()</code> function, but more generally to the way used by the language to handle parameters. C language produce a private copy of each argument, typically on the stack, before to pass them to the function, For this reason each change to them is confined locally and is lost when the function returns and the stack reused. Formally the C language pass almost all types by value (arrays are a well known exception). Anyway I'll come back on the argument below.</p>\n\n<blockquote>\n  <p>Is mutating the first argument dependent on the implementation?</p>\n</blockquote>\n\n<p>Of course not. As said above this depends by the language.</p>\n\n<blockquote>\n  <p>Is there a reason it should not be const? As a counter example memcpy\n  makes its src argument const.</p>\n</blockquote>\n\n<p>Of course there is a reason.</p>\n\n<p>Forget about <code>void * memcpy ( void * destination, const void * source, size_t num )</code> that has no connection to <code>void* realloc (void* ptr, size_t size)</code>, lets consider that the management of dynamic memory depends on specific local implementation, but basically all allocation routines are based on memory pools, normally divided in small chunks, from where are derived the memory blocks returned to our programs. We can imagine that when we require to shrink the block the system will remove some chunks giving back a smaller block that incidentally remain at the same address, but if we require an extension maybe the chunks following our block are already assigned we can't proceed.</p>\n\n<p>On an embedded 8 bit micro may happen that the actual memory block cannot be extended, but that another memory area is large enough for the scope, in that case we can copy the former block data to the new one and return it. But in this case we have a different address in memory.</p>\n\n<p>But the <code>malloc()</code> must be universal independently from the machine where it is implemented, starting from 8 bits embedded applications to 64bits desktops with GBytes of available memory and virtual memory support. For this reason the standard must provide a definition that could fit all cases.</p>\n\n<p>The second point is how pass the result, pass/fail, of the reallocation, if would have been used a <strong>reference to the memory block pointer</strong> (ie passing <code>&amp;ptr</code>), <strong>in case of a failure returning <code>NULL</code> the original pointer would have been lost!</strong>. The user, to preserve it, must have done a copy of the pointer before to <code>realloc()</code>, but this procedure is unnatural e prone to errors.</p>\n\n<p>For this reason in the standard library the problem is approached from a different side: <strong>the reallocation will formally return always a freshly allocated memory block in which has been copied the former memory block data</strong>. The programmer is required only to check the result before use it (see below code example).</p>\n\n<p>The standard is very clear in the function definition, as already mentioned in other answers, that for sake of completeness I report below. From <strong>ISO/IEC 9899:2017 \u00a77.22.3.5 The realloc function</strong>:</p>\n\n<blockquote>\n  <p>The realloc function deallocates the old object pointed to by ptr and\n  returns a pointer to a new object that has the size specified by size.</p>\n  \n  <p>The contents of the new object shall be the same as that of the old\n  object prior to deallocation, up to the lesser of the new and old\n  sizes.</p>\n  \n  <p>Any bytes in the new object beyond the size of the old object have\n  indeterminate values.</p>\n  \n  <p>If ptr is a null pointer, the realloc function behaves like the malloc\n  function for the specified size. Otherwise, if ptr does not match a\n  pointer earlier returned by a memory management function, or if the\n  space has been deallocated by a call to the free or realloc function,\n  the behavior is undefined.</p>\n  \n  <p>If size is nonzero and memory for the new object is not allocated, the\n  old object is not deallocated.</p>\n  \n  <p>If size is zero and memory for the new object is not allocated, it is\n  implementation-defined whether the old object is deallocated. If the\n  old object is not deallocated, its value shall be unchanged.</p>\n  \n  <p>The realloc function returns a pointer to the new object (which may\n  have the same value as a pointer to the old object), or a null pointer\n  if the new object has not been allocated.</p>\n</blockquote>\n\n<p>Because you don't know if <code>realloc()</code> returns a new object or the former one, or even <code>NULL</code> in case of error, you should consider <code>realloc()</code> as <strong>always returning a new object</strong>, hence the code:</p>\n\n<pre><code>  int* list = NULL;\n  void* mem;\n  mem = realloc(list, 64);\n  printf(\"Address of `list`: %p\\n\", list);\n</code></pre>\n\n<p>Is wrong at least for two reasons:</p>\n\n<ol>\n<li>Obviously Because if <code>realloc()</code> return a new object and frees the\nold memory, the variable <code>list</code> contains an invalid pointer. Moreover it could fail returning <code>NULL</code>, in that case the former block will still be valid.</li>\n<li>Because you <strong>can't expect to have <code>list</code> changed in any way passing it as a local parameter in a function</strong>. Of course <code>list</code> will retain its former value that  is <code>NULL</code>.</li>\n</ol>\n\n<p>While passing a null pointer to <code>realloc()</code> is standard compliant, because it explicitly says that in this case the behavior will be the same as <code>malloc()</code>, passing a <strong>zero size</strong> the behavior is <strong>implementation-defined</strong> implying that the former block will be deallocated by some compilers, but not from some others. The latter means that the behavior can change on compiler basis, on your machine we can deduce that evidently the compiler behavior is to deallocate the block because of the double free error you got and the null pointer returned by <code>realloc()</code>. Please note also that in latter case <strong>when passing a zero size to <code>realloc()</code>the returned <code>NULL</code> could not mean that a failure occurred</strong>, and that the function was successful, <strong>but in case of failure you will not able to correctly understand if there was a failure or not</strong>. This is an ambiguity of the function (or it is so at my knowledge comments are welcome).</p>\n\n<p>The golden rules to follow when using <code>realloc()</code> are basically these:</p>\n\n<ol>\n<li>Keep in mind that the object returned from function <strong>is always a\nnew object</strong> and you have to save it.</li>\n<li>Because <code>realloc()</code> can fail and return a <code>NULL</code> pointer, never use\ncode as that below, because if it fails we will overwrite the old\nobject pointer loosing the possibility to recover data or free the\nformer object. Always use a temporary variable to check the return\nvalue.</li>\n</ol>\n\n<p>Example code:</p>\n\n<pre><code>void *p = malloc(SIZE);\n/* Wrong approach we overwrite anyway teh pointer */\np = realloc(p, 2*SIZE);\n\n/** Correct approach */\nvoid *pTmp = realloc(p, 2*SIZE);\nif (NULL == pTmp)\n{\n    //Error manage code\n}\nelse\n{\n    p = pTmp;    //assign value\n}\n</code></pre>\n\n<p>Now you may ask why on many machines, having virtual memory management as desktops, smartphones and the like, often happen to have unchanged memory address returned from <code>realloc()</code>. Well the point is that, thanks to the virtual memory management, more physical <strong>not contiguous</strong> memory chunks can be added to the virtual memory chain, then the virtual memory descriptors can be manipulated, mapping consequential virtual addresses to each physical chunk in such a way that the user sees a flat contiguous virtual memory space.</p>\n"}], "owner": {"reputation": 310, "user_id": 6719353, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bgXrn.png?s=128&g=1", "display_name": "cmwt", "link": "https://stackoverflow.com/users/6719353/cmwt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 496, "favorite_count": 0, "accepted_answer_id": 57499067, "answer_count": 5, "score": 2, "last_activity_date": 1565878248, "creation_date": 1565799569, "last_edit_date": 1565807193, "question_id": 57498538, "link": "https://stackoverflow.com/questions/57498538/does-realloc-mutate-its-arguments", "title": "Does realloc mutate its arguments", "body": "<ol>\n<li>Does <code>realloc</code> mutate its first argument?</li>\n<li>Is mutating the first argument dependent on the implementation?</li>\n<li>Is there a reason it should not be <code>const</code>? As a counter example <code>memcpy</code> makes its <code>src</code> argument <code>const</code>.</li>\n</ol>\n\n<p>ISO C standard, section 7.20.3 Memory management functions, does not specify. The Linux man page for <code>realloc</code> does not specify.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main() {\n  int* list = NULL;\n  void* mem;\n  mem = realloc(list, 64);\n  printf(\"Address of `list`: %p\\n\", list);\n  list = mem;\n  printf(\"Address of `list`: %p\\n\", list);\n  mem = realloc(list, 0);\n  printf(\"Address of `list`: %p\\n\", list);\n  // free(list);  // Double free\n  list = mem;\n  printf(\"Address of `list`: %p\\n\", list);\n}\n\n</code></pre>\n\n<p>When I run the above code on my Debian laptop:</p>\n\n<ul>\n<li>The first <code>printf</code> is <code>null</code>.</li>\n<li>The second <code>printf</code> has an address.</li>\n<li>The third <code>printf</code> has the same address as the second.</li>\n<li>In accordance with the spec, trying to free the address results in a double <code>free</code> error.</li>\n<li>The forth <code>printf</code> is <code>null</code>.</li>\n</ul>\n"}, {"tags": ["c", "embedded"], "comments": [{"owner": {"reputation": 4756, "user_id": 10001688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvhzK.jpg?s=128&g=1", "display_name": "Michael Bianconi", "link": "https://stackoverflow.com/users/10001688/michael-bianconi"}, "edited": false, "score": 0, "creation_date": 1565798569, "post_id": 57498290, "comment_id": 101466233, "body": "C does not. <code>foo[100]</code> will go outside the buffer."}, {"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 1, "creation_date": 1565798672, "post_id": 57498290, "comment_id": 101466281, "body": "<code>foo[100]</code> is not a valid element of <code>foo</code>. It doesn&#39;t even go to &quot;never never land&quot;, it may modify other variables, cause your program to crash, or introduce any behaviour. This is undefined behaviour. (See <a href=\"http://www.catb.org/jargon/html/N/nasal-demons.html\" rel=\"nofollow noreferrer\">nasal demons</a>.)"}, {"owner": {"reputation": 1340, "user_id": 7218062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0e0d5a2d3c49c93f1aafd67adaaca59?s=128&d=identicon&r=PG&f=1", "display_name": "jmq", "link": "https://stackoverflow.com/users/7218062/jmq"}, "edited": false, "score": 0, "creation_date": 1565798902, "post_id": 57498290, "comment_id": 101466384, "body": "You can&#39;t assume that elements 70-99 are zeros unless you explicitly assign them"}, {"owner": {"reputation": 479, "user_id": 8321975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d934a13d46469176a140ba9b04c929c?s=128&d=identicon&r=PG&f=1", "display_name": "kesselhaus", "link": "https://stackoverflow.com/users/8321975/kesselhaus"}, "edited": false, "score": 0, "creation_date": 1565836938, "post_id": 57498290, "comment_id": 101477116, "body": "Oh my god, Matlab users trying to code (looks familiar to what I see at work). How inefficient to shift everything .. why not keep a header part free, or use a separate header before switching to the array?"}], "answers": [{"comments": [{"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 0, "creation_date": 1565799013, "post_id": 57498368, "comment_id": 101466449, "body": "Since it&#39;s not far outside of the array, it&#39;s pretty unlikely that you&#39;d get a segfault from this."}], "tags": [], "owner": {"reputation": 4756, "user_id": 10001688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvhzK.jpg?s=128&g=1", "display_name": "Michael Bianconi", "link": "https://stackoverflow.com/users/10001688/michael-bianconi"}, "is_accepted": false, "score": 0, "last_activity_date": 1565798806, "creation_date": 1565798806, "answer_id": 57498368, "question_id": 57498290, "link": "https://stackoverflow.com/questions/57498290/what-happens-when-you-shift-array-elements-outside-the-arrays-range/57498368#57498368", "title": "What happens when you shift array elements outside the arrays range?", "body": "<p>C has no bounds checking and it doesn't automatically resize arrays. If you have a size 100 array, and you access index 100 (since arrays start at 0), then you're accessing the memory immediately outside the array's buffer.</p>\n\n<p><em>Best case scenario</em>, it seg faults. However, since the behavior is undefined, you may be overwriting other variables or doing all kinds of weird stuff.</p>\n"}], "owner": {"reputation": 3, "user_id": 11658718, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a80d6b5701e686b95a1787259a9c5d4?s=128&d=identicon&r=PG&f=1", "display_name": "Billy", "link": "https://stackoverflow.com/users/11658718/billy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "closed_date": 1565800330, "answer_count": 1, "score": 0, "last_activity_date": 1565798806, "creation_date": 1565798516, "question_id": 57498290, "link": "https://stackoverflow.com/questions/57498290/what-happens-when-you-shift-array-elements-outside-the-arrays-range", "closed_reason": "Duplicate", "title": "What happens when you shift array elements outside the arrays range?", "body": "<p>Say I've got an array that contains 100 elements. Same array only has elements 0 through 69 filled because that's all the data that was captured and 70 through 99 are zeros. </p>\n\n<p>Before the data in the array is transferred, a start of message must be added to the beginning and has to be inserted after gathering the data. </p>\n\n<p>To insert the data, you use a for loop to manually shift the array elements to the right by n (see the code below). </p>\n\n<pre class=\"lang-c prettyprint-override\"><code>uint8_t foo[100]; \n\n/*\n * Some code that puts data in the first 70 elements\n */ \n\n//Need to insert the start of message\nfor(i=99; i&gt;0; i--)\n{\n    foo[i+1] = foo[i];\n}\n</code></pre>\n\n<p>On the first run of that for loop, it makes foo[100] = foo[99]. Is that a valid operation or does foo[100] just go off into never never land? I know in languages like MATLAB, it will dynamically resize your array, but does C do the same thing? </p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 6882, "user_id": 3403834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpA5S.jpg?s=128&g=1", "display_name": "user58697", "link": "https://stackoverflow.com/users/3403834/user58697"}, "edited": false, "score": 1, "creation_date": 1565803725, "post_id": 57498210, "comment_id": 101468357, "body": "Doesn&#39;t it also say something like <code>first defined at file:line</code>?"}, {"owner": {"reputation": 275, "user_id": 2215157, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/VEuTq.png?s=128&g=1", "display_name": "fyberoptik", "link": "https://stackoverflow.com/users/2215157/fyberoptik"}, "reply_to_user": {"reputation": 6882, "user_id": 3403834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpA5S.jpg?s=128&g=1", "display_name": "user58697", "link": "https://stackoverflow.com/users/3403834/user58697"}, "edited": false, "score": 0, "creation_date": 1565858148, "post_id": 57498210, "comment_id": 101481857, "body": "Updated the error output, it does also find it in /usr/include/x86_64-linux-gnu/sys/types.h:70"}], "owner": {"reputation": 275, "user_id": 2215157, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/VEuTq.png?s=128&g=1", "display_name": "fyberoptik", "link": "https://stackoverflow.com/users/2215157/fyberoptik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565858111, "creation_date": 1565798231, "last_edit_date": 1565858111, "question_id": 57498210, "link": "https://stackoverflow.com/questions/57498210/using-nano-usb-programmer-with-sensinodes", "title": "Using nano_usb_programmer with Sensinodes", "body": "<p>I am trying to use some old devices called sensinodes . There are a couple of pieces of software needed for this, contiki, sdcc and the some nano_usb_programmer</p>\n\n<p>I'm working from these instruction and I can't seem to make the nano_usb_programmer on ubuntu 16.04 LTS as this pretty old now and things have moved on.</p>\n\n<p><a href=\"https://github.com/avian2/contiki\" rel=\"nofollow noreferrer\">https://github.com/avian2/contiki</a></p>\n\n<p>When making the nano element I get the error *Edited</p>\n\n<pre><code>    In file included from main.c:17:0:\nopts.h:25:2: error: redefinition of typedef \u2018mode_t\u2019 with different type\n }mode_t;\n  ^\nIn file included from /usr/include/stdlib.h:314:0,\n                 from main.c:10:\n/usr/include/x86_64-linux-gnu/sys/types.h:70:18: note: previous declaration of \u2018mode_t\u2019 was here\n typedef __mode_t mode_t;\n                  ^\nmain.c: In function \u2018main\u2019:\nmain.c:57:6: warning: implicit declaration of function \u2018opts_parse\u2019 [-Wimplicit-function-declaration]\n  if (opts_parse(argc, argv) &lt; 0)\n      ^\nmain.c:77:4: warning: implicit declaration of function \u2018prog_scan\u2019 [-Wimplicit-function-declaration]\n    prog_scan();\n    ^\nmain.c:178:7: warning: implicit declaration of function \u2018hexfile_out\u2019 [-Wimplicit-function-declaration]\n       hexfile_out(line_data, 0x04, 0, ptr, 2);\n       ^\nmain.c:220:15: warning: implicit declaration of function \u2018hexfile_build_tables\u2019 [-Wimplicit-function-declaration]\n    if((rval = hexfile_build_tables(opts.filename, page_buffer, page_table)) == -1)\n               ^\nmain.c:231:4: warning: implicit declaration of function \u2018hexfile_program\u2019 [-Wimplicit-function-declaration]\n    hexfile_program(page_buffer, page_table);\n    ^\nMakefile:25: recipe for target 'main.o' failed\nmake: *** [main.o] Error 1\n</code></pre>\n\n<p>It is pointing to line 25 the following file, my c knowledge just isn't any where near good enough to fix this. Any help would be great.</p>\n\n<pre><code>/*\n * opts.h\n *\n *  Created on: Dec 21, 2009\n *      Author: martti\n */\n\n#ifndef OPTS_H_\n#define OPTS_H_\n\n#include \"cdi.h\"\n\ntypedef enum\n{\n    USAGE,\n    VERSION,\n    SCAN,\n    WRITE,\n    WRITE_FAST,\n    READ,\n    WRITE_MAC,\n    READ_MAC,\n    LOCK,\n    ERASE\n}mode_t;\n\ntypedef struct opts_t\n{\n    int port;\n    chip_t chip;\n    mode_t mode;\n    uint8_t write_mac[8];\n    ramcode_t code_in_ram;\n    char *filename;\n}opts_t;\n\nextern opts_t opts;\n\n#endif /* OPTS_H_ */\n</code></pre>\n"}, {"tags": ["c", "linux-kernel", "linux-device-driver", "gpio"], "comments": [{"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 1, "creation_date": 1565802767, "post_id": 57497890, "comment_id": 101467995, "body": "Is there any particular reason you need to use GPIO numbers? Referring to GPIO by number is considered a legacy interface in the kernel. Newer code tends to use GPIO descriptors. For device resource managed allocation of GPIO descriptors, use the <code>devm_gpiod_get_</code>* functions declared by <code>#include &lt;linux&#47;gpio&#47;consumer.h&gt;</code>."}, {"owner": {"reputation": 1198, "user_id": 413023, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/938f2d02e9c4ca01a339014d2abd6800?s=128&d=identicon&r=PG", "display_name": "Milan", "link": "https://stackoverflow.com/users/413023/milan"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1565813510, "post_id": 57497890, "comment_id": 101472088, "body": "@IanAbbott, tried to use desc_to_gpio() but it gives me crash. Just wanted to see which gpio pin number is set by gpiod_set_value_cansleep().is there other interface to check it( something from /sys/..) ?"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1565861117, "post_id": 57497890, "comment_id": 101482949, "body": "If <code>desc_to_gpio()</code> is crashing, perhaps the descriptor is invalid. Did you check it with <code>IS_ERR()</code>?"}, {"owner": {"reputation": 1198, "user_id": 413023, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/938f2d02e9c4ca01a339014d2abd6800?s=128&d=identicon&r=PG", "display_name": "Milan", "link": "https://stackoverflow.com/users/413023/milan"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1565863165, "post_id": 57497890, "comment_id": 101483727, "body": "@IanAbbott, Actually same descriptor is used for  gpiod_set_value_cansleep that doesn&#39;t give me a crash, in the following lines I&#39;m passing it to desc_to_gpio"}, {"owner": {"reputation": 3561, "user_id": 2511795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30c869f55cbcf82a7bc4536d563daa0a?s=128&d=identicon&r=PG", "display_name": "0andriy", "link": "https://stackoverflow.com/users/2511795/0andriy"}, "edited": false, "score": 0, "creation_date": 1566157955, "post_id": 57497890, "comment_id": 101558866, "body": "<code>gpiod_set_value*()</code> functions are NULL and error pointer aware. So, the absence of crash doesn&#39;t mean anything here."}], "owner": {"reputation": 1198, "user_id": 413023, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/938f2d02e9c4ca01a339014d2abd6800?s=128&d=identicon&r=PG", "display_name": "Milan", "link": "https://stackoverflow.com/users/413023/milan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565878245, "creation_date": 1565797060, "last_edit_date": 1565878245, "question_id": 57497890, "link": "https://stackoverflow.com/questions/57497890/getting-gpio-pin-number-using-devm-api", "title": "Getting GPIO pin number using devm_* api", "body": "<p>I would like to get gpio pin number from one of the driver using devm_* API.</p>\n\n<p>For instance, below snippet do it using \"of_get_named_gpio api\":</p>\n\n<p><a href=\"https://github.com/tanish2k09/venom_kernel_aio_otfp/blob/master/drivers/spi/spi-s3c64xx.c#L966\" rel=\"nofollow noreferrer\">https://github.com/tanish2k09/venom_kernel_aio_otfp/blob/master/drivers/spi/spi-s3c64xx.c#L966</a></p>\n\n<p>is there such devm_* api exist for reading gpio pin number in Linux ?</p>\n"}, {"tags": ["c", "gcc", "c-preprocessor"], "comments": [{"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 2, "creation_date": 1565797022, "post_id": 57497786, "comment_id": 101465483, "body": "You&#39;re assuming that the compiler implements each phase independently."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 5, "creation_date": 1565797450, "post_id": 57497786, "comment_id": 101465692, "body": "Basic benchmarking questions. Did you run both multiple times? It&#39;s possible you&#39;re just benchmarking disk caching. Did you <b><i>completely</i></b> clean the source tree between runs? Not <code>make clean</code>, that doesn&#39;t always get everything, start with a fresh source tree. It&#39;s possible you have compilation units still cached. Are you using something like <code>ccache</code>?"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 1, "creation_date": 1565797683, "post_id": 57497786, "comment_id": 101465795, "body": "And ensure your machine isn&#39;t doing anything else while you compile, especially something disk intensive."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1565799363, "post_id": 57497786, "comment_id": 101466590, "body": "Can you upload your source somewhere for an independent verification?"}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 0, "creation_date": 1565800523, "post_id": 57497786, "comment_id": 101467111, "body": "Modern C compilers don&#39;t implement preprocessing quite as separately as they used to, but you&#39;re right that comments are stripped very early in the overall process (&quot;translation phase 3&quot;, in C standardese) and that their presence or absence in the input <i>shouldn&#39;t</i> cause a factor of 2  difference in compilation time."}, {"owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 0, "creation_date": 1565801198, "post_id": 57497786, "comment_id": 101467365, "body": "In addition to the <i>basic benchmarking</i> comment, it might be useful to also build with clang, or with another version of gcc. It&#39;s always good to have some points of comparison for unexpected behaviour."}, {"owner": {"reputation": 49, "user_id": 11927859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ihn39.jpg?s=128&g=1", "display_name": "toto-w", "link": "https://stackoverflow.com/users/11927859/toto-w"}, "edited": false, "score": 0, "creation_date": 1565867583, "post_id": 57497786, "comment_id": 101485247, "body": "Thanks for your suggestions so far.  I&#39;m using Windows 10 with eclipse and a GCC fork from version 4.8.5."}, {"owner": {"reputation": 49, "user_id": 11927859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ihn39.jpg?s=128&g=1", "display_name": "toto-w", "link": "https://stackoverflow.com/users/11927859/toto-w"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1565869824, "post_id": 57497786, "comment_id": 101486014, "body": "I&#39;m using Windows 10 with eclipse and a GCC fork from version 4.8.5.  @Schwern: Compilation time is reproducible and does not depend on other activities (as only one core is busy with this). Before every run I change a char in the large source, press save and then build. I pay attention that only this one file is being compiled.  Sorry! I&#39;m not allowed to share that code.  A colleague compiled the file on a Linux machine (similar hardware) in less than 5 minutes.   My assumption is that is has something to do with a crappy Windows memory managing"}], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 11927859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ihn39.jpg?s=128&g=1", "display_name": "toto-w", "link": "https://stackoverflow.com/users/11927859/toto-w"}, "is_accepted": true, "score": 2, "last_activity_date": 1565967179, "creation_date": 1565967179, "answer_id": 57526776, "question_id": 57497786, "link": "https://stackoverflow.com/questions/57497786/gcc-preprocessor-not-working-compile-time-of-large-files-with-or-without-commen/57526776#57526776", "title": "GCC preprocessor not working? Compile time of large files with or without comments", "body": "<p>I found the reason:</p>\n\n<p>Someone (at an early stage of the project) turned on the option \"-Wa,-amhls\" that causes the assembler to generate a > 500.000 lines long combined .lst file from .S and .C input files.</p>\n\n<p>Building that file on a Windows machine takes over 30 Minutes. (Linux is much faster!)</p>\n\n<p>Also that's the reason why build time depends on optimizing and comments turned on/off. Both have influence to the length of that .lst file.</p>\n\n<p>With that option turned off my project builds in  less than 3 minutes. </p>\n"}], "owner": {"reputation": 49, "user_id": 11927859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ihn39.jpg?s=128&g=1", "display_name": "toto-w", "link": "https://stackoverflow.com/users/11927859/toto-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 2, "accepted_answer_id": 57526776, "answer_count": 1, "score": 2, "last_activity_date": 1565967179, "creation_date": 1565796624, "last_edit_date": 1565798489, "question_id": 57497786, "link": "https://stackoverflow.com/questions/57497786/gcc-preprocessor-not-working-compile-time-of-large-files-with-or-without-commen", "title": "GCC preprocessor not working? Compile time of large files with or without comments", "body": "<p>I suspect the gcc preprocessor is not working correctly because there is an inexplicable correlation of compiling time with or without comments and with or without optimization.</p>\n\n<p>I have a huge Matlab generated c-file (about 70.000 lines).</p>\n\n<p>I noticed when I compile it with optimization level -O3 it takes > 30 minutes to compile. When switching optimization off (-O0) it just takes 4 minutes. That was exactly what I would expect because optimization may be complex on large files.</p>\n\n<p>But, if I generate that same file in Matlab without comments (or delete them with an editor) it compiles in 16 minutes with, and in 2 minutes without optimization.</p>\n\n<p>Where does the factor 2 come from? I would expect that optimization is done after preprocessing and preprocessing should remove any comments. That would result in a fix time difference independent from o-level. I'm confused.</p>\n\n<p>I tried to display the preprocessed output (with gcc option -E) and there are no comments. If I additionally use option -C there are comments. </p>\n\n<p>If I delete empty lines and consecutive spaces it affects the compile time too. Compile time seems to be linear file size depending...</p>\n"}, {"tags": ["c", "windows", "driver"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1565793641, "post_id": 57496892, "comment_id": 101463544, "body": "Please make a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> and show it directly here instead of linking externally."}, {"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 0, "creation_date": 1565798151, "post_id": 57496892, "comment_id": 101466047, "body": "Corrected my previous formatting edit to change <code>BOOL</code> back to he original  <code>BOOLEAN</code>"}, {"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 0, "creation_date": 1565798327, "post_id": 57496892, "comment_id": 101466130, "body": "You might want to show the calling code at a minimum so those that would like to help have some idea what you&#39;ve done, and can reproduce the error.  (i.e. follow the instructions in the link provided in the first comment."}, {"owner": {"reputation": 2323, "user_id": 8350647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zJNHD.png?s=128&g=1", "display_name": "Nina", "link": "https://stackoverflow.com/users/8350647/nina"}, "edited": false, "score": 0, "creation_date": 1565953633, "post_id": 57496892, "comment_id": 101513525, "body": "Just a shot in the dark but you are calling <code>InitializeObjectAttributes</code> with <code>OBJ_CASE_INSENSITIVE</code> is your <code>UNICODE_STRING* src</code> correctly cased?"}, {"owner": {"reputation": 419, "user_id": 1403598, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d6f6dea087976c3e0de24d98c0ba2065?s=128&d=identicon&r=PG", "display_name": "user1403598", "link": "https://stackoverflow.com/users/1403598/user1403598"}, "edited": false, "score": 0, "creation_date": 1566023603, "post_id": 57496892, "comment_id": 101533054, "body": "Unfortunately the OBJ_CASE_INSENSITIVE had no impact, i have a feeling it might  be something to do with when it is executed. I have done some more testing so will add more details to the question."}], "owner": {"reputation": 419, "user_id": 1403598, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/d6f6dea087976c3e0de24d98c0ba2065?s=128&d=identicon&r=PG", "display_name": "user1403598", "link": "https://stackoverflow.com/users/1403598/user1403598"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 291, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566042272, "creation_date": 1565793497, "last_edit_date": 1566042272, "question_id": 57496892, "link": "https://stackoverflow.com/questions/57496892/cannot-read-file-with-windows-minifilter-driver", "title": "Cannot read file with Windows minifilter driver", "body": "<p>I have a minifilter driver based on the example Minivers \nSee <a href=\"https://github.com/guidoreina/minivers\" rel=\"nofollow noreferrer\">https://github.com/guidoreina/minivers</a> , </p>\n\n<p>I am getting error codes on some files on the FltCreateFile which is to read the input file.</p>\n\n<p>The error codes that i am receiving are </p>\n\n<p>-1073741757 0xC0000034</p>\n\n<p>STATUS_OBJECT_NAME_NOT_FOUND</p>\n\n<p>Followed by another attempt</p>\n\n<p>-1073741757 0xC0000043</p>\n\n<p>STATUS_SHARING_VIOLATION</p>\n\n<p>I am unsure where to go or change in order to troubleshoot the issue. I have looked at the MSDN page for FltCreateFile</p>\n\n<p>See <a href=\"https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/content/fltkernel/nf-fltkernel-fltcreatefile\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/content/fltkernel/nf-fltkernel-fltcreatefile</a></p>\n\n<p>Unfortunately the return values documented do not match the errors i am receiving.</p>\n\n<p>Running on Windows 10 1803</p>\n\n<p>I have tried modifying the Share access flags but still end up with the same errors.</p>\n\n<p>I have done some more testing/investigation and decided to monitor a single directory in my case C:\\temp within the minifilter. I believe my problem lies in the PreOperationCallback, as to when it calls the copy file. Below is my PreOperationCallback</p>\n\n<pre><code>FLT_PREOP_CALLBACK_STATUS PreOperationCallback(_Inout_ \nPFLT_CALLBACK_DATA Data, _In_ PCFLT_RELATED_OBJECTS FltObjects, \n_Flt_CompletionContext_Outptr_ PVOID* CompletionContext)\n{\n  //PFILE_RENAME_INFORMATION renameInfo;\n\n  /* IRP-based I/O operation? */\n  if (FLT_IS_IRP_OPERATION(Data)) {\n  /* Open file? */\n    if (Data-&gt;Iopb-&gt;MajorFunction == IRP_MJ_CREATE) {\n    /* Open file for writing/appending? */\n     if (Data-&gt;Iopb-&gt;Parameters.Create.SecurityContext-&gt;DesiredAccess &amp;\n      (FILE_WRITE_DATA | FILE_APPEND_DATA)) {\n    return process_irp(Data, FltObjects, CompletionContext, DEFERRED_IO, FALSE);\n  }\n} else if (Data-&gt;Iopb-&gt;MajorFunction == IRP_MJ_SET_INFORMATION) {\n\n  switch (Data-&gt;Iopb-&gt;Parameters.SetFileInformation.FileInformationClass) {\n\n    case FileDispositionInformation:\n          if (((FILE_DISPOSITION_INFORMATION*) Data-&gt;Iopb-&gt;Parameters.SetFileInformation.InfoBuffer)-&gt;DeleteFile) {\n            return process_irp(Data, FltObjects, CompletionContext, FALSE, FALSE);\n          }\n\n      break;\n    case FileEndOfFileInformation:\n    case FileRenameInformation:\n\n     //   //https://stackoverflow.com/questions/40564824/how-to-cancel-a-rename-operation-in-minifilter-driver\n        //renameInfo = Data-&gt;Iopb-&gt;Parameters.SetFileInformation.InfoBuffer;\n        //DbgPrint(\"Rename info length- '%u'\", renameInfo-&gt;FileNameLength);\n        //memcpy(buf, renameInfo-&gt;FileName, renameInfo-&gt;FileNameLength);\n        //DbgPrint(\"Rename info - '%wZ'\", renameInfo-&gt;FileName);\n\n\n      return process_irp(Data, FltObjects, CompletionContext, FALSE, TRUE);\n      }\n    }\n  }\n\nreturn FLT_PREOP_SUCCESS_NO_CALLBACK;\n}\n</code></pre>\n\n<p>I get the errors listed above when i right click in the temp directory and create new rich text document or if i copy a file to the directory. A new file is created in the c:\\temp and i receive the errors in the debugger. B.N - I have tried different files with different casing to confirm that i had no issues with filename casing.</p>\n\n<p>Now if i delete the file i get the correct results, which is being done via  </p>\n\n<pre><code>case FileDispositionInformation:\n  if (((FILE_DISPOSITION_INFORMATION*) Data-&gt;Iopb-&gt;Parameters.SetFileInformation.InfoBuffer)-&gt;DeleteFile) {\n            return process_irp(Data, FltObjects, CompletionContext, FALSE, FALSE);\n  }\n\n break;\n</code></pre>\n\n<p>The process_irp - checks the file and generates a new location on where to move it to, it then calls the copy_file if all the criteria has been met.</p>\n\n<pre><code>BOOLEAN copy_file(PFLT_FILTER filter,\n              PFLT_INSTANCE instance,\n              UNICODE_STRING* dest,\n              UNICODE_STRING* src)\n{\n    HANDLE hInput, hOutput;\n    PFILE_OBJECT out;\n    OBJECT_ATTRIBUTES attr;\n    IO_STATUS_BLOCK io_status_block;\n    PVOID buf;\n    ULONGLONG filesize;\n    NTSTATUS status;\n\n    InitializeObjectAttributes(&amp;attr,\n                             src,\n                             OBJ_CASE_INSENSITIVE | OBJ_KERNEL_HANDLE,\n                             NULL,\n                             NULL);\n\n\n\n    status = FltCreateFile(filter,      /* Filter            */\n          instance,                     /* Instance          */\n          &amp;hInput,                      /* FileHandle        */\n          GENERIC_READ,                 /* DesiredAccess     */\n          &amp;attr,                        /* ObjectAttributes  */\n          &amp;io_status_block,             /* IoStatusBlock     */\n          NULL,                         /* AllocationSize    */\n          FILE_ATTRIBUTE_NORMAL,        /* FileAttributes    */\n          FILE_SHARE_WRITE | FILE_SHARE_READ | FILE_SHARE_DELETE,   /* ShareAccess       */\n          FILE_OPEN,                    /* CreateDisposition */\n          FILE_SYNCHRONOUS_IO_NONALERT, /* CreateOptions     */\n          NULL,                         /* EaBuffer          */\n          0,                            /* EaLength          */\n          IO_FORCE_ACCESS_CHECK);       /* Flags             */\n\n\n\n\n\n\n    if (!NT_SUCCESS(status)) {\n\n        DbgPrint(\"Could not create the file '%wZ' with STATUS '%d.\\n' \",\n          dest, \n          status);\n\n      return FALSE;\n    }\n}\n</code></pre>\n\n<p>Apologies this is first time writing in C and creating a driver, i have tried reading up on IRP as i think the issue lies here. My thoughts are that the file may not exist at the time of execution, hence i get the errors - I could be completely wrong.</p>\n\n<p>Any help would be greatly appreciated.</p>\n"}, {"tags": ["java", "c++", "c", "dll", "java-native-interface"], "comments": [{"owner": {"reputation": 55767, "user_id": 219159, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cxM6H.jpg?s=128&g=1", "display_name": "Seva Alekseyev", "link": "https://stackoverflow.com/users/219159/seva-alekseyev"}, "edited": false, "score": 3, "creation_date": 1565792105, "post_id": 57496029, "comment_id": 101462726, "body": "How did you end up with this task in the first place? This is not a job for someone with no C++ experience. No, there isn&#39;t a way to clone/port the whole thing - not even if the .H file was available. DepWalk can help somewhat if you&#39;re lucky (e. g. the interface is not too hairy), but still, this will be an extremely manual job. To answer your question, the best approach would be to walk away from this task."}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 1, "creation_date": 1565792539, "post_id": 57496029, "comment_id": 101462964, "body": "I&#39;ll add to the previous comment.  Unless you know, and really know C++, doing JNI work is not going to go too well for you.  The JNI is fragile as it is, and it takes someone with experience to know how to work around the fragilities."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1565792824, "post_id": 57496029, "comment_id": 101463124, "body": "What are the <i>exact</i> details of this &quot;unknown DLL&quot;? You need to know details before you can even tell if the task can be done or not. Because you simply can&#39;t write code that calls something that&#39;s &quot;unknown&quot;."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1565793878, "post_id": 57496029, "comment_id": 101463687, "body": "@sstankov That&#39;s my entire point.  Just what are you supposed to &quot;wrap&quot;? &quot;Write a wrapper for this.&quot;  You:  &quot;What does it do?&quot;  &quot;Unknown.&quot;  Do you even know if this &quot;unknown DLL&quot; is a <a href=\"https://stackoverflow.com/questions/2265023/load-32bit-dll-library-in-64bit-application\">32- or 64-bit DLL?</a>"}, {"owner": {"reputation": 55767, "user_id": 219159, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cxM6H.jpg?s=128&g=1", "display_name": "Seva Alekseyev", "link": "https://stackoverflow.com/users/219159/seva-alekseyev"}, "edited": false, "score": 1, "creation_date": 1565794759, "post_id": 57496029, "comment_id": 101464210, "body": "There is another way. Find someone who has ample experience with both C++ and JNI (and, potentially, reverse engineering of compiled code), and pay them a ton of money. How important is this for the management, financially speaking? OBTW, C++ has no reflection."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1565808376, "post_id": 57496029, "comment_id": 101470234, "body": "@sstankov you can&#39;t call into a DLL if you don&#39;t know what its functions look like.  There is no way to solve this without knowing the function declarations. Period. If you don&#39;t have the function declarations, the only way to get them is to reverse engineer the DLL itself, as there is no reflection in C++."}], "answers": [{"tags": [], "owner": {"reputation": 9545, "user_id": 5295429, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XcJZr.png?s=128&g=1", "display_name": "Oo.oO", "link": "https://stackoverflow.com/users/5295429/oo-oo"}, "is_accepted": true, "score": 0, "last_activity_date": 1582366921, "last_edit_date": 1582366921, "creation_date": 1566165088, "answer_id": 57548629, "question_id": 57496029, "link": "https://stackoverflow.com/questions/57496029/jni-java-using-dll-function-which-takes-an-object-as-param/57548629#57548629", "title": "JNI Java using DLL function which takes an object as param", "body": "<p>The best way here is to use adapter pattern (<a href=\"https://en.wikipedia.org/wiki/Adapter_pattern\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Adapter_pattern</a>). Inside your <code>JNI</code> code you have to call <code>DLL</code> by creating all the objects, as expected by <code>C++</code> API.</p>\n\n<p>You can find sample here: <a href=\"http://jnicookbook.owsiak.org/recipe-No-021/\" rel=\"nofollow noreferrer\">http://jnicookbook.owsiak.org/recipe-No-021/</a> and here <a href=\"https://github.com/mkowsiak/jnicookbook/tree/master/recipes/recipeNo025\" rel=\"nofollow noreferrer\">https://github.com/mkowsiak/jnicookbook/tree/master/recipes/recipeNo025</a></p>\n\n<p>You can also take a look at the code where one shared library (<code>JNI</code>) calls the code from another one: <a href=\"http://jnicookbook.owsiak.org/recipe-No-023/\" rel=\"nofollow noreferrer\">http://jnicookbook.owsiak.org/recipe-No-023/</a></p>\n\n<p>Basically, what you have to do is to create <code>JNI</code> based wrapper code that translates <code>Java</code> calls to native methods into <code>C++</code> calls, and vice versa - the code that translates return values into something that is expected by Java.</p>\n"}], "owner": {"reputation": 93, "user_id": 11926388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69cfb7c8b6a78e538a3ed75e68d15b67?s=128&d=identicon&r=PG&f=1", "display_name": "s.stkvc", "link": "https://stackoverflow.com/users/11926388/s-stkvc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 394, "favorite_count": 0, "accepted_answer_id": 57548629, "answer_count": 1, "score": 1, "last_activity_date": 1582366921, "creation_date": 1565790464, "last_edit_date": 1565792438, "question_id": 57496029, "link": "https://stackoverflow.com/questions/57496029/jni-java-using-dll-function-which-takes-an-object-as-param", "title": "JNI Java using DLL function which takes an object as param", "body": "<p>I will need to use an external, unknown DLL and build a java wrapper around it. I do not have the DLL nor the header file at the moment, and maybe will not even get the header-file, but I'd like to prepare myself. (I have no experience with C++ )</p>\n\n<p>Following situation:</p>\n\n<p>Let's say this DLL has a function, which contains one or more C++ classes as method signature. Then how could I call this function with JNI, as in my java project those custom classes in the DLL are non-existent?  Is there a option to \"clone\" or \"port\" the C++ class to java? Is there anything I could do with a tool like Dependency Walker to resolve this problem?</p>\n\n<p>What would be the best / most simple approach to accomplish that?</p>\n\n<p>Here is some code which I already tried, to find out how it behaves:</p>\n\n<p><strong>Java Class with main</strong></p>\n\n<pre><code>public class FourthJNI {\n\n    public static native int returnAgeOfHuman(int zuQuadrierendeZahl);\n\n    public static void main(String[] args) {\n//      /* This message will help you determine whether\n//        LD_LIBRARY_PATH is correctly set\n//       */\n//      System.out.println(\"library: \"\n//              + System.getProperty(\"java.library.path\"));\n\n        Human testHuman = new Human(\"abcde\", 23, \"M\");\n\n        /* Call to shared library */\n        int ageOfHuman = FourthJNI.returnAgeOfHuman(5);\n        System.out.println(testHuman.toString());\n        System.out.println(\"Age: \" + ageOfHuman);\n    }\n} \n</code></pre>\n\n<p><strong>generatd h-file</strong></p>\n\n<pre><code>/* DO NOT EDIT THIS FILE - it is machine generated */\n#include &lt;jni.h&gt;\n/* Header for class FourthJNI */\n\n#ifndef _Included_FourthJNI\n#define _Included_FourthJNI\n#ifdef __cplusplus\nextern \"C\" {\n#endif\n/*\n * Class:     FourthJNI\n * Method:    returnAgeOfHuman\n * Signature: (I)I\n */\nJNIEXPORT jint JNICALL Java_FourthJNI_returnAgeOfHuman\n  (JNIEnv *, jclass, jint);\n\n#ifdef __cplusplus\n}\n#endif\n#endif\n</code></pre>\n"}, {"tags": ["c", "arrays", "character", "c-strings", "strlen"], "comments": [{"owner": {"reputation": 6233, "user_id": 5741073, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/1uZeL.jpg?s=128&g=1", "display_name": "TomServo", "link": "https://stackoverflow.com/users/5741073/tomservo"}, "edited": false, "score": 0, "creation_date": 1565790570, "post_id": 57496020, "comment_id": 101461864, "body": "Run it in a debugger and examine the values you&#39;re interested in."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 5, "creation_date": 1565790707, "post_id": 57496020, "comment_id": 101461941, "body": "It seems to me like you need to invest time and money into some books to read. Learning from online judge/competition sites is not something I would recommend (I would quite strongly recommend just about anything else than such sites).."}], "answers": [{"comments": [{"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1565800553, "post_id": 57496085, "comment_id": 101467122, "body": "&quot;<i>strs is an array of strings</i>&quot; No, it&#39;s a pointer to a pointer to <code>char</code>, a <code>char**</code>. Pointers are not arrays, nor 1D, nor 2D, nor .... You are simplifying too much."}], "tags": [], "owner": {"reputation": 4756, "user_id": 10001688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvhzK.jpg?s=128&g=1", "display_name": "Michael Bianconi", "link": "https://stackoverflow.com/users/10001688/michael-bianconi"}, "is_accepted": false, "score": 0, "last_activity_date": 1565793899, "last_edit_date": 1565793899, "creation_date": 1565790674, "answer_id": 57496085, "question_id": 57496020, "link": "https://stackoverflow.com/questions/57496020/allocate-char-array-and-strings/57496085#57496085", "title": "Allocate char array and strings", "body": "<p><code>strs</code> is an array of strings. <code>strsSize</code> is the number of strings in the array.</p>\n\n<pre><code>index = strlen(strs[0]);\n</code></pre>\n\n<p>This simply gets the length of <code>strs[0]</code>, the first string in the array.</p>\n\n<pre><code>a = malloc(sizeof(char)*index+1);\n</code></pre>\n\n<p>This will allocate enough memory to store a string of the same size. I say enough memory because each string actually has length + 1 characters. The last character is <code>\\0</code>, a null terminator. You always have to make sure to terminate your strings or else a bunch of weird buffer overflow stuff can happen.</p>\n\n<pre><code>str[i][j]\n</code></pre>\n\n<p>This accesses the jth character in the ith string in the array.</p>\n"}, {"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": -1, "last_activity_date": 1565800949, "last_edit_date": 1565800949, "creation_date": 1565793969, "answer_id": 57497030, "question_id": 57496020, "link": "https://stackoverflow.com/questions/57496020/allocate-char-array-and-strings/57497030#57497030", "title": "Allocate char array and strings", "body": "<p>For starters the program is bad and invalid.:)</p>\n\n<p>For example the size of the one dimensional array first element of which is pointed to by the parameter <code>strs</code> shall have the type <code>size_t</code> instead of <code>int</code>.</p>\n\n<p>And all other variables that deal with indices also shall have the type <code>size_t</code> as for example</p>\n\n<pre><code>size_t index = strlen( strs[0] );\n</code></pre>\n\n<p>because the standard C function <code>strlen</code> has the return type <code>size_t</code>.</p>\n\n<p>The source array is not changed in the function so the first parameter shall be declared with the qualifier <code>const</code>.</p>\n\n<p>That is the function declaration shall look like</p>\n\n<pre><code>char * longestCommonPrefix( const char** strs, size_t strsSize); \n</code></pre>\n\n<p>Farther the elements (strings) of the array can have different lengths, So this loop</p>\n\n<pre><code>for(j=0;j&lt;index;j++)\n</code></pre>\n\n<p>has undefined behavior because some element (string) of the array can have length less than the value of the variable <code>index</code>.</p>\n\n<p>In fact there is no need to calculate lengths of the elements of the array. The loop can use the condition</p>\n\n<pre><code>for( j=0; j &lt; index &amp;&amp; strs[i][j] != '\\0'; j++)\n</code></pre>\n\n<p>And moreover the function has a memory leak due to this return sub-statement in the if statement</p>\n\n<pre><code>a= malloc(sizeof(char)*(index+1));\n//...\nif (tempindex==0)return (\"\");\n</code></pre>\n\n<p>That is the allocated memory pointed to by the pointer <code>a</code> will not released.</p>\n\n<blockquote>\n  <p>What value index=strlen(strs[0]) gets?</p>\n</blockquote>\n\n<p><code>index</code> gets the length of the string stored in the first element of the array of strings.</p>\n\n<p>For example if you have an array</p>\n\n<pre><code>char *strs[] = { \"Hello\", \"Bye\", \"Good Morning\" };\n</code></pre>\n\n<p>then <code>index</code> is set to the length of the string <code>\"Hello\"</code>.</p>\n\n<blockquote>\n  <p>char <em>a= malloc (sizeof(char)</em>(index+1)) Is this the standard way to\n  allocate array for char array?</p>\n</blockquote>\n\n<p>Yes in this declaration there is allocated a memory large enough to store the string (including its terminating zero) of the first element of the array pointed to by <code>strs</code>.</p>\n\n<blockquote>\n  <p>What does strs[i][j] represent?</p>\n</blockquote>\n\n<p><code>strs[i][j]</code> access j-th character of the i-th element of the array pointed to by <code>strs</code>.</p>\n\n<p>For example for the declaration above <code>strs[0][0]</code> is equal to <code>'H</code>', <code>strs[0][1]</code> is equal to <code>'e'</code>, <code>strs[1][0]</code> is equal to <code>'B'</code> and so on.</p>\n\n<p>P.S. A better approach to define the function is the following as it is shown in the demonstrative program.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n\nsize_t longestCommonPrefix( const char **strs, size_t strsSize )\n{\n    size_t n = 0;\n\n    if ( strsSize != 0 )\n    {\n        n = strlen( *strs );\n\n        for ( size_t i = 1; n != 0 &amp;&amp; i &lt; strsSize; i++ )\n        {\n            size_t j = 0;\n\n            while ( j &lt; n &amp;&amp; strs[i][j] == strs[i-1][j] ) j++;\n\n            if ( j &lt; n ) n = j;\n        }\n    }\n\n    return n;\n}\n\nint main(void) \n{\n    char * strs[] = { \"0123456789\", \"012345\", \"0123\" };\n\n    size_t n = longestCommonPrefix( ( const char ** )strs, sizeof( strs ) / sizeof( *strs ) );\n\n    char *p = NULL;\n\n    if ( n != 0 )\n    {\n        p = malloc( n + 1 );\n        memcpy( p, strs[0], n );\n        p[n] = '\\0';\n\n        printf( \"The longest common prefix is \\\"%s\\\"\\n\", p );\n    }\n\n    free( p );\n\n    return 0;\n}\n</code></pre>\n\n<p>The program output is</p>\n\n<pre><code>The longest common prefix is \"0123\"\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 11146006, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-1wV74Mwe0Fk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcAu_k3PEY25KD2jnpHGuZTDPBGzw/mo/photo.jpg?sz=128", "display_name": "John Khor", "link": "https://stackoverflow.com/users/11146006/john-khor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 648, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1565800949, "creation_date": 1565790443, "last_edit_date": 1565800416, "question_id": 57496020, "link": "https://stackoverflow.com/questions/57496020/allocate-char-array-and-strings", "title": "Allocate char array and strings", "body": "<p>I have problem understanding the code below. </p>\n\n<ol>\n<li><p>What value <code>index=strlen(strs[0])</code> gets?</p></li>\n<li><p><code>char *a= malloc (sizeof(char)*(index+1))</code> Is this the standard way to allocate array for char array?</p></li>\n<li><p>What does <code>strs[i][j]</code> represent? </p></li>\n</ol>\n\n<p>This is the code I found on leetcode. Just trying to understand the code. (code from sanghi user on leetcode)</p>\n\n<pre><code>#include&lt;string.h&gt;\nchar* longestCommonPrefix(char** strs, int strsSize) \n{\n    int i=0; int j=0;int index;int tempindex=0;\n    if(strsSize&lt;1)\n    return \"\";\n    index=strlen(strs[0]);\n    char *a;\n    a= malloc(sizeof(char)*(index+1));\n    strcpy(a,strs[0]);\n    for(i=1;i&lt;strsSize;i++)\n    {   tempindex=0;\n        for(j=0;j&lt;index;j++)\n        { \n            if(a[j]==strs[i][j])\n            tempindex++;\n            else\n            {a[j]='\\0';\n             break;\n            }\n        } \n          if (tempindex==0)return (\"\");\n          if(tempindex&lt;index)index=tempindex;\n\n    }\n    return a;\n\n}\n</code></pre>\n\n<p>Expected results can be found on <a href=\"https://leetcode.com/problems/longest-common-prefix/\" rel=\"nofollow noreferrer\">https://leetcode.com/problems/longest-common-prefix/</a></p>\n"}, {"tags": ["c", "console", "windows-10", "codeblocks"], "comments": [{"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1565792618, "post_id": 57495662, "comment_id": 101463019, "body": "Maybe you could add some code to free your pointers after using them. This might give the debug library a chance to detect heap corruption after using more space than you allocated for your struct"}], "answers": [{"comments": [{"owner": {"reputation": 159, "user_id": 11223349, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-CpOqrGGhVMI/AAAAAAAAAAI/AAAAAAAAQLY/7yS2Dh5JNIk/photo.jpg?sz=128", "display_name": "rphii", "link": "https://stackoverflow.com/users/11223349/rphii"}, "edited": false, "score": 0, "creation_date": 1565790778, "post_id": 57495833, "comment_id": 101461984, "body": "Oh yea! I remember... Thanks alot! :)"}], "tags": [], "owner": {"reputation": 136, "user_id": 11512417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/747f40a4e55d654c08d78316db968d08?s=128&d=identicon&r=PG&f=1", "display_name": "kokopelli", "link": "https://stackoverflow.com/users/11512417/kokopelli"}, "is_accepted": true, "score": 2, "last_activity_date": 1565789655, "creation_date": 1565789655, "answer_id": 57495833, "question_id": 57495662, "link": "https://stackoverflow.com/questions/57495662/allocation-fails-only-on-release/57495833#57495833", "title": "Allocation fails only on release", "body": "<p>When you do this :</p>\n\n<p><code>pStart = (struct sNumStruct*)malloc(sizeof(struct sNumStruct*));</code></p>\n\n<p>You are allocating the sizeof a pointer, which is probably 8bytes if you are on a 64bits system. \nYou should rather use :</p>\n\n<p><code>pStart = (struct sNumStruct*)malloc(sizeof(struct sNumStruct));</code> (without the pointer)</p>\n\n<p>which will allocate the size needed for your struct.</p>\n\n<p>Maybe this might help ?</p>\n"}], "owner": {"reputation": 159, "user_id": 11223349, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-CpOqrGGhVMI/AAAAAAAAAAI/AAAAAAAAQLY/7yS2Dh5JNIk/photo.jpg?sz=128", "display_name": "rphii", "link": "https://stackoverflow.com/users/11223349/rphii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 57495833, "answer_count": 1, "score": 1, "last_activity_date": 1565789655, "creation_date": 1565789032, "question_id": 57495662, "link": "https://stackoverflow.com/questions/57495662/allocation-fails-only-on-release", "title": "Allocation fails only on release", "body": "<p>When debugging the program works how it's supposed to. When running the release version, it tells me I have not enough space. Why is this happening and how can I make it run in the release exe?</p>\n\n<p>I found some other article, but I don't get where the similarities are.\n<a href=\"https://stackoverflow.com/questions/12078417/c-malloc-weird-behavior-on-debug-release\">C malloc weird behavior on debug/release</a></p>\n\n<pre><code>#include &lt;stdio.h&gt; \n#include &lt;stdlib.h&gt;\n#include &lt;time.h&gt;\n\n#define AMOUNT  100000                              // amount of random numbers\n#define RANDOM  (rand() &amp; 0x1F) + (rand() &lt;&lt; 16)    // 32 bit random number\n\nstruct sNumStruct {\n    unsigned int uiNum;             // number\n    struct sNumStruct *pNext;       // next\n    struct sNumStruct *pPrev;       // previous\n};\n\nint main()\n{\n    /// initializing\n    srand(time(NULL));              // rand() initializer\n    unsigned int i = 0;             // counter\n    struct sNumStruct * pNumbers;   // pointer to number structure\n    struct sNumStruct * pStart;     // pointer to start of list\n    struct sNumStruct * pLast;      // pointer to end of list\n\n    /// random number generation\n    printf(\"Generating %d random numbers ...\\n\", AMOUNT);\n\n    pStart = (struct sNumStruct*)malloc(sizeof(struct sNumStruct*));    // allocating memory for first element\n    if(pStart == NULL)              // allocation failed?\n    {\n        perror(\"-1\");               // print error -1\n        return -1;\n    }\n    pStart-&gt;pNext = NULL;           // next element is NULL\n    pStart-&gt;pPrev = NULL;           // prev element is NULL\n\n    pNumbers = pStart;              // point to number structure\n    pNumbers-&gt;uiNum = RANDOM;       // get random number\n\n    for(i = 0; i &lt; AMOUNT; i++)     // repeat AMOUNT times\n    {\n        printf(\"%d,\", i);           // &lt;---------- DEBUG\n        pNumbers-&gt;pNext = (struct sNumStruct*)malloc(sizeof(struct sNumStruct*));   // allocating memory for next element\n        if(pNumbers-&gt;pNext == NULL) // allocation failed?\n        {\n            perror(\"-2\");           // print error -2\n            return -2;\n        }\n        (pNumbers-&gt;pNext)-&gt;pPrev = pNumbers;    // current element is previous from next\n        pNumbers = pNumbers-&gt;pNext;             // next element\n        pNumbers-&gt;uiNum = RANDOM;               // random number\n        pNumbers-&gt;pNext = NULL;                 // next element is NULL\n    }\n    pLast = pNumbers;\n\n    printf(\"\\n... done generating numbers\\n\");\n\n    // sort(&amp;pNumbers);\n\n    return 0;\n}\n</code></pre>\n\n<p>The output I'm getting is:\n\"Generating 100000 random numbers ...\n0,1,-2: Not enough space</p>\n\n<p>Process returned -2 (0xFFFFFFFE)\"</p>\n\n<p>the \"0,1,\" are how many elements it has allocated. so it fails on the first \"next element\" allocation.\n\"-2\" confirms the statement above</p>\n\n<p>expected to see:\n\"Generating 100000 random numbers ...\n0,1, ....(not gonna type all numbers)... 99998,99999,\n... ... done generating numbers</p>\n\n<p>Process returned 0\"</p>\n"}, {"tags": ["c", "arrays", "pointers", "undefined-behavior", "implicit-conversion"], "comments": [{"owner": {"reputation": 14754, "user_id": 1827600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KHa84.png?s=128&g=1", "display_name": "suspectus", "link": "https://stackoverflow.com/users/1827600/suspectus"}, "edited": false, "score": 2, "creation_date": 1565789103, "post_id": 57495601, "comment_id": 101460984, "body": "<code>*p</code> is the address of pointer p"}, {"owner": {"reputation": 167, "user_id": 8146707, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-TitJo259T40/AAAAAAAAAAI/AAAAAAAADOM/obcO94aOxiw/photo.jpg?sz=128", "display_name": "Varadaraju G", "link": "https://stackoverflow.com/users/8146707/varadaraju-g"}, "edited": false, "score": 0, "creation_date": 1565790043, "post_id": 57495601, "comment_id": 101461542, "body": "Difference between *ptr[10] and (*ptr)[10] (<a href=\"https://stackoverflow.com/q/13910749/8146707\">stackoverflow.com/q/13910749/8146707</a>)"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565790131, "post_id": 57495601, "comment_id": 101461597, "body": "didn&#39;t you get any diagnostics messages from the compiler?!"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565791022, "post_id": 57495601, "comment_id": 101462126, "body": "You can&#39;t reason about this code because <code>p=a+10;</code> isn&#39;t valid C. Read compiler warnings."}], "answers": [{"tags": [], "owner": {"reputation": 4732, "user_id": 8477999, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f8172e1919af53269de92316dcf03a03?s=128&d=identicon&r=PG&f=1", "display_name": "Gem Taylor", "link": "https://stackoverflow.com/users/8477999/gem-taylor"}, "is_accepted": false, "score": 0, "last_activity_date": 1565789502, "creation_date": 1565789502, "answer_id": 57495795, "question_id": 57495601, "link": "https://stackoverflow.com/questions/57495601/garbage-values-in-c/57495795#57495795", "title": "Garbage values in C", "body": "<p>The array can be treated as (decays to) a pointer to the first element.</p>\n\n<p>When you take the address of an array, you generate a pointer to the array, generally to the same address as first element</p>\n\n<p>When you dereference the pointer to array, you get pointer to element, which generally has the same actual numeric value.</p>\n\n<p>I say generally, because some strange C emulator, or some system that puts an extra indirection in all pointer objects, might decide that the array and the content of the array are 2 different objects.</p>\n"}, {"comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 9301, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "edited": false, "score": 0, "creation_date": 1565790984, "post_id": 57495881, "comment_id": 101462103, "body": "Fair observation, @Bob__.  I have added a few words aimed more directly at that issue."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565791315, "post_id": 57495881, "comment_id": 101462293, "body": "The main issue is rather that <code>p=a+10;</code> won&#39;t compile in the first place. <code>a</code> decays into an <code>int*</code>, then +10 is pointer arithmetic on that type. But it isn&#39;t possible to assign an <code>int*</code> to an <code>int (*p)[10]</code>."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565791470, "post_id": 57495881, "comment_id": 101462381, "body": "@Lundin, evidently it <i>does</i> compile for the OP, and I anticipate that it would compile for me, too, albeit with a warning.  I&#39;ll add something speaking to that issue, but I certainly don&#39;t think it&#39;s the main one."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565791559, "post_id": 57495881, "comment_id": 101462435, "body": "Even gcc in default gnu crap mode gives &quot; warning #556: a value of type &quot;<code>int *</code>&quot; cannot be assigned to an entity of type &quot;<code>int (*)[10]</code>&quot;&quot;. Constraint violation of simple assignment. The compiler need not generate a working binary and if it does, all bet about what that binary does are off - it is UB."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565792066, "post_id": 57495881, "comment_id": 101462699, "body": "Yes, @Lundin, it has UB.  And that should be corrected.  But I maintain that that is not the main issue with the OP&#39;s code, neither from the point of view of possible misbehavior (the format mismatches are more likely to have unwanted effects in practice) nor from the point of view of the semantics most likely to be of interest to the OP."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565792332, "post_id": 57495881, "comment_id": 101462851, "body": "Pointer types aside, I wonder if the conversion is ok still. The <code>int*</code> is allowed to point 1 <code>int</code> beyond the array and does so. The <code>int(*)[10]</code> is allowed to point 1 <code>int[10]</code> beyond the array. But I don&#39;t think anything in the standard allows <code>int(*)[10]</code> to point 1 <code>int</code> beyond the array."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565792369, "post_id": 57495881, "comment_id": 101462871, "body": "Relevant part would be C11 6.5.6 additive operators &#167;8 &quot;If both the pointer operand and the result point to elements of the same array object, or one past the last element of the array object, the evaluation shall not produce an overflow; otherwise, the behavior is undefined.&quot;"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565792804, "post_id": 57495881, "comment_id": 101463112, "body": "@Lundin, the standard explicitly specifies that object pointers of one type may be converted to object pointers of another type (paragraph 6.3.2.3/7).  The only qualification is about alignment, which cannot be an issue for the particular conversion of interest here.  Whether it is allowed to dereference the resulting pointer is perhaps an interesting question (I say no), but I see no reason whatever to doubt the validity of the conversion (by cast, or by assignment conversion to <code>void *</code>)."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565793219, "post_id": 57495881, "comment_id": 101463345, "body": "It is definitely not allowed to de-reference the pointer beyond the array, but you are allowed to do additive pointer arithmetic up to 1 item beyond it. Further additive pointer arithmetic beyond that is explicitly UB per the part I quoted. So what happens if you go 1 beyond first, then do a wild conversion to another type...  hmm."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565793788, "post_id": 57495881, "comment_id": 101463627, "body": "@Lundin, paragraph 6.5.6/8 qualifies the definition of pointer addition and subtraction based on the value of the integer addend / minuend and the array to which, or to just past the end of which, the pointer points.  If a pointer does not point to an array element (as determined in part by its derivation) then no behavior is defined for adding a positive value to it."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 1, "last_activity_date": 1565793154, "last_edit_date": 1565793154, "creation_date": 1565789824, "answer_id": 57495881, "question_id": 57495601, "link": "https://stackoverflow.com/questions/57495601/garbage-values-in-c/57495881#57495881", "title": "Garbage values in C", "body": "<p>Given this declaration:</p>\n\n<blockquote>\n<pre><code>    int (*p)[10];\n</code></pre>\n</blockquote>\n\n<p><code>p</code> is a pointer to an array.  The expression <code>*p</code> therefore designates the pointed-to array itself.  But in almost all C contexts, including in particular when it is an argument in a function call expression, the value of an expression of array type is automatically converted to a pointer to the first element of the array.  The address of that element is the same as the address of the array itself, so if <code>p</code> is in fact a valid pointer then it is entirely reasonable for</p>\n\n<pre><code>    printf(\"%p\\n\", (void *) (*p));\n    printf(\"%p\\n\", (void *) (p));\n</code></pre>\n\n<p>to print two identical lines.</p>\n\n<p>Do note, however, the use of the <code>%p</code> format directive instead of <code>%u</code> or <code>%d</code> for printing a (void) pointer value, and the casts to <code>void *</code>.  These changes to your original code are necessary for the behavior of the <code>printf</code> calls to be well defined.</p>\n\n<p>It is true that as far as the C language is concerned, <code>*p</code> does not designate an object in your case, so in that sense, evaluating the expression <code>*p</code> produces undefined behavior.  This is one of the reasons why I say only that it is \"reasonable\" for the code to emit two identical lines. In practice, however, implementations are likely to treat the expression <code>*p</code> identically to <code>(int *) p</code>, whose behavior is well-defined in this case.</p>\n\n<p>You should also be aware -- and your compiler should be warning you -- that the expression <code>a + 10</code> has the wrong type (<code>int *</code>) to be assigned directly to your <code>p</code> (an <code>int (*)[10]</code>).  It is allowed to convert between those two types, but a cast is required:</p>\n\n<pre><code>    p = (int (*)[10])(a + 10);\n</code></pre>\n\n<p>or</p>\n\n<pre><code>    p = (void *)(a + 10);\n</code></pre>\n\n<p>There is good reason to expect that your compiler is compiling the original assignment expression as if the required cast were present, especially inasmuch as it is a no-op in many implementations, probably including yours, but you should not rely on that.</p>\n"}, {"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 1, "last_activity_date": 1565792545, "last_edit_date": 1565792545, "creation_date": 1565791080, "answer_id": 57496210, "question_id": 57495601, "link": "https://stackoverflow.com/questions/57495601/garbage-values-in-c/57496210#57496210", "title": "Garbage values in C", "body": "<p>For starters this statement</p>\n\n<pre><code>p=a+10;\n</code></pre>\n\n<p>is invalid. </p>\n\n<p>The left side of the assignment has the type <code>int( * )[10]</code> while the right side of the assignment has the type <code>int *</code> and there is no implicit conversion from one type to another.</p>\n\n<p>You have to write</p>\n\n<pre><code>p = ( int( * )[10] )( a + 10 );\n</code></pre>\n\n<p>Secondly these calls of <code>printf</code></p>\n\n<pre><code>printf(\"%d\\n\",*(p));\nprintf(\"%u\",(p));\n</code></pre>\n\n<p>have undefined behavior because there are used invalid conversion specifier <code>d</code> and <code>u</code> with arguments of pointer types because <code>*p</code> and <code>p</code> are both pointers.</p>\n\n<p>So a valid program can look the following way</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void) \n{\n    int (*p)[10];\n    int a[10]={1,2,3,4,5,6,7,8,9,0};\n\n    p = ( int( * )[10] )( a + 10 );\n\n    printf(\"%p\\n\",( void * )*p );\n    printf(\"%p\\n\", (void *)p );\n\n    return 0;\n}\n</code></pre>\n\n<p>A pointer may point to the memory that follows the last element of an object (or an array).</p>\n\n<p>So after this statement</p>\n\n<pre><code>p = ( int( * )[10] )( a+10 );\n</code></pre>\n\n<p>the pointer <code>p</code> points after the first element of an imagined two-dimensional array  elements of which in turn one-dimensional arrays of the type <code>int[10]</code> and the first element of the imagined two-dimensional array corresponds to the array <code>a</code>.</p>\n\n<p>The expression <code>*p</code> is also a pointer. Its type is <code>int *</code> because the expression *p gives an lvalue of the type <code>int[10]</code> and in expressions this lvalue is implicitly converted to pointer to its first element (in this case of the type <code>int</code>).</p>\n\n<p>So the both expressions <code>p</code> and <code>*p</code> points to the same memory and have the same value.</p>\n\n<p>This is demonstrated by the program output</p>\n\n<pre><code>0x7ffcfd46ea48\n0x7ffcfd46ea48\n</code></pre>\n\n<p>The difference between these two pointers, <code>p</code> and <code>*p</code>, is the type of an object they potentially point to.</p>\n\n<p>Consider the following demonstrative program</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void) \n{\n    int (*p)[10];\n    int a[10]={1,2,3,4,5,6,7,8,9,0};\n\n    p = ( int( * )[10] )( a+10 );\n\n    printf(\"%zu\\n\",sizeof( *p ) );\n    printf(\"%zu\\n\",sizeof( **p ) );\n\n    return 0;\n}\n</code></pre>\n\n<p>Its output is</p>\n\n<pre><code>40\n4\n</code></pre>\n\n<p>You could get undefined behavior if you wrote</p>\n\n<pre><code>printf( \"%d\\n\", **p );\n</code></pre>\n\n<p>In this case the expression <code>**p</code> has the type <code>int</code> and there is an access to the memory beyond the array <code>a</code>.</p>\n"}], "owner": {"reputation": 7, "user_id": 11927501, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-37ZekfUdrPY/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQP3dH_qzWYbiaAC7KElvr5XLL6k3g/mo/photo.jpg?sz=128", "display_name": "Ashutosh rath", "link": "https://stackoverflow.com/users/11927501/ashutosh-rath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 0, "closed_date": 1565794916, "answer_count": 3, "score": -2, "last_activity_date": 1565793154, "creation_date": 1565788841, "last_edit_date": 1565791614, "question_id": 57495601, "link": "https://stackoverflow.com/questions/57495601/garbage-values-in-c", "closed_reason": "Needs details or clarity", "title": "Garbage values in C", "body": "<p>I was expecting a garbage value from the first printf() statement but I got the address instead. Why?</p>\n\n<pre><code>#include&lt;stdio.h&gt;\nint main()\n{\n    int (*p)[10];\n    int a[10]={1,2,3,4,5,6,7,8,9,0};\n    p=a+10;\n    printf(\"%d\\n\",*(p));\n    printf(\"%u\",(p));\n}\n</code></pre>\n"}, {"tags": ["c", "integer"], "comments": [{"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 0, "creation_date": 1565788579, "post_id": 57495410, "comment_id": 101460634, "body": "You don&#39;t seem to be using the pipe correctly. It&#39;s created after the fork, so you&#39;re just manipulating two unrelated pipes."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1565835575, "post_id": 57495410, "comment_id": 101476871, "body": "the OPs code, as posted, does not compile!   Amongst other things, it is missing the needed <code>#include</code> statements for the needed header files."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 10148601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14c145ad65e9499ef579deef4d576423?s=128&d=identicon&r=PG&f=1", "display_name": "ayush", "link": "https://stackoverflow.com/users/10148601/ayush"}, "edited": false, "score": 1, "creation_date": 1565790230, "post_id": 57495531, "comment_id": 101461664, "body": "Thank you nivpeled. I was doing this error only.  Now it&#39;s working correctly."}], "tags": [], "owner": {"reputation": 1605, "user_id": 11723965, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ygAu.jpg?s=128&g=1", "display_name": "nivpeled", "link": "https://stackoverflow.com/users/11723965/nivpeled"}, "is_accepted": true, "score": 0, "last_activity_date": 1565788600, "creation_date": 1565788600, "answer_id": 57495531, "question_id": 57495410, "link": "https://stackoverflow.com/questions/57495410/i-am-not-getting-the-sum-of-the-2-numbes-correct-using-the-read-and-write-in-c/57495531#57495531", "title": "I am not getting the sum of the 2 numbes correct using the read and write in C?", "body": "<p>first call <code>pipe()</code>, only afterwards call <code>fork()</code>.</p>\n\n<p>See more <a href=\"http://man7.org/linux/man-pages/man2/pipe.2.html\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 3, "user_id": 10148601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14c145ad65e9499ef579deef4d576423?s=128&d=identicon&r=PG&f=1", "display_name": "ayush", "link": "https://stackoverflow.com/users/10148601/ayush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "closed_date": 1565892880, "accepted_answer_id": 57495531, "answer_count": 1, "score": 0, "last_activity_date": 1565788677, "creation_date": 1565788212, "last_edit_date": 1565788445, "question_id": 57495410, "link": "https://stackoverflow.com/questions/57495410/i-am-not-getting-the-sum-of-the-2-numbes-correct-using-the-read-and-write-in-c", "closed_reason": "Not suitable for this site", "title": "I am not getting the sum of the 2 numbes correct using the read and write in C?", "body": "<p>I am computing the sum of 2 numbers in the child process and printing it through the Parent process. But the sum is not coming correct?</p>\n\n<pre><code>int main()\n{\n\n    int a,b;\n    printf(\"\\nEnter the value of a = \");\n    scanf(\"%d\",&amp;a);\n    printf(\"\\nEnter the value of b = \");\n    scanf(\"%d\",&amp;b);\n    pid_t fork_return = fork();\n    int fd1[2];\n    pipe(fd1);\n\n    if (fork_return==0)  //Child Process\n    {\n        printf(\"\\nI am the child process\\n\");\n        int sum;\n        sum=a+b;\n        // close the reading end of the fd1\n        close(fd1[0]);\n        write(fd1[1],&amp;sum,sizeof(sum));\n        close(fd1[1]);\n    }\n    else if(fork_return&gt;0)\n    {\n\n        // close the writing end of the fd1\n        close(fd1[1]);\n        int sum_read;\n        read(fd1[0],&amp;sum_read,sizeof(sum_read));\n        printf(\"\\nParent Process\\n\");\n        printf(\"\\nsum of %d and %d is = %d\\n\",a,b,sum_read);\n        close(fd1[0]);\n    }\n    return 0;\n}\n</code></pre>\n\n<p>I expect the output of 2+3 to be 5, but the actual output is coming to be random 7-8 digits like 1438521280.</p>\n"}, {"tags": ["c++", "c"], "comments": [{"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 1, "creation_date": 1565787443, "post_id": 57495150, "comment_id": 101459972, "body": "Please show the C++ code you are trying to compile. This is probably a name mangling issue."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1565787448, "post_id": 57495150, "comment_id": 101459974, "body": "C and C++ are not the same language.  Just because a lot of C code is valid C++ does not mean every valid C program is a valid C++ program.  More than likely you&#39;ll need to make some changes to the code as C++ has different name mangling than C."}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 1, "creation_date": 1565787625, "post_id": 57495150, "comment_id": 101460065, "body": "In particular, it is very likely that <a href=\"https://stackoverflow.com/a/12574420/9528746\">this</a> answer applies. But we can&#39;t be sure until we see the code you are giving to your compiler."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "reply_to_user": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 0, "creation_date": 1565787815, "post_id": 57495150, "comment_id": 101460167, "body": "@MaxLanghof Looking at the linked code, yes, I&#39;m almost certain that&#39;s the right answer."}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 1, "creation_date": 1565787936, "post_id": 57495150, "comment_id": 101460255, "body": "Possibly only some <code>extern &quot;C&quot;</code> lacking?"}, {"owner": {"reputation": 4533, "user_id": 2504757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef5b308d33027fab8440d223828fe4c?s=128&d=identicon&r=PG", "display_name": "Robert Andrzejuk", "link": "https://stackoverflow.com/users/2504757/robert-andrzejuk"}, "edited": false, "score": 0, "creation_date": 1565788662, "post_id": 57495150, "comment_id": 101460688, "body": "The attached duplicate is somewhat correct, but the correct answer is here : <a href=\"https://stackoverflow.com/questions/27215256/unresolved-external-symbol-c-with-assembler#35359098\" title=\"unresolved external symbol c with assembler%2335359098\">stackoverflow.com/questions/27215256/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 1, "creation_date": 1565788227, "post_id": 57495371, "comment_id": 101460419, "body": "I don&#39;t consider it a good idea to edit 3rd party library headers... If the library author really failed to apply the correct C++ guards, I personally would prefer placing them around the header <i>include</i> like in the referenced answer at the end (not nice either, I know...)."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "reply_to_user": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1565788509, "post_id": 57495371, "comment_id": 101460592, "body": "@Aconcagua Yeah, all I was saying is most popular libraries <i>do</i> have those guards and that&#39;s why OP might not have seen the problem before."}], "tags": [], "owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "is_accepted": false, "score": 0, "last_activity_date": 1565788060, "creation_date": 1565788060, "answer_id": 57495371, "question_id": 57495150, "link": "https://stackoverflow.com/questions/57495150/undefined-reference-to-inline-assembly-code-while-calling-in-c/57495371#57495371", "title": "Undefined reference to inline assembly code while calling in c++", "body": "<p>Assuming you are compiling the code from your link verbatim, change these lines of <code>md5-test.c</code>...</p>\n\n<pre><code>// Link this program with an external C or x86 compression function\nextern void md5_compress(uint32_t state[static STATE_LEN],\n                         const uint8_t block[static BLOCK_LEN]);\n</code></pre>\n\n<p>to read instead</p>\n\n<pre><code>// Link this program with an external C or x86 compression function\n#ifdef __cplusplus\nextern \"C\" {\n#endif\nextern void md5_compress(uint32_t state[static STATE_LEN],\n                         const uint8_t block[static BLOCK_LEN]);\n#ifdef __cplusplus\n} // extern \"C\"\n#endif\n</code></pre>\n\n<p>and it should start working.  To understand <em>why</em> this is the problem, see <a href=\"https://stackoverflow.com/a/12574420/9528746\">this old answer</a>.</p>\n\n<p>In a complete application, the declaration of <code>md5_compress</code> would be in a header file provided by the library that contains the MD5 implementation, and it would be that library's responsibility to put the <code>extern \"C\"</code> annotations in its header files.  This is why you may not have encountered this problem when working with off-the-shelf libraries.</p>\n"}], "owner": {"reputation": 1, "user_id": 9941030, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-uThlPJPUuBU/AAAAAAAAAAI/AAAAAAAAAf4/bydBIiZh-tM/photo.jpg?sz=128", "display_name": "Sujit chourasia", "link": "https://stackoverflow.com/users/9941030/sujit-chourasia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 237, "favorite_count": 0, "closed_date": 1565788070, "answer_count": 1, "score": 0, "last_activity_date": 1565788060, "creation_date": 1565787296, "question_id": 57495150, "link": "https://stackoverflow.com/questions/57495150/undefined-reference-to-inline-assembly-code-while-calling-in-c", "closed_reason": "Duplicate", "title": "Undefined reference to inline assembly code while calling in c++", "body": "<p>Link <a href=\"https://www.nayuki.io/page/fast-md5-hash-implementation-in-x86-assembly\" rel=\"nofollow noreferrer\">Fast MD5 Assembly</a></p>\n\n<p>above given link has assembly implementation of MD5.\nwhen i am trying to call the following code in c with given execute  instruction, it run successfully. but when as i try to call or execute in C++11, i got error as undefined reference to <code>Md5_hash</code> function </p>\n\n<p>for compiling in c </p>\n\n<pre><code>gcc --std=c99 md5-test.c md5-fast-x8664.S -o md5-test\n</code></pre>\n\n<p>same is used for c++11</p>\n\n<pre><code>gcc --std=c++11 md5-test.cpp md5-fast-x8664.S -o md5-test\n</code></pre>\n\n<p>it show error  </p>\n\n<pre><code>/staticLibmd5/main.cpp|32|undefined reference to md5_compress(unsigned char \nconst*, unsigned long, unsigned int*)'\n</code></pre>\n\n<p>is there any other instruction to that in c++ that is missing.</p>\n"}, {"tags": ["c", "linux", "multithreading", "pthreads"], "comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 2, "creation_date": 1565786701, "post_id": 57494965, "comment_id": 101459543, "body": "why would it be expected to print so?"}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 2, "creation_date": 1565786777, "post_id": 57494965, "comment_id": 101459593, "body": "Why is your thread function not using the proper signature?"}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 3, "creation_date": 1565786896, "post_id": 57494965, "comment_id": 101459657, "body": "That unprotected use of <code>count</code> is a race condition; consider using C11 atomic types."}, {"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 1, "creation_date": 1565786960, "post_id": 57494965, "comment_id": 101459707, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/4991470/pthread-execution-on-linux\">pthread execution on linux</a>, <a href=\"https://stackoverflow.com/q/12536649/608639\">Pthread Run a thread right after it&#39;s creation</a>, etc."}, {"owner": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "edited": false, "score": 1, "creation_date": 1565787067, "post_id": 57494965, "comment_id": 101459773, "body": "Why shouldn&#39;t it print  29945, 29999, or 29959? Those are all between 1 and 30000."}, {"owner": {"reputation": 15044, "user_id": 416574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/80e6a3e7975350dea41b2cf3fa46c407?s=128&d=identicon&r=PG", "display_name": "pstrjds", "link": "https://stackoverflow.com/users/416574/pstrjds"}, "reply_to_user": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "edited": false, "score": 0, "creation_date": 1565787183, "post_id": 57494965, "comment_id": 101459844, "body": "@Kevin - my guess is what OP means is that it doesn&#39;t always print all the way to 30000 as OP expected, but rather comes up short sometimes (due to the unprotected use of count)."}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 1, "creation_date": 1565788028, "post_id": 57494965, "comment_id": 101460300, "body": "You should also think about what happens when you return from <code>main()</code> before all those threads have finished."}], "answers": [{"tags": [], "owner": {"reputation": 162629, "user_id": 50617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YFykQ.png?s=128&g=1", "display_name": "Employed Russian", "link": "https://stackoverflow.com/users/50617/employed-russian"}, "is_accepted": false, "score": 0, "last_activity_date": 1565811769, "creation_date": 1565811769, "answer_id": 57501050, "question_id": 57494965, "link": "https://stackoverflow.com/questions/57494965/some-threads-never-get-execution-when-invoked-in-large-amount/57501050#57501050", "title": "Some threads never get execution when invoked in large amount", "body": "<blockquote>\n  <p>Why this is happening?</p>\n</blockquote>\n\n<p>Because you have a data race (undefined behavior).</p>\n\n<p>In particular, this statement:</p>\n\n<pre><code>printf(\"%d\\n\",++count);\n</code></pre>\n\n<p>modifies a global (shared) variable without any locking. Since the <code>++</code> does not atomically increment it, it's quite possible for multiple threads to read the same value (say 1234), increment it, and store the updated value <em>in parallel</em>, resulting in 1235 being printed repeatedly (two or more times), and one or more of the increments being <em>lost</em>.</p>\n\n<p>A typical solution is to either use mutex to avoid the data race, or (rarely) an atomic variable (which guarantees atomic increment). Beware: atomic variables are quite hard to get right. You are not ready to use them yet.</p>\n"}, {"comments": [{"owner": {"reputation": 162629, "user_id": 50617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YFykQ.png?s=128&g=1", "display_name": "Employed Russian", "link": "https://stackoverflow.com/users/50617/employed-russian"}, "edited": false, "score": 0, "creation_date": 1565812147, "post_id": 57501091, "comment_id": 101471572, "body": "&quot;The instruction you need is atomic_fetch_add&quot; -- no, he needs a mutex. Atomic variables are <i>not</i> appropriate for beginners."}, {"owner": {"reputation": 1774, "user_id": 1201456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b33a546c937f65ce7ef0f29ca0f6a84d?s=128&d=identicon&r=PG", "display_name": "nickelpro", "link": "https://stackoverflow.com/users/1201456/nickelpro"}, "reply_to_user": {"reputation": 162629, "user_id": 50617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YFykQ.png?s=128&g=1", "display_name": "Employed Russian", "link": "https://stackoverflow.com/users/50617/employed-russian"}, "edited": false, "score": 0, "creation_date": 1565812243, "post_id": 57501091, "comment_id": 101471604, "body": "@EmployedRussian No he doesn&#39;t? <code>atomic_fetch_add</code> will give him a copy of the data in the atomic and atomically increment the counter. Counters is explicitly the use case <code>atomic_fetch_add</code> is used for.  Do you have an explanation why it wouldn&#39;t work?  It&#39;s not like mutexs are easier to understand than atomic, mutexs <i>are</i> atomics under the hood."}, {"owner": {"reputation": 162629, "user_id": 50617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YFykQ.png?s=128&g=1", "display_name": "Employed Russian", "link": "https://stackoverflow.com/users/50617/employed-russian"}, "edited": false, "score": 0, "creation_date": 1565812439, "post_id": 57501091, "comment_id": 101471682, "body": "It would work for a trivial program like this one, but is not an appropriate solution for almost all real problems. You are saying: &quot;here, use this grenade to open a bottle&quot;. A bottle opener is more appropriate tool."}, {"owner": {"reputation": 1774, "user_id": 1201456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b33a546c937f65ce7ef0f29ca0f6a84d?s=128&d=identicon&r=PG", "display_name": "nickelpro", "link": "https://stackoverflow.com/users/1201456/nickelpro"}, "reply_to_user": {"reputation": 162629, "user_id": 50617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YFykQ.png?s=128&g=1", "display_name": "Employed Russian", "link": "https://stackoverflow.com/users/50617/employed-russian"}, "edited": false, "score": 0, "creation_date": 1565812730, "post_id": 57501091, "comment_id": 101471786, "body": "&quot;Is not an appropriate solution for almost all real problems&quot;  <i>It&#39;s a counter</i>, atomic counters are everywhere in threaded programming. They&#39;re the sync primitive for a whole class of low-contention semaphores. Just going to have to agree to disagree here."}], "tags": [], "owner": {"reputation": 1774, "user_id": 1201456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b33a546c937f65ce7ef0f29ca0f6a84d?s=128&d=identicon&r=PG", "display_name": "nickelpro", "link": "https://stackoverflow.com/users/1201456/nickelpro"}, "is_accepted": true, "score": 1, "last_activity_date": 1565812265, "last_edit_date": 1565812265, "creation_date": 1565812016, "answer_id": 57501091, "question_id": 57494965, "link": "https://stackoverflow.com/questions/57494965/some-threads-never-get-execution-when-invoked-in-large-amount/57501091#57501091", "title": "Some threads never get execution when invoked in large amount", "body": "<p>Because <code>count</code> isn't atomic, so you have a race condition both in the increment and in the subsequent print.</p>\n\n<p>The instruction you need is <code>atomic_fetch_add</code>, to increment the counter and avoid the race condition. The example on <a href=\"https://en.cppreference.com/w/c/atomic/atomic_fetch_add\" rel=\"nofollow noreferrer\">cppreference</a> illustrates the exact problem you laid out.</p>\n\n<p>Your example can be made to work with just a minor adjustment:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;sys/resource.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;stdatomic.h&gt;\n\nstatic atomic_long count = 1;\nvoid * thread(void *data)\n{\n    printf(\"%ld\\n\", atomic_fetch_add(&amp;count, 1));\n    return NULL;\n}\n\nint main()\n{\n    pthread_t t;\n    sigset_t set;\n    int i,limit = 30000;\n    struct rlimit rlim;\n\n    getrlimit(RLIMIT_NPROC, &amp;rlim);\n    rlim.rlim_cur = rlim.rlim_max;\n    setrlimit(RLIMIT_NPROC, &amp;rlim);\n\n    for(i=0; i&lt;limit; i++) {\n        if(pthread_create(&amp;t, NULL, thread, NULL) != 0) {\n            printf(\"thread creation failed\\n\");\n            return -1;\n        }\n    }\n    sigemptyset(&amp;set);\n    sigsuspend(&amp;set);\n    return 0;\n}\n</code></pre>\n\n<p>I made a handful of other changes, such as fixing the thread function signature and using the correct printf format for printing longs. But the atomic issue is why you weren't printing all the numbers you expected.</p>\n"}], "owner": {"reputation": 455, "user_id": 4899025, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGgvb.jpg?s=128&g=1", "display_name": "Ajith C Narayanan", "link": "https://stackoverflow.com/users/4899025/ajith-c-narayanan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 57501091, "answer_count": 2, "score": -2, "last_activity_date": 1565812265, "creation_date": 1565786601, "last_edit_date": 1565788895, "question_id": 57494965, "link": "https://stackoverflow.com/questions/57494965/some-threads-never-get-execution-when-invoked-in-large-amount", "title": "Some threads never get execution when invoked in large amount", "body": "<p>Consider the following program,</p>\n\n<pre><code>static long count = 0;\nvoid thread()\n{\n    printf(\"%d\\n\",++count);\n}\nint main()\n{\n    pthread_t t;\n    sigset_t set;\n    int i,limit = 30000;\n    struct rlimit rlim;\n\n    getrlimit(RLIMIT_NPROC, &amp;rlim);\n    rlim.rlim_cur = rlim.rlim_max;\n    setrlimit(RLIMIT_NPROC, &amp;rlim);\n\n    for(i=0; i&lt;limit; i++) {\n        if(pthread_create(&amp;t,NULL,(void *(*)(void*))thread, NULL) != 0) {\n            printf(\"thread creation failed\\n\");\n            return -1;\n        }\n    }\n    sigemptyset(&amp;set);\n    sigsuspend(&amp;set);\n    return 0;\n}\n</code></pre>\n\n<p>This program is expected to print 1 to 30000. But it some times prints 29945, 29999, 29959, etc. Why this is happening?</p>\n"}, {"tags": ["c", "linker", "iar"], "comments": [{"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1565786893, "post_id": 57494796, "comment_id": 101459653, "body": "Your free space in total memory is smaller than 0x111B range. That doesn&#39;t add up. Perhaps there is already something else placed on that range."}, {"owner": {"reputation": 11, "user_id": 11927296, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-TlOy15EPuQU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc3lVNVJLvUbPBtf3hV_werjylalQ/photo.jpg?sz=128", "display_name": "SlevinsLN", "link": "https://stackoverflow.com/users/11927296/slevinsln"}, "reply_to_user": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1565879371, "post_id": 57494796, "comment_id": 101490622, "body": "Thanks for comment. I have already checked map file for overlapping with another blocks, but no obvious placement into mention range is present."}, {"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1566284286, "post_id": 57494796, "comment_id": 101597140, "body": "Why is there <code>interrupt_event.o</code> (0x2003e7d9) right in the middle of your 0x2003e6d4-0x2003f7ef range? I am not familiar with CC3220S, but this placement looks very disjoined. There are big gaps everywhere, breaking the free space. I don&#39;t think we can solve this without knowing the placement declarations (in linker script and source files)."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11927296, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-TlOy15EPuQU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc3lVNVJLvUbPBtf3hV_werjylalQ/photo.jpg?sz=128", "display_name": "SlevinsLN", "link": "https://stackoverflow.com/users/11927296/slevinsln"}, "edited": false, "score": 0, "creation_date": 1565879343, "post_id": 57495067, "comment_id": 101490610, "body": "Thanks for comment. I have already done that, but no obvious placement into mention range is present."}, {"owner": {"reputation": 1605, "user_id": 11723965, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ygAu.jpg?s=128&g=1", "display_name": "nivpeled", "link": "https://stackoverflow.com/users/11723965/nivpeled"}, "reply_to_user": {"reputation": 11, "user_id": 11927296, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-TlOy15EPuQU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc3lVNVJLvUbPBtf3hV_werjylalQ/photo.jpg?sz=128", "display_name": "SlevinsLN", "link": "https://stackoverflow.com/users/11927296/slevinsln"}, "edited": false, "score": 0, "creation_date": 1566110006, "post_id": 57495067, "comment_id": 101548122, "body": "can you please share your map file?"}, {"owner": {"reputation": 11, "user_id": 11927296, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-TlOy15EPuQU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc3lVNVJLvUbPBtf3hV_werjylalQ/photo.jpg?sz=128", "display_name": "SlevinsLN", "link": "https://stackoverflow.com/users/11927296/slevinsln"}, "edited": false, "score": 0, "creation_date": 1566230059, "post_id": 57495067, "comment_id": 101582007, "body": "I cannot share the whole file."}], "tags": [], "owner": {"reputation": 1605, "user_id": 11723965, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ygAu.jpg?s=128&g=1", "display_name": "nivpeled", "link": "https://stackoverflow.com/users/11723965/nivpeled"}, "is_accepted": false, "score": 1, "last_activity_date": 1565790067, "last_edit_date": 1565790067, "creation_date": 1565786978, "answer_id": 57495067, "question_id": 57494796, "link": "https://stackoverflow.com/questions/57494796/linker-cant-place-a-block-into-free-memory-range/57495067#57495067", "title": "Linker can&#39;t place a block into free memory range", "body": "<p>A map file can be generated by passing the <code>--map MyMapFile.txt</code> string to ilinkarm.\nGenerate the map file and check if you have a <strong>continuous</strong> free block of memory of size >= 0x795 in the correct memory range.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 11927296, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-TlOy15EPuQU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc3lVNVJLvUbPBtf3hV_werjylalQ/photo.jpg?sz=128", "display_name": "SlevinsLN", "link": "https://stackoverflow.com/users/11927296/slevinsln"}, "is_accepted": false, "score": 1, "last_activity_date": 1567182884, "creation_date": 1567182884, "answer_id": 57730373, "question_id": 57494796, "link": "https://stackoverflow.com/questions/57494796/linker-cant-place-a-block-into-free-memory-range/57730373#57730373", "title": "Linker can&#39;t place a block into free memory range", "body": "<p>Thank you all for responsiveness. \nI solved my issue with forcing linker to place big aligned blocks which helps to organize free memory and avoid such a curious problems.</p>\n"}], "owner": {"reputation": 11, "user_id": 11927296, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-TlOy15EPuQU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc3lVNVJLvUbPBtf3hV_werjylalQ/photo.jpg?sz=128", "display_name": "SlevinsLN", "link": "https://stackoverflow.com/users/11927296/slevinsln"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1567182884, "creation_date": 1565786018, "last_edit_date": 1566231371, "question_id": 57494796, "link": "https://stackoverflow.com/questions/57494796/linker-cant-place-a-block-into-free-memory-range", "title": "Linker can&#39;t place a block into free memory range", "body": "<p>I use microcontroller CC3220S with 256KB of RAM memory and have some issue with memory placement. </p>\n\n<p>IAR ELF Linker V7.80.1.28/LNX for ARM</p>\n\n<p>Copyright 2007-2016 IAR Systems AB.</p>\n\n<p>Error[Lp011]: section placement failed\n            unable to place Block P3-P4-1 (min size 0x795, align 0x8) in: &lt;[0x2003e6d4-0x2003f7ef]></p>\n\n<p>Calculated free space in range &lt;[0x2003e6d4-0x2003f7ef]> is equal to 0x111B, which definitely bigger than Block P3-P4-1 min size 0x795. So even despite the fact that overall memory utilization is around 99% (259963 of 262144) but it still enough free space to allocate additional block P3-P4-1.</p>\n\n<p>I didn't managed to find any particular info in TI and IAR documents, so I would be very grateful if anyone can help with clarifying details or pointing me to the resource about following questions:</p>\n\n<p>What could be a root cause of issue with placing P3-P4-1 even if memory seems to be enough?</p>\n\n<p>@nivpeled Unfortunately I cannot share the whole file, but here is a part of it</p>\n\n<pre><code>\"P3-P4\", part 1 of 3:                      0x2bf40\n  .text               ro code  0x20004040   0x2ef4  ds_network.o\n  .rodata             const    0x2002e6b0    0x4cc  d_network.o\n  Initializer bytes   const    0x2002eb7c    0x39f  &lt;for P3-P4-1&gt; (used: 0x38b)\n                             - 0x2002ff80  0x2bf40\n\"P3-P4\", part 2 of 3:                       0xe85c\n  .bss                zero     0x2002ff80   0x6d78  heap_4.o\n  .bss                zero     0x2003e7d9      0x1  interrupt_event.o\n                                     0x2003e7da   0xe85a\n\"A0\":                                        0x800\n  CSTACK                       0x2003f7f0    0x800  &lt;Block&gt;\n    .stack            uninit   0x2003f7f0    0x800  startup_cc32xx_iar.o\n                             - 0x2003fff0    0x800\n\"P3-P4\", part 3 of 3 (*** FAILED ***):       0x795\n  P3-P4-1                                    0x795  &lt;Init block&gt;\n    .data             inited                  0x78  diagnostic.o\n    .data             inited                   0x1  d_als.o \n                                             0x795\n</code></pre>\n\n<p>B.R. Alex.</p>\n"}, {"tags": ["c", "doxygen"], "comments": [{"owner": {"reputation": 5891, "user_id": 1657886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34d48ba7c8258ef5c613ba129411a6b0?s=128&d=identicon&r=PG", "display_name": "albert", "link": "https://stackoverflow.com/users/1657886/albert"}, "edited": false, "score": 0, "creation_date": 1565787193, "post_id": 57494722, "comment_id": 101459853, "body": "You use the version 1.8.11 (December 30, 2015), the current version is 1.8.16 (August 8, 2019), what happens when you use the 1.8.16 version? Please also show with some small images the current situation and the wanted situation."}, {"owner": {"reputation": 223, "user_id": 941102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265fc109b3b78378227e0a52ddf6fc4e?s=128&d=identicon&r=PG", "display_name": "Michael Reinhardt", "link": "https://stackoverflow.com/users/941102/michael-reinhardt"}, "reply_to_user": {"reputation": 5891, "user_id": 1657886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34d48ba7c8258ef5c613ba129411a6b0?s=128&d=identicon&r=PG", "display_name": "albert", "link": "https://stackoverflow.com/users/1657886/albert"}, "edited": false, "score": 0, "creation_date": 1565866198, "post_id": 57494722, "comment_id": 101484760, "body": "Update was useless. Same effect. The requested images have been added."}], "answers": [{"comments": [{"owner": {"reputation": 223, "user_id": 941102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265fc109b3b78378227e0a52ddf6fc4e?s=128&d=identicon&r=PG", "display_name": "Michael Reinhardt", "link": "https://stackoverflow.com/users/941102/michael-reinhardt"}, "edited": false, "score": 0, "creation_date": 1594884583, "post_id": 62830077, "comment_id": 111284174, "body": "Unfortunately, this doesn&#39;t work with the MWE from the question. I tried with Doxygen 1.8.11 and 1.8.16. The final page looks still the same. Does the MWE work for you?"}], "tags": [], "owner": {"reputation": 41, "user_id": 5585082, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-f_w9w7xcw_4/AAAAAAAAAAI/AAAAAAAAAAA/aI2HuT38Lwg/photo.jpg?sz=128", "display_name": "Rolland Dudemaine", "link": "https://stackoverflow.com/users/5585082/rolland-dudemaine"}, "is_accepted": false, "score": 0, "last_activity_date": 1594369188, "creation_date": 1594369188, "answer_id": 62830077, "question_id": 57494722, "link": "https://stackoverflow.com/questions/57494722/doxygen-group-data-structures-on-file-level/62830077#62830077", "title": "Doxygen: group data structures on file level", "body": "<p>It took me several months to find, but the answer was deceptively simple.\nYou just need to enable INLINE_SIMPLE_STRUCTS:</p>\n<pre><code># When the INLINE_SIMPLE_STRUCTS tag is set to YES, structs, classes, and unions\n# with only public data fields or simple typedef fields will be shown inline in\n# the documentation of the scope in which they are defined (i.e. file,\n# namespace, or group documentation), provided this scope is documented. If set\n# to NO, structs, classes, and unions are shown on a separate page (for HTML and\n# Man pages) or section (for LaTeX and RTF).\n# The default value is: NO.\n\nINLINE_SIMPLE_STRUCTS  = YES\n</code></pre>\n<p>The fact that the data structures are &quot;simple&quot; is only a consideration of every member being publicly accessible, not the number of entries.</p>\n"}], "owner": {"reputation": 223, "user_id": 941102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265fc109b3b78378227e0a52ddf6fc4e?s=128&d=identicon&r=PG", "display_name": "Michael Reinhardt", "link": "https://stackoverflow.com/users/941102/michael-reinhardt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 394, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1594369188, "creation_date": 1565785728, "last_edit_date": 1565866712, "question_id": 57494722, "link": "https://stackoverflow.com/questions/57494722/doxygen-group-data-structures-on-file-level", "title": "Doxygen: group data structures on file level", "body": "<p>I would like to use the <a href=\"http://www.doxygen.nl/manual/grouping.html#memgroup\" rel=\"nofollow noreferrer\">Doxygen grouping mechanism</a> for data structures. I'm already using it for functions and it works well so far. What I've experienced so far fits to the documentation regarding member groups of a single type (e.g. function only) or mixed type (e.g. typedefs and functions).</p>\n\n<p>Now I tried to extend these member groups with data structures, and this fails exceptionally. Data structures are always a top section on its own. My tries so far:</p>\n\n<ol>\n<li>Put a data structures definition inside an existing mixed type member group. -> Data structure is still documented in a separate top level section.</li>\n</ol>\n\n<pre><code>/**\n * \\file doxytest.h\n */\n\n/**\n * \\name Iteration API\n * \\brief Some documentation. Group will be on top level.\n */\n/// @{\n\n/**\n * \\brief   For no reason this is not part of the member group.\n */\ntypedef struct {\n    /**\n     * \\brief Some mask\n     */\n    uint32_t mask;\n} filter_t;\n\n/**\n * \\brief  Some variable\n */\nextern const uint32_t MODE_FILTER_MASK;\n\n/**\n * \\brief   Curiously this IS part of the member group.\n */\ntypedef bool (*for_each_cb)(const void *obj, void *opaque);\n\n/**\n * \\brief Some function\n */\nuint32_t filter_id_filter_set(size_t ids_num, ...);\n\n/// @}\n</code></pre>\n\n<p>Side by Side of final Doxygen output and desired Doxygen output (Photoshopped)</p>\n\n<p><a href=\"https://i.stack.imgur.com/Cf7Ly.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Cf7Ly.png\" alt=\"enter image description here\"></a></p>\n\n<ol start=\"2\">\n<li>Creating a group solely consisting of data structures. -> Data structures are documented in a separate top level section and the documentation block for this group vanishes completely.</li>\n</ol>\n\n<pre><code>/**\n * \\file doxytest2.h\n */\n\n/**\n * \\name Structures\n * \\brief This documentation block will not show up \n *        in the final file documentation. It is completely lost.\n */\n/// @{\n\n/**\n * \\brief   Won't show up in group/section \"Structures\"\n */\ntypedef struct {\n    /**\n     * \\brief Some mask\n     */\n    uint32_t mask;\n} filterA_t;\n\n/**\n * \\brief   Won't show up as well\n */\ntypedef struct {\n    /**\n     * \\brief Some mask\n     */\n    uint32_t mask;\n} filterB_t;\n\n/// @}\n\n/// Some struct that should not show up in group \"Structures\"\ntypedef struct {\n    int bar;\n} someStruct;\n</code></pre>\n\n<p>Side by Side of final Doxygen output and desired Doxygen output (Photoshopped)</p>\n\n<p><a href=\"https://i.stack.imgur.com/4cmne.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4cmne.png\" alt=\"enter image description here\"></a></p>\n\n<ol start=\"3\">\n<li>Use a module and add the data structures mit \\ingroup. -> Data structure pops up in the module, but the file documentation still looks the same as above</li>\n<li>Using \\nosubgrouping command on file level documentation. -> No changes at all to file documentation page.</li>\n</ol>\n\n<pre><code>/**\n * \\file doxytest.h\n * \\nosubgrouping\n */\n</code></pre>\n\n<p>I would like that the documentation for file <code>doxytest.h</code>/<code>doxytest2.h</code> displays data structures in the group they were defined in.</p>\n\n<p>The programming language is C, but I'm very limited in terms of changing the code to fit documentation needs. Doxygen version is 1.8.16. The configuration file is almost default. (I left out stuff like project name and input settings)</p>\n\n<pre><code>OPTIMIZE_OUTPUT_FOR_C = YES\nEXTRACT_ALL           = YES\nEXTRACT_STATIC         = YES\nSORT_MEMBER_DOCS       = NO\nDISABLE_INDEX          = NO\n</code></pre>\n\n<p>Any help appreciated.</p>\n"}, {"tags": ["c", "gdb"], "comments": [{"owner": {"reputation": 29251, "user_id": 72178, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/M3OuM.png?s=128&g=1", "display_name": "ks1322", "link": "https://stackoverflow.com/users/72178/ks1322"}, "edited": false, "score": 0, "creation_date": 1565785288, "post_id": 57494330, "comment_id": 101458798, "body": "It is not GDB&#39;s error. Do you get it when running this code without gdb?"}], "answers": [{"tags": [], "owner": {"reputation": 12106, "user_id": 4431643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CoZjt.jpg?s=128&g=1", "display_name": "kiran Biradar", "link": "https://stackoverflow.com/users/4431643/kiran-biradar"}, "is_accepted": true, "score": 0, "last_activity_date": 1565785881, "creation_date": 1565785881, "answer_id": 57494757, "question_id": 57494330, "link": "https://stackoverflow.com/questions/57494330/how-to-fix-gdbs-error-invalid-address-specified-to-rtlfreeheap/57494757#57494757", "title": "How to fix GDB&#39;s error &quot;Invalid address specified to RtlFreeHeap&quot;", "body": "<p><code>realloc</code> takes input as number of bytes to be allocated.</p>\n\n<pre><code>   a-&gt;values = realloc(a-&gt;values, a-&gt;length + k);\n</code></pre>\n\n<p>should be</p>\n\n<pre><code>   a-&gt;values = realloc(a-&gt;values, sizeof(int) * (a-&gt;length + k));\n</code></pre>\n\n<p>As of now you are just allocating <code>5</code> bytes but you meant <code>5 * sizeof(int)</code> bytes.</p>\n\n<hr>\n\n<p>Or even better is </p>\n\n<pre><code>    int *temp = realloc(a-&gt;values, sizeof(int) * (a-&gt;length + k));\n    if (temp) {\n       a-&gt;values = temp;\n       a-&gt;length += k;\n    }\n    else {\n       //error\n    }\n</code></pre>\n"}], "owner": {"reputation": 436, "user_id": 11883920, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Ac3uCA0Uru0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re2UoJAMOEE3dXPUC-9xwDyoYHLfg/mo/photo.jpg?sz=128", "display_name": "Paul", "link": "https://stackoverflow.com/users/11883920/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 57494757, "answer_count": 1, "score": 0, "last_activity_date": 1565785881, "creation_date": 1565784172, "last_edit_date": 1565784701, "question_id": 57494330, "link": "https://stackoverflow.com/questions/57494330/how-to-fix-gdbs-error-invalid-address-specified-to-rtlfreeheap", "title": "How to fix GDB&#39;s error &quot;Invalid address specified to RtlFreeHeap&quot;", "body": "<p>I have some troubles working on a piece of C code.\nHere is my code:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>typedef struct ARRAY {\n    int length;\n    int* values;\n} ARRAY;\n\n\nARRAY* ARRAY_init(int length) {\n    ARRAY* a = malloc(sizeof(ARRAY));\n    a-&gt;values = malloc(length * sizeof(int));\n    for (int i = 0; i &lt; length; i++) {\n        a-&gt;values[i] = 0;\n    }\n    a-&gt;length = length;\n    return a;\n}\n\n\nvoid ARRAY_free(ARRAY* a) {\n    free(a-&gt;values);\n    free(a);\n}\n\n\nvoid ARRAY_extend(ARRAY* a, int k) {\n    a-&gt;values = realloc(a-&gt;values, a-&gt;length + k);\n    for (int i = a-&gt;length; i &lt; a-&gt;length + k; i++) {\n        a-&gt;values[i] = 0;\n    }\n    a-&gt;length += k;\n}\n\n\nint main() {\n    ARRAY* a = ARRAY_init(3);\n    ARRAY_extend(a, 2);\n    ARRAY_free(a);\n}\n</code></pre>\n\n<p>When i run this piece of code with gdb, i get a<br>\n<code>warning: Heap block at 00AD16B8 modified at 00AD16CC past requested size of 5</code><br>\nand then a<br>\n<code>warning: Invalid address specified to RtlFreeHeap( 00AD0000, 00AD16C0 )</code>\nThe error seems to occure during the <code>realloc</code>...<br>\nStill I don't understand what is wrong with my code. Can someone explain it to me?</p>\n"}, {"tags": ["c", "language-lawyer", "c99", "c11", "null-pointer"], "comments": [{"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 2, "creation_date": 1565784062, "post_id": 57494145, "comment_id": 101458220, "body": "The purpose of <code>restrict</code> is permitting compiler optimisations, not forcing errors for violated constraints.    If the programmer writes code that doesn&#39;t comply with aliasing assertions made using <code>restrict</code> - such as by passing a NULL pointer to your <code>mystrcpy()</code> - then the behaviour is undefined.   That means no diagnostic is required.      In other words, the behaviour you are expecting is not required at all by the standard.   Both compilers are therefore correct - in the sense that undefined behaviour means they are permitted to do anything,"}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1565784253, "post_id": 57494145, "comment_id": 101458306, "body": "I don&#39;t know about clang, but I&#39;m pretty sure gcc just ignores the minimum array length qualifiers. You&#39;re using an old version though and I haven&#39;t tested lately with current releases."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 0, "creation_date": 1565784418, "post_id": 57494145, "comment_id": 101458389, "body": "@Peter: I am well aware of the <code>restrict</code> semantics, which by the way are almost meaningless in a function declaration. I only put the <code>restrict</code> keywords for compatibility with the definition of <code>strcpy</code>, but the problem I am documenting relates to the <code>char p[static 1]</code> syntax which specifies that the function argument <code>p</code> should be non-null and point to an array of at least 1 char."}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1565784540, "post_id": 57494145, "comment_id": 101458448, "body": "You might be interested in playing with gcc&#39;s <code>nonnull</code> <a href=\"https://gcc.gnu.org/onlinedocs/gcc-9.2.0/gcc/Common-Function-Attributes.html\" rel=\"nofollow noreferrer\">function attribute</a> btw."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 1, "creation_date": 1565784659, "post_id": 57494145, "comment_id": 101458505, "body": "@Shawn: gcc&#39;s <code>nonnull</code> attribute is what is causing the wanings for <code>strcpy</code>. I want to use a standard feature with the same semantics and I&#39;m afraid it is not supported by gcc, unlike clang."}, {"owner": {"reputation": 6595, "user_id": 5218277, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZuEZa.jpg?s=128&g=1", "display_name": "Alex Lop.", "link": "https://stackoverflow.com/users/5218277/alex-lop"}, "edited": false, "score": 1, "creation_date": 1565785275, "post_id": 57494145, "comment_id": 101458791, "body": "I think this might answer your question: <a href=\"https://stackoverflow.com/a/3430353/5218277\">stackoverflow.com/a/3430353/5218277</a>"}, {"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 1, "creation_date": 1565785543, "post_id": 57494145, "comment_id": 101458914, "body": "Same comment goes for your use of <code>static</code> - for example, see <a href=\"https://stackoverflow.com/questions/3430315/what-is-the-purpose-of-static-keyword-in-array-parameter-of-function-like-char\" title=\"what is the purpose of static keyword in array parameter of function like char\">stackoverflow.com/questions/3430315/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 71860, "user_id": 366377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863018588657c38d29f22e72dc81325e?s=128&d=identicon&r=PG", "display_name": "Jens Gustedt", "link": "https://stackoverflow.com/users/366377/jens-gustedt"}, "edited": false, "score": 0, "creation_date": 1565813815, "post_id": 57494667, "comment_id": 101472210, "body": "Correct answer. I&#39;d just like to add that the requirement for the pointer not being  null cannot be a constraint violation, because there are situations where the compiler can&#39;t know."}, {"owner": {"reputation": 6595, "user_id": 5218277, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZuEZa.jpg?s=128&g=1", "display_name": "Alex Lop.", "link": "https://stackoverflow.com/users/5218277/alex-lop"}, "reply_to_user": {"reputation": 71860, "user_id": 366377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863018588657c38d29f22e72dc81325e?s=128&d=identicon&r=PG", "display_name": "Jens Gustedt", "link": "https://stackoverflow.com/users/366377/jens-gustedt"}, "edited": false, "score": 0, "creation_date": 1565847645, "post_id": 57494667, "comment_id": 101478730, "body": "@JensGustedt, right but that&#39;s true for many other things. For example <code>int x; ... x &lt;&lt; 32</code> the compiler will fire a warning but here <code>x &lt;&lt; y</code> the compiler just can&#39;t (always) know the value of <code>y</code> at compilation time."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 71860, "user_id": 366377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863018588657c38d29f22e72dc81325e?s=128&d=identicon&r=PG", "display_name": "Jens Gustedt", "link": "https://stackoverflow.com/users/366377/jens-gustedt"}, "edited": false, "score": 0, "creation_date": 1565888772, "post_id": 57494667, "comment_id": 101494945, "body": "@JensGustedt: Further, a compiler can&#39;t generally tell whether a particular function will ever be called, and the existence of that a function could never have defined behavior would only be allowed to affect program behavior in cases where it&#39;s not called if it would cause a program to exceed a translation limit.  A conforming compiler could impose a &quot;translation limit&quot; of zero functions that could not be executed while invoking UB, but that would seem an abuse of &quot;translation limit&quot; allowances."}], "tags": [], "owner": {"reputation": 6595, "user_id": 5218277, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZuEZa.jpg?s=128&g=1", "display_name": "Alex Lop.", "link": "https://stackoverflow.com/users/5218277/alex-lop"}, "is_accepted": false, "score": 4, "last_activity_date": 1565786114, "last_edit_date": 1565786114, "creation_date": 1565785571, "answer_id": 57494667, "question_id": 57494145, "link": "https://stackoverflow.com/questions/57494145/inconsistent-c99-support-in-gcc-and-clang/57494667#57494667", "title": "Inconsistent C99 support in gcc and clang", "body": "<p>Based on <a href=\"https://stackoverflow.com/a/3430353/5218277\">this answer</a>, the compiler doesn't have to diagnose the call to such function and verify that the parameters meet the <code>static</code> qualifier. </p>\n\n<blockquote>\n  <p>Note that the C Standard does not require the compiler to diagnose\n  when a call to the function does not meet these requirements (i.e. it\n  is silent undefined behaviour).</p>\n</blockquote>\n\n<hr>\n\n<p>EDIT:</p>\n\n<p>Based on the Standard C99:</p>\n\n<blockquote>\n  <p><strong>6.7.5.3 Function declarators (including prototypes)</strong></p>\n  \n  <p>...</p>\n  \n  <p>A declaration of a parameter as \u2018\u2018array of type\u2019\u2019 shall be adjusted to\n  \u2018\u2018qualified pointer to type\u2019\u2019, where the type qualifiers (if any) are\n  those specified within the [ and ] of the array type derivation. If\n  the keyword static also appears within the [ and ] of the array type\n  derivation, then for each call to the function, the value of the\n  corresponding actual argument shall provide access to the first\n  element of an array with at least as many elements as specified by the\n  size expression.</p>\n  \n  <p>...</p>\n  \n  <p><strong>J.2 Undefined behavior</strong></p>\n  \n  <p>...</p>\n  \n  <p>\u2014 A declaration of an array parameter includes the keyword static\n  within the [ and ] and the corresponding argument does not provide\n  access to the first element of an array with at least the specified\n  number of elements (6.7.5.3).</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1565786235, "post_id": 57494794, "comment_id": 101459274, "body": "Good point! neither is there a syntax to attach the nonnull semantics not the minimum size to individual pointers, such as the return value of <code>strcpy</code>... making the consistency check across function calls mostly impossible."}], "tags": [], "owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "is_accepted": false, "score": 1, "last_activity_date": 1565786586, "last_edit_date": 1565786586, "creation_date": 1565786013, "answer_id": 57494794, "question_id": 57494145, "link": "https://stackoverflow.com/questions/57494145/inconsistent-c99-support-in-gcc-and-clang/57494794#57494794", "title": "Inconsistent C99 support in gcc and clang", "body": "<p>GCC just ignores <code>static</code> and the arguments of <code>strcpy</code> is declared non-null with <code>__attribute__((nonnull))</code>, which is actually more useful than <code>static 1</code>:   you cannot use the latter for a function that has <code>void *</code> argument because the array syntax in arguments requires that the type of element is a <strong>completed</strong> type, neither can you use it for a pointer to an array of undeclared size, or to an opaque <code>struct</code>.</p>\n\n<p>As for compatibility, <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.7.6.3p21\" rel=\"nofollow noreferrer\">C11 6.7.6.3p21</a> says:</p>\n\n<blockquote>\n  <p>21 EXAMPLE 5 The following are all compatible function prototype declarators.</p>\n  \n  <p>[....]</p>\n\n<pre><code>       void   f(double      (* restrict a)[5]);\n       void   f(double      a[restrict][5]);\n       void   f(double      a[restrict 3][5]);\n       void   f(double      a[restrict static 3][5]);\n</code></pre>\n</blockquote>\n\n<p>Finally, the behaviour of the <code>static</code> is <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.7.6.3p7\" rel=\"nofollow noreferrer\">defined</a> under a <strong>semantics</strong> section, not in constraints, so it needs not be diagnosed. It could be but it doesn't seem to have been implemented in GCC. <a href=\"https://gcc.gnu.org/bugzilla/show_bug.cgi?id=50584\" rel=\"nofollow noreferrer\">Here's one bug report</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": false, "score": 0, "last_activity_date": 1565786134, "creation_date": 1565786134, "answer_id": 57494825, "question_id": 57494145, "link": "https://stackoverflow.com/questions/57494145/inconsistent-c99-support-in-gcc-and-clang/57494825#57494825", "title": "Inconsistent C99 support in gcc and clang", "body": "<p>From the answer to question <a href=\"https://stackoverflow.com/questions/3430315/what-is-the-purpose-of-static-keyword-in-array-parameter-of-function-like-char\">What is the purpose of static keyword in array parameter of function like &quot;char s[static 10]&quot;?</a> it appears to be a quality of implementation issue. The C Standard does not specify that the compiler has to diagnose such obvious cases of undefined behavior.</p>\n\n<p>As a matter of fact, the prototypes for functions <code>mystrcpy</code> and <code>strcpy</code> are compatible as documented in an example at the end C18 <strong>6.7.6.3 Function declarators (including prototypes)</strong>, removing much of the advantage of the added information.</p>\n\n<p>It seems much of the new features added in C99 have never caught on, as they were not implemented in some of the mainstream compilers, for political and technical reasons, not the least of which was the reluctance to introduce new incompatibilities with C++.</p>\n\n<p>As a consequence, this ill-born feature, with a horrible syntax, is quite useless.</p>\n"}, {"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 1, "last_activity_date": 1565789077, "last_edit_date": 1565789077, "creation_date": 1565788594, "answer_id": 57495528, "question_id": 57494145, "link": "https://stackoverflow.com/questions/57494145/inconsistent-c99-support-in-gcc-and-clang/57495528#57495528", "title": "Inconsistent C99 support in gcc and clang", "body": "<blockquote>\n  <blockquote>\n    <p>My question is: are these observations consistent with the C Standard\n    or are gcc and/or clang incorrect in their implementation of C99's\n    <code>static</code> keyword inside the <code>[]</code> of a function argument?</p>\n  </blockquote>\n</blockquote>\n\n<p><strong><em>The observations are consistent with the standard.</em></strong></p>\n\n<p><strong>With respect to diagnostics</strong>, the standard provides that</p>\n\n<blockquote>\n  <p>If the keyword <code>static</code> also appears within the <code>[</code> and <code>]</code> of the\n  array type derivation, then for each call to the function, the value\n  of the corresponding actual argument shall provide access to the first\n  element of an array with at least as many elements as specified by the\n  size expression.</p>\n</blockquote>\n\n<p>, but that is part of the <em>semantic</em> description, not a constraint, so there is no requirement that implementations produce diagnostics about violations.  Code that violates that provision has undefined behavior, of course, but that's a separate matter.</p>\n\n<p>And <strong>even if there were a constraint violation</strong>, a conforming implementation is not obligated to reject the code; the only requirement on the implementation in such a case is that it emit a diagnostic message.</p>\n\n<p><strong>As for function-pointer type compatibility</strong>, the standard specifies that</p>\n\n<blockquote>\n  <p>A declaration of a parameter as ''array of type'' shall be adjusted to\n  ''qualified pointer to type'', where the type qualifiers (if any) are\n  those specified within the [ and ] of the array type derivation.</p>\n</blockquote>\n\n<p><code>static</code> is not among the type qualifiers (they are zero or more of <code>const</code>, <code>restrict</code>, and <code>volatile</code>), so its appearance in the function signature does not serve to alter the function's type.  Thus, pointers to these two functions</p>\n\n<blockquote>\n<pre><code>char *mystrcpy(char dest[restrict static 1], char const src[restrict static 1]);\n</code></pre>\n  \n  <p>[...]</p>\n\n<pre><code>char *strcpy(char restrict *dest, const char restrict *src);\n</code></pre>\n</blockquote>\n\n<p>indeed do have compatible (in fact the same) type.  The <code>static 1</code> simply does not factor in to that.</p>\n"}], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 0, "accepted_answer_id": 57495528, "answer_count": 4, "score": 6, "last_activity_date": 1565789077, "creation_date": 1565783436, "last_edit_date": 1565785325, "question_id": 57494145, "link": "https://stackoverflow.com/questions/57494145/inconsistent-c99-support-in-gcc-and-clang", "title": "Inconsistent C99 support in gcc and clang", "body": "<p>When trying to take advantage of the C99 function prototype syntax specifying non null pointers for function arguments, I came across some inconsistent behavior between clang and gcc:</p>\n\n<p>A function can be declared and defined to receive a non-null pointer to an array of a minimum size. For example:</p>\n\n<p><code>char *mystrcpy(char dest[restrict static 1], char const src[restrict static 1]);</code></p>\n\n<p>declares function <code>mystrcpy</code> to take non-null restricted pointers to <code>char</code> arrays.</p>\n\n<p>This definition is stricter than the standard definition of <code>strcpy</code> that uses a more classic form:</p>\n\n<p><code>char *strcpy(char restrict *dest, const char restrict *src);</code></p>\n\n<p>Where the C compiler is given no information about the constraint ont the arguments to be non-null.</p>\n\n<p>I wrote a test program to verify the compatibility of these 2 prototypes and was surprised to discover that they are indeed compatible although more information is carried in the first than the second. Further surprising were these facts:</p>\n\n<ul>\n<li>with all warnings enabled, clang does not complain about <code>strcpy</code> receiving null arguments.</li>\n<li>gcc did complain about <code>strcpy</code> receiving null arguments, not not about <code>mystrcpy</code>, in spite of its unambiguous definition.</li>\n<li>assigning <code>strcpy</code> or <code>mystrcpy</code> to function pointers defined with both syntaxes did not cause any warning.</li>\n<li>passing null pointers to an indirect call through a function pointer did not trigger a warning in clang where the direct call did.</li>\n</ul>\n\n<blockquote>\n  <p>My question is: are these observations consistent with the C Standard or are gcc and/or clang incorrect in their implementation of C99's <code>static</code> keyword inside the <code>[]</code> of a function argument?</p>\n</blockquote>\n\n<p>Here is the code:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nstatic char *mystrcpy(char dest[restrict static 1], char const src[restrict static 1]) {\n    char *p = dest;\n    while ((*p++ = *src++) != '\\0')\n        continue;\n    return dest;\n}\n\nstatic char *(*f1)(char *dest, const char *src) = strcpy;\nstatic char *(*f2)(char *dest, const char *src) = mystrcpy;\n\nstatic char *(*f3)(char dest[restrict static 1], char const src[restrict static 1]) = strcpy;\nstatic char *(*f4)(char dest[restrict static 1], char const src[restrict static 1]) = mystrcpy;\n\nint main() {\n    char a[100];\n\n    strcpy(a, \"a\");\n    strcpy(a, \"\");\n    strcpy(a, NULL);\n    strcpy(a, a);\n    strcpy(NULL, a);\n    strcpy(NULL, NULL);\n\n    mystrcpy(a, \"a\");\n    mystrcpy(a, \"\");\n    mystrcpy(a, NULL);\n    mystrcpy(a, a);\n    mystrcpy(NULL, a);\n    mystrcpy(NULL, NULL);\n\n    f1(a, \"a\");\n    f1(a, \"\");\n    f1(a, NULL);\n    f1(a, a);\n    f1(NULL, a);\n    f1(NULL, NULL);\n\n    f2(a, \"a\");\n    f2(a, \"\");\n    f2(a, NULL);\n    f2(a, a);\n    f2(NULL, a);\n    f2(NULL, NULL);\n\n    f3(a, \"a\");\n    f3(a, \"\");\n    f3(a, NULL);\n    f3(a, a);\n    f3(NULL, a);\n    f3(NULL, NULL);\n\n    f4(a, \"a\");\n    f4(a, \"\");\n    f4(a, NULL);\n    f4(a, a);\n    f4(NULL, a);\n    f4(NULL, NULL);\n\n    return 0;\n}\n</code></pre>\n\n<p>gcc output: it only complains about the direct calls to <code>strcpy</code> with <code>NULL</code> arguments.</p>\n\n<pre>\n$ gcc -O2 -std=c99 -Wall -Wextra -W -o sc sc.c\nsc.c: In function 'main':\nsc.c:22:5: warning: null argument where non-null required (argument 2) [-Wnonnull]\nsc.c:22:5: warning: null argument where non-null required (argument 2) [-Wnonnull]\nsc.c:24:5: warning: null argument where non-null required (argument 1) [-Wnonnull]\nsc.c:24:5: warning: null argument where non-null required (argument 1) [-Wnonnull]\nsc.c:25:5: warning: null argument where non-null required (argument 1) [-Wnonnull]\nsc.c:25:5: warning: null argument where non-null required (argument 2) [-Wnonnull]\nsc.c:25:5: warning: null argument where non-null required (argument 1) [-Wnonnull]\nsc.c:25:5: warning: null argument where non-null required (argument 2) [-Wnonnull]\n</pre>\n\n<p>clang's output: only complains about the direct calls to <code>mystrcpy</code> with <code>NULL</code> arguments.</p>\n\n<pre>\n$ clang -Weverything -o sc sc.c\nsc.c:29:5: warning: null passed to a callee that requires a non-null argument [-Wnonnull]\n    mystrcpy(a, NULL);\n    ^           ~~~~\nsc.c:4:64: note: callee declares array parameter as static here\nstatic char *mystrcpy(char dest[restrict static 1], char const src[restrict static 1]) {\n                                                               ^  ~~~~~~~~~~~~~~~~~~~\nsc.c:31:5: warning: null passed to a callee that requires a non-null argument [-Wnonnull]\n    mystrcpy(NULL, a);\n    ^        ~~~~\nsc.c:4:28: note: callee declares array parameter as static here\nstatic char *mystrcpy(char dest[restrict static 1], char const src[restrict static 1]) {\n                           ^   ~~~~~~~~~~~~~~~~~~~\nsc.c:32:5: warning: null passed to a callee that requires a non-null argument [-Wnonnull]\n    mystrcpy(NULL, NULL);\n    ^        ~~~~\nsc.c:4:28: note: callee declares array parameter as static here\nstatic char *mystrcpy(char dest[restrict static 1], char const src[restrict static 1]) {\n                           ^   ~~~~~~~~~~~~~~~~~~~\nsc.c:32:5: warning: null passed to a callee that requires a non-null argument [-Wnonnull]\n    mystrcpy(NULL, NULL);\n    ^              ~~~~\nsc.c:4:64: note: callee declares array parameter as static here\nstatic char *mystrcpy(char dest[restrict static 1], char const src[restrict static 1]) {\n                                                               ^  ~~~~~~~~~~~~~~~~~~~\n4 warnings generated.\n</pre>\n\n<p>A more recent version of gcc also complains about passing the same pointer for 2 restrict qualified arguments, but still no support for the <code>static</code> minimum length specifier (see <a href=\"https://godbolt.org/z/aUbv3Z\" rel=\"nofollow noreferrer\">Godbolt session</a>):</p>\n\n<pre>\nsc.c:30:14: warning: passing argument 1 to 'restrict'-qualified parameter aliases with argument 2 [-Wrestrict]\n   30 |     mystrcpy(a, a);\n      |              ^  ~\nsc.c:51:8: warning: passing argument 1 to 'restrict'-qualified parameter aliases with argument 2 [-Wrestrict]\n   51 |     f3(a, a);\n      |        ^  ~\nsc.c:58:8: warning: passing argument 1 to 'restrict'-qualified parameter aliases with argument 2 [-Wrestrict]\n   58 |     f4(a, a);\n      |        ^  ~\nsc.c:37:5: warning: 'strcpy' source argument is the same as destination [-Wrestrict]\n   37 |     f1(a, a);\n      |     ^~~~~~~~\n</pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 5, "creation_date": 1565782915, "post_id": 57493908, "comment_id": 101457656, "body": "This definitely calls for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>.  Where it is well defined in the first place, C arithmetic depends on the types and values of the operands, not (otherwise) on the form of the operand expressions."}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 3, "creation_date": 1565783040, "post_id": 57493908, "comment_id": 101457723, "body": "Sometimes it helps to inspect the assembly generated by the two statements."}, {"owner": {"reputation": 446, "user_id": 11524813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-SLdyU8SbZMU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3ref3U-gZfn3pxcPa5XtOputeVj_mQ/mo/photo.jpg?sz=128", "display_name": "\u05d1\u05e0\u05d9\u05de\u05d9\u05df \u05db\u05d4\u05df", "link": "https://stackoverflow.com/users/11524813/%d7%91%d7%a0%d7%99%d7%9e%d7%99%d7%9f-%d7%9b%d7%94%d7%9f"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1565783168, "post_id": 57493908, "comment_id": 101457781, "body": "@PaulOgilvie I did that, and it didn&#39;t seem to have any problems (although I&#39;m not very good with assembly, so I might have missed it).. Should I edit my question to include it?"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 8, "creation_date": 1565783517, "post_id": 57493908, "comment_id": 101457935, "body": "Adding an <code>int</code> variable to a pointer n C is <i>definitely</i> the same as adding an <code>int</code> constant.  Your second example <code>*(vidmem + p) = 0x30</code> absolutely should have behaved the same way, presuming the value of <code>p</code> was in fact 0.  There must be something else going on here, that we can&#39;t see."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 3, "creation_date": 1565783595, "post_id": 57493908, "comment_id": 101457982, "body": "I would pick a name other than <code>p</code> for a variable that&#39;s not a pointer, but that&#39;s a stylistic point, that won&#39;t affect the functionality."}, {"owner": {"reputation": 32308, "user_id": 20270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37335856df5e5e73d82bca5a805bd647?s=128&d=identicon&r=PG", "display_name": "Hasturkun", "link": "https://stackoverflow.com/users/20270/hasturkun"}, "edited": false, "score": 1, "creation_date": 1565783641, "post_id": 57493908, "comment_id": 101457999, "body": "Is <code>p</code> global? if so it&#39;s likely in BSS, which might not be getting zeroed. Consider trying to compile it with <code>-fno-zero-initialized-in-bss</code> to test it out."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 2, "creation_date": 1565783648, "post_id": 57493908, "comment_id": 101458004, "body": "Where is <i>&quot;somewhere else&quot;</i>? Is <code>p</code> really <code>0</code> when the program is executing <code>*(vidmem + p) = 0x30;</code>? Please show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, I&#39;m sure there is something you&#39;re not telling us."}, {"owner": {"reputation": 446, "user_id": 11524813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-SLdyU8SbZMU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3ref3U-gZfn3pxcPa5XtOputeVj_mQ/mo/photo.jpg?sz=128", "display_name": "\u05d1\u05e0\u05d9\u05de\u05d9\u05df \u05db\u05d4\u05df", "link": "https://stackoverflow.com/users/11524813/%d7%91%d7%a0%d7%99%d7%9e%d7%99%d7%9f-%d7%9b%d7%94%d7%9f"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1565784081, "post_id": 57493908, "comment_id": 101458234, "body": "@JohnBollinger I edited the question to include the whole code (kernel.c)"}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1565784244, "post_id": 57493908, "comment_id": 101458301, "body": "What happens if you use this syntax: <code>vidmem[p] = 0x30;</code> ?"}, {"owner": {"reputation": 446, "user_id": 11524813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-SLdyU8SbZMU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3ref3U-gZfn3pxcPa5XtOputeVj_mQ/mo/photo.jpg?sz=128", "display_name": "\u05d1\u05e0\u05d9\u05de\u05d9\u05df \u05db\u05d4\u05df", "link": "https://stackoverflow.com/users/11524813/%d7%91%d7%a0%d7%99%d7%9e%d7%99%d7%9f-%d7%9b%d7%94%d7%9f"}, "reply_to_user": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1565784293, "post_id": 57493908, "comment_id": 101458326, "body": "@chqrlie then it produces exactly the same result"}, {"owner": {"reputation": 446, "user_id": 11524813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-SLdyU8SbZMU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3ref3U-gZfn3pxcPa5XtOputeVj_mQ/mo/photo.jpg?sz=128", "display_name": "\u05d1\u05e0\u05d9\u05de\u05d9\u05df \u05db\u05d4\u05df", "link": "https://stackoverflow.com/users/11524813/%d7%91%d7%a0%d7%99%d7%9e%d7%99%d7%9f-%d7%9b%d7%94%d7%9f"}, "reply_to_user": {"reputation": 32308, "user_id": 20270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37335856df5e5e73d82bca5a805bd647?s=128&d=identicon&r=PG", "display_name": "Hasturkun", "link": "https://stackoverflow.com/users/20270/hasturkun"}, "edited": false, "score": 0, "creation_date": 1565784384, "post_id": 57493908, "comment_id": 101458374, "body": "@Hasturkun didn&#39;t work"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565784649, "post_id": 57493908, "comment_id": 101458502, "body": "I am pretty shure your stack pointer is completely b0rked. Probably even so that it is not properly aligned upon entering the function."}, {"owner": {"reputation": 14956, "user_id": 544557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad1df76ef4fab96ec67b2afa080b3a0c?s=128&d=identicon&r=PG", "display_name": "Jim Balter", "link": "https://stackoverflow.com/users/544557/jim-balter"}, "edited": false, "score": 0, "creation_date": 1565786762, "post_id": 57493908, "comment_id": 101459579, "body": "&quot;it didn&#39;t seem to have any problems&quot; -- What does that mean? If this is compiled with optimization, the exact same code should be produced by <code>*(vidmem + 0) = 0x30;</code> and <code>int p = 0; *(vidmem + p) = 0x30;</code>.  &quot;then it produces exactly the same result&quot; -- as what? You have described two different results. In any case, it&#39;s unlikely that the difference has anything to do with using <code>p</code> or not ... you may be having random results that have coincidentally correlated with the two syntaxes."}, {"owner": {"reputation": 446, "user_id": 11524813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-SLdyU8SbZMU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3ref3U-gZfn3pxcPa5XtOputeVj_mQ/mo/photo.jpg?sz=128", "display_name": "\u05d1\u05e0\u05d9\u05de\u05d9\u05df \u05db\u05d4\u05df", "link": "https://stackoverflow.com/users/11524813/%d7%91%d7%a0%d7%99%d7%9e%d7%99%d7%9f-%d7%9b%d7%94%d7%9f"}, "reply_to_user": {"reputation": 14956, "user_id": 544557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad1df76ef4fab96ec67b2afa080b3a0c?s=128&d=identicon&r=PG", "display_name": "Jim Balter", "link": "https://stackoverflow.com/users/544557/jim-balter"}, "edited": false, "score": 0, "creation_date": 1565787889, "post_id": 57493908, "comment_id": 101460212, "body": "@JimBalter I don&#39;t compile with optimization, but if I do, then it works perfectly."}, {"owner": {"reputation": 478, "user_id": 2623045, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q7UIB.png?s=128&g=1", "display_name": "grenix", "link": "https://stackoverflow.com/users/2623045/grenix"}, "edited": false, "score": 0, "creation_date": 1565798060, "post_id": 57493908, "comment_id": 101465995, "body": "Optimizing can have the effect that the compiler &quot;sees&quot; that p is anyway 0, so no need to allocate memory for the &quot;useless&quot; variable p. This might be a further hint that somithing is wrong with p resp the address where p is stored. Antti Haapala already mentioned stack pointer. What if you define p above main as a global variable?"}], "answers": [{"comments": [{"owner": {"reputation": 478, "user_id": 2623045, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q7UIB.png?s=128&g=1", "display_name": "grenix", "link": "https://stackoverflow.com/users/2623045/grenix"}, "edited": false, "score": 0, "creation_date": 1565799830, "post_id": 57494789, "comment_id": 101466825, "body": "I agree: Even when Writing a &quot;Simple&quot; Operating System from Scratch some knowledge of the cpu architecture, the machine code resp assembler code and a debugger (preferably a hardware debugger) can not harm."}], "tags": [], "owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "is_accepted": false, "score": 0, "last_activity_date": 1565785995, "creation_date": 1565785995, "answer_id": 57494789, "question_id": 57493908, "link": "https://stackoverflow.com/questions/57493908/adding-variable-to-pointer-is-diffrent-then-adding-a-constant/57494789#57494789", "title": "Adding variable to pointer is diffrent then adding a constant", "body": "<p>This may not be an answer, but I need to format code.</p>\n\n<p>To debug, try:</p>\n\n<pre><code>#define VIDEO_ADDRESS 0xb8000\n\nint main() {\n    int p = 0;\n    unsigned char* vidmem = (unsigned char*) VIDEO_ADDRESS + p;\n    *vidmem = 0x30;\n}\n</code></pre>\n\n<p>This might prove Antti Haapala's suspicion.</p>\n\n<p>I also sugested to inspect the assembler generated, and you could step it in the debugger and inspect registers and memory locations, if your platforms has a debugger.</p>\n"}], "owner": {"reputation": 446, "user_id": 11524813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-SLdyU8SbZMU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3ref3U-gZfn3pxcPa5XtOputeVj_mQ/mo/photo.jpg?sz=128", "display_name": "\u05d1\u05e0\u05d9\u05de\u05d9\u05df \u05db\u05d4\u05df", "link": "https://stackoverflow.com/users/11524813/%d7%91%d7%a0%d7%99%d7%9e%d7%99%d7%9f-%d7%9b%d7%94%d7%9f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1567704691, "creation_date": 1565782519, "last_edit_date": 1567704691, "question_id": 57493908, "link": "https://stackoverflow.com/questions/57493908/adding-variable-to-pointer-is-diffrent-then-adding-a-constant", "title": "Adding variable to pointer is diffrent then adding a constant", "body": "<p>So I have learned a bit about operating systems, and after building a bootloader and the kernel entry as described <a href=\"http://www.cs.bham.ac.uk/~exr/lectures/opsys/10_11/lectures/os-dev.pdf\" rel=\"nofollow noreferrer\">here</a>, I came across some weird behavior.</p>\n\n<p>Consider this piece of code</p>\n\n<pre><code>#define VIDEO_ADDRESS 0xb8000\nunsigned char* vidmem = (unsigned char*) VIDEO_ADDRESS;\nint p = 0;\n</code></pre>\n\n<p>Now, if i do this</p>\n\n<pre><code>*(vidmem + 0) = 0x30;\n</code></pre>\n\n<p>it prints <code>0</code> at the top-left corner as it should, but if I do this</p>\n\n<pre><code>*(vidmem + p) = 0x30;\n</code></pre>\n\n<p>it prints it somewhere else!</p>\n\n<p>I have tried changing the type of <code>p</code>, and it appears that using an <code>int</code> causes the <code>0</code> being printed somewhere else (which looks completely unrelated). If I use any other variant of <code>unsigned</code> and any other type (char, long, int, short), then I need to set <code>p = 1</code> to get the <code>0</code> printed at the top-left corner (does it subtract 1?).</p>\n\n<p>I don't understand what is going on here, and any help will be appreciated.</p>\n\n<p>Here is the complete code</p>\n\n<pre><code>//kernel.c\n#define VIDEO_ADDRESS 0xb8000\n\nint main() {\n    unsigned char* vidmem = (unsigned char*) VIDEO_ADDRESS;\n    int p = 0;\n    *(vidmem + p) = 0x30;\n}\n</code></pre>\n\n<p>Here is how I compile my C file</p>\n\n<pre><code>gcc -ffreestanding -c screen.c -o screen.o\n</code></pre>\n\n<p>I'm using qemu to run the code (Not sure if it has anything to do with this)</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>If I use GRUB instead, it works as expected.</p>\n"}, {"tags": ["c", "gcc"], "comments": [{"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 11, "creation_date": 1565781551, "post_id": 57493650, "comment_id": 101457005, "body": "Perhaps you are compiling it with a C++ compiler instead of a C compiler."}, {"owner": {"reputation": 43, "user_id": 11926951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64c1db4822ecc4a2898fbade5df4db11?s=128&d=identicon&r=PG&f=1", "display_name": "FlorianOry", "link": "https://stackoverflow.com/users/11926951/florianory"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1565781691, "post_id": 57493650, "comment_id": 101457080, "body": "Thank you very much for your very quick answer.  I compiled my file like this : gcc -o tp tp.c"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 11926951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64c1db4822ecc4a2898fbade5df4db11?s=128&d=identicon&r=PG&f=1", "display_name": "FlorianOry", "link": "https://stackoverflow.com/users/11926951/florianory"}, "edited": false, "score": 0, "creation_date": 1565782040, "post_id": 57493722, "comment_id": 101457271, "body": "But when I look in the Finder, the file is called &quot; TP.c&quot; but in the error it&#39;s called &quot; TP.C&quot; and to create it, I did &quot; emacs TP.c&quot; (in lowercase). Is it possible that it is a &quot;.C&quot; file but the finder shows it as a &#39;.c&quot; file ?"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 1, "creation_date": 1565782430, "post_id": 57493722, "comment_id": 101457442, "body": "You can force gcc to treat the file as C language by using the option <code>-x c</code>. (It overrides language auto-detection for any source filename parameters that follow.)"}, {"owner": {"reputation": 43, "user_id": 11926951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64c1db4822ecc4a2898fbade5df4db11?s=128&d=identicon&r=PG&f=1", "display_name": "FlorianOry", "link": "https://stackoverflow.com/users/11926951/florianory"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1565782584, "post_id": 57493722, "comment_id": 101457518, "body": "It shows a &quot; .c &quot; file,   Here&#39;s the ls command :  macbook-pro-de-florian:CODEACADEMY Florian$ ls OLD\tTP.c  Thank you @IanAbbott, I didn&#39;t know a to force gcc to compile the file in C"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "reply_to_user": {"reputation": 43, "user_id": 11926951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64c1db4822ecc4a2898fbade5df4db11?s=128&d=identicon&r=PG&f=1", "display_name": "FlorianOry", "link": "https://stackoverflow.com/users/11926951/florianory"}, "edited": false, "score": 1, "creation_date": 1565783360, "post_id": 57493722, "comment_id": 101457854, "body": "@FlorianOry Perhaps the file can be found with both names <code>TP.c</code> and <code>TP.C</code>. Which name is used on the compiler command line? The error messages imply it is compiling <code>TP.C</code>. Does <code>ls TP.C</code> show a matched filename? Does <code>cat TP.C</code> list the file contents?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 43, "user_id": 11926951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64c1db4822ecc4a2898fbade5df4db11?s=128&d=identicon&r=PG&f=1", "display_name": "FlorianOry", "link": "https://stackoverflow.com/users/11926951/florianory"}, "edited": false, "score": 1, "creation_date": 1565783442, "post_id": 57493722, "comment_id": 101457897, "body": "@FlorianOry, does Ian&#39;s suggestion to force C-language mode resolve your problem?  If so, then both of your current positive-scoring answers are correct.  The remaining issues would then seem to be about the semantics of your filesystem, and those would be better raised as a separate question (if you cannot readily find an answer through your own research)."}, {"owner": {"reputation": 43, "user_id": 11926951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64c1db4822ecc4a2898fbade5df4db11?s=128&d=identicon&r=PG&f=1", "display_name": "FlorianOry", "link": "https://stackoverflow.com/users/11926951/florianory"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 1, "creation_date": 1565783865, "post_id": 57493722, "comment_id": 101458127, "body": "@IanAbbott, and John Bollinger ( I can only tag 1 person), the ls and cat commands show a matched file for TP.c and TP.C. It seems that TP.C is an hidden file. But when I compiled I used the TP.c . It works when I force the C resolve mode. And I also tried to create a new tp2.c file with the same content and I worked too. I don&#39;t know how the TP.C file was created but your solution worked perfectly. Thank you very much for you help !!"}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1565895520, "post_id": 57493722, "comment_id": 101497651, "body": "The error says how the compiler <i>sees</i> the file.  So try to rename the file, as it is compiling it as a c++ file."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user2404501"}, "is_accepted": true, "score": 12, "last_activity_date": 1565781737, "creation_date": 1565781737, "answer_id": 57493722, "question_id": 57493650, "link": "https://stackoverflow.com/questions/57493650/why-do-i-get-assigning-to-int-from-incompatible-type-void-error/57493722#57493722", "title": "Why do I get &quot;assigning to &#39;int *&#39; from incompatible type &#39;void *&#39; &quot; error?", "body": "<p>It appears that your file's name is <code>TP.C</code>.</p>\n\n<p>In the unix tradition, C source files are named <code>*.c</code> (lowercase c), and C++ source files are named <code>*.C</code> (capital C). The alternative <code>*.cpp</code> is used on Windows because of its case-ignorant filesystem, but gcc on MacOS is sufficiently unix-like that it is treating your <code>*.C</code> file as C++.</p>\n"}, {"comments": [{"owner": {"reputation": 81300, "user_id": 296974, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0e26cfe3ac75cd582ca200fbc6fa0421?s=128&d=identicon&r=PG", "display_name": "glglgl", "link": "https://stackoverflow.com/users/296974/glglgl"}, "edited": false, "score": 4, "creation_date": 1565781863, "post_id": 57493744, "comment_id": 101457178, "body": "Your answer is valid for C++, but frowned upon in C."}, {"owner": {"reputation": 14956, "user_id": 544557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad1df76ef4fab96ec67b2afa080b3a0c?s=128&d=identicon&r=PG", "display_name": "Jim Balter", "link": "https://stackoverflow.com/users/544557/jim-balter"}, "edited": false, "score": 2, "creation_date": 1565787173, "post_id": 57493744, "comment_id": 101459833, "body": "Hi Marian. This question is tagged [c], not [c++] ... they are different languages and have different rules for use of <code>malloc</code>. This is actually the key to the OP&#39;s problem, which turns out to be rather fascinating ... see the discussion above under Wumpus Q. Wumbley&#39;s answer."}], "tags": [], "owner": {"reputation": 13, "user_id": 9136761, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/738322ebc57ebaef8656a5199a9c15de?s=128&d=identicon&r=PG&f=1", "display_name": "Marian Cristian Serban", "link": "https://stackoverflow.com/users/9136761/marian-cristian-serban"}, "is_accepted": false, "score": -9, "last_activity_date": 1565781869, "last_edit_date": 1565781869, "creation_date": 1565781840, "answer_id": 57493744, "question_id": 57493650, "link": "https://stackoverflow.com/questions/57493650/why-do-i-get-assigning-to-int-from-incompatible-type-void-error/57493744#57493744", "title": "Why do I get &quot;assigning to &#39;int *&#39; from incompatible type &#39;void *&#39; &quot; error?", "body": "<p>The type returned from malloc is always void*, which can be cast to the desired type of data.</p>\n\n<p>You will need to do:\n(int*) malloc(nombre_lettres * sizeof(int));</p>\n\n<p>source: <a href=\"http://www.cplusplus.com/reference/cstdlib/malloc/\" rel=\"nofollow noreferrer\">cplusplus</a></p>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 11926951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64c1db4822ecc4a2898fbade5df4db11?s=128&d=identicon&r=PG&f=1", "display_name": "FlorianOry", "link": "https://stackoverflow.com/users/11926951/florianory"}, "edited": false, "score": 0, "creation_date": 1565784117, "post_id": 57493752, "comment_id": 101458248, "body": "Thank you for your answer, an hidden file TP.C was in the folder"}], "tags": [], "owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "is_accepted": false, "score": 8, "last_activity_date": 1565781867, "creation_date": 1565781867, "answer_id": 57493752, "question_id": 57493650, "link": "https://stackoverflow.com/questions/57493650/why-do-i-get-assigning-to-int-from-incompatible-type-void-error/57493752#57493752", "title": "Why do I get &quot;assigning to &#39;int *&#39; from incompatible type &#39;void *&#39; &quot; error?", "body": "<p>Given this error message:</p>\n\n<blockquote>\n<pre><code>TP.C:17:16: error: assigning to 'int *' from incompatible type 'void *'\n  decouverte = malloc(nombre_lettres * sizeof(int));\n</code></pre>\n</blockquote>\n\n<p>it appears your file is named <code>TP.C</code>.  <a href=\"https://gcc.gnu.org/onlinedocs/gcc-9.2.0/gcc/Overall-Options.html#Overall-Options\" rel=\"noreferrer\">The upper-case <code>.C</code> file extension causes GCC to compile the file as C++</a>:</p>\n\n<blockquote>\n<pre><code>file.cc\nfile.cp\nfile.cxx\nfile.cpp\nfile.CPP\nfile.c++\nfile.C\n</code></pre>\n  \n  <p>C++ source code that must be preprocessed. Note that in \u2018.cxx\u2019, the last two > must both be literally \u2018x\u2019. <strong>Likewise, \u2018.C\u2019 refers to a literal capital C.</strong></p>\n</blockquote>\n\n<p>You need to use lower-case.  Rename your file so that it ends with a <code>.c</code> - lower-case <code>c</code>.</p>\n"}], "owner": {"reputation": 43, "user_id": 11926951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64c1db4822ecc4a2898fbade5df4db11?s=128&d=identicon&r=PG&f=1", "display_name": "FlorianOry", "link": "https://stackoverflow.com/users/11926951/florianory"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 564, "favorite_count": 0, "accepted_answer_id": 57493722, "answer_count": 3, "score": 4, "last_activity_date": 1565861319, "creation_date": 1565781405, "last_edit_date": 1565861319, "question_id": 57493650, "link": "https://stackoverflow.com/questions/57493650/why-do-i-get-assigning-to-int-from-incompatible-type-void-error", "title": "Why do I get &quot;assigning to &#39;int *&#39; from incompatible type &#39;void *&#39; &quot; error?", "body": "<p>I'm learning c on codeacademy and I get an <em>assigning to 'int *' from incompatible type 'void *'</em> error. My file is a .c file, which includes stdlib.h. I don't understand the error, it seems that the corrections uses the same lines of code.</p>\n\n<p>I'm trying to create an array using malloc.</p>\n\n<p>I tried to find the answer on other topics. It seems that malloc is not the best way to do it but i would like to find a way to make it work.</p>\n\n<p>I'm on a mac, I use emacs to code et gcc to compile.</p>\n\n<p>Here's a part of my code : </p>\n\n<pre><code>int main(int argc, char *argv[])\n{\n  char mot_secret[] = \"PISCINE\";\n  int nombre_lettres = strlen(mot_secret);\n  int *pnombre_lettres = &amp;nombre_lettres;\n  int *decouverte = NULL;\n  int compteur = 10;\n\n  decouverte = malloc(nombre_lettres * sizeof(int));\n  if (decouverte == NULL)\n    {\n      exit(0);\n    }\n\n</code></pre>\n\n<p>And here's the solution : \n( I tried to translate some of the variables)</p>\n\n<pre><code>int main(int argc, char* argv[])\n{\n    char lettre = 0;\n    char secretword[100] = {0};\n    int *lettreTrouvee = NULL; \n    long coupsRestants = 10; // Compteur de coups restants (0 = mort)\n    long i = 0;\n    long wordSize = 0;\n\n    wordSize = strlen(secretWord);\n\n    lettreTrouvee = malloc(tailleMot * sizeof(int)); // creates a dynamic array of the size of the original)\n    if (lettreTrouvee == NULL)\n        exit(0);\n\n</code></pre>\n\n<p>The error is : </p>\n\n<pre><code>TP.C:17:16: error: assigning to 'int *' from incompatible type 'void *'\n  decouverte = malloc(nombre_lettres * sizeof(int));\n</code></pre>\n\n<p>Thank you very much for your help and I'm sorry if I make any mistakes in English.</p>\n"}, {"tags": ["c", "size", "32bit-64bit", "extern", "size-t"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1565781429, "post_id": 57493535, "comment_id": 101456952, "body": "Given <code>extern char _binary_myfile_txt_size[];</code>, <code>size_t data_size  = (size_t)_binary_myfile_txt_size;</code> converts the <i>address</i> of the <code>_binary_myfile_txt_size</code> array to a <code>size_t</code>.  <code>94339555942466</code> is <code>0x55CD23B86042</code> in hex."}, {"owner": {"reputation": 1, "user_id": 3615978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ptzau.jpg?s=128&g=1", "display_name": "Jonni Lehtiranta", "link": "https://stackoverflow.com/users/3615978/jonni-lehtiranta"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1565783749, "post_id": 57493535, "comment_id": 101458059, "body": "I figured I get the right value by <code>size_t dsize = (uint8_t)_binary_myfile_txt_size;</code>, but only if my file size fits into one byte. I don&#39;t understand why this works and why it doesn&#39;t work with, say, uint16_t or uint32_t. If I put uint64_t, I get the address again."}], "owner": {"reputation": 1, "user_id": 3615978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ptzau.jpg?s=128&g=1", "display_name": "Jonni Lehtiranta", "link": "https://stackoverflow.com/users/3615978/jonni-lehtiranta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566072800, "creation_date": 1565780983, "question_id": 57493535, "link": "https://stackoverflow.com/questions/57493535/text-file-linked-to-elf-file-binary-file-size-information-is-garbage", "title": "Text file linked to ELF file - _binary_file_size information is garbage", "body": "<p>I'm trying to revive some old code that links text files (.glsl etc.) into an executable. With my current computer &amp; Kubuntu OS, compiling in 64 bits, I can't read size information anymore. I found a simple example that fails for me in the same way at <a href=\"https://stackoverflow.com/questions/42235175/how-do-i-add-contents-of-text-file-as-a-section-in-an-elf-file\">How do I add contents of text file as a section in an ELF file?</a> . It is further simplified below.</p>\n\n<p>myfile.txt:</p>\n\n<pre><code>Annon edhellon, edro hi ammen\nFennas nogothrim, lasto beth lammen\n</code></pre>\n\n<p>Objectified with, as in the example,</p>\n\n<pre><code>objcopy --input binary --output elf64-x86-64 --binary-architecture i386:x86-64 --rename-section .data=.rodata,CONTENTS,ALLOC,LOAD,READONLY,DATA myfile.txt myfile.o\n</code></pre>\n\n<p>I also tried <code>ld -r -b binary -o myfile.o myfile.txt</code> with the same result.</p>\n\n<p>This is my main.c,</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\n/* These are external references to the symbols created by OBJCOPY */\nextern char _binary_myfile_txt_start[];\nextern char _binary_myfile_txt_end[];\nextern char _binary_myfile_txt_size[];\n\nint main() {\n    char *data_start     = _binary_myfile_txt_start;\n    char *data_end       = _binary_myfile_txt_end;\n    size_t data_size  = (size_t)_binary_myfile_txt_size;\n\n    printf (\"data_start %p\\n\", data_start);\n    printf (\"data_end   %p\\n\", data_end);\n    printf (\"data_size  %zu\\n\", data_size);\n}\n</code></pre>\n\n<p>compiled with\n<code>gcc main.c myfile.o</code></p>\n\n<p>When I run the code, the result is as follows:</p>\n\n<pre><code>data_start 0x55cd23b88032\ndata_end   0x55cd23b88074\ndata_size  94339555942466\n</code></pre>\n\n<p>The start and end pointers work, but data_size is nonsense. I'd expect it to be 66, as shown by wc. I've tried many obvious things but nothing seems to work.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 1605, "user_id": 11723965, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ygAu.jpg?s=128&g=1", "display_name": "nivpeled", "link": "https://stackoverflow.com/users/11723965/nivpeled"}, "edited": false, "score": 0, "creation_date": 1565780691, "post_id": 57493361, "comment_id": 101456606, "body": "check <a href=\"https://www.youtube.com/watch?v=dTtZEAfh_LM\" rel=\"nofollow noreferrer\">This</a>"}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1565782344, "post_id": 57493361, "comment_id": 101457406, "body": "Specify an absolute path to <code>fopen</code>."}, {"owner": {"reputation": 1, "user_id": 11911748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1d6d0db7c81f602bfbee6a35521daf8?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre", "link": "https://stackoverflow.com/users/11911748/pierre"}, "edited": false, "score": 0, "creation_date": 1565789200, "post_id": 57493361, "comment_id": 101461051, "body": "Unfortunately i already saw that video and it didn&#39;t help."}, {"owner": {"reputation": 1, "user_id": 11911748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1d6d0db7c81f602bfbee6a35521daf8?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre", "link": "https://stackoverflow.com/users/11911748/pierre"}, "edited": false, "score": 0, "creation_date": 1565789747, "post_id": 57493361, "comment_id": 101461377, "body": "I tried specifing the path and now it works correctly, thank you ."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11911748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1d6d0db7c81f602bfbee6a35521daf8?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre", "link": "https://stackoverflow.com/users/11911748/pierre"}, "edited": false, "score": 0, "creation_date": 1565789138, "post_id": 57495340, "comment_id": 101461009, "body": "it says that the current working directory is the main folder i was talking about in the question, where the file.txt is already located."}], "tags": [], "owner": {"reputation": 75, "user_id": 9178029, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e96354a94ad607b7fb71681c0b3f9c12?s=128&d=identicon&r=PG&f=1", "display_name": "Niklas Bj&#246;rnest&#229;l", "link": "https://stackoverflow.com/users/9178029/niklas-bj%c3%b6rnest%c3%a5l"}, "is_accepted": false, "score": 0, "last_activity_date": 1565787936, "creation_date": 1565787936, "answer_id": 57495340, "question_id": 57493361, "link": "https://stackoverflow.com/questions/57493361/i-cant-use-input-file-in-my-project-because-clion-seems-to-not-see-the-file/57495340#57495340", "title": "I can&#39;t use input file in my project because Clion seems to not see the file", "body": "<p>You can get the current directory using getcwd to find where the program is looking for file.txt</p>\n\n<pre><code>char cwd[PATH_MAX];\nif (getcwd(cwd, sizeof(cwd)) != NULL) {\n    printf(\"Current working dir: %s\\n\", cwd);\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11911748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1d6d0db7c81f602bfbee6a35521daf8?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre", "link": "https://stackoverflow.com/users/11911748/pierre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565787936, "creation_date": 1565780287, "question_id": 57493361, "link": "https://stackoverflow.com/questions/57493361/i-cant-use-input-file-in-my-project-because-clion-seems-to-not-see-the-file", "title": "I can&#39;t use input file in my project because Clion seems to not see the file", "body": "<p>I recently started using Clion to program in c, but it seems that Clion can't open a txt file for input in my project. I read online that i have to set a proper working directory so that the IDE can see the input file, but every time i tried to change the working directory, nothing changed. I created a simple program to test if the txt file is opened correctly:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n  if((fp = fopen(\"file.txt\", \"r\")) == NULL)\n\n      {\n          printf(\"Error: file.txt is not present\\n\");\n          exit(EXIT_FAILURE);\n      }\n   return 0;\n}\n</code></pre>\n\n<p>The program always print the error. I placed the txt in the main folder of this project, which contains:</p>\n\n<ol>\n<li>.idea                (folder)</li>\n<li>cmake-build-debug    (folder)</li>\n<li>CmakeLists.txt       (file)</li>\n<li>main.c               (file)</li>\n<li>file.txt             (the txt file that i want to be open in my program)</li>\n</ol>\n\n<p>I think i have to place file.txt inside the folder that contains the .exe file (cmake-build-debug) but also in this case the output of the program is the same.</p>\n"}, {"tags": ["c", "eof", "segmentation-fault", "file-writing", "strstr"], "comments": [{"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 2, "creation_date": 1565776612, "post_id": 57492356, "comment_id": 101454538, "body": "<code>while (end &lt;= EOF)</code> This is not correct. <code>EOF</code> is a constant value to indicate end of file. It is not suitable for anything but check for equality. &quot;Less or equal&quot; does not make any sense. Also <code>end</code> is a pointer while <code>EOF</code> is an integer value. Did you intent to use <code>while(end != NULL &amp;&amp; *end != 0)</code>?"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 1, "creation_date": 1565776858, "post_id": 57492356, "comment_id": 101454665, "body": "<code>while (end &lt;= EOF)</code>: this doen&#39;t make any sense: 1: you compare the <i>pointer</i> <code>end</code> to <code>EOF</code> which is not a pointer; 2: you don&#39;t do any file operation within the while loop, so testing for <code>EOF</code> doesn&#39;t make sense anyway."}, {"owner": {"reputation": 93, "user_id": 8360669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ea596116ce42f10e921ebb44a207ce7?s=128&d=identicon&r=PG&f=1", "display_name": "DerEntinator", "link": "https://stackoverflow.com/users/8360669/derentinator"}, "edited": false, "score": 0, "creation_date": 1565777043, "post_id": 57492356, "comment_id": 101454759, "body": "This is completely true,... now I feel a bit more stupid to not catch that myself. Sadly after implementing it didn&#39;t solve the problem, the sigsegv still comes up with the same result."}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1565777397, "post_id": 57492356, "comment_id": 101454944, "body": "Probably not the source of your problem, but: don&#39;t cast the result from <code>malloc()</code>, and do check it&#39;s not null."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1565777398, "post_id": 57492356, "comment_id": 101454945, "body": "@DerEntinator <code>*end != NULL</code> is wrong, <code>*end</code> is not a pointer, <code>end</code> is a pointer. Read again the first comment carefully."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1565777409, "post_id": 57492356, "comment_id": 101454952, "body": "If <code>start</code> doesn&#39;t get set to a non-<code>NULL</code> value, then <code>end</code> won&#39;t get set.  <code>end</code> has not been initialised before it is tested, so you have <i>undefined behaviour</i>."}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 3, "creation_date": 1565777461, "post_id": 57492356, "comment_id": 101454978, "body": "<code>char file[f_length + 1];</code> is dangerous if <code>f_length</code> is more than will fit in the stack frame.  Oh, and don&#39;t ignore the return value of <code>fread()</code>."}, {"owner": {"reputation": 93, "user_id": 8360669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ea596116ce42f10e921ebb44a207ce7?s=128&d=identicon&r=PG&f=1", "display_name": "DerEntinator", "link": "https://stackoverflow.com/users/8360669/derentinator"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565778209, "post_id": 57492356, "comment_id": 101455377, "body": "@WeatherVane The weird thing is, that it can output the correct thing to stdout, but not to a file directly"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565778265, "post_id": 57492356, "comment_id": 101455412, "body": "So? It&#39;s undefined behaviour."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 1, "creation_date": 1565778336, "post_id": 57492356, "comment_id": 101455447, "body": "That&#39;s probably because <code>stdout</code> is line buffered and each <code>printf</code> is shown immediately on the terminal. OTOH the file can have a larger buffer and when your program stops crashing&amp;burning the buffer is not flushed."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1565778372, "post_id": 57492356, "comment_id": 101455468, "body": "You could use <code>memmem()</code> instead of<code>strstr()</code>"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1565778546, "post_id": 57492356, "comment_id": 101455540, "body": "Note that by using <code>fread</code> you can&#39;t guarantee that any sequence of characters is zero-terminated and thus is safe to apply <code>strstr</code>. If searching for text you should be using text-based input functions. Also you might miss a construction that starts in one data block and finishes in the next one."}, {"owner": {"reputation": 93, "user_id": 8360669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ea596116ce42f10e921ebb44a207ce7?s=128&d=identicon&r=PG&f=1", "display_name": "DerEntinator", "link": "https://stackoverflow.com/users/8360669/derentinator"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565778785, "post_id": 57492356, "comment_id": 101455663, "body": "@WeatherVane what do you mean by text-based input functions?"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1565781039, "post_id": 57492356, "comment_id": 101456753, "body": "Properly parsing XML is <b>hard</b>.  See <a href=\"https://stackoverflow.com/questions/701166/can-you-provide-some-examples-of-why-it-is-hard-to-parse-xml-and-html-with-a-reg\">Can you provide some examples of why it is hard to parse XML and HTML with a regex?</a> and <a href=\"https://stackoverflow.com/questions/3597239/why-use-an-xml-parser\">Why use an XML parser?</a>."}, {"owner": {"reputation": 93, "user_id": 8360669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ea596116ce42f10e921ebb44a207ce7?s=128&d=identicon&r=PG&f=1", "display_name": "DerEntinator", "link": "https://stackoverflow.com/users/8360669/derentinator"}, "edited": false, "score": 0, "creation_date": 1565781144, "post_id": 57492356, "comment_id": 101456808, "body": "Is there any other way to achieve what I want to do e.g. pulling string between two stings out of the file and save it to a new one?"}, {"owner": {"reputation": 14956, "user_id": 544557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad1df76ef4fab96ec67b2afa080b3a0c?s=128&d=identicon&r=PG", "display_name": "Jim Balter", "link": "https://stackoverflow.com/users/544557/jim-balter"}, "edited": false, "score": 1, "creation_date": 1565787439, "post_id": 57492356, "comment_id": 101459966, "body": "First rule: COMPILE WITH WARNINGS ENABLED."}], "answers": [{"comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565780167, "post_id": 57492792, "comment_id": 101456358, "body": "Note that <code>end</code> is <i>uninitialised</i> before first use. The OP&#39;s code still has plenty more wrong with it and there isn&#39;t one simple fix."}], "tags": [], "owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "is_accepted": false, "score": 0, "last_activity_date": 1565780076, "last_edit_date": 1565780076, "creation_date": 1565778081, "answer_id": 57492792, "question_id": 57492356, "link": "https://stackoverflow.com/questions/57492356/stopping-strstr-before-it-runs-into-sigsegv/57492792#57492792", "title": "Stopping strstr before it runs into sigsegv", "body": "<p>You should not check <code>end</code> but <code>start</code>.</p>\n\n<pre><code>while (end != NULL &amp;&amp; *end != 0){ //EDIT from comments\n    char *target = NULL;\n    if (start = strstr(start, SPattern)) { // startig search from last end pointer\n        start += strlen(SPattern);\n        if (end = strstr(start, EPattern)) {\n            target = (char *) malloc(end - start + 1);\n            memcpy(target, start, end - start);\n            target[end - start] = '\\0';\n\n            start = end;\n        }\n    }\n\n    if (target) fprintf(stdout, \"%s%s%s\\n\", SPattern, target, EPattern);\n\n    free(target);\n}\n</code></pre>\n\n<p>If you found the last element and search for the next one, <code>start</code> will be <code>NULL</code> and you won't enter the <code>if</code> block.\nYou don't change <code>end</code> in that case and call <code>strstr</code> again but now with <code>start == NULL</code>.</p>\n\n<p>As far as I remember, <code>strstr</code> is not required to verify for valid pointers.</p>\n\n<p>In your loop <code>end</code> will only ever become <code>NULL</code> if you find the start pattern but no end pattern. For a valid XML file this is rather unlikely to happen.</p>\n"}], "owner": {"reputation": 93, "user_id": 8360669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ea596116ce42f10e921ebb44a207ce7?s=128&d=identicon&r=PG&f=1", "display_name": "DerEntinator", "link": "https://stackoverflow.com/users/8360669/derentinator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565791648, "creation_date": 1565776423, "last_edit_date": 1565777602, "question_id": 57492356, "link": "https://stackoverflow.com/questions/57492356/stopping-strstr-before-it-runs-into-sigsegv", "title": "Stopping strstr before it runs into sigsegv", "body": "<p>I have a large .xml file and need to pull specific bits out of it.\nThe things I need to pull out are encapsulated by a substring on either side.\nI need to write the output to a file.</p>\n\n<p>I'm searching for the starting sub and from there for the ending sub, then copying it and putting it out over fprintf.\nI'm setting the start-pointer to the position of the last end pointer and it continues to search until it runs into the sigsegv.</p>\n\n<p>I don't know how to stop the loop at the last occurrence of the substrings I'm searching for before it runs into the sigsegv.</p>\n\n<p>An interesting problem I encountered is that if I output to stdout it prints everything I want to pull out and then breaks down.\nIf I want to write it to a file it doesn't write the same thing but breaks down before it finishes and in the process losing the last 37 lines of output.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nint main(void) {\n\n    FILE *fp;\n    fp = fopen(\"C:/Users/entin/Desktop/IHP/Auswerte_Marko/TEMP/20190605204730250_S210D_PQ41701_TM2_TV2_MARK21Single_21Single.ega_rslt\", \"r\");\n\n    FILE *fw;\n    fw = fopen(\"C:/Users/entin/Desktop/IHP/Auswerte_Marko/TEMP/t1.xml\", \"w\");\n\n    int f_length;\n    fseek(fp, 0, SEEK_END);\n    f_length = ftell(fp);\n    char file[f_length + 1];\n    rewind(fp);\n    fread(file, f_length, 1, fp);\n    file[f_length] = 0; \n\n\n\n    const char *SPattern = \"&lt;MeasData \"; // start of substring\n    const char *EPattern = \"&lt;/MeasData&gt;\"; // end of substring\n    char *start, *end;\n    char *target = NULL;\n\n    if (start = strstr(file, SPattern)) { // search for start substring\n        start += strlen(SPattern);\n        if (end = strstr(start, EPattern)) { // search for end substring\n            target = (char *) malloc(end - start + 1);\n            memcpy(target, start, end - start); // copying content between start and end pointers\n            target[end - start] = '\\0';\n\n            start = end; // setting new start to old end\n        }\n    }\n\n    if (target) fprintf(stdout, \"%s%s%s\\n\", SPattern, target, EPattern); // assembling everything back together\n\n    free(target);\n\n\n    //while (end &lt;= EOF) { // repeating till end of file is reached\n    while (end != NULL &amp;&amp; *end != 0){ //EDIT from comments\n        char *target = NULL;\n        if (start = strstr(start, SPattern)) { // startig search from last end pointer\n            start += strlen(SPattern);\n            if (end = strstr(start, EPattern)) {\n                target = (char *) malloc(end - start + 1);\n                memcpy(target, start, end - start);\n                target[end - start] = '\\0';\n\n                start = end;\n            }\n        }\n\n        if (target) fprintf(stdout, \"%s%s%s\\n\", SPattern, target, EPattern);\n\n        free(target);\n    }\n\n    fclose(fp);\n    fclose(fw);\n    getchar();\n    return 0;\n}\n</code></pre>\n\n<p>Here are the files:</p>\n\n<p><a href=\"https://pastebin.com/ZK3DptkS\" rel=\"nofollow noreferrer\">Input File</a></p>\n\n<p><a href=\"https://pastebin.com/iAHQiJNq\" rel=\"nofollow noreferrer\">Output to stdout that I want in a file</a></p>\n\n<p><a href=\"https://pastebin.com/iijPPAik\" rel=\"nofollow noreferrer\">Output that I get when I write to a file</a></p>\n\n<p>(only the last lines of the output matter)</p>\n"}, {"tags": ["c", "pointers"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565775813, "post_id": 57492109, "comment_id": 101454114, "body": "You can&#39;t initialize pointers like that. It could be possible using <a href=\"https://en.cppreference.com/w/c/language/compound_literal\" rel=\"nofollow noreferrer\">compound literals</a> to make the pointer point to an array (e.g. <code>(int[]){ ... }</code>), but then this initialization must be at file-scope or else the array will end its life when the block it&#39;s defined in ends."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565775901, "post_id": 57492109, "comment_id": 101454152, "body": "The easiest solution is to let <code>sourceAddressingMode</code> and <code>destAddressingMode</code> be arrays of a fixed maximum size. Then use as much of them as needed. They are not arrays currently, but pointers, which doesn&#39;t make sense given this initializer list you&#39;ve provided."}], "answers": [{"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 2, "creation_date": 1565776025, "post_id": 57492193, "comment_id": 101454230, "body": "Note the <code>static</code> qualifier. If this is a local <code>static</code> variable you can&#39;t initialize it to point at compound literals. It will only work in case it is declared at file scope."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565779030, "post_id": 57492193, "comment_id": 101455780, "body": "In regard to the note: <code>(int [])</code> has no scope because it has no name. Scope is <b>where</b> in source code an <b>identifier</b> is visible. Lifetime is <b>when</b> during program execution an <b>object</b> exists. The statement that an object cannot be accessed \u201coutside its scope\u201d is false because an object may be accessed by subroutines called during its lifetime."}], "tags": [], "owner": {"reputation": 12106, "user_id": 4431643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CoZjt.jpg?s=128&g=1", "display_name": "kiran Biradar", "link": "https://stackoverflow.com/users/4431643/kiran-biradar"}, "is_accepted": false, "score": 1, "last_activity_date": 1565775849, "creation_date": 1565775849, "answer_id": 57492193, "question_id": 57492109, "link": "https://stackoverflow.com/questions/57492109/how-to-declare-pointer-from-struct-to-final-array/57492193#57492193", "title": "How to declare pointer from struct to final array", "body": "<p>You need to treat initialization elements as compound literals if you want to assign it to pointer.</p>\n\n<p><strong>Example:</strong></p>\n\n<p>change</p>\n\n<pre><code>{\"mov\", 0, 2, {IMMEDIATE ,DIRECT , INDEX , REGISTER},{DIRECT , INDEX , REGISTER}   },\n</code></pre>\n\n<p>to</p>\n\n<pre><code>{\"mov\", 0, 2, (int []){IMMEDIATE ,DIRECT , INDEX , REGISTER}, (int []){DIRECT , INDEX , REGISTER}   },\n</code></pre>\n\n<blockquote>\n  <p>Note:: <code>(int [])</code> will be having local scope and accessing them\n  outside its scope is undefined behavior.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 44, "user_id": 7221087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9960370de369f908a3a3d929fd1f503c?s=128&d=identicon&r=PG&f=1", "display_name": "Armand Biestro", "link": "https://stackoverflow.com/users/7221087/armand-biestro"}, "is_accepted": true, "score": 1, "last_activity_date": 1565777231, "creation_date": 1565777231, "answer_id": 57492587, "question_id": 57492109, "link": "https://stackoverflow.com/questions/57492109/how-to-declare-pointer-from-struct-to-final-array/57492587#57492587", "title": "How to declare pointer from struct to final array", "body": "<p>first off all, i think when i tied to compile your code i had so much warning, if i were you i would try to avoid those, wall warning are not bugs, but some are and are a good way to debug.\nmost errors are:\n<code>incompatible integer to pointer conversion initializing 'int *' with an expression of type 'int'</code></p>\n\n<p>One possibily that would make a lot of sense to me would be, as you know in advance thse size of your arrays to declare them this way: </p>\n\n<pre><code>int   sourceAddressingMode[4];\n\nint   destAddressingMode[4];\n</code></pre>\n\n<p>but is not optimal.</p>\n\n<p>The best to me would be using binary operators:</p>\n\n<p>your opcode become:</p>\n\n<pre><code>typedef enum {\n\nIMMEDIATE 0, DIRECT 1, INDEX 2, REGISTER 4\n\n}ADDRESSING_MODE;\n</code></pre>\n\n<p>your sourceAddressingMode and destAddressingMode are of type int.</p>\n\n<p>declaration is quite easy and looks like </p>\n\n<pre><code>{\"mov\", 0, 2, {IMMEDIATE | DIRECT | INDEX | REGISTER},{DIRECT | INDEX | REGISTER}   },\n</code></pre>\n\n<p>and to know for exemple of your first opCode have a sourceAddressingMode that is DIRECT, you can use  the '&amp;' operator such has:</p>\n\n<pre><code>if (Opcode[0].sourceAddressingMode &amp; DIRECT)\n  //do stuff\n</code></pre>\n\n<p>hope that will help, and i ll be glad to know what kiran Biradar does think about this solution instead of casts. cheers</p>\n"}], "owner": {"reputation": 95, "user_id": 10819830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32d95d61446f656f3847c4bc95babae7?s=128&d=identicon&r=PG&f=1", "display_name": "Agar123", "link": "https://stackoverflow.com/users/10819830/agar123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 57492587, "answer_count": 2, "score": 0, "last_activity_date": 1565777231, "creation_date": 1565775539, "question_id": 57492109, "link": "https://stackoverflow.com/questions/57492109/how-to-declare-pointer-from-struct-to-final-array", "title": "How to declare pointer from struct to final array", "body": "<p>I want to make an array of struct, the problem is when to each single struct has different size of array.\nI tried to make an pointer to the array, but i dont get the point.</p>\n\n<pre><code>typedef struct {\n\n    char *opcodeName;\n\n    int   opcodeNumber;\n\n    int   howManyOprendsNeeded;\n\n    int   *sourceAddressingMode;\n\n    int   *destAddressingMode;\n\n}Opcode;\n</code></pre>\n\n<pre><code>typedef enum {\n\n  IMMEDIATE, DIRECT, INDEX, REGISTER\n\n}ADDRESSING_MODE;\n</code></pre>\n\n<pre><code>static const Opcode opcodes[] = {\n\n        {\"mov\", 0, 2, {IMMEDIATE ,DIRECT , INDEX , REGISTER},{DIRECT , INDEX , REGISTER}   },\n        {\"cmp\" ,1, 2, {IMMEDIATE ,DIRECT , INDEX , REGISTER}, {IMMEDIATE ,DIRECT , INDEX , REGISTER}},\n        {\"add\" ,2, 2, {IMMEDIATE ,DIRECT , INDEX , REGISTER},{DIRECT , INDEX , REGISTER }    },\n        {\"sub\" ,3, 2, {IMMEDIATE ,DIRECT , INDEX , REGISTER},{ DIRECT , INDEX , REGISTER}   },\n        {\"not\" ,4, 1, {-1}                                   , {DIRECT , INDEX , REGISTER}  },\n        {\"clr\" ,5, 1, {-1}                                   , {DIRECT , INDEX , REGISTER} },\n        {\"lea\" ,6, 2, {DIRECT,INDEX}                         , {DIRECT , INDEX , REGISTER}   },\n        {\"inc\" ,7, 1, {-1}                                   , {DIRECT , INDEX , REGISTER} },\n        {\"dec\" ,8, 1, {-1}                                   , {DIRECT , INDEX , REGISTER} },\n        {\"jmp\" ,9, 1, {-1}                                   , {DIRECT ,REGISTER}  },\n        {\"bne\" ,10, 1,{-1}                                   , {DIRECT , REGISTER}  },\n        {\"red\" ,11, 1,{-1}                                   ,  {DIRECT , INDEX , REGISTER}  },\n        {\"prn\" ,12, 1,{-1}                                   , {IMMEDIATE ,DIRECT , INDEX , REGISTER}  },\n        {\"jsr\" ,13, 1,{-1}                                   , {DIRECT , REGISTER}  },\n        {\"rts\" ,14, 0,{-1}                                  , {-1}},\n        {\"stop\",15, 0,{-1}                                  , {-1}},\n\n\n};\n</code></pre>\n\n<p>How can i declare the array from the strcut, If i dont know how much the size is.\nThe errors i got : \n1.initialization of 'int *' from 'int' makes pointer from integer without a cast [-Wint-conversion] causing by {IMMEDIATE ,DIRECT , INDEX , REGISTER}.\n2.excess elements in scalar initializer. causing by {-1}.</p>\n"}, {"tags": ["c", "pointers", "stm32"], "comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565775665, "post_id": 57492079, "comment_id": 101454040, "body": "What is the type of <code>pLayerCfg.FBStartAdress</code>? Shouldn&#39;t it be a pointer? Why are you casting an address to become a <code>uint16_t</code> instead of a pointer?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565775934, "post_id": 57492079, "comment_id": 101454174, "body": "The framebuffer isn&#39;t &quot;16 bit&quot;, the framebuffer is an array of 16-bit integers. A good solution would be to make <code>FBStartAdress</code> a pointer to <code>uint16_t</code>, i.e. the type should be<code>uint16_t *</code>. Then you could make it point to the first element of the <code>framebuffer</code> array and not need any casting."}, {"owner": {"reputation": 11138, "user_id": 1015327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00d71e011fc61cad60c5ffc9bf48c5ef?s=128&d=identicon&r=PG", "display_name": "JimmyB", "link": "https://stackoverflow.com/users/1015327/jimmyb"}, "edited": false, "score": 0, "creation_date": 1565775963, "post_id": 57492079, "comment_id": 101454187, "body": "<code>(uint16_t)&amp;framebuffer;</code> tries to cast a <i>pointer</i> value (usually 32 or 64 bits wide) to a 16-bit integer..."}, {"owner": {"reputation": 1932, "user_id": 375666, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d33159b0c328adefa8e7cd2d6d814337?s=128&d=identicon&r=PG&f=1", "display_name": "Ahmed Saleh", "link": "https://stackoverflow.com/users/375666/ahmed-saleh"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565775983, "post_id": 57492079, "comment_id": 101454200, "body": "@Someprogrammerdude I can&#39;t change that, because it&#39;s a hardware accelerator and it should point to the address of the <code>framebuffer</code>"}, {"owner": {"reputation": 1932, "user_id": 375666, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d33159b0c328adefa8e7cd2d6d814337?s=128&d=identicon&r=PG&f=1", "display_name": "Ahmed Saleh", "link": "https://stackoverflow.com/users/375666/ahmed-saleh"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565776048, "post_id": 57492079, "comment_id": 101454242, "body": "@Lundin You are an embedded guy, that&#39;s STM32LTDC hardware layer, how would I configure it probably to point to at 16bit framebuffer ?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565776181, "post_id": 57492079, "comment_id": 101454322, "body": "When you do <code>(uint16_t)&amp;framebuffer</code> you cast the pointer to the type <code>uint16_t</code>. But the actual type of <code>FBStartAdress</code> <b><i>isn&#39;t</i></b> <code>uint16_t</code>. I&#39;m guessing you&#39;re confused because the array itself is an array of <code>uint16_t</code>. That doesn&#39;t mean &quot;pointers&quot; to it should be that type as well."}, {"owner": {"reputation": 1932, "user_id": 375666, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d33159b0c328adefa8e7cd2d6d814337?s=128&d=identicon&r=PG&f=1", "display_name": "Ahmed Saleh", "link": "https://stackoverflow.com/users/375666/ahmed-saleh"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565776248, "post_id": 57492079, "comment_id": 101454356, "body": "@Someprogrammerdude so how it should be ?  <code>(uint32_t)&amp;framebuffer</code>"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565776311, "post_id": 57492079, "comment_id": 101454392, "body": "Yes, or better yet (with the types you&#39;re supposedly forced to use) <code>(uint32_t) framebuffer</code>."}], "answers": [{"comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565776801, "post_id": 57492325, "comment_id": 101454640, "body": "It should be noted that there is a semantic difference between <code>&amp;framebuffer</code> and <code>&amp;framebuffer[0]</code> (which is what plain <code>framebuffer</code> will decay to). <code>&amp;framebuffer</code> is a pointer to the whole array, and its type is (in this case) <code>uint16_t (*)[76800]</code>. <code>&amp;framebuffer[0]</code> is a pointer to the first element, and its type is <code>uint16_t *</code>. What is typically wanted is a pointer to the first element only."}], "tags": [], "owner": {"reputation": 5360, "user_id": 9435815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xaQWU.jpg?s=128&g=1", "display_name": "r3mus n0x", "link": "https://stackoverflow.com/users/9435815/r3mus-n0x"}, "is_accepted": true, "score": 0, "last_activity_date": 1565776297, "creation_date": 1565776297, "answer_id": 57492325, "question_id": 57492079, "link": "https://stackoverflow.com/questions/57492079/casting-pointer-from-a-framebuffer-to-another-address/57492325#57492325", "title": "Casting pointer from a framebuffer to another address", "body": "<p>You are casting to the wrong type. If the <code>FBStartAdress</code> has type <code>uint32_t</code> then you should be casting to <code>uint32_t</code>:</p>\n\n<pre><code>pLayerCfg.FBStartAdress = (uint32_t)&amp;framebuffer;\n</code></pre>\n\n<p>If the compiler still gives you trouble you can cast it through the integer of the appropriate type like this:</p>\n\n<pre><code>pLayerCfg.FBStartAdress = (uint32_t)(uintptr_t) &amp;framebuffer;\n</code></pre>\n"}], "owner": {"reputation": 1932, "user_id": 375666, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d33159b0c328adefa8e7cd2d6d814337?s=128&d=identicon&r=PG&f=1", "display_name": "Ahmed Saleh", "link": "https://stackoverflow.com/users/375666/ahmed-saleh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "closed_date": 1565784650, "accepted_answer_id": 57492325, "answer_count": 1, "score": 0, "last_activity_date": 1565776297, "creation_date": 1565775440, "last_edit_date": 1565776001, "question_id": 57492079, "link": "https://stackoverflow.com/questions/57492079/casting-pointer-from-a-framebuffer-to-another-address", "closed_reason": "Needs details or clarity", "title": "Casting pointer from a framebuffer to another address", "body": "<p>I have a framebuffer or a bitmap that is 16 bit</p>\n\n<pre><code>uint16_t framebuffer[320*240];\n</code></pre>\n\n<p>I assign a framebuffer address to it</p>\n\n<pre><code>  pLayerCfg.FBStartAdress = (uint16_t)&amp;framebuffer;\n</code></pre>\n\n<p><code>FBStartadress</code> is   </p>\n\n<pre><code>uint32_t FBStartAdress;              /*!&lt; Configures the color frame buffer address */\n</code></pre>\n\n<p>cast from pointer to integer of different size </p>\n\n<p>I get the following error</p>\n"}, {"tags": ["c", "linux", "multithreading", "sockets", "pthreads"], "comments": [{"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "edited": false, "score": 0, "creation_date": 1565777054, "post_id": 57491719, "comment_id": 101454767, "body": "<a href=\"http://isvolatileusefulwiththreads.com/\" rel=\"nofollow noreferrer\">isvolatileusefulwiththreads.com</a>"}], "answers": [{"comments": [{"owner": {"reputation": 455, "user_id": 4899025, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGgvb.jpg?s=128&g=1", "display_name": "Ajith C Narayanan", "link": "https://stackoverflow.com/users/4899025/ajith-c-narayanan"}, "edited": false, "score": 0, "creation_date": 1565776154, "post_id": 57492110, "comment_id": 101454305, "body": "but i am printing the values only after completions of all the threads"}, {"owner": {"reputation": 479, "user_id": 4791150, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/kMDS5.png?s=128&g=1", "display_name": "elklepo", "link": "https://stackoverflow.com/users/4791150/elklepo"}, "reply_to_user": {"reputation": 455, "user_id": 4899025, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGgvb.jpg?s=128&g=1", "display_name": "Ajith C Narayanan", "link": "https://stackoverflow.com/users/4899025/ajith-c-narayanan"}, "edited": false, "score": 0, "creation_date": 1565788044, "post_id": 57492110, "comment_id": 101460311, "body": "@AjithCNarayanan I added more explanations."}], "tags": [], "owner": {"reputation": 479, "user_id": 4791150, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/kMDS5.png?s=128&g=1", "display_name": "elklepo", "link": "https://stackoverflow.com/users/4791150/elklepo"}, "is_accepted": true, "score": 1, "last_activity_date": 1565787958, "last_edit_date": 1565787958, "creation_date": 1565775545, "answer_id": 57492110, "question_id": 57491719, "link": "https://stackoverflow.com/questions/57491719/unexpected-behavior-of-threads/57492110#57492110", "title": "unexpected behavior of threads", "body": "<p>You're not synchronizing incrementations:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>param-&gt;c_created++;\n...\nparam-&gt;r_created++;\n...\nparam-&gt;c_response++;\n</code></pre>\n\n<p>Most probably, each of them is translated to more than one assembly instruction (<code>mov</code>, <code>inc/add</code>, <code>mov</code>). In my opinion you have problem with race conditions here.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Let's assume that increment operation was translated to following machine instructions:</p>\n\n<pre><code>mov eax, c_created \ninc eax\nmov c_created, eax\n</code></pre>\n\n<p>Now Imagine that two threads are executing those instructions in parallel and following execution order happened:</p>\n\n<pre><code>mov eax, c_created &lt;-- THREAD1 eax = &lt;initial&gt;c_created\ninc eax\nmov c_created, eax\n\nmov eax, c_created &lt;-- THREAD2 eax = &lt;initial&gt;c_created\ninc eax            &lt;-- THREAD1 eax = &lt;initial&gt;c_created + 1\nmov c_created, eax\n\nmov eax, c_created\ninc eax            &lt;-- THREAD2 eax = &lt;initial&gt;c_created + 1\nmov c_created, eax &lt;-- THREAD1 &lt;new&gt;c_created = &lt;initial&gt;c_created + 1\n\nmov eax, c_created\ninc eax\nmov c_created, eax &lt;-- THREAD2 &lt;new&gt;c_created = &lt;initial&gt;c_created + 1\n</code></pre>\n\n<p>Now You clearly see that there is a possibility that new value of <code>c_created</code> will be incremented by <code>1</code> instead of <code>2</code> event though both threads performed increment operation.</p>\n"}], "owner": {"reputation": 455, "user_id": 4899025, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGgvb.jpg?s=128&g=1", "display_name": "Ajith C Narayanan", "link": "https://stackoverflow.com/users/4899025/ajith-c-narayanan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 57492110, "answer_count": 1, "score": 0, "last_activity_date": 1565787958, "creation_date": 1565774284, "question_id": 57491719, "link": "https://stackoverflow.com/questions/57491719/unexpected-behavior-of-threads", "title": "unexpected behavior of threads", "body": "<p>I am writing a load testing HTTP client in C, A part of the code is given bellow,</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;arpa/inet.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;sched.h&gt;\n#include &lt;sys/time.h&gt;\n#include &lt;fcntl.h&gt;\n\ntypedef struct args_s {\n    volatile int t_requested;\n    volatile int t_created;\n    volatile int c_created;\n    volatile int r_created;\n    volatile int c_response;\n} args_t;\n\n#define HOST \"198.168.0.221\"\n\n#define CRLF \"\\r\\n\"\n\n#define REQUEST \"GET / HTTP/1.1\" CRLF \\\n        \"Host: 198.168.0.221\" CRLF \\\n        \"User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:31.0) Gecko/20100101 Firefox/31.0\" CRLF \\\n        \"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\" CRLF \\\n        \"Accept-Language: en-US,en;q=0.5\" CRLF \\\n        \"Accept-Encoding: gzip, deflate\" CRLF \\\n        \"Connection: keep-alive\" CRLF \\\n        CRLF\n\n\nstatic size_t socket_write(int sock_fd, char *buf, size_t size)\n{\n    size_t n, tot = 0;\n\n  again:\n    errno = 0;\n\n    if ((n = write(sock_fd, buf, size)) != -1) {\n    tot += n;\n    if (tot &lt; size) {\n        goto again;\n    }\n    if (tot == size) {\n        return size;\n    }\n    return -1;\n    }\n    if (errno == EINTR || errno == EAGAIN) {\n    goto again;\n    }\n    return -1;\n}\n\nstatic size_t socket_read(int sock_fd, char *buf, size_t size)\n{\n    size_t n;\n\n  again:\n    errno = 0;\n\n    if ((n = read(sock_fd, buf, size)) != -1) {\n    return n;\n    }\n    if (errno == EINTR || errno == EAGAIN) {\n    goto again;\n    }\n\n    return -1;\n}\n\nstatic void *client_thread(args_t * param)\n{\n    struct sockaddr_in addr = {\n    .sin_family = AF_INET,\n    .sin_port = htons(80),\n    .sin_addr.s_addr = inet_addr(HOST)\n    };\n    int sock_fd;\n    char res[4096];\n\n    unshare(CLONE_FILES);\n\n    if ((sock_fd = socket(AF_INET, SOCK_STREAM, 0)) == -1) {\n    return \"socket() failed\";\n    }\n\n    if (connect(sock_fd, (struct sockaddr *) &amp;addr, sizeof(addr)) == -1) {\n    close(sock_fd);\n    return \"connect() failed\";\n    }\n\n    if (fcntl(sock_fd, F_SETFL, O_NONBLOCK) == -1) {\n    close(sock_fd);\n    return \"cant make nonblock\";\n    }\n\n    param-&gt;c_created++;\n\n    if (socket_write(sock_fd, REQUEST, sizeof(REQUEST) - 1) !=\n    (sizeof(REQUEST) - 1)) {\n    close(sock_fd);\n    return \"write() failed\";\n    }\n\n    param-&gt;r_created++;\n\n    if (socket_read(sock_fd, res, 4096) == -1) {\n    close(sock_fd);\n    return \"read() failed\";\n    }\n\n    param-&gt;c_response++;\n    close(sock_fd);\n    return NULL;\n}\n\nvoid report_show(volatile args_t * param)\n{\n    printf(\"\\n\\nREPORTS\\n----------------------\\n\");\n    printf(\"Number of threads requested : %ld \\n\", param-&gt;t_requested);\n    printf(\"Number of threads created : %ld \\n\", param-&gt;t_created);\n    printf(\"Number of connections created : %ld \\n\", param-&gt;c_created);\n    printf(\"Number of requests sent : %ld \\n\", param-&gt;r_created);\n    printf(\"Number of response recieved : %ld \\n\", param-&gt;c_response);\n    printf(\"Number of response failed : %ld \\n\\n\",\n       param-&gt;r_created - param-&gt;c_response);\n}\n\n\nvoid timer()\n{\n    int i=0;\n    while(1) {\n    sleep(1);\n        printf(\"\\nTime taken : %d\\x1B[A\",i++);\n    }\n}\n\n\n\nint main()\n{\n    int pid,i;\n    char c;\n    char *ret;\n    static volatile args_t param;\n\n    param.t_requested = 30000;\n    pthread_t t[param.t_requested];\n    if(!(pid = fork())) {\n    timer();\n    exit(0);\n    }\n\n    for (i = 0; i &lt; param.t_requested; i++) {\n    if (pthread_create(&amp;t[i], NULL, client_thread, &amp;param) != 0) {\n        printf(\"thread creation failed\\n\");\n        return -1;\n    }\n    param.t_created++;\n    }\n\n    for (i = 0; i &lt; param.t_requested; i++) {\n    if(pthread_join(t[i], &amp;ret) != 0) {\n        printf(\"unable to join\\n\");\n        return -1;\n    }\n    if (ret != NULL) {\n        printf(\"%s\\n\", ret);\n        return -1;\n    }\n    }\n\n    kill(pid,SIGINT);\n    report_show(&amp;param);\n    return 0;\n}\n</code></pre>\n\n<p>When I run this code I am getting the output as bellow,</p>\n\n<pre><code>[ajith@localhost Pipe_Send_Recv_Capability_Test]$ ./a.out\n\nTime taken : 3\n\nREPORTS\n----------------------\nNumber of threads requested : 30000\nNumber of threads created : 30000\nNumber of connections created : 29983\nNumber of requests sent : 29997\nNumber of response recieved : 29988\nNumber of response failed : 9\n</code></pre>\n\n<p>Here, The connection created value (29983) is less than request sent value (29997). There is no way to happen this in the code. because whenever <code>param-&gt;r_created</code> got incremented <code>param-&gt;c_created</code> also incremented before it. Then why this is happening?</p>\n"}, {"tags": ["c", "gcc", "ld"], "comments": [{"owner": {"reputation": 5101, "user_id": 700170, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gZ8hw.png?s=128&g=1", "display_name": "Morten Jensen", "link": "https://stackoverflow.com/users/700170/morten-jensen"}, "edited": false, "score": 0, "creation_date": 1565778195, "post_id": 57491712, "comment_id": 101455365, "body": "I think the interesting part is what&#39;s in your makefile, i.e. how does the code get built"}, {"owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 0, "creation_date": 1565787177, "post_id": 57491712, "comment_id": 101459840, "body": "Please show us how you compile and build both libraries and the application."}], "owner": {"reputation": 705, "user_id": 2824661, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7c729d449a2941cd090ba3be630399db?s=128&d=identicon&r=PG", "display_name": "jugglingcats", "link": "https://stackoverflow.com/users/2824661/jugglingcats"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565774259, "creation_date": 1565774259, "question_id": 57491712, "link": "https://stackoverflow.com/questions/57491712/confusing-gcc-extern-symbol-linker-issue-using-static-libraries", "title": "Confusing gcc extern symbol linker issue using static libraries", "body": "<p>I have an app built using CMake that includes two static libs, called libA and libB.</p>\n\n<p>Static libA has a function defined:</p>\n\n<pre><code>void onData(char *msg) __attribute__((used));\n\nvoid onData(char *msg) {\n    printf(\"test: %s\\n\", msg);\n}\n</code></pre>\n\n<p>Static lib B has the following in <code>myfunc.c</code>:</p>\n\n<pre><code>extern void onData(char *msg);\n\nvoid myfunc() {\n    onData(\"hello\");\n}\n</code></pre>\n\n<p>The function <code>myfunc</code> is called by the main app, and I expect to see <code>test: hello</code> in stdout.</p>\n\n<p>Actually the app fails to link with:</p>\n\n<pre><code>libB.a(myfunc.c.o): In function `myfunc':\nmyfunc.c:10: undefined reference to `onData'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>I assumed this was to do with libA failing to include the <code>onData</code> symbol (since it's not being used by libA), hence the attempt to fix this with <code>__attribute__((used))</code>, but it doesn't seem to make a difference.</p>\n\n<p>Now... if I add some code in another function (<strong>within libA</strong>), for example:</p>\n\n<pre><code>extern void onData(char *msg);\n\nint main() {\n    printf(\"Location of onData: %p\", onData);\n}\n</code></pre>\n\n<p>Then the app links fine. So it is something to do with inclusion/exclusion of the code by gcc, but <code>objdump</code> and <code>nm</code> show the function is included in all scenarios!</p>\n\n<pre><code>$ nm libA.a\nondata.c:\n0000000000000000 T onData\n</code></pre>\n\n<p>Help much appreciated.</p>\n"}, {"tags": ["c", "windows", "io"], "comments": [{"owner": {"reputation": 6882, "user_id": 3403834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpA5S.jpg?s=128&g=1", "display_name": "user58697", "link": "https://stackoverflow.com/users/3403834/user58697"}, "edited": false, "score": 0, "creation_date": 1565819468, "post_id": 57491693, "comment_id": 101473984, "body": "Doesn&#39;t <code>&quot;rb+&quot;</code> do what you need?"}], "answers": [{"comments": [{"owner": {"reputation": 479, "user_id": 4791150, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/kMDS5.png?s=128&g=1", "display_name": "elklepo", "link": "https://stackoverflow.com/users/4791150/elklepo"}, "edited": false, "score": 0, "creation_date": 1565787086, "post_id": 57492512, "comment_id": 101459781, "body": "<code>fopen()</code> on Windows locks file by default, there is no need to call <code>flock()</code>, it does not even exist in stdlib on Windows."}, {"owner": {"reputation": 305, "user_id": 10120717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ab999de4cfcdc4f8934bd77e92eab02?s=128&d=identicon&r=PG&f=1", "display_name": "tscheppe", "link": "https://stackoverflow.com/users/10120717/tscheppe"}, "reply_to_user": {"reputation": 479, "user_id": 4791150, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/kMDS5.png?s=128&g=1", "display_name": "elklepo", "link": "https://stackoverflow.com/users/4791150/elklepo"}, "edited": false, "score": 0, "creation_date": 1565791593, "post_id": 57492512, "comment_id": 101462458, "body": "according to <a href=\"https://en.cppreference.com/w/c/io/freopen\" rel=\"nofollow noreferrer\">link</a> <code>freopen_s</code> closes an reopens the file and also releases and reaquires the the lock. Why don&#39;t you just open the file with write access if you know you are going to write on in?"}, {"owner": {"reputation": 479, "user_id": 4791150, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/kMDS5.png?s=128&g=1", "display_name": "elklepo", "link": "https://stackoverflow.com/users/4791150/elklepo"}, "edited": false, "score": 0, "creation_date": 1565792895, "post_id": 57492512, "comment_id": 101463167, "body": "besause, as I mentioned in third example, I&#39;m unable to read file content and fully rewrite it within single <code>fopen()</code>."}, {"owner": {"reputation": 305, "user_id": 10120717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ab999de4cfcdc4f8934bd77e92eab02?s=128&d=identicon&r=PG&f=1", "display_name": "tscheppe", "link": "https://stackoverflow.com/users/10120717/tscheppe"}, "reply_to_user": {"reputation": 479, "user_id": 4791150, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/kMDS5.png?s=128&g=1", "display_name": "elklepo", "link": "https://stackoverflow.com/users/4791150/elklepo"}, "edited": false, "score": 0, "creation_date": 1565947921, "post_id": 57492512, "comment_id": 101511036, "body": "@Klepak with the flag &quot;rb+&quot; you can read and write to the file. with &quot;ab+&quot; like you did you just append something. So you can try your third example with this flag. Another possibilty could be open it with &quot;rb+&quot; read everything, truncate the file <a href=\"http://man7.org/linux/man-pages/man2/truncate.2.html\" rel=\"nofollow noreferrer\">link</a> and the write on it."}], "tags": [], "owner": {"reputation": 305, "user_id": 10120717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ab999de4cfcdc4f8934bd77e92eab02?s=128&d=identicon&r=PG&f=1", "display_name": "tscheppe", "link": "https://stackoverflow.com/users/10120717/tscheppe"}, "is_accepted": false, "score": 0, "last_activity_date": 1565781357, "last_edit_date": 1565781357, "creation_date": 1565776940, "answer_id": 57492512, "question_id": 57491693, "link": "https://stackoverflow.com/questions/57491693/open-and-lock-file-for-read-and-write/57492512#57492512", "title": "Open and lock file for read and write", "body": "<p>According to this post -\n<a href=\"https://stackoverflow.com/questions/7573282/how-do-i-lock-files-using-fopen]\">How do I lock files using fopen()?</a> - <a href=\"https://linux.die.net/man/2/flock\" rel=\"nofollow noreferrer\">flock</a> may help you </p>\n"}], "owner": {"reputation": 479, "user_id": 4791150, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/kMDS5.png?s=128&g=1", "display_name": "elklepo", "link": "https://stackoverflow.com/users/4791150/elklepo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565781357, "creation_date": 1565774151, "last_edit_date": 1565774489, "question_id": 57491693, "link": "https://stackoverflow.com/questions/57491693/open-and-lock-file-for-read-and-write", "title": "Open and lock file for read and write", "body": "<p>I'd like to open file, read it's content and then fully override it. \nApart from that I'd like this file to be locked by process during whole procedure.\nThis is the idea I came with:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>fopen_s(&amp;fp, file_path, \"rb\");\n...\nfclose(fp);\nfopen_s(&amp;fp, file_path, \"wb+\");\n...\nfclose(fp);\n</code></pre>\n\n<p>But this solution generates small time window when file is not locked by process. That's the second idea:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>fopen_s(&amp;fp, file_path, \"rb\");\n...\nfreopen_s(&amp;fp, file_path, \"wb+\", fp);\n...\nfclose(fp);\n</code></pre>\n\n<p>Here, I could not find information whether <code>freopen_s</code> preserves file lock but I suppose that it does not.\nThird and last idea I came with is to open file in <code>ab+</code> mode:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>fopen_s(&amp;fp, file_path, \"ab+\");\n// read content\nfseek(fp, 0L, SEEK_END);\nlong file_size = ftell(fp);\nfseek(fp, 0L, SEEK_SET);\nfread(buffer, sizeof(char), file_size, fp);\n// TODO: override file\nfseek(fp, 0L, SEEK_SET);\nfwrite(\"hello\", 1, 5); // does not work - appends to end of file\nfclose(fp);\n</code></pre>\n\n<p>This solution has the best potential but I can't make it override file content in any way - every method that writes file content appends instead of writing to beggining.</p>\n\n<p>Is there any option to improve one of solution mentioned above or is there any other way to achieve my goal?\nNote that I'd not like to use WinAPI calls.</p>\n"}, {"tags": ["c", "loops", "date", "fgetc"], "comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565774189, "post_id": 57491653, "comment_id": 101453299, "body": "<a href=\"https://stackoverflow.com/questions/35356322/difference-between-int-and-char-in-getchar-fgetc-and-putchar-fputc\"><code>int ch</code></a>"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1565774283, "post_id": 57491653, "comment_id": 101453354, "body": "Don&#39;t use <a href=\"https://en.wikipedia.org/wiki/Magic_number_(programming)\" rel=\"nofollow noreferrer\"><i>magic numbers</i></a> like <code>0x0A</code>. If you mean a newline <code>&#39;\\n&#39;</code> then say so explicitly."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1565774335, "post_id": 57491653, "comment_id": 101453386, "body": "Also, calling <code>main</code> recursively is a <i>really bad</i> habit. Use real loops instead."}, {"owner": {"reputation": 33, "user_id": 11863548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36c74fdfee6301da3b0843314658df2d?s=128&d=identicon&r=PG&f=1", "display_name": "jadamian", "link": "https://stackoverflow.com/users/11863548/jadamian"}, "edited": false, "score": 0, "creation_date": 1565774455, "post_id": 57491653, "comment_id": 101453447, "body": "When i type date <code>20.12.2015</code> its ok, when i type <code>20.20.2015</code> output is correct, but when i type <code>a.a.a</code> im getting <code>Segmentation fault (core dumped)</code>"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 3, "creation_date": 1565774648, "post_id": 57491653, "comment_id": 101453559, "body": "You need to learn how to check function return values for error conditions. Most definitely you need to check what <a href=\"https://en.cppreference.com/w/c/io/fscanf#Return_value\" rel=\"nofollow noreferrer\"><code>scanf</code></a> returns. And to solve that crashing problem, consider using <a href=\"https://en.cppreference.com/w/c/io/fgets\" rel=\"nofollow noreferrer\"><code>fgets</code></a> in combination with <code>sscanf</code>."}, {"owner": {"reputation": 33, "user_id": 11863548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36c74fdfee6301da3b0843314658df2d?s=128&d=identicon&r=PG&f=1", "display_name": "jadamian", "link": "https://stackoverflow.com/users/11863548/jadamian"}, "edited": false, "score": 0, "creation_date": 1565777225, "post_id": 57491653, "comment_id": 101454855, "body": "So i have added <code>if(y&gt;=2015 &amp;&amp; y&lt;=3000)</code> before first <code>if</code> and it&#39;s working now...??"}, {"owner": {"reputation": 50126, "user_id": 1717300, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/81b91f602ce8acea8cbeb29f62725627?s=128&d=identicon&r=PG", "display_name": "hyde", "link": "https://stackoverflow.com/users/1717300/hyde"}, "edited": false, "score": 2, "creation_date": 1565781100, "post_id": 57491653, "comment_id": 101456781, "body": "Check <i>return value</i> of scanf. Handle errors. Then things might start making sense."}, {"owner": {"reputation": 33821, "user_id": 45685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y4RJr.jpg?s=128&g=1", "display_name": "AndersK", "link": "https://stackoverflow.com/users/45685/andersk"}, "edited": false, "score": 1, "creation_date": 1565781258, "post_id": 57491653, "comment_id": 101456863, "body": "another thing, u should have an else on your leap year check, otherwise if it once is set to 29 it will remain that way for all years."}, {"owner": {"reputation": 33821, "user_id": 45685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y4RJr.jpg?s=128&g=1", "display_name": "AndersK", "link": "https://stackoverflow.com/users/45685/andersk"}, "edited": false, "score": 0, "creation_date": 1565781350, "post_id": 57491653, "comment_id": 101456907, "body": "return main() is not a good practice. you already got a while loop. why not add one more and then make sure you empty the stdin before calling scanf"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1565835961, "post_id": 57491653, "comment_id": 101476935, "body": "OT: for ease of readability and understanding:  1) please consistently indent the code.  Indent after every opening brace &#39;{&#39;.  Unindent before every closing brace &#39;}&#39;.  Suggest each indent level be 4 spaces.  2) separate code blocks: <code>for</code> <code>else</code> <code>if</code> <code>while</code> <code>do...while</code> <code>switch</code> <code>case</code> <code>default</code> via a single blank line."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1565836044, "post_id": 57491653, "comment_id": 101476946, "body": "the posted code is missing the function: <code>main()</code> and missing the needed <code>#include</code> statements for the needed header files,"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1565836441, "post_id": 57491653, "comment_id": 101477013, "body": "regarding: <code>printf(&quot;Enter the date\\n&quot;);     scanf(&quot;%d.%d.%d&quot;,&amp;d,&amp;m,&amp;y);</code>  the prompt needs to specify the desired order (day, month, 4 digit year) because, a 2 digit year is not being allowed and (in America, the typical order is &#39;month day year&#39;) and the practice of placing a comma before the year is not being checked"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1565836602, "post_id": 57491653, "comment_id": 101477050, "body": "regarding: <code>return main();</code> NEVER call the function: main() in this manner.  The function <code>main()</code> is expecting certain parameters to be available that are not being setup in the posted code"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1565837439, "post_id": 57491653, "comment_id": 101477184, "body": "per the posted code, a user could enter a 0 or negative number for month and/or day and the code would accept it.  However, the result would be incorrect.  Suggest using <code>%u</code> for the input conversion specifiers for the call to <code>scanf()</code> and declaring the month and day and year variables as <code>unsigned int</code> rather than <code>int</code>"}, {"owner": {"reputation": 33, "user_id": 11863548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36c74fdfee6301da3b0843314658df2d?s=128&d=identicon&r=PG&f=1", "display_name": "jadamian", "link": "https://stackoverflow.com/users/11863548/jadamian"}, "edited": false, "score": 0, "creation_date": 1566212268, "post_id": 57491653, "comment_id": 101572447, "body": "Thanks for all that, but i still have problem with return of scanf values"}, {"owner": {"reputation": 33, "user_id": 11863548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36c74fdfee6301da3b0843314658df2d?s=128&d=identicon&r=PG&f=1", "display_name": "jadamian", "link": "https://stackoverflow.com/users/11863548/jadamian"}, "reply_to_user": {"reputation": 33821, "user_id": 45685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y4RJr.jpg?s=128&g=1", "display_name": "AndersK", "link": "https://stackoverflow.com/users/45685/andersk"}, "edited": false, "score": 0, "creation_date": 1566218306, "post_id": 57491653, "comment_id": 101575567, "body": "@Anders can you help me with that else for leap year?"}, {"owner": {"reputation": 33, "user_id": 11863548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36c74fdfee6301da3b0843314658df2d?s=128&d=identicon&r=PG&f=1", "display_name": "jadamian", "link": "https://stackoverflow.com/users/11863548/jadamian"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1566219322, "post_id": 57491653, "comment_id": 101576195, "body": "@Some programmer dude Could you explain to me how should i use <code>fgets   sscanf</code> here"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 11863548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36c74fdfee6301da3b0843314658df2d?s=128&d=identicon&r=PG&f=1", "display_name": "jadamian", "link": "https://stackoverflow.com/users/11863548/jadamian"}, "edited": false, "score": 0, "creation_date": 1566208836, "post_id": 57549610, "comment_id": 101570794, "body": "thanks for this answer, it will be helpful in the future"}, {"owner": {"reputation": 33, "user_id": 11863548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36c74fdfee6301da3b0843314658df2d?s=128&d=identicon&r=PG&f=1", "display_name": "jadamian", "link": "https://stackoverflow.com/users/11863548/jadamian"}, "edited": false, "score": 0, "creation_date": 1566286216, "post_id": 57549610, "comment_id": 101598005, "body": "Code works properly, but there is an error. When input is for example <code>a.b.c.</code> program is in endless loop"}, {"owner": {"reputation": 33, "user_id": 11863548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36c74fdfee6301da3b0843314658df2d?s=128&d=identicon&r=PG&f=1", "display_name": "jadamian", "link": "https://stackoverflow.com/users/11863548/jadamian"}, "edited": false, "score": 0, "creation_date": 1566289123, "post_id": 57549610, "comment_id": 101599436, "body": "I&#39;ve added this <code>system(&quot;clear&quot;); int ch = fgetc(stdin);if (ch == &#39;\\n&#39;){system(&quot;clear&quot;);printf(&quot;It&#39;s not a legitimate    date!\\n&quot;);fflush(stdin);return 1;}</code> in <code>if (res!=3)</code>"}, {"owner": {"reputation": 492, "user_id": 11943877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24f69b67cf13b3b83add3f3f2b56b176?s=128&d=identicon&r=PG&f=1", "display_name": "Sergey", "link": "https://stackoverflow.com/users/11943877/sergey"}, "reply_to_user": {"reputation": 33, "user_id": 11863548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36c74fdfee6301da3b0843314658df2d?s=128&d=identicon&r=PG&f=1", "display_name": "jadamian", "link": "https://stackoverflow.com/users/11863548/jadamian"}, "edited": false, "score": 1, "creation_date": 1566320252, "post_id": 57549610, "comment_id": 101616715, "body": "Perfect! You caught me. But I still think that it is not necessary to check the value of <code>ch</code>. Please see update #2."}], "tags": [], "owner": {"reputation": 492, "user_id": 11943877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24f69b67cf13b3b83add3f3f2b56b176?s=128&d=identicon&r=PG&f=1", "display_name": "Sergey", "link": "https://stackoverflow.com/users/11943877/sergey"}, "is_accepted": true, "score": 1, "last_activity_date": 1566319695, "last_edit_date": 1566319695, "creation_date": 1566178622, "answer_id": 57549610, "question_id": 57491653, "link": "https://stackoverflow.com/questions/57491653/loop-back-after-wrong-input-problem-with-fgetcstdin-and-loop/57549610#57549610", "title": "Loop back after wrong input, problem with fgetc(stdin) and loop", "body": "<p>If you have an appropriate code in the function <code>void main()</code> and need to repeat it in a cycle as you describe you can do the following:</p>\n\n<ol>\n<li>rename original <code>void main()</code> to <code>int one_step()</code></li>\n<li>put <code>return 0;</code> after <code>printf(\"It is a legitimate date!\\n\");</code></li>\n<li>put <code>return 1;</code> after <code>printf(\"It's not a legitimate date!\\n\");</code></li>\n<li>create the new <code>void main()</code> function as:</li>\n</ol>\n\n<pre><code>void main() {\n    while(one_step());\n}\n</code></pre>\n\n<p>You do not need <code>break;</code> and <code>return main();</code>. You may need some enhancements as described in the comments above. Good luck in coding!</p>\n\n<p><b>UPDATE #1</b><br><br>\nI meant such an improvement of your code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint fdateCheck();\n\nint main()\n{\n    while (fdateCheck());\n}\n\nint fdateCheck()\n{\nint res;\nint legit = 0;\nunsigned int d,m,y;\nunsigned int daysinmonth[12]={31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};\n\n    // get input block\n    printf(\"Enter the date\\n\");         // prompt for data\n    res = scanf(\"%u.%u.%u\",&amp;d,&amp;m,&amp;y);   // get input data\n    if (res == EOF) {                   // check if no more input\n            printf(\"Input error\\n\");\n            exit(1);\n    }\n    // check if input data is valid\n    if (res != 3) {                     // check if 3 numbers scanned\n            system(\"clear\");\n            printf(\"It is not a date\\n\");\n            fflush(stdin);\n            return 1;\n    }\n    // make leap year correction\n    if (y % 400 == 0 || (y % 100 != 0 &amp;&amp; y % 4 == 0)) {\n        daysinmonth[1]=29;              // leap year correction\n    }\n    // check if year, month and day is valid\n    if (y &gt;= 2015 &amp;&amp; y &lt;= 3000) {       // check if year in this range\n        if (0 &lt; m &amp;&amp; m &lt; 13) {          // check if month in this range\n            if (0 &lt; d &amp;&amp; d &lt;= daysinmonth[m-1]) // check if day in this range\n                legit = 1;\n        }\n    }\n    // print a message and finish the iteration\n    if (legit == 1) {\n        printf(\"It is a legitimate date!\\n\");\n        return 0;\n    }\n    else {\n        system(\"clear\");\n        printf(\"It's not a legitimate date!\\n\");\n        printf(\"Please retry.\\n\");\n        fflush(stdin);\n        return 1;\n    }\n}\n</code></pre>\n\n<p>I also moved all variables inside the function. This will restore values of <code>legit</code> and <code>daysinmonth[1]</code> before each iteration.</p>\n\n<p><b>UPDATE #2</b><br><br>\nMy next proposal:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint fdateCheck();\n\nint main()\n{\n    while (fdateCheck());\n}\n\nint fdateCheck()\n{\nint res;\nint legit = 0;\nunsigned int d,m,y;\nunsigned int daysinmonth[12]={31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};\n\n    // get input block\n    printf(\"Enter the date\\n\");         // prompt for data\n    res = scanf(\"%u.%u.%u\",&amp;d,&amp;m,&amp;y);   // get input data\n    if (res == EOF) {                   // check if no more input\n            printf(\"Input error\\n\");\n            exit(1);\n    }\n    // check if input data is valid\n    if (res != 3) {                     // check if 3 numbers scanned\n            fgetc(stdin);               // remove a barrier\n            system(\"clear\");\n            printf(\"It is not a date\\n\");\n            fflush(stdin);\n            return 1;\n    }\n    // make leap year correction\n    if (y % 400 == 0 || (y % 100 != 0 &amp;&amp; y % 4 == 0)) {\n        daysinmonth[1]=29;              // leap year correction\n    }\n    // check if year, month and day is valid\n    if (y &gt;= 2015 &amp;&amp; y &lt;= 3000) {       // check if year in this range\n        if (0 &lt; m &amp;&amp; m &lt; 13) {          // check if month in this range\n            if (0 &lt; d &amp;&amp; d &lt;= daysinmonth[m-1]) // check if day in this range\n                legit = 1;\n        }\n    }\n    // print a message and finish the iteration\n    if (legit == 1) {\n        printf(\"It is a legitimate date!\\n\");\n        return 0;\n    }\n    else {\n        system(\"clear\");\n        printf(\"It's not a legitimate date!\\n\");\n        printf(\"Please retry.\\n\");\n        fflush(stdin);\n        return 1;\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 11863548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36c74fdfee6301da3b0843314658df2d?s=128&d=identicon&r=PG&f=1", "display_name": "jadamian", "link": "https://stackoverflow.com/users/11863548/jadamian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 57549610, "answer_count": 1, "score": 1, "last_activity_date": 1566319695, "creation_date": 1565774027, "last_edit_date": 1566208739, "question_id": 57491653, "link": "https://stackoverflow.com/questions/57491653/loop-back-after-wrong-input-problem-with-fgetcstdin-and-loop", "title": "Loop back after wrong input, problem with fgetc(stdin) and loop", "body": "<p>So i have this simple code that i've found <a href=\"https://stackoverflow.com/questions/14950012/a-c-program-to-check-if-the-entered-date-is-valid-or-not\">here</a>. I want to make it work in a loop. I've tried couple of times with diffrent methods but output is bad. Working in Ubuntu Visual Studio</p>\n\n<p><strong>EDIT</strong> I've added <code>if(y&gt;=2015 &amp;&amp; y&lt;=3000)</code> and it is working properly?</p>\n\n<p><strong>EDIT 2</strong> I've modified my code and followed @Sergey advice... It is still not working properly...\nI've tried to add \"Check return value of scanf\" but it is also not working.</p>\n\n<pre><code>        if ((scanf(\"%u\", &amp;d) == 1) &amp;&amp; (scanf(\"%u\", &amp;m) == 1) &amp;&amp; (scanf(\"%u\", &amp;y) == 1))\n            while (fdateCheck());\n        else\n    //...EOF or conversion failure...\n            while (fdateCheck());\n</code></pre>\n\n<p>or</p>\n\n<pre><code>while ((rc = scanf(\"%u.%u.%u\", &amp;d, &amp;m, &amp;y)) != EOF)\n{\n    if (rc != 3)\n        //...oops data problems...\n    else\n        //...all OK...\n}\n</code></pre>\n\n<p>Need advice about checking return of scanfs</p>\n\n<pre><code>int fdateCheck();\n\nunsigned int d,m,y;\nunsigned int daysinmonth[12]={31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};\nint rc;\nint legit = 0;\n\nint main()\n    {\n        printf(\"Enter the date\\n\");\n        scanf(\"%u.%u.%u\",&amp;d,&amp;m,&amp;y);\n        while (fdateCheck());\n    }\nint fdateCheck()\n    {   \n        if (y % 400 == 0 || (y % 100 != 0 &amp;&amp; y % 4 == 0))\n            {\n                daysinmonth[1]=29;\n            }\n            else if (y &gt;= 2015 &amp;&amp; y &lt;= 3000)\n                {\n                    if (m &lt; 13)\n                        {\n                            if (d &lt;= daysinmonth[m-1])\n                            legit = 1;\n                        }\n\n                    if (legit == 1)\n                        {\n                            system(\"clear\");  \n                            printf(\"It is a legitimate date!\\n\");\n                            return 0;\n                        }\n                }\n            else\n                system(\"clear\");     \n                int ch = fgetc(stdin);\n                if (ch == '\\n')\n                    {\n                        system(\"clear\");\n                        printf(\"It's not a legitimate date!\\n\");\n                        printf(\"\\nRetry: \");\n                        return 1;\n                    }\n                fflush(stdin);\n    }\n\n</code></pre>\n"}, {"tags": ["c", "obs"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 1, "creation_date": 1565772733, "post_id": 57491137, "comment_id": 101452603, "body": "<i>&quot;I&#39;m not very experienced in C++&quot;</i> Standard c++ doesn&#39;t have any notion of image processing or graphics. You probably need some 3rd party stuff to handle that."}, {"owner": {"reputation": 118, "user_id": 9134198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f03e97add71a53fed1bdd30f943c31fc?s=128&d=identicon&r=PG&f=1", "display_name": "Cubimon", "link": "https://stackoverflow.com/users/9134198/cubimon"}, "edited": false, "score": 0, "creation_date": 1565772874, "post_id": 57491137, "comment_id": 101452681, "body": "What do you want to achieve? You can stream to a local RTMP server and extract images on the fly with another application. On linux based file system you can try to open the video file that obs writes to."}, {"owner": {"reputation": 1933, "user_id": 804969, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/99efaca7778f52c36708f29aa44b1340?s=128&d=identicon&r=PG", "display_name": "enne87", "link": "https://stackoverflow.com/users/804969/enne87"}, "reply_to_user": {"reputation": 118, "user_id": 9134198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f03e97add71a53fed1bdd30f943c31fc?s=128&d=identicon&r=PG&f=1", "display_name": "Cubimon", "link": "https://stackoverflow.com/users/9134198/cubimon"}, "edited": false, "score": 0, "creation_date": 1565773027, "post_id": 57491137, "comment_id": 101452758, "body": "@Cubimon Please see my updated description."}, {"owner": {"reputation": 118, "user_id": 9134198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f03e97add71a53fed1bdd30f943c31fc?s=128&d=identicon&r=PG&f=1", "display_name": "Cubimon", "link": "https://stackoverflow.com/users/9134198/cubimon"}, "edited": false, "score": 0, "creation_date": 1565774011, "post_id": 57491137, "comment_id": 101453205, "body": "@enne87 do you want each frame on disk or in ram? On disk would fill your disk really fast and requires lot of space and bandwidth if even possible. What are your realtime requirements, you may be interested in some lower level apis that obs use. Otherwise try to get the video from filesystem on linux/try to use the rtmp stream that obs offers."}, {"owner": {"reputation": 1933, "user_id": 804969, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/99efaca7778f52c36708f29aa44b1340?s=128&d=identicon&r=PG", "display_name": "enne87", "link": "https://stackoverflow.com/users/804969/enne87"}, "reply_to_user": {"reputation": 118, "user_id": 9134198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f03e97add71a53fed1bdd30f943c31fc?s=128&d=identicon&r=PG&f=1", "display_name": "Cubimon", "link": "https://stackoverflow.com/users/9134198/cubimon"}, "edited": false, "score": 0, "creation_date": 1565775116, "post_id": 57491137, "comment_id": 101453787, "body": "@Cubimon I just need the last 20 frames, olders will be removed. So disk space is no mattere here. My only requirement is that the frames have to be in the best possible quality. Another possibilty would be to extract the frames out of the mp4 that OBS fills during runtime. Is this probably possible with ffmpeg?"}, {"owner": {"reputation": 118, "user_id": 9134198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f03e97add71a53fed1bdd30f943c31fc?s=128&d=identicon&r=PG&f=1", "display_name": "Cubimon", "link": "https://stackoverflow.com/users/9134198/cubimon"}, "edited": false, "score": 0, "creation_date": 1565776378, "post_id": 57491137, "comment_id": 101454429, "body": "@enne87 mp4 quality varies with video bitrate - if you want best quality you should care for this. OBS has a replay buffer that saves the last x seconds as video file on disk, like a car dash cam/nvidia instant replay - is this your use case? Do you need at every point of time the most recent 20 frames? You can use ffmpeg to extract images from a video, but as I said this doesn&#39;t work with all filesystems. On windows the file is blocked from access for other applications until obs closes the file. For a side project I once used gstreamer/ximagesrc on linux with opencv to access the screen."}, {"owner": {"reputation": 1933, "user_id": 804969, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/99efaca7778f52c36708f29aa44b1340?s=128&d=identicon&r=PG", "display_name": "enne87", "link": "https://stackoverflow.com/users/804969/enne87"}, "reply_to_user": {"reputation": 118, "user_id": 9134198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f03e97add71a53fed1bdd30f943c31fc?s=128&d=identicon&r=PG&f=1", "display_name": "Cubimon", "link": "https://stackoverflow.com/users/9134198/cubimon"}, "edited": false, "score": 0, "creation_date": 1565777248, "post_id": 57491137, "comment_id": 101454866, "body": "@Cubimon Yes I need the most recent 20 frames at every point of time. A big hack but I would be fine with it: Is it possible to save every frame as mp4 in OBS and convert it to an image with ffmpeg? And by the way: Is it possible in Linux to access the mp4 while it is being created?"}, {"owner": {"reputation": 118, "user_id": 9134198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f03e97add71a53fed1bdd30f943c31fc?s=128&d=identicon&r=PG&f=1", "display_name": "Cubimon", "link": "https://stackoverflow.com/users/9134198/cubimon"}, "edited": false, "score": 0, "creation_date": 1565778845, "post_id": 57491137, "comment_id": 101455693, "body": "@enne87 I don&#39;t think you can save every image as a video file lol. But on Linux you should be able to read the video file while OBS writes into it. Performance may be bad though. But when you are on Linux/X11 you may also take a look at gstreamer/ximagesrc/opencv. But I guess there are also many other ways."}, {"owner": {"reputation": 1933, "user_id": 804969, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/99efaca7778f52c36708f29aa44b1340?s=128&d=identicon&r=PG", "display_name": "enne87", "link": "https://stackoverflow.com/users/804969/enne87"}, "reply_to_user": {"reputation": 118, "user_id": 9134198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f03e97add71a53fed1bdd30f943c31fc?s=128&d=identicon&r=PG&f=1", "display_name": "Cubimon", "link": "https://stackoverflow.com/users/9134198/cubimon"}, "edited": false, "score": 0, "creation_date": 1565783953, "post_id": 57491137, "comment_id": 101458167, "body": "@Cubimon Alright I&#39;ll have a look at this, thank you very much for your support :)"}], "owner": {"reputation": 1933, "user_id": 804969, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/99efaca7778f52c36708f29aa44b1340?s=128&d=identicon&r=PG", "display_name": "enne87", "link": "https://stackoverflow.com/users/804969/enne87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 317, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1565773006, "creation_date": 1565772169, "last_edit_date": 1565773006, "question_id": 57491137, "link": "https://stackoverflow.com/questions/57491137/obs-capture-frames-when-recording-screen", "title": "OBS - Capture frames when recording screen", "body": "<p>I'd like to record my whole screen and create images of each frame on the fly in OBS. I would like to record a third-party stream which I receive via web socket and want to extract each frame of the stream during run-time.</p>\n\n<p>I already have a solid overview of the source code (<a href=\"https://github.com/obsproject/obs-studio\" rel=\"nofollow noreferrer\">https://github.com/obsproject/obs-studio</a>) but still have no clue where I should adapt the code.</p>\n\n<p>In the graphics.c file there is this gs_draw_sprite() method which takes the sprite holding the frame and renders it accordingly:</p>\n\n<pre><code>void gs_draw_sprite(gs_texture_t *tex, uint32_t flip, uint32_t width,\n        uint32_t height)\n{\n   graphics_t *graphics = thread_graphics;\n   float fcx, fcy;\n   struct gs_vb_data *data;\n\n   fcx = width ? (float)width : (float)gs_texture_get_width(tex);\n   fcy = height ? (float)height : (float)gs_texture_get_height(tex);\n\n   data = gs_vertexbuffer_get_data(graphics-&gt;sprite_buffer);\n   if (tex &amp;&amp; gs_texture_is_rect(tex))\n    build_sprite_rect(data, tex, fcx, fcy, flip);\n   else\n    build_sprite_norm(data, fcx, fcy, flip);\n\n   gs_vertexbuffer_flush(graphics-&gt;sprite_buffer);\n   gs_load_vertexbuffer(graphics-&gt;sprite_buffer);\n   gs_load_indexbuffer(NULL);\n\n   gs_draw(GS_TRISTRIP, 0, 0);\n}\n</code></pre>\n\n<p>Is there a way to take this sprite and render it to a bitmap? I'm not very experienced in C, unfortunately.</p>\n"}, {"tags": ["c", "linux", "multithreading", "gcc"], "comments": [{"owner": {"reputation": 186, "user_id": 4446393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a28f271bd64ad2a1d210b540cf1df19?s=128&d=identicon&r=PG&f=1", "display_name": "flott", "link": "https://stackoverflow.com/users/4446393/flott"}, "edited": false, "score": 0, "creation_date": 1565772446, "post_id": 57491133, "comment_id": 101452455, "body": "From the GCC docs: &quot;Note that the \u2018__atomic\u2019 builtins assume that programs will conform to the C++11 memory model. In particular, they assume that programs are free of data races. See the C++11 standard for detailed requirements.&quot;"}, {"owner": {"reputation": 816, "user_id": 6093696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/991ce77dfa46d45f5301c0e29a8be248?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/6093696/eric"}, "edited": false, "score": 0, "creation_date": 1565776742, "post_id": 57491133, "comment_id": 101454604, "body": "I <i>think</i> you might have a data race but someone more knowledgeable in C could confirm this. Your <code>init()</code> function issues a plain write to <code>G_log_buffer.input_level</code>. You should make the write atomic. On the other hand, I <i>think</i> <code>pthread_create()</code> contains the necessary memory barriers to synchronize the write with later reads."}, {"owner": {"reputation": 32308, "user_id": 20270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37335856df5e5e73d82bca5a805bd647?s=128&d=identicon&r=PG", "display_name": "Hasturkun", "link": "https://stackoverflow.com/users/20270/hasturkun"}, "edited": false, "score": 1, "creation_date": 1565785057, "post_id": 57491133, "comment_id": 101458697, "body": "There&#39;s a window of opportunity between your checking of the input level and acquiring the mutex. This means that reading <code>LOG_BUFFER_INPUT_LEVEL_DEFAULT</code> only means the mutex wasn&#39;t locked yet at that time, and not that it won&#39;t be locked at the next instant. Maybe try using <code>pthread_mutex_trylock</code> and rechecking the level if it fails?"}, {"owner": {"reputation": 816, "user_id": 6093696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/991ce77dfa46d45f5301c0e29a8be248?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/6093696/eric"}, "edited": false, "score": 0, "creation_date": 1565790962, "post_id": 57491133, "comment_id": 101462088, "body": "Instead of relying on raising and lowering the level and aborting if the level is raised, why not just use <code>pthread_mutex_timedlock()</code> to make sure the business thread is not blocked too long?"}, {"owner": {"reputation": 169, "user_id": 4626178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bb0d46f8500a4db03d0609b585e4c?s=128&d=identicon&r=PG&f=1", "display_name": "Papillon", "link": "https://stackoverflow.com/users/4626178/papillon"}, "reply_to_user": {"reputation": 816, "user_id": 6093696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/991ce77dfa46d45f5301c0e29a8be248?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/6093696/eric"}, "edited": false, "score": 1, "creation_date": 1565828011, "post_id": 57491133, "comment_id": 101475646, "body": "Hi @Eric the <code>init()</code> function is called at the beginning of <code>main()</code>, where other threads are not created yet. It is safe to use a plain write there."}, {"owner": {"reputation": 169, "user_id": 4626178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bb0d46f8500a4db03d0609b585e4c?s=128&d=identicon&r=PG&f=1", "display_name": "Papillon", "link": "https://stackoverflow.com/users/4626178/papillon"}, "reply_to_user": {"reputation": 816, "user_id": 6093696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/991ce77dfa46d45f5301c0e29a8be248?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/6093696/eric"}, "edited": false, "score": 1, "creation_date": 1565828247, "post_id": 57491133, "comment_id": 101475681, "body": "@Eric the design is to use <code>pthread_mutex_timedlock()</code>, but here I just want to show the problem of atomic functions. If the protection to <code>input_level</code> works, business thread won&#39;t even have an opportunity to lock <code>log_buffer_lock</code>."}, {"owner": {"reputation": 169, "user_id": 4626178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bb0d46f8500a4db03d0609b585e4c?s=128&d=identicon&r=PG&f=1", "display_name": "Papillon", "link": "https://stackoverflow.com/users/4626178/papillon"}, "reply_to_user": {"reputation": 32308, "user_id": 20270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37335856df5e5e73d82bca5a805bd647?s=128&d=identicon&r=PG", "display_name": "Hasturkun", "link": "https://stackoverflow.com/users/20270/hasturkun"}, "edited": false, "score": 0, "creation_date": 1566029860, "post_id": 57491133, "comment_id": 101534158, "body": "Hi @Hasturkun thank you for your suggestion. I think this can be a workaround. A true fix is more appreciated."}], "answers": [{"tags": [], "owner": {"reputation": 169, "user_id": 4626178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bb0d46f8500a4db03d0609b585e4c?s=128&d=identicon&r=PG&f=1", "display_name": "Papillon", "link": "https://stackoverflow.com/users/4626178/papillon"}, "is_accepted": false, "score": 1, "last_activity_date": 1566267628, "last_edit_date": 1566267628, "creation_date": 1566267036, "answer_id": 57565877, "question_id": 57491133, "link": "https://stackoverflow.com/questions/57491133/gcc-built-in-atomic-or-sync-functions-cannot-provide-consistent-access-to-a/57565877#57565877", "title": "gcc built-in __atomic or __sync functions cannot provide consistent access to a global variable", "body": "<p>Thank you everyone for your comments.</p>\n\n<p>When I created 2 business threads, even binary semaphore and mutex cannot guarantee no timeout. After adding log before and after locking/unlocking the <code>log_buffer_lock</code>, I found the reason:</p>\n\n<pre><code># prefix B = business thread, 155 and 156 below; L = log collecting thread, 154 below.\n# first column is sequence.\n1D &lt;00:24:49.617510&gt; tid 156; B will lock.   # at this time, input level is 2\n1E &lt;00:24:49.617995&gt; tid 155; B will unlock.\n1F &lt;00:24:49.617998&gt; tid 154; L will lock.   # log collecting thread acquired mutex, even thread 156 waits first.\n20 &lt;00:24:49.618004&gt; tid 154; L locked.\n21 &lt;00:24:49.618005&gt; tid 155; B unlocked.\n22 &lt;00:24:49.719956&gt; tid 154; L will unlock.\n23 &lt;00:24:49.719974&gt; tid 154; L unlocked.\n24 &lt;00:24:49.720066&gt; tid 155; B locked without waiting.\n25 &lt;00:24:49.721051&gt; tid 155; B will unlock.\n26 &lt;00:24:49.721065&gt; tid 155; B unlocked.\n27 &lt;00:24:49.721069&gt; tid 156; B locked.      # finally thread 156 got the mutex.\n28 &lt;00:24:49.721073&gt; tid 155; B will lock.\n29 &lt;00:24:49.721538&gt; tid 156; B will unlock.\n2A &lt;00:24:49.721561&gt; tid 156; B unlocked.\n2B &lt;00:24:49.721644&gt; tid 155; B locked.\n2C &lt;00:24:49.722047&gt; tid 155; B will unlock.\n2D &lt;00:24:49.722083&gt; tid 155; B unlocked.\n2E &lt;00:24:49.722093&gt; tid 155; B locked without waiting.\n2F &lt;00:24:49.722119&gt; tid 156; ***** Business delayed 1 time(s)! *****\n</code></pre>\n\n<p>When there are >= 2 threads waiting for the same mutex, it cannot be determined that which will get the mutex first, regardless of its priority (I tried to set business thread's scheduling policy to REALTIME and priority to 99. This did not mitigate.) If <code>log_buffer_lock</code> is acquired by business thread 155, and both business thread 156 and log collecting thread are waiting, kernel may give the mutex to log collecting thread after it is released. In such situation, business thread 156 is starved and times out.</p>\n\n<p>@Hasturkun you are right, there is a window between checking of the input level and acquiring the mutex.</p>\n\n<ul>\n<li>When there is only ONE business thread, using <code>pthread_mutex_trylock()</code> and rechecking the input level if it fails will work, because if <code>pthread_mutex_trylock()</code> fails, we can 100% sure it is aqcuired by log collecting thread.</li>\n<li>When there are >= 2 business threads, this will not work, because <code>log_buffer_lock</code> may be not only acquired by log collecting thread, but also by another business thread.</li>\n</ul>\n\n<p>So this issue is not strong relevant to gcc builtin atomic functions. To fix it, <code>pthread_mutex_timedlock()</code> is inevitable. Using the following <code>write_log()</code> function, timeout did not happen for 1h even with no protection to <code>input_level</code>.</p>\n\n<pre><code>    static void write_log(int severity)\n    {\n        static unsigned int count = 0;\n        struct timeval      start, end;\n\n        gettimeofday(&amp;start, NULL);\n\n        if (severity &lt; get_input_level()) return;  // abort\n\n        #if BUSINESS_THREADS_COUNT == 1\n        if (0 != pthread_mutex_trylock(&amp;G_log_buffer_desc.log_buffer_lock))\n        {\n            // `log_buffer_lock` is 100% acquired by log collecting thread.\n            if (severity &lt; get_input_level()) return;  // abort\n            else {\n                papillon_log(\"B will lock.\\n\");\n                pthread_mutex_lock(&amp;G_log_buffer_desc.log_buffer_lock);\n                papillon_log(\"B locked.\\n\");\n            }\n        }\n        else papillon_log(\"B locked without waiting.\\n\");\n        #else\n        // When there are &gt;= 2 business threads, testing `log_buffer_lock` will not work, because it may be not only acquired by log collecting thread, but also by another business thread.\n        struct timespec wait_time;\n        clock_gettime(CLOCK_REALTIME , &amp;wait_time);\n        wait_time.tv_nsec += (TIMEOUT_MS / 10) * 1000;  // in ns\n        papillon_log(\"B will lock.\\n\");\n        if (0 != pthread_mutex_timedlock(&amp;G_log_buffer_desc.log_buffer_lock, &amp;wait_time)) return;  // abort\n        papillon_log(\"B locked.\\n\");\n        #endif  /* BUSINESS_THREADS_COUNT */\n\n        usleep(100);  // to simulate writing to the log buffer\n        papillon_log(\"B will unlock.\\n\");\n        pthread_mutex_unlock(&amp;G_log_buffer_desc.log_buffer_lock);\n        papillon_log(\"B unlocked.\\n\");\n\n        gettimeofday(&amp;end, NULL);\n        int diff = (end.tv_sec - start.tv_sec) * 1000 + (end.tv_usec - start.tv_usec) / 1000;  // in ms\n        if (diff &gt;= TIMEOUT_MS) papillon_log(\"***** Business delayed %u time(s)! *****\\n\", ++count);\n    }\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 4626178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c5bb0d46f8500a4db03d0609b585e4c?s=128&d=identicon&r=PG&f=1", "display_name": "Papillon", "link": "https://stackoverflow.com/users/4626178/papillon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566267628, "creation_date": 1565772156, "last_edit_date": 1565772680, "question_id": 57491133, "link": "https://stackoverflow.com/questions/57491133/gcc-built-in-atomic-or-sync-functions-cannot-provide-consistent-access-to-a", "title": "gcc built-in __atomic or __sync functions cannot provide consistent access to a global variable", "body": "<p>I have a global integer (<code>input_level</code> field of <code>struct LogBufferDescriptor</code> in the program below) which will be written by a thread, and read by more than 1 thread(s). I use gcc built-in <code>__atomic_store_n()</code> / <code>__atomic_load_n()</code> functions or legacy <code>__sync_lock_test_and_set()</code> / <code>__sync_fetch_and_add()</code> functions to access it. But neither can provide consistent result.</p>\n\n<p>Neither gcc built-in __atomic functions nor legacy __sync functions can provide consistent access to the integer. Current, only semaphore and pthread_mutex works OK.</p>\n\n<pre><code>/*\ngcc -g -o simulate_case simulate_case.c -lpthread\n*/\n\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/time.h&gt;\n#include &lt;semaphore.h&gt;\n\n#define LOG_BUFFER_INPUT_LEVEL_DEFAULT     2\n#define LOG_BUFFER_INPUT_LEVEL_NO_PRINTS   6\n#define MS_TO_US(ms)                ((ms) * 1000)\n#define TIMEOUT_MS                  100\n#define SYNC_GCC_SYNC\n\n\ntypedef struct LogBufferDescriptor\n{\n    int                          input_level;\n    pthread_mutex_t              log_buffer_lock;\n    pthread_mutex_t              input_level_lock;\n    sem_t                        input_level_sem;\n} LogBufferDescriptor;\n\nstatic LogBufferDescriptor       G_log_buffer;\n\n\n/********** choose one implementation by defining corresponding macro ***********/\n\n#ifdef SYNC_NONE\nstatic void print_sync_mechanism(void)\n{\n    printf(\"Sync mechanism = NONE\\n\");\n}\nstatic void set_input_level(int level)\n{\n    G_log_buffer.input_level = level;\n}\nstatic int get_input_level(void)\n{\n    return G_log_buffer.input_level;\n}\n#endif\n\n#ifdef SYNC_GCC_MUTEX\nstatic void print_sync_mechanism(void)\n{\n    printf(\"Sync mechanism = MUTEX\\n\");\n}\nstatic void set_input_level(int level)\n{\n    pthread_mutex_lock(&amp;G_log_buffer.input_level_lock);\n    G_log_buffer.input_level = level;\n    pthread_mutex_unlock(&amp;G_log_buffer.input_level_lock);\n}\nstatic int get_input_level(void)\n{\n    int level;\n    pthread_mutex_lock(&amp;G_log_buffer.input_level_lock);\n    level = G_log_buffer.input_level;\n    pthread_mutex_unlock(&amp;G_log_buffer.input_level_lock);\n    return level;\n}\n#endif\n\n#ifdef SYNC_SEM\nstatic void print_sync_mechanism(void)\n{\n    printf(\"Sync mechanism = semaphore\\n\");\n}\nstatic void set_input_level(int level)\n{\n    sem_wait(&amp;G_log_buffer.input_level_sem);\n    G_log_buffer.input_level = level;\n    sem_post(&amp;G_log_buffer.input_level_sem);\n}\nstatic int get_input_level(void)\n{\n    int level;\n    sem_wait(&amp;G_log_buffer.input_level_sem);\n    level = G_log_buffer.input_level;\n    sem_post(&amp;G_log_buffer.input_level_sem);\n    return level;\n}\n#endif\n\n#ifdef SYNC_GCC_ATOMIC\nstatic void print_sync_mechanism(void)\n{\n    printf(\"Sync mechanism = GCC ATOMIC\\n\");\n}\nstatic void set_input_level(int level)\n{\n    __atomic_store_n(&amp;G_log_buffer.input_level, level, __ATOMIC_SEQ_CST);\n}\nstatic int get_input_level(void)\n{\n    return __atomic_load_n(&amp;G_log_buffer.input_level, __ATOMIC_SEQ_CST);\n}\n#endif\n\n#ifdef SYNC_GCC_SYNC\nstatic void print_sync_mechanism(void)\n{\n    printf(\"Sync mechanism = GCC LEGACY SYNC\\n\");\n}\nstatic void set_input_level(int level)\n{\n    __sync_lock_test_and_set(&amp;G_log_buffer.input_level, level);\n}\nstatic int get_input_level(void)\n{\n    return __sync_fetch_and_add(&amp;G_log_buffer.input_level, 0);\n}\n#endif\n\n\n/********** log collecting thread ***********/\n\nstatic void dump_log_buffer()\n{\n    set_input_level(LOG_BUFFER_INPUT_LEVEL_NO_PRINTS);  // do not allow input during dumping\n\n    pthread_mutex_lock(&amp;G_log_buffer.log_buffer_lock);    \n    usleep(MS_TO_US(TIMEOUT_MS + 1));  // simulate dumping log buffer\n    pthread_mutex_unlock(&amp;G_log_buffer.log_buffer_lock);\n\n    set_input_level(LOG_BUFFER_INPUT_LEVEL_DEFAULT);  // restore\n}\n\nstatic void *log_thread(void *arg)\n{\n    unsigned long count = 0;\n    int seedp = 1;\n    srand(seedp);\n    for (; ;)\n    {\n        dump_log_buffer();\n        usleep(MS_TO_US(rand_r(&amp;seedp) % 5));\n        ++count;\n        if (count % 160 == 0) printf(\"Dumped %lu times of logs.\\n\", count);  // prove thread is running\n    }\n    return NULL;\n}\n\n/********** business thread ***********/\n\nstatic void write_log(int severity)\n{\n    static unsigned int count = 0;\n    struct timeval      start, end;\n\n    gettimeofday(&amp;start, NULL);\n\n    if (severity &lt; get_input_level()) return;  // abort\n    pthread_mutex_lock(&amp;G_log_buffer.log_buffer_lock);\n    usleep(100);  // simulate writing to log buffer\n    pthread_mutex_unlock(&amp;G_log_buffer.log_buffer_lock);\n\n    gettimeofday(&amp;end, NULL);\n    int diff = (end.tv_sec - start.tv_sec) * 1000 + (end.tv_usec - start.tv_usec) / 1000;  // in ms\n    if (diff &gt;= TIMEOUT_MS) printf(\"***** Business delayed %u time(s)! *****\\n\", ++count);\n}\n\n/* business thread prints logs randomly */\nstatic void *business_thread(void *arg)\n{\n    unsigned long count = 0;\n    for (; ;)\n    {\n        write_log(LOG_BUFFER_INPUT_LEVEL_DEFAULT);\n        ++count;\n        if (count % 131072000 == 0) printf(\"Printed %lu lines of logs.\\n\", count);  // prove thread is running\n    }\n    return NULL;\n}\n\n/********** init ***********/\n\nstatic void init()\n{\n    G_log_buffer.input_level = LOG_BUFFER_INPUT_LEVEL_DEFAULT;\n    pthread_mutex_init(&amp;G_log_buffer.log_buffer_lock, NULL);\n    pthread_mutex_init(&amp;G_log_buffer.input_level_lock, NULL);\n    sem_init(&amp;G_log_buffer.input_level_sem, 0, 1);  // binary semaphore\n}\n\nstatic void deinit()\n{\n    pthread_mutex_destroy(&amp;G_log_buffer.log_buffer_lock);\n    pthread_mutex_destroy(&amp;G_log_buffer.input_level_lock);\n    sem_destroy(&amp;G_log_buffer.input_level_sem);\n}\n\nint main(int argc, char *argv[])\n{\n    init();\n    print_sync_mechanism();\n\n    pthread_t thread_id1, thread_id2;\n    pthread_create (&amp;thread_id1, NULL, &amp;log_thread, NULL);\n    pthread_create (&amp;thread_id2, NULL, &amp;business_thread, NULL);\n    pthread_join(thread_id1, NULL);\n    pthread_join(thread_id2, NULL);\n\n    deinit();\n    return 0;\n}\n</code></pre>\n\n<p>I have checked <code>input_level</code> before trying to lock the <code>log_buffer_lock</code>, and <code>input_level</code> is protected. In theory, business should not be delayed (due to waiting for <code>log_buffer_lock</code> mutex).</p>\n\n<p>But it actually delayed. Program output when using gcc legacy __sync functions:</p>\n\n<pre><code>$ ./simulate_case\nSync mechanism = GCC LEGACY SYNC\n......\nDumped 2080 times of logs.\nPrinted 5373952000 lines of logs.\n***** Business delayed 1 time(s)! *****\n</code></pre>\n\n<p>OS and gcc info:</p>\n\n<pre><code>$ cat /etc/redhat-release \nRed Hat Enterprise Linux Server release 6.5 (Santiago)\n$ uname -a\nLinux *** 3.17.8-13.el6.x86_64 #1 SMP Tue Mar 28 20:56:38 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\n$ gcc -v\nUsing built-in specs.\nTarget: x86_64-redhat-linux\nConfigured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-languages=c,c++,objc,obj-c++,java,fortran,ada --enable-java-awt=gtk --disable-dssi --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-1.5.0.0/jre --enable-libgcj-multifile --enable-java-maintainer-mode --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --disable-libjava-multilib --with-ppl --with-cloog --with-tune=generic --with-arch_32=i686 --build=x86_64-redhat-linux\nThread model: posix\ngcc version 4.4.7 20120313 (Red Hat 4.4.7-4) (GCC) \n</code></pre>\n\n<p>Also happened on a Ubuntu machine (Windows 10 Linux Subsystem):</p>\n\n<pre><code>$ uname -a\nLinux N-5CG8205MFD 4.4.0-43-Microsoft #1-Microsoft Wed Dec 31 14:42:53 PST 2014 x86_64 x86_64 x86_64 GNU/Linux\n$ cat /etc/issue\nUbuntu 18.04.1 LTS \\n \\l\n$ gcc -v\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/7/lto-wrapper\nOFFLOAD_TARGET_NAMES=nvptx-none\nOFFLOAD_TARGET_DEFAULT=1\nTarget: x86_64-linux-gnu\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 7.3.0-27ubuntu1~18.04' --with-bugurl=file:///usr/share/doc/gcc-7/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-7 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\nThread model: posix\ngcc version 7.3.0 (Ubuntu 7.3.0-27ubuntu1~18.04)\n</code></pre>\n"}, {"tags": ["c", "ssl", "curl", "https", "libcurl"], "comments": [{"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1565768785, "post_id": 57489944, "comment_id": 101450694, "body": "try to use <code>curl -k -v --cert .&#47;.ssh&#47;authCert.pem --key .&#47;.ssh&#47;authKey.pem --pass abcde https:&#47;&#47;10.10.4.71&#47;</code> &lt;- this should be the correct syntax"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1565768900, "post_id": 57489944, "comment_id": 101450747, "body": "For the C source: start by trying to set the authKeyPwd to a string literal like <code>&quot;abcde&quot;</code> to rule out errors on reading in the passphrase"}, {"owner": {"reputation": 153, "user_id": 8097224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb0395251409129230d2679a72b212fa?s=128&d=identicon&r=PG&f=1", "display_name": "Rich", "link": "https://stackoverflow.com/users/8097224/rich"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1565850535, "post_id": 57489944, "comment_id": 101479366, "body": "curl -k -v --cert ./.ssh/authCert.pem --key ./.ssh/authKey.pem --pass abcde <a href=\"https://10.10.4.71/\" rel=\"nofollow noreferrer\">10.10.4.71</a> - Same result - &quot;SEC_ERROR_BAD_KEY&quot;"}, {"owner": {"reputation": 153, "user_id": 8097224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb0395251409129230d2679a72b212fa?s=128&d=identicon&r=PG&f=1", "display_name": "Rich", "link": "https://stackoverflow.com/users/8097224/rich"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1565850579, "post_id": 57489944, "comment_id": 101479379, "body": "I tried a literal for the key - no luck"}, {"owner": {"reputation": 153, "user_id": 8097224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb0395251409129230d2679a72b212fa?s=128&d=identicon&r=PG&f=1", "display_name": "Rich", "link": "https://stackoverflow.com/users/8097224/rich"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1565850634, "post_id": 57489944, "comment_id": 101479396, "body": "Something I should have mentioned - the key without the password has been extracted from the key WITH the password, so I know the password/key encryption isn&#39;t at fault"}], "owner": {"reputation": 153, "user_id": 8097224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb0395251409129230d2679a72b212fa?s=128&d=identicon&r=PG&f=1", "display_name": "Rich", "link": "https://stackoverflow.com/users/8097224/rich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1280, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1565767468, "creation_date": 1565767468, "question_id": 57489944, "link": "https://stackoverflow.com/questions/57489944/why-is-curl-unable-to-use-a-password-protected-key", "title": "Why is curl unable to use a password protected key?", "body": "<p>Curl SSL connection fails when I have a password on the client key</p>\n\n<p>I am trying to make a https POST request, with the client authenticating itself with the remote system with an appropriate certificate and private key</p>\n\n<p>In the following code, if 'pathToAuthKey' refers to a non-password-protected key, it all works fine. No errors. No warnings. The connection is established and all is good.</p>\n\n<p>If 'pathToAuthKey' refers to the <strong>SAME</strong> key but password protected, and I provide the password via the 'authKeyPwd' string, I get the following response from Curl;-</p>\n\n<pre><code>* About to connect() to 10.10.4.71 port 443 (#1)\n*   Trying 10.10.4.71...\n* Connected to 10.10.4.71 (10.10.4.71) port 443 (#1)\n* unable to load client key: -8178 (SEC_ERROR_BAD_KEY)\n* NSS error -8178 (SEC_ERROR_BAD_KEY)\n* Peer's public key is invalid.\n* Closing connection 1\n</code></pre>\n\n<p>Essentially, Curl seems to be either ignoring the password I give it, or it is unable to decrypt the key with the specified password, for reasons unknown. The password string I am giving Curl is just that; just the raw password, so \"abcde\", and not something like \"pass:abcde\" (though I have tried all sorts of combinations)</p>\n\n<p>I get the same error response if I use the command line (though I'm not sure I am specifying the password correctly here);-</p>\n\n<pre><code>curl -k -v --cert ./.ssh/authCert.pem --key --pass abcde ./.ssh/authKey.pem https://10.10.4.71/\n</code></pre>\n\n<p>...or (?)...</p>\n\n<pre><code>curl -k -v --cert ./.ssh/authCert.pem --key ./.ssh/authKey.pem:abcde https://10.10.4.71/\n</code></pre>\n\n<p>The key and certificate are in PEM format. I read somewhere that they should include the \"bag\" information to work with Curl. I have tried with and without - it makes no difference. I have also tried many variations of the following code (doing stuff in a different order, trying other options, etc), but no luck</p>\n\n<p>I started with a key PEM format with <code>----BEGIN ENCRYPTED PRIVATE KEY-----</code> headers, but read somewhere that Curl doesn't like this so changed it to <code>-----BEGIN RSA PRIVATE KEY-----</code>. I have tried the key PEM file with and without the <code>Proc-Type</code> and <code>DEK-Info</code> info (though I can't see how SSL would decode the key without this info, unless it just tries all combinations until it succeeds), ie -</p>\n\n<pre><code>-----BEGIN RSA PRIVATE KEY-----\nProc-Type: 4,ENCRYPTED\nDEK-Info: AES-256-CBC,FD47E79520E2C2A1E3B5D9B769C713A9\n\nXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX .......etc.....\n-----END RSA PRIVATE KEY-----\n</code></pre>\n\n<p>I have tried combining the key with the certificate file.</p>\n\n<p>The certificate is self-signed (though I can't see how this could effect the (lack of) password success)</p>\n\n<p>One final thing - I have seen the <code>CURLOPT_KEYPASSWD</code> option called <code>CURLOPT_SSLKEYPASSWD</code>. I have tried both, Curl seems to accept both, but I don't know if there is a difference (the official docs don't mention the latter form)</p>\n\n<p>This is on a Centos 6 machine. Curl version...</p>\n\n<pre><code>curl 7.29.0 (x86_64-redhat-linux-gnu) libcurl/7.29.0 NSS/3.36 zlib/1.2.7 libidn/1.28 libssh2/1.4.3\nProtocols: dict file ftp ftps gopher http https imap imaps ldap ldaps pop3 pop3s rtsp scp sftp smtp smtps telnet tftp \nFeatures: AsynchDNS GSS-Negotiate IDN IPv6 Largefile NTLM NTLM_WB SSL libz unix-sockets\n</code></pre>\n\n<p>Any help would be hugely appreciated</p>\n\n<p>This is the C code I have;-</p>\n\n<pre><code>curl_easy_setopt(curl, CURLOPT_USERAGENT, \"curl\"); // Identify ourselves\n\n// Set up timeout handler\ncurl_easy_setopt(curl, CURLOPT_XFERINFOFUNCTION, curlTimeoutCallback);\ncurl_easy_setopt(curl, CURLOPT_XFERINFODATA, &amp;transferStartTime);\n\n// Set up the response handler\ncurl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, curlResponseCallback);\ncurl_easy_setopt(curl, CURLOPT_WRITEDATA, &amp;response);\n\n// Create HTTP request data\nchar postData[MAX_JSON_POST_LEN] = {\"My POST data\"};\nint postLen = strlen(postData);\n\n// Construct URL to send request to\nchar url[] = {\"https://10.10.4.71/\"};\ncurl_easy_setopt(curl, CURLOPT_URL, url);\n\ncurl_easy_setopt(curl, CURLOPT_VERBOSE, 1L); // ###\n\ncurl_easy_setopt(curl, CURLOPT_SSLCERTTYPE, \"PEM\");\ncurl_easy_setopt(curl, CURLOPT_SSLCERT, pathToAuthCert);\n\ncurl_easy_setopt(curl, CURLOPT_SSLKEYTYPE, \"PEM\");\ncurl_easy_setopt(curl, CURLOPT_SSLKEY, pathToAuthKey);\n\nif (*authKeyPwd)\n{\n    curl_easy_setopt(curl, CURLOPT_KEYPASSWD, authKeyPwd);\n}\n\n// Try and simplify things for now by disabling verification of the remote system\ncurl_easy_setopt(curl, CURLOPT_SSL_VERIFYPEER, 0L);\ncurl_easy_setopt(curl, CURLOPT_SSL_VERIFYHOST, 0L);\n\n// Send request\nclock_gettime(CLOCK_MONOTONIC, &amp;transferStartTime);\ncurl_easy_setopt(curl, CURLOPT_POSTFIELDSIZE, postLen);\n\nCURLcode curlResp = curl_easy_perform(curl);\n</code></pre>\n"}, {"tags": ["c"], "answers": [{"tags": [], "owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "is_accepted": true, "score": 2, "last_activity_date": 1565763819, "last_edit_date": 1565763819, "creation_date": 1565761340, "answer_id": 57488717, "question_id": 57488447, "link": "https://stackoverflow.com/questions/57488447/inserting-elements-in-a-linked-list-of-linked-list/57488717#57488717", "title": "Inserting elements in a linked list of linked list", "body": "<ol>\n<li><p>You are using a mixture of C++ and C in the code with <code>new</code> and <code>scanf</code> You can use malloc as shown in the example below</p></li>\n<li><p>In the structure declarations, the code given will not compile. <code>trans *next;</code> should be changed to <code>struct trans *next;</code>. Similarly  <code>acct *next;</code> to be changed to <code>struct  acct *next;</code></p></li>\n<li><p>In the client case, you should set <code>ax-&gt;next = NULL</code> for the case <code>(t == NULL)</code> also</p></li>\n<li><p>For inserting the account, I have modified the code by making use of the <code>ax</code> variable in the client case as below.</p>\n\n<pre><code>account * acc = malloc (sizeof (account));\naccount * acc2;\nif (acc == NULL)  {  exit (1); } // or any other method to handle memory error\n\nscanf(\"%d\",acc-&gt;code);\nscanf(\"%s\",acc-&gt;bank);\nscanf(\"%d\",acc-&gt;type);\nscanf(\"%lf\",acc-&gt;balance);        \n\nacc-&gt;next = NULL;\n\nif (ax-&gt;anext == NULL) \n{\n    ax-&gt;anext = acc;\n}\nelse\n{\n    acc2 = ax-&gt;anext;\n    while (acc2-&gt;next != NULL)\n    {\n        acc2 = acc2-&gt;next;\n    }\n    acc2-&gt;next = acc;\n}\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 632, "user_id": 11467079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Ab3W.jpg?s=128&g=1", "display_name": "FlowMafia", "link": "https://stackoverflow.com/users/11467079/flowmafia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 57488717, "answer_count": 1, "score": 1, "last_activity_date": 1565763819, "creation_date": 1565759360, "question_id": 57488447, "link": "https://stackoverflow.com/questions/57488447/inserting-elements-in-a-linked-list-of-linked-list", "title": "Inserting elements in a linked list of linked list", "body": "<p>I have the following structures: </p>\n\n<pre><code>typedef struct trans {\n    int code;\n    int issuersAccsID;\n    double amount;\n    int type;\n    char date [100];\n    int secondPartysId;\n    char description [41];\n    trans *next;\n} transaction;\n\n\ntypedef struct acct{\n    int id;\n    char bank [50];\n    int type;\n    double balance;\n    acct *next;\n    transaction *tnext;\n} account;\n\n\nstruct client{\n    int id;\n    char name [150];\n    char city [200];\n    char phone [30];\n    client *next;\n    account *anext;\n};\n</code></pre>\n\n<p>When I insert elements in the list \"clients\" it's working fine, but the problem is when I go to the \"sublist\", because it inserts the last element infinitely.</p>\n\n<pre><code>void fileExists(client **p){\n    client *ax = new client, *t = *p;\n    scanf(\"%d\",ax-&gt;id);\n    scanf(\"%s\",ax-&gt;name);\n    ax-&gt;city=\"Example\";\n    scanf(\"%s\",ax-&gt;phone);\n        if (t==NULL)\n            *p=ax;\n                else{\n                /*Insert at the end of the list*/\n                    t = *p;\n                    ax-&gt;next = NULL;\n                        while(t-&gt;next != NULL)\n                            t=t-&gt;next;\n                    t-&gt;next = ax;\n                }\n\n\n/************************* ACCOUNTS ******************************/\n    scanf(\"%d\",auxid);\n    scanf(\"%s\",auxb);\n    scanf(\"%d\",auxt);\n    scanf(\"%lf\",auxbal);\n                /*Insert at the end of the list*/\n                    ax-&gt;anext = new account;\n                    t = *p;\n                    t-&gt;anext = (*p)-&gt;anext;\n                    ax-&gt;anext-&gt;id = auxid;\n                    strcpy(ax-&gt;anext-&gt;bank,auxb);\n                    ax-&gt;anext-&gt;type = auxt;\n                    ax-&gt;anext-&gt;balance = auxbal;\n                    ax-&gt;anext-&gt;next = NULL;\n                        if (t-&gt;anext == NULL)\n                            (*p)-&gt;anext = ax-&gt;anext;\n                        else while(t-&gt;anext-&gt;next != NULL)\n                            t-&gt;anext=t-&gt;anext-&gt;next;\n                    t-&gt;anext-&gt;next = ax-&gt;anext;\n}\n</code></pre>\n\n<p>To explain better what's happening let's say we insert 2 clients</p>\n\n<p><strong>Client A:</strong>\n1. ID = 4\n2. Name = Frank\n3. City = Example\n4. Phone = 1111</p>\n\n<p><em>Client A also has the following accounts</em></p>\n\n<p>Account A:\n1. ID = 3333\n2. Bank = Exampl\n3. Type = 2\n4. Balance = 35.3</p>\n\n<p>Account B:\n1. ID = 4444\n2. Bank = Exam\n3. Type = 1\n4. Balance = 38.3</p>\n\n<p><strong>Client B:</strong>\n1. ID = 6\n2. Name = Riley\n3. City = Example\n4. Phone = 2222</p>\n\n<p><em>Client B also has the following accounts</em></p>\n\n<p>Account A:\n1. ID = 6666\n2. Bank = Ex\n3. Type = 2\n4. Balance = 77.3</p>\n\n<p>Account B:\n1. ID = 8888\n2. Bank = E\n3. Type = 1\n4. Balance = 7542.3</p>\n\n<p>Account C:\n1. ID = 9998\n2. Bank = Ex\n3. Type = 2\n4. Balance = 752.63</p>\n\n<p>When I finish inserting in the linked list the account list for <strong>Client A</strong> looks like this:</p>\n\n<p>Account B -> Account B -> Account B -> Account B (...) nonstop. How could I solve it?</p>\n"}, {"tags": ["c", "segmentation-fault", "clang", "linker-scripts"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1565757440, "post_id": 57488182, "comment_id": 101446952, "body": "I see you&#39;re missing .rodata. Does the string &quot;value of g1 is %d&quot; appear in the file?"}, {"owner": {"reputation": 199, "user_id": 10938148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6e6c396abe4dfd500a3616338e3e4f8?s=128&d=identicon&r=PG&f=1", "display_name": "Jon marsh", "link": "https://stackoverflow.com/users/10938148/jon-marsh"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1565757664, "post_id": 57488182, "comment_id": 101446999, "body": "No there is no string <code>value of g1 is %d</code> in memory file"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1565834916, "post_id": 57488182, "comment_id": 101476760, "body": "That string probably goes in the .rodata section which is not included in your output file."}], "answers": [{"comments": [{"owner": {"reputation": 199, "user_id": 10938148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6e6c396abe4dfd500a3616338e3e4f8?s=128&d=identicon&r=PG&f=1", "display_name": "Jon marsh", "link": "https://stackoverflow.com/users/10938148/jon-marsh"}, "edited": false, "score": 0, "creation_date": 1565931211, "post_id": 57489133, "comment_id": 101505646, "body": "Yes , I tried with default linker scripts . I am able to execute my program  correctly."}], "tags": [], "owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "is_accepted": false, "score": 1, "last_activity_date": 1565764212, "last_edit_date": 1565764212, "creation_date": 1565763815, "answer_id": 57489133, "question_id": 57488182, "link": "https://stackoverflow.com/questions/57488182/cannot-execute-the-executable-when-linked-with-linker-scripts/57489133#57489133", "title": "cannot execute the executable when linked with linker scripts", "body": "<ol>\n<li><p>The linker scripts for executables are not that simple. You need to provide all kinds of sections for the application and the operating system to load and run the application.</p>\n\n<p>Please see the default linker scripts:</p>\n\n<ul>\n<li>On Linux they are in <code>/usr/lib/ldscripts</code> - at least with the distribution I tried.</li>\n<li>On Windows they are in <code>&lt;your-installation-path&gt;\\mingw64\\x86_64-w64-mingw32\\lib\\ldscripts</code> - at least with the installation I tried.</li>\n</ul></li>\n<li><p>You put hard coded addresses like <code>0x0000000000400410</code> for <code>.text</code> in your script. You can't do this, because our casual operating systems decide on their own where to load the sections.</p></li>\n</ol>\n\n<p>So, if you like to play with linker scripts, I'd suggest to copy one of the system's linker scripts and edit that. Which one you need, I don't know.</p>\n\n<p>There might be some option to let the linker show which one it uses. You can start with a standard compile command and the option <code>-v</code> which will give you a lot of details. But you will need to read the linker's documentation, for sure.</p>\n"}], "owner": {"reputation": 199, "user_id": 10938148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6e6c396abe4dfd500a3616338e3e4f8?s=128&d=identicon&r=PG&f=1", "display_name": "Jon marsh", "link": "https://stackoverflow.com/users/10938148/jon-marsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565764212, "creation_date": 1565757074, "last_edit_date": 1565761590, "question_id": 57488182, "link": "https://stackoverflow.com/questions/57488182/cannot-execute-the-executable-when-linked-with-linker-scripts", "title": "cannot execute the executable when linked with linker scripts", "body": "<p>I am new to concept of linker scripts . \nSo I was trying myself with simple c program and linker scripts and memory file.</p>\n\n<p>I tried to pass a custom linker script for a c program , \nWhen I looked into the memory file that got generated , I am able to see the variable that is initialized is placed at the address mentioned in the linker scripts.</p>\n\n<p>But the problem is I cannot execute the executable that got generated for the c program</p>\n\n<p>This is my c file <code>simpleHello.c</code></p>\n\n<pre><code>#include&lt;stdio.h&gt;\nint g1 = 100;\nint main(int argc , char *argv[])\n{\nprintf(\"value of g1 is %d\",g1);\nreturn 0;\n}\n\n</code></pre>\n\n<p>This is my linker script fie name <code>linker.ld</code></p>\n\n<pre><code>ENTRY(main)\nSECTIONS\n{\n  . = ALIGN(4);\n  . = 0x0000000000400410;\n  .text : { *(.text) }\n  . = 0x0000000000601038;\n  .data : { *(.data) }\n  .bss : { *(.bss) }\n}\n</code></pre>\n\n<p>I am running the below command </p>\n\n<pre><code>clang simpleHello.c -g -Wl,-emain,-Map=o.map,-Tlinker.ld -ffreestanding -nostartfiles -nodefaultlibs -L/usr/lib/x86_64-linux-gnu -lc -o simple\n</code></pre>\n\n<p>If i run <code>./simple</code></p>\n\n<blockquote>\n  <blockquote>\n    <p>Segmentation fault (core dumped)</p>\n  </blockquote>\n</blockquote>\n\n<p>So i debugged the executable with gdb and I got below this.</p>\n\n<pre><code>gdb ./simple\n\nReading symbols from ./simple...done.\n(gdb) b main\nBreakpoint 1 at 0x40041f: file simpleHello.c, line 9.\n(gdb) r\nStarting program: Desktop/Memory-Map/programs/simple \n\nBreakpoint 1, main (argc=-134225560, argv=0x1) at simpleHello.c:9\n9   printf(\"value of g1 is %d\",g1);\n(gdb) bt\n#0  main (argc=-134225560, argv=0x1) at simpleHello.c:9\n(gdb) \n\n</code></pre>\n\n<p>So the probelm is with argc and argv or with linker file that I passed.?</p>\n\n<p>Kindly suggest some solution for this issue.</p>\n"}, {"tags": ["c", "windows", "macos"], "comments": [{"owner": {"reputation": 23673, "user_id": 1118321, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a56b8390b7457739ed8cc7cbd52bf251?s=128&d=identicon&r=PG", "display_name": "user1118321", "link": "https://stackoverflow.com/users/1118321/user1118321"}, "edited": false, "score": 0, "creation_date": 1565759608, "post_id": 57488088, "comment_id": 101447430, "body": "Can you show the output on both systems?"}, {"owner": {"reputation": 23673, "user_id": 1118321, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a56b8390b7457739ed8cc7cbd52bf251?s=128&d=identicon&r=PG", "display_name": "user1118321", "link": "https://stackoverflow.com/users/1118321/user1118321"}, "edited": false, "score": 0, "creation_date": 1565760402, "post_id": 57488088, "comment_id": 101447613, "body": "Here&#39;s something to think about - What&#39;s in the <code>wall</code> array to start with? You fill out the sides after the user enters the width and height of the wall, but what&#39;s in between the sides?"}, {"owner": {"reputation": 1774, "user_id": 1201456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b33a546c937f65ce7ef0f29ca0f6a84d?s=128&d=identicon&r=PG", "display_name": "nickelpro", "link": "https://stackoverflow.com/users/1201456/nickelpro"}, "edited": false, "score": 1, "creation_date": 1565760666, "post_id": 57488088, "comment_id": 101447680, "body": "OSX Terminal wraps at 80 characters, which is likely the problem. <code>printf</code> isn&#39;t designed to do terminal UI. For that you need a TUI framework, like <a href=\"https://en.wikipedia.org/wiki/Ncurses\" rel=\"nofollow noreferrer\">ncurses</a> or similar"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565763843, "post_id": 57488088, "comment_id": 101448667, "body": "Allocating this many big arrays on the stack is a bad idea. See <a href=\"https://stackoverflow.com/questions/571945/getting-a-stack-overflow-exception-when-declaring-a-large-array\">Getting a stack overflow exception when declaring a large array</a>."}], "owner": {"reputation": 25, "user_id": 11879307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3583b356494a1bb653329dfd884c9cdf?s=128&d=identicon&r=PG&f=1", "display_name": "Learning", "link": "https://stackoverflow.com/users/11879307/learning"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565762557, "creation_date": 1565756149, "last_edit_date": 1565762557, "question_id": 57488088, "link": "https://stackoverflow.com/questions/57488088/c-program-runs-fine-on-windows-compiler-dev-c-but-not-on-osx-compiler-c", "title": "C program runs fine on Windows (compiler = Dev-C++) but not on OSX (compiler = Clang)", "body": "<p>The following program is a work in progress and is designed to allow someone to hang simulated pictures on a simulated wall in a very, very primitive graphical environment.</p>\n\n<p>I compiled the program on Windows with Dev-C++ and it runs just as intended. I compiled it on Mac OSX with Clang and it does not. On OSX, the 2D character array does not print properly. The right-most wall side ends up being printed in the <em>middle</em> of the wall, and when the program prints the \"pictures,\" the pictures do not print properly at all. They throw off the spacing for that right-most wall-side (resulting in certain asterisks on that wall-side appearing jagged and out of the appropriate column).</p>\n\n<p>Is this a function of the two different compilers? I don't see how it could be unless maybe there is undefined behavior going on in my code? </p>\n\n<p>Or is it a function of the two different command line environments? I.e., the character output works as intended with the Windows command prompt but not with Mac's terminal?</p>\n\n<p>Also, please disregard my use of the <code>round()</code> function from the math.h header in the beginning; initially I wanted to make sure the rounding was correct but I quickly realized that since I'm only ever dividing integers by 2, whether the program rounds up or down doesn't make much of a difference (it's .5 in either direction). That's why the function appears in the beginning of the program but not at the end. I'm going to either take it out completely or use it for all of the division in the program. </p>\n\n<p>Code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n\nint main(void)\n{\n    char wall[1000][1000];\n    int rows;\n    int columns;\n    int wfeet;\n    int winches;\n    int hfeet;\n    int hinches;\n    int wtotalinches;\n    int htotalinches;\n    int xcoordscols;\n    int ycoordsrows;\n    int rowunderscorechars;\n    int columnpipechars;\n    int i;\n    int j;\n    int k;\n    int p;\n    int xcoordTL[500];\n    int ycoordTL[500];\n    int xcoordTR[500];\n    int ycoordTR[500];\n    int xcoordBL[500];\n    int ycoordBL[500];\n    int xcoordBR[500];\n    int ycoordBR[500];\n    int picwidth[500];\n    int picheight[500];\n\n    p = 0;\n\n    printf(\"How wide is the wall? You'll first enter feet only. Then you'll need to enter inches (if any).\\n\");\n    printf(\"Please enter the width of the wall in feet (don't worry about inches yet):\\n\");\n    scanf(\"%d\", &amp;wfeet);\n    printf(\"Please enter any extra inches now.\\n\");\n    scanf(\"%d\", &amp;winches);\n    printf(\"Great! Now how TALL is the wall? Again, feet first, inches second.\\n\");\n    printf(\"Please enter the height of the wall in feet (don't worry about inches yet):\\n\");\n    scanf(\"%d\", &amp;hfeet);\n    printf(\"Please enter any extra inches now.\\n\");\n    scanf(\"%d\", &amp;hinches);\n\n    wtotalinches = (wfeet * 12) + winches;\n    htotalinches = (hfeet * 12) + hinches;\n\n    ycoordsrows = round((float)htotalinches / 2);\n    xcoordscols = round((float)wtotalinches / 2);\n\n    for (i = 0; i &lt; xcoordscols; i++)\n    {\n        wall[0][i] = '*';\n\n    }\n    for (i = 0; i &lt; xcoordscols; i++)\n    {\n        wall[ycoordsrows - 1][i] = '*';\n    }\n\n    for (i = 0; i &lt; ycoordsrows; i++)\n    {\n        wall[i][0] = '*';\n    }\n\n    for (i = 0; i &lt; ycoordsrows; i++)\n    {\n        wall[i][xcoordscols - 1] = '*';\n    }\n\n    for (k = 0; k &lt; ycoordsrows; k++)\n    {\n        for (j = 0; j &lt; xcoordscols; j++)\n        {\n            printf(\"%c\", wall[k][j]);\n            printf(\" \");\n        }\n    printf(\"\\n\");\n    }\n\n    while (1)\n    {\n        printf(\"Great! Now I need the x and y coordinates for the UPPER LEFT hand corner of the picture or object to be hung.\\n\");\n        printf(\"So pick out where you want the picture or object hung, then figure out where the upper left hand corner of that picture or object \");\n        printf(\"would be on the wall. Then, count the *s to get the x and y coordinates for the UPPER LEFT hand corner of the picture or object.\\n\");\n        printf(\"First, the x coordinate (of the upper left hand corner of the picture or object):\\n\");\n        scanf(\"%d\", &amp;xcoordTL[p]);\n        printf(\"Great! Now, the y coordinate (counting DOWN from the top):\\n\");\n        scanf(\"%d\", &amp;ycoordTL[p]);\n        printf(\"Great! Now, enter the dimensions of the picture, in INCHES only.\\n\");\n        printf(\"First, the width of the picture or object (in inches):\\n\");\n        scanf(\"%d\", &amp;picwidth[p]);\n        printf(\"Now the height of the picture or object (in inches):\\n\");\n        scanf(\"%d\", &amp;picheight[p]);\n\n        xcoordTR[p] = xcoordTL[p] + ((picwidth[p] / 2) - 1);\n        ycoordTR[p] = ycoordTL[p];\n\n        xcoordBL[p] = xcoordTL[p];\n        ycoordBL[p] = ycoordTL[p] + ((picheight[p] / 2) - 1);\n\n        xcoordBR[p] = xcoordTR[p];\n        ycoordBR[p] = ycoordBL[p];\n\n        for (i = xcoordTL[p] - 1; i &lt;= xcoordTR[p] - 1; i++)\n        {\n            wall[ycoordTL[p] - 1][i] = '*';\n        }\n\n        for (i = xcoordBL[p] - 1; i &lt;= xcoordBR[p] - 1; i++)\n        {\n            wall[ycoordBL[p] -1][i] = '*';\n        }\n\n        for (i = ycoordTL[p] - 1; i &lt;= ycoordBL[p] - 1; i++)\n        {\n            wall[i][xcoordTL[p] - 1] = '*';\n        }\n\n        for (i = ycoordTR[p] - 1; i &lt;= ycoordBR[p] - 1; i++)\n        {\n            wall[i][xcoordTR[p] - 1] = '*';\n        }\n\n        for (k = 0; k &lt; ycoordsrows; k++)\n        {\n            for (j = 0; j &lt; xcoordscols; j++)\n            {\n                printf(\"%c\", wall[k][j]);\n                printf(\" \");\n            }\n        printf(\"\\n\");\n        }\n    p++;\n    }\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 200780, "user_id": 116908, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/54d38793d7a407446999b33b81d607fd?s=128&d=identicon&r=PG", "display_name": "Carl Norum", "link": "https://stackoverflow.com/users/116908/carl-norum"}, "edited": false, "score": 1, "creation_date": 1565756146, "post_id": 57488072, "comment_id": 101446713, "body": "Relevant: <a href=\"https://stackoverflow.com/questions/5431941/why-is-while-feof-file-always-wrong\" title=\"why is while feof file always wrong\">stackoverflow.com/questions/5431941/&hellip;</a>"}, {"owner": {"reputation": 183, "user_id": 9272311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/641a11eecf2a4152fbf079df55608ebc?s=128&d=identicon&r=PG", "display_name": "SelfishCrawler", "link": "https://stackoverflow.com/users/9272311/selfishcrawler"}, "edited": false, "score": 0, "creation_date": 1565756153, "post_id": 57488072, "comment_id": 101446715, "body": "This is possible a problem of file and console encodings, ie. console encoding is OEM-866, and file encoding is possibly 1251 codepage, check it"}, {"owner": {"reputation": 442, "user_id": 9932916, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tzXpqeGz2Kg/AAAAAAAAAAI/AAAAAAAAAAA/-OUONdsc09A/photo.jpg?sz=128", "display_name": "Tagger5926", "link": "https://stackoverflow.com/users/9932916/tagger5926"}, "edited": false, "score": 0, "creation_date": 1565756371, "post_id": 57488072, "comment_id": 101446746, "body": "Would it not be better to look into getline(). Just another comment about feof not being advised to control the loop: <a href=\"https://stackoverflow.com/questions/5431941/why-is-while-feof-file-always-wrong\" title=\"why is while feof file always wrong\">stackoverflow.com/questions/5431941/&hellip;</a>"}, {"owner": {"reputation": 33, "user_id": 11320760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/27c728dc7ee0dd9707b29b997e1134b7?s=128&d=identicon&r=PG&f=1", "display_name": "testesttest", "link": "https://stackoverflow.com/users/11320760/testesttest"}, "reply_to_user": {"reputation": 442, "user_id": 9932916, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tzXpqeGz2Kg/AAAAAAAAAAI/AAAAAAAAAAA/-OUONdsc09A/photo.jpg?sz=128", "display_name": "Tagger5926", "link": "https://stackoverflow.com/users/9932916/tagger5926"}, "edited": false, "score": 0, "creation_date": 1565756823, "post_id": 57488072, "comment_id": 101446828, "body": "how would i use getline() in this instance @Tagger5926"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1565759070, "post_id": 57488072, "comment_id": 101447303, "body": "You may want to see <a href=\"https://stackoverflow.com/questions/57487416/how-to-take-text-file-as-command-line-argument-in-c\">https://stackoverflow.com/questions/57487416/how-to-take-tex&zwnj;&#8203;t-file-as-command-li&zwnj;&#8203;ne-argument-in-c</a> which looks suspiciously similar <code>:)</code>"}, {"owner": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 0, "creation_date": 1565759630, "post_id": 57488072, "comment_id": 101447439, "body": "Note: you define the array as having 4 items and then read upto 10 items into it. You say you want strings with max length 99 to fit into it and you tell <code>fgets</code> it\u2019s ok to read 150 characters. There\u2019s no reason to wonder why a program doesn\u2019t work before this kind of stuff is fixed first."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565760612, "post_id": 57488072, "comment_id": 101447662, "body": "Each of your arrays is 100 characters long and you lie to <code>fgets</code> that they have 150, why?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565764718, "post_id": 57488072, "comment_id": 101448990, "body": "Do you call <code>fopen</code> at all? Do you check what it returned?"}], "answers": [{"comments": [{"owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "edited": false, "score": 1, "creation_date": 1565758756, "post_id": 57488229, "comment_id": 101447221, "body": "You should check whether the <code>getline</code> is reading more lines than the array. In this case more than 4 lines."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1565759135, "post_id": 57488229, "comment_id": 101447314, "body": "e.g. <code>while (i &lt; count &amp;&amp; ( read=getline(&amp;lines, &amp;n, fp) ) != -1)</code>"}, {"owner": {"reputation": 442, "user_id": 9932916, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tzXpqeGz2Kg/AAAAAAAAAAI/AAAAAAAAAAA/-OUONdsc09A/photo.jpg?sz=128", "display_name": "Tagger5926", "link": "https://stackoverflow.com/users/9932916/tagger5926"}, "edited": false, "score": 0, "creation_date": 1565759897, "post_id": 57488229, "comment_id": 101447490, "body": "Cheers. Not sure if this will even work. Just gotta wait and see I guess."}], "tags": [], "owner": {"reputation": 442, "user_id": 9932916, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tzXpqeGz2Kg/AAAAAAAAAAI/AAAAAAAAAAA/-OUONdsc09A/photo.jpg?sz=128", "display_name": "Tagger5926", "link": "https://stackoverflow.com/users/9932916/tagger5926"}, "is_accepted": false, "score": 0, "last_activity_date": 1565759656, "last_edit_date": 1565759656, "creation_date": 1565757482, "answer_id": 57488229, "question_id": 57488072, "link": "https://stackoverflow.com/questions/57488072/how-to-store-multiple-strings-in-array-in-c/57488229#57488229", "title": "How to store multiple strings in array in c", "body": "<p>As @kleshenki mentioned, it could be an encoding issue.</p>\n\n<p>I tried refactoring the code to use getline instead. So give that a go. If it doesn't work, I will delete this post.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\n\nint main()\n{\n    int count = 4;\n\n    char string_array[count][100];\n    FILE *fp = fopen(\"test.txt\",\"r\");\n\n    ssize_t read;\n    int i = 0;\n    size_t n = 100;\n    char *lines = string_array[i];\n    while (i&lt;count&amp;&amp;( read=getline(&amp;lines, &amp;n, fp) )!= -1)\n    {\n\n        lines = string_array[i];\n    }\n\n    printf(\"First string is %s\", string_array[0]);\n    printf(\"Second string is %s\", string_array[1]);\n    fclose(fp);\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 11320760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/27c728dc7ee0dd9707b29b997e1134b7?s=128&d=identicon&r=PG&f=1", "display_name": "testesttest", "link": "https://stackoverflow.com/users/11320760/testesttest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1565759656, "creation_date": 1565755964, "question_id": 57488072, "link": "https://stackoverflow.com/questions/57488072/how-to-store-multiple-strings-in-array-in-c", "title": "How to store multiple strings in array in c", "body": "<p>Hey so Im currently trying to store multiple strings that are coming from a text file from the command line args. I have been told to use a 2D array so i declared one of size [count] which is 4 in this example. However when i got to use fgets to store each line in the array, it doesnt seem to be working as when i print the result to console, i get a bunch of random characters.</p>\n\n<pre><code>count = 4;\n\nchar string_array[count][100];\n\n    int loop_counter = 0;\n    while (!feof(file_pointer) &amp;&amp; loop_counter &lt; 10)\n    {\n       fgets(string_array[loop_counter], 150, file_pointer);\n       loop_counter += 1;\n    }\n\nprintf(\"First string is %s\", string_array[0]);\n</code></pre>\n\n<p>The last printf statement returns this:</p>\n\n<p>First string is \u2592\u2592ap\u2592 X\u2592a</p>\n\n<p>See the random characters^. First string is supposed to be \"A 1 2 3 4 5\". The text file looks like this:</p>\n\n<pre><code>A 1 2 3 4 5\nB 0 0\nC 1 1\nF 2 2\n</code></pre>\n"}, {"tags": ["c", "uefi", "gnu-efi", "edk2"], "answers": [{"comments": [{"owner": {"reputation": 2476, "user_id": 5931673, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/aTpXN.jpg?s=128&g=1", "display_name": "ajxs", "link": "https://stackoverflow.com/users/5931673/ajxs"}, "edited": false, "score": 0, "creation_date": 1565763093, "post_id": 57488673, "comment_id": 101448397, "body": "Ah! This makes a lot of sense. I should probably have mentioned that my understanding of what a &#39;handle&#39; is in-context might be a little shaky. The UEFI standard ( and EDK2 Driver Developer guide ) don&#39;t make it especially clear what multiple instances within a handle might represent. I was having trouble understanding why multiple implementations of a standard may exist on a platform. I thought a protocol would be like a driver interface exposed by the firmware as opposed to being an interface for an individual hardware entity. Thanks for the reply! This definitely helps!"}, {"owner": {"reputation": 2476, "user_id": 5931673, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/aTpXN.jpg?s=128&g=1", "display_name": "ajxs", "link": "https://stackoverflow.com/users/5931673/ajxs"}, "edited": false, "score": 0, "creation_date": 1565763136, "post_id": 57488673, "comment_id": 101448407, "body": "I&#39;ll leave the question open for a little while longer if you don&#39;t mind, just to encourage any other answers. After that I&#39;ll accept this as the answer!"}], "tags": [], "owner": {"reputation": 25733, "user_id": 559737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5de249db6565b87a2699e131974268a?s=128&d=identicon&r=PG", "display_name": "Brendan", "link": "https://stackoverflow.com/users/559737/brendan"}, "is_accepted": true, "score": 4, "last_activity_date": 1565761078, "creation_date": 1565761078, "answer_id": 57488673, "question_id": 57487924, "link": "https://stackoverflow.com/questions/57487924/what-is-the-correct-way-to-load-a-uefi-protocol/57488673#57488673", "title": "What is the correct way to load a UEFI protocol?", "body": "<p>For this specific case (trying to find \"EFI_GRAPHICS_OUTPUT_PROTOCOL\") if there is only one, or you only want one and don't care which one; then <code>gBS-&gt;LocateProtocol</code> is easier (and possibly faster?) but you could use <code>gBS-&gt;LocateHandleBuffer</code> too if you want.</p>\n\n<p>However; what if there's 5 video cards with 2 monitors each, and there's 10 different instances of \"EFI_GRAPHICS_OUTPUT_PROTOCOL\"? In this case maybe you want all of them (so you can set up a nice video mode on all 10 monitors), and maybe you want to search for the right one (e.g. maybe literally the one on the right-hand side of the user) and skip/avoid the other 9 wrong ones. For this you have to use <code>gBS-&gt;LocateHandleBuffer</code>.</p>\n"}], "owner": {"reputation": 2476, "user_id": 5931673, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/aTpXN.jpg?s=128&g=1", "display_name": "ajxs", "link": "https://stackoverflow.com/users/5931673/ajxs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 798, "favorite_count": 0, "accepted_answer_id": 57488673, "answer_count": 1, "score": 3, "last_activity_date": 1565761078, "creation_date": 1565754579, "question_id": 57487924, "link": "https://stackoverflow.com/questions/57487924/what-is-the-correct-way-to-load-a-uefi-protocol", "title": "What is the correct way to load a UEFI protocol?", "body": "<p>Apologies if this doesn't fit the StackOverflow format. I'm currently learning about writing UEFI applications. I've been reading the UEFI standard as well as a wealth of tutorials online and I can't seem to figure out what is the correct method for loading a UEFI protocol. All the tutorials seem to differ in the method that they use.</p>\n\n<p>In many cases the tutorials follow the method of locating the handle and then iterating through the handle buffer to open the protocol. Example shown below:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>EFI_HANDLE *handle_buffer;\nUINTN handle_count;\nEFI_GRAPHICS_OUTPUT_PROTOCOL *protocol;\n\n// GNU-EFI wrapper.\nstatus = uefi_call_wrapper(gBS-&gt;LocateHandleBuffer,\n    5,\n    ByProtocol,\n    &amp;gEfiGraphicsOutputProtocolGuid,\n    NULL,\n    &amp;handle_count,\n    &amp;handle_buffer);\n\nUINTN i = 0;\nfor(i = 0; i &lt; handle_count; i++) {\n    status = uefi_call_wrapper(gBS-&gt;OpenProtocol, 6,\n        handle_buffer[i],\n        &amp;gEfiGraphicsOutputProtocolGuid,\n        (VOID **)&amp;protocol,\n        ImageHandle,                        // from `efi_main`\n        NULL,\n        EFI_OPEN_PROTOCOL_BY_HANDLE_PROTOCOL);\n\n    if(status == EFI_SUCCESS) {\n        break;\n    }\n}\n</code></pre>\n\n<p>Alternatively, it appears that you can just load the protocol directly using the <code>LocateProtocol</code> function. Example:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>status = uefi_call_wrapper(gBS-&gt;LocateProtocol,\n    3,\n    &amp;gEfiGraphicsOutputProtocolGuid,\n    NULL,\n    &amp;graphics_service.protocol);\n</code></pre>\n\n<p>Both above examples work.\nI'm not sure I understand the significance of fetching the handle buffer prior to loading the protocol, as seen in some tutorials and online material. From searching through examples on Github, it looks like both are used interchangeably and so far I have found both work just as well. I understand that in the former method I will need to free the buffer since it is allocated from a pool, whereas in the latter there is no responsibility for this.</p>\n\n<p>Can anyone point out which is the ideal method to load a UEFI protocol? Are there any issues with either method?\nAny help here would be appreciated.</p>\n"}, {"tags": ["c", "windows", "cng"], "comments": [{"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1565763035, "post_id": 57487839, "comment_id": 101448378, "body": "Close voter: I&#39;m not interested in having someone inspect my code. I want to learn which parameter is causing <code>STATUS_INVALID_PARAMETER</code>. 23 potential parameters (with combinations) is too many to eliminate through guessing."}, {"owner": {"reputation": 32308, "user_id": 20270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37335856df5e5e73d82bca5a805bd647?s=128&d=identicon&r=PG", "display_name": "Hasturkun", "link": "https://stackoverflow.com/users/20270/hasturkun"}, "edited": false, "score": 1, "creation_date": 1565770949, "post_id": 57487839, "comment_id": 101451751, "body": "Example code for <code>BCryptEncrypt</code> does exist (<a href=\"https://docs.microsoft.com/en-us/windows/win32/seccng/encrypting-data-with-cng\" rel=\"nofollow noreferrer\">here for example</a>) though doesn&#39;t seem to handle authenticated cipher mode. The fields for <a href=\"https://docs.microsoft.com/en-us/windows/win32/api/bcrypt/ns-bcrypt-bcrypt_authenticated_cipher_mode_info\" rel=\"nofollow noreferrer\"><code>BCRYPT_AUTHENTICATED_CIPHER_MODE_INFO</code></a> do seem decently documented though. I could also find an example of authenticated encryption on SO <a href=\"https://stackoverflow.com/a/30958068/20270\">here</a>."}, {"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "reply_to_user": {"reputation": 32308, "user_id": 20270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37335856df5e5e73d82bca5a805bd647?s=128&d=identicon&r=PG", "display_name": "Hasturkun", "link": "https://stackoverflow.com/users/20270/hasturkun"}, "edited": false, "score": 0, "creation_date": 1565771659, "post_id": 57487839, "comment_id": 101452107, "body": "@Hasturkun - Nice find on the CNG examples. Microsoft docs don&#39;t provide sample code or link to them. Confer, <a href=\"https://docs.microsoft.com/en-us/windows/win32/api/bcrypt/nf-bcrypt-bcryptopenalgorithmprovider\" rel=\"nofollow noreferrer\">BCryptOpenAlgorithmProvider</a> (and friends). Be careful of the Microsoft docs for <a href=\"https://docs.microsoft.com/en-us/windows/win32/api/bcrypt/ns-bcrypt-bcrypt_authenticated_cipher_mode_info\" rel=\"nofollow noreferrer\">BCRYPT_AUTHENTICATED_CIPHER_MODE_INFO</a>. There are at least 2 errors and omissions. Getting back to the question, do you know how to get more information when a call fails with <code>STATUS_INVALID_PARAMETER</code>?"}, {"owner": {"reputation": 82917, "user_id": 3501, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/1fd5f5cc203c393634379a3b3b7e7a87?s=128&d=identicon&r=PG", "display_name": "Anders", "link": "https://stackoverflow.com/users/3501/anders"}, "edited": false, "score": 0, "creation_date": 1565779308, "post_id": 57487839, "comment_id": 101455909, "body": "Debug it? It might validate all the parameters at the start of the function if you are lucky."}], "answers": [{"tags": [], "owner": {"reputation": 1091, "user_id": 1988, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5yyul.png?s=128&g=1", "display_name": "John Tyner", "link": "https://stackoverflow.com/users/1988/john-tyner"}, "is_accepted": false, "score": 0, "last_activity_date": 1605295368, "last_edit_date": 1605295368, "creation_date": 1605145129, "answer_id": 64796691, "question_id": 57487839, "link": "https://stackoverflow.com/questions/57487839/how-to-determine-which-of-23-parameters-are-status-invalid-parameter/64796691#64796691", "title": "How to determine which of 23 parameters are STATUS_INVALID_PARAMETER?", "body": "<p>I spent the better part of the day today struggling with this very issue. While I don't have a good way to answer your question as to how to determine, in a generic way, which parameter exactly is bad, I'll leave these few tidbits here for posterity:</p>\n<ol>\n<li>The <code>cbTag</code> field of the <code>BCRYPT_AUTHENTICATED_CIPHER_MODE_INFO</code> needs to be set from the beginning. The <code>pbTag</code> isn't necessary until the final call that produces or verifies the tag, but <code>cbTag</code> must always be present.</li>\n<li>The <code>pbNonce</code> field of the <code>BCRYPT_AUTHENTICATED_CIPHER_MODE_INFO</code> structure must remain set for all calls when chaining calls together (by using <code>BCRYPT_AUTH_MODE_CHAIN_CALLS_FLAG</code>).</li>\n<li>All calls during a chain (again using <code>BCRYPT_AUTH_MODE_CHAIN_CALLS_FLAG</code>) of encryptions or decryptions, except for the last, must provide an input whose size is a multiple of the algorithm's block size. I think the documentation actually says this, but it's not abundantly clear when they explicitly tell you not to set the <code>BCRYPT_BLOCK_PADDING</code> flag (with authenticated ciphers).</li>\n</ol>\n<p>The code I'm working on will eventually be part of the library <a href=\"https://gitlab.com/ubiqsecurity/ubiq-c-cpp\" rel=\"nofollow noreferrer\">here</a>, which will hopefully provide a working example to the next person.</p>\n"}], "owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 332, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1605295368, "creation_date": 1565753544, "last_edit_date": 1566207861, "question_id": 57487839, "link": "https://stackoverflow.com/questions/57487839/how-to-determine-which-of-23-parameters-are-status-invalid-parameter", "title": "How to determine which of 23 parameters are STATUS_INVALID_PARAMETER?", "body": "<p>I'm trying to use <code>BCryptEncrypt</code> to authenticate some AAD but the function is failing with <code>STATUS_INVALID_PARAMETER</code>. <code>BCryptEncrypt</code> takes 10 parameters. One of the parameters is <code>BCRYPT_AUTHENTICATED_CIPHER_MODE_INFO</code>. <code>BCRYPT_AUTHENTICATED_CIPHER_MODE_INFO</code> takes another 13 parameters.</p>\n\n<p>Running my test program results in:</p>\n\n<pre><code>&gt;.\\bcrypt-gmac.exe\nBCryptEncrypt error, 0xc000000d (STATUS_INVALID_PARAMETER)\n</code></pre>\n\n<p><code>STATUS_INVALID_PARAMETER</code> is not very helpful in this case.</p>\n\n<p>My question is, how do I determine which of the 23 parameters is causing the error when using Bcrypt?</p>\n\n<p>Is there a way to get extended error information, like through <code>BcryptPropertyGet</code> (maybe a <code>LAST_ERROR_PARAMETER</code> or something similar)?</p>\n\n<p>Or does Microsoft expect us to guess at the problem? In this case, I guess the answer is, <em>\"you can't\"</em>.</p>\n\n<hr>\n\n<p>The Microsoft docs don't provide examples of using Bcrypt. I also cannot find helpful examples on Stack Overflow or MSDN. Even <a href=\"https://rads.stackoverflow.com/amzn/click/com/0735623937\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">Writing Secure Code for Windows Vista</a> fails to provide examples.</p>\n\n<p>Here is the treatment in <a href=\"https://rads.stackoverflow.com/amzn/click/com/0735623937\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">Writing Secure Code for Windows Vista</a>. It amounts to pseudo-code, which is very disappointing:</p>\n\n<p><a href=\"https://i.stack.imgur.com/CxV3J.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CxV3J.jpg\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/SAchg.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/SAchg.jpg\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["c", "pointers", "function-pointers"], "comments": [{"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 0, "creation_date": 1565753318, "post_id": 57487769, "comment_id": 101446250, "body": "All function pointer prototype are same i.e their input argument type &amp; return type are exactly same."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565772582, "post_id": 57487769, "comment_id": 101452518, "body": "See <a href=\"https://stackoverflow.com/questions/6893285/why-do-function-pointer-definitions-work-with-any-number-of-ampersands-or-as\">Why do function pointer definitions work with any number of ampersands &#39;&amp;&#39; or asterisks &#39;*&#39;?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "is_accepted": false, "score": 0, "last_activity_date": 1565753302, "creation_date": 1565753302, "answer_id": 57487815, "question_id": 57487769, "link": "https://stackoverflow.com/questions/57487769/why-these-type-define-get-same-results/57487815#57487815", "title": "Why these type define get same results", "body": "<p><code>function0</code> and <code>function1</code> are the same, you just have redundant parentheses.  <code>function_pointer</code> is a pointer to a <code>function0</code>.</p>\n\n<p>In a function parameter if you specify a function type it's adjusted to be a function pointer type (i.e. the function behaves as if you had specified a function pointer type). So <code>printDigit0</code> and <code>printDigit1</code> behave as if they had the same declaration as <code>printDigit2</code>.</p>\n"}], "owner": {"reputation": 49, "user_id": 9503665, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CIUj6.jpg?s=128&g=1", "display_name": "Dilnar", "link": "https://stackoverflow.com/users/9503665/dilnar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565753302, "creation_date": 1565752844, "question_id": 57487769, "link": "https://stackoverflow.com/questions/57487769/why-these-type-define-get-same-results", "title": "Why these type define get same results", "body": "<p>I write three different type define but they executes same result. so why is this happening. I thought the result might be different because I used the same way to execute the function.</p>\n\n<pre><code>\n#include &lt;stdio.h&gt;\n\nint* digit(int* number){\n    return number;\n}\n\ntypedef int*function0(int*);\ntypedef int*(function1(int*));\ntypedef int*(*function_pointer)(int*);\n\nvoid printDigit0(function0 p, int* digit){\n    printf(\"%d\", *p(digit));\n}\n\nvoid printDigit1(function1 p, int* digit){\n    printf(\"%d\", *p(digit));\n}\n\nvoid printDigit2(function_pointer p, int* digit){\n    printf(\"%d\", *p(digit));\n}\n\nint main() {\n\n    int a = 10;\n    printDigit0(digit, &amp;a);\n    printDigit1(digit, &amp;a);\n    printDigit2(digit, &amp;a);\n    return 0;\n}\n\n\n</code></pre>\n\n<p>they all printed 10</p>\n"}, {"tags": ["c", "atomic", "c11"], "answers": [{"comments": [{"owner": {"reputation": 14214, "user_id": 476410, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a2eca89d3f5a16ae846f501d0596116c?s=128&d=identicon&r=PG", "display_name": "tarabyte", "link": "https://stackoverflow.com/users/476410/tarabyte"}, "edited": false, "score": 1, "creation_date": 1565761254, "post_id": 57488028, "comment_id": 101447844, "body": "Oh I see the difference in the function signatures now.  Thanks."}], "tags": [], "owner": {"reputation": 1774, "user_id": 1201456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b33a546c937f65ce7ef0f29ca0f6a84d?s=128&d=identicon&r=PG", "display_name": "nickelpro", "link": "https://stackoverflow.com/users/1201456/nickelpro"}, "is_accepted": true, "score": 4, "last_activity_date": 1565755450, "creation_date": 1565755450, "answer_id": 57488028, "question_id": 57487647, "link": "https://stackoverflow.com/questions/57487647/difference-between-atomic-load-n-and-atomic-load/57488028#57488028", "title": "Difference between __atomic_load_n and __atomic_load", "body": "<p>They function identically, and internal to GCC they're used based on convenience and clarity.</p>\n\n<p>If you have a pointer you want to atomically load data into, it makes sense to do:</p>\n\n<pre><code>__atomic_load(__ptr, __dest, mem_order);\n</code></pre>\n\n<p>If you have a value or you're trying to return from a function it makes sense to do:</p>\n\n<pre><code>return __atomic_load_n(__ptr, mem_order)\n</code></pre>\n\n<p>Clearly they're isomorphic to one another, and in application code you should use the standard functions provided by <code>&lt;stdatomic.h&gt;</code> not compiler builtins.</p>\n"}], "owner": {"reputation": 14214, "user_id": 476410, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a2eca89d3f5a16ae846f501d0596116c?s=128&d=identicon&r=PG", "display_name": "tarabyte", "link": "https://stackoverflow.com/users/476410/tarabyte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2034, "favorite_count": 0, "accepted_answer_id": 57488028, "answer_count": 1, "score": 6, "last_activity_date": 1565755539, "creation_date": 1565751601, "last_edit_date": 1565755539, "question_id": 57487647, "link": "https://stackoverflow.com/questions/57487647/difference-between-atomic-load-n-and-atomic-load", "title": "Difference between __atomic_load_n and __atomic_load", "body": "<p>I'm trying to learn more about C11 atomics and don't see why I would use <code>__atomic_load_n</code> over <code>__atomic_load</code>.  The documentation simply states that one is generic, but the usages look the same:</p>\n\n<blockquote>\n  <p>Built-in Function: type __atomic_load_n (type *ptr, int memorder)\n  This built-in function implements an atomic load operation. It returns the contents of *ptr.</p>\n  \n  <p>The valid memory order variants are __ATOMIC_RELAXED, __ATOMIC_SEQ_CST, __ATOMIC_ACQUIRE, and __ATOMIC_CONSUME.</p>\n  \n  <p>Built-in Function: void __atomic_load (type *ptr, type *ret, int memorder)\n  This is the generic version of an atomic load. It returns the contents of *ptr in *ret.</p>\n</blockquote>\n\n<p><a href=\"https://gcc.gnu.org/onlinedocs/gcc/_005f_005fatomic-Builtins.html\" rel=\"noreferrer\">https://gcc.gnu.org/onlinedocs/gcc/_005f_005fatomic-Builtins.html</a></p>\n"}, {"tags": ["c", "linux", "seccomp"], "comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1565751905, "post_id": 57487618, "comment_id": 101446020, "body": "Not sure, but <a href=\"https://lwn.net/Articles/738694/\" rel=\"nofollow noreferrer\">The inherent fragility of seccomp()</a> caught my eye. (from those who know the Linux kernel)"}], "answers": [{"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1565758978, "post_id": 57488383, "comment_id": 101447281, "body": "Learned more about <code>seccomp</code> and the <code>no_new_privs</code> flag than I knew before, thank you."}, {"owner": {"reputation": 33, "user_id": 11857495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc660a846509df7ec91efd824bf8cae?s=128&d=identicon&r=PG&f=1", "display_name": "boxjan", "link": "https://stackoverflow.com/users/11857495/boxjan"}, "edited": false, "score": 0, "creation_date": 1565762153, "post_id": 57488383, "comment_id": 101448090, "body": "You are right, but I found that the ``` mtr ``` command  permissioni is ``` -rwxr-xr-x 1 root root 73664 Nov  2  2017 /usr/bin/mtr ```, and when I run it in the program, it notice &#39; Failure to open IPv4 sockets: Operation not permitted&#39;. Do you know any thing about it?"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 33, "user_id": 11857495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc660a846509df7ec91efd824bf8cae?s=128&d=identicon&r=PG&f=1", "display_name": "boxjan", "link": "https://stackoverflow.com/users/11857495/boxjan"}, "edited": false, "score": 0, "creation_date": 1565778916, "post_id": 57488383, "comment_id": 101455728, "body": "@boxjan <code>mtr</code> execs <code>mtr-packet</code> which is setuid"}, {"owner": {"reputation": 33, "user_id": 11857495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc660a846509df7ec91efd824bf8cae?s=128&d=identicon&r=PG&f=1", "display_name": "boxjan", "link": "https://stackoverflow.com/users/11857495/boxjan"}, "edited": false, "score": 0, "creation_date": 1565867523, "post_id": 57488383, "comment_id": 101485227, "body": "@immibis Thank you for your answer sincerely, but I noted another thing, I use <code>strace ping 192.168.1.1 -c 1</code>, it still have no permission, but <code>strace mtr -r ping</code> is working well. I think strace do not set <code>no_new_privs_flag</code> , I try use <code>strace -ff strace -ff ping 192.168.1.1 -c 1</code> to trace it, I can&#39;t find any thing <code>prctl</code> call."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 33, "user_id": 11857495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc660a846509df7ec91efd824bf8cae?s=128&d=identicon&r=PG&f=1", "display_name": "boxjan", "link": "https://stackoverflow.com/users/11857495/boxjan"}, "edited": false, "score": 0, "creation_date": 1565869460, "post_id": 57488383, "comment_id": 101485875, "body": "@boxjan strace calls ptrace (and doesn&#39;t show the ptrace) and ptrace&#39;d processes also can&#39;t use setuid. It&#39;s a different flag."}, {"owner": {"reputation": 33, "user_id": 11857495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc660a846509df7ec91efd824bf8cae?s=128&d=identicon&r=PG&f=1", "display_name": "boxjan", "link": "https://stackoverflow.com/users/11857495/boxjan"}, "edited": false, "score": 0, "creation_date": 1565933560, "post_id": 57488383, "comment_id": 101506105, "body": "Thank you for your answer, I learned more about <code>ptrace</code> and <code>seccomp</code>, thank you."}], "tags": [], "owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "is_accepted": true, "score": 1, "last_activity_date": 1565758681, "creation_date": 1565758681, "answer_id": 57488383, "question_id": 57487618, "link": "https://stackoverflow.com/questions/57487618/why-after-load-seccomp-filter-ping-will-no-work-by-normal-user/57488383#57488383", "title": "Why after load seccomp filter, PING will no work by normal user", "body": "<p><code>ping</code> only works as root. Normally it runs as root because it has the setuid bit set in its file permissions:</p>\n\n<pre><code>-rwsr-xr-x 1 root root 44168 May  8  2014 /bin/ping\n   ^         ^^^^\n   |\nthis 's' is called 'setuid' and means it wants to run as the user which owns it, which is root\n</code></pre>\n\n<p>You cannot use seccomp unless you are root, or you set the <a href=\"https://www.kernel.org/doc/html/latest/userspace-api/no_new_privs.html\" rel=\"nofollow noreferrer\">no_new_privs flag</a>. You are not using seccomp directly, but through a library. It appears the library is setting the flag for you.</p>\n\n<p>The no_new_privs flag means that you cannot run setuid programs. Well, you can run them, but they won't be setuid. They'll run as your user. Which doesn't have permission to send special packets the way <code>ping</code> requires. So <code>ping</code> fails because it doesn't have permission to ping.</p>\n"}], "owner": {"reputation": 33, "user_id": 11857495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc660a846509df7ec91efd824bf8cae?s=128&d=identicon&r=PG&f=1", "display_name": "boxjan", "link": "https://stackoverflow.com/users/11857495/boxjan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 57488383, "answer_count": 1, "score": 1, "last_activity_date": 1565758681, "creation_date": 1565751315, "question_id": 57487618, "link": "https://stackoverflow.com/questions/57487618/why-after-load-seccomp-filter-ping-will-no-work-by-normal-user", "title": "Why after load seccomp filter, PING will no work by normal user", "body": "<p>I use seccomp record 'ping' used syscall. When I run it, it always notice </p>\n\n<blockquote>\n  <p>socket: Operation not permitted.</p>\n</blockquote>\n\n<p>I can run ping in bash very well, but no work after load seccomp filter in program.</p>\n\n<p>But if I run the same program by root, it will run very well.</p>\n\n<p>This is running in Ubuntu 18.04 with 4.15.0-54-generic kernel.</p>\n\n<p>I have tried use Root user to run the program, then in the child progress, I use setuid(1000) to set to a normal user, and it still no work.</p>\n\n<p>If I not use fork, it still notice no premitted.</p>\n\n<p>If I change the seccomp default action to SCMP_ACT_ALLOW, it still no work too.</p>\n\n<p>Here is a simple code by C.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/resource.h&gt;\n#include &lt;sys/time.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;seccomp.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/time.h&gt;\n#include &lt;sys/resource.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;sys/wait.h&gt;\n\nvoid child() {\n        setuid(1000);\n        scmp_filter_ctx ctx = seccomp_init(SCMP_ACT_LOG);\n\n        if (seccomp_load(ctx) != 0) {\n                printf(\"SCMP LAOD ERR!\");\n        } else {\n                seccomp_release(ctx);\n        }\n        execl(\"/bin/ping\", \"ping\", \"-c\", \"1\", \"172.16.1.1\", NULL);\n        printf(\"EXEC FAIL\");\n}\nint main(){\n\n        int p = fork();\n        if (p &lt; 0) {\n                printf(\"Frok ERROR!\");\n                exit(1);\n        }\n        if ( p == 0 ) {\n                child();\n        } else {\n                struct rusage usage;\n                int status;\n                if (wait4(p, &amp;status, WSTOPPED, &amp;usage) == -1) {\n                        kill(p, SIGKILL);\n                }\n        }\n}\n</code></pre>\n\n<p>I use <code>gcc main.c -o main.out -lseccomp</code> to compile it.</p>\n\n<p>English is not my first Language, I'm sorry about my grammar.</p>\n"}, {"tags": ["c", "function-pointers", "c99"], "comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1565752844, "post_id": 57487488, "comment_id": 101446172, "body": "Yes, <code>fp</code> will hold the address to <code>test</code> after the assignment."}], "answers": [{"tags": [], "owner": {"reputation": 110733, "user_id": 1009479, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/wlrC5.jpg?s=128&g=1", "display_name": "Yu Hao", "link": "https://stackoverflow.com/users/1009479/yu-hao"}, "is_accepted": false, "score": 3, "last_activity_date": 1565751246, "creation_date": 1565751246, "answer_id": 57487610, "question_id": 57487488, "link": "https://stackoverflow.com/questions/57487488/can-i-compare-a-function-pointer-to-a-function-for-equality/57487610#57487610", "title": "Can I compare a function pointer to a function for equality?", "body": "<p>The code is valid ANSI C.</p>\n\n<p>Actually what happens is, a function name such as <code>test</code> in your code, is automatically converted to a pointer to function.</p>\n\n<p>You could change <code>test</code> to <code>&amp;test</code>, the result is the same.</p>\n"}, {"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": true, "score": 1, "last_activity_date": 1565765476, "creation_date": 1565765476, "answer_id": 57489492, "question_id": 57487488, "link": "https://stackoverflow.com/questions/57487488/can-i-compare-a-function-pointer-to-a-function-for-equality/57489492#57489492", "title": "Can I compare a function pointer to a function for equality?", "body": "<p>Yes, it is fine. The C standard is pretty self-explanatory in this case (C11 6.3.2.1/4):</p>\n\n<blockquote>\n  <p>A function designator is an expression that has function type. Except when it is the\n  operand of the <code>sizeof</code> operator, or the unary <code>&amp;</code> operator, a function designator with\n  type \u2018\u2018function returning type\u2019\u2019 is converted to an expression that has type \u2018\u2018pointer to function returning type\u2019\u2019.</p>\n</blockquote>\n\n<p>In your case <code>test</code> is an expression with function type. It gets converted to a function pointer of <code>void(*)(void)</code> type. This is a compatible pointer type with <code>fp</code>, so the <code>==</code> operator allows it.</p>\n\n<p>Regarding the equality operator <code>==</code>, the standard says (C11 6.5.9, emphasis mine):</p>\n\n<blockquote>\n  <p><strong>Two pointers compare equal if</strong> and only if both are null pointers, <strong>both are pointers to the same</strong> object (including a pointer to an object and a subobject at its beginning) or <strong>function</strong>,</p>\n</blockquote>\n"}], "owner": {"reputation": 2441, "user_id": 1902237, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/ImNMK.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/1902237/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 57489492, "answer_count": 2, "score": 1, "last_activity_date": 1565765476, "creation_date": 1565749962, "last_edit_date": 1565751275, "question_id": 57487488, "link": "https://stackoverflow.com/questions/57487488/can-i-compare-a-function-pointer-to-a-function-for-equality", "title": "Can I compare a function pointer to a function for equality?", "body": "<p>Is this valid C99 code? (I guess I'm asking whether it's portable)</p>\n\n<pre><code>void test(void){\nreturn;\n}\n\nvoid (*fp)(void) = test;\n\nif (fp == test){ &lt;--- This line\n    printf(\"Success\\n\");\n}\n</code></pre>\n\n<p>I gather only pointers of the same type can be compared with one another, so maybe my question is whether function names like 'test' are just pointer aliases? Or maybe someone can tell me what my question is better than I can :)</p>\n"}, {"tags": ["c"], "answers": [{"comments": [{"owner": {"reputation": 2031, "user_id": 1114498, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28c184063aa5fb8ab1303de158fa9bc8?s=128&d=identicon&r=PG", "display_name": "Necktwi", "link": "https://stackoverflow.com/users/1114498/necktwi"}, "edited": false, "score": 0, "creation_date": 1565751039, "post_id": 57487486, "comment_id": 101445868, "body": "thats what I expected."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 1, "creation_date": 1565752499, "post_id": 57487486, "comment_id": 101446109, "body": "&quot;hidden in the memory&quot; doesn&#39;t seem like a good way of saying &quot;somewhere else&quot;. It may well be in a read-only data segment on architectures which support such a thing."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1565753110, "post_id": 57487486, "comment_id": 101446215, "body": "See <a href=\"https://stackoverflow.com/questions/2589949/string-literals-where-do-they-go\">String literals: Where do they go?</a>"}, {"owner": {"reputation": 1966, "user_id": 10953328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e2f9870ea4a1a14bf72bfe62d6f21ae?s=128&d=identicon&r=PG&f=1", "display_name": "Ignatius", "link": "https://stackoverflow.com/users/10953328/ignatius"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1565754259, "post_id": 57487486, "comment_id": 101446416, "body": "@rici and David C. Rankin: Agreed. Updated the answer."}], "tags": [], "owner": {"reputation": 1966, "user_id": 10953328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e2f9870ea4a1a14bf72bfe62d6f21ae?s=128&d=identicon&r=PG&f=1", "display_name": "Ignatius", "link": "https://stackoverflow.com/users/10953328/ignatius"}, "is_accepted": false, "score": 1, "last_activity_date": 1565754218, "last_edit_date": 1565754218, "creation_date": 1565749956, "answer_id": 57487486, "question_id": 57487463, "link": "https://stackoverflow.com/questions/57487463/weird-const-char-pointer-member-initialization-in-c-struct/57487486#57487486", "title": "Weird const char pointer member initialization in C struct", "body": "<p>The string literal (char array) <code>\"/\"</code> is created in memory, and the constant char pointer <code>mountpoint</code> is initialized with the address to that memory.</p>\n\n<p>There is no \"actual char array size allocated inside this struct\".</p>\n\n<p>It is not different from initializing a local variable like:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>const char *mountpoint = \"/\";\n</code></pre>\n\n<p>The size of the variable (const char *) is only the size of the pointer. The actual string (char array) goes <a href=\"https://stackoverflow.com/questions/2589949/string-literals-where-do-they-go\">somewhere else</a>, which is unrelated to the character pointer itself.</p>\n"}], "owner": {"reputation": 2031, "user_id": 1114498, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28c184063aa5fb8ab1303de158fa9bc8?s=128&d=identicon&r=PG", "display_name": "Necktwi", "link": "https://stackoverflow.com/users/1114498/necktwi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1565754218, "creation_date": 1565749714, "question_id": 57487463, "link": "https://stackoverflow.com/questions/57487463/weird-const-char-pointer-member-initialization-in-c-struct", "title": "Weird const char pointer member initialization in C struct", "body": "<p>In <a href=\"https://github.com/warmcat/libwebsockets\" rel=\"nofollow noreferrer\">libwebsockets</a> library examples there is a variable of type <code>struct lws_http_mount</code> initialized <a href=\"https://github.com/warmcat/libwebsockets/blob/v3.1-stable/minimal-examples/http-server/minimal-http-server-multivhost/minimal-http-server.c#L22\" rel=\"nofollow noreferrer\">here</a>. The <code>stuct lws_http_mount</code> was declared <a href=\"https://github.com/warmcat/libwebsockets/blob/v3.1-stable/include/libwebsockets/lws-context-vhost.h#L877\" rel=\"nofollow noreferrer\">here</a>. Below is the snippet of its declaration and definition for convenience.</p>\n\n<pre><code>struct lws_http_mount {\n   const struct lws_http_mount *mount_next;\n   const char *mountpoint;\n   const char *origin;\n   const char *def;\n   const char *protocol;\n   const struct lws_protocol_vhost_options *cgienv;\n   const struct lws_protocol_vhost_options *extra_mimetypes;\n   const struct lws_protocol_vhost_options *interpret;\n   int cgi_timeout;\n   int cache_max_age;\n   unsigned int auth_mask;\n   unsigned int cache_reusable:1;\n   unsigned int cache_revalidate:1;\n   unsigned int cache_intermediaries:1;\n   unsigned char origin_protocol;\n   unsigned char mountpoint_len;\n   const char *basic_auth_login_file;\n   void *_unused[2];\n};\n\nstatic const struct lws_http_mount mount_localhost1 = {\n   /* .mount_next */           NULL,\n   /* .mountpoint */           \"/\",\n   /* .origin */               \"./mount-origin-localhost1\",\n   /* .def */                  \"index.html\",\n   /* .protocol */              NULL,\n   /* .cgienv */                NULL,\n   /* .extra_mimetypes */       NULL,\n   /* .interpret */             NULL,\n   /* .cgi_timeout */           0,\n   /* .cache_max_age */         0,\n   /* .auth_mask */             0,\n   /* .cache_reusable */        0,\n   /* .cache_revalidate */      0,\n   /* .cache_intermediaries */  0,\n   /* .origin_protocol */       LWSMPRO_FILE,\n   /* .mountpoint_len */        1,\n   /* .basic_auth_login_file */ NULL,\n}\n</code></pre>\n\n<p>The member <code>mountpoint</code> of this struct is of type <code>const char*</code>. This has been initialized to <code>\"\\\"</code> in the variable <code>mount_localhost1</code>. what will be the actual <strong>char array size</strong> allocated inside this struct for its member <code>mountpoint</code>? </p>\n\n<p>I only know that char array member declaration inside the struct should be done as <code>char mountpoint[string_length]</code> instead of <code>const char* mountpoint</code>.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 2, "creation_date": 1565750154, "post_id": 57487416, "comment_id": 101445726, "body": "You&#39;re not getting a warning from your compiler about that? (For gcc and clang, make sure you&#39;re compiling with at least <code>-Wall -Wextra</code> for a good set of warnings)."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 3, "creation_date": 1565751664, "post_id": 57487416, "comment_id": 101445976, "body": "You&#39;re passing a single character, <code>textExtracted[0]</code>, to <code>printf()</code> but telling it that you&#39;ve passed a string (pointer to <code>char</code>) because of the <code>%s</code>; <code>printf()</code> gets upset when you lie to it.   Using <a href=\"https://stackoverflow.com/questions/5431941/\"><code>while (!feof(file))</code> is always wrong</a>; use <code>while (fgets(textExtracted, sizeof(textExtracted), file_handle)</code> to control the loop and forget that <code>feof()</code> exists.  Also, each line overwrites the previous one, so you only print the last line read.  But the format string mismatch causes the crash."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1565751756, "post_id": 57487416, "comment_id": 101445990, "body": "You should also check that there is an <code>argv[1]</code> to use before opening the file.  After opening the file, you should check that succeeded before you use the file stream (<code>file_handle</code>) in your program.  You should only close the stream if it was opened successfully."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1565753265, "post_id": 57487416, "comment_id": 101446238, "body": "A convenient way to do it all at once (using <code>stdin</code> if no argument is given) is by using the <i>ternary</i> expression, e.g. <code>file_handle = argc &gt; 1 ? fopen(argv[1], &quot;r&quot;) : stdin;</code> (and then validate <code>if (!file_handle) { fprintf (stderr, &quot;error: file not found &#39;%s&#39;\\n&quot;, argv[1]); return 1; }</code> Also, how do you propose storing both characters and digits together in an array? Do you just want each row stored as a <code>char *</code> nul-terminated string and then convert the digits to integer values as needed?"}], "answers": [{"tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": false, "score": 1, "last_activity_date": 1565758085, "last_edit_date": 1565758085, "creation_date": 1565757756, "answer_id": 57488262, "question_id": 57487416, "link": "https://stackoverflow.com/questions/57487416/how-to-take-text-file-as-command-line-argument-in-c/57488262#57488262", "title": "How to take text file as command line argument in C", "body": "<p>The problem you present is the classic problem of <em>\"How do I read an unknown number of lines of unknown length from a file?\"</em> The way you approach the problem in a memory efficient manner is to declare a pointer-to-pointer to <code>char</code> and allocate a reasonable number of pointers to begin with and then allocate for each line assigning the starting address for the block holding each line to your pointers as you read each line and allocate for it.</p>\n\n<p>An efficient way to do that is to read each line from a file into a fixed buffer (of size sufficient to hold your longest line without skimping) with <code>fgets</code> or by using POSIX <code>getline</code> which will allocate as needed to hold the line. You then remove the trailing <code>'\\n'</code> from your temporary buffer and obtain the length of the line. </p>\n\n<p>Then allocate a block of memory of <code>length + 1</code> characters (the <code>+1</code> for the <em>nul-terminating</em> character) and assign the address for your new block of memory to your next available pointer (keeping track of the number of pointers allocated and the number of pointers used)</p>\n\n<p>When the number of pointers used equals the number allocated, you simply <code>realloc</code> additional pointers (generally by doubling the current number available, or by allocating for some fixed number of additional pointers) and you keep going. Repeat the process as many times as needed until you have read all of the lines in your input file.</p>\n\n<p>There are a number of ways to implement it and arrange the differing tasks, but all basically boil down to the same thing. Start with a temporary buffer of reasonable size to handle your longest line (without skimping, just in case there is some variation in your input data -- a 1K buffer is cheap insurance, adjust as needed). Add your counters to keep track of the number of pointers allocated and then number used (your index). Open and validate the file given on the command line is open for reading (or read from <code>stdin</code> by default if no argument was given on the command line) For example you could do:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\n#define MAXC 1024   /* if you need a constant, #define one (or more) */\n\nint main (int argc, char **argv) {\n\n    char buf[MAXC] = \"\",        /* temp buffer to hold line read from file */\n         **lines = NULL;        /* pointer-to-pointer to each line */\n    size_t ndx = 0, alloced = 0;    /* current index, no. of ptrs allocated */\n    /* use filename provided as 1st argument (stdin by default) */\n    FILE *fp = argc &gt; 1 ? fopen (argv[1], \"r\") : stdin;\n\n    if (!fp) {  /* validate file open for reading */\n        perror (\"file open failed\");\n        return 1;\n    }\n    ...\n</code></pre>\n\n<p>With your file open and validated, you are ready to read each line, controlling your read loop with your read function itself, and following the outline above to handle storage for each line, e.g.</p>\n\n<pre><code>    while (fgets (buf, MAXC, fp)) {     /* read each line */\n        size_t len;                     /* for line length */\n        if (ndx == alloced) {           /* check if realloc needed */\n            void *tmp = realloc (lines, /* alloc 2X current, or 2 1st time */\n                                (alloced ? 2 * alloced : 2) * sizeof *lines);\n            if (!tmp) {                 /* validate EVERY allocation */\n                perror (\"realloc-lines\");\n                break;  /* if allocation failed, data in lines still good */\n            }\n            lines = tmp;    /* assign new block of mem to lines */\n            alloced = alloced ? 2 * alloced : 2;    /* update ptrs alloced */\n        }\n</code></pre>\n\n<p><strong>Note:</strong> above, the first thing that happens in your read loop is to check if you have pointers available, e.g. <code>if (ndx == alloced)</code>, if your index (number used) is equal to the number allocated, you reallocate more. The <em>ternary</em> above <code>alloced ? 2 * alloced : 2</code> simply asks if you have some previously allocated <code>alloced ?</code> then double the number <code>2 * alloced</code> otherwise (<code>:</code>) just start with <code>2</code> pointers and go from there. In that doubling scheme, you allocate <code>2, 4, 8, 16, ...</code> pointers with each successive reallocation.</p>\n\n<p><strong>Also note:</strong> when you call <code>realloc</code> you always use a temporary pointer, e.g. <code>tmp = realloc (lines, ...)</code> and you <strong><em>never</em></strong> <code>realloc</code> using the pointer itself, e.g. <code>lines = realloc (lines, ...)</code>. When (not if) <code>realloc</code> fails, it returns <code>NULL</code>, and if you assign that to your original pointer -- you have just created a memory leak because the address for <code>lines</code> has been lost meaning you cannot reach or <code>free()</code> the memory you previously allocated.</p>\n\n<p>Now you have confirmed you have a pointer available to assign the address of a block of memory to hold the line, remove the <code>'\\n'</code> from <code>buf</code> and get the length of the line. You can do that conveniently in a single call to <code>strcspn</code> which returns the initial number of characters in the string not containing the delimiter <code>\"\\n\"</code>, e.g.</p>\n\n<pre><code>        buf[(len = strcspn(buf, \"\\n\"))] = 0;    /* trim \\n, get length */\n</code></pre>\n\n<p>(<strong>note:</strong> above you are simply overwriting the <code>'\\n'</code> with the nul-terminating character <code>0</code>, equivalent to <code>'\\0'</code>)</p>\n\n<p>Now that you have the length of the line, you simply allocate <code>length + 1</code> characters and copy from the temporary buffer <code>buf</code> to your new block of memory, e.g.</p>\n\n<pre><code>        if (!(lines[ndx] = malloc (len + 1))) { /* allocate for lines[ndx] */\n            perror (\"malloc-lines[ndx]\");       /* validate combined above */\n            break;\n        }\n        memcpy (lines[ndx++], buf, len + 1);    /* copy buf to lines[ndx] */\n    }                                           /* increment ndx */\n</code></pre>\n\n<p>At that point you are done reading and storing all lines and can simply close the file if not reading from <code>stdin</code>. Here, for example, we just output each of the lines, and then <code>free</code> the storage for each line, finally freeing the memory for the allocated pointers as well, e.g.</p>\n\n<pre><code>    if (fp != stdin) fclose (fp);   /* close file if not stdin */\n\n    for (size_t i = 0; i &lt; ndx; i++) {      /* loop over each storage line */\n        printf (\"lines[%2zu] : %s\\n\", i, lines[i]); /* output line */\n        free (lines[i]);    /* free storage for strings */\n    }\n    free (lines);           /* free pointers */\n}\n</code></pre>\n\n<p>That's it. Putting it altogether, you could do:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\n#define MAXC 1024   /* if you need a constant, #define one (or more) */\n\nint main (int argc, char **argv) {\n\n    char buf[MAXC] = \"\",        /* temp buffer to hold line read from file */\n         **lines = NULL;        /* pointer-to-pointer to each line */\n    size_t ndx = 0, alloced = 0;    /* current index, no. of ptrs allocated */\n    /* use filename provided as 1st argument (stdin by default) */\n    FILE *fp = argc &gt; 1 ? fopen (argv[1], \"r\") : stdin;\n\n    if (!fp) {  /* validate file open for reading */\n        perror (\"file open failed\");\n        return 1;\n    }\n\n    while (fgets (buf, MAXC, fp)) {     /* read each line */\n        size_t len;                     /* for line length */\n        if (ndx == alloced) {           /* check if realloc needed */\n            void *tmp = realloc (lines, /* alloc 2X current, or 2 1st time */\n                                (alloced ? 2 * alloced : 2) * sizeof *lines);\n            if (!tmp) {                 /* validate EVERY allocation */\n                perror (\"realloc-lines\");\n                break;  /* if allocation failed, data in lines still good */\n            }\n            lines = tmp;    /* assign new block of mem to lines */\n            alloced = alloced ? 2 * alloced : 2;    /* update ptrs alloced */\n        }\n        buf[(len = strcspn(buf, \"\\n\"))] = 0;    /* trim \\n, get length */\n        if (!(lines[ndx] = malloc (len + 1))) { /* allocate for lines[ndx] */\n            perror (\"malloc-lines[ndx]\");       /* validate combined above */\n            break;\n        }\n        memcpy (lines[ndx++], buf, len + 1);    /* copy buf to lines[ndx] */\n    }                                           /* increment ndx */\n\n    if (fp != stdin) fclose (fp);   /* close file if not stdin */\n\n    for (size_t i = 0; i &lt; ndx; i++) {      /* loop over each storage line */\n        printf (\"lines[%2zu] : %s\\n\", i, lines[i]); /* output line */\n        free (lines[i]);    /* free storage for strings */\n    }\n    free (lines);           /* free pointers */\n}\n</code></pre>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/fgets_lines_dyn dat/cmdlinefile.txt\nlines[ 0] : A 1 2 3 4 5\nlines[ 1] : B 0 0\nlines[ 2] : C 1 1\n</code></pre>\n\n<p>Redirecting from <code>stdin</code> instead of opening the file:</p>\n\n<pre><code>$ ./bin/fgets_lines_dyn &lt; dat/cmdlinefile.txt\nlines[ 0] : A 1 2 3 4 5\nlines[ 1] : B 0 0\nlines[ 2] : C 1 1\n</code></pre>\n\n<p><strong>Memory Use/Error Check</strong></p>\n\n<p>In any code you write that dynamically allocates memory, you have 2 <em>responsibilities</em> regarding any block of memory allocated: (1) <em>always preserve a pointer to the starting address</em> for the block of memory so, (2) it can be <em>freed</em> when it is no longer needed.</p>\n\n<p>It is imperative that you use a memory error checking program to insure you do not attempt to access memory or write beyond/outside the bounds of your allocated block, attempt to read or base a conditional jump on an uninitialized value, and finally, to confirm that you free all the memory you have allocated. </p>\n\n<p>For Linux <code>valgrind</code> is the normal choice. There are similar memory checkers for every platform. They are all simple to use, just run your program through it.</p>\n\n<pre><code>$ valgrind ./bin/fgets_lines_dyn dat/cmdlinefile.txt\n==6852== Memcheck, a memory error detector\n==6852== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.\n==6852== Using Valgrind-3.12.0 and LibVEX; rerun with -h for copyright info\n==6852== Command: ./bin/fgets_lines_dyn dat/cmdlinefile.txt\n==6852==\nlines[ 0] : A 1 2 3 4 5\nlines[ 1] : B 0 0\nlines[ 2] : C 1 1\n==6852==\n==6852== HEAP SUMMARY:\n==6852==     in use at exit: 0 bytes in 0 blocks\n==6852==   total heap usage: 6 allocs, 6 frees, 624 bytes allocated\n==6852==\n==6852== All heap blocks were freed -- no leaks are possible\n==6852==\n==6852== For counts of detected and suppressed errors, rerun with: -v\n==6852== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)\n</code></pre>\n\n<p>Always confirm that you have freed all memory you have allocated and that there are no memory errors.</p>\n\n<p>While allocating storage for each pointer and each line may look daunting at first, it is a problem you will face over and over again, whether reading and storing lines from a file, integer or floating point values in some 2D representation of the data, etc... it is worth the time it takes to learn. Your alternative is to declare a fixed size 2D array and hope your line length never exceeds the declared width and the number of lines never exceeds your declared number of rows. (you should learn that as well, but the limitation become quickly apparent)</p>\n\n<p>Look things over and let me know if you have further questions.</p>\n"}, {"tags": [], "owner": {"reputation": 33821, "user_id": 45685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y4RJr.jpg?s=128&g=1", "display_name": "AndersK", "link": "https://stackoverflow.com/users/45685/andersk"}, "is_accepted": false, "score": 2, "last_activity_date": 1580032163, "last_edit_date": 1580032163, "creation_date": 1565760462, "answer_id": 57488601, "question_id": 57487416, "link": "https://stackoverflow.com/questions/57487416/how-to-take-text-file-as-command-line-argument-in-c/57488601#57488601", "title": "How to take text file as command line argument in C", "body": "<p>Some points:</p>\n\n<pre><code>int main(int argc, char* argv[]) {\n</code></pre>\n\n<p>I suggest you check number of arguments here before proceeding further</p>\n\n<pre><code>setup_screen();\nsetup();\n\n// File input\nchar textExtracted[250];\n</code></pre>\n\n<p>Declaration can be joined but always always check return values from I/O</p>\n\n<pre><code>FILE* file_handle = = fopen(argv[1], \"r\");\nif (NULL == file_handle)\n{\n  perror(argv[1]);\n  return EXIT_FAILURE;\n}\n</code></pre>\n\n<p>below is not the correct way to read from a file, instead you should\ntry and read from the file first, then check for error/eof/enuff bytes read</p>\n\n<pre><code>// while(fgets(textExtracted,sizeof(textExtracted), 1, file_handle) &gt; 0) {}\n\nwhile(!feof(file_handle)){\n    fgets(textExtracted, 150, file_handle);\n}\n</code></pre>\n\n<p>It looks like you think fgets appends to textExtracted when you call it\nmultiple times, it doesn't! every line in the file will overwrite the previously read line. Note also that the \\n character is included in your buffer.</p>\n\n<p>But since your file appears to be pretty small, you could read the whole \ncontent into your buffer and work with that. </p>\n\n<pre><code>// int size = fread(textExtracted, sizeof(textExtracted), 1, file_handle);\n</code></pre>\n\n<p>Better is to check the size of the file first and then allocate a buffer with malloc to hold the whole file or read the file character by character and do whatever commands you need to do on the fly. e.g. a switch statement is excellent as a statemachine</p>\n\n<pre><code>switch( myreadchar )\n{\n   case 'A':\n     break;\n   case 'B':\n     break;\n   ...\n}\n</code></pre>\n\n<p>textExtracted[0] is one character, textExtracted is the whole array so instead of</p>\n\n<pre><code>printf(\"%s\", textExtracted[0]);\n</code></pre>\n\n<p>write </p>\n\n<pre><code>printf(\"%s\", textExtracted);\n</code></pre>\n\n<p>or even better</p>\n\n<pre><code>fputs(textExtracted, stdout);\n\nreturn 0;   \n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 11531878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a39a45798015a431d83764c09fd0d60?s=128&d=identicon&r=PG&f=1", "display_name": "Billbert", "link": "https://stackoverflow.com/users/11531878/billbert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1144, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1580032163, "creation_date": 1565749383, "question_id": 57487416, "link": "https://stackoverflow.com/questions/57487416/how-to-take-text-file-as-command-line-argument-in-c", "title": "How to take text file as command line argument in C", "body": "<p>Bascially, Im trying to accept a command line text file so that when I run the program as \"program instructions.txt\", it stores the values listed in instructions. However I am having trouble testing what i currently have, as it is giving me the error \"segmentation fault core dumped\".</p>\n\n<pre><code>int main(int argc, char* argv[]) {\n    setup_screen();\n    setup();\n\n    // File input\n    char textExtracted[250];\n    FILE* file_handle;\n    file_handle = fopen(argv[1], \"r\");\n    while(!feof(file_handle)){\n        fgets(textExtracted, 150, file_handle);\n    }\n\n    fclose(file_handle);\n\n    printf(\"%s\", textExtracted[0]);\n\n    return 0;   \n}\n</code></pre>\n\n<p>Inside the text file is </p>\n\n<pre><code>A 1 2 3 4 5\nB 0 0\nC 1 1\n</code></pre>\n\n<p>Im just trying to store each line in an array and then print them. </p>\n"}, {"tags": ["c", "gcc", "struct", "linux-kernel", "initializer"], "comments": [{"owner": {"reputation": 57967, "user_id": 2805305, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/442d249754d1725d9510cf06fa46b964?s=128&d=identicon&r=PG&f=1", "display_name": "bolov", "link": "https://stackoverflow.com/users/2805305/bolov"}, "edited": false, "score": 1, "creation_date": 1565750877, "post_id": 57487415, "comment_id": 101445838, "body": "<a href=\"https://stackoverflow.com/questions/6305396/whats-this-c-syntax-that-puts-a-brace-surrounded-block-where-an-expression-is\" title=\"whats this c syntax that puts a brace surrounded block where an expression is\">stackoverflow.com/questions/6305396/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 32686, "user_id": 10396, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ddbfebb47432f6599da361df6a135c7c?s=128&d=identicon&r=PG", "display_name": "AShelly", "link": "https://stackoverflow.com/users/10396/ashelly"}, "edited": false, "score": 1, "creation_date": 1565751151, "post_id": 57487565, "comment_id": 101445887, "body": "I was working on an answer and I got hung up on explaining why the statement expression uses <code>*({...;&amp;work;})</code> instead of simply <code>({...;work;})</code>.  Why the need to take the address and then dereference the &quot;return value&quot;?"}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "reply_to_user": {"reputation": 32686, "user_id": 10396, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ddbfebb47432f6599da361df6a135c7c?s=128&d=identicon&r=PG", "display_name": "AShelly", "link": "https://stackoverflow.com/users/10396/ashelly"}, "edited": false, "score": 1, "creation_date": 1565751396, "post_id": 57487565, "comment_id": 101445929, "body": "@AShelly That I&#39;m not so sure of.  Taking the address of the variable prevents undefined behavior when reading an uninitialized variable, however the function call is doing that already."}, {"owner": {"reputation": 10702, "user_id": 2079103, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XlVYy.png?s=128&g=1", "display_name": "clearlight", "link": "https://stackoverflow.com/users/2079103/clearlight"}, "edited": false, "score": 0, "creation_date": 1565751966, "post_id": 57487565, "comment_id": 101446039, "body": "Ahh, so the part I wasn&#39;t getting was that I can initialize a struct from another struct without using a pointer (also didn&#39;t know about statement expressions as a gcc extension, so thanks for that):  Apparently this is legit, at least in gcc, because it compiled:  <code>struct foo { int a, b }; struct foo zoo = { 1, 2 }; struct foo bar = zoo;</code>  So that completes my understanding and accepting your answer now."}, {"owner": {"reputation": 10702, "user_id": 2079103, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XlVYy.png?s=128&g=1", "display_name": "clearlight", "link": "https://stackoverflow.com/users/2079103/clearlight"}, "edited": false, "score": 0, "creation_date": 1565752486, "post_id": 57487565, "comment_id": 101446106, "body": "Fantastic edit @dbush, that reference to the linux kernel source change is really helpful. Interesting to see how it evolved and why. Great explanation!"}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 6, "last_activity_date": 1565751902, "last_edit_date": 1565751902, "creation_date": 1565750858, "answer_id": 57487565, "question_id": 57487415, "link": "https://stackoverflow.com/questions/57487415/advanced-c-question-please-explain-c-construct-foobar-bar/57487565#57487565", "title": "Advanced C question: Please explain C construct *({ foo(&amp;bar); &amp;bar; })", "body": "<p>The syntax of statements within a <code>({ ... })</code> block is a <strong>statement expression</strong> which is a GCC extension.  It allows you to run a series of statements where the last statement in the block is an expression which becomes the value of the full statement expression.  So in this case the statement expression has the value <code>&amp;work</code>.</p>\n\n<p>Since the statement expression evaluates to <code>&amp;work</code>, the <code>*</code> right before the statement expression gives you <code>*&amp;work</code>, or equivalently <code>work</code> as the value of the macro <code>COMPLETION_INITIALIZER_ONSTACK</code>.</p>\n\n<p>Now let's look at <code>DECLARE_COMPLETION_ONSTACK</code>.  When it is used:</p>\n\n<pre><code>DECLARE_COMPLETION_ON_STACK(comp);\n</code></pre>\n\n<p>It expands to:</p>\n\n<pre><code>struct completion comp= COMPLETION_INITIALIZER_ONSTACK(comp);\n</code></pre>\n\n<p>Which further expands to:</p>\n\n<pre><code>struct completion comp = (*({ init_completion(&amp;comp ); &amp;comp; }))\n</code></pre>\n\n<p>Breaking this down, the variable <code>comp</code> is being initialized with a statement expression.  The first statement in that expression is a call to the function <code>init_completion</code> which is passed the address of the new variable.  This function sets the values of the variable which at this point hasn't actually been initialized yet.  The next (and last) statement in the statement expression is <code>&amp;comp</code> which is the value of the statement expression.  This address is then dereferenced giving us <code>comp</code> which is then assigned to <code>comp</code>.  So the variable is being validly initialized with itself!</p>\n\n<p>Normally initializing a variable with itself would invoke undefined behavior because you would be trying to read an uninitialized variable, but not in this case because the variable's address is passed to a function which assigns values to its fields before it's initialized.</p>\n\n<p>You might ask why <code>COMPLETION_INITIALIZER_ONSTACK</code> was not defined like this:</p>\n\n<pre><code>#define COMPLETION_INITIALIZER_ONSTACK(work) \\\n    ({ init_completion(&amp;work); work; })\n</code></pre>\n\n<p>If done this way, a temporary variable is created on the stack.  Using the addrress prevents this from happening.  In fact the code originally did this but was changed to what you see in the following commit:</p>\n\n<p><a href=\"https://github.com/torvalds/linux/commit/ec81048cc340bb03334e6ca62661ecc0a684897a#diff-f4f6d7a50d07f6f07835787ec35565bb\" rel=\"nofollow noreferrer\">https://github.com/torvalds/linux/commit/ec81048cc340bb03334e6ca62661ecc0a684897a#diff-f4f6d7a50d07f6f07835787ec35565bb</a></p>\n"}, {"comments": [{"owner": {"reputation": 1077, "user_id": 4460514, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/aE5kE.jpg?s=128&g=1", "display_name": "ruach", "link": "https://stackoverflow.com/users/4460514/ruach"}, "edited": false, "score": 0, "creation_date": 1566266321, "post_id": 57487654, "comment_id": 101592948, "body": "It seems that your point is that a compiler cannot optimize out the statically allocated data structure, x in test_on_classic function, when it is used inside the statement expression, but the variable is not allocated on the stack when it is used in the usual form, right? Then what is the advantage of having a local variable in the stack that is not used anymore outside of the function by making use of the statement expression?"}, {"owner": {"reputation": 1077, "user_id": 4460514, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/aE5kE.jpg?s=128&g=1", "display_name": "ruach", "link": "https://stackoverflow.com/users/4460514/ruach"}, "edited": false, "score": 0, "creation_date": 1566266329, "post_id": 57487654, "comment_id": 101592951, "body": "As far as I know, the statement expression is useful when the macro function is used with the argument that has a side effect, which means preventing multiple side effects could ensue during macro expansion. Although it seems that kernel code utilizes statement expression to shorten the code line by intermingling expression and initialization, which might not follow the original design purpose of the statement expression, I cannot find any code example that can make use of this stack-allocated properties. Is there any code example that rely on this feature in other ways?"}], "tags": [], "owner": {"reputation": 57967, "user_id": 2805305, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/442d249754d1725d9510cf06fa46b964?s=128&d=identicon&r=PG&f=1", "display_name": "bolov", "link": "https://stackoverflow.com/users/2805305/bolov"}, "is_accepted": false, "score": 4, "last_activity_date": 1565752033, "last_edit_date": 1565752033, "creation_date": 1565751650, "answer_id": 57487654, "question_id": 57487415, "link": "https://stackoverflow.com/questions/57487415/advanced-c-question-please-explain-c-construct-foobar-bar/57487654#57487654", "title": "Advanced C question: Please explain C construct *({ foo(&amp;bar); &amp;bar; })", "body": "<p><a href=\"https://stackoverflow.com/a/57487565/2805305\">The answer from dbush</a> is excellent in showing what a statement expression is. I would like however to add what is achieved with this contrived way. The main purpose of the macro is to force the compiler to allocate the stack for the object. Without it, the optimizer could elide it.</p>\n\n<p>I've created a simpler but equivalent code:</p>\n\n<pre><code>struct X\n{\n    int a;\n    long long b;\n};\n\nvoid init_x(struct X*);\nX make_x();\n\nint test_classic()\n{\n    struct X x = make_x();\n\n    return x.a; // we are returning a member of `x`\n                // and still the optimizer will skip the creation of x on the stack\n}\n\nint test_on_stack()\n{\n    struct X x = (*({init_x(&amp;x); &amp;x;}));  \n\n    return 24;  // even if x is unused after the initializer\n                // the compiler is forced to allocate space for it on the stack\n}\n</code></pre>\n\n<p>On the classic way of initializing a variable the compiler can and gcc indeed does eliminate the object from the stack (in this case because the result is already in <code>eax</code> after calling <code>make_x</code>):</p>\n\n<pre><code>test_classic():\n        sub     rsp, 8\n        call    make_x()\n        add     rsp, 8\n        ret\n</code></pre>\n\n<p>However with the linux <code>DECLARE_COMPLETION_ONSTACK</code> equivalent the compiler is forced to create the object on the stack as there is a call to a function that passes the address of the object, so the object creation cannot be elided:</p>\n\n<pre><code>test_on_stack():\n        sub     rsp, 24\n        mov     rdi, rsp\n        call    init_x(X*)\n        mov     eax, DWORD PTR [rsp]\n        add     rsp, 24\n        ret\n</code></pre>\n\n<hr>\n\n<p>I guess the same could still be achieved by calling init after the initialization:</p>\n\n<pre><code>struct X x;\ninit_x(&amp;x);\n</code></pre>\n\n<p>Maybe someone more experienced could shed further light here.</p>\n"}], "owner": {"reputation": 10702, "user_id": 2079103, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XlVYy.png?s=128&g=1", "display_name": "clearlight", "link": "https://stackoverflow.com/users/2079103/clearlight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 4, "accepted_answer_id": 57487565, "answer_count": 2, "score": 5, "last_activity_date": 1565752033, "creation_date": 1565749367, "last_edit_date": 1565750414, "question_id": 57487415, "link": "https://stackoverflow.com/questions/57487415/advanced-c-question-please-explain-c-construct-foobar-bar", "title": "Advanced C question: Please explain C construct *({ foo(&amp;bar); &amp;bar; })", "body": "<p>This is ultimately a C question that arose when studying code in completion.h of the Linux kernel source, where I see a C technique I've never used in C before. Although have a vague sense what it's doing, I'd like to fine tune my understanding with a precise description, and I'm not quite sure how to search for the answer with Google without a potentially a long ordeal.</p>\n\n<p>The relevant lines of code from the linux kernel's <a href=\"https://elixir.bootlin.com/linux/latest/source/include/linux/completion.h#L69\" rel=\"nofollow noreferrer\">completion.h</a>:</p>\n\n<pre><code>struct completion {\n    unsigned int done;\n    wait_queue_head_t wait;\n};\n\n#define COMPLETION_INITIALIZER_ONSTACK(work) \\\n    (*({ init_completion(&amp;work); &amp;work; }))\n\n#define DECLARE_COMPLETION_ONSTACK(work) \\\n    struct completion work = COMPLETION_INITIALIZER_ONSTACK(work)\n\nstatic inline void init_completion(struct completion *x)\n{\n    x-&gt;done = 0;\n    init_waitqueue_head(&amp;x-&gt;wait);\n}\n</code></pre>\n\n<p>and in use:</p>\n\n<pre><code>int myFunc()\n{\n   DECLARE_COMPLETION_ON_STACK(comp);\n   .\n   .\n   .\n   wait_for_completion(&amp;comp);\n}\n</code></pre>\n\n<p>Specifically, I want to understand the code \nof <code>COMPLETION_INITIALIZER_ON_STACK</code>.</p>\n\n<p>I believe the braced body of two statements <code>{ init_completion(&amp;work); &amp;work; }</code> results in simply a value, <code>&amp;work</code> (a NOP statement), which from what I know about braced blocks in C, yeilds the value of the last assignment, in this case, the address of a struct.</p>\n\n<p>But it is the enclosing of all of that in <code>*( )</code> that gets interesting (and where I am bewildered). </p>\n\n<ol>\n<li>What is that 'fetch' doing <em>exactly</em>? </li>\n<li>Is it resulting in the function <code>init_completion()</code> being invoked (probably)? </li>\n<li>And what is the result of a pointer to a struct as a fetched object?</li>\n<li>In what contexts can it be applied?</li>\n</ol>\n\n<p>I'm not sure what is happening, how to conceive of it, and how it is it possible to assign that result to <code>struct completion work</code> as is done in in <code>DECLARE_COMPLETION_ON_STACK</code>.</p>\n\n<p>Any education about this would be appreciated.</p>\n"}, {"tags": ["c", "matrix"], "comments": [{"owner": {"reputation": 308, "user_id": 3927579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79c6744b7d14faaaa0cf636601f0aeb5?s=128&d=identicon&r=PG", "display_name": "tbejos", "link": "https://stackoverflow.com/users/3927579/tbejos"}, "edited": false, "score": 0, "creation_date": 1565748700, "post_id": 57487293, "comment_id": 101445469, "body": "Currently sum is not initialized, if you add <code>sum = 0;</code> directly after the <code>&#47;&#47;Sum</code> comment but before the second set of loops does it fix any of your issues?"}], "answers": [{"tags": [], "owner": {"reputation": 552, "user_id": 9668481, "user_type": "registered", "profile_image": "https://graph.facebook.com/1520623474717268/picture?type=large", "display_name": "Saurav Pathak", "link": "https://stackoverflow.com/users/9668481/saurav-pathak"}, "is_accepted": false, "score": 2, "last_activity_date": 1565753963, "creation_date": 1565753963, "answer_id": 57487874, "question_id": 57487293, "link": "https://stackoverflow.com/questions/57487293/how-to-find-the-maximum-and-sum-of-a-row-within-a-matrix/57487874#57487874", "title": "How to find the maximum and sum of a row within a matrix", "body": "<p>You are operating addition operation on int sum before initializing it to 0. Initialize sum to 0 while declaring and that should fix your issue. </p>\n"}], "owner": {"reputation": 39, "user_id": 10195332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6aa8618587bc4ab264c554b4955c2974?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan Grady", "link": "https://stackoverflow.com/users/10195332/ryan-grady"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565753963, "creation_date": 1565748213, "question_id": 57487293, "link": "https://stackoverflow.com/questions/57487293/how-to-find-the-maximum-and-sum-of-a-row-within-a-matrix", "title": "How to find the maximum and sum of a row within a matrix", "body": "<p>To the best of my knowledge what I have entered should be working properly, but I am new to C and am unable to come up with a reason as to why it isn't. Each function works fine separately but for some reason whilst together they produce weird errors. </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include&lt;conio.h&gt;\n\nmain()\n{\n   int m, n, c, d, sum, matrix[10][10], maximum;\n\n   printf(\"Enter the number of rows and columns of matrix\\n\");\n   scanf(\"%d%d\",&amp;m,&amp;n);\n   printf(\"Enter the elements of matrix\\n\");\n\n   for( c = 0 ; c &lt; m ; c++ )\n   {\n      for( d = 0 ; d &lt; n ; d++ )\n      {\n         scanf(\"%d\",&amp;matrix[c][d]);\n      }\n   }\n\n   maximum = matrix[0][0];\n\n//Maximum\n   for( c = 0 ; c &lt; m ; c++ )\n   {\n      for( d = 0 ; d &lt; n ; d++ )\n      {\n         if ( matrix[c][d] &gt; maximum )\n            maximum = matrix[c][d];\n      }\n   }\n   //Sum\n   for (c = 0; c &lt; m; ++c)\n   {\n        for (d = 0; d &lt; n; ++d)\n        {\n            sum = sum + matrix[c][d] ;\n        }\n\n        printf(\"Sum of the %d row is = %d\\n\", c, sum);\n        sum = 0;\n\n    }\n\n    printf(\"Maximum element in matrix is %d\\n\", maximum);\n\n   getch();\n   return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "if-statement"], "comments": [{"owner": {"reputation": 57967, "user_id": 2805305, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/442d249754d1725d9510cf06fa46b964?s=128&d=identicon&r=PG&f=1", "display_name": "bolov", "link": "https://stackoverflow.com/users/2805305/bolov"}, "edited": false, "score": 0, "creation_date": 1565735342, "post_id": 57486010, "comment_id": 101443078, "body": "this is a great time to start debugging your own program. You can&#39;t survive in the programming world without debugging, the sooner you learn it, the better. It will save you countless hours of staring at your code wondering why it isn&#39;t working. I really can&#39;t stress enough how important and helpful the ability to debug your own programs is. So take a break from whatever you are doing and learn it now! And you will be able to solve these kinds of bugs on your own."}, {"owner": {"reputation": 57967, "user_id": 2805305, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/442d249754d1725d9510cf06fa46b964?s=128&d=identicon&r=PG&f=1", "display_name": "bolov", "link": "https://stackoverflow.com/users/2805305/bolov"}, "edited": false, "score": 0, "creation_date": 1565735473, "post_id": 57486010, "comment_id": 101443109, "body": "also you&#39;ve got a lot of repetitive code. Strongly consider using functions."}, {"owner": {"reputation": 9301, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "edited": false, "score": 1, "creation_date": 1565735771, "post_id": 57486010, "comment_id": 101443172, "body": "You should inspect the actual value of <code>change</code> after every operation and you&#39;d find out that floating point math isn&#39;t as precise as you may think. See e.g. <a href=\"https://cs50.stackexchange.com/questions/2259/greedy-c-works-for-all-numbers-except-4-2\" title=\"greedy c works for all numbers except 4 2\">cs50.stackexchange.com/questions/2259/&hellip;</a>"}, {"owner": {"reputation": 11, "user_id": 11924597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cd774cd96e65b43588827676e917853?s=128&d=identicon&r=PG&f=1", "display_name": "slimeysl", "link": "https://stackoverflow.com/users/11924597/slimeysl"}, "reply_to_user": {"reputation": 57967, "user_id": 2805305, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/442d249754d1725d9510cf06fa46b964?s=128&d=identicon&r=PG&f=1", "display_name": "bolov", "link": "https://stackoverflow.com/users/2805305/bolov"}, "edited": false, "score": 0, "creation_date": 1565736296, "post_id": 57486010, "comment_id": 101443291, "body": "Thank you for the advice @bolov"}, {"owner": {"reputation": 11, "user_id": 11924597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cd774cd96e65b43588827676e917853?s=128&d=identicon&r=PG&f=1", "display_name": "slimeysl", "link": "https://stackoverflow.com/users/11924597/slimeysl"}, "reply_to_user": {"reputation": 9301, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "edited": false, "score": 0, "creation_date": 1565736656, "post_id": 57486010, "comment_id": 101443366, "body": "Thank you @Bob__"}, {"owner": {"reputation": 16851, "user_id": 5460719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0f2a855c86ad12fc2988d3948b69ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Karzes", "link": "https://stackoverflow.com/users/5460719/tom-karzes"}, "edited": false, "score": 2, "creation_date": 1565738113, "post_id": 57486010, "comment_id": 101443688, "body": "You&#39;re probably running into floating point roundoff errors.  See the duplicate link for an explanation of why using float for exact results generally won&#39;t work.  You need to keep all of your amounts as integers (i.e. pennies).  Then your arithmetic will be exact."}], "owner": {"reputation": 11, "user_id": 11924597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cd774cd96e65b43588827676e917853?s=128&d=identicon&r=PG&f=1", "display_name": "slimeysl", "link": "https://stackoverflow.com/users/11924597/slimeysl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "closed_date": 1565738925, "answer_count": 0, "score": 0, "last_activity_date": 1565735052, "creation_date": 1565735052, "question_id": 57486010, "link": "https://stackoverflow.com/questions/57486010/where-in-the-if-statement-does-my-program-go-wrong", "closed_reason": "Duplicate", "title": "Where in the if statement does my program go wrong?", "body": "<p>The program takes a monetary value in, for ex. (3.85)\nand should return the minimum number of coins needed to make that value.\nThe answer to this being 16</p>\n\n<p>Another example would be 2.37\nWhich should return 12</p>\n\n<p>The coin values are 0.25, 0.10, 0.05, and 0.01</p>\n\n<pre><code>    float change = cash;\n    int num = 0;\n    do\n    {\n        change = change - 0.25;\n        num++;\n    }\n    while (change &gt;= 0.25);       \n\n    if (change == 0.00)\n    {\n        printf(\"%i\\n\", num);\n    }\n    else if (change != 0.00)\n    {\n        do\n        {\n            change = change - 0.10;\n            num++;\n        }\n        while (change &gt;= 0.10);\n\n    }\n    if (change == 0.00)\n    {\n        printf(\"%i\\n\", num);\n    }\n    else if (change != 0.00)\n    {\n        do\n        {\n            change = change - 0.05;\n            num++;\n        }\n        while (change &gt;= 0.05);\n\n    }\n    if (change == 0.00)\n    {\n        printf(\"%i\\n\", num);\n    }\n    else if (change != 0.00)\n    {\n        do\n        {\n            change = change - 0.01;\n            num++;\n        }\n        while (change &gt;= 0.00);\n\n        printf(\"%i\\n\", num);\n    }\n</code></pre>\n\n<p>I put in 2.37 and I get 12. but when I put in 3.85 I get 18. When it should be 16</p>\n"}, {"tags": ["c", "gcc", "assembly", "inline-assembly"], "comments": [{"owner": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 2, "creation_date": 1565733929, "post_id": 57485761, "comment_id": 101442762, "body": "It means the input value will be in the same register as the output value (as that is operand 0)."}, {"owner": {"reputation": 6093, "user_id": 2189500, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/109f747845a9ce762a1fff72eb8cf6f3?s=128&d=identicon&r=PG", "display_name": "David Wohlferd", "link": "https://stackoverflow.com/users/2189500/david-wohlferd"}, "edited": false, "score": 0, "creation_date": 1565739363, "post_id": 57485761, "comment_id": 101443946, "body": "Which docs are you reading? From <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html#InputOperands\" rel=\"nofollow noreferrer\">gcc</a>: <i>Input constraints can also be digits (for example, &quot;0&quot;). This indicates that the specified input must be in the same place as the output constraint at the (zero-based) index in the output constraint list.</i>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11810714"}, "reply_to_user": {"reputation": 6093, "user_id": 2189500, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/109f747845a9ce762a1fff72eb8cf6f3?s=128&d=identicon&r=PG", "display_name": "David Wohlferd", "link": "https://stackoverflow.com/users/2189500/david-wohlferd"}, "edited": false, "score": 0, "creation_date": 1565747554, "post_id": 57485761, "comment_id": 101445278, "body": "@DavidWohlferd the gcc 6.3 doc."}, {"owner": {"reputation": 6093, "user_id": 2189500, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/109f747845a9ce762a1fff72eb8cf6f3?s=128&d=identicon&r=PG", "display_name": "David Wohlferd", "link": "https://stackoverflow.com/users/2189500/david-wohlferd"}, "edited": false, "score": 0, "creation_date": 1565776846, "post_id": 57485761, "comment_id": 101454659, "body": "Ok.  The text I was quoting has been in the docs since <a href=\"https://gcc.gnu.org/onlinedocs/gcc-5.5.0/gcc/Extended-Asm.html#InputOperands\" rel=\"nofollow noreferrer\">at least 5.5</a> so I expect you should have it there."}], "answers": [{"comments": [{"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1565734170, "post_id": 57485860, "comment_id": 101442809, "body": "I think as well that they may not understand how the <code>0</code> is arrived at. I think some mention of how the constraints are counted would help."}], "tags": [], "owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": false, "score": 6, "last_activity_date": 1565734961, "last_edit_date": 1565734961, "creation_date": 1565733916, "answer_id": 57485860, "question_id": 57485761, "link": "https://stackoverflow.com/questions/57485761/what-does-the-0-9-constraint-do-in-gcc-inline-assembly/57485860#57485860", "title": "What does the 0..9 constraint do in GCC Inline Assembly?", "body": "<p>It's like a way to split up a <code>\"+r\"(value)</code> input/output operand into separate operands (with separate C variables) for input and output while still forcing them to pick the same register.</p>\n\n<p>Specifically <code>\"0\"</code> means \"input operand in the same register as operand 0\", which in this case is <code>\"=r\"(value)</code>.  So whatever register <code>%0</code> picks, <code>%1</code> will be the same register.  <strong>Operands are counted left to right, starting with <code>0</code>.</strong>  The same numbering of operands for <code>%0</code>, <code>%1</code>, etc. in the asm template applies when a matching constraint refers to an earlier operand.</p>\n\n<p>I've only ever seen it used with an input constraint matching an output constraint.  This lets you omit it from the template without risk that the compiler is expecting your asm template to copy from one reg to another.</p>\n\n<p><strong>Using the same C variable for both input and output is easier with <code>\"+r\"(value)</code>.</strong>  Matching constraints for this is pointless complexity.</p>\n\n<p>Maybe <code>\"+r\"</code> was only added in a later gcc version because you do see matching constraints used when a read/write operand would be easier.</p>\n\n<blockquote>\n  <p>If a digit is used together with letters within the same alternative, the digit should come last.\"</p>\n</blockquote>\n\n<p>This is considering the possibility of a constraint that gives the compiler a choice of multiple constraints.  e.g. <code>\"rm\"</code> lets the compiler choose register or memory.</p>\n\n<p><code>\"a0\"</code> on x86 would choose either EAX or the same register as operand <code>0</code>.  I'm not sure when that would be useful.  Maybe it can be used with an early-clobber to tell the compiler that it's still ok for this input to be in the same register as a certain output?  But optionally any register, like with <code>\"r0\"</code>?</p>\n\n<p>Obviously if you use a constraint like <code>\"r0\"</code> you (normally) need to explicitly use <code>%1</code> (or whatever number or named operand it has) in the asm template since you don't know which location the compiler will pick given the surrounding code and optimization levels.</p>\n\n<hr>\n\n<p>When debugging constraints, <strong>it can be useful to use an asm comment that includes the constraints</strong>, including ones you're going to make assumptions about.</p>\n\n<pre><code>asm (\"swap %0    # other operand: %1  \"  : \"=r\"(output) : \"0\"(input));\n</code></pre>\n\n<p>The resulting asm will print the same register name twice, for both <code>%0</code> and <code>%1</code>.  This case is trivial; it gets more interesting in more complicated cases.</p>\n\n<p>Like if you'd used <code>\"r\"(input)</code>, your code might happen to work because the compiler did pick the same reg for input and output (because no early-clobber).  But then when it breaks because it picks a different reg for <code>output</code> (and expects the original value of <code>input</code> to still be in its register unchanged), you can debug it by looking at what regs the constraints picked and then realizing you were assuming they'd pick the same reg but didn't tell the compiler about it.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11810714"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1565734961, "creation_date": 1565733258, "question_id": 57485761, "link": "https://stackoverflow.com/questions/57485761/what-does-the-0-9-constraint-do-in-gcc-inline-assembly", "title": "What does the 0..9 constraint do in GCC Inline Assembly?", "body": "<p>The manual says: </p>\n\n<p>\"An operand that matches the specified operand number is allowed. If a digit\nis used together with letters within the same alternative, the digit should come last.\"</p>\n\n<p>I'm not sure what this means.</p>\n\n<p>Example code:</p>\n\n<pre><code>asm volatile(\"swap %0\" : \"=r\" (value) : \"0\" (value));\n</code></pre>\n"}, {"tags": ["c", "clang", "header-files"], "comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565728780, "post_id": 57485010, "comment_id": 101441162, "body": "<a href=\"https://shouldiblamecaching.com\" rel=\"nofollow noreferrer\">shouldiblamecaching.com</a>"}], "owner": {"reputation": 79, "user_id": 6402839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52254ce22be6e4d866ab49dad439a467?s=128&d=identicon&r=PG&f=1", "display_name": "SmugLispWeenie", "link": "https://stackoverflow.com/users/6402839/smuglispweenie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 259, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1565728705, "creation_date": 1565728705, "question_id": 57485010, "link": "https://stackoverflow.com/questions/57485010/how-to-clear-clang-precompiled-header-cache", "title": "How to Clear Clang Precompiled Header Cache?", "body": "<p>It seems Clang cached some stale headers, due to a time-drift error. How does one list what headers are precompiled and clears them?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 2, "creation_date": 1565727984, "post_id": 57484829, "comment_id": 101440903, "body": "Related: <a href=\"https://stackoverflow.com/questions/949433/why-are-these-constructs-using-pre-and-post-increment-undefined-behavior\">Why are these constructs using pre and post-increment undefined behavior?</a>"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1565727996, "post_id": 57484829, "comment_id": 101440905, "body": "As a general rule, if there&#39;s no requirement that something <i>has</i> to happen, then the behaviour is termed &quot;undefined&quot; and anything can and will happen instead. <code>f()</code> and <code>g()</code> will both be evaluated prior to the addition being performed. That much is assured, but as to the order, that doesn&#39;t matter and shouldn&#39;t impact your code. Same goes for arguments. When in doubt consult the C standard you&#39;re working with, whatever that is."}, {"owner": {"reputation": 188064, "user_id": 635608, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oIJia.png?s=128&g=1", "display_name": "Mat", "link": "https://stackoverflow.com/users/635608/mat"}, "edited": false, "score": 0, "creation_date": 1565728322, "post_id": 57484829, "comment_id": 101440999, "body": "<a href=\"https://stackoverflow.com/questions/5473107/operator-precedence-vs-order-of-evaluation?rq=1\" title=\"operator precedence vs order of evaluation\">stackoverflow.com/questions/5473107/&hellip;</a>"}, {"owner": {"reputation": 1285, "user_id": 114292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zWZob.jpg?s=128&g=1", "display_name": "David Spillett", "link": "https://stackoverflow.com/users/114292/david-spillett"}, "edited": false, "score": 2, "creation_date": 1565775424, "post_id": 57484829, "comment_id": 101453914, "body": "For extra confusion: as the order of evaulation of <code>f()</code> and <code>g()</code> are undefined, an advanced compile targetting a multi-core system is technically free to run them both at once. I don&#39;t know of any compiler that does this sort of automatic threading but it is at least possible. As a general note: this is all a good argument against using tricks like pre-/post-increment for optimising code conciseness or resulting run-time: you can potentially confuse the reader of your code (i.e. <i>you</i>, a few months from now!) and a good modern compiler will affect the same optimisation automatically anyway."}], "answers": [{"comments": [{"owner": {"reputation": 6430, "user_id": 812053, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/005db5b7c457d0cdea627e5b48e7f59f?s=128&d=identicon&r=PG", "display_name": "Ben Millwood", "link": "https://stackoverflow.com/users/812053/ben-millwood"}, "edited": false, "score": 0, "creation_date": 1565791197, "post_id": 57484951, "comment_id": 101462223, "body": "Also float arithmetic is not associative."}], "tags": [], "owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "is_accepted": false, "score": 5, "last_activity_date": 1565797473, "last_edit_date": 1565797473, "creation_date": 1565728448, "answer_id": 57484951, "question_id": 57484829, "link": "https://stackoverflow.com/questions/57484829/beginner-in-need-of-a-simple-explanation-of-the-difference-between-order-of-eval/57484951#57484951", "title": "Beginner in need of a simple explanation of the difference between order of evaluation and precedence/associativity", "body": "<p>Precedence and associativity matter when an expression has more than one operator.</p>\n\n<p>Associativity doesn't matter with addition, because as you may remember from grade school math, addition is commutative and associative -- there's no difference between <code>(a + b) + c</code>, <code>a + (b + c)</code>, or <code>(b + c) + a</code> (but see the <strong>Note</strong> at the end of my answer).</p>\n\n<p>But consider subtraction. If you write</p>\n\n<pre><code>100 - 50 - 5\n</code></pre>\n\n<p>it matters whether you treat this as</p>\n\n<pre><code>(100 - 50) - 5 = 45\n</code></pre>\n\n<p>or</p>\n\n<pre><code>100 - (50 - 5) = 55\n</code></pre>\n\n<p>Left associativity means that the first interpretation will be used.</p>\n\n<p>Precedence comes into play when you have different operators, e.g.</p>\n\n<pre><code>10 * 20 + 5\n</code></pre>\n\n<p>Since <code>*</code> has higher precedence than <code>+</code>, this is treated like</p>\n\n<pre><code>(10 * 20) + 5 = 205\n</code></pre>\n\n<p>rather than</p>\n\n<pre><code>10 * (20 + 5) = 250\n</code></pre>\n\n<hr>\n\n<p>Finally, order of evaluation is only noticeable when there are side effects or other dependencies between the sub-expressions. If you write</p>\n\n<pre><code>x = f() - g() - h()\n</code></pre>\n\n<p>and these functions each print something, the language doesn't specify the order in which the output will occur. Associativity doesn't change this. Even though the results will be subtracted in left-to-right order, it could call them in a different order, save the results somewhere, and then subtract them in the correct order. E.g. it could act as if you'd written:</p>\n\n<pre><code>temp_h = h();\ntemp_f = f();\ntemp_g = g();\nx = (temp_f - temp_g) - temp_h;\n</code></pre>\n\n<p>Any reordering of the first 3 lines would be allowed as an interpretation.</p>\n\n<h2>Note</h2>\n\n<p>Note that in some cases, computer arithmetic is not exactly like real arithmetic. Numbers in computers generally have limited range or precision, so there can be anomalous results (e.g. overflow if the result of addition is too large). This could cause different results depending on the order of operations even with operators that are theoretically associative, e.g. mathematically the following two expressions are equivalent:</p>\n\n<pre><code>x + y - z = (x + y) - z\ny - z + x = (y - z) + x\n</code></pre>\n\n<p>But if <code>x + y</code> overflows, the results can be different. Use explicit parentheses to override the default associativity if necessary to avoid a problem like this.</p>\n"}, {"tags": [], "owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "is_accepted": false, "score": 7, "last_activity_date": 1565878874, "last_edit_date": 1565878874, "creation_date": 1565728485, "answer_id": 57484964, "question_id": 57484829, "link": "https://stackoverflow.com/questions/57484829/beginner-in-need-of-a-simple-explanation-of-the-difference-between-order-of-eval/57484964#57484964", "title": "Beginner in need of a simple explanation of the difference between order of evaluation and precedence/associativity", "body": "<ol>\n<li>It's not really meaningful to say that function calls have left-to-right associativity, and even if it <em>were</em> meaningful, this would only apply to exotic combinations where two function-call operators were being applied right next to each other.  It wouldn't say anything about two separate function calls on either side of a <code>+</code> operator.</li>\n<li>Precedence and associativity don't help us at all in the expression <code>a[i] = i++</code>.  There simply is no rule that says precisely when within an expression <code>i++</code> stores the new result back into <code>i</code>, meaning that there is no rule to tell us whether the <code>a[i]</code> part uses the old or the new value.  That's why this expression is <em>undefined</em>.</li>\n</ol>\n\n<p>Precedence tells you what happens when you have two different operators that might apply.  In <code>a + b * c</code>, does the <code>+</code> or the <code>*</code> apply first?  In <code>*p++</code>, does the <code>*</code> or the <code>++</code> apply first?  Precedence answers these questions.</p>\n\n<p>Associativity tells you what happens when you have two of the <em>same</em> operators that might apply (generally, a string of the same operators in a row).  In <code>a + b + c</code>, which <code>+</code> applies first?  That's what associativity answers.</p>\n\n<p>But the answers to these questions (that is, the answers supplied by the precedence and associativity rules) apply rather narrowly.  They tell you which of the two operators you were wondering about apply first, but they do <em>not</em> tell you much of anything about the bigger expression, or about the smaller subexpressions \"underneath\" the operators you were wondering about.  (For example, if I wrote <code>(a - b) + (c - d) * (e - f)</code>, there's no rule to say which of the subtractions happens first.)</p>\n\n<p>The bottom line is that <em>precedence and associativity do not fully determine order of evaluation</em>.  Let's say that again in a slightly different way: precedence and associativity partially determine the order of evaluation in certain expressions, but they do <em>not</em> fully determine the order of evaluation in all expressions.</p>\n\n<p>In C, some aspects of the order of evaluation are <em>unspecified</em>, and some are <em>undefined</em>.  (This is by contrast to, as I understand it, Java, where all aspects of evaluation order are defined.)</p>\n\n<p>See also <a href=\"https://stackoverflow.com/questions/31087537/why-does-a-b-have-the-same-behavior-as-a-b/31088592#31088592\">this answer</a> which, although it's about a different question, explains the same points in more detail.</p>\n"}, {"comments": [{"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 4, "creation_date": 1565735681, "post_id": 57484972, "comment_id": 101443153, "body": "Associativity is not relevant to <code>f()()()</code>. There is no other way to structure the expression, so there is no choice for associativity to resolve. Associativity applies in a situation like <code>a-b+c</code> where there could (based on precedence alone) be a choice between <code>(a-b)+c</code> or <code>a-(b+c)</code>. (And the C rules actually specify expression structure or parsing by grammar, not by explicit precedence or associativity direction.)"}, {"owner": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1565766473, "post_id": 57484972, "comment_id": 101449698, "body": "@EricPostpischil Yes, I know. However, many (most?) C[++] reference pages, tutorials, etc. still describe associativity for operators such as function call or unaries, even if it makes no sense. It therefore has to be handled in a beginner-oriented answer <i>somehow.</i> Notice also the note about associativity being pointless in some cases; I will extend it to cover more than just unaries."}, {"owner": {"reputation": 586, "user_id": 1317409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8747cc4d8176bf9f4a19c1d3c06d46c6?s=128&d=identicon&r=PG", "display_name": "pbfy0", "link": "https://stackoverflow.com/users/1317409/pbfy0"}, "edited": false, "score": 0, "creation_date": 1565798336, "post_id": 57484972, "comment_id": 101466134, "body": "Is <code>a[i]</code> really evalulated? The value stored at that memory location before the assignment happens is certainly never read."}, {"owner": {"reputation": 5543, "user_id": 6372809, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O11k5.jpg?s=128&g=1", "display_name": "ilkkachu", "link": "https://stackoverflow.com/users/6372809/ilkkachu"}, "reply_to_user": {"reputation": 586, "user_id": 1317409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8747cc4d8176bf9f4a19c1d3c06d46c6?s=128&d=identicon&r=PG", "display_name": "pbfy0", "link": "https://stackoverflow.com/users/1317409/pbfy0"}, "edited": false, "score": 1, "creation_date": 1565798998, "post_id": 57484972, "comment_id": 101466441, "body": "@pbfy0, the assignment needs to know the location (memory address) where to store the value assigned. That requires evaluating <code>a[i]</code>, even if it doesn&#39;t use the actual value stored there. If you have something like  <code>*(p + f(x)) = g(x)</code> it should be clear that there&#39;s something to evaluate on the LHS too (and still no guarantees about which of <code>f()</code> and <code>g()</code> is called first)."}, {"owner": {"reputation": 586, "user_id": 1317409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8747cc4d8176bf9f4a19c1d3c06d46c6?s=128&d=identicon&r=PG", "display_name": "pbfy0", "link": "https://stackoverflow.com/users/1317409/pbfy0"}, "reply_to_user": {"reputation": 5543, "user_id": 6372809, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O11k5.jpg?s=128&g=1", "display_name": "ilkkachu", "link": "https://stackoverflow.com/users/6372809/ilkkachu"}, "edited": false, "score": 1, "creation_date": 1565799973, "post_id": 57484972, "comment_id": 101466894, "body": "@ilkkachu This might not be the terminology that the C standard uses, but to me that seems more like evaluating <code>&amp;a[i]</code>."}], "tags": [], "owner": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "is_accepted": true, "score": 21, "last_activity_date": 1565766551, "last_edit_date": 1565766551, "creation_date": 1565728521, "answer_id": 57484972, "question_id": 57484829, "link": "https://stackoverflow.com/questions/57484829/beginner-in-need-of-a-simple-explanation-of-the-difference-between-order-of-eval/57484972#57484972", "title": "Beginner in need of a simple explanation of the difference between order of evaluation and precedence/associativity", "body": "<p><strong>FIRST LINE</strong></p>\n\n<p>The left-to-right associativity means that an expression such as <code>f()()()</code> is evaluated as <code>((f())())()</code>. The associativity of the function call operator <code>()</code> says nothing about its relationship with other operators such as <code>+</code>.</p>\n\n<p>(Note that associativity only really makes sense for nestable infix operators such as binary <code>+</code>, <code>%</code>, or <code>,</code>. For operators such as function call or the unary ones, associativity is rather pointless in general.)</p>\n\n<p><strong>SECOND LINE</strong></p>\n\n<p>Operator precedence affects <em>parsing</em>, not <em>order of evaluation</em>. The fact that <code>[]</code> has higher precedence than <code>=</code> means that the expression is parsed as <code>(a[i]) = (i++)</code>. It says very little about evaluation order; <code>a[i]</code> and <code>i++</code> must both be evaluated before the assignment, but nothing is said about their order with respect to each other.</p>\n\n<p>To hopefully clear up confusion:</p>\n\n<p><em>Associativity</em> controls parsing and tells you whether <code>a + b + c</code> is parsed as <code>(a + b) + c</code> (left-to-right) or as <code>a + (b + c)</code> (right-to-left).</p>\n\n<p><em>Precedence</em> also controls parsing and tells you whether <code>a + b * c</code> is parsed as <code>(a + b) * c</code> (<code>+</code> has higher precedence than <code>*</code>) or as <code>a + (b * c)</code> (<code>*</code> has higher precedence than <code>+</code>).</p>\n\n<p><em>Order of evaluation</em> controls which values need to be evaluated in which order. <em>Parts</em> of it can follow from associativity or precedence (an operand must be evaluated before it's used), but it's seldom fully defined by them.</p>\n"}, {"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 4, "last_activity_date": 1565728692, "creation_date": 1565728692, "answer_id": 57485008, "question_id": 57484829, "link": "https://stackoverflow.com/questions/57484829/beginner-in-need-of-a-simple-explanation-of-the-difference-between-order-of-eval/57485008#57485008", "title": "Beginner in need of a simple explanation of the difference between order of evaluation and precedence/associativity", "body": "<p>Regarding your first question:</p>\n\n<pre><code>x = f() + g();\n</code></pre>\n\n<p>The left-to-right associativity relates to operators at the same level that are directly grouped together.  For example:</p>\n\n<pre><code>x = a + b - c;\n</code></pre>\n\n<p>Here the <code>+</code> and <code>-</code> operators have the same precedence level, so <code>a + b</code> is first evaluated, then <code>a + b - c</code>.</p>\n\n<p>For an example more related to yours, imagine a function that returns a function pointer.  You could then do something like this:</p>\n\n<pre><code>x()();\n</code></pre>\n\n<p>In this case, the function <code>x</code> must be called first, then the function pointer returned by <code>x</code> is called.</p>\n\n<p>For the second:</p>\n\n<pre><code>a[i] = i++;\n</code></pre>\n\n<p>The side effect of the postincrement operator is not guaranteed to occur until the next sequence point.  Because there are no sequence points in this expression, the <code>i</code> on the left side may be evaluated before or after the side effect of <code>++</code>.  This invokes <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behavior</a> due to both reading and writing a variable without a sequence point.</p>\n"}, {"tags": [], "owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "is_accepted": false, "score": 2, "last_activity_date": 1565733053, "creation_date": 1565733053, "answer_id": 57485732, "question_id": 57484829, "link": "https://stackoverflow.com/questions/57484829/beginner-in-need-of-a-simple-explanation-of-the-difference-between-order-of-eval/57485732#57485732", "title": "Beginner in need of a simple explanation of the difference between order of evaluation and precedence/associativity", "body": "<p><strong>FIRST LINE</strong> - Associativity is not relevant here.  Associativity only really comes into play when you have a sequence of operators with the same precedence.  Let's take the expression <code>x + y - z</code>.  The additive operators <code>+</code> and <code>-</code> are <em>left-associative</em>, so that sequence is parsed as <code>(x + y) - z</code> - IOW, the result of <code>z</code> is subtracted from the result of <code>x + y</code>.  </p>\n\n<p>THIS DOES NOT MEAN that any of <code>x</code>, <code>y</code>, or <code>z</code> have to be evaluated in any particular order.  It does not mean that <code>x + y</code> must be evaluated before <code>z</code>.  It only means that the result of <code>x + y</code> must be known before the result of <code>z</code> is subtracted from it.  </p>\n\n<p>Regarding <code>x = f() + g()</code>, all that matters is that the results of <code>f()</code> and <code>g()</code> are known before they can be added together - it does not mean that <code>f()</code> must be evaluated before <code>g()</code>.  And again, associativity has no effect here.</p>\n\n<p><strong>SECOND LINE</strong> - This statement invokes <strong>undefined behavior</strong> <em>precisely because</em> the order of operations is unspecified (strictly speaking, the expressions <code>a[i]</code> and <code>i++</code> are <em>unsequenced</em> with respect to each other). You cannot both update an object (<code>i++</code>) and use its value in a computation (<code>a[i]</code>) in the same expression without an intervening sequence point.  The result will not be consistent or predictable from build to build (it doesn't even have to be consistent from run to run of the same build).  Expressions like <code>a[i] = i++</code> (or <code>a[i++] = i</code>) and <code>x = x++</code> all have undefined behavior, and the result can be quite literally anything.  </p>\n\n<p>Note that the <code>&amp;&amp;</code>, <code>||</code>, <code>?:</code>, and comma operators <em>do</em> force left-to-right evaluation and introduce sequence points, so an expression like</p>\n\n<pre><code>i++ &amp;&amp; a[i]\n</code></pre>\n\n<p>is well-defined - <code>i++</code> will be evaluated first and its side effect will be applied <em>before</em> <code>a[i]</code> is evaluated.  </p>\n\n<p>Precedence and associativity fall out of the language grammar - for example, the grammar for the additive operators <code>+</code> and <code>-</code> is</p>\n\n<pre><code><em>additive-expression</em>:\n    <em>multiplicative-expression</em>\n    <em>additive-expression</em> + <em>multiplicative-expression</em>\n    <em>additive-expression</em> - <em>multiplicative-expression</em>\n</code></pre>\n\n<p>IOW, an <em><code>additive-expression</code></em> can produce a single <em><code>multiplicative-expression</code></em>, or it can produce another <em><code>additive-expression</code></em> followed by an additive operator followed by a <em><code>multiplicative-expression</code></em>.  Let's see how this plays out with <code>x + y - z</code>:</p>\n\n<pre><code>x -- additive-expression ---------+\n                                  |\n+                                 +-- additive-expression --+\n                                  |                         |\ny -- multiplicative-expression ---+                         |\n                                                            +-- additive-expression\n-                                                           |\n                                                            |\nz -- multiplicative-expression -----------------------------+\n</code></pre>\n\n<p>You can see that <code>x + y</code> is grouped together into an <em><code>additive-expression</code></em> first, and then that expression is grouped with <code>z</code> to form another <em><code>additive-expression</code></em>.  </p>\n"}], "owner": {"reputation": 393, "user_id": 6470928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ca50db72512cbab0ea4d95c14222d07?s=128&d=identicon&r=PG&f=1", "display_name": "bonehead", "link": "https://stackoverflow.com/users/6470928/bonehead"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1914, "favorite_count": 2, "accepted_answer_id": 57484972, "answer_count": 5, "score": 27, "last_activity_date": 1566416517, "creation_date": 1565727744, "last_edit_date": 1566416517, "question_id": 57484829, "link": "https://stackoverflow.com/questions/57484829/beginner-in-need-of-a-simple-explanation-of-the-difference-between-order-of-eval", "title": "Beginner in need of a simple explanation of the difference between order of evaluation and precedence/associativity", "body": "<p>I am reading the end of the 2nd chapter of K&amp;R and I'm having some difficulty understanding two specific unrelated example lines of code (which follow) along with commentary of them in the book:</p>\n\n<pre><code>x = f() + g();\na[i] = i++;\n</code></pre>\n\n<p><strong>FIRST LINE</strong> - I have no trouble understanding that the standard does not specify the order of evaluation for the <code>+</code> operator, and that therefore it is unspecified whether <code>f()</code> or <code>g()</code> evaluates first (and that is why I think the question isn't a duplicate). My confusion stems from the fact that if we look up the <a href=\"https://en.cppreference.com/w/c/language/operator_precedence\" rel=\"nofollow noreferrer\">C operator precedence chart</a> it cites function calls as of highest precedence with left-to-right associativity. Now doesn't that mean that <code>f()</code> <strong>has</strong> to be called/evaluated before <code>g()</code>? Obviously not, but I don't know what I am missing.</p>\n\n<p><strong>SECOND LINE</strong> - Again the similar conundrum regarding whether the array is indexed to the initial value of <code>i</code> or the incremented value. However, again the operator precedence chart cites array subscripting as of highest precedence with left-to-right associativity. Therefore wouldn't array subscripting be the first thing to be evaluated causing the array to be subscripted to the initial value of <code>i</code> and removing any unambiguity? Obviously not, and I'm missing something.</p>\n\n<p>I do understand that compilers have the freedom to decide when side effects happen in an expression (between sequence points of course) and that that may cause undefined behaviour if the variable in question is used again in the same expression, however in the examples above it seems that any ambiguity is cleared by function calls and array subscripting having highest precedence and defined left-to-right associativity, so I fail to see the ambiguity.</p>\n\n<p>I have a feeling that I have some fundamental misconception about the concepts of associativity, operator precedence and order of evaluation, but I can't point my finger on what it is, and similar questions/answers on this topic were out of my league to understand thoroughly at this point.</p>\n"}, {"tags": ["c", "string", "pointers", "realloc"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1565727624, "post_id": 57484773, "comment_id": 101440780, "body": "PSA: <a href=\"https://stackoverflow.com/questions/605845/do-i-cast-the-result-of-malloc\">Don&#39;t cast the result of <code>malloc</code></a>."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1565727701, "post_id": 57484773, "comment_id": 101440813, "body": "You check the result of <code>realloc</code>. If it succeed, then you can assume it have allocated whatever you asked it to allocate. If it is allocating more - it&#39;s not of your concern as you still should not use this memory."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1565727751, "post_id": 57484773, "comment_id": 101440827, "body": "I&#39;m not sure <code>realloc</code> is obligated to reallocate at all. You&#39;re just telling it that you&#39;d like to, and it takes that under advisement. The only requirement is it gives you an allocation <i>at least</i> as much as you ask for. In some cases there may be granularity on the allocator level where going from, say, 63 bytes to 62 doesn&#39;t actually do anything."}, {"owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1565727756, "post_id": 57484773, "comment_id": 101440829, "body": "@tadman Thanks,i will stop casting,i did because our teacher showed it like that"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1565728081, "post_id": 57484773, "comment_id": 101440940, "body": "If you really want to know what&#39;s going on, your compiler may have an allocator debugging feature where it gives you details on each allocation or reallocation performed, plus a breakdown of the heap. This is compiler-specific, so check your compiler&#39;s docs."}, {"owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1565728096, "post_id": 57484773, "comment_id": 101440942, "body": "@EugeneSh. I checked with a if ( *temp == NULL) wasnt true so i should be good then ?"}, {"owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1565728144, "post_id": 57484773, "comment_id": 101440952, "body": "@tadman i think visualstrudio had something like that,im currently on codeblocks"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1565728269, "post_id": 57484773, "comment_id": 101440983, "body": "if you have something like <code>temp = realloc(string....); if (temp) string = temp; else fail</code> then you should be fine"}, {"owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1565728348, "post_id": 57484773, "comment_id": 101441015, "body": "@EugeneSh. Ye i did that,it went fine"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1565730163, "post_id": 57484773, "comment_id": 101441640, "body": "@tadman The question you linked is &quot;Do I cast the result of malloc&quot;, not &quot;Don&#39;t cast the result of malloc&quot;. The discussion there lists pros and cons, and just because the answer in favor of &quot;con&quot; has some more votes doesn&#39;t make it the one and only truth. Casting malloc is perfectly ok and a matter of style."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1565730775, "post_id": 57484773, "comment_id": 101441840, "body": "@Ctx The accepted answer with a bazillion upvotes of support is &quot;No, you don&#39;t&quot;."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1565730885, "post_id": 57484773, "comment_id": 101441880, "body": "@tadman Well, it doesn&#39;t need a thorough analysis to see, that this is clearly an opinion and far from an objective truth/fact. Note, that I do not claim that you <i>should</i> cast the result, but telling others that this is wrong is... well ... wrong ;)"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1565730977, "post_id": 57484773, "comment_id": 101441912, "body": "@Ctx You want to argue, take it up with the author of that answer as a comment. As far as I&#39;m concerned, and as thousands of Stack Overflow users have whole-heartedly agreed, the best practice is to not do it."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1565731046, "post_id": 57484773, "comment_id": 101441936, "body": "@tadman This is &quot;primarily opinion based&quot; and doesn&#39;t really have a place here. codereview.stackexchange.com might be a better place for that discussion. You claim here, that one should <i>not</i> cast the result of <code>malloc()</code> and I have the desire to set straight, that it is neither wrong, nor &quot;bad practice&quot;, regardless what a handful users claim."}], "answers": [{"comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1565728667, "post_id": 57484928, "comment_id": 101441122, "body": "Well. <a href=\"https://stackoverflow.com/questions/16674370/why-does-malloc-or-new-never-return-null\">To an extent</a>..."}, {"owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1565729482, "post_id": 57484928, "comment_id": 101441424, "body": "@EugeneSh. I see."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1565733893, "post_id": 57484928, "comment_id": 101442754, "body": "<i>realistically you&#39;re using some multiple of the page size, which is usually 4KiB</i>  Each block is unlikely to use a full page internally.  Handing out 4 KB blocks for 8-byte allocations is extremely wasteful.  There&#39;s usually a management layer between <code>malloc()</code> <i>et al</i> and the full pages given to a process by the kernel via <code>brk()</code>/<code>sbrk()</code> and/or <code>mmap()</code>.  glibc, for example can use <code>brk()</code>/<code>sbrk()</code> for smaller requests, and <code>mmap()</code> directly for larger requests.  Memory management libraries for high-performance multithreaded programs can get really complex."}, {"owner": {"reputation": 1774, "user_id": 1201456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b33a546c937f65ce7ef0f29ca0f6a84d?s=128&d=identicon&r=PG", "display_name": "nickelpro", "link": "https://stackoverflow.com/users/1201456/nickelpro"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1565743755, "post_id": 57484928, "comment_id": 101444616, "body": "@AndrewHenle That&#39;s what I meant by &quot;you don&#39;t know where in the page <code>realloc</code> put you, so you can&#39;t rely on that.&quot; Obviously malloc isn&#39;t going to call mmap for every single allocation, and malloc has its own overhead as well. I&#39;m just pointing out if you&#39;re monitoring program memory usage, it&#39;ll be in 4K blocks. <code>brk()</code> can move the break around arbitrarily, but memory protection only has page-granularity so you wont segfault anywhere in the page <code>brk()</code> is located. All of that memory exclusively belongs to the one program, see: <a href=\"https://elixir.bootlin.com/linux/latest/source/mm/mmap.c#L224\" rel=\"nofollow noreferrer\">elixir.bootlin.com/linux/latest/source/mm/mmap.c#L224</a>"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1565777506, "post_id": 57484928, "comment_id": 101454999, "body": "@nickelpro <i>Obviously malloc isn&#39;t going to call mmap for every single allocation ...</i> I was aiming my comment at inexperienced programmers and non-programmers who might run across this question sometime in the future.  Sorry if I didn&#39;t make that clear."}], "tags": [], "owner": {"reputation": 1774, "user_id": 1201456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b33a546c937f65ce7ef0f29ca0f6a84d?s=128&d=identicon&r=PG", "display_name": "nickelpro", "link": "https://stackoverflow.com/users/1201456/nickelpro"}, "is_accepted": true, "score": 2, "last_activity_date": 1565728325, "creation_date": 1565728325, "answer_id": 57484928, "question_id": 57484773, "link": "https://stackoverflow.com/questions/57484773/how-to-know-if-a-string-pointer-actually-got-smaller-after-realloc/57484928#57484928", "title": "How to know if a string pointer actually got smaller after realloc?", "body": "<p>You can't \"double-check\" <code>realloc</code> if that's your question</p>\n\n<p><a href=\"https://en.cppreference.com/w/c/memory/realloc\" rel=\"nofollow noreferrer\">The standard defines</a> the behavior of <code>realloc</code>, if it failed to provide the number of consecutive bytes that you ask for it will return <code>NULL</code>.</p>\n\n<p>Now, how many bytes does <code>realloc</code> actually use? The internals of memory management functions are implementation defined, but realistically you're using some multiple of the <a href=\"https://en.wikipedia.org/wiki/Page_(computer_memory)\" rel=\"nofollow noreferrer\">page size</a>, which is usually 4KiB. The tricky part is you don't know where in the page <code>realloc</code> put you, so you can't rely on that.</p>\n\n<p>Ask for the amount of bytes you need and you won't go wrong. Don't assume memory management functions are providing more than you ask for, and the standard provides the guarantee that you have at least what you need. </p>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "edited": false, "score": 0, "creation_date": 1565728935, "post_id": 57484983, "comment_id": 101441212, "body": "if i dont know the max size of string, my only option is to put a big size,my 256  and realloc() or is there a way to realloc the moment i get the string from user ?"}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "edited": false, "score": 1, "creation_date": 1565729359, "post_id": 57484983, "comment_id": 101441377, "body": "@Jesepy: there is a non portable way to get <code>scanf()</code> to allocate the array on some systems with <code>scanf(&quot;%ms&quot;, &amp;string)</code>: it will allocate (and reallocate) an array of the proper size and store its address into the pointer <code>string</code>. This extension is available on systems that use the GNU C library and may become standard some day."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1565729565, "post_id": 57484983, "comment_id": 101441452, "body": "@EugeneSh.: good point, but <code>readline()</code> reads a line of input whereas <code>scanf(&quot;%ms&quot;), &amp;p)</code> reads a single word."}, {"owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "edited": false, "score": 0, "creation_date": 1565729890, "post_id": 57484983, "comment_id": 101441549, "body": "Didnt know about %ms ill try it(is there a catch to it ?).Eugene what is readline ?I googled it didnt find much,and it kind of seemed out of my league for now,is there a post about it ?."}, {"owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1565730854, "post_id": 57484983, "comment_id": 101441867, "body": "@EugeneSh. There&#39;s so much stuff there heh,ill check it later thanks"}, {"owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "edited": false, "score": 0, "creation_date": 1565731310, "post_id": 57484983, "comment_id": 101442024, "body": "@chqrlie At first i thought of upvoting everyone hah.But thought its bad,but then i thought that you will like it,but then i say Stackoverflow saying to upvote the ones that helped with the solution,but everyone helped so i dont know what to do(writing too much ? nah)."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "edited": false, "score": 0, "creation_date": 1565731654, "post_id": 57484983, "comment_id": 101442141, "body": "@Jesepy: the policy is to upvote useful answers. As the OP, this means helping with the solution, sometimes in indirect ways by pointing to related info or non obvious problems. You can upvote all answers if they fit this scheme."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "edited": false, "score": 0, "creation_date": 1565733027, "post_id": 57484983, "comment_id": 101442526, "body": "@Jesepy: yes, my rarest badge: awarded only 116 times in total. Let&#39;s clean up these comments, long discussions tend to get bumped to the chat rooms."}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": false, "score": 1, "last_activity_date": 1565728565, "creation_date": 1565728565, "answer_id": 57484983, "question_id": 57484773, "link": "https://stackoverflow.com/questions/57484773/how-to-know-if-a-string-pointer-actually-got-smaller-after-realloc/57484983#57484983", "title": "How to know if a string pointer actually got smaller after realloc?", "body": "<p>There are multiple issues to consider here:</p>\n\n<ul>\n<li><p><code>realloc()</code> returns the address of a block with <em>at least</em> the size requested if it succeeds, otherwise it returns a null pointer. Storing this return value directly into the passed pointer would overwrite this pointer with a null pointer if the call fails, making it impossible to use the original pointer, even just to free it.</p></li>\n<li><p><code>scanf()</code> should be passed the maximum number of bytes to read into the array, namely 255 in your example.</p></li>\n<li><p>you should test the return value of <code>scanf()</code> to detect invalid input and avoid undefined behavior using unset variables in case of such failures.</p></li>\n<li><p>you should test if <code>number</code> is positive. passing a negative value to <code>realloc()</code> will request an insanely large amount of memory causing the call to fail.</p></li>\n<li><p>if you know the maximum string length, you can just allocate the correct size before reading the string.</p></li>\n<li><p>regarding your question: if the number is less than 256 and you read a word longer than <code>number</code> bytes, setting <code>string[number] = '\\0';</code> is <strong>necessary</strong> to truncate the string because <code>realloc()</code> just shortened the array to <code>number+1</code> bytes, potentially moving the contents, but preserved the byte at offset <code>number</code>.</p></li>\n</ul>\n"}], "owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 57484928, "answer_count": 2, "score": 1, "last_activity_date": 1565729562, "creation_date": 1565727447, "last_edit_date": 1565729562, "question_id": 57484773, "link": "https://stackoverflow.com/questions/57484773/how-to-know-if-a-string-pointer-actually-got-smaller-after-realloc", "title": "How to know if a string pointer actually got smaller after realloc?", "body": "<p>I use realloc() on a string to make its size/memory smaller,so that way i lose the byte that had the null character '\\0' in the end.I go and put back the null character for the new smaller size of the string.</p>\n\n<p>The way i know to check a string's size is funtcion strlen(),but strlen will stop when it spots null character.</p>\n\n<p>So the question is did i actually free the space or is strlen just stopping on the null character that i mannualy set at the end.How can i check ?</p>\n\n<p>Just curious,how do you see my post so fast ?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nchar * function ()\n{\n    int number;\n    char *string;\n\n    printf(\"Give number: \");\n    scanf(\"%i\",&amp;number);\n\n    string = (char *) calloc(256,sizeof(char));\n\n    printf(\"Give string: \");\n    scanf(\"%s\",string);\n\n    string = (char *) realloc(string,number+1);//I make the string smaller\n\n    string[number] = '\\0';//I set the null at the end of the new size\n\n    return string;\n}\n\nint main()\n{\n    char *string;\n\n    string = function();\n\n    printf(\"Size of string is: %i\\n\",strlen(string));//I check the size of string\n    puts(string);\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "iot", "contiki", "cooja", "contiki-process"], "owner": {"reputation": 11, "user_id": 9671929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9c7fbc03a6d916e10971abce76f2cd7?s=128&d=identicon&r=PG&f=1", "display_name": "SukantaCB", "link": "https://stackoverflow.com/users/9671929/sukantacb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1569331301, "creation_date": 1565726821, "last_edit_date": 1569331301, "question_id": 57484641, "link": "https://stackoverflow.com/questions/57484641/contiki-br-not-executing-tcp-ip-event-doesnt-goes-after-process-yield", "title": "Contiki BR not executing tcp_ip event,, does&#39;nt goes after PROCESS_YIELD", "body": "<p>I'm trying to implement ECC in 6LoWPAN border router. I'm using contiki Wismote motes for all udp_sender.c as sender and the Border router (border_router.c) needs to receive some messages and also reply ECC keys. I have disabled the default server (WITH_WEBSERVER=0) in makefile and enabled debug_print.</p>\n\n<p>udp_sender.c sends messages correctly but the border router doesn't receive messages. <strong>Nothing executes after <code>PROCESS_YIELD</code> in border_router.c</strong></p>\n\n<pre><code>while(1) {\n     PROCESS_YIELD(); **//Nothing executes from this point**\n     if(ev == tcpip_event) {\n          tcpip_handler();\n     } else if (ev == sensors_event &amp;&amp; data == &amp;button_sensor) {\n          PRINTF(\"Initiaing global repair\\n\");\n          rpl_repair_root(RPL_DEFAULT_INSTANCE);\n     }\n }\n</code></pre>\n\n<p>`</p>\n\n<pre><code>#define DEBUG DEBUG_PRINT\n#include \"net/uip-debug.h\"\n\nuint16_t dag_id[] = {0x1111, 0x1100, 0, 0, 0, 0, 0, 0x0011};\nstatic uip_ipaddr_t prefix;\nstatic uint8_t prefix_set;\n\n#define UIP_IP_BUF   ((struct uip_ip_hdr *)&amp;uip_buf[UIP_LLH_LEN])\n#define UDP_CLIENT_PORT 8765\n#define UDP_SERVER_PORT 5678\nstatic struct uip_udp_conn *server_conn;\n\nPROCESS(border_router_process, \"Border router process\");\nPROCESS(startup_process, \"Startup process\");\n\n#if WEBSERVER==0\n/* No webserver */\nAUTOSTART_PROCESSES(&amp;startup_process, &amp;border_router_process);\n#elif WEBSERVER&gt;1\n/* Use an external webserver application */\n#include \"webserver-nogui.h\"\nAUTOSTART_PROCESSES(&amp;border_router_process,&amp;webserver_nogui_process);\n#else\n\n#include \"httpd-simple.h\"\n\n#define WEBSERVER_CONF_LOADTIME 0\n#define WEBSERVER_CONF_FILESTATS 0\n#define WEBSERVER_CONF_NEIGHBOR_STATUS 0\n\n#define WEBSERVER_CONF_ROUTE_LINKS 0\n#if WEBSERVER_CONF_ROUTE_LINKS\n#define BUF_USES_STACK 1\n#endif\n\nPROCESS ( startup_process, \"Statup Process\" );\nPROCESS(webserver_nogui_process, \"Web server\");\nPROCESS_THREAD(webserver_nogui_process, ev, data)\n{\n  PROCESS_BEGIN();\n  httpd_init();\n  while(1) {\n    PROCESS_WAIT_EVENT_UNTIL(ev == tcpip_event);\n    httpd_appcall(data);\n  }\n  PROCESS_END();\n}\nAUTOSTART_PROCESSES(&amp;border_router_process,&amp;webserver_nogui_process, &amp;startup_process);\n\n//webserver codes\n/*-----------------------------------------*/\nstatic void \ntcpip_handler(void)\n{\n  char *appdata;\n\n  if(uip_newdata()) {\n    appdata = (char *)uip_appdata;\n    appdata[uip_datalen()] = 0;\n    PRINTF(\"DATA recv '%s' from \", appdata);\n    PRINTF(\"%d\",\n           UIP_IP_BUF-&gt;srcipaddr.u8[sizeof(UIP_IP_BUF-&gt;srcipaddr.u8) - 1]);\n    PRINTF(\"\\n\");\n#if SERVER_REPLY\n    PRINTF(\"DATA sending reply\\n\");\n    uip_ipaddr_copy(&amp;server_conn-&gt;ripaddr, &amp;UIP_IP_BUF-&gt;srcipaddr);\n    uip_udp_packet_send(server_conn, \"Reply\", sizeof(\"Reply\"));\n    uip_create_unspecified(&amp;server_conn-&gt;ripaddr);\n#endif\n  }\n}\n\nPROCESS_THREAD ( startup_process, ev, data )\n{\n        PROCESS_BEGIN();\n    //some ECC codes here\n      process_start ( &amp;border_router_process, ev );\n        PROCESS_END();\n}\n\nPROCESS_THREAD(border_router_process, ev, data)\n{\n  static struct etimer et;\n  rpl_dag_t *dag;\n\n  PROCESS_BEGIN();\n  ....\n  .....\n  server_conn = udp_new(NULL, UIP_HTONS(UDP_CLIENT_PORT), NULL);\n  if(server_conn == NULL) {\n    PRINTF(\"No UDP connection available, exiting the process!\\n\");\n    PROCESS_EXIT();\n  }\n  udp_bind(server_conn, UIP_HTONS(UDP_SERVER_PORT));\n\n  PRINTF(\"Created a server connection with remote address \");\n  PRINT6ADDR(&amp;server_conn-&gt;ripaddr);\n  PRINTF(\" local/remote port %u/%u\\n\", UIP_HTONS(server_conn-&gt;lport),\n         UIP_HTONS(server_conn-&gt;rport));\n\n  while(1) {\n   PROCESS_YIELD();\n   //Nothing executes from this point\n    if(ev == tcpip_event) {\n      tcpip_handler();\n    } else if (ev == sensors_event &amp;&amp; data == &amp;button_sensor) {\n      PRINTF(\"Initiaing global repair\\n\");\n      rpl_repair_root(RPL_DEFAULT_INSTANCE);\n    }\n  }\n  PROCESS_END();\n}\n</code></pre>\n\n<p><strong>Here is my output</strong></p>\n\n<pre><code>08:46.163   ID:2    Rime started with address 0.0.0.0.0.0.0.2\n08:46.174   ID:2    MAC 00:00:00:00:00:00:00:02 Contiki 2.6 started. Node id is set to 2.\n08:46.183   ID:2    nullmac nullrdc, channel check rate 128 Hz, radio channel 26\n08:46.194   ID:2    Tentative link-local IPv6 address fe80:0000:0000:0000:0200:0000:0000:0002\n08:46.199   ID:2    Starting 'UDP client process'\n08:46.207   ID:2    ECC INITIALIZED: key bit len: 128 NN_DIGIT_BITS: 16\n08:46.660   ID:1    Rime started with address 0.0.0.0.0.0.0.1\n08:46.672   ID:1    MAC 00:00:00:00:00:00:00:01 Contiki 2.6 started. Node id is set to 1.\n08:46.681   ID:1    nullmac nullrdc, channel check rate 128 Hz, radio channel 26\n08:46.693   ID:1    Tentative link-local IPv6 address fe80:0000:0000:0000:0200:0000:0000:0001\n08:46.697   ID:1    Starting 'Startup process'\n08:46.701   ID:1    Inside STARTUP process\n08:46.708   ID:1    ECC INITIALIZED: key bit len: 128 NN_DIGIT_BITS: 16\n08:46.711   ID:2    # [1024 bytes, no line ending]:                     ...\n08:46.938   ID:2    # [1024 bytes, no line ending]:                     ...\n\n08:49.078   ID:1    # [1024 bytes, no line ending]:                     ...\n08:49.207   ID:2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  UDP client process started\n08:49.213   ID:2    Client IPv6 addresses: aaaa::200:0:0:2\n08:49.215   ID:2    fe80::200:0:0:2\n08:49.224   ID:2    Created a connection with the server :: local/remote port 8765/5678\n08:49.311   ID:1    # [1024 bytes, no line ending]:                     ...\n08:49.545   ID:1    # [1024 bytes, no line ending]:                     ...\n08:49.778   ID:1    # [1024 bytes, no line ending]:                     ...\n08:50.010   ID:1    # [1024 bytes, no line ending]:                     ...\n08:50.242   ID:1    # [1024 bytes, no line ending]:                     ...\n08:50.475   ID:1    # [1024 bytes, no line ending]:                     ...\n08:50.748   ID:1    # [1024 bytes, no line ending]:                     ...\n08:50.751   ID:1    der router process\n08:50.756   ID:1    RPL-Border router started\n08:50.766   ID:1    ?PGot configuration message of type P\n08:50.769   ID:1    Setting prefix aaaa::\n08:51.758   ID:1    after PREFIX\n08:51.761   ID:1    created a new RPL dag\n08:51.765   ID:1    Server IPv6 addresses:\n08:51.768   ID:1     aaaa::200:0:0:1\n08:51.770   ID:1     fe80::200:0:0:1\n08:51.782   ID:1    Created a server connection with remote address :: local/remote port 5678/8765\n10:40.719   ID:2    DATA send to 1 'Hello 1'\n11:38.321   ID:2    DATA send to 1 'Hello 2'\n12:24.887   ID:2    DATA send to 1 'Hello 3'\n13:37.051   ID:2    DATA send to 1 'Hello 4'\n14:22.934   ID:2    DATA send to 1 'Hello 5'\n15:24.160   ID:2    DATA send to 1 'Hello 6'\n16:01.856   ID:2    DATA send to 1 'Hello 7'\n\\\\more messages like above\n\n</code></pre>\n"}, {"tags": ["c", "iar"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1565726959, "post_id": 57484313, "comment_id": 101440549, "body": "Per <a href=\"http://port70.net/~nsz/c/c11/n1570.html#7.16\" rel=\"nofollow noreferrer\">section 7.16 of the standard</a>, the type <code>va_list</code> is declared in <code>stdarg.h</code>.  This is why you get a compilation error when you attempt to use that type without including the header.  I can&#39;t speak with any authority to why the preprocessor does not expand the header, but you seem to have established that &quot;does not expand&quot; is very different in your case from &quot;ignores&quot;."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1565727605, "post_id": 57484313, "comment_id": 101440776, "body": "It think it is some compiler-specific quirk which is recognizing this header as &quot;built-in&quot; and assuming it&#39;s functionality provided by the compiler without actually using the header."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 1, "creation_date": 1565729466, "post_id": 57484313, "comment_id": 101441417, "body": "<code>I&#39;m using libclang to get an AST</code> - how? <code>I&#39;m preprocessing my source-code</code> - how? <code>it doesn&#39;t get expanded</code> - as a result of what command? How to replicate the behaviour you are getting. Ok, let&#39;s imagine I have installed the workbench, what should I do to have the stdarg not expanded? How did you run the preprocessor? What options did you use? Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> of steps you took to reproduce the problems you are having."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565773064, "post_id": 57484313, "comment_id": 101452775, "body": "There should be no reason to need stdarg.h in an embedded system. Its presence means you are either using printf, sprintf or user-defined variadic functions. In either case, a certain sign of bad code."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565778110, "post_id": 57484313, "comment_id": 101455313, "body": "@Lundin wowow, that&#39;s a bit broad statement, it is an ARM microprocessor not a uC with 4 bits of ram."}, {"owner": {"reputation": 307, "user_id": 1499700, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/ef0c86b0925f617d01bc79c6a38b0c1d?s=128&d=identicon&r=PG", "display_name": "Rami Rosenbaum", "link": "https://stackoverflow.com/users/1499700/rami-rosenbaum"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565778244, "post_id": 57484313, "comment_id": 101455398, "body": "Antti Haapala - I simply smiled regarding comment by @Lundin. Thanks for standing up :-)"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565778856, "post_id": 57484313, "comment_id": 101455701, "body": "@AnttiHaapala Memory consumption, execution speed, program safety. There are very few functions in any programming language that are more dangerous. In embedded systems specifically, programmers tend to use them either because they don&#39;t know how to implement a serial port interface, or because they are too lazy to do so, or alternatively because they don&#39;t know how to convert integers to text. None of the alternatives are flattering."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565778978, "post_id": 57484313, "comment_id": 101455752, "body": "@Lundin there are embedded systems outside automotive/industrial industry. Some might even use printf. ;)"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565779011, "post_id": 57484313, "comment_id": 101455773, "body": "I have embedded systems that <i>speak</i>."}, {"owner": {"reputation": 307, "user_id": 1499700, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/ef0c86b0925f617d01bc79c6a38b0c1d?s=128&d=identicon&r=PG", "display_name": "Rami Rosenbaum", "link": "https://stackoverflow.com/users/1499700/rami-rosenbaum"}, "edited": false, "score": 0, "creation_date": 1565779074, "post_id": 57484313, "comment_id": 101455798, "body": "I agree that va_list is probably not supported in misra 26262. I&#39;m using it as part of the c-language &#39;Greatest&#39; regression-testing-framework. As you grow, you learn to wait with your assumptions, before jumping to conclusions..."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565779386, "post_id": 57484313, "comment_id": 101455940, "body": "@AnttiHaapala Obviously the term &quot;embedded system&quot; is broad and subjective. A PC mounted inside a custom enclosure isn&#39;t an embedded system in my book, but that&#39;s just me."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565779655, "post_id": 57484313, "comment_id": 101456086, "body": "@RamiRosenbaum ISO 26262 -&gt; MISRA-C -&gt; complete ban of stdio.h in production code. Furthermore, the (A)SIL standards dictate that you are not allowed to have any code in your project which doesn&#39;t have an execution path in the live production binary. So managing a test build through compiler switches etc won&#39;t do, you&#39;ll need different, separate branches for test code. Even still, writing test cases with stdio.h is questionable, because it will bloat up all that is real-time and you end up testing something else that isn&#39;t the actual product. stdio.h is a bug factory, period."}], "answers": [{"tags": [], "owner": {"reputation": 3133, "user_id": 3668462, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d2Rj1.jpg?s=128&g=1", "display_name": "Johan", "link": "https://stackoverflow.com/users/3668462/johan"}, "is_accepted": true, "score": 3, "last_activity_date": 1565769674, "creation_date": 1565769674, "answer_id": 57490545, "question_id": 57484313, "link": "https://stackoverflow.com/questions/57484313/iar-embedded-workbench-stdarg-h-isnt-preprocessed/57490545#57490545", "title": "IAR Embedded Workbench: stdarg.h isn&#39;t preprocessed", "body": "<p>In iccarm 7.40 the <code>stdarg.h</code> in the filesystem is only a stub file. The varargs machinery is built into the compiler and activated by the <code>#include &lt;stdarg.h&gt;</code> directive. This is also why this include directive is not expanded when using the <code>--preprocess</code> command line option. This was changed recently and as of iccarm 8.40 the compiler uses the <code>stdarg.h</code> from the file system.</p>\n"}, {"comments": [{"owner": {"reputation": 307, "user_id": 1499700, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/ef0c86b0925f617d01bc79c6a38b0c1d?s=128&d=identicon&r=PG", "display_name": "Rami Rosenbaum", "link": "https://stackoverflow.com/users/1499700/rami-rosenbaum"}, "edited": false, "score": 0, "creation_date": 1565779749, "post_id": 57493012, "comment_id": 101456131, "body": "I thought that &lt;...&gt; just includes the build-system include-paths, while &quot;...&quot;  uses only the user include-paths. Interesting... thanks."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 307, "user_id": 1499700, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/ef0c86b0925f617d01bc79c6a38b0c1d?s=128&d=identicon&r=PG", "display_name": "Rami Rosenbaum", "link": "https://stackoverflow.com/users/1499700/rami-rosenbaum"}, "edited": false, "score": 0, "creation_date": 1565785269, "post_id": 57493012, "comment_id": 101458788, "body": "@RamiRosenbaum that is &quot;implementation-defined&quot;. <code>&quot;...&quot;</code> includes source files by given name, and if not found, then <i>headers</i> by that name as if placed in <code>&lt;...&gt;</code>."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 307, "user_id": 1499700, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/ef0c86b0925f617d01bc79c6a38b0c1d?s=128&d=identicon&r=PG", "display_name": "Rami Rosenbaum", "link": "https://stackoverflow.com/users/1499700/rami-rosenbaum"}, "edited": false, "score": 0, "creation_date": 1565785344, "post_id": 57493012, "comment_id": 101458822, "body": "I guess it is just the IDEs for which the header contents are placed in external files, so that it is easier to autocomplete stuff, hence the reversal mentioned by Johan...."}], "tags": [], "owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "is_accepted": false, "score": 1, "last_activity_date": 1565778861, "creation_date": 1565778861, "answer_id": 57493012, "question_id": 57484313, "link": "https://stackoverflow.com/questions/57484313/iar-embedded-workbench-stdarg-h-isnt-preprocessed/57493012#57493012", "title": "IAR Embedded Workbench: stdarg.h isn&#39;t preprocessed", "body": "<p>As a general remark, the <em>headers</em> specified in <code>&lt;...&gt;</code> need not be separate files on disk, but can be built in to the compiler, and need only be expanded during the preprocessing phase of the compilation <em>as if</em> they were code pasted in the place of the <code>#include</code> directive.</p>\n\n<p>In fact, the standard says that the <em>other</em> include form of <code>\"...\"</code> includes <em>source files</em>, so the standard itself does not even use a term \"header file\" at all - there are only <strong>headers</strong> or <strong>source files</strong>.</p>\n"}], "owner": {"reputation": 307, "user_id": 1499700, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/ef0c86b0925f617d01bc79c6a38b0c1d?s=128&d=identicon&r=PG", "display_name": "Rami Rosenbaum", "link": "https://stackoverflow.com/users/1499700/rami-rosenbaum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 0, "accepted_answer_id": 57490545, "answer_count": 2, "score": 1, "last_activity_date": 1565778874, "creation_date": 1565725150, "last_edit_date": 1565778874, "question_id": 57484313, "link": "https://stackoverflow.com/questions/57484313/iar-embedded-workbench-stdarg-h-isnt-preprocessed", "title": "IAR Embedded Workbench: stdarg.h isn&#39;t preprocessed", "body": "<p>I'm building a c-language application, using <em>IAR Embedded Workbench for ARM 7.40</em>.<br>\nI'm using <em>libclang</em> to get an <em>AST</em> (abstract syntax tree) representation of my c-code.\nFor that, I'm preprocessing my source-code.<br>\nThe problem is with <code>#include &lt;stdarg.h&gt;</code> - <strong>it doesn't get expanded</strong>.  </p>\n\n<p>Original code snippet:  </p>\n\n<pre><code>int before_stdarg = 1;\n#include &lt;stdarg.h&gt;\nint after_stdarg = 2;\nva_list args;\n#include \"func1.h\"\n...\n</code></pre>\n\n<p>Preprocessed code snippet:  </p>\n\n<pre><code>#line 1 \"source\\\\App\\\\func1.c\"\nint before_stdarg = 1;\n#include &lt;stdarg.h&gt;\nint after_stdarg = 2;\nva_list args;\n#line 1 \"C:\\\\testAppC\\\\source\\\\App\\\\func1.h\"\n...\n</code></pre>\n\n<p>Viewing stdarg.h:</p>\n\n<pre><code>#ifdef __ICCARM__\n#error \"Reading built-in header-file. If you used upper case, try #include &lt;stdarg.h&gt;\"\n#endif\n</code></pre>\n\n<p>A second issue: where is <code>va_list</code> defined?<br>\ncommenting out <code>#include &lt;stdarg.h&gt;</code> results in a compilation error: <code>Error[Pe020]: identifier \"va_list\" is undefined</code>  </p>\n\n<p>What am I missing?</p>\n\n<p><strong>Update, due to comments:</strong><br>\nThe Q is not for IAR EWARM newbies, as the marked answer can hint.<br>\nThe issue occurs on any minimal hello-world example, simply by adding the <code>#include &lt;stdarg.h&gt;</code>, without even using it!<br>\nThe preprocess command is a copy-paste of the regular build command, with the <code>--preprocess=l PATH_TO_PREPROCESSED_OUTPUT_FILE</code> addition:  </p>\n\n<pre><code>PS C:\\testAppC&gt; iccarm.exe source\\App\\func1.c -DSTM32L476xx -DUSE_HAL_DRIVER -I\"C:\\Program Files (x86)\\IAR Systems\\Embedded Workbench 7.2\\arm\\CMSIS\\Include\" -I\"C:\\Program Files (x86)\\IAR Systems\\Embedded Workbench 7.2\\arm\\inc\\c\" -I\"source\\App\" -I\"source\\Device\" --char_is_signed --cpu=Cortex-M4 --debug --dlib_config  \"C:\\Program Files (x86)\\IAR Systems\\Embedded Workbench 7.2\\arm\\INC\\c\\DLib_Config_Normal.h\" --endian=little --fpu=None --no_clustering --no_code_motion --no_cse --no_inline --no_scheduling --no_tbaa --no_unroll -On -e -o testAppC\\Obj --preprocess=l C:\\testAppC\\.aurora\\tmp\\func1.c.i\n</code></pre>\n"}, {"tags": ["c", "variable-assignment"], "comments": [{"owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "edited": false, "score": 0, "creation_date": 1565724398, "post_id": 57484114, "comment_id": 101439606, "body": "As far as I know, this technically isn&#39;t valid C because the standard doesn&#39;t allow variable-length arrays (yet?), but some compilers still provide this as an extension to the language, but you shouldn&#39;t rely on it because a different compiler may strictly comply to the standard and thus reject your code"}, {"owner": {"reputation": 4756, "user_id": 10001688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvhzK.jpg?s=128&g=1", "display_name": "Michael Bianconi", "link": "https://stackoverflow.com/users/10001688/michael-bianconi"}, "edited": false, "score": 0, "creation_date": 1565724474, "post_id": 57484114, "comment_id": 101439630, "body": "Variable sized arrays are supported from C99 on."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "edited": false, "score": 2, "creation_date": 1565724486, "post_id": 57484114, "comment_id": 101439634, "body": "@ForceBru the compiler would reject it during compilation and not produce an exectuable, yet here there clearly is. VLA&#39;s became standard in C99 but optional in C11."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1565724769, "post_id": 57484114, "comment_id": 101439744, "body": "The array (and in fact every local variable in a C program) needs to be initialized before it&#39;s used."}], "answers": [{"comments": [{"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 3, "creation_date": 1565724390, "post_id": 57484136, "comment_id": 101439604, "body": "You also need to initialize the other bytes in the array. Otherwise, any one of them could be a <code>&#39;\\0&#39;</code>, and <code>strlen</code> won&#39;t report the expected length."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565724600, "post_id": 57484136, "comment_id": 101439677, "body": "Ideally <code>number_array[0] = &#39;\\0&#39;;</code> since there is no other data set in the string."}], "tags": [], "owner": {"reputation": 4756, "user_id": 10001688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvhzK.jpg?s=128&g=1", "display_name": "Michael Bianconi", "link": "https://stackoverflow.com/users/10001688/michael-bianconi"}, "is_accepted": true, "score": 2, "last_activity_date": 1565724208, "creation_date": 1565724208, "answer_id": 57484136, "question_id": 57484114, "link": "https://stackoverflow.com/questions/57484114/char-string-length-not-getting-initialized-properly-despite-literally-putting-in/57484136#57484136", "title": "Char string length not getting initialized properly despite literally putting in the integer size I want it to be?", "body": "<p>You need to null terminate your array.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>char number_array[num_digits + 1];\nnumber_array[num_digits] = '\\0';\n</code></pre>\n\n<p>Without this null terminator, C has no way of know when you've reached the end of the array.</p>\n"}, {"comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565725697, "post_id": 57484370, "comment_id": 101440100, "body": "Are you sure this answers the question? OP knows what size it is - because it was defined to be that size."}], "tags": [], "owner": {"reputation": 1, "user_id": 6753198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7113658177bef4880805e0c6006abc03?s=128&d=identicon&r=PG&f=1", "display_name": "user6753198", "link": "https://stackoverflow.com/users/6753198/user6753198"}, "is_accepted": false, "score": 0, "last_activity_date": 1565725406, "creation_date": 1565725406, "answer_id": 57484370, "question_id": 57484114, "link": "https://stackoverflow.com/questions/57484114/char-string-length-not-getting-initialized-properly-despite-literally-putting-in/57484370#57484370", "title": "Char string length not getting initialized properly despite literally putting in the integer size I want it to be?", "body": "<p>just use 'sizeof' instead of 'strlen'</p>\n\n<p>printf(\"String len of array: %d\\n\", sizeof(number_array));</p>\n"}, {"tags": [], "owner": {"reputation": 16808, "user_id": 197011, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c2bfdf995aa973ef9974fca9aeb6c7fb?s=128&d=identicon&r=PG", "display_name": "GreenMatt", "link": "https://stackoverflow.com/users/197011/greenmatt"}, "is_accepted": false, "score": 0, "last_activity_date": 1565725767, "creation_date": 1565725767, "answer_id": 57484441, "question_id": 57484114, "link": "https://stackoverflow.com/questions/57484114/char-string-length-not-getting-initialized-properly-despite-literally-putting-in/57484441#57484441", "title": "Char string length not getting initialized properly despite literally putting in the integer size I want it to be?", "body": "<p>There are a couple possible issues I see here:</p>\n\n<ul>\n<li><p>As noted in <a href=\"https://stackoverflow.com/a/57484136/197011\">Michael Bianconi's answer</a>, C character arrays (often called strings) require null terminators. You would explicitly set this this with something like:</p>\n\n<p><code>number_array[number + 1] = '\\0';   /* See below for why number + 1 */</code></p></li>\n</ul>\n\n<p>Rather than just setting the last element to null, pre-initializing the entire character array to nulls might be helpful. Some compilers may do this for you, but if not you'll need to do this explicitly with something like:</p>\n\n<pre><code>for (int i = 0; i &lt; num_digits + 1; i ++) number_array[i] = '\\0';\n</code></pre>\n\n<p>Note that with gcc I had to use C99 mode using <code>-std=c99</code> to get this to compile, as the compiler didn't like the initialization within the for statement.</p>\n\n<ul>\n<li>Also, the code presented sets the length of the character array to be the same length as <code>number</code>'s length. We don't know what get_num_digits returns, but if it returns the actual number of significant digits in an integer, this will come up one short (see above and other answer), as you need an extra character for the null terminator. An example: if the number is 123456 and get_number_digits returns 6, you would would need to set the length of number_array to 7, instead of 6 (i.e. <code>number + 1</code>).</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 91978, "user_id": 387076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/cFyP6.jpg?s=128&g=1", "display_name": "Gilles &#39;SO- stop being evil&#39;", "link": "https://stackoverflow.com/users/387076/gilles-so-stop-being-evil"}, "is_accepted": false, "score": 0, "last_activity_date": 1565726620, "last_edit_date": 1565726620, "creation_date": 1565726075, "answer_id": 57484502, "question_id": 57484114, "link": "https://stackoverflow.com/questions/57484114/char-string-length-not-getting-initialized-properly-despite-literally-putting-in/57484502#57484502", "title": "Char string length not getting initialized properly despite literally putting in the integer size I want it to be?", "body": "<p><code>char number_array[num_digits];</code> allocates some space for a string. It's an array of <code>num_digits</code> characters. Strings in C are represented as an array of characters, with a null byte at the end. (A null byte has the value zero, not to be confused with the digit character <code>'0'</code>.) So this array has room for a string of up to <code>num_digits - 1</code> characters.</p>\n\n<p><code>sizeof(number_array)</code> gives you the array storage size. That's the total amount of space you have for a string plus its null terminator. At any given time, the array can contain a string of any length up to <code>number_array - 1</code>, or it might not contain a string at all if the array doesn't contain a null terminator.</p>\n\n<p><code>strlen(number_array)</code> gives you the length of the string contained in the array. If the array doesn't contain a null terminator, this call may return a garbage value or crash your program (or make demons fly out of your nose, but most computers fortunately lack the requisite hardware).</p>\n\n<p>Since you haven't initialized <code>number_array</code>, it contains whatever happened to be there in memory before. Depending on how your system works, this may or may not vary from one execution of the program to the next, and this certainly does vary depending on what the program has been doing and on the compiler and operating system.</p>\n\n<p>What you need to do is:</p>\n\n<ul>\n<li>Give the array enough room for the null terminator.</li>\n<li>Initialize the array to an empty string by making setting the first character to zero.</li>\n<li>Optionally, initialize the whole array to zero. This is not necessary, but it may simplify further work with the array.</li>\n<li>Use <code>%zu</code> rather than <code>%d</code> to print a size. <code>%d</code> is for an <code>int</code>, but <code>sizeof</code> and <code>strlen</code> return a <code>size_t</code>, which depending on your system may or may not be the same size of integers.</li>\n</ul>\n\n<pre><code>char number_array[num_digits + 1];\nnumber_array[0] = 0;  // or memset(number_array, 0, sizeof(number_array));\nprintf(\"Storage size of array: %zu\\n\", sizeof(number_array));\nprintf(\"The array contains an empty string: length=%zu\\n\", strlen(number_array));\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 11206094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc40b1bc4a362da0f37f14b6ecea403?s=128&d=identicon&r=PG&f=1", "display_name": "programmer12", "link": "https://stackoverflow.com/users/11206094/programmer12"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 57484136, "answer_count": 4, "score": 2, "last_activity_date": 1565726620, "creation_date": 1565724093, "question_id": 57484114, "link": "https://stackoverflow.com/questions/57484114/char-string-length-not-getting-initialized-properly-despite-literally-putting-in", "title": "Char string length not getting initialized properly despite literally putting in the integer size I want it to be?", "body": "<p>I'm working with char arrays in C. I'm setting the size in a previous step. When I print it out it clearly shows the num_digits as 1. \nBut then when I put it in to set the size of a char array to make it a char array of size num_digits, its setting the size of the array as 6. \nIn the next step when I print strlen(number_array), it prints 6. Printing it out I get something with a lot of question marks. Does anyone know why this is happening?</p>\n\n<pre><code>int num_digits = get_num_digits(number);\nprintf(\"Num digits are %d\\n\", num_digits);\nchar number_array[num_digits];\nprintf(\"String len of array: %d\\n\", strlen(number_array));\n</code></pre>\n"}, {"tags": ["c", "string", "pointers"], "comments": [{"owner": {"reputation": 26033, "user_id": 1047662, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/8aXzf.jpg?s=128&g=1", "display_name": "Cyclonecode", "link": "https://stackoverflow.com/users/1047662/cyclonecode"}, "edited": false, "score": 1, "creation_date": 1565723500, "post_id": 57483931, "comment_id": 101439267, "body": "<code>initial</code> is only a char and lack a null terminating <code>\\0</code> character. So <code>strcat</code> copies until it encounters the terminating null character. <a href=\"https://en.wikipedia.org/wiki/Null-terminated_string\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Null-terminated_string</a>"}], "answers": [{"comments": [{"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1565725753, "post_id": 57484011, "comment_id": 101440117, "body": "This is one of the problems, copying a string on itself has undefined behavior too."}], "tags": [], "owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "is_accepted": true, "score": 3, "last_activity_date": 1565726070, "last_edit_date": 1565726070, "creation_date": 1565723489, "answer_id": 57484011, "question_id": 57483931, "link": "https://stackoverflow.com/questions/57483931/reversing-a-name-printing-garbage-after-first-name-letter/57484011#57484011", "title": "Reversing a name - Printing garbage after first name letter", "body": "<p><code>strcat(name, &amp;initial)</code> tries to treat the data at <code>&amp;initial</code> as a C string, which is <em>NULL-terminated</em>. It will continue copying data from this address until it finds the null byte. But <code>&amp;initial</code> is a pointer to a byte on the stack, and there's no guarantee that <code>*(&amp;initial + 1) == 0</code>, so it continues copying whatever data it finds on the stack into the string.</p>\n\n<p>As pointed out in the comments, <code>strcopy</code>ing a part of a string into another part of <em>the same string</em> is undefined behavior. <a href=\"https://en.cppreference.com/w/cpp/string/byte/memmove\" rel=\"nofollow noreferrer\">The <code>memmove</code> function</a> is safer in this regard. However, you should probably just allocate a new memory region and build the resulting string there instead.</p>\n"}, {"tags": [], "owner": {"reputation": 656, "user_id": 9592917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fe6504c31f4954495f952699592361a?s=128&d=identicon&r=PG&f=1", "display_name": "Bwebb", "link": "https://stackoverflow.com/users/9592917/bwebb"}, "is_accepted": false, "score": 1, "last_activity_date": 1565723964, "creation_date": 1565723964, "answer_id": 57484102, "question_id": 57483931, "link": "https://stackoverflow.com/questions/57483931/reversing-a-name-printing-garbage-after-first-name-letter/57484102#57484102", "title": "Reversing a name - Printing garbage after first name letter", "body": "<p>Since you can assume the initial is always 1 char, use this instead of the failing strcat.</p>\n\n<pre><code>strncat(name, &amp;initial, 1);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 167, "user_id": 10614385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e11e37e484f744ed4731fd24ce4212a?s=128&d=identicon&r=PG&f=1", "display_name": "Shuster", "link": "https://stackoverflow.com/users/10614385/shuster"}, "edited": false, "score": 0, "creation_date": 1565724560, "post_id": 57484141, "comment_id": 101439663, "body": "Regarding your first point: I should have clarified that one is assumed to ener a first and last name, so input like <code>&quot;Superman&quot;</code> is ignored here. Thanks for pointing out though!"}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 167, "user_id": 10614385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e11e37e484f744ed4731fd24ce4212a?s=128&d=identicon&r=PG&f=1", "display_name": "Shuster", "link": "https://stackoverflow.com/users/10614385/shuster"}, "edited": false, "score": 1, "creation_date": 1565725558, "post_id": 57484141, "comment_id": 101440036, "body": "@Shuster: defensive programming is a good idea, avoiding undefined behavior in unexpected situations."}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": false, "score": 1, "last_activity_date": 1565725904, "last_edit_date": 1565725904, "creation_date": 1565724215, "answer_id": 57484141, "question_id": 57483931, "link": "https://stackoverflow.com/questions/57483931/reversing-a-name-printing-garbage-after-first-name-letter/57484141#57484141", "title": "Reversing a name - Printing garbage after first name letter", "body": "<p>There are multiple major problems in your code:</p>\n\n<ul>\n<li><p><code>while (*p != ' ') p++;</code> makes a bold assumption that the string contains at least one space after the first word. Calling <code>reverse_name</code> with the credentials of <code>\"Superman\"</code> or <code>\"Madonna\"</code>, or just an empty string will cause undefined behavior.</p></li>\n<li><p><code>strcpy(name, p);</code> violates a constaint on the arguments of <code>strcpy</code>: copying between overlapping strings has undefined behavior.</p></li>\n<li><p><code>strcat(name, &amp;initial);</code> passes the address of a single <code>char</code>, which is not a valid C string. You can append a single <code>char</code> with <code>strncat(name, &amp;initial, 1)</code>.</p></li>\n</ul>\n\n<p>You just cannot simply perform the inversion in place as coded, and should be aware that the resulting string might be longer than the source string.</p>\n\n<p>Here is an corrected version:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nvoid reverse_name(char *name) {\n    char *copy = strdup(name);\n\n    char *first = copy + strspn(copy, \" \");  // skip spaces before the first name\n    int first_length = strcspn(first, \" \");\n    char *last = first + first_length + strspn(first + first_length);\n    int last_length = strcspn(last, \" \");\n\n    if (last_length == 0) {\n        /* no name or a single name */\n        sprintf(name, \"%.*s\", first_length, first);\n    } else {\n        sprintf(name, \"%.*s, %c.\", last_length, last, *first);\n    }\n    free(copy);\n}\n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 10614385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e11e37e484f744ed4731fd24ce4212a?s=128&d=identicon&r=PG&f=1", "display_name": "Shuster", "link": "https://stackoverflow.com/users/10614385/shuster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 57484011, "answer_count": 3, "score": 3, "last_activity_date": 1565726070, "creation_date": 1565723139, "question_id": 57483931, "link": "https://stackoverflow.com/questions/57483931/reversing-a-name-printing-garbage-after-first-name-letter", "title": "Reversing a name - Printing garbage after first name letter", "body": "<p>I'm trying to write a program that reverses a name.</p>\n\n<p>I'm using <code>gets()</code> to read the string, so it doesn't put the <code>\\n</code> in the string.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nvoid reverse_name(char *name)\n{\n    const char *p = name;\n    char initial;\n\n    while (*p == ' ')       // skip preceding white-spaces\n        p++;\n\n    initial = *p++;         // store letter of first name\n\n    while (*p != ' ')       // skip until first white-space\n        p++;                // between first and last name\n\n    while (*p == ' ')       // skip additional white-spaces\n        p++;                // p now points to the first letter of the last name\n\n    strcpy(name, p);        // copy last name to the beginning\n    strcat(name, \", \");\n    strcat(name, &amp;initial);\n    strcat(name, \".\");\n}\n</code></pre>\n\n<p>For example, when inputting <code>Immanuel Kant</code> it should output <code>Kant, I.</code>. It prints garbage between the <code>I</code> and the <code>.</code> though. What's going wrong?</p>\n"}, {"tags": ["c", "arrays", "function", "implicit-conversion", "definition"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1565719869, "post_id": 57483233, "comment_id": 101437733, "body": "What do you mean by undefined?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565719947, "post_id": 57483233, "comment_id": 101437766, "body": "The only array I see is defined by the C standard, although any name may be used. Please see <b>5.1.2.2.1 Program startup</b> in C11."}, {"owner": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1565720077, "post_id": 57483233, "comment_id": 101437820, "body": "@tkausl The argv array has no size, how is this possible?"}], "answers": [{"comments": [{"owner": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "edited": false, "score": 0, "creation_date": 1565720035, "post_id": 57483264, "comment_id": 101437799, "body": "The second argument argv has no size, how is that possible?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565720150, "post_id": 57483264, "comment_id": 101437861, "body": "Because the number of elements in the outer dimension of an array which is used as function argument is not necessary for the compiler to know."}, {"owner": {"reputation": 4756, "user_id": 10001688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvhzK.jpg?s=128&g=1", "display_name": "Michael Bianconi", "link": "https://stackoverflow.com/users/10001688/michael-bianconi"}, "edited": false, "score": 0, "creation_date": 1565720153, "post_id": 57483264, "comment_id": 101437862, "body": "You only need to specify multidimensional array sizes when using <code>char array[n][]</code>. <code>char *array[]</code> and <code>char **array</code> are both fine to use."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565720440, "post_id": 57483264, "comment_id": 101437986, "body": "@MichaelBianconi I think you mean <code>char array[][n]</code>"}, {"owner": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "edited": false, "score": 0, "creation_date": 1565720473, "post_id": 57483264, "comment_id": 101438002, "body": "To rephrase it another way: normally declaring an array without a size such as int example[] is not permitted, so why is char *argv[] permitted"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1565720545, "post_id": 57483264, "comment_id": 101438025, "body": "<code>*argv[]</code> is allowed in any function argument list. It is the same as <code>**argv</code> in this context."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1565720603, "post_id": 57483264, "comment_id": 101438058, "body": "Please see <a href=\"https://stackoverflow.com/questions/1461432/what-is-array-decaying\">What is array decaying?</a>"}, {"owner": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1565720617, "post_id": 57483264, "comment_id": 101438069, "body": "@EugeneSh. I know it is allowed but I am hoping to understand why it is allowed."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "reply_to_user": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "edited": false, "score": 2, "creation_date": 1565720687, "post_id": 57483264, "comment_id": 101438100, "body": "@duper21 Your question implies that you believe it is only allowed in <code>main</code>. If you mean anything else - please edit the question."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565720724, "post_id": 57483264, "comment_id": 101438121, "body": "The only reason for array length in a function argument is so the compiler can compute the address of an array element. C makes no restriction on indexing an array so apart from that it does not care what its length is."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565720923, "post_id": 57483264, "comment_id": 101438202, "body": "...you need to fully specify an array where it is defined so the correct memory can be allocated, but there is no allocation for a function argument. The function only receives a pointer, not an actual array."}, {"owner": {"reputation": 270, "user_id": 639680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf2c7f6b67f2cac38e3caa5403c9ba27?s=128&d=identicon&r=PG&f=1", "display_name": "Fabiano Salles", "link": "https://stackoverflow.com/users/639680/fabiano-salles"}, "edited": false, "score": 0, "creation_date": 1565721155, "post_id": 57483264, "comment_id": 101438304, "body": "That is because it is simply a pointer to an array of char pointers. The count of elements is informed in the first parameter, so you can access from argv[0] to argv[argc]. The first argument (argv[0]) will always contain the name of program being executed and if the program was called with command line parameters it wil be available from argv[1] to argv[argc]."}], "tags": [], "owner": {"reputation": 4756, "user_id": 10001688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvhzK.jpg?s=128&g=1", "display_name": "Michael Bianconi", "link": "https://stackoverflow.com/users/10001688/michael-bianconi"}, "is_accepted": false, "score": 0, "last_activity_date": 1565719924, "creation_date": 1565719924, "answer_id": 57483264, "question_id": 57483233, "link": "https://stackoverflow.com/questions/57483233/why-are-arrays-of-undefined-size-only-allowed-in-main/57483264#57483264", "title": "Why are arrays of undefined size only allowed in main()?", "body": "<p>I'm a little confused about this question. <code>argc</code> is the number of commandline arguments passed into the executable. <code>argv</code> is an array of those arguments. Neither are undefined.</p>\n\n<p>Both <code>argc</code> and <code>argv</code> are simply parameter names, and you can change them to whatever you'd like. They are simply called <code>argc</code> and <code>argv</code> by convention.</p>\n"}, {"comments": [{"owner": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "edited": false, "score": 0, "creation_date": 1565721979, "post_id": 57483433, "comment_id": 101438629, "body": "Would it be correct to say arrays can be declared without size in functions as they will decay into a pointer which is why char *argv[] is allowed?"}, {"owner": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "edited": false, "score": 0, "creation_date": 1565722078, "post_id": 57483433, "comment_id": 101438685, "body": "It took me a while to understand but I honestly can not thank you enough"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1565723377, "post_id": 57483433, "comment_id": 101439213, "body": "@druper21, No, it is <i>not</i> correct to say that arrays can be declared without size in functions.  Although a fine distinction, function parameters declared with array syntax, whether with or without bounds, are pointers, not arrays.  This is their inherent meaning, not the result of automatic conversion (a.k.a. &quot;decay&quot;), but it does match up with array decay in the caller.  Arrays without <i>explicit</i> size can otherwise be declared inside functions only if they have an accompanying initializer to establish their size implicitly, or if they have linkage."}, {"owner": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1565724087, "post_id": 57483433, "comment_id": 101439495, "body": "@JohnBollinger To clarify what do you mean by &quot;an accompanying initializer to establish their size implicitly, or if they have linkage&quot;?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "edited": false, "score": 0, "creation_date": 1565725851, "post_id": 57483433, "comment_id": 101440153, "body": "@duper21, I have discussed this in more depth, especially the initializer part, in my own answer.  The linkage bit pertains to the rarely-exercised alternative of (re)declaring an external variable inside a function, by including the keyword <code>extern</code> in its declaration.  External variables are sometimes colloquially called &quot;global&quot;, but that&#39;s not the technical term for them in C, and it can be taken to have implications that don&#39;t in fact hold in C."}], "tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": true, "score": 2, "last_activity_date": 1565721378, "last_edit_date": 1565721378, "creation_date": 1565720654, "answer_id": 57483433, "question_id": 57483233, "link": "https://stackoverflow.com/questions/57483233/why-are-arrays-of-undefined-size-only-allowed-in-main/57483433#57483433", "title": "Why are arrays of undefined size only allowed in main()?", "body": "<p>In fact this declaration</p>\n\n<pre><code>int main(int argc, char *argv[])\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>int main(int argc, char **argv)\n</code></pre>\n\n<p>It is the host environment that supplies an array of strings and passes the pointer to the first string in the array as an argument for the parameter <code>argv</code>.</p>\n\n<p>From the C Standard (5.1.2.2.1 Program startup)</p>\n\n<blockquote>\n  <p>\u2014 If the value of argc is greater than zero, the array members argv[0]\n  through argv[argc-1] inclusive shall contain pointers to strings,\n  which are given implementation-defined values by the host environment\n  prior to program startup. The intent is to supply to the program\n  information determined prior to program startup from elsewhere in the\n  hosted environment. If the host environment is not capable of\n  supplying strings with letters in both uppercase and lowercase, the\n  implementation shall ensure that the strings are received in lowercase</p>\n</blockquote>\n\n<p>As for the comment</p>\n\n<blockquote>\n  <p>The argv array has no size, how is this possible?</p>\n</blockquote>\n\n<p>then a function parameter declared as an array of type T is adjusted to pointer to T.</p>\n\n<p>So for example these function declarations</p>\n\n<pre><code>void f( int a[100] );\nvoid f( int a[10] );\nvoid f( int a[] );\n</code></pre>\n\n<p>declare the same one function and the all declarations are adjusted to the declaration</p>\n\n<pre><code>void f( int *a );\n</code></pre>\n\n<p>The same way when an argument of an array type is passed to a function then the array is implicitly converted to pointer to its first element.</p>\n\n<p>So for example the function above can be called like</p>\n\n<pre><code>int a[100];\nf( a );\n</code></pre>\n\n<p>or</p>\n\n<pre><code>int a[10];\nf( a );\n</code></pre>\n\n<p>or</p>\n\n<pre><code>int *a;\nf( a );\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "edited": false, "score": 0, "creation_date": 1565721561, "post_id": 57483446, "comment_id": 101438453, "body": "So char *argv[] declared by its own cannot exist but can in a function as it decays into **argv?"}], "tags": [], "owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "is_accepted": false, "score": 1, "last_activity_date": 1565720707, "creation_date": 1565720707, "answer_id": 57483446, "question_id": 57483233, "link": "https://stackoverflow.com/questions/57483233/why-are-arrays-of-undefined-size-only-allowed-in-main/57483446#57483446", "title": "Why are arrays of undefined size only allowed in main()?", "body": "<p>Nothing is special about <code>main</code> here. An array declaration such as <code>char *argv[]</code> or <code>int example[]</code> has <strong>incomplete type</strong>, which is valid in certain contexts but not others. However, in the declaration of arguments to a function, the final type cannot be an array type; the array notation acts as a stand-in for a pointer to the first member of an array of that type. The actual type of <code>argv</code> in <code>main</code> is <code>char **</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565736402, "post_id": 57484378, "comment_id": 101443314, "body": "If function parameters declared with array syntax do not have array type <b>at all</b>, why does <code>#include &lt;stdio.h&gt;</code> / <code>void foo(char x[printf(&quot;Hello, world.\\n&quot;)]) {}</code> / <code>int main(void) { foo(0); }</code> print \u201cHello, world.\u201d? Some aspect of the array type must be in there. (This was tested using Apple LLVM 10.0.1 with clang-1001.0.46.4.)"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565737977, "post_id": 57484378, "comment_id": 101443650, "body": "All that demonstrates, @EricPostpischil, is that the dimension expression is evaluated when the function is called.  That does not in any way make <code>x</code> the identifier of an array."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565739183, "post_id": 57484378, "comment_id": 101443900, "body": "How can the dimension expression be evaluated when the parameter does not have array type <b>AT ALL</b>? Pointers do not have dimensions. If there is a dimension expression, there must be some aspect of an array type. Telling people the parameter does not have array type <b>AT ALL</b> conflicts with the facts."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565739544, "post_id": 57484378, "comment_id": 101443984, "body": "@EricPostpischil, the dimension expression is part of the declaration of the parameter.  That is orthogonal to what type is thereby declared for the parameter by that syntax in that context.  A function parameter declaration expressed using that syntax declares the parameter as a pointer, not an array."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565741821, "post_id": 57484378, "comment_id": 101444344, "body": "No. There are multiple steps. The parameter is first declared as an array. It is subsequently adjusted to be a pointer. But, as demonstrated, the array declaration does not completely vanish. The phrase \u201cat all\u201d means \u201cin any way\u201d or \u201cto any extent/\u201d But it is clear there <b>is</b> a way in which the declaration of the array as a parameter has a persistent effect. This means the statement that it does not have array type \u201cat all\u201d is false. If you are going to qualify statements with absolutes like \u201cat all,\u201d you should ensure they are true. This one is not."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565742063, "post_id": 57484378, "comment_id": 101444378, "body": "If you had just said a parameter declared as an array ends up with a pointer type and not an array type, I would not be harping on this. But when you emphasize it with \u201cat all,\u201d then it should be correct."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565743165, "post_id": 57484378, "comment_id": 101444541, "body": "Very well, @EricPostpischil, I have adjusted the wording to &quot;after all&quot; instead of &quot;at all&quot;, which to me, in the particular usage here, has no significant difference in meaning, but which I hope you find less objectionable."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 1, "last_activity_date": 1565742773, "last_edit_date": 1565742773, "creation_date": 1565725474, "answer_id": 57484378, "question_id": 57483233, "link": "https://stackoverflow.com/questions/57483233/why-are-arrays-of-undefined-size-only-allowed-in-main/57484378#57484378", "title": "Why are arrays of undefined size only allowed in main()?", "body": "<blockquote>\n  <p>Why is it undefined arrays are only allowed in the main() method?</p>\n</blockquote>\n\n<p>By \"undefined arrays\" you appear to mean arrays with unspecified size.  There are several different cases to consider.</p>\n\n<ol>\n<li><p><strong>Function parameters declared with array syntax</strong> in fact do not have array type after all, whether a bound is specified or not.  Rather, such a parameter has a <em>pointer</em> type.  It is not necessary to specify a bound (for the first dimension), and if one is specified then it is insignificant.  This matches up with the automatic conversion from array to pointer (\"decay\") that would happen in the caller if the corresponding argument were an array, but in the called function the parameter is a pointer, a whole pointer, and nothing but a pointer.</p>\n\n<p>This applies to <em>any</em> function, not just <code>main()</code>.</p></li>\n<li><p><strong>Any variable</strong> can be declared at file or block scope as an array without an explicit bound but <strong>with an initializer</strong>; in this case, the array bound is established implicitly as the minimum necessary to accommodate all elements initialized by the initializer.</p>\n\n<p>Example:</p>\n\n<pre><code>int some_primes[] = { 2, 3, 5, 7, 11 };  // dimension 5\n</code></pre></li>\n<li><p><strong>A file-scope (outside any function) variable</strong> or one that otherwise has linkage can be declared as an array without explicit bounds and <strong>without an intializer</strong> to establish the bound implicitly.  The type of such a variable is \"incomplete\" until and unless another, compatible declaration of the same variable completes it by providing the bound, but many array operations can be performed on it at points in the source where it remains incomplete.</p></li>\n<li><p>Only <strong>local variables of array type and without initializers</strong> must be declared with an explicit bound.  (\"Local variables\" are those declared at block scope and with no linkage.)  These are a fairly common case, though, so I suppose the need to declare a size for them was part of the inspiration for the question.</p></li>\n</ol>\n"}], "owner": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 57483433, "answer_count": 4, "score": 0, "last_activity_date": 1565782542, "creation_date": 1565719771, "last_edit_date": 1565782542, "question_id": 57483233, "link": "https://stackoverflow.com/questions/57483233/why-are-arrays-of-undefined-size-only-allowed-in-main", "title": "Why are arrays of undefined size only allowed in main()?", "body": "<p>The main method argument uses an undefined array argv[] </p>\n\n<pre><code>int main(int argc, char *argv[])\n{\n .... Do stuff....\n}\n</code></pre>\n\n<p>Why is it undefined arrays are only allowed in the main() method?</p>\n"}, {"tags": ["c", "macros"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1565719020, "post_id": 57482934, "comment_id": 101437371, "body": "Ultimately, the C preprocessor is a blunt weapon for mangling text and it is hard to avoid problems like this except by renaming your macros and functions.  Do you use a systematic prefix on the names exposed in your GUI library?  You should,.  Does your friend&#39;s library use a (different) systematic prefix on the names it exposes?  Again, if not, it should."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1565719081, "post_id": 57482934, "comment_id": 101437404, "body": "You should also make sure you steer clear of names reserved for the implementation.  A short version of that is &quot;names starting with an underscore&quot;; the full rules (<a href=\"https://port70.net/~nsz/c/c11/n1570.html#7,1.3\" rel=\"nofollow noreferrer\">C11 &#167;7.1.3 Reserved identifiers</a>) are subtler than that but you won&#39;t go amiss following the short version of the rules."}, {"owner": {"reputation": 199, "user_id": 4883238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbdd8a03ea95fc24d6fd7087fc215c26?s=128&d=identicon&r=PG&f=1", "display_name": "BugSquasher", "link": "https://stackoverflow.com/users/4883238/bugsquasher"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565719255, "post_id": 57482934, "comment_id": 101437479, "body": "@JonathanLeffler My library is C++, Nilorea is C. My library collides with windows.h when both are included namely on &quot;CreateWindow&quot; and &quot;Rectangle&quot; which are both used by win32. Those I will eventually rename. And no, sadly Nilorea has no prefix on the macros it uses that collide with MinGW-W64."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565719369, "post_id": 57482934, "comment_id": 101437537, "body": "Time to choose different libraries?   You can use namespaces in your C++ GUI library to help a bit \u2014 though macros are still a bludgeon with no knowledge of namespaces.  If your code has to coexist with Windows, you&#39;ll have to stay far enough away from Windows names \u2014 they&#39;re effectively reserved for you."}, {"owner": {"reputation": 199, "user_id": 4883238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbdd8a03ea95fc24d6fd7087fc215c26?s=128&d=identicon&r=PG&f=1", "display_name": "BugSquasher", "link": "https://stackoverflow.com/users/4883238/bugsquasher"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565719410, "post_id": 57482934, "comment_id": 101437555, "body": "@JonathanLeffler macros don&#39;t care about namespaces, but I will be using one in my library as soon as I get around to it. Honestly, these are the two best libraries I could be using, as they both do exactly what I need."}, {"owner": {"reputation": 199, "user_id": 4883238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbdd8a03ea95fc24d6fd7087fc215c26?s=128&d=identicon&r=PG&f=1", "display_name": "BugSquasher", "link": "https://stackoverflow.com/users/4883238/bugsquasher"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565719547, "post_id": 57482934, "comment_id": 101437602, "body": "I will edit my question to provide a specific example."}, {"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 0, "creation_date": 1565719569, "post_id": 57482934, "comment_id": 101437615, "body": "@BugSquasher Is it something that <i>needs</i> to be a macro? You can do a lot with template meta-programming."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1565719912, "post_id": 57482934, "comment_id": 101437756, "body": "The C standard requires macros that map standard functions to be function-like macros (with a parameter list), which limits the damage they can do.  If the conflicting code is using object-like macros (no parameter list), then they do make life harder.  Otherwise, I&#39;m not sure there&#39;s an easy way out.  There are options in GCC to print all preprocessor definitions \u2014 see <a href=\"https://gcc.gnu.org/onlinedocs/gcc-9.2.0/gcc/Preprocessor-Options.html#Preprocessor-Options\" rel=\"nofollow noreferrer\">preprocessor options</a> especially <code>-dletters</code> (<code>-dM</code> etc)."}, {"owner": {"reputation": 199, "user_id": 4883238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbdd8a03ea95fc24d6fd7087fc215c26?s=128&d=identicon&r=PG&f=1", "display_name": "BugSquasher", "link": "https://stackoverflow.com/users/4883238/bugsquasher"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565720086, "post_id": 57482934, "comment_id": 101437829, "body": "-lmacros looks very promising @JonathanLeffler"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565720114, "post_id": 57482934, "comment_id": 101437846, "body": "The macro <code>Free</code> from the Nilaroa library obviously conflicts with the interface shown.  You either need to define <code>CINTERFACE</code> or you have to rename the macro: <code>#define Nilaroa_Free(ptr) \u2026</code> or something similar.  Otherwise, you&#39;re stuck between a rock and a hard place \u2014 you have to determine what you can change, and if you can&#39;t change any of the conflicting names, then you&#39;ll have to give up either on the o/s or the Nilaroa library \u2014 it&#39;s probably easier to give up on the library."}, {"owner": {"reputation": 199, "user_id": 4883238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbdd8a03ea95fc24d6fd7087fc215c26?s=128&d=identicon&r=PG&f=1", "display_name": "BugSquasher", "link": "https://stackoverflow.com/users/4883238/bugsquasher"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565720583, "post_id": 57482934, "comment_id": 101438047, "body": "@JonathanLeffler <code>#define CINTERFACE</code> seems to solve the problems. I can now compile an empty main while including headers for both Eagle and Nilorea. What do I lose by defining CINTERFACE? Just the C++ version of some COM functions? I can&#39;t quite tell what its for from a cursory google."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565721895, "post_id": 57482934, "comment_id": 101438590, "body": "I&#39;ve no idea what you&#39;re losing \u2014 I&#39;m not a Windows programmer.  It isn&#39;t strictly C code that you&#39;re losing (it&#39;s C++ code, AFAICT, plus some macros), but that&#39;s probably not news to you.  If you weren&#39;t aware of using it, you probably weren&#39;t.  (And apologies for the typo of Nilaroa for Nilorea.)"}], "owner": {"reputation": 199, "user_id": 4883238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbdd8a03ea95fc24d6fd7087fc215c26?s=128&d=identicon&r=PG&f=1", "display_name": "BugSquasher", "link": "https://stackoverflow.com/users/4883238/bugsquasher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1565719827, "creation_date": 1565718476, "last_edit_date": 1565719827, "question_id": 57482934, "link": "https://stackoverflow.com/questions/57482934/identifying-and-avoiding-macros", "title": "Identifying and avoiding macros", "body": "<p>I have a combination of libraries that are suffering from namespace pollution due to the use of macros and macro names in function prototypes of the same name. Specifically, I am using my GUI library Eagle and my friend's networking library Nilorea.</p>\n\n<ol>\n<li><p>How do I obtain a list of all the function like macros included in my code? I looked at MSVS and CodeBlocks and I can't seem to find a way to list them. I can also use <code>grep</code>, but that is only effective on a directory or easily obtained list of files.</p>\n\n<p>I read about this (<a href=\"https://stackoverflow.com/questions/1951885/macro-and-function-with-same-name\">Macro and function with same name</a>) and discovered I can (surround) a function name in a declaration to prevent macro expansion, but that only solves the instances where I am using a function with the same name as the macro. MinGW is using macro names for functions I cannot change.</p>\n\n<p>I avoided some namespace collision by separating out bad headers like <code>windows.h</code> and defining NOGDI to avoid some others, but I can't seem to get rid of them all.</p></li>\n<li><p>I know I can <code>#undef</code> a symbol if I need to and I've had limited success with this, along with changing the order of inclusion of headers, but I'm still having problems.</p></li>\n</ol>\n\n<p>So what options do I have to scrub my code of these obnoxious macros?'</p>\n\n<p>I looked at the CPP (C preprocessor) program's help and it doesn't show any abilities to list the macros in a given header.</p>\n\n<p>Do I need to write my own custom solution? What about Clang?</p>\n\n<p>For an example of the collision between Nilorea and MinGW-W64 see here :</p>\n\n<p>This is a macro in Nilorea that collides with mingw :</p>\n\n<pre><code>/*! Free Handler to get errors */\n#define Free( ptr ) \\\n    if (  ptr  )\\\n    {\\\n        free(  ptr  );\\\n        ptr  = NULL;\\\n    }\\\n    else\\\n    {\\\n        n_log( LOG_DEBUG , \"Free( %s ) already done or NULL at line %d of %s \\n\", #ptr , __LINE__ , __FILE__ );\\\n    }\n</code></pre>\n\n<p>The compiler error it generates is misleading, but points to c:\\mingw\\i686-w64-mingw32\\include\\objidbase.h and oaidl.h in these function prototypes :</p>\n\n<pre><code>#if defined(__cplusplus) &amp;&amp; !defined(CINTERFACE)\nMIDL_INTERFACE(\"00000002-0000-0000-c000-000000000046\")\nIMalloc : public IUnknown\n{\n    virtual void * STDMETHODCALLTYPE Alloc(\n        SIZE_T cb) = 0;\n\n    virtual void * STDMETHODCALLTYPE Realloc(\n        void *pv,\n        SIZE_T cb) = 0;\n\n    virtual void STDMETHODCALLTYPE Free(\n        void *pv) = 0;\n\n    virtual SIZE_T STDMETHODCALLTYPE GetSize(\n        void *pv) = 0;\n\n    virtual int STDMETHODCALLTYPE DidAlloc(\n        void *pv) = 0;\n\n    virtual void STDMETHODCALLTYPE HeapMinimize(\n        ) = 0;\n\n};\n\n</code></pre>\n"}, {"tags": ["c", "pointers", "memory-management", "scope"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "edited": false, "score": 0, "creation_date": 1565718584, "post_id": 57482920, "comment_id": 101437169, "body": "But free() will delete the pointer and the memory in the address,i want a way to delete only the 4 bytes that the pointer as an integer is taking in the memory(i NEED those 4 bytes hah)"}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "reply_to_user": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "edited": false, "score": 0, "creation_date": 1565718624, "post_id": 57482920, "comment_id": 101437192, "body": "@Jesepy I do not understand what you mean. free does not delete the pointer itself. It frees the memory pointed to by the pointer."}, {"owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "edited": false, "score": 0, "creation_date": 1565718737, "post_id": 57482920, "comment_id": 101437248, "body": "Pointer is an integer that has stored an address,i want to delete the integer/pointer and keep the memory in adress"}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "reply_to_user": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "edited": false, "score": 0, "creation_date": 1565718827, "post_id": 57482920, "comment_id": 101437285, "body": "@Jesepy Variables with automatic storage duration stop their life when the program control goes outside the scope where variables are declared. And pointers are not integers. So it is unclear what you are trying to achieve."}, {"owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "edited": false, "score": 0, "creation_date": 1565718967, "post_id": 57482920, "comment_id": 101437353, "body": "Then i cant delete the pointer as an integer alone,but in the code does temp as an integer get deleted after the function ends?"}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "reply_to_user": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "edited": false, "score": 0, "creation_date": 1565719022, "post_id": 57482920, "comment_id": 101437374, "body": "@Jesepy Read one more my answer."}, {"owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "edited": false, "score": 0, "creation_date": 1565719185, "post_id": 57482920, "comment_id": 101437449, "body": "I see,its clear now thanks.(Stackoverflow:&quot; dont post thanks in comments&quot; eh)"}], "tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": true, "score": 1, "last_activity_date": 1565719281, "last_edit_date": 1565719281, "creation_date": 1565718405, "answer_id": 57482920, "question_id": 57482876, "link": "https://stackoverflow.com/questions/57482876/if-with-function-i-return-a-pointer-created-inside-it-will-the-pointers-4-bytes/57482920#57482920", "title": "If with function i return a pointer created inside it,will the pointer&#39;s 4 bytes created in function be freed after it ends?", "body": "<p>In the function </p>\n\n<pre><code>int * Array_K_Size(int number)\n{\n    int *temp;\n\n    temp = (int *) calloc(number,sizeof(int));\n\n    for ( int i=0; i&lt;number; i++)\n        temp[i] = 1;\n\n    return temp;\n}\n</code></pre>\n\n<p>You dynamically allocated an array and a pointer to its first element is returned.</p>\n\n<p>Its value is assigned to the pointer <code>ptr</code></p>\n\n<pre><code>ptr = Array_K_Size(number);\n</code></pre>\n\n<p>That is the pointer <code>ptr</code> gets a copy of the value stored in the local pointer temp. The local variable temp will not be alive after exiting the function. Nevertheless the allocated dynamically memory is still alive outside the function.</p>\n\n<p>To free the allocated memory you need just to call</p>\n\n<pre><code>free( ptr );\n</code></pre>\n\n<p>The scope of the pointer <code>temp</code> is the body of the function <code>Array_K_Size</code>.</p>\n\n<p>The scope of the pointer <code>ptr</code> is the body of the function <code>main</code>.</p>\n\n<p>From the C Standard (6.2.4 Storage durations of objects)</p>\n\n<blockquote>\n  <p>5 An object whose identifier is declared with no linkage and without\n  the storage-class specifier static has <strong>automatic storage duration</strong>,\n  as do some compound literals....</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>6 For such an object that does not have a variable length array type,\n  <strong>its lifetime extends from entry into the block with which it is\n  associated until execution of that block ends in any way</strong></p>\n</blockquote>\n\n<p>The both pointers <code>temp</code> and <code>ptr</code> have automatic storage duration but each is declared in each own block.</p>\n"}], "owner": {"reputation": 35, "user_id": 11919008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c6cd7a52c6ac35376cb4a50e328e37?s=128&d=identicon&r=PG", "display_name": "Jesepy", "link": "https://stackoverflow.com/users/11919008/jesepy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 57482920, "answer_count": 1, "score": 1, "last_activity_date": 1565719281, "creation_date": 1565718235, "last_edit_date": 1565719075, "question_id": 57482876, "link": "https://stackoverflow.com/questions/57482876/if-with-function-i-return-a-pointer-created-inside-it-will-the-pointers-4-bytes", "title": "If with function i return a pointer created inside it,will the pointer&#39;s 4 bytes created in function be freed after it ends?", "body": "<p>Any comments about the quality of my post are welcome,im new.</p>\n\n<p>1)Will the 4 bytes of temp(pointer) be cleared after the function ends?</p>\n\n<p>2)(Not from the code bellow)If i have pointer1 that points to address A and i copy address A to pointer2, how do i free the memory that pointer1(the 4 bytes as an int) takes and keep only the new pointer2?</p>\n\n<p>(The code bellow)The code gets a number from user (lets say 4) and uses a function to make an array of size 4 with 1 in every slot. </p>\n\n<pre><code>int * Array_K_Size(int number)\n{\n    int *temp;\n\n    temp = (int *) calloc(number,sizeof(int));\n\n    for ( int i=0; i&lt;number; i++)\n        temp[i] = 1;\n\n    return temp;\n}\n\nint main()\n{\n    int number,*ptr=NULL;\n\n    printf(\"Give number: \");\n    scanf(\"%i\",&amp;number);\n\n    ptr = Array_K_Size(number);\n\n    for ( int i=0; i&lt;number; i++)\n        printf(\"Position %3i of array is: %3i\\n\",i+1,ptr[i]);\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["java", "c", "openmpi"], "answers": [{"tags": [], "owner": {"reputation": 1582, "user_id": 189297, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b98a34931025b9d4a04b33b38e7f8504?s=128&d=identicon&r=PG", "display_name": "Aaron Altman", "link": "https://stackoverflow.com/users/189297/aaron-altman"}, "is_accepted": false, "score": 0, "last_activity_date": 1569530619, "creation_date": 1569530619, "answer_id": 58124514, "question_id": 57482736, "link": "https://stackoverflow.com/questions/57482736/are-run-time-structs-possible-in-open-mpi/58124514#58124514", "title": "Are run time structs possible in open MPI?", "body": "<p>It sounds like you may be looking for <code>MPI_Type_create_struct</code>: <a href=\"https://www.mpich.org/static/docs/v3.1/www3/MPI_Type_create_struct.html\" rel=\"nofollow noreferrer\">https://www.mpich.org/static/docs/v3.1/www3/MPI_Type_create_struct.html</a>.  See previous questions and answers like:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/44892788/mpi-create-mpi-datatype-from-struct-containing-structs-with-structs-and-typedef\">MPI create MPI_Datatype from struct containing structs with structs and typedef</a></li>\n<li><a href=\"https://stackoverflow.com/questions/41225554/using-mpi-type-create-struct-to-transfer-structs-containing-dynamic-arrays-in\">Using MPI_Type_create_struct() to transfer structs containing dynamic arrays in C</a></li>\n</ul>\n"}], "owner": {"reputation": 97, "user_id": 3868835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c0d6f3c760cbdd2aa81bd1148902945?s=128&d=identicon&r=PG&f=1", "display_name": "kroppian", "link": "https://stackoverflow.com/users/3868835/kroppian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569530619, "creation_date": 1565717687, "question_id": 57482736, "link": "https://stackoverflow.com/questions/57482736/are-run-time-structs-possible-in-open-mpi", "title": "Are run time structs possible in open MPI?", "body": "<p>I'm trying to create a custom data type (which I call <code>AttribStruct</code>)  using Open MPI's Java bindings, but I'm getting a <code>invalid datatype</code> error when I try to run the program. I suspect it's because the dimensions of the arrays within the structs are determined at run time.</p>\n\n<p>My goal is to send n <code>AttribStruct</code> buffers in each <code>send</code> and <code>recv</code> operation. So, I concatenate all <code>n</code> individual buffers into one big buffer in order to send them all together. Then the receiving end deconstructs the buffers.</p>\n\n<p>Below is the AttribStruct class</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>public class AttribStruct extends Struct {\n\n    // Pointers to  the objectives, variables, and constraints\n    private final int objectives;\n    private final int variables;\n    private final int constraints;\n\n    // an int that represents a boolean for whether the objectives are valid (1 true, 0 false)\n    private final int validObjectiveFunctionsValues;\n    private final int validConstraintsViolationValues;\n\n    public final int objCount;\n    public final int varCount;\n    public final int constrCount;\n\n    public AttribStruct(int objCount, int varCount, int constrCount) {\n        this.objCount = objCount;\n        this.varCount = varCount;\n        this.constrCount = constrCount;\n        this.objectives = addDouble(this.objCount);\n        this.constraints = addDouble(this.constrCount);\n        this.variables = addDouble(this.varCount);\n\n        this.validObjectiveFunctionsValues = addInt();\n        this.validConstraintsViolationValues = addInt();\n\n    }\n\n    @Override\n    protected Data newData() {\n        return new Data();\n    }\n\n    public class Data extends Struct.Data {\n\n        /*\n         * Getters go here\n         */\n\n\n        /*\n         * Setters go here\n         */\n\n    } // End -- Data\n\n} \n\n</code></pre>\n\n<p>And below is an example of me sending a number of structs:</p>\n\n<pre><code>AttribStruct attr = new AttribStruct(4, 3, 0);\n/*\n * Build buffer goes here\n */\nattr.getType().commit();\nMPI.COMM_WORLD.iSend(toSend, n, attr.getType(), target, 0);\nattr.getType().free();\n</code></pre>\n\n<p>Where <code>toSend</code> is <code>n</code> different AttribStruct buffers concatenated together, <code>n</code> is the number of attribs structs I'm sending, <code>attr</code> is an instance of the AttribStruct class, <code>target</code> is the rank of the node I'm communicating with, and <code>0</code> is just a place holder. </p>\n\n<p>And below is a rough example of the target node receiving the message:</p>\n\n<pre><code>AttribStruct attr = new AttribStruct(4, 3, 0);\nattr.getType().commit();\nMPI.COMM_WORLD.recv(msgBuffer, n, attr.getType(), MASTER_RANK, 0);\nattr.getType().free();\n/*\n * Deconstruct buffer goes here\n */\n\n</code></pre>\n\n<p>However, when I run the program, I get the following error messages: </p>\n\n<pre><code>[node01:13219] *** An error occurred in MPI_Recv\n[node01:13219] *** reported by process [203161601,0]\n[node01:13219] *** on communicator MPI_COMM_WORLD\n[node01:13219] *** MPI_ERR_TYPE: invalid datatype\n[node01:13219] *** MPI_ERRORS_ARE_FATAL (processes in this communicator will now abort,\n[node01:13219] ***    and potentially your MPI job)\n</code></pre>\n\n<p>Does my overall strategy make sense? If so, can you help me figure out what I'm doing incorrectly? Let me know if you want further details, since I omitted some code to reduce clutter.</p>\n"}, {"tags": ["c", "struct", "quicksort", "qsort"], "comments": [{"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 1, "creation_date": 1565716014, "post_id": 57482269, "comment_id": 101436119, "body": "Please provide a minimal compiled example that reproduces the problem."}, {"owner": {"reputation": 5181, "user_id": 5529197, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6af647bacfb3f0b596c73b0e3b0dc4b1?s=128&d=identicon&r=PG&f=1", "display_name": "Afshin", "link": "https://stackoverflow.com/users/5529197/afshin"}, "edited": false, "score": 1, "creation_date": 1565716014, "post_id": 57482269, "comment_id": 101436120, "body": "your code is incomplete. please add full code. Off top of my head, you are accessing <code>Card</code> in <code>Deck</code> without allocating it...."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565773289, "post_id": 57482269, "comment_id": 101452867, "body": "<code>b-&gt;top++; b-&gt;c[b-&gt;top] = c;</code> Increase the variable <i>after</i> adding, not before."}], "answers": [{"tags": [], "owner": {"reputation": 5181, "user_id": 5529197, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6af647bacfb3f0b596c73b0e3b0dc4b1?s=128&d=identicon&r=PG&f=1", "display_name": "Afshin", "link": "https://stackoverflow.com/users/5529197/afshin"}, "is_accepted": true, "score": 2, "last_activity_date": 1565719138, "last_edit_date": 1565719138, "creation_date": 1565716416, "answer_id": 57482459, "question_id": 57482269, "link": "https://stackoverflow.com/questions/57482269/sorting-a-struct-with-array-pointer-is-not-working/57482459#57482459", "title": "Sorting a struct with array pointer is not working", "body": "<p>Hm....Your code seems like \"fill in the blanks\" since you have not posted your complete code and <em>the code that you have posted is correct</em>. So I completed your code in a way it works:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n// Your code\ntypedef struct Card {\n   int value;\n}Card;\n\ntypedef struct Deck{\n   Card *c[100];\n   int top;\n}Deck;\n\nint compare(const void *x, const void *y) {\n   Card*  xa = *(Card **) x;\n   Card*  ya = *(Card **) y;\n\n   if(xa-&gt;value == ya-&gt;value)\n      return 0;\n\n   if(xa-&gt;value &gt; ya-&gt;value)\n      return 1;\n\n   return -1;\n}\n\nvoid sort(Deck *b) {\n   qsort(b-&gt;c, b-&gt;top, sizeof(struct Card*), compare);\n}\n\n// My main\nint main() {\n    Deck d;\n    d.c[0] = calloc(1, sizeof(Card));\n    d.c[0]-&gt;value = 5;\n    d.c[1] = calloc(1, sizeof(Card));\n    d.c[1]-&gt;value = 1;\n    d.c[2] = calloc(1, sizeof(Card));\n    d.c[2]-&gt;value = 3;\n    d.top = 3;\n    sort(&amp;d);\n    printf(\"%d %d %d\", d.c[0]-&gt;value, d.c[1]-&gt;value, d.c[2]-&gt;value);\n    return 0;\n}\n</code></pre>\n\n<p>My guess in your segmentation fault is that you are accessing <code>Card</code> <strong>without allocating it</strong>.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>your <code>addCard()</code> is incorrect. Here is correct one:</p>\n\n<pre><code>void addCard(Deck *b, Card *c) {\n   b-&gt;c[b-&gt;top] = c;\n   b-&gt;top++;\n}\n</code></pre>\n\n<p>When you are adding cards, your <code>top</code> points place that you need to add card. So you need to increase it after adding. Just remember that you need to add checks for it too to prevent overflowing <code>Deck-&gt;c</code>.</p>\n"}], "owner": {"reputation": 13, "user_id": 10408031, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-bjJwZBJQL0s/AAAAAAAAAAI/AAAAAAAABiA/IQbN8h3qYoY/photo.jpg?sz=128", "display_name": "Kevin Uehara", "link": "https://stackoverflow.com/users/10408031/kevin-uehara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 57482459, "answer_count": 1, "score": 0, "last_activity_date": 1565719138, "creation_date": 1565715519, "last_edit_date": 1565718543, "question_id": 57482269, "link": "https://stackoverflow.com/questions/57482269/sorting-a-struct-with-array-pointer-is-not-working", "title": "Sorting a struct with array pointer is not working", "body": "<p>I'm creating two struct's: Deck and Card. I want sort the cards of the deck using qsort but this is not working. When I run an exception occurs: Segmentation fault. \nFollow my code: </p>\n\n<pre><code>typedef struct Card {\n   int value;\n}Card;\n\ntypedef struct Deck{\n   Card *c[100];\n   int top;\n}Deck;\n\nCard * newCard(int value) {\n   Card * aux = (Card *)malloc(sizeof(Card));\n   aux-&gt;value = value;\n\n   return aux;\n}\n\nDeck * newDeck() {\n   Deck * deck = (Deck *)malloc(sizeof(Deck));\n   deck-&gt;top = 0;\n\n   return deck;\n}\n\nvoid addCard(Deck *b, Card *c) {\n   b-&gt;top++;\n   b-&gt;c[b-&gt;top] = c;\n}\n\nint compare(const void *x, const void *y) {\n   Card * xa = *(Card **) x;\n   Card * ya = *(Card **) y;\n\n   if(xa-&gt;value == ya-&gt;value)\n      return 0;\n\n   if(xa-&gt;value &gt; ya-&gt;value)\n      return 1;\n\n   return -1;\n}\n\nvoid sort(Deck *b) {\n   qsort(b-&gt;c, b-&gt;top, sizeof(struct Card*), compare);\n}\n\nint main() {\n   Deck * b = newDeck();\n   addCard(b,newCard(11));\n   addCard(b,newCard(12));\n   addCard(b,newCard(11));\n   addCard(b,newCard(1));\n   addCard(b,newCard(1));\n\n   sort(b);\n\n   return 0;\n}\n</code></pre>\n\n<p>Someone can help me? I just want sort the cards of the deck but something is wrong with the logic. Probably something like pointer(malloc or calloc?).</p>\n"}, {"tags": ["c++", "c"], "comments": [{"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 12, "creation_date": 1565712683, "post_id": 57481486, "comment_id": 101434745, "body": "If your compiler doesn&#39;t provide a 128-bit integer type (like GCC and others do on some platforms), there is no way to create something that behaves like a new, larger, arithmetic type in C. In C++, you could create a class, and define operator overrides for it that allow it to behave like a larger integer type. This is what is being done in <a href=\"https://github.com/calccrypto/uint128_t#uint128_t\" rel=\"nofollow noreferrer\">this project</a>. Please specify which language you are using, <a href=\"https://stackoverflow.com/questions/tagged/c\">c</a> and <a href=\"https://stackoverflow.com/questions/tagged/c%2b%2b\">c++</a> are not the same."}, {"owner": {"reputation": 3958, "user_id": 535724, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9a7cd70ab9eda527473e023a3ecc3333?s=128&d=identicon&r=PG", "display_name": "umlcat", "link": "https://stackoverflow.com/users/535724/umlcat"}, "reply_to_user": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 0, "creation_date": 1565713488, "post_id": 57481486, "comment_id": 101435088, "body": "@Thomas Jagger I want to interact with both &quot;c&quot; and &quot;c++&quot;"}, {"owner": {"reputation": 98775, "user_id": 421195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9a9793fdeb3b94e185c8c99c0238372f?s=128&d=identicon&r=PG", "display_name": "paulsm4", "link": "https://stackoverflow.com/users/421195/paulsm4"}, "edited": false, "score": 0, "creation_date": 1565713983, "post_id": 57481486, "comment_id": 101435266, "body": "@umlcat: I think yours is a fair question (I even upvoted it).  But a C++ solution will likely be radically different than a C solution (with the understanding that a &quot;C&quot; solution should be compatible to both)."}, {"owner": {"reputation": 40655, "user_id": 1023390, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/2g9CZ.jpg?s=128&g=1", "display_name": "Walter", "link": "https://stackoverflow.com/users/1023390/walter"}, "edited": false, "score": 3, "creation_date": 1565714683, "post_id": 57481486, "comment_id": 101435560, "body": "I don&#39;t think that <code>packed</code> and <code>aligned</code> are valid C++ keywords."}, {"owner": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "reply_to_user": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 1, "creation_date": 1565714787, "post_id": 57481486, "comment_id": 101435602, "body": "@KonradRudolph The question has been edited after I wrote my first comment."}, {"owner": {"reputation": 3108, "user_id": 4641116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gc52U.png?s=128&g=1", "display_name": "Eljay", "link": "https://stackoverflow.com/users/4641116/eljay"}, "edited": false, "score": 5, "creation_date": 1565715317, "post_id": 57481486, "comment_id": 101435820, "body": "Your requirements &quot;similar to a simple type&quot; and &quot;interact with C&quot; are mutually exclusive.  You could get closer with C++, but will still have oddities compared to simple types."}, {"owner": {"reputation": 3958, "user_id": 535724, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9a7cd70ab9eda527473e023a3ecc3333?s=128&d=identicon&r=PG", "display_name": "umlcat", "link": "https://stackoverflow.com/users/535724/umlcat"}, "edited": false, "score": 0, "creation_date": 1565716442, "post_id": 57481486, "comment_id": 101436279, "body": "@KonradRudolph I edited the question (rephrase) as VTT indicates, to correct it."}, {"owner": {"reputation": 46978, "user_id": 856199, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/CPtki.png?s=128&g=1", "display_name": "Nikos C.", "link": "https://stackoverflow.com/users/856199/nikos-c"}, "edited": false, "score": 0, "creation_date": 1565717094, "post_id": 57481486, "comment_id": 101436527, "body": "Not sure I understand the question. Are you looking for this, basically: <a href=\"https://stackoverflow.com/questions/4306186/structure-padding-and-packing\" title=\"structure padding and packing\">stackoverflow.com/questions/4306186/&hellip;</a>"}, {"owner": {"reputation": 269328, "user_id": 5987, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/2a1f9f4986b58015691eb2014e78869f?s=128&d=identicon&r=PG", "display_name": "Mark Ransom", "link": "https://stackoverflow.com/users/5987/mark-ransom"}, "edited": false, "score": 0, "creation_date": 1565717311, "post_id": 57481486, "comment_id": 101436614, "body": "Are you looking to do any operations other than assignment? I think the code you have would work fine for assignment."}, {"owner": {"reputation": 3958, "user_id": 535724, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9a7cd70ab9eda527473e023a3ecc3333?s=128&d=identicon&r=PG", "display_name": "umlcat", "link": "https://stackoverflow.com/users/535724/umlcat"}, "reply_to_user": {"reputation": 269328, "user_id": 5987, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/2a1f9f4986b58015691eb2014e78869f?s=128&d=identicon&r=PG", "display_name": "Mark Ransom", "link": "https://stackoverflow.com/users/5987/mark-ransom"}, "edited": false, "score": 0, "creation_date": 1565795718, "post_id": 57481486, "comment_id": 101464755, "body": "@Mark Random as operators, Assignment, Equality, mostly user defined functions. I like to make udf before overloaded operators, and keep a func version of operator with unique id"}], "answers": [{"comments": [{"owner": {"reputation": 3958, "user_id": 535724, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9a7cd70ab9eda527473e023a3ecc3333?s=128&d=identicon&r=PG", "display_name": "umlcat", "link": "https://stackoverflow.com/users/535724/umlcat"}, "edited": false, "score": 0, "creation_date": 1565795991, "post_id": 57483022, "comment_id": 101464916, "body": "I prefer to use a user defined data type independent of other fields on a structure. The question also applied to typed different than UUID"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 3958, "user_id": 535724, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9a7cd70ab9eda527473e023a3ecc3333?s=128&d=identicon&r=PG", "display_name": "umlcat", "link": "https://stackoverflow.com/users/535724/umlcat"}, "edited": false, "score": 0, "creation_date": 1565796446, "post_id": 57483022, "comment_id": 101465190, "body": "This is literally the purpose of a UDT. Are you encountering some practical problem with these common techniques, @umlcat?"}, {"owner": {"reputation": 3958, "user_id": 535724, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9a7cd70ab9eda527473e023a3ecc3333?s=128&d=identicon&r=PG", "display_name": "umlcat", "link": "https://stackoverflow.com/users/535724/umlcat"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1565796678, "post_id": 57483022, "comment_id": 101465320, "body": "@Lightness I see this particular case, as a very uncommon case, I declare a lot of user defined typed, that are larger, than CPU register, but, never had one, than required to be used as a simple type"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1565797250, "post_id": 57483022, "comment_id": 101465606, "body": "How is this an uncommon case? It describes literally every UDT every created. That&#39;s what a UDT <i>is</i>. It sounds like you need to do a little more research!"}, {"owner": {"reputation": 91978, "user_id": 387076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/cFyP6.jpg?s=128&g=1", "display_name": "Gilles &#39;SO- stop being evil&#39;", "link": "https://stackoverflow.com/users/387076/gilles-so-stop-being-evil"}, "reply_to_user": {"reputation": 3958, "user_id": 535724, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9a7cd70ab9eda527473e023a3ecc3333?s=128&d=identicon&r=PG", "display_name": "umlcat", "link": "https://stackoverflow.com/users/535724/umlcat"}, "edited": false, "score": 0, "creation_date": 1565802396, "post_id": 57483022, "comment_id": 101467863, "body": "@umlcat I don&#39;t understand. What do you mean by \u201cindependent of other fields on a structure\u201d? What do you mean by \u201crequired to be used as a simple type\u201d?"}, {"owner": {"reputation": 3958, "user_id": 535724, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9a7cd70ab9eda527473e023a3ecc3333?s=128&d=identicon&r=PG", "display_name": "umlcat", "link": "https://stackoverflow.com/users/535724/umlcat"}, "edited": false, "score": 0, "creation_date": 1565970297, "post_id": 57483022, "comment_id": 101521315, "body": "@Gilles some of the types I want to implement, are number-alike, but, doesn&#39;t necessarily, require arithmetic, like add or subtract, or less or greater, maybe are equal or not."}], "tags": [], "owner": {"reputation": 91978, "user_id": 387076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/cFyP6.jpg?s=128&g=1", "display_name": "Gilles &#39;SO- stop being evil&#39;", "link": "https://stackoverflow.com/users/387076/gilles-so-stop-being-evil"}, "is_accepted": false, "score": 2, "last_activity_date": 1565718853, "creation_date": 1565718853, "answer_id": 57483022, "question_id": 57481486, "link": "https://stackoverflow.com/questions/57481486/how-to-declare-compact-type-larger-than-cpu-machine/57483022#57483022", "title": "How to declare compact type larger than CPU machine?", "body": "<p>A struct works like a simple type for the purpose of passing it around, taking its address, <code>sizeof</code>, etc. To just store some unstructured data inside, make a struct that contains a single array field.</p>\n\n<pre><code>typedef struct {\n    uint8_t a[16];\n} code128;\n</code></pre>\n\n<p>Depending on what you want to store, you may want to put more structure in your struct. For example, a UUID is formally defined as having fields of a certain size, some of which are stored in platform endianness. (However not all software cares about endianness, and modern software often treats UUIDs as just a bunch of bytes.)</p>\n\n<pre><code>typedef struct {\n    uint32_t time_low;\n    uint16_t time_mid;\n    uint16_t time_hi_and_version;\n    uint8_t clock_seq_hi_and_res;\n    uint8_t clock_seq_low;\n    uint8_t node[6];\n</code></pre>\n\n<p>For a 128-bit time, what this could be depends on how the time is counted. It's common to represent time as a 64-bit number of seconds and a number of fractions such as nanoseconds or 2^64th of a second. For example, modern Unix systems have this type:</p>\n\n<pre><code>typedef struct timeval {\n    uint64_t tv_sec;\n    uint64_t tv_usec;\n};\n</code></pre>\n\n<p>You can't do arithmetic on these structures, but arithmetic is meaningless on UUID anyway, and arithmetic on time is usually not direct arithmetic because time with subsecond precision is usually not represented as a single number.</p>\n\n<p>If you do need arithmetic, some platforms offer <code>uint128_t</code>, but that's not portable (any C or C++ implementation must offer an integer type that's at least 64 bits, but they don't have to go beyond that). For example GCC and Clang both offer double-width integer types, so they offer <code>uint128_t</code> on machines where the CPU has 64-bit registers, but only up to <code>uint64_t</code> on 32-bit CPUs.</p>\n"}], "owner": {"reputation": 3958, "user_id": 535724, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9a7cd70ab9eda527473e023a3ecc3333?s=128&d=identicon&r=PG", "display_name": "umlcat", "link": "https://stackoverflow.com/users/535724/umlcat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1565796237, "creation_date": 1565712087, "last_edit_date": 1565796237, "question_id": 57481486, "link": "https://stackoverflow.com/questions/57481486/how-to-declare-compact-type-larger-than-cpu-machine", "title": "How to declare compact type larger than CPU machine?", "body": "<p>Sometimes, I need to declare a type, that works similar to a simple type, that may have a larger size than the register of a cpu, in some machines, in others not.</p>\n\n<p>For example, a UUID (128 bits) or a (128 bits) datetime, in a 32 bits or 64 bits machine.</p>\n\n<p>In some cases, there already are multiplatform libraries, but, in another doesn't. </p>\n\n<p>I know is recommended to stick to existing libraries, but, in case that doesn't, how should I do ?</p>\n\n<p>Example:</p>\n\n<pre><code>typedef\n  uint_16 /* redeclare as */ code16;\n  uint_32 /* redeclare as */ code32;\n\n// option 1\nstruct code64\n{\n  packed uint_32 A, B;\n};\n\n// option 2\nstruct code64\n{\n  aligned uint32_t A, B;\n};\n\n// option 3\ntypedef\n  packed uint_16 code64[4];\n\nvoid Example( )\n{ \n  code64 A = Foo();\n  code64 B = Bar();\n  code64 Q = Zaz(A, B);\n}\n</code></pre>\n\n<p>As the  tags indicates, I want it to be compiled, both, in \"C\" and \"C++\".</p>\n\n<p>I already search for this subject in other questions, on stackoverflow.</p>\n"}, {"tags": ["c", "pointers", "char", "printf", "c-strings"], "comments": [{"owner": {"reputation": 5192, "user_id": 2318649, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rW1HG.jpg?s=128&g=1", "display_name": "barny", "link": "https://stackoverflow.com/users/2318649/barny"}, "edited": false, "score": 2, "creation_date": 1565710877, "post_id": 57481180, "comment_id": 101433854, "body": "&quot;doesn&#39;t seem to work&quot; isn&#39;t a very useful diagnostic aid. What <i>does</i> it do?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 2, "creation_date": 1565711403, "post_id": 57481180, "comment_id": 101434123, "body": "&quot;It gives the error error: format specifies type &#39;char *&#39; but the argument has type &#39;char&#39;&quot; I don&#39;t see how you can get that error message for the code you&#39;ve posted. The <code>%c</code> format specifier implies the type <code>char</code>, not <code>char*</code>. That message would only make sense if you used <code>%s</code> instead of <code>%c</code> (or you used <code>%c</code> with <code>(f)scanf</code> instead of <code>(f)printf</code>)."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1565713089, "post_id": 57481180, "comment_id": 101434924, "body": "Are you trying to print a character or a string? If <code>name</code> is a <code>char *</code>, then <code>*name</code> is a <code>char</code>, that is, a single character. Also, <code>%c</code> is the format specifier for a character. What exactly are you trying to print?"}, {"owner": {"reputation": 103, "user_id": 11733507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c4f5e193df150fea56c5f228768c0cb?s=128&d=identicon&r=PG&f=1", "display_name": "TriposG", "link": "https://stackoverflow.com/users/11733507/triposg"}, "edited": false, "score": 0, "creation_date": 1565714604, "post_id": 57481180, "comment_id": 101435524, "body": "The issue has been resolved. The first answer below solved my issue."}], "answers": [{"tags": [], "owner": {"reputation": 4756, "user_id": 10001688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvhzK.jpg?s=128&g=1", "display_name": "Michael Bianconi", "link": "https://stackoverflow.com/users/10001688/michael-bianconi"}, "is_accepted": false, "score": 2, "last_activity_date": 1565710941, "creation_date": 1565710941, "answer_id": 57481212, "question_id": 57481180, "link": "https://stackoverflow.com/questions/57481180/how-to-print-char/57481212#57481212", "title": "How to print char *", "body": "<p>If <code>name</code> is a <code>char*</code>, you only need to use <code>fprintf(stderr,\"%s\",name);</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": true, "score": 5, "last_activity_date": 1565710951, "creation_date": 1565710951, "answer_id": 57481216, "question_id": 57481180, "link": "https://stackoverflow.com/questions/57481180/how-to-print-char/57481216#57481216", "title": "How to print char *", "body": "<p>Here you are</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void) \n{\n    char *name = \"TriposG\";\n\n    fprintf( stderr, \"%s\", name );\n\n    return 0;\n}\n</code></pre>\n\n<p>As for this statement</p>\n\n<pre><code>fprintf( stderr, \"%c\", *name);\n</code></pre>\n\n<p>then it outputs the first character of the string pointed to by the pointer <code>name</code>.</p>\n"}], "owner": {"reputation": 103, "user_id": 11733507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c4f5e193df150fea56c5f228768c0cb?s=128&d=identicon&r=PG&f=1", "display_name": "TriposG", "link": "https://stackoverflow.com/users/11733507/triposg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2995, "favorite_count": 0, "closed_date": 1565750316, "accepted_answer_id": 57481216, "answer_count": 2, "score": -3, "last_activity_date": 1565713417, "creation_date": 1565710809, "last_edit_date": 1565711087, "question_id": 57481180, "link": "https://stackoverflow.com/questions/57481180/how-to-print-char", "closed_reason": "Not suitable for this site", "title": "How to print char *", "body": "<p>I am trying to print char * name;</p>\n\n<p>I have tried that</p>\n\n<pre><code>fprintf(stderr,\"%c\",* name)\n</code></pre>\n\n<p>But it doesn't seem to work. My reasoning was that since name is a character pointer I could use * to get the value for the pointer.</p>\n\n<p>It gives the error\nerror: format specifies type 'char *' but the argument has type 'char'</p>\n"}, {"tags": ["c", "shell", "operating-system", "signals"], "comments": [{"owner": {"reputation": 335, "user_id": 9698161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2881d4f88da4ddcd701eccf723006f?s=128&d=identicon&r=PG&f=1", "display_name": "J.Panek", "link": "https://stackoverflow.com/users/9698161/j-panek"}, "edited": false, "score": 0, "creation_date": 1565710403, "post_id": 57480852, "comment_id": 101433607, "body": "you are changing the disposition of SIGINT inside the main <b>and</b> inside your sigintHandler function"}, {"owner": {"reputation": 667, "user_id": 6321700, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ThyXm4Te_Hc/AAAAAAAAAAI/AAAAAAAAAPc/5IYlDo3xh5k/photo.jpg?sz=128", "display_name": "Mandar Sadye", "link": "https://stackoverflow.com/users/6321700/mandar-sadye"}, "reply_to_user": {"reputation": 335, "user_id": 9698161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2881d4f88da4ddcd701eccf723006f?s=128&d=identicon&r=PG&f=1", "display_name": "J.Panek", "link": "https://stackoverflow.com/users/9698161/j-panek"}, "edited": false, "score": 0, "creation_date": 1565710779, "post_id": 57480852, "comment_id": 101433800, "body": "@J.Panek Sorry but can you elaborate, please. I am sorry if I am not picking on an obvious mistake. I didn&#39;t get what you are trying to say. In both programs statement calling signalHandler seem to be identical."}, {"owner": {"reputation": 335, "user_id": 9698161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2881d4f88da4ddcd701eccf723006f?s=128&d=identicon&r=PG&f=1", "display_name": "J.Panek", "link": "https://stackoverflow.com/users/9698161/j-panek"}, "edited": false, "score": 0, "creation_date": 1565711188, "post_id": 57480852, "comment_id": 101434006, "body": "You call signal in your main and change the behavior of SIGINT, then inside the handler you call signal again and change SIGINT again. Only call it from inside the main in your case. Leave only the <code>printf(&quot;\\n&quot;);</code> inside <code>sigintHandle</code>"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1565712514, "post_id": 57480852, "comment_id": 101434683, "body": "Don&#39;t use <code>signal()</code> \u2014 use <code>sigaction()</code> (see <a href=\"https://stackoverflow.com/questions/231912/what-is-the-difference-between-sigaction-and-signal\">What is the difference between <code>sigaction()</code> and <code>signal()</code>?</a>).  Don&#39;t use <code>printf()</code> in a signal handler; it can lead to undefined behaviour (see <a href=\"https://stackoverflow.com/questions/16891019/\">How to avoid using <code>printf()</code> in a signal handler</a>).  Don&#39;t use <code>loop()</code> in the signal handler \u2014 it is completely unsupportable."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 335, "user_id": 9698161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2881d4f88da4ddcd701eccf723006f?s=128&d=identicon&r=PG&f=1", "display_name": "J.Panek", "link": "https://stackoverflow.com/users/9698161/j-panek"}, "edited": false, "score": 1, "creation_date": 1565712772, "post_id": 57480852, "comment_id": 101434788, "body": "@J.Panek: some variants of <code>signal()</code> reset the signal handler and require the signal handler to reinstate signal handling.  Look up <code>SA_RESETHAND</code> in <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/sigaction.html\" rel=\"nofollow noreferrer\"><code>sigaction()</code></a> which is there in large part to allow the simulation of antique <code>signal()</code> implementations using <code>sigaction()</code>.  The semantics of <code>signal()</code> in standard C are minimal; the semantics of <code>signal()</code> in POSIX reflect the divergence of actual implementations before POSIX was standardized.  POSIX recommends <code>sigaction()</code> for many reaons."}, {"owner": {"reputation": 667, "user_id": 6321700, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ThyXm4Te_Hc/AAAAAAAAAAI/AAAAAAAAAPc/5IYlDo3xh5k/photo.jpg?sz=128", "display_name": "Mandar Sadye", "link": "https://stackoverflow.com/users/6321700/mandar-sadye"}, "reply_to_user": {"reputation": 335, "user_id": 9698161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2881d4f88da4ddcd701eccf723006f?s=128&d=identicon&r=PG&f=1", "display_name": "J.Panek", "link": "https://stackoverflow.com/users/9698161/j-panek"}, "edited": false, "score": 0, "creation_date": 1565712955, "post_id": 57480852, "comment_id": 101434871, "body": "@J.Panek even after doing these removing everything from a signal handler except printf, I still get the output as shown in code 1. I want some way to start the loop from the start if interrupt happens in the middle of the execution of the loop."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1565712958, "post_id": 57480852, "comment_id": 101434873, "body": "When you have the <code>loop()</code> call in the signal handler, you&#39;d probably find that the the interrupt signal is still blocked because you have not returned from the original signal handler.  Also, calling <code>loop()</code> in the signal handler means you&#39;re calling <code>loop()</code> recursively (albeit indirectly recursively).  The original call to <code>loop()</code> hasn&#39;t finished either.  Your <code>loop()</code> does no error checking; I hope that&#39;s because you&#39;ve created an MCVE (<a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, Verifiable Example?</a>) (or MRE or whatever name SO now uses)."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1565713036, "post_id": 57480852, "comment_id": 101434903, "body": "You should be paying attention to the return value from <code>scanf()</code>.  It will probably return an error condition if it is interrupted \u2014 and if it is interrupted, you should not use the value in <code>a</code>."}, {"owner": {"reputation": 667, "user_id": 6321700, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ThyXm4Te_Hc/AAAAAAAAAAI/AAAAAAAAAPc/5IYlDo3xh5k/photo.jpg?sz=128", "display_name": "Mandar Sadye", "link": "https://stackoverflow.com/users/6321700/mandar-sadye"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565713515, "post_id": 57480852, "comment_id": 101435097, "body": "@JonathanLeffler I will definitely look into the link you added in comments and consider switching to <code>sigaction</code>. What I want to know is that is there a way to start a loop cycle from the beginning if I am interrupted in the middle of executing a loop cycle. So,  actually, I don&#39;t want to use the value from <code>scanf</code> but ask the user again. is there any way to change the flow of program on interrupt. Is it a good idea to use goto? For example, if <code>bool inLoop</code> is true the goto first statement in the loop."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1565713801, "post_id": 57480852, "comment_id": 101435207, "body": "Look at what <code>scanf()</code> returns.  If it says <code>1</code>, you&#39;re OK to use the contents of <code>a</code>.  If it says <code>0</code> or <code>EOF</code>, you have more work to do.  You may need to use <code>clearerr(stdin)</code> to get anything sensible from the terminal thereafter.  You can then go back and prompt again."}], "answers": [{"comments": [{"owner": {"reputation": 667, "user_id": 6321700, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ThyXm4Te_Hc/AAAAAAAAAAI/AAAAAAAAAPc/5IYlDo3xh5k/photo.jpg?sz=128", "display_name": "Mandar Sadye", "link": "https://stackoverflow.com/users/6321700/mandar-sadye"}, "edited": false, "score": 1, "creation_date": 1565801718, "post_id": 57495997, "comment_id": 101467600, "body": "Well, what I was missing was the check of <code>errno</code>. Good thing is that it works for <code>getc</code> in my original code. I will definitely keep in mind your suggestions. Thank you."}], "tags": [], "owner": {"reputation": 13767, "user_id": 2413201, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rxfuw.jpg?s=128&g=1", "display_name": "Armali", "link": "https://stackoverflow.com/users/2413201/armali"}, "is_accepted": true, "score": 2, "last_activity_date": 1565790323, "creation_date": 1565790323, "answer_id": 57495997, "question_id": 57480852, "link": "https://stackoverflow.com/questions/57480852/how-to-handle-control-c-signal-while-designing-a-shell/57495997#57495997", "title": "How to handle Control-C signal while designing a shell?", "body": "<p>Jonathan Leffler provided helpful hints (though not sufficient, at least on some popular operating system):</p>\n\n<ul>\n<li><em>Look at what <code>scanf()</code> returns.</em></li>\n<li><em>Don&#39;t use <code>loop()</code> in the signal handler</em></li>\n<li><em>Don&#39;t use <code>signal()</code> \u2014 use <code>sigaction()</code></em>. In your case, this has two advantages:\n\n<ul>\n<li>Restoring the signal action to the default state on call of the signal  handler can be avoided, so you don't have to change the action again in the handler.</li>\n<li>Restarting the <code>read()</code> system call (inside <code>scanf()</code>) can be avoided, so that <em><code>scanf()</code> returns</em> and you can react to the interrupt in the first place.</li>\n</ul></li>\n</ul>\n\n<p>So, the signal handler can be just</p>\n\n<pre><code>void sigintHandler(int sig_num)\n{\n    printf(\"\\n\");   // or perhaps better write(1, \"\\n\", 1)\n}\n</code></pre>\n\n<p>The <code>signal(SIGINT, sigintHandler);</code> in <code>main()</code> can be replaced with</p>\n\n<pre><code>  sigaction(SIGINT, &amp;(struct sigaction){ .sa_handler = sigintHandler }, NULL);\n</code></pre>\n\n<p>and the <code>scanf(\"%s\",a);</code> with</p>\n\n<pre><code>      if (scanf(\"%s\", a) == EOF)\n      {\n          if (errno == EINTR) continue; // read operation interrupted by signal\n          return;\n      }\n</code></pre>\n\n<p>EOF is returned on interrupt as well as on end of file, so the cases are to be distinguished through <code>errno</code>. Besides, it's nice if your program provides a way to exit it, thus the <code>return</code>.</p>\n"}], "owner": {"reputation": 667, "user_id": 6321700, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ThyXm4Te_Hc/AAAAAAAAAAI/AAAAAAAAAPc/5IYlDo3xh5k/photo.jpg?sz=128", "display_name": "Mandar Sadye", "link": "https://stackoverflow.com/users/6321700/mandar-sadye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 599, "favorite_count": 1, "accepted_answer_id": 57495997, "answer_count": 1, "score": 2, "last_activity_date": 1565790323, "creation_date": 1565709607, "question_id": 57480852, "link": "https://stackoverflow.com/questions/57480852/how-to-handle-control-c-signal-while-designing-a-shell", "title": "How to handle Control-C signal while designing a shell?", "body": "<p>I am trying to implement some of the features present in the shell including quitting only when a user enters quit and not on Ctrl+C. Below is a simplified version of the code that I am tried.</p>\n\n<p>Code 1: without calling loop() in a signal handler.</p>\n\n<pre><code>void loop(){\n    while(1){\n      char a[20];\n      printf(\"Enter Command : \" );\n      scanf(\"%s\",a);\n      printf(\"%s\\n\", a);\n    }\n}\n\nvoid sigintHandler(int sig_num)\n{\n    signal(SIGINT, sigintHandler);\n    printf(\"\\n\");\n}\n\nint main(int argc, char const *argv[]) {\n\n  signal(SIGINT, sigintHandler);\n  loop();\n  return 0;\n}\n</code></pre>\n\n<p>The output of Code 1:</p>\n\n<p><a href=\"https://i.stack.imgur.com/JQHyX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/JQHyX.png\" alt=\"enter image description here\"></a></p>\n\n<p>As can be seen on a third input, I go to a new line and continued right from where I left the loop. I want to instead start the loop again. So, I did the following modification by calling loop in signal handler itself.</p>\n\n<pre><code>void loop(){\n    while(1){\n      char a[20];\n      printf(\"Enter Command : \" );\n      scanf(\"%s\",a);\n      printf(\"%s\\n\", a);\n    }\n}\n\nvoid sigintHandler(int sig_num)\n{\n    signal(SIGINT, sigintHandler);\n    printf(\"\\n\");\n    loop();\n}\n\nint main(int argc, char const *argv[]) {\n\n  signal(SIGINT, sigintHandler);\n  loop();\n  return 0;\n}\n</code></pre>\n\n<p>Output for code 2:</p>\n\n<p><a href=\"https://i.stack.imgur.com/ltyvA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ltyvA.png\" alt=\"enter image description here\"></a></p>\n\n<p>As can be seen that when I clicked first-time Ctrl+C (on input line 3), it works properly and I can continue. But when I click Ctrl+C second time I don't go to a new line and I have to press enter for a program to execute.</p>\n\n<p>I went through <a href=\"https://stackoverflow.com/questions/5269942/control-c-and-signal-handling-in-c\">this</a> question but it doesn't seem to apply for my case. This is my first time using signals and system calls so my question may come as silly. But it will be a great help if someone can help me to get to a proper way of implementing signals. Thank you.</p>\n"}, {"tags": ["c", "simulator"], "comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565708898, "post_id": 57480417, "comment_id": 101432834, "body": "Any reason why you can&#39;t add all files to your favourite IDE and have it handle the compilation and linking?"}, {"owner": {"reputation": 33, "user_id": 7810276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16fd0e06610c6d5e2afb241044e960e8?s=128&d=identicon&r=PG&f=1", "display_name": "Karthik Ganesan", "link": "https://stackoverflow.com/users/7810276/karthik-ganesan"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565895695, "post_id": 57480417, "comment_id": 101497719, "body": "@LundinI was just trying to get it to work &#39;as is&#39; without having to move files and essentially create my own project. But if nothing else works, I might have to do that!Thanks"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565938702, "post_id": 57480417, "comment_id": 101507462, "body": "It&#39;s the least painful way. Single command line or make files is a thing of the past, better to focus on actual programming."}], "owner": {"reputation": 33, "user_id": 7810276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16fd0e06610c6d5e2afb241044e960e8?s=128&d=identicon&r=PG&f=1", "display_name": "Karthik Ganesan", "link": "https://stackoverflow.com/users/7810276/karthik-ganesan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565708351, "creation_date": 1565708176, "last_edit_date": 1565708351, "question_id": 57480417, "link": "https://stackoverflow.com/questions/57480417/linker-errors-when-compiling-disksim4-with-64-bit-extensions", "title": "Linker errors when compiling disksim4 with 64-bit extensions", "body": "<p>I'm trying to compile the Disksim4 simulator with dixtrac. I've followed the instructions from here: <a href=\"http://cighao.com/2016/03/23/disksim-with-ssdmodel-source-analysis-013-use-it-on-64bit/\" rel=\"nofollow noreferrer\">http://cighao.com/2016/03/23/disksim-with-ssdmodel-source-analysis-013-use-it-on-64bit/</a> to install the SSD patch along with the 2 patches recommended on that page. </p>\n\n<p>All the required files compile (however with many warnings about implicit function declarations). However, it fails at the following command: </p>\n\n<pre><code>gcc -Wall -Wno-unused -MD -I. -I../diskmodel/include -I../libparam/include -I../libddbg/include -g -DASSERTS   -I../memsmodel/include -I../ssdmodel/include -D_INLINE  -o disksim disksim_main.o -L. -ldisksim -L../diskmodel/lib -ldiskmodel -L../memsmodel/lib -lmemsmodel -L../ssdmodel/lib -lssdmodel -L../libparam/lib -lparam -L../libddbg/lib -lddbg -lm\n</code></pre>\n\n<p>For example, </p>\n\n<pre><code>./libdisksim.a(disksim.o): In function `addlisttoextraq': /home/karthik/school/disksim-4.0/src/disksim.c:235: undefined reference to `addtoextraq'\n</code></pre>\n\n<p>All the errors are similar to the one above. Not sure how to proceed to fix this. If anyone is familiar with this and has any suggestions, I would greatly appreciate it! thank you! </p>\n"}, {"tags": ["c++", "c", "ssl", "httpserver", "client-certificates"], "comments": [{"owner": {"reputation": 31408, "user_id": 243245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aed5c13647d581ae231f019a886e05a8?s=128&d=identicon&r=PG", "display_name": "Rup", "link": "https://stackoverflow.com/users/243245/rup"}, "edited": false, "score": 0, "creation_date": 1565707575, "post_id": 57480082, "comment_id": 101432022, "body": "Do you mean why do you have to provide MHD_start_daemon the CA if you&#39;re then going to validate the certificate yourself? I think it&#39;s part of the handshake: the server says &#39;I only accept client certs signed by this CA&#39;, so it needs the certificate even if it doesn&#39;t then do the verification itself. But I suspect it does do the verification at the moment, it just allows empty certificates as not authenticated and you probably just need to check for and reject that case (if there isn&#39;t a MHD flag you can set to get it to do that for you)."}, {"owner": {"reputation": 13, "user_id": 10076200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/467361a94483e5e8ff28c029ae471e67?s=128&d=identicon&r=PG&f=1", "display_name": "typ", "link": "https://stackoverflow.com/users/10076200/typ"}, "reply_to_user": {"reputation": 31408, "user_id": 243245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aed5c13647d581ae231f019a886e05a8?s=128&d=identicon&r=PG", "display_name": "Rup", "link": "https://stackoverflow.com/users/243245/rup"}, "edited": false, "score": 0, "creation_date": 1565708706, "post_id": 57480082, "comment_id": 101432719, "body": "Thank you @Rup - I guess I probably just need to check indeed. Just wanted to be sure this is correct - i.e. I couldn&#39;t find a suitable flag"}], "owner": {"reputation": 13, "user_id": 10076200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/467361a94483e5e8ff28c029ae471e67?s=128&d=identicon&r=PG&f=1", "display_name": "typ", "link": "https://stackoverflow.com/users/10076200/typ"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 165, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1565707116, "creation_date": 1565707116, "question_id": 57480082, "link": "https://stackoverflow.com/questions/57480082/gnu-libmicrohttpd-with-client-tls-allows-empty-certificate", "title": "GNU libmicrohttpd with client TLS allows empty certificate", "body": "<p>I am using GNU libmicrohttpd to establish HTTPS server. My requirement is that the server and the client both authenticate during the TLS handshake however what I observe is that even if the client sends empty certificate the connection is accepted.</p>\n\n<p>in wireshark I see that the server requests certificate and the client sends certificate with len 0. How to make the microhttpd to not accept that case - the certificate must always be verified with the provided CA pem? </p>\n\n<pre><code>if(!(server_handle = MHD_start_daemon(flags, port, NULL, NULL, \n    &amp;mhttpd_layer::access_handler_callback, callback_data,\n                    // now, continue with the options\n                    MHD_OPTION_NOTIFY_COMPLETED, &amp;mhttpd_layer::request_completed_callback, l_callback_data,\n                    MHD_OPTION_SOCK_ADDR, (sockaddr*) &amp;(it-&gt;addr),\n                    MHD_OPTION_CONNECTION_TIMEOUT, it-&gt;conn_timeout,\n                    MHD_OPTION_CONNECTION_LIMIT, it-&gt;conn_limit,\n                    MHD_OPTION_PER_IP_CONNECTION_LIMIT, it-&gt;per_ip_conn_limit,\n                    // HTTPS certificate options\n                    MHD_OPTION_HTTPS_MEM_KEY, it-&gt;https_key_buff.data(),\n                    MHD_OPTION_HTTPS_MEM_CERT, it-&gt;https_cert_buff.data(),\n                    MHD_OPTION_HTTPS_MEM_TRUST, it-&gt;https_turst_ca_buff.data(),\n                    MHD_OPTION_END)))\n</code></pre>\n\n<p>Maybe I should manually on the access callback retrieve the certificate as described by their tutorial (<a href=\"https://www.gnu.org/software/libmicrohttpd/tutorial.html#Adding-a-layer-of-security\" rel=\"nofollow noreferrer\">https://www.gnu.org/software/libmicrohttpd/tutorial.html#Adding-a-layer-of-security</a>) ? In this case why do I provide the CA - this doesn't seem the proper way to me?</p>\n"}, {"tags": ["c", "macos", "tcp", "server", "client"], "comments": [{"owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "edited": false, "score": 0, "creation_date": 1565706992, "post_id": 57479952, "comment_id": 101431705, "body": "The third argument of <a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/functions/accept.html\" rel=\"nofollow noreferrer\">POSIX <code>accept()</code></a> must be a &quot;pointer to <code>socklen_t</code>&quot;. Your code is trying to pass a value of <code>size_t</code> type which is incompatible. Apparently the youtube guide you linked to has erroneous information"}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 11838162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f88f03da22bf63abf1a3ff0a2349a79?s=128&d=identicon&r=PG&f=1", "display_name": "fredy4", "link": "https://stackoverflow.com/users/11838162/fredy4"}, "edited": false, "score": 0, "creation_date": 1565711501, "post_id": 57480115, "comment_id": 101434166, "body": "Thanks for this :)"}], "tags": [], "owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "is_accepted": true, "score": 2, "last_activity_date": 1565708267, "last_edit_date": 1565708267, "creation_date": 1565707218, "answer_id": 57480115, "question_id": 57479952, "link": "https://stackoverflow.com/questions/57479952/language-c-tcp-server-and-client/57480115#57480115", "title": "language C, TCP Server and Client", "body": "<p>The prototype of <code>accept</code> is like:</p>\n\n<pre><code>int accept(int socket, struct sockaddr *restrict address, socklen_t *restrict address_len);\n</code></pre>\n\n<p>(from the <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/accept.html\" rel=\"nofollow noreferrer\">Open Group Base Specification Issue 7</a>)</p>\n\n<p>The <code>address_len</code> argument is a pointer to a <code>socklen_t</code> object, not a numerical length.</p>\n\n<p>Instead, you should create a variable of type <code>socklen_t</code> to which you assign the size you're trying to pass:</p>\n\n<pre><code>socklen_t newAddrLength = sizeof(newAddr);\n</code></pre>\n\n<p>You can then pass a pointer to this variable in your call to <code>accept</code>:</p>\n\n<pre><code>newSocket = accept(sockfd, (struct sockaddr*)&amp;newAddr, &amp;newAddrLength);\n</code></pre>\n\n<hr>\n\n<p>I'm unsure what you are trying to do with <code>ntoa</code>. I believe the function that you'd want to use in its place is <code>ntohs</code>, which converts the network-order of the <code>sin_port</code> member to a host-order <code>uint16_t</code>:</p>\n\n<pre><code>ntohs(newAddr.sin_port))\n</code></pre>\n\n<p>You'll then want to either cast this to a standard integer type, or use the <code>PRIu16</code> format macro in <code>&lt;inttypes.h&gt;</code>:</p>\n\n<pre><code>#include &lt;inttypes.h&gt;\n</code></pre>\n\n<pre><code>printf(\"Connection accepted from %s:%\" PRIu16 \"\\n\", inet_ntoa(newAddr.sin_addr), ntohs(newAddr.sin_port));\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 11838162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f88f03da22bf63abf1a3ff0a2349a79?s=128&d=identicon&r=PG&f=1", "display_name": "fredy4", "link": "https://stackoverflow.com/users/11838162/fredy4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 57480115, "answer_count": 1, "score": 0, "last_activity_date": 1565708283, "creation_date": 1565706660, "last_edit_date": 1565708283, "question_id": 57479952, "link": "https://stackoverflow.com/questions/57479952/language-c-tcp-server-and-client", "title": "language C, TCP Server and Client", "body": "<p>I'm trying to create a tcpServer and tcpClient messages terminal. i run into a problem with some code i can't get to work</p>\n\n<p>I Follow aftr this guide here <a href=\"https://www.youtube.com/watch?v=BIJGSQEipEE\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=BIJGSQEipEE</a></p>\n\n<pre class=\"lang-c prettyprint-override\"><code>int newSocket = accept(sockfd, (struct sockaddr*)&amp;newAddr, sizeof(newAddr));\nprintf(\"Connection accepted from %s:%d\\n\", inet_ntoa(newAddr.sin_addr), ntoa(newAddr.sin_port));\n</code></pre>\n\n<p>my error code is:</p>\n\n<pre><code>tcpServer.c:50:64: warning: incompatible integer to pointer conversion passing 'unsigned long' to parameter of type 'socklen_t *' (aka 'unsigned int *') [-Wint-conversion]\n        newSocket = accept(sockfd, (struct sockaddr*)&amp;newAddr, sizeof(newAddr));\n                                                               ^~~~~~~~~~~~~~~\n/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.14.sdk/usr/include/sys/socket.h:686:73: note: passing argument to parameter here\nint     accept(int, struct sockaddr * __restrict, socklen_t * __restrict)\n                                                                        ^\ntcpServer.c:54:81: warning: implicit declaration of function 'ntoa' is invalid in C99 [-Wimplicit-function-declaration]\n        printf(\"Connection accepted from %s:%d\\n\", inet_ntoa(newAddr.sin_addr), ntoa(newAddr.sin_port));\n</code></pre>\n\n<p>Why does error 2 come arise?</p>\n\n<p>Thanks for helping me :)</p>\n"}, {"tags": ["c++", "c", "linux", "gcc", "zynq"], "comments": [{"owner": {"reputation": 2234, "user_id": 3052438, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/X9OWu.png?s=128&g=1", "display_name": "NO_NAME", "link": "https://stackoverflow.com/users/3052438/no-name"}, "edited": false, "score": 0, "creation_date": 1565706381, "post_id": 57479836, "comment_id": 101431381, "body": "You can. This is called cross-compilation. It is a very common method of compiling programs for different platforms."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 2, "creation_date": 1565706834, "post_id": 57479836, "comment_id": 101431632, "body": "The other question - do you really need a compiler on that system? Or cross-compiling the needed binaries on some dev machine will suffice?"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565712026, "post_id": 57479836, "comment_id": 101434453, "body": "You might be able to find a pre-built GCC for running on the target hardware, just as you presumably find the pre-built kernel and pre-built utilities for the target hardware.  However, you do need quite a lot of space to do that \u2014 and space may be at a premium."}], "answers": [{"comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1565710434, "post_id": 57480002, "comment_id": 101433620, "body": "The point being that you wouldn&#39;t usually use this technique to install the <i>compiler</i> on the target system, but to instead just keep the compiler on your main dev machine then install your final build result to the target. Cut out the middle man entirely."}, {"owner": {"reputation": 383, "user_id": 10636865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5572e7623749f7b49f9d4e1baad75aa7?s=128&d=identicon&r=PG&f=1", "display_name": "linuxUser123", "link": "https://stackoverflow.com/users/10636865/linuxuser123"}, "edited": false, "score": 0, "creation_date": 1565764273, "post_id": 57480002, "comment_id": 101448809, "body": "compiling compilers is common practice. Also, some Linux distributions ship compiler for their target system. It&#39;s not that unusual."}, {"owner": {"reputation": 559, "user_id": 3576334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/fjRbx.jpg?s=128&g=1", "display_name": "alireza sadeghpour", "link": "https://stackoverflow.com/users/3576334/alireza-sadeghpour"}, "edited": false, "score": 0, "creation_date": 1565773171, "post_id": 57480002, "comment_id": 101452813, "body": "how install &quot;arm-linux-gnueabihf-gcc&quot; on fedora?? sudo dnf install arm-linux-gnueabihf-gcc do not work."}, {"owner": {"reputation": 136, "user_id": 11512417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/747f40a4e55d654c08d78316db968d08?s=128&d=identicon&r=PG&f=1", "display_name": "kokopelli", "link": "https://stackoverflow.com/users/11512417/kokopelli"}, "edited": false, "score": 0, "creation_date": 1565789401, "post_id": 57480002, "comment_id": 101461190, "body": "I think it&#39;s the &quot;gcc-arm-linux-gnueabihf&quot; package, not the &quot;arm-linux-gnueabihf-gcc&quot;."}, {"owner": {"reputation": 559, "user_id": 3576334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/fjRbx.jpg?s=128&g=1", "display_name": "alireza sadeghpour", "link": "https://stackoverflow.com/users/3576334/alireza-sadeghpour"}, "edited": false, "score": 0, "creation_date": 1565856454, "post_id": 57480002, "comment_id": 101481253, "body": "How if i want compile an kernel module for target platform?"}, {"owner": {"reputation": 136, "user_id": 11512417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/747f40a4e55d654c08d78316db968d08?s=128&d=identicon&r=PG&f=1", "display_name": "kokopelli", "link": "https://stackoverflow.com/users/11512417/kokopelli"}, "edited": false, "score": 0, "creation_date": 1565874120, "post_id": 57480002, "comment_id": 101487865, "body": "For a kernel module, it&#39;s more tricky. You can still use cross compilation, but you need to give a link to the linux kernel folder in the compilation process, and the linux kernel must be of the same version as the one on your target device (if the kernel on your device is 4.17 and the one used to compile is 4.16, it won&#39;t work, and maybe even the configuration must be the same, but not sure about this last point). If you are using a makefile, the line to compile should be something like that:  make  ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- -C &lt;your_kernel_dir_path&gt; M=$(shell pwd)"}], "tags": [], "owner": {"reputation": 136, "user_id": 11512417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/747f40a4e55d654c08d78316db968d08?s=128&d=identicon&r=PG&f=1", "display_name": "kokopelli", "link": "https://stackoverflow.com/users/11512417/kokopelli"}, "is_accepted": true, "score": 3, "last_activity_date": 1565706868, "creation_date": 1565706868, "answer_id": 57480002, "question_id": 57479836, "link": "https://stackoverflow.com/questions/57479836/how-install-gcc-on-linux-without-compiler/57480002#57480002", "title": "How install gcc on Linux without compiler", "body": "<p>Yes, you can compile your code on your x86 device and then export it to your arm device. But for this, you need a special compiler. This process is called \"cross-compilation\", where you compile a code for a special target device on an other device.</p>\n\n<p>For arm devices, the one I used was the \"arm-linux-gnueabihf-gcc\" compiler.</p>\n\n<p>Once installed, you can use it just like your casual gcc compiler. For example, on linux, it would be something like this :</p>\n\n<p><code>$ arm-linux-gnueabihf-gcc -o your_program your_program.c</code></p>\n\n<p>You then export the compiled output to your device, and it should work.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 5829423, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OJEFAM_Zx7E/AAAAAAAAAAI/AAAAAAAAABw/i4YsqAwetuM/photo.jpg?sz=128", "display_name": "Zohaib Nauman", "link": "https://stackoverflow.com/users/5829423/zohaib-nauman"}, "is_accepted": false, "score": 0, "last_activity_date": 1565722999, "creation_date": 1565722999, "answer_id": 57483909, "question_id": 57479836, "link": "https://stackoverflow.com/questions/57479836/how-install-gcc-on-linux-without-compiler/57483909#57483909", "title": "How install gcc on Linux without compiler", "body": "<p>Cross-compiling may be the solution for you It allows you to compile executables for one architecture on a system of a different architecture.\nhere is link <a href=\"http://www.landley.net/writing/docs/cross-compiling.html\" rel=\"nofollow noreferrer\">http://www.landley.net/writing/docs/cross-compiling.html</a></p>\n"}], "owner": {"reputation": 559, "user_id": 3576334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/fjRbx.jpg?s=128&g=1", "display_name": "alireza sadeghpour", "link": "https://stackoverflow.com/users/3576334/alireza-sadeghpour"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 626, "favorite_count": 1, "accepted_answer_id": 57480002, "answer_count": 2, "score": 1, "last_activity_date": 1565722999, "creation_date": 1565706278, "last_edit_date": 1565711936, "question_id": 57479836, "link": "https://stackoverflow.com/questions/57479836/how-install-gcc-on-linux-without-compiler", "title": "How install gcc on Linux without compiler", "body": "<p>I have a very light Linux OS that does not have any compiler on it.  How can I install gcc or g++ on it? The target hardware is an armv7-a processor. Can I compile gcc on my x86 system and then install it on my armv7 Linux??</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1565705507, "post_id": 57479561, "comment_id": 101430778, "body": "Present your <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "edited": false, "score": 0, "creation_date": 1565705570, "post_id": 57479561, "comment_id": 101430829, "body": "@gsamaras Wrong duplicate (careful with that hammer!) I&#39;ve fixed it."}, {"owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1565705677, "post_id": 57479561, "comment_id": 101430889, "body": "Thanks for that @LightnessRacesInOrbit, I&#39;ll keep that in mind!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11922083"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1565783283, "post_id": 57479561, "comment_id": 101457822, "body": "Thanks @Lightness Races in Orbit. I&#39;m new to programming and stack overflow, and this was my first question, so I didn&#39;t know that much about it."}], "owner": {"user_type": "does_not_exist", "display_name": "user11922083"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 287, "favorite_count": 0, "closed_date": 1565705512, "answer_count": 0, "score": 0, "last_activity_date": 1565707858, "creation_date": 1565705359, "last_edit_date": 1565707858, "question_id": 57479561, "link": "https://stackoverflow.com/questions/57479561/if-lengths-of-three-sides-of-a-triangle-are-input-through-the-keyboards-write-a", "closed_reason": "Duplicate", "title": "If lengths of three sides of a triangle are input through the keyboards, write a program to find the area of the traingle", "body": "<p>I'm using gcc compiler in ubuntu and I've already tried to use sqrt function along with the header file, but I always get an error.</p>\n\n<pre><code>float a , b , c , s , area;\n\nprintf(\"\\nEnter three sides of the triangle : \");\nscanf(\"%f%f%f\", &amp;a, &amp;b, &amp;c);\n\ns = (a+b+c)/2;\narea = sqrt(s*(s-a)*(s-b)*(s-c));\n\nprintf(\"\\nArea : %f\", area);\n</code></pre>\n\n<p>This is the error I'm getting after compiling:</p>\n\n<pre><code>Area.c:(.text+0xaf): undefined reference to 'sqrt'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n"}, {"tags": ["c", "debugging", "valgrind"], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 11755286, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pBqCRUURAqY/AAAAAAAAAAI/AAAAAAAAATA/9n5KS1E1hao/photo.jpg?sz=128", "display_name": "Nacho Sanjose", "link": "https://stackoverflow.com/users/11755286/nacho-sanjose"}, "edited": false, "score": 0, "creation_date": 1565706859, "post_id": 57479633, "comment_id": 101431645, "body": "Thanks a lot for explaining it. It solved my problem and got to learn something."}], "tags": [], "owner": {"reputation": 136, "user_id": 11512417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/747f40a4e55d654c08d78316db968d08?s=128&d=identicon&r=PG&f=1", "display_name": "kokopelli", "link": "https://stackoverflow.com/users/11512417/kokopelli"}, "is_accepted": true, "score": 4, "last_activity_date": 1565707034, "last_edit_date": 1565707034, "creation_date": 1565705589, "answer_id": 57479633, "question_id": 57479536, "link": "https://stackoverflow.com/questions/57479536/valgrind-invalid-write-read-of-size-1-errors-memcpy/57479633#57479633", "title": "Valgrind \u201cinvalid write/read of size 1\u201d errors memcpy", "body": "<p>When you are doing this:</p>\n\n<p><code>char *y = malloc(sizeof(siz));</code></p>\n\n<p>sizeof(size) equals the number of byte of the variable siz, which is the number of byte of size_t. Is this really what you want, or do you just want to do:</p>\n\n<p><code>char *y = malloc(siz);</code></p>\n"}], "owner": {"reputation": 29, "user_id": 11755286, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pBqCRUURAqY/AAAAAAAAAAI/AAAAAAAAATA/9n5KS1E1hao/photo.jpg?sz=128", "display_name": "Nacho Sanjose", "link": "https://stackoverflow.com/users/11755286/nacho-sanjose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "closed_date": 1565809159, "accepted_answer_id": 57479633, "answer_count": 1, "score": 0, "last_activity_date": 1565707034, "creation_date": 1565705288, "question_id": 57479536, "link": "https://stackoverflow.com/questions/57479536/valgrind-invalid-write-read-of-size-1-errors-memcpy", "closed_reason": "Not suitable for this site", "title": "Valgrind \u201cinvalid write/read of size 1\u201d errors memcpy", "body": "<p>I know similar questions have been asked. However I still can't solve my problem. So I'd be really thankful if you could help me understand what I'm doing wrong. My program basically takes reads words from a File and puts them in a hashtable as key/value pairs. Then it compares words from another file to the ones in the HT and if found it gives the value back...</p>\n\n<pre><code>    char *str_dup(const char *s) {\n      if (s == NULL) { // Optional test, s should point to a string\n        return NULL;\n      }\n      size_t siz = strlen(s) + 1;\n      char *y = malloc(sizeof(siz));\n      if (y != NULL) {\n        memcpy(y, s, siz);\n      }\n      return y;\n    }\n\n    int ht_put(HashTable *hashtable, const char *key, const char \n    *value){\n    List *node;\n\n    if (hashtable == NULL) {\n            return 2;\n    }\n\n    node = malloc(sizeof(List));\n    if (node == NULL) {\n            return 2;\n    }\n    node-&gt;key = str_dup(key);\n    node-&gt;value = str_dup(value);\n\n    node_handler(hashtable, node);\n\n    return 0;\n    }\n\n    HashTable *dict;\n    dict = ht_create(numKeys);\n    if(dict == NULL){\n        return 2;\n    }\n\n    char *val;\n    int cnt = 0;\n    while(fgets(buffer,1000000000,wb)) {\n        // Eliminate UNIX/DOS line terminator\n        val=strrchr(buffer,'\\n');\n        if (val) *val=0;\n        val=strrchr(buffer,'\\r');\n        if (val) *val=0;\n\n        //Find first occurrence of the separator ':'\n        val=strchr(buffer,':');\n        if (val) {\n            // Truncates buffer string to first word\n            // and (++) points second word\n            *val++=0;\n        }\n\n        if (cnt&lt;1000000000) {\n            if (val!=NULL) {\n                    if(ht_get(dict,buffer) == NULL){\n                       ht_put(dict,buffer,val);\n                    }\n                    else {\n                            ht_free(dict);\n                            fclose(wb);\n                            free(buffer);\n                            fprintf(stderr,\"Zwei Zeilen beschreiben \n         dasselbe deutsche Wort.\\n\");\n                            exit(2);\n                            return 2;\n                    }\n            }\n            cnt++;\n        } \n    }\n    fclose(wb);\n    free(buffer);\n</code></pre>\n\n<p>And here is what valgrind shows:</p>\n\n<pre><code>    ==478519== Invalid write of size 2\n    ==478519==    at 0x4C325E3: memcpy@GLIBC_2.2.5 (in \n    /usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)\n    ==478519==    by 0x401701: strdup (loesung.c:62)\n    ==478519==    by 0x401701: ht_put (loesung.c:285)\n    ==478519==    by 0x400FA2: main (loesung.c:389)\n    ==478519==  Address 0x51fc958 is 0 bytes after a block of size \n    8 alloc'd\n    ==478519==    at 0x4C2E01F: malloc (in \n    /usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)\n    ==478519==    by 0x4016EA: strdup (loesung.c:60)\n    ==478519==    by 0x4016EA: ht_put (loesung.c:285)\n    ==478519==    by 0x400FA2: main (loesung.c:389)\n</code></pre>\n"}, {"tags": ["c", "cs50"], "comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1565705462, "post_id": 57479529, "comment_id": 101430745, "body": "Step your program in the debugger and see what happens..."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 4, "creation_date": 1565705815, "post_id": 57479529, "comment_id": 101430986, "body": "Does the assignment say you have to manipulate all your amounts as <code>float</code>?  Usually for this sort of problem it&#39;s infinitely easier to use an <code>int</code>, but representing cents -- that is, $1.00 is represented as <code>100</code>."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 5, "creation_date": 1565705850, "post_id": 57479529, "comment_id": 101431007, "body": "Also, see <a href=\"https://stackoverflow.com/questions/3730019/why-not-use-double-or-float-to-represent-currency\"><b>Why not use Double or Float to represent currency?</b></a>"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 3, "creation_date": 1565706165, "post_id": 57479529, "comment_id": 101431244, "body": "For your special values: <code>0.5</code> and <code>0.25</code> are perfect powers of 2 and can be represented without rounding. On the other hand <code>0.1</code> is not."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1565706206, "post_id": 57479529, "comment_id": 101431270, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/588004/is-floating-point-math-broken\">Is floating point math broken?</a>"}, {"owner": {"reputation": 1080, "user_id": 11890657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e128d9b341fa1abad09bab0576aacd7f?s=128&d=identicon&r=PG&f=1", "display_name": "Chelmy88", "link": "https://stackoverflow.com/users/11890657/chelmy88"}, "edited": false, "score": 1, "creation_date": 1565706332, "post_id": 57479529, "comment_id": 101431356, "body": "One problem in you algorithm is the use of round, you should use floor() instead, to round to the lower integer."}, {"owner": {"reputation": 13767, "user_id": 2413201, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rxfuw.jpg?s=128&g=1", "display_name": "Armali", "link": "https://stackoverflow.com/users/2413201/armali"}, "edited": false, "score": 0, "creation_date": 1565706620, "post_id": 57479529, "comment_id": 101431508, "body": "<code>printf(&quot;%.20f\\n&quot;, 0.10)</code> \u2192 <code>0.10000000000000000555</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1565797202, "post_id": 57479529, "comment_id": 101465580, "body": "literals, like: <code>0.009</code>, <code>0.00</code>, <code>0.25</code>, etc are <code>doubles</code>, not <code>floats</code>  To make them <code>floats</code>,  append a <code>f</code> to the end of the literal."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1565797372, "post_id": 57479529, "comment_id": 101465654, "body": "Please read the MAN page for <code>round()</code>  especially the paragraph:  <i>These functions round x to the nearest integer, but round halfway cases        away from zero (regardless  of  the  current  rounding  direction,  see        fenv(3)), instead of to the nearest even integer like rint(3).         For example, round(0.5) is 1.0, and round(-0.5) is -1.0.</i>  And since the posted code is working with <code>float</code> values, you should be using: <code>roundf()</code> rather than <code>round()</code>"}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1565977465, "post_id": 57479529, "comment_id": 101524051, "body": "@Manu: you can accept the answer by clicking on the grey checkmark below its score."}], "answers": [{"comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1566003012, "post_id": 57479874, "comment_id": 101530689, "body": "Can a modulo be used on a <code>float</code>?"}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1566040517, "post_id": 57479874, "comment_id": 101536277, "body": "@JL2210: OOPS! wrong variable. Thanks for catching that."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1566041239, "post_id": 57479874, "comment_id": 101536442, "body": "MAX_INT  being possibly ridiculously low I&#39;d use a long int"}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1566042610, "post_id": 57479874, "comment_id": 101536692, "body": "@AnttiHaapala: you are correct, although interactive 16-bit systems are quite rare these days. I bought an old Sirius S1 last year and have not been able to boot MS/DOS to run my old Lattice C compiler on floppy disks... But emulators and virtual machines can be used to remember the old days :) answer updated."}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": false, "score": 6, "last_activity_date": 1566042310, "last_edit_date": 1566042310, "creation_date": 1565706412, "answer_id": 57479874, "question_id": 57479529, "link": "https://stackoverflow.com/questions/57479529/i-don%c2%b4t-know-why-the-else-if-statement-doesn%c2%b4t-happen/57479874#57479874", "title": "I don&#180;t know why the else if statement doesn&#180;t happen", "body": "<p>The internal representation of floating point numbers C is almost always the binary formats specified in the <a href=\"https://en.wikipedia.org/wiki/IEEE_754\" rel=\"nofollow noreferrer\">IEEE 754 binary representations</a>, not a decimal form. As a consequence, some numbers with a simple representation in decimal notation such as <code>0.1</code> as not represented exactly in a <code>float</code> or even in a <code>double</code> variable. Multiplying this variable by <code>10</code> does not necessarily yield the value <code>1</code> exactly, but a very close floating point number different from <code>1</code>. Comparing floating point numbers should be done with extreme care, allowing for the small differences coming from the propagation of the rounding method. In particular, you should avoid using <code>float</code> or <code>double</code> for currency values where the exact number of cents matters: use an integer holding the number of cents with a large enough size to handle the computed numbers. Regular 32-bit <code>int</code> would not suffice for numbers greater than 20 million USD expressed in cents.</p>\n\n<p>Here is a modified version using <code>long int</code> for at least 32-bit size:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;cs50.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n\nint main(void) {\n    float change = get_float(\"Change owed: \");        \n    long int cents = round(change * 100); // get an exact number of cents.\n    long int count = cents / 25;  // number of quarters\n    cents %= 25;\n    count += cents / 10;     // number of dimes\n    cents %= 10;\n    count += cents / 5;      // number of nickels\n    cents %= 5;\n    count += cents;          // number of pennies\n    printf(\"%ld coins\\n\", count);\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11922785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93a41d1f72136c5f6bc8398f1b5405a9?s=128&d=identicon&r=PG&f=1", "display_name": "Manu", "link": "https://stackoverflow.com/users/11922785/manu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566042310, "creation_date": 1565705247, "last_edit_date": 1566002909, "question_id": 57479529, "link": "https://stackoverflow.com/questions/57479529/i-don%c2%b4t-know-why-the-else-if-statement-doesn%c2%b4t-happen", "title": "I don&#180;t know why the else if statement doesn&#180;t happen", "body": "<p>When I input <code>0.50</code> or other floats that can be divided by <code>0.25</code> I don\u00b4t get any error but when I input <code>0.10</code> or other float that can\u00b4t be divided by <code>0.25</code> the <code>else</code> if statement that I have written does not happen. Can anyone tell me why? </p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;cs50.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n\nint main(void) {\n    float change;\n    do {\n        change = get_float(\"Change owed: \");        \n    } while (change &lt; 0.009);\n    int count = 0;\n    int div = 0;\n    while (change &gt; 0.00) {\n        if ((change / 0.25) &gt;= 1.00) {\n            div = round(change / 0.25);\n            count += div;\n            change = change - (div  *0.25);\n        } else\n        if ((change / 0.10) &gt;= 1.00) {\n            div = round(change / 0.10);\n            count += div;\n            change = change - (div * 0.10);\n        } else\n        if ((change / 0.05) &gt;= 1.00) {\n            div = round(change / 0.05);\n            count += div;\n            change = change - (div * 0.05);\n        } else {\n            div = round(change / 0.01);\n            count += div;\n            change = change - (div * 0.01);\n        }\n    }\n    printf(\"%i\\n\", count);\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565701846, "post_id": 57478368, "comment_id": 101428550, "body": "Is the macro used in any constant expression contexts? You know that <code>__attribute__((deprecated))</code> works only with gcc (and similar) compilers."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1565702113, "post_id": 57478368, "comment_id": 101428702, "body": "Related, if a bit old:  <a href=\"https://stackoverflow.com/questions/2681259/how-to-deprecate-a-macro-in-gcc\" title=\"how to deprecate a macro in gcc\">stackoverflow.com/questions/2681259/&hellip;</a>  I&#39;m of the opinion that it&#39;s not really a duplicate as that asks for GCC-specific answers.  This question asks for more general answers.  Given the elapsed time, there&#39;s a distinct chance for newer, better answers here."}, {"owner": {"reputation": 41, "user_id": 11183600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3528f4bc0fb72f35cb870b649ef3036?s=128&d=identicon&r=PG&f=1", "display_name": "Haim", "link": "https://stackoverflow.com/users/11183600/haim"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565702851, "post_id": 57478368, "comment_id": 101429116, "body": "@KamilCuk, The macro is used in the code but not in other macros. I mean that there is no other macros that depend on this macro."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565706561, "post_id": 57478368, "comment_id": 101431479, "body": "I ask if the macro is used  like <code>struct A { char field : MACRO1; }</code> or <code>static char arr[MACRO1];</code>, as a constant expression."}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 1, "creation_date": 1565708098, "post_id": 57478368, "comment_id": 101432323, "body": "Very good question indeed."}, {"owner": {"reputation": 32100, "user_id": 1033581, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/e8891617e36b8d1254eb3ce1a5662da4?s=128&d=identicon&r=PG", "display_name": "C\u0153ur", "link": "https://stackoverflow.com/users/1033581/c%c5%93ur"}, "edited": false, "score": 0, "creation_date": 1595856258, "post_id": 57478368, "comment_id": 111610554, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/2681259/how-to-deprecate-a-macro-in-gcc\">How to deprecate a macro in GCC?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "edited": false, "score": 0, "creation_date": 1565705545, "post_id": 57479189, "comment_id": 101430808, "body": "You could add a <code>(void)dep;</code> to get rid of the unused value warning."}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "reply_to_user": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "edited": false, "score": 0, "creation_date": 1565705807, "post_id": 57479189, "comment_id": 101430981, "body": "@Kevin Done. Thanks."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 1, "creation_date": 1565706330, "post_id": 57479189, "comment_id": 101431355, "body": "<code>Some C++ compilers have problems with expanding do-while ininline functions</code> O, wow. Do you have any C++ compilers in mind? Any experience with that?"}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565706802, "post_id": 57479189, "comment_id": 101431607, "body": "@KamilCuk Nope. Seltzer tried to edit, but I edited at the same time. I have included the source for that statement."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565707433, "post_id": 57479189, "comment_id": 101431932, "body": "@KamilCuk: the site says <i>historically some C++ compilers have refused to inline-expand any function containing a loop.</i> in reference to the use of the <code>do { multiple statements } while(0)</code> trick to encapsulate multiple statements as a single statement. This remark is obsolete and irrelevant, anybody still using such compilers has more pressing problems to deal with and the rest of us should not care, especially for a question tagged as <b>c</b>."}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "reply_to_user": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1565707484, "post_id": 57479189, "comment_id": 101431967, "body": "@chqrlie So you think I should delete it?"}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1565707684, "post_id": 57479189, "comment_id": 101432085, "body": "@klutt: yes, I think so. It is unrelated to the OP&#39;s question."}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1565709300, "post_id": 57479189, "comment_id": 101433030, "body": "Parens are not necessary when the expansion is a single token (but good advice for other macro definitions, I&#39;m sure)."}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 0, "creation_date": 1565721315, "post_id": 57479189, "comment_id": 101438363, "body": "This solution is nice, but doesn&#39;t work if you need the macro value to be valid for use in preprocessor expressions (changing <code>(void)dep</code> to <code>(void)+dep</code> would at least make it valid, but would not give a warning in that context) and doesn&#39;t make it an integer constant expression you can use in contexts that require one."}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "reply_to_user": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1565770565, "post_id": 57479189, "comment_id": 101451543, "body": "@TobySpeight That&#39;s true, but they never do any harm so it&#39;s good practice to always use them."}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "reply_to_user": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 0, "creation_date": 1565770826, "post_id": 57479189, "comment_id": 101451691, "body": "@R.. I tried <code>#define Y (X+X)</code> and then I printed <code>2*Y</code> and it gave the desired result."}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 0, "creation_date": 1565789868, "post_id": 57479189, "comment_id": 101461459, "body": "@klutt: <code>#if X == 1</code>"}], "tags": [], "owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "is_accepted": false, "score": 4, "last_activity_date": 1565775085, "last_edit_date": 1565775085, "creation_date": 1565704132, "answer_id": 57479189, "question_id": 57478368, "link": "https://stackoverflow.com/questions/57478368/what-is-the-best-way-to-mark-macro-as-deprecated/57479189#57479189", "title": "What is the best way to mark macro as deprecated?", "body": "<h1>GCC (and possibly others)</h1>\n\n<h2><code>__attribute__((deprecated))</code></h2>\n\n<p>For your particular example with just a constant expression, you can use this:</p>\n\n<p>Change</p>\n\n<pre><code>#define X (4)\n</code></pre>\n\n<p>to</p>\n\n<pre><code>#define X_old (4)\n</code></pre>\n\n<p>and then add</p>\n\n<pre><code>const int dep __attribute__((deprecated)) = 0;\n#define X ((void)dep, X_old)\n</code></pre>\n\n<p>Addition also works:</p>\n\n<pre><code>#define X (X_old + dep)\n</code></pre>\n\n<p>For a procedure macro you can do this:</p>\n\n<pre><code>#define P_old do { ... } while(0)\n#define P do { (void)dep; P_old; } while(0)\n</code></pre>\n\n<p>The only function of <code>(void)</code> is to suppress warnings. Thanks Kevin.</p>\n\n<h2><code>#pragma message</code></h2>\n\n<p>Another solution is to put all deprecated macros in a separate header file and use <code>pragma</code>. You could combine this with <code>#ifdef</code> and such:</p>\n\n<pre><code>#pragma message (\"This header contains deprecated macros\")\n</code></pre>\n\n<h1>All compilers</h1>\n\n<h2>Unreferenced label</h2>\n\n<p>Use an unreferenced label:</p>\n\n<pre><code>#define P_old do { ... } while(0)\n#define P do { P_IS_DEPRECATED: P_old; } while(0)\n</code></pre>\n\n<p>This does not work for constant expression macros and requires you to compile with <code>-Wall</code> to get a warning. Will trigger error if used more than once.</p>\n\n<h2>Unused variable:</h2>\n\n<pre><code>#define P_old do { ... } while(0)\n#define P do { int P_IS_DEPRECATED; P_old; } while(0)\n</code></pre>\n\n<p>Does not work on constant expressions either. Also requires <code>-Wall</code> but can be used more than once.</p>\n\n<h1>Sidenote</h1>\n\n<p>Remember to encapsulate constant expression macros in parentheses. The macro <code>#define X 2+3</code> would make an expression like <code>2*X</code> to expand to <code>2*2+3</code> instead of <code>2*(2+3)</code>.</p>\n"}], "owner": {"reputation": 41, "user_id": 11183600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3528f4bc0fb72f35cb870b649ef3036?s=128&d=identicon&r=PG&f=1", "display_name": "Haim", "link": "https://stackoverflow.com/users/11183600/haim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1565775085, "creation_date": 1565701613, "last_edit_date": 1565701804, "question_id": 57478368, "link": "https://stackoverflow.com/questions/57478368/what-is-the-best-way-to-mark-macro-as-deprecated", "title": "What is the best way to mark macro as deprecated?", "body": "<p>I know how to mark enums/functions as deprecated by using\n<code>__attribute__ ((deprecated))</code>. But how can I mark constant macro\nas deprecated?</p>\n\n<pre><code>#define MACRO1 4 //This is deprecated macro\n</code></pre>\n"}, {"tags": ["c", "file", "file-io", "char", "printf"], "comments": [{"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 4, "creation_date": 1565701701, "post_id": 57478333, "comment_id": 101428482, "body": "You&#39;re discarding half the characters in the file, and will print the first EOF half the time."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1531591"}, "edited": false, "score": 0, "creation_date": 1565701706, "post_id": 57478333, "comment_id": 101428487, "body": "Not exactly random characters, more 1/2 characters of input file. Plus past the end char..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1531591"}, "edited": false, "score": 1, "creation_date": 1565701763, "post_id": 57478333, "comment_id": 101428507, "body": "You call fgetc twice in your loop, but only print one result."}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 11718633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a32138f498582d555a8b802a1a03b2e2?s=128&d=identicon&r=PG&f=1", "display_name": "thep1rate", "link": "https://stackoverflow.com/users/11718633/thep1rate"}, "edited": false, "score": 0, "creation_date": 1565702671, "post_id": 57478402, "comment_id": 101428996, "body": "Thank you, it worked. I&#39;m unsure why you would declare c as an int, it works as a char too since the return from fgetc is casted automatically into a char I believe. Also it says there are 3 lines, although there are only two."}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "reply_to_user": {"reputation": 45, "user_id": 11718633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a32138f498582d555a8b802a1a03b2e2?s=128&d=identicon&r=PG&f=1", "display_name": "thep1rate", "link": "https://stackoverflow.com/users/11718633/thep1rate"}, "edited": false, "score": 1, "creation_date": 1565702780, "post_id": 57478402, "comment_id": 101429071, "body": "@thep1rate In general the type char can behave as signed char or unsigned char. So in the case when the type char behaves as unsigned char when you will never get that c == EOF.:) Because there will be compared two values (c = ) 255 and (EOF = ) -1."}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "reply_to_user": {"reputation": 45, "user_id": 11718633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a32138f498582d555a8b802a1a03b2e2?s=128&d=identicon&r=PG&f=1", "display_name": "thep1rate", "link": "https://stackoverflow.com/users/11718633/thep1rate"}, "edited": false, "score": 0, "creation_date": 1565703305, "post_id": 57478402, "comment_id": 101429381, "body": "@thep1rate As for the second part of your question it might be that there is an &quot;empty&quot; line in your file."}], "tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": true, "score": 4, "last_activity_date": 1565702142, "last_edit_date": 1565702142, "creation_date": 1565701712, "answer_id": 57478402, "question_id": 57478333, "link": "https://stackoverflow.com/questions/57478333/fgetc-prints-wrong-characters-to-console/57478402#57478402", "title": "fgetc prints wrong characters to console", "body": "<p>For starters you are using  <code>fgetc</code> two times in the loop</p>\n\n<pre><code>  while(fgetc(fp)!=EOF){\n        ^^^^^^^^^ \n    c = fgetc(fp);\n        ^^^^^^^^^\n    //...  \n</code></pre>\n\n<p>Secondly the variable <code>c</code> must be declared as having the type <code>int</code>.</p>\n\n<p>The loop can look the following way</p>\n\n<pre><code>int c;\n\n//...\n\nwhile ( ( c = fgetc( fp ) ) != EOF )\n{\n    putchar( c );\n    if ( c == '\\n' ) ++i;\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 11718633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a32138f498582d555a8b802a1a03b2e2?s=128&d=identicon&r=PG&f=1", "display_name": "thep1rate", "link": "https://stackoverflow.com/users/11718633/thep1rate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 57478402, "answer_count": 1, "score": 1, "last_activity_date": 1565702142, "creation_date": 1565701468, "last_edit_date": 1565702112, "question_id": 57478333, "link": "https://stackoverflow.com/questions/57478333/fgetc-prints-wrong-characters-to-console", "title": "fgetc prints wrong characters to console", "body": "<p>My program is supposed to print the text contained in a text file, which is saved in the same directory as both the source code and the executable, and then print the number of lines.\nHowever, the output is some random characters.\nI am using ubuntu.</p>\n\n<p>Follow up question: which one has to be in the same directory as the file (if I don't specify the absolute path), the executable or the source code? \nThanks in advance.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(){\n  char c;\n  int i = 0;\n\n  FILE *fp = fopen(\"newfile\",\"r\"); \n  if(!fp) {\n    printf(\"Error opening\\n\");\n    return -1;\n  }\n\n  printf(\"Text of newfile: \\n\");\n  while(fgetc(fp)!=EOF){\n    c = fgetc(fp);\n    printf(\"%c\",c);\n\n    if(c == '\\n')\n      ++i;\n  }\n\n  fclose(fp);\n  fp = NULL;\n  printf(\"\\nThere are %d lines in the file\\n\",i+1);\n\n  return 0;\n}\n</code></pre>\n\n<p>The file cointains the text: </p>\n\n<pre><code>this is my file\nthis is line 2\n</code></pre>\n\n<p>output: </p>\n\n<pre><code>Text of newfile: \nhsi yfl\nhsi ie2\ufffd\nThere are 2 lines in the file\n</code></pre>\n"}, {"tags": ["c", "termcap"], "comments": [{"owner": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "edited": false, "score": 0, "creation_date": 1565727309, "post_id": 57478317, "comment_id": 101440667, "body": "The sample program is incomplete, but the fragment shown appears to call unsafe functions from the signal handler (making the result unreliable)."}, {"owner": {"reputation": 81, "user_id": 11919189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f5851aaa868ae90cb4f3b1b2fa587ee?s=128&d=identicon&r=PG&f=1", "display_name": "aihya", "link": "https://stackoverflow.com/users/11919189/aihya"}, "reply_to_user": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "edited": false, "score": 0, "creation_date": 1565727522, "post_id": 57478317, "comment_id": 101440739, "body": "@ThomasDickey It&#39;s ok it was just testing sample, the solution was already provided by the answer below. Thanks"}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 11919189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f5851aaa868ae90cb4f3b1b2fa587ee?s=128&d=identicon&r=PG&f=1", "display_name": "aihya", "link": "https://stackoverflow.com/users/11919189/aihya"}, "edited": false, "score": 0, "creation_date": 1565711127, "post_id": 57478713, "comment_id": 101433977, "body": "I was working on the code on my mac and never encountered such problem, the function tgetnum always sends updated size."}, {"owner": {"reputation": 81, "user_id": 11919189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f5851aaa868ae90cb4f3b1b2fa587ee?s=128&d=identicon&r=PG&f=1", "display_name": "aihya", "link": "https://stackoverflow.com/users/11919189/aihya"}, "edited": false, "score": 0, "creation_date": 1565712017, "post_id": 57478713, "comment_id": 101434447, "body": "Thanks for the help."}, {"owner": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "edited": false, "score": 0, "creation_date": 1565727043, "post_id": 57478713, "comment_id": 101440577, "body": "<code>tgetnum</code> on MacOS is done by ncurses, which doesn&#39;t do that :-)"}], "tags": [], "owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "is_accepted": false, "score": 1, "last_activity_date": 1565704076, "last_edit_date": 1565704076, "creation_date": 1565702654, "answer_id": 57478713, "question_id": 57478317, "link": "https://stackoverflow.com/questions/57478317/why-the-function-tgetnumco-does-not-update-every-time-i-resize-the-terminal/57478713#57478713", "title": "Why the function tgetnum(&quot;co&quot;) does not update every time I resize the terminal?", "body": "<p>Looking up <code>tgetnum</code> in Linux man pages, it says:</p>\n\n<blockquote>\n  <p>These routines are included as a conversion aid for programs that use the termcap library. Their parameters are the same and the routines are emulated using the terminfo database. Thus, they can only be used to query the capabilities of entries for which a terminfo entry has been compiled.</p>\n</blockquote>\n\n<p>Looking up <em>terminfo</em> in man, it says:</p>\n\n<blockquote>\n  <p>Terminfo is a data base describing terminals, used by screen-oriented programs...</p>\n</blockquote>\n\n<p>Because it is a database, there is no dynamic updating. It only gets the statically defined information from the database for your current terminal.\n<hr>\n<em>Update:</em></p>\n\n<p>Googling around I found <a href=\"http://man7.org/tlpi/code/online/dist/tty/demo_SIGWINCH.c.html\" rel=\"nofollow noreferrer\">http://man7.org/tlpi/code/online/dist/tty/demo_SIGWINCH.c.html</a> which sets a <code>SIGWINCH</code> handler and then uses <code>ioctl</code> to get the updated size, roughly:</p>\n\n<pre><code>struct winsize ws;\nioctl(STDIN_FILENO, TIOCGWINSZ, &amp;ws);\nprintf(\"Caught SIGWINCH, new window size: \"\n            \"%d rows * %d columns\\n\", ws.ws_row, ws.ws_col);\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 11919189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f5851aaa868ae90cb4f3b1b2fa587ee?s=128&d=identicon&r=PG&f=1", "display_name": "aihya", "link": "https://stackoverflow.com/users/11919189/aihya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1565704076, "creation_date": 1565701389, "question_id": 57478317, "link": "https://stackoverflow.com/questions/57478317/why-the-function-tgetnumco-does-not-update-every-time-i-resize-the-terminal", "title": "Why the function tgetnum(&quot;co&quot;) does not update every time I resize the terminal?", "body": "<p>I have a global variable called g_data that holds a pointer to a structure which contains, among many, two variables to hold the height and width of the terminal.\nThe function <em>signalhandler</em> below checks whether the terminal has been resized. In that case, the function update_data changes the values of those two variables to the current height and width of the terminal.</p>\n\n<blockquote>\n  <p>My problem is that the function tgetnum, whenever it's being called, it \n  doesn't seem to get the current terminal size (after the resizing).</p>\n</blockquote>\n\n<p>I'm using Ubuntu 18.04LTS</p>\n\n<pre><code>typedef struct  s_data\n{\n    t_lst   *lst;\n    t_ldim  ldim;\n    t_pos   pos;\n    int     height;\n    int     width;\n    int     max;\n    int     lstsize;\n}               t_data;\n\nint i = 0;\n\nvoid    signalhandler(int sig)\n{\n\n    if (sig == SIGWINCH)\n    {\n        update_data(g_data);\n        if (g_data == NULL)\n            exit(EXIT_FAILURE);\n        enable_cap(\"ti\");\n        print_args(g_data);\n        printf(\"%d - %d\\n\", i++, tgetnum(\"co\"));\n        signal(SIGWINCH, signalhandler);\n    }\n    else if (sig == SIGTSTP)\n    {\n        signal(SIGTSTP, SIG_DFL);\n        modify_main_caps(SET);\n        enable_cap(\"te\");\n        ioctl(0, TIOCSTI, \"\\032\");\n    }\n    else if (sig == SIGCONT)\n    {\n        signal(SIGTSTP, signalhandler);\n        modify_main_caps(UNSET);\n        update_data(g_data);\n        enable_cap(\"ti\");\n        print_args(g_data);\n    }\n}\n</code></pre>\n"}, {"tags": ["c++", "c", "overloading", "variadic-functions"], "comments": [{"owner": {"reputation": 46978, "user_id": 856199, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/CPtki.png?s=128&g=1", "display_name": "Nikos C.", "link": "https://stackoverflow.com/users/856199/nikos-c"}, "edited": false, "score": 7, "creation_date": 1565701229, "post_id": 57478145, "comment_id": 101428238, "body": "You cannot call overloaded C++ functions from C."}, {"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "reply_to_user": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 0, "creation_date": 1565701517, "post_id": 57478145, "comment_id": 101428387, "body": "@KonradRudolph I&#39;m probably mistaken, but I was assuming that there&#39;s some <code>struct LOGGER</code>, given its use in a <code>typedef</code> in the C part, which causes some ambiguity (to me) as to OP&#39;s intentions."}, {"owner": {"reputation": 46978, "user_id": 856199, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/CPtki.png?s=128&g=1", "display_name": "Nikos C.", "link": "https://stackoverflow.com/users/856199/nikos-c"}, "edited": false, "score": 1, "creation_date": 1565701536, "post_id": 57478145, "comment_id": 101428400, "body": "OK, never mind. I think I see now. You&#39;re trying to have a type-safe printf-like function in C like you can have in C++? That&#39;s not possible. Macros aren&#39;t gonna help you. You need to pass a format string, just like <code>printf()</code> has, to tell the function what types the arguments have."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1565701787, "post_id": 57478145, "comment_id": 101428519, "body": "Not a problem exactly, but <code>#ifdef __cplusplus</code> blocks in a C++ file is just clutter."}, {"owner": {"reputation": 50126, "user_id": 1717300, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/81b91f602ce8acea8cbeb29f62725627?s=128&d=identicon&r=PG", "display_name": "hyde", "link": "https://stackoverflow.com/users/1717300/hyde"}, "edited": false, "score": 0, "creation_date": 1565701860, "post_id": 57478145, "comment_id": 101428561, "body": "Are you planning to build that logger.cpp separately with C and C++ compilers, or why do you have that #ifdef __cplusplus there?"}, {"owner": {"reputation": 50126, "user_id": 1717300, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/81b91f602ce8acea8cbeb29f62725627?s=128&d=identicon&r=PG", "display_name": "hyde", "link": "https://stackoverflow.com/users/1717300/hyde"}, "edited": false, "score": 0, "creation_date": 1565701939, "post_id": 57478145, "comment_id": 101428615, "body": "Anyway, you want <code>extern &quot;C&quot;</code> functions in C++ (meaning code compiled with C++ compiler). From those you can call normal C++ functions (which are name-mangled for linker, and support overloading etc). You can&#39;t call normal C++ functions from C (meaning code compiled with C compiler) directly (at least not practically/sanely), you can only call <code>extern &quot;C&quot;</code> functions (and those don&#39;t support overloading, can&#39;t be methods etc limitations of C language)."}, {"owner": {"reputation": 8002, "user_id": 1143850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2927fac544c9960cd5433688fe4cae1d?s=128&d=identicon&r=PG", "display_name": "Serge", "link": "https://stackoverflow.com/users/1143850/serge"}, "edited": false, "score": 0, "creation_date": 1565702351, "post_id": 57478145, "comment_id": 101428834, "body": "Why cannot you use your LOG macro to call your function directly? Why do you need a wrapper?"}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 4162878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6f1855995fec550fc4ba57131317b20?s=128&d=identicon&r=PG&f=1", "display_name": "caiy", "link": "https://stackoverflow.com/users/4162878/caiy"}, "edited": false, "score": 0, "creation_date": 1565721455, "post_id": 57479090, "comment_id": 101438413, "body": "Thanks for the alternative suggestion. C function with slightly different names is the convention for C &quot;overloading&quot; and that&#39;s the first thing that came to my mind. The challenge I face here is that inside macro, I&#39;ll need to invoke functions with different names based on variables, which I couldn&#39;t think of an optimal way. Do you have suggestions? Thanks."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 161, "user_id": 4162878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6f1855995fec550fc4ba57131317b20?s=128&d=identicon&r=PG&f=1", "display_name": "caiy", "link": "https://stackoverflow.com/users/4162878/caiy"}, "edited": false, "score": 0, "creation_date": 1565722057, "post_id": 57479090, "comment_id": 101438674, "body": "@caly, if you provide functions with different names, then I don&#39;t see why you need a macro at all.  But if you want one, whether in that case or your original case, then my last paragraph suggests providing several for-purpose macros instead of one generic one that tries to figure out what to do from its argument list.  This is, of course, along the same lines as providing separate function names and using them directly."}, {"owner": {"reputation": 161, "user_id": 4162878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6f1855995fec550fc4ba57131317b20?s=128&d=identicon&r=PG&f=1", "display_name": "caiy", "link": "https://stackoverflow.com/users/4162878/caiy"}, "edited": false, "score": 0, "creation_date": 1567022113, "post_id": 57479090, "comment_id": 101842361, "body": "What do you mean by for-purpose macros? What I&#39;m trying right now is that I pass in parameter type as an enum to the macro and try to do an if-else on the type and call corresponding C functions with different names. Since the number of parameters is different, the compiler is complaining about too few arguments for some of the cases. Which part am I doing it wrong? Thanks."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 161, "user_id": 4162878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6f1855995fec550fc4ba57131317b20?s=128&d=identicon&r=PG&f=1", "display_name": "caiy", "link": "https://stackoverflow.com/users/4162878/caiy"}, "edited": false, "score": 0, "creation_date": 1567040065, "post_id": 57479090, "comment_id": 101846963, "body": "@caiy, what you&#39;re doing wrong is trying to do too much with a single macro. &quot;Multiple for-purpose macros&quot; would be a separate macro for each purpose -- that is, for each different argument pattern you want to support."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 1, "last_activity_date": 1565703798, "creation_date": 1565703798, "answer_id": 57479090, "question_id": 57478145, "link": "https://stackoverflow.com/questions/57478145/how-to-call-c-overloaded-function-from-c-macros/57479090#57479090", "title": "how to call C++ overloaded function from C macros", "body": "<blockquote>\n  <p>Since the number of arguments is unknown, I have a macro counting the\n  arguments and pass it along into va_list. But using this approach, I\n  do not know the type of arguments to flexibly pass any arguments to\n  C++ function.</p>\n</blockquote>\n\n<p>That's right, you don't know.  The C mechanism for variadic functions does not directly provide the called function any information about the number or types of the variable arguments.  The called function must use a combination of assumptions and information gleaned from its arguments to make that determination.  The <code>printf</code> function is the canonical example: it determines both the number of variable arguments and their types by analyzing the the provided format string (and havoc ensues if the arguments actually provided are mismatched with the format).</p>\n\n<p>Provided that you place a fixed, artificial upper limit on the number of variable arguments supported, you can indeed count them via a variadic macro, as demonstrated.  Very little type information is available to the preprocessor, however, and there is no applicable mechanism for applying what little such information there is to your purpose.</p>\n\n<p>The usual C alternative to function overloading is simply to write functions with different names.  If you have similar functions that differ primarily in parameter number and type, then you might give them related names that convey those types.  For example,</p>\n\n<pre><code>void log_data(LOG_HEADER_s *);\nvoid log_data_u16(LOG_HEADER_s* hdr, uint16_t);\nvoid log_data_u64(LOG_HEADER_s* hdr, uint64_t);\nvoid log_data_u32_u32(LOG_HEADER_s* hdr, uint32_t, uint32_t);\n</code></pre>\n\n<p>Alternatively, it might be more appropriate to give them names that convey the purpose of their particular signature.  I'm inclined to suspect that an approach along these lines would work better for you than trying to multiplex your several distinct logging functions through a single variadic interface.</p>\n\n<p>On the other hand, if you insist on providing a single variadic function interface, then you could put multiple for-purpose macros in front of it on the C side, each corresponding to one of the supported back-end signatures.  These would not need to be variadic (unless the corresponding specific function was).  This would be to your advantage because you would get at least argument-count validation from your compiler (for calls going through the macros), and they could provide whatever extra arguments are needed to convey the expected number and types of arguments to the variadic interface function.</p>\n"}], "owner": {"reputation": 161, "user_id": 4162878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6f1855995fec550fc4ba57131317b20?s=128&d=identicon&r=PG&f=1", "display_name": "caiy", "link": "https://stackoverflow.com/users/4162878/caiy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565703798, "creation_date": 1565700763, "question_id": 57478145, "link": "https://stackoverflow.com/questions/57478145/how-to-call-c-overloaded-function-from-c-macros", "title": "how to call C++ overloaded function from C macros", "body": "<p>I'm adding a macro used in C file which should take a variable number of arguments, which should be handled based on the type and the number of arguments differently. If it's pure C++, it's easily achieved by overloading the function, but how would I pass the variadic arguments from C macro into C++ with this mixture of C and C++?</p>\n\n<p>The C file is restricted to be compiled with gcc. In macro definition, I passed the variadic arguments into C wrapper function. Since the number of arguments is unknown, I have a macro counting the arguments and pass it along into va_list. But using this approach, I do not know the type of arguments to flexibly pass any arguments to C++ function. I'm including relevant code snippet reflecting the current structure of code, skipping the actual handling logic in cpp file and other irrelevant information.</p>\n\n<p>In use.c:</p>\n\n<pre><code>#include \"macro.h\"\nLOG(id, lvl, params);\n</code></pre>\n\n<p>In macro.h:</p>\n\n<pre><code>#define LOG(_MSG_ID_, _LOG_LVL_, ...) \\\n  log_data(&amp;hdr, ##__VA_ARGS__); \\\n</code></pre>\n\n<p>In logger.h:</p>\n\n<pre><code>#define GET_NARG(_1, _2, _3, _4, N, ...) N\n#define COUNT_VARARGS(...) GET_NARG(__VA_ARGS__, 4, 3, 2, 1)\n#define log_data(p_hdr, ...) \\\n  log_data_c(p_hdr, COUNT_VARARGS(__VA_ARGS__), ##__VA_ARGS__);\n\n#ifdef __cplusplus\nclass LOGGER\n{\n public:\n  void log_data(LOG_HEADER_s* hdr);\n  void log_data(LOG_HEADER_s* hdr, uint16_t val);\n  void log_data(LOG_HEADER_s* hdr, uint64_t val);\n  void log_data(LOG_HEADER_s* hdr, uint32_t val1, uint32_t val1);\n  // and other overloaded functions\n  static inline LOGGER&amp; getInstance() { return m_instance; }\n private:\n  static LOGGER m_instance;\n};\n#else\ntypedef struct LOGGER LOGGER;\n#endif\n\n#ifdef __cplusplus\nextern \"C\" {\n#endif\nextern void log_data_c(LOG_HEADER_s* hdr, int n, ...);\n#ifdef __cplusplus\n}\n#endif\n</code></pre>\n\n<p>In logger.cpp:</p>\n\n<pre><code>#include \"logger.h\"\n#include &lt;stdarg.h&gt;\n\nLOGGER LOGGER::m_instance = LOGGER();\n#define LOGGER_Instance LOGGER::getInstance()\n\n#ifdef __cplusplus\nextern \"C\" {\n#endif\nvoid log_cmn_data(LOG_HEADER_s* hdr, int n, ...)\n{\n  va_list args;\n  va_start(args, n);\n  LOGGER_Instance.log_data(va_arg(args, LOG_HEADER_s*));\n  va_end(args);\n}\n#ifdef __cplusplus\n}\n#endif\n</code></pre>\n\n<p>The ideal scenario would be just passing the variadic arguments in the macro into the invocation of C++ overloaded function. Any workarounds to achieve the result are welcome. I've been trying to get this working for a while but I haven't found a post dealing with the same scenario. Any help is appreciated.</p>\n"}, {"tags": ["c", "regex", "pcre"], "answers": [{"tags": [], "owner": {"reputation": 481661, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": false, "score": 2, "last_activity_date": 1565767546, "last_edit_date": 1565767546, "creation_date": 1565701379, "answer_id": 57478312, "question_id": 57477893, "link": "https://stackoverflow.com/questions/57477893/how-to-fix-pcre2-to-w-will-match-marks/57478312#57478312", "title": "How to fix pcre2 to \\w will match marks?", "body": "<p>A <a href=\"https://docs.microsoft.com/en-us/dotnet/standard/base-types/character-classes-in-regular-expressions#word-character-w\" rel=\"nofollow noreferrer\">.NET <code>\\w</code> construct</a> matches </p>\n\n<pre><b>Category    Description</b>\nLl          Letter, Lowercase\nLu          Letter, Uppercase\nLt          Letter, Titlecase\nLo          Letter, Other\nLm          Letter, Modifier\nMn          Mark, Nonspacing\nNd          Number, Decimal Digit\nPc          Punctuation, Connector. This category includes ten characters, the most commonly used of which is the LOWLINE character (_), u+005F.</pre>\n\n<p>Note the differences: .NET <code>\\w</code> does not match all numbers, only those from the <a href=\"https://www.fileformat.info/info/unicode/category/Nd/list.htm\" rel=\"nofollow noreferrer\"><code>Nd</code> category</a>, and as for the <code>M</code> category, it only matches <a href=\"https://www.fileformat.info/info/unicode/category/Mn/list.htm\" rel=\"nofollow noreferrer\"><code>Mn</code></a> subset.</p>\n\n<p>Make sure you match these Unicode categories within your code and <code>\\w</code> will behave as in .NET regex.</p>\n\n<p>Use </p>\n\n<pre><code>case PT_WORD:\n    if ((PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_Ll ||\n         PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_Lu ||\n         PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_Lt ||\n         PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_Lo ||\n         PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_Lm ||\n         PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_Mn ||\n         PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_Nd ||\n         PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_Lm ||\n         PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_Pc) == (Fop == OP_NOTPROP))\n      RRETURN(MATCH_NOMATCH);\nbreak;\n</code></pre>\n\n<p>Note you do not need to care about <code>fc == CHAR_UNDERSCORE</code> as it is part of <code>\\p{Pc}</code> and you can't use just <code>ucp_L</code> as it also includes <code>\\p{LC}</code>.</p>\n"}], "owner": {"reputation": 870, "user_id": 7206675, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/8UtP3.png?s=128&g=1", "display_name": "google dev", "link": "https://stackoverflow.com/users/7206675/google-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565767546, "creation_date": 1565699906, "last_edit_date": 1565700286, "question_id": 57477893, "link": "https://stackoverflow.com/questions/57477893/how-to-fix-pcre2-to-w-will-match-marks", "title": "How to fix pcre2 to \\w will match marks?", "body": "<p>I use Pcre2 lib that can be found <a href=\"https://www.pcre.org/\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>As you can see <a href=\"https://github.com/svn2github/pcre2/blob/ba0cbc98725a5cfa538da8b49b208a0b1f3e0bb2/src/pcre2_internal.h#L1246\" rel=\"nofollow noreferrer\">here</a> Pcre2 <code>\\w</code> matches only <code>L</code> and <code>N</code> categories and underscore and not matches <code>M</code> - marks (see <a href=\"https://regex101.com/r/5v8jZi/1\" rel=\"nofollow noreferrer\">here</a>). However .Net Regex matches marks (see <a href=\"http://regexstorm.net/tester?p=%5Cw&amp;i=s%CC%8Clug%CC%A7%20slug\" rel=\"nofollow noreferrer\">here</a>).</p>\n\n<p>I want to change the source code of PCRE2 to behave like .Net Regex, only I'm not sure I'm doing right.</p>\n\n<p>What I want to do is find in the code where <code>PT_WORD</code> is referenced, like <a href=\"https://github.com/svn2github/pcre2/blob/46d95c641785318f9cd9f0de93b97bef41341806/src/pcre2_match.c#L2407\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>case PT_WORD:\n    if ((PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_L ||\n         PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_N ||\n         fc == CHAR_UNDERSCORE) == (Fop == OP_NOTPROP))\n</code></pre>\n\n<p>And add another line like that:</p>\n\n<pre><code>case PT_WORD:\n    if ((PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_L ||\n         PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_N ||\n         PRIV(ucp_gentype)[prop-&gt;chartype] == ucp_M || // &lt;-- new line\n         fc == CHAR_UNDERSCORE) == (Fop == OP_NOTPROP))\n</code></pre>\n\n<p>Is it right to do so? Are there other things to consider? What else do I need to change elsewhere in the code?</p>\n"}, {"tags": ["c", "memory-management", "embedded"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 2, "creation_date": 1565699318, "post_id": 57477689, "comment_id": 101427252, "body": "With embedded code on a microcontroller it is better to allocate memory for a buffer that you will never free, statically. You know the buffer size, and there is no reason not to. Here the <code>struct</code> member would be an array, or  a pointer to a static array."}, {"owner": {"reputation": 69, "user_id": 11042379, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DntHDRnAr9w/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPgMaunEP3VIdG8_-I5GHjJ2VDiTQ/mo/photo.jpg?sz=128", "display_name": "C. K.", "link": "https://stackoverflow.com/users/11042379/c-k"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565699520, "post_id": 57477689, "comment_id": 101427372, "body": "@WeatherVane I was trying to implement this! The reason for my choice of dynamically allocating memory for the buffer, is that I will have to decide the buffer size in the main code, while the buffer is defined in the library files. So to achieve a &quot;user defined&quot; buffer size I needed to use dynamically allocated memory."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565699567, "post_id": 57477689, "comment_id": 101427388, "body": "The code has <code>#define BUFF_SIZE</code> so you can still allocate a buffer statically, and place its pointer in the <code>struct</code>. But this isn&#39;t your code, because <code>#define BUFF_SIZE</code> contains no value."}, {"owner": {"reputation": 69, "user_id": 11042379, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DntHDRnAr9w/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPgMaunEP3VIdG8_-I5GHjJ2VDiTQ/mo/photo.jpg?sz=128", "display_name": "C. K.", "link": "https://stackoverflow.com/users/11042379/c-k"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565699827, "post_id": 57477689, "comment_id": 101427523, "body": "@WeatherVane you are right, I updated the code for clarity."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 4, "creation_date": 1565699893, "post_id": 57477689, "comment_id": 101427557, "body": "@MariusGulbrandsen IMO it depends entirely on the &quot;OS&quot; used in your microcontroller."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 1, "creation_date": 1565699964, "post_id": 57477689, "comment_id": 101427601, "body": "It would be way easier if you would specify what is the &quot;embedded&quot; platform you are working on. This is dependend on your OS implementation (and sbrk, malloc and startup implementation) so I think this is too broad. If <code>sbrk</code> pointer is reset during module initialization, then it is. What if you OS chooses to store the memory in some non-volatile external memory that survives on/off (would be strange). Specify your standard library implementation. And anyway modern microcontrollers have POR, when power is inserted they start with everything zeroed."}, {"owner": {"reputation": 69, "user_id": 11042379, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DntHDRnAr9w/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPgMaunEP3VIdG8_-I5GHjJ2VDiTQ/mo/photo.jpg?sz=128", "display_name": "C. K.", "link": "https://stackoverflow.com/users/11042379/c-k"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565700570, "post_id": 57477689, "comment_id": 101427898, "body": "@WeatherVane This cleared up a lot actually. In <a href=\"https://stackoverflow.com/a/57437945/11042379\">this</a> answer to my previous question I was adviced to use dynamic allocating of memory, which worked. I tried now to do the exact same thing, but not using dynamic allocating for the *buff but just setting the size sent to it, and it worked! That actually seems to solve my problems then."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565700672, "post_id": 57477689, "comment_id": 101427948, "body": "Good: the previous question did not mention &quot;embedded.&quot;"}, {"owner": {"reputation": 69, "user_id": 11042379, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DntHDRnAr9w/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPgMaunEP3VIdG8_-I5GHjJ2VDiTQ/mo/photo.jpg?sz=128", "display_name": "C. K.", "link": "https://stackoverflow.com/users/11042379/c-k"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565700697, "post_id": 57477689, "comment_id": 101427959, "body": "@KamilCuk I&#39;m working with Nordic SDK for an ARM based Bluetooth module <a href=\"https://www.nordicsemi.com/Products/Low-power-short-range-wireless/nRF52840\" rel=\"nofollow noreferrer\">nRF52840</a>. It&#39;s all written in C with Nordic&#39;s stack. I&#39;m not sure what &quot;OS&quot; that is, but I guess it&#39;s the Nordic stack or the ARM &quot;OS&quot;?"}, {"owner": {"reputation": 69, "user_id": 11042379, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DntHDRnAr9w/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPgMaunEP3VIdG8_-I5GHjJ2VDiTQ/mo/photo.jpg?sz=128", "display_name": "C. K.", "link": "https://stackoverflow.com/users/11042379/c-k"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565700776, "post_id": 57477689, "comment_id": 101427994, "body": "@WeatherVane I guess it&#39;s hard to ask good questions. Thanks."}, {"owner": {"reputation": 147, "user_id": 6897611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50e0b65453516d1cdc4d82a3c3632d7e?s=128&d=identicon&r=PG&f=1", "display_name": "grml", "link": "https://stackoverflow.com/users/6897611/grml"}, "edited": false, "score": 2, "creation_date": 1565702147, "post_id": 57477689, "comment_id": 101428721, "body": "In embedded environments you don&#39;t want to use dynamic allocated memory for various reasons. The easiest solution would be to staticly define the buffer and size in your main application and pass a pointer to the buffer to your lib, that is working on it. The only thing you have to make sure, is not to access the buffer outside of your lib."}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 11042379, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DntHDRnAr9w/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPgMaunEP3VIdG8_-I5GHjJ2VDiTQ/mo/photo.jpg?sz=128", "display_name": "C. K.", "link": "https://stackoverflow.com/users/11042379/c-k"}, "edited": false, "score": 0, "creation_date": 1565700854, "post_id": 57477807, "comment_id": 101428028, "body": "Thank you for this. It makes things clearer. So I guess the OS will generally take care of this on the next startup for something like an embedded design. But of course, good practice to free the memory."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "reply_to_user": {"reputation": 69, "user_id": 11042379, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DntHDRnAr9w/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPgMaunEP3VIdG8_-I5GHjJ2VDiTQ/mo/photo.jpg?sz=128", "display_name": "C. K.", "link": "https://stackoverflow.com/users/11042379/c-k"}, "edited": false, "score": 1, "creation_date": 1565787901, "post_id": 57477807, "comment_id": 101460225, "body": "@MariusGulbrandsen Typically, applications in a microcontroller are not loaded and unloaded dynamically, and do not terminate - restarting typically means a power-on reset. Most often there is no OS. Where there is an OS with load/unload and memory management responsibility, then the situation is no longer specific to microcontrollers/embedded systems.  Memory allocation is not persistent over a power cycle/system restart."}], "tags": [], "owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "is_accepted": false, "score": 2, "last_activity_date": 1565699559, "creation_date": 1565699559, "answer_id": 57477807, "question_id": 57477689, "link": "https://stackoverflow.com/questions/57477689/what-happens-if-you-dont-free-allocated-memory-in-a-microcontroller/57477807#57477807", "title": "What happens if you don&#39;t free allocated memory in a microcontroller?", "body": "<blockquote>\n  <p>If I allocate this memory to the buffer, never free it, and I turn off and on my microcontroller, will it allocate the memory twice so that over time it builds up and crashes?</p>\n</blockquote>\n\n<p>No, When you end the program the memory is generally reclaimed by the OS.</p>\n\n<p>In your case, you have an embedded system and do not end the program. What will usually happen is that when you restart the system, the start up code will allocate the memory regions again and you will allocate the memory only once. There is no guarantee that the same address is allocated every time though.</p>\n\n<p>That being said, It is a good practice to <code>free</code> the memory when you are done with it. This is because as your programs become bigger and you write code that goes into other systems, it becomes important to <code>free</code> the memory at the end of your part of the program.</p>\n"}, {"comments": [{"owner": {"reputation": 147, "user_id": 6897611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50e0b65453516d1cdc4d82a3c3632d7e?s=128&d=identicon&r=PG&f=1", "display_name": "grml", "link": "https://stackoverflow.com/users/6897611/grml"}, "edited": false, "score": 0, "creation_date": 1565704522, "post_id": 57479161, "comment_id": 101430140, "body": "I basically agree with you, beside a small part. Using <code>malloc</code> on a microcontroller, will allocate memory in the heap section (that is in most cases a very small free-floating part of the memory). Not calling <code>free()</code> will let you run out of space there very fast. And relying on a restart (power cycle, watchdog, softreset) to take care of freeing memory is not good practice."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 147, "user_id": 6897611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50e0b65453516d1cdc4d82a3c3632d7e?s=128&d=identicon&r=PG&f=1", "display_name": "grml", "link": "https://stackoverflow.com/users/6897611/grml"}, "edited": false, "score": 0, "creation_date": 1565705976, "post_id": 57479161, "comment_id": 101431099, "body": "@grml The OP is not concerned about freeing memory during run-time but when the application is done. If the programmer is aimlessly calling malloc over and over on a MCU, then the programmer is the problem."}, {"owner": {"reputation": 69, "user_id": 11042379, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DntHDRnAr9w/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPgMaunEP3VIdG8_-I5GHjJ2VDiTQ/mo/photo.jpg?sz=128", "display_name": "C. K.", "link": "https://stackoverflow.com/users/11042379/c-k"}, "edited": false, "score": 0, "creation_date": 1565730515, "post_id": 57479161, "comment_id": 101441761, "body": "This makes my understanding of memory management and programming of embedded systems much clearer. Thanks. Regarding the GitHub project, it&#39;s actually mine. So as mentioned in a comment on my <a href=\"https://stackoverflow.com/q/57477689/11042379\">question</a> I found a way to statically allocate the memory after all and will thus update it:)"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 69, "user_id": 11042379, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DntHDRnAr9w/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPgMaunEP3VIdG8_-I5GHjJ2VDiTQ/mo/photo.jpg?sz=128", "display_name": "C. K.", "link": "https://stackoverflow.com/users/11042379/c-k"}, "edited": false, "score": 1, "creation_date": 1565772617, "post_id": 57479161, "comment_id": 101452545, "body": "@MariusGulbrandsen also, dynamic memory allocation needs to spend precious bytes for bookkeeping."}, {"owner": {"reputation": 479, "user_id": 8321975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d934a13d46469176a140ba9b04c929c?s=128&d=identicon&r=PG&f=1", "display_name": "kesselhaus", "link": "https://stackoverflow.com/users/8321975/kesselhaus"}, "reply_to_user": {"reputation": 69, "user_id": 11042379, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DntHDRnAr9w/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPgMaunEP3VIdG8_-I5GHjJ2VDiTQ/mo/photo.jpg?sz=128", "display_name": "C. K.", "link": "https://stackoverflow.com/users/11042379/c-k"}, "edited": false, "score": 0, "creation_date": 1565836417, "post_id": 57479161, "comment_id": 101477008, "body": "@MariusGulbrandsen loooking at that GitHub implementation of yours, you already have a memory leak, all the time you use ringbuffer_put(), once already after ringbuffer_init() and then always after ringbuffer_get() when the ringbuffer is empty."}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 3, "last_activity_date": 1565704024, "creation_date": 1565704024, "answer_id": 57479161, "question_id": 57477689, "link": "https://stackoverflow.com/questions/57477689/what-happens-if-you-dont-free-allocated-memory-in-a-microcontroller/57479161#57479161", "title": "What happens if you don&#39;t free allocated memory in a microcontroller?", "body": "<blockquote>\n  <p>What happens if I allocate memory to say a buffer, and then I will never allocate memory in my code again. Do I then need to free that memory?</p>\n</blockquote>\n\n<ul>\n<li><p>On a hosted (PC-like) systems, you need to free the memory when you are done using it. The OS will reclaim it, but you should free it still. Partially because it's good practice to clean up your own mess, partially because when doing so, all heap-related bugs in your program will surface early on. When you get a program crash upon calling <code>free()</code>, the actual bug is elsewhere in the program.</p></li>\n<li><p>On freestanding (microcontroller/RTOS) systems, you shouldn't use dynamic allocation in the first place, because <a href=\"https://electronics.stackexchange.com/a/171581/6102\">it doesn't make any sense</a>. If you for reasons unknown still insist on using it, you don't need to free() it because your program controls 100% of the available resources in the computer. </p></li>\n</ul>\n\n<blockquote>\n  <p>My application of the code is going to be for embedded design, so a microcontroller.</p>\n</blockquote>\n\n<p>You shouldn't use that Github project in embedded systems. You need to get rid of malloc and replace it with a statically allocated buffer, one per instance of the ring buffer. </p>\n"}, {"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565772841, "post_id": 57491140, "comment_id": 101452668, "body": "In either of these cases, you gain nothing but extra code bloat from calling malloc instead of just declaring the variable with static allocation. There should be no reason why you&#39;d want to needlessly slow down the program and consume extra program flash for storing malloc. You&#39;ll have to be able to justify the use of malloc, which simply isn&#39;t possible to do."}, {"owner": {"reputation": 2432, "user_id": 117160, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0vdCM.jpg?s=128&g=1", "display_name": "u\u0250\u026a", "link": "https://stackoverflow.com/users/117160/u%c9%90%c9%aa"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565778809, "post_id": 57491140, "comment_id": 101455675, "body": "Granted but some frameworks e.g. FreeRTOS use malloc to allocate the task stacks etc when the tasks are created.  If all of the tasks are started and then left running without any task desruction and re-creation then this will not be a problem."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565779221, "post_id": 57491140, "comment_id": 101455873, "body": "Since there exists no system with infinite RAM, there must always be a maximum limit of how many stacks you can allocate simultaneously. The whole of the program must still function up to that limit. Thus common sense dictates that the RTOS only needs to allocate as many stacks as is required for that worst case."}, {"owner": {"reputation": 2432, "user_id": 117160, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0vdCM.jpg?s=128&g=1", "display_name": "u\u0250\u026a", "link": "https://stackoverflow.com/users/117160/u%c9%90%c9%aa"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565779691, "post_id": 57491140, "comment_id": 101456109, "body": "That is why my answer says that all allocations are made at the start of the run so that the memory allocation becomes a static set of allocated areas on the heap.  If you do not have enough memory to allocate the task stacks it will fail at initialisation and you will not get failures due to memory allocation later in the program run."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565787222, "post_id": 57491140, "comment_id": 101459864, "body": "That is not the only argument for not using dynamic memory, and may not even apply - not all embedded systems are memory constrained. A less obvious issue is that the non-deterministic allocation time, and potential for failure makes it unsuited to meeting hard real-time deadlines. Unlike @Lundin, I would not say never, but you do need to understand the issues to determine if it is appropriate or safe, and when you do, will often choose to avoid. If you do not understand the issues, then prohibition is a good guideline."}], "tags": [], "owner": {"reputation": 2432, "user_id": 117160, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0vdCM.jpg?s=128&g=1", "display_name": "u\u0250\u026a", "link": "https://stackoverflow.com/users/117160/u%c9%90%c9%aa"}, "is_accepted": true, "score": 1, "last_activity_date": 1565772176, "creation_date": 1565772176, "answer_id": 57491140, "question_id": 57477689, "link": "https://stackoverflow.com/questions/57477689/what-happens-if-you-dont-free-allocated-memory-in-a-microcontroller/57491140#57491140", "title": "What happens if you don&#39;t free allocated memory in a microcontroller?", "body": "<p>The normal rule on an embedded microcontroller is to never use dynamic memory allocation because in the limited memory space available to a microcontroller you can, over time, get memory space fragmentation and end up in a situation where the memory manager cannot find a large enough free block of memory to complete the memory allocation.</p>\n\n<p>There are two cases that I can think of where allocating memory off the heap could be permitted</p>\n\n<ul>\n<li>When all allocations are done at startup and are never freed (your situation)</li>\n<li>When all allocations are made with the same block size.</li>\n</ul>\n\n<p>In the first case any failures in allocation will happen before the main code starts and there is no possibility of an allocation failure happening after a long time running as there are never any more allocation attempts.</p>\n\n<p>In the second case, assuming that the maximum number of allocations can be supported by the available memory, the memory cannot become fragmented as any new allocation will always fit into a block that has been freed.</p>\n\n<p>In your case you will not have to free the memory as your application continues to run for as long as there is power available.  When power is removed the memory will inevitably be freed. </p>\n"}, {"tags": [], "owner": {"reputation": 49, "user_id": 11927859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ihn39.jpg?s=128&g=1", "display_name": "toto-w", "link": "https://stackoverflow.com/users/11927859/toto-w"}, "is_accepted": false, "score": 0, "last_activity_date": 1565872265, "creation_date": 1565872265, "answer_id": 57509705, "question_id": 57477689, "link": "https://stackoverflow.com/questions/57477689/what-happens-if-you-dont-free-allocated-memory-in-a-microcontroller/57509705#57509705", "title": "What happens if you don&#39;t free allocated memory in a microcontroller?", "body": "<p>If you power off and reboot your controller any memory should be lost. The startup code should initialize the whole memory with 0 and the OS should be able to allocate the same memory for the buffers again.</p>\n\n<p>If it is in general a good idea to use malloc on an embedded system depends mainly on the used operating system. Most embedded OS' use definable numbers of different fixed sized mem blocks and allocate them depending on requested size as needed. They mostly supports some kind of statistics so you can watch the use of the blocks.</p>\n\n<p>Don't create large buffers as automatic variables in functions. They can blast the stack. Be aware that declaring static vars as buffer may consume FLASH/ROM memory too for the init section. (Static vars were initialized per default.)</p>\n"}], "owner": {"reputation": 69, "user_id": 11042379, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DntHDRnAr9w/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPgMaunEP3VIdG8_-I5GHjJ2VDiTQ/mo/photo.jpg?sz=128", "display_name": "C. K.", "link": "https://stackoverflow.com/users/11042379/c-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 1, "accepted_answer_id": 57491140, "answer_count": 4, "score": 0, "last_activity_date": 1565872265, "creation_date": 1565699056, "last_edit_date": 1565699924, "question_id": 57477689, "link": "https://stackoverflow.com/questions/57477689/what-happens-if-you-dont-free-allocated-memory-in-a-microcontroller", "title": "What happens if you don&#39;t free allocated memory in a microcontroller?", "body": "<p>I know that there are lots of questions on this topic but my question is specifically: What happens if I allocate memory to say a buffer, and then I will never allocate memory in my code again. Do I then need to free that memory?</p>\n\n<p>My application of the code is going to be for embedded design, so a microcontroller. The code would look something like this:</p>\n\n<pre><code>#include \"ringbuffer.h\"\n\nconst int BUFFER_SIZE = 5;       \n\n// create instance of ring buffer\nringbuffer buff1;\nringbuffer buff2;\n\nint main(void)\n{\n    // initialize ring buffer (this allocates memory to buffers)\n    ringbuffer_init(BUFFER_SIZE, &amp;buff1);\n    ringbuffer_init(BUFFER_SIZE, &amp;buff2);\n\n    while(true)\n   {\n       // receive data in buffer here\n       // do stuff with data\n       // run forever\n   }\n\n    // memory is never freed for the buffers\n    return 0;\n}\n</code></pre>\n\n<p>The allocate memory to the buffer happens inside the <code>ringbuffer_init()</code> function, and this function would be permitted to only run once in the start of main, before the loop. </p>\n\n<p>My question is really. If I allocate this memory to the buffer, never free it, and I turn off and on my microcontroller, will it allocate the memory twice so that over time it builds up and crashes?</p>\n\n<p>.c and .h files for the ringbuffer library on <a href=\"https://github.com/mariugul/Ring-buffer-C/tree/master/src\" rel=\"nofollow noreferrer\">GitHub</a>.</p>\n"}, {"tags": ["c", "linux", "sockets", "udp"], "comments": [{"owner": {"reputation": 1663, "user_id": 4626508, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/irrxZ.jpg?s=128&g=1", "display_name": "rbashish", "link": "https://stackoverflow.com/users/4626508/rbashish"}, "edited": false, "score": 1, "creation_date": 1565698819, "post_id": 57477537, "comment_id": 101426972, "body": "Hi there, Welcome to Stack Overflow! Please see <a href=\"https://stackoverflow.com/help/how-to-ask\">how to ask</a>. We request you to show your effort first, what you have done and tried so far. We can not answer direct question where there are no efforts. Hope you understand."}, {"owner": {"reputation": 101, "user_id": 9669015, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "OlliWerPXC", "link": "https://stackoverflow.com/users/9669015/olliwerpxc"}, "edited": false, "score": 0, "creation_date": 1565698976, "post_id": 57477537, "comment_id": 101427056, "body": "I guess this is what you want to do... <a href=\"https://stackoverflow.com/questions/16007311/multicasting-on-the-loopback-device\" title=\"multicasting on the loopback device\">stackoverflow.com/questions/16007311/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 5675428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7263e7bab8ee89e58ac91f0123f8625c?s=128&d=identicon&r=PG", "display_name": "user5675428", "link": "https://stackoverflow.com/users/5675428/user5675428"}, "edited": false, "score": 0, "creation_date": 1565702891, "post_id": 57477851, "comment_id": 101429141, "body": "I tried it and it seems to work without setting IP_ADD_MEMBERSHIP after binding to a address in each client."}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 1, "last_activity_date": 1565699723, "creation_date": 1565699723, "answer_id": 57477851, "question_id": 57477537, "link": "https://stackoverflow.com/questions/57477537/make-applications-discover-each-other-via-udp/57477851#57477851", "title": "Make Applications discover each other via UDP", "body": "<p>Each instance of your application should create a socket that is bound to the same port.  You'll need to set the <code>SO_REUSEADDR</code> on the socket before binding to allow this to happen.  </p>\n\n<p>As you've already found, when you have multiple UDP sockets bound to the same port and a unicast packet arrives only one of those sockets will receive the packet.  To get around that you'll have to use multicast.  If the sockets are all listening on a multicast address and a multicast packet it sent, all sockets will receive the packet.  This also has the advantage of working whether or not the processes are on the same host.</p>\n\n<p>After you set <code>SO_REUSEADDR</code> and bind the socket, you'll want to join a multicast group by setting the <code>IP_ADD_MEMBERSHIP</code> option.  You can use any valid multicast address for this in the 225.0.0.0 - 239.255.255.255 range (avoid 232.x.x.x as that is for source specific multicast) and all instances of the app should join the same group.</p>\n\n<p>You should also set the <code>IP_MULTICAST_IF</code> option to set the network interface for outgoing multicast packets, and if you want the app to receive multicast messages that it sent itself, you'll also want to set <code>IP_MULTICAST_LOOP</code>.</p>\n"}], "owner": {"reputation": 11, "user_id": 5675428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7263e7bab8ee89e58ac91f0123f8625c?s=128&d=identicon&r=PG", "display_name": "user5675428", "link": "https://stackoverflow.com/users/5675428/user5675428"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "closed_date": 1565759304, "accepted_answer_id": 57477851, "answer_count": 1, "score": -1, "last_activity_date": 1565699723, "creation_date": 1565698476, "last_edit_date": 1565699328, "question_id": 57477537, "link": "https://stackoverflow.com/questions/57477537/make-applications-discover-each-other-via-udp", "closed_reason": "Not suitable for this site", "title": "Make Applications discover each other via UDP", "body": "<p>I want to make a application in C on Linux where there are multiple processes running on one computer, which come from the same binary. It is not exactly defined how many of these processes there will be (2-20). I want them to find all the other running instances of the binary when they start up. The processes should communicate over UDP with Linux Sockets and when one application sends a packet every process should receive it. </p>\n\n<p>At the moment i have set up some basic udp message sending between two clients with fixed predefined ports. The goal ist to have them start up and get some port assigned from the os. The applications then should find other instances of the same binary and communicate with them. How can implement this sort of searching ? At first i tried to make them all listen to some fixed port via SO_REUSEADDR, but then just the last process to start up will receive all traffic. Then i looked into Multi and Broadcasting, but i think i need different ips for that to work. </p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["c", "assembly", "arm", "cortex-m", "objdump"], "comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1565699128, "post_id": 57477494, "comment_id": 101427139, "body": "Could be a bug.  What is the corresponding source code?  Another possibility is that the operand to this instruction is subject to relocation.  <code>objdump</code> evaluates relocations during disassembly and accounts for them in disassembly (but not in the dumped machine code).  This could explain the difference."}, {"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1565699209, "post_id": 57477494, "comment_id": 101427184, "body": "unfortunately I cannot provide a source code. Also, can a <code>b.n</code> which branch to a small offset within the same function is applicable for relocation?"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1565699298, "post_id": 57477494, "comment_id": 101427240, "body": "The output is correct, if <code>func</code> starts at 3c. Ok, indeed it is only half correct then (the second half). Where does func start?"}, {"owner": {"reputation": 4654, "user_id": 332733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BR7yE.jpg?s=128&g=1", "display_name": "Mgetz", "link": "https://stackoverflow.com/users/332733/mgetz"}, "edited": false, "score": 0, "creation_date": 1565699312, "post_id": 57477494, "comment_id": 101427250, "body": "@user2162550 unless the branch is instruction pointer relative it must be relocated"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1565699586, "post_id": 57477494, "comment_id": 101427395, "body": "Can you provide a larger disassembly context (i.e. from 0 to at least b4)?"}, {"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1565699684, "post_id": 57477494, "comment_id": 101427450, "body": "@Ctx working on that"}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1565699687, "post_id": 57477494, "comment_id": 101427452, "body": "@user2162550 Please show us the object&#39;s relocation table.  You can get it with <code>objdump -r foo.o</code>."}, {"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1565700677, "post_id": 57477494, "comment_id": 101427951, "body": "@fuz unfortunately I cannot attach that. Only relocations for <code>0x3c</code> address are in <code>.debug_frame</code>, <code>.debug_info</code> and <code>.debug_line</code> sections"}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1565701540, "post_id": 57477494, "comment_id": 101428402, "body": "@user2162550 I see.  Looks like a bug then."}], "answers": [{"comments": [{"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "edited": false, "score": 0, "creation_date": 1565701222, "post_id": 57478154, "comment_id": 101428237, "body": "still exist in <code>gcc-arm-none-eabi-8-2019-q3-update-linux</code>"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "edited": false, "score": 1, "creation_date": 1565706113, "post_id": 57478154, "comment_id": 101431200, "body": "@user2162550 I have provided some more details for this bug"}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 1, "creation_date": 1565725442, "post_id": 57478154, "comment_id": 101439990, "body": "bl is not a 32 bit instruction it is two separate 16 bit instructions executed separately.  If objdump is incorrectly interpreting them as that.   if the bl&#39;s surrounding the branch were branches forward objdump was producing the correct value if branching back then I saw similar behavior.  the branch instruction I believe is being generated correctly by gas."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1565728427, "post_id": 57478154, "comment_id": 101441041, "body": "@old_timer <code>f7ff fffe   bl  0</code>&lt;- one instruction, 32 bit. Where&#39;s the issue?"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1565730485, "post_id": 57478154, "comment_id": 101441754, "body": "@Ctx: old_timer is correct about Thumb <code>bl</code>; Thumb 1 needed a way to encode <code>bl</code> so they split it into two 16-bit instructions: one that sets some internal state (high part of the displacement), another that provides the low half and jumps.  Of course for a toolchain that handles variable-length instructions, it makes sense to treat it as one single 32-bit instruction.  Probably internally for Thumb2 CPUs as well, regardless of how it&#39;s still documented.  (e.g. <a href=\"https://ece.uwaterloo.ca/~ece222/ARM/ARM7-TDMI-manual-pt3.pdf\" rel=\"nofollow noreferrer\">ece.uwaterloo.ca/~ece222/ARM/ARM7-TDMI-manual-pt3.pdf</a> page 40: <i>5.19 Format 19: long branch with link</i>)"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1565730583, "post_id": 57478154, "comment_id": 101441785, "body": "@PeterCordes It is very common for assemblers to have a slightly higher level and translate &quot;complex&quot; operations into several instructions; and it is very common for disassemblers to reverse that process. So, semantically it is a 32-bit instruction for the assembler and disassembler. That&#39;s where the issue/bug comes into play. The lowlevel instructions don&#39;t play a role here."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1565730929, "post_id": 57478154, "comment_id": 101441896, "body": "Agreed, like I said it makes sense for a toolchain to treat it as one 32-bit instruction.  I&#39;m not sure I understand the point @old_timer is making based on the fact, but he&#39;s correct that <code>bl</code> can be considered as 2 separate instructions.  IDK if that has any impact on PC = 2 instructions ahead, it&#39;s been a while since I looked at ARM Thumb2 details."}], "tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": true, "score": 6, "last_activity_date": 1566072923, "last_edit_date": 1566072923, "creation_date": 1565700784, "answer_id": 57478154, "question_id": 57477494, "link": "https://stackoverflow.com/questions/57477494/objdump-produces-wrong-branch-opcode-interpretation/57478154#57478154", "title": "objdump produces wrong branch opcode interpretation", "body": "<p>Looks like a bug; each time the jump is between jumps, that are subject to relocation like here</p>\n\n<pre><code>38:   f7ff fffe   bl  0 &lt;log_func&gt;\n3c:   e03a        b.n 78 &lt;func+0x78&gt;   &lt;---- PROBLEM IS HERE\n3e:   f7ff fffe   bl  0 &lt;func&gt;\n</code></pre>\n\n<p>or here</p>\n\n<pre><code>6a:   f7ff fffe   bl  0 &lt;log_func&gt;\n6e:   e021        b.n 46 &lt;random_delay+0x46&gt;\n70:   f7ff fffe   bl  0 &lt;random_delay&gt;\n</code></pre>\n\n<p>the calculation is wrong.</p>\n\n<p>There is no legitimate reason for this; a report to the bugtracking system <a href=\"http://www.sourceware.org/bugzilla/\" rel=\"nofollow noreferrer\">http://www.sourceware.org/bugzilla/</a> is probably appropriate (after verifying, that the latest versions also suffer from this bug)</p>\n\n<p><strong>EDIT:</strong> I had some time to look deeper into this bug.</p>\n\n<p>The problem is, that if the instruction <em>before</em> the <code>b.n</code> is any 32-bit instruction and the instruction <em>after</em> the <code>b.n</code> is subject to relocation, objdump falsely assumes that the <code>b.n</code> instruction has a relocation associated with it and sets the relative pc to 0 for the offset calculation.</p>\n\n<p>This code part from <code>binutils/objdump.c</code> is the culprit:</p>\n\n<pre><code>              bfd_signed_vma distance_to_rel;\n\n              distance_to_rel = (**relppp)-&gt;address\n                - (rel_offset + addr_offset);\n\n              /* Check to see if the current reloc is associated with\n                 the instruction that we are about to disassemble.  */\n              if (distance_to_rel == 0\n                  /* FIXME: This is wrong.  We are trying to catch\n                     relocs that are addressed part way through the\n                     current instruction, as might happen with a packed\n                     VLIW instruction.  Unfortunately we do not know the\n                     length of the current instruction since we have not\n                     disassembled it yet.  Instead we take a guess based\n                     upon the length of the previous instruction.  The\n                     proper solution is to have a new target-specific\n                     disassembler function which just returns the length\n                     of an instruction at a given address without trying\n                     to display its disassembly. */\n                  || (distance_to_rel &gt; 0\n                      &amp;&amp; distance_to_rel &lt; (bfd_signed_vma) (previous_octets/ opb)))\n                {\n                  inf-&gt;flags |= INSN_HAS_RELOC;\n                  aux-&gt;reloc = **relppp;\n                }\n</code></pre>\n\n<p>The comment says it all: this parser guesses from the previous 32-bit instruction, that the next instruction is <em>also</em> 32-bit (which it isn't!). The relocation is targeted for <code>3e</code> and the disassembler assumes, that the next instruction is from <code>3c</code> to <code>3f</code>, so the <code>b.n</code> is flagged with <code>INSN_HAS_RELOC</code>, which in turn leads to the incorrect offset calculation. Looks, like this will not be easy to fix up.</p>\n\n<p>However, you could try and patch your objdump like this:</p>\n\n<pre><code>if (distance_to_rel == 0) {\n              inf-&gt;flags |= INSN_HAS_RELOC;\n              aux-&gt;reloc = **relppp;\n}\n</code></pre>\n\n<p>This might produce inaccuracies the other way round, but that should be rare cases and maybe that is better acceptable for you.</p>\n"}], "owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 57478154, "answer_count": 1, "score": 5, "last_activity_date": 1566072923, "creation_date": 1565698328, "last_edit_date": 1565700966, "question_id": 57477494, "link": "https://stackoverflow.com/questions/57477494/objdump-produces-wrong-branch-opcode-interpretation", "title": "objdump produces wrong branch opcode interpretation", "body": "<p>See the following <code>objdump</code> line of a specific object file of a specific function (<code>func</code>):</p>\n\n<pre><code>3c:   e03a            b.n     78 &lt;func+0x78&gt;\n</code></pre>\n\n<p>Now, the opcode <code>e03a</code> in the target system (ARMv6-M) says jump to the location of <code>PC + 0x78</code>. A correct interpretation will be:</p>\n\n<pre><code>3c:   e03a            b.n     B4 &lt;func+0xB4&gt;\n</code></pre>\n\n<p>Every other function and file contains proper <code>b.n</code> interpretations with proper values calculations in their <code>objdump</code> dump. For some reason, only this function causes <code>objdump</code> to be \"confused\".</p>\n\n<p>Note: <code>func</code>starts at <code>0x0</code>.</p>\n\n<p>I could not think of any reason for this situation. And since I have tools that parse and uses the <code>objdump</code> dump, this causes great problem for me.\nIs there any reasonable reason for that?</p>\n\n<p>toolchain: <code>gcc-arm-none-eabi-4_9-2015q3</code></p>\n\n<p>platform running this toolchain: <code>Ubuntu 16.04.2 LTS</code></p>\n\n<hr>\n\n<p><strong>EDIT:</strong> I'm attaching partial dump:</p>\n\n<pre><code>Disassembly of section i.func:\n\n00000000 &lt;func&gt;:\n   0:   b531        push    {r0, r4, r5, lr}\n   2:   b088        sub sp, #32\n   4:   2100        movs    r1, #0\n   6:   9106        str r1, [sp, #24]\n   8:   482c        ldr r0, [pc, #176]  ; (bc &lt;func+0xbc&gt;)\n   a:   6800        ldr r0, [r0, #0]\n   c:   6840        ldr r0, [r0, #4]\n   e:   9103        str r1, [sp, #12]\n  10:   1c40        adds    r0, r0, #1\n  12:   9002        str r0, [sp, #8]\n  14:   492a        ldr r1, [pc, #168]  ; (c0 &lt;func+0xc0&gt;)\n  16:   2000        movs    r0, #0\n  18:   9104        str r1, [sp, #16]\n  1a:   9005        str r0, [sp, #20]\n  1c:   a802        add r0, sp, #8\n  1e:   f7ff fffe   bl  0 &lt;random_func&gt;\n  22:   f7ff fffe   bl  0 &lt;random_func2&gt;\n  26:   4604        mov r4, r0\n  28:   4d26        ldr r5, [pc, #152]  ; (c4 &lt;func+0xc4&gt;)\n  2a:   42ac        cmp r4, r5\n  2c:   d007        beq.n   3e &lt;func+0x3e&gt;\n  2e:   a326        add r3, pc, #152    ; (adr r3, c8 &lt;func+0xc8&gt;)\n  30:   22ee        movs    r2, #238    ; 0xee\n  32:   492c        ldr r1, [pc, #176]  ; (e4 &lt;func+0xe4&gt;)\n  34:   2000        movs    r0, #0\n  36:   9400        str r4, [sp, #0]\n  38:   f7ff fffe   bl  0 &lt;log_func&gt;\n  3c:   e03a        b.n 78 &lt;func+0x78&gt;   &lt;---- PROBLEM IS HERE\n  3e:   f7ff fffe   bl  0 &lt;func&gt;\n  42:   9006        str r0, [sp, #24]\n  44:   f3bf 8f5f   dmb sy\n  48:   a808        add r0, sp, #32\n  4a:   7800        ldrb    r0, [r0, #0]\n  4c:   2800        cmp r0, #0\n  4e:   d00f        beq.n   70 &lt;func+0x70&gt;\n  50:   9806        ldr r0, [sp, #24]\n  52:   2803        cmp r0, #3\n  54:   d016        beq.n   84 &lt;func+0x84&gt;\n  56:   f7ff fffe   bl  0 &lt;some_hw_func&gt;\n  5a:   4604        mov r4, r0\n  5c:   42ac        cmp r4, r5\n  5e:   d01a        beq.n   96 &lt;func+0x96&gt;\n  60:   a321        add r3, pc, #132    ; (adr r3, e8 &lt;func+0xe8&gt;)\n  62:   22fa        movs    r2, #250    ; 0xfa\n  64:   491f        ldr r1, [pc, #124]  ; (e4 &lt;func+0xe4&gt;)\n  66:   2000        movs    r0, #0\n  68:   9400        str r4, [sp, #0]\n  6a:   f7ff fffe   bl  0 &lt;log_func&gt;\n  6e:   e021        b.n 46 &lt;random_delay+0x46&gt;  &lt;--- ALSO HERE SAME PROBLEM\n  70:   f7ff fffe   bl  0 &lt;random_delay&gt;\n  74:   2800        cmp r0, #0\n  76:   d003        beq.n   80 &lt;func+0x80&gt;\n  78:   a808        add r0, sp, #32\n  7a:   7800        ldrb    r0, [r0, #0]\n  7c:   2800        cmp r0, #0\n  7e:   d018        beq.n   b2 &lt;func+0xb2&gt;\n  80:   f7ff fffe   bl  0 &lt;some_hw_func2&gt;\n  84:   f7ff fffe   bl  0 &lt;random_delay&gt;\n  88:   2800        cmp r0, #0\n  8a:   d002        beq.n   92 &lt;func+0x92&gt;\n  8c:   9806        ldr r0, [sp, #24]\n  8e:   2803        cmp r0, #3\n  90:   d00f        beq.n   b2 &lt;func+0xb2&gt;\n  92:   f7ff fffe   bl  0 &lt;some_hw_func2&gt;\n  96:   f7ff fffe   bl  0 &lt;func&gt;\n  9a:   4604        mov r4, r0\n  9c:   42ac        cmp r4, r5\n  9e:   d008        beq.n   b2 &lt;func+0xb2&gt;\n  a0:   22ff        movs    r2, #255    ; 0xff\n  a2:   a318        add r3, pc, #96 ; (adr r3, 104 &lt;func+0x104&gt;)\n  a4:   3201        adds    r2, #1\n  a6:   490f        ldr r1, [pc, #60]   ; (e4 &lt;func+0xe4&gt;)\n  a8:   2000        movs    r0, #0\n  aa:   9400        str r4, [sp, #0]\n  ac:   f7ff fffe   bl  0 &lt;log_func&gt;\n  b0:   e000        b.n b4 &lt;func+0xb4&gt;\n  b2:   462c        mov r4, r5\n  b4:   4620        mov r0, r4\n</code></pre>\n"}, {"tags": ["c", "pointers", "recursion", "reverse", "c-strings"], "comments": [{"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 3, "creation_date": 1565698144, "post_id": 57477228, "comment_id": 101426649, "body": "It doesn&#39;t.   It simply prints the characters of the string in reverse order."}, {"owner": {"reputation": 2182, "user_id": 1689090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef8d951e67e4b0c03f5b4c021e22b93d?s=128&d=identicon&r=PG", "display_name": "Evil Dog Pie", "link": "https://stackoverflow.com/users/1689090/evil-dog-pie"}, "edited": false, "score": 1, "creation_date": 1565698322, "post_id": 57477228, "comment_id": 101426730, "body": "<a href=\"https://en.wikipedia.org/wiki/Recursion\" rel=\"nofollow noreferrer\">Recursion</a>."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 11709393, "user_type": "registered", "profile_image": "https://graph.facebook.com/2436609226389215/picture?type=large", "display_name": "Yunus Emre &#220;zmez", "link": "https://stackoverflow.com/users/11709393/yunus-emre-%c3%9czmez"}, "edited": false, "score": 0, "creation_date": 1565699550, "post_id": 57477301, "comment_id": 101427383, "body": "Thank you i mean how to print strings in reverse order but i wrote reverse strings i&#39;ll correct it."}], "tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 9, "last_activity_date": 1565698884, "last_edit_date": 1565698884, "creation_date": 1565697577, "answer_id": 57477301, "question_id": 57477228, "link": "https://stackoverflow.com/questions/57477228/how-does-this-function-print-strings-in-the-reverse-order/57477301#57477301", "title": "How does this function print strings in the reverse order?", "body": "<blockquote>\n  <p>I don't understand that how does this function reverse the strings</p>\n</blockquote>\n\n<p>The function does not reverse a string. Its parameter is declared with the qualifier <code>const</code>.</p>\n\n<pre><code>void reverse(const char * const sPtr);\n             ^^^^^\n</code></pre>\n\n<p>It outputs a string in the reverse order.</p>\n\n<p>Due to these statements</p>\n\n<pre><code>  reverse(&amp;sPtr[1]); \n  putchar(sPtr[0]);\n</code></pre>\n\n<p>the first character of the string is outputted last and the last character before the terminating zero is outputted first.</p>\n\n<p>The function can be written simpler as for example</p>\n\n<pre><code>void reverse( const char *s )\n{\n    if ( *s )\n    {\n        reverse( s + 1 ); \n        putchar( *s );\n    }\n}\n</code></pre>\n\n<p>Let's assume that <code>s</code> is a pointer to the first character of string literal <code>\"Hello\"</code>.</p>\n\n<p>Then as the character 'H' is not equal to 0 ( <code>if ( *s )</code> ) then the function call itself passing a pointer to to the second character that is to <code>'e'</code>.</p>\n\n<p>Again 'e' is not equal to 0 so the function call itself recursively. It will call itself until the expression in the if statement <code>if ( *s )</code> is evaluate to false that is then <code>*s</code> is equal to <code>'\\0'</code>. So the previous calls of the function outputs their corresponding characters</p>\n\n<pre><code>putchar( *s );\n</code></pre>\n\n<p>You can imagine this the following way</p>\n\n<pre><code>1 reverse( \"Hello\"[0] ); \n2 reverse( \"ello\"[0] ); \n3 reverse( \"llo\"[0] ); \n4 reverse( \"lo\"[0] ); \n5 reverse( \"o\"[0] ); \n6 reverse( \"\"[0] ); \n6 // do not call putchar \n5 putchar( 'o' );\n4 putchar( 'l' );\n3 putchar( 'l' );\n2 putchar( 'e' );\n1 putchar( 'H' );\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 11709393, "user_type": "registered", "profile_image": "https://graph.facebook.com/2436609226389215/picture?type=large", "display_name": "Yunus Emre &#220;zmez", "link": "https://stackoverflow.com/users/11709393/yunus-emre-%c3%9czmez"}, "edited": false, "score": 0, "creation_date": 1565700410, "post_id": 57477593, "comment_id": 101427817, "body": "Thanks for your answer but i am still  confused about this code.Could you explain more in detail how return statement and putchar()  works in this function ? Recursive step comes hard to me if there is return."}, {"owner": {"reputation": 14754, "user_id": 1827600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KHa84.png?s=128&g=1", "display_name": "suspectus", "link": "https://stackoverflow.com/users/1827600/suspectus"}, "reply_to_user": {"reputation": 73, "user_id": 11709393, "user_type": "registered", "profile_image": "https://graph.facebook.com/2436609226389215/picture?type=large", "display_name": "Yunus Emre &#220;zmez", "link": "https://stackoverflow.com/users/11709393/yunus-emre-%c3%9czmez"}, "edited": false, "score": 0, "creation_date": 1565701959, "post_id": 57477593, "comment_id": 101428627, "body": "I&#39;ve tried - it may help you to run through the logic of the program with a debugger. Recursion can be confusing at first."}], "tags": [], "owner": {"reputation": 14754, "user_id": 1827600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KHa84.png?s=128&g=1", "display_name": "suspectus", "link": "https://stackoverflow.com/users/1827600/suspectus"}, "is_accepted": false, "score": 3, "last_activity_date": 1565701778, "last_edit_date": 1565701778, "creation_date": 1565698701, "answer_id": 57477593, "question_id": 57477228, "link": "https://stackoverflow.com/questions/57477228/how-does-this-function-print-strings-in-the-reverse-order/57477593#57477593", "title": "How does this function print strings in the reverse order?", "body": "<p>The function <em>outputs</em> the string in reverse. It's a recursive function, this statement calls the function itself.</p>\n\n<pre><code> reverse(&amp;sPtr[1]);\n</code></pre>\n\n<p>Take a string \"abc\" as an example: </p>\n\n<p><code>reverse(\"abc\");</code> \nsPtr is not null, so <code>reverse(&amp;sPtr[1]);</code> is called with parameter <code>&amp;sPtr[1]</code> pointing to \"bc\". And so on.</p>\n\n<pre><code>reverse(\"abc\");\nreverse(\"bc\");\nreverse(\"c\");    \nreverse(\"\");  //Now sPtr is null, reverse() returns to `reverse(\"c\") frame:\n\n// just returned from reverse(\"c\") call so do \n// next statement following it \n// in reverse(\"bc\") frame.\nputchar(sPtr[0]); //  outputs \"c\" \n\n// reverse(\"c\") frame reaches function end \n// so returns back from reverse(\"bc\")\n// call and executes next statement \n// after reverse(\"bc\") \nputchar(sPtr[0]); //  outputs \"b\" \n\n// reverse(\"bc\") frame reaches function end \n// so returns back from reverse(\"abc\")\n// call and executes next statement \n// after reverse(\"abc\") \nputchar(sPtr[0]); //  outputs \"a\"\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 11709393, "user_type": "registered", "profile_image": "https://graph.facebook.com/2436609226389215/picture?type=large", "display_name": "Yunus Emre &#220;zmez", "link": "https://stackoverflow.com/users/11709393/yunus-emre-%c3%9czmez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1595446119, "creation_date": 1565697318, "last_edit_date": 1595446119, "question_id": 57477228, "link": "https://stackoverflow.com/questions/57477228/how-does-this-function-print-strings-in-the-reverse-order", "title": "How does this function print strings in the reverse order?", "body": "<p>I am learning about strings and characters in c programming.Today i saw a code that print strings in the reverse order but i don't understand how it works.Can you help me to understand it ? </p>\n\n<pre><code>  void reverse(const char * const sPtr)\n    {\n\n    if ('\\0' == sPtr[0]) {\n         return;\n    }\n\n    else { \n          reverse(&amp;sPtr[1]); \n          putchar(sPtr[0]);\n          }\n    }\n</code></pre>\n"}, {"tags": ["c++", "c", "compilation"], "comments": [{"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 3, "creation_date": 1565696322, "post_id": 57476950, "comment_id": 101425743, "body": "You say that the <code>triangle</code> code is still in source form. Did you compile it? If so, which <code>-l</code> argument is it supposed to in?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1565696726, "post_id": 57476950, "comment_id": 101425951, "body": "The <code>-l</code> option for the Unix/GNU-related linkers I am familiar with is for specifying a particular library file to use. <code>-lxyz</code> says to look for a file named <code>libxyz.a</code> or <code>libxyz.dylib</code> or possibly other suffixes for libraries, and <code>-lxyz.o</code> says to look for a file named <code>xyz.o</code>. <code>-l ~&#47;triangle</code> does not tell the linker to use all object or library files in the directory <code>~&#47;triangle&#47;</code>. There is another option with a capital L, <code>-Ldirectory</code>, that tells the linker to include <code>directory</code> in the places it looks when it is looking for a library. But again, it does not tell the linker to use all\u2026"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565696781, "post_id": 57476950, "comment_id": 101425975, "body": "\u2026 files in that directory. You still have to specify them individually. You can also list object and library files explicitly on the linker command line, without using <code>-l</code> or <code>-L</code>. For example, <code>~&#47;triangle&#47;*.o</code> might do what you need."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1565696801, "post_id": 57476950, "comment_id": 101425986, "body": "<code>-I</code> specifies a directory to look for headers in."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1565696812, "post_id": 57476950, "comment_id": 101425992, "body": "@EricPostpischil He&#39;s using <code>-I</code>, it just looked like <code>-l</code>."}, {"owner": {"reputation": 842, "user_id": 5440125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5368403fa6c1aa62270f86373269777f?s=128&d=identicon&r=PG&f=1", "display_name": "zengod", "link": "https://stackoverflow.com/users/5440125/zengod"}, "reply_to_user": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 0, "creation_date": 1565781592, "post_id": 57476950, "comment_id": 101457026, "body": "@MaxLanghof I have compiled it using make."}, {"owner": {"reputation": 842, "user_id": 5440125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5368403fa6c1aa62270f86373269777f?s=128&d=identicon&r=PG&f=1", "display_name": "zengod", "link": "https://stackoverflow.com/users/5440125/zengod"}, "reply_to_user": {"reputation": 70931, "user_id": 882003, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/de71acd9a8eab73186dea35aea7a68f2?s=128&d=identicon&r=PG", "display_name": "john", "link": "https://stackoverflow.com/users/882003/john"}, "edited": false, "score": 0, "creation_date": 1565781600, "post_id": 57476950, "comment_id": 101457031, "body": "@john triangle readme says that TRILIBRARY is set automatically with make."}, {"owner": {"reputation": 842, "user_id": 5440125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5368403fa6c1aa62270f86373269777f?s=128&d=identicon&r=PG&f=1", "display_name": "zengod", "link": "https://stackoverflow.com/users/5440125/zengod"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565781607, "post_id": 57476950, "comment_id": 101457037, "body": "@EricPostpischil doing the *.o trick gives the same error in addition to a warning that path/to/triangle.o is not a directory."}, {"owner": {"reputation": 842, "user_id": 5440125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5368403fa6c1aa62270f86373269777f?s=128&d=identicon&r=PG&f=1", "display_name": "zengod", "link": "https://stackoverflow.com/users/5440125/zengod"}, "edited": false, "score": 0, "creation_date": 1565781622, "post_id": 57476950, "comment_id": 101457046, "body": "I haven&#39;t used any -l flags for triangle in this command. All the -l flags in the command are for other things."}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 0, "creation_date": 1565781862, "post_id": 57476950, "comment_id": 101457174, "body": "You need to link with the triangle library (that you built with make), just like you linked with libjpeg and libpng."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565782679, "post_id": 57476950, "comment_id": 101457558, "body": "If you got a warning that <code>path&#47;to&#47;triangle.o</code> is not a directory, then you used it after a switch like <code>-L</code> or <code>-I</code> that expects a directory. To link an object file in with the program, just list it on the command line by itself, not after a switch that expects an argument to go with it."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565783100, "post_id": 57476950, "comment_id": 101457757, "body": "@zengod Don&#39;t use <code>-I ~&#47;triangle&#47;*.o</code> or <code>-l ~&#47;triangle&#47;*.o</code>, just use <code>~&#47;triangle&#47;*.o</code>."}], "answers": [{"comments": [{"owner": {"reputation": 842, "user_id": 5440125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5368403fa6c1aa62270f86373269777f?s=128&d=identicon&r=PG&f=1", "display_name": "zengod", "link": "https://stackoverflow.com/users/5440125/zengod"}, "edited": false, "score": 0, "creation_date": 1565781677, "post_id": 57477068, "comment_id": 101457072, "body": "How does one compile and link?"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 842, "user_id": 5440125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5368403fa6c1aa62270f86373269777f?s=128&d=identicon&r=PG&f=1", "display_name": "zengod", "link": "https://stackoverflow.com/users/5440125/zengod"}, "edited": false, "score": 0, "creation_date": 1565783024, "post_id": 57477068, "comment_id": 101457712, "body": "@zengod How do you think one compiles and links? Use your compiler!"}], "tags": [], "owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "is_accepted": false, "score": 2, "last_activity_date": 1565696709, "creation_date": 1565696709, "answer_id": 57477068, "question_id": 57476950, "link": "https://stackoverflow.com/questions/57476950/why-undefined-reference-error-despite-i-dash-capital-i-flag-during-compilatio/57477068#57477068", "title": "Why undefined reference error despite -I (dash capital i) flag during compilation?", "body": "<p><code>-I</code> only specifies to the compiler that you are searching in a directory for files to satisfy <code>#include</code> statements.</p>\n\n<p>You now need to compile and link to the <code>triangulate</code> code that you are using.</p>\n"}], "owner": {"reputation": 842, "user_id": 5440125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5368403fa6c1aa62270f86373269777f?s=128&d=identicon&r=PG&f=1", "display_name": "zengod", "link": "https://stackoverflow.com/users/5440125/zengod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "closed_date": 1565697214, "answer_count": 1, "score": -4, "last_activity_date": 1565696790, "creation_date": 1565696198, "last_edit_date": 1565696790, "question_id": 57476950, "link": "https://stackoverflow.com/questions/57476950/why-undefined-reference-error-despite-i-dash-capital-i-flag-during-compilatio", "closed_reason": "Duplicate", "title": "Why undefined reference error despite -I (dash capital i) flag during compilation?", "body": "<p>I am compiling code that uses the external library <code>https://www.cs.cmu.edu/afs/cs/project/quake/public/www/triangle.html</code>.\nAll the triangle source and object files are in ~/triangle/ folder. So I compile like this:</p>\n\n<pre><code>g++ -g sobel_aot_run.cpp sobel_x_out.a sobel_y_out.a support.a -ljpeg -lpng -std=c++11 -I ../include -I ../tools -I ~/triangle -lpthread -ldl -o sobel\n</code></pre>\n\n<p>Even though I have specified <code>-I ~/triangle</code>, running this command gives the following error:</p>\n\n<pre><code>/tmp/cc9AUEre.o: In function `main':\n/home/zendevil/Halide/tutorial/sobel_aot_run.cpp:74: undefined reference to `triangulate(char*, triangulateio*, triangulateio*, triangulateio*)'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>How to compile this?</p>\n"}, {"tags": ["c", "struct", "file-descriptor"], "comments": [{"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 0, "creation_date": 1565701658, "post_id": 57476790, "comment_id": 101428457, "body": "Apart from errors mentioned in Paul Ogilvie&#39;s answer, it is difficult to understand when you call which piece of code and what are the preconditions. There are even syntax errors in your code. You don&#39;t show how you call your functions. Maybe this is in the <code>main</code> function? Please <a href=\"https://stackoverflow.com/posts/57476790/edit\">edit</a> your question and add more details and what exactly you mean with &quot;Loop falls through&quot;. Which loop? Comparing the result of <code>read()</code> with <code>EOF</code> is probably wrong. <code>read()</code> will return the number of bytes it has read, which may be less than you want, or <code>0</code> on EOF or <code>&lt;0</code> on error."}, {"owner": {"reputation": 46, "user_id": 3598510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2a4901d74f6e59890b64a52c537afc?s=128&d=identicon&r=PG&f=1", "display_name": "Avalon", "link": "https://stackoverflow.com/users/3598510/avalon"}, "reply_to_user": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 0, "creation_date": 1565709632, "post_id": 57476790, "comment_id": 101433216, "body": "@Bodo ... Thanks for view.... I have edited and added for explanations sure it is clear for your aid... Thanks"}], "answers": [{"comments": [{"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 0, "creation_date": 1565700811, "post_id": 57476900, "comment_id": 101428006, "body": "To add a new user you could also use <code>newStudent[studentInDatabase] = myUserInfo; studentInDatabase++;</code>"}, {"owner": {"reputation": 46, "user_id": 3598510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2a4901d74f6e59890b64a52c537afc?s=128&d=identicon&r=PG&f=1", "display_name": "Avalon", "link": "https://stackoverflow.com/users/3598510/avalon"}, "edited": false, "score": 0, "creation_date": 1565709807, "post_id": 57476900, "comment_id": 101433309, "body": "@Paul Ogilivie .. I trying it out now... Please will let know how far about the come... Thanks"}, {"owner": {"reputation": 46, "user_id": 3598510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2a4901d74f6e59890b64a52c537afc?s=128&d=identicon&r=PG&f=1", "display_name": "Avalon", "link": "https://stackoverflow.com/users/3598510/avalon"}, "reply_to_user": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 0, "creation_date": 1566203101, "post_id": 57476900, "comment_id": 101568014, "body": "@Bodo Thanks but how about the error am facing when re-writing the data back to file after adding a new recode <code>open write() error: Permission denied</code>  Am using <code>fd = open(fn, O_WRONLY| O_CREAT | O_TRUNC )</code>"}], "tags": [], "owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "is_accepted": false, "score": 2, "last_activity_date": 1565696053, "creation_date": 1565696053, "answer_id": 57476900, "question_id": 57476790, "link": "https://stackoverflow.com/questions/57476790/how-to-read-and-write-files-and-process-files-using-file-descriptor-or-system-ca/57476900#57476900", "title": "How to read and write files and process files using file-descriptor or system call in c using struct with index", "body": "<p>Your add function reads into a single student record, but never updates the student array. You should use an index of the number of students in the array and read directly into the next free element:</p>\n\n<pre><code>struct Student newStudent[500];\nint studentInDatabase;\n</code></pre>\n\n<p>and now read like:</p>\n\n<pre><code>    printf(\"Type Student Name: \");\n    scanf(\"%s\",  newStudent[studentInDatabase].name );\n    //...\n    studentInDatabase++;\n</code></pre>\n\n<p>The same for <code>showStudents</code>, where the commented-out code seems correct. Etcetera, for all your other functions.</p>\n\n<p>Note: <code>if(newStudent[i].surname == \"search\" )</code>: use <code>strcmp()</code> to compare strings, so <code>if (strcmp(newStudent[i].surname, \"search\")==0 )</code></p>\n"}, {"comments": [{"owner": {"reputation": 46, "user_id": 3598510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2a4901d74f6e59890b64a52c537afc?s=128&d=identicon&r=PG&f=1", "display_name": "Avalon", "link": "https://stackoverflow.com/users/3598510/avalon"}, "edited": false, "score": 0, "creation_date": 1566062513, "post_id": 57481583, "comment_id": 101541286, "body": "ok.... I will testing the above suggestion right away and also i found out i do have access to any data i read from file to the struct outside while loop... Sure the above suggestion may help.. Will let know what ever come up..."}, {"owner": {"reputation": 46, "user_id": 3598510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2a4901d74f6e59890b64a52c537afc?s=128&d=identicon&r=PG&f=1", "display_name": "Avalon", "link": "https://stackoverflow.com/users/3598510/avalon"}, "edited": false, "score": 0, "creation_date": 1566064498, "post_id": 57481583, "comment_id": 101541731, "body": "<code>loadStudentFromFile()</code> is working just fine.... Concerning the <b>Remarks about search and remove functions</b> is to pass a search parameter to the function, load and loop through the data from file/db if found, return the details the student or update a specific field and save back ` void searchByAny(char studentParam[]) {    if((strcmp(myUserInfo.name, studentParam) || (strcmp(myUserInfo.telephone, studentParam)) == 0 ) return foundStudent; break: // Same for delete if found delete the matched record of student  } `"}, {"owner": {"reputation": 46, "user_id": 3598510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2a4901d74f6e59890b64a52c537afc?s=128&d=identicon&r=PG&f=1", "display_name": "Avalon", "link": "https://stackoverflow.com/users/3598510/avalon"}, "edited": false, "score": 0, "creation_date": 1566113289, "post_id": 57481583, "comment_id": 101548637, "body": "@Bolo ref:  specifically the term &quot;from file&quot; am only writing everything to file, also i use the <code>O_APPEND</code> because i want to add to what already written to file without removing the rest... if i should use the <code>O_TRUNC </code> how do i achieve same result without loading contents from the file before writing..."}, {"owner": {"reputation": 46, "user_id": 3598510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2a4901d74f6e59890b64a52c537afc?s=128&d=identicon&r=PG&f=1", "display_name": "Avalon", "link": "https://stackoverflow.com/users/3598510/avalon"}, "edited": false, "score": 0, "creation_date": 1566131146, "post_id": 57481583, "comment_id": 101552396, "body": "Had and error on this <code>void savePeopleToFile()</code>  ` sz = write(fd, newStudent[i], sizeof(newStudent[0]))` Error <code>error: incompatible type for argument 2 of &#39;write&#39;</code>"}, {"owner": {"reputation": 46, "user_id": 3598510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2a4901d74f6e59890b64a52c537afc?s=128&d=identicon&r=PG&f=1", "display_name": "Avalon", "link": "https://stackoverflow.com/users/3598510/avalon"}, "edited": false, "score": 0, "creation_date": 1566131754, "post_id": 57481583, "comment_id": 101552540, "body": "With the earlier approach i later had permission issues which wasn&#39;t so <code>open write() error: Permission denied</code> Will be glad for any suggestions..."}, {"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "reply_to_user": {"reputation": 46, "user_id": 3598510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2a4901d74f6e59890b64a52c537afc?s=128&d=identicon&r=PG&f=1", "display_name": "Avalon", "link": "https://stackoverflow.com/users/3598510/avalon"}, "edited": false, "score": 1, "creation_date": 1566210774, "post_id": 57481583, "comment_id": 101571723, "body": "@Avalon regarding the error about incompatible type: I forgot an <code>&amp;</code>-&gt; <code>sz = write(fd, &amp;newStudent[i], sizeof(newStudent[0]))</code>. Regarding overwriting or appending to the file: Please describe the use case. What should be in the file, what will be added. Appending new entries is be easy, but deleting entries will be difficult if you want to do all manipulations with reading/writing the file."}, {"owner": {"reputation": 46, "user_id": 3598510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2a4901d74f6e59890b64a52c537afc?s=128&d=identicon&r=PG&f=1", "display_name": "Avalon", "link": "https://stackoverflow.com/users/3598510/avalon"}, "edited": false, "score": 0, "creation_date": 1566236032, "post_id": 57481583, "comment_id": 101584685, "body": "regarding the file manipulation... I want to add new entries to the existing ones / modify... I think one scenario might work for the other or what do you think.. cos i load the entries before doing further processing like adding... So i add up to the existing index .... Whats your suggestions..."}, {"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "reply_to_user": {"reputation": 46, "user_id": 3598510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2a4901d74f6e59890b64a52c537afc?s=128&d=identicon&r=PG&f=1", "display_name": "Avalon", "link": "https://stackoverflow.com/users/3598510/avalon"}, "edited": false, "score": 0, "creation_date": 1566284415, "post_id": 57481583, "comment_id": 101597192, "body": "With a limited number of entries I suggest to read the whole file into memory, do all changes in memory and write the whole data back to the file."}, {"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "reply_to_user": {"reputation": 46, "user_id": 3598510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2a4901d74f6e59890b64a52c537afc?s=128&d=identicon&r=PG&f=1", "display_name": "Avalon", "link": "https://stackoverflow.com/users/3598510/avalon"}, "edited": false, "score": 0, "creation_date": 1566285976, "post_id": 57481583, "comment_id": 101597885, "body": "@Avalon If this is not what you want, you should describe your use cases in your question. How is the user of your program supposed to use the menu options 1..6. Can (s)he use 1, 2, 5, 6 without using 4 before? What exactly do you want to happen on various combinations of the menu options? Should the data be added/modified/deleted in a data structure in memory and/or in the file? How many records should your program be able to handle?"}], "tags": [], "owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "is_accepted": true, "score": 1, "last_activity_date": 1566211296, "last_edit_date": 1566211296, "creation_date": 1565712489, "answer_id": 57481583, "question_id": 57476790, "link": "https://stackoverflow.com/questions/57476790/how-to-read-and-write-files-and-process-files-using-file-descriptor-or-system-ca/57481583#57481583", "title": "How to read and write files and process files using file-descriptor or system call in c using struct with index", "body": "<p>Your code contains several problems.</p>\n\n<p><strong>This answer addresses the saving and loading of the data only.</strong></p>\n\n<p>I assume the number of records is small enough to read the all data to an array in memory and do all operations like adding/searching/removing records in memory using this array. Of course after any modification the data must be written back to the file. Because of this approach, the file is opened  for writing with <code>O_TRUNC</code>, not with <code>O_APPEND</code>.</p>\n\n<p>(It would be possible to work directly on the file, but such a solution will be more difficult to implement. Appending records to the existing data in the file is easy, searching while reading the data from the file is also no problem, but deleting records from the file would be difficult. You either would have to mark a record as deleted or move all data following the deleted record. Moving data inside a file will be difficult.)</p>\n\n<p>I assume that <code>studentInDatabase</code> is initialized with 0 and incremented by <code>addStudent()</code> for every new record.</p>\n\n<p>This means you should use</p>\n\n<pre><code>short studentInDatabase = 0;\n</code></pre>\n\n<p>In <code>savePeopleToFile()</code> I suggest to write whole structures instead of individual fields. Note that writing binary data is platform specific.</p>\n\n<pre><code>void savePeopleToFile()\n{\n    int  fd, sz, i;\n\n    fd = open(fn, O_WRONLY| O_CREAT | O_TRUNC ); /* not O_APPEND because we want to overwrite the file */\n    if(fd &lt; 0 )\n    {\n        perror(\"open write() error\");\n        fprintf(stderr, \"Error Creating File\\n\");\n        return;\n    }\n\n    printf(\"Open File Successfully......%d\\n\\n\", fd);\n\n//        printf(\"People in Database......%d\\n\", psz);\n    /* you could write the number of persons to the file if you want to have a cross-check */\n    for(int i = 0; i &lt; peopleInDatabase; i++)\n    {\n\n        sz = write(fd, &amp;newStudent[i] , sizeof(newStudent[0]));\n\n        /* TODO error handling if sz &lt; 0 or handling of partial write if sz != sizeof(newStudent[0]) */\n\n        printf(\"Size for person......%d\\n\", sz);\n\n    }\n    if(close(fd) &lt; 0)\n    {\n        perror(\"close() error\");\n        fprintf(stderr, \"Error Closing File\\n\");\n    }\n}\n</code></pre>\n\n<p>Note: This code is untested.</p>\n\n<p>When reading the data you have two options. If you have written the number of persons to the file, you can read this number first, then use a <code>for</code> loop. Otherwise use a <code>while</code> loop reading one record per cycle until EOF and count the number of records.</p>\n\n<p>Solution using a while loop:</p>\n\n<pre><code>void loadStudentFromFile()\n{\n    int readret;\n    int  fd;\n\n    if((fd = open(fn, O_RDONLY )) &lt; 0)\n    {\n        perror(\"open() error\");\n        fprintf(stderr, \"Error Opening File\\n\");\n        return;\n    }\n\n    peopleInDatabase = 0;\n\n    do\n    {\n        /* you could read directly to newStudent[peopleInDatabase], but I use\n           myUserInfo for easier access to the fields for printing */\n        readret = read(fd, &amp;myUserInfo , sizeof(myUserInfo));\n\n        /* TODO handle errors and partial reads */\n\n        if(readret &gt; 0)\n        {\n            printf(\"Person Index: %d \\n\", peopleInDatabase);\n            printf(\"Name: %s  \\n\",   myUserInfo.name);\n            printf(\"Surname: %s  \\n\",   myUserInfo.surname);\n            printf(\"Age: %s  \\n\",   myUserInfo.age);\n            printf(\"Tel: %s  \\n\\n\",  myUserInfo.telephone);\n\n            newStudent[peopleInDatabase] = myUserInfo;\n            peopleInDatabase++\n        }\n    } while(readret &gt; 0);\n\n    /* readret == 0 means EOF */\n    if(readret &lt; 0)\n    {\n        perror(\"read() error\");\n        fprintf(stderr, \"Error Reading File\\n\");\n    }\n\n    if(close(fd) &lt; 0)\n    {\n        perror(\"close() error\");\n        fprintf(stderr, \"Error Closing File\\n\");\n    }\n}\n</code></pre>\n\n<p>Note: This code is untested.</p>\n\n<p><strong>Remarks about search and remove functions</strong></p>\n\n<p>The menu entries <code>5. Search Student from file/db database</code> and <code>6. Remove Student from file/db database..</code> are not clear to me, specifically the term \"from file\".</p>\n\n<p>If you have loaded the file into memory using <code>4. Load Students from file/db...</code> you can do the operations for 5 and 6 in memory by accessing your array of data structures and after modifications save the data to the file using <code>3. Save Student to database...</code>. </p>\n\n<p>Or are you supposed to automatically read/write the file for 5 and 6?</p>\n"}], "owner": {"reputation": 46, "user_id": 3598510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2a4901d74f6e59890b64a52c537afc?s=128&d=identicon&r=PG&f=1", "display_name": "Avalon", "link": "https://stackoverflow.com/users/3598510/avalon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 0, "accepted_answer_id": 57481583, "answer_count": 2, "score": 0, "last_activity_date": 1566211296, "creation_date": 1565695586, "last_edit_date": 1565709484, "question_id": 57476790, "link": "https://stackoverflow.com/questions/57476790/how-to-read-and-write-files-and-process-files-using-file-descriptor-or-system-ca", "title": "How to read and write files and process files using file-descriptor or system call in c using struct with index", "body": "<p>I'm writing an application in c using file descriptor, open, read, write to store information to a file using a struct array with content <code>{name,age,mob}</code> eg \n<code>struct Students student[50]</code>. How do i handle the read back to the struct and say retrieve other information of the student by the name like a search..?\nHelp is Appreciated</p>\n\n<p>This what i tried so far but still not working as expected</p>\n\n<pre><code>// functions to implement\nshort studentInDatabase;\nvoid saveStudentToFile();\nvoid requireEntered();\nvoid addStudent();\nvoid showStudents();\nvoid loadStudentFromFile();\nvoid searchDatabase();\nstruct Student\n{\n    char name[20];\n    char surname[20];\n    char age[20]; //using char array because i can't save int to file\n    char telephone[20];\n\n};\n\nstruct Student newStudent[500];\nstruct Student myUserInfo;\n</code></pre>\n\n<pre><code>void addStudent()\n{\n\n    printf(\"Type Student Name: \");\n    scanf(\"%s\",  myUserInfo.name );\n\n    printf(\"Type Surname: \");\n    scanf(\"%s\", myUserInfo.surname);\n\n    printf(\"Type Age: \");\n    scanf(\"%s\", myUserInfo.age);\n\n    printf(\"Type Telephone: \");\n    scanf(\"%s\", myUserInfo.telephone);\n\n    studentInDatabase++;\n\n}\n</code></pre>\n\n<pre><code>void showStudents()\n{\n    if(peopleInDatabase &gt; 0)\n    {\n        for(int i = 0; i &lt; peopleInDatabase; i++)\n        {\n            printf(\"Person in index %d\\n\", i+1);\n            printf(\"Name: %s \\n\", myUserInfo.name);\n            printf(\"Surname: %s\\n\",myUserInfo.surname );\n            printf(\"Age: %s\\n\",myUserInfo.age);\n            printf(\"Telephone: %s\\n\\n\",myUserInfo.telephone);\n// Use this is using the newStudents Array structure\n//            printf(\"Person in index %d\\n\", i+1);\n//            printf(\"Name: %s \\n\", newStudents [i].name);\n//            printf(\"Surname: %s\\n\", newStudents [i].surname );\n//            printf(\"Age: %s\\n\", newStudents [i].age);\n//            printf(\"Telephone: %s\\n\\n\", newStudents [i].telephone);\n\n        }\n    }\n    else {\n          printf(\"There is nobody available...\");\n    }\n}\n</code></pre>\n\n<pre><code>void savePeopleToFile()\n{\n    //char *mega_string;\n    int  fd, ret, sz, ssz, asz, tsz, psz, fdd;\n    char fn[]=\"writefile.txt\";\n\n    fd = open(fn, O_WRONLY| O_CREAT| O_APPEND );\n    if(fd &lt; 0 )\n    {\n        perror(\"open write() error\");\n        printf(\"Error Creating File\\n\");\n    }\n\n    printf(\"Open File Successfully......%d\\n\\n\", fd);\n\n    if(peopleInDatabase &gt; 0)\n    {\n//        printf(\"People in Database......%d\\n\", psz);\n        for(int i = 0; i &lt; peopleInDatabase; i++)\n        {\n            //\n            sz = write(fd, myUserInfo.name , sizeof( myUserInfo.name));\n            printf(\"Size for name......%d\\n\", sz);\n\n            ssz = write(fd, myUserInfo.surname, sizeof(myUserInfo.surname));\n            printf(\"Size for Surname......%d\\n\", ssz);\n\n            asz = write(fd, myUserInfo.age, sizeof(myUserInfo.age));\n            printf(\"Size for age......%d\\n\", asz);\n\n            tsz = write(fd, myUserInfo.telephone, sizeof(myUserInfo.telephone));\n            printf(\"Size for telephone......%d\\n\", tsz);\n        }\n//\n//            sz = write(fd, newStudents [i].name, sizeof(people[i].name));\n//            printf(\"Size for name......%d\\n\", sz);\n//\n//            ssz = write(fd, newStudents[i].surname, sizeof(people[i].surname));\n//            printf(\"Size for Surname......%d\\n\", ssz);\n//\n//            asz = write(fd, newStudents [i].age, sizeof(people[i].age));\n//            printf(\"Size for age......%d\\n\", asz);\n//\n//            tsz = write(fd, newStudents[i].telephone, sizeof(people[i].telephone));\n//            printf(\"Size for telephone......%d\\n\", tsz);\n        }\n    close(fd);\n}\n</code></pre>\n\n<pre><code>void loadStudentFromFile()\n{\n    int readret, someSize;\n    int foo;\n    int  fd;\n    char buf[4096];\n    char fn[]=\"writefile.txt\";\n     if((fd = open(fn, O_RDONLY )) &lt; 0)\n    {\n        perror(\"creat() error\");\n        printf(\"Error Creating File\\n\");\n    }\n\n    // Use this when using array structure\n    readret = read(fd, newStudent , sizeof(newStudent) != EOF);\n\n    // Use this when using myUserInfo structure\n    readret = read(fd, &amp;myUserInfo , sizeof(myUserInfo) != EOF);\n\n    while (readret = read(fd, &amp;myUserInfo , sizeof(people) != EOF))\n    {\n           printf(\"Person Index: %d \\n\", (i+1));\n           printf(\"Name: %s  \\n\",   myUserInfo.name);\n           printf(\"Surname: %s  \\n\",   myUserInfo.surname);\n           printf(\"Age: %s  \\n\",   myUserInfo.age);\n           printf(\"Tel: %s  \\n\\n\",  myUserInfo.telephone);\n    };\n\n// Check for readret in not -1 or EOF\n//    if(readret &gt; 0)\n//    {\n//        int i = 0;\n//        for(; i &lt; 10; i++)\n//        {\n////             printf(\"Person Index: %d \\n\", (i+1));\n////             printf(\"Name: %s  \\n\",   newStudent[i].name);\n//               printf(\"Name: %s  \\n\",   myUserInfo.name);\n//               printf(\"Surname: %s  \\n\",   myUserInfo.surname);\n////             printf(\"Age: %s  \\n\",   newStudent[i].age);\n////             printf(\"Tel: %s  \\n\\n\",   newStudent[i].telephone);\n//\n//             if(newStudent[i].surname == \"Midel\" )\n//             {\n//                 printf(\"%s %s is Available ....\\n\",myUserInfo.name, myUserInfo.surname);\n//             }\n//      }\n//   }\n\n    close(fd);\n}\n</code></pre>\n\n<pre><code>void searchDatabase(char search[])\n{\n    int readret, someSize;\n    int foo;\n    int  fd;\n    char buf[4096];\n    char fn[]=\"writefile.txt\";\n     if((fd = open(fn, O_RDONLY )) &lt; 0)\n    {\n        perror(\"creat() error\");\n        printf(\"Error Creating File\\n\");\n    }\n\n    // Use this when using array structure\n    readret = read(fd, newStudent , sizeof(newStudent) != EOF);\n\n    // Use this when using myUserInfo structure\n    readret = read(fd, &amp;myUserInfo , sizeof(myUserInfo) != EOF);\n\n    while (readret = read(fd, &amp;myUserInfo , sizeof(people) != EOF))\n    {\n         if(newStudent[i].surname == \"search\" )\n//        {\n//           Return Details of User when Found....  \n//            printf(\"Person Index: %d \\n\", (i+1));\n//           printf(\"Name: %s  \\n\",   myUserInfo.name);\n//           printf(\"Surname: %s  \\n\",   myUserInfo.surname);\n//           printf(\"Age: %s  \\n\",   myUserInfo.age);\n//           printf(\"Tel: %s  \\n\\n\",  myUserInfo.telephone);\n//        }\n\n    };\n\n// Check for readret in not -1 or EOF\n//    if(readret &gt; 0)\n//    {\n//        int i = 0;\n//        for(; i &lt; 10; i++)\n//        {\n////             printf(\"Person Index: %d \\n\", (i+1));\n////             printf(\"Name: %s  \\n\",   newStudent[i].name);\n//               printf(\"Name: %s  \\n\",   myUserInfo.name);\n//               printf(\"Surname: %s  \\n\",   myUserInfo.surname);\n////             printf(\"Age: %s  \\n\",   newStudent[i].age);\n////             printf(\"Tel: %s  \\n\\n\",   newStudent[i].telephone);\n//\n//             if(&amp;people[i].surname == \"search\" )\n//             {\n//                 printf(\"%s %s is Available ....\\n\",myUserInfo.name, myUserInfo.surname);\n//             }\n//      }\n//   }\n\n    close(fd);\n}\n</code></pre>\n\n<p>I was expecting to get the number of students in DB File when am reading</p>\n\n<pre><code>// Write four (4) students or people\nif(peopleInDatabase &lt; 4)\n    {\n//        printf(\"People in Database......%d\\n\", psz);\n        for(int i = 0; i &lt; peopleInDatabase; i++)\n        {\n            //\n            sz = write(fd, myUserInfo.name , sizeof( myUserInfo.name));\n            printf(\"Size for name......%d\\n\", sz);\n\n            ssz = write(fd, myUserInfo.surname, sizeof(myUserInfo.surname));\n            printf(\"Size for Surname......%d\\n\", ssz);\n\n            asz = write(fd, myUserInfo.age, sizeof(myUserInfo.age));\n            printf(\"Size for age......%d\\n\", asz);\n\n            tsz = write(fd, myUserInfo.telephone, sizeof(myUserInfo.telephone));\n            printf(\"Size for telephone......%d\\n\", tsz);\n        }\n</code></pre>\n\n<pre><code>// Use this when using array structure should return 4 \n// i.e Shouldn't exceed 4\n    readret = read(fd, newStudent , sizeof(newStudent) != EOF);\n\n    // Use this when using myUserInfo structure\n    readret = read(fd, &amp;myUserInfo , sizeof(myUserInfo) != EOF);\n\n    while (readret = read(fd, &amp;myUserInfo , sizeof(people) != EOF))\n    {\n           printf(\"Person Index: %d \\n\", (i+1));\n           printf(\"Name: %s  \\n\",   myUserInfo.name);\n           printf(\"Surname: %s  \\n\",   myUserInfo.surname);\n           printf(\"Age: %s  \\n\",   myUserInfo.age);\n           printf(\"Tel: %s  \\n\\n\",  myUserInfo.telephone);\n    };\n</code></pre>\n\n<pre><code>void searchStudent(char search[])\n// Check for readret in not -1 or EOF\n//    if(readret &gt; 0)\n//    {\n//        int i = 0;\n//        for(; i &lt; 10; i++)\n//        {\n//             if(newStudent[i].surname == \"search\" )\n//             {\n//                 printf(\"%s %s is Available ....\\n\",myUserInfo.name, myUserInfo.surname);\n//                  printf(\"Person Index: %d \\n\", (i+1));\n////             printf(\"Name: %s  \\n\",   newStudent[i].name);\n//               printf(\"Name: %s  \\n\",   myUserInfo.name);\n//               printf(\"Surname: %s  \\n\",   myUserInfo.surname);\n////             printf(\"Age: %s  \\n\",   newStudent[i].age);\n////             printf(\"Tel: %s  \\n\\n\",   newStudent[i].telephone);\n//             }\n//      }\n//   }\n</code></pre>\n\n<p>Currently it doesn't work... Loop falls through</p>\n\n<pre><code>int main()\n{\n    char test;\n    loadPeopleFromFile();\n\n    do\n    {\n        printf( \"Number of People In Database... %d \\n\", peopleInDatabase);\n        printf( \"MENU\\n\");\n\n        printf(\"1. Add Student\\n\");\n        printf( \"2. Show All Students\\n\");\n        printf(\"3. Save Student to database... \\n\");\n        printf( \"4. Load Students from file/db...\\n\");\n        printf( \"5. Search Student from file/db database\\n\");\n        printf( \"6. Remove Student from file/db database..\\n\");\n\n\n        test = getchar();\n\n        switch(test)\n        {\n        case '1':\n            addPerson();\n            break;\n        case '2':\n             showPeople();\n             break;\n        case '3':\n            savePeopleToFile();\n            break;\n        case '4':\n            loadPeopleFromFile();\n            break;\n        case '5':\n            searchDatabase();\n            break;\n        case '6':\n            removePersonFromDatabase();\n            break;\n        }\n\n        requireEntered();\n        system(\"cls\");\n    } while(test != 27);\n\n    return 0;\n}\nvoid requireEntered()\n{\n        printf(\"Click enter to continue.....\");\n        while(getch() != 13);\n}\n</code></pre>\n\n<p>This is the implementation in main.... as requested..\nIf i mean fall through... I can get the actual number of records i saved unless i add initialize and int bigger for the loop.. Say i save 5 records.. i write</p>\n\n<pre><code>readret = read(fd, &amp;myUserInfo , sizeof(myUserInfo));\nif(readret &gt; 0)\n   {\n       int i = 0;\n       for(; i &lt; 10; i++)\n       {\n             printf(\"Person Index: %d \\n\", (i+1));\n             printf(\"Name: %s  \\n\",   newStudent[i].name);\n             printf(\"Name: %s  \\n\",   myUserInfo.name);\n             printf(\"Surname: %s  \\n\",   myUserInfo.surname);\n             printf(\"Age: %s  \\n\",   newStudent[i].age);\n             printf(\"Tel: %s  \\n\\n\",   newStudent[i].telephone);\n\n            if(newStudent[i].surname == \"Midel\" )\n            {\n                printf(\"%s %s is Available ....\\n\",myUserInfo.name, myUserInfo.surname);\n            }\n        }\n     }\n\n//NB I only use \nreadret = read(fd, &amp;myUserInfo, sizeof(myUserInfo) != EOF); //for the while loop\n while (readret = read(fd, &amp;myUserInfo , sizeof(people) != EOF))\n    {\n           printf(\"Person Index: %d \\n\", (i+1));\n           printf(\"Name: %s  \\n\",   myUserInfo.name);\n           printf(\"Surname: %s  \\n\",   myUserInfo.surname);\n           printf(\"Age: %s  \\n\",   myUserInfo.age);\n           printf(\"Tel: %s  \\n\\n\",  myUserInfo.telephone);\n    };\n</code></pre>\n\n<p>Any help on getting the exact number of what i save so i can use for loop is appreciated thanks...\nSay i retrieve that an pass to <code>int studentsInDb</code> then i can <code>if i &lt; studentsInDb</code>.. Thanks</p>\n"}, {"tags": ["c++", "c", "linker", "glibc", "static-linking"], "comments": [{"owner": {"reputation": 1995, "user_id": 4850111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26c63534a6d43180d0d0636e5c3a26b8?s=128&d=identicon&r=PG&f=1", "display_name": "nada", "link": "https://stackoverflow.com/users/4850111/nada"}, "edited": false, "score": 3, "creation_date": 1565708508, "post_id": 57476533, "comment_id": 101432584, "body": "Ironic that CentOS&#39;s package repo is so outdated that it sometimes forces developers to link statically."}], "answers": [{"comments": [{"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "edited": false, "score": 4, "creation_date": 1565696273, "post_id": 57476755, "comment_id": 101425721, "body": "<a href=\"https://yarchive.net/comp/linux/gcc_vs_kernel_stability.html\" rel=\"nofollow noreferrer\">yarchive.net/comp/linux/gcc_vs_kernel_stability.html</a>: <i>We care about user-space interfaces to an insane degree. We go to extreme lengths to maintain even badly designed or unintentional interfaces. Breaking user programs simply isn&#39;t acceptable.</i>"}, {"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "edited": false, "score": 0, "creation_date": 1565696420, "post_id": 57476755, "comment_id": 101425810, "body": "<a href=\"https://unix.stackexchange.com/questions/235335/why-is-there-a-linux-kernel-policy-to-never-break-user-space\" title=\"why is there a linux kernel policy to never break user space\">unix.stackexchange.com/questions/235335/&hellip;</a>"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "edited": false, "score": 1, "creation_date": 1565696796, "post_id": 57476755, "comment_id": 101425984, "body": "@MaximEgorushkin Reality is different.  <a href=\"http://lkml.iu.edu/hypermail/linux/kernel/1604.0/00998.html\" rel=\"nofollow noreferrer\">The Linux ABI isn&#39;t very stable, to the point it&#39;s been mocked relatively recently</a>:  &quot;It&#39;s not a secret that there are two basic ways of running a Linux distribution on your hardware. Either you use a stable distro which has quite an outdated kernel release which might not support your hardware or you run the most recent stable version but you lose stability and you are prone to regressions.&quot;"}, {"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "edited": false, "score": 8, "creation_date": 1565697013, "post_id": 57476755, "comment_id": 101426077, "body": "The quote you cited is about in-kernel driver APIs, not the user-space API."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "edited": false, "score": 0, "creation_date": 1565697225, "post_id": 57476755, "comment_id": 101426176, "body": "@MaximEgorushkin Are you really claiming the the Linux kernel user-space API is standardized to the level of POSIX, the C standard, and the C++ standard, amongst others?  Really?  That the Linux kernel user-space API is as stable as standard C functions listed in the C standard?  Because <b>that</b> is the interface that gets coded to."}, {"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "edited": false, "score": 0, "creation_date": 1565697271, "post_id": 57476755, "comment_id": 101426197, "body": "I never claimed that Linux API is standardized. Only that it is (relatively) stable. And most Linux POSIX function implementations are quite compliant."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "edited": false, "score": 0, "creation_date": 1565697505, "post_id": 57476755, "comment_id": 101426318, "body": "@MaximEgorushkin <i>I never claimed that Linux API is standardized. Only that it is (relatively) stable.</i> Compared to POSIX and the C standard, it&#39;s not stable at all. It can be changed whenever a small group decides unilaterally to change it.  The <code>glibc</code> interface is standardized.  By POSIX.  By the C standard.  And others. So you admit this answer is correct then?"}, {"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "edited": false, "score": 0, "creation_date": 1565697802, "post_id": 57476755, "comment_id": 101426484, "body": "Read my first two comments again and argue with Linus Torvalds."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "edited": false, "score": 0, "creation_date": 1565698012, "post_id": 57476755, "comment_id": 101426584, "body": "@MaximEgorushkin That has <b>absolutely nothing</b> to do with static linking <code>glibc</code>.  You need to <a href=\"https://en.wikipedia.org/wiki/GNU/Linux_naming_controversy\" rel=\"nofollow noreferrer\">read Richard Stallman about how its GNU (the <b>G</b> in <code>glibc</code>)/Linux and not just Linux.</a>  It&#39;s even got a wikipedia page."}, {"owner": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "edited": false, "score": 0, "creation_date": 1565703984, "post_id": 57476755, "comment_id": 101429779, "body": "@AndrewHenle: That whole confusion is <b>exactly</b> why it&#39;s such a problem, even 25 years later. <code>glibc</code> tries to be too much for too many cases. Microsoft is much cleaner in this respect. Windows itself has the Universal CRT, Visual Studio has its MSVCRT."}, {"owner": {"reputation": 7116, "user_id": 5083516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f2aeeefc1a95ddb2f19612150ccd7ba?s=128&d=identicon&r=PG&f=1", "display_name": "plugwash", "link": "https://stackoverflow.com/users/5083516/plugwash"}, "edited": false, "score": 4, "creation_date": 1565726328, "post_id": 57476755, "comment_id": 101440334, "body": "&quot;The glibc interface is standardized. By POSIX. By the C standard. And others.&quot; the <i>programming interface</i> is, but the <i>binary interface</i> is not!"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 7116, "user_id": 5083516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f2aeeefc1a95ddb2f19612150ccd7ba?s=128&d=identicon&r=PG&f=1", "display_name": "plugwash", "link": "https://stackoverflow.com/users/5083516/plugwash"}, "edited": false, "score": 0, "creation_date": 1565727010, "post_id": 57476755, "comment_id": 101440563, "body": "@plugwash And that&#39;s why statically-linking glibc has some serious drawbacks.  The binary interface can change a lot easier than what you called the &quot;programming interface&quot;.  That programming interface is defined by <a href=\"https://port70.net/~nsz/c/c11/n1570.html\" rel=\"nofollow noreferrer\">the C standard</a> and <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/\" rel=\"nofollow noreferrer\">POSIX</a> among other standards.  The kernel&#39;s binary interface is not standardized at all.  The programming interface is tightly defined and standardized."}, {"owner": {"reputation": 7116, "user_id": 5083516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f2aeeefc1a95ddb2f19612150ccd7ba?s=128&d=identicon&r=PG&f=1", "display_name": "plugwash", "link": "https://stackoverflow.com/users/5083516/plugwash"}, "edited": false, "score": 1, "creation_date": 1565727535, "post_id": 57476755, "comment_id": 101440748, "body": "The kernel&#39;s binary interface is not standardised, but neither is glibc&#39;s binary interface."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 7116, "user_id": 5083516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f2aeeefc1a95ddb2f19612150ccd7ba?s=128&d=identicon&r=PG&f=1", "display_name": "plugwash", "link": "https://stackoverflow.com/users/5083516/plugwash"}, "edited": false, "score": 0, "creation_date": 1565728147, "post_id": 57476755, "comment_id": 101440955, "body": "@plugwash <i>The kernel&#39;s binary interface is not standardised, but neither is glibc&#39;s binary interface.</i>  <a href=\"https://stackoverflow.com/questions/18133812/where-is-the-x86-64-system-v-abi-documented\">Ummm, you sure about that?</a>  The C standard says the function is <code>fopen( const char *file, const char *mode );</code>  The platform ABI specifies the calling convention into the system-provided library, along with <a href=\"https://port70.net/~nsz/c/c11/n1570.html#6.2.2\" rel=\"nofollow noreferrer\">the C standard</a> and <a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/\" rel=\"nofollow noreferrer\">POSIX</a>.  So, do you know what system call that <code>fopen()</code> call uses?"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 7116, "user_id": 5083516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f2aeeefc1a95ddb2f19612150ccd7ba?s=128&d=identicon&r=PG&f=1", "display_name": "plugwash", "link": "https://stackoverflow.com/users/5083516/plugwash"}, "edited": false, "score": 0, "creation_date": 1565728185, "post_id": 57476755, "comment_id": 101440961, "body": "@plugwash Can you please provide the standard that Linux kernel system call interface is governed by?"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1565737296, "post_id": 57476755, "comment_id": 101443499, "body": "Linux is committed to keeping its interface backwards compatible for this reason."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1565737335, "post_id": 57476755, "comment_id": 101443510, "body": "@AndrewHenle Actually, that&#39;s an argument in favour of static linking. What if the binary interface to glibc changed, but your program didn&#39;t change to use the new binary interface? (Answer: glibc doesn&#39;t change its binary interface for this reason)"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1565737430, "post_id": 57476755, "comment_id": 101443523, "body": "@AndrewHenle The standard is here: <a href=\"https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/\" rel=\"nofollow noreferrer\">git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/t&zwnj;&#8203;ree</a> - unfortunately it&#39;s written in C rather than English."}, {"owner": {"reputation": 7116, "user_id": 5083516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f2aeeefc1a95ddb2f19612150ccd7ba?s=128&d=identicon&r=PG&f=1", "display_name": "plugwash", "link": "https://stackoverflow.com/users/5083516/plugwash"}, "edited": false, "score": 0, "creation_date": 1565788323, "post_id": 57476755, "comment_id": 101460486, "body": "@AndrewHenle those standards are an insufficient specification of the interface for two reasons. The first is that C standard library functionality is sometimes implemented using macros. The second and far more pressing issue is symbol versioning, which effectively prevents software built against a newer glibc from running with an older glibc."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 7116, "user_id": 5083516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f2aeeefc1a95ddb2f19612150ccd7ba?s=128&d=identicon&r=PG&f=1", "display_name": "plugwash", "link": "https://stackoverflow.com/users/5083516/plugwash"}, "edited": false, "score": 0, "creation_date": 1565790347, "post_id": 57476755, "comment_id": 101461734, "body": "@plugwash Are you <b>really</b> trying to claim that statically linking to glibc 2.30 is the solution to producing a binary guaranteed to run on a system with glibc 2.21?"}], "tags": [], "owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "is_accepted": false, "score": 2, "last_activity_date": 1565777039, "last_edit_date": 1592644375, "creation_date": 1565695463, "answer_id": 57476755, "question_id": 57476533, "link": "https://stackoverflow.com/questions/57476533/why-is-statically-linking-glibc-discouraged/57476755#57476755", "title": "Why is statically linking glibc discouraged?", "body": "<p>The program/<code>glibc</code> interface is standardized and documented by POSIX, the C and C++ standards, and others.  For example, the <code>fopen()</code> function behaves per the C standard, and <code>pthread_mutex_lock()</code> per POSIX.</p>\n<p>The <code>glibc</code>/kernel interface is <em>not</em> standardized.  Does <code>fopen()</code> use <code>open()</code> under the hood?  Or does it use <code>openat()</code>?  Or something else? What will it use next year? You don't know.</p>\n<p>If the <code>glibc</code>/kernel interface changes, a program that uses whatever changed but statically links <code>glibc</code> won't work any more.</p>\n<p>15+ years ago, Solaris removed all static versions of <code>libc</code> for this very reason.</p>\n<p><a href=\"https://blogs.oracle.com/solaris/static-linking-where-did-it-go-v2\" rel=\"nofollow noreferrer\"><strong>Static Linking - where did it go?</strong></a></p>\n<blockquote>\n<p>With Solaris 10 you can no longer build a static executable. It's not that ld(1) doesn't allow static linking, or using archives, it's just that libc.a, the archive version of libc.so.1, is no longer provided. This library provides the interfaces between user land and the kernel, and without this library it is rather hard to create any form of application.</p>\n<p>We've been warning users against static linking for some time now, and linking against libc.a has been especially problematic. Every solaris release, or update (even some patches) has resulted in some application that was built against libc.a, failing. The problem is that libc is supposed to isolate an application from the user/kernel boundary, a boundary which can undergo changes from release to release.</p>\n<p>If an application is built against libc.a, <strong>then any kernel interface it references is extracted from the archive and becomes a part of the application. Thus, this application can only run on a kernel that is in-sync with the kernel interfaces used. Should these interfaces change, the application is treading on shaky ground.</strong></p>\n<p>...</p>\n</blockquote>\n<p><strong>Edit:</strong></p>\n<p>There seems to be serious overestimation of the stability of the Linux kernel interface.  See <a href=\"https://stackoverflow.com/questions/19073157/linux-kernel-api-changes-additions\">Linux kernel API changes/additions</a> for details.  To summarize:</p>\n<p><a href=\"https://i.stack.imgur.com/PRjoG.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PRjoG.jpg\" alt=\"enter image description here\" /></a></p>\n"}, {"tags": [], "owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "is_accepted": false, "score": 2, "last_activity_date": 1565708006, "last_edit_date": 1565708006, "creation_date": 1565697030, "answer_id": 57477138, "question_id": 57476533, "link": "https://stackoverflow.com/questions/57476533/why-is-statically-linking-glibc-discouraged/57477138#57477138", "title": "Why is statically linking glibc discouraged?", "body": "<p>Bug fixes in glibc aren't included in a statically linked application when you upgrade glibc unless you rebuild the application.</p>\n\n<p>Also, <a href=\"https://www.gnu.org/software/libc/manual/html_node/Name-Service-Switch.html\" rel=\"nofollow noreferrer\">NSS</a> (Name Service Switch) doesn't work unless you use dynamic linking.</p>\n"}, {"comments": [{"owner": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "edited": false, "score": 7, "creation_date": 1565704367, "post_id": 57478728, "comment_id": 101430011, "body": "Note that the need for a second copy of glibc is a design decision. If the static glibc library had linked in NSS and iconv statically, it wouldn&#39;t have been necessary. The downside of course would be that you could only use those NSS modules and iconv conversions that were linked in statically, but that&#39;s pretty obvious from the definition of static linking."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "reply_to_user": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "edited": false, "score": 6, "creation_date": 1565704863, "post_id": 57478728, "comment_id": 101430371, "body": "@MSalters There has been some discussion recently on the glibc development list about doing just that.  This design decision was made in the 1990s, and there&#39;s a strong argument that we don&#39;t <i>need</i> quite so much flexibility in character encoding for terminal output anymore, especially not in the kinds of programs that people want to link statically.  NSS flexibility is still important but there are alternative ways to handle that (e.g. <code>nscd</code>)."}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1565727209, "post_id": 57478728, "comment_id": 101440636, "body": "This is not <i>quite</i> right; I discovered that staticly linked C programs using <code>stdio.h</code> work with no libraries in /lib. The program I had to do this with was lilo."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "reply_to_user": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1565727665, "post_id": 57478728, "comment_id": 101440798, "body": "@Joshua Did you try it with LANG set to a locale that requires use of an unusual character set?"}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 1, "creation_date": 1565727813, "post_id": 57478728, "comment_id": 101440852, "body": "@zwol: It just switches to LANG=C if it can&#39;t load the library. This behavior is necessary for early boot."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 1, "creation_date": 1565737109, "post_id": 57478728, "comment_id": 101443451, "body": "@Joshua then it sounds like it will load the library, and another copy of glibc, if it can."}], "tags": [], "owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "is_accepted": true, "score": 46, "last_activity_date": 1565702689, "creation_date": 1565702689, "answer_id": 57478728, "question_id": 57476533, "link": "https://stackoverflow.com/questions/57476533/why-is-statically-linking-glibc-discouraged/57478728#57478728", "title": "Why is statically linking glibc discouraged?", "body": "<p>The reasons given in other answers are correct, but they are not the most important reason.</p>\n\n<p>The most important reason why glibc should not be statically linked, is that it makes extensive internal use of <a href=\"http://man7.org/linux/man-pages/man3/dlopen.3.html\" rel=\"noreferrer\"><code>dlopen</code></a>, to load NSS (<a href=\"http://man7.org/linux/man-pages/man5/nsswitch.conf.5.html\" rel=\"noreferrer\">Name Service Switch</a>) modules and <a href=\"http://man7.org/linux/man-pages/man3/iconv.3.html\" rel=\"noreferrer\"><code>iconv</code></a> conversions.  The modules themselves refer to C library functions.  If the main program is dynamically linked with the C library, that's no problem.  But if the main program is statically linked with the C library, <code>dlopen</code> has to go load a <em>second copy</em> of the C library to satisfy the modules' load requirements.</p>\n\n<p>This means your \"statically linked\" program still needs a copy of <code>libc.so.6</code> to be present on the file system, plus the NSS or <code>iconv</code> or whatever modules themselves, plus other dynamic libraries that the modules might need, like <code>ld-linux.so.2</code>, <code>libresolv.so.2</code>, etc.  This is not what people usually want when they statically link programs.</p>\n\n<p>It also means the statically linked program has two copies of the C library in its address space, and they might fight over whose <code>stdout</code> buffer is to be used, who gets to call <code>sbrk</code> with a nonzero argument, that sort of thing.  There is a bunch of defensive logic inside glibc to try to make this work, but it's never been <em>guaranteed</em> to work.</p>\n\n<p>You might think your program doesn't need to worry about this because it doesn't ever call <code>getaddrinfo</code> or <code>iconv</code>, but locale support uses <code>iconv</code> internally, which means <em>any <code>stdio.h</code> function</em> might trigger a call to <code>dlopen</code>, and you don't control this, the user's environment variable settings do.</p>\n"}], "owner": {"reputation": 1602, "user_id": 5285891, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/863f0d8e87256fcdf5209545922d20f9?s=128&d=identicon&r=PG&f=1", "display_name": "pzelasko", "link": "https://stackoverflow.com/users/5285891/pzelasko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7395, "favorite_count": 4, "accepted_answer_id": 57478728, "answer_count": 3, "score": 50, "last_activity_date": 1565777039, "creation_date": 1565694653, "question_id": 57476533, "link": "https://stackoverflow.com/questions/57476533/why-is-statically-linking-glibc-discouraged", "title": "Why is statically linking glibc discouraged?", "body": "<p>Most of the sources online state that you can statically link glibc, but discourage from doing so; e.g. <a href=\"https://centos.pkgs.org/7/centos-updates-x86_64/glibc-static-2.17-260.el7_6.4.x86_64.rpm.html\" rel=\"noreferrer\">centos package repo</a>:</p>\n\n<pre><code>The glibc-static package contains the C library static libraries\nfor -static linking.  You don't need these, unless you link statically,\nwhich is highly discouraged.\n</code></pre>\n\n<p>These sources rarely (or never) say why that would be a bad idea.</p>\n"}, {"tags": ["java", "c++", "c", "path", "os-agnostic"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 1, "creation_date": 1565692948, "post_id": 57476045, "comment_id": 101423866, "body": "There isn&#39;t such language like c/c++, they are completely different. If you want an answer for c++, maybe <code>std::filesystem</code> is the way to go."}, {"owner": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "reply_to_user": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1565693421, "post_id": 57476045, "comment_id": 101424143, "body": "Okay. Go it. Thanks. It helps. Edited the question to remove C. If you could write an answer with an example. It would be helpful."}, {"owner": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "reply_to_user": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1565694361, "post_id": 57476045, "comment_id": 101424687, "body": "I added C again. I&#39;d like a solution in C too."}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1565694428, "post_id": 57476045, "comment_id": 101424729, "body": "Good luck. May be there&#39;s some 3rd party library you can use in c."}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1565694467, "post_id": 57476045, "comment_id": 101424755, "body": "Why did you need to change the path? Windows is fine with&#39;/&#39;."}, {"owner": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "reply_to_user": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1565695305, "post_id": 57476045, "comment_id": 101425223, "body": "@stark I just checked in windows. It worked. I don&#39;t remember why I changed it."}], "answers": [{"tags": [], "owner": {"reputation": 91, "user_id": 5238399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcf94a2a59027aa0d67b43b345ca470a?s=128&d=identicon&r=PG&f=1", "display_name": "du4ko", "link": "https://stackoverflow.com/users/5238399/du4ko"}, "is_accepted": false, "score": 1, "last_activity_date": 1565696177, "creation_date": 1565696177, "answer_id": 57476946, "question_id": 57476045, "link": "https://stackoverflow.com/questions/57476045/what-is-the-equivalent-of-paths-getabc-def-jpg-to-get-os-agnostic-path-in-c/57476946#57476946", "title": "What is the equivalent of Paths.get(&quot;abc/def.jpg&quot;) to get OS agnostic path in C and C++?", "body": "<p>Not sure if you managed to find your solution , but you can change the path/string according to the OS with the predefined macros here is example:</p>\n\n<pre><code>    string getFileName(const string&amp; s) {\n\n   char sep = '/';\n\n#ifdef _WIN32\n   sep = '\\\\';\n#endif\n\n   size_t i = s.rfind(sep, s.length());\n   if (i != string::npos) {\n      return(s.substr(i+1, s.length() - i));\n   }\n\n   return(\"\");\n}\n</code></pre>\n\n<p>Here is a <a href=\"https://stackoverflow.com/questions/142508/how-do-i-check-os-with-a-preprocessor-directive\">link</a> with more information on predefined macros. </p>\n"}], "owner": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1565696177, "creation_date": 1565692842, "last_edit_date": 1565694338, "question_id": 57476045, "link": "https://stackoverflow.com/questions/57476045/what-is-the-equivalent-of-paths-getabc-def-jpg-to-get-os-agnostic-path-in-c", "title": "What is the equivalent of Paths.get(&quot;abc/def.jpg&quot;) to get OS agnostic path in C and C++?", "body": "<p>I'd like to write and reuse same code in both Linux and Windows, especially the path constants.</p>\n\n<pre><code>fopen(base+\"subfolder/abc.bin\",\"wb\")\n</code></pre>\n\n<p>The above code worked fine when I cross compiled for Windows in Linux.</p>\n\n<p>But, I had to change the code to <code>fopen(base+\"subfolder\\\\abc.bin\",\"wb\")</code> to compile it in windows directly.</p>\n\n<p>Now I have added many dependencies to the software which would require cross compilation if I cross compiled my software, which I don't wanna do, so, I use precompiled binaries in both Windows and Linux versions of the software.</p>\n\n<p>The issue now, I face is if I wanted to compile in Linux, I'd have to change the path which I don't want to do, as I'd have to maintain, two different branches of the software. Is there a way, akin to Java using <code>Paths.get(\"abcd/def/hij.bin\").toString()</code>. I'm not just asking for a system call, a custom function which identifies underlying OS and changes the path string accordingly, will do.</p>\n\n<p>I need both C and C++.</p>\n"}, {"tags": ["c", "printf", "character", "constants", "string-literals"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 6, "creation_date": 1565691903, "post_id": 57475754, "comment_id": 101423346, "body": "E.g. <code>&#39;odd&#39;</code> is not a string. It&#39;s a multi-<b><i>character</i></b> literal. <code>&quot;odd&quot;</code> is a string. C is not Python or Javascript, single quotes are for single characters, double quotes for strings."}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 4, "creation_date": 1565691999, "post_id": 57475754, "comment_id": 101423390, "body": "<code>num = (a % 2) ? &#39;odd&#39; : &#39;even&#39;;</code> - you&#39;re compiler <i>didn&#39;t</i> warn you about multi-character literals? That should be <code>num = (a % 2) ? &quot;odd&quot; : &quot;even&quot;;</code> . Further, <code>num</code> <i>should</i> be <code>const char*</code> , and the final print should be. <code>printf(&quot;Its %s number&quot;, num);</code> - I suggest you rewind a few chapters in whatever text you&#39;re studying."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1565693654, "post_id": 57475754, "comment_id": 101424286, "body": "Moreover the standard definition of <code>main</code> here should be <code>int main(void)</code>, and, function <code>getch()</code> is not a standard C function in <code>stdio.h</code>. It&#39;s a non-standard library function possibly in Windows <code>conio.h</code> or old Turbo C. Please pay attention to compiler warnings."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1565693910, "post_id": 57475754, "comment_id": 101424424, "body": "You&#39;re supposed to get <i>diagnostics messages</i> from your compiler for this."}], "answers": [{"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 1, "last_activity_date": 1565694691, "creation_date": 1565694691, "answer_id": 57476543, "question_id": 57475754, "link": "https://stackoverflow.com/questions/57475754/string-printed-in-reverse-without-reversing-in-the-code/57476543#57476543", "title": "string printed in reverse without reversing in the code", "body": "<p><code>'odd'</code> and <code>'even'</code> are integer character constants.</p>\n\n<p>According to the C Standard (6.4.4.4 Character constants)</p>\n\n<blockquote>\n  <p>10 An integer character constant has type int. The value of an integer\n  character constant containing a single character that maps to a\n  single-byte execution character is the numerical value of the\n  representation of the mapped character interpreted as an integer. \n  <strong>The value of an integer character constant containing more than one character (e.g.,\n  'ab'), or containing a character or escape sequence\n  that does not map to a single-byte execution character, is\n  implementation-defined.</strong></p>\n</blockquote>\n\n<p>So in this call</p>\n\n<pre><code>printf(\"Its %s number\", &amp;num);\n</code></pre>\n\n<p>you are trying to output the address of the variable <code>num</code> as an address of a string that is you are trying to output a string but <code>num</code> does not point to a string.</p>\n\n<p>You have to use string literals instead of the character constants.</p>\n\n<p>What you mean is the following</p>\n\n<pre><code>    num = (a % 2) ? \"odd\" : \"even\";\n\n    printf(\"Its %s number\", num);\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 3419786, "user_type": "registered", "profile_image": "https://graph.facebook.com/1015808734/picture?type=large", "display_name": "user3419786", "link": "https://stackoverflow.com/users/3419786/user3419786"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1565694729, "creation_date": 1565691727, "last_edit_date": 1565694729, "question_id": 57475754, "link": "https://stackoverflow.com/questions/57475754/string-printed-in-reverse-without-reversing-in-the-code", "title": "string printed in reverse without reversing in the code", "body": "<p>I tried to print the string by declaring it via ternary operator. Instead of any error it prints string in reverse.</p>\n\n<p>Can someone explain please?</p>\n\n<p>I was expecting string to be printed as <code>even</code> or <code>odd</code> based on the input.</p>\n\n<pre><code> #include&lt;stdio.h&gt;\n\n    void main()\n    {\n        int a;\n        char *num;\n\n        printf(\"Enter a number: \");\n        scanf(\"%d\", &amp;a);\n\n        num = (a % 2) ? 'odd' : 'even';\n\n        printf(\"Its %s number\", &amp;num);\n\n        getch();\n    }\n</code></pre>\n"}, {"tags": ["html", "c", "curl", "post"], "comments": [{"owner": {"reputation": 1, "user_id": 5800112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/771bc0af8c571feef4bc2723aad848a9?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Vickers", "link": "https://stackoverflow.com/users/5800112/peter-vickers"}, "reply_to_user": {"reputation": 2839, "user_id": 3091398, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0b4b5c88fcdd9c2c7b65d448106125a8?s=128&d=identicon&r=PG&f=1", "display_name": "CodeIt", "link": "https://stackoverflow.com/users/3091398/codeit"}, "edited": false, "score": 0, "creation_date": 1565689823, "post_id": 57475099, "comment_id": 101422247, "body": "This causes the server to reply immediately with the error shown above"}, {"owner": {"reputation": 2839, "user_id": 3091398, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0b4b5c88fcdd9c2c7b65d448106125a8?s=128&d=identicon&r=PG&f=1", "display_name": "CodeIt", "link": "https://stackoverflow.com/users/3091398/codeit"}, "edited": false, "score": 0, "creation_date": 1565689910, "post_id": 57475099, "comment_id": 101422296, "body": "Did you try running the c program ? Is it working properly ? Are you trying to translate this <a href=\"https://raw.githubusercontent.com/dystophia/VeoCL/master/client.c\" rel=\"nofollow noreferrer\">code</a> ?"}, {"owner": {"reputation": 1, "user_id": 5800112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/771bc0af8c571feef4bc2723aad848a9?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Vickers", "link": "https://stackoverflow.com/users/5800112/peter-vickers"}, "reply_to_user": {"reputation": 2839, "user_id": 3091398, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0b4b5c88fcdd9c2c7b65d448106125a8?s=128&d=identicon&r=PG&f=1", "display_name": "CodeIt", "link": "https://stackoverflow.com/users/3091398/codeit"}, "edited": false, "score": 0, "creation_date": 1565690101, "post_id": 57475099, "comment_id": 101422379, "body": "Yes, it gets data back form the server and proceeds to use it elsewhere in the program"}, {"owner": {"reputation": 2839, "user_id": 3091398, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0b4b5c88fcdd9c2c7b65d448106125a8?s=128&d=identicon&r=PG&f=1", "display_name": "CodeIt", "link": "https://stackoverflow.com/users/3091398/codeit"}, "edited": false, "score": 0, "creation_date": 1565690641, "post_id": 57475099, "comment_id": 101422649, "body": "You are sending <code>{&quot;mining_data&quot;:&quot;BONJmlU2FUqYgUY60LTIumsYrW&#47;c6MHte64y5KlDzXk5&zwnj;&#8203;toyEMaBzWm8dHmdMfJmX&zwnj;&#8203;nqvbYmlwim0hiFmYCCn3&zwnj;&#8203;Rm0=&quot;}</code> instead of <code>&quot;[&#39;mining_data&#39;, &#39;BONJmlU2FUqYgUY60LTIumsYrW&#47;c6MHte64y5KlDzXk5toyEMaBzWm8dHmd&zwnj;&#8203;MfJmXnqvbYmlwim0hiFm&zwnj;&#8203;YCCn3Rm0=&#39;]&quot;</code>"}, {"owner": {"reputation": 1, "user_id": 5800112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/771bc0af8c571feef4bc2723aad848a9?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Vickers", "link": "https://stackoverflow.com/users/5800112/peter-vickers"}, "reply_to_user": {"reputation": 2839, "user_id": 3091398, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0b4b5c88fcdd9c2c7b65d448106125a8?s=128&d=identicon&r=PG&f=1", "display_name": "CodeIt", "link": "https://stackoverflow.com/users/3091398/codeit"}, "edited": false, "score": 0, "creation_date": 1565690861, "post_id": 57475099, "comment_id": 101422783, "body": "Changing that moves be from &quot;Internal Sever Error&quot; to &quot;Bad Request&quot;"}, {"owner": {"reputation": 2839, "user_id": 3091398, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0b4b5c88fcdd9c2c7b65d448106125a8?s=128&d=identicon&r=PG&f=1", "display_name": "CodeIt", "link": "https://stackoverflow.com/users/3091398/codeit"}, "edited": false, "score": 0, "creation_date": 1565690947, "post_id": 57475099, "comment_id": 101422842, "body": "As per your buffer it should be <code>&quot;[&#39;mining_data&#39;, &#39;BONJmlU2FUqYgUY60LTIumsYrW&#47;c6MHte64y5KlDzXk5toyEMaBzWm8dHmd&zwnj;&#8203;MfJmXnqvbYmlwim0hiFm&zwnj;&#8203;YCCn3Rm0=&#39;]&quot;</code>. You may also try removing that content-length now."}, {"owner": {"reputation": 2839, "user_id": 3091398, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0b4b5c88fcdd9c2c7b65d448106125a8?s=128&d=identicon&r=PG&f=1", "display_name": "CodeIt", "link": "https://stackoverflow.com/users/3091398/codeit"}, "edited": false, "score": 0, "creation_date": 1565693102, "post_id": 57475099, "comment_id": 101423957, "body": "Is it working now ?"}], "owner": {"reputation": 1, "user_id": 5800112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/771bc0af8c571feef4bc2723aad848a9?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Vickers", "link": "https://stackoverflow.com/users/5800112/peter-vickers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565689398, "creation_date": 1565689398, "question_id": 57475099, "link": "https://stackoverflow.com/questions/57475099/translating-c-post-request-to-curl", "title": "Translating C POST request to Curl", "body": "<p>I'm trying to translate some c code to python. I need to understand the structure of a POST request the original c code makes. I would like to tranlate the following C code to a cURL command:</p>\n\n<pre><code>void nonblock(int sock) {\n    int flags = fcntl(sock, F_GETFL, 0);\n    flags = flags | O_NONBLOCK;\n    fcntl(sock, F_SETFL, flags);\n}\n\nint pool() {\n        int sd = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);\n\n    nonblock(sd);\n\n    struct sockaddr_in servaddr;\n\n        memset(&amp;servaddr, 0, sizeof(servaddr));\n\n        servaddr.sin_family = AF_INET;\n        servaddr.sin_port = htons(poolport);\n    memcpy(&amp;servaddr.sin_addr, poolip, sizeof(poolip));\n\n    pollcount++;\n\n        connect(sd, (struct sockaddr *)&amp;servaddr, sizeof(servaddr));\n\n    char buffer[1000];\n\n\n\n    sprintf(buffer, \"POST %s HTTP/1.1\\r\\ncontent-type: application/octet-stream\\r\\ncontent-length: %i\\r\\nhost: %s:%i\\r\\nconnection: close\\r\\n\\r\\n[\\\"mining_data\\\", \\\"%s\\\"]\", \n        workPath,\n        (19 + (int)strlen(address)),\n        hostname,\n        poolport,\n        address\n    );\n\n    printf(\"1_____\\n%s\\n_____\\n\", \n    struct timeval tv;\n    tv.tv_sec = 4;\n    tv.tv_usec = 0;\n\n    fd_set my;\n    FD_ZERO(&amp;my);\n    FD_SET(sd, &amp;my);\n    select(sd+1, NULL, &amp;my, NULL, &amp;tv);\n\n    if(!FD_ISSET(sd, &amp;my)) {\n        close(sd);\n        usleep(500000);\n        return -1;\n    }\n\n    send(sd, buffer, strlen(buffer), MSG_NOSIGNAL);\n\n    tv.tv_sec = 4;\n    tv.tv_usec = 0;\n\n    FD_ZERO(&amp;my);\n    FD_SET(sd, &amp;my);\n\n    select(sd+1, &amp;my, NULL, NULL, &amp;tv);\n\n\n    if(!FD_ISSET(sd, &amp;my)) {\n        close(sd);\n        usleep(500000);\n        return -1;\n    }\n\n\n    int bytes = read(sd, buffer, 1000);\n        // I want what's in buffer here\n\n        close(sd);\n        ...\n}\n\n</code></pre>\n\n<p>Buffer is:</p>\n\n<pre><code>POST /work HTTP/1.1\ncontent-type: application/octet-stream\ncontent-length: 107\nhost: veopool.pw:8880\nconnection: close\n\n[\"mining_data\", \"BONJmlU2FUqYgUY60LTIumsYrW/c6MHte64y5KlDzXk5toyEMaBzWm8dHmdMfJmXnqvbYmlwim0hiFmYCCn3Rm0=\"]\n</code></pre>\n\n<p>I have tried requesting this same data in cURL as</p>\n\n<pre><code>curl -v -d '{\"mining_data\":\"BONJmlU2FUqYgUY60LTIumsYrW/c6MHte64y5KlDzXk5toyEMaBzWm8dHmdMfJmXnqvbYmlwim0hiFmYCCn3Rm0=\"}' -H \"content-length: 107\" -H \"content-type: application/octet-stream\" -H \"connection: close\" -X POST http://veopool.pw:8880/work\n</code></pre>\n\n<p>After a few seconds I get:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;meta charset=\"utf-8\"&gt;\n&lt;title&gt;Error&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;pre&gt;Internal Server Error&lt;/pre&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n* Closing connection 0\n</code></pre>\n\n<p>Can anyone show me where I'm messing up?</p>\n"}, {"tags": ["c", "eclipse"], "comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1565687636, "post_id": 57474379, "comment_id": 101421123, "body": "What you&#39;ll likely have to do is to add <code>-I</code> option (assuming gcc) with the include path, somewhere in a hard to find compiler option setting. Since Eclipse is really nothing but a mysterious linker error generator, I&#39;d recommend using an IDE instead, so you can focus on debugging your code instead of debugging the toolchain."}, {"owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "edited": false, "score": 1, "creation_date": 1565687650, "post_id": 57474379, "comment_id": 101421134, "body": "Apparently your code looks ok. Just one thing: <a href=\"http://port70.net/~nsz/c/c11/n1570.html#7.1.3\" rel=\"nofollow noreferrer\">using <code>__</code> at the start of any identifier is reserved for any use</a>. Maybe try <code>#ifndef H__HEADER_</code>?"}, {"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565688262, "post_id": 57474379, "comment_id": 101421431, "body": "@Lundin Wouldn&#39;t you classify Eclipse as an IDE? Or did you mean another IDE?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 2, "creation_date": 1565689112, "post_id": 57474379, "comment_id": 101421898, "body": "@KamiKaze Since Eclipse cannot be used for any form of productive development, no I wouldn&#39;t classify it as a Development Environment."}, {"owner": {"reputation": 63, "user_id": 6734619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b564a2c999fd9d73083c0765a8d69e5?s=128&d=identicon&r=PG&f=1", "display_name": "l.voe", "link": "https://stackoverflow.com/users/6734619/l-voe"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565689237, "post_id": 57474379, "comment_id": 101421965, "body": "@Lundin As I said, I verified that the directory is in the include path. And I also checked if it is in the (indeed hard to find) compiler option setting. Also the compiler only seems to have a problem resolving the defined parameters. When I change the number of arguments in the function declaration, I get an error that there are too few arguments to the respective function in the C file. So I assume that the header file is included (more or less) properly."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565689492, "post_id": 57474379, "comment_id": 101422087, "body": "You&#39;ll get linker errors like these all day, every day - it is perfectly normal with Eclipse. Takes roughly a week to resolve each one, then you can move on to the next. The number of possible Eclipse bugs is infinite. Could be <a href=\"https://stackoverflow.com/questions/27905795/eclipse-cant-find-header-filers-even-though-include-paths-have-been-set\">this</a>, could be anything. My best advice is to get a better IDE."}, {"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565689613, "post_id": 57474379, "comment_id": 101422134, "body": "@Lundin while we are here in the comments, do you have suggestions for a (free) IDE that would also support/can be enhanced to support unit testing? Free would be nice but not mandatory."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1565695756, "post_id": 57474379, "comment_id": 101425447, "body": "Is there another header with same name around that could be picked instead of your desired header?"}], "answers": [{"tags": [], "owner": {"reputation": 63, "user_id": 6734619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b564a2c999fd9d73083c0765a8d69e5?s=128&d=identicon&r=PG&f=1", "display_name": "l.voe", "link": "https://stackoverflow.com/users/6734619/l-voe"}, "is_accepted": true, "score": 1, "last_activity_date": 1565694013, "creation_date": 1565694013, "answer_id": 57476370, "question_id": 57474379, "link": "https://stackoverflow.com/questions/57474379/eclipse-c-constants-defined-in-header-could-not-be-resolved/57476370#57476370", "title": "Eclipse C constants defined in header could not be resolved", "body": "<p>Right Click on the Project <code>Index &gt; Freshen All Files</code> and then <code>Index &gt; Rebuild</code> fixed the problem</p>\n"}], "owner": {"reputation": 63, "user_id": 6734619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b564a2c999fd9d73083c0765a8d69e5?s=128&d=identicon&r=PG&f=1", "display_name": "l.voe", "link": "https://stackoverflow.com/users/6734619/l-voe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 57476370, "answer_count": 1, "score": 0, "last_activity_date": 1565694013, "creation_date": 1565686869, "last_edit_date": 1565687403, "question_id": 57474379, "link": "https://stackoverflow.com/questions/57474379/eclipse-c-constants-defined-in-header-could-not-be-resolved", "title": "Eclipse C constants defined in header could not be resolved", "body": "<p>I'm writing a C program where I use a header to declare some functions and define several constants. When I use these constants in my code, I get the error <code>Symbol 'FOO' could not be resolved</code>. I have no problems with the declared functions.</p>\n\n<p>I am using Eclipse Neon. I have already verified that the path to the directory containing the header files is added to the Include Path. And I have also restarted Eclipse.</p>\n\n<p>header.h</p>\n\n<pre><code>#ifndef __header_h_\n#define __header_h_\n\n#define FOO 0x00\n#define BAR 0x01\n\nvoid do_stuff(int x);\n\n#endif\n</code></pre>\n\n<p>main.c</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include \"header.h\"\n\nint main() {\n    do_stuff(FOO);\n    return 0;\n}\n</code></pre>\n\n<blockquote>\n  <p>ERROR: Symbol 'FOO' could not be resolved</p>\n</blockquote>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["c", "linux", "multithreading", "pthreads"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1565684524, "post_id": 57473781, "comment_id": 101419713, "body": "Time to refresh <a href=\"http://stackoverflow.com/help\">the help pages</a>, especially <a href=\"http://stackoverflow.com/help/on-topic\">&quot;What topics can I ask about here?&quot;</a> and <a href=\"http://stackoverflow.com/help/dont-ask\">&quot;What types of questions should I avoid asking?&quot;</a>. Also <a href=\"http://stackoverflow.com/tour\">take the tour</a> and <a href=\"http://stackoverflow.com/help/how-to-ask\">read about how to ask good questions</a> and <a href=\"https://codeblog.jonskeet.uk/2012/11/24/stack-overflow-question-checklist/\" rel=\"nofollow noreferrer\">this question checklist</a>. Lastly don&#39;t forget how to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1565696176, "post_id": 57473781, "comment_id": 101425672, "body": "@Someprogrammerdude: Could you explain your comment? This question appears to be reasonable. It is a programming question. Its question is clear; it asks about separating system-imposed file descriptor limits between threads. No reproducible example is needed because it is not asking what is wrong with existing code."}], "answers": [{"comments": [{"owner": {"reputation": 215710, "user_id": 134633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6be45ddcfd038ba5e1e5fca319c7fa?s=128&d=identicon&r=PG", "display_name": "caf", "link": "https://stackoverflow.com/users/134633/caf"}, "edited": false, "score": 1, "creation_date": 1565755614, "post_id": 57473854, "comment_id": 101446617, "body": "Note that after unsharing the file descriptor table, you&#39;ll have to close all the descriptors in the thread that it doesn&#39;t need access to, in order to free up those descriptors."}], "tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": true, "score": 4, "last_activity_date": 1565696341, "last_edit_date": 1565696341, "creation_date": 1565684684, "answer_id": 57473854, "question_id": 57473781, "link": "https://stackoverflow.com/questions/57473781/can-i-make-the-file-descriptor-limit-a-per-thread-limit/57473854#57473854", "title": "Can I make the file descriptor limit a per-thread limit?", "body": "<p>On Linux, </p>\n\n<pre><code>unshare(CLONE_FILES);\n</code></pre>\n\n<p>(if successful) will give the current thread its own filedescriptor table.</p>\n\n<p>It should be usable from an already- spawned kernel-backed (all Linux pthreads implementations I know of) pthread.</p>\n\n<p>There doesn't appear to be even a nonportable pthread attribute that you could set this up with, but you can use the above approach to wrap <code>pthread_create</code>, adding this capability.</p>\n\n<p>If you're doing your own threading on Linux, you can pass the <code>CLONE_FILES</code> flag directly to <code>clone</code>. Otherwise you'll need the to make your <code>wrapped_pthread_create</code> wait until the child has made the <code>unshare</code> call (and cancel and reap the thread if the call failed).</p>\n"}], "owner": {"reputation": 455, "user_id": 4899025, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGgvb.jpg?s=128&g=1", "display_name": "Ajith C Narayanan", "link": "https://stackoverflow.com/users/4899025/ajith-c-narayanan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 2, "accepted_answer_id": 57473854, "answer_count": 1, "score": 1, "last_activity_date": 1565706745, "creation_date": 1565684423, "last_edit_date": 1565704810, "question_id": 57473781, "link": "https://stackoverflow.com/questions/57473781/can-i-make-the-file-descriptor-limit-a-per-thread-limit", "title": "Can I make the file descriptor limit a per-thread limit?", "body": "<p>I am working on a Centos-6 x86_64 machine. By default, if I start a process, it can open 1024 files (including the standard in/out/error streams) and I am able to extend that limit using <code>setrlimit()</code> APIs.</p>\n\n<p>My problem is that if I start a thread within the process, it shares this limit. For example, assume I am running a parent process which opens 1024 descriptors, and then if I create one thread using <code>pthread_create()</code>, it can't open a single file because its parent already opened 1024 descriptors and consumed the full limit.</p>\n\n<p>I want to make the child thread (not child process) able to open 1024 files like its parent. I know that extending parent's file descriptor limit to 2048 will allow the child to open 1024 more files.  But I want to make the parent and child have individual limits, not a shared limit.</p>\n\n<p>I am expecting some attributes in <code>pthread_attr_t</code> that can be applicable for the child thread to have an individual file table.</p>\n"}, {"tags": ["c", "bluetooth-lowenergy", "contiki"], "comments": [{"owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 0, "creation_date": 1570602013, "post_id": 57473532, "comment_id": 102958909, "body": "What do you like to know, 1. where the header files are, or 2. how the declared methods can be used? The former doesn&#39;t help you with the latter. Do you understand the concept of compiling (usage of header files) and linking (usage of libraries)?"}, {"owner": {"reputation": 159, "user_id": 10957632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DLEuW.jpg?s=128&g=1", "display_name": "SUBHANSHU SAHU", "link": "https://stackoverflow.com/users/10957632/subhanshu-sahu"}, "reply_to_user": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 0, "creation_date": 1570614019, "post_id": 57473532, "comment_id": 102965088, "body": "@thebusybee Thanks for replying! No I am not clear with the concept of compiling (usage of header files) and linking (usage of libraries)."}], "answers": [{"tags": [], "owner": {"reputation": 838, "user_id": 8203386, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-jh5sbzAGKxU/AAAAAAAAAAI/AAAAAAAAAoY/D9kXnHjYE0M/photo.jpg?sz=128", "display_name": "Buddhima Udaranga", "link": "https://stackoverflow.com/users/8203386/buddhima-udaranga"}, "is_accepted": false, "score": 0, "last_activity_date": 1570619674, "last_edit_date": 1570619674, "creation_date": 1565684628, "answer_id": 57473838, "question_id": 57473532, "link": "https://stackoverflow.com/questions/57473532/where-are-headers-file-present-in-contiki/57473838#57473838", "title": "Where are headers file present in Contiki?", "body": "<p>Please find the answer below.</p>\n\n<p><a href=\"https://github.com/contiki-os/contiki/tree/master/core\" rel=\"nofollow noreferrer\">https://github.com/contiki-os/contiki/tree/master/core</a></p>\n\n<pre><code>\"contiki.h\"\n\"contiki-lib.h\"\n\"contiki-net.h\"\n</code></pre>\n\n<p><a href=\"https://github.com/contiki-os/contiki/blob/master/core/net/ip/uip-debug.h\" rel=\"nofollow noreferrer\">https://github.com/contiki-os/contiki/blob/master/core/net/ip/uip-debug.h</a></p>\n\n<p>You can find the header files in the Contiki in the same respective locations.</p>\n"}, {"tags": [], "owner": {"reputation": 120, "user_id": 5895576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8424bb126e2462976e8a11121aa7288?s=128&d=identicon&r=PG&f=1", "display_name": "av92", "link": "https://stackoverflow.com/users/5895576/av92"}, "is_accepted": false, "score": 0, "last_activity_date": 1570592968, "creation_date": 1570592968, "answer_id": 58296802, "question_id": 57473532, "link": "https://stackoverflow.com/questions/57473532/where-are-headers-file-present-in-contiki/58296802#58296802", "title": "Where are headers file present in Contiki?", "body": "<p>contiki.h, contiki-lib.h, contiki-net.h: These files are in contiki/core/ folder.</p>\n\n<p>uip-debug.h: contiki/core/net/ip</p>\n\n<p>uiplib.h: contiki/core/net/ip</p>\n\n<p>uip-icmp6.h: contiki/core/net/ipv6/</p>\n"}, {"tags": [], "owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "is_accepted": true, "score": 1, "last_activity_date": 1570619180, "last_edit_date": 1570619180, "creation_date": 1570616366, "answer_id": 58301966, "question_id": 57473532, "link": "https://stackoverflow.com/questions/57473532/where-are-headers-file-present-in-contiki/58301966#58301966", "title": "Where are headers file present in Contiki?", "body": "<p>So you need to understand how an application is build.</p>\n\n<ol>\n<li><p>All executable code is defined in C files and translated into machine code. Having said this, there might be modules written in other languages, the C runtime most probably has some assembler sources. We can call these \"translation units\" because they are each translated separately on their own.</p></li>\n<li><p>The header files just contain declarations of objects implemented in those translation units. Header files can combine declarations of several units or deliberately leave out some declarations.</p></li>\n<li><p>If you compile one of your own sources which includes a header file there will be no code of the referenced objects in your resulting object file.</p></li>\n<li><p>At the link stage the linker combines all object modules of your program, resolving references between all of them. That means if you have a call in one unit to a method in another module, that call will receive the correct address.</p></li>\n<li><p>There are still unsatisfied references left, in particular those to library methods that were declared in those header files. The linker searches through the default and the explicitely given libraries to look for the methods. If it finds one it will get added to the code and the call will receive its address.</p></li>\n</ol>\n\n<p>This is it really very short. Please search for a broader description in the web, you'll find a lot of them.</p>\n\n<hr>\n\n<p><strong>To answer your explicit question: \"How can the example code use the methods present in files at different locations?\"</strong></p>\n\n<p>The linker adds the machine code of these methods to the machine code of your modules. The location of their source code is irrelevant. The linker knows the location of the standard libraries. If you use additional libraries, add them (and their path, if needed) to the command line.</p>\n\n<p>If you have any further questions, edit your question, please.</p>\n"}], "owner": {"reputation": 159, "user_id": 10957632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DLEuW.jpg?s=128&g=1", "display_name": "SUBHANSHU SAHU", "link": "https://stackoverflow.com/users/10957632/subhanshu-sahu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 312, "favorite_count": 0, "accepted_answer_id": 58301966, "answer_count": 3, "score": -1, "last_activity_date": 1570619674, "creation_date": 1565683373, "question_id": 57473532, "link": "https://stackoverflow.com/questions/57473532/where-are-headers-file-present-in-contiki", "title": "Where are headers file present in Contiki?", "body": "<p>I am trying to understand the IPv6-over-BLE UDP-client demo example which is present in <code>examples/cc26xx/cc26xx-ble-client-demo</code>, the code has following header files:</p>\n\n<pre><code>#include \"contiki.h\"\n#include \"contiki-lib.h\"\n#include \"contiki-net.h\"\n\n#define DEBUG DEBUG_FULL\n#include \"net/ip/uip-debug.h\"\n#include \"net/ip/uiplib.h\"\n#include \"net/ipv6/uip-icmp6.h\"\n</code></pre>\n\n<p>I just want to know the locations of these header files in the Contiki file system as the code for the main implementation of the BLE connection is under <code>cpu/cc26xx-cc13xx/rf-core/*.[ch]</code> and <code>cpu/cc26xx-cc13xx/net/*.[ch]</code>. I want to understand how the example code can use the methods present in files at different locations.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 712, "user_id": 10168590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5484b587c0114f37f8323164e249256?s=128&d=identicon&r=PG&f=1", "display_name": "Suven Pandey", "link": "https://stackoverflow.com/users/10168590/suven-pandey"}, "edited": false, "score": 0, "creation_date": 1565682774, "post_id": 57473349, "comment_id": 101418896, "body": "So you&#39;re saying you want to declare function parameter as <code>short* array</code> but use <code>array[m][n]</code>&#39; in function definition?"}, {"owner": {"reputation": 335, "user_id": 9698161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2881d4f88da4ddcd701eccf723006f?s=128&d=identicon&r=PG&f=1", "display_name": "J.Panek", "link": "https://stackoverflow.com/users/9698161/j-panek"}, "edited": false, "score": 0, "creation_date": 1565682818, "post_id": 57473349, "comment_id": 101418920, "body": "Can you show an example for the input for your function?"}, {"owner": {"reputation": 335, "user_id": 9698161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2881d4f88da4ddcd701eccf723006f?s=128&d=identicon&r=PG&f=1", "display_name": "J.Panek", "link": "https://stackoverflow.com/users/9698161/j-panek"}, "edited": false, "score": 0, "creation_date": 1565683507, "post_id": 57473349, "comment_id": 101419217, "body": "If I understand correctly you could use memcpy to do the job you want"}], "answers": [{"tags": [], "owner": {"reputation": 9554, "user_id": 3306465, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MAduK.png?s=128&g=1", "display_name": "Igal S.", "link": "https://stackoverflow.com/users/3306465/igal-s"}, "is_accepted": false, "score": -2, "last_activity_date": 1565683590, "creation_date": 1565683590, "answer_id": 57473590, "question_id": 57473349, "link": "https://stackoverflow.com/questions/57473349/c-howto-convert-a-pointer-to-access-it-as-a-multidimensional-array/57473590#57473590", "title": "C: howto convert a pointer to access it as a multidimensional array", "body": "<p>Not the most efficient way, but you can create a two dimensions array inside your function and copy the original array to it:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n\nint Filter(short* array, short nNumRow, short nNumCol) {\n    short arr[nNumRow][nNumCol];\n    memcpy(arr, array, nNumRow * nNumCol * sizeof(short));\n    for (int i = 0; i &lt; nNumRow; i++) {\n        printf(\"| \");\n        for (int j = 0; j &lt; nNumCol; j++) {\n            printf(\"%d \", arr[i][j]);\n        }\n        printf(\"| \\n\");\n    }\n    return 0;\n\n}\n\nint main(void) {\n    short arr[] = {1, 2, 3, 4, 5, 6 ,7, 8};\n    Filter(arr, 2, 4);\n    printf(\"---\\n\");\n    Filter(arr, 4, 2);\n    return 0;\n}\n</code></pre>\n\n<p>See it running here: <a href=\"https://ideone.com/58KhYj\" rel=\"nofollow noreferrer\">https://ideone.com/58KhYj</a></p>\n"}, {"comments": [{"owner": {"reputation": 179, "user_id": 3392481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00f05a66e595588f70451cd51fabfa72?s=128&d=identicon&r=PG&f=1", "display_name": "Arno", "link": "https://stackoverflow.com/users/3392481/arno"}, "edited": false, "score": 0, "creation_date": 1565684940, "post_id": 57473597, "comment_id": 101419913, "body": "I agree your first approach is best and according to the rules but not that has been requested for. The array is a result from some existing code I can&#39;t change. The issue with the second example is  you really have to spend memory for the array2D, haven&#39;t you?"}, {"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "reply_to_user": {"reputation": 179, "user_id": 3392481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00f05a66e595588f70451cd51fabfa72?s=128&d=identicon&r=PG&f=1", "display_name": "Arno", "link": "https://stackoverflow.com/users/3392481/arno"}, "edited": false, "score": 0, "creation_date": 1565686742, "post_id": 57473597, "comment_id": 101420725, "body": "@Arno <code>array2D</code> is just a pointer, so it will only require memory of typical pointer. In this case it probably fits in CPU register."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 179, "user_id": 3392481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00f05a66e595588f70451cd51fabfa72?s=128&d=identicon&r=PG&f=1", "display_name": "Arno", "link": "https://stackoverflow.com/users/3392481/arno"}, "edited": false, "score": 0, "creation_date": 1565687100, "post_id": 57473597, "comment_id": 101420880, "body": "@Arno No and you can&#39;t pass arrays by value in C. In the first example, <code>short array[nNumRow][nNumCol]</code> &quot;decays&quot; into an array pointer between the lines. In the second example, <code>short(*array2D)[nNumCol];</code> is also just an array pointer."}, {"owner": {"reputation": 179, "user_id": 3392481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00f05a66e595588f70451cd51fabfa72?s=128&d=identicon&r=PG&f=1", "display_name": "Arno", "link": "https://stackoverflow.com/users/3392481/arno"}, "edited": false, "score": 0, "creation_date": 1565697734, "post_id": 57473597, "comment_id": 101426448, "body": "You are both right, didn&#39;t read carefully enough. Thanks! Think I wouldn&#39;t get managed this &quot;dirty&quot; pointer conversion on my own."}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 8, "last_activity_date": 1565692900, "last_edit_date": 1565692900, "creation_date": 1565683629, "answer_id": 57473597, "question_id": 57473349, "link": "https://stackoverflow.com/questions/57473349/c-howto-convert-a-pointer-to-access-it-as-a-multidimensional-array/57473597#57473597", "title": "C: howto convert a pointer to access it as a multidimensional array", "body": "<blockquote>\n  <p>How can I handle that problem without changing function parameter list?</p>\n</blockquote>\n\n<p>If you can't do that, then you are stuck with the \"mangled array\" <code>array[y*nNumCol + x]</code> notation (which is old style but otherwise ok).</p>\n\n<p>The best and correct solution is to change the function to this:</p>\n\n<pre><code>int Filter (short nNumRow, short nNumCol, short array[nNumRow][nNumCol])\n{\n   ...\n   array[x][y] = something;\n}\n</code></pre>\n\n<hr>\n\n<p>The last resort, which I would not recommend unless you are maintaining some old crap that can't be changed, is a dirty pointer conversion inside the function. Writing such code requires that you to know exactly what you are doing, because if the types of the actual data or the alignment mismatch, you will get very strange bugs. The below code works and is safe as far as the C language is concerned, but it isn't pretty:</p>\n\n<pre><code>// BAD CODE, avoid this solution\n\n#include &lt;stdio.h&gt;\n\nint Filter (short* array, short nNumRow, short nNumCol)\n{\n  short(*array2D)[nNumCol];            // pointer to array of type short[nNumCol]\n  array2D = (short(*)[nNumCol])array;  // dirty pointer conversion\n\n  for(int i=0; i&lt;nNumRow; i++)\n  {\n    for(int j=0; j&lt;nNumCol; j++)\n    {\n      printf(\"%d \", array2D[i][j]);\n    }\n    printf(\"\\n\");\n  }\n\n  return 0;\n}\n\nint main (void) \n{\n  short array[2][2] = { {1,2}, {3,4} };\n\n  Filter((void*)array, 2, 2);\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565692739, "post_id": 57475137, "comment_id": 101423762, "body": "&quot;Otherwise, you will have to define the pointer-type dynamically at run-time, which is somewhere between difficult and impossible&quot;. Eh, it&#39;s not really that hard. Given the array <code>int array[x][y]</code>, a pointer to such an array is <code>int (*ptr)[x][y]</code>. Though for convenience when accessing, you&#39;d drop the inner dimension: <code>int (*ptr)[y]</code>. And that&#39;s it."}, {"owner": {"reputation": 1780, "user_id": 10988580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9885afb3fe782ac4c8e89a3b5904b8f6?s=128&d=identicon&r=PG&f=1", "display_name": "virolino", "link": "https://stackoverflow.com/users/10988580/virolino"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565694512, "post_id": 57475137, "comment_id": 101424787, "body": "@Lundin: That is perfectly fine if the array has a size known at design time. I remember I tried defining arrays with sizes known only during runtime (i.e. variable / random x and y), and the compiler rejected my attempt."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565694813, "post_id": 57475137, "comment_id": 101424959, "body": "Sorry, but your C knowledge is 20 years outdated. The language was changed in the year 1999. Time to study the C99 version and variable-length arrays."}, {"owner": {"reputation": 1780, "user_id": 10988580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9885afb3fe782ac4c8e89a3b5904b8f6?s=128&d=identicon&r=PG&f=1", "display_name": "virolino", "link": "https://stackoverflow.com/users/10988580/virolino"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565694960, "post_id": 57475137, "comment_id": 101425035, "body": "Also sorry, but it is what is used in the automotive industry, to make sure that the brakes and other stuff always work as expected. OTOH, good point that I should get acquainted with the news :D Tnx for the heads up."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565695147, "post_id": 57475137, "comment_id": 101425149, "body": "No, the automotive industry mainly uses C99 or C11 under MISRA-C:2012. They trailed behind and remained reluctant to use C99 until somewhere around 2010, as did I."}, {"owner": {"reputation": 1780, "user_id": 10988580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9885afb3fe782ac4c8e89a3b5904b8f6?s=128&d=identicon&r=PG&f=1", "display_name": "virolino", "link": "https://stackoverflow.com/users/10988580/virolino"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565695818, "post_id": 57475137, "comment_id": 101425473, "body": "I know about the new MISRA, but it was still not widely adopted the last time I checked. Maybe things have changed &quot;recently&quot;, I will not fight you on this."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565696458, "post_id": 57475137, "comment_id": 101425834, "body": "MISRA-C is not only widely adopted in all automotive firmware, it is pretty much mandatory nowadays, since you can&#39;t pass ISO 26262 (&quot;ASIL&quot;) qualification without using a safe subset of the programming language. MISRA has been industry standard in automotive for ages - it started there, but is now de facto standard for pretty much all embedded systems. The 2012 version is much better than the 2004 one, in almost every aspect."}, {"owner": {"reputation": 1780, "user_id": 10988580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9885afb3fe782ac4c8e89a3b5904b8f6?s=128&d=identicon&r=PG&f=1", "display_name": "virolino", "link": "https://stackoverflow.com/users/10988580/virolino"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565696963, "post_id": 57475137, "comment_id": 101426053, "body": "MISRA as a general concept is adopted for ages as you say, of course. I used it (older versions) for almost half of my life. However, I do not have recent information about the adoption of MISRA 2012, so I claim nothing about it."}], "tags": [], "owner": {"reputation": 1780, "user_id": 10988580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9885afb3fe782ac4c8e89a3b5904b8f6?s=128&d=identicon&r=PG&f=1", "display_name": "virolino", "link": "https://stackoverflow.com/users/10988580/virolino"}, "is_accepted": false, "score": 0, "last_activity_date": 1565689518, "creation_date": 1565689518, "answer_id": 57475137, "question_id": 57473349, "link": "https://stackoverflow.com/questions/57473349/c-howto-convert-a-pointer-to-access-it-as-a-multidimensional-array/57475137#57475137", "title": "C: howto convert a pointer to access it as a multidimensional array", "body": "<p>The best (optimal) way to do that is your own solution:</p>\n\n<pre><code>array[y*nNumCol + x] = xx;\n</code></pre>\n\n<p>Fo \"beauty\" reasons, you may use a function-like macro to access that data:</p>\n\n<pre><code>#define arrElement(array,x,y) ((array)[(y)*nNumCol + (x)]]))\n</code></pre>\n\n<p>If you need to apply this trick to only one array, then you can simplify the macro:</p>\n\n<pre><code>#define arrElement(x,y) (array[(y)*nNumCol + (x)]]))\n</code></pre>\n\n<p>If the size of the array is not known before the function call, you will need to add some complexity to the macro:</p>\n\n<pre><code>#define arrElement(x,y,nNumCol) (array[(y)*(nNumCol) + (x)]]))\n</code></pre>\n\n<hr>\n\n<p>Note: I did not text exactly the statements above, but I used the trick in the past several times, successfully.</p>\n\n<hr>\n\n<p>You can use a pointer-type (as per your question) only if the array always has the same size. Otherwise, you will have to define the pointer-type dynamically at run-time, which is somewhere between difficult and impossible.</p>\n\n<hr>\n\n<p>A sane thing to do is to pass to the function the array size also, and check if the coordinates actually fall inside the array. Otherwise, you may run into undefined behavior, accessing data outside defined range.</p>\n"}], "owner": {"reputation": 179, "user_id": 3392481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00f05a66e595588f70451cd51fabfa72?s=128&d=identicon&r=PG&f=1", "display_name": "Arno", "link": "https://stackoverflow.com/users/3392481/arno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1565692900, "creation_date": 1565682561, "last_edit_date": 1565685304, "question_id": 57473349, "link": "https://stackoverflow.com/questions/57473349/c-howto-convert-a-pointer-to-access-it-as-a-multidimensional-array", "title": "C: howto convert a pointer to access it as a multidimensional array", "body": "<p>I do have a function call like:</p>\n\n<pre><code>int Filter(short* array, short nNumRow, short nNumCol)\n</code></pre>\n\n<p>but inside it I want to handle array like that:</p>\n\n<pre><code>array[y][x] = xx;\n</code></pre>\n\n<p>I try to solve this by declaring an array</p>\n\n<pre><code>short help[nNumRow][nNumCol];\nhelp = array;\n</code></pre>\n\n<p>but this doesn't work that way. How can I handle that problem without changing function parameter list (this *array is result of a different function that I can't change)? Best of course would be not a copy (of memory) is needed.\nProbably another option would be    </p>\n\n<pre><code> array[y*nNumCol + x] = xx;\n</code></pre>\n\n<p>but I don't like this calculations. So how to do this best?\nThanks!</p>\n"}]