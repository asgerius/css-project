[{"tags": ["c", "gcc"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 3, "creation_date": 1472081759, "post_id": 39134415, "comment_id": 65614379, "body": "Run <code>gcc -v main.c</code> to see what commands the compiler actually runs.  Note that it runs a vastly more complex command line for <code>ld</code> than the one you give."}, {"owner": {"reputation": 1049, "user_id": 5304415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8N5s.png?s=128&g=1", "display_name": "Ryan B.", "link": "https://stackoverflow.com/users/5304415/ryan-b"}, "edited": false, "score": 0, "creation_date": 1472086799, "post_id": 39134415, "comment_id": 65615470, "body": "GCC&#39;s extremly long <code>ld</code> arguments are not always mandatory. A simple <code>Hello, world</code> program can be perfectly linked only with : <code>ld -lc -lkernel32 src.o -o src.exe</code>."}, {"owner": {"reputation": 3246, "user_id": 815612, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/aff0866587273eeae903c6bd2715b717?s=128&d=identicon&r=PG", "display_name": "Jack M", "link": "https://stackoverflow.com/users/815612/jack-m"}, "reply_to_user": {"reputation": 1049, "user_id": 5304415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8N5s.png?s=128&g=1", "display_name": "Ryan B.", "link": "https://stackoverflow.com/users/5304415/ryan-b"}, "edited": false, "score": 0, "creation_date": 1472140241, "post_id": 39134415, "comment_id": 65642748, "body": "@RyanB I get &quot;cannot find -lc&quot;."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "reply_to_user": {"reputation": 1049, "user_id": 5304415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8N5s.png?s=128&g=1", "display_name": "Ryan B.", "link": "https://stackoverflow.com/users/5304415/ryan-b"}, "edited": false, "score": 1, "creation_date": 1472195290, "post_id": 39134415, "comment_id": 65663980, "body": "@RyanB, i&#39;m afraid that depends strongly on the architecture.  Main is a normal function (does not have anything special) so for it to be called, you must provide to the linker a piece of code that does the actual parameter gathering from command line, prepare the <code>argc</code> and <code>argv</code> parameters, stores properly the environment and then makes a call to <code>main()</code> getting the result code (in case <code>main()</code> does a <code>return exit_value;</code>) and do the proper <code>_exit(2)</code> call (after calling all the <code>atexit(3)</code> registered calls). This is done normally by modules as <code>rt.o</code>, <code>crt.o</code>, etc. and is arch dep."}], "answers": [{"comments": [{"owner": {"reputation": 3246, "user_id": 815612, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/aff0866587273eeae903c6bd2715b717?s=128&d=identicon&r=PG", "display_name": "Jack M", "link": "https://stackoverflow.com/users/815612/jack-m"}, "edited": false, "score": 0, "creation_date": 1472083886, "post_id": 39134493, "comment_id": 65614874, "body": "But if the problem is support libraries, why is the undefined reference to &quot;__main&quot;?"}, {"owner": {"reputation": 5298, "user_id": 4241278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53f687af42c3e779a0f2ee98d5fe3bb4?s=128&d=identicon&r=PG", "display_name": "deamentiaemundi", "link": "https://stackoverflow.com/users/4241278/deamentiaemundi"}, "reply_to_user": {"reputation": 3246, "user_id": 815612, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/aff0866587273eeae903c6bd2715b717?s=128&d=identicon&r=PG", "display_name": "Jack M", "link": "https://stackoverflow.com/users/815612/jack-m"}, "edited": false, "score": 0, "creation_date": 1472084904, "post_id": 39134493, "comment_id": 65615097, "body": "@JackM That is the function that does the actual work in <code>main</code>, see e.g.: <a href=\"https://gcc.gnu.org/onlinedocs/gccint/Collect2.html\" rel=\"nofollow noreferrer\">gcc.gnu.org/onlinedocs/gccint/Collect2.html</a>"}, {"owner": {"reputation": 1049, "user_id": 5304415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8N5s.png?s=128&g=1", "display_name": "Ryan B.", "link": "https://stackoverflow.com/users/5304415/ryan-b"}, "edited": false, "score": 0, "creation_date": 1472087030, "post_id": 39134493, "comment_id": 65615528, "body": "Also, if you want to dig into ASM, a good practice will be to turn optimizations off (-O0 flag). Here it&#39;s useless since there are any functions and any optimizations to be made, but I think it&#39;s worth pointing out."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "reply_to_user": {"reputation": 3246, "user_id": 815612, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/aff0866587273eeae903c6bd2715b717?s=128&d=identicon&r=PG", "display_name": "Jack M", "link": "https://stackoverflow.com/users/815612/jack-m"}, "edited": false, "score": 1, "creation_date": 1472195437, "post_id": 39134493, "comment_id": 65664064, "body": "@JackM, <code>__main</code> is the actual program entry point.  It is not the same identifier as <code>_main</code>, which is the internal normal name for the <code>main()</code> function."}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": true, "score": 12, "last_activity_date": 1472082185, "last_edit_date": 1472082185, "creation_date": 1472081353, "answer_id": 39134493, "question_id": 39134415, "link": "https://stackoverflow.com/questions/39134415/undefined-reference-to-main-in-minimal-c-program/39134493#39134493", "title": "Undefined reference to &quot;main&quot; in minimal C program", "body": "<p>You didn't link any of the necessary support libraries. C global objects like stdin, stdout, stderr don't just appear from nowhere. Command arguments and environment variables are pulled from the operating system. And on exit all those <code>atexit()</code> functions get called and the return code from <code>main</code> is passed to <code>exit(return_code)</code>. Etc.</p>\n\n<p>Check out the commands <code>gcc -dumpspecs</code>, <code>gcc -print-libgcc-file-name</code>. Look at all of the other libraries in that directory. You'll find a lot of those libraries and object files referenced in the output of dumpspecs. I don't know exactly when or how those spec rules are interpreted but you can probably get the idea. And I think the GCC info pages <code>info gcc</code> explain it in detail if you dig in far enough.</p>\n\n<p><code>info gcc</code> and then press 'g' and then enter 'Spec Files'</p>\n\n<p>And as Jonathan Leffler said, the shortcut is to run gcc with the verbose option: <code>gcc -v</code> and just see what commands it used.</p>\n"}], "owner": {"reputation": 3246, "user_id": 815612, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/aff0866587273eeae903c6bd2715b717?s=128&d=identicon&r=PG", "display_name": "Jack M", "link": "https://stackoverflow.com/users/815612/jack-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 742, "favorite_count": 0, "accepted_answer_id": 39134493, "answer_count": 1, "score": 11, "last_activity_date": 1472082185, "creation_date": 1472080733, "question_id": 39134415, "link": "https://stackoverflow.com/questions/39134415/undefined-reference-to-main-in-minimal-c-program", "title": "Undefined reference to &quot;main&quot; in minimal C program", "body": "<p>I'm trying to understand C compilation in a little more depth, and so I'm compiling and linking \"manually\". Here is my code</p>\n\n<pre><code>int main()\n{\n    return 0;\n}\n</code></pre>\n\n<p>And here is what I'm putting into my console (Windows):</p>\n\n<pre><code>gcc -S main.c\nas main.s -o main.o\nld main.o\n</code></pre>\n\n<p>And when trying to link, I get:</p>\n\n<pre><code>main.o:main.c:(text+0x7): undefined reference to `__main'\n</code></pre>\n"}, {"tags": ["c", "perl", "openssl", "pthreads", "xs"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472087129, "post_id": 39134329, "comment_id": 65615550, "body": "What is &quot;pure C/C++&quot;?"}, {"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1472089253, "post_id": 39134329, "comment_id": 65615930, "body": "<i>&quot;Now I would say that is because I do not have any thread-handling...&quot;</i> - You would probably be right. <i>&quot;If I have a look into other Perl-Modules (e.g. Crypt::OpenSSL::RSA) I do not find and special thread-handling there too...&quot;</i> - You don&#39;t have to follow them over the cliff."}, {"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1472093372, "post_id": 39134329, "comment_id": 65616810, "body": "Looked at C::O::RSA. If that works in threads, then yeah, yours should too. It does check if <code>bio</code> or <code>pk</code> are <code>NULL</code>, but I&#39;m guessing you made sure that neither <code>bio</code> nor <code>pk</code> are <code>NULL</code>."}, {"owner": {"reputation": 8001, "user_id": 307297, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/e28FD.png?s=128&g=1", "display_name": "chris01", "link": "https://stackoverflow.com/users/307297/chris01"}, "edited": false, "score": 0, "creation_date": 1472109211, "post_id": 39134329, "comment_id": 65622074, "body": "I said addresses and pointers are ok. No problem with NULL or anything."}], "answers": [{"comments": [{"owner": {"reputation": 8001, "user_id": 307297, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/e28FD.png?s=128&g=1", "display_name": "chris01", "link": "https://stackoverflow.com/users/307297/chris01"}, "edited": false, "score": 0, "creation_date": 1472110144, "post_id": 39136689, "comment_id": 65622672, "body": "I now made sure the init is only called once and not inside the thread. But it did not make a difference. I was hoping I do not need the MUTEX-locking of OpenSSL-threads. Therefore I was comparing with that other module."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 8001, "user_id": 307297, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/e28FD.png?s=128&g=1", "display_name": "chris01", "link": "https://stackoverflow.com/users/307297/chris01"}, "edited": false, "score": 0, "creation_date": 1472110765, "post_id": 39136689, "comment_id": 65623083, "body": "@chris: with the code you&#39;ve shown so far it is impossible to say what exactly is going on and what interactions might happen with Perl or other modules. To get better help please provide a fully working minimal example which makes it possible to reproduce your problem, see <a href=\"http://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>."}, {"owner": {"reputation": 8001, "user_id": 307297, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/e28FD.png?s=128&g=1", "display_name": "chris01", "link": "https://stackoverflow.com/users/307297/chris01"}, "edited": false, "score": 0, "creation_date": 1472111699, "post_id": 39136689, "comment_id": 65623668, "body": "Yes, I agree. I addes mutex-locking to my code and it is still not working. Same problem. I will post a sample. Thanks!"}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": false, "score": 1, "last_activity_date": 1472099150, "creation_date": 1472099150, "answer_id": 39136689, "question_id": 39134329, "link": "https://stackoverflow.com/questions/39134329/openssl-and-threads-in-perl-xs/39136689#39136689", "title": "OpenSSL and Threads in Perl XS", "body": "<blockquote>\n<pre><code>printf (\"\\ninit=%d\", SSL_library_init ());   // init\n</code></pre>\n</blockquote>\n\n<p>From the documentation of <a href=\"https://www.openssl.org/docs/manmaster/ssl/SSL_library_init.html\" rel=\"nofollow\">SSL_library_init</a>:</p>\n\n<blockquote>\n  <p>SSL_library_init() must be called before any other action takes place. SSL_library_init() is not reentrant.</p>\n</blockquote>\n\n<p>Which means that you should better call <code>SSL_library_init</code> once before the threads are started or at least make sure that you have proper locking and that this function is not called multiple times, including not called from other modules you might use. Modules like <a href=\"https://metacpan.org/pod/Net::SSLeay\" rel=\"nofollow\">Net::SSLeay</a> actually take care of this <a href=\"https://metacpan.org/source/MIKEM/Net-SSLeay-1.78/SSLeay.xs#L2344\" rel=\"nofollow\">as can be seen in the source code</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1472163158, "post_id": 39140167, "comment_id": 65654489, "body": "<i>&quot;If I include the h-file it works all fine. Even without the added openssl-mutex-thread-handling...&quot;</i> - that does not really make sense."}, {"owner": {"reputation": 8001, "user_id": 307297, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/e28FD.png?s=128&g=1", "display_name": "chris01", "link": "https://stackoverflow.com/users/307297/chris01"}, "reply_to_user": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1472202298, "post_id": 39140167, "comment_id": 65667874, "body": "My code did not work in threads. It was ok outside threads.   OpenSSL provides functions to handle multithreading (<a href=\"https://www.openssl.org/docs/man1.0.2/crypto/threads.html\" rel=\"nofollow noreferrer\">openssl.org/docs/man1.0.2/crypto/threads.html</a>). I thought the reason for the problem was that I did not use them.   But it still did not work after I added the suggested handling.  Hope it is clear now."}, {"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1472560578, "post_id": 39140167, "comment_id": 65792475, "body": "You wrote in your question: &quot;<i>That is working if I do pure C/C++.</i>&quot; Did it work in your &quot;pure C/C++&quot; test without including the h-file?"}, {"owner": {"reputation": 8001, "user_id": 307297, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/e28FD.png?s=128&g=1", "display_name": "chris01", "link": "https://stackoverflow.com/users/307297/chris01"}, "edited": false, "score": 0, "creation_date": 1472560908, "post_id": 39140167, "comment_id": 65792705, "body": "With pure C I ment the XS. It is in C and if I tried the C-code it was working. I did not try it in C with threads. But then as XS with perl-threads."}], "tags": [], "owner": {"reputation": 8001, "user_id": 307297, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/e28FD.png?s=128&g=1", "display_name": "chris01", "link": "https://stackoverflow.com/users/307297/chris01"}, "is_accepted": true, "score": 0, "last_activity_date": 1472113374, "creation_date": 1472113374, "answer_id": 39140167, "question_id": 39134329, "link": "https://stackoverflow.com/questions/39134329/openssl-and-threads-in-perl-xs/39140167#39140167", "title": "OpenSSL and Threads in Perl XS", "body": "<p>I found out the answer. I am not sure about it and I do not like it but it seems to be legit.</p>\n\n<p>I have a lot of openssl-includes in my xs. But I did not include ssl.h.</p>\n\n<pre><code>#include &lt;openssl/ssl.h&gt;\n</code></pre>\n\n<p>No compile-error, no linker-error. Only a segmentation-fault if I use it in threads. Works even outside threads.</p>\n\n<p>If I include the h-file it works all fine. Even without the added openssl-mutex-thread-handling. </p>\n\n<p>Found out after I tried to make my sample \"pretty\" to post it here. That is a bit weird.... I would prefer an compiler-error...</p>\n\n<p>But it explains why the other module is working.</p>\n\n<p>Thanks for help!!</p>\n"}], "owner": {"reputation": 8001, "user_id": 307297, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/e28FD.png?s=128&g=1", "display_name": "chris01", "link": "https://stackoverflow.com/users/307297/chris01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 39140167, "answer_count": 2, "score": 1, "last_activity_date": 1472113374, "creation_date": 1472080019, "last_edit_date": 1472089077, "question_id": 39134329, "link": "https://stackoverflow.com/questions/39134329/openssl-and-threads-in-perl-xs", "title": "OpenSSL and Threads in Perl XS", "body": "<p>I am working with OpenSSL inside a Perl-XS-Module. I have a C-function that calls OpenSSL-API-functions. It is very simple for test-purposes (init openssl, read a key, make the RSA-object and use it, no arguments). No big checks needed and addresses and memory are ok.</p>\n\n<p>XS is standard h2xs with <code>-lssl</code> and <code>-lcrypto</code> in the <code>Makefile</code>.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>void _foo (void)\n{\n    unsigned char key [3000];\n    memset (key, 0, 3000);\n    printf (\"\\ninit=%d\", SSL_library_init ());   // init\n    FILE *f = fopen (\"key.key\",\"r\");\n    printf (\"\\nf=%d\", f);\n    int keysize = fread (key, 1, 3000, f);   // readin\n    printf (\"\\nn=%d\",keysize);\n    fclose (f);\n    printf (\"\\nkey=%s\", key);\n\n    BIO *bio = BIO_new_mem_buf (key, keysize);\n    printf (\"\\nbio=%ld\", bio);\n    RSA *pk = (RSA *) PEM_read_bio_RSAPrivateKey (bio, NULL, NULL, NULL);\n    printf (\"\\npk=%ld\", pk);\n\n    printf (\"\\nsz=%d\" ,RSA_size(pk));  // ***** crash here if in a perl-thread\n    printf (\"\\n\\n\");\n}\n</code></pre>\n\n<p>That is working if I do pure C/C++. It is also ok if I have it in the XS-Module and use it in Perl outside a thread. But it crashes if I have it in Perl and inside a thread.</p>\n\n<p>Now I would say that is because I do not have any <a href=\"http://www.openssl.org/docs/man1.0.2/crypto/threads.html\" rel=\"nofollow\">thread-handling</a>. But if I have a look into other Perl-Modules (e.g. Crypt::OpenSSL::RSA) I do not find and special thread-handling there too.</p>\n\n<p>I am pretty new to XS and maybe I miss something. Maybe someone can give me a hint, thanks!</p>\n"}, {"tags": ["c", "compiler-construction"], "comments": [{"owner": {"reputation": 30558, "user_id": 1013719, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/U8X0A.jpg?s=128&g=1", "display_name": "Ryan Haining", "link": "https://stackoverflow.com/users/1013719/ryan-haining"}, "edited": false, "score": 3, "creation_date": 1472079124, "post_id": 39134155, "comment_id": 65613685, "body": "every lvalue is an expression, not every expression is an lvalue"}, {"owner": {"reputation": 46073, "user_id": 3002139, "user_type": "moderator", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/tYIVC.png?s=128&g=1", "display_name": "Baum mit Augen", "link": "https://stackoverflow.com/users/3002139/baum-mit-augen"}, "edited": false, "score": 1, "creation_date": 1472079180, "post_id": 39134155, "comment_id": 65613698, "body": "Are you sure you want to use your precious time to make yet another C compiler? That stuff is quite hard to get right."}, {"owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "reply_to_user": {"reputation": 30558, "user_id": 1013719, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/U8X0A.jpg?s=128&g=1", "display_name": "Ryan Haining", "link": "https://stackoverflow.com/users/1013719/ryan-haining"}, "edited": false, "score": 0, "creation_date": 1472079479, "post_id": 39134155, "comment_id": 65613775, "body": "@RyanHaining Let&#39;s say <code>var a = 1; a++;</code> In <code>a++;</code> <i>expression-statement</i>, in <code>a++</code> <i>expression</i>, the <code>a</code> variable is what? <i>expression</i>? <i>lvalue</i>? <i>object</i>?"}, {"owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "reply_to_user": {"reputation": 46073, "user_id": 3002139, "user_type": "moderator", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/tYIVC.png?s=128&g=1", "display_name": "Baum mit Augen", "link": "https://stackoverflow.com/users/3002139/baum-mit-augen"}, "edited": false, "score": 0, "creation_date": 1472079959, "post_id": 39134155, "comment_id": 65613909, "body": "@BaummitAugen There are no C compilers in JavaScript."}, {"owner": {"reputation": 46073, "user_id": 3002139, "user_type": "moderator", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/tYIVC.png?s=128&g=1", "display_name": "Baum mit Augen", "link": "https://stackoverflow.com/users/3002139/baum-mit-augen"}, "edited": false, "score": 3, "creation_date": 1472080081, "post_id": 39134155, "comment_id": 65613942, "body": "@Vad That&#39;s mainly because no one needs a C compiler in JavaScript."}, {"owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "reply_to_user": {"reputation": 46073, "user_id": 3002139, "user_type": "moderator", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/tYIVC.png?s=128&g=1", "display_name": "Baum mit Augen", "link": "https://stackoverflow.com/users/3002139/baum-mit-augen"}, "edited": false, "score": 0, "creation_date": 1472080235, "post_id": 39134155, "comment_id": 65613990, "body": "@BaummitAugen Well I need one, so how can you say that no one needs one."}, {"owner": {"reputation": 46073, "user_id": 3002139, "user_type": "moderator", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/tYIVC.png?s=128&g=1", "display_name": "Baum mit Augen", "link": "https://stackoverflow.com/users/3002139/baum-mit-augen"}, "edited": false, "score": 1, "creation_date": 1472080311, "post_id": 39134155, "comment_id": 65614015, "body": "@Vad Eh, I doubt that. Looks more like an XY-problem. I&#39;m rather confident because no one would do that in real life and it&#39;s to big for an assignment,"}, {"owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "reply_to_user": {"reputation": 46073, "user_id": 3002139, "user_type": "moderator", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/tYIVC.png?s=128&g=1", "display_name": "Baum mit Augen", "link": "https://stackoverflow.com/users/3002139/baum-mit-augen"}, "edited": false, "score": 1, "creation_date": 1472080427, "post_id": 39134155, "comment_id": 65614038, "body": "@BaummitAugen No, it&#39;s definitely not XY-problem, and I&#39;m doing it in real life and its actually not that hard, the hard part obviously is to optimize the machine code which is a separate problem."}, {"owner": {"reputation": 46073, "user_id": 3002139, "user_type": "moderator", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/tYIVC.png?s=128&g=1", "display_name": "Baum mit Augen", "link": "https://stackoverflow.com/users/3002139/baum-mit-augen"}, "edited": false, "score": 0, "creation_date": 1472080481, "post_id": 39134155, "comment_id": 65614058, "body": "@Vad Alright. Gl hf."}, {"owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "reply_to_user": {"reputation": 46073, "user_id": 3002139, "user_type": "moderator", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/tYIVC.png?s=128&g=1", "display_name": "Baum mit Augen", "link": "https://stackoverflow.com/users/3002139/baum-mit-augen"}, "edited": false, "score": 0, "creation_date": 1472080609, "post_id": 39134155, "comment_id": 65614089, "body": "@BaummitAugen gl hf"}, {"owner": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "edited": false, "score": 0, "creation_date": 1472080732, "post_id": 39134155, "comment_id": 65614116, "body": "@Vad , as far as a compiler goes, I don&#39;t think there is such a thing as <code>object</code>. Everything is <code>rvalue</code>, <code>lvalue</code>, <code>expression</code> <b>and</b> / <b>or</b> <code>type</code> (<code>type</code> can be <code>struct</code> which has it&#39;s own namespace but is still a struct) within a <code>scope</code> (<code>scope</code> can be <code>global</code>, which is still a scope)... but I might be wrong, I never wrote a compiler."}, {"owner": {"reputation": 5298, "user_id": 4241278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53f687af42c3e779a0f2ee98d5fe3bb4?s=128&d=identicon&r=PG", "display_name": "deamentiaemundi", "link": "https://stackoverflow.com/users/4241278/deamentiaemundi"}, "edited": false, "score": 0, "creation_date": 1472080738, "post_id": 39134155, "comment_id": 65614117, "body": "The JISON lexer/parser (<a href=\"https://github.com/zaach/jison\" rel=\"nofollow noreferrer\">github.com/zaach/jison</a> Bison compatibel to a great extend) has an ANSI-C grammar (and lexer) as an example. Do you use that?"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1472081184, "post_id": 39134155, "comment_id": 65614224, "body": "&quot;its actually not that hard&quot; - Your question tells something different ..."}, {"owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "reply_to_user": {"reputation": 5298, "user_id": 4241278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53f687af42c3e779a0f2ee98d5fe3bb4?s=128&d=identicon&r=PG", "display_name": "deamentiaemundi", "link": "https://stackoverflow.com/users/4241278/deamentiaemundi"}, "edited": false, "score": 0, "creation_date": 1472110537, "post_id": 39134155, "comment_id": 65622926, "body": "@deamentiaemundi I actually don&#39;t have a parser, I start from an AST, though I will have convenience methods to easily build AST in JavaScript, it will be like writing C in JavaScript, of course, you can easily add a parser as a frontent later."}, {"owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "reply_to_user": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "edited": false, "score": 0, "creation_date": 1472110666, "post_id": 39134155, "comment_id": 65623007, "body": "@Myst see <a href=\"http://en.cppreference.com/w/c/language/object\" rel=\"nofollow noreferrer\">this on objects</a>"}, {"owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472110700, "post_id": 39134155, "comment_id": 65623032, "body": "@Olaf Do you know the answer? What is <code>a</code>?"}, {"owner": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "edited": false, "score": 0, "creation_date": 1472112415, "post_id": 39134155, "comment_id": 65624079, "body": "@Vad , <code>object</code>, much like <code>pointer</code>, is a type of expression. I&#39;m not saying that they do not exist in C, I&#39;m just saying that they are a child class, similarly to how <code>pointer</code> is a type of <code>object</code>. For that matter, <code>lvalue</code> and <code>rvalue</code> are probably state specifiers inside an <code>expression</code> rather then a class."}, {"owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "reply_to_user": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "edited": false, "score": 0, "creation_date": 1472117406, "post_id": 39134155, "comment_id": 65627368, "body": "@Myst thank you, so what would be the base class from which <code>pointer</code> and <code>expression</code> inherit?"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "edited": false, "score": 0, "creation_date": 1472123408, "post_id": 39134155, "comment_id": 65631355, "body": "@Myst: The C standard does not support classes, nor does it use that term. The term &quot;object&quot; in C is well defined. It does not have the same meaning like in OOP! They are <b>not</b> &quot;a type of expression&quot;!"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472123709, "post_id": 39134155, "comment_id": 65631556, "body": "@Vad: If you want to create an implementation for C, you have to read <b>and understand</b> the <a href=\"http://port70.net/~nsz/c/c11/n1570.html\" rel=\"nofollow noreferrer\">standard</a>. That exactly defines the terms. Asking particular questions here is near useless."}, {"owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472125129, "post_id": 39134155, "comment_id": 65632460, "body": "@Olaf I&#39;ve read the C99 standard, it mostly deals with parsing though, which I don&#39;t need at all. I start from AST, thus I am more interested in the relationships between the resulting structures."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472125547, "post_id": 39134155, "comment_id": 65632754, "body": "@Vad: C99 is <b>not</b> C standard since ca. 5 years now! Anyway: 1) you don&#39;t need aprsing for a compiler? Strange attitude! 2) It does <b>not</b> &quot;mostly deal with parsing&quot;. If you really think it does, you did not read/understand it! Most part discusses the library, but the rest is <b>mostly</b> about semantics! That&#39;s exactly what you are asking about. 3) Implemention a compiler without reading&amp;understanding the specification is doomed from the start."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1472125751, "post_id": 39134155, "comment_id": 65632896, "body": "&quot;expression evaluates to lvalue&quot; is sloppy language, it means &quot;lvalue expression evaluates to designator of a memory location&quot;"}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "reply_to_user": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "edited": false, "score": 0, "creation_date": 1472125768, "post_id": 39134155, "comment_id": 65632909, "body": "@Myst check the C standard, there certainly is &quot;object&quot;"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1472125950, "post_id": 39134155, "comment_id": 65633049, "body": "@M.M: Slight correction: 6.3.2.1p1 - &quot;An lvalue is an expression (with an object type other than void) that <b>potentially</b> designates an <b>object</b>. ...&quot; - Not necessarily and not just an arbitrary memory location, but an object."}, {"owner": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472126060, "post_id": 39134155, "comment_id": 65633122, "body": "@Olaf , @M.M , with all due respect, the OP&#39;s question related to the use of classes in an OO design for a C compiler. All I state is that <code>object</code> is an unnecessary class. Your references in this regard are somewhat besides the point."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472126087, "post_id": 39134155, "comment_id": 65633136, "body": "@Olaf evaluating an lvalue that doesn&#39;t actually designate an object is undefined behaviour, so we can ignore that case"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "edited": false, "score": 0, "creation_date": 1472126194, "post_id": 39134155, "comment_id": 65633210, "body": "@Myst: OP apparently refers to some C reference (of suspicious origin&amp;quality). So it is not clear if he means the C terms or that of his - also unspecified - OOP language."}, {"owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472126278, "post_id": 39134155, "comment_id": 65633275, "body": "@Olaf &quot;C99 is not C standard since ca. 5 years now!&quot;, how does it matter in this discussion? &quot;you don&#39;t need aprsing for a compiler?&quot; as I wrote I start from AST so I don&#39;t need parsing, that&#39;s one of the reasons for the original question to better understand the relationships between different parts. &quot;Implemention a compiler without reading&amp;understanding the specification is doomed from the start.&quot;, as I said I read the standard and believe it or not I understand it too, don&#39;t think I&#39;m doomed, I&#39;ll be just fine; the question was though how to model the structure OO way."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1472126319, "post_id": 39134155, "comment_id": 65633310, "body": "@M.M: It is UB, but the expression is not always evaluated, e.g. for <code>sizeof</code>?"}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1472126969, "post_id": 39134155, "comment_id": 65633723, "body": "yes, <code>sizeof</code> cases are also not relevant to discussion of evaluating an lvalue"}], "answers": [{"comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472123527, "post_id": 39142671, "comment_id": 65631432, "body": "Values have a type, expressions yield values. You answer could have been a comment linking to the C standard (might have been the easier and more helpful way)"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472125981, "post_id": 39142671, "comment_id": 65633071, "body": "@Olaf Expressions have types, which determine how a given object is interpreted as a value (from 6.2.5. Values: &quot;The meaning of a value stored in an object or returned by a function is determined by the <b>type of  the  expression</b>  used  to  access  it.&quot;). And yes, I could&#39;ve just posted a link to the standard, which certainly would&#39;ve been less effort, but a) I don&#39;t see how summarizing and quoting the relevant sections is <i>less</i> helpful than ... not doing that and b) questions shouldn&#39;t be answered in comments as then the question will keep appearing as an unanswered question."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472126624, "post_id": 39142671, "comment_id": 65633505, "body": "Hmm, that is true for lvalues. Non-lvalue expression just yield a value and values have types. Major point is the question itself is far too broad. The standard shall be read&amp;understood anyway and the design of the compiler is a matter of opinion. I didn&#39;t say the question shall be answered in a comment, but there is no acceptable answer within site rules."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1472127030, "post_id": 39142671, "comment_id": 65633751, "body": "I wouldn&#39;t agree that &quot;expressions evaluate to values&quot;. If the expression is an lvalue then it does not evaluate to a value.  The process of lvalue-to-rvalue conversion is separate to evaluation, and happens in some contexts only."}, {"owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "edited": false, "score": 0, "creation_date": 1472127191, "post_id": 39142671, "comment_id": 65633883, "body": "So what do you think about the following OO design? I will have a base <code>Expression</code> class from which all different <i>expressions</i> will inherit. The <code>Expression</code> class will have an <code>.evaluate()</code> method that will return an instance of <code>Value</code>. <code>Value</code> will be a base class from which all values (<i>lvalue</i>, <i>rvalue</i> and <i>function designator</i>) will inherit. And <code>Object</code> will be yet another class that can be referenced by <code>LValue</code> class instances. Should something like that work or am I missing shomething?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "edited": false, "score": 0, "creation_date": 1472127311, "post_id": 39142671, "comment_id": 65633964, "body": "@Vad I thought you were writing a compiler. Barring optimizations such as constant folding, a compiler doesn&#39;t evaluate anything (and thus doesn&#39;t need an <code>evaluate</code> method). Evaluation happens when the generated code is executed."}, {"owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "edited": false, "score": 0, "creation_date": 1472128263, "post_id": 39142671, "comment_id": 65634624, "body": "@sepp2k ok, I&#39;m probably naming the <code>.evaluate()</code> method incorrectly, I should probably call it <code>.getValue()</code>"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "edited": false, "score": 0, "creation_date": 1472128417, "post_id": 39142671, "comment_id": 65634721, "body": "@Vad It doesn&#39;t matter what you name it. If what it does is to take an expression and produce a value, that&#39;s not supposed to happen during compilation. There is no reason for a <code>Value</code> class to even exist in a compiler outside of the optimizer."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 3, "last_activity_date": 1472121293, "last_edit_date": 1592644375, "creation_date": 1472120498, "answer_id": 39142671, "question_id": 39134155, "link": "https://stackoverflow.com/questions/39134155/c-value-vs-type-vs-expression/39142671#39142671", "title": "C: value vs type vs expression", "body": "<blockquote>\n<p>What I need to understand is what is the exact relationship between types, values, expressions and objects</p>\n</blockquote>\n<p>Expressions have a type and e<em>valuate</em> to values. Objects contain data that, when interpreted as a specific type, may represent values (<em>may</em> because an object can be uninitialized or otherwise contain invalid data). Lvalues (which are a type of expression) refer to objects. To quote the relevant definitions from the standard:</p>\n<blockquote>\n<p><strong>3.15</strong></p>\n<p><strong>object</strong></p>\n<p>region of data storage in the execution environment, the contents of which can represent values</p>\n<p><strong>3.19</strong></p>\n<p><strong>value</strong></p>\n<p>precise meaning of the contents of an object when interpreted as having a specific type</p>\n<p><strong>6.3.2.1 Lvalues, arrays, and function designators</strong></p>\n<p>An lvalue is  an  expression  (with  an  object  type  other  than <code>void</code>)  that  potentially designates an object</p>\n</blockquote>\n<hr />\n<blockquote>\n<p><code>a++;</code> is expression-statement, right?</p>\n</blockquote>\n<p>Yes, an expression statement is an expression followed by a semicolon (grammar rule: &quot;<em>expression_statement</em>: <em>expression</em><sub>opt</sub> <strong>;</strong>&quot; from section 6.8.3 of the standard). <code>a++</code> is an expression thus <code>a++;</code> is an expression statement.</p>\n<blockquote>\n<p><code>a++</code> is expression, with postfix increment operator, right?</p>\n</blockquote>\n<p>Right. The relevant clauses of the grammar are &quot;<em>postfix-expression</em>: <em>postfix-expression</em> <strong>++</strong>&quot;, &quot;<em>postfix-expression</em>: <em>primary-expression</em>&quot; (section 6.5.2) and &quot;<em>primary-expression</em>: <em>identifier</em>&quot; (section 6.5.1). So we get the following derivation (skipping part of the expression hierarchy for brevity) for <code>a++;</code>:</p>\n<pre><code>     expression-statement\n   expression           ';'\n   postfix-expression   ';'\npostfix-expression '++' ';'\nprimary-expression '++' ';'\nidentifier         '++' ';'\n'a'                '++' ';'\n</code></pre>\n<blockquote>\n<p><code>a</code>, so what is <code>a</code>? Is it expression, object, or lvalue? Or is <code>a</code> an expression that evaluates to lvalue and this lvalue has an associated object and type?</p>\n</blockquote>\n<p>Syntactically <code>a</code> is an identifier, which is a primary expression, which is an expression. Semantically it's the name of a variable and a variable is an object. As cited above, &quot;an lvalue is  an  expression  (with  an  object  type  other  than <code>void</code>)  that  potentially designates an object&quot; (section 6.3.2.1), so <code>a</code> is also an <code>lvalue</code>.</p>\n"}], "owner": {"reputation": 3678, "user_id": 1091644, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9783f1f2526f4e2a0f31b0a37bf71879?s=128&d=identicon&r=PG", "display_name": "Vad", "link": "https://stackoverflow.com/users/1091644/vad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 39142671, "answer_count": 1, "score": 2, "last_activity_date": 1472134115, "creation_date": 1472078983, "last_edit_date": 1472134115, "question_id": 39134155, "link": "https://stackoverflow.com/questions/39134155/c-value-vs-type-vs-expression", "title": "C: value vs type vs expression", "body": "<p>Let's say I want to build a C compiler in some OO language, so I create classes like <code>Scope</code>, <code>Object</code>, <code>LValue</code>, <code>Type</code>, <code>Pointer</code>, <code>Expression</code>, etc.</p>\n\n<p>What I need to understand is what is the exact relationship between types, values, expressions and objects. Because some C references say something like:</p>\n\n<blockquote>\n  <p>Expression <em>evaluates</em> to lvalue.</p>\n</blockquote>\n\n<p>In other places you can read something like:</p>\n\n<blockquote>\n  <p>lvalue <em>is</em> an expression...</p>\n</blockquote>\n\n<p>So, how exactly do the C concepts relate to each other?</p>\n\n<p>For binary expression, say addition <code>a + b</code>, the <code>a</code> and <code>b</code> operands, are those <em>expressions</em>? Or <em>objects</em>? Or just <em>types</em> that may or may not be an <em>object</em>?</p>\n\n<p>Consider a simple code:</p>\n\n<pre><code>int a = 1;\na++;\n</code></pre>\n\n<ul>\n<li><code>a++;</code> is <em>expression-statement</em>, right?</li>\n<li><code>a++</code> is <em>expression</em>, with postfix increment operator, right?</li>\n<li><code>a</code>, so what is <code>a</code>? Is it <em>expression</em>, <em>object</em>, or <em>lvalue</em>? Or is <code>a</code> an <em>expression</em> that evaluates to <em>lvalue</em> and this <em>lvalue</em> has an associated <em>object</em> and <em>type</em>?</li>\n</ul>\n\n<hr>\n\n<p><strong>EDIT</strong>: What I am doing is writing a library (called <code>jsc</code>) that will allow to \"write C in JavaScript\".</p>\n\n<p>Consider the following C function:</p>\n\n<pre><code>void main() {\n    int a = 100;\n    int b = 200;\n    int c = 300;\n    return a + (b + c);\n}\n</code></pre>\n\n<p>Using <code>jsc</code> <em>builder</em> interface in JavaScript you would write that function like so:</p>\n\n<pre><code>var _ = require('jsc').Builder.context();\n\nvar main = _.func(_ =&gt; {\n    var a = _.int(100);\n    var b = _.int(200);\n    var c = _.int(300);\n    _.return(_.['+'](a, _['+'](b, c)));\n});\n\nconsole.log(main.compile());\n</code></pre>\n\n<p>Internally <code>jsc</code> would generate something like this:</p>\n\n<pre><code>var fs = new FunctionScope();\n\nvar a = new Object(Type.int(), 100);\nvar b = new Object(Type.int(), 200);\nvar c = new Object(Type.int(), 300);\nfs.body.push(new Declaration(a));\nfs.body.push(new Declaration(b));\nfs.body.push(new Declaration(c));\n\nvar pa = new PrimaryExpression(a);\nvar pb = new PrimaryExpression(b);\nvar pc = new PrimaryExpression(c);\nvar expr1 = new AdditionExpression(pb, pc);\nvar expr2 = new AdditionExpression(pa, expr1);\nfs.body.push(new ReturnStatement(expr2));\n\nvar codegen = new Codegen();\nvar bin = codegen.compileFunction(fs);\nconsole.log(bin);\n</code></pre>\n"}, {"tags": ["c", "regex", "xml"], "comments": [{"owner": {"reputation": 481661, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1472080844, "post_id": 39133979, "comment_id": 65614140, "body": "You seem to want to get multiple matches, but in fact you are trying to access captured values. See <a href=\"https://gist.github.com/ianmackinnon/3294587\" rel=\"nofollow noreferrer\">gist.github.com/ianmackinnon/3294587</a>. Also, <code>.*</code> is too greedy and I believe you can replace the <code>.*</code> with <code>[0-9]*</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2295, "user_id": 792779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99528e625676b23a593f5a3daa005793?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/792779/john"}, "is_accepted": false, "score": 0, "last_activity_date": 1472080026, "last_edit_date": 1472080026, "creation_date": 1472079673, "answer_id": 39134282, "question_id": 39133979, "link": "https://stackoverflow.com/questions/39133979/regexec-get-value-of-xml-tags-in-c/39134282#39134282", "title": "regexec get value of xml tags in c", "body": "<p>Your regular expression is matching from the first instance of <code>&lt;CODE&gt;</code> to the last instance of <code>&lt;/CODE&gt;</code>. To help prevent this, you can replace the <code>(.*\\\\)</code> with <code>([^&lt;]*\\\\)</code>, so your regex is now:</p>\n\n<p><code>char pattern_str[] = \"&lt;CODE[ \\t]*^*&gt;[ \\t]*\\\\([^&lt;]*\\\\)[ \\t]*&lt;\\\\/CODE[ \\t]*&gt;\";</code></p>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 6754547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea91d7c594584e646d59c49789a02be1?s=128&d=identicon&r=PG&f=1", "display_name": "5042", "link": "https://stackoverflow.com/users/6754547/5042"}, "edited": false, "score": 0, "creation_date": 1472144993, "post_id": 39135048, "comment_id": 65645633, "body": "Thanks for the quick response, that was realy helpfull. Since i might expect <b>&lt;CODE/&gt;</b> in the xml added that condition also.  <code>char pattern_str[] = &quot;&lt;CODE[ \\t]*&gt;\\\\s*([0-9a-zA-Z ]*)\\\\s*&lt;\\\\&#47;CODE[ \\t]*&gt;|&lt;CODE[ \\t]*\\\\&#47;&gt;&quot;;</code>"}], "tags": [], "owner": {"reputation": 14487, "user_id": 6106614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/maZZf.png?s=128&g=1", "display_name": "xorspark", "link": "https://stackoverflow.com/users/6106614/xorspark"}, "is_accepted": true, "score": 0, "last_activity_date": 1472085948, "creation_date": 1472085948, "answer_id": 39135048, "question_id": 39133979, "link": "https://stackoverflow.com/questions/39133979/regexec-get-value-of-xml-tags-in-c/39135048#39135048", "title": "regexec get value of xml tags in c", "body": "<p>Per Wiktor's comment, <code>.*</code> is too greedy, so I updated the regex to <code>\"&lt;CODE[ \\t]*&gt;\\\\s*([0-9]*)\\\\s*&lt;\\\\/CODE[ \\t]*&gt;\"</code> and passed in the <code>REG_EXTENDED</code> flag to avoid having to escape the parentheses.</p>\n\n<p>As for capturing multiple matches, you want to follow how the gist Wiktor linked captures multiple matches.  In order to get every match, you have to call regexec on the string multiple times while advancing a pointer to the source string by the length of the entire match. The first array element in the array of matches is the entire match, while the subsequent elements are the captured groups. Since you only have one captured group, you only need to pass in a size of 2, not 10. Here's the full code I used:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;regex.h&gt;\n\nint main() {\n    char value[500];\n    regex_t regexp_data;\n    regmatch_t matched_data[2];\n    char pattern_str[] = \"&lt;CODE[ \\t]*&gt;\\\\s*([0-9]*)\\\\s*&lt;\\\\/CODE[ \\t]*&gt;\";\n    char msg_str[] = \"&lt;ROOT&gt;&lt;INFO&gt;&lt;CODE&gt;5001&lt;/CODE&gt;&lt;MSG&gt;msg one&lt;/MSG&gt;&lt;/INFO&gt;&lt;INFO&gt;&lt;CODE&gt;5002&lt;/CODE&gt;&lt;MSG&gt;msg two&lt;/MSG&gt;&lt;/INFO&gt;&lt;/ROOT&gt;\";\n    char *cursor = msg_str;\n\n    if (regcomp(&amp;regexp_data, pattern_str, REG_EXTENDED | REG_NEWLINE) != 0) {\n        printf(\"Couldn't compile.\\n\");\n        return 1;\n    } \n\n    while (regexec(&amp;regexp_data, cursor, 2, matched_data, 0) != REG_NOMATCH) {\n        memset(value, '\\0', sizeof(value));\n        memcpy(value, cursor + matched_data[1].rm_so, (matched_data[1].rm_eo - matched_data[1].rm_so));\n        printf(\"value [%s]\\n\", value);\n        cursor += matched_data[0].rm_eo;\n    }\n\n    regfree(&amp;regexp_data);\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 6754547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea91d7c594584e646d59c49789a02be1?s=128&d=identicon&r=PG&f=1", "display_name": "5042", "link": "https://stackoverflow.com/users/6754547/5042"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 39135048, "answer_count": 2, "score": 0, "last_activity_date": 1472085948, "creation_date": 1472077826, "question_id": 39133979, "link": "https://stackoverflow.com/questions/39133979/regexec-get-value-of-xml-tags-in-c", "title": "regexec get value of xml tags in c", "body": "<p>I'm trying to get the value of xml tags in c programming by regexec and i cannot use xml parser.</p>\n\n<p>Below is my sample code, can someone help in getting the expected output.</p>\n\n<pre><code>char value[500];\nregex_t regexp_data;    \nregmatch_t matched_data[10];\nchar pattern_str[] = \"&lt;CODE[ \\t]*^*&gt;[ \\t]*\\\\(.*\\\\)[ \\t]*&lt;\\\\/CODE[ \\t]*&gt;\";\nchar msg_str[] = \"&lt;ROOT&gt;&lt;INFO&gt;&lt;CODE&gt;5001&lt;/CODE&gt;&lt;MSG&gt;msg one&lt;/MSG&gt;&lt;/INFO&gt; &lt;INFO&gt;&lt;CODE&gt;5002&lt;/CODE&gt;&lt;MSG&gt;msg two&lt;/MSG&gt;&lt;/INFO&gt;&lt;/ROOT&gt;\";\n\nif ((regcomp(&amp;regexp_data, pattern_str, REG_NEWLINE) == 0) &amp;&amp;\n  (regexec(&amp;regexp_data, msg_str, 10, matched_data, 0) == 0))\n{\n   int i;\n   for (i=0; i &lt; 10; ++i)\n   {\n     memset(value, '\\0', sizeof(value));\n     memcpy(value, &amp;msg_str[matched_data[i].rm_so], (matched_data[i].rm_eo - matched_data[i].rm_so));\n\n     printf (\"value [%s]\\n\", value);\n  }\n\n  regfree(&amp;regexp_data);\n}\n\n/*----------------------\nOutupt\nvalue [&lt;CODE&gt;5001&lt;/CODE&gt;&lt;MSG&gt;msg one&lt;/MSG&gt;&lt;/INFO&gt;&lt;INFO&gt;&lt;CODE&gt;5002&lt;/CODE&gt;]\nvalue [5001&lt;/CODE&gt;&lt;MSG&gt;msg one&lt;/MSG&gt;&lt;/INFO&gt;&lt;INFO&gt;&lt;CODE&gt;5002]\n----------------------\nExpected Outupt\nvalue [5001]\nvalue [5002]\n----------------------*/\n</code></pre>\n"}, {"tags": ["c", "multithreading", "shared-resource"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 2, "creation_date": 1472078350, "post_id": 39133964, "comment_id": 65613477, "body": "C does not require variables with external linkage to be <code>const</code>, so whatever error you got must be specific to a particular usage or context.  Present a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> if you want help with that."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1472078427, "post_id": 39133964, "comment_id": 65613493, "body": "On the other hand, we do expect <i>specific</i> questions here.  &quot;How do I go about &lt;foo&gt;?&quot; rarely qualifies."}, {"owner": {"reputation": 97034, "user_id": 427332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e11b58e11decc7b4c352d3ac3b2d0b90?s=128&d=identicon&r=PG", "display_name": "Tommy", "link": "https://stackoverflow.com/users/427332/tommy"}, "edited": false, "score": 0, "creation_date": 1472078525, "post_id": 39133964, "comment_id": 65613516, "body": "Is it possible you had a call assigning <code>init_custom</code> to a global variable within a header? Otherwise: if you have a library that isn&#39;t thread safe and you attempt to make it so by implementing thread safety on the data structure you hand to it then, well, usually things won&#39;t end well. You can make the accesses sufficiently safe that nobody ever writes at the same time as somebody else is reading but who&#39;s to say what the code is assuming about coherence and atomicity of accessing different parts of the structure?"}], "answers": [{"comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1472078573, "post_id": 39134068, "comment_id": 65613526, "body": "If <code>my_global_custom</code> is declared at file scope, which it must be if it is to have external linkage, then its initializer must be a compile-time constant.  It cannot be initialized via a function call."}, {"owner": {"reputation": 23, "user_id": 6513543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d027c930f0e3f34f9dbfa0df873d28d?s=128&d=identicon&r=PG&f=1", "display_name": "Coolmatt69", "link": "https://stackoverflow.com/users/6513543/coolmatt69"}, "edited": false, "score": 0, "creation_date": 1472078674, "post_id": 39134068, "comment_id": 65613548, "body": "Hey the custom_t = init_custom(); was a typo, it was meant to be used like you said. And the variable is being protected by a mutex. My problem is that I can&#39;t create the my_global_custom with a function because it gives the error saying that globals have to be a const"}, {"owner": {"reputation": 23, "user_id": 6513543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d027c930f0e3f34f9dbfa0df873d28d?s=128&d=identicon&r=PG&f=1", "display_name": "Coolmatt69", "link": "https://stackoverflow.com/users/6513543/coolmatt69"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1472078947, "post_id": 39134068, "comment_id": 65613627, "body": "@JohnBollinger That is exactly my problem. How do I go about it then?"}], "tags": [], "owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "is_accepted": true, "score": 3, "last_activity_date": 1472081263, "last_edit_date": 1495542783, "creation_date": 1472078375, "answer_id": 39134068, "question_id": 39133964, "link": "https://stackoverflow.com/questions/39133964/make-a-variable-that-is-initialized-by-a-function-available-to-a-function-in-mul/39134068#39134068", "title": "Make a variable that is initialized by a function available to a function in multithreaded environment", "body": "<p>With <code>custom_t = init_custom();</code> you're trying to set a <em>typename</em> (i.e. <code>custom_t</code>).</p>\n\n<p>Just call it something else:</p>\n\n<pre><code>custom_t my_global_custom = init_custom();\n</code></pre>\n\n<p>But, to access this from multiple threads and library functions, assuming you'll need to write to it, you'll need to wrap access to this in a mutex:</p>\n\n<pre><code>pthread_mutex_t custom_mutex = PTHREAD_MUTEX_INITIALIZER;\ncustom_t my_global_custom;\n\nmy_global_custom = init_custom();\n\n// how each thread must access it\npthread_mutex_lock(&amp;custom_mutex);\nfunc_that_uses_my_global_custom();\npthread_mutex_unlock(&amp;custom_mutex);\n</code></pre>\n\n<hr>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>My example wasn't intended to be <em>literally</em> an <em>initializer</em> but an <em>assignment</em>:</p>\n\n<pre><code>pthread_mutex_t custom_mutex = PTHREAD_MUTEX_INITIALIZER;\ncustom_t my_global_custom;\ncustom_t my_global_2;\n\ncustom_t\ninit_custom(void)\n{\n    custom_t temp;\n\n    temp.val1 = 5;\n    temp.val2 = 5;\n\n    return temp;\n}\n\nvoid\ninit_custom2(custom_t *temp)\n{\n\n    temp-&gt;val1 = 5;\n    temp-&gt;val2 = 5;\n}\n\nint\nmain(void)\n{\n\n    // either one of these should work ..\n    my_global_custom = init_custom();\n    init_custom2(&amp;my_global_2);\n\n    // start some threads ...\n\n    return 0;\n}\n\nvoid *\nthread_func(void *)\n{\n\n    // how each thread must access it:\n    pthread_mutex_lock(&amp;custom_mutex);\n    func_that_uses_my_global_custom();\n    pthread_mutex_unlock(&amp;custom_mutex);\n\n    return (void *) 0;\n}\n</code></pre>\n\n<hr>\n\n<p><strong>UPDATE #2:</strong></p>\n\n<blockquote>\n  <p>But do you know any way to initialize my_global_custom outside the main function? Or is that just not possible?</p>\n</blockquote>\n\n<p>Another way [under <code>gcc</code> at least], is to create a <em>contructor</em> function.  Given the above functions and definitions, move the init calls into:</p>\n\n<pre><code>void __attribute__((constructor))\nmy_global_constructor(void)\n{\n\n    my_global_custom = init_custom();\n    init_custom2(&amp;my_global_2);\n}\n</code></pre>\n\n<p>Nothing needs to [and nothing <em>should</em>] call this function. It will be called automatically <em>before</em> <code>main</code> is called because it's now a special function.</p>\n\n<p>These are often used by libraries that want to do some init, but <em>don't</em> want to <em>burden</em> <code>main</code> with having to <em>know</em> to call (e.g.) <code>init_liba(); init_libb(); ...</code> In this case, it is called at the \"right\" time for the library [based upon linkage, etc.].</p>\n\n<p>There is also a <code>__attribute__((destructor))</code> than can be used to \"destroy\" things [after <code>main</code> returns, IIRC].</p>\n\n<p>For more on this, see: <a href=\"https://stackoverflow.com/questions/2053029/how-exactly-does-attribute-constructor-work\">How exactly does __attribute__((constructor)) work?</a></p>\n\n<p>Personally, I now use the above attribute, but, for nostalgia, I like the older <code>.init/.fini</code> sections.</p>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 6513543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d027c930f0e3f34f9dbfa0df873d28d?s=128&d=identicon&r=PG&f=1", "display_name": "Coolmatt69", "link": "https://stackoverflow.com/users/6513543/coolmatt69"}, "edited": false, "score": 0, "creation_date": 1472079954, "post_id": 39134237, "comment_id": 65613906, "body": "That&#39;s a cool trick, did not know that. Thank you. What do I do if val1 needs to be initialized with a function?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 23, "user_id": 6513543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d027c930f0e3f34f9dbfa0df873d28d?s=128&d=identicon&r=PG&f=1", "display_name": "Coolmatt69", "link": "https://stackoverflow.com/users/6513543/coolmatt69"}, "edited": false, "score": 0, "creation_date": 1472130720, "post_id": 39134237, "comment_id": 65636354, "body": "@Coolmatt69, if you want any object with static storage duration, including any variable declared with file scope, to take a value that is not a compile-time constant, then you must assign that value to it as part of the normal execution of your program.  You cannot use an initializer for that purpose."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 1, "last_activity_date": 1472130622, "last_edit_date": 1472130622, "creation_date": 1472079428, "answer_id": 39134237, "question_id": 39133964, "link": "https://stackoverflow.com/questions/39133964/make-a-variable-that-is-initialized-by-a-function-available-to-a-function-in-mul/39134237#39134237", "title": "Make a variable that is initialized by a function available to a function in multithreaded environment", "body": "<p>As clarified in you comment on @CraigEstey's answer, the problem is not that the variable needs to be <code>const</code>, but that its <em>initializer</em> needs to be a compile-time constant.  One approach to this sort of problem is to define a static initialization value via a macro instead of as a function return value.  For example, in some appropriate header file declare</p>\n\n<pre><code>typedef struct {\n    int val1;\n    int val2;\n} custom_t;\n\n#define CUSTOM_T_INITIALIZER { .val1 = 5, .val2 = 5 }\n</code></pre>\n\n<p>You can then initialize variables of type <code>custom_t</code> like so:</p>\n\n<pre><code>custom_t some_name = CUSTOM_T_INITIALIZER;\n</code></pre>\n\n<p>, including at file scope.</p>\n\n<h2>Update:</h2>\n\n<p>If you need to assign a value to your file-scope or static-duration variable that is not compile-time constant (including if it has an aggregate type and the value desired for one of its members is not a compile-time constant), then you cannot use an initializer for that purpose.  Instead, you must arrange to assign the wanted value to that variable after the program starts, perhaps by calling an initialization function of some sort.</p>\n"}], "owner": {"reputation": 23, "user_id": 6513543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d027c930f0e3f34f9dbfa0df873d28d?s=128&d=identicon&r=PG&f=1", "display_name": "Coolmatt69", "link": "https://stackoverflow.com/users/6513543/coolmatt69"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 1, "accepted_answer_id": 39134068, "answer_count": 2, "score": 2, "last_activity_date": 1472130622, "creation_date": 1472077765, "last_edit_date": 1472079301, "question_id": 39133964, "link": "https://stackoverflow.com/questions/39133964/make-a-variable-that-is-initialized-by-a-function-available-to-a-function-in-mul", "title": "Make a variable that is initialized by a function available to a function in multithreaded environment", "body": "<p>So here is the problem I'm trying to solve, I'm programming in C.</p>\n\n<p>We have a function that can initialize a struct for you.</p>\n\n<pre><code>typedef struct {\n  int val1;\n  int val2;\n} custom_t;\n\ncustom_t init_custom() {\n  custom_t temp;\n\n  temp.val1 = 5;\n  temp.val2 = 5;\n\n\n  return temp;\n}\n</code></pre>\n\n<p>And you would just use it like so:</p>\n\n<pre><code>custom_t some_name = init_custom();\n</code></pre>\n\n<p>I have 4 functions that takes the custom_t as input and can do some work with it.</p>\n\n<p>In another file I have a lot of library functions that will run in a multithreaded enviroment. These library functions will all need to do work on the same custom_t variable, no matter the thread.</p>\n\n<p>The library functions won't get the custom_t variable passed to it, because the goal is that another user should be able to use the library functions without thinking of the custom_t variable.</p>\n\n<p>I'm thinking that I have to make the custom_t variable global in the namespace where I define the library functions but I an error saying that global variables must be const.</p>\n\n<p>I am unsure how to achieve this and I would appreciate all the help I can get. If my explanation wasn't good enough feel free to ask any questions and I will try to elaborate.</p>\n\n<p>EDIT:\nFixed the variable init typo</p>\n"}, {"tags": ["python", "c", "arrays", "numpy", "cython"], "comments": [{"owner": {"reputation": 38371, "user_id": 3555845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e06f616d9a53b1ca18287d1049a28ee?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3555845/daniel"}, "edited": false, "score": 3, "creation_date": 1472075888, "post_id": 39133578, "comment_id": 65612697, "body": "regular expressions are not slower in Python than in C."}, {"owner": {"reputation": 151, "user_id": 6037476, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8a00ea92195de535ffc5ae8f6cc3d85f?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/6037476/max"}, "reply_to_user": {"reputation": 38371, "user_id": 3555845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e06f616d9a53b1ca18287d1049a28ee?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/3555845/daniel"}, "edited": false, "score": 0, "creation_date": 1472120475, "post_id": 39133578, "comment_id": 65629465, "body": "Yes I&#39;m aware the speed of compiled regexes is comparable between C and python. I&#39;m looking to avoid overhead in other areas by building the numpy array in C."}], "answers": [{"comments": [{"owner": {"reputation": 151, "user_id": 6037476, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8a00ea92195de535ffc5ae8f6cc3d85f?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/6037476/max"}, "edited": false, "score": 0, "creation_date": 1472122079, "post_id": 39134223, "comment_id": 65630518, "body": "Thanks for the well- informed comment. I would add that converting a numpy array of strings into an array of Objects basically kills any performance gain you get out of numpy. After reading your response, I think the best thing for me to do is (1) Create a numpy array of appropiate size and dtype (2) obtain the numpy array&#39;s bytes in C with PyArray_BYTES and then (3) copy my strings into that memory with memcpy."}], "tags": [], "owner": {"reputation": 173469, "user_id": 901925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bbd70aaeb3a97d0087daf93c2be8804?s=128&d=identicon&r=PG", "display_name": "hpaulj", "link": "https://stackoverflow.com/users/901925/hpaulj"}, "is_accepted": true, "score": 3, "last_activity_date": 1472095139, "last_edit_date": 1472095139, "creation_date": 1472079343, "answer_id": 39134223, "question_id": 39133578, "link": "https://stackoverflow.com/questions/39133578/fastest-way-to-expose-c-strings-to-numpy/39134223#39134223", "title": "Fastest way to expose C strings to NumPy?", "body": "<p>To give a sense of how an array of strings is stored, I'll make one, and view it in several ways:</p>\n\n<pre><code>In [654]: np.array(['one','two','three','four'],dtype='S5')\nOut[654]: \narray([b'one', b'two', b'three', b'four'], \n      dtype='|S5')\nIn [655]: x=np.array(['one','two','three','four'],dtype='S5')\nIn [656]: x.tostring()\nOut[656]: b'one\\x00\\x00two\\x00\\x00threefour\\x00'\nIn [657]: x.view(np.uint8)\nOut[657]: \narray([111, 110, 101,   0,   0, 116, 119, 111,   0,   0, 116, 104, 114,\n       101, 101, 102, 111, 117, 114,   0], dtype=uint8)\n</code></pre>\n\n<p>So its databuffer consists of 20 bytes (4*S5).  For strings that are shorter than 5, it puts (or leaves) <code>0</code> in the byte.</p>\n\n<p>Yes, there are <code>C</code> functions for creating new arrays of a given size and dtype.  And functions for copying blocks of data to those arrays.  Look at the <code>C</code> side of the numpy documentation, or look at some of the numpy code on it's github repository.</p>\n\n<p>Regarding the <code>pandas</code> transfer, beware that <code>pandas</code> readily changes the dtype of its columns.  For example if you put <code>None</code> or <code>nan</code> in a column it is likely to change it to object dtype.</p>\n\n<p>Object arrays store pointers in the databuffer.</p>\n\n<pre><code>In [658]: y=np.array(['one','two','three','four'],dtype=object)\nIn [659]: y\nOut[659]: array(['one', 'two', 'three', 'four'], dtype=object)\nIn [660]: y.tostring()\nOut[660]: b'\\xe0\\x0f\\xc5\\xb5\\xa0\\xfah\\xb5\\x80\\x0b\\x8c\\xb4\\xc09\\x8b\\xb4'\n</code></pre>\n\n<p>If I interpret that right, the databuffer has 16 bytes - 4 4byte pointers.  The strings are stored elsewhere in memory as regular Python strings (in this case unicode strings (Py3)).</p>\n\n<p>=================</p>\n\n<p><code>fromstring</code> and <code>frombuffer</code> lets me recreate an array from a buffer</p>\n\n<pre><code>In [696]: x=np.array(['one','two','three','four'],dtype='S5')\nIn [697]: xs=x.tostring()\nIn [698]: np.fromstring(xs,'S5')\nOut[698]: \narray([b'one', b'two', b'three', b'four'], \n      dtype='|S5')\nIn [700]: np.frombuffer(xs,'S5')\nOut[700]: \narray([b'one', b'two', b'three', b'four'], \n      dtype='|S5')\n</code></pre>\n\n<p>This works without copying the buffer.</p>\n\n<p>However, if the are multiple strings in different parts of memory, then building an array from them will require copying into on contiguous buffer.</p>\n"}], "owner": {"reputation": 151, "user_id": 6037476, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8a00ea92195de535ffc5ae8f6cc3d85f?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/6037476/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 3, "accepted_answer_id": 39134223, "answer_count": 1, "score": 3, "last_activity_date": 1523373814, "creation_date": 1472075454, "last_edit_date": 1523373814, "question_id": 39133578, "link": "https://stackoverflow.com/questions/39133578/fastest-way-to-expose-c-strings-to-numpy", "title": "Fastest way to expose C strings to NumPy?", "body": "<p>I'm working on converting some old text logs to a usable format in Python. \nThe files are huge, so I'm writing my own C extensions to run through the files as quickly as possible and parse out the relevant fields with regular expressions. My ultimate goal is to export these fields into <code>NumPy</code> arrays of <code>strings</code>. I know it's possible to create the <code>NumPy</code> array as a <code>PyObject</code> in C and then call <code>SetItem</code> on each element, but I'm looking to optimize as much as I can. </p>\n\n<p><strong>Can I use something like <code>memcpy</code> or <code>PyBuffer_FromMemory</code> to read the C strings into a <code>NumPy</code> <code>string</code> array directly?</strong> I understand that <code>NumPy</code> arrays are internally similar to C arrays, but do I have to ensure the <code>NumPy</code> array will be contiguously allocated?</p>\n\n<p>I intend to use the <code>NumPy</code> arrays to build columns <code>Pandas</code> for statistical analysis. As I understand it, <code>Pandas</code> uses <code>NumPy</code> arrays to store columns in a <code>DataFrame</code> so I won't have a large overhead going from <code>NumPy</code> into <code>Pandas</code>. I'd like to avoid <code>cython</code> if possible.</p>\n"}, {"tags": ["c", "bison"], "comments": [{"owner": {"reputation": 7792, "user_id": 249237, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QjPtI.png?s=128&g=1", "display_name": "Kninnug", "link": "https://stackoverflow.com/users/249237/kninnug"}, "edited": false, "score": 0, "creation_date": 1472075881, "post_id": 39133560, "comment_id": 65612695, "body": "Most likely yes. What have you tried so far? What isn&#39;t working?"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 3, "creation_date": 1472076440, "post_id": 39133560, "comment_id": 65612879, "body": "You need to configure your lexical analyzer so that it will read from the string, tokenizing it, and reporting EOF (via the return value 0) when it reaches the end.  You probably need an initialization function and the <code>yylex()</code> code to read from what the initialization set."}, {"owner": {"reputation": 159, "user_id": 2548592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/giH3O.png?s=128&g=1", "display_name": "tejas", "link": "https://stackoverflow.com/users/2548592/tejas"}, "edited": false, "score": 0, "creation_date": 1472079989, "post_id": 39133560, "comment_id": 65613918, "body": "How do I do that?"}], "answers": [{"comments": [{"owner": {"reputation": 159, "user_id": 2548592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/giH3O.png?s=128&g=1", "display_name": "tejas", "link": "https://stackoverflow.com/users/2548592/tejas"}, "edited": false, "score": 0, "creation_date": 1472331895, "post_id": 39134488, "comment_id": 65712691, "body": "Getting this error:  <code>error: use of undeclared identifier &#39;yy_free_buffer&#39;</code>"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 159, "user_id": 2548592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/giH3O.png?s=128&g=1", "display_name": "tejas", "link": "https://stackoverflow.com/users/2548592/tejas"}, "edited": false, "score": 1, "creation_date": 1472333146, "post_id": 39134488, "comment_id": 65713029, "body": "@TejGop: Sorry, memory spasm. It&#39;s <code>yy_delete_buffer</code>. Fixed the answer. See the <a href=\"http://flex.sourceforge.net/manual/Multiple-Input-Buffers.html#Multiple-Input-Buffers\" rel=\"nofollow noreferrer\">docs</a>"}, {"owner": {"reputation": 676, "user_id": 4170605, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/AnjCH.png?s=128&g=1", "display_name": "velocirabbit", "link": "https://stackoverflow.com/users/4170605/velocirabbit"}, "edited": false, "score": 0, "creation_date": 1481108653, "post_id": 39134488, "comment_id": 69238792, "body": "Is there any way of doing this (reading from a string) while in the middle of reading from a file without restarting bison&#39;s parse state? I can easily have flex read from a string, but when it does, bison for some reason starts up a whole new parse stack rather than continuing the existing one."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 676, "user_id": 4170605, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/AnjCH.png?s=128&g=1", "display_name": "velocirabbit", "link": "https://stackoverflow.com/users/4170605/velocirabbit"}, "edited": false, "score": 0, "creation_date": 1481115169, "post_id": 39134488, "comment_id": 69242965, "body": "@velocirabbit: sure, but you need to <i>ask a question</i>. (<a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>.) Please show what you tried."}], "tags": [], "owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "is_accepted": true, "score": 4, "last_activity_date": 1511122968, "last_edit_date": 1511122968, "creation_date": 1472081291, "answer_id": 39134488, "question_id": 39133560, "link": "https://stackoverflow.com/questions/39133560/how-to-parse-a-c-string-with-bison/39134488#39134488", "title": "How to parse a C string with Bison", "body": "<p>Bison parsers don't read input at all. They simply obtains a series of tokens by repeatedly calling <code>yylex</code>. (Or, with modern bison, you can create a \"push parser\" which is given tokens in successive calls.) So whatever implements <code>yylex</code> is responsible for the input.</p>\n\n<p>If you use <code>flex</code> to create a lexical scanner, you can use <code>yy_scan_string</code> (or <code>yy_scan_bytes</code> if you know how long the string is) to scan a string instead of scanning from a file. See the <a href=\"http://westes.github.io/flex/manual/Multiple-Input-Buffers.html#Scanning-Strings\" rel=\"nofollow noreferrer\">Flex manual</a> for details on these functions.</p>\n\n<p>For a simple example, you could put the following two functions at the end of your <code>flex</code> definition file, after the second <code>%%</code>:</p>\n\n<pre><code>void set_input_string(const char* in) {\n  yy_scan_string(in);\n}\n\nvoid end_lexical_scan(void) {\n  yy_delete_buffer(YY_CURRENT_BUFFER);\n}\n</code></pre>\n\n<p>And put this at the end of your bison definition file, again after the second <code>%%</code>:</p>\n\n<pre><code>/* Declarations */\nvoid set_input_string(const char* in);\nvoid end_lexical_scan(void);\n\n/* This function parses a string */\nint parse_string(const char* in) {\n  set_input_string(in);\n  int rv = yyparse();\n  end_lexical_scan();\n  return rv;\n}\n</code></pre>\n\n<p>Then you can declare and use <code>parse_string</code> to parse a string. </p>\n"}], "owner": {"reputation": 159, "user_id": 2548592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/giH3O.png?s=128&g=1", "display_name": "tejas", "link": "https://stackoverflow.com/users/2548592/tejas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1234, "favorite_count": 0, "closed_date": 1472101412, "accepted_answer_id": 39134488, "answer_count": 1, "score": 3, "last_activity_date": 1511122968, "creation_date": 1472075373, "question_id": 39133560, "link": "https://stackoverflow.com/questions/39133560/how-to-parse-a-c-string-with-bison", "closed_reason": "Needs details or clarity", "title": "How to parse a C string with Bison", "body": "<p>I have a string in a C file like this:</p>\n\n<pre><code>char *test = \"print x\";\n</code></pre>\n\n<p>I want to parse that with a Bison parser I've written. Is it possible?</p>\n"}, {"tags": ["c", "jpeg", "libjpeg", "libjpeg-turbo"], "comments": [{"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1472074656, "post_id": 39133386, "comment_id": 65612198, "body": "You really should be using your debugger to see what is going on instead of guessing what may be the issue."}, {"owner": {"reputation": 1149, "user_id": 1516809, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/14af4904f9e094a18d52d820f7a62cbe?s=128&d=identicon&r=PG", "display_name": "Sid", "link": "https://stackoverflow.com/users/1516809/sid"}, "reply_to_user": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1472074929, "post_id": 39133386, "comment_id": 65612295, "body": "You&#39;re right. I do not have the source/symbols for libjpeg at the moment so I can&#39;t dig around there. I was hoping that someone has already come across this issue, because what I&#39;m trying to do is really basic. Worst case scenario, I&#39;ll have to download/build libjpeg myself"}, {"owner": {"reputation": 6882, "user_id": 3403834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpA5S.jpg?s=128&g=1", "display_name": "user58697", "link": "https://stackoverflow.com/users/3403834/user58697"}, "edited": false, "score": 0, "creation_date": 1472075622, "post_id": 39133386, "comment_id": 65612585, "body": "How do you build your app on Windows?"}, {"owner": {"reputation": 1149, "user_id": 1516809, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/14af4904f9e094a18d52d820f7a62cbe?s=128&d=identicon&r=PG", "display_name": "Sid", "link": "https://stackoverflow.com/users/1516809/sid"}, "edited": false, "score": 0, "creation_date": 1472075691, "post_id": 39133386, "comment_id": 65612616, "body": "I&#39;m using visual studio 2015. I got the precompiled binaries, and linked the library/header files"}, {"owner": {"reputation": 1149, "user_id": 1516809, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/14af4904f9e094a18d52d820f7a62cbe?s=128&d=identicon&r=PG", "display_name": "Sid", "link": "https://stackoverflow.com/users/1516809/sid"}, "edited": false, "score": 0, "creation_date": 1472076251, "post_id": 39133386, "comment_id": 65612808, "body": "The jpeg file? Yes. I&#39;m getting the correct size of the file when doing the fseek/ftell. Also, if it doesn&#39;t find the file it will return NULL. So I&#39;m pretty sure the file is in the correct folder"}, {"owner": {"reputation": 6882, "user_id": 3403834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpA5S.jpg?s=128&g=1", "display_name": "user58697", "link": "https://stackoverflow.com/users/3403834/user58697"}, "edited": false, "score": 2, "creation_date": 1472082745, "post_id": 39133386, "comment_id": 65614619, "body": "That&#39;s what I suspected. See this discussion: <a href=\"https://sourceforge.net/p/gnuwin32/discussion/74807/thread/54e28799/\" rel=\"nofollow noreferrer\">sourceforge.net/p/gnuwin32/discussion/74807/thread/54e28799</a>"}, {"owner": {"reputation": 8099, "user_id": 2797476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcf9561473705b0e781edb4525bed2ac?s=128&d=identicon&r=PG", "display_name": "Christian Ternus", "link": "https://stackoverflow.com/users/2797476/christian-ternus"}, "reply_to_user": {"reputation": 6882, "user_id": 3403834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpA5S.jpg?s=128&g=1", "display_name": "user58697", "link": "https://stackoverflow.com/users/3403834/user58697"}, "edited": false, "score": 1, "creation_date": 1472086836, "post_id": 39133386, "comment_id": 65615479, "body": "@user58697 Please add this as an answer!"}, {"owner": {"reputation": 1149, "user_id": 1516809, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/14af4904f9e094a18d52d820f7a62cbe?s=128&d=identicon&r=PG", "display_name": "Sid", "link": "https://stackoverflow.com/users/1516809/sid"}, "reply_to_user": {"reputation": 6882, "user_id": 3403834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpA5S.jpg?s=128&g=1", "display_name": "user58697", "link": "https://stackoverflow.com/users/3403834/user58697"}, "edited": false, "score": 0, "creation_date": 1472087260, "post_id": 39133386, "comment_id": 65615573, "body": "@user58697 thanks a lot for linking that thread! I&#39;m almost certain that&#39;s what is happening in my case (although I&#39;m not sure why I see the &#39;Empty input file&#39; error instead of a crash as mentioned in that thread). I&#39;ll look into it tomorrow. Also as Christian said please add your comment as an answer!"}], "answers": [{"comments": [{"owner": {"reputation": 7970, "user_id": 4117097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lrdeC.jpg?s=128&g=1", "display_name": "Anton Malyshev", "link": "https://stackoverflow.com/users/4117097/anton-malyshev"}, "edited": false, "score": 0, "creation_date": 1472088095, "post_id": 39135245, "comment_id": 65615737, "body": "BTW, there are official builds of libjpeg-turbo for Visual C++ on its page, for example see: <a href=\"https://sourceforge.net/projects/libjpeg-turbo/files/1.5.0/\" rel=\"nofollow noreferrer\">sourceforge.net/projects/libjpeg-turbo/files/1.5.0</a> - I&#39;m using it for years together with <code>jpeg_stdio_src</code> API"}, {"owner": {"reputation": 1149, "user_id": 1516809, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/14af4904f9e094a18d52d820f7a62cbe?s=128&d=identicon&r=PG", "display_name": "Sid", "link": "https://stackoverflow.com/users/1516809/sid"}, "reply_to_user": {"reputation": 7970, "user_id": 4117097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lrdeC.jpg?s=128&g=1", "display_name": "Anton Malyshev", "link": "https://stackoverflow.com/users/4117097/anton-malyshev"}, "edited": false, "score": 0, "creation_date": 1472438364, "post_id": 39135245, "comment_id": 65735829, "body": "@AntonMalyshev I was using the same Visual C++ binaries you are talking about with VS2015 and am still seeing the crash. In fact it is also documented on their website that passing in C runtime handles will fail on Windows unless you build your application against msvcrt.dll. <a href=\"http://www.libjpeg-turbo.org/Documentation/OfficialBinaries\" rel=\"nofollow noreferrer\">link</a>"}, {"owner": {"reputation": 7970, "user_id": 4117097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lrdeC.jpg?s=128&g=1", "display_name": "Anton Malyshev", "link": "https://stackoverflow.com/users/4117097/anton-malyshev"}, "edited": false, "score": 0, "creation_date": 1472444229, "post_id": 39135245, "comment_id": 65737040, "body": "Don&#39;t know why, but I have no problems with VS2008, maybe lucky :)"}], "tags": [], "owner": {"reputation": 6882, "user_id": 3403834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpA5S.jpg?s=128&g=1", "display_name": "user58697", "link": "https://stackoverflow.com/users/3403834/user58697"}, "is_accepted": true, "score": 2, "last_activity_date": 1472087624, "creation_date": 1472087624, "answer_id": 39135245, "question_id": 39133386, "link": "https://stackoverflow.com/questions/39133386/decompressing-jpeg-using-libjpegturbo-returning-empty-input-file/39135245#39135245", "title": "Decompressing jpeg using libjpegturbo returning &quot;Empty input file&quot;", "body": "<p>The core of the issue is a dll mismatch. The <code>libjpeg</code> is built agains <code>msvcrt.dll</code>, whereas the app is built against whatever runtime provided by MSVS2015. They are incompatible, and the file pointers opened in one runtime make no sense to another.</p>\n\n<p>The solution, as per this <a href=\"https://sourceforge.net/p/gnuwin32/discussion/74807/thread/54e28799/\" rel=\"nofollow\">discussion</a>, is to avoid <code>jpeg_stdio_src</code> API.</p>\n"}, {"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1472095351, "post_id": 39135296, "comment_id": 65617228, "body": "Yes, technically that is true, but you have this compiler thing that will complain (rather loudly) if <code>true</code> were undeclared."}, {"owner": {"reputation": 7970, "user_id": 4117097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lrdeC.jpg?s=128&g=1", "display_name": "Anton Malyshev", "link": "https://stackoverflow.com/users/4117097/anton-malyshev"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1472200769, "post_id": 39135296, "comment_id": 65666936, "body": "Problem is not with declared/undeclared. true and TRUE or even C++ true and C99 true can have different internal representations (different int values) what can lead to weird runtime errors. I faced this several times."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1472236811, "post_id": 39135296, "comment_id": 65687774, "body": "I see your point, basically <code>true</code> is <i>implementation defined</i> so it is up to the OP to verify it is passing what he thinks it is as the <code>require image</code> flag."}], "tags": [], "owner": {"reputation": 7970, "user_id": 4117097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lrdeC.jpg?s=128&g=1", "display_name": "Anton Malyshev", "link": "https://stackoverflow.com/users/4117097/anton-malyshev"}, "is_accepted": false, "score": 0, "last_activity_date": 1472087976, "creation_date": 1472087976, "answer_id": 39135296, "question_id": 39133386, "link": "https://stackoverflow.com/questions/39133386/decompressing-jpeg-using-libjpegturbo-returning-empty-input-file/39135296#39135296", "title": "Decompressing jpeg using libjpegturbo returning &quot;Empty input file&quot;", "body": "<p>You are passing C++ <code>true</code> value to <code>jpeg_read_header</code> -- that could also be the reason for failure. You should pass TRUE constant instead.</p>\n"}], "owner": {"reputation": 1149, "user_id": 1516809, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/14af4904f9e094a18d52d820f7a62cbe?s=128&d=identicon&r=PG", "display_name": "Sid", "link": "https://stackoverflow.com/users/1516809/sid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 706, "favorite_count": 0, "accepted_answer_id": 39135245, "answer_count": 2, "score": 1, "last_activity_date": 1472087976, "creation_date": 1472074481, "last_edit_date": 1472086613, "question_id": 39133386, "link": "https://stackoverflow.com/questions/39133386/decompressing-jpeg-using-libjpegturbo-returning-empty-input-file", "title": "Decompressing jpeg using libjpegturbo returning &quot;Empty input file&quot;", "body": "<p>As the title states, I'm trying to read a JPEG file using libjpeg-turbo. I tried this code on a mac at home and it worked, but now I'm on Windows and it's giving me a <code>Empty input file</code> error on calling <code>jpeg_read_header</code>. I have verified that the file is not empty by doing a fseek/ftell, and the size I get corresponds to what I expect it to be. </p>\n\n<p>My initial thoughts were that I might not have been opening the file in binary mode, so I tried that as well using _setmode, but that didn't seem to help. Here is my code for reference. </p>\n\n<pre><code>int decodeJpegFile(char* filename)\n{\n    FILE *file = fopen(filename, \"rb\");\n\n    if (file == NULL)\n    {\n        return NULL;\n    }\n\n    _setmode(_fileno(file), _O_BINARY);\n\n    fseek(file, 0L, SEEK_END);\n    int sz = ftell(file);\n    fseek(file, 0L, SEEK_SET);\n\n\n    struct jpeg_decompress_struct info; //for our jpeg info\n    struct jpeg_error_mgr err; //the error handler\n\n    info.err = jpeg_std_error(&amp;err);\n    jpeg_create_decompress(&amp;info); //fills info structure\n    jpeg_stdio_src(&amp;info, file);\n    jpeg_read_header(&amp;info, true); // ****This is where it fails*****\n    jpeg_start_decompress(&amp;info);\n\n\n    int w = info.output_width;\n    int h = info.output_height;\n    int numChannels = info.num_components; // 3 = RGB, 4 = RGBA\n    unsigned long dataSize = w * h * numChannels;\n\n    unsigned char *data = (unsigned char *)malloc(dataSize);\n    unsigned char* rowptr;\n    while (info.output_scanline &lt; h)\n    {\n        rowptr = data + info.output_scanline * w * numChannels;\n        jpeg_read_scanlines(&amp;info, &amp;rowptr, 1);\n    }\n\n    jpeg_finish_decompress(&amp;info);\n    fclose(file);\n\n    FILE* outfile = fopen(\"outFile.raw\", \"wb\");\n    size_t data_out = fwrite(data, dataSize, sizeof(unsigned char), outfile);\n\n}`\n</code></pre>\n\n<p>Any help is much appreciated!</p>\n"}, {"tags": ["python", "c", "arrays", "python-c-api", "python-embedding"], "comments": [{"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1472074762, "post_id": 39133222, "comment_id": 65612242, "body": "What do you mean by &quot;list of arrays&quot;? You can&#39;t put C arrays in a Python list."}, {"owner": {"reputation": 11, "user_id": 6736912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4922f7b0bee13d89a557e62ebec32f50?s=128&d=identicon&r=PG&f=1", "display_name": "suzaku", "link": "https://stackoverflow.com/users/6736912/suzaku"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1472113002, "post_id": 39133222, "comment_id": 65624450, "body": "I think a two dimensional array (in terms of C) (which would be like a list of lists in terms of Python) would be more appropriate. You can refer to the example I gave of the input I wanted."}, {"owner": {"reputation": 23048, "user_id": 4657412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4915a27d01efa79d81d322511ee517a9?s=128&d=identicon&r=PG&f=1", "display_name": "DavidW", "link": "https://stackoverflow.com/users/4657412/davidw"}, "edited": false, "score": 0, "creation_date": 1472116532, "post_id": 39133222, "comment_id": 65626763, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/30330279/how-to-pass-two-dimensional-array-from-c-to-python\">How to Pass Two-dimensional array from C to Python</a>"}, {"owner": {"reputation": 23048, "user_id": 4657412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4915a27d01efa79d81d322511ee517a9?s=128&d=identicon&r=PG&f=1", "display_name": "DavidW", "link": "https://stackoverflow.com/users/4657412/davidw"}, "edited": false, "score": 0, "creation_date": 1472116653, "post_id": 39133222, "comment_id": 65626836, "body": "I know this isn&#39;t a perfect duplicate - they&#39;re using <code>std::vector</code> rather than 2D C array and they return tuples rather than lists - but it&#39;s pretty close and the answer is good so you should probably be able to get what you want from it."}, {"owner": {"reputation": 11, "user_id": 6736912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4922f7b0bee13d89a557e62ebec32f50?s=128&d=identicon&r=PG&f=1", "display_name": "suzaku", "link": "https://stackoverflow.com/users/6736912/suzaku"}, "edited": false, "score": 0, "creation_date": 1472118937, "post_id": 39133222, "comment_id": 65628442, "body": "Thanks, yes it helped me solve my first part of the query, but how do I return a list back to C?"}, {"owner": {"reputation": 11, "user_id": 6736912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4922f7b0bee13d89a557e62ebec32f50?s=128&d=identicon&r=PG&f=1", "display_name": "suzaku", "link": "https://stackoverflow.com/users/6736912/suzaku"}, "edited": false, "score": 0, "creation_date": 1472120065, "post_id": 39133222, "comment_id": 65629175, "body": "I think I get it, I probably need to return a PyList object, and extract each element using PyList_GetItem macro and then, add it to an array."}, {"owner": {"reputation": 23048, "user_id": 4657412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4915a27d01efa79d81d322511ee517a9?s=128&d=identicon&r=PG&f=1", "display_name": "DavidW", "link": "https://stackoverflow.com/users/4657412/davidw"}, "edited": false, "score": 0, "creation_date": 1472121157, "post_id": 39133222, "comment_id": 65629880, "body": "@suzaku Sorry - I didn&#39;t realise you wanted to go transfer the data both ways! The other thing you could look at are numpy arrays"}], "answers": [{"tags": [], "owner": {"reputation": 151, "user_id": 6037476, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8a00ea92195de535ffc5ae8f6cc3d85f?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/6037476/max"}, "is_accepted": false, "score": 0, "last_activity_date": 1472560768, "last_edit_date": 1472560768, "creation_date": 1472256800, "answer_id": 39176243, "question_id": 39133222, "link": "https://stackoverflow.com/questions/39133222/embedding-python-in-c-passing-a-two-dimensional-array-and-retrieving-back-a-lis/39176243#39176243", "title": "Embedding Python in C: Passing a two dimensional array and retrieving back a list", "body": "<p>I think what you want to do is to pass in some Lists, have them converted to C arrays and then back to Lists before returning to Python.</p>\n\n<p>The Lists are received in C as a pointer to a PyObject, so to get the data from you'll have to use <a href=\"https://docs.python.org/3.4/extending/extending.html\" rel=\"nofollow\">PyArg_ParseXX</a>(YY), where XX and YY depend on what type of list object you had in Python and how you want it to be interpreted in C. This is where you would specify the shape information of the input lists and turn it into whatever shape you need for processing.</p>\n\n<p>To return the arrays back to python you'll have to look at the Python-C API, which gives methods for creating and manipulating Python objects in C. As othera have suggested, using the <a href=\"http://docs.scipy.org/doc/numpy/user/c-info.how-to-extend.html\" rel=\"nofollow\">numpy-C API</a> is also an option with many advantages. In this case, you can use the PyArray_SimpleNew to create an array and populate it with your output.</p>\n"}], "owner": {"reputation": 11, "user_id": 6736912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4922f7b0bee13d89a557e62ebec32f50?s=128&d=identicon&r=PG&f=1", "display_name": "suzaku", "link": "https://stackoverflow.com/users/6736912/suzaku"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 463, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1472560768, "creation_date": 1472073710, "last_edit_date": 1472140613, "question_id": 39133222, "link": "https://stackoverflow.com/questions/39133222/embedding-python-in-c-passing-a-two-dimensional-array-and-retrieving-back-a-lis", "title": "Embedding Python in C: Passing a two dimensional array and retrieving back a list", "body": "<p>I want to pass a list of arrays (or a 2D array) such as <code>[[1,2,3],[4,5,6]]</code> from C to a Python script which computes and returns a list. What possible changes would be required to the embedding <a href=\"https://docs.python.org/3/extending/embedding.html#pure-embedding\" rel=\"nofollow\">code</a> in order to achieve this? The python script to be executed is as follows:</p>\n\n<p><em>abc.py</em></p>\n\n<pre><code>import math\ndef xyz(size,wss):\n    result=[0 for i in range(size)]\n    for i in range(size):    \n        wss_mag=math.sqrt(wss[i][0]*wss[i][0]+wss[i][1]*wss[i][1]+wss[i][2]*wss[i][2])\n        result[i]=1/wss_mag\n    return result\n</code></pre>\n\n<p>Here size is the number of 1D arrays in WSS (for e.g. 2 in case <code>wss=[[1,2,3],[4,5,6]]</code>) The question is different than the suggested duplicate in the sense it has to return back a list as a 1-D array to C.</p>\n"}, {"tags": ["c", "linked-list"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 9, "creation_date": 1472070259, "post_id": 39132407, "comment_id": 65610145, "body": "<code>current-&gt;Lastname == name</code> - this is not the way to compare strings. Use <code>strcmp</code> family. Which makes me suspect you have similar problems in the functions you don&#39;t show..."}, {"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1472072798, "post_id": 39132407, "comment_id": 65611350, "body": "Tip; <code>char *name</code> should be <code>const char *name</code> since you don&#39;t modify that to which <code>name</code> points."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 6744800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92be06e7d4107d3abc624a885329eeae?s=128&d=identicon&r=PG&f=1", "display_name": "Chance Potter", "link": "https://stackoverflow.com/users/6744800/chance-potter"}, "is_accepted": false, "score": 0, "last_activity_date": 1472169956, "creation_date": 1472169956, "answer_id": 39156528, "question_id": 39132407, "link": "https://stackoverflow.com/questions/39132407/delete-a-node-based-on-matching-data/39156528#39156528", "title": "Delete a node based on matching data", "body": "<p>Thanks for the tips! Here's the code that I got to work for anyone interested.</p>\n\n<pre><code>STUDENT *DeleteByLastName(STUDENT *students, char *name)\n{\nstruct STUDENT* current;\nstruct STUDENT* head = students;\n\ncurrent = students;\nint count = 0;\nstruct STUDENT* previous = NULL;\n\nwhile (current != NULL) {\n    //check for matching head and delete\n    if (strcmp(current-&gt;Lastname,name) == 0 &amp;&amp; count == 0) {\n        students = current-&gt;Next;\n        return students;\n    }\n    //If name matches but is not at the beggining of the list\n    if(strcmp(current-&gt;Lastname,name) == 0) {\n        previous-&gt;Next = previous-&gt;Next-&gt;Next;\n        current = current-&gt;Next;\n        return students;\n    }\n    else {\n        previous = current;\n        current = current-&gt;Next;\n        ++count;\n    }\n}\nreturn head;\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 6744800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92be06e7d4107d3abc624a885329eeae?s=128&d=identicon&r=PG&f=1", "display_name": "Chance Potter", "link": "https://stackoverflow.com/users/6744800/chance-potter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1597866611, "creation_date": 1472070077, "question_id": 39132407, "link": "https://stackoverflow.com/questions/39132407/delete-a-node-based-on-matching-data", "title": "Delete a node based on matching data", "body": "<p>Directions: Implement the following function to search by last name and then delete the first matching student from the linked-list. If a matching student is found, the function returns a pointer to the head of the new linked-list; if a matching student is not found, the list is unchanged and the head of the linked-list is returned.</p>\n\n<p>When compiling and running this code, it only deletes the head node each time. Even if the name is in the middle of the list or not in the list at all, the head node is always deleted. Not really sure whats going wrong. Any help will be greatly appreciated! Thanks!</p>\n\n<pre><code>STUDENT *DeleteByLastName(STUDENT *students, char *name)\n{\nstruct STUDENT* current = students;\nstruct STUDENT* previous = NULL;\n\nwhile (current != NULL) {\n  if (current-&gt;Lastname == name) {\n     if (previous == NULL) {\n        current = current-&gt;Next;\n        free(students);\n        students = current;\n     }\n     else {\n        previous-&gt;Next = current-&gt;Next;\n        free(current);\n        current = previous-&gt;Next;\n     }\n  } \n  else {\n     previous = current;\n     current = current-&gt;Next;\n  }\n  return current;\n}    \nreturn NULL;\n\n}\n</code></pre>\n"}, {"tags": ["c", "string"], "comments": [{"owner": {"reputation": 50126, "user_id": 1717300, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/81b91f602ce8acea8cbeb29f62725627?s=128&d=identicon&r=PG", "display_name": "hyde", "link": "https://stackoverflow.com/users/1717300/hyde"}, "edited": false, "score": 4, "creation_date": 1472070336, "post_id": 39132399, "comment_id": 65610179, "body": "What&#39;s wrong with malloc and memcpy?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1472070363, "post_id": 39132399, "comment_id": 65610190, "body": "You know <code>sprintf</code>? Although text-oriented functions have no parallel (AFAIK) with binary file operations. It&#39;s a use equivalent for <code>fprintf</code>."}, {"owner": {"reputation": 52445, "user_id": 1253222, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3a62746fb04e19c1656cd1df560911f?s=128&d=identicon&r=PG", "display_name": "twalberg", "link": "https://stackoverflow.com/users/1253222/twalberg"}, "edited": false, "score": 0, "creation_date": 1472070962, "post_id": 39132399, "comment_id": 65610515, "body": "<code>memcpy</code> or <code>memmove</code>, along with suitable allocation of destination buffers, would be the way to go here..."}], "answers": [{"comments": [{"owner": {"reputation": 5298, "user_id": 4241278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53f687af42c3e779a0f2ee98d5fe3bb4?s=128&d=identicon&r=PG", "display_name": "deamentiaemundi", "link": "https://stackoverflow.com/users/4241278/deamentiaemundi"}, "edited": false, "score": 2, "creation_date": 1472070570, "post_id": 39132456, "comment_id": 65610296, "body": "Casting a <code>const void *</code> to a non-const pointer can bite back. I think your  solution with <code>memcpy</code> is much better."}], "tags": [], "owner": {"reputation": 27697, "user_id": 4433386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/hbHEL.png?s=128&g=1", "display_name": "Marcus M&#252;ller", "link": "https://stackoverflow.com/users/4433386/marcus-m%c3%bcller"}, "is_accepted": false, "score": 8, "last_activity_date": 1472070646, "last_edit_date": 1472070646, "creation_date": 1472070339, "answer_id": 39132456, "question_id": 39132399, "link": "https://stackoverflow.com/questions/39132399/fwrite-but-to-string-instead-of-file-in-c/39132456#39132456", "title": "fwrite, but to string instead of file in C", "body": "<p>a <code>char</code> is just a single character. What you mean is a char buffer; and lo! your <code>p</code> is already one. Just use <code>(char*)p</code> (cast your void pointer to a char pointer), or <code>memcpy</code> the things that <code>p</code> points to to the char buffer of your choice.</p>\n\n<p>Deamentiaemundi raises a good point: you probably pass <code>p</code> as <code>const void*</code> for a reason; if you plan to modify the data, you should memcpy the contents, definitely.</p>\n"}, {"tags": [], "owner": {"reputation": 1876, "user_id": 785411, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pA8HF.jpg?s=128&g=1", "display_name": "Chris McGrath", "link": "https://stackoverflow.com/users/785411/chris-mcgrath"}, "is_accepted": true, "score": 6, "last_activity_date": 1473194732, "last_edit_date": 1473194732, "creation_date": 1472070933, "answer_id": 39132611, "question_id": 39132399, "link": "https://stackoverflow.com/questions/39132399/fwrite-but-to-string-instead-of-file-in-c/39132611#39132611", "title": "fwrite, but to string instead of file in C", "body": "<p>Under the hood, it seems your pointer <code>p</code> is just a big array of bytes. You can cast it to a char array and use it:</p>\n\n<pre><code>char *jpegframe = (char *) p;\n</code></pre>\n\n<p>If you'd like to modify the frame, you might want to allocate some more memory and copy it in:</p>\n\n<pre><code>static char* process_frame(const void *p, int size) {\n    char* jpegframe = malloc(size);\n    memcpy(jpegframe, p, size);\n\n    /* Do the processing... */\n\n    return jpegframe;\n}\n</code></pre>\n"}], "owner": {"reputation": 714, "user_id": 5849262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aea9a350d929ede34c328ca570d84487?s=128&d=identicon&r=PG&f=1", "display_name": "Billy", "link": "https://stackoverflow.com/users/5849262/billy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1066, "favorite_count": 0, "accepted_answer_id": 39132611, "answer_count": 2, "score": 4, "last_activity_date": 1473194732, "creation_date": 1472070051, "question_id": 39132399, "link": "https://stackoverflow.com/questions/39132399/fwrite-but-to-string-instead-of-file-in-c", "title": "fwrite, but to string instead of file in C", "body": "<p>I'm writing a C program to get a JPEG frame from a camera and do various stuff with it. I have the following function:</p>\n\n<pre><code>static void process_frame(const void *p, int size) {\n        fwrite(p, size, 1, stdout);\n}\n</code></pre>\n\n<p>It works great for writing the frame to stdout, but what I really need is something like this (\"swrite\" being like <code>fwrite</code>, but to a <code>char</code> instead of a file):</p>\n\n<pre><code>static char* process_frame(const void *p, int size) {\n        char* jpegframe;\n        swrite(p, size, 1, jpegframe);\n        return jpegframe;\n}\n</code></pre>\n\n<p>Unfortunately, there is no swrite function (at least not that I could find).\nSo...</p>\n\n<p>Are there any functions similiar to an \"swrite\" function?\n</p>\n\n<p>or</p>\n\n<p>\nHow can I use the process_frame function with <code>printf</code> (and therefore <code>sprintf</code>) instead of <code>fwrite</code>?</p>\n"}, {"tags": ["c", "linux", "linux-kernel", "kernel", "kernel-module"], "answers": [{"comments": [{"owner": {"reputation": 91978, "user_id": 387076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/cFyP6.jpg?s=128&g=1", "display_name": "Gilles &#39;SO- stop being evil&#39;", "link": "https://stackoverflow.com/users/387076/gilles-so-stop-being-evil"}, "edited": false, "score": 0, "creation_date": 1472082961, "post_id": 39134012, "comment_id": 65614658, "body": "<code>&#47;proc</code> is for process information. There&#39;s also some legacy stuff but new stuff that isn&#39;t process-related is supposed to go under <code>&#47;sys</code>."}], "tags": [], "owner": {"reputation": 3598, "user_id": 4822941, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06bJl.jpg?s=128&g=1", "display_name": "employee of the month", "link": "https://stackoverflow.com/users/4822941/employee-of-the-month"}, "is_accepted": true, "score": 2, "last_activity_date": 1472078065, "creation_date": 1472078065, "answer_id": 39134012, "question_id": 39132262, "link": "https://stackoverflow.com/questions/39132262/ensure-that-uid-gid-check-in-system-call-is-executed-in-rcu-critical-section/39134012#39134012", "title": "Ensure that UID/GID check in system call is executed in RCU-critical section", "body": "<p>The linked question concerns a fundamentally different issue. To quote:</p>\n\n<blockquote>\n  <p>Please note that the uid that I want to get is NOT of the current process.</p>\n</blockquote>\n\n<p>Clearly, a thread which is not the currently executing thread can in principle exit at any point or change credentials. Measures need to be taken to ensure the stability of whatever we are fiddling with. RCU is often the right answer. The answer provided there is somewhat wrong in the sense that there are other ways as well.</p>\n\n<p>Meanwhile, if you want to operate on the thread executing the very code, you can know it wont exit (because it is executing your code as opposed to an exit path). A question arises what about the stability of credentials -- good news, they are also guaranteed to be there and can be accessed with no preparation whatsoever. This can be easily verified by checking the code doing credential switching.</p>\n\n<p>We are left with the question what primitives can be used to do the access. To that end one can use make_kuid, uid_eq and similar primitives.</p>\n\n<p>The real question is why is this a syscall as opposed to just a /proc file.</p>\n\n<p>See this blogpost for somewhat elaborated description of credential handling: <a href=\"http://codingtragedy.blogspot.com/2015/04/weird-stuff-thread-credentials-in-linux.html\" rel=\"nofollow\">http://codingtragedy.blogspot.com/2015/04/weird-stuff-thread-credentials-in-linux.html</a></p>\n"}, {"comments": [{"owner": {"reputation": 17102, "user_id": 1022889, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WZOSZ.jpg?s=128&g=1", "display_name": "Cloud", "link": "https://stackoverflow.com/users/1022889/cloud"}, "edited": false, "score": 0, "creation_date": 1472101820, "post_id": 39134684, "comment_id": 65618796, "body": "Minor typo &quot;you can do this in the kernel&quot;. Does the kernel understand non-zero PID/GID values at least, even if it can&#39;t map them to the user name string in <code>&#47;etc&#47;passwd</code>? Thank you."}, {"owner": {"reputation": 91978, "user_id": 387076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/cFyP6.jpg?s=128&g=1", "display_name": "Gilles &#39;SO- stop being evil&#39;", "link": "https://stackoverflow.com/users/387076/gilles-so-stop-being-evil"}, "reply_to_user": {"reputation": 17102, "user_id": 1022889, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WZOSZ.jpg?s=128&g=1", "display_name": "Cloud", "link": "https://stackoverflow.com/users/1022889/cloud"}, "edited": false, "score": 0, "creation_date": 1472109629, "post_id": 39134684, "comment_id": 65622344, "body": "@DevNull The kernel maintains UID and GID values, but it doesn&#39;t know what they mean, apart from 0 = the user who is allowed to do a lot of things that others can&#39;t. But keep in mind that a UID/GID is only meaningful in a namespace: it isn&#39;t an integer, but a pair {namespace, integer}. There may well be multiple <code>&#47;etc&#47;passwd</code> in different virtual environments in userland, a UID value alone means nothing."}], "tags": [], "owner": {"reputation": 91978, "user_id": 387076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/cFyP6.jpg?s=128&g=1", "display_name": "Gilles &#39;SO- stop being evil&#39;", "link": "https://stackoverflow.com/users/387076/gilles-so-stop-being-evil"}, "is_accepted": false, "score": 2, "last_activity_date": 1472109438, "last_edit_date": 1472109438, "creation_date": 1472082930, "answer_id": 39134684, "question_id": 39132262, "link": "https://stackoverflow.com/questions/39132262/ensure-that-uid-gid-check-in-system-call-is-executed-in-rcu-critical-section/39134684#39134684", "title": "Ensure that UID/GID check in system call is executed in RCU-critical section", "body": "<p>First, adding a new system call is rarely the right way to do things. It's best to do things via the existing mechanisms because you'll benefit from already-existing tools on both sides: existing utility functions in the kernel, existing libc and high-level language support in userland. Files are a central concept in Linux (like other Unix systems) and most data is exchanged via files, either <a href=\"https://en.wikipedia.org/wiki/Device_file\" rel=\"nofollow\">device files</a> or special filesystems such as <a href=\"https://en.wikipedia.org/wiki/Procfs\" rel=\"nofollow\">proc</a> and <a href=\"https://en.wikipedia.org/wiki/Sysfs\" rel=\"nofollow\">sysfs</a>.</p>\n\n<blockquote>\n  <p>I would like to modify the system call so that it only gets invoked if a special user (such as \"root\" or user \"pi\") issues it.</p>\n</blockquote>\n\n<p>You can't do this in the kernel. Not only is it wrong from a design point of view, but it isn't even possible. The kernel knows nothing about user names. The only knowledge about users in the kernel in that some privileged actions are reserved to user 0 in the root <a href=\"https://en.wikipedia.org/wiki/Linux_namespaces\" rel=\"nofollow\">namespace</a> (don't forget that last part! And if that's new to you it's a sign that you shouldn't be doing advanced things like adding system calls). (Many actions actually look for a <a href=\"https://en.wikipedia.org/wiki/Capability-based_security\" rel=\"nofollow\">capability</a> rather than being root.)</p>\n\n<p>What you want to use is <strong>sysfs</strong>. Read the <a href=\"https://www.kernel.org/doc/Documentation/filesystems/sysfs.txt\" rel=\"nofollow\">kernel documentation</a> and look for non-ancient online tutorials or existing kernel code (code that uses sysfs is typically pretty clean nowadays). With sysfs, you expose information through files under <code>/sys</code>. Access control is up to userland \u2014\u00a0have a sane default in the kernel and do things like calling <code>chgrp</code>, <code>chmod</code> or <code>setfacl</code> in the boot scripts. That's one of the many wheels that you don't need to reinvent on the user side when using the existing mechanisms.</p>\n\n<p>The sysfs <code>show</code> method automatically takes a lock around the file, so only one kernel thread can be executing it at a time. That's one of the many wheels that you don't need to reinvent on the kernel side when using the existing mechanisms.</p>\n"}], "owner": {"reputation": 17102, "user_id": 1022889, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WZOSZ.jpg?s=128&g=1", "display_name": "Cloud", "link": "https://stackoverflow.com/users/1022889/cloud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 39134012, "answer_count": 2, "score": 4, "last_activity_date": 1472109438, "creation_date": 1472069441, "last_edit_date": 1472078106, "question_id": 39132262, "link": "https://stackoverflow.com/questions/39132262/ensure-that-uid-gid-check-in-system-call-is-executed-in-rcu-critical-section", "title": "Ensure that UID/GID check in system call is executed in RCU-critical section", "body": "<h1>Task</h1>\n\n<p>I have a small kernel module I wrote for my RaspBerry Pi 2 which implements an additional system call for generating power consumption metrics.  I would like to modify the system call so that it only gets invoked if a special user (such as \"root\" or user \"pi\") issues it. Otherwise, the call just skips the bulk of its body and returns success.</p>\n\n<hr>\n\n<h1>Background Work</h1>\n\n<p>I've read into the issue at length, and <a href=\"https://stackoverflow.com/questions/33863487/get-uid-from-pidprocess-id-from-kernel-level-code\">I've found a similar question on SO</a>, but there are numerous problems with it, from my perspective (noted below).</p>\n\n<hr>\n\n<h1>Question</h1>\n\n<ul>\n<li><s>The linked question notes that <code>struct task_struct</code> contains a pointer element to <code>struct cred</code>, as defined in <code>linux/sched.h</code> and <code>linux/cred.h</code>. The latter of the two headers doesn't exist on my system(s), and the former doesn't show any declaration of a pointer to a <code>struct cred</code> element. <strong>Does this make sense?</strong></s>\n\n<ul>\n<li>Silly mistake. This is present in its entirety in the kernel headers (ie: <code>/usr/src/linux-headers-$(uname -r)/include/linux/cred.h</code>), I was searching in gcc-build headers in <code>/usr/include/linux</code>.</li>\n</ul></li>\n<li><s>Even if the above worked, it doesn't mention if I would be getting the <a href=\"https://stackoverflow.com/questions/32455684/difference-between-real-user-id-effective-user-id-and-saved-user-id\">the real, effective, or saved UID for the process</a>. <strong>Is it even possible to get each of these three values from within the system call?</strong></s>\n\n<ul>\n<li><code>cred.h</code> already contains all of these.</li>\n</ul></li>\n<li><s><strong>Is there a safe way in the kernel module to quickly determine which groups the user belongs to without parsing <code>/etc/group</code>?</strong></s>\n\n<ul>\n<li><code>cred.h</code> already contains all of these.</li>\n</ul></li>\n</ul>\n\n<hr>\n\n<h1>Update</h1>\n\n<p>So, the only valid question remaining is the following:</p>\n\n<blockquote>\n  <p>Note, that iterating through processes and reading process's\n  credentials should be done under RCU-critical section.</p>\n</blockquote>\n\n<ul>\n<li><code>...</code> <strong>how do I ensure my check is run in this critical section? Are there any working examples of how to accomplish this?</strong> <a href=\"https://www.kernel.org/doc/Documentation/RCU/whatisRCU.txt\" rel=\"nofollow\">I've found some existing kernel documentation that instructs readers to wrap the relevant code with <code>rcu_read_lock()</code> and <code>rcu_read_unlock()</code>.</a> Do I just need to wrap an read operations against the <code>struct cred</code> and/or <code>struct task_struct</code> data structures?</li>\n</ul>\n"}, {"tags": ["c++", "c", "glibc"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1472068786, "post_id": 39131893, "comment_id": 65609455, "body": "IIRC what you&#39;re claiming works. I think cppreference needs an update about this."}, {"owner": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "edited": false, "score": 0, "creation_date": 1472069128, "post_id": 39131893, "comment_id": 65609617, "body": "Documentation:  Check out one of the drafts for the latest C++ standard.  It documents the library functions (but possibly by referring to a C standard).  Note that there is a general rule &quot;you can&#39;t pass NULL to a library function unless it explicitly says you can&quot;."}, {"owner": {"reputation": 17408, "user_id": 2881849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5a2fd0122f50f7582be15be3062c5b71?s=128&d=identicon&r=PG&f=1", "display_name": "MikeMB", "link": "https://stackoverflow.com/users/2881849/mikemb"}, "reply_to_user": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1472069137, "post_id": 39131893, "comment_id": 65609621, "body": "@\u03c0\u03ac\u03bd\u03c4\u03b1\u1fe5\u03b5\u1fd6: The thing is that neither in the C nor C++ standard (at least in the versions I can find in the internet) I can find any reference to this. Nor in the according man pages on the linux systems I tested it on."}, {"owner": {"reputation": 17408, "user_id": 2881849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5a2fd0122f50f7582be15be3062c5b71?s=128&d=identicon&r=PG&f=1", "display_name": "MikeMB", "link": "https://stackoverflow.com/users/2881849/mikemb"}, "reply_to_user": {"reputation": 26945, "user_id": 771073, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/412bf39694cbe9d1fc0374deda225b18?s=128&d=identicon&r=PG", "display_name": "Martin Bonner supports Monica", "link": "https://stackoverflow.com/users/771073/martin-bonner-supports-monica"}, "edited": false, "score": 0, "creation_date": 1472069621, "post_id": 39131893, "comment_id": 65609864, "body": "@MartinBonner: Thanks, but I know, where to look for the documentation for ISO C or C++ but couldn&#39;t find any reference to this behavior in either of those documents (which doesn&#39;t necessarily mean it doesn&#39;t exist). Apparently this isn&#39;t even mentioned in the POSIX spec, which often requires additional functionality (e.g. POSIX specified multithreading behavior long befor ISO C or C++ did)."}, {"owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 1, "creation_date": 1472069966, "post_id": 39131893, "comment_id": 65610015, "body": "I think its more efficient to create a stack buffer and then construct the <code>std::string</code> directly passing the address of the stack buffer and the return value of <code>std::strftime()</code>, passing it the same stack buffer along with the rest of the format parameters.Then <code>std::strftime</code> fills the stack buffer and returns the correct length to construct the <code>std:string</code> directly. That saves calling <code>st::strftime</code> twice and filling the <code>std::string</code> twice."}, {"owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 1, "creation_date": 1472070085, "post_id": 39131893, "comment_id": 65610061, "body": "Here is an example: <a href=\"https://stackoverflow.com/questions/31281293/timestamps-for-embedded-system/31281976#31281976\" title=\"timestamps for embedded system\">stackoverflow.com/questions/31281293/&hellip;</a>"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1472070527, "post_id": 39131893, "comment_id": 65610278, "body": "This looks like undefined behavior to me.  strftime does not have any requirement in the C standard to do what you say and it does say <i>If the total number of resulting characters including the terminating null character is not more than maxsize, the strftime function returns the number of characters placed into the array pointed to by s not including the terminating null character.</i> so it looks to me like it will attempt to write into the array and doing that is UB."}, {"owner": {"reputation": 17408, "user_id": 2881849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5a2fd0122f50f7582be15be3062c5b71?s=128&d=identicon&r=PG&f=1", "display_name": "MikeMB", "link": "https://stackoverflow.com/users/2881849/mikemb"}, "reply_to_user": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 0, "creation_date": 1472070712, "post_id": 39131893, "comment_id": 65610367, "body": "@Galik: Thank you. You are most probably right and this was certainly not meant as demonstration of how to best use <code>strftime</code>. I came across something similar in some older code of mine (while porting it to windows) and was surprised that I didn&#39;t find anything about this in the Linux/POSIX documentation."}, {"owner": {"reputation": 17408, "user_id": 2881849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5a2fd0122f50f7582be15be3062c5b71?s=128&d=identicon&r=PG&f=1", "display_name": "MikeMB", "link": "https://stackoverflow.com/users/2881849/mikemb"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1472070843, "post_id": 39131893, "comment_id": 65610439, "body": "@NathanOliver: I agree, that is UB according to the ISO C and C++ standard. But just because something is UB in the ISO-C or C++ standard doesn&#39;t necessarily mean it is not specified for an actual standard library implementation that might (in addition) adhere to other standards like POSIX."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 1, "creation_date": 1472073735, "post_id": 39131893, "comment_id": 65611788, "body": "@mikemb: it is not in posix either. It is probably an undocumented glibc extension."}, {"owner": {"reputation": 17408, "user_id": 2881849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5a2fd0122f50f7582be15be3062c5b71?s=128&d=identicon&r=PG&f=1", "display_name": "MikeMB", "link": "https://stackoverflow.com/users/2881849/mikemb"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1472075558, "post_id": 39131893, "comment_id": 65612559, "body": "@rici: Thank you very much. You were absolutely right just that it is documented and I was to stupid to search at the right place."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472075860, "post_id": 39131893, "comment_id": 65612681, "body": "Neither C11 nor POSIX (2008, 2013) mandates the &#39;return the number of characters that would have been printed&#39; behaviour.  However, it parallels the behaviour of <code>snprintf()</code> which is mandated to behave sanely like that, so there is precedent for the specification."}], "answers": [{"comments": [{"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 0, "creation_date": 1472076399, "post_id": 39133589, "comment_id": 65612867, "body": "This answer would be improved if you&#39;d mention that this behavior is not specified by the C or C++ standard or by POSIX. For implementations other than glibc, passing a null pointer as the first argument to <code>strftime</code> has undefined behavior. (Of course returning useful information is entirely consistent with undefined behavior.)"}, {"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 0, "creation_date": 1472077453, "post_id": 39133589, "comment_id": 65613177, "body": "A quibble: This is a glibc issue; it has nothing directly to do with gcc or g++. For example, you can use clang or clang++ with glibc, and you can use gcc or g++ with other library implementations."}, {"owner": {"reputation": 17408, "user_id": 2881849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5a2fd0122f50f7582be15be3062c5b71?s=128&d=identicon&r=PG&f=1", "display_name": "MikeMB", "link": "https://stackoverflow.com/users/2881849/mikemb"}, "reply_to_user": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 1, "creation_date": 1472078300, "post_id": 39133589, "comment_id": 65613460, "body": "@KeithThompson: Fixed. Thank you."}], "tags": [], "owner": {"reputation": 17408, "user_id": 2881849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5a2fd0122f50f7582be15be3062c5b71?s=128&d=identicon&r=PG&f=1", "display_name": "MikeMB", "link": "https://stackoverflow.com/users/2881849/mikemb"}, "is_accepted": true, "score": 4, "last_activity_date": 1472077579, "last_edit_date": 1472077579, "creation_date": 1472075514, "answer_id": 39133589, "question_id": 39131893, "link": "https://stackoverflow.com/questions/39131893/return-value-of-stdstrftime/39133589#39133589", "title": "Return value of std::strftime", "body": "<p>As far as I can tell and as others have wrote in the comments, above code is most probably undefined behavior according to the ISO C or C++ standard and as far as my own experiments are concerned will crash when compiled with VS2015.</p>\n\n<p>However, as far as glibc is concerned, @rici was spot on:</p>\n\n<p>From the documentation of <a href=\"http://www.gnu.org/software/libc/manual/html_node/Formatting-Calendar-Time.html\" rel=\"nofollow\">The GNU C Library</a>:</p>\n\n<blockquote>\n  <p>If s is a null pointer, strftime does not actually write anything, but instead returns the number of characters it would have written. </p>\n</blockquote>\n"}], "owner": {"reputation": 17408, "user_id": 2881849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5a2fd0122f50f7582be15be3062c5b71?s=128&d=identicon&r=PG&f=1", "display_name": "MikeMB", "link": "https://stackoverflow.com/users/2881849/mikemb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 663, "favorite_count": 0, "accepted_answer_id": 39133589, "answer_count": 1, "score": 5, "last_activity_date": 1472077844, "creation_date": 1472068068, "last_edit_date": 1472077844, "question_id": 39131893, "link": "https://stackoverflow.com/questions/39131893/return-value-of-stdstrftime", "title": "Return value of std::strftime", "body": "<p>I think I read somewhere that if I pass a nullptr to <a href=\"http://en.cppreference.com/w/cpp/chrono/c/strftime\" rel=\"nofollow\">std::strftime</a>, the function would return the required buffer size. And indeed, the following code works perfectly well on numerous linux systems I've tried it on (not when compiled with VS though): </p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;ctime&gt;\n#include &lt;string&gt;\n\nint main()\n{\n    std::time_t time{};\n    std::tm const * ltime = std::localtime(&amp;time);\n\n    const char * formatString = \"%Y-%b-%d\";\n    //allocate buffer of appropriate size\n    auto requiredSize = 1 + std::strftime(nullptr, 50, formatString, ltime);\n    std::cout &lt;&lt; \"Required buffer size:\" &lt;&lt; requiredSize &lt;&lt; \"\\n\";\n\n    //Format time to string\n    std::string buff(requiredSize, ' ');\n    std::strftime(&amp;buff[0], requiredSize, formatString, ltime);\n\n    std::cout &lt;&lt; buff &lt;&lt; std::endl;\n}\n</code></pre>\n\n<p>However, I was unable to find my original source or any other documentation that would specify this behavior. So my question is:</p>\n\n<ul>\n<li>On which systems / compilers / standard library implementations (if any) is this a guaranteed behavior?</li>\n<li>Where can I find the according documentation?</li>\n</ul>\n\n<p>Edit: I added the C label, as I've seen the same result with equivalent C code and at least with gcc/g++ (or rather glibc/libstdc++) <code>std::strftime</code> is probably just an alias for the c-function <code>strftime</code> anyway. </p>\n"}, {"tags": ["c", "visual-studio-2015", "c99"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 5, "creation_date": 1472067951, "post_id": 39131841, "comment_id": 65609003, "body": "Do not &quot;live with&quot; warnings. The size of the <code>struct</code> is unknown. If you don&#39;t know the size of the array, define that member as a pointer, and allocate memory as required."}, {"owner": {"reputation": 9550, "user_id": 338479, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/nYkXL.jpg?s=128&g=1", "display_name": "Edward Falk", "link": "https://stackoverflow.com/users/338479/edward-falk"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1472068219, "post_id": 39131841, "comment_id": 65609150, "body": "I agree. I don&#39;t want to live with warnings, I want to fix them. However, the use of an incomplete array as the last element of a struct <i>is</i> supported in C-99. The use of zero-length arrays has been an extension in both GNU C and Windows C for many years. <a href=\"https://en.wikipedia.org/wiki/Flexible_array_member\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Flexible_array_member</a>"}, {"owner": {"reputation": 9550, "user_id": 338479, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/nYkXL.jpg?s=128&g=1", "display_name": "Edward Falk", "link": "https://stackoverflow.com/users/338479/edward-falk"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1472068322, "post_id": 39131841, "comment_id": 65609213, "body": "I should also add: this is older code that I&#39;m in charge of supporting. I didn&#39;t write it and I can&#39;t change it."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1472068380, "post_id": 39131841, "comment_id": 65609235, "body": "No, MSVC does not support 0 length arrays. If you want a <code>struct</code> to overflow into allocated memory (from its last member), define the member string as <code>[1]</code> and let it overflow, into the correctly allocated memory."}, {"owner": {"reputation": 9550, "user_id": 338479, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/nYkXL.jpg?s=128&g=1", "display_name": "Edward Falk", "link": "https://stackoverflow.com/users/338479/edward-falk"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1472068499, "post_id": 39131841, "comment_id": 65609302, "body": "Actually, it does, but as an extension. I can suppress the warning with a pragma, but I&#39;d rather do this &quot;right&quot;, which means changing the zero-length array (which is what the code originally was) to a flexible array member and then getting the compiler to accept C99 code."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1472068529, "post_id": 39131841, "comment_id": 65609317, "body": "Please cite which extension this is."}, {"owner": {"reputation": 9550, "user_id": 338479, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/nYkXL.jpg?s=128&g=1", "display_name": "Edward Falk", "link": "https://stackoverflow.com/users/338479/edward-falk"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1472068911, "post_id": 39131841, "comment_id": 65609515, "body": "<a href=\"https://msdn.microsoft.com/en-us/library/79wf64bc.aspx\" rel=\"nofollow noreferrer\">msdn.microsoft.com/en-us/library/79wf64bc.aspx</a> -- key text is &quot;Declaration of a zero-sized array is a Microsoft extension&quot;"}, {"owner": {"reputation": 9550, "user_id": 338479, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/nYkXL.jpg?s=128&g=1", "display_name": "Edward Falk", "link": "https://stackoverflow.com/users/338479/edward-falk"}, "edited": false, "score": 0, "creation_date": 1472068960, "post_id": 39131841, "comment_id": 65609538, "body": "Anyway, as I said, I don&#39;t want to use zero-length arrays, I want to use flexible arrays as supported in C99"}, {"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 2, "creation_date": 1472069286, "post_id": 39131841, "comment_id": 65609701, "body": "MSVC is C99 nonconformity. (Apply to some)"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1472069295, "post_id": 39131841, "comment_id": 65609706, "body": "Actually, within a <code>struct</code> the member <code>char z[]</code> is accepted by MSVC, as a zero-length member, so please accept my apologies."}, {"owner": {"reputation": 9550, "user_id": 338479, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/nYkXL.jpg?s=128&g=1", "display_name": "Edward Falk", "link": "https://stackoverflow.com/users/338479/edward-falk"}, "edited": false, "score": 0, "creation_date": 1472079464, "post_id": 39131841, "comment_id": 65613770, "body": "BLUEPIXY, change your comment to an answer and I&#39;ll accept it. I was hoping there was some compiler flag I could set, but apparently not."}, {"owner": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1472149585, "post_id": 39131841, "comment_id": 65648171, "body": "@Weather Vane: Why? This is a perfectly cromulent C99 feature, supported by Visual Studio. It just so happens that at this stage support for such features is sometimes accomnanied by spurios warnings."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "edited": false, "score": 0, "creation_date": 1472149814, "post_id": 39131841, "comment_id": 65648285, "body": "@AnT perhpas you missed my later remark, apologising for the oversight, after I discovered that MSVC does accept an <code>array[]</code> as a <code>struct</code> member, but not as a plain variable. However it must the <i>last</i> member of the struct. Otherwise it&#39;s an error not a warning."}, {"owner": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "edited": false, "score": 1, "creation_date": 1472150375, "post_id": 39131841, "comment_id": 65648597, "body": "@Edward Falk: Firstly, despite what was stated by other people above, VS 2015 is C99 conformant (with maybe some remaining issues in the library). Secondly, the difference between zero-length array and flexible-array member is purely superficial. It would be prefectly conformant to implement flexible-array member as zero-length array, which is exactly what MSVC is doing. The only issue here is that they accompany it with that spurious warning."}, {"owner": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1472150484, "post_id": 39131841, "comment_id": 65648644, "body": "@Weather Vane: Yes, precisely as required by C99. It must be the last member. Which immediately indicates that this is not some glitch, but rather a genuine attempt to implement C99 flexible-array member."}, {"owner": {"reputation": 870061, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 0, "creation_date": 1472150802, "post_id": 39131841, "comment_id": 65648787, "body": "It is a non-standard extension in C++.  It compiles clean without a warning as long as you compile your source code as C.  Renaming the filename extension to .c is the simplest way.  And of course it is important to name the VS version you use, C99 compatibility is not complete until VS2015."}, {"owner": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "reply_to_user": {"reputation": 870061, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 1, "creation_date": 1472151523, "post_id": 39131841, "comment_id": 65649127, "body": "@Hans Passant: It should be noted that VS2015 <i>does</i> issue a warning <i>in pure C code</i> in Update 1 version, but produces no warning in Update 3 version (I have no Update 2 to test). This is apparently one of the changes made between Update 1 and Update 3."}], "answers": [{"comments": [{"owner": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "edited": false, "score": 1, "creation_date": 1472150855, "post_id": 39133330, "comment_id": 65648810, "body": "The code in the OP is a perfectly legitimate and well-known feature of C language. It is not an &quot;array of undefined length&quot;. It is a C99 flexible-array member. And no, it cannot meake the program crash if you use it properly."}, {"owner": {"reputation": 3350, "user_id": 7332147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e4GFL.png?s=128&g=1", "display_name": "linuxfan says Reinstate Monica", "link": "https://stackoverflow.com/users/7332147/linuxfan-says-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1540143315, "post_id": 39133330, "comment_id": 92745901, "body": "Also, you mention cache memory which is out of topic."}], "tags": [], "owner": {"reputation": 1, "user_id": 6754490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec8a8fad3c8779ee307de9fe2eccc195?s=128&d=identicon&r=PG", "display_name": "DontUseGoTo", "link": "https://stackoverflow.com/users/6754490/dontusegoto"}, "is_accepted": false, "score": 0, "last_activity_date": 1472074198, "creation_date": 1472074198, "answer_id": 39133330, "question_id": 39131841, "link": "https://stackoverflow.com/questions/39131841/visual-studio-treats-incomplete-arrays-as-zero-length-arrays/39133330#39133330", "title": "Visual studio treats incomplete arrays as zero-length arrays", "body": "<p>When you create an array of undefined length (in your case in a struct) it is unknown how much memory needs to be allocated for it. When using variable 'info' it is therefore unknown where in the cache memory of the computer the program is writing or reading. This can make the program crash. Normally when you want to use an array of undefined length a pointer is used. Memory can be allocated for this pointer when it is known how large the array should be.</p>\n\n<p>The compiler warns you about the problem I described above but lets you execute the code (at least it does in Microsoft Visual studio 2013).</p>\n\n<p>Hope this helps you!</p>\n"}, {"comments": [{"owner": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "edited": false, "score": 0, "creation_date": 1472151026, "post_id": 39134211, "comment_id": 65648895, "body": "&quot;...and seeing how many places use zero-length arrays. This is a very commonly used idiom.&quot; It is a broken idiom that propagates due to laziness and/or incompetence of some Linux programmers (and GCC compiler catering to that laziness). The proper form of that idiom in pre-C99 language implies using <code>[1]</code> for the flexible member (as in your original example), not <code>[0]</code>."}, {"owner": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "edited": false, "score": 1, "creation_date": 1472151201, "post_id": 39134211, "comment_id": 65648979, "body": "Your <code>- 1</code> argument is not valid, since the alternative (proper) way to calculate the size in <code>[1]</code> variant would be <code>offsetof(mydata, data) + len</code>. See? No need to subtract that <code>1</code> anymore. Suprisingly enough, a significant number of so called &quot;professional&quot; programmers are blissfully unaware of such standard feature of the language as <code>offsetof</code> macro (to the point of trying to re-implement it manually, despite it being readily avaliable already)."}, {"owner": {"reputation": 9550, "user_id": 338479, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/nYkXL.jpg?s=128&g=1", "display_name": "Edward Falk", "link": "https://stackoverflow.com/users/338479/edward-falk"}, "reply_to_user": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "edited": false, "score": 0, "creation_date": 1472160388, "post_id": 39134211, "comment_id": 65653452, "body": "Perhaps. I&#39;ve never used that idiom myself. I&#39;ve always just used something like <code>char *datap = &amp;mydatap-&gt;data[0];</code>, or (in the case where <code>struct mydata</code> had no <code>data</code> element at all) <code>char *datap = ((char *)mydatap) + sizeof(*mydatap);</code>."}, {"owner": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "edited": false, "score": 0, "creation_date": 1472161591, "post_id": 39134211, "comment_id": 65653901, "body": "I&#39;m not sure what you mean in the last comment. My comment was referring specifically to the method of calculating the size for <code>malloc</code>: replace <code>sizeof(*rval) + len - 1</code> with <code>offsetof(mydata, data) + len</code> and there&#39;s no need to subtract <code>1</code> anymore regardless of how <code>data</code> member is declared (with <code>[]</code>, <code>[0]</code>, <code>[1]</code> or even <code>[1024]</code>). Meanwhile <code>char *datap = &amp;mydatap-&gt;data[0]</code> is a completely different story that works in either case. I don&#39;t understand why you are mentioning it."}, {"owner": {"reputation": 9550, "user_id": 338479, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/nYkXL.jpg?s=128&g=1", "display_name": "Edward Falk", "link": "https://stackoverflow.com/users/338479/edward-falk"}, "reply_to_user": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "edited": false, "score": 0, "creation_date": 1472161789, "post_id": 39134211, "comment_id": 65653975, "body": "Meh. Doesn&#39;t matter. Bottom line is that I can&#39;t significantly change the code; I just want the warning to go away. I thought there might be a way to tell the compiler to use C99 standard."}, {"owner": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "edited": false, "score": 1, "creation_date": 1472161873, "post_id": 39134211, "comment_id": 65654015, "body": "As I said above, this warning is no longer produced for C code in VS 2015 Update 3. Microsoft fixed this issue already."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "edited": false, "score": 0, "creation_date": 1472504139, "post_id": 39134211, "comment_id": 65768796, "body": "@AnT: The size-one form will invoke UB if code ever tries to access anything other than the first member.  The proper way the construct should have been handled would have been to allow what some pre-C89 compilers did, which is to treat zero-sized arrays as zero-byte allocations which are aligned for the appropriate type, and refrain from making any assumptions about the indices used to access them.  As it is, avoiding UB requires declaring an array large enough to accommodate the maximum index with which it will be used."}], "tags": [], "owner": {"reputation": 9550, "user_id": 338479, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/nYkXL.jpg?s=128&g=1", "display_name": "Edward Falk", "link": "https://stackoverflow.com/users/338479/edward-falk"}, "is_accepted": false, "score": 2, "last_activity_date": 1540136645, "last_edit_date": 1540136645, "creation_date": 1472079285, "answer_id": 39134211, "question_id": 39131841, "link": "https://stackoverflow.com/questions/39131841/visual-studio-treats-incomplete-arrays-as-zero-length-arrays/39134211#39134211", "title": "Visual studio treats incomplete arrays as zero-length arrays", "body": "<p>For those who are curious about the zero-length array or \"flexible array\" idioms, it's probably worth taking a minute to explain them. This idiom is as old as C itself.</p>\n\n<p>Say you want to pass around a structure that consists of a header and a variable amount of data. It's not known until the structure is allocated how much data will need to be added to it.</p>\n\n<p>The original idiom was to declare the structure like this:</p>\n\n<pre><code>/* Variation 1 */\nstruct mydata {\n    int type;\n    int datalen;\n    char data[1];\n};\n</code></pre>\n\n<p>Then suppose we wanted to return one of these objects:</p>\n\n<pre><code>struct mydata *\nget_some_data()\n{\n    int len;\n    struct mydata *rval;\n    len = find_out_how_much_data();\n    /* Allocate the struct AND enough extra space to hold the data */\n    rval = malloc(sizeof(*rval) + len - 1);\n    rval-&gt;datalen = len;\n    read_data(&amp;rval-&gt;data[0], len);\n    return rval;\n}\n</code></pre>\n\n<p>And a caller would access it like this:</p>\n\n<pre><code>void caller()\n{\n    struct mydata *foo = get_some_data();\n    /* Start accessing foo-&gt;datalen bytes of data starting at\n     * foo-&gt;data[0]\n     */\n    free(foo);     /* And free it all */\n}\n</code></pre>\n\n<p>The point to this idiom is that the <code>char data[1]</code> declaration is a lie, since the data will surely be longer than that, but the C compiler doesn't do range checking, so everything is cool.</p>\n\n<p>But notice the <code>len - 1</code> expression in the malloc. This is necessary because declaring data to have a length 1 introduces an off-by-one error into everything, and invites coders to make mistakes.</p>\n\n<p>So both GNU and Microsoft added an extension to the language that allows you to declare an array of length zero:</p>\n\n<pre><code>/* Variation 2 */\nstruct mydata {\n    int type;\n    int datalen;\n    char data[0];\n};\n</code></pre>\n\n<p>While on the surface, this is nonsensical, it dovetails neatly with the idiom used here. Now we can simply do:</p>\n\n<pre><code>rval = malloc(sizeof(*rval) + len);\n</code></pre>\n\n<p>and the code is much cleaner.</p>\n\n<p>C99 formalized this idiom by acknowledging that the length of the array is a lie, but the ability to have extra data at the end of the structure comes in very handy. So now you declare:</p>\n\n<pre><code>/* Variation C99 */\nstruct mydata {\n    int type;\n    int datalen;\n    char data[];\n};\n</code></pre>\n\n<p>and everything is coded up exactly as with the Gnu/Microsoft extension.</p>\n\n<p>Unfortunately, it seems that Microsoft hasn't adopted C99 standards into their compiler, so no matter what you do, variations 2 and C99 will generate a warning. It looks like my only choices are to either live with the warning message or add a pragma to suppress it.</p>\n\n<p>Linux users may amuse themselves by executing <code>gr -r '\\[0\\]' /usr/include</code> and seeing how <em>many</em> places use zero-length arrays. This is a very commonly used idiom.</p>\n\n<p>As to my own issue: the struct I'm working with is actually part of an ioctl. The driver has already been written and I can't change it. The very most I can do is redefine the array from zero-length to flexible. Unfortunately, neither option makes the MSVC compiler happy.</p>\n"}, {"tags": [], "owner": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "is_accepted": true, "score": 3, "last_activity_date": 1472308617, "last_edit_date": 1472308617, "creation_date": 1472149499, "answer_id": 39152330, "question_id": 39131841, "link": "https://stackoverflow.com/questions/39131841/visual-studio-treats-incomplete-arrays-as-zero-length-arrays/39152330#39152330", "title": "Visual studio treats incomplete arrays as zero-length arrays", "body": "<p>Visual Studio 2015 [almost] fully implements C99, but still treats all C99 features as <em>language extensions</em> (e.g. disabling language extensions disables C99 support as well). Some of these features trigger spurious warnings like the one you observed. </p>\n\n<p>As long as C99 support remains in this semi-official \"extension\" status, just ignore/disable such warnings.</p>\n\n<p>Note that VS2015 Update 3 no longer issues this warning for such C code.</p>\n"}], "owner": {"reputation": 9550, "user_id": 338479, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/nYkXL.jpg?s=128&g=1", "display_name": "Edward Falk", "link": "https://stackoverflow.com/users/338479/edward-falk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1238, "favorite_count": 0, "accepted_answer_id": 39152330, "answer_count": 3, "score": 3, "last_activity_date": 1540136645, "creation_date": 1472067829, "last_edit_date": 1472149145, "question_id": 39131841, "link": "https://stackoverflow.com/questions/39131841/visual-studio-treats-incomplete-arrays-as-zero-length-arrays", "title": "Visual studio treats incomplete arrays as zero-length arrays", "body": "<p>I have a struct that looks sort of like this:</p>\n\n<pre><code>typedef struct foo {\n    int this;\n    int that;\n    int length;\n    int info[];     // legal for last element of a struct \n} Foo;\n</code></pre>\n\n<p>When I compile it, I get an warning like this:</p>\n\n<pre><code>C4200 nonstandard extension used: zero-sized array in struct/union\n</code></pre>\n\n<p>Do I just live with the warning, or is there some property I can set to tell Visual Studio to use C-99?</p>\n"}, {"tags": ["c"], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 5866885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4413f026d3ea7268e07609e8004274be?s=128&d=identicon&r=PG&f=1", "display_name": "someone", "link": "https://stackoverflow.com/users/5866885/someone"}, "edited": false, "score": 0, "creation_date": 1472070290, "post_id": 39132179, "comment_id": 65610160, "body": "wow thank you very much! i understand things much better now! now all i have to do is attach the body same way you did the header right?"}, {"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "reply_to_user": {"reputation": 91, "user_id": 5866885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4413f026d3ea7268e07609e8004274be?s=128&d=identicon&r=PG&f=1", "display_name": "someone", "link": "https://stackoverflow.com/users/5866885/someone"}, "edited": false, "score": 0, "creation_date": 1472071942, "post_id": 39132179, "comment_id": 65610957, "body": "Since a streaming protocol (TCP) is used, the header and body can be output using separate <code>send</code>/<code>write</code> calls. But I&#39;ve modified my answer to build the whole packet at once. Don&#39;t forget to <code>free</code> it!"}, {"owner": {"reputation": 91, "user_id": 5866885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4413f026d3ea7268e07609e8004274be?s=128&d=identicon&r=PG&f=1", "display_name": "someone", "link": "https://stackoverflow.com/users/5866885/someone"}, "edited": false, "score": 0, "creation_date": 1472072122, "post_id": 39132179, "comment_id": 65611041, "body": "ohh i didn&#39;t know i can do 2 <b>sends</b> functions to send 1 packet thanks for the information :)"}], "tags": [], "owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "is_accepted": true, "score": 3, "last_activity_date": 1472072128, "last_edit_date": 1472072128, "creation_date": 1472069158, "answer_id": 39132179, "question_id": 39131805, "link": "https://stackoverflow.com/questions/39131805/how-do-i-build-a-protocol-header-and-body-over-a-tcp-socket-in-c/39132179#39132179", "title": "how do I build a protocol header and body over a tcp socket in C", "body": "<p>What you have doesn't produce the right output at all!</p>\n\n<p>The following is portable:</p>\n\n<pre><code>#include &lt;stdint.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nuint8_t* pack_uint8(uint8_t* dest, uint8_t src) {\n   *(dest++) = src;\n   return dest;\n}\n\nuint8_t* pack_uint32be(uint8_t* dest, uint32_t src) {\n   *(dest++) = src &gt;&gt; 24;\n   *(dest++) = (src &gt;&gt; 16) &amp; 0xFF;\n   *(dest++) = (src &gt;&gt; 8) &amp; 0xFF;\n   *(dest++) = src &amp; 0xFF;\n   return dest;\n}\n\nuint8_t* build_packet(\n   uint8_t maj_version,\n   uint8_t min_version,\n   uint8_t type,\n   uint8_t seq,\n   uint8_t flags,\n   uint32_t session_id,\n   uint32_t body_length,\n   const uint8_t* body\n) {\n   uint8_t* packet = malloc(12 + body_length);\n   uint8_t* p = packet;\n   p = pack_uint8(p, ( maj_version &lt;&lt; 4 ) | min_version);\n   p = pack_uint8(p, type);\n   p = pack_uint8(p, seq);\n   p = pack_uint8(p, flags);\n   p = pack_uint32be(p, session_id);\n   p = pack_uint32be(p, body_length);\n   memcpy(p, body, body_length);\n   return packet;\n}\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 5866885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4413f026d3ea7268e07609e8004274be?s=128&d=identicon&r=PG&f=1", "display_name": "someone", "link": "https://stackoverflow.com/users/5866885/someone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 522, "favorite_count": 0, "accepted_answer_id": 39132179, "answer_count": 1, "score": 2, "last_activity_date": 1484333080, "creation_date": 1472067697, "last_edit_date": 1484333080, "question_id": 39131805, "link": "https://stackoverflow.com/questions/39131805/how-do-i-build-a-protocol-header-and-body-over-a-tcp-socket-in-c", "title": "how do I build a protocol header and body over a tcp socket in C", "body": "<p>I'm writing a tacacs+ client,</p>\n\n<p>I'm trying to write a simple packet to send to the server,\nI checked <a href=\"https://tools.ietf.org/html/draft-grant-tacacs-02\" rel=\"nofollow noreferrer\">the RFC page</a> and I saw the protocol needs to get this header in every packet:</p>\n\n<pre><code>    +----------------+----------------+----------------+----------------+\n    |major  | minor  |                |                |                |\n    |version| version|      type      |     seq_no     |   flags        |\n    +----------------+----------------+----------------+----------------+\n    |                                                                   |\n    |                            session_id                             |\n    +----------------+----------------+----------------+----------------+\n    |                                                                   |\n    |                              length                               |\n    +----------------+----------------+----------------+----------------+\n</code></pre>\n\n<p>now I'm pretty new with this,\nand I'm not sure how do I build this header,\nis creating a buffer like this good enough?:</p>\n\n<pre><code>snprintf(buffer, sizeof(buffer), \"%x%x%x%x%x\",version,version,type,seq,flags,session_id,length);\n</code></pre>\n\n<p>and then take this buffer and attach it the body in the same way and send:</p>\n\n<pre><code>send(socket,buffer,sizeof(buffer),0);\n</code></pre>\n\n<p>or is there another way of doing this whole packet building?</p>\n"}, {"tags": ["c", "binary"], "comments": [{"owner": {"reputation": 1439, "user_id": 5196093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ovj7.png?s=128&g=1", "display_name": "Ray", "link": "https://stackoverflow.com/users/5196093/ray"}, "edited": false, "score": 1, "creation_date": 1472069344, "post_id": 39131665, "comment_id": 65609734, "body": "Out of curiosity, why are you doing this?  It seems an odd conversion, given that under it, e.g. 3 &gt; 3221225471 (0.11 &gt; 0.10111111111111111111111111111111) and 2 = 1 (0.10 = .1)."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 0, "creation_date": 1472069697, "post_id": 39131665, "comment_id": 65609892, "body": "I imagine there is a strange structure being used to represent a floating point value."}, {"owner": {"reputation": 1235, "user_id": 1904755, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/68879b1c8cb87f19c86a3b48ad573d1c?s=128&d=identicon&r=PG", "display_name": "&#233;tale-cohomology", "link": "https://stackoverflow.com/users/1904755/%c3%a9tale-cohomology"}, "reply_to_user": {"reputation": 1439, "user_id": 5196093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ovj7.png?s=128&g=1", "display_name": "Ray", "link": "https://stackoverflow.com/users/5196093/ray"}, "edited": false, "score": 0, "creation_date": 1472771749, "post_id": 39131665, "comment_id": 65898768, "body": "@Ray So the original motivation is to <a href=\"http://www.americanscientist.org/include/popup_fullImage.aspx?key=mAGyoWpHKxq4DbGJIaAyrUVGvdPDqRmPFA5WsU8dgjqivkZFgKQb4A==\" rel=\"nofollow noreferrer\">construct a Sobol sequence like this</a>, but I made I mistake and this question doesn&#39;t actually help with that! (I think.) Hopefully it helps someone someday."}, {"owner": {"reputation": 1439, "user_id": 5196093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ovj7.png?s=128&g=1", "display_name": "Ray", "link": "https://stackoverflow.com/users/5196093/ray"}, "edited": false, "score": 1, "creation_date": 1472773424, "post_id": 39131665, "comment_id": 65899187, "body": "Ah, that makes a bit more sense.  jxh&#39;s solution is still basically the right approach; you just need to loop over the bits in the opposite direction in order to reverse the sequence.  <code>for (int bit = CHAR_BIT * sizeof(unsigned) - 1; bit &gt;= 0; bit--) { x += (input &gt;&gt; bit) &amp; 1; x &#47;= 10.0; }</code>"}], "answers": [{"comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1472069012, "post_id": 39131908, "comment_id": 65609567, "body": "But what if we want <code>0.0101</code>? Actually this question is for the OP"}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1472069186, "post_id": 39131908, "comment_id": 65609642, "body": "@EugeneSh.: Right, the OP&#39;s problem doesn&#39;t make that scenario possible. It seems like the input is already normalized."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1472069306, "post_id": 39131908, "comment_id": 65609717, "body": "So the problem statement would be &quot;Binary integer to fraction between <i>0.1</i> and <i>0.111(1)</i>&quot;."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1472069351, "post_id": 39131908, "comment_id": 65609740, "body": "@EugeneSh.: Well, 0 is possible."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1472069403, "post_id": 39131908, "comment_id": 65609763, "body": "Yeah. Which makes me wonder about the application of such a strange conversion"}, {"owner": {"reputation": 1235, "user_id": 1904755, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/68879b1c8cb87f19c86a3b48ad573d1c?s=128&d=identicon&r=PG", "display_name": "&#233;tale-cohomology", "link": "https://stackoverflow.com/users/1904755/%c3%a9tale-cohomology"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1472771641, "post_id": 39131908, "comment_id": 65898739, "body": "@EugeneSh. So what if we want <code>0.0101</code>? Well, that number is not in the range of this transformation/function (I think)."}], "tags": [], "owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "is_accepted": true, "score": 3, "last_activity_date": 1472068112, "creation_date": 1472068112, "answer_id": 39131908, "question_id": 39131665, "link": "https://stackoverflow.com/questions/39131665/binary-integer-to-fraction-between-0-and-1-in-base-10-in-c/39131908#39131908", "title": "Binary integer to fraction between 0 and 1 in base 10, in C", "body": "<p>You don't need to convert into a string. C has binary operators that work just fine for this purpose.</p>\n\n<pre><code>double binary_inverse (unsigned input) {\n    double x = 0;\n    while (input) {\n        x += input &amp; 0x1;\n        x /= 10;\n        input &gt;&gt;= 1;\n    }\n    return x;\n}\n</code></pre>\n"}], "owner": {"reputation": 1235, "user_id": 1904755, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/68879b1c8cb87f19c86a3b48ad573d1c?s=128&d=identicon&r=PG", "display_name": "&#233;tale-cohomology", "link": "https://stackoverflow.com/users/1904755/%c3%a9tale-cohomology"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 39131908, "answer_count": 1, "score": 2, "last_activity_date": 1472068112, "creation_date": 1472067201, "last_edit_date": 1472067940, "question_id": 39131665, "link": "https://stackoverflow.com/questions/39131665/binary-integer-to-fraction-between-0-and-1-in-base-10-in-c", "title": "Binary integer to fraction between 0 and 1 in base 10, in C", "body": "<p>Eg. how can I transform the integer <code>7</code> to the float <code>0.111</code>?</p>\n\n<p>The naive way would be to convert <code>7</code> to the string <code>111</code>, convert that to the integer <code>111</code> and then divide by 1000 to get <code>0.111</code>. Is there a better/faster way, though?</p>\n\n<p>Here's a working example.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;stdlib.h&gt;\n\n// Convert 32-bit uint to string\n// http://stackoverflow.com/questions/699968/display-the-binary-representation-of-a-number-in-c\nconst char* bin(uint32_t n){\n    uint N = 32;\n    static unsigned char ucharBuffer[32+1];\n    char *p_buffer = ucharBuffer;\n\n    if(!n)\n        return \"0\";\n\n    // Work from the end of the buffer back\n    p_buffer += N;\n    *p_buffer-- = '\\0';\n\n    //For each bit (going backwards) store character\n    while(n){\n        if (N-- == 0)\n            return NULL;\n        *p_buffer-- = ((n &amp; 1) == 1) ? '1' : '0';\n        n &gt;&gt;= 1;}\n\n    return p_buffer+1;}\n\n\nint main(){\n\n    uint INPUT = 7;\n    const char *p = bin(INPUT);\n    char *end;\n\n    printf(\"%d -&gt; \", INPUT);\n    printf(\"'%.*s' -&gt; \", (uint)(end-p), p);\n    printf(\"%.3f\\n\", (double) strtol(p, &amp;end, 10)/1000);\n\n}\n</code></pre>\n"}, {"tags": ["c", "arrays", "cilk-plus"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 6754077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/035e130b572698af323f92a7d83edba0?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Aubanel", "link": "https://stackoverflow.com/users/6754077/eric-aubanel"}, "edited": false, "score": 0, "creation_date": 1472497665, "post_id": 39147593, "comment_id": 65765520, "body": "Thanks, I installed v. 6.1 and it works fine. Surprised that it took this recent a version for this work."}], "tags": [], "owner": {"reputation": 96, "user_id": 5091287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c734d421cbb3d953979fe9f43b674e3e?s=128&d=identicon&r=PG&f=1", "display_name": "Hansang Bae", "link": "https://stackoverflow.com/users/5091287/hansang-bae"}, "is_accepted": false, "score": 0, "last_activity_date": 1472134191, "creation_date": 1472134191, "answer_id": 39147593, "question_id": 39131648, "link": "https://stackoverflow.com/questions/39131648/cilk-plus-array-notation-not-vectorized-with-gcc-4-9-0/39147593#39147593", "title": "cilk plus array notation not vectorized with gcc 4.9.0", "body": "<p>It looks like only the latest version of GCC (6.1) can vectorize your example:</p>\n\n<p><a href=\"http://melpon.org/wandbox/permlink/LOIweYNRRLXeJsZf\" rel=\"nofollow\">http://melpon.org/wandbox/permlink/LOIweYNRRLXeJsZf</a></p>\n"}], "owner": {"reputation": 1, "user_id": 6754077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/035e130b572698af323f92a7d83edba0?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Aubanel", "link": "https://stackoverflow.com/users/6754077/eric-aubanel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1472134191, "creation_date": 1472067149, "question_id": 39131648, "link": "https://stackoverflow.com/questions/39131648/cilk-plus-array-notation-not-vectorized-with-gcc-4-9-0", "title": "cilk plus array notation not vectorized with gcc 4.9.0", "body": "<p>I'm trying to figure out why gcc 4.9.0 won't vectorize a simple array addition when using gcc 4.9.0, using -O -ftree-vectorize:</p>\n\n<pre><code>int a[256], b[256], c[256];\nfoo () {\n  int i;\n  a[:] = b[:] + c[:];\n}\n</code></pre>\n\n<p>From looking at the assembler produced this loop hasn't been vectorized and with the -fopt-info-vec-all flag I get a lot of output telling me why vectorization failed, beginning with:</p>\n\n<pre><code>&gt;testvec.c:5: note: ===== analyze_loop_nest ===== \n&gt;testvec.c:5: note: === vect_analyze_loop_form === \n&gt;testvec.c:5: note: not vectorized: control flow in loop. \n&gt;testvec.c:5: note: bad loop form.\n</code></pre>\n\n<p>which is puzzling, since there's not control flow in the loop. Vectorization of the <code>for</code> loop using standard array notation for the same operation works fine.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1472065411, "post_id": 39130984, "comment_id": 65607715, "body": "Start simple - fix your indentation."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1472065416, "post_id": 39130984, "comment_id": 65607717, "body": "If I could solve this problem, I would submit it directly to Hacker Rank, but thanks for the opportunity to be your proxy. Those sites are about <i>your</i> abilities."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1472065531, "post_id": 39130984, "comment_id": 65607777, "body": "What line is the segmentation fault happening on? You should try stepping through the program with a debugger, examining the values of your strings at various steps to see when they&#39;ve become corrupted."}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 1, "creation_date": 1472068122, "post_id": 39130984, "comment_id": 65609096, "body": "When harkening back to hackerrank, consider this: Do you really, <i>really</i> need an array of char array ? Once know the number of test cases, isn&#39;t the actual handling of each case independent of all the others? Why bother storing all those strings when you can just handle them one at a time <i>as you read them</i> ? If anything it would declutter your code significantly."}], "answers": [{"tags": [], "owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "is_accepted": true, "score": 0, "last_activity_date": 1472073183, "creation_date": 1472073183, "answer_id": 39133118, "question_id": 39130984, "link": "https://stackoverflow.com/questions/39130984/segmentation-fault-core-dumped-programming-in-c/39133118#39133118", "title": "Segmentation fault (core dumped) programming in C", "body": "<p><code>t</code> can be <code>10^5</code> or 100,000. Your <code>c</code> array is <code>c[t][100]</code>, so the size of that is <code>100000 * 100</code>, which is 10,000,000. You're probably getting a stack overflow.</p>\n\n<p>As WhozCraig pointed out, the processing of each case is independent. Thus, <code>c</code> can be a one dimensional array: <code>char c[100]</code>. Change all <code>c[t][...]</code> into <code>c[...]</code>.</p>\n\n<p>Adjust things so that you have one outer loop:</p>\n\n<pre><code>int\nmain()\n{\n    int t;\n    char c[100];\n\n    scanf(\"%d\", &amp;t);\n\n    for (int i = 0; i &lt; t; i++) {\n        scanf(\" %s\", c);\n        // do all processing for this line ...\n        n = strlen(c);\n    }\n\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 6634737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b7c6df5562346ef44aaf138ed2b2a0b?s=128&d=identicon&r=PG&f=1", "display_name": "rushank27", "link": "https://stackoverflow.com/users/6634737/rushank27"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 39133118, "answer_count": 1, "score": -3, "last_activity_date": 1472077040, "creation_date": 1472064707, "last_edit_date": 1472077040, "question_id": 39130984, "link": "https://stackoverflow.com/questions/39130984/segmentation-fault-core-dumped-programming-in-c", "title": "Segmentation fault (core dumped) programming in C", "body": "<p>I was solving the HackerRank problem given here : -- <a href=\"https://www.hackerrank.com/challenges/bigger-is-greater\" rel=\"nofollow\">https://www.hackerrank.com/challenges/bigger-is-greater</a></p>\n\n<p>Program statement is as follow : </p>\n\n<blockquote>\n  <p>Given a word, rearrange the letters to construct another word in such a way that is lexicographically greater than original one. In case of multiple possible answers, find the lexicographically smallest one among them.</p>\n</blockquote>\n\n<p>If you don't understand then just go to the link; they have explained with examples.</p>\n\n<p>I made the program as given below. In this program I have made two dimensional array. And variable <code>t</code> decides number of row and number is fix.</p>\n\n<p>Code is running as it should be when <code>t = 1</code>.\nBut when t is greater than 1 or some large number it gives error <strong>segmentation error</strong></p>\n\n<p>Code is as below :</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main() {\n\n    /* Enter your code here. Read input from STDIN. Print output to STDOUT */\n    int i,j,n,rot;\n    int t;\n    scanf(\"%d\",&amp;t);\n    char c[t][100];\n    char temp;\n    for(int i=0;i&lt;t;i++)\n    {\n        scanf(\" %s\",c[i]);\n    }\n    rot=t;\n    for(int t=0;t&lt;rot;t++)\n    {\n        n  = strlen(c[t]);\n        //printf(\"%d\\n\",n);\n        for(i=n-1;i&gt;=0;i--)\n        {\n            for(j=i-1;j&gt;=0;j--)\n            {\n                //printf(\"comparint %c and %c\\n\",c[t][i],c[t][j]);   //FOR DEBUG\n                if(c[t][i]&gt;c[t][j]) goto gotit;\n            }\n        }\n        printf(\"no answer\\n\");\n\n        continue;\n\n    gotit:\n        temp = c[t][i];\n        c[t][i]=c[t][j];\n        c[t][j]=temp;\n        n = (n-1)-j;\n        //printf(\"%s\\n\",c[t]);  //FOR DEBUG\n        //printf(\"%d %d %d\\n\",i,j,n); //FOR DEBUG\n\n        for(i=0;i&lt;n-1;i++)\n        {\n            for(int k=0;k&lt;n-1;k++)\n            {\n                //  printf(\"comparint %c and %c\\n\",c[t][j+k+1],c[t][j+k+2]);\n                if(c[t][j+k+1]&gt;c[t][j+k+2] )\n                {\n                    temp = c[t][j+k+1];\n                    c[t][j+k+1]=c[t][j+k+2];\n                    c[t][j+k+2]=temp;\n                }\n            }\n        }\n        printf(\"%s\\n\",c[t]);\n    }\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "arrays", "dynamic", "struct"], "comments": [{"owner": {"reputation": 35932, "user_id": 1606345, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/IwiIM.png?s=128&g=1", "display_name": "David Ranieri", "link": "https://stackoverflow.com/users/1606345/david-ranieri"}, "edited": false, "score": 0, "creation_date": 1472064098, "post_id": 39130762, "comment_id": 65606995, "body": "You are <code>realloc</code>ating the address of a local variable instead of <code>arr</code> in <code>main</code>, pass a pointer to pointer: <code>void add_one_element(struct data **arr, int *num_elements)</code> and <code>add_one_element(&amp;arr, &amp;num_elements);</code>"}, {"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 0, "creation_date": 1472064380, "post_id": 39130762, "comment_id": 65607153, "body": "Carefully stepping through your code in a debugger would quickly point out the problem to you."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472064473, "post_id": 39130762, "comment_id": 65607207, "body": "Something like <code>arr = realloc(arr, ...</code> is very bad practice! What if <code>realloc</code> returns a null pointer? You loose the array. First thing is to have proper error handling!"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1472064726, "post_id": 39130762, "comment_id": 65607365, "body": "Note that repeatedly adding one to an array with <code>realloc()</code> can lead to quadratic performance over time, in general, as it has to copy all the previous entries to the new location \u2014 in general. The normal technique is to (a) keep a record of the number of allocated entries as well as the number of entries in use, and (b) double the number of allocated entries when you need to allocate more. If, when you&#39;re finished adding, there is enough extra allocated space to warrant it, you could use a shrinking <code>realloc()</code> to return the unused space. &#39;Enough&#39; \u2014 depends; think 256 bytes or more, perhaps."}], "answers": [{"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 3, "last_activity_date": 1472064248, "creation_date": 1472064248, "answer_id": 39130857, "question_id": 39130762, "link": "https://stackoverflow.com/questions/39130762/resize-array-of-structs-within-a-function/39130857#39130857", "title": "Resize array of structs within a function", "body": "<p>You're correct that you need to pass in a <code>struct data **</code> to your function.  You would do it as follows:</p>\n\n<pre><code>void add_one_element(struct data **arr, int *num_elements)\n{\n  /*increment counter*/\n  *num_elements +=1;\n  *arr = realloc(*arr, *num_elements * sizeof(struct data));\n\n  strcpy((*arr)[*num_elements-1].s, \"ABC\");\n  for(int i = 0; i &lt; 10; i++)\n    (*arr)[*num_elements-1].arr[i] = i;\n}\n</code></pre>\n\n<p>So anyplace you were referencing <code>arr</code> in this function would change to <code>*arr</code>.  Note that this expression is parenthesized in order to access the array elements.</p>\n\n<p>Then you call the function like this:</p>\n\n<pre><code>add_one_element(&amp;arr, &amp;num_elements);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1472075139, "post_id": 39130983, "comment_id": 65612376, "body": "Alternatively, one could simply force an abnormal termination if the <code>realloc</code> returns null if targeting an implementation where a realloc failure would indicate that an unrecoverable failure was likely imminent."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "reply_to_user": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1472076390, "post_id": 39130983, "comment_id": 65612864, "body": "@supercat: That is a valid decision to make, but not something I would want an API that happens to perform allocation to do. I would rather the failure get logged and propagated back to the caller to decide if termination is required."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1472077132, "post_id": 39130983, "comment_id": 65613083, "body": "If a program&#39;s requirements would be satisfied if it terminates abnormally in case of memory shortage, but would not be satisfied if it writes to memory it does not own, an allocation API which is guaranteed to either succeed or terminate abnormally can make it easier to meet those requirements than would be possible on one that requires the caller to check every call for possible failure."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1472077476, "post_id": 39130983, "comment_id": 65613185, "body": "Further, some virtual memory systems only allocate physical pages to portions of a malloc block if/when they&#39;re accessed.  Such designs can work very well if code makes large allocations and ends up abandoning them while leaving significant chunks unused, but make it impossible to reliably recover from out-of-memory conditions.  If situations where malloc() or realloc() returns null are less common than those where out-of-memory faults cause a program to die when dereferencing a seemingly-valid pointer, there&#39;s not much point trying to gracefully handle the former."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "reply_to_user": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1472077612, "post_id": 39130983, "comment_id": 65613234, "body": "@supercat: There are exceptions, I am simply stating what I would prefer."}], "tags": [], "owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "is_accepted": false, "score": 2, "last_activity_date": 1472064700, "creation_date": 1472064700, "answer_id": 39130983, "question_id": 39130762, "link": "https://stackoverflow.com/questions/39130762/resize-array-of-structs-within-a-function/39130983#39130983", "title": "Resize array of structs within a function", "body": "<p>Since C passes by value, you cannot change the variable value for the caller without a reference. In C, this is done by dereferencing a pointer to the variable that the function needs to change. Thus, you need to pass in the pointer to the pointer variable.</p>\n\n<p>(In your edited change, you did not dereference the pointer variable.)</p>\n\n<p><code>realloc</code> may return NULL, and in that case, the original pointer has not been freed. So, you need to capture and test the result or <code>realloc</code> in a separate variable.</p>\n\n<pre><code>void add_one_element(struct data **arr, int *num_elements)\n{\n  struct data *tmp;\n  int tmp_num = *num_elements + 1;\n\n  /*increment counter*/\n  tmp = realloc(*arr, tmp_num * sizeof(struct data));\n  if (tmp == NULL) {\n      /* XXX: handle the error */\n      return;\n  }\n\n  strcpy(tmp[tmp_num-1].s, \"ABC\");\n  for(int i = 0; i &lt; 10; i++)\n    tmp[tmp_num-1].arr[i] = i;\n\n  *arr = tmp;\n  *num_elements = tmp_num;\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 5959424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e848d6a332beeff31c9ff59e8f3f75?s=128&d=identicon&r=PG", "display_name": "Allstar", "link": "https://stackoverflow.com/users/5959424/allstar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 0, "accepted_answer_id": 39130857, "answer_count": 2, "score": 3, "last_activity_date": 1472066858, "creation_date": 1472063948, "last_edit_date": 1472066858, "question_id": 39130762, "link": "https://stackoverflow.com/questions/39130762/resize-array-of-structs-within-a-function", "title": "Resize array of structs within a function", "body": "<p>I want to dynamically add new elements to a array of structs. I have added a minimal example that segfaults. I think I have to pass a pointer <code>struct data **arr</code> to the function to reallocate and add new element correctly, but I haven't been able to do it correctly.</p>\n\n<pre><code>#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\nstruct data {\n    char s[10];\n    int arr[10];\n};\n\nvoid add_one_element(struct data *arr, int *num_elements)\n{\n  /*increment counter*/\n  *num_elements +=1;\n  arr = realloc(arr, *num_elements * sizeof(struct data));\n\n  strcpy(arr[*num_elements-1].s, \"ABC\");\n  for(int i = 0; i &lt; 10; i++)\n    arr[*num_elements-1].arr[i] = i;\n}\n\n\nint main()\n{\n   struct data *arr = NULL;\n   int num_elements = 0;\n   add_one_element(arr, &amp;num_elements);\n\n   printf(\"arr.s = %s\\n\", arr[num_elements-1].s);\n   for(int i = 0; i &lt; 10; i++)\n        printf(\"arr[%d].arr[%d] = %d\\n\", num_elements-1, i, arr[num_elements-1].arr[i]);\n\n   free(arr);\n   return 0;\n}\n</code></pre>\n\n<p>EDIT 1: Tried to correct the problem. This time I get <code>test(91537,0x7fff79532000) malloc: *** error for object 0x7fff5f5c0ad0: pointer being realloc'd was not allocated</code>. Which suggest that the reallocation failed.</p>\n\n<pre><code>#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\nstruct data {\n    char s[10];\n    int arr[10];\n};\n\nvoid add_one_element(struct data **arr, int *num_elements)\n{\n  /*increment counter*/\n  *num_elements +=1;\n  arr = realloc(arr, *num_elements * sizeof(struct data));\n\n  strcpy(arr[*num_elements-1]-&gt;s, \"ABC\");\n  for(int i = 0; i &lt; 10; i++)\n    arr[*num_elements]-&gt;arr[i] = i;\n}\n\n\nint main()\n{\n   struct data *arr = NULL;\n   int num_elements = 0;\n   add_one_element(&amp;arr, &amp;num_elements);\n   printf(\"arr.s =&gt; %s\\n\", arr[num_elements-1].s);\n   for(int i = 0; i &lt; 10; i++)\n        printf(\"arr[%d].arr[%d] = %d\\n\", num_elements-1, i, arr[num_elements-1].arr[i]);\n   return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "data-structures", "linked-list"], "comments": [{"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472063391, "post_id": 39130599, "comment_id": 65606601, "body": "Please fix your indentation so that this is legible."}, {"owner": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "edited": false, "score": 0, "creation_date": 1472063505, "post_id": 39130599, "comment_id": 65606660, "body": "You have a typo: <code>rev_dispaly</code> is not <code>rev_display</code>."}, {"owner": {"reputation": 31, "user_id": 6547375, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4735af83559a5d5802ab89d2b988167c?s=128&d=identicon&r=PG&f=1", "display_name": "user6547375", "link": "https://stackoverflow.com/users/6547375/user6547375"}, "reply_to_user": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "edited": false, "score": 0, "creation_date": 1472063794, "post_id": 39130599, "comment_id": 65606823, "body": "@aschepler Thanks I found that mistake Please rectify my other one"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1472063842, "post_id": 39130599, "comment_id": 65606849, "body": "My eyes hurt! Use a <b>readable</b> indentation style. Add error-checking and get comfortable with the debugger."}, {"owner": {"reputation": 31, "user_id": 6547375, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4735af83559a5d5802ab89d2b988167c?s=128&d=identicon&r=PG&f=1", "display_name": "user6547375", "link": "https://stackoverflow.com/users/6547375/user6547375"}, "edited": false, "score": 0, "creation_date": 1472063968, "post_id": 39130599, "comment_id": 65606919, "body": "What is the problem in indentation style?"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 1, "creation_date": 1472064457, "post_id": 39130599, "comment_id": 65607199, "body": "I sometimes wonder if an OP can actually see what they posted. Is that really what your code looks like in your editor?"}, {"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 1, "creation_date": 1472064490, "post_id": 39130599, "comment_id": 65607220, "body": "<code>while(temp-&gt;next!=NULL)</code> at <code>display</code> : <code>temp-&gt;next</code> --&gt; <code>temp</code> (<code>rev_dispaly</code> similar mistake)"}, {"owner": {"reputation": 31, "user_id": 6547375, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4735af83559a5d5802ab89d2b988167c?s=128&d=identicon&r=PG&f=1", "display_name": "user6547375", "link": "https://stackoverflow.com/users/6547375/user6547375"}, "reply_to_user": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472064855, "post_id": 39130599, "comment_id": 65607433, "body": "@BLUEPIXY I am not able to understand what is the problem please elaborate"}, {"owner": {"reputation": 3919, "user_id": 3169961, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/42c9a71949249cac6172502dfce7da7d?s=128&d=identicon&r=PG", "display_name": "sabbahillel", "link": "https://stackoverflow.com/users/3169961/sabbahillel"}, "edited": false, "score": 0, "creation_date": 1472064948, "post_id": 39130599, "comment_id": 65607481, "body": "You have used tabs in the code. While this appears correct when you use an 8 character tab, when it is posted it does not show correctly. You must replace the tab characters with actual spaces (either 2 or 4 spaces). Otherwise, we cannot see what the code means."}, {"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472065103, "post_id": 39130599, "comment_id": 65607563, "body": "@user6547375 The last element is not displayed.(because it falls out of the loop before display last element)"}, {"owner": {"reputation": 3919, "user_id": 3169961, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/42c9a71949249cac6172502dfce7da7d?s=128&d=identicon&r=PG", "display_name": "sabbahillel", "link": "https://stackoverflow.com/users/3169961/sabbahillel"}, "edited": false, "score": 0, "creation_date": 1472065133, "post_id": 39130599, "comment_id": 65607579, "body": "There are several places where you use `**dispaly** when it seems you should be using <b>display</b> Fix those with the indentation so that we can see what is going on."}, {"owner": {"reputation": 31, "user_id": 6547375, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4735af83559a5d5802ab89d2b988167c?s=128&d=identicon&r=PG&f=1", "display_name": "user6547375", "link": "https://stackoverflow.com/users/6547375/user6547375"}, "reply_to_user": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472065327, "post_id": 39130599, "comment_id": 65607678, "body": "@BLUEPIXY The first element is not being displayed. the last element is being dislayed as far as I know"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1472065407, "post_id": 39130599, "comment_id": 65607712, "body": "I suggest that you learn how to use a debugger."}, {"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472065493, "post_id": 39130599, "comment_id": 65607757, "body": "@user6547375 If the element is  one, it is the last element. try test (change <code>display();  rev_display();</code> --&gt; <code>display();</code>)"}, {"owner": {"reputation": 31, "user_id": 6547375, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4735af83559a5d5802ab89d2b988167c?s=128&d=identicon&r=PG&f=1", "display_name": "user6547375", "link": "https://stackoverflow.com/users/6547375/user6547375"}, "reply_to_user": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472066444, "post_id": 39130599, "comment_id": 65608211, "body": "@BLUEPIXY I am not getting what changes should be done in display() and rev_display();"}, {"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472066853, "post_id": 39130599, "comment_id": 65608445, "body": "The reason for performing test only in <code>display</code>, because the display is mixed."}], "answers": [{"tags": [], "owner": {"reputation": 3919, "user_id": 3169961, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/42c9a71949249cac6172502dfce7da7d?s=128&d=identicon&r=PG", "display_name": "sabbahillel", "link": "https://stackoverflow.com/users/3169961/sabbahillel"}, "is_accepted": false, "score": 1, "last_activity_date": 1472069208, "last_edit_date": 1472069208, "creation_date": 1472065565, "answer_id": 39131231, "question_id": 39130599, "link": "https://stackoverflow.com/questions/39130599/the-link-list-is-not-printing-the-value-after-first-iteration/39131231#39131231", "title": "The link list is not printing the value after first iteration", "body": "<p>The error is in the definition of the while loop. You stop when you reach a setting with no previous entry. You should stop when the current entry is NULL</p>\n\n<p>Also note that in your original you call  <code>rev_display()</code> but you defined the function as <code>rev_dispaly()</code>. That typo should be fixed.</p>\n\n<p>You also assume that insertattail() never has a case in which the list is empty (<code>head == NULL</code>) I will show how that occurs after the <code>rev_display</code> fix.</p>\n\n<pre><code>void rev_display()\n  {\n    struct node *temp;\n    temp=head;\n    // This correctly finds the last entry\n    while(temp-&gt;next!=NULL)\n      {\n        temp=temp-&gt;next;\n      }\n    /* This will stop when you reach the entry with no previous entry */\n    while(temp-&gt;prev!=NULL)\n      {\n        printf(\"%d \",temp-&gt;data);\n        temp=temp-&gt;prev;\n      }\n}\n</code></pre>\n\n<p>The code should really be</p>\n\n<pre><code>void rev_display()\n  {\n    struct node *temp;\n    temp=head;\n    // This correctly finds the last entry\n    while(temp-&gt;next!=NULL)\n      {\n        temp=temp-&gt;next;\n      }\n    /* This will correctly include the head as well in the print */\n    while(temp != NULL)\n      {\n        printf(\"%d \",temp-&gt;data);\n        temp=temp-&gt;prev;\n      }\n}\n</code></pre>\n\n<p>You do not check for the empty list case in <code>insertattail()</code>.</p>\n\n<pre><code>void insertattail(int x)\n  {\n    struct node *temp=getnewnode(x);\n    struct node *t;\n    t=head;\n    // Note that this assumes that the list is not empty\n    while(t-&gt;next!=NULL)\n      {\n        t=t-&gt;next;\n      }\n    t-&gt;next=temp;\n    temp-&gt;prev=t;\n  } \n</code></pre>\n\n<p>This needs to check for the empty list.</p>\n\n<pre><code>void insertattail(int x)\n  {\n    struct node *temp=getnewnode(x);\n    struct node *t;\n    // First check if the list is empty\n    if(head==NULL)\n      {\n        head=temp;\n        head-&gt;next = NULL;\n        head-&gt;prev = NULL;     \n      }\n    else\n      {\n        t=head;\n        // This list is not empty so find the end\n        while(t-&gt;next!=NULL)\n          {\n            t=t-&gt;next;\n          }\n          t-&gt;next=temp;\n          temp-&gt;prev=t;\n        }\n  }\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 6547375, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4735af83559a5d5802ab89d2b988167c?s=128&d=identicon&r=PG&f=1", "display_name": "user6547375", "link": "https://stackoverflow.com/users/6547375/user6547375"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "closed_date": 1473429339, "answer_count": 1, "score": -3, "last_activity_date": 1472079975, "creation_date": 1472063365, "last_edit_date": 1472079975, "question_id": 39130599, "link": "https://stackoverflow.com/questions/39130599/the-link-list-is-not-printing-the-value-after-first-iteration", "closed_reason": "Not suitable for this site", "title": "The link list is not printing the value after first iteration", "body": "<p>I just made a program of double linked list in which I was trying to print the values after every insertion operation done.</p>\n\n<p>After first insertion no value is being printed but from the second insertion the value is printing fine(except the first one).</p>\n\n<p>I am hereby attaching the full code </p>\n\n<pre><code>// Double Linked List\n#include&lt;stdio.h&gt;\n#include&lt;conio.h&gt;\n#include&lt;stdlib.h&gt;\n\nstruct node\n{\n    int data;\n    struct node *next,*prev;\n};\n\nstruct node *head;\n\nstruct node *getnewnode(int);\nvoid insertathead(int);\nvoid insertattail(int);\nvoid display();\nvoid rev_display();\n\nvoid main()\n{\n    char c;\n    int n,n1;\n\n    clrscr();\n    head = NULL;\n    do\n    {\n        printf(\"\\n Enter Data Element\");\n        scanf(\"%d\", &amp;n);\n        printf(\"Press 1 to insert at beginning \\n Press 2 to insert at the end\");\n        scanf(\"%d\", &amp;n1);\n\n        if(n1 == 1)\n        {\n            insertathead(n);\n            display();\n            rev_display();\n        }\n        if(n1 == 2)\n        {\n            insertattail(n);\n            display();\n            rev_display();\n        }\n        printf(\"Do you wish to enter more (Y/N)\");\n        c = getch();\n    } while(c == 'Y' || c == 'y');\n    getch();\n}\n\nstruct node *getnewnode(int x)\n{\n    struct node *newnode = (struct node*)malloc(sizeof(struct node));\n    newnode-&gt;data = x;\n    newnode-&gt;next = NULL;\n    newnode-&gt;prev = NULL;\n    return(newnode);\n}\n\nvoid insertathead(int x)\n{\n    struct node *temp = getnewnode(x);\n    if(head == NULL)\n    {\n        head = temp;\n    }\n    else\n    {\n        head-&gt;prev = temp;\n        temp-&gt;next = head;\n        head = temp;\n    }\n}\n\nvoid display()\n{\n    struct node *temp;\n    temp = head;\n    printf(\"Forward:\\n\");\n\n    while(temp-&gt;next != NULL)\n    {\n        printf(\"%d \", temp-&gt;data);\n        temp = temp-&gt;next;\n    }\n    printf(\"\\n\");\n}\n\nvoid rev_display()\n{\n    struct node *temp;\n    temp = head;\n\n    while(temp-&gt;next != NULL)\n    {\n        temp = temp-&gt;next;\n    }\n\n    while(temp-&gt;prev != NULL)\n    {\n        printf(\"%d \", temp-&gt;data);\n        temp = temp-&gt;prev;\n    }\n}\n\nvoid insertattail(int x)\n{\n    struct node *temp = getnewnode(x);\n    struct node *t;\n\n    t = head;\n\n    while(t-&gt;next != NULL)\n    {\n        t = t-&gt;next;\n    }\n    t-&gt;next = temp;\n    temp-&gt;prev = t;\n} \n</code></pre>\n"}, {"tags": ["c", "if-statement"], "comments": [{"owner": {"reputation": 27385, "user_id": 1382251, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/17622c39e8ead537a0944c767551b2fe?s=128&d=identicon&r=PG", "display_name": "barak manos", "link": "https://stackoverflow.com/users/1382251/barak-manos"}, "edited": false, "score": 0, "creation_date": 1472062478, "post_id": 39130292, "comment_id": 65606078, "body": "<code>strcmp</code> returns <code>0</code> if and only if the two input strings are identical. What exactly are you trying to achieve by comparing its output to <code>1</code>? A good way to start learning C, is by checking the documentation of any standard function before using it. A simple search on Google would have solved the problem."}, {"owner": {"reputation": 105, "user_id": 6719215, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XPegHvcABGw/AAAAAAAAAAI/AAAAAAAAABE/YGn1Rm98z1w/photo.jpg?sz=128", "display_name": "Allan Mayers", "link": "https://stackoverflow.com/users/6719215/allan-mayers"}, "reply_to_user": {"reputation": 27385, "user_id": 1382251, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/17622c39e8ead537a0944c767551b2fe?s=128&d=identicon&r=PG", "display_name": "barak manos", "link": "https://stackoverflow.com/users/1382251/barak-manos"}, "edited": false, "score": 0, "creation_date": 1472062657, "post_id": 39130292, "comment_id": 65606167, "body": "I thought the very opposit i thought it returns 1 if they were identical."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 3, "creation_date": 1472062740, "post_id": 39130292, "comment_id": 65606213, "body": "<code>fgets</code> retains the <code>newline</code> you typed at the end of the string it writes to. The <code>newline</code> is not present in the comparison strings. Furthemore, <code>strcmp</code> returns <code>0</code> when the strings match. <a href=\"http://stackoverflow.com/questions/2693776/removing-trailing-newline-character-from-fgets-input\">Please see this</a>."}, {"owner": {"reputation": 105, "user_id": 6719215, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XPegHvcABGw/AAAAAAAAAAI/AAAAAAAAABE/YGn1Rm98z1w/photo.jpg?sz=128", "display_name": "Allan Mayers", "link": "https://stackoverflow.com/users/6719215/allan-mayers"}, "edited": false, "score": 0, "creation_date": 1472062816, "post_id": 39130292, "comment_id": 65606264, "body": "I changed to 0 and it did the opposit of what i wanted it gives the sorry message when i give all the right inputs"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1472062918, "post_id": 39130292, "comment_id": 65606323, "body": "<code>years = strlen(age);</code> does not give the age. <code>years = atoi(age);</code> does."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472062920, "post_id": 39130292, "comment_id": 65606326, "body": "Statements don&#39;t return anything. Functions return a result. Always read the documentation for functions you use."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472063016, "post_id": 39130292, "comment_id": 65606389, "body": "Format&amp;indent your code properly. And <code>return</code> is not a function, but a statement. Dont use parentheses around simple expressions. They are missleading and potentially error-prone."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1472063101, "post_id": 39130292, "comment_id": 65606435, "body": "See <a href=\"https://stackoverflow.com/questions/2693776/removing-trailing-newline-character-from-fgets-input\">&quot;How to remove the newline when using fgets&quot;</a>. Also, it&#39;s generally a bad idea to use small buffers with <code>fgets</code>. Instead, declare a line buffer, e.g. <code>char line[200]</code>. Read the string into the line buffer with <code>fgets</code>, and then copy it to the smaller buffer after checking the length and removing the newline."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1472063152, "post_id": 39130292, "comment_id": 65606462, "body": "@AllanMayers, style is up to you, but while you are learning a <i>4-space</i> indent can help keep things organized."}, {"owner": {"reputation": 105, "user_id": 6719215, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XPegHvcABGw/AAAAAAAAAAI/AAAAAAAAABE/YGn1Rm98z1w/photo.jpg?sz=128", "display_name": "Allan Mayers", "link": "https://stackoverflow.com/users/6719215/allan-mayers"}, "edited": false, "score": 0, "creation_date": 1472064673, "post_id": 39130292, "comment_id": 65607325, "body": "Thanks very much every one,  Regarding the editing I have already edited the post and I will look at the edits you made and approve one of them. I still have one problem , if you could help me, it&#39;s with the integer variable age it&#39;s always true in the if statement."}], "answers": [{"tags": [], "owner": {"reputation": 7371, "user_id": 1510211, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4acda0216d7fd2ea07c31c0cfc53a714?s=128&d=identicon&r=PG", "display_name": "Shachar Shemesh", "link": "https://stackoverflow.com/users/1510211/shachar-shemesh"}, "is_accepted": false, "score": 2, "last_activity_date": 1472062820, "creation_date": 1472062820, "answer_id": 39130457, "question_id": 39130292, "link": "https://stackoverflow.com/questions/39130292/my-if-statement-returns-unexpected-results/39130457#39130457", "title": "My if statement returns unexpected results", "body": "<p><code>strcmp</code> doesn't work the way you think it works. It returns 0 (not 1) if the strings are the same, and a value less than one (which is usually <code>-1</code>, but do not rely on it) if the first has a lower dictionary sorting than the second string, and a value larger than 0 (which may or may not be 1) if the second is higher.</p>\n\n<p>So when you checked for equality of strings, what you actually checked for was for a very specific inequality of strings. They is probably the reason your program misbehaves.</p>\n\n<p>In general, whenever a function returns unexpected results, make sure to go over that function's documentation to make sure you are not misusing it.</p>\n"}, {"tags": [], "owner": {"reputation": 6059, "user_id": 1230086, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1dd67f82db5bf5f26a1597400c6ffbf4?s=128&d=identicon&r=PG", "display_name": "tijko", "link": "https://stackoverflow.com/users/1230086/tijko"}, "is_accepted": false, "score": 1, "last_activity_date": 1472282672, "last_edit_date": 1472282672, "creation_date": 1472062841, "answer_id": 39130463, "question_id": 39130292, "link": "https://stackoverflow.com/questions/39130292/my-if-statement-returns-unexpected-results/39130463#39130463", "title": "My if statement returns unexpected results", "body": "<p>You're not hitting your conditions here because you're expecting a different return from <code>strcmp</code> when you get a match.</p>\n\n<p>From the <code>strcmp</code> manpage:</p>\n\n<blockquote>\n  <p>The strcmp() and strncmp() functions return an integer less than, equal to, or greater than zero if s1 (or the first n bytes thereof) is found, respectively, to be less than, to match, or be greater than s2.</p>\n</blockquote>\n\n<p>Try testing for negation on the strings used in <code>strcmp</code>.</p>\n\n<pre><code>if (!strcmp(gender_str, \"male\"))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 105, "user_id": 6719215, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XPegHvcABGw/AAAAAAAAAAI/AAAAAAAAABE/YGn1Rm98z1w/photo.jpg?sz=128", "display_name": "Allan Mayers", "link": "https://stackoverflow.com/users/6719215/allan-mayers"}, "edited": false, "score": 0, "creation_date": 1472064015, "post_id": 39130573, "comment_id": 65606942, "body": "I Implemented or your advice and all errors are fixed expect one , and that is when age is greater than 50 it still returns true and displays welcome message even though it should return false and display the sorry message."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1472064204, "post_id": 39130573, "comment_id": 65607052, "body": "You have <code>fgets(evaluation, 20)</code>, but <code>evaluation</code> is declared to only hold 7 characters. If you type more than 6 characters, you&#39;ll write outside the array bounds and cause undefined behavior."}, {"owner": {"reputation": 105, "user_id": 6719215, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XPegHvcABGw/AAAAAAAAAAI/AAAAAAAAABE/YGn1Rm98z1w/photo.jpg?sz=128", "display_name": "Allan Mayers", "link": "https://stackoverflow.com/users/6719215/allan-mayers"}, "edited": false, "score": 0, "creation_date": 1472064420, "post_id": 39130573, "comment_id": 65607178, "body": "Thanks a lot , fixed it. But still the same problem with the age variable. it always returns true."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 105, "user_id": 6719215, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XPegHvcABGw/AAAAAAAAAAI/AAAAAAAAABE/YGn1Rm98z1w/photo.jpg?sz=128", "display_name": "Allan Mayers", "link": "https://stackoverflow.com/users/6719215/allan-mayers"}, "edited": false, "score": 0, "creation_date": 1472064546, "post_id": 39130573, "comment_id": 65607249, "body": "@AllanMayers <code>char age[2];</code> is not big enough for people over the age of 9. There is room for one digit and one <code>nul</code> terminator. Let alone the <code>newline</code>. Don&#39;t be mean with your string allocations."}, {"owner": {"reputation": 262, "user_id": 5916457, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/eeae0a149f32d093e9cd77fa6cd4a340?s=128&d=identicon&r=PG&f=1", "display_name": "FreeStyle4", "link": "https://stackoverflow.com/users/5916457/freestyle4"}, "reply_to_user": {"reputation": 105, "user_id": 6719215, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XPegHvcABGw/AAAAAAAAAAI/AAAAAAAAABE/YGn1Rm98z1w/photo.jpg?sz=128", "display_name": "Allan Mayers", "link": "https://stackoverflow.com/users/6719215/allan-mayers"}, "edited": false, "score": 0, "creation_date": 1472064758, "post_id": 39130573, "comment_id": 65607383, "body": "@AllanMayers, yeah just change char age[2] to something higher, and change it on the fgets as well"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1472065034, "post_id": 39130573, "comment_id": 65607525, "body": "Just to add to that. If <code>fgets</code> is not given enough room to read a whole line, the line will be broken, and no <code>newline</code> will be appended to the input string. The rest of the line is not discarded, it will be read as the <i>next</i> line. One reason the <code>newline</code> is included in the read, is so that the program can know it has read the <i>whole</i> line."}, {"owner": {"reputation": 105, "user_id": 6719215, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XPegHvcABGw/AAAAAAAAAAI/AAAAAAAAABE/YGn1Rm98z1w/photo.jpg?sz=128", "display_name": "Allan Mayers", "link": "https://stackoverflow.com/users/6719215/allan-mayers"}, "edited": false, "score": 0, "creation_date": 1472065200, "post_id": 39130573, "comment_id": 65607619, "body": "You&#39;re amazing, guys. I gave age more room and  It worked like a charm."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472069249, "post_id": 39130573, "comment_id": 65609674, "body": "Although uncommon, after <code>fgets()</code>, <code>gender[0]</code> may be 0 and <code>gender[strlen(gender) - 1]</code> is a problem. Defensive coding insures the first character after <code>fgets()</code> was not a user entered null character.  Suggest <code>gender[strcspn(gender, &quot;\\n&quot;)] = &#39;\\0&#39;;</code>"}], "tags": [], "owner": {"reputation": 262, "user_id": 5916457, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/eeae0a149f32d093e9cd77fa6cd4a340?s=128&d=identicon&r=PG&f=1", "display_name": "FreeStyle4", "link": "https://stackoverflow.com/users/5916457/freestyle4"}, "is_accepted": false, "score": 1, "last_activity_date": 1472063280, "creation_date": 1472063280, "answer_id": 39130573, "question_id": 39130292, "link": "https://stackoverflow.com/questions/39130292/my-if-statement-returns-unexpected-results/39130573#39130573", "title": "My if statement returns unexpected results", "body": "<p>You have a few things wrong. As others have said <code>strcmp</code>should return 0 if the strings are equal.</p>\n\n<p>Second thing, remove the newline character after you read in the values</p>\n\n<pre><code> gender[strlen(gender) - 1] = '\\0';\n evaluation[strlen(evaluation) - 1] = '\\0';\n</code></pre>\n\n<p>Third, <code>years = strlen (age);</code> should be <code>years = atoi(age)</code></p>\n"}, {"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 105, "user_id": 6719215, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XPegHvcABGw/AAAAAAAAAAI/AAAAAAAAABE/YGn1Rm98z1w/photo.jpg?sz=128", "display_name": "Allan Mayers", "link": "https://stackoverflow.com/users/6719215/allan-mayers"}, "edited": false, "score": 0, "creation_date": 1472073717, "post_id": 39132589, "comment_id": 65611780, "body": "Sure, everyone needs a little help figuring the basics out. C is a fantastic language. However with the unmatched low-level control it provides, it takes a bit of additional dedication and learning.  Enjoy the ride. Good luck with your coding."}], "tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": false, "score": 1, "last_activity_date": 1472072403, "last_edit_date": 1472072403, "creation_date": 1472070831, "answer_id": 39132589, "question_id": 39130292, "link": "https://stackoverflow.com/questions/39130292/my-if-statement-returns-unexpected-results/39132589#39132589", "title": "My if statement returns unexpected results", "body": "<p>By trying to limit the buffer size to just what will fit, you are unwittingly shooting yourself in the foot. For example <code>char gender[7];</code> will hold <code>female\\0</code>, but what happened with the <code>'\\n'</code> at the end of the input?</p>\n\n<p>It remains unread in the input buffer (<code>stdin</code> here), just waiting to cause you problems on your next call to <code>fgets</code> (ever wonder why when you entered <code>female</code> your code seemed to <em>skip</em> the <code>age</code> prompt?) What happens if a cat steps on the keyboard and enters <code>kkkkkkkkkkkkkkkkkkkkkkkkk</code> for <code>gender</code>, or a nutty user enters <code>you go figure it out!</code>?</p>\n\n<p><strong><em>Lesson one</em></strong>, don't try and micro-manage the input array size when taking user input. Choose adequately sized buffers for your input (<code>64</code>, <code>128</code>, or <code>256</code> chars are fine). If you are on an embedded system with very limited memory, sure, then cut back, but for normal use, a few extra bytes never hurts.</p>\n\n<p><strong><em>Lesson two</em></strong> -- always check that the full line has been read and that additional characters do not remain unread just waiting to screw you over on your next read. How do you do this? Simple, <code>fgets</code> reads <em>up to and including the next</em> <code>'\\n'</code> (or the maximum number of characters specified in <code>size</code>, including the <em>nul-byte</em>). If you check the last character and it isn't a <code>'\\n'</code>, you have experienced a <strong><em>short-read</em></strong> and there are additional characters in the input buffer that remain unread.</p>\n\n<p><strong><em>Lesson three</em></strong> -- <code>fgets</code> reads <em>up to and including the next</em> <code>'\\n'</code>. What do you think happens when you compare:</p>\n\n<pre><code>if (strcmp (\"male\\n\", \"male\") == 0)\n</code></pre>\n\n<p>You will need to check for, and remove the <code>'\\n'</code> from the end of the input if it is present. </p>\n\n<p>How? Since this is something you will be doing for every input, it would make sense to have a single function you could call that would check if the <code>newline</code> was present at the end of the input and if so, <em>overwrite the</em> <code>'\\n'</code> <em>with a nul-terminating character</em> (which is simply <code>0</code> or the equivalent <code>'\\0'</code> form). If the <code>'\\n'</code> isn't present in your input, you know it remains unread in the input buffer, so you need to <em>read &amp; discard</em> all remaining characters in that line of input if the remainder is unneeded or <em>read &amp; process</em> the input if it is. You can do that simply with something like:</p>\n\n<pre><code>void check_eol (char *s)\n{\n    if (!s || !*s) return;               /* validate pointer &amp; non-empty s */\n    if (*s == '\\n') { *s = 0; return; }  /* avoid strlen call if 1st is \\n */\n\n    size_t len = strlen (s);     /* get lenth and check if last char is \\n */\n    if (s[len - 1] == '\\n')\n        s[len - 1] = 0;             /* if so, overwrite '\\n' with nul-char */\n    else {            /* otherwise '\\n' remains in input buffer, read rest */\n        int c;        /* of line, to prevent failure on next call to fgets */\n        while ((c = getchar()) != '\\n' &amp;&amp; c != EOF) {}\n    }\n}\n</code></pre>\n\n<p>(you can add a <code>FILE *</code> parameter and use <code>fgetc</code> in place of <code>getchar()</code> if you are reading from other than <code>stdin</code>)</p>\n\n<p>Putting all the pieces of the puzzle together, and leaving your <code>age</code> and <code>gender</code> arrays small to illustrate the point, along with a few other tips, you can do something like the following with your code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n\n/* use constants instead of 'magic' numbers in your code.\n * since you know the limit of age and gender, you can tailor\n * the size, otherwise, it is better to create a buffer large\n * enough to handle any name or evaluation.\n */\nenum { MAXA = 4, MAXG = 8, MAXE = 32, MAXC = 256 };\n\nvoid check_eol (char *s);\n\nint main (void) {\n\n    /* int years = 0; */\n    char name[MAXC] = \"\",      /* initializing char arrays all 0 can insure */\n        gender[MAXG] = \"\",     /* nul-terminated strings if you forget :)   */\n        evaluation[MAXE] = \"\",\n        age[MAXA] = \"\";\n\n    printf (\"enter name, please (max: %3d)       : \", MAXC - 1);\n    fgets (name, MAXC, stdin);\n    check_eol (name);\n\n    printf (\"enter gender, please (max: %3d)     : \", MAXG - 1);\n    fgets (gender, MAXG, stdin);\n    check_eol (gender);\n\n    printf (\"enter evaluation, please (max: %3d) : \", MAXE - 1);\n    fgets (evaluation, MAXE, stdin);\n    check_eol (evaluation);\n\n    printf (\"Please enter age (max: %3d)         : \", MAXA - 1);\n    fgets (age, MAXA, stdin);\n    check_eol (age);\n    if (*age &lt; '0' || '9' &lt; *age) {     /* make sure 1st char is a number */\n        fprintf (stderr, \"error: non-numeric age entered.\\n\");\n        return 1;\n    }\n\n    // years = strlen (age);   /* WTF?? */\n\n    if ((strcmp (gender, \"male\") == 0)\n        &amp;&amp; (strcmp (evaluation, \"good\") == 0) &amp;&amp; *age &lt; 5 + '0')\n        printf (\"\\nwelcome volunteer, %s . You're fit to participate\\n\",\n                name);\n    else\n        printf (\"\\nSorry, '%s'. You're not fit to participate\\n\", name);\n\n    return (0);\n}\n\n/** check for '\\n' at end of 's', overwrite with 0 if present, otherwise\n *  read remaining chars from stdin.\n */\nvoid check_eol (char *s)\n{\n    if (!s || !*s) return;               /* validate pointer &amp; non-empty s */\n    if (*s == '\\n') { *s = 0; return; }  /* avoid strlen call if 1st is \\n */\n\n    size_t len = strlen (s);     /* get lenth and check if last char is \\n */\n    if (s[len - 1] == '\\n')\n        s[len - 1] = 0;             /* if so, overwrite '\\n' with nul-char */\n    else {            /* otherwise '\\n' remains in input buffer, read rest */\n        int c;        /* of line, to prevent failure on next call to fgets */\n        while ((c = getchar()) != '\\n' &amp;&amp; c != EOF) {}\n    }\n}\n</code></pre>\n\n<p>(<strong><em>note:</em></strong> the check for <code>age &lt; 50</code> just checks that the first <em>character</em> of <code>age</code> is less than <code>5</code>, the test can simply be written <code>*age &lt; '5'</code>, is the way it is currently written equivalent? why/why not?)</p>\n\n<p><strong>Example Use/Output</strong></p>\n\n<p>Fit - male, good, &lt; 50</p>\n\n<pre><code>$ ./bin/rfmt\nenter name, please (max: 255)       : Somebody With Avery-Longname\nenter gender, please (max:   7)     : male\nenter evaluation, please (max:  31) : good\nPlease enter age (max:   3)         : 49\n\nwelcome volunteer, Somebody With Avery-Longname . You're fit to participate\n</code></pre>\n\n<p>Not fit - male, good, <code>= 50</code></p>\n\n<pre><code>$ ./bin/rfmt\nenter name, please (max: 255)       : Somebody With Avery-Longname\nenter gender, please (max:   7)     : male\nenter evaluation, please (max:  31) : good\nPlease enter age (max:   3)         : 50\n\nSorry, 'Somebody With Avery-Longname'. You're not fit to participate\n</code></pre>\n\n<p>Not fit - <code>unknown</code>, good, &lt; 50</p>\n\n<pre><code>$ ./bin/fgets_user_input\nenter name, please (max: 255)       : Somebody With Avery-Longname\nenter gender, please (max:   7)     : unknown\nenter evaluation, please (max:  31) : good\nPlease enter age (max:   3)         : 49\n\nSorry, 'Somebody With Avery-Longname'. You're not fit to participate\n</code></pre>\n\n<p>Look things over and let me know if you have any questions. Hope some of this helps.</p>\n"}], "owner": {"reputation": 105, "user_id": 6719215, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XPegHvcABGw/AAAAAAAAAAI/AAAAAAAAABE/YGn1Rm98z1w/photo.jpg?sz=128", "display_name": "Allan Mayers", "link": "https://stackoverflow.com/users/6719215/allan-mayers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1472282672, "creation_date": 1472062299, "last_edit_date": 1472063247, "question_id": 39130292, "link": "https://stackoverflow.com/questions/39130292/my-if-statement-returns-unexpected-results", "title": "My if statement returns unexpected results", "body": "<p>I am learning C.\nWhat I want my program to do is prompt for three variables compare them to specific values using if statement and return true and print a welcome message only if (all) comparisons are true. Any thing else return false and print a sorry message.\nBut when I compile and run the code, which is shown below. </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main ()\n{\n    int years;\n    char name[15];\n    char gender[7];\n    char evaluation[7];\n    char age[2];\n    printf (\"enter name, please     \");\n    fgets (name, 15, stdin);\n    printf (\"enter gender, please     \");\n    fgets (gender, 7, stdin);\n    printf (\"enter evaluation, please     \");\n    fgets (evaluation, 20, stdin);\n    printf (\"Please enter age      \");\n    fgets (age, 2, stdin);\n\n    years = strlen (age);\n\n    {\n        if ((strcmp (gender, \"male\") == 1)\n            &amp;&amp; (strcmp (evaluation, \"good\") == 1) &amp;&amp; years &lt; 50)\n\n            printf (\"welcome volunteer, %s . You're fit to participate\\n\",\n                    name);\n\n        else\n            printf (\"Sorry, %s. You're not fit to participate/n\", name);\n    }\n\n    return (0);\n}\n</code></pre>\n\n<p>-It compiles with no errors and no warnings.\nBut,\n- the if statement returns true if any of the first two comparisons, gender and evaluation, is true.</p>\n\n<p>but,\n- it returns false when all are false.\nand\n- when the first two comparisons ,gender and evaluation,are both false  and the third comparison ,age, is true it returns false.</p>\n\n<p>I would like to know what's wrong with my if statement. \nThanks for your help</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 2, "creation_date": 1472060389, "post_id": 39129735, "comment_id": 65604952, "body": "<code>void main(void)</code> is an invalid signature on hosted environments. <code>main</code> shall return an <code>int</code> result."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472060530, "post_id": 39129735, "comment_id": 65605023, "body": "I really struggled if that is &quot;primarily opinion based&quot;, &quot;too broad&quot; or &quot;asking for external resources&quot;. Anyway, it is off-topic here."}, {"owner": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "edited": false, "score": 1, "creation_date": 1472060916, "post_id": 39129735, "comment_id": 65605220, "body": "It seems that you need proper knowledge.My suggestion is to go for the definitive C books list."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1472061494, "post_id": 39129735, "comment_id": 65605532, "body": "Opinion based: my own preference is to provide a function prototype which is identical to the function definition. Copy/paste, add a <code>;</code> and it&#39;s done. It is also more readable, provided I have used meaningful names for its arguments. I always state the type. What&#39;s the alternative? Hunting around to remind myself what the types and arguments are. It&#39;s a no-brainer really."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 1, "creation_date": 1472061604, "post_id": 39129735, "comment_id": 65605602, "body": "In example 3, the <code>int</code> is for the benefit of the compiler, so it knows what type of parameter the function takes. The name <code>idum2</code> is for the benefit of the programmer, so s/he knows what sort of information the parameter conveys. Choosing a descriptive name is therefore important. (Choosing a name that duplicates the name of a global variable should be avoided whenever possible.) And I agree with machine_1. At some point you need to go beyond the random junk on the internet, and actually buy a book. Here&#39;s the <a href=\"http://stackoverflow.com/a/562377/3386109\">list of books</a>."}], "answers": [{"tags": [], "owner": {"reputation": 15946, "user_id": 4606734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/858769040849894/picture?type=large", "display_name": "ameyCU", "link": "https://stackoverflow.com/users/4606734/ameycu"}, "is_accepted": false, "score": 0, "last_activity_date": 1472060553, "creation_date": 1472060553, "answer_id": 39129827, "question_id": 39129735, "link": "https://stackoverflow.com/questions/39129735/proper-c-function-argument-variable-definition-location/39129827#39129827", "title": "Proper C Function Argument Variable Definition Location", "body": "<p>While in forward declarations you don't need to give parameter's name only type is required (while you can provide name). But this doesn't have to be same as when you define the function . </p>\n\n<p>In funciton definition say <code>void my_func(int i){..}</code> , in this function parameter is of type <code>int</code> and variable name is <code>i</code> . You can access it's value by variable name <code>i</code> inside the function block.</p>\n\n<p>Also ,there is no re-declaration of variables as these have scope limited to function block.  </p>\n\n<p>There is basically no difference in those methods , it's convention how you use it.</p>\n"}, {"tags": [], "owner": {"reputation": 7937, "user_id": 1866300, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/dab16abeddf6aa51bb13e7fe06d70b2c?s=128&d=identicon&r=PG", "display_name": "Serve Laurijssen", "link": "https://stackoverflow.com/users/1866300/serve-laurijssen"}, "is_accepted": false, "score": 0, "last_activity_date": 1472060590, "creation_date": 1472060590, "answer_id": 39129839, "question_id": 39129735, "link": "https://stackoverflow.com/questions/39129735/proper-c-function-argument-variable-definition-location/39129839#39129839", "title": "Proper C Function Argument Variable Definition Location", "body": "<p>This would work too:</p>\n\n<pre><code>void my_func(int);\n</code></pre>\n\n<p>In function signatures it's not about the <strong>name</strong> of the arguments but about the <strong>type</strong>.</p>\n\n<p>There are special rules for when you declare an external variable with the same name as a parameter</p>\n\n<pre><code>int idum1 = 1;\n\nvoid my_func(int idum1)\n{\n  idum1++;\n}\n</code></pre>\n\n<p>Here the variable with the most local scope is incremented, not the external.</p>\n"}], "owner": {"reputation": 1, "user_id": 6753319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I8m2C.jpg?s=128&g=1", "display_name": "scottrod", "link": "https://stackoverflow.com/users/6753319/scottrod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1472061130, "creation_date": 1472060282, "last_edit_date": 1472061130, "question_id": 39129735, "link": "https://stackoverflow.com/questions/39129735/proper-c-function-argument-variable-definition-location", "title": "Proper C Function Argument Variable Definition Location", "body": "<p>I always declare functions ahead of main(). What confuses me is the correct (or at least, best practice) method of declaring, defining, assigning, and passing function arguments. For example, this works:</p>\n\n<pre><code>// EXAMPLE 1 //\nint idum1 = 1;\n\nvoid my_func(int); // Says the function's going to need an integer.\n\nvoid main (void) \n{\n    my_func(idum1);\n}\n\nvoid my_func(idum2)  // Is this then declaring AND defining a local integer, idum2?\n{\n    // Do stuff using idum2...\n}\n</code></pre>\n\n<p>But this works too:</p>\n\n<pre><code>// EXAMPLE 2 //\nint idum1 = 1;\n\nvoid my_func(int idum2);  //Is this declaring a variable idum2 local to my_func?\n\nvoid main (void) \n{\n    my_func(idum1);\n}\n\nvoid my_func(idum3) // A different variable or the same one (idum2) still works.\n                    //Is this declaring idum3 as a local integer? \n{                   //What happened to idum2, still a viable integer in the function? \n    // Do stuff using idum3...\n}\n</code></pre>\n\n<p>And this works:</p>\n\n<pre><code>// EXAMPLE 3 //\nint idum1 = 1;\n\nvoid my_func(int idum2);  // Declaring...\n\nvoid main (void) \n{\n    my_func(idum1);\n}\n\nvoid my_func(int idum2)  //Declaring again. Different address as in function declaration? \n                        //Same variable and address?\n{\n    // Do stuff using idum2...\n}\n</code></pre>\n\n<p>And so does this:</p>\n\n<pre><code>// EXAMPLE 4 //\nint idum1 = 1;\n\nvoid my_func(int);  \n\nvoid main (void) \n{\n    my_func(idum1);\n}\n\nvoid my_func(int idum2)  //Yet another way that works.\n{\n    // Do stuff using idum2...\n}\n</code></pre>\n\n<p>I'm a self-taught beginner, but I've been squeaking by for years not really knowing the right way and what's going on behind the scenes. I just know it works (always dangerous).</p>\n\n<p>My gut says EXAMPLE 4 is the best way; tell it what type it's going to need, then declare it at the function along with the type for ease of coding and error checking. I'm sure there are reasons to do it one way or another, depending on what you're trying to do, but could really use some guidance here.</p>\n\n<p>I do see EXAMPLE 3 a lot, but that seems superfluous, declaring a variable twice.</p>\n\n<p>Can someone explain or point me to an article that explains the ins and outs of what I'm trying to get at here? Almost don't quite know what I'm asking, iykwim. Everything's so fragmented on the web. Tried CodingUnit but the tutorials just aren't deep enough. TIA!</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 2678, "user_id": 5699206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b779af6a871be4c7cd891113f722f62?s=128&d=identicon&r=PG&f=1", "display_name": "Joseph Young", "link": "https://stackoverflow.com/users/5699206/joseph-young"}, "edited": false, "score": 1, "creation_date": 1472059143, "post_id": 39129394, "comment_id": 65604267, "body": "Make <code>offset</code> a <code>long int</code> or <code>off_t</code>?"}, {"owner": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 2, "creation_date": 1472059159, "post_id": 39129394, "comment_id": 65604272, "body": "The warning is pretty clear: You&#39;re causing undefined behavior. It&#39;s also clear where the problem is, you just need to replace <code>int offset;</code> with <code>off_t offset;</code>."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472059164, "post_id": 39129394, "comment_id": 65604275, "body": "The message is very clear. You have incompatible pointer types and the conversion would invoke undefined behaviour. What is your <b>specific</b> problem?"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 2678, "user_id": 5699206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b779af6a871be4c7cd891113f722f62?s=128&d=identicon&r=PG&f=1", "display_name": "Joseph Young", "link": "https://stackoverflow.com/users/5699206/joseph-young"}, "edited": false, "score": 0, "creation_date": 1472059237, "post_id": 39129394, "comment_id": 65604308, "body": "@JosephYoung: That might cause problems elsewhere in the code."}], "answers": [{"tags": [], "owner": {"reputation": 5542, "user_id": 1076451, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/ZTP3Q.jpg?s=128&g=1", "display_name": "Chimera", "link": "https://stackoverflow.com/users/1076451/chimera"}, "is_accepted": true, "score": 1, "last_activity_date": 1472064335, "last_edit_date": 1472064335, "creation_date": 1472063758, "answer_id": 39130704, "question_id": 39129394, "link": "https://stackoverflow.com/questions/39129394/invalid-conversion-from-int-to-off-t-in-c/39130704#39130704", "title": "Invalid conversion from &#39;int*&#39; to &#39;off_t*&#39; in C?", "body": "<p>You need to know what parameter types the <code>sendfile()</code> function takes.\nSee <a href=\"http://man7.org/linux/man-pages/man2/sendfile.2.html\" rel=\"nofollow\">sendfile() man page.</a></p>\n\n<p>Notice that the 3rd parameter that you are calling offset is of type <code>off_t *</code>. Make sure you are passing in a pointer to type <code>off_t</code> and your error will be fixed.</p>\n\n<p>So instead of defining offset as:</p>\n\n<p><code>int offset;</code></p>\n\n<p>Try</p>\n\n<p><code>off_t offset;</code></p>\n"}], "owner": {"reputation": 57, "user_id": 6747174, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LijFv.jpg?s=128&g=1", "display_name": "Lukas Hejcman", "link": "https://stackoverflow.com/users/6747174/lukas-hejcman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 734, "favorite_count": 0, "accepted_answer_id": 39130704, "answer_count": 1, "score": -2, "last_activity_date": 1472064335, "creation_date": 1472058982, "question_id": 39129394, "link": "https://stackoverflow.com/questions/39129394/invalid-conversion-from-int-to-off-t-in-c", "title": "Invalid conversion from &#39;int*&#39; to &#39;off_t*&#39; in C?", "body": "<p>I am writting a program that will send one file over the network using sockets to another program using C. However, I've hit a roadblock, and since I am pretty new to C, I was unable to resolve it. When trying to compile, I get this error:</p>\n\n<pre><code>data_logger.c: In function \u2018void sender()\u2019:\ndata_logger.c:163:72: error: invalid conversion from \u2018int*\u2019 to \u2018off_t* {aka   long int*}\u2019 [-fpermissive]\n     while (((sent_bytes = sendfile(peer_socket, fd, &amp;offset, BUFSIZ)) &gt; 0) &amp;&amp; (remain_data &gt; 0)){\n</code></pre>\n\n<p>I can't understand what is wrong. All help is greatly appreciated. Thanks :)</p>\n\n<p>File:</p>\n\n<pre><code>void sender(){\n\n    int server_socket;\n    int peer_socket;\n    socklen_t       sock_len;\n    ssize_t len;\n    struct sockaddr_in      server_addr;\n    struct sockaddr_in      peer_addr;\n    int fd;\n    int sent_bytes = 0;\n    char file_size[256];\n    struct stat file_stat;\n    int offset;\n    int remain_data;\n\n    /* Create server socket */\n    server_socket = socket(AF_INET, SOCK_STREAM, 0);\n\n    if (server_socket == -1){\n            fprintf(stderr, \"Error creating socket --&gt; %s\", strerror(errno));\n            exit(EXIT_FAILURE);\n    }\n\n    /* Zeroing server_addr struct */\n    memset(&amp;server_addr, 0, sizeof(server_addr));\n\n    /* Construct server_addr struct */\n    server_addr.sin_family = AF_INET;\n    inet_pton(AF_INET, SERVER_ADDRESS, &amp;(server_addr.sin_addr));\n    server_addr.sin_port = htons(PORT_NUMBER);\n\n    /* Bind */\n    if ((bind(server_socket, (struct sockaddr *)&amp;server_addr, sizeof(struct sockaddr))) == -1){\n            fprintf(stderr, \"Error on bind --&gt; %s\", strerror(errno));\n            exit(EXIT_FAILURE);\n    }\n\n    /* Listening to incoming connections */\n    if ((listen(server_socket, 5)) == -1){\n            fprintf(stderr, \"Error on listen --&gt; %s\", strerror(errno));\n            exit(EXIT_FAILURE);\n    }\n\n    fd = open(FILE_TO_SEND, O_RDONLY);\n\n    if (fd == -1){\n            fprintf(stderr, \"Error opening file --&gt; %s\", strerror(errno));\n            exit(EXIT_FAILURE);\n    }\n\n    /* Get file stats */\n    if (fstat(fd, &amp;file_stat) &lt; 0){\n            fprintf(stderr, \"Error fstat --&gt; %s\", strerror(errno));\n            exit(EXIT_FAILURE);\n    }\n\n    fprintf(stdout, \"File Size: \\n%ld bytes\\n\", file_stat.st_size);\n\n    sock_len = sizeof(struct sockaddr_in);\n\n    /* Accepting incoming peers */\n    peer_socket = accept(server_socket, (struct sockaddr *)&amp;peer_addr, &amp;sock_len);\n    if (peer_socket == -1){\n            fprintf(stderr, \"Error on accept --&gt; %s\", strerror(errno));\n            exit(EXIT_FAILURE);\n    }\n    fprintf(stdout, \"Accept peer --&gt; %s\\n\", inet_ntoa(peer_addr.sin_addr));\n\n    sprintf(file_size, \"%ld\", file_stat.st_size);\n\n    /* Sending file size */\n    len = send(peer_socket, file_size, sizeof(file_size), 0);\n\n    if (len &lt; 0){\n          fprintf(stderr, \"Error on sending greetings --&gt; %s\", strerror(errno));\n          exit(EXIT_FAILURE);\n    }\n\n    fprintf(stdout, \"Server sent %d bytes for the size\\n\", len);\n\n    offset = 0;\n    remain_data = file_stat.st_size;\n\n    /* Sending file data */\n    while (((sent_bytes = sendfile(peer_socket, fd, &amp;offset, BUFSIZ)) &gt; 0) &amp;&amp; (remain_data &gt; 0)){\n            fprintf(stdout, \"1. Server sent %d bytes from file's data, offset is now : %d and remaining data = %d\\n\", sent_bytes, offset, remain_data);\n            remain_data -= sent_bytes;\n            fprintf(stdout, \"2. Server sent %d bytes from file's data, offset is now : %d and remaining data = %d\\n\", sent_bytes, offset, remain_data);\n    }\n\n    close(peer_socket);\n    close(server_socket);\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["c", "linux"], "answers": [{"comments": [{"owner": {"reputation": 82, "user_id": 1036643, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e5650cdb1dec42a6fcbd02ec281dfc21?s=128&d=identicon&r=PG", "display_name": "woytekm", "link": "https://stackoverflow.com/users/1036643/woytekm"}, "edited": false, "score": 0, "creation_date": 1472066627, "post_id": 39128939, "comment_id": 65608317, "body": "Hi Jonathan, thanks for the suggestion. I&#39;ve just tried what you suggested and it works as i want it to. It is a bit of a hack, but as i can&#39;t find any other way to do it, i guess i&#39;ll have to stick to this solution."}], "tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": true, "score": 1, "last_activity_date": 1472057265, "creation_date": 1472057265, "answer_id": 39128939, "question_id": 39128825, "link": "https://stackoverflow.com/questions/39128825/how-to-flush-a-pipe-created-by-pipe-on-linux/39128939#39128939", "title": "How to flush a pipe created by pipe() on Linux?", "body": "<p>There isn't a standard way to do it.</p>\n\n<p>You could consider setting the non-blocking attribute on the pipe followed by a preliminary <code>read()</code> to clear the data, then reset the attribute to blocking before collecting the data you're really after.  You'd have to attempt to read at least the pipe size \u2014 which can be as small as 4 KiB or can be much larger (64 KiB on Linux, IIRC).  That's kinda fiddly, but it would 'work' with a minimal window of time between TOCTOU (time of check, time of use) \u2014 basically, the two <code>read</code> calls I'm postulating.  That shouldn't matter to you; it was data written after the start of the reading process.</p>\n"}], "owner": {"reputation": 82, "user_id": 1036643, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e5650cdb1dec42a6fcbd02ec281dfc21?s=128&d=identicon&r=PG", "display_name": "woytekm", "link": "https://stackoverflow.com/users/1036643/woytekm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1637, "favorite_count": 0, "accepted_answer_id": 39128939, "answer_count": 1, "score": 0, "last_activity_date": 1472057265, "creation_date": 1472056908, "question_id": 39128825, "link": "https://stackoverflow.com/questions/39128825/how-to-flush-a-pipe-created-by-pipe-on-linux", "title": "How to flush a pipe created by pipe() on Linux?", "body": "<p>I want to flush a pipe created by pipe() call on Linux, as i am interested only in data that will come <em>after</em> read() was called. I am trying following ioctl call:</p>\n\n<pre><code>ioctl_err = ioctl(G_MIDI_inout_event_pipe[0],I_FLUSH,FLUSHR);  \nread(G_MIDI_inout_event_pipe[0],&amp;event_type,1);\n</code></pre>\n\n<p>But ioctl returns ENOTTY and pipe is not flushed.\nHow to properly flush such stream?</p>\n"}, {"tags": ["c", "sockets", "solaris"], "comments": [{"owner": {"reputation": 2445, "user_id": 3476780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/abf771bddcd864626a0e1499ccfc699b?s=128&d=identicon&r=PG&f=1", "display_name": "yano", "link": "https://stackoverflow.com/users/3476780/yano"}, "edited": false, "score": 0, "creation_date": 1472056550, "post_id": 39128583, "comment_id": 65602873, "body": "I assume your <code>for</code> loops are supposed to have brackets somewhere?"}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 1, "creation_date": 1472056633, "post_id": 39128583, "comment_id": 65602916, "body": "If <code>select</code> returns -1 you should call <code>perror</code> to find out why it failed."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2404501"}, "edited": false, "score": 0, "creation_date": 1472058885, "post_id": 39128583, "comment_id": 65604117, "body": "Possibly you have gone over <code>FD_SETSIZE</code>? See <a href=\"http://stackoverflow.com/questions/7976388/increasing-limit-of-fd-setsize-and-select\" title=\"increasing limit of fd setsize and select\">stackoverflow.com/questions/7976388/&hellip;</a>"}, {"owner": {"reputation": 3, "user_id": 6753429, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-0WiEkFhupKI/AAAAAAAAAAI/AAAAAAAAABE/WWLJexrHrf4/photo.jpg?sz=128", "display_name": "Clay Weston", "link": "https://stackoverflow.com/users/6753429/clay-weston"}, "edited": false, "score": 0, "creation_date": 1472072665, "post_id": 39128583, "comment_id": 65611286, "body": "the FD_SETSIZE was indeed my issue.  Thanks for the help."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 6753429, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-0WiEkFhupKI/AAAAAAAAAAI/AAAAAAAAABE/WWLJexrHrf4/photo.jpg?sz=128", "display_name": "Clay Weston", "link": "https://stackoverflow.com/users/6753429/clay-weston"}, "edited": false, "score": 0, "creation_date": 1472072645, "post_id": 39129412, "comment_id": 65611277, "body": "Thank you, changing the nfds argument fixed my issue.  Sorry for not posting an MCVE. I&#39;m trying to fix 20 year old code that I&#39;ve never seen before and wasn&#39;t sure how to do it."}], "tags": [], "owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "is_accepted": true, "score": 0, "last_activity_date": 1472059048, "last_edit_date": 1495541311, "creation_date": 1472059048, "answer_id": 39129412, "question_id": 39128583, "link": "https://stackoverflow.com/questions/39128583/c-socket-select-error-on-solaris/39129412#39129412", "title": "C Socket select error on Solaris", "body": "<p>You really need to <a href=\"https://stackoverflow.com/help/mcve\">post an MCVE</a> to get real help.  And this is more informed speculation instead of an actual answer because of that.</p>\n\n<p>First, assuming you're getting passed an <code>int *</code> that points to an <code>int</code> array of open file descriptors, this is useless:</p>\n\n<pre><code>/*\n** Determine the current limits.\n*/\n\nif ( getrlimit( RLIMIT_NOFILE, &amp;file_limits ) != 0 )\n    return( -1 );\n</code></pre>\n\n<p>If you're getting passed <em>already open</em> file descriptors, the resource limit on the number of open descriptors is utterly irrelevant - the descriptors are already open, and if something were to <em>lower</em> the limit, you might be unable to act on some descriptors.</p>\n\n<p>Second, this is problematic if the limit of open files is greater than the value in <code>FD_SETSIZE</code>.  The arrays you pass to select - <code>read_fds</code> and <code>except_fds</code> - each have at most <code>FD_SETSIZE</code> elements:</p>\n\n<pre><code>select_fd = select( file_limits.rlim_cur,\n                    &amp;read_fds,\n                    NULL,\n                    &amp;except_fds,\n                    &amp;timeout );\n</code></pre>\n\n<p>I don't know what <code>FD_SETSIZE</code> is on your Solaris installation, but given your posted \"the code below when it works <code>file_limits.rlim_cur</code> is <code>256</code>\" in the question, I strongly suspect that's what's happening.  Given the contents of the <a href=\"https://docs.oracle.com/cd/E26502_01/html/E29034/select-3c.html#scrolltoc\" rel=\"nofollow noreferrer\">Solaris <code>select(3C)</code> man page</a> are</p>\n\n<blockquote>\n  <p><strong>Errors</strong></p>\n  \n  <p>The <code>select()</code> and <code>pselect()</code> functions will fail if:</p>\n  \n  <p>...</p>\n  \n  <p><code>EINVAL</code> The <code>nfds</code> argument is less than <code>0</code> or greater than <code>FD_SETSIZE</code>.</p>\n</blockquote>\n\n<p>you need to fix your code.</p>\n\n<p>And this will lead to starvation of descriptors later in the array:</p>\n\n<pre><code>for ( i = 0; i &lt; how_many; i++ )\n    if ( ( fd[i] &gt;= 0 ) &amp;&amp;\n         ( FD_ISSET( fd[i], &amp;read_fds ) ) )\n        return( fd[i] );\n</code></pre>\n\n<p>You always return the first descriptor with activity that you find.  If the first one in the array is always busy, it's the only one that will get serviced.</p>\n\n<p>You're also ignoring <code>except_fds</code>.  If one \"goes bad\" there in such a way as no other descriptor will ever have readable data, your code will stop doing anything other than looping in <code>select()</code>.</p>\n"}], "owner": {"reputation": 3, "user_id": 6753429, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-0WiEkFhupKI/AAAAAAAAAAI/AAAAAAAAABE/WWLJexrHrf4/photo.jpg?sz=128", "display_name": "Clay Weston", "link": "https://stackoverflow.com/users/6753429/clay-weston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 528, "favorite_count": 0, "accepted_answer_id": 39129412, "answer_count": 1, "score": -1, "last_activity_date": 1472059360, "creation_date": 1472056097, "last_edit_date": 1472059360, "question_id": 39128583, "link": "https://stackoverflow.com/questions/39128583/c-socket-select-error-on-solaris", "title": "C Socket select error on Solaris", "body": "<p>I am getting a return of -1 on a socket select.  However this only happens when we are using a new install of a sybase database.  Using this code with the old database, I do not get any socket select errors and everything works fine.</p>\n\n<p>In the below example how_many = 2, and timeout_secs = 60.</p>\n\n<p>Important to note that in the code below when it works file_limits.rlim_cur is 256.  However with the new database file_limits.rlim_cur = over 65,000 and the socket select returns -1.  I've tried hard coding the first parameter in the select to 256 but it still returns -1.</p>\n\n<pre><code>int socket_activity( int how_many, int *fd, int timeout_secs )\n{\nint                                 i;\nint                                 select_fd;\nfd_set                              read_fds;\nfd_set                              except_fds;\nstruct timeval              timeout;\nstruct rlimit               file_limits;\n\n/*\n** Determine the current limits.\n*/\n\nif ( getrlimit( RLIMIT_NOFILE, &amp;file_limits ) != 0 )\n    return( -1 );\n\n/*\n** Set up the select structures.  Initialize the timeout to the specified\n** seconds.  Only non-negative file descriptors are initialized.\n*/\n\nFD_ZERO( &amp;read_fds );\nFD_ZERO( &amp;except_fds );\nfor ( i = 0; i &lt; how_many; i++ )\n\n    if ( fd[i] &gt;= 0 ) {\n\n        FD_SET( fd[i], &amp;read_fds );\n        FD_SET( fd[i], &amp;except_fds );\n\n    }  /*  of if  */\n\ntimeout.tv_sec  = timeout_secs;\ntimeout.tv_usec = 0;\n\n/*\n** Perform the select and check on the results.\n*/\n\nselect_fd = select( file_limits.rlim_cur,\n                    &amp;read_fds,\n                    NULL,\n                    &amp;except_fds,\n                    &amp;timeout );\n\nif ( select_fd &gt; 0 ) {\n\n    /*\n    ** Scan the list of file descriptors and return which file\n    ** descripitor show activity.  Only check non-negative file descriptors.\n    */\n\n    for ( i = 0; i &lt; how_many; i++ )\n        if ( ( fd[i] &gt;= 0 ) &amp;&amp;\n             ( FD_ISSET( fd[i], &amp;read_fds ) ) )\n            return( fd[i] );\n\n    /*\n    ** No file descriptor showed activity so return zero to indicate\n    ** that a timeout occured.\n    */\n\n    return( 0 );\n\n}  /*  of if  */\n\nelse\n\n    /*\n    ** Simply return the return value from select (the function will\n    ** return a 0 on timeout or a -1 on error).\n    */\n\n    return( select_fd );\n\n}  /*  of function  */\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 11494, "user_id": 1795279, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/4TEag.jpg?s=128&g=1", "display_name": "Haris", "link": "https://stackoverflow.com/users/1795279/haris"}, "edited": false, "score": 1, "creation_date": 1472054272, "post_id": 39127968, "comment_id": 65601474, "body": "The thing that will happen first (and in this kind of case always) is undefined behaviour."}, {"owner": {"reputation": 19817, "user_id": 1784011, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5QrkA.png?s=128&g=1", "display_name": "Woodstock", "link": "https://stackoverflow.com/users/1784011/woodstock"}, "edited": false, "score": 0, "creation_date": 1472054333, "post_id": 39127968, "comment_id": 65601525, "body": "read this: <a href=\"http://stackoverflow.com/questions/7506704/difference-between-sequence-points-and-operator-precedence-0-o\" title=\"difference between sequence points and operator precedence 0 o\">stackoverflow.com/questions/7506704/&hellip;</a> ... the key bit: &quot;It does not matter that due to operator precedence the order in which the two operators are evaluated is well-defined, because the order in which their side effects are processed is still undefined.&quot;"}, {"owner": {"reputation": 1248, "user_id": 1791872, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/6nnz7.png?s=128&g=1", "display_name": "flau", "link": "https://stackoverflow.com/users/1791872/flau"}, "edited": false, "score": 1, "creation_date": 1472054367, "post_id": 39127968, "comment_id": 65601542, "body": "Also <code>%f</code> is for floating point numbers, you&#39;re printing an int so use <code>%d</code>"}], "answers": [{"tags": [], "owner": {"reputation": 26917, "user_id": 1892179, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/umfON.jpg?s=128&g=1", "display_name": "Theodoros Chatzigiannakis", "link": "https://stackoverflow.com/users/1892179/theodoros-chatzigiannakis"}, "is_accepted": false, "score": 0, "last_activity_date": 1472054996, "creation_date": 1472054996, "answer_id": 39128251, "question_id": 39127968, "link": "https://stackoverflow.com/questions/39127968/what-will-happen-first-multiplication-after-increment-or-multiplication-before-i/39128251#39128251", "title": "What will happen first multiplication after increment or multiplication before increment?", "body": "<p>This invokes undefined behavior, which means that anything can happen in your program.</p>\n\n<p>See the C99 spec, specifically <em>J.2 Undefined Behavior:</em></p>\n\n<blockquote>\n  <p>The behavior is undefined in the following circumstances: <em>[...]</em></p>\n  \n  <ul>\n  <li>Between two sequence points, an object is modified more than once, or is modified and the prior value is read other than to determine the value to be stored (6.5).</li>\n  </ul>\n</blockquote>\n\n<p>As a rule of thumb, \"between two sequence points\" means between two semicolons (<code>;</code>) that end a statement. The \"object\" mentioned in the excerpt is the variable <code>c</code>.</p>\n\n<p>With that out of the way, we can clearly see that the object is modified twice between two sequence points. It's modified once during the evaluation of the expression <code>c++</code> and once during the assignment.</p>\n"}], "owner": {"reputation": 495, "user_id": 6753380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6aec45c783e168a85d43c0ec7064fff0?s=128&d=identicon&r=PG&f=1", "display_name": "Jay Patel", "link": "https://stackoverflow.com/users/6753380/jay-patel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 276, "favorite_count": 0, "closed_date": 1472055130, "answer_count": 1, "score": 0, "last_activity_date": 1472054996, "creation_date": 1472054229, "question_id": 39127968, "link": "https://stackoverflow.com/questions/39127968/what-will-happen-first-multiplication-after-increment-or-multiplication-before-i", "closed_reason": "Duplicate", "title": "What will happen first multiplication after increment or multiplication before increment?", "body": "<p>The Output of this program is coming out to be 4.00000.\nI don't know that what will happen first multiplication of 2 with c and then increment takes place or multiplication of 2 with increased c?  </p>\n\n<pre><code>int main()        \n{\nint c=1;\nc=c+2*c++;\nprintf(\"\\n%f\", c);\nreturn 0;\n}\n</code></pre>\n"}, {"tags": ["c", "biginteger"], "comments": [{"owner": {"reputation": 13636, "user_id": 3191557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffa6013ed93cfff5ef56f1ddf63956b1?s=128&d=identicon&r=PG&f=1", "display_name": "dhke", "link": "https://stackoverflow.com/users/3191557/dhke"}, "edited": false, "score": 0, "creation_date": 1472050686, "post_id": 39126701, "comment_id": 65598978, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/2104884/how-does-python-manage-int-and-long\">How does Python manage int and long?</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5164080"}, "reply_to_user": {"reputation": 13636, "user_id": 3191557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffa6013ed93cfff5ef56f1ddf63956b1?s=128&d=identicon&r=PG&f=1", "display_name": "dhke", "link": "https://stackoverflow.com/users/3191557/dhke"}, "edited": false, "score": 0, "creation_date": 1472050763, "post_id": 39126701, "comment_id": 65599041, "body": "@dhke it is, partially. But I wonder how oversized integers are stored, it should make the difference."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472050962, "post_id": 39126701, "comment_id": 65599231, "body": "<code>%zd</code> is a wrong conversion specifier. <code>size_t</code> is unsigned!"}, {"owner": {"reputation": 13636, "user_id": 3191557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffa6013ed93cfff5ef56f1ddf63956b1?s=128&d=identicon&r=PG&f=1", "display_name": "dhke", "link": "https://stackoverflow.com/users/3191557/dhke"}, "edited": false, "score": 0, "creation_date": 1472051071, "post_id": 39126701, "comment_id": 65599318, "body": "@light2yellow: <a href=\"https://www.python.org/dev/peps/pep-0237/\" rel=\"nofollow noreferrer\">PEP 237</a> has the details for CPython 2. In CPython 3, the union is replaced by a <a href=\"https://github.com/python/cpython/blob/0e7736c2e955724df2da09060e7aea9864050f80/Include/longintrepr.h#L89\" rel=\"nofollow noreferrer\">struct with an extensible array</a>. As for performance, see e.g. <a href=\"https://www.southampton.ac.uk/~fangohr/blog/performance-of-pythons-long-data-type.html\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1472051078, "post_id": 39126701, "comment_id": 65599325, "body": "How does an 8 bit CPU calculate 16 bit <code>int</code>? How 32 bit <code>int</code>? What did you find out yourself? What **specifically don&#39;t you understand?"}, {"owner": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "edited": false, "score": 0, "creation_date": 1472051139, "post_id": 39126701, "comment_id": 65599377, "body": "It&#39;s stored in base <code>2**15</code> or <code>2**30</code>, depending on the system and build; each &quot;digit&quot; is stored in a suitable unsigned C type (e.g., <code>unsigned short</code> for base <code>2**15</code>, <code>unsigned int</code> for base <code>2**30</code>, on a typical system). See <a href=\"https://github.com/python/cpython/blob/master/Include/longintrepr.h\" rel=\"nofollow noreferrer\">longintrepr.h</a> in the Python source for details of the storage format, and <a href=\"https://github.com/python/cpython/blob/master/Objects/longobject.c\" rel=\"nofollow noreferrer\">longobject.c</a> for the implementation of the arithmetic."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5164080"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472051249, "post_id": 39126701, "comment_id": 65599452, "body": "@Olaf good point!"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "edited": false, "score": 0, "creation_date": 1472051286, "post_id": 39126701, "comment_id": 65599484, "body": "@MarkDickinson: 15 or 30 bits?? Very uncommon!"}, {"owner": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472051415, "post_id": 39126701, "comment_id": 65599568, "body": "@Olaf: Not that uncommon. It allows a bit of wiggle-room in the arithmetic operations, which is useful, especially if you don&#39;t want to rely on details of the C implementation or start coding in assembly language (as in GMP). For example, efficiently extracting the carry bit from a base 2**32 addition is tricky in standard portable C."}, {"owner": {"reputation": 13636, "user_id": 3191557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffa6013ed93cfff5ef56f1ddf63956b1?s=128&d=identicon&r=PG&f=1", "display_name": "dhke", "link": "https://stackoverflow.com/users/3191557/dhke"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472051463, "post_id": 39126701, "comment_id": 65599604, "body": "@Olaf <a href=\"https://github.com/python/cpython/blob/0e7736c2e955724df2da09060e7aea9864050f80/Include/longintrepr.h#L11\" rel=\"nofollow noreferrer\"><code>longintrepr.h</code></a> has quite some detail on why things are this way. In particular, you can always calculate the sum of two digits without overflow, which is quite handy."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5164080"}, "reply_to_user": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "edited": false, "score": 0, "creation_date": 1472051505, "post_id": 39126701, "comment_id": 65599631, "body": "@MarkDickinson thanks for the links. Is it okay that they link on diffs?"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "edited": false, "score": 1, "creation_date": 1472051547, "post_id": 39126701, "comment_id": 65599666, "body": "@MarkDickinson: Arithmetics on unsigned integers is not implementation-specific! You typically use the machine&#39;s word-size, which is 16 resp 32 bits (32 on architectures Python supports). But I think about an optimized Assembler-version. Don&#39;t see much good implementation such critical code in C actually. The core would be pretty small and for e.g. multiplication, a single spare bit doesn&#39;t change much."}, {"owner": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "edited": false, "score": 0, "creation_date": 1472051549, "post_id": 39126701, "comment_id": 65599669, "body": "@light2yellow: Sorry, copy and paste errors on the links. They should be fixed now."}, {"owner": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472051600, "post_id": 39126701, "comment_id": 65599703, "body": "@Olaf: See my comment about carry bits."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "edited": false, "score": 0, "creation_date": 1472051680, "post_id": 39126701, "comment_id": 65599766, "body": "@MarkDickinson: see my edit"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5164080"}, "reply_to_user": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "edited": false, "score": 0, "creation_date": 1472051710, "post_id": 39126701, "comment_id": 65599790, "body": "@MarkDickinson thank you again. Would you be so kind to write an answer and say a few words for me to check it as the right one?"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472067356, "post_id": 39126701, "comment_id": 65608724, "body": "The only question in the post is &quot;why is it still on hold?&quot;  For clarity, suggest removing that and clearly asking your 2 questions.  I&#39;m voting to re-open anyway given the <i>implied</i> questions."}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "reply_to_user": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "edited": false, "score": 0, "creation_date": 1472106097, "post_id": 39126701, "comment_id": 65620387, "body": "@MarkDickinson why difficult? something like <code>sum = a + b; carry = sum &lt; a;</code> with unsigned operands. bigint limbs should always be unsigned except for the most significant one"}, {"owner": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "reply_to_user": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 0, "creation_date": 1472114000, "post_id": 39126701, "comment_id": 65625086, "body": "@L\u01b0uV\u0129nhPh&#250;c: Right, but the basic operation you need for multi-limb addition is not <code>a + b -&gt; sum and carry</code>, but <code>a + b + carry -&gt; sum and carry</code>, and now your overflow condition needs to be different depending on whether there was a carry going in or not, and you end up with a corresponding branch in the C code... It&#39;s just slightly more straightforward to deal with these issues with the extra bit in hand. @Olaf: no, an optimised assembler version would be a terrible idea for Python. The priority is having simple, <i>portable</i> code. This is not GMP; the goals are completely different."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user5164080"}, "edited": false, "score": 0, "creation_date": 1472050881, "post_id": 39126837, "comment_id": 65599156, "body": "&gt; Thats python implementation, you cannot know how it is physically stored. What about Linux? I&#39;ve edited the question."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5164080"}, "edited": false, "score": 0, "creation_date": 1472051002, "post_id": 39126837, "comment_id": 65599254, "body": "Why cannot I know how this is implemented? It <b>is</b> implemented somehow in C and I wonder how precisely."}, {"owner": {"reputation": 1447, "user_id": 6746897, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1eb640fcdc6847c55c189ceddb6afca5?s=128&d=identicon&r=PG&f=1", "display_name": "Julien", "link": "https://stackoverflow.com/users/6746897/julien"}, "edited": false, "score": 0, "creation_date": 1472051271, "post_id": 39126837, "comment_id": 65599467, "body": "@light2yellow I  do not (but other persons may) know how it is implemented. You will have to look into the source code of python to know how this is done."}, {"owner": {"reputation": 22202, "user_id": 696391, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VrUwT.jpg?s=128&g=1", "display_name": "samgak", "link": "https://stackoverflow.com/users/696391/samgak"}, "edited": false, "score": 0, "creation_date": 1472051422, "post_id": 39126837, "comment_id": 65599572, "body": "Here&#39;s the source: <a href=\"https://svn.python.org/projects/python/trunk/Objects/longobject.c\" rel=\"nofollow noreferrer\">svn.python.org/projects/python/trunk/Objects/longobject.c</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5164080"}, "edited": false, "score": 4, "creation_date": 1472052088, "post_id": 39126837, "comment_id": 65600057, "body": "Well, I don&#39;t want to insult you in any way, but everything you&#39;ve written is just a general information known to me without this answer. So, if you <code>don&#39;t know</code> please don&#39;t answer with <code>I don&#39;t know</code>. Because this is not an answer."}, {"owner": {"reputation": 12328, "user_id": 34426, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/3fyBN.jpg?s=128&g=1", "display_name": "Dan Fego", "link": "https://stackoverflow.com/users/34426/dan-fego"}, "edited": false, "score": 0, "creation_date": 1472052237, "post_id": 39126837, "comment_id": 65600160, "body": "@light2yellow Yeah this is the greatest non-answer answer I&#39;ve seen on SO in a while."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472052345, "post_id": 39126837, "comment_id": 65600241, "body": "&quot;Python 2 and 3 should have the same high level behaviour.&quot; - Even that is wrong. The rest wrong or &quot;don&#39;t know&quot;. I agree with @light2yellow, this is not an answer."}, {"owner": {"reputation": 1447, "user_id": 6746897, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1eb640fcdc6847c55c189ceddb6afca5?s=128&d=identicon&r=PG&f=1", "display_name": "Julien", "link": "https://stackoverflow.com/users/6746897/julien"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472105736, "post_id": 39126837, "comment_id": 65620221, "body": "@olaf what is wrong about &quot;Python 2 and 3 should have the same high level behaviour&quot; ? Please clarify, we may learn something."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 12328, "user_id": 34426, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/3fyBN.jpg?s=128&g=1", "display_name": "Dan Fego", "link": "https://stackoverflow.com/users/34426/dan-fego"}, "edited": false, "score": 0, "creation_date": 1472123916, "post_id": 39126837, "comment_id": 65631692, "body": "@DanFego: Yet it got one upvote (I always wonder how one upvotes - or downvotes - posts he apparently does not understand; some reflex?), so nets it pays for the poster. Hope others will change that."}, {"owner": {"reputation": 27437, "user_id": 95954, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iD0qO.png?s=128&g=1", "display_name": "Rudy Velthuis", "link": "https://stackoverflow.com/users/95954/rudy-velthuis"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472158630, "post_id": 39126837, "comment_id": 65652704, "body": "@Olaf: I upvoted because this answer does answer what was being asked. How and when Python reverts to using BigInteger code is dependent on the platform and the Python implementation. It does not give exact specifics, but explaining how BigIntegers work exactly would thoroughly explode the size of any answer."}, {"owner": {"reputation": 27437, "user_id": 95954, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iD0qO.png?s=128&g=1", "display_name": "Rudy Velthuis", "link": "https://stackoverflow.com/users/95954/rudy-velthuis"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472158951, "post_id": 39126837, "comment_id": 65652882, "body": "@Olaf: the OP may not like the answer, but he can&#39;t expect to get more specifics, IMO. And contrary to the reviewer, I do think this answers the question. It does not request clarification, it gives clarification. And it does not critique either."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 27437, "user_id": 95954, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iD0qO.png?s=128&g=1", "display_name": "Rudy Velthuis", "link": "https://stackoverflow.com/users/95954/rudy-velthuis"}, "edited": false, "score": 0, "creation_date": 1472159242, "post_id": 39126837, "comment_id": 65653018, "body": "@RudyVelthuis: &quot;but explaining how BigIntegers work exactly would thoroughly explode the size of any answer.&quot; - That&#39;s exactly the reason the question has been closed as too broad. The only part which looks like an answer is that integers grow with the size. Which is not quite exactly true for Python2, though. (Btw. I don&#39;t care of OP likes the answer, that is his own decision. I vote/comment according to my opinion.)"}, {"owner": {"reputation": 27437, "user_id": 95954, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iD0qO.png?s=128&g=1", "display_name": "Rudy Velthuis", "link": "https://stackoverflow.com/users/95954/rudy-velthuis"}, "edited": false, "score": 0, "creation_date": 1472159610, "post_id": 39126837, "comment_id": 65653167, "body": "I do think the answer answers what is being asked. That may not be what the OP wanted, but then the OP should ask what he really wants to know. He did ask these questions. If he knew it already, he should have said so in his question. Unlike the reviewer, I do think this is a legitimate answer, and certainly not a comment. It is also not a non-answer answer."}, {"owner": {"reputation": 27437, "user_id": 95954, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iD0qO.png?s=128&g=1", "display_name": "Rudy Velthuis", "link": "https://stackoverflow.com/users/95954/rudy-velthuis"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472160241, "post_id": 39126837, "comment_id": 65653403, "body": "@Olaf: What is not right about Python 2? AFAIK, in Python 2, long integers also have &quot;unlimited&quot; precision, so they obviously also grow with the size."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 27437, "user_id": 95954, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iD0qO.png?s=128&g=1", "display_name": "Rudy Velthuis", "link": "https://stackoverflow.com/users/95954/rudy-velthuis"}, "edited": false, "score": 0, "creation_date": 1472160605, "post_id": 39126837, "comment_id": 65653537, "body": "@RudyVelthuis: YOu already mentioned the difference: They are a different type! (Although the transition is <b>mostly</b> seamless)"}, {"owner": {"reputation": 27437, "user_id": 95954, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iD0qO.png?s=128&g=1", "display_name": "Rudy Velthuis", "link": "https://stackoverflow.com/users/95954/rudy-velthuis"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472160730, "post_id": 39126837, "comment_id": 65653579, "body": "@Olaf: I must be missing something, but I&#39;ll find out on my own, thanks anyway. Is this the difference between long integers and integers?"}], "tags": [], "owner": {"reputation": 1447, "user_id": 6746897, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1eb640fcdc6847c55c189ceddb6afca5?s=128&d=identicon&r=PG&f=1", "display_name": "Julien", "link": "https://stackoverflow.com/users/6746897/julien"}, "is_accepted": false, "score": -1, "last_activity_date": 1472105513, "last_edit_date": 1472105513, "creation_date": 1472050736, "answer_id": 39126837, "question_id": 39126701, "link": "https://stackoverflow.com/questions/39126701/unlimited-integer-precision/39126837#39126837", "title": "Unlimited integer precision", "body": "<blockquote>\n  <p>What if I have a bigger number in Python (not going into 8 bytes)?</p>\n</blockquote>\n\n<p>Python will adapt and always store the correct number, no approximation. Even with very big INTEGER (but this is not true with other types)</p>\n\n<blockquote>\n  <p>How is it stored in the system, literally? Like a few smaller integers? </p>\n</blockquote>\n\n<p>That's python implementation. You could find it from the source code here : <a href=\"http://svn.python.org/projects/python/trunk/Objects/longobject.c\" rel=\"nofollow\">svn.python.org/projects/python/trunk/Objects/longobject.c</a> (thanks @samgak)</p>\n\n<blockquote>\n  <p>Does it hugely slow down the arithmetics on this number? </p>\n</blockquote>\n\n<p>Yes like in other languages when the number becomes bigger than .e.g 2^32 on 32 bits systems the arithmetic becomes slower. How much is implementation dependent.</p>\n\n<blockquote>\n  <p>What does Python do, when it encounters such number? </p>\n</blockquote>\n\n<p>Huge integers are stored in a different way and all arithmetic is adapted to fit.</p>\n\n<blockquote>\n  <p>Is there any difference in Python's 2 &amp; 3 behavior except storing as long in Python 2 and appending L to string representation?</p>\n</blockquote>\n\n<p>Python 2 and 3 should have the same high level behaviour. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5164080"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 805, "favorite_count": 0, "closed_date": 1472052867, "answer_count": 1, "score": 2, "last_activity_date": 1472105513, "creation_date": 1472050391, "last_edit_date": 1472069975, "question_id": 39126701, "link": "https://stackoverflow.com/questions/39126701/unlimited-integer-precision", "closed_reason": "Needs more focus", "title": "Unlimited integer precision", "body": "<p>From <a href=\"https://docs.python.org/3/library/stdtypes.html#numeric-types-int-float-complex\" rel=\"nofollow\">Python Numeric Types</a>:</p>\n\n<blockquote>\n  <p>Integers have unlimited precision.</p>\n</blockquote>\n\n<p>This test\n</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void) {\n    printf(\"%zu bytes\", sizeof(long long));\n    return 0;\n}\n</code></pre>\n\n<p>gives me <code>8 bytes</code> or 64 bits under Linux.</p>\n\n<p>How this is implemented in cpython (this was answered in the comment section)?</p>\n\n<p>What happens when the integer exceeds <code>long long</code> in the implementation?</p>\n\n<p>How big is the speed difference in arithmetics between pre-8-byte and post-8-byte integers?</p>\n"}, {"tags": ["c", "memory-management", "malloc"], "comments": [{"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472049910, "post_id": 39126432, "comment_id": 65598397, "body": "Seems reasonable to me."}, {"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 0, "creation_date": 1472049998, "post_id": 39126432, "comment_id": 65598459, "body": "Pass 1 is ok, no surely bad coding. About exiting the program on <code>calloc</code> returning <code>NULL</code>: you should take care of already allocated items: you must <code>free</code> them before to exit your program or it will leak memory."}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "edited": false, "score": 4, "creation_date": 1472050076, "post_id": 39126432, "comment_id": 65598516, "body": "A null pointer may not have all bits set to zero, so if you&#39;re writing portable code, calloc is a trap."}, {"owner": {"reputation": 57967, "user_id": 2805305, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/442d249754d1725d9510cf06fa46b964?s=128&d=identicon&r=PG&f=1", "display_name": "bolov", "link": "https://stackoverflow.com/users/2805305/bolov"}, "reply_to_user": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 3, "creation_date": 1472050140, "post_id": 39126432, "comment_id": 65598575, "body": "@LPs since the program is already on a fast train to terminate, why bother with manually freeing memory? The OS will do that anyway."}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 2, "creation_date": 1472050194, "post_id": 39126432, "comment_id": 65598612, "body": "OT: Coding <code>struct ll_Node *node = calloc(1, sizeof *node);</code> is more robust."}, {"owner": {"reputation": 2955, "user_id": 4718288, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ee409c8a881d44d6fa6d728445962103?s=128&d=identicon&r=PG&f=1", "display_name": "Hatefiend", "link": "https://stackoverflow.com/users/4718288/hatefiend"}, "reply_to_user": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 0, "creation_date": 1472050208, "post_id": 39126432, "comment_id": 65598621, "body": "@LPs How would I, after every single <code>malloc</code> and <code>calloc</code> in my entire program somehow make a function that could go through every variable and free them like that? I don&#39;t see how that can be done without being a mess."}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 1, "creation_date": 1472050334, "post_id": 39126432, "comment_id": 65598719, "body": "@Hatefiend: &quot;<i>How would I [...] make a function that could go through every variable and free them like that?  I don&#39;t see how that can be done without being a mess.</i>&quot; Sry to state this, but you then might already have a mess now ..."}, {"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "reply_to_user": {"reputation": 57967, "user_id": 2805305, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/442d249754d1725d9510cf06fa46b964?s=128&d=identicon&r=PG&f=1", "display_name": "bolov", "link": "https://stackoverflow.com/users/2805305/bolov"}, "edited": false, "score": 2, "creation_date": 1472050431, "post_id": 39126432, "comment_id": 65598788, "body": "@bolov You are assuming an, let me say, <i>hi-level</i> OS. I didn&#39;t  ;)"}, {"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "reply_to_user": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1472050436, "post_id": 39126432, "comment_id": 65598790, "body": "@alk - I&#39;m not sure that&#39;s completely fair.  Error-handling (or more specifically, rigorous resource cleanup in the face of errors) is just an unpleasant problem in C, given the lack of RAII, etc.."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1472050441, "post_id": 39126432, "comment_id": 65598792, "body": "Exit on &#39;no space&#39; is fine in code that you&#39;re writing for your program to use. It is not OK for code that you expect other people to use. You&#39;d be a bit upset if your program exited because a library function ran out of space.  That said, there often aren&#39;t many alternatives to exiting. But it should be at the decision of the programmer.  When it&#39;s you deciding for your code, exit is fine \u2014 I do that sort of thing.  When you&#39;re deciding for others, it is presumptuous \u2014 you might have just thrown away the user&#39;s hour of editing when the file could have been saved. It would make you unpopular."}, {"owner": {"reputation": 2955, "user_id": 4718288, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ee409c8a881d44d6fa6d728445962103?s=128&d=identicon&r=PG&f=1", "display_name": "Hatefiend", "link": "https://stackoverflow.com/users/4718288/hatefiend"}, "reply_to_user": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1472050471, "post_id": 39126432, "comment_id": 65598808, "body": "@alk Well it&#39;s just that it&#39;s already a pain to check every EVERY <code>malloc</code> and <code>calloc</code> if the pointer returned is <code>NULL</code>, let alone to have to locate and de-allocate every pointer nicely. This is going to sound really stupid but would making a <code>LinkedList</code> of <code>void*</code> and have it contain every single variable I&#39;ve ever allocated memory for in the runtime be a wise way of solving that problem?"}, {"owner": {"reputation": 2955, "user_id": 4718288, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ee409c8a881d44d6fa6d728445962103?s=128&d=identicon&r=PG&f=1", "display_name": "Hatefiend", "link": "https://stackoverflow.com/users/4718288/hatefiend"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472050562, "post_id": 39126432, "comment_id": 65598882, "body": "@JonathanLeffler But if the program ran out of memory, how could it possibly recover? It can no longer create new memory for variables so even something as simple as saving their data to a <code>FILE</code> might be impossible."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472050598, "post_id": 39126432, "comment_id": 65598904, "body": "You can write wrapper functions: <code>extern void *emalloc(size_t size) { void *space = malloc(size); if (space == 0) error(&quot;Out of memory allocating %zu bytes\\n&quot;, size); return space; }</code> where I assume <code>error()</code> does not return and does exit."}, {"owner": {"reputation": 57967, "user_id": 2805305, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/442d249754d1725d9510cf06fa46b964?s=128&d=identicon&r=PG&f=1", "display_name": "bolov", "link": "https://stackoverflow.com/users/2805305/bolov"}, "edited": false, "score": 0, "creation_date": 1472050686, "post_id": 39126432, "comment_id": 65598981, "body": "@Hatefiend it didn&#39;t ran out of memory. It ran out of enough memory to allocate the requested size. It is possible it could still alocate smaller sizes, or even more total memory, but not contiguous."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1472050813, "post_id": 39126432, "comment_id": 65599102, "body": "It may have pre-allocated the space it needs to ensure that it can save the results.  The writing process may not need any more memory.  Word processors, for example, take steps to ensure that they can at least not lose your precious work even if they run out of memory.  A lot of my code uses a set of functions that do exit on error \u2014 it isn&#39;t a wholly unreasonable strategy.  But if the function is going to be a general-purpose library function for other programmers to use, I avoid exiting on error (it ceases to be fully general-purpose when it makes decisions about how to respond to errors)."}, {"owner": {"reputation": 2445, "user_id": 3476780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/abf771bddcd864626a0e1499ccfc699b?s=128&d=identicon&r=PG&f=1", "display_name": "yano", "link": "https://stackoverflow.com/users/3476780/yano"}, "edited": false, "score": 2, "creation_date": 1472050924, "post_id": 39126432, "comment_id": 65599198, "body": "even with no errors with <code>malloc</code> or <code>calloc</code>, how were you planning on deleting/inserting/finding nodes, clearing the entire list,, etc? Every linked-linked implementation should have these function calls; you already have to keep track of EVERY node you create, or what are you even doing?. Then if <code>malloc</code> errs out and you want to clean up and exit, it should be as simple as <code>delete_list(); exit(errCode);</code>"}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1472051028, "post_id": 39126432, "comment_id": 65599283, "body": "Always be prepared for the perfect &quot;dismount&quot;: <a href=\"https://www.youtube.com/watch?v=CzycofSj7EM\" rel=\"nofollow noreferrer\">youtube.com/watch?v=CzycofSj7EM</a> ;-)"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1472051039, "post_id": 39126432, "comment_id": 65599291, "body": "Oh, and exiting without an error message explaining why you&#39;re exiting is bad.  Your user will only be able to say &quot;the program stopped&quot;.  But that in turn indicates part of the problem with the code exiting.  I report errors with <code>fprintf(stderr, &quot;Out of memory\\n&quot;);</code> but in a GUI system, that&#39;s not appropriate.  Maybe the error message should be written to a log file, maybe <code>syslog</code>, or maybe an alert box should be should be shown, or \u2026  Your library function can&#39;t do all of those; it can&#39;t tell which of those it should do.  It&#39;s another reason not to exit from within a library function."}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1472051184, "post_id": 39126432, "comment_id": 65599411, "body": "More or less safe (in terms of graceful error handling) C code is <i>at least</i> 30% error checking &amp; handling."}], "answers": [{"comments": [{"owner": {"reputation": 2955, "user_id": 4718288, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ee409c8a881d44d6fa6d728445962103?s=128&d=identicon&r=PG&f=1", "display_name": "Hatefiend", "link": "https://stackoverflow.com/users/4718288/hatefiend"}, "edited": false, "score": 0, "creation_date": 1472215857, "post_id": 39135866, "comment_id": 65675764, "body": "Thank you for your advice. I actually didn&#39;t know you can do multiple assignments on the same line. That&#39;s really cool!"}], "tags": [], "owner": {"reputation": 62, "user_id": 5927989, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xW8hmrJemB8/AAAAAAAAAAI/AAAAAAAAqvw/JuEgdyq1BKk/photo.jpg?sz=128", "display_name": "Miguel Sosa", "link": "https://stackoverflow.com/users/5927989/miguel-sosa"}, "is_accepted": true, "score": 2, "last_activity_date": 1472092759, "creation_date": 1472092759, "answer_id": 39135866, "question_id": 39126432, "link": "https://stackoverflow.com/questions/39126432/c-calloc-instead-of-malloc-to-save-lines/39135866#39135866", "title": "C - Calloc instead of Malloc to save lines?", "body": "<p>The answers to your questions may all come down to style.</p>\n\n<p>Although your use of calloc is correct to ensure that the allocated memory is zeroed out, especially in a case like this where you are not assigning all the fields when constructing the node, I dislike that you are relying on calloc setting the 0s instead of specifically assigning prev and next to NULL. You have to consider someone else (or even you) reading this code 6 months from now. The code's intention is slightly less clear by not explicitly assigning prev and next to NULL.</p>\n\n<p>Something like this:</p>\n\n<pre><code>static struct ll_Node* ll_Node_new(void *data)\n{\n    struct ll_Node *node = calloc(1, sizeof(struct ll_Node));\n    if (node == NULL) {\n        exit(EXIT_FAILURE);\n    }\n    node-&gt;data = data;\n    node-&gt;prev = node-&gt;next = NULL;\n    return node;\n}\n</code></pre>\n\n<p>Makes it clear to a reader that prev and next are initialized to NULL and the caller should make sure they are set to the correct values.  Code is going to be read many more times than written, so anything you can do to make the intentions of the code obvious will put less stress on someone reading it.</p>\n\n<p>As to your other question, I agree with the commenters that it is preferable if your function returns and you verify in a single place if the function was successful or not and do any notification (setting an error string/code) and cleanup (freeing up the resources cleanly) necessary in a single location.  </p>\n"}, {"tags": [], "owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "is_accepted": false, "score": 1, "last_activity_date": 1472102025, "last_edit_date": 1495541312, "creation_date": 1472102025, "answer_id": 39137143, "question_id": 39126432, "link": "https://stackoverflow.com/questions/39126432/c-calloc-instead-of-malloc-to-save-lines/39137143#39137143", "title": "C - Calloc instead of Malloc to save lines?", "body": "<p>Using <code>calloc(1, sz)</code> is quite acceptable, and in fact preferable to <code>malloc(sz)</code> followed by <code>memset</code>. <a href=\"https://stackoverflow.com/questions/2688466/why-mallocmemset-is-slower-than-calloc\">See here for further reading</a>.</p>\n\n<p>However, it is a bit sloppy to assume that <code>calloc</code> generates null pointers. While that is true on the most popular modern platforms, there have been platforms in the past (and perhaps even still existing) where the null pointer has some other bit pattern.</p>\n\n<p>To be as correct as possible it'd be better to calloc and then explicitly set any pointer to <code>NULL</code>. If you are on a platform where null pointers are in fact all-bits-zero then the compiler will optimize out those assignments.</p>\n"}], "owner": {"reputation": 2955, "user_id": 4718288, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ee409c8a881d44d6fa6d728445962103?s=128&d=identicon&r=PG&f=1", "display_name": "Hatefiend", "link": "https://stackoverflow.com/users/4718288/hatefiend"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 39135866, "answer_count": 2, "score": 1, "last_activity_date": 1472102025, "creation_date": 1472049732, "last_edit_date": 1472050280, "question_id": 39126432, "link": "https://stackoverflow.com/questions/39126432/c-calloc-instead-of-malloc-to-save-lines", "title": "C - Calloc instead of Malloc to save lines?", "body": "<p>I just wanted to double check that the following was a totally okay and appreciated improvement:</p>\n\n<p>If I were to have:</p>\n\n<pre><code>struct ll_Node\n{\n    void *data;\n    struct ll_Node *next, *prev;\n};\n</code></pre>\n\n<p>And I had the constructor:</p>\n\n<pre><code>static struct ll_Node* ll_Node_new(void *data)\n{\n    struct ll_Node *node = calloc(1, sizeof(struct ll_Node));\n    if (node == NULL)\n        exit(EXIT_FAILURE);\n    node-&gt;data = data;\n    return node;\n}\n</code></pre>\n\n<p>In the above code snippet, I want to make sure the <code>previous</code> variable is set to <code>NULL</code>. I heard using <code>calloc</code> defaults variables to <code>0</code> in memory which in C for all intents and purposes is the exact same thing as <code>NULL</code>. </p>\n\n<p>So instead of: </p>\n\n<p><code>struct ll_Node *node = malloc(sizeof(struct ll_Node));</code></p>\n\n<p>I do</p>\n\n<p><code>struct ll_Node *node = calloc(1, sizeof(struct ll_Node));</code></p>\n\n<p>I ask this because <code>calloc</code> seems to be extremely popular when it comes to <strong>arrays</strong>, because if you were to use <code>malloc</code> for an array, the every item would have garbage data in it. Is using <code>calloc</code> with a <code>1</code> in the first parameter slot considered bad coding?. </p>\n\n<hr>\n\n<p>Tiny tiny subquestion: is exiting the program if the thing I use <code>calloc</code> on is <code>NULL</code> acceptable? Or is that a bit extreme? I figure that if there's no memory left to create a struct then clearly any hopes of my program continuing to run are forfeit.</p>\n"}, {"tags": ["java", "c", "jvm", "reverse-engineering"], "comments": [{"owner": {"reputation": 64505, "user_id": 413337, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/783783f968e84cf5047544e9a0f3ccf4?s=128&d=identicon&r=PG", "display_name": "Codo", "link": "https://stackoverflow.com/users/413337/codo"}, "edited": false, "score": 2, "creation_date": 1472049422, "post_id": 39126185, "comment_id": 65598059, "body": "While the general approach to memory layout, memory management and garbage collection has been described in public talks, I don&#39;t think the details have ever been published. They are private implementation details. And some details certainly change with the JRE version, even minor ones."}, {"owner": {"reputation": 77832, "user_id": 3448419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/54njx.png?s=128&g=1", "display_name": "apangin", "link": "https://stackoverflow.com/users/3448419/apangin"}, "edited": false, "score": 0, "creation_date": 1472053460, "post_id": 39126185, "comment_id": 65600947, "body": "Do you want to read memory of a foreign process, or a memory of JVM launched from within the same process?"}, {"owner": {"reputation": 147, "user_id": 6752956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a706c882e200a4bcde18c219842dc4d?s=128&d=identicon&r=PG&f=1", "display_name": "M B", "link": "https://stackoverflow.com/users/6752956/m-b"}, "reply_to_user": {"reputation": 77832, "user_id": 3448419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/54njx.png?s=128&g=1", "display_name": "apangin", "link": "https://stackoverflow.com/users/3448419/apangin"}, "edited": false, "score": 0, "creation_date": 1472054242, "post_id": 39126185, "comment_id": 65601449, "body": "@apangin From a foreign process which can launch the Java process if that benefits the implementation."}], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 6752956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a706c882e200a4bcde18c219842dc4d?s=128&d=identicon&r=PG&f=1", "display_name": "M B", "link": "https://stackoverflow.com/users/6752956/m-b"}, "edited": false, "score": 0, "creation_date": 1472200390, "post_id": 39133025, "comment_id": 65666734, "body": "I went through the API docs and it looks like a good place to start. However I cannot get this to work on my windows 10 laptop. I switched to the 32 bit JRE when running the program in Eclipse and tried to attach to a simple Java process but it doesn&#39;t seem to work: <a href=\"http://i.imgur.com/YfYyvHc.png\" rel=\"nofollow noreferrer\">i.imgur.com/YfYyvHc.png</a> and the sawindbg.dll file is not even included in the JRE by default, I had to download it manually. Is there anything I can do about this or should I switch to an older JRE/JDK version (current using latest) ?"}, {"owner": {"reputation": 77832, "user_id": 3448419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/54njx.png?s=128&g=1", "display_name": "apangin", "link": "https://stackoverflow.com/users/3448419/apangin"}, "reply_to_user": {"reputation": 147, "user_id": 6752956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a706c882e200a4bcde18c219842dc4d?s=128&d=identicon&r=PG&f=1", "display_name": "M B", "link": "https://stackoverflow.com/users/6752956/m-b"}, "edited": false, "score": 0, "creation_date": 1472209905, "post_id": 39133025, "comment_id": 65672190, "body": "@MB Serviceability Agent is included in JDK, not in JRE. Here are SA usage examples: <a href=\"https://github.com/odnoklassniki/jvm-serviceability-examples/tree/master/src/demo3\" rel=\"nofollow noreferrer\">github.com/odnoklassniki/jvm-serviceability-examples/tree/&hellip;</a>"}, {"owner": {"reputation": 147, "user_id": 6752956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a706c882e200a4bcde18c219842dc4d?s=128&d=identicon&r=PG&f=1", "display_name": "M B", "link": "https://stackoverflow.com/users/6752956/m-b"}, "edited": false, "score": 0, "creation_date": 1472281702, "post_id": 39133025, "comment_id": 65698584, "body": "Thanks for the help, it works great on linux. Is there any way this can work on windows too provided that it requires sawindbg.dll?"}, {"owner": {"reputation": 77832, "user_id": 3448419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/54njx.png?s=128&g=1", "display_name": "apangin", "link": "https://stackoverflow.com/users/3448419/apangin"}, "reply_to_user": {"reputation": 147, "user_id": 6752956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a706c882e200a4bcde18c219842dc4d?s=128&d=identicon&r=PG&f=1", "display_name": "M B", "link": "https://stackoverflow.com/users/6752956/m-b"}, "edited": false, "score": 0, "creation_date": 1472293304, "post_id": 39133025, "comment_id": 65701500, "body": "@MB SA works fine on Windows. However, in order to use it, you need JDK (not JRE) of exactly the same version that the target application is running on. For example, if the application runs on JRE 8u101 32-bit, you have to run SA on JDK 8u101 32-bit."}, {"owner": {"reputation": 147, "user_id": 6752956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a706c882e200a4bcde18c219842dc4d?s=128&d=identicon&r=PG&f=1", "display_name": "M B", "link": "https://stackoverflow.com/users/6752956/m-b"}, "edited": false, "score": 0, "creation_date": 1472310587, "post_id": 39133025, "comment_id": 65706613, "body": "Alright, finally made it work on windows. I was talking about the JRE because it requires sawindbg.dll to be in the java.library.path which is generally set to jre/bin. I first downloaded it from the internet because I couldn&#39;t find it included in the jdk or jre which and it didn&#39;t work, but after searching through my pc I found it in the database folders at $ORACLE_HOME/jdk/jre/bin and this one works. Thanks for the help, it&#39;s exacly what I needed. I&#39;ll just go from here and try to replicate some more native solutions."}], "tags": [], "owner": {"reputation": 77832, "user_id": 3448419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/54njx.png?s=128&g=1", "display_name": "apangin", "link": "https://stackoverflow.com/users/3448419/apangin"}, "is_accepted": true, "score": 0, "last_activity_date": 1472072785, "creation_date": 1472072785, "answer_id": 39133025, "question_id": 39126185, "link": "https://stackoverflow.com/questions/39126185/reading-and-interpreting-jvm-memory-from-c/39133025#39133025", "title": "Reading and interpreting JVM memory from C", "body": "<p><a href=\"http://openjdk.java.net/groups/hotspot/docs/Serviceability.html#bsa\" rel=\"nofollow\">HotSpot Serviceability Agent</a> can do this. It knows how to reconstruct JVM structures from memory of a foreign Java process or from a core dump.</p>\n\n<p>Serviceability Agent has <a href=\"http://docs.oracle.com/javase/8/docs/serviceabilityagent/index.html\" rel=\"nofollow\">Java API</a> available at <code>{JDK}/lib/sa-jdi.jar</code>. It is feasible to implement similar functionality in C, though it would require much efforts.<br>\nAnyway, you may look at SA sources <a href=\"http://hg.openjdk.java.net/jdk8u/jdk8u/hotspot/file/312e113bc3ed/agent\" rel=\"nofollow\">here</a>.</p>\n"}], "owner": {"reputation": 147, "user_id": 6752956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a706c882e200a4bcde18c219842dc4d?s=128&d=identicon&r=PG&f=1", "display_name": "M B", "link": "https://stackoverflow.com/users/6752956/m-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 576, "favorite_count": 0, "accepted_answer_id": 39133025, "answer_count": 1, "score": 1, "last_activity_date": 1472072785, "creation_date": 1472049118, "last_edit_date": 1472049191, "question_id": 39126185, "link": "https://stackoverflow.com/questions/39126185/reading-and-interpreting-jvm-memory-from-c", "title": "Reading and interpreting JVM memory from C", "body": "<p>So I'm trying to read the memory of a Java process from C code. I found documentation on the JVM structure (heap, perm gen, method area etc.) but none of these articles actually show how to find where these areas are in memory. </p>\n\n<p>From what I understood, classes are stored in the method area and all instances in the heap on the first 32 bits have a pointer (I'm talking about x86 JVM) to these classes. I've tried the jmap and jhat utilities provided in the JDK hoping that I could find a \"pattern\" for the memory locations, but failed to do as they only show the memory location of the instances. The <code>ClassLoader</code> doesn't provide any pointers to classes and static fields but I found some memory locations for <code>Class</code> objects by applying reflection in the java program and looking at the referenced <code>Class</code> object memory location. There must be some way to determine where these things are stored otherwise the Java process wouldn't know how to fetch them either.</p>\n\n<p>Can anyone provide some insight on how to find instances, classes, static fields in memory or point me in the right direction? </p>\n\n<p>I know it's possible through Java code but I need this in C. Usage of JNI or modifying the Java program is not acceptable either as I need it entirely written in native code.</p>\n"}, {"tags": ["c", "excel", "math", "arduino", "algebra"], "comments": [{"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472049991, "post_id": 39126073, "comment_id": 65598453, "body": "<a href=\"https://en.wikipedia.org/wiki/Trilateration\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Trilateration</a>"}, {"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472050026, "post_id": 39126073, "comment_id": 65598483, "body": "I&#39;m voting to close this question as off-topic because this is (currently) a maths problem (more on-topic for <a href=\"http://math.stackexchange.com\">math.stackexchange.com</a>), not a programming problem - the code should be obvious once you&#39;ve nailed the maths."}, {"owner": {"reputation": 43, "user_id": 2772031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0380ca1fa21527eef5f66df96484eb9c?s=128&d=identicon&r=PG&f=1", "display_name": "BrianD", "link": "https://stackoverflow.com/users/2772031/briand"}, "reply_to_user": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472050233, "post_id": 39126073, "comment_id": 65598635, "body": "Cheers Oliver, I&#39;ve had a quick look, Got a headache now :-)  Struggle to understand the maths."}, {"owner": {"reputation": 486, "user_id": 2677670, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/9e4be09701a10c2335f590abd4116d9d?s=128&d=identicon&r=PG&f=1", "display_name": "mactro", "link": "https://stackoverflow.com/users/2677670/mactro"}, "edited": false, "score": 0, "creation_date": 1472195990, "post_id": 39126073, "comment_id": 65664345, "body": "What type of senors do you use? Are you sure they measure distance to exactly the same point?"}, {"owner": {"reputation": 43, "user_id": 2772031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0380ca1fa21527eef5f66df96484eb9c?s=128&d=identicon&r=PG&f=1", "display_name": "BrianD", "link": "https://stackoverflow.com/users/2772031/briand"}, "edited": false, "score": 0, "creation_date": 1472591422, "post_id": 39126073, "comment_id": 65811428, "body": "Yes the sensors are polar specific to north pole of a small electro-magnet."}], "owner": {"reputation": 43, "user_id": 2772031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0380ca1fa21527eef5f66df96484eb9c?s=128&d=identicon&r=PG&f=1", "display_name": "BrianD", "link": "https://stackoverflow.com/users/2772031/briand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1472049730, "creation_date": 1472048842, "last_edit_date": 1472049730, "question_id": 39126073, "link": "https://stackoverflow.com/questions/39126073/vectors-intersection-in-3d-space", "title": "Vectors Intersection in 3D space", "body": "<p>I programming up an Arduino board (using C and experimenting in Excel to get my calculations right).</p>\n\n<p>I need some help calculating the location of a target within a particular range in 3 dimensions.</p>\n\n<p>I have a sensor system that gives the distance at each detector to a target\nFour detectors are 50mm apart on the top rectangular plane A,B,C,D\nThe co-ordinates of the corners on the example cube are:</p>\n\n<pre><code>A: (-25,25,0); \nB: (25,25,0); \nC: (-25,25,0); \nD: (-25,-25,0) [Sensor plane]\nE: (-25,25,-50); \nF: (25,25,-50); \nG: (-25,25,-50); \nH: (-25,-25,-50)\n</code></pre>\n\n<p>The target <code>T1</code> is resting at <code>(2,7,-26)</code></p>\n\n<p>I calculate the distance from (4 decimals)\nA to <code>T1 = 32.4500</code>, B to <code>T1 = 29.2060</code>, C to <code>T1 = 39.4081</code> and D to <code>T1 = 41.8688</code></p>\n\n<p>In reality there is no cube, I only have the known distances between the sensors and the range (Distance) that the Target is from each Sensor and the Target could be anywhere within 1 meter of the Sensor but never above the Sensor plane.</p>\n\n<p>Anybody out there able to let me know how I can work out Target's (x,y,z) from these fixed points and the four distances in algebra or trig.</p>\n\n<p>Much appreciated as I need to keep the code tight since there's not that much room.</p>\n\n<p><a href=\"https://i.stack.imgur.com/t4vkW.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/t4vkW.jpg\" alt=\"Examples\"></a></p>\n"}, {"tags": ["c", "gcc", "linker", "shared-libraries", "compiler-flags"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1472048512, "post_id": 39125920, "comment_id": 65597392, "body": "What specifically about the man-page of gcc did you not understand? Did you look up the options you use? What they mean?"}, {"owner": {"reputation": 3688, "user_id": 1111557, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f2b40cacf02c8fa3f91429ef441912ac?s=128&d=identicon&r=PG", "display_name": "inetknght", "link": "https://stackoverflow.com/users/1111557/inetknght"}, "edited": false, "score": 1, "creation_date": 1472048577, "post_id": 39125920, "comment_id": 65597438, "body": "If you previously had only one source file and now you have two, then yes absolutely that would cause that. What do you think it&#39;s trying to do?"}], "answers": [{"comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472050168, "post_id": 39126322, "comment_id": 65598591, "body": "Note that the object files will not be in <code>Demo1&#47;src</code>; they&#39;ll be in the current directory.  If you want the object files in <code>Demo1&#47;src</code>, you&#39;ll have to compile each file separately with the output file specified (using <code>-o Demo1&#47;src&#47;whatever.o</code>)."}, {"owner": {"reputation": 32098, "user_id": 646887, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YJ0Ye.jpg?s=128&g=1", "display_name": "Klas Lindb&#228;ck", "link": "https://stackoverflow.com/users/646887/klas-lindb%c3%a4ck"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472051128, "post_id": 39126322, "comment_id": 65599367, "body": "@JonathanLeffler Thanks for reminding me. Been a while since I used multiple directories without the aid of makefiles. And when I see my edited answer it is easy to understand why."}], "tags": [], "owner": {"reputation": 32098, "user_id": 646887, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YJ0Ye.jpg?s=128&g=1", "display_name": "Klas Lindb&#228;ck", "link": "https://stackoverflow.com/users/646887/klas-lindb%c3%a4ck"}, "is_accepted": false, "score": 1, "last_activity_date": 1472050931, "last_edit_date": 1472050931, "creation_date": 1472049479, "answer_id": 39126322, "question_id": 39125920, "link": "https://stackoverflow.com/questions/39125920/gcc-wont-let-me-just-compile-c-source-after-addition-of-source-files/39126322#39126322", "title": "gcc won&#39;t let me &#39;just compile&#39; c source after addition of source files", "body": "<p>It is complaining that you try to compile multiple <code>.c</code> files into a single <code>.o</code> file. When you omit the link step, each source file will result in a separate output file.</p>\n\n<p>The default name for the output file is that <code>.c</code> is replaced by <code>.o</code> when the <code>-c</code> (compile only) flag is specified. This will put the intermediate files in the current directory.</p>\n\n<p>Let the compiler name the output files in the compile step and include all object files in the link step:</p>\n\n<pre><code>cd Demo1/build\ngcc -c -fpic ../src/*.c -Ilib1/include \ngcc -shared *.o -Llib1/lib -llib1 -o ../dist/libDemo1.so\n</code></pre>\n\n<p>Another way is to split the compile step into one line for each source file. </p>\n\n<p>As you can see, this isn't very user friendly and will get messy as you create more files.</p>\n\n<p>If I were you I would create a <code>makefile</code> (or learn some newer build system if I wanted spice up my CV). That way you can specify the compilation the way you want it  using rules and then build using a single command.</p>\n"}, {"tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": false, "score": 2, "last_activity_date": 1472051275, "last_edit_date": 1472051275, "creation_date": 1472049879, "answer_id": 39126487, "question_id": 39125920, "link": "https://stackoverflow.com/questions/39125920/gcc-wont-let-me-just-compile-c-source-after-addition-of-source-files/39126487#39126487", "title": "gcc won&#39;t let me &#39;just compile&#39; c source after addition of source files", "body": "<p>The <code>-o</code> option specifies the (single) output file.  Blithely ignoring the options that are not immediately relevant, when you have:</p>\n\n<pre><code>gcc -c file1.c file2.c -o output.o\n</code></pre>\n\n<p>does the output from <code>file1.c</code> or <code>file2.c</code> go into <code>output.o</code>?</p>\n\n<p>GCC is telling you that you can't do that.  Either you have to use:</p>\n\n<pre><code>gcc -c file1.c -o file1.o\ngcc -c file2.c -o file2.o\n</code></pre>\n\n<p>or you have to use:</p>\n\n<pre><code>gcc -c file1.c file2.c\n</code></pre>\n\n<p>That's what the error message says.</p>\n\n<p>Note that you have source code in a sub-directory.  The default output from the compiler will be in the current directory.  That is:</p>\n\n<pre><code>gcc -c Demo1/file1.c Demo1/file2.c\n</code></pre>\n\n<p>will create output files <code>./file1.o</code> and <code>./file2.o</code>.  AFAIK, there isn't a way to specify the output <em>directory</em> (<code>-o directory-name</code> gives an error like <code>error: unable to open output file 'directory-name': 'Is a directory'</code>, for example).  Therefore, the separate compilation with the explicit output file is probably the best way for you to work.  It is also what build systems such as <code>make</code> would do.</p>\n"}], "owner": {"reputation": 13, "user_id": 4832103, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/15f307c06eceaf6d7c3ea338f0a5c75f?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel_Bogorad", "link": "https://stackoverflow.com/users/4832103/daniel-bogorad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1472051275, "creation_date": 1472048406, "question_id": 39125920, "link": "https://stackoverflow.com/questions/39125920/gcc-wont-let-me-just-compile-c-source-after-addition-of-source-files", "title": "gcc won&#39;t let me &#39;just compile&#39; c source after addition of source files", "body": "<p>I'm writing a program that looks roughly like this:  </p>\n\n<ul>\n<li>Some main code in src/ </li>\n<li>Some code in Demo1/  </li>\n</ul>\n\n<p>I compile Demo1's stuff into .o , then .so, and use that .so in the creation of the main executable. (Demo1's code is used in src/).<br>\nDemo1 uses an already complied library <strong>lib1</strong> that sits in a separate folder with both its binaries and the source.  </p>\n\n<p>That's how I've been building Demo1:  </p>\n\n<pre><code>gcc -c -fpic Demo1/src/*.c -Ilib1/include -o Demo1/build/demo1.o  \ngcc -shared Demo1/build/demo1.o -Llib1/lib -llib1 -o Demo1/dist/libDemo1.so\n</code></pre>\n\n<p>Now I've added one new .c file and one new .h to Demo1 and then this happened when I ran the build script (that contains the two command from above, among others):  </p>\n\n<blockquote>\n  <p>gcc: fatal error: cannot specify -o with -c, -S or -E with multiple files  </p>\n</blockquote>\n\n<p>What does it mean ? I don't think that an addition of a source file could have caused this..<br>\nI've been using <code>-c</code> with <code>-o</code> on the same line in the past of course, and besides that - the last part of the sentence is not the most clear to me grammatically... (does it mean I can't specify -o with <strong>{-E when -E has multiple files}</strong>)?</p>\n\n<p>I'm running gcc 4.8.4 on an Ubuntu 14.04 machine.<br>\nThanks in advance.</p>\n"}, {"tags": ["c", "macros", "c-preprocessor"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1472048378, "post_id": 39125854, "comment_id": 65597310, "body": "Why do you think you need to convert it into ternary? You can write <code>if</code> very well in the macro. Just don&#39;t forget backslashes in the line breaks..."}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "edited": false, "score": 1, "creation_date": 1472048515, "post_id": 39125854, "comment_id": 65597394, "body": "Don&#39;t abuse macros. Leave the break in the code, so it will make sense to anyone who reads it."}, {"owner": {"reputation": 117, "user_id": 1995082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cAU3J.gif?s=128&g=1", "display_name": "Terminator", "link": "https://stackoverflow.com/users/1995082/terminator"}, "reply_to_user": {"reputation": 96743, "user_id": 2455888, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/MQu4W.png?s=128&g=1", "display_name": "haccks", "link": "https://stackoverflow.com/users/2455888/haccks"}, "edited": false, "score": 0, "creation_date": 1472048530, "post_id": 39125854, "comment_id": 65597409, "body": "@haccks it is in 2nd line i want if condition is not true nothing happens"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 3, "creation_date": 1472048616, "post_id": 39125854, "comment_id": 65597469, "body": "Don&#39;t change control flow of the outer code inside a macro! No one will understand what your code does. That includes yourself after some weeks/months!"}, {"owner": {"reputation": 117, "user_id": 1995082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cAU3J.gif?s=128&g=1", "display_name": "Terminator", "link": "https://stackoverflow.com/users/1995082/terminator"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1472048673, "post_id": 39125854, "comment_id": 65597507, "body": "@EugeneSh. Hi,i saw this therefore i thought this would be used <a href=\"http://stackoverflow.com/questions/12989298/is-it-possible-to-use-a-if-statement-inside-define\" title=\"is it possible to use a if statement inside define\">stackoverflow.com/questions/12989298/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472054352, "post_id": 39126055, "comment_id": 65601529, "body": "This fails in the context: <code>if (\u2026) IfCount(x, 5); else \u2026</code> because the else here is a syntax error.  That is why people use the <code>#define IfCount(i, j) do { if ((i) == (j)) { count++; break; } while (0)</code> meme; it doesn&#39;t break the syntax of <code>if (\u2026) IfCount(i, j); else \u2026</code>."}, {"owner": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472054478, "post_id": 39126055, "comment_id": 65601630, "body": "Your version won&#39;t work either:  The <code>break</code>-statement will break out of the <code>do-while(0)</code> loop, and not the outer, user-written loop."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1472054529, "post_id": 39126055, "comment_id": 65601668, "body": "Oh \u2014\u2014 futz!  You&#39;re right, of course.  Grrr!  Don&#39;t do what the macro&#39;s trying to do, then."}, {"owner": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472054568, "post_id": 39126055, "comment_id": 65601696, "body": "Honestly, the attempt at a macro here is BS and pointless obfuscation.   The OP would be better off writing simple, clear, explicit code without macros. :)"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1472054759, "post_id": 39126055, "comment_id": 65601809, "body": "Absolutely \u2014 the macro is misguided, and my attempt to fix one problem didn&#39;t help. A numbered break (<code>break 2;</code> as in <a href=\"https://www.gnu.org/software/bash/manual/bash.html#Bourne-Shell-Builtins\" rel=\"nofollow noreferrer\">shell</a> scripts) would fix it if C supported it, but it doesn&#39;t."}, {"owner": {"reputation": 117, "user_id": 1995082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cAU3J.gif?s=128&g=1", "display_name": "Terminator", "link": "https://stackoverflow.com/users/1995082/terminator"}, "edited": false, "score": 0, "creation_date": 1472055674, "post_id": 39126055, "comment_id": 65602360, "body": "@abelenky this is the code i have to convert it to macro no matter what <a href=\"http://pastebin.com/i7Tuyh00\" rel=\"nofollow noreferrer\">pastebin.com/i7Tuyh00</a>"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 117, "user_id": 1995082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cAU3J.gif?s=128&g=1", "display_name": "Terminator", "link": "https://stackoverflow.com/users/1995082/terminator"}, "edited": false, "score": 1, "creation_date": 1472063328, "post_id": 39126055, "comment_id": 65606563, "body": "@Terminator: the code shown in the pastebin won&#39;t benefit at all from using a macro (which is invoked once).  Were you not under constraints from some tutor, submitting that code with a macro such as the proposed one would be cause for immediate loss of marks and/or face \u2014 it is pointless to make a macro except as a pedagogic exercise.  I&#39;d be tempted to use: <code>#define if_condition_body(condition, body) if (condition) { body; } else</code> and then invoke <code>if_condition_body(i == j, count++; break)</code> where the semicolon (and <code>break</code>) in the macro invocation makes it clear this isn&#39;t a regular function."}], "tags": [], "owner": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "is_accepted": false, "score": 0, "last_activity_date": 1472056193, "last_edit_date": 1472056193, "creation_date": 1472048809, "answer_id": 39126055, "question_id": 39125854, "link": "https://stackoverflow.com/questions/39125854/how-do-i-write-if-conditions-like-these-in-a-macro/39126055#39126055", "title": "How do I write if conditions like these in a macro?", "body": "<p>I don't see any need to use the ternary (<code>?:</code>) operator.<br>\nSo here is your macro using an if-statement.</p>\n\n<pre><code>#define IfCount(i,j) if ((i)==(j)) { count++; break; }\n</code></pre>\n\n<p><strong>Usage:</strong></p>\n\n<pre><code>IfCount(x,5);\n</code></pre>\n\n<hr>\n\n<p>Okay, what do you guys think of this?</p>\n\n<pre><code>#define IfCount(i,j) if ((i)==(j)) { count++; break; } do{}while(0)\n</code></pre>\n\n<p>The final, isolated <code>do-while-0</code> serves a couple of purposes:</p>\n\n<ul>\n<li>Its a place to hang a semi-colon, so the macro usage looks like \"normal\" C and ends with a semi-colon.</li>\n<li>It prevents an inadvertent else-statement afterwards, because the syntax <code>do{}while(0) else</code> is invalid.</li>\n</ul>\n\n<p>Is there anything else it should take care of?</p>\n"}, {"comments": [{"owner": {"reputation": 117, "user_id": 1995082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cAU3J.gif?s=128&g=1", "display_name": "Terminator", "link": "https://stackoverflow.com/users/1995082/terminator"}, "edited": false, "score": 0, "creation_date": 1472048972, "post_id": 39126059, "comment_id": 65597724, "body": "ok thanks but what is this sir <a href=\"http://stackoverflow.com/questions/12989298/is-it-possible-to-use-a-if-statement-inside-define\" title=\"is it possible to use a if statement inside define\">stackoverflow.com/questions/12989298/&hellip;</a>"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 117, "user_id": 1995082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cAU3J.gif?s=128&g=1", "display_name": "Terminator", "link": "https://stackoverflow.com/users/1995082/terminator"}, "edited": false, "score": 0, "creation_date": 1472049108, "post_id": 39126059, "comment_id": 65597827, "body": "@HumayunAkhtar Are you trying to control the flow of a program, such as with <code>break</code>?  Or are you trying to assign the results of an expression?  That question you linked is trying to assign something.  Your question isn&#39;t about that."}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "reply_to_user": {"reputation": 117, "user_id": 1995082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cAU3J.gif?s=128&g=1", "display_name": "Terminator", "link": "https://stackoverflow.com/users/1995082/terminator"}, "edited": false, "score": 0, "creation_date": 1472051752, "post_id": 39126059, "comment_id": 65599824, "body": "@Terminator: It looks like you are trying to convert a program to obfuscating macros just for the sake of it, and that makes no sense whatsoever. I&#39;m guessing that it is some kind of weird assignment..."}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "reply_to_user": {"reputation": 117, "user_id": 1995082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cAU3J.gif?s=128&g=1", "display_name": "Terminator", "link": "https://stackoverflow.com/users/1995082/terminator"}, "edited": false, "score": 0, "creation_date": 1472051890, "post_id": 39126059, "comment_id": 65599922, "body": "@Terminator: In C there are expressions and there are statements. A macro can be one or the other (or even none) but not an statement and an expression at the same time. <code>if</code> is a statement, so is <code>break</code>, but <code>?:</code> is an expression."}, {"owner": {"reputation": 117, "user_id": 1995082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cAU3J.gif?s=128&g=1", "display_name": "Terminator", "link": "https://stackoverflow.com/users/1995082/terminator"}, "edited": false, "score": 0, "creation_date": 1472054083, "post_id": 39126059, "comment_id": 65601341, "body": "@rodrigo this is a weird assignment and i knew nothing about macro i&#39;m learning on all interent and trying to solve it"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472054108, "post_id": 39126059, "comment_id": 65601358, "body": "The trailing semicolon in the macro (<code>#define ifcount(i,j) if ((i)==(j)) { count=count+1; break; } else ;</code>) is bad news.  In the context: <code>if (\u2026) ifcount(i, j); else \u2026</code>, the trailing semicolon in the macro makes this code into a syntax error \u2014 the <code>else</code> in this code is invalid.  You could, I suppose, omit that trailing semicolon in the macro definition (but that&#39;s icky \u2014 it would require copious comments).  But this is why people use the <code>#define ifcount(i, j) do { if ((i) == (j)) { count++; break; } while (0)</code> meme; it doesn&#39;t break the syntax of <code>if (\u2026) ifcount(i, j); else \u2026</code>."}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472054470, "post_id": 39126059, "comment_id": 65601627, "body": "@JonathanLeffler: You are right, of course. My intention was to write the <i>dangling else</i>, without the semicolon, but that is so unnatural to write. I&#39;ll change it to the <code>while (0)</code> thing."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1472054582, "post_id": 39126059, "comment_id": 65601705, "body": "Note what <a href=\"http://stackoverflow.com/users/34824/abelenky\">abelenky</a> <a href=\"http://stackoverflow.com/questions/39125854/how-do-i-write-if-conditions-like-these-in-a-macro/39126059?noredirect=1#comment65601630_39126055\">told</a> me.  Aaargh!"}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1472054767, "post_id": 39126059, "comment_id": 65601816, "body": "@JonathanLeffler: Ouch! I know the dangling <code>else</code> will come handy sometime... reverting."}], "tags": [], "owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "is_accepted": true, "score": 2, "last_activity_date": 1472055014, "last_edit_date": 1472055014, "creation_date": 1472048815, "answer_id": 39126059, "question_id": 39125854, "link": "https://stackoverflow.com/questions/39125854/how-do-i-write-if-conditions-like-these-in-a-macro/39126059#39126059", "title": "How do I write if conditions like these in a macro?", "body": "<p>Using (abusing) macros to change the flow of the program is usually a bad idea, because the people that will read your code (yourself in a few years) may get surprised by unexpected jumps in the program flow.</p>\n\n<p>That said, your problem has nothing to do with the ternary operator. Actually the ternary operator cannot contain a break in its right side, only expressions. </p>\n\n<p>But macros are allmighty, so you can just do:</p>\n\n<pre><code>#define ifcount(i,j) if ((i)==(j)) { count=count+1; break; }\n</code></pre>\n\n<p>The main problem with this macro is that people will write a <code>;</code> when using it, and it will break badly if it is used between another <code>if /else</code> pair, without braces:</p>\n\n<pre><code>if (...)\n    ifcount(a,b);\nelse // &lt;--- syntax error because the previous ; breaks the if /else relation\n    ...;\n</code></pre>\n\n<p>The standard solution is to use the <code>do/while(0)</code> idiom:</p>\n\n<pre><code>#define do { ifcount(i,j) if ((i)==(j)) { count=count+1; break; } } while (0)\n</code></pre>\n\n<p>But that will not work because the <code>break</code> will break this inner <code>while</code>, not the one you want (credit to @abelenky) below.</p>\n\n<p>The only other C statement that allows a compound statement and ends with a <code>;</code> is this one:</p>\n\n<pre><code>#define ifcount(i,j) if ((i)==(j)) { count=count+1; break; } else\n</code></pre>\n\n<p>The problem is that if you forget to add the <code>;</code> when using <code>ifcount(i,j)</code>, instead of a compiler error you will get a silently compiling and surprisingly change in behavior.</p>\n"}], "owner": {"reputation": 117, "user_id": 1995082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cAU3J.gif?s=128&g=1", "display_name": "Terminator", "link": "https://stackoverflow.com/users/1995082/terminator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 813, "favorite_count": 0, "accepted_answer_id": 39126059, "answer_count": 2, "score": -2, "last_activity_date": 1472056193, "creation_date": 1472048219, "last_edit_date": 1472055567, "question_id": 39125854, "link": "https://stackoverflow.com/questions/39125854/how-do-i-write-if-conditions-like-these-in-a-macro", "title": "How do I write if conditions like these in a macro?", "body": "<p>I'm quite new to macros.<br>\nI know how to use if condition using ternary operator.<br>\nHow do I convert this into a <code>#define</code> </p>\n\n<pre><code>if(i==j)\n            {\n                count=count+1;\n                break;\n            }\n</code></pre>\n\n<p>I try my luck with this but seems like it is wrong: </p>\n\n<pre><code>#define ifcount(i,j) ((i)==(j)? count=count+1\\\n                                    break:0)\n</code></pre>\n\n<p>This is the code i'm trying to convert \n<a href=\"http://pastebin.com/i7Tuyh00\" rel=\"nofollow\">http://pastebin.com/i7Tuyh00</a></p>\n"}, {"tags": ["c", "file", "operating-system", "gnu"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1472048374, "post_id": 39125784, "comment_id": 65597307, "body": "The book is wrong. There is no specific time when the data is actually on disc. But that is true for all normal file-IO. You might want to read about OS. Does the book say there is no buffering <b>at all</b> or just by the file-functions?"}, {"owner": {"reputation": 1, "user_id": 6443678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c65f226d538481a84c6576ad0957739?s=128&d=identicon&r=PG&f=1", "display_name": "NareshR", "link": "https://stackoverflow.com/users/6443678/nareshr"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472049411, "post_id": 39125784, "comment_id": 65598051, "body": "@Olaf: Yes, the book says there is no concept of buffering in case of low level file routines."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472051342, "post_id": 39125784, "comment_id": 65599516, "body": "<i>Sigh</i> Read my comment <b>carefully</b> again! Then think about it! Then google (or whatever you use to lookup &quot;linux file buffering&quot;)!"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 6443678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c65f226d538481a84c6576ad0957739?s=128&d=identicon&r=PG&f=1", "display_name": "NareshR", "link": "https://stackoverflow.com/users/6443678/nareshr"}, "edited": false, "score": 0, "creation_date": 1472049545, "post_id": 39126020, "comment_id": 65598142, "body": "I understand what you have said, but my question is why will the delay take place?"}], "tags": [], "owner": {"reputation": 10300, "user_id": 2469027, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b62ce55f4f1a0eff6775e7863850a912?s=128&d=identicon&r=PG", "display_name": "Edward Karak", "link": "https://stackoverflow.com/users/2469027/edward-karak"}, "is_accepted": false, "score": 0, "last_activity_date": 1472048696, "creation_date": 1472048696, "answer_id": 39126020, "question_id": 39125784, "link": "https://stackoverflow.com/questions/39125784/understanding-low-level-file-routines/39126020#39126020", "title": "Understanding low level file routines", "body": "<p>A file is said to be <em>buffered</em>, when its contents are not outputted or inputted directly. Instead, the file's bytes are written to a temporary buffer in memory. </p>\n\n<p>For example, if you are reading from a file, you are reading from the buffer. Once you have read all the characters in the buffer, it is replenished with new bytes from the file. The reason for this indirectness, is that a memory read is much faster than a hard disk read. </p>\n\n<p>The calls <code>read</code> and <code>write</code> are low-level, and do not perform buffering. The <code>stdio.h</code> calls like <code>getc</code> and <code>putc</code>, do use buffering. These higher-level APIs only call the low level ones, when the buffer must be replenished.</p>\n"}, {"tags": [], "owner": {"reputation": 698, "user_id": 6697083, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zwg0f.png?s=128&g=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/6697083/riley"}, "is_accepted": false, "score": 0, "last_activity_date": 1472050705, "creation_date": 1472050705, "answer_id": 39126824, "question_id": 39125784, "link": "https://stackoverflow.com/questions/39125784/understanding-low-level-file-routines/39126824#39126824", "title": "Understanding low level file routines", "body": "<p>Writing to the hard drive is much slower than writing to RAM. When you write to a drive it writes to memory, but doesn't always write to the disk immediately. The data might not be written to disk until that part of memory needs to be overwritten to make room for something else. This is called a Write-Back cache.</p>\n"}, {"tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": false, "score": 1, "last_activity_date": 1472055188, "creation_date": 1472055188, "answer_id": 39128311, "question_id": 39125784, "link": "https://stackoverflow.com/questions/39125784/understanding-low-level-file-routines/39128311#39128311", "title": "Understanding low level file routines", "body": "<p>There are two places where I/O buffering can occur (at least \u2014 it could be more than just two).</p>\n\n<p>One is in the application; the standard I/O functions using <code>FILE *</code> use buffered I/O unless you use <code>setvbuf()</code> to prevent it.</p>\n\n<p>The other is in the kernel.  Disk I/O normally goes into the kernel buffer pool, and eventually gets written by the kernel to disk.  There are ways around that (<code>O_DIRECT</code> on Linux; raw devices on classic Unix; etc).  The key point is that the <code>write()</code> system call normally writes to he kernel buffer pool.  The kernel takes responsibility for ensuring that the data is written to disk safely and correctly (journalling, \u2026).</p>\n\n<p>The kernel doesn't write everything to disk immediately because (a) you may add more changes to the data, (b) other people may need to read or write the data, (c) the disk drive may be busy writing something else at the other end of its 1 TiB of storage and it will take time to get the write head in position to take your data, and it would be better for the overall performance of the system if it scheduled other work before writing your changed buffer to disk.  It will get written to disk.  It is just not defined when, and it could be fractions of a second or multiple seconds or longer, though most often it will not take minutes for the data to be written to disk.</p>\n\n<p>These days, there could also be buffering in the RAID controllers, and maybe in the individual disks inside the RAID setup, and maybe there's network buffering too if it is a remotely-mounted file system.  Those add extra levels of buffering.</p>\n\n<p>The <code>read()</code> and <code>write()</code> and related low-level I/O functions do not have any client-side (application) buffering \u2014 unlike the standard C I/O functions.</p>\n"}], "owner": {"reputation": 1, "user_id": 6443678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c65f226d538481a84c6576ad0957739?s=128&d=identicon&r=PG&f=1", "display_name": "NareshR", "link": "https://stackoverflow.com/users/6443678/nareshr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1472055188, "creation_date": 1472048036, "question_id": 39125784, "link": "https://stackoverflow.com/questions/39125784/understanding-low-level-file-routines", "title": "Understanding low level file routines", "body": "<p>I am going through Mark Burgess's \"The GNU C Programming Tutorial\". I have come across the following information:</p>\n\n<blockquote>\n  <p>Even though low-level fle routines do not use bu\ufb00ering, and once you call write, your data can be read from the file immediately, it may take up to a minute before your data is physically written to disk. (Page:142)</p>\n</blockquote>\n\n<p>Firstly, is \"it may take up to a minute(some time) before your data is written to disk\" true? </p>\n\n<p>Secondly, when low level file routines are not using buffering why will the delay take place? </p>\n"}, {"tags": ["c", "matlab", "rounding"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1472048195, "post_id": 39125706, "comment_id": 65597162, "body": "Questions seeking debugging help (&quot;why isn&#39;t this code working?&quot;) must include the desired behavior, a specific problem or error and the shortest code necessary to reproduce it in the question itself. Questions without a clear problem statement are not useful to other readers. See: How to create a Minimal, Complete, and Verifiable example."}, {"owner": {"reputation": 11277, "user_id": 3657941, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/304d8d4cceca5f9ce2383ff97b53e36b?s=128&d=identicon&r=PG&f=1", "display_name": "David Cullen", "link": "https://stackoverflow.com/users/3657941/david-cullen"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 3, "creation_date": 1472048640, "post_id": 39125706, "comment_id": 65597480, "body": "@Olaf is correct: We need a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> and we need the expected result."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1472067816, "post_id": 39125706, "comment_id": 65608940, "body": "Does code have <code>#include &lt;math.h&gt;</code> before using <code>round()</code> to properly prototype <code>round()</code> - or is <code>round()</code> your own code?  The <code>(double)</code> cast in <code>(double)round(movmean_h[i]*n)&#47;n;</code> is suspicious - it should not be needed."}, {"owner": {"reputation": 79, "user_id": 3481699, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5d609d7f85e34d9ee842cdc1c8cd23a8?s=128&d=identicon&r=PG&f=1", "display_name": "Aboozar Roosta", "link": "https://stackoverflow.com/users/3481699/aboozar-roosta"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472109314, "post_id": 39125706, "comment_id": 65622142, "body": "Yes @chux. Thanks. That was the problem. I added math.h and it works fine now. Also the double is not necessary and it doesn&#39;t change the result."}, {"owner": {"reputation": 4242, "user_id": 2903371, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b51033cda71617323ee74389bd6715a9?s=128&d=identicon&r=PG&f=1", "display_name": "patrik", "link": "https://stackoverflow.com/users/2903371/patrik"}, "edited": false, "score": 1, "creation_date": 1472109925, "post_id": 39125706, "comment_id": 65622525, "body": "@AboozarRoosta Normally casting should be avoided. A lot of casting like this is normally indicating that something is wrong (like that you were missing some headers)."}], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 3481699, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5d609d7f85e34d9ee842cdc1c8cd23a8?s=128&d=identicon&r=PG&f=1", "display_name": "Aboozar Roosta", "link": "https://stackoverflow.com/users/3481699/aboozar-roosta"}, "edited": false, "score": 0, "creation_date": 1472050926, "post_id": 39126834, "comment_id": 65599200, "body": "Tried it now. It doesn&#39;t work. Still the same results."}], "tags": [], "owner": {"reputation": 1347, "user_id": 3871918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bc7d09955f09964bbb6d0f571e055cd?s=128&d=identicon&r=PG&f=1", "display_name": "dasdingonesin", "link": "https://stackoverflow.com/users/3871918/dasdingonesin"}, "is_accepted": false, "score": 0, "last_activity_date": 1472050729, "creation_date": 1472050729, "answer_id": 39126834, "question_id": 39125706, "link": "https://stackoverflow.com/questions/39125706/rounding-to-desired-digits-in-matlab-and-c/39126834#39126834", "title": "rounding to desired digits in MATLAB and C", "body": "<p>10^15 doesn't fit into a <code>long int</code> on a Windows machine. Use a <code>double</code>.</p>\n\n<pre><code>double n = pow(10, 15);\nmovmean_h[i]=(double)sum/(f-b);\nmexPrintf(\"\\t movmean_h[%d]=%e\",i,movmean_h[i]);\nmovmean_h[i]=round(movmean_h[i]*n)/n;\nmexPrintf(\"\\t movmean_h[%d]=%e\",i,movmean_h[i]);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": true, "score": 2, "last_activity_date": 1472115719, "creation_date": 1472115719, "answer_id": 39140942, "question_id": 39125706, "link": "https://stackoverflow.com/questions/39125706/rounding-to-desired-digits-in-matlab-and-c/39140942#39140942", "title": "rounding to desired digits in MATLAB and C", "body": "<p>Code lacked a declaration of declaration of <code>double round()</code>.  Older compilers allow this, yet interpret the result then an <code>int</code>.  Code output is then quite bizarre.  The hint, for me, was that many nearby <code>double</code> inputs had the same result.</p>\n\n<pre><code>// add\n#include &lt;math.h&gt;\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 3481699, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5d609d7f85e34d9ee842cdc1c8cd23a8?s=128&d=identicon&r=PG&f=1", "display_name": "Aboozar Roosta", "link": "https://stackoverflow.com/users/3481699/aboozar-roosta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 39140942, "answer_count": 2, "score": 1, "last_activity_date": 1472115719, "creation_date": 1472047858, "last_edit_date": 1472049038, "question_id": 39125706, "link": "https://stackoverflow.com/questions/39125706/rounding-to-desired-digits-in-matlab-and-c", "title": "rounding to desired digits in MATLAB and C", "body": "<p>I've read the questions regarding the implementation of rounding in C, inspired by MATLAB round function and I followed their advice but the result is not at all what it should be. Here's part of my code regarding this issue:</p>\n\n<pre><code>    movmean_h[i]=(double)sum/(f-b);\n    mexPrintf(\"\\t movmean_h[%d]=%e\",i,movmean_h[i]);\n    movmean_h[i]=(double)round(movmean_h[i]*n)/n;\n    mexPrintf(\"\\t movmean_h[%d]=%e\",i,movmean_h[i]);\n</code></pre>\n\n<p>And part of the result is like this(this code is run in a loop):</p>\n\n<pre><code> movmean_h[10261]=2.283693e-13   movmean_h[10261]=1.668138e-06\n movmean_h[10261]=2.283693e-13   movmean_h[10261]=1.668138e-06\n movmean_h[10262]=2.288172e-13   movmean_h[10262]=1.483963e-06\n movmean_h[10263]=2.292687e-13   movmean_h[10263]=-8.838173e-07\n movmean_h[10264]=2.297219e-13   movmean_h[10264]=0.000000e+00\n movmean_h[10265]=2.292835e-13   movmean_h[10265]=2.138378e-06\n movmean_h[10266]=2.288319e-13   movmean_h[10266]=1.409754e-06\n movmean_h[10267]=2.283839e-13   movmean_h[10267]=0.000000e+00\n movmean_h[10268]=2.279412e-13   movmean_h[10268]=-2.147484e-06\n movmean_h[10269]=2.275056e-13   movmean_h[10269]=-2.147484e-06\n movmean_h[10270]=2.270787e-13   movmean_h[10270]=-2.147484e-06\n movmean_h[10262]=2.288172e-13   movmean_h[10262]=1.483963e-06\n movmean_h[10263]=2.292687e-13   movmean_h[10263]=-8.838173e-07\n movmean_h[10264]=2.297219e-13   movmean_h[10264]=0.000000e+00\n movmean_h[10265]=2.292835e-13   movmean_h[10265]=2.138378e-06\n movmean_h[10266]=2.288319e-13   movmean_h[10266]=1.409754e-06\n movmean_h[10267]=2.283839e-13   movmean_h[10267]=0.000000e+00\n movmean_h[10268]=2.279412e-13   movmean_h[10268]=-2.147484e-06\n movmean_h[10269]=2.275056e-13   movmean_h[10269]=-2.147484e-06\n movmean_h[10270]=2.270787e-13   movmean_h[10270]=-2.147484e-06\n</code></pre>\n\n<p>The answers do not match at all, not in order and not in the decimals, which in theory they would match.</p>\n\n<p>And 'n' is defined as:</p>\n\n<pre><code>long int n=pow(10,15);\n</code></pre>\n\n<p>So my question is why my code is wrong, or is there something I'm missing?\nBy the way I am writing my C code for a MATLAB mex-file.</p>\n"}, {"tags": ["c", "arrays", "free", "realloc"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1472045962, "post_id": 39124910, "comment_id": 65595355, "body": "Please show us some <i>real</i> code."}, {"owner": {"reputation": 95, "user_id": 2577818, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/154c68ee117140795d7e6d7278c4f81f?s=128&d=identicon&r=PG", "display_name": "Homer", "link": "https://stackoverflow.com/users/2577818/homer"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472046255, "post_id": 39124910, "comment_id": 65595585, "body": "@JoachimPileborg The real code is complex and very long, I have tried to make it simple here! There is not any compiling error but the runtime error as I mentioned in the post: &#39;_crtisvalidheappointer(puserdata) dbgheap.c"}, {"owner": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "edited": false, "score": 1, "creation_date": 1472046509, "post_id": 39124910, "comment_id": 65595792, "body": "Well @Homer the problem is this code isn&#39;t even c. <code>2dArray</code> is an invalid parameter name. Anyhow after fixing missing includes, ; for your do while loop and the parameter name to get something working -- this snippet works."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472046963, "post_id": 39124910, "comment_id": 65596192, "body": "There is <b>no</b> 2D array in your code, noting which can represent one nor point to one. A pointer is not an array. Freeing a 2D array is as simple as <code>free(my2Darray);</code>."}, {"owner": {"reputation": 95, "user_id": 2577818, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/154c68ee117140795d7e6d7278c4f81f?s=128&d=identicon&r=PG", "display_name": "Homer", "link": "https://stackoverflow.com/users/2577818/homer"}, "reply_to_user": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "edited": false, "score": 0, "creation_date": 1472047197, "post_id": 39124910, "comment_id": 65596404, "body": "@IshayPeled Now it breaks! I added the <code>TwodArray[j-1] = &quot;abcdefgh&quot;;</code> line to the code"}, {"owner": {"reputation": 95, "user_id": 2577818, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/154c68ee117140795d7e6d7278c4f81f?s=128&d=identicon&r=PG", "display_name": "Homer", "link": "https://stackoverflow.com/users/2577818/homer"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472047467, "post_id": 39124910, "comment_id": 65596629, "body": "@Olaf When I simply <code>free(my2Darray)</code>, there is memory leak with each elements as I checked by vld!"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472047696, "post_id": 39124910, "comment_id": 65596818, "body": "@Homer: Read my comment <b>completely and carefully</b> again! What again did I write in the first sentence?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472048302, "post_id": 39124910, "comment_id": 65597239, "body": "The try to create a <a href=\"http://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable Example</a>. that you can show us. Without some actual real code it&#39;s really hard for us to help you."}], "answers": [{"tags": [], "owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "is_accepted": false, "score": 0, "last_activity_date": 1472048935, "last_edit_date": 1472048935, "creation_date": 1472047539, "answer_id": 39125570, "question_id": 39124910, "link": "https://stackoverflow.com/questions/39124910/free-2d-array-of-char-with-realloc/39125570#39125570", "title": "Free 2d array of char with realloc", "body": "<pre><code>TwodArray[j-1] = \"abcdefgh\";\n</code></pre>\n\n<p>followed by</p>\n\n<pre><code>free(TwodArray[l]);   // with l = j -1 from above  \n</code></pre>\n\n<p>will fail because the value of <code>TwodArray[j-1]</code> doesn't point to something allocated by <code>malloc</code></p>\n\n<p>Did you wanted to do:</p>\n\n<pre><code>strcpy(TwodArray[j-1], \"abcdefgh\");\n</code></pre>\n\n<p>The explanation is that <code>TwodArray[j-1] = \"abcdefgh\";</code> changes the value of the pointer <code>TwodArray[j-1]</code> while <code>strcpy(TwodArray[j-1], \"abcdefgh\");</code> copies the string <code>\"abcdefgh\"</code> to the location pointed to by <code>TwodArray[j-1]</code> (and leaves the value of <code>TwodArray[j-1]</code> unchanged).</p>\n\n<p><strong>Example of failing code</strong></p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\nint main (void)\n{\n  char* p = malloc(10 * sizeof(char));\n  printf(\"%p\\n\", (void*)p);\n  p = \"aaaa\";                  // Bad....\n  printf(\"%p\\n\", (void*)p);\n  free(p);\n  return 1;\n}\n</code></pre>\n\n<blockquote>\n  <p>Possible output</p>\n  \n  <p>0x1b76010</p>\n  \n  <p>0x400688</p>\n  \n  <p><strong>* Error in `./a.out': free(): invalid pointer: 0x0000000000400688 *</strong></p>\n  \n  <p>Aborted</p>\n</blockquote>\n\n<p><strong>Example of working code</strong></p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nint main (void)\n{\n  char* p = malloc(10 * sizeof(char));\n  printf(\"%p\\n\", (void*)p);\n  strcpy(p, \"aaaa\");\n  printf(\"%p\\n\", (void*)p);\n  printf(\"%s\\n\", p);\n  free(p);\n  return 1;\n}\n</code></pre>\n\n<blockquote>\n  <p>Possible output</p>\n  \n  <p>0x1d2c010</p>\n  \n  <p>0x1d2c010</p>\n  \n  <p>aaaa</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 41428, "user_id": 440564, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e3dbcb5159c02d59f52159faa8437c97?s=128&d=identicon&r=PG", "display_name": "blue112", "link": "https://stackoverflow.com/users/440564/blue112"}, "is_accepted": false, "score": 1, "last_activity_date": 1472047558, "creation_date": 1472047558, "answer_id": 39125576, "question_id": 39124910, "link": "https://stackoverflow.com/questions/39124910/free-2d-array-of-char-with-realloc/39125576#39125576", "title": "Free 2d array of char with realloc", "body": "<p>You are trying to free a static string.</p>\n\n<p>If you write something like </p>\n\n<pre><code>char* a = \"hello\";\n</code></pre>\n\n<p>a isn't pointing to a dynamically memory zone. It is static, so you can't free it.</p>\n"}, {"tags": [], "owner": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "is_accepted": false, "score": -1, "last_activity_date": 1472047877, "creation_date": 1472047877, "answer_id": 39125714, "question_id": 39124910, "link": "https://stackoverflow.com/questions/39124910/free-2d-array-of-char-with-realloc/39125714#39125714", "title": "Free 2d array of char with realloc", "body": "<p>In short, don't free static strings:</p>\n\n<pre><code>char *a = \"aaaa\";\nfree(a)\n</code></pre>\n\n<p>Will cause the same error.</p>\n\n<p>This will work:</p>\n\n<pre><code>#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include&lt;stdio.h&gt;\n\nint main(){\n    char ** TwodArray= NULL;\n    int k = 0;\n    int j = 0;\n\n    do{\n        k++;\n        for (int i= 0; i&lt;10; i++){\n            j++;\n            TwodArray=(char**)realloc(TwodArray, (j+1)*10*sizeof(char*));\n            TwodArray[j-1] = strndup(\"abcdefgh\",8);\n        }\n    }while(k&lt;3);\n    // free the memory\n    for (int l = 0; l &lt; j; l++){\n        if (TwodArray[l] != NULL)\n            free(TwodArray[l]); // here I get the error!\n    }\n    free(TwodArray);\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 2577818, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/154c68ee117140795d7e6d7278c4f81f?s=128&d=identicon&r=PG", "display_name": "Homer", "link": "https://stackoverflow.com/users/2577818/homer"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "closed_date": 1472050081, "answer_count": 3, "score": -4, "last_activity_date": 1472048935, "creation_date": 1472045869, "last_edit_date": 1472047094, "question_id": 39124910, "link": "https://stackoverflow.com/questions/39124910/free-2d-array-of-char-with-realloc", "closed_reason": "Not suitable for this site", "title": "Free 2d array of char with realloc", "body": "<p>In the following code, when I'm trying to free the individual elements of the 2D array of character (i.e. 2dArray[l]), I got an error (_crtisvalidheappointer(puserdata) dbgheap.c):\nAny idea about the reason of the error?</p>\n\n<pre><code>#include&lt;stdio.h&gt;\nint main(){    \n    char ** TwodArray= NULL;\n    int k = 0;\n    int j = 0;\n\n    do{\n        k++;\n        for (int i= 0; i&lt;10; i++){\n            j++;\n            TwodArray=(char**)realloc(TwodArray, (j+1)*10*sizeof(char*));\n            TwodArray[j-1]=(char*)malloc(10 *sizeof(char));\n            TwodArray[j-1] = \"abcdefgh\";\n            ....\n        }        \n    }while(k&lt;3)\n    // free the memory\n    for (int l = 0; l &lt; j; l++){\n        if (TwodArray[l] != NULL)\n            free(TwodArray[l]); // here I get the error!\n    }\n    free(TwodArray);\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "linux", "gdb"], "comments": [{"owner": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "edited": false, "score": 0, "creation_date": 1472046127, "post_id": 39124817, "comment_id": 65595494, "body": "This works for me... <code>printf</code>completed. I tried both running <code>gdb .&#47;sample.out</code> and attaching to a running process."}, {"owner": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "reply_to_user": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "edited": false, "score": 0, "creation_date": 1472046277, "post_id": 39124817, "comment_id": 65595603, "body": "@IshayPeled I think you just were lucky and <code>sample.out</code> just wasn&#39;t executing <code>malloc</code> at the moment. You can try to repeat it multiple times."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1472046703, "post_id": 39124817, "comment_id": 65595971, "body": "Calling functions from gdb is a dubious practice, especially from the standard library. One reason is what you just experienced. When debugging you want your program to be in a static state so that you can inspect it, calling functions that potentially change state is pretty counter-productive for debugging. I&#39;d suggest finding a different way of solving your problem."}, {"owner": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "reply_to_user": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1472046931, "post_id": 39124817, "comment_id": 65596165, "body": "@Art but as far as I know calling some functions inside <code>gdb</code> is the only way in which I can inject some code inside running process. Do you know any better ways?"}, {"owner": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "edited": false, "score": 0, "creation_date": 1472046982, "post_id": 39124817, "comment_id": 65596206, "body": "@Dima right - it took me 10 attempts, but I eventually got hung. See my answer for a possible WA"}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1472047217, "post_id": 39124817, "comment_id": 65596423, "body": "@Dima Eh. Sure. There are many ways. <code>dlopen</code> for example. Suspending a process in an unpredictable state to &quot;inject code&quot; sounds like a sure way of shooting your own foot. If you want self-modifying code there are many languages that do it nicely, C is probably the worst choice. Btw. All kinds of alarm bells are going off in my head, I&#39;m not sure I should have mentioned <code>dlopen</code> up there. What is the actual problem you&#39;re solving?"}, {"owner": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "reply_to_user": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1472047388, "post_id": 39124817, "comment_id": 65596564, "body": "@Art I do some <code>dlopen</code> inside my <code>gdb</code> process, but it seems to me that I will face same problems because <code>dlopen(&quot;some_constant_string&quot;, some_flags)</code> needs to create this string and will call <code>malloc</code> (if I understand that process right). My actual problem -- I need to connect to ruby process and create some threads there."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1472047735, "post_id": 39124817, "comment_id": 65596846, "body": "I meant <code>dlopen</code> as a well-designed part of your program you&#39;re &quot;injecting code&quot; into, not <code>dlopen</code> after shanking some unsuspecting process with gdb. And what you said is not an &quot;actual problem&quot;, it&#39;s just the solution you decided to implement for some reason. Really, trust me, suspending a process with gdb to make it run some random code you inject has microscopic probability of ever working reliably. As an experiment, go for it, try a few times until it looks like it&#39;s working, but forget to ever make it reliable which it seems that you&#39;re aiming for."}], "answers": [{"comments": [{"owner": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "edited": false, "score": 0, "creation_date": 1472047147, "post_id": 39125321, "comment_id": 65596358, "body": "yes, but the main problem here is how can I understand that I&#39;m inside <code>malloc</code> and that I need to call finish? I&#39;m running this <code>gdb</code> as subprocess inside another program so I don&#39;t have access to console and need to understand that executing commands with <code>-ex</code> (or I can write some <code>.gdbinit</code> script and define my function there)."}, {"owner": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "reply_to_user": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "edited": false, "score": 0, "creation_date": 1472047291, "post_id": 39125321, "comment_id": 65596488, "body": "Well, if the interesting code is in the outer loop (main function) as you describe here, that is not a problem - finish is ignored for outer loops."}, {"owner": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "edited": false, "score": 0, "creation_date": 1472047583, "post_id": 39125321, "comment_id": 65596724, "body": "Cool, I didn&#39;t know that, thank). But the problem still remains because my actual project is a bit more complicated (actually it is a ruby interpreter :)) and it can be inside some &quot;infinite&quot; loop which is not main function (I used quotes because it is running while my process is running)."}, {"owner": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "edited": false, "score": 0, "creation_date": 1472047770, "post_id": 39125321, "comment_id": 65596880, "body": "Also I&#39;m not sure, but if I really was inside <code>malloc</code> function and called <code>finish</code> does it mean that after that <i>all</i> the threads are not inside this function?"}, {"owner": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "reply_to_user": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "edited": false, "score": 0, "creation_date": 1472048066, "post_id": 39125321, "comment_id": 65597076, "body": "You should check if you have other threads running around (there shouldn&#39;t be unless you created them) and finish each one. This should be scripted because it gets complicated... Another thing I&#39;d try will be instead of breaking your program, set a breakpoint to the current position in your code+1 and enable it. That way you&#39;ll be certain the lock is not held when called"}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 1, "creation_date": 1472052507, "post_id": 39125321, "comment_id": 65600347, "body": "You could try something like <code>while $_any_caller_matches(&quot;.*malloc.*&quot;) &lt;newline&gt; finish &lt;newline&gt; end</code>"}, {"owner": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1472053915, "post_id": 39125321, "comment_id": 65601235, "body": "@MarkPlotnick using that I get <code>Invalid data type for function to be called.</code>"}, {"owner": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1472054297, "post_id": 39125321, "comment_id": 65601493, "body": "@MarkPlotnick also my <code>help function</code> only outputs <code>_isvoid</code>, <code>_memeq</code>, <code>_regex</code>, <code>_streq</code>, <code>_strlen</code>"}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "reply_to_user": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "edited": false, "score": 0, "creation_date": 1472054498, "post_id": 39125321, "comment_id": 65601647, "body": "@Dima You may have an older version of gdb that doesn&#39;t have <code>$_any_caller_matches</code>. Does <code>show conv</code> show any functions that are similar to that, such as <code>$_caller_matches</code> or <code>$caller_matches</code> ?"}, {"owner": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1472054610, "post_id": 39125321, "comment_id": 65601716, "body": "@MarkPlotnick no, it does not. My <code>gdb</code> version is 7.7.1."}, {"owner": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "edited": false, "score": 0, "creation_date": 1472055474, "post_id": 39125321, "comment_id": 65602242, "body": "Depending on the actual need, tracepoints may help you, they do not stop execution so there shouldn&#39;t be any lock issues. See here <a href=\"https://sourceware.org/gdb/onlinedocs/gdb/Tracepoints.html\" rel=\"nofollow noreferrer\">sourceware.org/gdb/onlinedocs/gdb/Tracepoints.html</a>"}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "reply_to_user": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "edited": false, "score": 1, "creation_date": 1472066485, "post_id": 39125321, "comment_id": 65608231, "body": "@Dima You can get <code>$_any_caller_matches</code> from <a href=\"https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;a=blob_plain;f=gdb/python/lib/gdb/function/caller_is.py;hb=HEAD\" rel=\"nofollow noreferrer\">sourceware.org/git/&hellip;</a> ; download the file and use the gdb <code>source</code> command to read it in. I&#39;ve verified that, at least for your demo program, the <code>while $_any_caller_matches(&quot;.*malloc.*&quot;) &lt;newline&gt; finish &lt;newline&gt; end</code> code works; it&#39;ll match functions like <code>__GI___libc_malloc</code> and <code>_int_malloc</code>."}, {"owner": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1472070172, "post_id": 39125321, "comment_id": 65610109, "body": "@MarkPlotnick thanks! With python it works for me as well!"}], "tags": [], "owner": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "is_accepted": false, "score": 3, "last_activity_date": 1472046956, "creation_date": 1472046956, "answer_id": 39125321, "question_id": 39124817, "link": "https://stackoverflow.com/questions/39124817/gdb-freezes-in-malloc/39125321#39125321", "title": "gdb freezes in malloc", "body": "<p>The reason you're froze is probably a lock that's being held by your program, and is also required by <code>printf</code>. When you try to aquire it twice - you fail.</p>\n\n<p>A possible WA is when breaking your program to <code>call printf</code>, just before you make the call, type <code>finish</code> - it will cause the current function to complete and return to the main frame. This will ensure the lock is free before you call printf.</p>\n"}, {"comments": [{"owner": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "edited": false, "score": 0, "creation_date": 1472123019, "post_id": 39128960, "comment_id": 65631096, "body": "Thanks! Even though I need to do a bit more complicated things your approach gave me some useful ideas."}], "tags": [], "owner": {"reputation": 2173, "user_id": 6577680, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BNh_9G6Q-1M/AAAAAAAAAAI/AAAAAAAAAA8/uTxVAAioLfw/photo.jpg?sz=128", "display_name": "Matthew Fisher", "link": "https://stackoverflow.com/users/6577680/matthew-fisher"}, "is_accepted": false, "score": 1, "last_activity_date": 1472057321, "last_edit_date": 1495540866, "creation_date": 1472057321, "answer_id": 39128960, "question_id": 39124817, "link": "https://stackoverflow.com/questions/39124817/gdb-freezes-in-malloc/39128960#39128960", "title": "gdb freezes in malloc", "body": "<p>If the 'finish' solution doesn't work for you.  Here is another idea.</p>\n\n<p>You can check if you are in malloc when you break the program.  Based on the boolean in/out you skip calling the print commands.  Here is a working example.</p>\n\n<pre><code># gdb script: pygdb-logg.gdb\n# easier interface for pygdb-logg.py stuff\n# from within gdb: (gdb) source -v pygdb-logg.gdb\n# from cdmline: gdb -x pygdb-logg.gdb -se test.exe\n\n# first, \"include\" the python file:\nsource -v pygdb-logg.py\n\n# define shorthand for inMalloc():\ndefine inMalloc\n  python inMalloc()\nend\n</code></pre>\n\n<p>The associated python file:</p>\n\n<pre><code># gdb will 'recognize' this as python\n#  upon 'source pygdb-logg.py'\n# however, from gdb functions still have\n#  to be called like:\n#  (gdb) python print logExecCapture(\"bt\")\n\nimport sys\nimport gdb\nimport os\n\ndef logExecCapture(instr):\n  # /dev/shm - save file in RAM\n  ltxname=\"/dev/shm/c.log\"\n\n  gdb.execute(\"set logging file \"+ltxname) # lpfname\n  gdb.execute(\"set logging redirect on\")\n  gdb.execute(\"set logging overwrite on\")\n  gdb.execute(\"set logging on\")\n  gdb.execute(\"bt\")\n  gdb.execute(\"set logging off\")\n\n  replyContents = open(ltxname, 'r').read() # read entire file\n  return replyContents\n\n# in malloc?\ndef inMalloc():\n  isInMalloc = -1;\n  # as long as we don't find \"Breakpoint\" in report:\n  while isInMalloc == -1:\n    REP=logExecCapture(\"n\")\n#Look for calls that have '_malloc' in them \n    isInMalloc = REP.find(\"_malloc\")\n    if(isInMalloc != -1):\n#       print (\"Malloc:: \", isInMalloc, \"\\n\", REP)\n       gdb.execute(\"set $inMalloc=1\")\n       return True\n    else:\n#       print (\"No Malloc:: \", isInMalloc, \"\\n\", REP)\n       gdb.execute(\"set $inMalloc=0\")\n       return False\n\ngdb -x pygdb-logg.gdb -se test.exe\n</code></pre>\n\n<p>From the command line or script, </p>\n\n<pre><code>(gdb) inMalloc\n(gdb) print $inMalloc\n</code></pre>\n\n<p>From an actual test program:</p>\n\n<pre><code>Program received signal SIGINT, Interrupt.\n0x00007ffff7a94dba in _int_malloc (av=&lt;optimized out&gt;, bytes=1) at malloc.c:3806\n3806    malloc.c: No such file or directory.\n(gdb) inMalloc\n(gdb) if $inMalloc\n &gt;print $inMalloc\n &gt;end\n$1 = 1\n</code></pre>\n\n<p>I believe your script can use a similar 'if' structure to do/not do printf</p>\n\n<p>Most of this was knocked off from <a href=\"https://stackoverflow.com/questions/6947389/how-to-print-every-executed-line-in-gdb-automatically-until-a-given-breakpoint-i/6964213#6964213\">here</a> </p>\n"}], "owner": {"reputation": 1316, "user_id": 2304212, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/217cbdae046a33da5633c7982463104c?s=128&d=identicon&r=PG", "display_name": "PepeHands", "link": "https://stackoverflow.com/users/2304212/pepehands"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 712, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1472057321, "creation_date": 1472045598, "last_edit_date": 1472046291, "question_id": 39124817, "link": "https://stackoverflow.com/questions/39124817/gdb-freezes-in-malloc", "title": "gdb freezes in malloc", "body": "<p>Suppose I have some C program like this:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdbool.h&gt;\n\nint main()\n{\n    while (true) {\n        void *p = malloc(1000);\n        free(p);\n    }\n    return 0;\n}\n</code></pre>\n\n<p>and I attach to it with <code>gdb</code> like this <code>gdb a.out PID</code>. <code>gdb</code> successfully attaches to it but that I try to do something like <code>call printf(\"bla bla bla\")</code> <code>gdb</code> freezes and if I press <code>Ctrl^C</code> I get this:</p>\n\n<pre><code>(gdb) call printf(\"bla bla bla\")\n^C\nProgram received signal SIGINT, Interrupt.\n__lll_lock_wait_private () at ../nptl/sysdeps/unix/sysv/linux/x86_64/lowlevellock.S:95\n95  ../nptl/sysdeps/unix/sysv/linux/x86_64/lowlevellock.S: No such file or directory.\nThe program being debugged was signaled while in a function called from GDB.\nGDB remains in the frame where the signal was received.\nTo change this behavior use \"set unwindonsignal on\".\nEvaluation of the expression containing the function\n(malloc) will be abandoned.\nWhen the function is done executing, GDB will silently stop.\n</code></pre>\n\n<p>I suppose that this happens because my <code>a.out</code> was creating an object and acquired a lock inside <code>malloc.c</code> and in this moment I connected with <code>gdb</code> and tried to create string \"bla bla bla\" using <code>malloc</code>.</p>\n\n<p>My question is how can I detect that I'm inside <code>malloc.c</code> and let my program finish this execution? I need to do it not inside command line but using some sort of gdb scripting (I only can execute commands inside <code>gdb</code> with <code>-ex</code> option).</p>\n"}, {"tags": ["c", "linux", "select", "g++"], "comments": [{"owner": {"reputation": 13767, "user_id": 2413201, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rxfuw.jpg?s=128&g=1", "display_name": "Armali", "link": "https://stackoverflow.com/users/2413201/armali"}, "edited": false, "score": 0, "creation_date": 1472196879, "post_id": 39124814, "comment_id": 65664848, "body": "What is the output of <code>printf(&quot;size = %zu\\n&quot;, sizeof __FDS_BITS(&amp;my_set)[0])</code>?"}, {"owner": {"reputation": 145, "user_id": 6691017, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a7bba5f7cb7bc8ac9f3f94365324e5b?s=128&d=identicon&r=PG&f=1", "display_name": "study_20160808", "link": "https://stackoverflow.com/users/6691017/study-20160808"}, "reply_to_user": {"reputation": 13767, "user_id": 2413201, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rxfuw.jpg?s=128&g=1", "display_name": "Armali", "link": "https://stackoverflow.com/users/2413201/armali"}, "edited": false, "score": 0, "creation_date": 1472197788, "post_id": 39124814, "comment_id": 65665342, "body": "@Armali,The result is eight."}, {"owner": {"reputation": 13767, "user_id": 2413201, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rxfuw.jpg?s=128&g=1", "display_name": "Armali", "link": "https://stackoverflow.com/users/2413201/armali"}, "edited": false, "score": 0, "creation_date": 1472198256, "post_id": 39124814, "comment_id": 65665592, "body": "Interesting\u2026 How exactly did you print the second result (so that I can try it)?"}, {"owner": {"reputation": 145, "user_id": 6691017, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a7bba5f7cb7bc8ac9f3f94365324e5b?s=128&d=identicon&r=PG&f=1", "display_name": "study_20160808", "link": "https://stackoverflow.com/users/6691017/study-20160808"}, "reply_to_user": {"reputation": 13767, "user_id": 2413201, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rxfuw.jpg?s=128&g=1", "display_name": "Armali", "link": "https://stackoverflow.com/users/2413201/armali"}, "edited": false, "score": 0, "creation_date": 1472198468, "post_id": 39124814, "comment_id": 65665691, "body": "@Armali,update question.I added a full testing code."}], "answers": [{"comments": [{"owner": {"reputation": 145, "user_id": 6691017, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a7bba5f7cb7bc8ac9f3f94365324e5b?s=128&d=identicon&r=PG&f=1", "display_name": "study_20160808", "link": "https://stackoverflow.com/users/6691017/study-20160808"}, "edited": false, "score": 1, "creation_date": 1472118197, "post_id": 39140610, "comment_id": 65627906, "body": ",I compiled my program by using -m64.The result is no change."}], "tags": [], "owner": {"reputation": 483, "user_id": 6736846, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wod-_IEsStU/AAAAAAAAAAI/AAAAAAAAAGw/y1053EASDWI/photo.jpg?sz=128", "display_name": "Peter Skarpetis", "link": "https://stackoverflow.com/users/6736846/peter-skarpetis"}, "is_accepted": false, "score": 0, "last_activity_date": 1472114719, "creation_date": 1472114719, "answer_id": 39140610, "question_id": 39124814, "link": "https://stackoverflow.com/questions/39124814/about-fd-set-and-fd-set-in-linux/39140610#39140610", "title": "About FD_SET and fd_set in linux", "body": "<p>You probably compiled your code as 32 bit. set.fds_bits is an array of long int. Check the value of my_set.fds_bits[1]</p>\n"}, {"comments": [{"owner": {"reputation": 145, "user_id": 6691017, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a7bba5f7cb7bc8ac9f3f94365324e5b?s=128&d=identicon&r=PG&f=1", "display_name": "study_20160808", "link": "https://stackoverflow.com/users/6691017/study-20160808"}, "edited": false, "score": 0, "creation_date": 1472199424, "post_id": 39161496, "comment_id": 65666192, "body": ",Oh, I got it. I missed format string of printf function.Thank you!"}], "tags": [], "owner": {"reputation": 13767, "user_id": 2413201, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rxfuw.jpg?s=128&g=1", "display_name": "Armali", "link": "https://stackoverflow.com/users/2413201/armali"}, "is_accepted": true, "score": 1, "last_activity_date": 1472199215, "creation_date": 1472199215, "answer_id": 39161496, "question_id": 39124814, "link": "https://stackoverflow.com/questions/39124814/about-fd-set-and-fd-set-in-linux/39161496#39161496", "title": "About FD_SET and fd_set in linux", "body": "<blockquote>\n  <p>Doesn't fd that is equal to 63 have a state in my_set.</p>\n</blockquote>\n\n<p>It has. You just didn't correctly print the value, because you forgot the length modifier <code>l</code> in the <code>printf</code> format string.</p>\n\n<pre><code>        printf(\"0x%016lx\\t\", __FDS_BITS(&amp;target_sets)[uIndex]);\n</code></pre>\n"}], "owner": {"reputation": 145, "user_id": 6691017, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5a7bba5f7cb7bc8ac9f3f94365324e5b?s=128&d=identicon&r=PG&f=1", "display_name": "study_20160808", "link": "https://stackoverflow.com/users/6691017/study-20160808"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1109, "favorite_count": 1, "accepted_answer_id": 39161496, "answer_count": 2, "score": 2, "last_activity_date": 1472199215, "creation_date": 1472045586, "last_edit_date": 1472198411, "question_id": 39124814, "link": "https://stackoverflow.com/questions/39124814/about-fd-set-and-fd-set-in-linux", "title": "About FD_SET and fd_set in linux", "body": "<p>My os is 64bits Centos6.4. I have a question about how to fd_set manage FD_SET add the fd.Follow code is case:</p>\n\n<pre><code>fd_set my_set;\nFD_SET(31, &amp;my_set);\n</code></pre>\n\n<p>Then, I show my_set.fds_bits[...].The my_set.fds_bits[0] is equal to 0x0000000080000000, my_set.fds_bits[1~...] is zero.I can understand the result.But I also write an case,Follow code:</p>\n\n<pre><code>fd_set my_set;\nFD_SET(63, &amp;my_set);\n</code></pre>\n\n<p>I show my_set.fds_bits[...].The my_set.fds_bits[0] is equal to 0x0.In my opinion, the result should be my_set.fds_bits[0] is equal to 0x8000000000000000.I really don't understand why sencond result is 0x0. Doesn't fd that is equal to 63 have a state in my_set.</p>\n\n<p>Here is full testing code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;resolv.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;arpa/inet.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;sys/time.h&gt;\n#include &lt;pthread.h&gt;\n\n#define BUFSIZE 1024\n\nvoid printFDSET(fd_set target_sets)\n{\n    int uIndex = 0;\n    int model_num = __NFDBITS;\n    for(uIndex = 0; uIndex &lt; 10/*FD_SETSIZE/model_num*/; uIndex++)\n    {\n        printf(\"0x%016x\\t\", target_sets.fds_bits[uIndex]);\n        if(uIndex % 4 == 3)\n            printf(\"\\n\");\n    }\n    printf(\"\\n\");\n\n    return;\n}\n\nint main(int argc, char* argv[])\n{\n    fd_set my_set;\n    FD_ZERO(&amp;my_set);\n\n    printf(\"sizeof(long int) = %d\\n\", sizeof(long int));\n    printf(\"FD_SETSIZE = %d\\n\", FD_SETSIZE);\n    printf(\"size = %zu\\n\", sizeof __FDS_BITS(&amp;my_set)[0]);\n    printf(\"\\n\\n\");\n\n    int unfd = 31;\n    FD_SET(unfd, &amp;my_set);\n    printf(\"%d is added to my_set:\\n\", unfd);\n    printFDSET(my_set);\n    printf(\"\\n\\n\");\n\n    FD_CLR(unfd, &amp;my_set);\n    unfd = 63;\n    printf(\"%d is added to my_set:\\n\", unfd);\n    FD_SET(unfd, &amp;my_set);\n    printFDSET(my_set);\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "pointers", "const-correctness"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1472045719, "post_id": 39124796, "comment_id": 65595180, "body": "The common use-case for pointers to constants are as function arguments. This tells the users of the function (as well as the compiler) that the function will not alter the data that the pointer points to."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2404501"}, "edited": false, "score": 0, "creation_date": 1472045720, "post_id": 39124796, "comment_id": 65595182, "body": "Your example doesn&#39;t &quot;break const&quot; because the object that was modified (<code>some_number</code>) is not const. Having const on a pointer target doesn&#39;t mean &quot;guaranteed to yield the same value if you read it twice, with some other stuff happening in between&quot;"}, {"owner": {"reputation": 96743, "user_id": 2455888, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/MQu4W.png?s=128&g=1", "display_name": "haccks", "link": "https://stackoverflow.com/users/2455888/haccks"}, "edited": false, "score": 1, "creation_date": 1472045872, "post_id": 39124796, "comment_id": 65595296, "body": "Think of <code>const</code> as promise. Why any one want to break his own promise?"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1472047477, "post_id": 39124796, "comment_id": 65596636, "body": "There is no <code>const</code> qualified pointer in your code!"}, {"owner": {"reputation": 1122, "user_id": 3218438, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XE9Rb.png?s=128&g=1", "display_name": "Nibor", "link": "https://stackoverflow.com/users/3218438/nibor"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472047764, "post_id": 39124796, "comment_id": 65596873, "body": "@Olaf: that is not the point, it&#39;s about the changing of the underlying values"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472048236, "post_id": 39124796, "comment_id": 65597198, "body": "@Nibor: Read the title!"}], "answers": [{"comments": [{"owner": {"reputation": 1122, "user_id": 3218438, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XE9Rb.png?s=128&g=1", "display_name": "Nibor", "link": "https://stackoverflow.com/users/3218438/nibor"}, "edited": false, "score": 0, "creation_date": 1472047047, "post_id": 39125197, "comment_id": 65596271, "body": "I forgot to mention that I use C99, but I guess the standard there is similar. Thanks for the clarification!"}, {"owner": {"reputation": 1122, "user_id": 3218438, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XE9Rb.png?s=128&g=1", "display_name": "Nibor", "link": "https://stackoverflow.com/users/3218438/nibor"}, "edited": false, "score": 0, "creation_date": 1472047216, "post_id": 39125197, "comment_id": 65596418, "body": "But it&#39;s strange that for double pointers, a warning is issued indeed, to prevent what I just did above for single pointers, see <a href=\"http://c-faq.com/ansi/constmismatch.html\" rel=\"nofollow noreferrer\">c-faq.com/ansi/constmismatch.html</a>"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 2, "creation_date": 1472047534, "post_id": 39125197, "comment_id": 65596692, "body": "&quot;It only means that you are not allowed to change it.&quot; - Not even that! I means <b>the programmer</b> guarantees not to modify it."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 1122, "user_id": 3218438, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XE9Rb.png?s=128&g=1", "display_name": "Nibor", "link": "https://stackoverflow.com/users/3218438/nibor"}, "edited": false, "score": 0, "creation_date": 1472047654, "post_id": 39125197, "comment_id": 65596780, "body": "@Nibor: C is not <code>const</code>-safe across multiple indirections like C++ is. It allows certain constructs which are indeed problematic. But as it is a guarantee by the programmer, it is at your side to not break that contract."}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "edited": false, "score": 1, "creation_date": 1472047928, "post_id": 39125197, "comment_id": 65596986, "body": "<i>Passing a const pointer to a function, you can safely assume that the function will not change your data, thus is &quot;making a promise to you&quot;</i> This is not correct, the function may still change the data via other parameters of global values."}, {"owner": {"reputation": 15569, "user_id": 2302862, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e264db339bb96e343770fa38018e00f1?s=128&d=identicon&r=PG", "display_name": "Siguza", "link": "https://stackoverflow.com/users/2302862/siguza"}, "reply_to_user": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "edited": false, "score": 0, "creation_date": 1472048873, "post_id": 39125197, "comment_id": 65597651, "body": "@2501 My example says nothing about such connections though, only about a <code>const</code> value being passed to a function, and the function being unable to change the underlying value through that argument. In a way, it is implicitly assuming the absence of such a connection in the same way it is assuming the function not to violate the specification, the hardware to function as expected, and the laws of physics to hold. I was hoping these didn&#39;t require explicit declaration."}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "edited": false, "score": 1, "creation_date": 1472048990, "post_id": 39125197, "comment_id": 65597736, "body": "That is not what is written in the answer. Your comment adds: <i>through that argument</i>, which is an important distinction."}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "edited": false, "score": 0, "creation_date": 1472049966, "post_id": 39125197, "comment_id": 65598431, "body": "The const may still be legally cast away, so this is really not a guarantee."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "edited": false, "score": 0, "creation_date": 1472055542, "post_id": 39125197, "comment_id": 65602287, "body": "@2501: If you cast away <code>const</code> and then modify the data pointed at, you get undefined behaviour.  You can cast away the const-ness of a character literal all you like, but if your system places them in read-only (<code>text</code>) memory, it does you no good if you try to modify the data pointed at."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472055729, "post_id": 39125197, "comment_id": 65602397, "body": "The statement <i>It only means that you are not allowed to change it</i> should be qualified with <i>via the <code>const</code>-qualified pointer</i> or something similar.  You can change the data pointed at via a pointer that is not <code>const</code>-qualified (<code>mutable</code> in the question), or via the original (non-<code>const</code>) variable name (<code>some_number</code> in the question)."}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472114313, "post_id": 39125197, "comment_id": 65625330, "body": "@JonathanLeffler The function that receives the const pointer doesn&#39;t know if the how the object was defined. <i>If you cast away const and then modify the data pointed at, you get undefined behaviour.</i> Not exactly. It is only undefined if the object, the const pointer is pointing to, was defined with const."}], "tags": [], "owner": {"reputation": 15569, "user_id": 2302862, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e264db339bb96e343770fa38018e00f1?s=128&d=identicon&r=PG", "display_name": "Siguza", "link": "https://stackoverflow.com/users/2302862/siguza"}, "is_accepted": true, "score": 4, "last_activity_date": 1472057244, "last_edit_date": 1472057244, "creation_date": 1472046660, "answer_id": 39125197, "question_id": 39124796, "link": "https://stackoverflow.com/questions/39124796/why-is-an-implicit-conversion-from-non-const-to-const-allowed-for-pointers-in-th/39125197#39125197", "title": "Why is an implicit conversion from non-const to const allowed for pointers in the first place?", "body": "<p>From <a href=\"http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf\" rel=\"nofollow\">the C11 standard (draft N1570)</a>:</p>\n\n<blockquote>\n  <h3>6.7.3 Type qualifiers</h3>\n  \n  <p>Syntax</p>\n  \n  <ol>\n  <li>type-qualifier:<br>\n  <code>const</code><br>\n  <code>restrict</code><br>\n  <code>volatile</code><br>\n  <code>_Atomic</code>  </li>\n  </ol>\n  \n  <p>[...]</p>\n  \n  <p>Semantics:</p>\n  \n  <ol start=\"4\">\n  <li>The properties associated with qualified types are meaningful only for expressions that are lvalues.</li>\n  </ol>\n  \n  <p>[...]</p>\n  \n  <p>EXAMPLE 1</p>\n  \n  <p>An object declared</p>\n\n<pre><code>extern const volatile int real_time_clock;\n</code></pre>\n  \n  <p>may be modifiable by hardware, but cannot be assigned to, incremented, or decremented.</p>\n</blockquote>\n\n<p>In simple terms:</p>\n\n<p><code>const</code> doesn't mean a value never changes. It only means that <em>you</em> are not allowed to change it<sup>1</sup>.</p>\n\n<p>For <em>callees</em> , <code>const</code> is a restriction, not a promise.<br>\nFor <em>callers</em> however, it <em>is</em> a promise. Passing a <code>const</code> pointer to a function, you can safely assume that the function will not change your data<sup>2</sup>, thus is \"making a promise to you\".</p>\n\n<hr>\n\n<p><sup>1</sup> ...through the identifier with the <code>const</code> qualifier.<br>\n<sup>2</sup> ...through the <code>const</code> argument passed to it.</p>\n"}], "owner": {"reputation": 1122, "user_id": 3218438, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XE9Rb.png?s=128&g=1", "display_name": "Nibor", "link": "https://stackoverflow.com/users/3218438/nibor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 561, "favorite_count": 0, "accepted_answer_id": 39125197, "answer_count": 1, "score": 1, "last_activity_date": 1472057244, "creation_date": 1472045542, "last_edit_date": 1495542168, "question_id": 39124796, "link": "https://stackoverflow.com/questions/39124796/why-is-an-implicit-conversion-from-non-const-to-const-allowed-for-pointers-in-th", "title": "Why is an implicit conversion from non-const to const allowed for pointers in the first place?", "body": "<p>I understand that implicit conversion from <code>non-const</code> to <code>const</code> is not dangerous when handling values, by example:</p>\n\n<pre><code>int mutable = 5;\nconst int immutable = mutable;\n</code></pre>\n\n<p>However, when working with pointers, I can do something as follows:</p>\n\n<pre><code>int some_number = 5;\nint *mutable = &amp;some_number;\nconst int *immutable = mutable;    // &lt;= Legal, but isn't it dangerous?\n\n// Let's try to break const\nprintf(\"%d\\n\", *immutable);        // Prints 5\nmutable[0] = 10;\nprintf(\"%d\\n\", *immutable);        // Prints 10\n</code></pre>\n\n<p>By the way, for double pointers this is not allowed (at least you get a warning)! See <a href=\"https://stackoverflow.com/questions/5055655/double-pointer-const-correctness-warnings-in-c\">this</a> question and the references therein.</p>\n"}, {"tags": ["c", "arrays", "string"], "comments": [{"owner": {"reputation": 51929, "user_id": 1524450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSzDV.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1524450/michael"}, "edited": false, "score": 1, "creation_date": 1472044589, "post_id": 39124325, "comment_id": 65594340, "body": "You&#39;re not initializing <code>temp</code> anywhere. You can&#39;t just read and write through a pointer that doesn&#39;t point anywhere."}, {"owner": {"reputation": 51929, "user_id": 1524450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSzDV.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1524450/michael"}, "edited": false, "score": 1, "creation_date": 1472044781, "post_id": 39124325, "comment_id": 65594475, "body": "Same goes for <code>i</code>, which you attempt to use as an index without initalizing it first."}, {"owner": {"reputation": 51929, "user_id": 1524450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSzDV.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1524450/michael"}, "edited": false, "score": 1, "creation_date": 1472044874, "post_id": 39124325, "comment_id": 65594539, "body": "<i>&quot;I saw one code which do that&quot;</i> is of no help to us unless you show us <i>that exact code</i>."}, {"owner": {"reputation": 131, "user_id": 4309211, "user_type": "registered", "accept_rate": 44, "profile_image": "https://lh5.googleusercontent.com/-rn-SqO0k5SY/AAAAAAAAAAI/AAAAAAAAAQc/uihnXrq5ZmE/photo.jpg?sz=128", "display_name": "R1S8K", "link": "https://stackoverflow.com/users/4309211/r1s8k"}, "reply_to_user": {"reputation": 51929, "user_id": 1524450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSzDV.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1524450/michael"}, "edited": false, "score": 0, "creation_date": 1472045053, "post_id": 39124325, "comment_id": 65594660, "body": "Code updated :) I also edited I indexing. i &amp; j are initialized after main."}, {"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 0, "creation_date": 1472045385, "post_id": 39124325, "comment_id": 65594928, "body": "What compiler are you using? Make sure you have warnings enabled <i>and you heed them</i>. If you&#39;re using GCC, always build with at least <code>gcc -Wall -Werror</code>."}, {"owner": {"reputation": 51929, "user_id": 1524450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSzDV.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1524450/michael"}, "edited": false, "score": 0, "creation_date": 1472045459, "post_id": 39124325, "comment_id": 65594977, "body": "<i>&quot;i &amp; j are initialized after main&quot;</i> You&#39;re <i>declaring</i> <code>i</code>, but not <i>initializing</i> it. The first time you give <code>i</code> a value is at <code>for(i=0;i&lt;cnt;i++)</code>."}, {"owner": {"reputation": 8858, "user_id": 403335, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/811bf232b634245aebba5323462d885c?s=128&d=identicon&r=PG", "display_name": "vulkanino", "link": "https://stackoverflow.com/users/403335/vulkanino"}, "edited": false, "score": 0, "creation_date": 1472045488, "post_id": 39124325, "comment_id": 65595004, "body": "Your code is a complete mess. And i is still uninitialized."}, {"owner": {"reputation": 131, "user_id": 4309211, "user_type": "registered", "accept_rate": 44, "profile_image": "https://lh5.googleusercontent.com/-rn-SqO0k5SY/AAAAAAAAAAI/AAAAAAAAAQc/uihnXrq5ZmE/photo.jpg?sz=128", "display_name": "R1S8K", "link": "https://stackoverflow.com/users/4309211/r1s8k"}, "edited": false, "score": 0, "creation_date": 1472050135, "post_id": 39124325, "comment_id": 65598573, "body": "I&#39;m using windows gcc with Dev-C++. Sorry about the initializing, it&#39;s m &amp; j. m=0 and j=1. They are the indexing members. The problem is with strcpy(str1[m],str1[j]);"}, {"owner": {"reputation": 131, "user_id": 4309211, "user_type": "registered", "accept_rate": 44, "profile_image": "https://lh5.googleusercontent.com/-rn-SqO0k5SY/AAAAAAAAAAI/AAAAAAAAAQc/uihnXrq5ZmE/photo.jpg?sz=128", "display_name": "R1S8K", "link": "https://stackoverflow.com/users/4309211/r1s8k"}, "edited": false, "score": 0, "creation_date": 1472108809, "post_id": 39124325, "comment_id": 65621823, "body": "online code updated."}], "answers": [{"comments": [{"owner": {"reputation": 15946, "user_id": 4606734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/858769040849894/picture?type=large", "display_name": "ameyCU", "link": "https://stackoverflow.com/users/4606734/ameycu"}, "edited": false, "score": 0, "creation_date": 1472054514, "post_id": 39124736, "comment_id": 65601660, "body": "Problem is not because <code>temp</code> is a <code>char *</code> pointer , but because of <code>temp</code> being not initialized."}, {"owner": {"reputation": 131, "user_id": 4309211, "user_type": "registered", "accept_rate": 44, "profile_image": "https://lh5.googleusercontent.com/-rn-SqO0k5SY/AAAAAAAAAAI/AAAAAAAAAQc/uihnXrq5ZmE/photo.jpg?sz=128", "display_name": "R1S8K", "link": "https://stackoverflow.com/users/4309211/r1s8k"}, "edited": false, "score": 0, "creation_date": 1472057153, "post_id": 39124736, "comment_id": 65603192, "body": "How to initialize it to a string array? I know how to initialize it to int and char."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user3126480"}, "is_accepted": false, "score": 0, "last_activity_date": 1472045401, "creation_date": 1472045401, "answer_id": 39124736, "question_id": 39124325, "link": "https://stackoverflow.com/questions/39124325/strcpy-with-strings-array/39124736#39124736", "title": "strcpy with strings array", "body": "<p>I think your error is because temp is a pointer and you use it as a string (Char array)\nwhen you call <code>strcpy(str1[j],temp)</code>, is where the problem is, i think.</p>\n\n<p>Also notice that the online solution doesnt use *temp pointer, it uses an array</p>\n"}], "owner": {"reputation": 131, "user_id": 4309211, "user_type": "registered", "accept_rate": 44, "profile_image": "https://lh5.googleusercontent.com/-rn-SqO0k5SY/AAAAAAAAAAI/AAAAAAAAAQc/uihnXrq5ZmE/photo.jpg?sz=128", "display_name": "R1S8K", "link": "https://stackoverflow.com/users/4309211/r1s8k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 829, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1472108788, "creation_date": 1472044326, "last_edit_date": 1472108788, "question_id": 39124325, "link": "https://stackoverflow.com/questions/39124325/strcpy-with-strings-array", "title": "strcpy with strings array", "body": "<p>I'm working with arrays, I've done passing strings array to functions and other bit banging with strings and ints arrays.</p>\n\n<p>Now, I have a problem with <code>strcpy</code>, what I did and want to know:</p>\n\n<ol>\n<li>It crashes with if I assign <code>strcpy(temp, str1[i]);</code> while <code>temp</code> is <code>char *temp</code>.</li>\n<li><p>single string array <code>temp[100]</code>. However, I didn't figure out how to calculate the size of the <code>temp</code> to the string element of the array. I understood that I have to give 17 as the size of <code>temp</code> so fit the bytes from the string array.\nLike:\n<code>char *temp[17];</code> then, I can apply <code>strcpy(temp, str1[i]);</code>\nWhere <code>*str1[] = {\"sweepsweepsweepsweep\"}</code> 20 chars. And crashes with size of 16.</p></li>\n<li><p>I can't assign one member of stings array to another member.\nBut I saw one code which do that.</p></li>\n<li><p>Another thing that is why if I declared other empty string arrays <code>str2</code> &amp; <code>str3</code>, they have the same values as <code>str1</code>? It's included at the end of the code example.</p></li>\n</ol>\n\n<p>This is my code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdint.h&gt;\n\nint main()\n{      \n    int m = 0, j = 1, n, i;\n    char *str1[] = {\"sweep\", \"forward\"}, *str2[] = {}, *str3[] = {}, *temp;\n    uint8_t cnt = sizeof(str1) / sizeof(str1[0]);\n\n    if (strcmp(str1[m], str1[j]) &gt; 0) {\n        strcpy(temp, str1[m]);\n        strcpy(str1[m], str1[j]);\n        strcpy(str1[j], temp);\n        printf(\"OK\\n\");\n    } else {\n        printf(\"NOPE\\n\");       \n    }\n    printf(\"The sorted string\\n\");\n    for (i = 0; i &lt; cnt; i++)\n        puts(str1[i]);     \n    printf(\"%d\\n\", strcmp(str1[0], str1[1]));\n    printf(\"-----------------\\n\");\n\n    printf(\"temp: %s\\n\", temp);\n    printf(\"str2: %s\\n\", str2[0]);\n    printf(\"str3: %s\\n\", str3[0]);\n    return 0;\n}\n</code></pre>\n\n<p>Code Example from online:</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n\nint main(){\nint i,j,n;\nchar str[20][20],temp[20];\nputs(\"Enter the no. of string to be sorted\");\nscanf(\"%d\",&amp;n);\nfor(i=0;i&lt;=n;i++)\n  gets(str[i]);\nfor(i=0;i&lt;=n;i++)\n  for(j=i+1;j&lt;=n;j++)\n  {\n       if(strcmp(str[i],str[j])&gt;0)\n       {\n          strcpy(temp,str[i]);\n          strcpy(str[i],str[j]);\n          strcpy(str[j],temp);\n       }\n   }\nprintf(\"The sorted string\\n\");\nfor(i=0;i&lt;=n;i++)\n  puts(str[i]);\nreturn 0;\n}\n</code></pre>\n"}, {"tags": ["c", "gcc", "libc"], "comments": [{"owner": {"reputation": 13866, "user_id": 54200, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6261c8ab215b8069e8290516c80445d8?s=128&d=identicon&r=PG", "display_name": "KevinDTimm", "link": "https://stackoverflow.com/users/54200/kevindtimm"}, "edited": false, "score": 0, "creation_date": 1472056004, "post_id": 39124298, "comment_id": 65602559, "body": "<code>man gcc</code>, search for libraries (you can do this in google or on your system)"}], "answers": [{"comments": [{"owner": {"reputation": 927, "user_id": 466932, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/424347075f5b5405bfb7ca79a9aa264b?s=128&d=identicon&r=PG", "display_name": "Unmanned Player", "link": "https://stackoverflow.com/users/466932/unmanned-player"}, "edited": false, "score": 1, "creation_date": 1504155509, "post_id": 39187733, "comment_id": 78905839, "body": "If you actually look inside these scripts, the &quot;take care&quot; part is generally done by providing the correct ld scripts to link it with their respective libraries. Would be good, if OP actually gets to read that."}], "tags": [], "owner": {"reputation": 162629, "user_id": 50617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YFykQ.png?s=128&g=1", "display_name": "Employed Russian", "link": "https://stackoverflow.com/users/50617/employed-russian"}, "is_accepted": false, "score": 4, "last_activity_date": 1472354393, "creation_date": 1472354393, "answer_id": 39187733, "question_id": 39124298, "link": "https://stackoverflow.com/questions/39124298/how-to-compile-with-an-another-libc-on-linux-gcc/39187733#39187733", "title": "How to compile with an another libC on Linux? (gcc)", "body": "<blockquote>\n  <p>What gcc option should I use for this purpose?</p>\n</blockquote>\n\n<p>You should read <code>dietlibc</code> or <code>musl</code> documentation. Example for <code>dietlibc</code> from <a href=\"https://www.fefe.de/dietlibc/FAQ.txt\" rel=\"noreferrer\">here</a>:</p>\n\n<pre><code>diet gcc -pipe -g -o t t.c\n</code></pre>\n\n<p>That is: <code>dietlibc</code> provides a wrapper command called <code>diet</code> which takes care of this for you.</p>\n\n<p>Example for <code>musl</code> from <a href=\"https://www.musl-libc.org/how.html\" rel=\"noreferrer\">here</a>:</p>\n\n<pre><code>musl-gcc -static -Os hello.c\n</code></pre>\n\n<p>That is, <code>musl</code> provides a wrapper command called <code>musl-gcc</code> which takes care of this for you.</p>\n\n<p>You can examine <code>musl-gcc</code> and <code>diet</code> to see exactly what options they pass the to the linker. Note however that the exact options may change from version to version, and you are better off <em>always</em> using the wrappers even if you know exactly which flags they pass.</p>\n"}], "owner": {"reputation": 81, "user_id": 6556128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc0673bc7bb4d4d1dc59db12a627d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "meridj", "link": "https://stackoverflow.com/users/6556128/meridj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 761, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1472354393, "creation_date": 1472044238, "last_edit_date": 1472045367, "question_id": 39124298, "link": "https://stackoverflow.com/questions/39124298/how-to-compile-with-an-another-libc-on-linux-gcc", "title": "How to compile with an another libC on Linux? (gcc)", "body": "<p>I want to compile my C program with an another C library like dietlibc or musl.</p>\n\n<p>What gcc option should I use for this purpose?</p>\n"}, {"tags": ["c", "linux", "multithreading", "io"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472045335, "post_id": 39124096, "comment_id": 65594892, "body": "How did you profile? Values? Expectation? Other relevant circumstances? <b>What</b> restricts performance?"}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "edited": false, "score": 0, "creation_date": 1472049346, "post_id": 39124096, "comment_id": 65598000, "body": "Most likely the contents of the file is already in page cache, in which case the I/O priority won&#39;t have much effect. Make sure the <code>large#.txt</code> files are separate and not hardlinks to the same inode: if they point to the same inode, then there is only one instance of the contents; whenever a block of the file gets cached into page cache, the other threads get it immediately. Finally, if there is no competition over I/O resources, the priority has no effect, so do make sure the threads compete (and not over the same inode). To clear page cache: <code>sudo sh -c &#39;echo 3 &gt; &#47;proc&#47;sys&#47;vm&#47;drop_caches&#39;</code>."}, {"owner": {"reputation": 11, "user_id": 3228320, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001348613283/picture?type=large", "display_name": "Swapnil", "link": "https://stackoverflow.com/users/3228320/swapnil"}, "edited": false, "score": 0, "creation_date": 1472201149, "post_id": 39124096, "comment_id": 65667168, "body": "I took care that large#.txt are not hardlink of same inode, In fact I have generated each file with with &#39;base64 /dev/urandom | head -c 3000000000 &gt; large#.txt&#39; (3GB file)  I have also tried freeing caches anyways. output was : (Gain in 2nd thread is not seen)   Thread 0 created successfully   Thread 1 created successfully   Thread 2 created successfully   0 : 347.382835  1 : 350.225743  2 : 349.463542"}], "owner": {"reputation": 11, "user_id": 3228320, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001348613283/picture?type=large", "display_name": "Swapnil", "link": "https://stackoverflow.com/users/3228320/swapnil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 142, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1472043718, "creation_date": 1472043718, "question_id": 39124096, "link": "https://stackoverflow.com/questions/39124096/ioprio-set-is-not-showing-gain-in-io-performace-of-calling-thread", "title": "ioprio_set is not showing gain in io performace of calling thread", "body": "<p>This small experiment was to demonstrate the gain in I/O performance by increasing I/O priority of thread . \nFor this purpose <a href=\"http://linux.die.net/man/2/ioprio_set\" rel=\"nofollow\">ioprio_set</a> system call was used.\nTo see this api in action you can explore code of ionice utility.\nSo, I have spawned some threads to copy some files of same size(where one thread copy one file to some output file) \nand for one thread I have called ioprio_set.</p>\n\n<pre><code>ioprio_set(IOPRIO_WHO_PROCESS, 0, IOPRIO_PRIO_VALUE(IOPRIO_CLASS_RT,0));\n</code></pre>\n\n<p>These parameter are such that it will escalate the priority of calling thread to real time(ioclass) with highest value(i.e 0). And for measurement of performance I have used the clock_gettime around io operations of threads.</p>\n\n<p>But after running program I can't see the gain in execution time calling thread. \nFollowing is the code</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;pthread.h&gt;\n#include&lt;stdlib.h&gt;\n#include&lt;sys/syscall.h&gt;\n#include&lt;unistd.h&gt;\n#include&lt;time.h&gt;\n#define NB_THREADS  3 \n#define IOPRIO_PRIO_VALUE(class, data)  (((class) &lt;&lt; IOPRIO_CLASS_SHIFT) | data)\n#define IOPRIO_CLASS_SHIFT  13\n#define BILLION  1000000000L\n\nenum {\n    IOPRIO_CLASS_NONE,\n    IOPRIO_CLASS_RT,\n    IOPRIO_CLASS_BE,\n    IOPRIO_CLASS_IDLE,\n};\n\nenum {\n    IOPRIO_WHO_PROCESS = 1,\n    IOPRIO_WHO_PGRP,\n    IOPRIO_WHO_USER,\n};\n\nstatic inline int ioprio_set(int which, int who, int ioprio)\n{\n    return syscall(SYS_ioprio_set, which, who, ioprio);\n}\n\n\ndouble times[NB_THREADS];\nvoid *copyfile(void *args){\n    struct timespec start, stop;\n    double accum;\n\n\nint x;\n    char finname[10];// name of the file to be copied\n    char foutname[10],ch;\n    int *id;\n    FILE *source, *target;\n\n\n    id = (int *) args;\n    sprintf(finname,\"large%d.txt\",*id);\n\n    sprintf(foutname,\"out%d.txt\",*id);\n\n    if(*id == 2){\n        x=ioprio_set(IOPRIO_WHO_PROCESS, 0, IOPRIO_PRIO_VALUE(IOPRIO_CLASS_RT,0));\n        //printf(\"##%d##\",x);\n    }\n\nif( clock_gettime( CLOCK_REALTIME, &amp;start) == -1 ) {\n        perror( \"clock gettime\" );\n        exit(EXIT_FAILURE);\n    }\n\n\n    //printf(\"%s##%s\\n\\n\",finname,foutname);\n    source = fopen(finname, \"r\");\n    if( source == NULL )\n    {\n        printf(\"Press any key to exit...\\n\");\n        exit(EXIT_FAILURE);\n    }\n\n\n    target = fopen(foutname, \"w\");\n\n    if( target == NULL )\n    {\n        fclose(source);\n        printf(\"Press any key to exit...\\n\");\n        exit(EXIT_FAILURE);\n    }\n\n    while( ( ch = fgetc(source) ) != EOF )\n    {\n        fputc(ch, target);           \n    }\n\n    //printf(\"\\ndone copying file %s to %s in %lf\\n\",finname,foutname,accum);\n\n    fclose(source);\n    fclose(target);\n    if( clock_gettime( CLOCK_REALTIME, &amp;stop) == -1 ) {\n        perror( \"clock gettime\" );\n        exit(EXIT_FAILURE);\n    }\n\n    accum = ( stop.tv_sec - start.tv_sec )\n        + (double)( stop.tv_nsec - start.tv_nsec )\n        / (double)BILLION;\n\n    times[*id]=accum;\n}\n\n\n\n\nint main()\n{\n\n    unsigned int ints[NB_THREADS],i;\n    int err;\n    pthread_t    threads[NB_THREADS];\n\n    for (i = 0; i &lt; NB_THREADS; ++i) {\n        ints[i] = i;\n        err=pthread_create(&amp;threads[i], NULL, copyfile , &amp;ints[i]);\n        if (err != 0)\n            printf(\"\\ncan't create thread :[%s]\", strerror(err));\n        else\n            printf(\"\\n Thread %d created successfully\\n\",i);\n\n        //pthread_join(threads[i], NULL);\n    }\n    for (i = 0; i &lt; NB_THREADS; ++i) {\n        pthread_join(threads[i], NULL);\n    }\n    for (i = 0; i &lt; NB_THREADS; ++i) {\n        printf(\"\\n %d : %lf\",i,times[i]);\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p><em>Note</em> : to call this api with IOPRIO_CLASS_RT, permissions are needed. (So already ran with sudo). ioprio_set is returning 0(successful call, it return -1 in case of failure).<br>\n<em>Note</em> : to compile this code add -lpthread and -lrt to gcc.</p>\n\n<p><strong>Q</strong>. Is some thing wrong with code structure.?<br>\n<strong>Q</strong>. How can I carry out this experiment correctly?<br>\n<strong>Q</strong>. What can be done to achieve desired thing i.e increasing i/o priority of thread over other threads?</p>\n"}, {"tags": ["c", "sizeof", "size-t"], "comments": [{"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472043407, "post_id": 39123821, "comment_id": 65593408, "body": "I&#39;m not sure that&#39;s actually possible, otherwise <code>sizeof(char[LARGE_NUMBER])</code> wouldn&#39;t always work."}, {"owner": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "reply_to_user": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472043737, "post_id": 39123821, "comment_id": 65593669, "body": "@OliverCharlesworth It do not allways work, if you write something like char str[1024ULL*1024ULL*1024ULL*5];, you will get a compile error on 32bit machines (at least in my case with gcc -m32) (but not on AMD64)"}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "reply_to_user": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472044306, "post_id": 39123821, "comment_id": 65594120, "body": "@OliverCharlesworth It doesn&#39;t have to. If the constant-expression in the brackets makes an object that cannot be represented by size_t, which will be the result of sizeof, then the compiler will generate an error."}, {"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "reply_to_user": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "edited": false, "score": 0, "creation_date": 1472044544, "post_id": 39123821, "comment_id": 65594307, "body": "@2501 - Off-topic: What about if the array size is passed via a variable (i.e. if it&#39;s a VLA type)?  Presumably would have to be a runtime-error / UB."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1472044878, "post_id": 39123821, "comment_id": 65594548, "body": "Use a static assertion."}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "reply_to_user": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472045009, "post_id": 39123821, "comment_id": 65594633, "body": "@OliverCharlesworth I&#39;d say it would be undefined behavior when it is evaluated by sizeof."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472045016, "post_id": 39123821, "comment_id": 65594635, "body": "@OliverCharlesworth: You should get a truncation warning. If not: That&#39;s why one should enable warnings. C does not keep you from shooting you foot, though."}, {"owner": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "reply_to_user": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472045036, "post_id": 39123821, "comment_id": 65594648, "body": "@OliverCharlesworth, if you pass the len to a functin and creat there a array of that size (without malloc()), you will get a stack overflow in the most case  much faster than (U)INT_MAX or SIZE_MAX"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472045078, "post_id": 39123821, "comment_id": 65594681, "body": "@12431234123412341234123: &quot;stack&quot; is no concept in C."}, {"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472052673, "post_id": 39123821, "comment_id": 65600449, "body": "@12431234123412341234123 - Oh, to clarify, I meant something like <code>long x = LARGE_NUMBER; sizeof(char[x]);</code> - so no explicit array creation."}], "answers": [{"comments": [{"owner": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "edited": false, "score": 0, "creation_date": 1472046772, "post_id": 39124899, "comment_id": 65596025, "body": "Sorry if i dont understand you 100%. But if you set n to 0, (what i do) the returned Number must not be equal or less than n, so could it not be that the returned value is greater than SIZE_MAX?"}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "reply_to_user": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "edited": false, "score": 0, "creation_date": 1472047037, "post_id": 39124899, "comment_id": 65596259, "body": "@12431234123412341234123 Standard implies that return value must not be greater than n, which has a limit of SIZE_MAX. If you think the ruling is too vague to be reliable, just add the check that is guarded by preprocessor directives and forget about it."}], "tags": [], "owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "is_accepted": false, "score": 3, "last_activity_date": 1472047470, "last_edit_date": 1472047470, "creation_date": 1472045836, "answer_id": 39124899, "question_id": 39123821, "link": "https://stackoverflow.com/questions/39123821/real-implementation-where-sizeofsize-t-sizeofunsigned-int/39124899#39124899", "title": "Real implementation where sizeof(size_t) &lt; sizeof(unsigned int)", "body": "<p>While the standard doesn't forbid that INT_MAX won't be smaller than SIZE_MAX, the function vsnprintf guarantees that the returned value will not be greater than SIZE_MAX. </p>\n\n<p>If the functions succeeds, then the return value must be less than its second argument<sup>1</sup>. This argument has the type size_t, thus the return value must be less than SIZE_MAX.<sup>2</sup>. </p>\n\n<p>And if you're not convinced, you can always use preprocessor directive that evaluates INT_MAX > SIZE_MAX, and then include the needed code that checks the result of vsnprintf.</p>\n\n<hr>\n\n<p><sup>1</sup> The identifier n mentioned in the standard citation below, is the second argument to vsnprintf.</p>\n\n<p><sup>2</sup> (Quoted from: ISO/IEC 9899:201x 7.21.6.12 The vsnprintf function 3)<br>\nThe vsnprintf function returns the number of characters that would have been written\nhad n been sufficiently large, not counting the terminating null character, or a neg ative\nvalue if an encoding error occurred. Thus, the null-terminated output has been\ncompletely written if and only if the returned value is nonnegative and less than n.</p>\n"}], "owner": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1472048867, "creation_date": 1472043014, "last_edit_date": 1472048867, "question_id": 39123821, "link": "https://stackoverflow.com/questions/39123821/real-implementation-where-sizeofsize-t-sizeofunsigned-int", "title": "Real implementation where sizeof(size_t) &lt; sizeof(unsigned int)", "body": "<p>I know that the C standard allows for implementations where</p>\n\n<pre><code>(sizeof(unsigned) &gt; sizeof(size_t))\n</code></pre>\n\n<p>or</p>\n\n<pre><code>(sizeof(int) &gt; sizeof(ptrdiff_t))\n</code></pre>\n\n<p>is true. But are there any real implementations where one of these is true?</p>\n\n<p><strong>Background</strong></p>\n\n<p>I wrote a function similar to <code>asprintf()</code> (since <code>asprintf()</code> is not portable), and <code>snprintf()</code> return an <code>int</code> but needs a <code>size_t</code> argument, so should I check if <code>leni</code> (shown below) is not less than <code>SIZE_MAX</code> in this code?</p>\n\n<pre><code>va_copy(atmp,args)\nint leni = vsnprintf(NULL,0,format,atmp); //get the size of the new string\nva_end(atmp);\nif(leni&lt;0)\n  //do some error handling\nif(leni&gt;=SIZE_MAX) //do i need this part?\n  //error handling\nsize_t lens = ((size_t)leni)+1;\nchar *newString = malloc(lens);\nif(!newString)\n  //do some error hanling\nvsnprintf(newString,lens,format,args)!=lens-1)\n</code></pre>\n"}, {"tags": ["c", "bytearray"], "comments": [{"owner": {"reputation": 13636, "user_id": 3191557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffa6013ed93cfff5ef56f1ddf63956b1?s=128&d=identicon&r=PG&f=1", "display_name": "dhke", "link": "https://stackoverflow.com/users/3191557/dhke"}, "edited": false, "score": 3, "creation_date": 1472043533, "post_id": 39123801, "comment_id": 65593496, "body": "If you cannot use existing libraries (GMP, MPFI, ...), you might want to check how those represent long integers. It&#39;s usually an array of unsigneds aligned with the platform."}, {"owner": {"reputation": 258, "user_id": 6726703, "user_type": "registered", "accept_rate": 89, "profile_image": "https://graph.facebook.com/1227426243957448/picture?type=large", "display_name": "Popovici Sebi", "link": "https://stackoverflow.com/users/6726703/popovici-sebi"}, "reply_to_user": {"reputation": 13636, "user_id": 3191557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ffa6013ed93cfff5ef56f1ddf63956b1?s=128&d=identicon&r=PG&f=1", "display_name": "dhke", "link": "https://stackoverflow.com/users/3191557/dhke"}, "edited": false, "score": 0, "creation_date": 1472044362, "post_id": 39123801, "comment_id": 65594157, "body": "I can not use any library , I think I  am going to try something with uint32 , Thank you!"}, {"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1472063453, "post_id": 39123801, "comment_id": 65606632, "body": "<i>&quot;I can not store decimals in a vector or something like that&quot;</i> - Why? What&#39;s the limitation? Any specific size?"}, {"owner": {"reputation": 258, "user_id": 6726703, "user_type": "registered", "accept_rate": 89, "profile_image": "https://graph.facebook.com/1227426243957448/picture?type=large", "display_name": "Popovici Sebi", "link": "https://stackoverflow.com/users/6726703/popovici-sebi"}, "edited": false, "score": 1, "creation_date": 1472111147, "post_id": 39123801, "comment_id": 65623322, "body": "I have a RH850 board( <a href=\"https://www.renesas.com/en-us/products/microcontrollers-microprocessors/rh850/softtools.html\" rel=\"nofollow noreferrer\">renesas.com/en-us/products/microcontrollers-microprocessors/&zwnj;&#8203;&hellip;</a> )  and this is why the memory is limited and the hole algorithm will be structured on a state machine , this is why I should pay more attention on not losing data."}, {"owner": {"reputation": 258, "user_id": 6726703, "user_type": "registered", "accept_rate": 89, "profile_image": "https://graph.facebook.com/1227426243957448/picture?type=large", "display_name": "Popovici Sebi", "link": "https://stackoverflow.com/users/6726703/popovici-sebi"}, "edited": false, "score": 0, "creation_date": 1472127705, "post_id": 39123801, "comment_id": 65634260, "body": "I made this this structure do you have any better ideas? if (CPU_TYPE == CPU_TYPE_32) \ttypedef uint32_t word; \t#define word_length 32 \ttypedef struct BigNumber { \t\tword words[64]; \t} BigNumber; #elif (CPU_TYPE == CPU_TYPE_16) \ttypedef uint16_t word; \t#define word_length 16 \ttypedef struct BigNumber { \t\tword words[128]; \t} BigNumber; #else   \t#error Unsupported CPU_TYPE   #endif"}], "answers": [{"comments": [{"owner": {"reputation": 258, "user_id": 6726703, "user_type": "registered", "accept_rate": 89, "profile_image": "https://graph.facebook.com/1227426243957448/picture?type=large", "display_name": "Popovici Sebi", "link": "https://stackoverflow.com/users/6726703/popovici-sebi"}, "edited": false, "score": 1, "creation_date": 1500468699, "post_id": 45165087, "comment_id": 77349384, "body": "Thank you , but I couldn&#39;t not use any library  because of memory limitations , I used that method that I posted in question , but I still live this question unanswered , in case of a better  solution , that will help someone else ."}, {"owner": {"reputation": 6309, "user_id": 717822, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7e6a550ddff2d2288933bfd21d49a14?s=128&d=identicon&r=PG", "display_name": "perror", "link": "https://stackoverflow.com/users/717822/perror"}, "reply_to_user": {"reputation": 258, "user_id": 6726703, "user_type": "registered", "accept_rate": 89, "profile_image": "https://graph.facebook.com/1227426243957448/picture?type=large", "display_name": "Popovici Sebi", "link": "https://stackoverflow.com/users/6726703/popovici-sebi"}, "edited": false, "score": 0, "creation_date": 1500473246, "post_id": 45165087, "comment_id": 77353366, "body": "You can also look at <a href=\"https://tls.mbed.org/\" rel=\"nofollow noreferrer\">mbed TLS</a> is a very similar library to OpenSSL specifically used in embedded systems. The problem with your &quot;memory limitation&quot; is that you never told precisely how strict they were."}], "tags": [], "owner": {"reputation": 6309, "user_id": 717822, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7e6a550ddff2d2288933bfd21d49a14?s=128&d=identicon&r=PG", "display_name": "perror", "link": "https://stackoverflow.com/users/717822/perror"}, "is_accepted": false, "score": 4, "last_activity_date": 1500376194, "creation_date": 1500376194, "answer_id": 45165087, "question_id": 39123801, "link": "https://stackoverflow.com/questions/39123801/how-to-store-large-numbers/45165087#45165087", "title": "How to store large numbers?", "body": "<p>You may simply use the BigNumber API from OpenSSL. You can find the full API <a href=\"https://www.openssl.org/docs/man1.0.2/crypto/bn.html\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>And, you can use this code sample as a start:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n#include &lt;openssl/crypto.h&gt;\n#include &lt;openssl/bn.h&gt;\n\nint main(int argc, char *argv[])\n{\n  static const char num1[] = \"18446744073709551616\";\n  static const char num2[] = \"36893488147419103232\";\n\n  BIGNUM *bn1 = NULL;\n  BIGNUM *bn2 = NULL;\n  BN_CTX *ctx = BN_CTX_new();\n\n  BN_dec2bn(&amp;bn1, num1); // convert the string to BIGNUM\n  BN_dec2bn(&amp;bn2, num2);\n\n  BN_add(bn1, bn1, bn2); // bn1 = bn1 + bn2\n\n  char *result_str = BN_bn2dec(bn1);  // convert the BIGNUM back to string\n  printf(\"%s + %s = %s\\n\", num1, num2, result_str);\n  OPENSSL_free(result_str);\n\n  BN_free(bn1);\n  BN_free(bn2);\n  BN_CTX_free(ctx);\n\n  return 0;\n}\n</code></pre>\n\n<p>Compile it with:</p>\n\n<pre><code>#&gt; gcc -Wall -Wextra -g -o sample sample.c -lcrypto\n</code></pre>\n\n<p>You should get something like this when executing it:</p>\n\n<pre><code>18446744073709551616 + 36893488147419103232 = 55340232221128654848\n</code></pre>\n"}], "owner": {"reputation": 258, "user_id": 6726703, "user_type": "registered", "accept_rate": 89, "profile_image": "https://graph.facebook.com/1227426243957448/picture?type=large", "display_name": "Popovici Sebi", "link": "https://stackoverflow.com/users/6726703/popovici-sebi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 2, "answer_count": 1, "score": 5, "last_activity_date": 1500376194, "creation_date": 1472042943, "last_edit_date": 1472393280, "question_id": 39123801, "link": "https://stackoverflow.com/questions/39123801/how-to-store-large-numbers", "title": "How to store large numbers?", "body": "<p>I have to make a RSA signature (on a state machine) in <code>C</code> on a 32bit board. I am limited on memory so I can not store decimals in a vector or something like that.</p>\n\n<p>The best thing would be if I could store bits and to have easy access to them; what storage method would be best?</p>\n\n<p>I made this one:</p>\n\n<pre><code>#if (CPU_TYPE == CPU_TYPE_32)\n\ntypedef uint32_t word;\n#define word_length 32\ntypedef struct BigNumber {\n    word words[64];\n} BigNumber;\n\n#elif (CPU_TYPE == CPU_TYPE_16)\n\ntypedef uint16_t word;\n#define word_length 16\ntypedef struct BigNumber {\n    word words[128];\n} BigNumber;\n\n#else  \n#error Unsupported CPU_TYPE  \n#endif\n</code></pre>\n\n<p>This seems hard to use.  How can I simplify it?</p>\n"}, {"tags": ["c", "arrays", "pointers", "multidimensional-array"], "comments": [{"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 1, "creation_date": 1472042439, "post_id": 39123570, "comment_id": 65592652, "body": "The message is correct - <code>table</code> is neither an array nor a pointer."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 4, "creation_date": 1472042501, "post_id": 39123570, "comment_id": 65592703, "body": "Please don&#39;t cast the return of <code>malloc</code> &amp; co in C. using <code>typedef</code> to obscure the fact that you&#39;re dealing with pointers is also considered to be bad style in most cases. Another thing: inside <code>nullTable</code>, you&#39;re allocating memory, not returning anything, and never <code>free</code>&#39;ing the memory. You&#39;re leaking memory in other words"}, {"owner": {"reputation": 30168, "user_id": 5612562, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/gzBQY.jpg?s=128&g=1", "display_name": "msc", "link": "https://stackoverflow.com/users/5612562/msc"}, "edited": false, "score": 0, "creation_date": 1472042646, "post_id": 39123570, "comment_id": 65592805, "body": "Use table variable as a double pointer."}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1472043028, "post_id": 39123570, "comment_id": 65593100, "body": "This <code>void nullTable(size_t)</code> misses the variable name. <code>size_t</code> is just a type."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1472043045, "post_id": 39123570, "comment_id": 65593110, "body": "Looking at the code a bit closer, you don&#39;t seem to understand how pointers actually work: <code>table</code> isn&#39;t a pointer, it&#39;s a struct. The memory you&#39;ve allocated doesn&#39;t exactly make sense (in terms of size, you actually want to allocate <code>sizeof(Table)</code>, and then allocate memory for the <code>hashTableSet</code> member separately. At no point does <code>table[i][j]</code> make sense. The offset of the first member of a struct is guaranteed to be 0, but the first member of <code>table</code> is an <code>int</code>, which you&#39;re accessing as an array of sorts. That will never, ever work"}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1472043260, "post_id": 39123570, "comment_id": 65593292, "body": "Here &quot;<i>and HashTableSet an array of DataPointer</i>&quot; the verb is missing, which I feel is essential to understand what you are after."}, {"owner": {"reputation": 1513, "user_id": 5784052, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e6139e7c726eceed5250789e18427768?s=128&d=identicon&r=PG&f=1", "display_name": "Eyzuky", "link": "https://stackoverflow.com/users/5784052/eyzuky"}, "edited": false, "score": 0, "creation_date": 1472043368, "post_id": 39123570, "comment_id": 65593377, "body": "Thank you all for your comments. I do lack understanding and trying to learn by this example. Should Table hold **HashTableSet?"}, {"owner": {"reputation": 1513, "user_id": 5784052, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e6139e7c726eceed5250789e18427768?s=128&d=identicon&r=PG&f=1", "display_name": "Eyzuky", "link": "https://stackoverflow.com/users/5784052/eyzuky"}, "edited": false, "score": 0, "creation_date": 1472043605, "post_id": 39123570, "comment_id": 65593565, "body": "Alright, i think i understood a little. I am now trying something closer to: table.hashTableSet-&gt;hashSet[j] instead of table[i][j]."}], "owner": {"reputation": 1513, "user_id": 5784052, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e6139e7c726eceed5250789e18427768?s=128&d=identicon&r=PG&f=1", "display_name": "Eyzuky", "link": "https://stackoverflow.com/users/5784052/eyzuky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1472044561, "creation_date": 1472042305, "last_edit_date": 1472044561, "question_id": 39123570, "link": "https://stackoverflow.com/questions/39123570/array-of-a-type-which-is-an-array-of-another-type-c", "title": "Array of a type which is an array of another type - C", "body": "<p>I have this code:</p>\n\n<pre><code>typedef struct Table* TableP;\n\ntypedef struct DataPointer\n{\n    void* dataP;\n    void* key;\n}DataPointer;\n\ntypedef struct HashTableSet\n{\n    DataPointer *hashSet[2];\n}HashTableSet;\n\ntypedef struct Table\n{\n    int size, d;\n    HashTableSet *hashTableSet;\n}Table;\n\nvoid nullTable(size_t)\n{\n    TableP myTable = (Table*)malloc(size_t*sizeof(HashTableSet)*sizeof(DataPointer);\n    Table table = *tableP;\n    int i = 0;\n    for(; i &lt; tableP-&gt;size; i++)\n    {\n        int j = 0;\n        for (; j &lt; MAX_ROW_ELEMENTS ; ++j)\n        {\n            DataPointer data;\n            DataPointer *dataP = &amp;data;\n            data.key = NULL;\n            data.dataP = NULL;\n            table[i][j] = data;\n        }\n    }\n}\n</code></pre>\n\n<p>My goal is to have Table as an array of HashTableSet, and HashTableSet an array of DataPointer, and in the null function i am trying to create all spots in the table to be initialized to NULL (atlist the pointers). But i get this error message:</p>\n\n<pre><code> error: subscripted value is neither array nor pointer nor vector\n         table[i][j] = data;\n</code></pre>\n\n<p>So what am i doing wrong? I guess i need some pointer to pointer action but i am not sure how to do it in a case that i have a 2Dimentional array with different types in each dimension.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 51929, "user_id": 1524450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSzDV.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1524450/michael"}, "edited": false, "score": 2, "creation_date": 1472040519, "post_id": 39122868, "comment_id": 65591299, "body": "<code>token = 1;</code> has no effect on <code>second.token</code>. You want <code>second-&gt;token = 1;</code> (the second argument is redundant)."}, {"owner": {"reputation": 8251, "user_id": 2912665, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XrRhd.jpg?s=128&g=1", "display_name": "CinCout", "link": "https://stackoverflow.com/users/2912665/cincout"}, "edited": false, "score": 0, "creation_date": 1472040553, "post_id": 39122868, "comment_id": 65591320, "body": "Also, I don&#39;t see any need to pass the second parameter!"}, {"owner": {"reputation": 31113, "user_id": 112079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ccb721ddaf2f6e7dccc66262f406b1?s=128&d=identicon&r=PG&f=1", "display_name": "fvu", "link": "https://stackoverflow.com/users/112079/fvu"}, "edited": false, "score": 0, "creation_date": 1472040680, "post_id": 39122868, "comment_id": 65591410, "body": "There must be dozens of almost-dupes for this one, @CBegin you should start out by <b>searching</b> SO for comparable questions before asking one yourself."}], "answers": [{"comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1472040778, "post_id": 39122900, "comment_id": 65591480, "body": "As the accepted answer of the dup states: C does never do pass-by-reference. It is strictly pass-by-value. Regarding the constant: Python is strictly pass-by-reference, but still you can pass a literal to a function. And it works like a charm. No horror!"}], "tags": [], "owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "is_accepted": false, "score": 4, "last_activity_date": 1472040856, "last_edit_date": 1472040856, "creation_date": 1472040487, "answer_id": 39122900, "question_id": 39122868, "link": "https://stackoverflow.com/questions/39122868/function-return-value-different-from-expected/39122900#39122900", "title": "Function return value different from expected", "body": "<p>C uses pass-by-value for function argument passing.</p>\n\n<p>In your code, <code>second.token</code> is passed by value, so any change made to it inside the function will not reflect to the caller.</p>\n\n<p>What you're expecting, is the below code </p>\n\n<pre><code>void change( int x)\n{\n      x = 10;\n}\n\nint main(void)\n{\n    int p = 5;\n    change(p);\n    printf(\"%d\\n\", p);\n    return 0;\n}\n</code></pre>\n\n<p>to print 10, which is simply not possible. (If you make the call as <code>change(15);</code>, <em>imagine the horror</em>.)</p>\n\n<p>Solution:</p>\n\n<p>You don't need to pass the second argument separately. You're already passing the pointer to the structure containing the enum variable, just use the pointer to change the value in the called function, and then in the caller, print the value of the enum member of the structure variable.</p>\n"}, {"comments": [{"owner": {"reputation": 8251, "user_id": 2912665, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XrRhd.jpg?s=128&g=1", "display_name": "CinCout", "link": "https://stackoverflow.com/users/2912665/cincout"}, "edited": false, "score": 0, "creation_date": 1472040676, "post_id": 39122958, "comment_id": 65591406, "body": "What is the use of passing the second argument?"}], "tags": [], "owner": {"reputation": 1081, "user_id": 5532266, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ysTfd.gif?s=128&g=1", "display_name": "DevMJ", "link": "https://stackoverflow.com/users/5532266/devmj"}, "is_accepted": false, "score": 0, "last_activity_date": 1472040696, "last_edit_date": 1472040696, "creation_date": 1472040640, "answer_id": 39122958, "question_id": 39122868, "link": "https://stackoverflow.com/questions/39122868/function-return-value-different-from-expected/39122958#39122958", "title": "Function return value different from expected", "body": "<pre><code>struct player\n{\nchar name[20];\nenum cell token;\nunsigned score;\n};\n\n\nBOOLEAN init_player2(struct player *second, enum cell token)\n{\n    second-&gt;token= 1;\n}\n\nint main()\n{\n    struct player second;\n    init_player2(&amp;second, second.token);\n    printf(\"The value of second token is: %d\\n\", second.token);\n\n    return 0;\n}\n</code></pre>\n\n<p>You just need to use variable of structure inside function using pointer to change the value. </p>\n"}], "owner": {"reputation": 29, "user_id": 6729281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ef6b564bd526be8c565960c368b3bb6?s=128&d=identicon&r=PG&f=1", "display_name": "CBegin", "link": "https://stackoverflow.com/users/6729281/cbegin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1477039649, "creation_date": 1472040387, "last_edit_date": 1472040456, "question_id": 39122868, "link": "https://stackoverflow.com/questions/39122868/function-return-value-different-from-expected", "title": "Function return value different from expected", "body": "<p>I having trouble understanding what is happening. The value of second token is some random number instead of 1. Why does the value of second token not the value in the function?</p>\n\n<pre><code>struct player\n{\nchar name[20];\nenum cell token;\nunsigned score;\n};\n\n\nBOOLEAN init_player2(struct player *second, enum cell token)\n{\n    token = 1;\n}\n\nint main()\n{\n    struct player second;\n    init_player2(&amp;second, second.token);\n    printf(\"The value of second token is: %d\\n\", second.token);\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "arrays", "malloc"], "comments": [{"owner": {"reputation": 27697, "user_id": 4433386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/hbHEL.png?s=128&g=1", "display_name": "Marcus M&#252;ller", "link": "https://stackoverflow.com/users/4433386/marcus-m%c3%bcller"}, "edited": false, "score": 0, "creation_date": 1472040254, "post_id": 39122791, "comment_id": 65591080, "body": "<code>if(!ptr_file)fclose(ptr_file);</code> doesn&#39;t make sense. If the file wasn&#39;t opened, no need to close it. In fact, you&#39;re calling <code>fclose(0)</code> in that case; that certainly can&#39;t do anything useful!"}, {"owner": {"reputation": 27697, "user_id": 4433386, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/hbHEL.png?s=128&g=1", "display_name": "Marcus M&#252;ller", "link": "https://stackoverflow.com/users/4433386/marcus-m%c3%bcller"}, "edited": false, "score": 1, "creation_date": 1472040332, "post_id": 39122791, "comment_id": 65591144, "body": "The funny thing is that you <i>should</i> be using malloc or similar mechanisms, and you tag <a href=\"https://stackoverflow.com/questions/tagged/malloc\">malloc</a>, but you <i>don&#39;t</i> use it!"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472042146, "post_id": 39122791, "comment_id": 65592417, "body": "Note: <code>return</code> is not a function, but a statement. Don&#39;t put parentheses around a simple argument, this can result in subtle errors with typos."}], "answers": [{"comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 1, "creation_date": 1472040396, "post_id": 39122816, "comment_id": 65591199, "body": "Upvoted: I prefer the final solution by a country mile."}, {"owner": {"reputation": 9, "user_id": 5506981, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204106691987457/picture?type=large", "display_name": "Morfeo Rejocktana", "link": "https://stackoverflow.com/users/5506981/morfeo-rejocktana"}, "edited": false, "score": 0, "creation_date": 1472040653, "post_id": 39122816, "comment_id": 65591390, "body": "Thank you i&#180;l try again with malloc, it is the &quot;best&quot; way to deal with array in functions."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 1, "creation_date": 1472040737, "post_id": 39122816, "comment_id": 65591450, "body": "I can&#39;t resist, do forgive me: a problem with that approach is that if this function ever ends up in a library, then that library&#39;s <code>malloc</code> might use a different C runtime library than your <code>free</code>. Watch your computer slowly melt."}], "tags": [], "owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": false, "score": 2, "last_activity_date": 1472040469, "last_edit_date": 1472040469, "creation_date": 1472040221, "answer_id": 39122816, "question_id": 39122791, "link": "https://stackoverflow.com/questions/39122791/c-function-with-array-do-not-return-value/39122816#39122816", "title": "c function with array do not return value", "body": "<p>You are returning a pointer to a local array. That local array goes out of scope once the function returns, leaving you with a pointer to an array that no longer exists. Attempting to use this pointer will lead to <em>undefined behavior</em>.</p>\n\n<p>There are a few solutions:</p>\n\n<ul>\n<li><p>Make the array a global variable.</p></li>\n<li><p>Make the array <code>static</code>. That means its lifetime is extended to the lifetime of the program, and the pointer to it will still be valid after you return it.</p></li>\n<li><p>Allocate dynamically using <code>malloc</code>, and return that pointer. Don't forget to <code>free</code> the memory once you're done with it.</p></li>\n<li><p>Create the array in the calling function, and pass a pointer to it as an argument. Let the function fill in that array. If the function doesn't know the size (number of possible elements), you need to pass this as an argument too.</p></li>\n</ul>\n\n<p>I personally recommend the last solution, but the \"best\" might differ depending on use-case. I really <strong><em>don't</em></strong> recommend the first solution, making it a global variable. I also don't like the second, making the variable a <code>static</code> variable, it's really no different from having a global variable IMO.</p>\n"}, {"tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": false, "score": 2, "last_activity_date": 1472040270, "creation_date": 1472040270, "answer_id": 39122833, "question_id": 39122791, "link": "https://stackoverflow.com/questions/39122791/c-function-with-array-do-not-return-value/39122833#39122833", "title": "c function with array do not return value", "body": "<p><code>candata_needed</code> has automatic storage duration. It will go out of scope when the function ends. So don't attempt to return a pointer to it!</p>\n\n<p>The behaviour on using the returned pointer is <em>undefined</em>.</p>\n\n<p>One solution would be to pass a character buffer, along with its size, to <code>read_from_file</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 9, "user_id": 5506981, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204106691987457/picture?type=large", "display_name": "Morfeo Rejocktana", "link": "https://stackoverflow.com/users/5506981/morfeo-rejocktana"}, "is_accepted": false, "score": 0, "last_activity_date": 1472043755, "creation_date": 1472043755, "answer_id": 39124111, "question_id": 39122791, "link": "https://stackoverflow.com/questions/39122791/c-function-with-array-do-not-return-value/39124111#39124111", "title": "c function with array do not return value", "body": "<p>@Joachim Pileborg: I\u00b4ve changed my code and i\u00b4m using now <code>malloc</code>:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nvoid read_from_file(char *result, int lenght_result)\n{\n\n    FILE *ptr_file;\n    char buf[22];\n    char buf_old[sizeof(buf)];\n    char candata_needed[4]; \n    //while(1){\n        ptr_file =fopen(\"/home/pi/probe.txt\",\"r\");\n        if (!ptr_file){\n            return 1;\n        }\n        if (fgets(buf,sizeof(buf), ptr_file)!=NULL){\n\n            if(memcmp(buf, buf_old, sizeof(buf)))\n            {\n\n                memcpy(candata_needed, buf + 17, sizeof(buf));\n                strncpy(result, candata_needed, lenght_result);\n\n                memcpy(buf_old, buf, sizeof(buf));\n            }\n        }\n\n        fclose(ptr_file); \n}\n\n\nint main()\n{\n        int i;\n        int size=4;\n        char *candata = malloc(size);           \n    while(1){\n\n        read_from_file(candata, size);\n\n        printf(\"candata: %s\\n\", candata); \n\n    }\n    free(candata);        \n    return 0; \n</code></pre>\n\n<p>The code works and i can get the data. Is this way ok or it\u00b4s not recomended?\nMy final goal is to send the data as output to another c proram. \nI\u00b4m new in C and it\u00b4s difficult for me to find the best way to resolve this problem.   </p>\n"}], "owner": {"reputation": 9, "user_id": 5506981, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204106691987457/picture?type=large", "display_name": "Morfeo Rejocktana", "link": "https://stackoverflow.com/users/5506981/morfeo-rejocktana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "answer_count": 3, "score": -2, "last_activity_date": 1472043755, "creation_date": 1472040148, "question_id": 39122791, "link": "https://stackoverflow.com/questions/39122791/c-function-with-array-do-not-return-value", "title": "c function with array do not return value", "body": "<p>I wrote the following c-code. </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nchar *read_from_file()\n{\n\n    FILE *ptr_file;\n    char buf[22];\n    char buf_old[sizeof(buf)];\n    char candata_needed[4]; \n        ptr_file =fopen(\"/home/pi/probe.txt\",\"r\");\n        if (!ptr_file){\n            fclose(ptr_file);\n            return 1;\n        }\n        if (fgets(buf,sizeof(buf), ptr_file)!=NULL){\n\n            if(memcmp(buf, buf_old, sizeof(buf)))\n            {\n                memcpy(candata_needed, buf + 17, sizeof(buf));              \n                memcpy(buf_old, buf, sizeof(buf));\n            }\n        }       \n        fclose(ptr_file);    \n   return (candata_needed);        \n}    \n\nint main()\n{\n        char *candata;\n        int i;\n\n    while(1){\n        printf(\"stape 1\\n\");        \n        candata=read_from_file()\n        for(i=0; i&lt;4; i++)\n        {\n            candata[i] = *(candata + i);\n        }\n        printf(\"candata: %s\\n\", candata); \n    }\n        free(candata);\n        return 0;\n}\n</code></pre>\n\n<p>The Function should read a file and store the content(the content is a 22 Hex number) in an Array. From the 22 hex number, i only need 4, so i stored the 4 hex number in a Array(candata_needed). \nSo i want to get the stored 4 hex number from the function in a main-function a pointer. I tried with <code>malloc</code> but i became repeatedly an error  <code>double free or corruption (fasttop)</code>. With the pointer nothing appears. \nCan anybody help please?   </p>\n"}, {"tags": ["c", "performance", "winapi", "gdi"], "comments": [{"owner": {"reputation": 3017, "user_id": 1820086, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/uyBPp.png?s=128&g=1", "display_name": "LBes", "link": "https://stackoverflow.com/users/1820086/lbes"}, "edited": false, "score": 0, "creation_date": 1472040346, "post_id": 39122708, "comment_id": 65591162, "body": "Not sure i get your comment &quot;// Take 100 screen captures for a more accurante measurement of the duration.&quot;. I&#39;m pretty sure the first three line of the for loop can probably done outside of the loop no? What have you tried so far?"}, {"owner": {"reputation": 7126, "user_id": 1560774, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e5c7d8e9733ac6dee89d29d0cd0123f4?s=128&d=identicon&r=PG", "display_name": "Virus721", "link": "https://stackoverflow.com/users/1560774/virus721"}, "reply_to_user": {"reputation": 3017, "user_id": 1820086, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/uyBPp.png?s=128&g=1", "display_name": "LBes", "link": "https://stackoverflow.com/users/1820086/lbes"}, "edited": false, "score": 0, "creation_date": 1472040753, "post_id": 39122708, "comment_id": 65591466, "body": "Well currently I have not tried to change things without knowing first. I suspect that, depending on what mistake I do, I could, for example, have the same screenshot for each iteration due to something not being updated, and because it&#39;s not easy to compare the screenshots without actually displaying them, it would be unpractical to just try things blindly. I&#39;m doing this loop multiple times because I know by experience that GetTickCount is not always very accurate. If it is sometimes inaccurate by 15 ms, then this measurement error is divided by the number of times you iterate."}, {"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 2, "creation_date": 1472041169, "post_id": 39122708, "comment_id": 65591778, "body": "Well, sure, but why are you constantly allocating somewhat costly resources (first 3 lines of your loop), instead of reusing them? Not allocating resources is certainly no slower than allocating resources, so this isn&#39;t <i>&quot;blindly trying things&quot;</i> either."}, {"owner": {"reputation": 3017, "user_id": 1820086, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/uyBPp.png?s=128&g=1", "display_name": "LBes", "link": "https://stackoverflow.com/users/1820086/lbes"}, "reply_to_user": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 0, "creation_date": 1472041781, "post_id": 39122708, "comment_id": 65592168, "body": "As I said in my first comment and I agree with @IInspectable that you could very well try to do the allocation outside of your for loop. It will surely not hurt your implementation. While this may not be enough to get a good enough time performance it will surely improve it. Surely the Delete() could be done outside as well... It&#39;s not blindly testing in that case but just trying what seems to be the most logical thing to do."}, {"owner": {"reputation": 7126, "user_id": 1560774, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e5c7d8e9733ac6dee89d29d0cd0123f4?s=128&d=identicon&r=PG", "display_name": "Virus721", "link": "https://stackoverflow.com/users/1560774/virus721"}, "edited": false, "score": 0, "creation_date": 1472042654, "post_id": 39122708, "comment_id": 65592815, "body": "That&#39;s my point : I wasn&#39;t sure about what allocates and what can be done outside of the loop. When the screen gets updated, the DC pointed to by hScreen is also updated ? Btw you say the first three lines. That Implies that I can remove the 5-th line ? Thanks. EDIT : Well for some reason it&#39;s now taking an extra 10 ms per iteration after moving the first 3 lines and the last 2 lines outside of the loop and commenting out the 5-th one, strange."}, {"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 0, "creation_date": 1472050808, "post_id": 39122708, "comment_id": 65599096, "body": "You should probably read about <a href=\"https://msdn.microsoft.com/en-us/library/dd183553.aspx\" rel=\"nofollow noreferrer\">Device Contexts</a>. As for the code changes, we cannot comment on what we cannot see."}], "answers": [{"comments": [{"owner": {"reputation": 7126, "user_id": 1560774, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e5c7d8e9733ac6dee89d29d0cd0123f4?s=128&d=identicon&r=PG", "display_name": "Virus721", "link": "https://stackoverflow.com/users/1560774/virus721"}, "edited": false, "score": 0, "creation_date": 1472126315, "post_id": 39134107, "comment_id": 65633307, "body": "Thanks for your answer. I did something like this, but unfortunately, BitBlt is is what is taking a very large part of the computation time and is too slow for my needs. I&#39;ll have to find another way to do this."}, {"owner": {"reputation": 26606, "user_id": 4603670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7eabc1427aa3c8185153cc81978289a?s=128&d=identicon&r=PG&f=1", "display_name": "Barmak Shemirani", "link": "https://stackoverflow.com/users/4603670/barmak-shemirani"}, "reply_to_user": {"reputation": 7126, "user_id": 1560774, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e5c7d8e9733ac6dee89d29d0cd0123f4?s=128&d=identicon&r=PG", "display_name": "Virus721", "link": "https://stackoverflow.com/users/1560774/virus721"}, "edited": false, "score": 0, "creation_date": 1472142324, "post_id": 39134107, "comment_id": 65644087, "body": "There are other options for example, for DirectX games, but <code>BitBlt</code> is the only option for remote desktop as far as I know. You can add hook for mouse and keyboard, take screen shot only after user input, this will greatly improve performance, and it should be okay unless the window is doing some drawings on its own."}], "tags": [], "owner": {"reputation": 26606, "user_id": 4603670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7eabc1427aa3c8185153cc81978289a?s=128&d=identicon&r=PG&f=1", "display_name": "Barmak Shemirani", "link": "https://stackoverflow.com/users/4603670/barmak-shemirani"}, "is_accepted": true, "score": 0, "last_activity_date": 1472078660, "creation_date": 1472078660, "answer_id": 39134107, "question_id": 39122708, "link": "https://stackoverflow.com/questions/39122708/improving-screen-capture-performance/39134107#39134107", "title": "Improving screen capture performance", "body": "<p>Keep <code>BitBlt</code> and <code>GetDIBits</code> inside the loop, move the rest outside the loop as follows:</p>\n\n<pre><code>HBITMAP hBitmap = CreateCompatibleBitmap(hScreen, ScreenX, ScreenY);\nHDC hdcMem = CreateCompatibleDC (hScreen);\nHGDIOBJ hOld = SelectObject(hdcMem, hBitmap);\n\nfor( int i = 0; i &lt; 100; ++i )\n{\n    BitBlt(hdcMem, 0, 0, ScreenX, ScreenY, hScreen, 0, 0, SRCCOPY);\n    //hBitmap is updated now\n    GetDIBits(hdcMem, hBitmap, 0, ScreenY, ScreenData, (BITMAPINFO*)&amp;bmi, DIB_RGB_COLORS);\n    //wait...\n}\n\nSelectObject(hdcMem, hOld);\nDeleteDC(hdcMem);\nDeleteObject(hBitmap);\n</code></pre>\n\n<p>In addition <code>bmi.biSizeImage</code> should be set to data size, in this case <code>4 * ScreenX * ScreenY</code></p>\n\n<p>This won't make the code noticeably faster. The bottle neck is at <code>BitBlt</code>. It's still about 30 frames/sec, this should be okay unless there is a game or movie on the screen.</p>\n\n<p>You might also try saving to a 24 bit bitmap. It won't make any difference in this code but data size would be smaller <code>((width * bitcount + 31) / 32) * 4 * height)</code></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 13471385, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/cdfdd130ff88ecbbfe2fecfd3bc868f9?s=128&d=identicon&r=PG", "display_name": "Hobby Programmer", "link": "https://stackoverflow.com/users/13471385/hobby-programmer"}, "is_accepted": false, "score": 0, "last_activity_date": 1588644851, "creation_date": 1588644851, "answer_id": 61604606, "question_id": 39122708, "link": "https://stackoverflow.com/questions/39122708/improving-screen-capture-performance/61604606#61604606", "title": "Improving screen capture performance", "body": "<p>The Aero feature of Windows seems to affect the BitBlt speed.</p>\n\n<p>If you iteratively BitBlt even one pixel from the display, it will run at about 30 frames per second, and the CPU usage will be near idle. But if you turn off the Aero feature of Windows, you'll get BitBlt speeds that are remarkably faster.</p>\n"}], "owner": {"reputation": 7126, "user_id": 1560774, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e5c7d8e9733ac6dee89d29d0cd0123f4?s=128&d=identicon&r=PG", "display_name": "Virus721", "link": "https://stackoverflow.com/users/1560774/virus721"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 478, "favorite_count": 0, "accepted_answer_id": 39134107, "answer_count": 2, "score": 3, "last_activity_date": 1588644851, "creation_date": 1472039921, "question_id": 39122708, "link": "https://stackoverflow.com/questions/39122708/improving-screen-capture-performance", "title": "Improving screen capture performance", "body": "<p>I am going to create some kind of \"remote desktop\" application that streams the content of the screen over a socket to a connected client.</p>\n\n<p>In order to take a screenshot, I've come up with the following piece of code, which is a modified version of examples I've seen here and there.</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;tchar.h&gt;\n#include &lt;stdio.h&gt;\n\nint _tmain( int argc, _TCHAR * argv[] )\n{\n    int ScreenX = 0;\n    int ScreenY = 0;\n    BYTE* ScreenData = 0;\n\n    HDC hScreen = GetDC(GetDesktopWindow());\n\n    ScreenX = GetDeviceCaps(hScreen, HORZRES);\n    ScreenY = GetDeviceCaps(hScreen, VERTRES);\n    ScreenData = (BYTE*)calloc(4 * ScreenX * ScreenY, sizeof(BYTE) );\n\n    BITMAPINFOHEADER bmi = {0};\n    bmi.biSize = sizeof(BITMAPINFOHEADER);\n    bmi.biPlanes = 1;\n    bmi.biBitCount = 32;\n    bmi.biWidth = ScreenX;\n    bmi.biHeight = -ScreenY;\n    bmi.biCompression = BI_RGB;\n    bmi.biSizeImage = 0; // 3 * ScreenX * ScreenY;\n\n\n    int iBegTc = ::GetTickCount();\n\n    // Take 100 screen captures for a more accurante measurement of the duration.\n    for( int i = 0; i &lt; 100; ++i )\n    {\n        HBITMAP hBitmap = CreateCompatibleBitmap(hScreen, ScreenX, ScreenY);\n        HDC hdcMem = CreateCompatibleDC (hScreen);\n        HGDIOBJ hOld = SelectObject(hdcMem, hBitmap);\n        BitBlt(hdcMem, 0, 0, ScreenX, ScreenY, hScreen, 0, 0, SRCCOPY);\n        SelectObject(hdcMem, hOld);\n        GetDIBits(hdcMem, hBitmap, 0, ScreenY, ScreenData, (BITMAPINFO*)&amp;bmi, DIB_RGB_COLORS);\n        DeleteDC(hdcMem);\n        DeleteObject(hBitmap);\n    }\n\n    int iEndTc = ::GetTickCount();\n\n    printf( \"%d ms\", (iEndTc - iBegTc) / 100 );\n    system(\"PAUSE\");\n\n    ReleaseDC(GetDesktopWindow(),hScreen);\n\n    return 0;\n}\n</code></pre>\n\n<p>My problem is that the code within the loop takes too long too execute. In my case it's about 36 ms per iteration.</p>\n\n<p>I am wondering if there are statements that could be done just once and thus put outside of the loop, likI did for the byte buffer. I don't know however which are the ones that I must do for each new image, and which are the ones I can only do one time.</p>\n"}, {"tags": ["c", "multithreading"], "answers": [{"comments": [{"owner": {"reputation": 456, "user_id": 5529678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d52fceadf783b1021718b90c86b53403?s=128&d=identicon&r=PG&f=1", "display_name": "sendaran", "link": "https://stackoverflow.com/users/5529678/sendaran"}, "edited": false, "score": 1, "creation_date": 1472040248, "post_id": 39122039, "comment_id": 65591071, "body": "The question is for C, not C++."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472042301, "post_id": 39122039, "comment_id": 65592537, "body": "1) This is not C! 2) Code-only answer 3) Why two function? 4) No, it does not &quot;work the same&quot;! Different languages!"}], "tags": [], "owner": {"reputation": 527, "user_id": 864802, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/808a56cb6b9771861970068fa0591fb5?s=128&d=identicon&r=PG&f=1", "display_name": "baliman", "link": "https://stackoverflow.com/users/864802/baliman"}, "is_accepted": true, "score": 0, "last_activity_date": 1472037970, "creation_date": 1472037970, "answer_id": 39122039, "question_id": 39121715, "link": "https://stackoverflow.com/questions/39121715/split-a-c-function-into-threads/39122039#39122039", "title": "Split a c function into threads", "body": "<p>I think you can create two functions which does the jobs. I presume the values for k and range are already defined in the program.\nUsing boost/threads.</p>\n\n<p>Johan</p>\n\n<pre><code>    #include &lt;boost/thread.hpp&gt;\n\n    void task1() \n    { \n        while ((k &lt; range) &amp;&amp; ( range &gt; 7))\n        {\n           //loading data from input tables\n           //Computing butterflies\n           //Loading twiddles\n           //Computing final values\n           //Store result in the same table\n        }\n    }\n\n    void task2() \n    { \n        while ((k&lt;range) &amp;&amp; (range&lt;=7))\n        {\n           //loading data from input tables\n           //Computing butterflies\n           //Loading twiddles\n           //Computing final values\n           //Store result in the same table\n        }\n    }\n\nvoid radix4(float* x, float* y, N)\n{\n   for (l = 1; l &lt;= PMAX; l++)\n   {\n      n = pow_4[l];//LUT for power of 4\n      for (c =0; c &lt; n; c=c+4)\n      {\n         //Loading some parameters from a look-up table\n        n2  =LUT_n2[l][c];\n        N2  =LUT_n2[l][c+1];\n        N2_2=LUT_n2[l][c+2];\n        N2_3=LUT_n2[l][c+3];\n        factor = TWIDDLE_LIMIT/(range*4);\n\n        thread thread_1 = thread(task1);\n        thread thread_2 = thread(task2);\n\n        // join\n        thread_2.join();\n        thread_1.join();\n\n   }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 78, "user_id": 6744189, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qFucL.png?s=128&g=1", "display_name": "Ayan Shafqat", "link": "https://stackoverflow.com/users/6744189/ayan-shafqat"}, "is_accepted": false, "score": 1, "last_activity_date": 1472048954, "creation_date": 1472048954, "answer_id": 39126125, "question_id": 39121715, "link": "https://stackoverflow.com/questions/39121715/split-a-c-function-into-threads/39126125#39126125", "title": "Split a c function into threads", "body": "<p>It looks like you're trying to optimize an FFT routine. You may want to look into thread pools, since you're going to compute multiple FFTs over the lifetime of the application. Take a look at <a href=\"http://fftw.org/\" rel=\"nofollow\">FFTW</a>'s website and see how their API is structured.</p>\n\n<p>And for the answer to your question, you can \"split\" your problem into <code>N</code> threads (Let's pick <code>N = 2</code>). Then what you need to do is basically de-interleave (even in top half of array, and odd in bottom for <code>N = 2</code>). And run another routine to compute FFT for the subset of those arrays (<code>N</code> of them). Then you can put the arrays back using the identity/symmetry properties and interleave the array again.</p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 451, "user_id": 6650397, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2fcc00075552f0fd192c2c13b4f6256b?s=128&d=identicon&r=PG&f=1", "display_name": "A.nechi", "link": "https://stackoverflow.com/users/6650397/a-nechi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 39122039, "answer_count": 2, "score": 1, "last_activity_date": 1472048954, "creation_date": 1472037045, "question_id": 39121715, "link": "https://stackoverflow.com/questions/39121715/split-a-c-function-into-threads", "title": "Split a c function into threads", "body": "<p>I have a c application handling float tables purposed for Radix4 calculation. Now I want it to be split into two threads in order to run it on a multicore system, First, this is the function structure:</p>\n\n<pre><code>void radix4(float* x, float* y, N)\n{\n   for (l = 1; l &lt;= PMAX; l++)\n   {\n      n = pow_4[l];//LUT for power of 4\n      for (c =0; c &lt; n; c=c+4)\n      {\n         //Loading some parameters from a look-up table\n        n2  =LUT_n2[l][c];\n        N2  =LUT_n2[l][c+1];\n        N2_2=LUT_n2[l][c+2];\n        N2_3=LUT_n2[l][c+3];\n        factor = TWIDDLE_LIMIT/(range*4);\n\n          while ((k &lt; range) &amp;&amp; ( range &gt; 7))\n          {//loading data from input tables\n           //Computing butterflies\n           //Loading twiddles\n           //Computing final values\n           //Store result in the same table\n          }\n          while ((k&lt;range) &amp;&amp; (range&lt;=7))\n          {\n           //loading data from input tables\n           //Computing butterflies\n           //Loading twiddles\n           //Computing final values\n           //Store result in the same table\n          }\n      }\n   }\n}\n</code></pre>\n\n<p>the while loops are unrolled.\nNow what I want to understand is how can i know which parts can be split into threads and could give some hints on how to do it because I'm reading a lot of stuffs that made me a little bit confused. </p>\n"}, {"tags": ["c++", "c", "haskell", "ffi"], "comments": [{"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "reply_to_user": {"reputation": 5662, "user_id": 5781248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/712de4f2f811d1a400d3311c9cdd5836?s=128&d=identicon&r=PG&f=1", "display_name": "J.J. Hakala", "link": "https://stackoverflow.com/users/5781248/j-j-hakala"}, "edited": false, "score": 0, "creation_date": 1472037793, "post_id": 39121458, "comment_id": 65589346, "body": "@J.J.Hakala that does not make a difference. I can also use <code>cout</code> earlier in <code>basler_init</code> without any problems."}], "answers": [{"comments": [{"owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "edited": false, "score": 3, "creation_date": 1472039048, "post_id": 39122190, "comment_id": 65590193, "body": "Wow, spot on! I used the &quot;hack&quot; from <a href=\"http://www.serpentine.com/blog/2010/09/04/dealing-with-fragile-c-libraries-e-g-mysql-from-haskell/\" rel=\"nofollow noreferrer\">serpentine.com/blog/2010/09/04/&hellip;</a> and all is good now. Thank you!"}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 8, "last_activity_date": 1472038901, "last_edit_date": 1472038901, "creation_date": 1472038383, "answer_id": 39122190, "question_id": 39121458, "link": "https://stackoverflow.com/questions/39121458/calling-a-shared-library-from-haskell-via-ffi-blocks-while-it-doesnt-when-link/39122190#39122190", "title": "Calling a shared library from Haskell via FFI blocks, while it doesn&#39;t when linked from a C program", "body": "<p>I believe this TRAC commentary is relevant:</p>\n\n<p><a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Signals\">https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Signals</a></p>\n\n<p>The difference occurs starting a line 437 in the C strace output\nvs. line 495 in the Haskell strace output.</p>\n\n<p>At this point the library creates two UDP sockets and sends two UDP datagrams\n(lines 448-449 C / lines 506-507 Haskell). The packets are broadcast to\ntwo local networks: 192.168.1.0/24 and 192.168.56.0/24.</p>\n\n<p>It then waits for a response on either of these sockets with a timeout of (apparently)\n25 microseconds (line 450 C / line 508 Haskell). In the C case the select call\ntimes out. In the Haskell case the select call is repeatedly interrupted by\na SIGVTALRM signal which is used by the GHC RTS. This is the same pattern\nwhich is shown in the the above TRAC commentary.</p>\n\n<p>For a potential fix, have a look at how the mysql package implements and uses the <code>block_rts_signals()</code> and <code>unblock_rts_signals()</code> macros:</p>\n\n<ul>\n<li><a href=\"https://github.com/bos/mysql/blob/00fcc3ae5bb03b49612ecdd43319164377671ad5/cbits/mysql_signals.c\">mysql_signals.c</a></li>\n</ul>\n"}], "owner": {"reputation": 5992, "user_id": 74497, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0d4a7e6c8edd88e835508df8397592e5?s=128&d=identicon&r=PG", "display_name": "ocharles", "link": "https://stackoverflow.com/users/74497/ocharles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 3, "accepted_answer_id": 39122190, "answer_count": 1, "score": 6, "last_activity_date": 1472038901, "creation_date": 1472036387, "last_edit_date": 1472037519, "question_id": 39121458, "link": "https://stackoverflow.com/questions/39121458/calling-a-shared-library-from-haskell-via-ffi-blocks-while-it-doesnt-when-link", "title": "Calling a shared library from Haskell via FFI blocks, while it doesn&#39;t when linked from a C program", "body": "<p>I'm trying to interface with a Basler USB3 camera from a Haskell application, but I'm experiencing some difficulty. The camera comes with a C++ library that makes it fairly straight forward. The following code can be used to acquire a camera source:</p>\n\n<pre><code>extern \"C\" {\n  void basler_init() {\n    PylonAutoInitTerm pylon;\n    CInstantCamera camera( CTlFactory::GetInstance().CreateFirstDevice());\n    camera.RegisterConfiguration( (CConfigurationEventHandler*) NULL, RegistrationMode_ReplaceAll, Cleanup_None);\n    cout &lt;&lt; \"Using device \" &lt;&lt; camera.GetDeviceInfo().GetModelName() &lt;&lt; endl;\n  }\n}\n</code></pre>\n\n<p>I've used this source code to build a shared library - <code>libbasler.so</code>. To confirm it works, here's a basic C program that links against it and confirms everything is working:</p>\n\n<pre><code>void basler_init();\n\nint main () {\n  basler_init();\n}\n</code></pre>\n\n<p>I compile and run this as:</p>\n\n<pre><code>$ gcc Test2.c -lbasler -Llib -Wl,--enable-new-dtags -Wl,-rpath,pylon5/lib64 -Wl,-E -lpylonbase -o Test2-c\n\n$ PYLON_CAMEMU=1 LD_LIBRARY_PATH=lib ./Test2-c\nUsing device Emulation\n</code></pre>\n\n<p>This is the expected output.</p>\n\n<p>However, when I try and use this with Haskell, the behaviour changes and the program blocks indefinitely. Here's the Haskell source code:</p>\n\n<pre><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nforeign import ccall \"basler_init\" baslerInit :: IO ()\n\nmain :: IO ()\nmain = baslerInit\n</code></pre>\n\n<p>I compile and run this as:</p>\n\n<pre><code>$ ghc --make Test2.hs -o Test2-haskell -Llib -lbasler -optl-Wl,--enable-new-dtags -optl-Wl,-rpath,pylon5/lib64 -optl-Wl,-E -lpylonbase\n\n$ PYLON_CAMEMU=1 LD_LIBRARY_PATH=lib ./Test2-haskell\n</code></pre>\n\n<p>The application now hangs indefinitely.</p>\n\n<p>I have ran both through <code>strace</code> to try and get an idea of what is going on, but I'm unable to really make much sense of it. The output is too long to add here, but please see these two pastes:</p>\n\n<ul>\n<li><code>strace</code> output for the C application: <a href=\"https://gist.github.com/ocharles/001b5f42c09229bc7a8482a22cadf486\">https://gist.github.com/ocharles/001b5f42c09229bc7a8482a22cadf486</a></li>\n<li><code>strace</code> output for the Haskell application: <a href=\"https://gist.github.com/ocharles/4c1c45a9ee78f75cd723f1a2910998f3\">https://gist.github.com/ocharles/4c1c45a9ee78f75cd723f1a2910998f3</a></li>\n</ul>\n\n<p>On top of that, I've used <code>gdb</code> to try and ascertain where the Haskell application is getting stuck:</p>\n\n<pre><code>$ PYLON_CAMEMU=1 LD_LIBRARY_PATH=lib gdb Test2-haskell \nGNU gdb (GDB) 7.11\nCopyright (C) 2016 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-pc-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n&lt;http://www.gnu.org/software/gdb/bugs/&gt;.\nFind the GDB manual and other documentation resources online at:\n&lt;http://www.gnu.org/software/gdb/documentation/&gt;.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from Test2-haskell...done.\n(gdb) run\nStarting program: /home/ollie/work/circuithub/receiving-station/Test2-haskell \nwarning: File \"/nix/store/9ljgbhb26ca0j9shwh8bwsa77h42izr2-gcc-5.4.0-lib/lib/libstdc++.so.6.0.21-gdb.py\" auto-loading has been declined by your `auto-load safe-path' set to \"$debugdir:$datadir/auto-load\".\nTo enable execution of this file add\n        add-auto-load-safe-path /nix/store/9ljgbhb26ca0j9shwh8bwsa77h42izr2-gcc-5.4.0-lib/lib/libstdc++.so.6.0.21-gdb.py\nline to your configuration file \"/home/ollie/.gdbinit\".\nTo completely disable this security protection add\n        set auto-load safe-path /\nline to your configuration file \"/home/ollie/.gdbinit\".\nFor more information about this security protection see the\n\"Auto-loading safe path\" section in the GDB manual.  E.g., run from the shell:\n        info \"(gdb)Auto-loading safe path\"\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/nix/store/bb32xf954imhdrzn7j8h82xs1bx7p3fr-glibc-2.23/lib/libthread_db.so.1\".\n^C\nProgram received signal SIGINT, Interrupt.\n0x00007ffff6c6fb33 in __recvfrom_nocancel () from /nix/store/98s2znxww6x7h2ch7cj1w5givahxmdna-glibc-2.23/lib/libc.so.6\n(gdb) bt\n#0  0x00007ffff6c6fb33 in __recvfrom_nocancel () from /nix/store/98s2znxww6x7h2ch7cj1w5givahxmdna-glibc-2.23/lib/libc.so.6\n#1  0x00007fffedb885c2 in GxImp::CEnumCollector::OnReady(unsigned int, _GX_SOCKET_INTERFACE_INFO const*) () from /home/ollie/work/circuithub/receiving-station/pylon5/lib64/libgxapi-5.0.1.so\n#2  0x00007fffedb8d54d in CCollector::Collect(GxImp::CSocket*, unsigned int, unsigned int, _GX_SOCKET_INTERFACE_INFO const*) () from /home/ollie/work/circuithub/receiving-station/pylon5/lib64/libgxapi-5.0.1.so\n#3  0x00007fffedb8817b in CBroadcastSocketCollection::Collect(CCollector&amp;, unsigned int) () from /home/ollie/work/circuithub/receiving-station/pylon5/lib64/libgxapi-5.0.1.so\n#4  0x00007fffedb889ab in Gx::Enumerator::Discover(Gx::Enumerator::Callee*, unsigned int, unsigned int, sockaddr const*) () from /home/ollie/work/circuithub/receiving-station/pylon5/lib64/libgxapi-5.0.1.so\n#5  0x00007fffeddeaca0 in Pylon::CBaslerGigETl::DoDeviceEnumeration(Pylon::DeviceInfoList&amp;, bool, sockaddr const*) () from pylon5/lib64/libpylon_TL_gige-5.0.1.so\n#6  0x00007fffeddeaebc in Pylon::CBaslerGigETl::InternalEnumerateDevices(Pylon::DeviceInfoList&amp;) () from pylon5/lib64/libpylon_TL_gige-5.0.1.so\n#7  0x00007fffeddf3c99 in Pylon::CTransportLayerBase&lt;Pylon::IGigETransportLayer&gt;::EnumerateDevices(Pylon::DeviceInfoList&amp;, Pylon::DeviceInfoList const&amp;, bool) () from pylon5/lib64/libpylon_TL_gige-5.0.1.so\n#8  0x00007ffff7949669 in Pylon::CTlFactory::EnumerateDevices(Pylon::DeviceInfoList&amp;, Pylon::DeviceInfoList const&amp;, bool) () from pylon5/lib64/libpylonbase-5.0.1.so\n#9  0x00007ffff7949c8f in Pylon::CTlFactory::InternalCreateDevice(Pylon::CDeviceInfo const&amp;, GenICam_3_0_Basler_pylon_v5_0::gcstring_vector const&amp;, bool) () from pylon5/lib64/libpylonbase-5.0.1.so\n#10 0x00007ffff794a655 in Pylon::CTlFactory::CreateFirstDevice(Pylon::CDeviceInfo const&amp;) () from pylon5/lib64/libpylonbase-5.0.1.so\n#11 0x00007ffff7bd7dc5 in basler_init () from lib/libbasler.so\n#12 0x0000000000438415 in rFl_info ()\n#13 0x0000000000000000 in ?? ()\n</code></pre>\n\n<p>For the C program:</p>\n\n<pre><code>Reading symbols from Test2-c...done.\n(gdb) run\nStarting program: /home/ollie/work/circuithub/receiving-station/Test2-c \nwarning: File \"/nix/store/9ljgbhb26ca0j9shwh8bwsa77h42izr2-gcc-5.4.0-lib/lib/libstdc++.so.6.0.21-gdb.py\" auto-loading has been declined by your `auto-load safe-path' set to \"$debugdir:$datadir/auto-load\".\nTo enable execution of this file add\n        add-auto-load-safe-path /nix/store/9ljgbhb26ca0j9shwh8bwsa77h42izr2-gcc-5.4.0-lib/lib/libstdc++.so.6.0.21-gdb.py\nline to your configuration file \"/home/ollie/.gdbinit\".\nTo completely disable this security protection add\n        set auto-load safe-path /\nline to your configuration file \"/home/ollie/.gdbinit\".\nFor more information about this security protection see the\n\"Auto-loading safe path\" section in the GDB manual.  E.g., run from the shell:\n        info \"(gdb)Auto-loading safe path\"\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/nix/store/bb32xf954imhdrzn7j8h82xs1bx7p3fr-glibc-2.23/lib/libthread_db.so.1\".\n[New Thread 0x7fffed4ae700 (LWP 13792)]\n[New Thread 0x7fffeccad700 (LWP 13793)]\nUsing device Emulation\n[Thread 0x7fffeccad700 (LWP 13793) exited]\n[Thread 0x7fffed4ae700 (LWP 13792) exited]\n[Inferior 1 (process 13788) exited normally]\n</code></pre>\n\n<p>My guess is GHC's runtime is doing something that causes pthreads to have different behaviour, but I'm not sure what that could be.</p>\n"}, {"tags": ["c++", "c", "multithreading", "loops", "glut"], "comments": [{"owner": {"reputation": 1248, "user_id": 1791872, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/6nnz7.png?s=128&g=1", "display_name": "flau", "link": "https://stackoverflow.com/users/1791872/flau"}, "edited": false, "score": 6, "creation_date": 1472034880, "post_id": 39120836, "comment_id": 65587451, "body": "<code>I have a c-Program ... Within this function I have C++ Code</code> What?"}, {"owner": {"reputation": 4649, "user_id": 5601284, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qVVND.jpg?s=128&g=1", "display_name": "byxor", "link": "https://stackoverflow.com/users/5601284/byxor"}, "edited": false, "score": 0, "creation_date": 1472034887, "post_id": 39120836, "comment_id": 65587453, "body": "Maybe you could start your own thread before glut gets into its loop."}, {"owner": {"reputation": 13260, "user_id": 6612932, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Q3mwe.jpg?s=128&g=1", "display_name": "rgmt", "link": "https://stackoverflow.com/users/6612932/rgmt"}, "edited": false, "score": 1, "creation_date": 1472036486, "post_id": 39120836, "comment_id": 65588536, "body": "Your post is unclear. You should edit it and show some code"}, {"owner": {"reputation": 1, "user_id": 6751355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45bc78ddf212b5407c0718f4141e4c4f?s=128&d=identicon&r=PG&f=1", "display_name": "Michael O", "link": "https://stackoverflow.com/users/6751355/michael-o"}, "edited": false, "score": 0, "creation_date": 1472143163, "post_id": 39120836, "comment_id": 65644634, "body": "Sorry if my explainations aren&#39;t so clear. I started programming with c++ not so long ago. I will show some pseudo code tomorrow when I have access to my program again."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 6751355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45bc78ddf212b5407c0718f4141e4c4f?s=128&d=identicon&r=PG&f=1", "display_name": "Michael O", "link": "https://stackoverflow.com/users/6751355/michael-o"}, "edited": false, "score": 0, "creation_date": 1472143683, "post_id": 39125734, "comment_id": 65644899, "body": "Thank you very much for this detailed explaination! I should have mentioned that I use external already for mixing my c and c++ code. If I plug the doStep function into the idle callback, it wouldn&#39;t get called every 40 ms from my c-main() but more frequently. The program is a little bit more complex, I will try to give you some pseudocode tomorrow, when I have access to my code."}], "tags": [], "owner": {"reputation": 7786, "user_id": 999884, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yuL5q.jpg?s=128&g=1", "display_name": "Software_Designer", "link": "https://stackoverflow.com/users/999884/software-designer"}, "is_accepted": false, "score": 1, "last_activity_date": 1472051054, "last_edit_date": 1472051054, "creation_date": 1472047914, "answer_id": 39125734, "question_id": 39120836, "link": "https://stackoverflow.com/questions/39120836/how-to-call-an-external-c-function-while-a-glut-display-loop-locks-my-c-main/39125734#39125734", "title": "How to call an external c-function, while a GLUT Display Loop locks my c++ main?", "body": "<p>To mix <code>C</code> code with <code>C++</code> code, use the <code>extern</code> keyword.</p>\n\n<pre><code>extern \"C\"{\n   void externalDoStep() {\n\n    // your algorithm here\n\n   }   \n}\n</code></pre>\n\n<p>However when you say that your function is being blocked, i think you should do this:</p>\n\n<p>Try plugging your <code>doStep()</code> function into this <code>GLUT</code> callback function just to see..</p>\n\n<p><code>glutIdleFunc( doStep );</code></p>\n\n<p>or any other <code>GLUT</code> callback function.  </p>\n\n<p>If you dont put your functions in a <code>GLUT</code> callback function, your function will not be run by <code>GLUT</code>.</p>\n\n<p>The main important part of <code>GLUT</code> are the <code>callbacks</code>. These are functions that will handle the <code>GLUT</code> events generated when you change the size of the window or press a key.</p>\n\n<p>It works like this. You create your own functions and plug those function\ninto these main <code>GLUT</code> callback functions. They must be in the <code>main()</code></p>\n\n<pre><code>   glutReshapeFunc(your reshape function);\n   glutDisplayFunc(your display function);\n   glutIdleFunc(your idle function);\n   glutKeyboardFunc(your keyboard function);\n</code></pre>\n\n<p>Full Code listing:</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;string.h&gt;\n#include &lt;GL\\glut.h&gt;\n#include &lt;iostream.h&gt;\n#include &lt;fstream.h&gt;\n\n#pragma comment(lib, \"glu32.lib\")\n\nint ii=0;\nint iex=0;\n\nextern \"C\"{\n   void externalDoStep() {\n\n    // your algorithm here\n       iex++;\n       cout&lt;&lt;iex&lt;&lt;\" externalDoStep \\n\";\n   }   \n}\n\nvoid doStep (void){\n    // your algorithm here\n  ii++;\n  cout&lt;&lt;ii&lt;&lt;\" doStep () is running \\n\";\n  glutPostRedisplay();\n}\n\nvoid RenderToDisplay(){\n    // your algorithm here   \n}\n\nvoid myDisplayFunction(void){\n    // your algorithm here     \n}\n\nvoid myReshapeFunction(int w, int h){\n    // your algorithm here\n}\n\nint main(){\n\n    glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGB | GLUT_DEPTH);\n    glutInitWindowSize(800, 400);\n    glutCreateWindow(\"dostep\");\n    glClearColor(0.0, 0.0, 0.0, 1.0);\n    glLineWidth(3);\n\n    glutDisplayFunc( myDisplayFunction );\n    glutReshapeFunc( myReshapeFunction );\n    glutIdleFunc( doStep );\n    glutMainLoop();\n\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6751355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45bc78ddf212b5407c0718f4141e4c4f?s=128&d=identicon&r=PG&f=1", "display_name": "Michael O", "link": "https://stackoverflow.com/users/6751355/michael-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1472191147, "creation_date": 1472034706, "last_edit_date": 1472191147, "question_id": 39120836, "link": "https://stackoverflow.com/questions/39120836/how-to-call-an-external-c-function-while-a-glut-display-loop-locks-my-c-main", "title": "How to call an external c-function, while a GLUT Display Loop locks my c++ main?", "body": "<p>I'm new here and not so familiar with display programming.\nI have a c-Program that calls a doStep-function every 40ms. Within this function I have C++ Code, which runs a glut display to visualize a 3D-environment. The doStep function passes new position information of my 3D Objects from outside into my C++ 3D-environment.</p>\n\n<p>The problem is, that my c-code gets locked by the glut display loop, so that I can't update the positions in the environment any more. Should I use a seperate thread for the display loop for solving this issue? \nI know that glutPostRedisplay() can be used to redraw my scene, but I don't know how to separate my display loop to maintain control of the doStep function.</p>\n\n<p>Thanks in advance</p>\n\n<hr>\n\n<p>Ok since my post was unclear and without code, I will try to specify the issue. I'm using Nvidia OptiX Raytracing for rendering a scene. The visual output is created by a GLUTDisplay class in C++. I created a separate thread for my display and detached it, so that I have further control of the program. I know that one can share a class between threads, so it was possible for me to create a separate thread for the display and calling <code>GLUTDisplay::postRedisplay();</code> in my other thread to update the context. To run my program I use 3 c-functions:</p>\n\n<pre><code>extern \"C\" {\n\nextern void* create(const char* filename, double* inputArray, double* outputArray, int argc, char** argv);\nextern void  trace(void* scene_obj);\nextern void  exitScene(void* scene_obj);\n\n}\n</code></pre>\n\n<p>Here's my implementation of them:</p>\n\n<pre><code>void * create( const char* filename, double* inputArray, double* outputArray, int argc, char** argv ){\n    OptixScene* scene = new OptixScene(filename);\n    scene-&gt;routeInput(inputArray);       //routing my inputs and outputs\n    scene-&gt;routeOutput(outputArray);     //from a simulation model\n\n    std::thread display_thread(&amp;OptixScene::createDisplayThread, scene, argc, argv); // this starts the display loop\n    display_thread.detach();    // detach display thread to get control back\n\n    return (void *)scene;\n}\n\nvoid trace( void* scene_obj ){\n    OptixScene* scene = static_cast&lt;OptixScene*&gt; (scene_obj);\n    scene-&gt;readInputs();\n    scene-&gt;updateMatrix();\n    scene-&gt;renderImage();      // GLUTDisplay::postRedisplay() in here\n    scene-&gt;writeOutputs();\n}\n\nvoid exitScene(void* scene_obj){\n    OptixScene* scene = static_cast&lt;OptixScene*&gt; (sensor);\n    try{\n        scene-&gt;cleanUp();\n        if (scene-&gt;getContext().get() != 0)\n              {\n                sutilReportError( \"Scene class failed to clean up!\" );\n                exit(2);\n              }\n        exit(0);\n    }\n    catch( Exception&amp; e ){\n        sutilReportError( e.getErrorString().c_str() );\n        exit(2);\n    } \n}\n</code></pre>\n\n<p>At the beginning I call <code>create()</code> once and then every 40ms I call <code>trace()</code> to update my scene. Is this a safe thread implementation for the dislay loop? After a while running my progam, my scene won't update itself anymore. Only if I'm moving my mouse over the window, the scene gets updated. Is this caused by my thread implementation?</p>\n"}, {"tags": ["c", "unix", "autotools"], "comments": [{"owner": {"reputation": 3489, "user_id": 1350184, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/EQnef.jpg?s=128&g=1", "display_name": "tversteeg", "link": "https://stackoverflow.com/users/1350184/tversteeg"}, "edited": false, "score": 3, "creation_date": 1472032958, "post_id": 39120108, "comment_id": 65586148, "body": "Creating a sub-directory for your (multiple) header files inside the users include directory (e.g. <code>&#47;include&#47;foo</code>) won&#39;t clutter up the directory."}, {"owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "reply_to_user": {"reputation": 3489, "user_id": 1350184, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/EQnef.jpg?s=128&g=1", "display_name": "tversteeg", "link": "https://stackoverflow.com/users/1350184/tversteeg"}, "edited": false, "score": 0, "creation_date": 1472033447, "post_id": 39120108, "comment_id": 65586459, "body": "@tversteeg That probably makes the most sense. For some reason that didn&#39;t occur to me."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 3489, "user_id": 1350184, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/EQnef.jpg?s=128&g=1", "display_name": "tversteeg", "link": "https://stackoverflow.com/users/1350184/tversteeg"}, "edited": false, "score": 0, "creation_date": 1472044139, "post_id": 39120108, "comment_id": 65593977, "body": "@tversteeg: putting user-installed headers at root-level? Very bad idea!"}, {"owner": {"reputation": 3489, "user_id": 1350184, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/EQnef.jpg?s=128&g=1", "display_name": "tversteeg", "link": "https://stackoverflow.com/users/1350184/tversteeg"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472044354, "post_id": 39120108, "comment_id": 65594152, "body": "@Olaf I meant <code>*&#47;include&#47;foo</code>, where <code>*</code> probably is <code>&#47;usr</code> or <code>&#47;usr&#47;local</code>"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 3489, "user_id": 1350184, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/EQnef.jpg?s=128&g=1", "display_name": "tversteeg", "link": "https://stackoverflow.com/users/1350184/tversteeg"}, "edited": false, "score": 0, "creation_date": 1472044645, "post_id": 39120108, "comment_id": 65594389, "body": "@tversteeg One should respect the filesystem standard on the platform."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472079718, "post_id": 39120108, "comment_id": 65613836, "body": "it does not matter how many header files are involved in the creation of the library.  When you want to access that library from user code, you only need to create a single header file that exposes all the &#39;user&#39; entry points in the library AND any data definitions that the &#39;user&#39; needs to know about."}], "owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472032763, "creation_date": 1472032763, "question_id": 39120108, "link": "https://stackoverflow.com/questions/39120108/installing-c-header-files-for-libraries-with-many-headers", "title": "Installing C header files for libraries with many headers", "body": "<p>I'm using GNU autotools to build a library (let's call it libfoo) which will probably contain lots of header files, as I use a \"one header per source file\" approach.</p>\n\n<p>If I were to use libfoo in another project, I would probably not want to include them at the granularity in which they are defined in the source, but would want to include them in larger chunks.</p>\n\n<p>My first approach to this was to make a header <code>foo.h</code> and include the other headers into that header, so a user would only have to include <code>foo.h</code>, but this would still require installing the smaller headers (thus cluttering up the users include directory), as includes in <code>foo.h</code> aren't handled during libfoo's build, but only when the header is used.</p>\n\n<p>I know I could just define everything that is part of the public API in <code>foo.h</code>, but that would result in a big cluttered header file and I prefer not to do that.</p>\n\n<p>What is the usual approach to this?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472032949, "post_id": 39120091, "comment_id": 65586142, "body": "<code>scanf(&quot;%999[^&#47;]&quot;, str);</code>"}, {"owner": {"reputation": 271, "user_id": 5681036, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ef324ef1a6f884572c6f9ef749370137?s=128&d=identicon&r=PG&f=1", "display_name": "user123", "link": "https://stackoverflow.com/users/5681036/user123"}, "reply_to_user": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472033003, "post_id": 39120091, "comment_id": 65586177, "body": "I can use it but what is the issue in this code ?"}, {"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 1, "creation_date": 1472033114, "post_id": 39120091, "comment_id": 65586242, "body": "Characters are thrown away that you entered."}, {"owner": {"reputation": 271, "user_id": 5681036, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ef324ef1a6f884572c6f9ef749370137?s=128&d=identicon&r=PG&f=1", "display_name": "user123", "link": "https://stackoverflow.com/users/5681036/user123"}, "reply_to_user": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472033161, "post_id": 39120091, "comment_id": 65586267, "body": "But why , when I am scanning correctly"}, {"owner": {"reputation": 32098, "user_id": 646887, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YJ0Ye.jpg?s=128&g=1", "display_name": "Klas Lindb&#228;ck", "link": "https://stackoverflow.com/users/646887/klas-lindb%c3%a4ck"}, "edited": false, "score": 3, "creation_date": 1472033188, "post_id": 39120091, "comment_id": 65586285, "body": "<code>getchar()</code> removes a character from the input stream."}, {"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472033288, "post_id": 39120091, "comment_id": 65586359, "body": "@user123 you don&#39;t use <code>c</code> as input."}, {"owner": {"reputation": 271, "user_id": 5681036, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ef324ef1a6f884572c6f9ef749370137?s=128&d=identicon&r=PG&f=1", "display_name": "user123", "link": "https://stackoverflow.com/users/5681036/user123"}, "reply_to_user": {"reputation": 32098, "user_id": 646887, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YJ0Ye.jpg?s=128&g=1", "display_name": "Klas Lindb&#228;ck", "link": "https://stackoverflow.com/users/646887/klas-lindb%c3%a4ck"}, "edited": false, "score": 0, "creation_date": 1472033744, "post_id": 39120091, "comment_id": 65586669, "body": "@KlasLindb&#228;ck, Thanks I got my issue resolved"}, {"owner": {"reputation": 271, "user_id": 5681036, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ef324ef1a6f884572c6f9ef749370137?s=128&d=identicon&r=PG&f=1", "display_name": "user123", "link": "https://stackoverflow.com/users/5681036/user123"}, "reply_to_user": {"reputation": 32098, "user_id": 646887, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YJ0Ye.jpg?s=128&g=1", "display_name": "Klas Lindb&#228;ck", "link": "https://stackoverflow.com/users/646887/klas-lindb%c3%a4ck"}, "edited": false, "score": 0, "creation_date": 1472037514, "post_id": 39120091, "comment_id": 65589162, "body": "@KlasLindb&#228;ck, can you please tell how to indicate the end of input without the usage of any external character ,here I have used &#39;/&#39; character,if I want to do it without any character , I used  while(!feof(stdin)) ,but it is not working ,please guide"}, {"owner": {"reputation": 32098, "user_id": 646887, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YJ0Ye.jpg?s=128&g=1", "display_name": "Klas Lindb&#228;ck", "link": "https://stackoverflow.com/users/646887/klas-lindb%c3%a4ck"}, "edited": false, "score": 0, "creation_date": 1472037680, "post_id": 39120091, "comment_id": 65589263, "body": "What do you mean by &quot;not working&quot;? Are you sending an EOF to the stream (e.g. by pressing CTRL-D in Linux or CTRL+W in Windows)?"}, {"owner": {"reputation": 271, "user_id": 5681036, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ef324ef1a6f884572c6f9ef749370137?s=128&d=identicon&r=PG&f=1", "display_name": "user123", "link": "https://stackoverflow.com/users/5681036/user123"}, "edited": false, "score": 0, "creation_date": 1472037801, "post_id": 39120091, "comment_id": 65589356, "body": "I am simply running my code on online compiler and I click on run after giving input ,so how to indicate here end on input ?"}, {"owner": {"reputation": 32098, "user_id": 646887, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YJ0Ye.jpg?s=128&g=1", "display_name": "Klas Lindb&#228;ck", "link": "https://stackoverflow.com/users/646887/klas-lindb%c3%a4ck"}, "edited": false, "score": 1, "creation_date": 1472038058, "post_id": 39120091, "comment_id": 65589537, "body": "I don&#39;t know. You would have to check the documentation for the site you are using (if there is any). Please also note that <code>feof()</code> won&#39;t return true until you have failed to read from the stream. See <a href=\"http://stackoverflow.com/questions/5431941/why-is-while-feof-file-always-wrong\" title=\"why is while feof file always wrong\">stackoverflow.com/questions/5431941/&hellip;</a>"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472047453, "post_id": 39120091, "comment_id": 65596620, "body": "&quot;,I am using &#39;/&#39; character as the end of input&quot; --&gt; not likely to work.  <code>stdin</code> if often <i>line buffered</i> so text is not given to the program until a <code>&#39;\\n&#39;</code> occurs."}], "answers": [{"tags": [], "owner": {"reputation": 37, "user_id": 5188934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1c1b77afdcd1d5a212c6a3421c8a36f?s=128&d=identicon&r=PG&f=1", "display_name": "Mehdi", "link": "https://stackoverflow.com/users/5188934/mehdi"}, "is_accepted": false, "score": 1, "last_activity_date": 1472056489, "creation_date": 1472056489, "answer_id": 39128705, "question_id": 39120091, "link": "https://stackoverflow.com/questions/39120091/how-to-print-output-in-similar-manner-as-input/39128705#39128705", "title": "How to print output in similar manner as input?", "body": "<p>Why don't you just use this? :</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint main() {\nint index=0;\nchar str[1000];\nchar c;\nwhile((c=getchar())!='/')  {\n  str[index] = c;\n  index++;\n}\nstr[index]='\\0';\nprintf(\"%s\",str);\nreturn 0;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": true, "score": 2, "last_activity_date": 1472058062, "last_edit_date": 1472058062, "creation_date": 1472057725, "answer_id": 39129055, "question_id": 39120091, "link": "https://stackoverflow.com/questions/39120091/how-to-print-output-in-similar-manner-as-input/39129055#39129055", "title": "How to print output in similar manner as input?", "body": "<p>When reading characters from <code>stdin</code>, in your case, you have <em>three</em> conditions to protect against if you want to terminate the read on <code>'/'</code>:</p>\n\n<ol>\n<li><code>index + 1 &lt; 1000</code> (to prevent overrun and preserve space for the\n<em>nul-terminating</em> char)</li>\n<li><code>(c = getchar()) != '/'</code> (your chosen terminator); and</li>\n<li><code>c != EOF</code>  (you don't want to read after <code>EOF</code> is set on the\nstream)</li>\n</ol>\n\n<p>Putting those pieces together, you could simply do:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n#define MAXC 1000   /* define a constant (macro) for max chars */\n\nint main (void) {\n\n    int c, idx = 0;\n    char str[MAXC] = \"\";    /* initialize your array (good practice) */\n\n    /* read each char up to MAXC (-2) chars, stop on '/' or EOF */\n    while (idx + 1 &lt; MAXC &amp;&amp; (c = getchar()) != '/' &amp;&amp; c != EOF)\n        str[idx++] = c; /* add to str */\n\n    str[idx] = 0; /* nul-terminate (optional here if array initialized, why?) */\n\n    printf (\"%s\", str);\n\n    return 0;\n}\n</code></pre>\n\n<p>(I would encourage a <code>putchar ('\\n');</code> after the <code>printf</code> (or simply add a <code>'\\n'</code> to the <em>format string</em>) to protect against input without a final POSIX <em>end-of-line</em>, e.g. in the event of a stop on <code>'/'</code>, or on reaching <code>1000</code> chars, or reading from a redirected file that does not contain a POSIX EOL)</p>\n\n<p><strong>Example Input File</strong></p>\n\n<pre><code>$ cat ../dat/captnjack.txt\nThis is a tale\nOf Captain Jack Sparrow\nA Pirate So Brave\nOn the Seven Seas.\n</code></pre>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/getchar_io &lt;../dat/captnjack.txt\nThis is a tale\nOf Captain Jack Sparrow\nA Pirate So Brave\nOn the Seven Seas.\n</code></pre>\n\n<p>Look things over and let me know if you have any questions.</p>\n"}], "owner": {"reputation": 271, "user_id": 5681036, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ef324ef1a6f884572c6f9ef749370137?s=128&d=identicon&r=PG&f=1", "display_name": "user123", "link": "https://stackoverflow.com/users/5681036/user123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 1, "accepted_answer_id": 39129055, "answer_count": 2, "score": -2, "last_activity_date": 1472058062, "creation_date": 1472032714, "last_edit_date": 1472032837, "question_id": 39120091, "link": "https://stackoverflow.com/questions/39120091/how-to-print-output-in-similar-manner-as-input", "title": "How to print output in similar manner as input?", "body": "<pre><code>#include&lt;stdio.h&gt;\nint main() {\n    int index=0;\n    char str[1000];\n    char c;\n    while((c=getchar())!='/')  {\n       while((c=getchar())!='\\n') {\n          scanf(\"%c\",&amp;str[index]);\n          index++;\n       }\n       str[index]='\\n';\n       index++;\n    }\n    str[index]='\\0';\n    printf(\"%s\",str);\n    return 0;\n}\n</code></pre>\n\n<p>I am giving input in the form of multiple lines ,and I want to display the output in similar fashion as input provided ,I am using '/' character as the end of input ,now I am not getting the output ,how to resolve this issue ? </p>\n"}, {"tags": ["c", "hashtable", "valgrind"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1472030592, "post_id": 39119249, "comment_id": 65584598, "body": "Please don&#39;t add line-numbers to code you show, it makes it hard to read, ad even harder to e.g. copy and try ourselves. Instead add e.g a comment in the code at the relevant line or lines."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472030725, "post_id": 39119249, "comment_id": 65584677, "body": "Also, you don&#39;t really need a tripple-pointer here, <a href=\"http://c2.com/cgi/wiki?ThreeStarProgrammer\" rel=\"nofollow noreferrer\">being a three-star programmer</a> is usually not a compliment. Use just a  double-pointer, and in the innermost loop you don&#39;t need to allocate each node dynamically."}, {"owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472030865, "post_id": 39119249, "comment_id": 65584750, "body": "I tried to use double pointer but program had tons of errors and didn&#39;t even compile"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472030954, "post_id": 39119249, "comment_id": 65584819, "body": "Then fix the errors? Did you actually read the error messages? Did you attempt to use the arrow operator <code>-&gt;</code> to access members of the structure instead of the dot <code>.</code>?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1472031021, "post_id": 39119249, "comment_id": 65584853, "body": "As for your Valgrind error, how do you call this function? What is the value of <code>size</code>? What is <code>LENGTH_OF_ROW</code>?"}, {"owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472031032, "post_id": 39119249, "comment_id": 65584861, "body": "Yes syntax was spot on, dot everywhere but I was getting an error I think it was like this: SYSMALLOC ASSERTION something very long.. now at least the program runs and outputs a correct output. yet still got this problem.."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472031089, "post_id": 39119249, "comment_id": 65584881, "body": "That doesn&#39;t sound like a build error, but a run-time crash. That probably means you are using pointers incorrectly."}, {"owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472031121, "post_id": 39119249, "comment_id": 65584902, "body": "LENGTH OF ROW is of size 2 it is a constant. Size is a size received by user - which I use in valgrind - I start from size 1, then size 2  then size 4 then size 8 then size 16 until all data is inside the table."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1472031189, "post_id": 39119249, "comment_id": 65584944, "body": "So <code>size</code> is never really uninitialized? Is it possible to create a <a href=\"http://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable Example</a>? That would help us very much!"}, {"owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472031623, "post_id": 39119249, "comment_id": 65585245, "body": "I&#39;ve added where I receive the size and also added createTable"}, {"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 2, "creation_date": 1472032006, "post_id": 39119249, "comment_id": 65585522, "body": "<code>sscanf(argv[1], &quot;%d&quot;,(&amp;tableSize));</code> is wrong when <code>sizeof(int)  != sizeof(size_t)</code>. use <code>%zu</code> instead of <code>%d</code>."}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "reply_to_user": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472032516, "post_id": 39119249, "comment_id": 65585874, "body": "@BLUEPIXY That is probably the problem. Had OP used any flags he would have been be warned."}], "owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472031793, "creation_date": 1472030405, "last_edit_date": 1472031793, "question_id": 39119249, "link": "https://stackoverflow.com/questions/39119249/receving-valgrind-error-on-conditional-jump", "title": "Receving valgrind error on conditional jump", "body": "<p>I got this code which creates a 3D ARRAY - more like a 2D array that each cell is a pointer. I'm trying to initialize it to be <code>LENGTH_OF_ROW * SIZE * sizeof(Node)</code>.</p>\n\n<p>This is struct Node:</p>\n\n<pre><code>typedef struct Node\n{\nvoid * data;\nvoid *key;\n}Node;\n</code></pre>\n\n<p>and this is the code to creating a hash table:</p>\n\n<pre><code> Node*** createHashTable(size_t size)\n {\n Node ***hashTable = (Node***)malloc(LENGTH_OF_ROW*sizeof(Node**));\n for (int i = 0; i &lt; LENGTH_OF_ROW; i++)\n {\n    hashTable[i] = (Node**)malloc(size * sizeof(Node*));\n    for (int j = 0; j &lt; (int)size; j++)\n    {\n        hashTable[i][j] = malloc(sizeof(Node));\n        hashTable[i][j]-&gt;key = EMPTY_CELL;\n    }\n}\nreturn hashTable;\n}\n</code></pre>\n\n<p>this is the valgrind error:</p>\n\n<blockquote>\n  <p>49427== Conditional jump or move depends on uninitialised value(s)</p>\n  \n  <p>49427== at 0x4C28BCD: malloc (vg_replace_malloc.c:296)</p>\n  \n  <p>49427==   by 0x400844: createHashTable (GenericHashTable.c:40)</p>\n  \n  <p>49427==    by 0x40091B: createTable (GenericHashTable.c:57)</p>\n  \n  <p>49427==    by 0x4015E5: main (HashIntSearch.c:30)</p>\n</blockquote>\n\n<p>So an error at line 40, \nthis line:  <code>hashTable[i] = (Node**)malloc(size * sizeof(Node*));</code>\nCan't figure out why am I getting this error.</p>\n\n<p>Thanks!</p>\n\n<p>size is defined in main this way: </p>\n\n<pre><code>size_t tableSize;\nint val;\nsscanf(argv[1], \"%d\",(&amp;tableSize));\nsscanf(argv[2], \"%d\", &amp;val);\n// Creating a table with addresses of functions.\nTableP table = createTable(tableSize, &amp;cloneInt, &amp;freeInt, &amp;intFcn,\n                                        &amp;intPrint, &amp;intPrint, &amp;intCompare);\n</code></pre>\n\n<p>this is createTable:</p>\n\n<pre><code>TableP createTable(size_t tableSize, CloneKeyFcn cloneKey, FreeKeyFcn   freeKey\n , HashFcn hfun, PrintKeyFcn printKeyFun, PrintDataFcn printDataFun\n, ComparisonFcn fcomp)\n{\nTableP table = (TableP)malloc(sizeof(Table));\ntable-&gt;multiplicity = 1;\ntable-&gt;originalSize = tableSize;\ntable-&gt;currentSize = tableSize;\ntable-&gt;hashTable = createHashTable(tableSize);\ntable-&gt;cloner = cloneKey;\ntable-&gt;freer = freeKey;\ntable-&gt;hash = hfun;\ntable-&gt;keyPrinter = printKeyFun;\ntable-&gt;dataPrinter = printDataFun;\ntable-&gt;comparer = fcomp;\nreturn table;\n}\n</code></pre>\n\n<p>I'm running valgrind with size 1 </p>\n"}, {"tags": ["c", "printf", "scanf"], "comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 7, "creation_date": 1472030512, "post_id": 39119235, "comment_id": 65584542, "body": "Your code is absolutely riddled with <i>undefined behaviour</i>: it works by accident. A good answer will be quite a long one. Let&#39;s wait for it."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1472030596, "post_id": 39119235, "comment_id": 65584600, "body": "The very fitst line is not valid C. It&#39;s hard to reason about subsequent lines because of that."}, {"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 4, "creation_date": 1472031479, "post_id": 39119235, "comment_id": 65585151, "body": "Voting to close, as paying attention to compiler warnings would have obviated the need for this question entirely."}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1472032388, "post_id": 39119235, "comment_id": 65585791, "body": "It&#39;s hard to believe that the first line even compiles."}], "answers": [{"comments": [{"owner": {"reputation": 2203, "user_id": 6137423, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O1Rfu.jpg?s=128&g=1", "display_name": "AhmadWabbi", "link": "https://stackoverflow.com/users/6137423/ahmadwabbi"}, "edited": false, "score": 0, "creation_date": 1472030716, "post_id": 39119288, "comment_id": 65584673, "body": "<code>char *string = &quot;default&quot;;</code> would be more correct. The assignment changes the pointer and the allocated 20 chars become inaccessible. The program works in both cases, though."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 2203, "user_id": 6137423, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O1Rfu.jpg?s=128&g=1", "display_name": "AhmadWabbi", "link": "https://stackoverflow.com/users/6137423/ahmadwabbi"}, "edited": false, "score": 3, "creation_date": 1472030823, "post_id": 39119288, "comment_id": 65584731, "body": "@AhmadWabbi Have you tried it?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1472030877, "post_id": 39119288, "comment_id": 65584757, "body": "Your syntax for declaring an array of character is incorrect. You should also use the <code>&quot;%19s&quot;</code> format for <code>scanf</code> to not write out of bounds of the array."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1472030942, "post_id": 39119288, "comment_id": 65584805, "body": "@JoachimPileborg will it make <code>scanf</code> more likely to succeed, or less?"}, {"owner": {"reputation": 4751, "user_id": 5649326, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/a82Se.jpg?s=128&g=1", "display_name": "Marievi", "link": "https://stackoverflow.com/users/5649326/marievi"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472030956, "post_id": 39119288, "comment_id": 65584820, "body": "@JoachimPileborg I forgot about that, sorry. Edited, thanks."}, {"owner": {"reputation": 2203, "user_id": 6137423, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O1Rfu.jpg?s=128&g=1", "display_name": "AhmadWabbi", "link": "https://stackoverflow.com/users/6137423/ahmadwabbi"}, "edited": false, "score": 0, "creation_date": 1472030979, "post_id": 39119288, "comment_id": 65584828, "body": "Ah, and you are doing a <code>scanf</code> into <code>string</code>! You are using the storage of the constant string. This is wrong"}, {"owner": {"reputation": 4751, "user_id": 5649326, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/a82Se.jpg?s=128&g=1", "display_name": "Marievi", "link": "https://stackoverflow.com/users/5649326/marievi"}, "reply_to_user": {"reputation": 2203, "user_id": 6137423, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O1Rfu.jpg?s=128&g=1", "display_name": "AhmadWabbi", "link": "https://stackoverflow.com/users/6137423/ahmadwabbi"}, "edited": false, "score": 0, "creation_date": 1472031025, "post_id": 39119288, "comment_id": 65584854, "body": "@AhmadWabbi but this is what the OP wants to do. He wants to read on the same storage."}, {"owner": {"reputation": 2203, "user_id": 6137423, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O1Rfu.jpg?s=128&g=1", "display_name": "AhmadWabbi", "link": "https://stackoverflow.com/users/6137423/ahmadwabbi"}, "edited": false, "score": 0, "creation_date": 1472031724, "post_id": 39119288, "comment_id": 65585314, "body": "@Marievi You are right"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472047640, "post_id": 39119288, "comment_id": 65596767, "body": "Yes, OP code is messed up, but &quot;<code>string</code> as a single character but you fill it with a string&quot;.  Instead <code>string</code> is assigned a narrowed version of the address of the string literal.  <i>That</i> is not UB."}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 1, "creation_date": 1472063203, "post_id": 39119288, "comment_id": 65606484, "body": "People have strong feelings about <code>gets()</code>, but when an answer with <code>scanf(&quot;%s&quot;, string);</code> comes up, they be upvotin. SMH."}], "tags": [], "owner": {"reputation": 4751, "user_id": 5649326, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/a82Se.jpg?s=128&g=1", "display_name": "Marievi", "link": "https://stackoverflow.com/users/5649326/marievi"}, "is_accepted": true, "score": 3, "last_activity_date": 1472031093, "last_edit_date": 1472031093, "creation_date": 1472030517, "answer_id": 39119288, "question_id": 39119235, "link": "https://stackoverflow.com/questions/39119235/why-is-the-operator-used-after-using-scanf/39119288#39119288", "title": "Why is the &amp; operator used after using scanf?", "body": "<p>You have declared <code>string</code> as a single character but you fill it with a string. This invokes undefined behavior. You should change your code to :</p>\n\n<pre><code>char string [20] = \"default\";   //20 is random, you should use the maximum length of the input you may have\nprintf(\"The default String is: %19s\", string);\nscanf(\"%s\", string);\nprintf(\"You entered: %s\", string);\n</code></pre>\n\n<hr>\n\n<p>In general, <code>scanf</code> needs to take a memory address as an argument, and in the code above, <code>string</code> is  a memory address. You can read more about <code>scanf</code> in <a href=\"http://www.tutorialspoint.com/c_standard_library/c_function_scanf.htm\" rel=\"nofollow\">this link</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 1, "creation_date": 1472031191, "post_id": 39119480, "comment_id": 65584946, "body": "<code>strcpy(string, &quot;default&quot;);</code> is not necessary; <code>char string[20] = &quot;default&quot;;</code> will work just as well."}, {"owner": {"reputation": 2203, "user_id": 6137423, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O1Rfu.jpg?s=128&g=1", "display_name": "AhmadWabbi", "link": "https://stackoverflow.com/users/6137423/ahmadwabbi"}, "reply_to_user": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1472031317, "post_id": 39119480, "comment_id": 65585037, "body": "@user694733 No. Please read my comments with Marievi"}, {"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 1, "creation_date": 1472031386, "post_id": 39119480, "comment_id": 65585083, "body": "I saw your comment. It&#39;s incorrect. <code>char string[20]</code> is an array, and <code>= &quot;default&quot;</code> is valid initializer for it. N1570 6.7.9 p14: <i>&quot;An array of character type may be initialized by a character string literal or UTF \u22128 string literal, optionally enclosed in braces. Successive bytes of the string literal (including the terminating null character if there is room or if the array is of unknown size) initialize the elements of the array.&quot;</i>"}, {"owner": {"reputation": 2203, "user_id": 6137423, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O1Rfu.jpg?s=128&g=1", "display_name": "AhmadWabbi", "link": "https://stackoverflow.com/users/6137423/ahmadwabbi"}, "reply_to_user": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1472031566, "post_id": 39119480, "comment_id": 65585210, "body": "@user694733 You are right. I double checked. The initializer copies. It is not a pointer assignment. So, no need for <code>strcpy</code>, the assignment would be enough"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1472047753, "post_id": 39119480, "comment_id": 65596864, "body": "19 in <code>&quot;The default String is: %19s&quot;</code> serves little value.  Missing 19 from <code>scanf(&quot;%s&quot;, string);</code> is as bad as <code>gets(string);</code>."}], "tags": [], "owner": {"reputation": 2203, "user_id": 6137423, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O1Rfu.jpg?s=128&g=1", "display_name": "AhmadWabbi", "link": "https://stackoverflow.com/users/6137423/ahmadwabbi"}, "is_accepted": false, "score": 0, "last_activity_date": 1472113718, "last_edit_date": 1472113718, "creation_date": 1472031110, "answer_id": 39119480, "question_id": 39119235, "link": "https://stackoverflow.com/questions/39119235/why-is-the-operator-used-after-using-scanf/39119480#39119480", "title": "Why is the &amp; operator used after using scanf?", "body": "<p>This would be a solution:</p>\n\n<pre><code>char string[20];\nstrcpy(string, \"default\");  \nprintf(\"The default String is: %s\", string);\nscanf(\"%19s\", string);\nprintf(\"You entered: %s\", string);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472048263, "post_id": 39119505, "comment_id": 65597218, "body": "Although uncommon, after <code>fgets()</code>, <code>string[0]</code> may be 0 and <code>l = strlen(s); s[l-1]</code> is a problem.  Defensive coding insures the first character after <code>fgets()</code> was not a user entered null character."}], "tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": false, "score": 1, "last_activity_date": 1472058461, "last_edit_date": 1472058461, "creation_date": 1472031186, "answer_id": 39119505, "question_id": 39119235, "link": "https://stackoverflow.com/questions/39119235/why-is-the-operator-used-after-using-scanf/39119505#39119505", "title": "Why is the &amp; operator used after using scanf?", "body": "<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nchar chomp(char* s, char c){\n    size_t l = strlen(s);\n    if (!l) return 0;\n    return s[l-1] = s[l-1]==c ? '\\0' : s[l-1];\n}\n\nint main(){\n    char string[] = \"default\"; /* sizeof(string) == strlen(\"default\")+1 */\n    printf(\"The default String is: %s\\n\", string); \n    //^ you want the array to decay to a char* here\n    /*scanf(\"%s\", &amp;string); -- DANGEROUS \n    -- scanf doesn't know how much space you have in string*/\n\n    fgets(string /*decay again*/,  sizeof(string), stdin);\n    /* fgets does know because you've told it with sizeof(string)*/\n\n    chomp(string, '\\n');\n    printf(\"You entered: %s\", string);\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 3647078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f045a4d8d777d93f560b90d0460afce?s=128&d=identicon&r=PG&f=1", "display_name": "John K", "link": "https://stackoverflow.com/users/3647078/john-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "closed_date": 1472314576, "accepted_answer_id": 39119288, "answer_count": 3, "score": -6, "last_activity_date": 1472113718, "creation_date": 1472030377, "last_edit_date": 1472035217, "question_id": 39119235, "link": "https://stackoverflow.com/questions/39119235/why-is-the-operator-used-after-using-scanf", "closed_reason": "Not suitable for this site", "title": "Why is the &amp; operator used after using scanf?", "body": "<pre><code>char string = \"default\";\nprintf(\"The default String is: %s\", &amp;string);\nscanf(\"%s\", &amp;string);\nprintf(\"You entered: %s\", &amp;string);\n</code></pre>\n\n<p>The first printf statement prints out &amp;string as <code>X(?_?</code>. The second printf, after the scanf statement prints out the string I entered.</p>\n\n<p>Since the &amp;var operator means \"memory address of var\", then why does &amp;string print out the string entered? Why do I get a segmentation fault, when I attempt to use just \"string\"?</p>\n"}, {"tags": ["c", "linux"], "owner": {"reputation": 841, "user_id": 4531806, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/A5fAL.jpg?s=128&g=1", "display_name": "Nikhil Utane", "link": "https://stackoverflow.com/users/4531806/nikhil-utane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1472030009, "creation_date": 1472030009, "question_id": 39119117, "link": "https://stackoverflow.com/questions/39119117/sigill-because-of-when-the-system-has-trouble-running-the-handler-for-a-signal", "title": "SIGILL because of &quot;when the system has trouble running the handler for a signal&quot;", "body": "<p>This is about a different SIGILL issue than what I had raised earlier <a href=\"https://stackoverflow.com/questions/39010931/debugging-a-nasty-sigill-crash-text-segment-corruption\">here</a>.<br>\nI understand the various reasons that can lead to a SIGILL and I have ruled out all of them except one that is mentioned <a href=\"https://www.gnu.org/software/libc/manual/html_node/Program-Error-Signals.html\" rel=\"nofollow\">here</a>, which is,\n\"when the system has trouble running the handler for a signal\".  Can somebody explain in what scenario can this occur? Where in the kernel can I see this code?</p>\n\n<p>I have ruled out all other cases by looking at the instruction that was being executed when SIGILL was received. It is a harmless move register (mr) instruction. The stack frame is all proper with valid values of pc, sp, lr. Thanks.</p>\n"}, {"tags": ["c", "char"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 7, "creation_date": 1472029799, "post_id": 39119000, "comment_id": 65584057, "body": "Try that <a href=\"http://en.cppreference.com/w/c/io/fscanf\" rel=\"nofollow noreferrer\"><code>scanf</code></a> call, and give some non-integer input. Check what <a href=\"http://en.cppreference.com/w/c/io/fscanf\" rel=\"nofollow noreferrer\"><code>scanf</code></a> <b><i>returns</i></b>."}, {"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 0, "creation_date": 1472029871, "post_id": 39119000, "comment_id": 65584101, "body": "Try <code>printf(&quot;Input: %d\\n&quot;, scanf(&quot;%d&quot;, &amp;a));</code>"}, {"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 2, "creation_date": 1472029927, "post_id": 39119000, "comment_id": 65584142, "body": "If you want to distinguish letters, then it&#39;s not a good idea to read them into an <code>int</code>..."}, {"owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "edited": false, "score": 1, "creation_date": 1472029974, "post_id": 39119000, "comment_id": 65584174, "body": "Can you give some sample inputs and expected outputs."}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 2, "creation_date": 1472029977, "post_id": 39119000, "comment_id": 65584177, "body": "<code>%d</code> always reads an <code>int</code>, never a character. There&#39;s no &quot;alphabet&quot; type in C"}, {"owner": {"reputation": 4703, "user_id": 5375464, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3292ca87ff6c766b75dbe4b2ea0831da?s=128&d=identicon&r=PG&f=1", "display_name": "J...S", "link": "https://stackoverflow.com/users/5375464/j-s"}, "reply_to_user": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472231499, "post_id": 39119000, "comment_id": 65685314, "body": "@Oliver Tell me about a better way."}], "answers": [{"tags": [], "owner": {"reputation": 3483, "user_id": 3932569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1bca364f93a9dfab17419b31a8a1a504?s=128&d=identicon&r=PG&f=1", "display_name": "Garf365", "link": "https://stackoverflow.com/users/3932569/garf365"}, "is_accepted": false, "score": 1, "last_activity_date": 1472030910, "last_edit_date": 1472030910, "creation_date": 1472030564, "answer_id": 39119313, "question_id": 39119000, "link": "https://stackoverflow.com/questions/39119000/distinguish-between-a-letter-and-integer-in-c/39119313#39119313", "title": "Distinguish between a letter and integer in C", "body": "<p>You don't have to distinguish it after <code>scanf</code> because it had already distinguished it:</p>\n\n<ul>\n<li><code>%d</code> only input integer, so you just can enter integer => if you write 9, you will store 9 inside variable. You <em>can't</em> read character with this (<a href=\"http://ideone.com/pzQDJ8\" rel=\"nofollow\">demo</a>). Also, if you input 97, it will store 97 inside variable, which also correspond to code associated to a</li>\n<li><code>%c</code> only input character => if you write 9, you will store associated code of character 9, <em>ie</em> 57</li>\n</ul>\n\n<p>You can check return of <code>scanf</code> to know if it succeed read something or not. </p>\n\n<p>So, if user can input both character and letter, <em>a possible solution</em> is to acquire only character with <code>%c</code> and to recreate integer during typing of user:</p>\n\n<pre><code>int i = 0;\nint dec = 1;\nchar c;\nscanf(\"%c\", &amp;c);\nif (c &gt;= '0' &amp;&amp; c &lt;= '9')\n{\n    i += c*dec;\n    dec *= 10;\n}\nelse\n{\n    // manage letter\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "is_accepted": true, "score": 2, "last_activity_date": 1472031113, "last_edit_date": 1472031113, "creation_date": 1472030717, "answer_id": 39119369, "question_id": 39119000, "link": "https://stackoverflow.com/questions/39119000/distinguish-between-a-letter-and-integer-in-c/39119369#39119369", "title": "Distinguish between a letter and integer in C", "body": "<p>Check the return value of <code>scanf()</code></p>\n\n<pre><code>int val;\nint chk = sscanf(\"a\", \"%d\", &amp;val);\nif (chk == 1) /* all ok */;\nif (chk == 0) /* no assignments */;\nif (chk == EOF) /* error */;\n</code></pre>\n\n<p>or</p>\n\n<pre><code>int val;\nint chk = sscanf(\"97\", \"%d\", &amp;val);\nif (chk == 1) /* all ok */;\nif (chk == 0) /* no assignments */;\nif (chk == EOF) /* error */;\n</code></pre>\n\n<p>or</p>\n\n<pre><code>int val1, val2, val3;\nint chk = sscanf(\"97 b 99\", \"%d%d%d\", &amp;val1, &amp;val2, &amp;val3);\nif (chk == 3) /* all ok */;\nif (chk == 2) /* only val1 and val2 were assigned a value */;\nif (chk == 1) /* only val1 was assigned a value */;\nif (chk == 0) /* no assignments */;\nif (chk == EOF) /* error */;\n</code></pre>\n"}], "owner": {"reputation": 4703, "user_id": 5375464, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3292ca87ff6c766b75dbe4b2ea0831da?s=128&d=identicon&r=PG&f=1", "display_name": "J...S", "link": "https://stackoverflow.com/users/5375464/j-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 0, "accepted_answer_id": 39119369, "answer_count": 2, "score": 1, "last_activity_date": 1472031113, "creation_date": 1472029697, "question_id": 39119000, "link": "https://stackoverflow.com/questions/39119000/distinguish-between-a-letter-and-integer-in-c", "title": "Distinguish between a letter and integer in C", "body": "<p>Please note that I'm NOT trying to distinguish between a single digit and a letter (or other character) as done by functions like isalpha() in ctype.h</p>\n\n<p>I'm trying to distinguish between an integer and an alphabet.</p>\n\n<p>The problem is that an alphabet is also treated as an integer in C and I can't think of a way out.</p>\n\n<p>eg: if input is\n         the letter a,\n    it is the same as 'a' which is the integer 97.</p>\n\n<p>And I need to find if 'a' or 97 was the input.</p>\n\n<p>I tried to do this and realised it simply couldn't work.</p>\n\n<pre><code>int a;\nscanf(\"%d\", &amp;a);\nif( (a&gt;='A' &amp;&amp; a&lt;='Z') || (a&gt;='a' &amp;&amp; a&lt;='z') )\n{\n   printf(\"\\nAlphabet\");\n}\n</code></pre>\n"}, {"tags": ["c", "pointers", "clone"], "comments": [{"owner": {"reputation": 70686, "user_id": 11683, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d4d284c3c214d52f004df795aee394e3?s=128&d=identicon&r=PG", "display_name": "GSerg", "link": "https://stackoverflow.com/users/11683/gserg"}, "edited": false, "score": 1, "creation_date": 1472027539, "post_id": 39118218, "comment_id": 65582680, "body": "You allocate memory for an <code>int</code> and store <code>*i</code> there?"}, {"owner": {"reputation": 1513, "user_id": 5784052, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e6139e7c726eceed5250789e18427768?s=128&d=identicon&r=PG&f=1", "display_name": "Eyzuky", "link": "https://stackoverflow.com/users/5784052/eyzuky"}, "reply_to_user": {"reputation": 70686, "user_id": 11683, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d4d284c3c214d52f004df795aee394e3?s=128&d=identicon&r=PG", "display_name": "GSerg", "link": "https://stackoverflow.com/users/11683/gserg"}, "edited": false, "score": 0, "creation_date": 1472027625, "post_id": 39118218, "comment_id": 65582747, "body": "Will this work? void* cloneInt(const void* i) {     int myInt = (int*)malloc(sizeof(int));     myInt = *i;      return &amp;myInt; }"}, {"owner": {"reputation": 70686, "user_id": 11683, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d4d284c3c214d52f004df795aee394e3?s=128&d=identicon&r=PG", "display_name": "GSerg", "link": "https://stackoverflow.com/users/11683/gserg"}, "edited": false, "score": 0, "creation_date": 1472027704, "post_id": 39118218, "comment_id": 65582797, "body": "No it won&#39;t, you need to create <code>int* myInt</code>, and you need to assign it with <code>*myInt = *i</code>."}, {"owner": {"reputation": 1513, "user_id": 5784052, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e6139e7c726eceed5250789e18427768?s=128&d=identicon&r=PG&f=1", "display_name": "Eyzuky", "link": "https://stackoverflow.com/users/5784052/eyzuky"}, "edited": false, "score": 0, "creation_date": 1472027704, "post_id": 39118218, "comment_id": 65582799, "body": "And when i want to free this int, should i free(myInt) or free(*myInt)? Should i free the pointer or the int itself?"}, {"owner": {"reputation": 70686, "user_id": 11683, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d4d284c3c214d52f004df795aee394e3?s=128&d=identicon&r=PG", "display_name": "GSerg", "link": "https://stackoverflow.com/users/11683/gserg"}, "edited": false, "score": 2, "creation_date": 1472027925, "post_id": 39118218, "comment_id": 65582935, "body": "I believe you should consult <a href=\"http://stackoverflow.com/q/562303/11683\">stackoverflow.com/q/562303/11683</a> before going any further @Eyzuky."}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1472028198, "post_id": 39118218, "comment_id": 65583101, "body": "I all depends on how you designed the map. Who&#39;s responsible for allocating memory for the keys &amp; objects stored, the map or the user? And When freeing it?"}, {"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472028217, "post_id": 39118218, "comment_id": 65583115, "body": "Why does a function called <code>cloneInt</code> accept/return a pointer to <code>void</code>?"}, {"owner": {"reputation": 3483, "user_id": 3932569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1bca364f93a9dfab17419b31a8a1a504?s=128&d=identicon&r=PG&f=1", "display_name": "Garf365", "link": "https://stackoverflow.com/users/3932569/garf365"}, "reply_to_user": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1472030033, "post_id": 39118218, "comment_id": 65584216, "body": "@OliverCharlesworth OP said &quot;<i>I need to have this clone function as it is in my API for a generic implementation of a hash table</i>&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "is_accepted": true, "score": 5, "last_activity_date": 1472027913, "creation_date": 1472027913, "answer_id": 39118361, "question_id": 39118218, "link": "https://stackoverflow.com/questions/39118218/clone-void-pointer-to-int/39118361#39118361", "title": "Clone void* pointer to int", "body": "<p>This will work:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nvoid* cloneInt(const void* i)\n{\n    int *myInt = malloc(sizeof(int));\n    *myInt = *(int*)i;\n    return myInt;\n}\n\nint main(int argc, char** argv)\n{\n    int i=10;\n    int *j;\n    j = cloneInt(&amp;i);\n    printf(\"j: %d i: %d\\n\", *j, i);\n    free(j);\n}\n</code></pre>\n"}], "owner": {"reputation": 1513, "user_id": 5784052, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e6139e7c726eceed5250789e18427768?s=128&d=identicon&r=PG&f=1", "display_name": "Eyzuky", "link": "https://stackoverflow.com/users/5784052/eyzuky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 650, "favorite_count": 0, "accepted_answer_id": 39118361, "answer_count": 1, "score": 1, "last_activity_date": 1472029918, "creation_date": 1472027422, "last_edit_date": 1472029918, "question_id": 39118218, "link": "https://stackoverflow.com/questions/39118218/clone-void-pointer-to-int", "title": "Clone void* pointer to int", "body": "<p>I have this signature of a function:</p>\n\n<pre><code>void* cloneInt(const void* i);\n</code></pre>\n\n<p>This <code>int</code> represents a key for a hash function. I need to have this clone function as it is in my API for a generic implementation of a hash table (this function is a part of the int implementation, this function will be forwarded as a pointer to a function that my generic implementation will use). \nBut I am having a problem understanding: how can you clone an <code>int</code>? I need to return a pointer that will point on the same value of <code>int</code>, but a different place in the memory. This got me very much confused.</p>\n"}, {"tags": ["c", "types", "macros", "structure"], "comments": [{"owner": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "edited": false, "score": 0, "creation_date": 1472027391, "post_id": 39118122, "comment_id": 65582585, "body": "Yes. Structures are just the way memory is organized on the machine. If both structures were compiled by the same compiler on the same machine (architecture), the memory footprint will be the same and you can simply cast their pointer to one to a pointer of the other."}, {"owner": {"reputation": 1580, "user_id": 6667256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c939d82ad703536dcfc9f9eee6dd819?s=128&d=identicon&r=PG&f=1", "display_name": "Franck", "link": "https://stackoverflow.com/users/6667256/franck"}, "edited": false, "score": 0, "creation_date": 1472027542, "post_id": 39118122, "comment_id": 65582683, "body": "If you accept C++ code, you can first define a base class <code>VirtualRegisters</code>. Then if <code>STag_ABCRegisters</code> and if <code>STag_CDERegisters</code>inherits from it, you can choose the right concrete class later. The fields  <code>aaa</code> can be present in <code>VirtualRegisters</code> to avoid if else constructs or in the derived classes."}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "edited": false, "score": 0, "creation_date": 1472027550, "post_id": 39118122, "comment_id": 65582689, "body": "You did that with if statements."}, {"owner": {"reputation": 1269, "user_id": 5173316, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/n9PU5.jpg?s=128&g=1", "display_name": "Tom Doodler", "link": "https://stackoverflow.com/users/5173316/tom-doodler"}, "edited": false, "score": 2, "creation_date": 1472027565, "post_id": 39118122, "comment_id": 65582703, "body": "Why would you define exactly the same thing twice with different names and then struggle with accessing them under one name...?"}, {"owner": {"reputation": 1, "user_id": 6750805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b61535802790a2d3ae8a22089fa98fe?s=128&d=identicon&r=PG&f=1", "display_name": "Gopal", "link": "https://stackoverflow.com/users/6750805/gopal"}, "reply_to_user": {"reputation": 1269, "user_id": 5173316, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/n9PU5.jpg?s=128&g=1", "display_name": "Tom Doodler", "link": "https://stackoverflow.com/users/5173316/tom-doodler"}, "edited": false, "score": 0, "creation_date": 1472030496, "post_id": 39118122, "comment_id": 65584529, "body": "@TomDoodler - These structures are going to be used in Embedded systems, While creating structure we will be giving corresponding Hardware address also to that particular structure. For that only this thing is necessary."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 6750805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b61535802790a2d3ae8a22089fa98fe?s=128&d=identicon&r=PG&f=1", "display_name": "Gopal", "link": "https://stackoverflow.com/users/6750805/gopal"}, "edited": false, "score": 0, "creation_date": 1472031334, "post_id": 39118287, "comment_id": 65585048, "body": "Thanks for your comment, Any thing possible by using stringizing operator?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "reply_to_user": {"reputation": 1, "user_id": 6750805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b61535802790a2d3ae8a22089fa98fe?s=128&d=identicon&r=PG&f=1", "display_name": "Gopal", "link": "https://stackoverflow.com/users/6750805/gopal"}, "edited": false, "score": 1, "creation_date": 1472031434, "post_id": 39118287, "comment_id": 65585118, "body": "@Gopal The &quot;stringizing&quot; operator <code>#</code> and the concatenation operator <code>##</code> are part of the preprocessor, and can only be used in macros, and as such are a compile-time thing."}], "tags": [], "owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": false, "score": 0, "last_activity_date": 1472035691, "last_edit_date": 1472035691, "creation_date": 1472027681, "answer_id": 39118287, "question_id": 39118122, "link": "https://stackoverflow.com/questions/39118122/is-it-possible-to-access-the-different-structure-with-same-members-by-using-macr/39118287#39118287", "title": "Is it possible to access the different Structure with same members by using Macros or any other functionality at runtime?(Structure updated))", "body": "<p><sub><em>This is from a C++ perspective, you really should be more careful with those language tags if this is not what you want</em></sub></p>\n\n<p>Since C++ does not have <a href=\"https://en.wikipedia.org/wiki/Reflection_(computer_programming)\" rel=\"nofollow\">reflection</a>, it's not possible to do what you want at runtime. There are workarounds though.</p>\n\n<p>For example one workaround could be to have a common base-class for the common elements (which in your simple example seems to be all). The you could have an <a href=\"http://en.cppreference.com/w/cpp/container/unordered_map\" rel=\"nofollow\">unordered map</a> translating strings to pointers to your structure.</p>\n\n<p>Example:</p>\n\n<pre><code>struct CommonBase\n{\n    unsigned short aaa;\n    unsigned long bbb;\n    unsigned short ccc;\n    unsigned short dddd;\n};\n\nstruct ABC : CommonBase {};\nstruct DEF : CommonBase {};\n\nint main()\n{\n    std::unordered_map&lt;std::string, std::unique_ptr&lt;CommonBase&gt;&gt; items = {\n        { \"ABC\", new ABC },\n        { \"DEF\", new DEF }\n    };\n\n    std::cout &lt;&lt; \"Select item to modify (ABC or DEF): \";\n    std::string input;\n    std::cin &gt;&gt; input;\n\n    items[input]-&gt;aaa = 12;\n}\n</code></pre>\n\n<p>For members that are not common, that are unique for each respective structure, then you need to actually check like you do now and then downcast the pointer to the correct type.</p>\n\n<hr>\n\n<p>For a C solution there is none really, except to manually check like you do now.</p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 6750805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b61535802790a2d3ae8a22089fa98fe?s=128&d=identicon&r=PG&f=1", "display_name": "Gopal", "link": "https://stackoverflow.com/users/6750805/gopal"}, "edited": false, "score": 0, "creation_date": 1472030769, "post_id": 39118470, "comment_id": 65584700, "body": "Thanks for your comment, Actually this structures are used for Embedded C code, The address for the structure will be allocating manually based on the embedded Hardware. At the time I hope it might not useful. Consider address for  STag_ABCRegisters = 1000 and STag_CDERegisters = 9000."}, {"owner": {"reputation": 1, "user_id": 6750805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b61535802790a2d3ae8a22089fa98fe?s=128&d=identicon&r=PG&f=1", "display_name": "Gopal", "link": "https://stackoverflow.com/users/6750805/gopal"}, "edited": false, "score": 0, "creation_date": 1472031190, "post_id": 39118470, "comment_id": 65584945, "body": "Please update me if you have any other option like changing the structure name using stringization operator(##) (but its not helpful)."}, {"owner": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "reply_to_user": {"reputation": 1, "user_id": 6750805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b61535802790a2d3ae8a22089fa98fe?s=128&d=identicon&r=PG&f=1", "display_name": "Gopal", "link": "https://stackoverflow.com/users/6750805/gopal"}, "edited": false, "score": 1, "creation_date": 1472032967, "post_id": 39118470, "comment_id": 65586157, "body": "@Gopal, I updated my answer to address your comment. I wish you luck. As a side note, we usually don&#39;t thank each other (or we would never stop and the site&#39;s database will fill up with thankful comments). Instead, we vote up or accept answers that were helpful."}, {"owner": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "reply_to_user": {"reputation": 1, "user_id": 6750805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b61535802790a2d3ae8a22089fa98fe?s=128&d=identicon&r=PG&f=1", "display_name": "Gopal", "link": "https://stackoverflow.com/users/6750805/gopal"}, "edited": false, "score": 0, "creation_date": 1472034275, "post_id": 39118470, "comment_id": 65587022, "body": "@Gopal I reviewed your question again and added an update to my answer."}, {"owner": {"reputation": 1, "user_id": 6750805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b61535802790a2d3ae8a22089fa98fe?s=128&d=identicon&r=PG&f=1", "display_name": "Gopal", "link": "https://stackoverflow.com/users/6750805/gopal"}, "edited": false, "score": 0, "creation_date": 1472035995, "post_id": 39118470, "comment_id": 65588207, "body": "Okay @Myst, I will follow and will check with your answer. Also I updated the member type of structures. This is also required now."}], "tags": [], "owner": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "is_accepted": false, "score": 1, "last_activity_date": 1472034212, "last_edit_date": 1472034212, "creation_date": 1472028169, "answer_id": 39118470, "question_id": 39118122, "link": "https://stackoverflow.com/questions/39118122/is-it-possible-to-access-the-different-structure-with-same-members-by-using-macr/39118470#39118470", "title": "Is it possible to access the different Structure with same members by using Macros or any other functionality at runtime?(Structure updated))", "body": "<p>As I stated in my comment, structures are just the way memory is organized on the machine.</p>\n\n<p>If both structures were compiled by the same compiler on the same machine (architecture / OS), their memory footprint will be the same and you can simply cast their pointer to one to a pointer of the other.</p>\n\n<p>This, however, is not the best way to go about \"inheritance\" with C.</p>\n\n<p>At the moment, you can have something like this:</p>\n\n<pre><code>struct STag_ABCRegisters\n{\n    unsigned short aaa;\n    unsigned long bbb;\n    unsigned short ccc;\n    unsigned short dddd;\n\n} RegistersABC;\n\nstruct STag_CDERegisters\n{\n    unsigned short aaa;\n    unsigned long bbb;\n    unsigned short ccc;\n    unsigned short dddd;\n\n} RegistersCDE;\n\nmain()\n{\n    (struct STag_CDERegisters*) pdata = (struct STag_CDERegisters*)&amp;RegistersABC;\n    data-&gt;ccc = 10;\n    data-&gt;aaa = 10;\n}\n</code></pre>\n\n<p>It works, but it isn't beautiful.</p>\n\n<p>If you need two of the same, the correct way would be:</p>\n\n<pre><code>struct STag_Registers\n{\n    unsigned short aaa;\n    unsigned long bbb;\n    unsigned short ccc;\n    unsigned short dddd;\n\n};\nstruct STag_Registers RegistersABC, RegistersCDE;\n\nmain()\n{\n    struct STag_Registers * data = &amp;RegistersABC;\n    data-&gt;ccc = 10;\n    data-&gt;aaa = 10;\n}\n</code></pre>\n\n<p>If you need struct inheritance, then the \"trick\" is to have the \"parent\" placed at the head of the struct, so that the memory footprint is aligned.</p>\n\n<pre><code>struct STag_Registers\n{\n    unsigned short aaa;\n    unsigned long bbb;\n    unsigned short ccc;\n    unsigned short dddd;\n\n};\nstruct STag_RegistersExtended\n{\n    struct STag_Registers parent;\n    // ... more types\n};\n</code></pre>\n\n<p>This allows a pointer to <code>struct STag_RegistersExtended</code> to be cast as a pointer to <code>struct STag_Registers</code>, so that functions that accept a pointer to <code>struct STag_Registers</code> can also accept a pointer to <code>struct STag_RegistersExtended</code>.</p>\n\n<p>Good luck with C.</p>\n\n<h3>EDIT (answering comment)</h3>\n\n<p>If you're writing for an embedded system and you have reserved (fixed) memory addresses for the data, you could go with something such as:</p>\n\n<pre><code>typedef struct {\n    unsigned short aaa;\n    unsigned long bbb;\n    unsigned short ccc;\n    unsigned short dddd;\n} register_s;\n\n#define PTR2REG(p) ((register_s *)(p))\n#define REG_A PTR2REG(0x1000))\n#define REG_B PTR2REG(0x9000))\n\ninline void perform_work(register_s * reg)\n{\n   reg-&gt;ccc = 10;\n   // ...\n   reg-&gt;aaa = 10;\n}\n\nmain()\n{\n   perform_work(REG_A);\n   perform_work(REG_B);\n   if(REG_A-&gt;aaa == 10) // should be true\n      printf(\"work was performed\");\n}\n</code></pre>\n\n<p>You should note that struct have a memory alignment and packing order. The compiler will add padding to the struct you defined in the question, due to the <code>long</code>'s memory alignment requirements. You can <a href=\"http://www.catb.org/esr/structure-packing/\" rel=\"nofollow\">read more about struct packing here</a>.</p>\n\n<p>If your embedded system requires an exact bit / byte match (and is free from padding requirements), you should tell the complier not to add any padding. This is often done using <code>#pragma pack</code></p>\n\n<h3>EDIT 2</h3>\n\n<p>I'm not sure where the <code>type</code> in your question is derived from... but if you have a global variable with the address for the struct, you could go with:</p>\n\n<pre><code>typedef struct {\n    unsigned short aaa;\n    unsigned long bbb;\n    unsigned short ccc;\n    unsigned short dddd;\n} register_s;\n\n#define PTR2REG(p) ((register_s *)(p))\n#define REG_A PTR2REG(0x1000))\n#define REG_B PTR2REG(0x9000))\n\nregister_s * active_register = REG_A;\n\ninline void perform_work(void)\n{\n   active_register-&gt;ccc = 10;\n   // ... active_register might change\n   active_register-&gt;aaa = 10;\n}\n\nmain()\n{\n   perform_work();\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 50, "user_id": 6266963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OUL8Z.png?s=128&g=1", "display_name": "Rorschach", "link": "https://stackoverflow.com/users/6266963/rorschach"}, "is_accepted": false, "score": 0, "last_activity_date": 1518699638, "creation_date": 1518699638, "answer_id": 48807935, "question_id": 39118122, "link": "https://stackoverflow.com/questions/39118122/is-it-possible-to-access-the-different-structure-with-same-members-by-using-macr/48807935#48807935", "title": "Is it possible to access the different Structure with same members by using Macros or any other functionality at runtime?(Structure updated))", "body": "<p>Dynamic languages like python have buildin metadata table for reflection, so we just build one for help. Now it looks much like a script language.</p>\n\n<p>_Generic need C11 std to work.</p>\n\n<p>some code copied from <a href=\"https://stackoverflow.com/a/42222928/6266963\">How to save the result of typeof?</a></p>\n\n<pre><code>// some code copied from https://stackoverflow.com/questions/42222379/how-to-save-the-result-of-typeof\n// gcc -std=c11 typeid_of_test.c\n\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stddef.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;string.h&gt;\n\ntypedef struct STRU\n{\n    int32_t aaa;\n    double bbb;\n    int ccc;\n    char dddd;\n}STRU;\n\ntypedef struct Metainfo\n{\n    int     type;\n    char*   name;     //or hash\n    int  offset;\n}Metainfo;\n\nenum {TYPE_UNKNOWN, TYPE_INT, TYPE_CHAR, TYPE_DOUBLE};\n#define typeid_of(T)  _Generic((T), int: TYPE_INT, long: TYPE_INT, char: TYPE_CHAR, double: TYPE_DOUBLE, default: 0)\n\n#define META(ST_, M_) {typeid_of((__typeof__(((ST_ *)0)-&gt;M_))0), #ST_ \".\" #M_, offsetof(ST_, M_)}\n/*                    {          typeid,                             name,      offset      } */\n\nMetainfo meta[]={\n    META(STRU, aaa),\n    META(STRU, bbb),\n    META(STRU, ccc),\n    META(STRU, dddd),\n};\n\nint set_by_name(char* member_name, char* value, void* p)\n{\n    int offset=0, type=0;\n    for(int i=0; i&lt;sizeof(meta)/sizeof(Metainfo); i++)\n        if(stricmp(member_name, meta[i].name)==0) \n        {\n        offset=meta[i].offset;\n        type = meta[i].type;\n        }\n\n    switch(type)\n    {\n        case TYPE_INT:\n            *(int*)((char*)p+offset) = atoi(value);\n            break;\n        case TYPE_CHAR:\n            *(char*)((char*)p+offset) = atoi(value);\n            break;\n        case TYPE_DOUBLE:\n            *(double*)((char*)p+offset) = atof(value);\n            break;\n        default:\n        return 0;\n    }\n    return 1;\n}\n\nint main(void)\n{\n\n    for(int i=0; i&lt;sizeof(meta)/sizeof(Metainfo); i++)\n        printf(\"type:%d, name: %s, offset: %d\\n\", meta[i].type, meta[i].name, meta[i].offset);\n\n    STRU b={0};\n\n    set_by_name(\"stru.bbb\", \"3.1415926\", &amp;b);\n    printf(\"stru.bbb == %f\", b.bbb);\n\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6750805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b61535802790a2d3ae8a22089fa98fe?s=128&d=identicon&r=PG&f=1", "display_name": "Gopal", "link": "https://stackoverflow.com/users/6750805/gopal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 1, "answer_count": 3, "score": -1, "last_activity_date": 1518699638, "creation_date": 1472027150, "last_edit_date": 1500560021, "question_id": 39118122, "link": "https://stackoverflow.com/questions/39118122/is-it-possible-to-access-the-different-structure-with-same-members-by-using-macr", "title": "Is it possible to access the different Structure with same members by using Macros or any other functionality at runtime?(Structure updated))", "body": "<p>In this code contains two structures and their naming is different. Structure member naming is same but type is different. Is there any possibility to change the structure name at run time by using macros or other functionality. </p>\n\n<pre><code>typedef struct STag_ABCRegisters\n{\n    unsigned long aaa;\n    unsigned long bbb;\n    unsigned long ccc;\n    unsigned long dddd;\n\n}RegistersABC;\ntypedef struct STag_CDERegisters\n{\n    unsigned short aaa;\n    unsigned short bbb;\n    unsigned short ccc;\n    unsigned short dddd;\n\n}RegistersCDE;\n\nmain()\n{\n    int type = 1;\n    if(type == 1)\n    {\n        RegistersABC-&gt;ccc = 10;\n    }\n    else\n    {\n        RegistersCDE-&gt;ccc = 10;\n    }\n    /* after some process again checking the type updating structure*/\n    type = 2;\n    if(type == 1)\n    {\n        RegistersABC-&gt;aaa = 10;\n    }\n    else\n    {\n        RegistersCDE-&gt;aaa = 10;\n    }\n\n}\n</code></pre>\n\n<p>I need the help for following process\nIn the above code contains complexity of if else condition.\nSo <strong>is there any possibilities for select the structure at run time??</strong>.</p>\n\n<p>See the below Pseudo code steps for your understanding </p>\n\n<pre><code>main()\n{\n\n    char type = \"ABC\";\n    Registers//type//-&gt;aaa = 10;  // Type of structure name should be  replaced here\n} \n</code></pre>\n"}, {"tags": ["c++", "c", "c-preprocessor"], "comments": [{"owner": {"reputation": 1395, "user_id": 5494601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b314d62b89eb1d5eab5f063dd0d15190?s=128&d=identicon&r=PG&f=1", "display_name": "vadikrobot", "link": "https://stackoverflow.com/users/5494601/vadikrobot"}, "edited": false, "score": 0, "creation_date": 1472027191, "post_id": 39118040, "comment_id": 65582448, "body": "How, you define OS on line 11 ? With just (for example) #define WINDOWS ? If"}, {"owner": {"reputation": 6398, "user_id": 4284627, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/2e017633cda5465e6683c74992cdec5e?s=128&d=identicon&r=PG", "display_name": "Donald Duck", "link": "https://stackoverflow.com/users/4284627/donald-duck"}, "reply_to_user": {"reputation": 1395, "user_id": 5494601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b314d62b89eb1d5eab5f063dd0d15190?s=128&d=identicon&r=PG&f=1", "display_name": "vadikrobot", "link": "https://stackoverflow.com/users/5494601/vadikrobot"}, "edited": false, "score": 0, "creation_date": 1472027255, "post_id": 39118040, "comment_id": 65582492, "body": "@vadikrobot I define OS on line 11 means that line 11 in my program contains for example <code>#define WINDOWS</code>."}, {"owner": {"reputation": 1395, "user_id": 5494601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b314d62b89eb1d5eab5f063dd0d15190?s=128&d=identicon&r=PG&f=1", "display_name": "vadikrobot", "link": "https://stackoverflow.com/users/5494601/vadikrobot"}, "edited": false, "score": 0, "creation_date": 1472027339, "post_id": 39118040, "comment_id": 65582553, "body": "And if this line is absent, you would like to see an error on this line ?"}, {"owner": {"reputation": 6398, "user_id": 4284627, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/2e017633cda5465e6683c74992cdec5e?s=128&d=identicon&r=PG", "display_name": "Donald Duck", "link": "https://stackoverflow.com/users/4284627/donald-duck"}, "reply_to_user": {"reputation": 1395, "user_id": 5494601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b314d62b89eb1d5eab5f063dd0d15190?s=128&d=identicon&r=PG&f=1", "display_name": "vadikrobot", "link": "https://stackoverflow.com/users/5494601/vadikrobot"}, "edited": false, "score": 0, "creation_date": 1472027452, "post_id": 39118040, "comment_id": 65582626, "body": "@vadikrobot The program isn&#39;t supposed to be shorter than that number of lines. If that line contains something else, I would like it to put the error there anyway, since it&#39;s not supposed to contain anything else."}, {"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 0, "creation_date": 1472027507, "post_id": 39118040, "comment_id": 65582664, "body": "Your logic i backward, Donald Duck.    Your code is testing if the macro is NOT defined, so the <code>#error</code> will never activate if it is."}, {"owner": {"reputation": 6398, "user_id": 4284627, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/2e017633cda5465e6683c74992cdec5e?s=128&d=identicon&r=PG", "display_name": "Donald Duck", "link": "https://stackoverflow.com/users/4284627/donald-duck"}, "reply_to_user": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 0, "creation_date": 1472027616, "post_id": 39118040, "comment_id": 65582740, "body": "@Peter That&#39;s exactly what I want. If the macro <code>WINDOWS</code>, <code>UNIX</code> or <code>MAC</code> is defined, it&#39;s OK since my program is for one of these. If none is defined, there is a problem, so that&#39;s when I want there to be an error."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1472027746, "post_id": 39118040, "comment_id": 65582829, "body": "<code>#define PI 3.14159265</code> Here, I have defined an OS. <code>#define NDEBUG</code> here&#39;s another one. <code>#define BIG_ENDIAN 0x1234</code> and another one."}, {"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 0, "creation_date": 1472027750, "post_id": 39118040, "comment_id": 65582833, "body": "You&#39;re missing the point.   If they are NOT defined, the typical use case is that there is NO place where they have been defined.   It is not possible to report where something was defined if it is not defined."}, {"owner": {"reputation": 1395, "user_id": 5494601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b314d62b89eb1d5eab5f063dd0d15190?s=128&d=identicon&r=PG&f=1", "display_name": "vadikrobot", "link": "https://stackoverflow.com/users/5494601/vadikrobot"}, "edited": false, "score": 1, "creation_date": 1472028053, "post_id": 39118040, "comment_id": 65583010, "body": "@DonaldDuck If I understand you want, show an error on line 11, if there is now defined macros."}, {"owner": {"reputation": 6398, "user_id": 4284627, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/2e017633cda5465e6683c74992cdec5e?s=128&d=identicon&r=PG", "display_name": "Donald Duck", "link": "https://stackoverflow.com/users/4284627/donald-duck"}, "reply_to_user": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 0, "creation_date": 1472028064, "post_id": 39118040, "comment_id": 65583015, "body": "@Peter That specific line is the line where the OS should be defined (the previous line contains a comment explaining that) and since it&#39;s my code, I know that that&#39;s where the OS should be defined. The main reason why I want to do this is in case I make a typing mistake which I don&#39;t notice (for example write <code>WINDDOWS</code> instead of <code>WINDOWS</code>). That would do so that I don&#39;t have to go around looking for the error in my whole code."}, {"owner": {"reputation": 1395, "user_id": 5494601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b314d62b89eb1d5eab5f063dd0d15190?s=128&d=identicon&r=PG&f=1", "display_name": "vadikrobot", "link": "https://stackoverflow.com/users/5494601/vadikrobot"}, "edited": false, "score": 2, "creation_date": 1472028068, "post_id": 39118040, "comment_id": 65583018, "body": "@DonaldDuck Try this. #ifndef WINDOWS #ifndef UNIX #ifndef MAC #line 11 #error &quot;OS must be WINDOWS, UNIX or MAC&quot; #endif #endif #endif"}, {"owner": {"reputation": 6398, "user_id": 4284627, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/2e017633cda5465e6683c74992cdec5e?s=128&d=identicon&r=PG", "display_name": "Donald Duck", "link": "https://stackoverflow.com/users/4284627/donald-duck"}, "reply_to_user": {"reputation": 1395, "user_id": 5494601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b314d62b89eb1d5eab5f063dd0d15190?s=128&d=identicon&r=PG&f=1", "display_name": "vadikrobot", "link": "https://stackoverflow.com/users/5494601/vadikrobot"}, "edited": false, "score": 0, "creation_date": 1472028310, "post_id": 39118040, "comment_id": 65583171, "body": "@vadikrobot Thanks, that worked to add <code>#line 11</code> before the <code>#error</code> (even though everything shouldn&#39;t be on the same line). You can post that as an answer so that I can accept it."}], "answers": [{"tags": [], "owner": {"reputation": 69264, "user_id": 256138, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ed9e8c0ff767e38f8fade11f5af00a45?s=128&d=identicon&r=PG", "display_name": "rubenvb", "link": "https://stackoverflow.com/users/256138/rubenvb"}, "is_accepted": false, "score": 2, "last_activity_date": 1472027155, "creation_date": 1472027155, "answer_id": 39118124, "question_id": 39118040, "link": "https://stackoverflow.com/questions/39118040/make-a-preprocessor-error-at-a-specific-line/39118124#39118124", "title": "Make a preprocessor error at a specific line", "body": "<p>The preprocessor is quite simple. The only option you have here is including the line number in the error message. Because if you <code>#define</code> that number elsewhere, how are you sure that this <code>#define</code> was even processed, as this scenario misses other definitions (the OS you're checking for). Additionally, there's no way you can define all three macros on the same line number, unless you have separate headers for each of these things, which seems like a very fragile system. Bottom line is you can't figure out where something should be defined if it was never defined in the first place.</p>\n\n<p>If this is pure C++, there are better ways to handle this than defines. <code>constexpr</code> and <code>static_assert</code>s comes to mind, and using standard facilities like <a href=\"http://www.boost.org/doc/libs/1_61_0/libs/predef/doc/html/index.html\" rel=\"nofollow\">Boost.Predef</a> seem like a better idea than manually defining these things.</p>\n"}, {"tags": [], "owner": {"reputation": 1395, "user_id": 5494601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b314d62b89eb1d5eab5f063dd0d15190?s=128&d=identicon&r=PG&f=1", "display_name": "vadikrobot", "link": "https://stackoverflow.com/users/5494601/vadikrobot"}, "is_accepted": true, "score": 3, "last_activity_date": 1472028539, "creation_date": 1472028539, "answer_id": 39118589, "question_id": 39118040, "link": "https://stackoverflow.com/questions/39118040/make-a-preprocessor-error-at-a-specific-line/39118589#39118589", "title": "Make a preprocessor error at a specific line", "body": "<p>If you would like to show an error on specific line if there is no defined macros on your code, try to use <strong>#line</strong></p>\n\n<pre><code>1 #ifndef UNIX\n2 #ifndef MAC\n3 #line 11 \n4 #error \"OS must be WINDOWS, UNIX or MAC\" \n5 #endif \n6 #endif \n7 #endif \n8    \n9  int main ()\n10 {\n11   // here will be error from line 4\n12 }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 0, "last_activity_date": 1472029921, "last_edit_date": 1472029921, "creation_date": 1472029278, "answer_id": 39118870, "question_id": 39118040, "link": "https://stackoverflow.com/questions/39118040/make-a-preprocessor-error-at-a-specific-line/39118870#39118870", "title": "Make a preprocessor error at a specific line", "body": "<p>You might be able to do what you want (nothing can be guaranteed however) if you change your logic.</p>\n\n<p>The C preprocessor has no idea which macro names an OS and which names somwthing else. There is no way to catch a macro that you think names some OS other than the three you can handle. Instead of many possible macro names, use one macro with many possible values. Now when you see a value you cannot handle, you may be able to do something.</p>\n\n<pre><code> #define WINDOWS 1002437 // a random magic number\n #define UNIX 2753321\n ...\n\n #define OS UNIX\n\n ...\n\n #if OS == WINDOWS\n   ...\n #elseif OS == UNIX\n   ...\n #elseif ...\n  ...\n #else // here comes the trick\n    #define OS 99997321\n    #error \"Bad OS\"\n #endif\n</code></pre>\n\n<p>If a macro is defined, many compilers will warn you about its redefinition, and say exactly where the first definition may be found. This is not guaranteed however. </p>\n\n<p>Of course if OS is never defined, there is no even a theoretical possibility to pinpoint the place where it is <em>not</em> defined. If you know where it <em>should be</em> defined, you can use <code>__LINE__</code> and <code>__FILE__</code> directives to direct the compiler to that place:</p>\n\n<pre><code>    #line 11\n    #error \"OS should be defined here\"\n</code></pre>\n\n<p>In real software however such macros are normally defined by the compiler command line, and controlled by your makefile or equivalent.</p>\n\n<pre><code>   CPPFLAGS += \"-DOS=$(OS_ID)\"\n</code></pre>\n\n<p>so there's no place in the source code that can be blamed for an error.</p>\n"}], "owner": {"reputation": 6398, "user_id": 4284627, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/2e017633cda5465e6683c74992cdec5e?s=128&d=identicon&r=PG", "display_name": "Donald Duck", "link": "https://stackoverflow.com/users/4284627/donald-duck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 39118589, "answer_count": 3, "score": 0, "last_activity_date": 1472203767, "creation_date": 1472026873, "last_edit_date": 1472203767, "question_id": 39118040, "link": "https://stackoverflow.com/questions/39118040/make-a-preprocessor-error-at-a-specific-line", "title": "Make a preprocessor error at a specific line", "body": "<p>I'm making a cross-platform program for Windows, Unix and Mac. To be able to use things that are specific for each OS, I use a <code>#define</code>, for example when I'm compiling for Windows, I use <code>#define WINDOWS</code>. To make sure not to define an OS that doesn't exist, or at least that my program doesn't support, I use this:</p>\n\n<pre><code>#ifndef WINDOWS\n#ifndef UNIX\n#ifndef MAC\n#error \"OS must be WINDOWS, UNIX or MAC\"\n#endif\n#endif\n#endif\n</code></pre>\n\n<p>When I define an invalid OS, is gives me an error as it should, but it puts the red rectangle that means error in front of the <code>#error</code> line. I would like to put it in front of the line where I defined the OS. For example, if I'm supposed to define the OS on line 11, I would like it to send me to line 11. Is there a way to do this?</p>\n"}, {"tags": ["c", "multithreading"], "answers": [{"comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472026340, "post_id": 39117778, "comment_id": 65581886, "body": "The second problem is different from the first, the variable <code>i</code> will not go out of scope."}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472026476, "post_id": 39117778, "comment_id": 65581962, "body": "@JoachimPileborg Thanks."}, {"owner": {"reputation": 265, "user_id": 5954317, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/zeQTP.jpg?s=128&g=1", "display_name": "Casualet", "link": "https://stackoverflow.com/users/5954317/casualet"}, "edited": false, "score": 0, "creation_date": 1472028488, "post_id": 39117778, "comment_id": 65583278, "body": "Thank you\uff0cbut in the original link\uff0cthe code was like: <code>pthread_create(&amp;pids[i], NULL, thread_func, (void*)(i));</code>  and in <b>thread_func</b>, it used int <b>v = (int)arg</b>, and the result was right. Why wasn&#39;t there a data race.  Also, that code compiles using gcc, but with g++, casting from void* to int is not allowed, so how can I intergrate that piece of code with my cpp code? \uff1a\uff09"}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "reply_to_user": {"reputation": 265, "user_id": 5954317, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/zeQTP.jpg?s=128&g=1", "display_name": "Casualet", "link": "https://stackoverflow.com/users/5954317/casualet"}, "edited": false, "score": 0, "creation_date": 1472029266, "post_id": 39117778, "comment_id": 65583699, "body": "@Casualet I don&#39;t know, i haven&#39;t seen that code. Post a new question. <a href=\"https://stackoverflow.com/questions/ask\">stackoverflow.com/questions/ask</a>"}], "tags": [], "owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "is_accepted": false, "score": 5, "last_activity_date": 1472026902, "last_edit_date": 1472026902, "creation_date": 1472026084, "answer_id": 39117778, "question_id": 39117674, "link": "https://stackoverflow.com/questions/39117674/how-to-pass-arguments-when-using-pthread-create/39117778#39117778", "title": "How to pass arguments when using pthread_create", "body": "<p>In the first example, the main thread returns from the function doJob, and the object index stops existing. Then the threads try to print the values of the array index. Since the object index, doesn't exist anymore, the behavior is undefined.</p>\n\n<p>The first example would be correct if you joined with the threads before returning from the function.</p>\n\n<p>The second example is also undefined because there is a data race. The variable i is being read by multiple threads and modified by the main thread, without any synchronization.</p>\n\n<p>To fix the second example, use an array of integers, and pass each element separately to created threads.</p>\n"}, {"tags": [], "owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": false, "score": 3, "last_activity_date": 1472026296, "creation_date": 1472026296, "answer_id": 39117851, "question_id": 39117674, "link": "https://stackoverflow.com/questions/39117674/how-to-pass-arguments-when-using-pthread-create/39117851#39117851", "title": "How to pass arguments when using pthread_create", "body": "<p>The second problem is because all threads get the exact same pointer. The problem with this is that you have no control of when a threads start to run and copy the value. If the first thread doesn't start immediately and the loop creating the threads continue it will increase the variable, and once the threads starts it will see the wrong value.</p>\n\n<p>The first example have another problem, but is also related to the problem described above. The problem is that you pass pointers to something that will go out of scope. Once the <code>init_job</code> returns the array <code>index</code> will go out of scope and exist no more, and if no threads have started running yet then the pointers they will dereference will not point to what you think they are pointing.</p>\n"}, {"comments": [{"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472081710, "post_id": 39117940, "comment_id": 65614371, "body": "the call to <code>sleep()</code> is not a good idea.  Rather, in a loop, call <code>pthread_join()</code>  for each of the threads (save the thread IDs globally, so they will be available for the calls to <code>pthread_join()</code>"}], "tags": [], "owner": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "is_accepted": false, "score": 1, "last_activity_date": 1472026571, "creation_date": 1472026571, "answer_id": 39117940, "question_id": 39117674, "link": "https://stackoverflow.com/questions/39117674/how-to-pass-arguments-when-using-pthread-create/39117940#39117940", "title": "How to pass arguments when using pthread_create", "body": "<p>As previous comments mentioned, the problem is your index array is out of scope for the thread context. I'd like to offer you the following solution:</p>\n\n<pre><code>#include&lt;pthread.h&gt;\n#include&lt;unistd.h&gt;\n#include&lt;stdio.h&gt;\n#define NUM_OF_JOB 3\n\nint index[NUM_OF_JOB]={-1,-1,-1};\n\nvoid* doJob(void* arg){\n    int i = *((int*)arg);\n    printf(\"%d\\n\",i);\n}\n\nvoid init_job() {\n    pthread_t thread[NUM_OF_JOB];\n    for(int i=0;i&lt;NUM_OF_JOB;i++){\n        pthread_create(&amp;thread[i],NULL,doJob,&amp;index[i]);\n    }\n}\n\nint main(){\n    init_job();\n    sleep(1);\n    return 0;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 6757939, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/afb1561db67a585cc7704b22daa0077a?s=128&d=identicon&r=PG", "display_name": "General Disarray", "link": "https://stackoverflow.com/users/6757939/general-disarray"}, "is_accepted": false, "score": 1, "last_activity_date": 1472140279, "creation_date": 1472140279, "answer_id": 39149705, "question_id": 39117674, "link": "https://stackoverflow.com/questions/39117674/how-to-pass-arguments-when-using-pthread-create/39149705#39149705", "title": "How to pass arguments when using pthread_create", "body": "<p>You will need to block the calling thread until a local copy of data can be made. Semaphores can be useful here.</p>\n\n<pre><code>struct thread_param {\n    void * args; sem_t * ready;\n};\n\nvoid * child(void * args)\n{\n    struct thread_param * param = args;\n    /* make local copies. */\n    sem_post(param-&gt;ready);\n    /* do work. */\n    return NULL;\n}\n\nint main(int argc, char * argv)\n{\n    /* setup (semaphore and other). */\n    struct thread_param param;\n    param.ready = &amp;ready;\n\n    for (i = 0; i &lt; n; i++) {\n        param.args = &amp;i; /* or whatever. */\n        pthread_create(&amp;thread[i], &amp;attrib, child, &amp;param);\n        sem_wait(param.ready);\n    }\n    /* cleanup, join on threads. */\n    return 0;\n}\n</code></pre>\n\n<p><strong>Note:</strong> Code is untested. I apologize for any typos/errors.</p>\n"}], "owner": {"reputation": 265, "user_id": 5954317, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/zeQTP.jpg?s=128&g=1", "display_name": "Casualet", "link": "https://stackoverflow.com/users/5954317/casualet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6168, "favorite_count": 2, "answer_count": 4, "score": 1, "last_activity_date": 1472140279, "creation_date": 1472025789, "last_edit_date": 1495540865, "question_id": 39117674, "link": "https://stackoverflow.com/questions/39117674/how-to-pass-arguments-when-using-pthread-create", "title": "How to pass arguments when using pthread_create", "body": "<p>I want to create three threads and pass an integer to each of these thread. I used pthread_create, and my code is as follows.</p>\n\n<pre><code>#include&lt;pthread.h&gt;\n#include&lt;unistd.h&gt;\n#include&lt;stdio.h&gt;\n#define NUM_OF_JOB 3\n\nvoid* doJob(void* arg){\n    int i = *((int*)arg);\n    printf(\"%d\\n\",i);\n}\n\nvoid init_job() {\n    pthread_t thread[NUM_OF_JOB];\n    int index[NUM_OF_JOB]={-1,-1,-1};\n    for(int i=0;i&lt;NUM_OF_JOB;i++){\n    pthread_create(&amp;thread[i],NULL,doJob,(void*)(&amp;index[i]));\n    }\n}\n\nint main(){\n    init_job();\n    sleep(1);\n    return 0;\n}\n</code></pre>\n\n<p>I intended to pass -1 to each of the thread, but after running the code for server times, I found that it did not print three -1. Instead, they could produce strange outputs. So why is that?</p>\n\n<p>similar code can be found in \n<a href=\"https://stackoverflow.com/questions/21980722/pass-arguments-to-the-pthread-create-function\">pass arguments to the pthread_create function</a>\nI can't find anything different between his code and mine. But in his code the threads could get the expected argument.</p>\n\n<p>thank you very much\uff1a\uff09</p>\n\n<p>btw, I try to change the code from the above link a little, and run it.surprisingly, my mordified version don't produce expected results either.\uff08I think each thread should get their own unique integer as argument\uff09\nHere is my mordified code. can anyone explain that?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\n\n#define THREAD_NUM 10\n\nvoid *thread_func(void *arg)\n{\n    int v = *(int*)arg;\n\n    printf(\"v = %d\\n\", v);\n\n    return (void*)0;\n}\n\nint main(int argc, const char *argv[])\n{\n    pthread_t pids[THREAD_NUM];\n    int rv;\n    int i;\n\n    for (i = 0; i &lt; THREAD_NUM; i++) {\n        rv = pthread_create(&amp;pids[i], NULL, thread_func, (void*)(&amp;i));\n        if (rv != 0) {\n           perror(\"failed to create child thread\");\n           return 1;\n        }\n    }\n    for (i = 0; i &lt; THREAD_NUM; i++) {\n        pthread_join(pids[i], NULL);\n    }\n    return 0; \n}\n</code></pre>\n\n<p>thank you again:)</p>\n"}, {"tags": ["c", "pass-by-reference", "pass-by-value"], "comments": [{"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "edited": false, "score": 3, "creation_date": 1472025228, "post_id": 39117424, "comment_id": 65581141, "body": "C doesn&#39;t have references."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472025237, "post_id": 39117424, "comment_id": 65581152, "body": "If you want to use <a href=\"http://en.cppreference.com/w/c/io/fprintf\" rel=\"nofollow noreferrer\"><code>printf</code></a> to print a pointer, you should use the <code>&quot;%p&quot;</code> format to print a <code>void*</code> (casting is necessary)."}], "answers": [{"tags": [], "owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "is_accepted": false, "score": 2, "last_activity_date": 1472025883, "last_edit_date": 1495541696, "creation_date": 1472025211, "answer_id": 39117469, "question_id": 39117424, "link": "https://stackoverflow.com/questions/39117424/is-this-a-valid-example-of-call-by-reference-not-being-true-in-c/39117469#39117469", "title": "Is this a valid example of call by reference not being true in C?", "body": "<blockquote>\n  <p><em>If C supports call by reference,.....</em></p>\n</blockquote>\n\n<p>C has no concept of pass by reference for function argument passing. Arguments are always passed using pass by value.</p>\n\n<p>We can achieve the similar behavior of <em>pass by reference</em> through passing a pointer to the <em>object</em> and manipulating the value at address pointed by the pointer from inside the called function, but then, <strong>the pointer itself is passed by value.</strong></p>\n\n<p>That implies, if you have to change a <em>pointer</em> itself from the called function, you should be sending a pointer to the pointer variable to achieve that. Refer <a href=\"https://stackoverflow.com/a/3629118/2173917\">this answer</a> for a nice code-wise example.</p>\n"}, {"comments": [{"owner": {"reputation": 2149, "user_id": 2096401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVjii.jpg?s=128&g=1", "display_name": "TripeHound", "link": "https://stackoverflow.com/users/2096401/tripehound"}, "edited": false, "score": 2, "creation_date": 1472026914, "post_id": 39117528, "comment_id": 65582266, "body": "For the sake of this example (pointer-to-pointer ~= pointer-by-reference) you could make it <code>static int b = 50;</code> to get rid of the UB."}], "tags": [], "owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": false, "score": 2, "last_activity_date": 1472025392, "creation_date": 1472025392, "answer_id": 39117528, "question_id": 39117424, "link": "https://stackoverflow.com/questions/39117424/is-this-a-valid-example-of-call-by-reference-not-being-true-in-c/39117528#39117528", "title": "Is this a valid example of call by reference not being true in C?", "body": "<p>You are passing a pointer. This pointer is passed <em>by value</em>. I.e. the pointer itself is copied for the function. So when you make <code>ptr</code> inside the function point somewhere else, you are only changing the local copy of the pointer.</p>\n\n<p>If you want to change the value of where the pointer is pointing, you need to use the dereference operator <code>*</code>:</p>\n\n<pre><code>void changePtr(int* ptr) {\n    *ptr = 50;\n}\n</code></pre>\n\n<p>This will <em>emulate</em> pass by reference.</p>\n\n<hr>\n\n<p>If you instead pass a pointer to the pointer variable (emulating passing the pointer by reference), like the following (simplified version of your) program</p>\n\n<pre><code>void changePtr(int** ptr) {\n    int b = 50;\n    *ptr = &amp;b;\n}\n\nint main() {\n    int a = 10;\n    int* ptr = &amp;a;\n    changePtr(&amp;ptr);\n    printf(\"Value of ptr in main is %d, address is %p\\n\",*ptr, (void *) &amp;ptr);\n    return 0;\n}\n</code></pre>\n\n<p>That is actually <em>worse</em> because after the <code>changePtr</code> call the pointer is pointing to a local variable inside the <code>changePtr</code> function, a variable which have gone out of scope and no longer exists. This leads to <em>undefined behavior</em> when using the pointer.</p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 6281201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/068d9bd01df89e7f410589669abb0dc5?s=128&d=identicon&r=PG&f=1", "display_name": "Alex S.", "link": "https://stackoverflow.com/users/6281201/alex-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1472025675, "creation_date": 1472025675, "answer_id": 39117625, "question_id": 39117424, "link": "https://stackoverflow.com/questions/39117424/is-this-a-valid-example-of-call-by-reference-not-being-true-in-c/39117625#39117625", "title": "Is this a valid example of call by reference not being true in C?", "body": "<p>No, it is not. What you do is to pass the pointer (address of a) by value. When you call the function a new pointer will be created containing the value of the old pointer ptr. This value is the address of a. When you change the functions ptr the main ptr will not changed because they where not the same. They just pointed to the same element.</p>\n"}, {"tags": [], "owner": {"reputation": 19601, "user_id": 1620779, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/dlgGb.png?s=128&g=1", "display_name": "sjsam", "link": "https://stackoverflow.com/users/1620779/sjsam"}, "is_accepted": false, "score": 0, "last_activity_date": 1472027113, "creation_date": 1472027113, "answer_id": 39118110, "question_id": 39117424, "link": "https://stackoverflow.com/questions/39117424/is-this-a-valid-example-of-call-by-reference-not-being-true-in-c/39118110#39118110", "title": "Is this a valid example of call by reference not being true in C?", "body": "<p>The identifier <code>ptr</code> by alone is a pointer and is not meaningful unless you tell it what type it should point to ie</p>\n\n<pre><code>int *ptr;  //says  int &lt;- *ptr or *ptr is an integer\n</code></pre>\n\n<p>In</p>\n\n<pre><code>changePtr(ptr); // You pass pointer by value\n</code></pre>\n\n<p>and in</p>\n\n<pre><code>void changePtr(int* ptr) \n/* you caught the argument 'ptr' from main\n * using the function parameter 'ptr'\n */\n</code></pre>\n\n<p>so </p>\n\n<p><code>ptr_from_main</code> &amp; <code>ptr_from_funtion</code> contians the same value at this point that is <code>13368980</code> as obtained from your example.</p>\n\n<p>You have a mistake in the <code>printf</code> statement that follows, not using the format specifier <code>%p</code> for printing the address, it should have been</p>\n\n<pre><code>printf(\"Value of ptr is %d, address is %p \\n\" , *ptr,&amp;ptr);\n</code></pre>\n\n<p>Also you should have used <code>ptr</code> instead of <code>&amp;ptr</code> for the example to be more meaningful,ie</p>\n\n<pre><code>printf(\"Value of ptr is %d, address is %p \\n\" , *ptr,ptr);\n/* Would give you\n * Value of ptr is 10, address is 13368980\n */\n</code></pre>\n\n<p>Every pointer is indeed an object which indeed has an an address, so <code>&amp;ptr</code> gives you the address of the pointer not its value(remember value is an address indeed :))</p>\n\n<hr>\n\n<p>To emulate call by reference in C++, you need to completely rewrite your program.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nvoid changePtr(int** ptr) // Here pointer&lt;-*ptr  &amp; integer&lt;-**ptr;\n{\nprintf(\"Value of ptr is %d, address is %p \\n\" , **ptr,*ptr);\nint b = 50;\n*ptr = &amp;b; // You've just changed the value of ptr in main\nprintf(\"Value of ptr in function changePtr is %d, address is %p  \\n\", **ptr , *ptr);\n\n}\n\n\nint main() {\n\nint a = 10;\nint* ptr;\nptr = &amp;a;\nchangePtr(&amp;ptr); // Pass the address\nprintf(\"Value of ptr in main is %d, address is %p  \\n\", *ptr,ptr);\nreturn 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 209, "user_id": 2519193, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/10cefc2bef0187a701a036e20f4b9320?s=128&d=identicon&r=PG", "display_name": "user2519193", "link": "https://stackoverflow.com/users/2519193/user2519193"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1472027113, "creation_date": 1472025076, "last_edit_date": 1472025573, "question_id": 39117424, "link": "https://stackoverflow.com/questions/39117424/is-this-a-valid-example-of-call-by-reference-not-being-true-in-c", "title": "Is this a valid example of call by reference not being true in C?", "body": "<pre><code>#include &lt;stdio.h&gt;\n\n\nvoid changePtr(int* ptr) {\n\nprintf(\"Value of ptr is %d, address is %d \\n\" , *ptr,&amp;ptr);\nint b = 50;\nptr = &amp;b;\nprintf(\"Value of ptr in function changePtr is %d, address is %d  \\n\", *ptr , &amp;ptr);\n\n}\n\n\nint main() {\n\nint a = 10;\nint* ptr;\nptr = &amp;a;\nchangePtr(ptr);\nprintf(\"Value of ptr in main is %d, address is %d  \\n\", *ptr,&amp;ptr);\nreturn 0;\n}\n</code></pre>\n\n<p>This is the output</p>\n\n<pre><code>Value of ptr is 10, address is 13368768\nValue of ptr in function changePtr is 50, address is 13368768\nValue of ptr in main is 10, address is 13368980\n</code></pre>\n\n<p>Over here, when I call function changePtr with ptr as it's argument, the function changePtr doesn't receive the pointer itself, rather the value of ptr in main(), and the variable ptr in the function changePtr is a totally new pointer that copies the value from the pointer ptr received from main().</p>\n\n<p>If C supports call by reference, the output at the lower two lines would match.</p>\n"}, {"tags": ["c", "shellcode"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1472025249, "post_id": 39117386, "comment_id": 65581161, "body": "<code>\\x</code> yields an escaped <code>x</code> character."}], "answers": [{"tags": [], "owner": {"reputation": 3849, "user_id": 6008453, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3f29d4474cf818b192e452474933ef4c?s=128&d=identicon&r=PG&f=1", "display_name": "Mirakurun", "link": "https://stackoverflow.com/users/6008453/mirakurun"}, "is_accepted": false, "score": 0, "last_activity_date": 1472026016, "last_edit_date": 1592644375, "creation_date": 1472026016, "answer_id": 39117756, "question_id": 39117386, "link": "https://stackoverflow.com/questions/39117386/compiling-shellcode-program-in-c-error/39117756#39117756", "title": "Compiling ShellCode Program in C error", "body": "<p>\\x indicates a hexadecimal character escape. From C99 6.4.4.4.:</p>\n<blockquote>\n<p>The hexadecimal digits that follow the backslash and the letter x in a hexadecimal escape sequence are taken to be part of the construction of a single character for an integer character constant or of a single wide character for a wide character constant.</p>\n<p>EXAMPLE 3 Even if eight bits are used for objects that have type char, the construction '\\x123' specifies an integer character constant containing only one character, since a hexadecimal escape sequence is terminated only by a non-hexadecimal character. To specify an integer character constant containing the two characters whose values are '\\x12' and '3', the construction '\\0223' may be used, since an octal escape sequence is terminated after three octal digits. (The value of this two-character integer character constant is implementation-defined.)</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 81, "user_id": 6584923, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/93d8dd4e134299c4b1bfe27f17fe737a?s=128&d=identicon&r=PG&f=1", "display_name": "Tarrell13", "link": "https://stackoverflow.com/users/6584923/tarrell13"}, "edited": false, "score": 0, "creation_date": 1472046709, "post_id": 39117860, "comment_id": 65595976, "body": "Thank you guys for the help. I just realized maybe because I pasted the code, it didn&#39;t read it as a string right away. One I deleted the quotes and retyped them, then the text turned yellow(nano) to signify a string and it compiled."}], "tags": [], "owner": {"reputation": 32098, "user_id": 646887, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YJ0Ye.jpg?s=128&g=1", "display_name": "Klas Lindb&#228;ck", "link": "https://stackoverflow.com/users/646887/klas-lindb%c3%a4ck"}, "is_accepted": false, "score": 0, "last_activity_date": 1472026698, "last_edit_date": 1472026698, "creation_date": 1472026326, "answer_id": 39117860, "question_id": 39117386, "link": "https://stackoverflow.com/questions/39117386/compiling-shellcode-program-in-c-error/39117860#39117860", "title": "Compiling ShellCode Program in C error", "body": "<p>I think the problem is caused by the typographic quotes: <code>\u201c</code> <code>\u201d</code>. </p>\n\n<p>In C, strings must be enclosed by regular double quotes: <code>\"</code></p>\n\n<p>The <code>\\x</code> notation for hex characters only works inside strings (double quotes) and character constants (single qoutes). Becuse of the typographic qoutes the compiler doesn't recognize the code as a string.</p>\n\n<p>So try changing the declaration like this:</p>\n\n<pre><code>char shellcode[] =\n\"\\xeb\\x1a\\x5e\\x31\\xc0\\x88\\x46\\x07\\x8d\\x1e\\x89\\x5e\\x08\\x89\\x46\"\n\"\\x0c\\xb0\\x0b\\x89\\xf3\\x8d\\x4e\\x08\\x8d\\x56\\x0c\\xcd\\x80\\xe8\\xe1\"\n\"\\xff\\xff\\xff\\x2f\\x62\\x69\\x6e\\x2f\\x73\\x68\";\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 81, "user_id": 6584923, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/93d8dd4e134299c4b1bfe27f17fe737a?s=128&d=identicon&r=PG&f=1", "display_name": "Tarrell13", "link": "https://stackoverflow.com/users/6584923/tarrell13"}, "edited": false, "score": 0, "creation_date": 1472171253, "post_id": 39117967, "comment_id": 65656823, "body": "Ok, I just copied and pasted what you had and I am so confused. Not really confused but a bit. Is that a function that was called? Maybe it is confusing because it is all on one line. I am still a novice when it comes to programming but I am working hard on it."}, {"owner": {"reputation": 10281, "user_id": 51760, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SI89u.jpg?s=128&g=1", "display_name": "Aif", "link": "https://stackoverflow.com/users/51760/aif"}, "reply_to_user": {"reputation": 81, "user_id": 6584923, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/93d8dd4e134299c4b1bfe27f17fe737a?s=128&d=identicon&r=PG&f=1", "display_name": "Tarrell13", "link": "https://stackoverflow.com/users/6584923/tarrell13"}, "edited": false, "score": 0, "creation_date": 1472202791, "post_id": 39117967, "comment_id": 65668162, "body": "Well the shellcode is a piece of code, which will ultimately call <code>exec</code> system call family. Hence, from the C perspective, this is like a function call. In particular, the function will be <code>noreturn</code>. So I find this cast more obvious. For information, I&#39;m not the one inventing this cast."}], "tags": [], "owner": {"reputation": 10281, "user_id": 51760, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SI89u.jpg?s=128&g=1", "display_name": "Aif", "link": "https://stackoverflow.com/users/51760/aif"}, "is_accepted": false, "score": 0, "last_activity_date": 1472026647, "creation_date": 1472026647, "answer_id": 39117967, "question_id": 39117386, "link": "https://stackoverflow.com/questions/39117386/compiling-shellcode-program-in-c-error/39117967#39117967", "title": "Compiling ShellCode Program in C error", "body": "<p>As indicated before, your quotes are an issue here. Pasting them on vi produces <code>?~@~\\\\xeb..</code> which may explain the complain about the backslash.</p>\n\n<p>Also, I would consider this cast for shellcode, which is more straightforward. </p>\n\n<pre><code>char shellcode[] =\n\"\\xeb\\x1a\\x5e\\x31\\xc0\\x88\\x46\\x07\\x8d\\x1e\\x89\\x5e\\x08\\x89\\x46\"\n\"\\x0c\\xb0\\x0b\\x89\\xf3\\x8d\\x4e\\x08\\x8d\\x56\\x0c\\xcd\\x80\\xe8\\xe1\"\n\"\\xff\\xff\\xff\\x2f\\x62\\x69\\x6e\\x2f\\x73\\x68\";\n\nint main(){\n        (*(void(*)()) shellcode)();\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 6584923, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/93d8dd4e134299c4b1bfe27f17fe737a?s=128&d=identicon&r=PG&f=1", "display_name": "Tarrell13", "link": "https://stackoverflow.com/users/6584923/tarrell13"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1472026698, "creation_date": 1472024984, "last_edit_date": 1472025525, "question_id": 39117386, "link": "https://stackoverflow.com/questions/39117386/compiling-shellcode-program-in-c-error", "title": "Compiling ShellCode Program in C error", "body": "<p>I am currently reading through a book about shellcoding and I am running into some issues during one of the examples. I am trying to compile the code below but I keep getting an error about stray \"\\\". Is there a certain way I have to input the characters because of the \"\\\"?</p>\n\n<pre><code>// shellcode.c\n\nchar shellcode[] =\n\u201c\\xeb\\x1a\\x5e\\x31\\xc0\\x88\\x46\\x07\\x8d\\x1e\\x89\\x5e\\x08\\x89\\x46\u201d\n\u201c\\x0c\\xb0\\x0b\\x89\\xf3\\x8d\\x4e\\x08\\x8d\\x56\\x0c\\xcd\\x80\\xe8\\xe1\u201d\n\u201c\\xff\\xff\\xff\\x2f\\x62\\x69\\x6e\\x2f\\x73\\x68\u201d;\n\nint main(){\n\n    int *ret;\n    ret = (int *)&amp;ret + 2;\n    (*ret) = (int)shellcode;\n}\n</code></pre>\n"}, {"tags": ["c", "opengl", "directx", "sdl", "gpu"], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 4116509, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qA7yYjJEKZM/AAAAAAAAAAI/AAAAAAAAAMw/ml9Jk7PRG1Q/photo.jpg?sz=128", "display_name": "hemant c", "link": "https://stackoverflow.com/users/4116509/hemant-c"}, "edited": false, "score": 0, "creation_date": 1472038540, "post_id": 39119929, "comment_id": 65589899, "body": "I understand but I need to send this image over network , so to reduce latency and getting real time transfer I need to do so. As for SDL &quot;SDL_RenderReadPixels()&quot; function is very slow."}, {"owner": {"reputation": 149158, "user_id": 524368, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oZ8Up.png?s=128&g=1", "display_name": "datenwolf", "link": "https://stackoverflow.com/users/524368/datenwolf"}, "reply_to_user": {"reputation": 147, "user_id": 4116509, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qA7yYjJEKZM/AAAAAAAAAAI/AAAAAAAAAMw/ml9Jk7PRG1Q/photo.jpg?sz=128", "display_name": "hemant c", "link": "https://stackoverflow.com/users/4116509/hemant-c"}, "edited": false, "score": 2, "creation_date": 1472075254, "post_id": 39119929, "comment_id": 65612427, "body": "@hemantc: What makes you think that glReadPixels increases your latency? If anything it <i>reduces</i> the latency, because glReadPixels introduces a synchronization point and drivers are optimized to finish rendering the result to be returned by glReadPixels and to return from it as fast as possible. The main purpose of PBOs is to give the implementation some leeway when and how to finish rendering and the transfer (giving petter throughput, but actually increasing latency on glReadPixels)."}, {"owner": {"reputation": 149158, "user_id": 524368, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oZ8Up.png?s=128&g=1", "display_name": "datenwolf", "link": "https://stackoverflow.com/users/524368/datenwolf"}, "reply_to_user": {"reputation": 147, "user_id": 4116509, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qA7yYjJEKZM/AAAAAAAAAAI/AAAAAAAAAMw/ml9Jk7PRG1Q/photo.jpg?sz=128", "display_name": "hemant c", "link": "https://stackoverflow.com/users/4116509/hemant-c"}, "edited": false, "score": 2, "creation_date": 1472075407, "post_id": 39119929, "comment_id": 65612498, "body": "@hemantc: Also you can do glReadPixels before buffer swap; however I strongly suggest to not &quot;deadline&quot; it, i.e. only start the transfer if you can assert that it will finish before the swap. Otherwise you might miss the deadline."}, {"owner": {"reputation": 147, "user_id": 4116509, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qA7yYjJEKZM/AAAAAAAAAAI/AAAAAAAAAMw/ml9Jk7PRG1Q/photo.jpg?sz=128", "display_name": "hemant c", "link": "https://stackoverflow.com/users/4116509/hemant-c"}, "edited": false, "score": 0, "creation_date": 1472158520, "post_id": 39119929, "comment_id": 65652658, "body": "@datenwoof thanks I will try . What will be fastest way to capture  screen in binary or base32 format other than glReadPixels ."}], "tags": [], "owner": {"reputation": 703, "user_id": 5778900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jh1qL.png?s=128&g=1", "display_name": "pleluron", "link": "https://stackoverflow.com/users/5778900/pleluron"}, "is_accepted": false, "score": 1, "last_activity_date": 1472032313, "creation_date": 1472032313, "answer_id": 39119929, "question_id": 39117271, "link": "https://stackoverflow.com/questions/39117271/how-to-get-video-output-or-frame-from-vram/39119929#39119929", "title": "How to get video output or frame from VRAM", "body": "<p>It is not a very good way to try and get the frame directly from VRAM. How and where the frame is laid out in memory is an implementation-dependent point, so you should use functions from your API to get that image.</p>\n\n<p>With OpenGL, use <a href=\"https://www.opengl.org/sdk/docs/man/html/glReadPixels.xhtml\" rel=\"nofollow\"><code>glReadPixels</code></a> or <a href=\"https://www.opengl.org/wiki/Pixel_Buffer_Object\" rel=\"nofollow\">PBOs</a> for async transfers.</p>\n"}], "owner": {"reputation": 147, "user_id": 4116509, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qA7yYjJEKZM/AAAAAAAAAAI/AAAAAAAAAMw/ml9Jk7PRG1Q/photo.jpg?sz=128", "display_name": "hemant c", "link": "https://stackoverflow.com/users/4116509/hemant-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1472032468, "creation_date": 1472024574, "last_edit_date": 1472032468, "question_id": 39117271, "link": "https://stackoverflow.com/questions/39117271/how-to-get-video-output-or-frame-from-vram", "title": "How to get video output or frame from VRAM", "body": "<p>I want to get the frame (image) that will be displayed on screen, directly from VRAM if possible in binary(RAW) format using SDL/OpenGl/DirectX or any other API.</p>\n\n<p>I want to minimize latency of capturing screen then saving it to image and converting it to binary or base64.  </p>\n"}, {"tags": ["c", "operators", "integer-overflow", "signed-integer"], "answers": [{"comments": [{"owner": {"reputation": 30168, "user_id": 5612562, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/gzBQY.jpg?s=128&g=1", "display_name": "msc", "link": "https://stackoverflow.com/users/5612562/msc"}, "edited": false, "score": 0, "creation_date": 1472024026, "post_id": 39117039, "comment_id": 65580467, "body": "Thank you for solving my problem."}], "tags": [], "owner": {"reputation": 106438, "user_id": 1275169, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4c6dbda4e65af6d2ceaabdfad538b319?s=128&d=identicon&r=PG&f=1", "display_name": "P.P", "link": "https://stackoverflow.com/users/1275169/p-p"}, "is_accepted": true, "score": 7, "last_activity_date": 1505363525, "last_edit_date": 1505363525, "creation_date": 1472023910, "answer_id": 39117039, "question_id": 39117022, "link": "https://stackoverflow.com/questions/39117022/if-we-add-one-to-the-largest-re-presentable-integer-is-the-result-negative/39117039#39117039", "title": "If we add one to the largest re-presentable integer, is the result negative?", "body": "<blockquote>\n  <p>If we add one to the largest re-presentable integer, is the result negative? </p>\n</blockquote>\n\n<p>No. Signed integer overflow is <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behaviour</a>.  You may observe as if it wraps around in 2's complement representation. But that's just implementation specific behaviour and the C standard makes absolutely no such guarantee anything.</p>\n"}, {"comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 1, "creation_date": 1472024096, "post_id": 39117044, "comment_id": 65580513, "body": "I <i>think</i> it&#39;s <i>necessarily</i> an overflow."}, {"owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "reply_to_user": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1472024180, "post_id": 39117044, "comment_id": 65580569, "body": "@Bathsheba ok, is that is confusing, let me keep that part out."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1472024222, "post_id": 39117044, "comment_id": 65580596, "body": "I&#39;ve asserted in my answer that it <i>must</i> be an overflow. You&#39;re welcome to copy - your answers normally emerge as more comprehensive than mine."}], "tags": [], "owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "is_accepted": false, "score": 5, "last_activity_date": 1472024244, "last_edit_date": 1472024244, "creation_date": 1472023931, "answer_id": 39117044, "question_id": 39117022, "link": "https://stackoverflow.com/questions/39117022/if-we-add-one-to-the-largest-re-presentable-integer-is-the-result-negative/39117044#39117044", "title": "If we add one to the largest re-presentable integer, is the result negative?", "body": "<p><code>INT_MAX</code> being a signed value, <code>INT_MAX + 1</code> is causing a signed integer overflow, which invokes <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow\">undefined behavior</a>.</p>\n\n<p>The output (<em>if at all</em>) of a(ny) program containing UB cannot be justified in any way.</p>\n"}, {"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1472048733, "post_id": 39117048, "comment_id": 65597545, "body": "Hmmm 13th answer that includes &quot;eat your cat&quot;.  Hope your kitty icon does not get nervous with all this UB."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1472049534, "post_id": 39117048, "comment_id": 65598132, "body": "@chux Ha. Yes I guess I do say it a lot. A triskaidekaphobic cat ought to be doubly-nervous."}], "tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": false, "score": 5, "last_activity_date": 1472023940, "creation_date": 1472023940, "answer_id": 39117048, "question_id": 39117022, "link": "https://stackoverflow.com/questions/39117022/if-we-add-one-to-the-largest-re-presentable-integer-is-the-result-negative/39117048#39117048", "title": "If we add one to the largest re-presentable integer, is the result negative?", "body": "<p>The behaviour of <code>INT_MAX + 1</code> is <em>undefined</em> as you will be overflowing a <code>signed</code> type.</p>\n\n<p>The program could output anything, or the compiler could eat your cat.</p>\n\n<p>(Out of interest, this is why you'll see <code>-INT_MAX - 1</code> as the definition of <code>INT_MIN</code> on a 2's complement system.)</p>\n"}, {"comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 4, "creation_date": 1472024166, "post_id": 39117117, "comment_id": 65580558, "body": "And a truck load of UB."}], "tags": [], "owner": {"reputation": 648, "user_id": 3081675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/729e2dcea76b214b1bd2217b62ef9cf6?s=128&d=identicon&r=PG&f=1", "display_name": "Wiki Wang", "link": "https://stackoverflow.com/users/3081675/wiki-wang"}, "is_accepted": false, "score": -1, "last_activity_date": 1472024134, "creation_date": 1472024134, "answer_id": 39117117, "question_id": 39117022, "link": "https://stackoverflow.com/questions/39117022/if-we-add-one-to-the-largest-re-presentable-integer-is-the-result-negative/39117117#39117117", "title": "If we add one to the largest re-presentable integer, is the result negative?", "body": "<pre><code>INT_MAX = 0x7fffffff\nINT_MAX + 1 = 0x80000000 = -2147483648 &lt; 0\n</code></pre>\n"}], "owner": {"reputation": 30168, "user_id": 5612562, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/gzBQY.jpg?s=128&g=1", "display_name": "msc", "link": "https://stackoverflow.com/users/5612562/msc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 1, "accepted_answer_id": 39117039, "answer_count": 4, "score": 2, "last_activity_date": 1505363525, "creation_date": 1472023848, "last_edit_date": 1472024733, "question_id": 39117022, "link": "https://stackoverflow.com/questions/39117022/if-we-add-one-to-the-largest-re-presentable-integer-is-the-result-negative", "title": "If we add one to the largest re-presentable integer, is the result negative?", "body": "<p>This program is asking the <code>C</code> implementation to answer a simple question:  </p>\n\n<p>If we check the largest re-presentable integer <strong>INT_MAX &lt; 0</strong> and print it.</p>\n\n<pre><code>printf (\"%d\\n\", (INT_MAX) &lt; 0);\n</code></pre>\n\n<p>So, displayed output <code>0</code>. because condition become <strong>false</strong> and relational operator return <code>0</code>.</p>\n\n<p>But, If we <strong>add</strong> <code>1</code> to the largest re-presentable integer and check condition, See following program.</p>\n\n<pre><code>#include &lt;limits.h&gt;\n#include &lt;stdio.h&gt;\n\nint main (void)\n{\n  printf (\"%d\\n\", (INT_MAX+1) &lt; 0);\n  return 0;\n}\n</code></pre>\n\n<p>and displayed <strong>output</strong> <code>1</code>. </p>\n\n<p>Why condition not become <strong>false</strong>?</p>\n\n<p>Also, if we add one to the largest re-presentable integer, is the result negative?</p>\n"}, {"tags": ["c", "lint", "truncation", "armcc"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1472023765, "post_id": 39116944, "comment_id": 65580304, "body": "Unrelated to your problem, but <code>int64_t</code> is already defined to be <code>signed</code>, you don&#39;t need to specify <code>signed</code> again when using it. See e.g. <a href=\"http://en.cppreference.com/w/c/types/integer\" rel=\"nofollow noreferrer\">this fixed-width integer reference</a>."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1472024092, "post_id": 39116944, "comment_id": 65580510, "body": "Do you need: <code>((int64_t)sub2 &lt;&lt; 8) &#47; pCont-&gt;freq + 1</code>?"}, {"owner": {"reputation": 870061, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 1, "creation_date": 1472025299, "post_id": 39116944, "comment_id": 65581203, "body": "The basic questions you have to answer for yourself: &quot;why are you using a signed type to store the value when it can never be negative?&quot;  And &quot;why are you storing it as a 63-bit value when the expression can never produce more than 32 valid bits?&quot;  And it won&#39;t hurt to think about &quot;What happens when sub2 is too large and the value overflows?&quot;  Only after you can say &quot;I meant to do that!&quot; can you suppress the warning."}], "answers": [{"comments": [{"owner": {"reputation": 507, "user_id": 3417549, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3VOwl.jpg?s=128&g=1", "display_name": "titus.andronicus", "link": "https://stackoverflow.com/users/3417549/titus-andronicus"}, "edited": false, "score": 0, "creation_date": 1472025253, "post_id": 39117139, "comment_id": 65581164, "body": "<code>lint</code> warning is gone! Your explanation is clear an on point. I&#39;m happy; my boss is happy; my QA colleague is happy :-)"}], "tags": [], "owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": true, "score": 4, "last_activity_date": 1472024191, "creation_date": 1472024191, "answer_id": 39117139, "question_id": 39116944, "link": "https://stackoverflow.com/questions/39116944/lint-warning-647-suspicious-truncation/39117139#39117139", "title": "Lint Warning: #647: Suspicious truncation", "body": "<p>From <a href=\"http://www.gimpel.com/html/bugs/bug647.htm\" rel=\"nofollow\">this reference about the warning</a></p>\n\n<blockquote>\n  <p>For example:</p>\n\n<pre><code>(long) (n &lt;&lt; 8)\n</code></pre>\n  \n  <p>might elicit this message if n is unsigned int, whereas</p>\n\n<pre><code>(long) n &lt;&lt; 8\n</code></pre>\n  \n  <p>would not.  In the first case, the shift is done at int precision\n  and the high order 8 bits are lost even though there is a\n  subsequent conversion to a type that might hold all the bits.  In\n  the second case, the shifted bits are retained.</p>\n</blockquote>\n\n<p>This seems to fit your case <em>exactly</em> and also show you how to fix it.</p>\n"}], "owner": {"reputation": 507, "user_id": 3417549, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3VOwl.jpg?s=128&g=1", "display_name": "titus.andronicus", "link": "https://stackoverflow.com/users/3417549/titus-andronicus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2006, "favorite_count": 0, "accepted_answer_id": 39117139, "answer_count": 1, "score": 1, "last_activity_date": 1472024191, "creation_date": 1472023599, "question_id": 39116944, "link": "https://stackoverflow.com/questions/39116944/lint-warning-647-suspicious-truncation", "title": "Lint Warning: #647: Suspicious truncation", "body": "<p>I have read the related questions to this Lint warning about the suspicious truncation, but here it is a purely C case.</p>\n\n<p>The following line is where the <code>Warning #647</code> pops up:</p>\n\n<pre><code>pCont-&gt;sig -= (signed int64_t)((sub2 &lt;&lt; 8)/pCont-&gt;freq + 1);\n</code></pre>\n\n<p>where <code>pCont-&gt;sig</code> is also 64 bit signed (type <code>signed int64_t</code>), and both <code>sub2</code> and <code>freq</code> are 32 bit unsigned. All this is compiled with armcc.</p>\n\n<p>Already tried, without success, to cast the <code>1</code> to unsigned 32 bit, but the problem persists. </p>\n\n<p>Any idea on what I might try, or what is going wrong here?</p>\n"}, {"tags": ["c", "arrays", "csv", "multidimensional-array", "char"], "comments": [{"owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "edited": false, "score": 2, "creation_date": 1472021875, "post_id": 39116366, "comment_id": 65579246, "body": "Please show your research/debugging effort so far. Please read <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a> page first."}, {"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 1, "creation_date": 1472022017, "post_id": 39116366, "comment_id": 65579314, "body": "<i>comma seperated</i> ??"}, {"owner": {"reputation": 65, "user_id": 4194025, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dc01dd84522c18eab1a697345f04a073?s=128&d=identicon&r=PG&f=1", "display_name": "noobatrilla", "link": "https://stackoverflow.com/users/4194025/noobatrilla"}, "reply_to_user": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472022475, "post_id": 39116366, "comment_id": 65579558, "body": "@BLUEPIXY I think it is the char &#39;,&#39;"}, {"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472023076, "post_id": 39116366, "comment_id": 65579909, "body": "I think that you needed string of the output, it is not in the jagged array."}, {"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472023945, "post_id": 39116366, "comment_id": 65580430, "body": "@noobatrilla Do <code>int**</code> mean real 2D-Array ( like <code>int array[3][4];</code>)?"}], "answers": [{"comments": [{"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472028006, "post_id": 39118389, "comment_id": 65582976, "body": "<a href=\"http://ideone.com/O6oRLP\" rel=\"nofollow noreferrer\">DEMO</a>"}, {"owner": {"reputation": 65, "user_id": 4194025, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dc01dd84522c18eab1a697345f04a073?s=128&d=identicon&r=PG&f=1", "display_name": "noobatrilla", "link": "https://stackoverflow.com/users/4194025/noobatrilla"}, "edited": false, "score": 0, "creation_date": 1472298303, "post_id": 39118389, "comment_id": 65702889, "body": "Thank you! Thank you! After speaking with so many people, you have shown me the light."}], "tags": [], "owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "is_accepted": true, "score": 0, "last_activity_date": 1472027967, "creation_date": 1472027967, "answer_id": 39118389, "question_id": 39116366, "link": "https://stackoverflow.com/questions/39116366/convert-an-int-array-into-a-char-array-of-a-different-size-composition/39118389#39118389", "title": "Convert an int** array into a char** array of a different size / composition", "body": "<p>I think that you needed string, not 2D-Array.<br>\nYou can be written out to a string like write to the standard output by implementing a string that a simple extension.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\ntypedef struct char_vec {\n    char *v;\n    size_t capacity;\n    size_t used;\n} sstream;\n\nsstream *ss_new(void);\nvoid ss_free(sstream *ss);\nvoid ss_putc(sstream *ss, char ch);\nvoid ss_puts(sstream *ss, char *str);\n\nint main(void){\n    int rows = 3;\n    int cols = 4;\n    int **array = malloc(rows * sizeof(*array));\n    for(int r = 0; r &lt; rows; ++r){\n        array[r] = malloc(cols * sizeof(**array));\n    }\n    //set values\n    memcpy(array[0], (int[]){1,2,3,4}, cols * sizeof(**array));\n    memcpy(array[1], (int[]){5,6,7,8}, cols * sizeof(**array));\n    memcpy(array[2], (int[]){9,3,2,1}, cols * sizeof(**array));\n\n    //print original array\n    for(int r = 0; r &lt; rows; ++r){\n        for(int c = 0; c &lt; cols; ++c){\n            if(c)\n                putchar(' ');\n            printf(\"%d\", array[r][c]);\n        }\n        puts(\"\");\n    }\n    //make string of output\n    char temp[32];\n    sstream *ss = ss_new();\n    ss_putc(ss, '[');\n    for(int r = 0; r &lt; rows; ++r){\n        if(r)\n            ss_putc(ss, ',');\n        snprintf(temp, sizeof(temp), \"['%d'\", r + 1);//0'th index is represented as the row number\n        ss_puts(ss, temp);\n        for(int c = 0; c &lt; cols; ++c){\n            snprintf(temp, sizeof(temp), \",'%d'\", array[r][c]);\n            ss_puts(ss, temp);\n        }\n        ss_putc(ss, ']');\n    }\n    ss_putc(ss, ']');\n    ss_putc(ss, '\\0');\n\n    puts(ss-&gt;v);\n    ss_free(ss);\n\n    //deallocate array\n    for(int r = 0; r &lt; rows; ++r)\n        free(array[r]);\n    free(array);\n    return 0;\n}\n\nsstream *ss_new(void){\n    sstream *ss = malloc(sizeof(*ss));\n    ss-&gt;capacity = 32;\n    ss-&gt;used = 0;\n    ss-&gt;v = malloc(ss-&gt;capacity);\n    return ss;\n}\nvoid ss_free(sstream *ss){\n    free(ss-&gt;v);\n    free(ss);\n}\n\nvoid ss_putc(sstream *ss, char ch){\n    ss-&gt;v[ss-&gt;used++] = ch;\n    if(ss-&gt;used == ss-&gt;capacity){\n        char *temp = realloc(ss-&gt;v, ss-&gt;capacity += 32);\n        if(!temp){\n            ss_free(ss);\n            fprintf(stderr, \"fail realloc at %s\\n\", __func__);\n            exit(EXIT_FAILURE);\n        }\n        ss-&gt;v = temp;\n    }\n}\n\nvoid ss_puts(sstream *ss, char *str){\n    while(*str)\n        ss_putc(ss, *str++);\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 4194025, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/dc01dd84522c18eab1a697345f04a073?s=128&d=identicon&r=PG&f=1", "display_name": "noobatrilla", "link": "https://stackoverflow.com/users/4194025/noobatrilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "closed_date": 1472314564, "accepted_answer_id": 39118389, "answer_count": 1, "score": -6, "last_activity_date": 1472027967, "creation_date": 1472021796, "question_id": 39116366, "link": "https://stackoverflow.com/questions/39116366/convert-an-int-array-into-a-char-array-of-a-different-size-composition", "closed_reason": "Needs details or clarity", "title": "Convert an int** array into a char** array of a different size / composition", "body": "<p>I'm trying to convert an int** array that looks like the below, into a char** array that is made up from the number of rows and is comma seperated. </p>\n\n<pre><code>1 2 3 4\n5 6 7 8\n9 3 2 1\n</code></pre>\n\n<p>An example of what I would like the char** array to be represented as would be something like [['1','1','2','3','4'], ['2','5','6','7','8'] , ['3','9','3','2','1']] where every 0'th index is represented as the row number. I'm not really sure how I would be able to achieve this, is there any known methods that are good for converting an int** into something like this? Thanks.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "edited": false, "score": 1, "creation_date": 1472022753, "post_id": 39116352, "comment_id": 65579727, "body": "@SouravGhosh: He doesn&#39;t want to use signed bit-fields.  He just wants to get the equivalent of <code>-1</code> into an unsigned bit-field, but the compiler is complaining about the signed vs unsigned mismatch."}, {"owner": {"reputation": 12119, "user_id": 5265292, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/0b9b1031971201aa02e13287af690946?s=128&d=identicon&r=PG&f=1", "display_name": "grek40", "link": "https://stackoverflow.com/users/5265292/grek40"}, "edited": false, "score": 0, "creation_date": 1472022780, "post_id": 39116352, "comment_id": 65579746, "body": "What about explicitely casting the <code>-1</code>? The warning should only occur on implicit cast. Can&#39;t test right now, thats why I only write comment."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 3, "creation_date": 1472022807, "post_id": 39116352, "comment_id": 65579767, "body": "Use <code>~0U</code> for a bit-field with base type <code>unsigned int</code> or smaller.  Use <code>~0UL</code> or <code>~0ULL</code> for bigger types.  This does assume 2&#39;s complement binary arithmetic; if you&#39;re on a CPU with an alternative, you&#39;ll need to think carefully."}, {"owner": {"reputation": 695, "user_id": 2506949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52e5d8756b5535046a2560c4169a464c?s=128&d=identicon&r=PG", "display_name": "David Bern", "link": "https://stackoverflow.com/users/2506949/david-bern"}, "edited": false, "score": 0, "creation_date": 1472022892, "post_id": 39116352, "comment_id": 65579798, "body": "Not sure what you want to do.         int test = UINT_MAX;         printf(&quot;\\n0x%x\\n&quot;, test);         printf(&quot;\\n%d\\n&quot;, test);"}, {"owner": {"reputation": 57967, "user_id": 2805305, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/442d249754d1725d9510cf06fa46b964?s=128&d=identicon&r=PG&f=1", "display_name": "bolov", "link": "https://stackoverflow.com/users/2805305/bolov"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1472023354, "post_id": 39116352, "comment_id": 65580070, "body": "@JonathanLeffler still warnings"}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1472023388, "post_id": 39116352, "comment_id": 65580095, "body": "@JonathanLeffler What does 2&#39;s complement have to do with unsigned types? ~0U will always yield all bits set to 1."}, {"owner": {"reputation": 81300, "user_id": 296974, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0e26cfe3ac75cd582ca200fbc6fa0421?s=128&d=identicon&r=PG", "display_name": "glglgl", "link": "https://stackoverflow.com/users/296974/glglgl"}, "reply_to_user": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "edited": false, "score": 0, "creation_date": 1472023435, "post_id": 39116352, "comment_id": 65580124, "body": "@2501 is right, didn&#39;t think about that as well. <code>-1</code> only works with 2-s complement platforms."}, {"owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "reply_to_user": {"reputation": 81300, "user_id": 296974, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0e26cfe3ac75cd582ca200fbc6fa0421?s=128&d=identicon&r=PG", "display_name": "glglgl", "link": "https://stackoverflow.com/users/296974/glglgl"}, "edited": false, "score": 0, "creation_date": 1472023488, "post_id": 39116352, "comment_id": 65580149, "body": "@glglgl No. -1 converted to an unsigned type will always yield the maximum value of that unsigned type. Integer representation is irrelevant."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "edited": false, "score": 0, "creation_date": 1472023680, "post_id": 39116352, "comment_id": 65580258, "body": "@2501: I accept that two&#39;s complement vs other representations doesn&#39;t affect bitwise inversion of an unsigned value.  I need to get to bed (it&#39;s late here)."}, {"owner": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "edited": false, "score": 0, "creation_date": 1472025652, "post_id": 39116352, "comment_id": 65581451, "body": "I dont see a warning with gcc, and -Wall -Wextra -Wpedantic, when i use -1 and uin8_t, what compiler do you use?. <a href=\"http://www.tutorialspoint.com/compile_c_online.php?PID=0Bw_CjBb95KQMOXJRd3Fuc2dNYWc\" rel=\"nofollow noreferrer\">tutorialspoint.com/&hellip;</a>"}, {"owner": {"reputation": 695, "user_id": 2506949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52e5d8756b5535046a2560c4169a464c?s=128&d=identicon&r=PG", "display_name": "David Bern", "link": "https://stackoverflow.com/users/2506949/david-bern"}, "edited": false, "score": 0, "creation_date": 1472033675, "post_id": 39116352, "comment_id": 65586620, "body": "This question makes no sense. Do you want initialize one bit or all bits with 1?"}], "answers": [{"comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1472023858, "post_id": 39116717, "comment_id": 65580376, "body": "Maybe you need: <code>#define N_BITS(n) ((1U &lt;&lt; (n)) - 1)</code> and <code>X x = { N_BITS(4) };</code> for a 4-bit bit field.  If you have to deal with 32-bit or larger fields, you have to work harder."}, {"owner": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "edited": false, "score": 0, "creation_date": 1472025048, "post_id": 39116717, "comment_id": 65581032, "body": "#define N_BITS(n) ((1ULL &lt;&lt; (n)) - 1) may be work better for larger bitfields (up to 63)?"}], "tags": [], "owner": {"reputation": 57967, "user_id": 2805305, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/442d249754d1725d9510cf06fa46b964?s=128&d=identicon&r=PG&f=1", "display_name": "bolov", "link": "https://stackoverflow.com/users/2805305/bolov"}, "is_accepted": false, "score": 2, "last_activity_date": 1472024398, "last_edit_date": 1472024398, "creation_date": 1472022912, "answer_id": 39116717, "question_id": 39116352, "link": "https://stackoverflow.com/questions/39116352/how-to-fill-bitfields-with-0xff/39116717#39116717", "title": "How to fill bitfields with 0xff", "body": "<p>One solution is to manually create all the init values in an enum and just use them:</p>\n\n<pre><code>enum Init_bit {\n  // etc\n  i_3 = 7u, // use longer names because global space\n  i_4 = 15u,\n  i_5 = 31u,\n  // etc\n};\n</code></pre>\n\n<p>You write that once and then it becomes easy:</p>\n\n<pre><code>X x = {/*other fields*/, i_4, /*other fields*/};\n</code></pre>\n\n<hr>\n\n<p>Another solution I found is to init to <code>0</code> and then decrement. This is well defined because we are dealing with unsigned type. If you need to initialize you can create a function like this:</p>\n\n<pre><code>X get_x()\n{\n  X x;\n  x.a = 0;\n  --x.a;\n\n  return x;\n}\n</code></pre>\n\n<p>With optimizations enable the compiler will direct initialize:</p>\n\n<pre><code>get_x:\n        movl    $15, %eax\n        ret\n</code></pre>\n\n<p>You can then use that function for initialization:</p>\n\n<pre><code>X x = get_x();\n</code></pre>\n\n<p>Of course this has the disadvantage that you need to init the other fields of <code>X</code> in <code>get_x</code>.</p>\n\n<hr>\n\n<p><em>where <code>X</code> was defined as:</em></p>\n\n<pre><code>struct X {\n  unsigned a : 4;\n};\n\ntypedef struct X X;\n</code></pre>\n\n<hr>\n\n<p>It seems that it is tricky to initialize bit fields like this without warnings (gcc 6.1):</p>\n\n<pre><code>X x = {-1};\n//!!warning: negative integer implicitly converted to unsigned type [-Wsign-conversion]\n\nX x = {-1u};\n//!!warning: large integer implicitly truncated to unsigned type [-Woverflow]\n\nX x = {(unsigned)-1};\n//!!warning: large integer implicitly truncated to unsigned type [-Woverflow]\n\nX x = {~0};\n//!!warning: negative integer implicitly converted to unsigned type [-Wsign-conversion]\n\nX x = {~0u};\n//!!warning: large integer implicitly truncated to unsigned type [-Woverflow]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24488, "user_id": 4082723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LJbVr.png?s=128&g=1", "display_name": "2501", "link": "https://stackoverflow.com/users/4082723/2501"}, "is_accepted": false, "score": 0, "last_activity_date": 1472024249, "creation_date": 1472024249, "answer_id": 39117156, "question_id": 39116352, "link": "https://stackoverflow.com/questions/39116352/how-to-fill-bitfields-with-0xff/39117156#39117156", "title": "How to fill bitfields with 0xff", "body": "<p>If you use bitfields, then their size is known at compile time and is known to the programmer. </p>\n\n<p>Therefore initialization can be done by simply using the maximum value, which has all bits set to one.</p>\n\n<p>To avoid repeating yourself, a macro containing the max value for that type should be used. Just like UINT_MAX holds the maximum value for type unsigned int, you define your own type. For example, a unsigned bitfield of width 7:</p>\n\n<pre><code>#define UBIT7_MAX 0x7F\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 56, "user_id": 3487710, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10925978a49d767d80100ac6db194e1e?s=128&d=identicon&r=PG", "display_name": "Foo Bar", "link": "https://stackoverflow.com/users/3487710/foo-bar"}, "is_accepted": false, "score": 1, "last_activity_date": 1472027119, "last_edit_date": 1472027119, "creation_date": 1472025922, "answer_id": 39117718, "question_id": 39116352, "link": "https://stackoverflow.com/questions/39116352/how-to-fill-bitfields-with-0xff/39117718#39117718", "title": "How to fill bitfields with 0xff", "body": "<p>You can use memset </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nstruct bitfields {\n    unsigned int a : 1;\n    unsigned int b : 2;\n    unsigned int c : 5;\n};\n\nint main(void) {\n    struct bitfields x;\n    memset(&amp;x,0xff, sizeof(x));\n    printf(\"a=%u; b=%u, c=%u\\n\", x.a, x.b, x.c);\n    return 0;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 0, "last_activity_date": 1472075907, "last_edit_date": 1472075907, "creation_date": 1472048905, "answer_id": 39126101, "question_id": 39116352, "link": "https://stackoverflow.com/questions/39116352/how-to-fill-bitfields-with-0xff/39126101#39126101", "title": "How to fill bitfields with 0xff", "body": "<blockquote>\n  <p>If I use -1 I get a warning that I am assigning signed to unsigned variable.</p>\n</blockquote>\n\n<p>Use an <em>unsigned</em> constant by appending a <code>u</code>.  The <code>-</code> does not change the type of the constant.</p>\n\n<pre><code>// to initialize a unsigned field in bitfield with 0xfff.\nstruct {\n  unsigned u:7;\n} x = {-1u};\n</code></pre>\n\n<p>Alternatively</p>\n\n<pre><code>int main(void) {\n  typedef struct {\n    unsigned u :7;\n  } useven;\n  useven z = { 0 };\n  z.u--;\n  useven x = { z.u };  // No warnings/errors - set to all 1 bits.\n  printf(\"%X\\n\", x.u); // Prints 7F\n}\n</code></pre>\n\n<p>This may generate a warning like \"warning: large integer implicitly truncated to unsigned type\" but it does get rid of the warning in OP's post.</p>\n\n<p>If your bitfield is wider than <code>unsigned</code>, use <code>-1lu</code>, etc.  Note: using bitfields wider than <code>int/unsigned</code> is not universally supported.  Do not recommend.</p>\n"}], "owner": {"reputation": 2087, "user_id": 1179689, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/0af041f6eb59ed4e3698c3af45d58607?s=128&d=identicon&r=PG&f=1", "display_name": "yehudahs", "link": "https://stackoverflow.com/users/1179689/yehudahs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "answer_count": 4, "score": 3, "last_activity_date": 1472075907, "creation_date": 1472021754, "question_id": 39116352, "link": "https://stackoverflow.com/questions/39116352/how-to-fill-bitfields-with-0xff", "title": "How to fill bitfields with 0xff", "body": "<p>Is there a way to initialize a unsigned field in bitfield with 0xfff...(according to its' size ofcourse) ?\nIf I use -1 I get a warning that I am assigning signed to unsigned variable.</p>\n"}, {"tags": ["c++", "c", "multithreading", "openmp"], "comments": [{"owner": {"reputation": 65854, "user_id": 1374437, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/34xta.png?s=128&g=1", "display_name": "Hristo &#39;away&#39; Iliev", "link": "https://stackoverflow.com/users/1374437/hristo-away-iliev"}, "edited": false, "score": 0, "creation_date": 1472107399, "post_id": 39116329, "comment_id": 65620928, "body": "You shouldn&#39;t be combining OpenMP with other forms of threading as it goes beyond the scope of the standard and there is no guarantee that your program will work correctly with future versions of the respective OpenMP runtime."}], "answers": [{"comments": [{"owner": {"reputation": 2946, "user_id": 1488118, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/74638bb1fe3873f2c5d1d31ac6cdafe2?s=128&d=identicon&r=PG", "display_name": "bweber", "link": "https://stackoverflow.com/users/1488118/bweber"}, "edited": false, "score": 0, "creation_date": 1472114232, "post_id": 39119009, "comment_id": 65625270, "body": "Thanks, I think this is the perfect solution. I can just add a boolean variable to the pragma then, that specifies if the run should be parallelised or not."}], "tags": [], "owner": {"reputation": 2799, "user_id": 1747493, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ro2p4.jpg?s=128&g=1", "display_name": "Harald", "link": "https://stackoverflow.com/users/1747493/harald"}, "is_accepted": true, "score": 14, "last_activity_date": 1472980913, "last_edit_date": 1472980913, "creation_date": 1472029724, "answer_id": 39119009, "question_id": 39116329, "link": "https://stackoverflow.com/questions/39116329/enable-disable-openmp-locally-at-runtime/39119009#39119009", "title": "Enable/disable OpenMP locally at runtime", "body": "<p>An alternative you can use is to add an <code>if</code> condition to the <code>#pragma omp</code> constructs. These will skip the invocation to the OpenMP runtime calls derived from the pragmas whenever the condition is false.</p>\n\n<p>Consider the following program that uses conditionals based on variables <code>t</code> and <code>f</code> (respectively true and false):</p>\n\n<pre><code>#include &lt;omp.h&gt;\n#include &lt;stdio.h&gt;\n\nint main (void)\n{\n    int t = (0 == 0); // true value\n    int f = (1 == 0); // false value\n\n    #pragma omp parallel if (f)\n    { printf (\"FALSE: I am thread %d\\n\", omp_get_thread_num()); }\n\n    #pragma omp parallel if (t)\n    { printf (\"TRUE : I am thread %d\\n\", omp_get_thread_num()); }\n\n    return 0;\n}\n</code></pre>\n\n<p>Its output is:</p>\n\n<pre><code>$ OMP_NUM_THREADS=4 ./test\nFALSE: I am thread 0\nTRUE : I am thread 0\nTRUE : I am thread 1\nTRUE : I am thread 3\nTRUE : I am thread 2\n</code></pre>\n"}], "owner": {"reputation": 2946, "user_id": 1488118, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/74638bb1fe3873f2c5d1d31ac6cdafe2?s=128&d=identicon&r=PG", "display_name": "bweber", "link": "https://stackoverflow.com/users/1488118/bweber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2715, "favorite_count": 1, "accepted_answer_id": 39119009, "answer_count": 1, "score": 5, "last_activity_date": 1472980913, "creation_date": 1472021604, "last_edit_date": 1472033675, "question_id": 39116329, "link": "https://stackoverflow.com/questions/39116329/enable-disable-openmp-locally-at-runtime", "title": "Enable/disable OpenMP locally at runtime", "body": "<p>Is it possible to enable or disable OpenMP parallelisation at runtime? I have some code that should run in parallel under certain circumstances and not in parallel under different circumstances. At the same time, there are other computations in other threads that also use OpenMP and should always run in parallel. Is there a way to tell OpenMP not to parallelise in the current thread? I know of <code>omp_set_num_threads</code>, but I assume that globally sets the number of threads that OpenMP uses.</p>\n"}, {"tags": ["c", "pointers", "constants"], "comments": [{"owner": {"reputation": 27385, "user_id": 1382251, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/17622c39e8ead537a0944c767551b2fe?s=128&d=identicon&r=PG", "display_name": "barak manos", "link": "https://stackoverflow.com/users/1382251/barak-manos"}, "edited": false, "score": 5, "creation_date": 1472017613, "post_id": 39115264, "comment_id": 65577318, "body": "The linker has placed the global variable <code>i</code> in a RO section of the executable image."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6359267"}, "edited": false, "score": 1, "creation_date": 1472018489, "post_id": 39115264, "comment_id": 65577636, "body": "*p = 10 undefined behaviors."}], "answers": [{"comments": [{"owner": {"reputation": 661, "user_id": 2425460, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/840e7165882bdc3499f4e4c33d8ca353?s=128&d=identicon&r=PG", "display_name": "Able Eldhose", "link": "https://stackoverflow.com/users/2425460/able-eldhose"}, "edited": false, "score": 0, "creation_date": 1472064412, "post_id": 39115358, "comment_id": 65607169, "body": "Is the RO section residing in RAM itself?"}, {"owner": {"reputation": 27385, "user_id": 1382251, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/17622c39e8ead537a0944c767551b2fe?s=128&d=identicon&r=PG", "display_name": "barak manos", "link": "https://stackoverflow.com/users/1382251/barak-manos"}, "reply_to_user": {"reputation": 661, "user_id": 2425460, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/840e7165882bdc3499f4e4c33d8ca353?s=128&d=identicon&r=PG", "display_name": "Able Eldhose", "link": "https://stackoverflow.com/users/2425460/able-eldhose"}, "edited": false, "score": 0, "creation_date": 1472099182, "post_id": 39115358, "comment_id": 65618171, "body": "@AbleEldhose: The rest of my comment here is not something that is dictated by the C-language standard, but basically depends on the underlying platform (operating system, virtual memory, compiler, linker, etc). Typically, the entire executable image is loaded into RAM. Sometimes parts of it may be &quot;swapped out&quot; into the hard-disk, in order to &quot;make room&quot; for other applications. But basically, when it&#39;s running - it is running from the RAM (again, depending on your platform - for example, there are HW architectures which run everything from Flash)."}, {"owner": {"reputation": 27385, "user_id": 1382251, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/17622c39e8ead537a0944c767551b2fe?s=128&d=identicon&r=PG", "display_name": "barak manos", "link": "https://stackoverflow.com/users/1382251/barak-manos"}, "reply_to_user": {"reputation": 661, "user_id": 2425460, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/840e7165882bdc3499f4e4c33d8ca353?s=128&d=identicon&r=PG", "display_name": "Able Eldhose", "link": "https://stackoverflow.com/users/2425460/able-eldhose"}, "edited": false, "score": 1, "creation_date": 1472099186, "post_id": 39115358, "comment_id": 65618172, "body": "While the executable image is running from RAM, different access-privileges are defined for different sections within that image. For example, the code-section is definitely RO. The stack is RW. The data section (global and/or static variables) is typically divided into RO and RW. But it&#39;s not like the RO sections actually reside in a &quot;physically&quot; RO storage unit. It&#39;s just that any memory-access attempt goes through the MMU (memory management unit), and if the attempt is illegal, then a bus-fault exception is raised."}], "tags": [], "owner": {"reputation": 27385, "user_id": 1382251, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/17622c39e8ead537a0944c767551b2fe?s=128&d=identicon&r=PG", "display_name": "barak manos", "link": "https://stackoverflow.com/users/1382251/barak-manos"}, "is_accepted": true, "score": 5, "last_activity_date": 1472017858, "creation_date": 1472017858, "answer_id": 39115358, "question_id": 39115264, "link": "https://stackoverflow.com/questions/39115264/how-does-the-system-knew-that-an-address-being-accessed-is-constant-or-not/39115358#39115358", "title": "How does the system knew that an address being accessed is constant or not", "body": "<p>Strictly speaking, your code yields undefined behavior according to the C-language standard.</p>\n\n<p>In practice, the linker has probably placed the variable <code>i</code> in a RO section of the executable image.</p>\n\n<p>So the write-operation <code>*p = 10</code> resulted in a memory-access violation (aka <em>segmentation fault</em>).</p>\n"}, {"tags": [], "owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "is_accepted": false, "score": 4, "last_activity_date": 1472019871, "last_edit_date": 1472019871, "creation_date": 1472019142, "answer_id": 39115629, "question_id": 39115264, "link": "https://stackoverflow.com/questions/39115264/how-does-the-system-knew-that-an-address-being-accessed-is-constant-or-not/39115629#39115629", "title": "How does the system knew that an address being accessed is constant or not", "body": "<blockquote>\n  <p><em>How does the system knew ....</em></p>\n</blockquote>\n\n<p>Ideally, the <em>system</em> does not need to <strong>know</strong>. For objects with <code>const</code>-qualified type, the allocation (in general) will be in read-only section, so any attempt to modify (write) will cause access violation. It's the programmer who should know.</p>\n\n<blockquote>\n  <p><em>When I printed the address of <code>const</code> variables and normal variables, I can see that they are in different offsets.</em></p>\n</blockquote>\n\n<p>Yes, that's likely, because the <em>normal</em> variables reside in read-write memory, whereas <code>const</code> variables will reside in read-only memory.</p>\n\n<p>Please notice, there's <strong>no syntax (or compilation) error</strong> for your code snippet. It's only the behavior of the code (runtime) is undefined.</p>\n\n<p>FYI, quoting <code>C11</code>, chapter \u00a76.7.3/p6</p>\n\n<blockquote>\n  <p>If an attempt is made to modify an object defined with a const-qualified type through use\n  of an lvalue with non-const-qualified type, the behavior is undefined. [...]</p>\n</blockquote>\n"}], "owner": {"reputation": 661, "user_id": 2425460, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/840e7165882bdc3499f4e4c33d8ca353?s=128&d=identicon&r=PG", "display_name": "Able Eldhose", "link": "https://stackoverflow.com/users/2425460/able-eldhose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 39115358, "answer_count": 2, "score": 3, "last_activity_date": 1472019871, "creation_date": 1472017497, "last_edit_date": 1472019784, "question_id": 39115264, "link": "https://stackoverflow.com/questions/39115264/how-does-the-system-knew-that-an-address-being-accessed-is-constant-or-not", "title": "How does the system knew that an address being accessed is constant or not", "body": "<p>Writing to a constant variable using a pointer is giving run time error.</p>\n\n<pre><code>const int i;\nint *p;\nvoid main()\n{\n    p = (int*)&amp;i;\n    *p = 10;         // Causes runtime error\n}\n</code></pre>\n\n<p>But in a windows system everything is running from RAM itself.</p>\n\n<p>When I printed the address of const variables and normal variables, I can see that they are in different offsets.</p>\n\n<p>How does the system know that the address being accessed by the pointer is a <code>const</code> one?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1472012606, "post_id": 39114334, "comment_id": 65575582, "body": "Post definition of <code>opcion</code>."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1472015224, "post_id": 39114334, "comment_id": 65576367, "body": "You have set circleProgram as a signal handler for SIGALRM. When a SIGALRM is raised, the operating system seems to assume that your program is busy processing that SIGALRM until your signal handler returns, so it won&#39;t send you another one."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1472045976, "post_id": 39114334, "comment_id": 65595368, "body": "You&#39;re also likely deadlocking - you can only use <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/V2_chap02.html#tag_15_04\" rel=\"nofollow noreferrer\">async-signal-safe</a> functions in a signal handler.  Page down - there&#39;s a list of functions that POSIX requires to be async-signal-safe.  In your implementation, you&#39;re likely to be in <code>getchar()</code> waiting for input when the alarm signal is sent which causes another invocation of <code>circleprogram()</code> to be started asynchronously - outside the normal program flow.  That tries to call <code>getchar()</code> but the original call has the input stream locked - a deadlock."}, {"owner": {"reputation": 11, "user_id": 6750623, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210365413910454/picture?type=large", "display_name": "DAM", "link": "https://stackoverflow.com/users/6750623/dam"}, "edited": false, "score": 0, "creation_date": 1475120651, "post_id": 39114334, "comment_id": 66817554, "body": "so could i add some control in that &quot;while&quot; in order to evaluate the signal alarm and avoid the deadlock?  thanks!"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1476989697, "post_id": 39114334, "comment_id": 67593616, "body": "Welcome to Stack Overflow. Please note that the preferred way of saying &#39;thanks&#39; around here is by up-voting good questions and helpful answers (once you have enough reputation to do so), and by accepting the most helpful answer to any question you ask (which also gives you a small boost to your reputation). Please see the <a href=\"https://stackoverflow.com/tour\">About</a> page and also <a href=\"http://stackoverflow.com/help/how-to-ask\">How do I ask questions here?</a> and <a href=\"http://stackoverflow.com/help/someone-answers\">What do I do when someone answers my question?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6750623, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210365413910454/picture?type=large", "display_name": "DAM", "link": "https://stackoverflow.com/users/6750623/dam"}, "edited": false, "score": 0, "creation_date": 1475120619, "post_id": 39114828, "comment_id": 66817548, "body": "so could i add some control in that &quot;while&quot; in order to evaluate the signal alarm and avoid the deadlock?  thanks!"}, {"owner": {"reputation": 11, "user_id": 6750623, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210365413910454/picture?type=large", "display_name": "DAM", "link": "https://stackoverflow.com/users/6750623/dam"}, "edited": false, "score": 0, "creation_date": 1475170543, "post_id": 39114828, "comment_id": 66847469, "body": "thanks a lot!   After I&#39;ll prove that code of you and i&#39;ll see what happens more closely  really thanks"}, {"owner": {"reputation": 11, "user_id": 6750623, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210365413910454/picture?type=large", "display_name": "DAM", "link": "https://stackoverflow.com/users/6750623/dam"}, "edited": false, "score": 0, "creation_date": 1476989432, "post_id": 39114828, "comment_id": 67593448, "body": "it works very nice! and I got the reference I needed so it was very usefull! thanks a lot"}], "tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": false, "score": 1, "last_activity_date": 1475122314, "last_edit_date": 1495535549, "creation_date": 1472015264, "answer_id": 39114828, "question_id": 39114334, "link": "https://stackoverflow.com/questions/39114334/sigalrm-alarm-only-skips-getchar-once/39114828#39114828", "title": "SIGALRM alarm only skips getchar once", "body": "<p>You're using <code>cicleProgram()</code> as your signal handler (despite it having the wrong type \u2014 it should take an <code>int</code> argument).  That means you never return from the signal handler until you type <code>q</code> or <code>Q</code>, and the system is probably blocking the signal until the first signal handler returns.  So, you never get the second signal \u2014 it is blocked.</p>\n\n<p>Use a separate signal handler function.  See also <a href=\"https://stackoverflow.com/questions/231912/\">What is the difference between <code>sigaction()</code> and <code>signal()</code>?</a> and use <code>sigaction()</code> in preference to <code>signal()</code>.</p>\n\n<p>And use <code>int main(void)</code> \u2014 with at least the return type.  Even the old (C99) version of the standard requires that, let alone the current (C11) standard.  We've progressed to the 21st Century; don't code in 20th Century C!</p>\n\n<p>See also <a href=\"https://stackoverflow.com/questions/16891019/\">How to avoid using <code>printf()</code> in a signal handler?</a> for information on what you can do in a signal handler.</p>\n\n<hr>\n\n<blockquote>\n  <p>Could I add some control in that \"while\" in order to evaluate the signal alarm and avoid the deadlock?</p>\n</blockquote>\n\n<p>There are multiple problems with the original code, and not all possible problems were diagnosed.  An additional problem was that if the alarm fired, there was nothing to set the alarm again, so the program falls into waiting until you type a character.</p>\n\n<p>Here's some experimental code you play with:</p>\n\n<pre><code>#include &lt;assert.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n\nstatic int duration = 2;\nstatic volatile sig_atomic_t alarm_fired = 0;\n\nstatic void alarm_handler(int signum)\n{\n    //signal(SIGALRM, alarm_handler);\n    write(STDOUT_FILENO, \"Signalled!\\n\", 11);\n    alarm_fired = signum;\n    alarm(duration);\n}\n\nstatic void cicleProgram(void)\n{\n    int opcion = 0;\n    while (opcion != 'q' &amp;&amp; opcion != 'Q')\n    {\n        signal(SIGALRM, alarm_handler);\n        alarm(duration);\n        if ((opcion = getchar()) == EOF)\n            clearerr(stdin);\n        if (alarm_fired)\n        {\n            alarm_fired = 0;\n            printf(\"Alarm!\\n\");\n        }\n        printf(\"c = %d\\n\", opcion);\n    }\n}\n\nstatic void actionProgram(void)\n{\n    struct sigaction sa = { 0 };\n    sa.sa_handler = alarm_handler;\n    sa.sa_flags = 0;\n    sigfillset(&amp;sa.sa_mask);\n    sigaction(SIGALRM, &amp;sa, 0);\n\n    int opcion = 0;\n    while (opcion != 'q' &amp;&amp; opcion != 'Q')\n    {\n        alarm(duration);\n        if ((opcion = getchar()) == EOF)\n            clearerr(stdin);\n        if (alarm_fired)\n        {\n            alarm_fired = 0;\n            printf(\"Alarm!\\n\");\n        }\n        printf(\"c = %d\\n\", opcion);\n    }\n}\n\nint main(void)\n{\n    printf(\"Using signal (q to quit):\\n\");\n    cicleProgram();\n    printf(\"Using sigaction (q to quit):\\n\");\n    actionProgram();\n    return 0;\n}\n</code></pre>\n\n<p>There are two active functions, each with a loop.  The first is based on your original <code>cicleProgram()</code> but the function has been revamped; it is no longer the signal handler.  I am running on Mac OS X (BSD-based), and these systems do not require you to reset the <code>signal()</code> handler in the signal handler function.  The second function, <code>actionProgram()</code>, uses <code>sigaction()</code> instead of <code>signal()</code>.  It probably isn't necessary, but it gives you something to look at.  The absence of <code>SA_RESTART</code> in the <code>sa.sa_flags</code> element means that the <code>read()</code> system call reports that it was interrupted each time the signal goes off.  The code in the <code>signal_handler()</code> doesn't use disallowed function calls.</p>\n\n<p>Example output (program name <code>al97</code>):</p>\n\n<pre><code>$ ./al97\nUsing signal (q to quit):\nSignalled!\nSignalled!\nSignalled!\nSignalled!\nWonderfulSignalled!\n\nAlarm!\nc = 87\nc = 111\nc = 110\nc = 100\nc = 101\nc = 114\nc = 102\nc = 117\nc = 108\nc = 10\nSignalled!\nSignalled!\nq\nAlarm!\nc = 113\nUsing sigaction (q to quit):\nc = 10\nSignalled!\nAlarm!\nc = -1\nSignalled!\nAlarm!\nc = -1\nSignalled!\nAlarm!\nc = -1\nSignalled!\nAlarm!\nc = -1\nASignalled!\nAlarm!\nc = -1\nlso workingSignalled!\nAlarm!\nc = -1\n\nc = 65\nc = 108\nc = 115\nc = 111\nc = 32\nc = 119\nc = 111\nc = 114\nc = 107\nc = 105\nc = 110\nc = 103\nc = 10\nqSignalled!\nAlarm!\nc = -1\n\nc = 113\n$\n</code></pre>\n\n<p>There were some quite long pauses in the run, but you can experiment on your machine.  You may need to reinclude the <code>signal()</code> in the <code>alarm_handler()</code> function for <code>cicleProgram()</code> and use a different handler (that doesn't use <code>signal()</code>, as now) for <code>actionProgram()</code>.</p>\n"}], "owner": {"reputation": 11, "user_id": 6750623, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210365413910454/picture?type=large", "display_name": "DAM", "link": "https://stackoverflow.com/users/6750623/dam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 290, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1475122314, "creation_date": 1472012188, "last_edit_date": 1472012701, "question_id": 39114334, "link": "https://stackoverflow.com/questions/39114334/sigalrm-alarm-only-skips-getchar-once", "title": "SIGALRM alarm only skips getchar once", "body": "<p>I'm just using the function <code>alarm</code> to skip the <code>getchar</code>, but something is not going well because it only skips once, and I want it indefinitely.   </p>\n\n<p>Example:</p>\n\n<pre><code>#include &lt;signal.h&gt;\n\nint duration = 2;\n\nmain() {\n     cicleProgram();\n}\n\nvoid cicleProgram(){\n\n  while(opcion != 'q' &amp;&amp; opcion != 'Q'){\n\n    signal(SIGALRM, (void*)cicleProgram);\n    alarm(duration);\n\n    opcion = getchar();\n  }\n}\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["c", "data-structures", "linked-list"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 3, "creation_date": 1472011927, "post_id": 39114264, "comment_id": 65575403, "body": "Learn how to use a debugger, and how to step through your code line by line while monitoring variables an their values."}, {"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 1, "creation_date": 1472012264, "post_id": 39114264, "comment_id": 65575495, "body": "<code>next=current;</code> --&gt; <code>next=current-&gt;next;</code>"}, {"owner": {"reputation": 31, "user_id": 6547375, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4735af83559a5d5802ab89d2b988167c?s=128&d=identicon&r=PG&f=1", "display_name": "user6547375", "link": "https://stackoverflow.com/users/6547375/user6547375"}, "reply_to_user": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472012841, "post_id": 39114264, "comment_id": 65575638, "body": "@BLUEPIXY Thanks I got the mistake"}], "answers": [{"tags": [], "owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "is_accepted": false, "score": 4, "last_activity_date": 1472014975, "last_edit_date": 1472014975, "creation_date": 1472014454, "answer_id": 39114674, "question_id": 39114264, "link": "https://stackoverflow.com/questions/39114264/reverse-link-list-is-not-printing-while-using-reverse-iteration-method/39114674#39114674", "title": "Reverse Link List is not printing while using reverse iteration method", "body": "<p>You have two problems with the code.</p>\n\n<p>1) <code>next=current;</code> should be <code>next=current-&gt;next;</code> as pointed out by @BLUEPIXY in a comment</p>\n\n<p>2) After calling <code>reverse</code> you have lost your list, i.e. <code>head</code> in main is no longer pointing to head of the list. To fix this you could do:</p>\n\n<pre><code>struct node* reverse(struct node *head)\n{\n    ....\n    return head;\n}\n</code></pre>\n\n<p>and in <code>main</code></p>\n\n<pre><code>head = reverse(head);\n</code></pre>\n\n<p>Another solution is:</p>\n\n<pre><code>void reverse(struct node **head) { ... }\n                          ^\n                          notice\n\n// Called from main as: reverse(&amp;head);\n</code></pre>\n\n<p>and then dereference <code>head</code> before use in the function. This will make changes to <code>*head</code> in the function to change <code>head</code> in <code>main</code>.</p>\n\n<p>BTW: Don't cast the value returned by <code>malloc</code></p>\n"}], "owner": {"reputation": 31, "user_id": 6547375, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4735af83559a5d5802ab89d2b988167c?s=128&d=identicon&r=PG&f=1", "display_name": "user6547375", "link": "https://stackoverflow.com/users/6547375/user6547375"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1472020058, "creation_date": 1472011712, "last_edit_date": 1472020058, "question_id": 39114264, "link": "https://stackoverflow.com/questions/39114264/reverse-link-list-is-not-printing-while-using-reverse-iteration-method", "title": "Reverse Link List is not printing while using reverse iteration method", "body": "<p>I am trying to print the link list in reverse order but when I run it it's not printing it out. It is just stopping after printing the correct order and the output screen hangs after that. Here's my code:</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;conio.h&gt;\n#include&lt;stdlib.h&gt;\nstruct node{\n    int data;\n    struct node *next;\n};\nvoid reverse(struct node*);\nvoid main()\n{\n    struct node *a;\n    char ch;\n    struct node *temp;\n    struct node *temp1;\n    a=NULL;\n    clrscr();\n    do\n    {\n    if(a==NULL)\n    {\n        temp=(struct node*)malloc(sizeof(struct node));\n        printf(\"Enter Data\");\n        scanf(\"%d\",&amp;temp-&gt;data);\n        temp-&gt;next=NULL;\n        a=temp;\n    }\n       else\n    {\n    temp=(struct node*)malloc(sizeof(struct node));\n    temp-&gt;next=NULL;\n    printf(\"Enter data element\");\n    scanf(\"%d\",&amp;temp-&gt;data);\n    temp1=a;\n    while(temp1-&gt;next!=NULL)\n        {\n        temp1=temp1-&gt;next;\n        }\n    temp1-&gt;next=temp;\n    }\n    printf(\"Do You Wish to continue\");\n    ch=getch();\n    }\n    while(ch=='Y'||ch=='y');\n    printf(\"Status of the link list\");\n    temp1=a;\n    while(temp1!=NULL)\n    {\n    printf(\"%d \",temp1-&gt;data);\n    temp1=temp1-&gt;next;\n    }\n    reverse(a);\n    getch();\n}\nvoid reverse(struct node *head)\n{\nstruct node *prev,*current,*next,*t;\ncurrent=head;\nprev=NULL;\nwhile(current!=NULL)\n    {\n    next=current;\n    current-&gt;next=prev;\n    prev=current;\n    current=next;\n    }\nhead=prev;\nprintf(\"Displaying in reverse order\");\nt=head;\nwhile(t!=NULL)\n    {\n    printf(\"%d\",t-&gt;data);\n    t=t-&gt;next;\n    }\n\n}\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1472011585, "post_id": 39114247, "comment_id": 65575311, "body": "It initializes an array of four <code>PRE256</code> structures."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 2, "creation_date": 1472015331, "post_id": 39114247, "comment_id": 65576412, "body": "I don&#39;t see any function here."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472015620, "post_id": 39114247, "comment_id": 65576523, "body": "In future, please don&#39;t include massive blocks of comments, especially with extraneous blank lines in between each comment line.  They provide no useful information in a question like this \u2014 they simply get in the way."}], "answers": [{"tags": [], "owner": {"reputation": 2258, "user_id": 3399105, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh6.googleusercontent.com/-twhyJ9NJTFw/AAAAAAAAAAI/AAAAAAAAADA/Nwa0s-0HXvA/photo.jpg?sz=128", "display_name": "Shahid", "link": "https://stackoverflow.com/users/3399105/shahid"}, "is_accepted": false, "score": 3, "last_activity_date": 1472015469, "last_edit_date": 1472015469, "creation_date": 1472011597, "answer_id": 39114251, "question_id": 39114247, "link": "https://stackoverflow.com/questions/39114247/explanation-of-a-function/39114251#39114251", "title": "Explanation of a function", "body": "<p>This is not a function. The first part is a <code>typedef</code> that defines a <a href=\"https://en.wikipedia.org/wiki/Struct_(C_programming_language)\" rel=\"nofollow\">structure</a>. And the latter is the definition of an initialized array of the structure type <code>PRE25G</code>.</p>\n"}], "owner": {"reputation": 129, "user_id": 6740465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3c536c232db5517b33b94e454299bb5?s=128&d=identicon&r=PG&f=1", "display_name": "ab bc", "link": "https://stackoverflow.com/users/6740465/ab-bc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": -7, "last_activity_date": 1472015469, "creation_date": 1472011517, "last_edit_date": 1472015362, "question_id": 39114247, "link": "https://stackoverflow.com/questions/39114247/explanation-of-a-function", "title": "Explanation of a function", "body": "<p>Could anyone can tell what the following code does?  Does it write or read on a table ? This is a function in program. I am trying to understand the program.If anyone reply with explanation it will be great help.</p>\n\n<pre><code>typedef struct {\n  short a[16];\n} PRE25G;\n\nPRE25G pre25g_g[4] = {\n    1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,           /*1*/\n    1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,           /*2*/\n    1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,           /*3*/\n    1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0            /*4*/\n};\n</code></pre>\n"}, {"tags": ["c", "macos", "debug-symbols"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1472011845, "post_id": 39114234, "comment_id": 65575377, "body": "Compile and link with the <code>-g</code> option.  The debugging information ends up in <code>program.dSYM</code> directory \u2014 automatically when you link a program from a single object file, or when you run <code>dsymutil program</code>."}, {"owner": {"reputation": 6516, "user_id": 1364726, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/abdb670e1c130f96f947a94d03c02efa?s=128&d=identicon&r=PG", "display_name": "echristopherson", "link": "https://stackoverflow.com/users/1364726/echristopherson"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472049666, "post_id": 39114234, "comment_id": 65598240, "body": "The Makefile is already building everything (including the final binary) with <code>-g -O0</code>."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472049793, "post_id": 39114234, "comment_id": 65598325, "body": "Good. That&#39;s necessary but not sufficient."}], "owner": {"reputation": 6516, "user_id": 1364726, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/abdb670e1c130f96f947a94d03c02efa?s=128&d=identicon&r=PG", "display_name": "echristopherson", "link": "https://stackoverflow.com/users/1364726/echristopherson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 206, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472011394, "creation_date": 1472011394, "question_id": 39114234, "link": "https://stackoverflow.com/questions/39114234/how-can-i-build-and-install-a-c-program-on-os-x-with-debugging-symbols", "title": "How can I build and install a C program on OS X with debugging symbols?", "body": "<p>How can I build and install a C program with debugging symbols on OS X?</p>\n\n<p>I'm trying to build something (<a href=\"http://www.mutt.org/\" rel=\"nofollow\">mutt</a>) with debugging symbols on OS X, to help me track down a crash. I'm basically following the Homebrew formula for mutt in my build process. But no matter what I try, the resulting binary has no debugging symbols. I build it with <code>CFLAGS='-g -O0'</code> (after having also tried the default <code>'-g -O2'</code> in the Makefile). I can see when I see the make output go by that it is using these flags as it should be, and I don't see any <code>strip</code> or <code>install -s</code> invocations; but the resulting binary has no debugging symbols, as seen by trying to run it in gdb or lldb, or running dsymutil on it.</p>\n\n<p>I'm trying to understand <a href=\"http://valgrind.org/docs/manual/manual-core.html#manual-core.erropts\" rel=\"nofollow\">the Valgrind instructions</a> on the matter; basically, they say that the linker on OS X doesn't actually put debug symbols that exist in the object files into the linked result -- I read that as saying you have to run dsymutil on the linked result, but I'm a little unsure as to whether that automatically pulls in the symbols from the object files, or if there's some way I need to specify them.</p>\n\n<p>And even if I knew exactly how to use dsymutil here, I don't see that there are any debug symbols in any of the .o files.</p>\n\n<p>Finally, I'm wondering if a \"proper\" installation, once I got the debugging symbols into the binary, would copy that .dSYM directory into /usr/local/bin along with mutt; or if it would go somewhere else. I know in Debian-based systems you can install specifically debuggable versions of libraries using the package manager, but I don't know if it's a best practice (or even a practice that's common) to actually install things with debug symbols in OS X. If nothing else, I can probably just run the debuggable binary from its build directory, so this doesn't seem like a big deal.</p>\n\n<p>I've tried building with gcc and clang, with the same disappointing results.</p>\n"}, {"tags": ["c", "gcc", "x86", "vectorization", "simd"], "comments": [{"owner": {"reputation": 6779, "user_id": 1691223, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/c2AsP.jpg?s=128&g=1", "display_name": "Shravan40", "link": "https://stackoverflow.com/users/1691223/shravan40"}, "edited": false, "score": 0, "creation_date": 1472011359, "post_id": 39114159, "comment_id": 65575257, "body": "Choose one language. C and C++ are different language."}, {"owner": {"reputation": 4426, "user_id": 450609, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6708bd9ccabfcb1cf6863fb32f32d1de?s=128&d=identicon&r=PG", "display_name": "dave", "link": "https://stackoverflow.com/users/450609/dave"}, "reply_to_user": {"reputation": 6779, "user_id": 1691223, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/c2AsP.jpg?s=128&g=1", "display_name": "Shravan40", "link": "https://stackoverflow.com/users/1691223/shravan40"}, "edited": false, "score": 0, "creation_date": 1472011536, "post_id": 39114159, "comment_id": 65575298, "body": "@Shravan40: The original question was tagged C and is asking about C, the C++ edit was by someone else (now reverted)."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 4593, "user_id": 105104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b23920ac852e946b333d3f9d0d95c1?s=128&d=identicon&r=PG", "display_name": "dvhh", "link": "https://stackoverflow.com/users/105104/dvhh"}, "edited": false, "score": 3, "creation_date": 1472011553, "post_id": 39114159, "comment_id": 65575300, "body": "@dvhh: the code is fairly clearly not using C++ <code>vector</code> template notation and the title says &#39;C&#39;, not &#39;C++&#39;.  I don&#39;t see why C++ is appropriate.  I assume that at one point it had both tags, but that seems to have been fixed."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 4, "creation_date": 1472011582, "post_id": 39114159, "comment_id": 65575308, "body": "If you want <code>memcpy</code>, just use <code>memcpy</code>."}, {"owner": {"reputation": 4426, "user_id": 450609, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6708bd9ccabfcb1cf6863fb32f32d1de?s=128&d=identicon&r=PG", "display_name": "dave", "link": "https://stackoverflow.com/users/450609/dave"}, "reply_to_user": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1472012846, "post_id": 39114159, "comment_id": 65575641, "body": "@DavidSchwartz: does memcpy produce the efficient code wanted on your machine?"}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "reply_to_user": {"reputation": 4426, "user_id": 450609, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6708bd9ccabfcb1cf6863fb32f32d1de?s=128&d=identicon&r=PG", "display_name": "dave", "link": "https://stackoverflow.com/users/450609/dave"}, "edited": false, "score": 0, "creation_date": 1472012899, "post_id": 39114159, "comment_id": 65575655, "body": "@dave If <code>memcpy</code>, given all the information, didn&#39;t produce the most efficient code on my machine, I&#39;d use a better compiler/library/whatever. What possible excuse is there for not doing it the best way?"}, {"owner": {"reputation": 27385, "user_id": 1382251, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/17622c39e8ead537a0944c767551b2fe?s=128&d=identicon&r=PG", "display_name": "barak manos", "link": "https://stackoverflow.com/users/1382251/barak-manos"}, "edited": false, "score": 0, "creation_date": 1472015383, "post_id": 39114159, "comment_id": 65576432, "body": "Unless your HW architecture supports 256-bit load/store operations, I don&#39;t see any reason to hope that the assignment operation of <code>v = a</code> (even if you somehow find the correct syntax for it) will be compiled into a single opcode. If it doesn&#39;t support 128-bit load/store operations either, then you may as well copy these 4 values one by one (as you are currently doing)."}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 0, "creation_date": 1472018778, "post_id": 39114159, "comment_id": 65577737, "body": "why don&#39;t just use <code>_m256_loadu_pd</code>?"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1472018990, "post_id": 39114159, "comment_id": 65577802, "body": "@2501: IIRC, GNU C Vector Extension pointers are defined as <code>may_alias</code>.    At least the Intel intrinsic types (like <code>__m256d</code>) are defined that way in GNU C, so it&#39;s safe to mix vector loads/stores to an array of <code>double</code> with scalar loads/stores to the same array, and casting <code>double*</code> to <code>__m256d*</code>.  But anyway, that doesn&#39;t explain the segfault.  Failure to detect aliasing leads to loading bogus data, not segfaults (at least not directly.  Sure you could construct a case where something uses a stale or uninitialized pointer, but this isn&#39;t like that.)"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 27385, "user_id": 1382251, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/17622c39e8ead537a0944c767551b2fe?s=128&d=identicon&r=PG", "display_name": "barak manos", "link": "https://stackoverflow.com/users/1382251/barak-manos"}, "edited": false, "score": 0, "creation_date": 1472019437, "post_id": 39114159, "comment_id": 65577986, "body": "@barakmanos: he <i>is</i> compiling for a target that supports 256b load/store operations; specifically x86 with AVX.  Even baseline x86-64 includes 128b SSE2.  (Most architectures these days have 128b SIMD vectors.  ARM, MIPS, PowerPC, and x86 all have more or less widely supported vector extensions.  256b vectors may be unique to x86, though.)"}, {"owner": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "edited": false, "score": 0, "creation_date": 1472064334, "post_id": 39114159, "comment_id": 65607134, "body": "In this particular example, you could write directly <code>vector v = {1.0, 2.0, 3.0, 4.0};</code>, although I expect this was just to demonstrate the problem."}, {"owner": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1472064500, "post_id": 39114159, "comment_id": 65607228, "body": "@PeterCordes may_alias is not necessary to let the types vector of double and double alias (just like array of double can alias double). <code>__m256d</code> is may_alias because the Intel specs want all the vector types of the same size to be compatible."}], "answers": [{"comments": [{"owner": {"reputation": 4426, "user_id": 450609, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6708bd9ccabfcb1cf6863fb32f32d1de?s=128&d=identicon&r=PG", "display_name": "dave", "link": "https://stackoverflow.com/users/450609/dave"}, "edited": false, "score": 0, "creation_date": 1472013101, "post_id": 39114457, "comment_id": 65575713, "body": "can you show the output of <code>gcc -S</code> which shows whether the compiler did separate copies or used the SSE instructions?"}, {"owner": {"reputation": 62, "user_id": 5927989, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xW8hmrJemB8/AAAAAAAAAAI/AAAAAAAAqvw/JuEgdyq1BKk/photo.jpg?sz=128", "display_name": "Miguel Sosa", "link": "https://stackoverflow.com/users/5927989/miguel-sosa"}, "reply_to_user": {"reputation": 4426, "user_id": 450609, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6708bd9ccabfcb1cf6863fb32f32d1de?s=128&d=identicon&r=PG", "display_name": "dave", "link": "https://stackoverflow.com/users/450609/dave"}, "edited": false, "score": 0, "creation_date": 1472014275, "post_id": 39114457, "comment_id": 65576006, "body": "My assembly is rusty and I am in a mac using clang, but you should be able to build the example above to verify.  You can split these into two files, one with c_ptr and one with c_copy and check. On my machine, when I compile with -O3, both of the examples compile to the same .s file but that is likely because the optimizer realizes that I am not modifying v_copy so it optimizes the memmove away."}], "tags": [], "owner": {"reputation": 62, "user_id": 5927989, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xW8hmrJemB8/AAAAAAAAAAI/AAAAAAAAqvw/JuEgdyq1BKk/photo.jpg?sz=128", "display_name": "Miguel Sosa", "link": "https://stackoverflow.com/users/5927989/miguel-sosa"}, "is_accepted": false, "score": -2, "last_activity_date": 1472032738, "last_edit_date": 1472032738, "creation_date": 1472013035, "answer_id": 39114457, "question_id": 39114159, "link": "https://stackoverflow.com/questions/39114159/how-do-you-load-store-from-to-an-array-of-doubles-with-gnu-c-vector-extensions/39114457#39114457", "title": "How do you load/store from/to an array of doubles with GNU C Vector Extensions?", "body": "<p>If you don't need to get a copy of a, use a pointer instead (see v_ptr in example). If you need a copy, use memmove (see v_copy)</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\ntypedef double vector __attribute__((vector_size(4 * sizeof(double))));\n\nint main(int argc, char **argv) {\n  double a[4] = {1.0, 2.0, 3.0, 4.0};\n  vector *v_ptr;\n  vector v_copy;\n\n  v_ptr = (vector*)&amp;a;\n  memmove(&amp;v_copy, a, sizeof(a));\n\n  printf(\"a[0] = %f // v[0] = %f // v_copy[0] = %f\\n\", a[0], (*v_ptr)[0], v_copy[0]);\n  printf(\"a[2] = %f // v[2] = %f // v_copy[0] = %f\\n\", a[2], (*v_ptr)[2], v_copy[2]);\n  return 0;\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>a[0] = 1.000000 // v[0] = 1.000000 // v_copy[0] = 1.000000\na[2] = 3.000000 // v[2] = 3.000000 // v_copy[0] = 3.000000\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1472016990, "post_id": 39114882, "comment_id": 65577059, "body": "That&#39;s not portable to non-x86 platforms.  I just realized that&#39;s what the OP is doing."}, {"owner": {"reputation": 4426, "user_id": 450609, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6708bd9ccabfcb1cf6863fb32f32d1de?s=128&d=identicon&r=PG", "display_name": "dave", "link": "https://stackoverflow.com/users/450609/dave"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1472021393, "post_id": 39114882, "comment_id": 65578989, "body": "@PeterCordes: You are right, I&#39;ve added a note that this is for x86 (which is what I thought OP wanted).  Your answer is still better though."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1472022056, "post_id": 39114882, "comment_id": 65579335, "body": "Let me know if you come across a platform-independent way to write vector loads/stores with GNU C vector extensions.  I find it super-weird that there isn&#39;t a portable aligned / unaligned load/store builtin, only the platform-specific builtins.  Maybe you are supposed to pointer-cast and dereference?  Anyway, upvoted your answer for pointing out the GNU C builtin that <code>_mm256_loadu_pd</code> is implemented on top of."}, {"owner": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "edited": false, "score": 3, "creation_date": 1472063917, "post_id": 39114882, "comment_id": 65606896, "body": "Please don&#39;t use those builtins. The only advantage over intrinsics is that you don&#39;t need a #include. But it may be removed from gcc in the future."}], "tags": [], "owner": {"reputation": 4426, "user_id": 450609, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6708bd9ccabfcb1cf6863fb32f32d1de?s=128&d=identicon&r=PG", "display_name": "dave", "link": "https://stackoverflow.com/users/450609/dave"}, "is_accepted": false, "score": 1, "last_activity_date": 1472021328, "last_edit_date": 1472021328, "creation_date": 1472015547, "answer_id": 39114882, "question_id": 39114159, "link": "https://stackoverflow.com/questions/39114159/how-do-you-load-store-from-to-an-array-of-doubles-with-gnu-c-vector-extensions/39114882#39114882", "title": "How do you load/store from/to an array of doubles with GNU C Vector Extensions?", "body": "<p>You can use the equivalent intrinsics from gcc for x86: __builtin_ia32_loadupd256 (<a href=\"https://gcc.gnu.org/onlinedocs/gcc/x86-Built-in-Functions.html#x86-Built-in-Functions\" rel=\"nofollow\">https://gcc.gnu.org/onlinedocs/gcc/x86-Built-in-Functions.html#x86-Built-in-Functions</a>).</p>\n\n<p>So something like:</p>\n\n<pre><code>typedef double v4df __attribute__((vector_size(4 * sizeof(double))));\n\nvoid vector_copy(double *a, v4df *v)\n{\n    *v = __builtin_ia32_loadupd256(a);\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "edited": false, "score": 1, "creation_date": 1472064188, "post_id": 39115055, "comment_id": 65607042, "body": "Using attribute aligned seems like the normal way to load/store vectors in unaligned memory."}, {"owner": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "edited": false, "score": 1, "creation_date": 1472645291, "post_id": 39115055, "comment_id": 65834146, "body": "And that&#39;s even how gcc implements _mm256_loadu_pd now ;-) <a href=\"https://gcc.gnu.org/viewcvs/gcc/trunk/gcc/config/i386/avxintrin.h?revision=239889&amp;view=markup#l868\" rel=\"nofollow noreferrer\">gcc.gnu.org/viewcvs/gcc/trunk/gcc/config/i386/&hellip;</a>"}], "tags": [], "owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": false, "score": 4, "last_activity_date": 1472018270, "last_edit_date": 1495540423, "creation_date": 1472016377, "answer_id": 39115055, "question_id": 39114159, "link": "https://stackoverflow.com/questions/39114159/how-do-you-load-store-from-to-an-array-of-doubles-with-gnu-c-vector-extensions/39115055#39115055", "title": "How do you load/store from/to an array of doubles with GNU C Vector Extensions?", "body": "<p>update: I see you're using GNU C's native vector syntax, not Intel intrinsics.  Are you avoiding Intel intrinsics for portability to non-x86?  gcc currently does a bad job compiling code that uses GNU C vectors wider than the target machine supports.  (You'd hope that it would just use two 128b vectors and operate on each separately, but apparently it's worse than that.)</p>\n\n<p>Anyway, <strong>this answer shows how you can use Intel x86 intrinsics to load data into GNU C vector-syntax types</strong></p>\n\n<hr>\n\n<p>First of all, looking at compiler output at less than <code>-O2</code> is a waste of time if you're trying to learn anything about what will compile to good code.  Your <code>main()</code> will optimize to just a <code>ret</code> at -O2.</p>\n\n<p>Besides that, it's not totally surprising that you get bad asm from assigning elements of a vector one at a time.</p>\n\n<hr>\n\n<p>Aside: normal people would call the type <code>v4df</code> (vector of 4 Double Float) or something, not <code>vector</code>, so they don't go insane when using it with C++ <code>std::vector</code>.  For single-precision, <code>v8sf</code>.  IIRC, gcc uses type names like this internally for <code>__m256d</code>.</p>\n\n<p>On x86, Intel intrinsic types (like <code>__m256d</code>) are implemented on top of GNU C vector syntax (which is why you can do <code>v1 * v2</code> in GNU C instead of writing <code>_mm256_mul_pd(v1, v2)</code>).  You can convert freely from <code>__m256d</code> to <code>v4df</code>, like I've done here.</p>\n\n<p><strong>I've wrapped both sane ways to do this in functions, so we can look at their asm</strong>.  Notice how we're not loading from an array that we define inside the same function, so the compiler won't optimize it away.</p>\n\n<p>I put them on the <a href=\"http://gcc.godbolt.org/#compilers:!((compiler:g6,options:&#39;-xc+-std%3Dgnu11+-Wall+-Wextra++-O3+-fverbose-asm+-march%3Dhaswell&#39;,source:&#39;typedef+double+v4df+__attribute__((vector_size(4+*+sizeof(double))))%3B%0A%0A//+terrible+asm%0Av4df+load_4_doubles(const+double+*p)+%7B%0A++v4df+retval+%3D+%7Bp%5B0%5D,+p%5B1%5D,+p%5B2%5D,+p%5B3%5D%7D%3B%0A++return+retval%3B%0A%7D%0A%0A%23include+%3Cimmintrin.h%3E%0A%0Av4df+load_4_doubles_intel(const+double+*p)+%7B+return+_mm256_loadu_pd(p)%3B+%7D%0A%0Av4df+avx_constant()+%7B+return+_mm256_setr_pd(+1.0,+2.0,+3.0,+4.0+)%3B+%7D%0A&#39;)),filterAsm:(commentOnly:!t,directives:!t,intel:!t,labels:!t),version:3\" rel=\"nofollow noreferrer\">Godbolt compiler explorer</a> so you can look at the asm with various compile options and compiler versions.</p>\n\n<pre><code>typedef double v4df __attribute__((vector_size(4 * sizeof(double))));\n\n#include &lt;immintrin.h&gt;\n\n// note the return types.  gcc6.1 compiles with no warnings, even at -Wall -Wextra\nv4df load_4_doubles_intel(const double *p) { return _mm256_loadu_pd(p); }\n    vmovupd ymm0, YMMWORD PTR [rdi]   # tmp89,* p\n    ret\n\nv4df avx_constant() { return _mm256_setr_pd( 1.0, 2.0, 3.0, 4.0 ); }\n    vmovapd ymm0, YMMWORD PTR .LC0[rip]\n    ret\n</code></pre>\n\n<p><strong>If the args to <code>_mm_set*</code> intrinsics aren't compile-time constants, the compiler will do the best it can to make efficient code to get all the elements into a single vector</strong>.  It's usually best to do that rather than writing C that stores to a tmp array and loads from it, because that's not always the best strategy.  (Store-forwarding failure on multiple narrow stores forwarding to a wide load costs an extra ~10 cycles (IIRC) of latency on top of the usual store-forwarding delay.  If your <code>double</code>s are already in registers, it's usually best to just shuffle them together.)</p>\n\n<hr>\n\n<p>See also <a href=\"https://stackoverflow.com/questions/11759791/is-it-possible-to-cast-floats-directly-to-m128-if-they-are-16-byte-alligned/11766098#11766098\">Is it possible to cast floats directly to __m128 if they are 16 byte alligned?</a> for a list of the various intrinsics for getting a single scalar into a vector.  The <a href=\"/questions/tagged/x86\" class=\"post-tag\" title=\"show questions tagged &#39;x86&#39;\" rel=\"tag\">x86</a> tag wiki has links to Intel's manuals, and their intrinsics finder.</p>\n\n<hr>\n\n<h3>Load/store GNU C vectors without Intel intrinsics:</h3>\n\n<p>I'm not sure how you're \"supposed\" to do that.  <a href=\"https://stackoverflow.com/questions/18199605/better-way-to-load-vectors-from-memory-clang\">This Q&amp;A</a> suggests casting a pointer to the memory you want to load, and using a vector type like <code>typedef char __attribute__ ((vector_size (16),aligned (1))) unaligned_byte16;</code>  (note the <code>aligned(1)</code> attribute).</p>\n\n<p>You get a segfault from <code>*(v4df *)a</code> because presumably <code>a</code> isn't aligned on a 32-byte boundary, but you're using a vector type that does assume natural alignment.  (Just like <code>__m256d</code> if you dereference a pointer to it instead of using load/store intrinsics to communicate alignment info to the compiler.)</p>\n"}], "owner": {"reputation": 184, "user_id": 5896888, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EBe7XdeKxK4/AAAAAAAAAAI/AAAAAAAAt7I/l2GeK24xRAA/photo.jpg?sz=128", "display_name": "Jerry Zhao", "link": "https://stackoverflow.com/users/5896888/jerry-zhao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1364, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1472032738, "creation_date": 1472010919, "last_edit_date": 1472018429, "question_id": 39114159, "link": "https://stackoverflow.com/questions/39114159/how-do-you-load-store-from-to-an-array-of-doubles-with-gnu-c-vector-extensions", "title": "How do you load/store from/to an array of doubles with GNU C Vector Extensions?", "body": "<p>I'm using <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Vector-Extensions.html\" rel=\"nofollow\">GNU C Vector Extensions</a>, not Intel's <code>_mm_*</code> intrinsics.</p>\n\n<p>I want to do the same thing as Intel's <code>_m256_loadu_pd</code> intrinsic. Assigning the values one by one is slow: gcc produces code that has 4 load instructions, rather than one single <code>vmovupd</code> (which <code>_m256_loadu_pd</code> does generate).</p>\n\n<pre><code>typedef double vector __attribute__((vector_size(4 * sizeof(double))));\n\nint main(int argc, char **argv) {\n    double a[4] = {1.0, 2.0, 3.0, 4.0};\n    vector v;\n\n    /* I currently do this */\n    v[0] = a[0];\n    v[1] = a[1];\n    v[2] = a[2];\n    v[3] = a[3];\n}\n</code></pre>\n\n<p>I want something like this:</p>\n\n<pre><code>v = (vector)(a);\n</code></pre>\n\n<p>or</p>\n\n<pre><code>v = *((vector*)(a));\n</code></pre>\n\n<p>but neither work. The first fails with \"can't convert value to a vector\" while the second results in segfaults. </p>\n"}, {"tags": ["c", "struct"], "comments": [{"owner": {"reputation": 26606, "user_id": 4603670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7eabc1427aa3c8185153cc81978289a?s=128&d=identicon&r=PG&f=1", "display_name": "Barmak Shemirani", "link": "https://stackoverflow.com/users/4603670/barmak-shemirani"}, "edited": false, "score": 0, "creation_date": 1472016265, "post_id": 39114073, "comment_id": 65576762, "body": "Note that you have declared <code>identity</code> to have room for 512 wide characters. <code>sizeof(t2.identity)</code> will return 1024 bytes (each <code>wchar_t</code> is 2 bytes in Windows). The second parameter in wcscpy_s should be <code>sizeof(t2.identity)&#47;sizeof(wchar_t)</code> or use <code>_countof</code> as suggested in the answer, this will give 512."}], "answers": [{"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472012400, "post_id": 39114106, "comment_id": 65575536, "body": "Hmmm, This answer has correct information, yet it does <i>not</i> explain OP&#39;s problem unless <code>t1.identity</code> lacks a terminator or was from some other <code>struct</code> with a larger <code>identity[]</code> field.  UV for detailing correct coding."}], "tags": [], "owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": false, "score": 5, "last_activity_date": 1472010532, "creation_date": 1472010532, "answer_id": 39114106, "question_id": 39114073, "link": "https://stackoverflow.com/questions/39114073/crash-in-wcscpy-s/39114106#39114106", "title": "Crash in wcscpy_s", "body": "<p>If you <a href=\"https://msdn.microsoft.com/en-us/library/td1esda9.aspx\">read the <code>wcscpy_s</code> reference</a> you will see that the middle argument is the number of <strong><em>elements</em></strong>, while you pass the size of the array <strong><em>in bytes</em></strong>.</p>\n\n<p>If you're using Visual C++ then you can use e.g. <a href=\"https://msdn.microsoft.com/en-us/library/ms175773.aspx\"><code>_countof</code></a> to get the number of elements.</p>\n"}], "owner": {"reputation": 11, "user_id": 6390240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48990acca00e67029c4edec75b9fdb7b?s=128&d=identicon&r=PG&f=1", "display_name": "Ananya Taneja", "link": "https://stackoverflow.com/users/6390240/ananya-taneja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 418, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1472010532, "creation_date": 1472010311, "question_id": 39114073, "link": "https://stackoverflow.com/questions/39114073/crash-in-wcscpy-s", "title": "Crash in wcscpy_s", "body": "<p>I am getting crash in <code>wcscpy</code>_s while <code>wcscpy</code> works fine. I have the following struct </p>\n\n<pre><code>struct Test {\n...\nwchar_t         identity[256 * 2];  \n...\n};\n</code></pre>\n\n<p>I am doing member-by-member copy of one struct into another. The below one is crashing</p>\n\n<pre><code>wcscpy_s(t2.identity, sizeof(t2.identity) , t1.identity);\n</code></pre>\n\n<p>while this one is working fine:</p>\n\n<pre><code>wcscpy(t2.identity, t1.identity);\n</code></pre>\n"}, {"tags": ["c", "string", "pointers", "malloc", "free"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1472007789, "post_id": 39113727, "comment_id": 65574514, "body": "You allocate memory somewhere. Then you write out of bounds of that memory. That is the only reason for an error such as this."}, {"owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472007863, "post_id": 39113727, "comment_id": 65574530, "body": "I don&#39;t think this is the case @JoachimPileborg, I posted an answer. I think his <code>malloc()</code> is not as it should be!"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1472007874, "post_id": 39113727, "comment_id": 65574535, "body": "Also when you have a pointer then <code>sizeof</code> on that pointer will give you the size <i>of the pointer</i>, and not what it points to. On a 32-bit system it will most likely be <code>4</code> and on a 64-bit system it will most likely be <code>8</code>."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "reply_to_user": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "edited": false, "score": 2, "creation_date": 1472007929, "post_id": 39113727, "comment_id": 65574547, "body": "@gsamaras That&#39;s exactly the reason. The allocation is to small and the OP writes out of bounds of that allocation."}, {"owner": {"user_type": "does_not_exist", "display_name": "user707650"}, "edited": false, "score": 0, "creation_date": 1472008007, "post_id": 39113727, "comment_id": 65574560, "body": "I thought this is why there is <code>strdup</code>?"}, {"owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "reply_to_user": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1472008016, "post_id": 39113727, "comment_id": 65574562, "body": "Agreed JoachimPileborg, but damn my Internet is sooo slow that I didn&#39;t see @BLUEPIXY&#39;s comment, who seem to spotted that some seconds before of me, so if he wishes I can delete my answer, so that he can post one, if desired. <code>strdup()</code> is <i>not</i> standard <a href=\"https://stackoverflow.com/questions/tagged/c\">c</a> Evert, better not proposing to a beginner."}, {"owner": {"reputation": 40055, "user_id": 545127, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/RJgJM.png?s=128&g=1", "display_name": "Raedwald", "link": "https://stackoverflow.com/users/545127/raedwald"}, "edited": false, "score": 0, "creation_date": 1542877785, "post_id": 39113727, "comment_id": 93728795, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/4729395/error-free-invalid-next-size-fast\">Error: free(): invalid next size (fast):</a>"}], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 6632730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb66018cd54e95b2041c8e925738561d?s=128&d=identicon&r=PG&f=1", "display_name": "SillyRab", "link": "https://stackoverflow.com/users/6632730/sillyrab"}, "edited": false, "score": 1, "creation_date": 1472088735, "post_id": 39113743, "comment_id": 65615846, "body": "Thank you very much for you answer, it helped me out tons!"}, {"owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "reply_to_user": {"reputation": 65, "user_id": 6632730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb66018cd54e95b2041c8e925738561d?s=128&d=identicon&r=PG&f=1", "display_name": "SillyRab", "link": "https://stackoverflow.com/users/6632730/sillyrab"}, "edited": false, "score": 0, "creation_date": 1472091604, "post_id": 39113743, "comment_id": 65616449, "body": "You are welcome! You see @SillyRab, you posted a good question, especially one that one could actually answer, since it had all the required info, bravo! That&#39;s others and me upvoted. Glad I helped!"}], "tags": [], "owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "is_accepted": true, "score": 5, "last_activity_date": 1472008630, "last_edit_date": 1472008630, "creation_date": 1472007773, "answer_id": 39113743, "question_id": 39113727, "link": "https://stackoverflow.com/questions/39113727/free-invalid-next-size-fast-error/39113743#39113743", "title": "Free() : invalid next size (fast) error", "body": "<p>Change this:</p>\n\n<pre><code>char* copy = malloc(sizeof(line));\n</code></pre>\n\n<p>to this:</p>\n\n<pre><code>char* copy = malloc(strlen(line) + 1);\n</code></pre>\n\n<p>The first allocates space for the size of <code>line</code>, which is a POINTER!</p>\n\n<p>While the second, allocates space equal to the length of the string that <code>line</code> points to, <em>plus one</em>, for the NULL terminator (please don't forget that and you will live a happier <a href=\"/questions/tagged/c\" class=\"post-tag\" title=\"show questions tagged &#39;c&#39;\" rel=\"tag\">c</a>-life)! ;)</p>\n\n<hr>\n\n<p>BTW, I believe that it's more common to write the comments of your code above the line of code (rather than next to it). :)</p>\n"}, {"comments": [{"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 2, "creation_date": 1472009670, "post_id": 39113816, "comment_id": 65574900, "body": "<code>sizeof</code> ans <code>strlen</code> return <code>size_t</code> which should be printed with <a href=\"http://stackoverflow.com/q/940087/995714\"><code>%zu</code></a>. Printing with the wrong format specifier invokes undefined behavior. What if <code>size_t</code> is different from <code>long</code> on that platform?"}, {"owner": {"reputation": 65, "user_id": 6632730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb66018cd54e95b2041c8e925738561d?s=128&d=identicon&r=PG&f=1", "display_name": "SillyRab", "link": "https://stackoverflow.com/users/6632730/sillyrab"}, "edited": false, "score": 0, "creation_date": 1472088766, "post_id": 39113816, "comment_id": 65615853, "body": "Thank you for your answer, it was very informative!"}], "tags": [], "owner": {"reputation": 62, "user_id": 5927989, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xW8hmrJemB8/AAAAAAAAAAI/AAAAAAAAqvw/JuEgdyq1BKk/photo.jpg?sz=128", "display_name": "Miguel Sosa", "link": "https://stackoverflow.com/users/5927989/miguel-sosa"}, "is_accepted": false, "score": 2, "last_activity_date": 1472032297, "last_edit_date": 1472032297, "creation_date": 1472008395, "answer_id": 39113816, "question_id": 39113727, "link": "https://stackoverflow.com/questions/39113727/free-invalid-next-size-fast-error/39113816#39113816", "title": "Free() : invalid next size (fast) error", "body": "<p>On the line:</p>\n\n<pre><code>char* copy = malloc(sizeof(line)); //allocate space for a copy of the line parameter\n</code></pre>\n\n<p>You are allocating memory to hold the size of a pointer. You need to allocate the length of the string instead. See the following:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint main(int argc, const char* argv[]) {\n  const char *line = \"this is a line\";\n  printf(\"sizeof line: %zu\\n\", sizeof(line));\n  printf(\"strlen line: %zu\\n\", strlen(line));\n  return 0;\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>sizeof line: 8\nstrlen line: 14\n</code></pre>\n\n<p>You should allocate on strlen+1 (to account for the null character).</p>\n"}], "owner": {"reputation": 65, "user_id": 6632730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb66018cd54e95b2041c8e925738561d?s=128&d=identicon&r=PG&f=1", "display_name": "SillyRab", "link": "https://stackoverflow.com/users/6632730/sillyrab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2818, "favorite_count": 0, "accepted_answer_id": 39113743, "answer_count": 2, "score": 4, "last_activity_date": 1472032297, "creation_date": 1472007676, "last_edit_date": 1472014285, "question_id": 39113727, "link": "https://stackoverflow.com/questions/39113727/free-invalid-next-size-fast-error", "title": "Free() : invalid next size (fast) error", "body": "<p>So I keep running to this error: <code>free(): invalid next size(fast)</code> when I run my code. If I remove the free at the end of the function I know I am leaking memory but I don't understand why I am getting this error.</p>\n\n<p>I assume it has something to do with me allocating memory incorrectly but I can't seem to find the fix, here is my code: </p>\n\n<pre><code>bool parse(const char* line) //NOT WORKING JUST QUITE \n{\n    char* copy = malloc(sizeof(line)); //allocate space for a copy of the line parameter\n    strcpy(copy, line); //copy the line parameter\n\n    char* method = strtok(copy, \" \"); //pointer to the method \n    char* reqLine = strtok(NULL, \" \"); //pointer to the requestline\n    char* version = strtok(NULL, \"\\r\\n\"); //pointer to the HTTP-Version\n\n    if (strcmp(method,\"GET\") != 0) //if the method is not GET\n    {\n        printf(\"%s\\n\", method);\n        printf(\"ERROR 405\\n\");\n        return false;\n    }\n    if (strncmp(reqLine, \"/\", 1) != 0)//if the request line does not begin with a / character\n    {\n        printf(\"%c\\n\", reqLine[0]);\n        printf(\"%s\\n\", reqLine);\n        printf(\"ERROR 501\\n\");\n        return false; \n    }\n    if (strchr(reqLine, 34) != NULL) //if the request line contains a \" character\n    {\n        printf(\"%s\\n\", reqLine);\n        printf(\"ERROR 400\\n\");\n        return false;\n    }\n    if (strcmp(version, \"HTTP/1.1\") != 0)\n    {\n        printf(\"%s\", version);\n        printf(\"ERROR 505\\n\");\n        return false;\n    }\n\n//free(copy); \nreturn true;\n}\n</code></pre>\n\n<p>If it helps the passed in <code>const char*</code> line is of the form:</p>\n\n<blockquote>\n  <p>method <code>SP request-target SP HTTP-version CRLF</code></p>\n</blockquote>\n\n<p>Where SP is a space and CRLF is carridge return, line feed.</p>\n"}, {"tags": ["c", "stack", "arm", "bare-metal"], "comments": [{"owner": {"reputation": 55516, "user_id": 892256, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/15FJW.png?s=128&g=1", "display_name": "Ed Heal", "link": "https://stackoverflow.com/users/892256/ed-heal"}, "edited": false, "score": 2, "creation_date": 1472007220, "post_id": 39113658, "comment_id": 65574403, "body": "What is &quot;none OS&quot;?"}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 0, "creation_date": 1472007482, "post_id": 39113658, "comment_id": 65574454, "body": "Do you mean &quot;non-OS&quot;, as in bare metal?"}, {"owner": {"reputation": 159, "user_id": 5932760, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d592a44ab4e9d1d2df8363c5c178e807?s=128&d=identicon&r=PG&f=1", "display_name": "lrouter", "link": "https://stackoverflow.com/users/5932760/lrouter"}, "edited": false, "score": 0, "creation_date": 1472009532, "post_id": 39113658, "comment_id": 65574866, "body": "Yes, sorry for the confusion."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 2, "creation_date": 1472009951, "post_id": 39113658, "comment_id": 65574965, "body": "In a bare-metal environment, it&#39;s usually best not to use <code>malloc</code> at all. Instead, use memory pools that manage a fixed number of fixed-size memory blocks."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 2, "creation_date": 1472010056, "post_id": 39113658, "comment_id": 65574994, "body": "In a bare-metal environment, <code>malloc</code> often doesn&#39;t exist. If it does exist, then check the documentation for wherever it came from."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1472010106, "post_id": 39113658, "comment_id": 65575008, "body": "Also, that &quot;C memory model&quot; has not been correct for over two decades."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472011253, "post_id": 39113658, "comment_id": 65575235, "body": "&quot;when does malloc return NULL?&quot; --&gt; Note that <code>malloc(0)</code> may return <code>NULL</code> and does not imply out -of memory.  YMMV."}, {"owner": {"reputation": 159, "user_id": 5932760, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d592a44ab4e9d1d2df8363c5c178e807?s=128&d=identicon&r=PG&f=1", "display_name": "lrouter", "link": "https://stackoverflow.com/users/5932760/lrouter"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1472017529, "post_id": 39113658, "comment_id": 65577287, "body": "@user3386109 &#183;malloc&#183; is a c library function. Do you mean declare a memory pool globally ? Then you could implement your own malloc function to manage this memory pool."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1472019728, "post_id": 39113658, "comment_id": 65578125, "body": "Maybe <a href=\"https://en.wikipedia.org/wiki/Memory_pool\" rel=\"nofollow noreferrer\">this article</a> will help. A memory pool is a different way to manage dynamic memory. It is used instead of <code>malloc</code> on systems where <code>malloc</code> is either not available, or not suitable for use. Which would be pretty much any system that doesn&#39;t have an OS."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472082680, "post_id": 39113658, "comment_id": 65614605, "body": "the link.cmd file (for TI, similar file for other environments) tells the linker exactly where to place everything in memory.   One of the items that is placed is the <code>heap</code>.   the link.cmd file (usually) does not say exactly where to place the <code>heap</code> but often says how large to make the <code>heap</code>."}], "answers": [{"comments": [{"owner": {"reputation": 159, "user_id": 5932760, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d592a44ab4e9d1d2df8363c5c178e807?s=128&d=identicon&r=PG&f=1", "display_name": "lrouter", "link": "https://stackoverflow.com/users/5932760/lrouter"}, "edited": false, "score": 0, "creation_date": 1472016893, "post_id": 39113733, "comment_id": 65577028, "body": "Based on your figure, I found out a label &#39;heap_limit&#39; and a stack_limit in my map file."}], "tags": [], "owner": {"reputation": 648, "user_id": 3081675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/729e2dcea76b214b1bd2217b62ef9cf6?s=128&d=identicon&r=PG&f=1", "display_name": "Wiki Wang", "link": "https://stackoverflow.com/users/3081675/wiki-wang"}, "is_accepted": false, "score": 2, "last_activity_date": 1472007713, "creation_date": 1472007713, "answer_id": 39113733, "question_id": 39113658, "link": "https://stackoverflow.com/questions/39113658/when-does-malloc-return-null-in-a-bare-metal-environment/39113733#39113733", "title": "When does malloc return NULL in a bare-metal environment?", "body": "<p>Size of stack is determinded at compile time. </p>\n\n<pre><code>      +--------+   Last Address of RAM\n      | Stack  |\n      |   |    |\n      |   v    |\n      +--------+\nRAM   |        |\n      +--------+   Stack Limit\n      |        |\n      +--------+\n      |   ^    |\n      |   |    |\n      | Heap   |\n      +--------+\n      |   ZI   |\n      +--------+\n      |   RW   |  \n      +========+  First Address of RAM\n</code></pre>\n\n<p>malloc return null if there is not enough space for the requested heap.</p>\n\n<p>And its your duty to to prevent stack overflow!</p>\n"}, {"tags": [], "owner": {"reputation": 15409, "user_id": 2877364, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a101160e41fd7fd75f5fc701f8acb1c?s=128&d=identicon&r=PG", "display_name": "cxw", "link": "https://stackoverflow.com/users/2877364/cxw"}, "is_accepted": false, "score": 3, "last_activity_date": 1472007943, "creation_date": 1472007943, "answer_id": 39113756, "question_id": 39113658, "link": "https://stackoverflow.com/questions/39113658/when-does-malloc-return-null-in-a-bare-metal-environment/39113756#39113756", "title": "When does malloc return NULL in a bare-metal environment?", "body": "<p>@WikiWang is correct if you are using a static, compile-time memory layout (<strong>edit</strong> although you have to tell your <code>malloc</code> implementation somehow where the end of the heap is).  </p>\n\n<p>If not, and assuming you mean bare-metal, it depends on the C library implementation in your board-support package.  The library must provide some implementation of <a href=\"http://linux.die.net/man/2/sbrk\" rel=\"nofollow\"><code>brk(2)</code></a> or a function having a similar effect.  <code>malloc</code> works within the area of memory set by <code>brk</code> or <code>sbrk</code>.  For example, see the <a href=\"https://fossies.org/dox/glibc-2.24/malloc_8c_source.html#l02491\" rel=\"nofollow\">malloc source</a> calling macro <code>MORECORE</code>, which is by default <code>sbrk</code>.  Your C library will have to use something other than a kernel call for that :) .</p>\n"}, {"comments": [{"owner": {"reputation": 159, "user_id": 5932760, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d592a44ab4e9d1d2df8363c5c178e807?s=128&d=identicon&r=PG&f=1", "display_name": "lrouter", "link": "https://stackoverflow.com/users/5932760/lrouter"}, "edited": false, "score": 0, "creation_date": 1472016984, "post_id": 39113853, "comment_id": 65577054, "body": "I have checked my map file. Yes, there is a heap limit."}], "tags": [], "owner": {"reputation": 7393, "user_id": 1690777, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/18ef5bab4c70735313d86c7240e4abed?s=128&d=identicon&r=PG", "display_name": "Sergey", "link": "https://stackoverflow.com/users/1690777/sergey"}, "is_accepted": false, "score": 2, "last_activity_date": 1472008669, "creation_date": 1472008669, "answer_id": 39113853, "question_id": 39113658, "link": "https://stackoverflow.com/questions/39113658/when-does-malloc-return-null-in-a-bare-metal-environment/39113853#39113853", "title": "When does malloc return NULL in a bare-metal environment?", "body": "<blockquote>\n  <p>when does malloc return NULL?</p>\n</blockquote>\n\n<p>It may depend on C compiler and library implementation. For example, my <code>malloc</code> implementation calls <a href=\"http://linux.die.net/man/2/sbrk\" rel=\"nofollow\"><code>sbrk</code></a>, which is a system call in Linux environment. As we have no Linux on the MCU, I provided my own implementation of <code>sbrk</code> like this:</p>\n\n<pre><code>// Global variables.\nextern unsigned int _heap;\nextern unsigned int _eheap;\nstatic caddr_t heap = NULL;\n\ncaddr_t _sbrk(int incr)\n{\n  caddr_t prevHeap;\n  caddr_t nextHeap;\n\n  if (heap == NULL) { // first allocation\n    heap = (caddr_t) &amp; _heap;\n  }\n\n  prevHeap = heap;\n\n  // Always return data aligned on a 8 byte boundary\n  nextHeap = (caddr_t) (((unsigned int) (heap + incr) + 7) &amp; ~7);\n  if (nextHeap &gt;= (caddr_t) &amp; _eheap) {\n    errno = ENOMEM;\n    return ((void*)-1); // error - no more memory\n  } else {\n    heap = nextHeap;\n    return (caddr_t) prevHeap;\n  }\n}\n</code></pre>\n\n<p>and <code>_eheap</code> is defined in the linker script:</p>\n\n<pre><code>PROVIDE ( _eheap = ALIGN(ORIGIN(ram) + LENGTH(ram) - 8 ,8) );\n</code></pre>\n\n<p>Having this, <code>malloc</code> in my program will return error only when it hits the end of the memory. Stack top address is not recognized, thus I cannot diagnose possible stack corruption by checking <code>malloc</code> return value.</p>\n\n<blockquote>\n  <p>how to prevent stack from overlapping with heap?</p>\n</blockquote>\n\n<p>You may define your own limit for <code>sbrk</code> to return error, which will prevent <code>malloc</code> from invading stack memory.</p>\n"}, {"comments": [{"owner": {"reputation": 159, "user_id": 5932760, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d592a44ab4e9d1d2df8363c5c178e807?s=128&d=identicon&r=PG&f=1", "display_name": "lrouter", "link": "https://stackoverflow.com/users/5932760/lrouter"}, "edited": false, "score": 0, "creation_date": 1472017359, "post_id": 39115143, "comment_id": 65577218, "body": "Thanks. How to check the maximum stack depth ?"}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 159, "user_id": 5932760, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d592a44ab4e9d1d2df8363c5c178e807?s=128&d=identicon&r=PG&f=1", "display_name": "lrouter", "link": "https://stackoverflow.com/users/5932760/lrouter"}, "edited": false, "score": 0, "creation_date": 1472036055, "post_id": 39115143, "comment_id": 65588241, "body": "one is by analysis of your code.  Another is a valgrind type approach, fill ram with some pattern, run your program, stop and examine ram, where does the fill pattern end, how deep did the stack go.  They by analysis you need to confirm you took the deepest path from a stack consumption perspective.  Not doing the analysis right and relying only on experimenting you may miss a path and be off by some amount small or large."}, {"owner": {"reputation": 159, "user_id": 5932760, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d592a44ab4e9d1d2df8363c5c178e807?s=128&d=identicon&r=PG&f=1", "display_name": "lrouter", "link": "https://stackoverflow.com/users/5932760/lrouter"}, "edited": false, "score": 0, "creation_date": 1472210795, "post_id": 39115143, "comment_id": 65672696, "body": "Is there any tool could finish the job \uff1f"}], "tags": [], "owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "is_accepted": false, "score": 2, "last_activity_date": 1472016879, "creation_date": 1472016879, "answer_id": 39115143, "question_id": 39113658, "link": "https://stackoverflow.com/questions/39113658/when-does-malloc-return-null-in-a-bare-metal-environment/39115143#39115143", "title": "When does malloc return NULL in a bare-metal environment?", "body": "<p>1) bare metal you probably dont want to use malloc in the first place</p>\n\n<p>2) bare metal you own that memory and manage it so you are the only one that can answer the question.</p>\n\n<p>3) even on not-bare-metal (windows, linux, etc) stack hitting the heap or running into the code space is not something you normally get protections from, you need to either tell the compiler, if it supports it, to add a ton more code, or you just design your software right to not collide.</p>\n\n<p>What is your memory allocation scheme, what does your code do, how if at all have you told this code what space it can allocate from.  If the compiler supports it at all you may need to tell the compiler the space or runtime indicate where the top of heap is currently.  Or maybe the compiler relies on that space being filled with a pattern and it checks for the pattern before allocating, which means in bare metal for a case like that you would need to fill that memory with that pattern.  First and foremost you need to find out if and how the compilers output works with respect to preventing the stack colliding with data or program space.</p>\n\n<p>Normally you know by your system/software design how deep your stack will go worst case, and from that how much memory you have left.  As you do your design and then implementation you verify the maximum stack depth, how much ram you ended up needing and making sure you have not oversubscribed the ram you have available for that processor in that system.</p>\n\n<p>Bare metal there is no reason to expect the compiler nor libraries nor other tools to do this work for you.</p>\n"}, {"comments": [{"owner": {"reputation": 159, "user_id": 5932760, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d592a44ab4e9d1d2df8363c5c178e807?s=128&d=identicon&r=PG&f=1", "display_name": "lrouter", "link": "https://stackoverflow.com/users/5932760/lrouter"}, "edited": false, "score": 0, "creation_date": 1472210756, "post_id": 39121423, "comment_id": 65672669, "body": "So does the malloc in c library check stack and heap limits"}, {"owner": {"reputation": 1306, "user_id": 6644919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24b4fdd15cf4d51ab53f48aa7a7bcade?s=128&d=identicon&r=PG&f=1", "display_name": "Andrea Biondo", "link": "https://stackoverflow.com/users/6644919/andrea-biondo"}, "reply_to_user": {"reputation": 159, "user_id": 5932760, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d592a44ab4e9d1d2df8363c5c178e807?s=128&d=identicon&r=PG&f=1", "display_name": "lrouter", "link": "https://stackoverflow.com/users/5932760/lrouter"}, "edited": false, "score": 0, "creation_date": 1472211226, "post_id": 39121423, "comment_id": 65672953, "body": "@D.E.T That depends on how your libc implements it. In the most common case, it won&#39;t do it directly but it will allocate memory calling an <code>sbrk</code> you define, so you can check it there."}, {"owner": {"reputation": 159, "user_id": 5932760, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d592a44ab4e9d1d2df8363c5c178e807?s=128&d=identicon&r=PG&f=1", "display_name": "lrouter", "link": "https://stackoverflow.com/users/5932760/lrouter"}, "edited": false, "score": 0, "creation_date": 1472298747, "post_id": 39121423, "comment_id": 65703006, "body": "Thanks for explanation."}], "tags": [], "owner": {"reputation": 1306, "user_id": 6644919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24b4fdd15cf4d51ab53f48aa7a7bcade?s=128&d=identicon&r=PG&f=1", "display_name": "Andrea Biondo", "link": "https://stackoverflow.com/users/6644919/andrea-biondo"}, "is_accepted": false, "score": 1, "last_activity_date": 1472036277, "creation_date": 1472036277, "answer_id": 39121423, "question_id": 39113658, "link": "https://stackoverflow.com/questions/39113658/when-does-malloc-return-null-in-a-bare-metal-environment/39121423#39121423", "title": "When does malloc return NULL in a bare-metal environment?", "body": "<p><code>malloc</code> will return NULL when the allocation fails. Usually this is due to lack of memory. In a free-running model, where heap and stack don't have limits, it would always give you memory (even if that meant colliding with the stack).</p>\n\n<p>Fortunately, that is never done. Usually the heap and the stack have fixed maximum sizes, so checks are easier. For example, if the library <code>malloc</code> calls your <code>sbrk</code> (typical situation), you could write <code>sbrk</code> so that it refuses to extend the heap past the stack limit. This avoids the heap from colliding into the stack.</p>\n\n<p>The other way around (stack collides into heap) is trickier. First off, there isn't much you can do to recover from a stack overflow, so the strategy here would be to produce useful debug info and halt the system to avoid working on corrupted memory. Technically, the compiler could add checks for every stack allocation, but that would noticeably slow down the code (I don't even know if any compiler supports it - probably yes, with some instrumentation). If your MCU has a Memory Protection Unit (MPU), you could configure a small unaccessible zone above the stack limit, so that stack overflows will generate an MPU fault. This technique is often called guard page (much like <a href=\"https://en.wikipedia.org/wiki/Guard_byte\" rel=\"nofollow\">guard bytes</a> with a memory breakpoint, if you want). For this to work, however, exceptions need to use a different stack (otherwise you're in the same boat). Note that <a href=\"https://en.wikipedia.org/wiki/Buffer_overflow_protection#Canaries\" rel=\"nofollow\">stack canaries</a> don't protect against stack-heap collision.</p>\n\n<p>That being said, in bare metal <em>you</em> are the one designing the memory layout, and you can set it up however you want depending on your needs. <code>malloc</code> is generally frowned upon because it's non-deterministic. Also, you should profile your stack usage and know your maximum stack depth in order to properly size the stack.</p>\n"}], "owner": {"reputation": 159, "user_id": 5932760, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d592a44ab4e9d1d2df8363c5c178e807?s=128&d=identicon&r=PG&f=1", "display_name": "lrouter", "link": "https://stackoverflow.com/users/5932760/lrouter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1779, "favorite_count": 2, "answer_count": 5, "score": 4, "last_activity_date": 1472036277, "creation_date": 1472007113, "last_edit_date": 1472008835, "question_id": 39113658, "link": "https://stackoverflow.com/questions/39113658/when-does-malloc-return-null-in-a-bare-metal-environment", "title": "When does malloc return NULL in a bare-metal environment?", "body": "<p>There is a c memory model as following :</p>\n\n<pre><code>      +--------+   Last Address of RAM\n      | Stack  |\n      |   |    |\n      |   v    |\n      +--------+\nRAM   |        |\n      |        |\n      +--------+\n      |   ^    |\n      |   |    |\n      | Heap   |\n      +--------+\n      |   ZI   |\n      +--------+\n      |   RW   |  \n      +========+  First Address of RAM\n</code></pre>\n\n<p>The stack and heap space increase in opposite directions. They would be overlapped with each other in the middle.\nSo my questions are:</p>\n\n<ul>\n<li>In a bare-metal environment, when does malloc return NULL?</li>\n<li>In a bare-metal environment, how to prevent stack from overlapping with heap?</li>\n</ul>\n"}, {"tags": ["c", "ruby", "mri"], "comments": [{"owner": {"reputation": 279, "user_id": 6366047, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/986546a4d07bc47d42c714e762082a51?s=128&d=identicon&r=PG", "display_name": "csTroubled", "link": "https://stackoverflow.com/users/6366047/cstroubled"}, "reply_to_user": {"reputation": 52633, "user_id": 3155639, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d254eedd932f950213109aa3706aba74?s=128&d=identicon&r=PG", "display_name": "Alexander O&#39;Mara", "link": "https://stackoverflow.com/users/3155639/alexander-omara"}, "edited": false, "score": 0, "creation_date": 1472006050, "post_id": 39113492, "comment_id": 65574179, "body": "@AlexanderO&#39;Mara No, it&#39;s not, this define seems to be referencing the enum."}, {"owner": {"reputation": 52633, "user_id": 3155639, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d254eedd932f950213109aa3706aba74?s=128&d=identicon&r=PG", "display_name": "Alexander O&#39;Mara", "link": "https://stackoverflow.com/users/3155639/alexander-omara"}, "edited": false, "score": 0, "creation_date": 1472006188, "post_id": 39113492, "comment_id": 65574199, "body": "It&#39;s not a multi-line macro: <a href=\"http://stackoverflow.com/questions/16685211/c-define-multiline-macro\" title=\"c define multiline macro\">stackoverflow.com/questions/16685211/c-define-multiline-macr&zwnj;&#8203;o</a>"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 1, "creation_date": 1472006675, "post_id": 39113492, "comment_id": 65574299, "body": "Duplicate of: <a href=\"http://stackoverflow.com/q/6830602\">stackoverflow.com/q/6830602</a>"}, {"owner": {"reputation": 34061, "user_id": 616460, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Yiloe.png?s=128&g=1", "display_name": "Jason C", "link": "https://stackoverflow.com/users/616460/jason-c"}, "edited": false, "score": 0, "creation_date": 1472009915, "post_id": 39113492, "comment_id": 65574955, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/6830602/redefining-enum-enumerators-with-define\">Redefining enum enumerators with #define</a>"}], "answers": [{"tags": [], "owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "is_accepted": false, "score": 0, "last_activity_date": 1472006042, "creation_date": 1472006042, "answer_id": 39113526, "question_id": 39113492, "link": "https://stackoverflow.com/questions/39113492/what-does-the-define-robject-embed-len-max-robject-embed-len-max-do/39113526#39113526", "title": "What does the #define ROBJECT_EMBED_LEN_MAX ROBJECT_EMBED_LEN_MAX do?", "body": "<p>The <code>#define</code>s make it possible to test for the existence of the definition at compile-time using <code>#ifdef</code>. (You cannot test for the existence of an enum at compile-time.)</p>\n\n<p>Since the C preprocessor doesn't do recursive substitution, defining a symbol as itself effectively does nothing; the symbol is replaced once with itself, and then passed normally to the compiler.</p>\n"}], "owner": {"reputation": 279, "user_id": 6366047, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/986546a4d07bc47d42c714e762082a51?s=128&d=identicon&r=PG", "display_name": "csTroubled", "link": "https://stackoverflow.com/users/6366047/cstroubled"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1472006578, "creation_date": 1472005748, "question_id": 39113492, "link": "https://stackoverflow.com/questions/39113492/what-does-the-define-robject-embed-len-max-robject-embed-len-max-do", "title": "What does the #define ROBJECT_EMBED_LEN_MAX ROBJECT_EMBED_LEN_MAX do?", "body": "<p>Browsing through MRI's code, I found these <code>#define</code>s I don't understand: </p>\n\n<pre><code>#define ROBJECT_EMBED_LEN_MAX ROBJECT_EMBED_LEN_MAX\n#define ROBJECT_EMBED ROBJECT_EMBED\nenum {\n    ROBJECT_EMBED_LEN_MAX = 3,\n    ROBJECT_EMBED = RUBY_FL_USER1,\n\n    ROBJECT_ENUM_END\n};\n</code></pre>\n\n<p>What's the point of those <code>#define</code>s? They seem to do nothing...</p>\n\n<p>This code is found in the <code>ruby/include/ruby/ruby.h</code> file in the ruby github repo.</p>\n"}, {"tags": ["c++", "c", "io"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1472010186, "post_id": 39113490, "comment_id": 65575028, "body": "The bits after <code>jmp</code> are not part of that function. They&#39;re part of another function which for some reason isn&#39;t labelled."}, {"owner": {"reputation": 1579, "user_id": 5215536, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/2b44d6db2f2f3fa384fd15d46f4f9c4d?s=128&d=identicon&r=PG&f=1", "display_name": "YiFei", "link": "https://stackoverflow.com/users/5215536/yifei"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1472026198, "post_id": 39113490, "comment_id": 65581800, "body": "@immibis Ah, I should have noticed that, but it&#39;s just interesting that even if I only include <code>iostream</code>, that part of code exist even with <code>-Os</code>, so I suspect that&#39;s some dynamic initializer or something alike."}], "answers": [{"comments": [{"owner": {"reputation": 1579, "user_id": 5215536, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/2b44d6db2f2f3fa384fd15d46f4f9c4d?s=128&d=identicon&r=PG&f=1", "display_name": "YiFei", "link": "https://stackoverflow.com/users/5215536/yifei"}, "edited": false, "score": 0, "creation_date": 1472009033, "post_id": 39113663, "comment_id": 65574756, "body": "Is that compulsory whenever I include <code>iostream</code>?"}, {"owner": {"reputation": 2888, "user_id": 444885, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bb90d3043cabe9cb5b063ae29cdaa1fc?s=128&d=identicon&r=PG", "display_name": "dmitri", "link": "https://stackoverflow.com/users/444885/dmitri"}, "reply_to_user": {"reputation": 1579, "user_id": 5215536, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/2b44d6db2f2f3fa384fd15d46f4f9c4d?s=128&d=identicon&r=PG&f=1", "display_name": "YiFei", "link": "https://stackoverflow.com/users/5215536/yifei"}, "edited": false, "score": 0, "creation_date": 1472017155, "post_id": 39113663, "comment_id": 65577133, "body": "@YiFei That&#39;s what the particular implementation of the library does. Another implementation may behave differently. C++ standard doesn&#39;t specify these kind of implementation details."}], "tags": [], "owner": {"reputation": 2888, "user_id": 444885, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bb90d3043cabe9cb5b063ae29cdaa1fc?s=128&d=identicon&r=PG", "display_name": "dmitri", "link": "https://stackoverflow.com/users/444885/dmitri"}, "is_accepted": true, "score": 2, "last_activity_date": 1472017325, "last_edit_date": 1472017325, "creation_date": 1472007144, "answer_id": 39113663, "question_id": 39113490, "link": "https://stackoverflow.com/questions/39113490/difference-at-assembly-level-of-printf-from-cstdio-and-iostream/39113663#39113663", "title": "Difference at assembly level of printf from cstdio and iostream", "body": "<p>Your print function compiles to a pretty much the same assembly code in both cases.\nThe additional lines you see are to initialise and de-initialise iostream library. You may see that clearly if you remove the optimisation flag <code>-O3</code>.\nHere is a complete listing with iostream included and optimisation switched off.</p>\n\n<pre><code>std::piecewise_construct:\n        .zero   1\n.LC0:\n        .string \"abc\"\nprint():\n        pushq   %rbp\n        movq    %rsp, %rbp\n        movl    $.LC0, %edi\n        movl    $0, %eax\n        call    printf\n        nop\n        popq    %rbp\n        ret\n__static_initialization_and_destruction_0(int, int):\n        pushq   %rbp\n        movq    %rsp, %rbp\n        subq    $16, %rsp\n        movl    %edi, -4(%rbp)\n        movl    %esi, -8(%rbp)\n        cmpl    $1, -4(%rbp)\n        jne     .L4\n        cmpl    $65535, -8(%rbp)\n        jne     .L4\n        movl    std::__ioinit, %edi\n        call    std::ios_base::Init::Init()\n        movl    $__dso_handle, %edx\n        movl    std::__ioinit, %esi\n        movl    std::ios_base::Init::~Init(), %edi\n        call    __cxa_atexit\n.L4:\n        nop\n        leave\n        ret\n        pushq   %rbp\n        movq    %rsp, %rbp\n        movl    $65535, %esi\n        movl    $1, %edi\n        call    __static_initialization_and_destruction_0(int, int)\n        popq    %rbp\n        ret\n</code></pre>\n"}], "owner": {"reputation": 1579, "user_id": 5215536, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/2b44d6db2f2f3fa384fd15d46f4f9c4d?s=128&d=identicon&r=PG&f=1", "display_name": "YiFei", "link": "https://stackoverflow.com/users/5215536/yifei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 1, "accepted_answer_id": 39113663, "answer_count": 1, "score": 1, "last_activity_date": 1472017325, "creation_date": 1472005725, "last_edit_date": 1472006096, "question_id": 39113490, "link": "https://stackoverflow.com/questions/39113490/difference-at-assembly-level-of-printf-from-cstdio-and-iostream", "title": "Difference at assembly level of printf from cstdio and iostream", "body": "<p>So this question is just out of curiosity.\nI have some tiny program:</p>\n\n<pre><code>#include &lt;some_header&gt;\nvoid print(){ printf(\"abc\"); } // don't care about main, I'm not gonna run it\n</code></pre>\n\n<p>Then I compiled it to assembly, with once <code>some_header</code>=><code>iostream</code> and another time <code>some_header</code>=><code>cstdio</code> with gcc.godbolt.org (6.1 for x86_64) with <code>-O3 -pedantic -std=c++14</code>. Look at this:</p>\n\n<pre><code>.LC0:\n        .string \"abc\"\nprint(): (iostream) or (both included)\n        movl    $.LC0, %edi\n        xorl    %eax, %eax\n        jmp     printf\n        subq    $8, %rsp\n        movl    std::__ioinit, %edi\n        call    std::ios_base::Init::Init()\n        movl    $__dso_handle, %edx\n        movl    std::__ioinit, %esi\n        movl    std::ios_base::Init::~Init(), %edi\n        addq    $8, %rsp\n        jmp     __cxa_atexit\nprint(): (cstdio)\n        movl    $.LC0, %edi\n        xorl    %eax, %eax\n        jmp     printf\n</code></pre>\n\n<p>There's a significant difference between them, and they're identical for the first three lines, so why do <code>iostream</code> need such amount of code to clean up or what are those lines just doing? OR just to say that godbolt is unreliable upon this task?</p>\n\n<hr>\n\n<p>Also it seems that standard doesn't guarantee that printf is accessible from <code>iostream</code>, should this be relied upon?</p>\n"}, {"tags": ["c", "makefile"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472004336, "post_id": 39113300, "comment_id": 65573803, "body": "Source files don&#39;t contain object files by definition! Compilers don&#39;t link. See <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>, provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 1, "creation_date": 1472004490, "post_id": 39113300, "comment_id": 65573832, "body": "You only need the final linking for <code>rlmain</code> not for <code>rlist.o</code>. Just compile <code>rlist.o</code> with <code>-c</code> as you do for <code>queue.o</code>. And then link them both in the final <code>rlmain</code> target."}, {"owner": {"reputation": 167, "user_id": 3466773, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3a9d2212c28c775b172990deba6b5244?s=128&d=identicon&r=PG", "display_name": "user3466773", "link": "https://stackoverflow.com/users/3466773/user3466773"}, "edited": false, "score": 0, "creation_date": 1472004756, "post_id": 39113300, "comment_id": 65573885, "body": "but when I do that, it&#39;s saying rlist.o has undefined references to all of my queue functions"}, {"owner": {"reputation": 167, "user_id": 3466773, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3a9d2212c28c775b172990deba6b5244?s=128&d=identicon&r=PG", "display_name": "user3466773", "link": "https://stackoverflow.com/users/3466773/user3466773"}, "edited": false, "score": 0, "creation_date": 1472004893, "post_id": 39113300, "comment_id": 65573909, "body": "What more could you possibly need to answer a question Olaf..."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472004905, "post_id": 39113300, "comment_id": 65573911, "body": "@user3466773: That is a completely different issue. &quot;What more could you possibly need to answer a question&quot; - Let me think ... The actual error and the necessary information?"}, {"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 0, "creation_date": 1472005500, "post_id": 39113300, "comment_id": 65574040, "body": "&quot;when I do that&quot;. When you do what? You probably did &quot;that&quot; wrongly (you can&#39;t get undefined reference link errors with <code>-c</code> because by definition it doesn&#39;t link). So show exactly what you did and what the exact error message is if you want help. Because your &quot;that&quot; and what I think your &quot;that&quot; is could be very different."}, {"owner": {"reputation": 167, "user_id": 3466773, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3a9d2212c28c775b172990deba6b5244?s=128&d=identicon&r=PG", "display_name": "user3466773", "link": "https://stackoverflow.com/users/3466773/user3466773"}, "edited": false, "score": 0, "creation_date": 1472005711, "post_id": 39113300, "comment_id": 65574097, "body": "First off, I know why the error happens if I don&#39;t include -c, and I specified it. Second, there&#39;s only a warning when I -c &quot;gcc: warning: queue.o: linker input file unused because linking not done&quot; and then I make the rlmain and I have undefined references to all of my queue.o functions. There shouldn&#39;t need to be any more information for how to do one technical operation that would help a few people with this issue, as embedded structures are a fairly common practice, but if there was a prior post I would not have made this one."}, {"owner": {"reputation": 167, "user_id": 3466773, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3a9d2212c28c775b172990deba6b5244?s=128&d=identicon&r=PG", "display_name": "user3466773", "link": "https://stackoverflow.com/users/3466773/user3466773"}, "edited": false, "score": 0, "creation_date": 1472005755, "post_id": 39113300, "comment_id": 65574110, "body": "-c in rlist.o. then make rlmain, kaylum"}, {"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 0, "creation_date": 1472005884, "post_id": 39113300, "comment_id": 65574141, "body": "Please, please update the question with the <i>exact</i> changes. For example, did you add <code>queue.o</code> to the <code>rlmain</code> build command? And remove <code>queue.o</code> from the <code>rlist.o</code> build command?"}, {"owner": {"reputation": 167, "user_id": 3466773, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3a9d2212c28c775b172990deba6b5244?s=128&d=identicon&r=PG", "display_name": "user3466773", "link": "https://stackoverflow.com/users/3466773/user3466773"}, "edited": false, "score": 0, "creation_date": 1472006005, "post_id": 39113300, "comment_id": 65574172, "body": "I didn&#39;t make any changes, kaylum. I&#39;m saying I already tried what you told me to do but it did not work. I compiled rlist.o with a -c flag, then when I make rlmain it errs and says all my functions defined in queue.h are undefinded"}, {"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 0, "creation_date": 1472006088, "post_id": 39113300, "comment_id": 65574182, "body": "You did make changes to try what I suggested. The fact is that it seems you did not make those changes in the correct way. But without seeing exactly what you tried we cannot  help you to progress further. But the general solution approach is the same - don&#39;t attempt to link until the final stage."}, {"owner": {"reputation": 167, "user_id": 3466773, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3a9d2212c28c775b172990deba6b5244?s=128&d=identicon&r=PG", "display_name": "user3466773", "link": "https://stackoverflow.com/users/3466773/user3466773"}, "edited": false, "score": 0, "creation_date": 1472006202, "post_id": 39113300, "comment_id": 65574202, "body": "Alright, it was updated with my change I made"}, {"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 0, "creation_date": 1472006467, "post_id": 39113300, "comment_id": 65574255, "body": "I already pointed out to you: add queue.o to the rlmain build command and remove queue.o from the rlist.o build command."}, {"owner": {"reputation": 167, "user_id": 3466773, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3a9d2212c28c775b172990deba6b5244?s=128&d=identicon&r=PG", "display_name": "user3466773", "link": "https://stackoverflow.com/users/3466773/user3466773"}, "edited": false, "score": 0, "creation_date": 1472007187, "post_id": 39113300, "comment_id": 65574393, "body": "Well it looks like it compiled, so thank you, but shouldn&#39;t there be a problem compiling rlist.o if in rlist.c I&#39;m calling functions defined in queue.h?"}, {"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 0, "creation_date": 1472008407, "post_id": 39113300, "comment_id": 65574647, "body": "No. Because symbol resolution only happens at the link stage (without the <code>-c</code>). In the compilation phase any undefined symbols are marked but are not considered errors as that is the job of the later link phase to resolve."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472138044, "post_id": 39113300, "comment_id": 65641373, "body": "from your question, it is obvious that each of the three compile operations (and you really should have 3 compile rules + 1 link rule)  each need to 1) source must #include each of the header files 2) the make file should list every &#39;user&#39; header file that contains prototypes that are called within the associated source file."}], "answers": [{"comments": [{"owner": {"reputation": 167, "user_id": 3466773, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3a9d2212c28c775b172990deba6b5244?s=128&d=identicon&r=PG", "display_name": "user3466773", "link": "https://stackoverflow.com/users/3466773/user3466773"}, "edited": false, "score": 0, "creation_date": 1472162759, "post_id": 39149316, "comment_id": 65654354, "body": "Thanks for the better practices, but what does $&lt; mean?"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "reply_to_user": {"reputation": 167, "user_id": 3466773, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3a9d2212c28c775b172990deba6b5244?s=128&d=identicon&r=PG", "display_name": "user3466773", "link": "https://stackoverflow.com/users/3466773/user3466773"}, "edited": false, "score": 0, "creation_date": 1472252780, "post_id": 39149316, "comment_id": 65693737, "body": "The $ what ever macros are very useful.  I use the macros defined in the GNU MAKE utility.   download the full manual from: <code>https:&#47;&#47;www.gnu.org&#47;software&#47;make&#47;manual&#47;</code>    I have edited the answer to include some of the <code>make</code> &#39;shortcut&#39; macros"}], "tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": true, "score": 1, "last_activity_date": 1472253319, "last_edit_date": 1472253319, "creation_date": 1472139210, "answer_id": 39149316, "question_id": 39113300, "link": "https://stackoverflow.com/questions/39113300/compile-and-link-a-source-file-containing-object-files-to-another-data-structure/39149316#39149316", "title": "Compile and link a source file containing object files to another data structure", "body": "<pre><code>Note: `&lt;tab&gt;` needs to be replaced with a tab character\nNote: use `:=` when defining macros, so they are only evaluated once\n\n# select the specific external executables to run\nCC := /usr/bin/gcc\nRM := /usr/bin/rm\n\nINCLUDE := ./Structures/\nCFLAGS  := -c -Wall -Wextra -pedantic -Wconversion -std=gnu99 \nOBJS    := main.o rlist.o queue.o\n\n.PHONY: all clean\n\nall: rlmain\n\nqueue.o: $(INCLUDE)queue.c $(INCS)\n&lt;tab&gt;$(CC) $(CFLAGS) $&lt; -o $@ -I$(INCLUDE)\n\nrlist.o: $(INCLUDE)rlist.c $(INCS)\n&lt;tab&gt;$(CC) $(CFLAGS) $&lt; -o $@ -I$(INCLUDE)\n\nmain.o: $(INCLUDE)main.c $(INCS)\n&lt;tab&gt;$(CC) $(CFLAGS) $&lt; -o $@ -I$(INCLUDE)\n\nrlmain: $(OBJS) \n&lt;tab&gt;$(CC) $(OBJS) $(LFLAGS)\n\nclean: \n&lt;tab&gt;$(RM) -f *.o rlmain\n</code></pre>\n\n<p>--EDIT-- following ADDED --\nthe following are some of the more common <code>GNU make</code> utility macros</p>\n\n<pre><code>$@  &lt;&lt;-- the name to the left of the colon on the `rule`\n\n    The file name of the target.\n$%\n\n    The target member name, when the target is an archive member.\n$&lt;  &lt;&lt;-- I use this to reference the first dependency on the `rule`\n\n    The name of the first prerequisite.\n$?  &lt;&lt;-- a more reliable method to reference the first dependency on the `rule`\n\n    The names of all the prerequisites that are newer than the target, with spaces between them. For prerequisites which are archive members, only the named member is used (see Archives).\n$^\n$+\n\n    The names of all the prerequisites, with spaces between them. For prerequisites which are archive members, only the named member is used (see Archives). The value of $^ omits duplicate prerequisites, while $+ retains them and preserves their order.\n$*\n\n    The stem with which an implicit rule matches (see How Patterns Match).\n$(@D)\n$(@F)\n\n    The directory part and the file-within-directory part of $@.\n$(*D)\n$(*F)\n\n    The directory part and the file-within-directory part of $*.\n$(%D)\n$(%F)\n\n    The directory part and the file-within-directory part of $%.\n$(&lt;D)\n$(&lt;F)\n\n    The directory part and the file-within-directory part of $&lt;.\n$(^D)\n$(^F)\n\n    The directory part and the file-within-directory part of $^.\n$(+D)\n$(+F)\n\n    The directory part and the file-within-directory part of $+.\n$(?D)\n$(?F)\n\n    The directory part and the file-within-directory part of $?. \n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 3466773, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3a9d2212c28c775b172990deba6b5244?s=128&d=identicon&r=PG", "display_name": "user3466773", "link": "https://stackoverflow.com/users/3466773/user3466773"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "closed_date": 1472314419, "accepted_answer_id": 39149316, "answer_count": 1, "score": -4, "last_activity_date": 1472253319, "creation_date": 1472004057, "last_edit_date": 1472006793, "question_id": 39113300, "link": "https://stackoverflow.com/questions/39113300/compile-and-link-a-source-file-containing-object-files-to-another-data-structure", "closed_reason": "Not suitable for this site", "title": "Compile and link a source file containing object files to another data structure", "body": "<p>This is my current Makefile:</p>\n\n<pre><code>CC=gcc\nINCLUDE=./Structures/\nCFLAGS=-Wall -I$(INCLUDE)\nOBJS=rlmain.o rlist.o queue.o\n\n.PHONY: all clean\n\nall: rlmain\n\nqueue.o: $(INCLUDE)queue.c $(INCLUDE)queue.h\n        $(CC) $(CFLAGS) -c $(INCLUDE)queue.c -o queue.o\n\nrlist.o: $(INCLUDE)rlist.c $(INCLUDE)rlist.h\n        $(CC) $(CFLAGS) -c $(INCLUDE)rlist.c -o rlist.o\n\nrlmain: main.c rlist.o queue.o\n        $(CC) $(CFLAGS) main.c rlist.o queue.o -o rlmain\n\nclean: \n        rm -f *.o rlmain\n</code></pre>\n\n<p>Makefile is in the top directory. In the lower directory called \"Structures\" is a collection of files for my data structures. My data structures implement a ready list - a linked list of queues.</p>\n\n<p>I managed to get queue.o working using '-c' but I cannot get rlist.o to make because rlist.c does not contain a main method, and it must link to the queue.o functions. I'm using the command <code>make</code></p>\n\n<p>Everything else working except the command. I want to write a command to tell the compiler to link the queue.o functions to the rlist.c compilation but not compile the functions that require main(). What do I do in order to make that happen?</p>\n"}, {"tags": ["c", "lapack", "stan"], "comments": [{"owner": {"reputation": 4520, "user_id": 1762912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fea49706fe47d5c2e8f3dd183d63ec42?s=128&d=identicon&r=PG", "display_name": "Ben Goodrich", "link": "https://stackoverflow.com/users/1762912/ben-goodrich"}, "edited": false, "score": 0, "creation_date": 1472002934, "post_id": 39112833, "comment_id": 65573485, "body": "It is pretty much impossible to interface Stan with C or Fortran because Stan relies on templated C++ to handle the autodifferentiation among other reasons. But if you can write C code, you can write code. The Stan language has <code>cholesky_decompose</code> and matrix solvers (with the `` operator), so I&#39;m not sure what else you would need to port a function like get_V."}, {"owner": {"reputation": 1, "user_id": 6277191, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZTRihqqZlh4/AAAAAAAAAAI/AAAAAAAAAE8/KJjo6oY89J0/photo.jpg?sz=128", "display_name": "Lu Zhang", "link": "https://stackoverflow.com/users/6277191/lu-zhang"}, "reply_to_user": {"reputation": 4520, "user_id": 1762912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fea49706fe47d5c2e8f3dd183d63ec42?s=128&d=identicon&r=PG", "display_name": "Ben Goodrich", "link": "https://stackoverflow.com/users/1762912/ben-goodrich"}, "edited": false, "score": 0, "creation_date": 1472004740, "post_id": 39112833, "comment_id": 65573879, "body": "I see, Thank you very much. By the way, do you know how to use user-defined derivative instead of the default derivative in &quot;stan&quot;?"}, {"owner": {"reputation": 4520, "user_id": 1762912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fea49706fe47d5c2e8f3dd183d63ec42?s=128&d=identicon&r=PG", "display_name": "Ben Goodrich", "link": "https://stackoverflow.com/users/1762912/ben-goodrich"}, "edited": false, "score": 0, "creation_date": 1472013475, "post_id": 39112833, "comment_id": 65575804, "body": "That is not currently possible. But it usually does not matter that much since autodiffing only takes about 3 to 5 times as long as evaluating the posterior log-density."}, {"owner": {"reputation": 1, "user_id": 6277191, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZTRihqqZlh4/AAAAAAAAAAI/AAAAAAAAAE8/KJjo6oY89J0/photo.jpg?sz=128", "display_name": "Lu Zhang", "link": "https://stackoverflow.com/users/6277191/lu-zhang"}, "reply_to_user": {"reputation": 4520, "user_id": 1762912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fea49706fe47d5c2e8f3dd183d63ec42?s=128&d=identicon&r=PG", "display_name": "Ben Goodrich", "link": "https://stackoverflow.com/users/1762912/ben-goodrich"}, "edited": false, "score": 0, "creation_date": 1472015001, "post_id": 39112833, "comment_id": 65576284, "body": "Alright, I will try to rewrite it in &quot;stan&quot;. Thank you."}], "owner": {"reputation": 1, "user_id": 6277191, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZTRihqqZlh4/AAAAAAAAAAI/AAAAAAAAAE8/KJjo6oY89J0/photo.jpg?sz=128", "display_name": "Lu Zhang", "link": "https://stackoverflow.com/users/6277191/lu-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472003067, "creation_date": 1472000058, "last_edit_date": 1472003067, "question_id": 39112833, "link": "https://stackoverflow.com/questions/39112833/how-to-implement-user-defined-function-from-c-in-stan", "title": "How to implement user-defined function from c in stan", "body": "<p>I am trying to use HMC to do MCMC sampling with a self-defined target function. I had my HMC code, but it doesn't work well. I recently knew \"stan\" which has a more powerful HMC model. So I want to implement my code with \"stan\".</p>\n\n<p>I have already coded the target function as well as the derivative function in C. It involves for-loop, and functions needed for Cholesky decomposition and other linear algebras from Lapack. I really don't want to recode it in stan. Is there any way to use my functions directly? I would also appreciate it if anyone can give some clues about how to modify my code, or teach me how to modify \"stan\" code. The following is part of my code:</p>\n\n<pre><code>void get_V(double phi, double sigmasq, double k, double *neardist, \ndouble *neardistM, int *nearind, double *w, int n, int m, double *V){\n\ndouble one = 1.0, var;\nint i, j, dim ,info, int_one = 1;\ndouble *u, *temp_neardistM;\nchar UPLO = 'L';\nchar SIDE = 'L', DIAG = 'N';\nchar TRANS = 'N', TRANS2 = 'T';\n\nvar = (double)(1/k) * sigmasq;\n\nV[0] = var;\n\nfor (i = 1; i &lt; n ; i++){\n    if(i &lt; m) {\n        dim = i;\n    }\n    else {\n        dim = m;\n    }\n\n    ...       \n\n    // Cholesky decomposition of temp_neardistM\n    info = -1;\n    dpotrf_(&amp;UPLO, &amp;dim, temp_neardistM, &amp;dim, &amp;info);   \n    if (info != 0) {free(temp_neardistM); return ;}\n\n    ...\n\n    // get Vi\n    dtrsm_(&amp;SIDE, &amp;UPLO, &amp;TRANS, &amp;DIAG, &amp;dim, &amp;int_one, &amp;one, temp_neardistM, &amp;dim, u, &amp;dim);\n    V[i] = (var - sigmasq * (sq_sum(u, dim)) );\n\n    ...\n\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "printf", "mingw"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 3, "creation_date": 1472000160, "post_id": 39112759, "comment_id": 65572813, "body": "How about having a look into the standard? <a href=\"http://port70.net/~nsz/c/c11/n1570.html#7.21.6.1\" rel=\"nofollow noreferrer\">port70.net/~nsz/c/c11/n1570.html#7.21.6.1</a> ? If your environment does not support this, it is not compliant."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 1, "creation_date": 1472001273, "post_id": 39112759, "comment_id": 65573093, "body": "What does <code>-v</code> report for version information?"}, {"owner": {"reputation": 1468, "user_id": 1188636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56a9f6905eee8797a30f70f109a40853?s=128&d=identicon&r=PG", "display_name": "crowding", "link": "https://stackoverflow.com/users/1188636/crowding"}, "edited": false, "score": 0, "creation_date": 1472001324, "post_id": 39112759, "comment_id": 65573110, "body": "I don&#39;t have the compiler environment easily accessible -- I am getting the log from a package build service."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 0, "creation_date": 1472001680, "post_id": 39112759, "comment_id": 65573193, "body": "GCC doesn&#39;t support <code>%a</code> directly, it relies on the library implementation to actually do it. Does your MinGW use <code>glibc</code>?"}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 2, "creation_date": 1472001770, "post_id": 39112759, "comment_id": 65573206, "body": "MS Visual C is not C99 compliant, so its runtime library may not support <code>%a</code>. If MinGW is using the MS Visual C runtime, then it wouldn&#39;t support <code>%a</code> either."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1472002351, "post_id": 39112759, "comment_id": 65573349, "body": "To solve the higher level problem &quot;need to losslessly represent a double precision float in a string&quot;, consider using <code>&quot;%.*e&quot;</code> <a href=\"http://stackoverflow.com/q/16839658/2410359\">Printf width specifier to maintain precision of floating-point value</a>  Works back to C89."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472003717, "post_id": 39112759, "comment_id": 65573673, "body": "@chux: The <code>*</code> specifies a variable precision, requiring an additional argument. Not sure how that would differ from a constant here. And that is not the same as <code>%a</code>."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 1, "creation_date": 1472009761, "post_id": 39112759, "comment_id": 65574917, "body": "Try using mingw-w64  (mingw is an old defunct project), and define <code>#define __USE_MINGW_ANSI_STDIO 1</code>, this will make it use its own printf implementation instead of referring to microsoft&#39;s broken one"}, {"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1472010656, "post_id": 39112759, "comment_id": 65575121, "body": "@M.M: Assuming that works, you should post it as an answer."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "reply_to_user": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 0, "creation_date": 1472010765, "post_id": 39112759, "comment_id": 65575136, "body": "@KeithThompson my comment doesn&#39;t help with the question &quot;How to detect if printf will support %a&quot;  . It seems OP is XY-probleming"}, {"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1472010923, "post_id": 39112759, "comment_id": 65575162, "body": "@M.M: Hmm. Once you define that macro, you can tell that it <i>does</i> support <code>%a</code>."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1472010976, "post_id": 39112759, "comment_id": 65575174, "body": "ok. will wait for OP to report if it works or not"}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "reply_to_user": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 0, "creation_date": 1472011408, "post_id": 39112759, "comment_id": 65575268, "body": "@KeithThompson do you know where I can find sample data for %a ? On my system , <code>double x = 3.14; printf(&quot;%a&quot;, x);</code> gives <code>0xc.8f5c285fc28f8p-2</code>, but <a href=\"http://stackoverflow.com/questions/4826842/the-format-specifier-a-for-printf-in-c\">this page</a> suggests that isn&#39;t the right answer."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1472011584, "post_id": 39112759, "comment_id": 65575310, "body": "@M.M  What is wrong about <code>0xc.8f5c285fc28f8p-2</code>?  It meets C spec."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472011618, "post_id": 39112759, "comment_id": 65575322, "body": "@chux it&#39;s different to the expected value of <code>0x1.91eb86p+1</code>"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1472011757, "post_id": 39112759, "comment_id": 65575357, "body": "@M.M  The spec does not specify the range of the leading digit as long as it is non-zero (except for sub-normal)  &quot;... where there is one hexadecimal digit (which is nonzero if the argument is a normalized floating-point number and is otherwise unspecified) ...&quot;  Its the same value either way."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1472011867, "post_id": 39112759, "comment_id": 65575385, "body": "ok, if you write both in binary and offset by 3 bits then they sort of match up"}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1472013012, "post_id": 39112759, "comment_id": 65575681, "body": "make sure you&#39;re compiling with <code>-std=c99</code> or <code>-std=c11</code> of course"}], "answers": [{"comments": [{"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 2, "creation_date": 1472002337, "post_id": 39113059, "comment_id": 65573344, "body": "To answer the actual question, <code>#ifdef __MINGW32__</code> is probably sufficient to decide to use the workaround."}], "tags": [], "owner": {"reputation": 5298, "user_id": 4241278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53f687af42c3e779a0f2ee98d5fe3bb4?s=128&d=identicon&r=PG", "display_name": "deamentiaemundi", "link": "https://stackoverflow.com/users/4241278/deamentiaemundi"}, "is_accepted": false, "score": 2, "last_activity_date": 1472002057, "creation_date": 1472002057, "answer_id": 39113059, "question_id": 39112759, "link": "https://stackoverflow.com/questions/39112759/how-to-detect-if-printf-will-support-a/39113059#39113059", "title": "How to detect if printf will support %a?", "body": "<p>As jxh already suspected, MingW uses the <a href=\"http://www.mingw.org/wiki/c99\" rel=\"nofollow\">MSVCRT LibC</a> from Windows. The C99 support is not complete, especially some of the options of <code>printf(3)</code> like <code>a</code> are missing. </p>\n"}, {"comments": [{"owner": {"reputation": 9796, "user_id": 1565512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb35a5b79ac6032efc45cc9e2aa81260?s=128&d=identicon&r=PG", "display_name": "MikeM", "link": "https://stackoverflow.com/users/1565512/mikem"}, "edited": false, "score": 0, "creation_date": 1527885466, "post_id": 39114367, "comment_id": 88312255, "body": "<code>0xc.8f5c28f5c28f8p-2 = 3.140000000000000124344978758017532527446746826171875 (3.14)</code> and <code>0x1.91eb85p+1 = 3.13999998569488525390625 (3.1399999856948853)</code>"}], "tags": [], "owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "is_accepted": false, "score": 3, "last_activity_date": 1472012425, "creation_date": 1472012425, "answer_id": 39114367, "question_id": 39112759, "link": "https://stackoverflow.com/questions/39112759/how-to-detect-if-printf-will-support-a/39114367#39114367", "title": "How to detect if printf will support %a?", "body": "<p>This doesn't answer the question \"How to detect if printf will support %a?\" in the general case, but you can modify your compiler installation so that <code>%a</code> is supported.</p>\n\n<p>First of all , use <a href=\"http://mingw-w64.org/doku.php\" rel=\"nofollow\">mingw-w64</a>.  This is an up-to-date fork of MinGW.  The original version of MinGW is not well maintained and does not fix bugs such as you are experiencing (preferring to blame Microsoft or something).</p>\n\n<p>Using mingw-w64 4.9.2 in Windows 10, the following code works for me:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    double x = 3.14;\n    printf(\"%a\\n\", x);\n}\n</code></pre>\n\n<p>producing <code>0x1.91eb85p+1</code> which is correct. This is still deferring to the Microsoft runtime.</p>\n\n<hr>\n\n<p>Your question mentions <code>%la</code>, however <code>%a</code> and <code>%la</code> are both the same and can be used to print either a <code>float</code> or a <code>double</code> argument.</p>\n\n<p>If you want to print a <code>long double</code>, then the Microsoft runtime does not support that; gcc and MS use different sizes of <code>long double</code>. You have to use mingw-w64's own printf implementation:</p>\n\n<pre><code>#define __USE_MINGW_ANSI_STDIO 1\n#include &lt;stdio.h&gt;\n\nint main()\n{\n    long double x = 3.14;\n    printf(\"%La\\n\", x);\n}\n</code></pre>\n\n<p>which outputs <code>0xc.8f5c28f5c28f8p-2</code>.   This is actually the same number as <code>0x1.91eb85p+1</code> with more precision and a different placement of the binary point, it is also correct.</p>\n"}], "owner": {"reputation": 1468, "user_id": 1188636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56a9f6905eee8797a30f70f109a40853?s=128&d=identicon&r=PG", "display_name": "crowding", "link": "https://stackoverflow.com/users/1188636/crowding"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1472012425, "creation_date": 1471999427, "question_id": 39112759, "link": "https://stackoverflow.com/questions/39112759/how-to-detect-if-printf-will-support-a", "title": "How to detect if printf will support %a?", "body": "<p>I need to losslessly represent a double precision float in a string, and so I am using </p>\n\n<pre><code>sprintf(buf, \"%la\", x);\n</code></pre>\n\n<p>This works fine on my system, but when built on MinGW under Windows, gives a warning:</p>\n\n<pre><code>unknown conversion type character 'a' in format\n</code></pre>\n\n<p>I coded up a workaround for this case, but have trouble detecting when I should use the workaround -- I tried <code>#if __STDC_VERSION__ &gt;= 199901L</code>, but it seems Gcc/MinGW defines that even if it doesn't support <code>%a</code>. Is there another macro I could check?</p>\n"}, {"tags": ["c", "linux", "linux-kernel", "linux-device-driver"], "comments": [{"owner": {"reputation": 695058, "user_id": 20862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2343ae368d3241278581ce6c87f62a25?s=128&d=identicon&r=PG", "display_name": "Ignacio Vazquez-Abrams", "link": "https://stackoverflow.com/users/20862/ignacio-vazquez-abrams"}, "edited": false, "score": 3, "creation_date": 1472000141, "post_id": 39112724, "comment_id": 65572809, "body": "Not all of Linux is meant to be run as modules..."}, {"owner": {"reputation": 3198, "user_id": 1636521, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/2116626f42d8a2f87ee420ecefb1ec0c?s=128&d=identicon&r=PG", "display_name": "flashburn", "link": "https://stackoverflow.com/users/1636521/flashburn"}, "reply_to_user": {"reputation": 695058, "user_id": 20862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2343ae368d3241278581ce6c87f62a25?s=128&d=identicon&r=PG", "display_name": "Ignacio Vazquez-Abrams", "link": "https://stackoverflow.com/users/20862/ignacio-vazquez-abrams"}, "edited": false, "score": 0, "creation_date": 1472014852, "post_id": 39112724, "comment_id": 65576223, "body": "@IgnacioVazquez-Abrams Can you clarify your comment? I&#39;m not sure what you mean."}, {"owner": {"reputation": 695058, "user_id": 20862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2343ae368d3241278581ce6c87f62a25?s=128&d=identicon&r=PG", "display_name": "Ignacio Vazquez-Abrams", "link": "https://stackoverflow.com/users/20862/ignacio-vazquez-abrams"}, "edited": false, "score": 0, "creation_date": 1472015367, "post_id": 39112724, "comment_id": 65576428, "body": "<code>mem.o</code> is supposed to be linked into the final kernel executable."}, {"owner": {"reputation": 3198, "user_id": 1636521, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/2116626f42d8a2f87ee420ecefb1ec0c?s=128&d=identicon&r=PG", "display_name": "flashburn", "link": "https://stackoverflow.com/users/1636521/flashburn"}, "reply_to_user": {"reputation": 695058, "user_id": 20862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2343ae368d3241278581ce6c87f62a25?s=128&d=identicon&r=PG", "display_name": "Ignacio Vazquez-Abrams", "link": "https://stackoverflow.com/users/20862/ignacio-vazquez-abrams"}, "edited": false, "score": 0, "creation_date": 1472057378, "post_id": 39112724, "comment_id": 65603314, "body": "@IgnacioVazquez-Abrams Aren&#39;t all modules supposed to be linked with the kernel?"}, {"owner": {"reputation": 695058, "user_id": 20862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2343ae368d3241278581ce6c87f62a25?s=128&d=identicon&r=PG", "display_name": "Ignacio Vazquez-Abrams", "link": "https://stackoverflow.com/users/20862/ignacio-vazquez-abrams"}, "edited": false, "score": 0, "creation_date": 1472057480, "post_id": 39112724, "comment_id": 65603372, "body": "Yes, but not all compilation units can be used as modules."}, {"owner": {"reputation": 3198, "user_id": 1636521, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/2116626f42d8a2f87ee420ecefb1ec0c?s=128&d=identicon&r=PG", "display_name": "flashburn", "link": "https://stackoverflow.com/users/1636521/flashburn"}, "reply_to_user": {"reputation": 695058, "user_id": 20862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2343ae368d3241278581ce6c87f62a25?s=128&d=identicon&r=PG", "display_name": "Ignacio Vazquez-Abrams", "link": "https://stackoverflow.com/users/20862/ignacio-vazquez-abrams"}, "edited": false, "score": 0, "creation_date": 1472057610, "post_id": 39112724, "comment_id": 65603436, "body": "@IgnacioVazquez-Abrams As far as I understand <code>mem.c</code> is a driver. Aren&#39;t drivers supposed to be loadable and unloadable?"}, {"owner": {"reputation": 695058, "user_id": 20862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2343ae368d3241278581ce6c87f62a25?s=128&d=identicon&r=PG", "display_name": "Ignacio Vazquez-Abrams", "link": "https://stackoverflow.com/users/20862/ignacio-vazquez-abrams"}, "edited": false, "score": 0, "creation_date": 1472058320, "post_id": 39112724, "comment_id": 65603826, "body": "Where did you hear that <code>mem.c</code> is a driver?"}, {"owner": {"reputation": 3198, "user_id": 1636521, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/2116626f42d8a2f87ee420ecefb1ec0c?s=128&d=identicon&r=PG", "display_name": "flashburn", "link": "https://stackoverflow.com/users/1636521/flashburn"}, "reply_to_user": {"reputation": 695058, "user_id": 20862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2343ae368d3241278581ce6c87f62a25?s=128&d=identicon&r=PG", "display_name": "Ignacio Vazquez-Abrams", "link": "https://stackoverflow.com/users/20862/ignacio-vazquez-abrams"}, "edited": false, "score": 0, "creation_date": 1472059098, "post_id": 39112724, "comment_id": 65604244, "body": "The code for it is located under <code>drivers&#47;char</code>. I assume that all the drivers are located under a <code>drivers</code> directory. Am I wrong?"}, {"owner": {"reputation": 695058, "user_id": 20862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2343ae368d3241278581ce6c87f62a25?s=128&d=identicon&r=PG", "display_name": "Ignacio Vazquez-Abrams", "link": "https://stackoverflow.com/users/20862/ignacio-vazquez-abrams"}, "edited": false, "score": 0, "creation_date": 1472059569, "post_id": 39112724, "comment_id": 65604482, "body": "Modules are meant to be loadable and unloadable. Not all drivers are modules."}], "owner": {"reputation": 3198, "user_id": 1636521, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/2116626f42d8a2f87ee420ecefb1ec0c?s=128&d=identicon&r=PG", "display_name": "flashburn", "link": "https://stackoverflow.com/users/1636521/flashburn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 291, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1471999118, "creation_date": 1471999118, "question_id": 39112724, "link": "https://stackoverflow.com/questions/39112724/compiling-mem-c-without-config-strict-devmem-flag", "title": "compiling mem.c without CONFIG_STRICT_DEVMEM flag", "body": "<p>I'm trying to compile <code>mem.c</code> module with a <code>CONFIG_STRICT_DEVMEM</code> disabled. The idea is to have a module that will allow me to access address space in <code>/dev/mem</code> above 1MB. Why? I'm doing some testing which requires access to this memory space. </p>\n\n<p>I copied <code>mem.c</code> into my home directory, removed code that has access restriction and compiled it. However I'm getting the following warnings:</p>\n\n<pre><code>WARNING: \"kmsg_fops\" [/home/user/projects/new_mem/mem.ko] undefined!\nWARNING: \"tty_init\" [/home/user/projects/new_mem/mem.ko] undefined!\nWARNING: \"phys_mem_access_prot\" [/home/user/projects/new_mem/mem.ko] undefined!\nWARNING: \"xlate_dev_mem_ptr\" [/home/user/projects/new_mem/mem.ko] undefined!\nWARNING: \"devmem_is_allowed\" [/home/user/projects/new_mem/mem.ko] undefined!\nWARNING: \"splice_from_pipe\" [/home/user/projects/new_mem/mem.ko] undefined!\nWARNING: \"shmem_zero_setup\" [/home/user/projects/new_mem/mem.ko] undefined!\nmake[1]: Leaving directory `/usr/src/linux-headers-4.4.0-34-generic'\n</code></pre>\n\n<p>My questions are:</p>\n\n<p>Do I really have to compile every module that have these functions defined or there is another way to do it? If there is then what is it?</p>\n\n<p>All I need need is to compile code to be able to access <code>/dev/mem</code>, I really don't need all the other modules. Short of removing unnecessary code from <code>mem.c</code> is there another way to remove this code?</p>\n\n<p>Any help is appreciated.</p>\n"}, {"tags": ["linux", "c"], "answers": [{"tags": [], "owner": {"reputation": 12065, "user_id": 367865, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/78bdafae5cf469e2abebad372bb4e222?s=128&d=identicon&r=PG", "display_name": "Ouroborus", "link": "https://stackoverflow.com/users/367865/ouroborus"}, "is_accepted": true, "score": 5, "last_activity_date": 1472006896, "creation_date": 1472006113, "answer_id": 39113673, "question_id": 39113672, "link": "https://stackoverflow.com/questions/39113672/why-wont-this-code-permute-the-value-z/39113673#39113673", "title": "Why won&#39;t this code permute the value Z?", "body": "<p>You're printing the address of <code>z</code>, not the stored value, because you're passing <code>printf</code> a pointer to <code>z</code> rather than the value. Change the <code>printf</code> line to:</p>\n\n<pre><code>printf(\"%d\", z);\n</code></pre>\n\n<p><code>scanf</code> already returns a success value so has to use another way to give you the input. The argument you're passing (<code>&amp;x</code>) is a pointer to the variable you want to use for storage. That's what the ampersand is for. It says \"use the address of this variable\".</p>\n\n<p><code>printf</code>, on the other hand, just wants the values themselves. It doesn't need an address. (Though, technically, strings get passed in as pointers. Probably not a distinction you need to worry about right now.)</p>\n"}], "migrated_from": {"other_site": {"markdown_extensions": ["Prettify"], "launch_date": 1250553600, "open_beta_date": 1247529600, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon@2.png", "twitter_account": "super_user", "favicon_url": "https://cdn.sstatic.net/Sites/superuser/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon.png", "audience": "computer enthusiasts and power users", "site_url": "https://superuser.com", "api_site_parameter": "superuser", "logo_url": "https://cdn.sstatic.net/Sites/superuser/Img/logo.png", "name": "Super User", "site_type": "main_site"}, "on_date": 1472007235, "question_id": 1116933}, "owner": {"reputation": 13, "user_id": 6759253, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/c8HKS.png?s=128&g=1", "display_name": "Dillon Richardson", "link": "https://stackoverflow.com/users/6759253/dillon-richardson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 39113673, "answer_count": 1, "score": 0, "last_activity_date": 1472007235, "creation_date": 1471999020, "question_id": 39113672, "link": "https://stackoverflow.com/questions/39113672/why-wont-this-code-permute-the-value-z", "title": "Why won&#39;t this code permute the value Z?", "body": "<p>So I am trying to build a simple program in C that permutes the value of <code>z</code> (<code>z</code> is equal to <code>x + y</code>) but every single thing I try differently doesn't work. Seriously frustrated here. Please help me understand.</p>\n\n<p>Source: </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\nint main()\n{\n    int x, y, z;\n    scanf(\"%d\", &amp;x);\n    scanf(\"%d\", &amp;y);\n    z = x + y;\n    printf(\"%d\", &amp;z);\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "multithreading", "pthreads", "blocking"], "comments": [{"owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 2, "creation_date": 1471998929, "post_id": 39112670, "comment_id": 65572552, "body": "Add an eventfd to the mix on which you signal termination?"}, {"owner": {"reputation": 11, "user_id": 6750150, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/457609846fa4d6fc20f5348c167f9541?s=128&d=identicon&r=PG&f=1", "display_name": "A Sedate Mutant", "link": "https://stackoverflow.com/users/6750150/a-sedate-mutant"}, "reply_to_user": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 0, "creation_date": 1472010234, "post_id": 39112670, "comment_id": 65575039, "body": "That&#39;s a nice suggestion. I can try that. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 215710, "user_id": 134633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6be45ddcfd038ba5e1e5fca319c7fa?s=128&d=identicon&r=PG", "display_name": "caf", "link": "https://stackoverflow.com/users/134633/caf"}, "is_accepted": false, "score": 5, "last_activity_date": 1472013132, "creation_date": 1472013132, "answer_id": 39114474, "question_id": 39112670, "link": "https://stackoverflow.com/questions/39112670/how-to-gracefully-make-a-blocking-pthread-exit-from-the-main-thread/39114474#39114474", "title": "How to gracefully make a blocking pthread exit from the main thread?", "body": "<p>You can create an anonymous pipe with <code>pipe(2)</code> and have the file-descriptor-watching thread add the read end to its polled file descriptors, exiting when that file descriptor reports EOF.  The main thread then just closes the write end when it wants the thread to exit.</p>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 1, "last_activity_date": 1472017233, "creation_date": 1472017233, "answer_id": 39115217, "question_id": 39112670, "link": "https://stackoverflow.com/questions/39112670/how-to-gracefully-make-a-blocking-pthread-exit-from-the-main-thread/39115217#39115217", "title": "How to gracefully make a blocking pthread exit from the main thread?", "body": "<p>You can send the blocking thread a signal (e.g. <code>SIGUSR1</code>) with <code>pthread_kill()</code>. The <code>select</code> call should then return a negative value and set <code>errno</code> to <code>EINTR</code>.  Don't forget to set a handler for the signal you send.</p>\n"}], "owner": {"reputation": 11, "user_id": 6750150, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/457609846fa4d6fc20f5348c167f9541?s=128&d=identicon&r=PG&f=1", "display_name": "A Sedate Mutant", "link": "https://stackoverflow.com/users/6750150/a-sedate-mutant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1472017233, "creation_date": 1471998655, "question_id": 39112670, "link": "https://stackoverflow.com/questions/39112670/how-to-gracefully-make-a-blocking-pthread-exit-from-the-main-thread", "title": "How to gracefully make a blocking pthread exit from the main thread?", "body": "<p>I have a pthread which does an indefinite polling on some file descriptors, with negative timeout parameter.</p>\n\n<p>From the main thread, I would like to be able to indicate to the polling thread that it should exit.</p>\n\n<p>I did some research and found the following approaches:</p>\n\n<ol>\n<li><p>Use pthread_cancel(): This was discouraged as it might lead to unintended consequences of not clearing any held resources or mutexes</p></li>\n<li><p>Use a variable as a flag and set it in the main thread. The polling thread checks this flag every iteration and if set, exits by calling pthread_exit(). This approach won't work because my polling thread doesn't loop, but simply blocks indefinitely, waiting on the file descriptors.</p></li>\n</ol>\n\n<p>Can anyone suggest an elegant solution to this problem ?</p>\n\n<p>Thanks!\nASM</p>\n"}, {"tags": ["c", "cmake"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 3, "creation_date": 1472002823, "post_id": 39112571, "comment_id": 65573462, "body": "<b>All</b> declarations should always go into the header of the module/library which also defines it. <code>#include</code> the header in <b>every</b> compilation unit which requires any of its declarations."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472022602, "post_id": 39112571, "comment_id": 65579648, "body": "Somehow, you&#39;ve created a <code>test.c.o</code> file which you&#39;re trying to load into a library, but <code>test.c.o</code> contains no symbols according to the error message.  The file name for the object file would conventionally be <code>test.o</code> and not <code>test.c.o</code> \u2014 you might need to track that down.  And the link fails because the symbols that should be in the library aren&#39;t, so the linker fails to find them."}, {"owner": {"reputation": 21, "user_id": 2612864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b265dac049b7e34be412ab68f30d915?s=128&d=identicon&r=PG", "display_name": "tauruswang", "link": "https://stackoverflow.com/users/2612864/tauruswang"}, "edited": false, "score": 0, "creation_date": 1472031184, "post_id": 39112571, "comment_id": 65584939, "body": "very strange ? if i call the ddd function in main, the symbol  test_struct and ddd can be linked. if i don&#39;t call the ddd function in main program, make will report error for  _test_struct symbol is not undefined.   does it really rule should call the library function first then can link to the external struct defined in that library?"}, {"owner": {"reputation": 21, "user_id": 2612864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b265dac049b7e34be412ab68f30d915?s=128&d=identicon&r=PG", "display_name": "tauruswang", "link": "https://stackoverflow.com/users/2612864/tauruswang"}, "edited": false, "score": 0, "creation_date": 1472031400, "post_id": 39112571, "comment_id": 65585093, "body": "yes, i clear the cmake cache.  use the nm to check. if call the ddd function first every this is fine. but if don&#39;t call ddd function, then the external struct would not be linked."}, {"owner": {"reputation": 21, "user_id": 2612864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b265dac049b7e34be412ab68f30d915?s=128&d=identicon&r=PG", "display_name": "tauruswang", "link": "https://stackoverflow.com/users/2612864/tauruswang"}, "edited": false, "score": 0, "creation_date": 1472031406, "post_id": 39112571, "comment_id": 65585099, "body": "nm libmy_test_my.a   libmy_test_my.a(test.c.o): 0000000000000000 T _ddd 0000000000000018 C _my_test_str"}, {"owner": {"reputation": 17210, "user_id": 2436175, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/CK0Zo.png?s=128&g=1", "display_name": "Antonio", "link": "https://stackoverflow.com/users/2436175/antonio"}, "edited": false, "score": 0, "creation_date": 1472033279, "post_id": 39112571, "comment_id": 65586353, "body": "Not sure if this is the cause of all problems, but you are missing <code>#include &quot;test.h&quot;</code> at the beginning of test.c . You are getting an error about <code>ddd</code> which you are not even calling from <code>main</code>: I strongly suggest you restart from a clean (empty) build directory. In the main function, add some operations on the struct, and a call to <code>ddd()</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472139555, "post_id": 39112571, "comment_id": 65642327, "body": "both the file <code>test.c</code> and the file <code>main.c</code> need to have the statement: <code>#include &quot;test.h&quot;</code> added"}], "owner": {"reputation": 21, "user_id": 2612864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b265dac049b7e34be412ab68f30d915?s=128&d=identicon&r=PG", "display_name": "tauruswang", "link": "https://stackoverflow.com/users/2612864/tauruswang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 255, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1471998254, "creation_date": 1471997761, "question_id": 39112571, "link": "https://stackoverflow.com/questions/39112571/use-extern-structure-variable-defined-in-a-library-config-with-cmake", "title": "use extern structure variable defined in a library, config with cmake", "body": "<p>main.c</p>\n\n<pre><code>#include \"test.h\"\nextern struct test_struct my_test_str; // defined in my_test_lib.a \nint main(int argc, char *argv[]) {\n   return 0;\n}\n</code></pre>\n\n<p>here is the my_test_my library file of test.h and test.c\ncompiled as my_test_lib.a</p>\n\n<p>test.h</p>\n\n<pre><code>#ifndef TEST_MY\n#define TEST_MY\nstruct test_struct {\n  double d1;\n  double d2;\n  double d3;\n};\nvoid ddd(void);\n#endif\n</code></pre>\n\n<p>test.c</p>\n\n<pre><code>struct test_struct my_test_str;\nvoid ddd(void) {\n  int a = 0;\n  int c = 1;\n  c = a + c;\n}\n</code></pre>\n\n<p>write CMakeLists.txt , use cmake to generated Makefile</p>\n\n<pre><code>cmake_minimum_required(VERSION 2.6)\nproject(Tutorial)\n\nadd_library(my_test_my test.c)\nadd_executable(Tutorial main.c)\ntarget_link_libraries (Tutorial my_test_my)\n</code></pre>\n\n<p>after generate Makefiles in a out directory, execute the make</p>\n\n<pre><code>192:out jerryw$ make\n[ 25%] Building C object CMakeFiles/my_test_my.dir/test.c.o\n[ 50%] Linking C static library libmy_test_my.a\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: libmy_test_my.a(test.c.o) has no symbols\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: libmy_test_my.a(test.c.o) has no symbols\nwarning: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: warning for library: libmy_test_my.a the table of contents is empty (no object file members in the library define global symbols)\n[ 50%] Built target my_test_my\n[ 75%] Building C object CMakeFiles/Tutorial.dir/main.c.o\n[100%] Linking C executable Tutorial\nUndefined symbols for architecture x86_64:\n  \"_ddd\", referenced from:\n      _main in main.c.o\n  \"_my_test_str\", referenced from:\n      _main in main.c.o\nld: symbol(s) not found for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nmake[2]: *** [Tutorial] Error 1\nmake[1]: *** [CMakeFiles/Tutorial.dir/all] Error 2\nmake: *** [all] Error 2\n</code></pre>\n\n<p>why this happened ? </p>\n"}, {"tags": ["c", "arm", "itoa"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 3, "creation_date": 1471996327, "post_id": 39112255, "comment_id": 65571914, "body": "Variables don&#39;t have a &quot;decimal value&quot; - unless you use a digital system with decimal memory cells. Unlikely, all modern computers are <b>binary</b>. And C does not support <i>methods</i>, only <i>functions</i>."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471996901, "post_id": 39112255, "comment_id": 65572056, "body": "Step back and have a look at what <code>decimalToBinary</code> actually does. It us nonsense. Just remove the whole body and <code>return n;</code>. No offence, but you really messed it up. It is not even really clear what you actually want to accomplish. As you are aware of <code>itoa</code> (lowercase!), you seem to have something different in mind."}, {"owner": {"reputation": 38136, "user_id": 971127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6289285bbe25ce36ef68fe4932256350?s=128&d=identicon&r=PG&f=1", "display_name": "BLUEPIXY", "link": "https://stackoverflow.com/users/971127/bluepixy"}, "edited": false, "score": 0, "creation_date": 1471998421, "post_id": 39112255, "comment_id": 65572430, "body": "<code>char myStringG[8+1]; snprintf(myStringG, sizeof(myStringG), &quot;%08ld&quot;, binaryG);</code>"}, {"owner": {"reputation": 5768, "user_id": 3088572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/769f723b0fd6eb8c99d5f65b39392b18?s=128&d=identicon&r=PG&f=1", "display_name": "alvits", "link": "https://stackoverflow.com/users/3088572/alvits"}, "edited": false, "score": 2, "creation_date": 1472001374, "post_id": 39112255, "comment_id": 65573127, "body": "If your end goal is to run <code>T1()</code> and <code>T0()</code>, you don&#39;t really need to convert your decimal. Keep dividing the number by 2 and check for the remainder. Every time you get a remainder execute <code>T1()</code> otherwise execute <code>T0()</code>."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472003447, "post_id": 39112255, "comment_id": 65573621, "body": "<code>char myStringG[8] = {binaryG};</code> initializes <code>myStringG[0] = binaryG;</code> and the remaining array elements to 0."}, {"owner": {"reputation": 397, "user_id": 6716540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85923dcb6ca88e169ac138c8d5ef73bb?s=128&d=identicon&r=PG&f=1", "display_name": "DeftlyHacked", "link": "https://stackoverflow.com/users/6716540/deftlyhacked"}, "edited": false, "score": 0, "creation_date": 1472010257, "post_id": 39112255, "comment_id": 65575043, "body": "The only correct answer to this question is to use <code>itoa</code>. The OP is being ridiculous by asking people to reinvent the wheel."}], "answers": [{"comments": [{"owner": {"reputation": 8555, "user_id": 1402846, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/z5AzI.png?s=128&g=1", "display_name": "Pang", "link": "https://stackoverflow.com/users/1402846/pang"}, "edited": false, "score": 2, "creation_date": 1472003367, "post_id": 39112818, "comment_id": 65573602, "body": "The question says <i>&quot;Ps the <code>Itoa()</code>; function is also not an option&quot;</i>."}], "tags": [], "owner": {"reputation": 397, "user_id": 6716540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85923dcb6ca88e169ac138c8d5ef73bb?s=128&d=identicon&r=PG&f=1", "display_name": "DeftlyHacked", "link": "https://stackoverflow.com/users/6716540/deftlyhacked"}, "is_accepted": false, "score": 0, "last_activity_date": 1472005282, "last_edit_date": 1472005282, "creation_date": 1471999979, "answer_id": 39112818, "question_id": 39112255, "link": "https://stackoverflow.com/questions/39112255/need-to-convert-int-to-string-using-c/39112818#39112818", "title": "Need to convert int to string using C", "body": "<p>Use the <code>itoa</code> (integer-to-ascii) function.</p>\n\n<p><a href=\"http://www.cplusplus.com/reference/cstdlib/itoa/\" rel=\"nofollow\">http://www.cplusplus.com/reference/cstdlib/itoa/</a></p>\n\n<hr>\n\n<p>EDIT: Correction:</p>\n\n<p><strong>Don't be an idiot</strong>, use the <code>itoa</code> (integer-to-ascii) function.</p>\n\n<p><a href=\"http://www.cplusplus.com/reference/cstdlib/itoa/\" rel=\"nofollow\">http://www.cplusplus.com/reference/cstdlib/itoa/</a></p>\n\n<hr>\n\n<p>EDIT:</p>\n\n<p>Maybe I wasn't clear enough. I saw the line that said:</p>\n\n<blockquote>\n  <p>*Ps the Itoa(); function is also not an option.</p>\n</blockquote>\n\n<p>This is completely unreasonable. You want to reinvent the wheel, but you want someone else to do it? What do you possibly have against itoa? It's part of the standard. It will always exist, no matter what platform you're targeting or version of C that you're using.</p>\n"}, {"tags": [], "owner": {"reputation": 11698, "user_id": 5399734, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2162d669508364bb0c03aba1a2473aa8?s=128&d=identicon&r=PG&f=1", "display_name": "nalzok", "link": "https://stackoverflow.com/users/5399734/nalzok"}, "is_accepted": false, "score": 0, "last_activity_date": 1472004750, "creation_date": 1472004750, "answer_id": 39113387, "question_id": 39112255, "link": "https://stackoverflow.com/questions/39112255/need-to-convert-int-to-string-using-c/39113387#39113387", "title": "Need to convert int to string using C", "body": "<p>To achieve your goal, you don't have to convert a decimal value to binary:</p>\n\n<pre><code>unsigned decimalG = 24; // Assumed positive, for negative values\n                        // have implementation-defined representation\nfor (; decimalG; decimalG &gt;&gt;= 1) {\n    if(decimalG &amp; 1) {\n        // Do something\n    } else {\n        // Do something else\n    }\n}\n</code></pre>\n\n<p>Or you can use a union, but I'm not sure whether this approach is well defined by the standard.</p>\n\n<hr>\n\n<p>If you stick to writing <code>decimalToBinary</code>, note that you'll have to use an array:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;limits.h&gt;\n\nchar *decimalToBinary(unsigned n);\n\nint\nmain(void) {\n    int decimalG = 15;\n    char *binary = decimalToBinary(decimalG);\n    puts(binary);\n    free(binary);\n}\n\nchar *\ndecimalToBinary(unsigned n) {\n    // Don't forget to free() it after use!!!\n    char *binary = malloc(sizeof(unsigned) * CHAR_BIT + 1);\n    if(!binary) return 0;\n\n    size_t i;\n    for (i = 0; i &lt; sizeof(unsigned) * CHAR_BIT; i++) {\n        binary[i] = '0' + ((n &gt;&gt; i) &amp; 1); // in reverse order\n    }\n    binary[i] = 0;\n\n    return binary;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5298, "user_id": 4241278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53f687af42c3e779a0f2ee98d5fe3bb4?s=128&d=identicon&r=PG", "display_name": "deamentiaemundi", "link": "https://stackoverflow.com/users/4241278/deamentiaemundi"}, "is_accepted": false, "score": 1, "last_activity_date": 1472005433, "creation_date": 1472005433, "answer_id": 39113453, "question_id": 39112255, "link": "https://stackoverflow.com/questions/39112255/need-to-convert-int-to-string-using-c/39113453#39113453", "title": "Need to convert int to string using C", "body": "<p>As the post is tagged <code>arm</code> using <code>malloc()</code> might not be the best approach, although the simplest. If you insist on using arrays:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint decimalToBinary(long n, char out[], int len)\n{\n  long remainder;\n  // C arrays are zero based\n  len--;\n  // TODO: check if the input is reasonable\n  while (n != 0) {\n    // pick a bit\n    remainder = n % 2;\n    // shift n one bit to the right\n    // It is the same as n = n/2 but\n    // is more telling of what you are doing:\n    // shifting the whole thing to the right\n    // and drop the least significant bit\n    n &gt;&gt;= 1;\n    // Check boundaries! Always!\n    if (len &lt; 0) {\n      // return zero for \"Fail\"\n      return 0;\n    }\n    // doing the following four things at once:\n    // cast remainder to char\n    // add the numerical value of the digit \"0\"\n    // put it into the array at place len\n    // decrement len\n    out[len--] = (char) remainder + '0';\n  }\n  // return non-zero value for \"All OK\"\n  return 1;\n}\n\n// I don't know what you do here, but it\n// doesn't matter at all for this example\nvoid T0()\n{\n  fputc('0', stdout);\n}\n\nvoid T1()\n{\n  fputc('1', stdout);\n}\n\nint main()\n{\n  // your input\n  int decimalG = 24;\n  // an array able to hold 8 (eight) elements of type char\n  char myStringG[8];\n\n  // call decimalToBinary with the number, the array and\n  // the length of that array\n  if (!decimalToBinary(decimalG, myStringG, 8)) {\n    fprintf(stderr, \"decimalToBinary failed\\n\");\n    exit(EXIT_FAILURE);\n  }\n  // Print the whole array\n  // How to get rid of the leading zeros is left to you\n  for (int i = 0; i &lt; 8; i++) {\n    if (myStringG[i] == '1') {\n      T1();\n    } else {\n      T0();\n    }\n  }\n  // just for the optics\n  fputc('\\n', stdout);\n  exit(EXIT_SUCCESS);\n}\n</code></pre>\n\n<p>Computing the length needed is tricky, but if you know the size of <code>long</code> your Micro uses (8, 16, 32, or even 64 bit these days) you can take that as the maximum size for the array. Leaves the leading zeros but that should not be a problem, or is it?</p>\n"}, {"tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": false, "score": 0, "last_activity_date": 1472007706, "last_edit_date": 1472007706, "creation_date": 1472006819, "answer_id": 39113613, "question_id": 39112255, "link": "https://stackoverflow.com/questions/39112255/need-to-convert-int-to-string-using-c/39113613#39113613", "title": "Need to convert int to string using C", "body": "<blockquote>\n  <p>I want to give each character of the binary into it's own \n   space inside an array. However, I can't seem to save digits \n   from the return values in my string array.</p>\n</blockquote>\n\n<p>There are a number of ways to approach this, if I understand what you are asking. First, there is no need to actually store the results of the binary representation of your number in an array to call <code>T1()</code> or <code>T0()</code> based on the bit value of any given bit that makes up the number.</p>\n\n<p>Take your example <code>24</code> (binary <code>11000</code>). If I read your post correctly you state:</p>\n\n<blockquote>\n  <p>In this case since the decimal is <code>24</code>, the binary\n   would be <code>11000</code> therefore it should execute the the \n   function <code>T1()</code> <code>2</code> times and <code>T0()</code> <code>6</code> times.</p>\n</blockquote>\n\n<p>(I'm not sure where you get <code>6</code> times, it looks like you intended that <code>T0()</code> would be called <code>3</code> times)</p>\n\n<p>If you have <code>T0</code> and <code>T1</code> defined, for example, to simply let you know when they are called, e.g.:</p>\n\n<pre><code>void T1 (void) { puts (\"T1 called\"); }\nvoid T0 (void) { puts (\"T0 called\"); }\n</code></pre>\n\n<p>You can write a function (say named <code>callt</code>) to call <code>T1</code> for each <code>1-bit</code> and <code>T0</code> for each <code>0-bit</code> in a number simply as follows:</p>\n\n<pre><code>void callt (const unsigned long v)\n{\n    if (!v)  { putchar ('0'); return; };\n\n    size_t sz = sizeof v * CHAR_BIT;\n    unsigned long rem = 0;\n\n    while (sz--)\n        if ((rem = v &gt;&gt; sz)) {\n            if (rem &amp; 1) \n                T1(); \n            else \n                T0();\n        }\n}\n</code></pre>\n\n<p>So far example if you passed <code>24</code> to the function <code>callt (24)</code>, the output would be:</p>\n\n<pre><code>$ ./bin/dec2bincallt\nT1 called\nT1 called\nT0 called\nT0 called\nT0 called\n</code></pre>\n\n<p>(full example provided at the end of answer)</p>\n\n<p>On the other hand, if you really do want to <em>give each character of the binary into it's own space inside an array</em>, then you would simply need to pass an array to capture the bit values (either the ASCII character representations for <code>'0'</code> and <code>'1'</code>, or just <code>0</code> and <code>1</code>) instead of calling <code>T0</code> and <code>T1</code> (you would also add a few lines to handle <code>v=0</code> and also the <em>nul-terminating</em> character if you will use the array as a string) For example:</p>\n\n<pre><code>/** copy 'sz' bits of the binary representation of 'v' to 's'.\n *  returns pointer to 's', on success, empty string otherwise.\n *  's' must be adequately sized to hold 'sz + 1' bytes.\n */\nchar *bincpy (char *s, unsigned long v, unsigned sz)\n{\n    if (!s || !sz) {\n        *s = 0;\n        return s;\n    }\n    if (!v) {\n        *s = '0';\n        *(s + 1) = 0;\n        return s;\n    }\n    unsigned i;\n\n    for (i = 0; i &lt; sz; i++)\n        s[i] = (v &gt;&gt; (sz - 1 - i)) &amp; 1 ? '1' : '0';\n    s[sz] = 0;\n\n    return s;\n}\n</code></pre>\n\n<p>Let me know if you have any additional questions. Below are two example programs. Both take as their first argument the number to convert (or to process) as binary (default: 24 if no argument is given). The first simply calls <code>T1</code> for each <code>1-bit</code> and <code>T0</code> for each <code>0-bit</code>:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;limits.h&gt;         /* for CHAR_BIT */\n\nvoid callt (const unsigned long v);\nvoid T1 (void) { puts (\"T1 called\"); }\nvoid T0 (void) { puts (\"T0 called\"); }\n\nint main (int argc, char **argv) {\n\n    unsigned long v = argc &gt; 1 ? strtoul (argv[1], NULL, 10) : 24;\n\n    callt (v);\n\n    return 0;\n}\n\nvoid callt (const unsigned long v)\n{\n    if (!v)  { putchar ('0'); return; };\n\n    size_t sz = sizeof v * CHAR_BIT;\n    unsigned long rem = 0;\n\n    while (sz--)\n        if ((rem = v &gt;&gt; sz)) {\n            if (rem &amp; 1) T1(); else T0();\n        }\n}\n</code></pre>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/dec2bincallt\nT1 called\nT1 called\nT0 called\nT0 called\nT0 called\n\n$ ./bin/dec2bincallt 11\nT1 called\nT0 called\nT1 called\nT1 called\n</code></pre>\n\n<p>The second stores each bit of the binary representation for the value as a <em>nul-terminated</em> string and prints the result:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define BITS_PER_LONG 64    /* define as needed */\n\nchar *bincpy (char *s, unsigned long v, unsigned sz);\n\nint main (int argc, char **argv) {\n\n    unsigned long v = argc &gt; 1 ? strtoul (argv[1], NULL, 10) : 24;\n    char array[BITS_PER_LONG + 1] = \"\";\n\n    printf (\" values in array: %s\\n\", bincpy (array, v, 16));\n\n    return 0;\n}\n\n/** copy 'sz' bits of the binary representation of 'v' to 's'.\n *  returns pointer to 's', on success, empty string otherwise.\n *  's' must be adequately sized to hold 'sz + 1' bytes.\n */\nchar *bincpy (char *s, unsigned long v, unsigned sz)\n{\n    if (!s || !sz) {\n        *s = 0;\n        return s;\n    }\n    if (!v) {\n        *s = '0';\n        *(s + 1) = 0;\n        return s;\n    }\n    unsigned i;\n\n    for (i = 0; i &lt; sz; i++)\n        s[i] = (v &gt;&gt; (sz - 1 - i)) &amp; 1 ? '1' : '0';\n    s[sz] = 0;\n\n    return s;\n}\n</code></pre>\n\n<p><strong>Example Use/Output</strong></p>\n\n<p>(padding to 16 bits)</p>\n\n<pre><code>$ ./bin/dec2binarray\n values in array: 0000000000011000\n\n$ ./bin/dec2binarray 11\n values in array: 0000000000001011\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6655237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a08c3d601455cda0077fb20048287e2f?s=128&d=identicon&r=PG&f=1", "display_name": "AverageEh", "link": "https://stackoverflow.com/users/6655237/averageeh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 735, "favorite_count": 0, "answer_count": 4, "score": -4, "last_activity_date": 1472007706, "creation_date": 1471995199, "question_id": 39112255, "link": "https://stackoverflow.com/questions/39112255/need-to-convert-int-to-string-using-c", "title": "Need to convert int to string using C", "body": "<p>Hi I am pretty new to coding and I really need help. \nBasically I have a decimal value and I converted it to a binary value. \nUsing this method</p>\n\n<pre><code>long decimalToBinary(long n) \n{\n    int remainder; \n    long binary = 0, i = 1;\n\n    while(n != 0) \n    {\n        remainder = n%2;\n        n = n/2;\n        binary= binary + (remainder*i);\n        i = i*10;\n    }\n    return binary;\n}\n</code></pre>\n\n<p>And I want to give each character of the binary into it's own space inside an array. However, I can't seem to save digits from the return values in my string array. I think it has something to do with converting the long to string but I could be wrong! Here is what I have so far.\nI do not want to use sprintf(); I do not wish to print the value I just want the value stored inside it so that the if conditions can read it. Any help would be appreciated!</p>\n\n<pre><code>int decimalG = 24;\nlong binaryG = decimalToBinary(decimalG);\nchar myStringG[8] = {binaryG};\nfor( int i = 0; i&lt;8; i++)\n{\n     if (myStringG[i] == '1' )\n    {\n     T1();\n    }\n    else \n    {\n    T0();\n }\n }\n</code></pre>\n\n<p>In this case since the decimal is 24, the binary would be 11000 therefore it should execute the the function T1(); 2 times and T0() 6 times. But it doesn't do that and I can't seem to find the answer to store the saved values in the array.<br>\n*Ps the Itoa(); function is also not an option. Thanks in Advance! :)</p>\n"}, {"tags": ["c", "linux", "sockets", "networking", "tcp"], "comments": [{"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 1, "creation_date": 1471992153, "post_id": 39111479, "comment_id": 65570879, "body": "You could sleep for 2MSL which is like 2minutes (cat /proc/sys/net/ipv4/tcp_fin_timeout ) on my Linux box to make sure that no old stray packets will screw up your new server instance, but if you&#39;re testing locally, it&#39;s AFAIK, totally pointless because you won&#39;t have any stray packets and the simplest thing to do would be to set SO_REUSEADDR. Check out <a href=\"http://www.serverframework.com/asynchronousevents/2011/01/time-wait-and-its-design-implications-for-protocols-and-scalable-servers.html\" rel=\"nofollow noreferrer\">serverframework.com/asynchronousevents/2011/01/&hellip;</a> or <a href=\"http://stackoverflow.com/questions/3229860/what-is-the-meaning-of-so-reuseaddr-setsockopt-option-linux\" title=\"what is the meaning of so reuseaddr setsockopt option linux\">stackoverflow.com/questions/3229860/&hellip;</a>"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471993219, "post_id": 39111479, "comment_id": 65571157, "body": "C does not support classes. What&#39;s wrong with the POSIX standard library?"}, {"owner": {"reputation": 2473, "user_id": 4490706, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nmMcD.jpg?s=128&g=1", "display_name": "Ton Plooij", "link": "https://stackoverflow.com/users/4490706/ton-plooij"}, "edited": false, "score": 0, "creation_date": 1472023745, "post_id": 39111479, "comment_id": 65580295, "body": "This might be helpful for you: <a href=\"http://stackoverflow.com/questions/3757289/tcp-option-so-linger-zero-when-its-required\" title=\"tcp option so linger zero when its required\">stackoverflow.com/questions/3757289/&hellip;</a>."}], "owner": {"reputation": 58653, "user_id": 1131467, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6115f0a575cf85c444663504d5f1b3c3?s=128&d=identicon&r=PG", "display_name": "Andrew Tomazos", "link": "https://stackoverflow.com/users/1131467/andrew-tomazos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 480, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1471990349, "creation_date": 1471990349, "question_id": 39111479, "link": "https://stackoverflow.com/questions/39111479/eaddrinuse-address-already-in-use-avoidable", "title": "EADDRINUSE Address already in use avoidable?", "body": "<p>I am testing a Socket class I have written that wraps the Linux socket API.</p>\n\n<p>In a test function I do the following:</p>\n\n<ol>\n<li>Create a server socket</li>\n<li>bind/listen</li>\n<li>connect from a new socket</li>\n<li>accept on a new socket</li>\n<li>send some data between them with recv and send.</li>\n<li>call shutdown(SHUT_WR) on both sides</li>\n<li>call recv on both sides, and get a 0 return value</li>\n<li>call close on all three sockets</li>\n</ol>\n\n<p>I then immediately repeat these 8 steps again.</p>\n\n<p>I find that intermittantly on the <code>bind</code> in the second iteration of the steps I get EADDRINUSE.</p>\n\n<p>I was of the impression that it was possible to perform an orderly shutdown in such a fashion that this was avoidable.  I am aware of <code>SO_REUSEADDR</code> - but is it possible to do an orderly shutdown and block until the port is available again?</p>\n"}, {"tags": ["c", "optimization", "inline", "loop-unrolling"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1471989455, "post_id": 39111222, "comment_id": 65570038, "body": "So, what did you do to find out? Checked the Assembler? Profile? Why do you care in the first place? Always concentrate on writing readable and <b>correct</b> code! Don&#39;t do premature optimisations if they defy these primary goals. Optimise hotspots <b>after</b> profiling. And ARMv7 is actually three very different families. Which one do you use?"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471989819, "post_id": 39111222, "comment_id": 65570149, "body": "Sidenote: Optimise your hardware first. The code above is only required because the hardware connections have been messed up. It is very well the task of the software-developer to review the hardware connections and have a serious talk with the hardware-designer. So the most elegant option is to possibly kick bu** (verbally!)."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1471989992, "post_id": 39111222, "comment_id": 65570219, "body": "And use unsigned integers of appropriate type when shifting!"}, {"owner": {"reputation": 11, "user_id": 6749653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/264979b2e087ffbdb898ca322b44589c?s=128&d=identicon&r=PG&f=1", "display_name": "Embed", "link": "https://stackoverflow.com/users/6749653/embed"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472047851, "post_id": 39111222, "comment_id": 65596940, "body": "I did not perform any tests up to know, since I would first like to understand if this kind of compiler optimization is possible or not."}], "owner": {"reputation": 11, "user_id": 6749653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/264979b2e087ffbdb898ca322b44589c?s=128&d=identicon&r=PG&f=1", "display_name": "Embed", "link": "https://stackoverflow.com/users/6749653/embed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1471988909, "creation_date": 1471988909, "question_id": 39111222, "link": "https://stackoverflow.com/questions/39111222/loop-unrolling-in-inlined-functions-in-c-for-speed-optimized-multiple-register-m", "title": "Loop unrolling in inlined functions in C for speed optimized multiple register multiple bit access", "body": "<p>I have a question how to most elegantly solve following problem related to discrete IO checks of a micro controller:</p>\n\n<p>Contents of .c file:</p>\n\n<hr>\n\n<pre><code>struct transfers {\nuint32t *RegisterAddr;\nuint8_t RegBit;\n};\n\nstatic const struct transfers DIO[] = {\n{ REGA_ADDR, 3},\n{ NULL, 1},\n{ NULL, 12},\n{ REGB_ADDR, 2},\n{ NULL, 7},\n{ REGC_ADDR, 5},\n{ REGD_ADDR, 1}\n};\n\ninline uint32t Dinputs(const uint8_t n){\n\n  uint32_t DIO_Data = 0;\n  uint32_t RegData;\n\n  for (uint8_t i = 0; i &lt; n; i++) {\n\n    if (DIO[i].RegisterAddr != NULL) RegData = *DIO[i].RegisterAddr;\n\n    if ((RegData &amp; (1 &lt;&lt; DIO[i].RegBit)) == 0) DIO_Data |= (1 &lt;&lt; i);\n  }\n  return DIO_Data;\n}\n\nvoid testfunction(void) {\n\n  uint32_t DIO_Data = Dinputs(N_USED);\n}\n</code></pre>\n\n<hr>\n\n<p>Expected result after compilation with --O3 --funroll-loops\nshall be speed optimized such as the following equivalent C-Code for testfunction, provided that N_USED is defined to be 7 and REGx_ADDR are also defined to be valid register addresses:</p>\n\n<pre><code>  uint32_t DIO_Data = 0;\n  uint32_t RegData;\n\n  RegData = *REGA_ADDR;\n  if ((RegData &amp; (1 &lt;&lt; 3)) == 0) IO_Data |= (1 &lt;&lt; 0);\n  if ((RegData &amp; (1 &lt;&lt; 1)) == 0) IO_Data |= (1 &lt;&lt; 1);\n  if ((RegData &amp; (1 &lt;&lt; 12)) == 0) IO_Data |= (1 &lt;&lt; 2);\n  RegData = *REGB_ADDR;\n  if ((RegData &amp; (1 &lt;&lt; 2)) == 0) IO_Data |= (1 &lt;&lt; 3);\n  if ((RegData &amp; (1 &lt;&lt; 7)) == 0) IO_Data |= (1 &lt;&lt; 4);\n  RegData = *REGC_ADDR;\n  if ((RegData &amp; (1 &lt;&lt; 5)) == 0) IO_Data |= (1 &lt;&lt; 5);\n  RegData = *REGD_ADDR;\n  if ((RegData &amp; (1 &lt;&lt; 1)) == 0) IO_Data |= (1 &lt;&lt; 6);\n</code></pre>\n\n<p>I use the GCC compiler for ARM v7. Does this work as expected, with optimized machine code output when using the above inline function Dinputs called by testfunction? Is there a possibility to enforce the unroll and the inlining of the Dinputs function? Not really important, but for curiosity: since the struct transfers DIO in the above example is only used by the unrolled inline function, it would not be necessary for the compiler to take over this data into the data section of the object file. What is the expected behaviour wrt. this?</p>\n\n<p>The reason that I do not want to use the equivalent code in my project is, that this would require many additional preprocessor commands if N_USED shall be in the range of 0 to 7 (in this example) at compile time, and variants using other DIO tables are more easily definable by just exchanging the tables and not any the code.</p>\n"}, {"tags": ["c", "winapi", "registry"], "answers": [{"comments": [{"owner": {"reputation": 743, "user_id": 2355322, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/2wRIw.jpg?s=128&g=1", "display_name": "Sergio Calderon", "link": "https://stackoverflow.com/users/2355322/sergio-calderon"}, "edited": false, "score": 0, "creation_date": 1472066436, "post_id": 39111819, "comment_id": 65608203, "body": "Thanks a lot, master @RbMm! I am learning a lot from you and all the folks here!"}], "tags": [], "owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "is_accepted": true, "score": 2, "last_activity_date": 1471992212, "creation_date": 1471992212, "answer_id": 39111819, "question_id": 39111074, "link": "https://stackoverflow.com/questions/39111074/error-234-more-data-is-available-with-regqueryinfokey-and-regenumvalue/39111819#39111819", "title": "Error 234, more data is available, with RegQueryInfoKey and RegEnumValue", "body": "<p>your code containing many errors.</p>\n\n<p>1) \n<code>LPWSTR nameOfValue = (LPWSTR)malloc(longestValueName * sizeof(WCHAR));</code></p>\n\n<p>really longestValueName this is </p>\n\n<blockquote>\n  <p>The size does not include the terminating null character.</p>\n</blockquote>\n\n<p>so you need</p>\n\n<pre><code>LPWSTR nameOfValue = (LPWSTR)malloc((longestValueName + 1) * sizeof(WCHAR));\n</code></pre>\n\n<p>or (better)</p>\n\n<pre><code>LPWSTR nameOfValue = (LPWSTR)malloc(++longestValueName * sizeof(WCHAR));\n</code></pre>\n\n<p>then in loop, if use first variant - <code>sizeOfBufffer = longestValueName + 1</code>;</p>\n\n<p>or as in your code, if use <code>++longestValueName</code></p>\n\n<p>2) <code>DWORD sizeOfData = longestDataComponent;</code></p>\n\n<p>you must do this in Loop, as and <code>sizeOfBufffer = longestValueName</code>; because <code>sizeOfData</code> will be changed after every <code>RegEnumValue</code></p>\n\n<p>3) and you must be ready, that until you enumerate key, somebody can change key data/values - so Maximum can increase - what you got in call <code>RegQueryInfoKey</code> is only reasonable hint but not 100% guarantee</p>\n"}], "owner": {"reputation": 743, "user_id": 2355322, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/2wRIw.jpg?s=128&g=1", "display_name": "Sergio Calderon", "link": "https://stackoverflow.com/users/2355322/sergio-calderon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1517, "favorite_count": 0, "accepted_answer_id": 39111819, "answer_count": 1, "score": 0, "last_activity_date": 1471992212, "creation_date": 1471988199, "question_id": 39111074, "link": "https://stackoverflow.com/questions/39111074/error-234-more-data-is-available-with-regqueryinfokey-and-regenumvalue", "title": "Error 234, more data is available, with RegQueryInfoKey and RegEnumValue", "body": "<p>I am trying to use <code>RegQueryInfoKey</code> to get the longest value and data\u00b4s size and then <code>RegEnumValue</code> to show all the values, but I am getting the 234 error value, which means \"More data is available\" when I run the app. </p>\n\n<p>I am also using <code>malloc</code> to allocate <code>lpValueName</code> and <code>lpData</code> so I can use the sizes that <code>RegQueryInfoKey</code> gave me. </p>\n\n<p>If i set <code>lpcchValueName</code> to 16383, for example, the app works just fine, but it no idea why it doesn't with the <code>lpcMaxSubKeyLen</code> value returned by <code>RegQueryInfoKey</code>.</p>\n\n<p>The registry key has two string values:\n<a href=\"https://i.stack.imgur.com/mXMVt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/mXMVt.png\" alt=\"HKCU\\WinSide string values\"></a></p>\n\n<p>What am I doing wrong? Apologize for all the noob errors you might see. Here is my code: </p>\n\n<pre><code>int wmain()\n{\n    //RegOpenKeyEx\n    HKEY hKey = HKEY_CURRENT_USER;\n    LPCWSTR subKey = L\"WinSide\";\n    DWORD options = 0;\n    REGSAM samDesired = KEY_QUERY_VALUE;\n    HKEY hkOpenResult;\n\n    //Opening the HKEY_CURRENT_USER\\WinSide subkey\n    LONG openKey = RegOpenKeyEx(hKey, subKey, options,\n                            samDesired, &amp;hkOpenResult);\n\n    if (openKey != ERROR_SUCCESS)\n        wprintf(L\"Error code: %li\\n\", openKey);\n    else\n    {\n        wprintf(L\"Key opened!\\n\");\n\n        //RegQueryInfoKey\n        LPWSTR pClass = NULL;\n        LPDWORD pcClass = NULL;\n        LPDWORD reserved = NULL;\n        DWORD numberOfSubKeys;\n        LPDWORD pcMaxSubKeyLen = NULL;\n        LPDWORD pcMaxClassLen = NULL;\n        DWORD numberOfValues;\n        DWORD longestValueName;\n        DWORD longestDataComponent;\n        LPDWORD securityDescriptor = NULL;\n        PFILETIME pLastWriteTime = NULL;\n\n        //Querying info from HKCU\\WinSide subkey\n        LONG queryInfo = RegQueryInfoKey(hkOpenResult, pClass, pcClass, reserved, &amp;numberOfSubKeys,\n                                        pcMaxSubKeyLen, pcMaxClassLen, &amp;numberOfValues,\n                                        &amp;longestValueName, &amp;longestDataComponent,\n                                        securityDescriptor, pLastWriteTime);\n\n        if (queryInfo != ERROR_SUCCESS)\n            wprintf(L\"Error code: %li\\n\", queryInfo);\n        else\n        {\n            wprintf(L\"Key queried!\\n\");\n            wprintf(L\"Number of values: %u\\n\", numberOfValues);\n\n            //RegEnumValue\n            DWORD index=0;\n            DWORD sizedem = sizeof(WCHAR);\n            LPWSTR nameOfValue = (LPWSTR)malloc(longestValueName * sizeof(WCHAR));\n            DWORD sizeOfBufffer = longestValueName;\n            DWORD typeOfDataStored;\n            LPBYTE pData = (LPBYTE)malloc(longestDataComponent * sizeof(BYTE));\n            DWORD sizeOfData = longestDataComponent;\n\n            if (nameOfValue != NULL &amp;&amp; pData != NULL)\n            {\n                for (index = 0; index &lt; numberOfValues; index++)\n                {\n                    sizeOfBufffer = longestValueName;\n\n                    //Enumerating values from HKCU\\WinSide subkey\n                    LONG enuValue = RegEnumValue(hkOpenResult, index, nameOfValue,\n                        &amp;sizeOfBufffer, NULL, &amp;typeOfDataStored,\n                        pData, &amp;sizeOfData);\n\n                    if (enuValue != ERROR_SUCCESS)\n                        wprintf(L\"Error code: %li\\n\", enuValue);\n                    else\n                    {\n                        wprintf(L\"Value: %s\\n\", (LPWSTR)pData);\n\n                    }\n\n                }\n\n            }\n            else\n            {\n                wprintf(L\"Memory could not be allocated.\\n\");\n            }       \n\n\n\n            free(nameOfValue);\n            free(pData);\n\n\n        }\n\n\n\n        RegCloseKey(hkOpenResult);\n    }\n\n    return 0;\n\n}\n</code></pre>\n\n<p>This is my result:</p>\n\n<p><a href=\"https://i.stack.imgur.com/TFYw5.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/TFYw5.png\" alt=\"Result\"></a></p>\n\n<p>Thanks a lot!</p>\n"}, {"tags": ["c", "openmp", "pragma"], "comments": [{"owner": {"reputation": 3715, "user_id": 1241334, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fCjAE.jpg?s=128&g=1", "display_name": "Jonny Henly", "link": "https://stackoverflow.com/users/1241334/jonny-henly"}, "edited": false, "score": 1, "creation_date": 1471987978, "post_id": 39110969, "comment_id": 65569493, "body": "Please <a href=\"https://stackoverflow.com/posts/39110969/edit\">edit</a> your question to include an actual <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. Where are <code>Rp</code>, <code>next</code> and <code>S</code> defined? What are the random errors in output, are they actual errors or unexpected output? (Please include actual output and expected output)"}, {"owner": {"reputation": 8381, "user_id": 5239503, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MqgeX.jpg?s=128&g=1", "display_name": "Gilles", "link": "https://stackoverflow.com/users/5239503/gilles"}, "edited": false, "score": 0, "creation_date": 1472027377, "post_id": 39110969, "comment_id": 65582578, "body": "You have a race condition here: <code>next[j] = next[next[j]];</code>. Indeed, this depends on the order upon which you travel your <code>j</code> loop, so trying to parallelise it will just change the order and thereafter possibly change the result."}, {"owner": {"reputation": 9, "user_id": 6483290, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43fbe088c5a83acf637b27694310d1d2?s=128&d=identicon&r=PG&f=1", "display_name": "kumar", "link": "https://stackoverflow.com/users/6483290/kumar"}, "reply_to_user": {"reputation": 8381, "user_id": 5239503, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MqgeX.jpg?s=128&g=1", "display_name": "Gilles", "link": "https://stackoverflow.com/users/5239503/gilles"}, "edited": false, "score": 0, "creation_date": 1472029462, "post_id": 39110969, "comment_id": 65583827, "body": "@Gilles Thanks for the reply. I eliminated the race condition by putting the if loop in a critical region. But this means that I am effectively now running the algorithm in a sequential fashion. Is there any other way I can eliminate the race (I don&#39;t want to change the algorithm)."}, {"owner": {"reputation": 8381, "user_id": 5239503, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MqgeX.jpg?s=128&g=1", "display_name": "Gilles", "link": "https://stackoverflow.com/users/5239503/gilles"}, "edited": false, "score": 0, "creation_date": 1472030618, "post_id": 39110969, "comment_id": 65584619, "body": "This is more than just a race condition actually. The trouble is that this algorithm is fundamentally not parallelisable, because the order of execution or the <code>j</code> loop matters here. So you could get away with using the <code>ordered</code> directive, but ultimately you would end-up with a sequential algorithm. Therefore, if you want to get it truly parallel, you have to fundamentally change your algorithm."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 6831055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e943f4b55c7bdfccaf798682651567b6?s=128&d=identicon&r=PG&f=1", "display_name": "nxmxsis", "link": "https://stackoverflow.com/users/6831055/nxmxsis"}, "is_accepted": false, "score": 0, "last_activity_date": 1473862710, "last_edit_date": 1473862710, "creation_date": 1473858441, "answer_id": 39491267, "question_id": 39110969, "link": "https://stackoverflow.com/questions/39110969/list-ranking-implementation-in-c-with-openmp-output-error/39491267#39491267", "title": "List ranking implementation in C with OpenMP -- Output error", "body": "<p>I think this should be possible with a second set of arrays.\nCorrect me if I am wrong.</p>\n\n<p>When you take two arrays and two pointers <code>next_new</code> and <code>next_old</code> and two arrays and two pointers <code>Rp_new</code> and <code>Rp_old</code>, it should do the trick.</p>\n\n<p>You write to the <strong>new</strong> arrays, while reading from the <strong>old</strong> and swapping pointers after each Round.</p>\n\n<pre><code>Rp_new[j] = Rp_old[j] + Rp_old[next_old[j]];\n\nnext_new[j] = next_old[next_old[j]];\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 6483290, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43fbe088c5a83acf637b27694310d1d2?s=128&d=identicon&r=PG&f=1", "display_name": "kumar", "link": "https://stackoverflow.com/users/6483290/kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 684, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1473862710, "creation_date": 1471987722, "last_edit_date": 1472026516, "question_id": 39110969, "link": "https://stackoverflow.com/questions/39110969/list-ranking-implementation-in-c-with-openmp-output-error", "title": "List ranking implementation in C with OpenMP -- Output error", "body": "<p>The following code shows my implementation of list ranking algorithm with OpenMP. When I execute this code without the pragmas I get the correct results, but when I include the pragmas, I get errors (occasionally) in the output. The outputs are shown at the bottom. You can see that the second time the output was wrong. This occurs randomly. <strong>When I remove the pragmas my output is always correct.</strong> Is there an error in the way I used the pragmas or is there a dependency I am missing. \n(The sequential output is the expected output. When the parallel output matches sequential output the program prints DATA OK)</p>\n\n<p>length and number of threads are 16.</p>\n\n<pre><code>#define NSIZE 1\n#define NMAX 16\nint Ns[NSIZE] = {16};\nint A[NMAX] = {14,13,5,16,11,10,9,12,0,8,7,15,4,3,2,1}; \nint B[NMAX + 1] = {0};\n\nint S[NMAX + 1] = {0};\n\nint Rp[NMAX + 1] = {0};\nint next[NMAX+1] = {0};\n\nfor(int i = 1, j=0; i &lt;= n; i++, j++)\n{\n    B[i] = A[j];\n\n}\n\nint chunk = ceil(length/nthreads);\nint i, j;\nint tid;\n//#pragma omp parallel num_threads(nthreads)\n//{\n//#pragma omp for schedule(dynamic, chunk) private(i)\nfor(i = 1; i &lt;= length; i++)\n{\n\n    Rp[i] = 1;\n    next[i] = S[i];\n}\n\n\nfor(i = 1; i&lt;=log2(length); i++)\n{\n#pragma omp parallel num_threads(nthreads) shared(Rp,next,chunk) private(j)\n{\n    #pragma omp for schedule(dynamic,chunk)\n    for(j = 1; j &lt;= length; j++)\n    {\n        if(next[j]!=0)\n        {\n            Rp[j] = Rp[j] + Rp[next[j]];\n\n            next[j] = next[next[j]];\n        }\n    }\n\n}\n}\n</code></pre>\n\n<p>OUTPUT:</p>\n\n<p>./a.out -- (This was the output when I ran the program the first time)</p>\n\n<p>from parallel<br>\ndata OK<br>\nInput:   14  13   5  16  11  10   9  12   0   8   7  15   4   3   2   1<br>\nSequential:    6  10   4   8   3  15   1  13   0  14   2  12   9   5  11   7<br>\nParallel :   6 10  4  8  3 15  1 13  0 14  2 12  9  5 11  7 </p>\n\n<p>./a.out -- (output when I ran the program the second time)\nfrom parallel<br>\ndata MISMATCH!!!<br>\nInput:   14  13   5  16  11  10   9  12   0   8   7  15   4   3   2   1<br>\nSequential:    6  10   4   8   3  15   1  13   0  14   2  12   9   5  11   7<br>\nParallel :   6 10  4  8  3 15  1 13  0 10  2 12  9  5 11  7</p>\n\n<p>./a.out -- (output when I ran the program the third time)</p>\n\n<p>from parallel<br>\ndata OK<br>\nInput:   14  13   5  16  11  10   9  12   0   8   7  15   4   3   2   1<br>\nSequential:    6  10   4   8   3  15   1  13   0  14   2  12   9   5  11   7<br>\nParallel :   6 10  4  8  3 15  1 13  0 14  2 12  9  5 11  7 </p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1471987450, "post_id": 39110879, "comment_id": 65569238, "body": "Why would you want to do this?"}, {"owner": {"reputation": 2385, "user_id": 1009270, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/33fcdc9c0604cf69abb15e17840d2a3c?s=128&d=identicon&r=PG", "display_name": "john elemans", "link": "https://stackoverflow.com/users/1009270/john-elemans"}, "edited": false, "score": 0, "creation_date": 1471987578, "post_id": 39110879, "comment_id": 65569295, "body": "just use a loop to access the contents of the subarray and copy each value to the new array."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 2385, "user_id": 1009270, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/33fcdc9c0604cf69abb15e17840d2a3c?s=128&d=identicon&r=PG", "display_name": "john elemans", "link": "https://stackoverflow.com/users/1009270/john-elemans"}, "edited": false, "score": 2, "creation_date": 1471988688, "post_id": 39110879, "comment_id": 65569764, "body": "@johnelemans: What&#39;s wrong with <code>memcpy</code>?"}, {"owner": {"reputation": 2385, "user_id": 1009270, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/33fcdc9c0604cf69abb15e17840d2a3c?s=128&d=identicon&r=PG", "display_name": "john elemans", "link": "https://stackoverflow.com/users/1009270/john-elemans"}, "edited": false, "score": 0, "creation_date": 1471988876, "post_id": 39110879, "comment_id": 65569826, "body": "nothing. I like using up cycles!"}, {"owner": {"reputation": 159, "user_id": 4720441, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/521e1eea19ceac79d38638f6f23728c7?s=128&d=identicon&r=PG&f=1", "display_name": "Creatronik", "link": "https://stackoverflow.com/users/4720441/creatronik"}, "reply_to_user": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1471988989, "post_id": 39110879, "comment_id": 65569877, "body": "@EOF I had to modify my code and &quot;brightnesstable&quot; is integrated and it&#39;s working fine. I just don&#39;t want to change that running system :) I just need the modification now and will optimize my code later anyway. (It&#39;s a microcontroller application) I&#39;ll check if memcpy works."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1471992042, "post_id": 39110879, "comment_id": 65570854, "body": "Is <code>index</code> a fixed value, or is this code inside a function and you might create <code>brightnesstable</code> with different index from time to time?"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471997497, "post_id": 39110879, "comment_id": 65572182, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/8287109/how-to-copy-one-integer-array-to-another\">How to copy one integer array to another</a>"}], "answers": [{"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472003754, "post_id": 39111288, "comment_id": 65573677, "body": "Suggest <code>memcpy(brightnessstable, brightnessvariants[index], sizeof brightnesstable);</code>"}], "tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": false, "score": 1, "last_activity_date": 1471989333, "creation_date": 1471989333, "answer_id": 39111288, "question_id": 39110879, "link": "https://stackoverflow.com/questions/39110879/how-to-copy-an-array/39111288#39111288", "title": "How to copy an array", "body": "<p>Simply do</p>\n\n<pre><code> uint8_t brightnesstable[101]; \n memcpy(brightnessstable, brightnessvariants[index], 101*sizeof(uint8_t));\n</code></pre>\n\n<p><code>brightnessvariants[index]</code> is the address of the first item in the <code>(index+1)nth</code> row and the number of bytes you want to copy is \n<code>ROWSIZE*sizeof(ITEM_SIZE)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": false, "score": 1, "last_activity_date": 1471990829, "last_edit_date": 1471990829, "creation_date": 1471990261, "answer_id": 39111464, "question_id": 39110879, "link": "https://stackoverflow.com/questions/39110879/how-to-copy-an-array/39111464#39111464", "title": "How to copy an array", "body": "<p>It really depends on what you need to do. If you need to create separate storage for a duplication of one of the rows of <code>brightnessvariants</code>, then you can simply declare a separate array and copy the values as discussed in the comments and the other answer. </p>\n\n<p>If, however, you simply need to access one of the rows of <code>brightnessvariants</code> in the current scope, then there is no need for separate storage and copying. All that is required is to declare a pointer and assign the starting address of the desired row. Then you can access the desired row of <code>brightnessvariants</code> as if it were a separate array. e.g.</p>\n\n<pre><code>uint8_t brightnessvariants[4][101] = {{0}}, *btable = NULL;\n</code></pre>\n\n<p>Above, <code>btable</code> (short for your <code>brightnesstable</code>) is simply a <code>uint8_t</code> pointer. It can be assigned the the address of any of the rows in <code>brightnessvariants</code>. e.g. for the second row</p>\n\n<pre><code>btable = brightnessvariants[1];\n</code></pre>\n\n<p><code>btable</code> can then be used to access any value within the second row, just as if it were a separate array. Here is a short example that may help:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\n\nint main (void) {\n\n    uint8_t brightnessvariants[4][101] = {{0}}, *btable = NULL;\n    int nrows = sizeof brightnessvariants / sizeof *brightnessvariants;\n\n    for (int i = 0; i &lt; 101; i++) {\n        brightnessvariants[0][i] = i + 1;\n        brightnessvariants[1][i] = i + 3;\n        brightnessvariants[2][i] = i + 5;\n        brightnessvariants[3][i] = i + 7;\n    }\n\n    for (int i = 0; i &lt; nrows; i++) {\n        printf (\"\\nbrightnesstable[%d] :\\n\\n\", i);\n        btable = brightnessvariants[i];\n        for (int j = 0; j &lt; 101; j++) {\n            if (j &amp;&amp; j % 10 == 0) putchar ('\\n');\n            printf (\" %3hhu\", btable[j]);\n        }\n        putchar ('\\n');\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/ptrtobtable\n\nbrightnesstable[0] :\n\n   1   2   3   4   5   6   7   8   9  10\n  11  12  13  14  15  16  17  18  19  20\n  21  22  23  24  25  26  27  28  29  30\n  31  32  33  34  35  36  37  38  39  40\n  41  42  43  44  45  46  47  48  49  50\n  51  52  53  54  55  56  57  58  59  60\n  61  62  63  64  65  66  67  68  69  70\n  71  72  73  74  75  76  77  78  79  80\n  81  82  83  84  85  86  87  88  89  90\n  91  92  93  94  95  96  97  98  99 100\n 101\n\nbrightnesstable[1] :\n\n   3   4   5   6   7   8   9  10  11  12\n  13  14  15  16  17  18  19  20  21  22\n  23  24  25  26  27  28  29  30  31  32\n  33  34  35  36  37  38  39  40  41  42\n  43  44  45  46  47  48  49  50  51  52\n  53  54  55  56  57  58  59  60  61  62\n  63  64  65  66  67  68  69  70  71  72\n  73  74  75  76  77  78  79  80  81  82\n  83  84  85  86  87  88  89  90  91  92\n  93  94  95  96  97  98  99 100 101 102\n 103\n\nbrightnesstable[2] :\n\n   5   6   7   8   9  10  11  12  13  14\n  15  16  17  18  19  20  21  22  23  24\n  25  26  27  28  29  30  31  32  33  34\n  35  36  37  38  39  40  41  42  43  44\n  45  46  47  48  49  50  51  52  53  54\n  55  56  57  58  59  60  61  62  63  64\n  65  66  67  68  69  70  71  72  73  74\n  75  76  77  78  79  80  81  82  83  84\n  85  86  87  88  89  90  91  92  93  94\n  95  96  97  98  99 100 101 102 103 104\n 105\n\nbrightnesstable[3] :\n\n   7   8   9  10  11  12  13  14  15  16\n  17  18  19  20  21  22  23  24  25  26\n  27  28  29  30  31  32  33  34  35  36\n  37  38  39  40  41  42  43  44  45  46\n  47  48  49  50  51  52  53  54  55  56\n  57  58  59  60  61  62  63  64  65  66\n  67  68  69  70  71  72  73  74  75  76\n  77  78  79  80  81  82  83  84  85  86\n  87  88  89  90  91  92  93  94  95  96\n  97  98  99 100 101 102 103 104 105 106\n 107\n</code></pre>\n\n<p>Look things over and let me know if you have any questions. If you need an example of copying instead of the use of a pointer, let me know and I'm happy to help.</p>\n"}], "owner": {"reputation": 159, "user_id": 4720441, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/521e1eea19ceac79d38638f6f23728c7?s=128&d=identicon&r=PG&f=1", "display_name": "Creatronik", "link": "https://stackoverflow.com/users/4720441/creatronik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1471993805, "creation_date": 1471987279, "last_edit_date": 1471993805, "question_id": 39110879, "link": "https://stackoverflow.com/questions/39110879/how-to-copy-an-array", "title": "How to copy an array", "body": "<p>I have defined an array like this:</p>\n\n<pre><code>uint8_t brightnessvariants[4][101]={{1,2,...},{3,4,...},{5,6,...},{7,8,...}};\n</code></pre>\n\n<p>Now for my application i have to fill another array with one of the 4 arrays:</p>\n\n<pre><code>uint8_t brightnesstable[] = brightnessvariants[index][];\n</code></pre>\n\n<p>But that doesn't work. <em>Index</em> is counted from 0 to 3.</p>\n\n<p><em>brightnesstable</em> and <em>brightnessvariants</em> are defined in a header file as <em>extern</em></p>\n\n<p>How can I do it right?</p>\n"}, {"tags": ["c", "structure", "greatest-common-divisor"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 3, "creation_date": 1471986605, "post_id": 39110685, "comment_id": 65568856, "body": "<code>find_gcd</code> is taking structures, but you are passing it <code>int</code>s... Read the error! It is printing it for <i>you</i>."}, {"owner": {"reputation": 3715, "user_id": 1241334, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fCjAE.jpg?s=128&g=1", "display_name": "Jonny Henly", "link": "https://stackoverflow.com/users/1241334/jonny-henly"}, "edited": false, "score": 1, "creation_date": 1471986624, "post_id": 39110685, "comment_id": 65568866, "body": "How are you suppose to differentiate between the first and second parameter if they&#39;re both named <code>s1</code>?"}, {"owner": {"reputation": 6433, "user_id": 6591667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/6632be3bf9dfd9e4275569ebd3a2dacd?s=128&d=identicon&r=PG&f=1", "display_name": "tadm123", "link": "https://stackoverflow.com/users/6591667/tadm123"}, "edited": false, "score": 0, "creation_date": 1472008931, "post_id": 39110685, "comment_id": 65574739, "body": "Thanks, I feel like an idiot."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1472022147, "post_id": 39110685, "comment_id": 65579382, "body": "Your <a href=\"https://en.wikipedia.org/wiki/Greatest_common_divisor\" rel=\"nofollow noreferrer\">GCD</a> algorithm is bust (even when you sort out the argument list).  For example, given 1 and 1, it doesn&#39;t terminate."}], "answers": [{"tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": false, "score": 0, "last_activity_date": 1471986733, "creation_date": 1471986733, "answer_id": 39110737, "question_id": 39110685, "link": "https://stackoverflow.com/questions/39110685/using-structures-to-find-the-gcd-of-a-fraction-simple-c-program/39110737#39110737", "title": "Using structures to find the GCD of a fraction (Simple C program)", "body": "<p>in the signature of the function, both of the parameters are named <code>s1</code></p>\n\n<p>Fix that, perhaps by renaming one of the parameters to <code>s2</code></p>\n"}], "owner": {"reputation": 6433, "user_id": 6591667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/6632be3bf9dfd9e4275569ebd3a2dacd?s=128&d=identicon&r=PG&f=1", "display_name": "tadm123", "link": "https://stackoverflow.com/users/6591667/tadm123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 936, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1471987715, "creation_date": 1471986465, "question_id": 39110685, "link": "https://stackoverflow.com/questions/39110685/using-structures-to-find-the-gcd-of-a-fraction-simple-c-program", "title": "Using structures to find the GCD of a fraction (Simple C program)", "body": "<p>As the title says, I'm making a program to find the GCD of a fraction. The program has a function that find it, but I had run into some problems.</p>\n\n<p>I want the function to accept two structure variables (denominator and numerator) and returns the GCD (integer)</p>\n\n<p>Here's my code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n\nstruct fraction{\n    int numerator,denominator;\n};\n\nint find_gcd(struct fraction s1, struct fraction s1);\n\nint main(void)\n{\n    struct fraction d1;\n    int gcd;\n\n    d1.numerator= 20;\n    d1.denominator= 100;\n\n    printf(\"Fraction: %d/%d\\n\",d1.numerator,d1.denominator);\n\n    gcd= find_gcd(d1.numerator, d1.denominator);\n\n   printf(\"In lowest terms: %d/%d\",d1.numerator/gcd,d1.denominator/gcd);\n}\n\nint find_gcd(struct fraction s1, struct fraction s1)\n{\n    int remainder=0;\n\n    while (s1.denominator !=0)\n    {\n        remainder = s1.numerator/s1.denominator;\n        s1.numerator= s1.denominator;\n        s1.denominator= remainder;\n    }\n\n    return s1.numerator;        //this is the gcd\n}\n</code></pre>\n\n<p>I get the following errors:</p>\n\n<pre><code>GCD_structures.c:8:50: error: redefinition of parameter 's1'\n int find_gcd(struct fraction s1, struct fraction s1);\n                                                  ^\nGCD_structures.c:8:30: note: previous definition of 's1' was here\n int find_gcd(struct fraction s1, struct fraction s1);\n                              ^\nGCD_structures.c: In function 'main':\nGCD_structures.c:20:10: error: incompatible type for argument 1 of 'find_gcd'\n     gcd= find_gcd(d1.numerator, d1.denominator);\n</code></pre>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["c", "poisson"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471984637, "post_id": 39110184, "comment_id": 65567894, "body": "If the question was closed or not answered to your satisfaction, don&#39;t repost it!"}, {"owner": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1471984711, "post_id": 39110184, "comment_id": 65567933, "body": "<a href=\"https://en.wikipedia.org/wiki/Poisson_distribution#Definition\" rel=\"nofollow noreferrer\">&quot;The conventional definition of the Poisson distribution contains two terms that can easily overflow on computers: \u03bbk and k!. The fraction of \u03bbk to k! can also produce a rounding error which is very large compared to e\u2212\u03bb, and therefore give an erroneous result.&quot;</a> I&#39;m sure you&#39;ve  spent a lot of time on this."}, {"owner": {"reputation": 413, "user_id": 6727451, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6453c7494a81ae40c5aaa958188e47ba?s=128&d=identicon&r=PG&f=1", "display_name": "T.Setso", "link": "https://stackoverflow.com/users/6727451/t-setso"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471984717, "post_id": 39110184, "comment_id": 65567934, "body": "you didnt understand it..closed on Codereview @Olaf"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471984793, "post_id": 39110184, "comment_id": 65567972, "body": "&quot;i posted this before, ...&quot; - No, you posted it here first, then code review, now here again!"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1471984833, "post_id": 39110184, "comment_id": 65567991, "body": "Did you not read the comments last time? There should be no need to calculate that stupendous factorial. The running term of your series can be multiplied by <code>u</code> and divided by <code>k</code>, then added to the series sum (ref. the second formula in the <a href=\"http://stackoverflow.com/questions/39107616/how-to-calculate-erlangc-poisson-in-c-program\">previous question</a>)."}, {"owner": {"reputation": 413, "user_id": 6727451, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6453c7494a81ae40c5aaa958188e47ba?s=128&d=identicon&r=PG&f=1", "display_name": "T.Setso", "link": "https://stackoverflow.com/users/6727451/t-setso"}, "edited": false, "score": 0, "creation_date": 1471985037, "post_id": 39110184, "comment_id": 65568088, "body": "I cant follow you :/ could u show me that as code?  I have the same problem in the first poisson function (bool = false)@WeatherVane"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1471985107, "post_id": 39110184, "comment_id": 65568115, "body": "Each term <code>k</code> has <code>u^k &#47; k!</code>. So each term is the previous term times <code>u</code> over <code>k</code>."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1471985699, "post_id": 39110184, "comment_id": 65568415, "body": "...and be aware that <code>0!</code> for the first term (your series starts from <code>k=0</code>) is <code>1</code>, so there is no div 0  error."}, {"owner": {"reputation": 413, "user_id": 6727451, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6453c7494a81ae40c5aaa958188e47ba?s=128&d=identicon&r=PG&f=1", "display_name": "T.Setso", "link": "https://stackoverflow.com/users/6727451/t-setso"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1471985987, "post_id": 39110184, "comment_id": 65568569, "body": "i still cant follow you, a code line would be better to understand @WeatherVane"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1471986868, "post_id": 39110184, "comment_id": 65568976, "body": "To write your code for you would have to be an answer, and since I cannot guarantee that writing your code will produce the answers you need, I can only say that if you are not just blindly copying code, you have enough information now to write it yourself."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1471987065, "post_id": 39110184, "comment_id": 65569075, "body": "Lets start with post text, not images,  Most of us could probably help you, if 1) you posted text 2) you were clear, in your question, about exactly what it the problem\\"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1471987097, "post_id": 39110184, "comment_id": 65569091, "body": "voting to close because you did not follow the rules about posting questions."}], "answers": [{"comments": [{"owner": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1471987542, "post_id": 39110791, "comment_id": 65569272, "body": "Infinite descent, stack overflow, undefined behavior for using the value of an object with automatic storage duration while it is indeterminate, misleading indentation."}, {"owner": {"reputation": 413, "user_id": 6727451, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6453c7494a81ae40c5aaa958188e47ba?s=128&d=identicon&r=PG&f=1", "display_name": "T.Setso", "link": "https://stackoverflow.com/users/6727451/t-setso"}, "edited": false, "score": 0, "creation_date": 1471990756, "post_id": 39110791, "comment_id": 65570457, "body": "Thanks for your help, i used your way, and now i can handle big values"}, {"owner": {"reputation": 3919, "user_id": 3169961, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/42c9a71949249cac6172502dfce7da7d?s=128&d=identicon&r=PG", "display_name": "sabbahillel", "link": "https://stackoverflow.com/users/3169961/sabbahillel"}, "reply_to_user": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1471991581, "post_id": 39110791, "comment_id": 65570726, "body": "@EOF Thank you for pointing out the typo of leaving out the brackets. With the brackets in, the result is not infinite. Sice val is used only inside the if, I moved the definition into that scope and the values are no longer indeterminate."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471994174, "post_id": 39110791, "comment_id": 65571388, "body": "The control variable of a recursion typically is an integer type. I don&#39;t see any reason to use a float here, but very good reasons not to."}, {"owner": {"reputation": 3919, "user_id": 3169961, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/42c9a71949249cac6172502dfce7da7d?s=128&d=identicon&r=PG", "display_name": "sabbahillel", "link": "https://stackoverflow.com/users/3169961/sabbahillel"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471994243, "post_id": 39110791, "comment_id": 65571407, "body": "@Olaf good point. Since it is a power and a factorial then you are correct. I will fix it."}, {"owner": {"reputation": 3919, "user_id": 3169961, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/42c9a71949249cac6172502dfce7da7d?s=128&d=identicon&r=PG", "display_name": "sabbahillel", "link": "https://stackoverflow.com/users/3169961/sabbahillel"}, "reply_to_user": {"reputation": 413, "user_id": 6727451, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6453c7494a81ae40c5aaa958188e47ba?s=128&d=identicon&r=PG&f=1", "display_name": "T.Setso", "link": "https://stackoverflow.com/users/6727451/t-setso"}, "edited": false, "score": 0, "creation_date": 1471994496, "post_id": 39110791, "comment_id": 65571474, "body": "@T.Setso Thank you for letting me know it worked. I do not have access to a compiler."}, {"owner": {"reputation": 413, "user_id": 6727451, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6453c7494a81ae40c5aaa958188e47ba?s=128&d=identicon&r=PG&f=1", "display_name": "T.Setso", "link": "https://stackoverflow.com/users/6727451/t-setso"}, "edited": false, "score": 0, "creation_date": 1471994656, "post_id": 39110791, "comment_id": 65571529, "body": "Thanks to you! you helped me alot :) btw; u added a iterative way. What reasons should i have to use iterativ and not recursiv? @sabbahillel"}, {"owner": {"reputation": 413, "user_id": 6727451, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6453c7494a81ae40c5aaa958188e47ba?s=128&d=identicon&r=PG&f=1", "display_name": "T.Setso", "link": "https://stackoverflow.com/users/6727451/t-setso"}, "edited": false, "score": 0, "creation_date": 1471995683, "post_id": 39110791, "comment_id": 65571775, "body": "What reasons should i have to use the iterativ way and not recursiv?@sabbahillel"}, {"owner": {"reputation": 3919, "user_id": 3169961, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/42c9a71949249cac6172502dfce7da7d?s=128&d=identicon&r=PG", "display_name": "sabbahillel", "link": "https://stackoverflow.com/users/3169961/sabbahillel"}, "reply_to_user": {"reputation": 413, "user_id": 6727451, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6453c7494a81ae40c5aaa958188e47ba?s=128&d=identicon&r=PG&f=1", "display_name": "T.Setso", "link": "https://stackoverflow.com/users/6727451/t-setso"}, "edited": false, "score": 0, "creation_date": 1471999311, "post_id": 39110791, "comment_id": 65572639, "body": "@T.Setso no particular reason. I put it in for completeness. However, on some systems the stack processing could be worse than the looping. I just like to show the looping equivalent of recursion at times for completeness. I have spoken to some people who would otherwise have to have the recursion explained in more detail. This way someone else seeing the answer can see the expansion as part of the answer."}, {"owner": {"reputation": 413, "user_id": 6727451, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6453c7494a81ae40c5aaa958188e47ba?s=128&d=identicon&r=PG&f=1", "display_name": "T.Setso", "link": "https://stackoverflow.com/users/6727451/t-setso"}, "edited": false, "score": 0, "creation_date": 1472050182, "post_id": 39110791, "comment_id": 65598601, "body": "ok, i tried the iterative way, and the return value is false :) anyway the recursive way works! @sabbahillel"}, {"owner": {"reputation": 3919, "user_id": 3169961, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/42c9a71949249cac6172502dfce7da7d?s=128&d=identicon&r=PG", "display_name": "sabbahillel", "link": "https://stackoverflow.com/users/3169961/sabbahillel"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472053930, "post_id": 39110791, "comment_id": 65601242, "body": "@chux Yes it was a typo.Thanks for seeing it."}, {"owner": {"reputation": 3919, "user_id": 3169961, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/42c9a71949249cac6172502dfce7da7d?s=128&d=identicon&r=PG", "display_name": "sabbahillel", "link": "https://stackoverflow.com/users/3169961/sabbahillel"}, "reply_to_user": {"reputation": 413, "user_id": 6727451, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6453c7494a81ae40c5aaa958188e47ba?s=128&d=identicon&r=PG&f=1", "display_name": "T.Setso", "link": "https://stackoverflow.com/users/6727451/t-setso"}, "edited": false, "score": 0, "creation_date": 1472054022, "post_id": 39110791, "comment_id": 65601297, "body": "@T.Setso yes, the <code>u&#47;n</code> in the iterative code was a typo. It was supposed to be <code>u&#47;i</code>"}], "tags": [], "owner": {"reputation": 3919, "user_id": 3169961, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/42c9a71949249cac6172502dfce7da7d?s=128&d=identicon&r=PG", "display_name": "sabbahillel", "link": "https://stackoverflow.com/users/3169961/sabbahillel"}, "is_accepted": true, "score": 1, "last_activity_date": 1472053959, "last_edit_date": 1472053959, "creation_date": 1471986934, "answer_id": 39110791, "question_id": 39110184, "link": "https://stackoverflow.com/questions/39110184/poisson-calculation-erlang-c/39110791#39110791", "title": "Poisson calculation (erlang C)", "body": "<p><code>(pow(u, m)/factorial(m))</code> can be expressed as a recursive loop with each element shown as u/n where each n is an element of m!.</p>\n\n<pre><code>double ratio(double u, int n)\n{\n    if(n &gt; 0)\n     {\n        // Avoid the ratio overflow by calculating each ratio element\n        double val;\n        val = u/n;\n        return val*ratio(u, n-1);\n      }\n    else\n      {\n         // Avoid division by 0 as power and factorial of 0 are 1\n        return 1;\n      }\n}\n</code></pre>\n\n<p>Note that if you want to avoid recursion, you can do it as a loop as well</p>\n\n<pre><code>double ratio(double u, int n)\n{\n    int i;\n    // Avoid the ratio overflow by calculating each ratio element\n    // default the ratio to 1 for n == 0\n    double val = 1;\n    // calculate the next n-1 ratios and put them into the total\n    for (i = 1; i&lt;=n; i++)\n      {\n        // Put in the next element of the ratio \n        val *=  u/i;\n      }\n    // return the final value of the ratio\n    return val;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 413, "user_id": 6727451, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6453c7494a81ae40c5aaa958188e47ba?s=128&d=identicon&r=PG&f=1", "display_name": "T.Setso", "link": "https://stackoverflow.com/users/6727451/t-setso"}, "edited": false, "score": 0, "creation_date": 1471990887, "post_id": 39111339, "comment_id": 65570500, "body": "Wow, Thanks for your help. Your algorithm is wonderful, i just tried the algorithm of &quot;sabbahillel&quot; and its shorter than yours, but gives exactly the same results. Iam going to understand what u guys did, and then i am going to implement it! Thanks again!!!"}], "tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 1, "last_activity_date": 1471989567, "creation_date": 1471989567, "answer_id": 39111339, "question_id": 39110184, "link": "https://stackoverflow.com/questions/39110184/poisson-calculation-erlang-c/39111339#39111339", "title": "Poisson calculation (erlang C)", "body": "<p>To cope with values exceeding the <code>double</code> range, re-code to use the <em>log</em> of values.  Downside- some precision loss.</p>\n\n<p>Precision can be re-gained with improved code, but here is something that at least copes with the range issues.</p>\n\n<p>Slight variant of OP's code follows: Used for comparison.</p>\n\n<pre><code>long double factorial(unsigned m) {\n  long double f = 1.0;\n  while (m &gt; 0) {\n    f *= m;\n    m--;\n  }\n  return f;\n}\n\ndouble getPoisson(unsigned m, double u, bool cumu) {\n  double ret = 0;\n  if (!cumu) {\n    ret = (double) ((exp(-u) * pow(u, m)) / (factorial(m)));\n  } else {\n    double facto = 1;\n    double ehu = exp(-u);\n    for (unsigned i = 0; i &lt; m; i++) {\n      ret = ret + (ehu * pow(u, i)) / facto;\n      facto *= (i + 1);\n    }\n  }\n  return ret;\n}\n\ndouble getErlang(unsigned m, double u, double p) {\n  double numerator = getPoisson(m, u, false);\n  double denominator = numerator + (1.0 - p) * getPoisson(m, u, true);\n  return numerator / denominator;\n}\n</code></pre>\n\n<p>Suggested changes</p>\n\n<pre><code>#ifdef M_PI\n  #define  MY_PI M_PI\n#else\n  #define  MY_PI 3.1415926535897932384626433832795\n#endif\n\n// log of n!\n//\n// Gosper Approximation of Stirling's Approximation\n// http://mathworld.wolfram.com/StirlingsApproximation.html\n// n! about= sqrt(pi*(2*n + 1/3.)) * pow(n,n)  * exp(-n)\nstatic double ln_factorial(unsigned n) {\n  if (n &lt;= 1) return 0.0;\n  double x = n;\n  return log(sqrt(MY_PI * (2 * x + 1 / 3.0))) + log(x) * x - x;\n}\n\n\ndouble getPoisson_2(unsigned m, double u, bool cumu) {\n  double ret = 0.0;\n  if (cumu) {\n    // Simplify term calculation.  `mul` does not get too large nor small.\n    double mul = exp(-u);\n    for (unsigned i = 0; i &lt; m; i++) {\n      ret += mul;\n      mul *= u/(i + 1);\n      // printf(\"ret:% 10e  mul:% 10e\\n\", ret, mul);\n    }\n  } else {\n    // ret = (exp(-u) * pow(u, m)) / (factorial(m));\n    double ln_ret = -u + log(u) * m - ln_factorial(m);\n    return exp(ln_ret);\n  }\n  return ret;\n}\n\ndouble getErlang_2(unsigned m, double u, double p) {\n  double numerator = getPoisson_2(m, u, false);\n  double denominator = numerator + (1 - p) * getPoisson_2(m, u, true);\n  return numerator / denominator;\n}\n</code></pre>\n\n<p>Test code</p>\n\n<pre><code>void ErTest(unsigned m, double u, double p, double expect) {\n  printf(\"m:%4u  u:% 14e  p:% 14e\", m, u, p);\n  printf(\"  E0:% 14e\", expect);\n  double y1 = getErlang(m, u, p);\n  printf(\"  E1:% 14e\", y1);\n  double y2 = getErlang_2(m, u, p);\n  printf(\"  E2:% 14e\", y2);\n  puts(\"\");\n}\n\nint main(void) {\n  ErTest(50, 48, 0.96, 0.694456);\n  ErTest(100, 96, 0.96, 0.5872811);\n  ErTest(500, 487, 0.974, 0.45269);\n}\n\nm:  50  u:  4.800000e+01  p:  9.600000e-01  E0:  6.944560e-01  E1:  6.944556e-01  E2:  6.944562e-01\nm: 100  u:  9.600000e+01  p:  9.600000e-01  E0:  5.872811e-01  E1:  5.872811e-01  E2:  5.872813e-01\nm: 500  u:  4.870000e+02  p:  9.740000e-01  E0:  4.526900e-01  E1:           nan  E2:  4.464746e-01\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1471990176, "post_id": 39111361, "comment_id": 65570276, "body": "I tried your <code>getPoisson()</code> as a replacement for OP&#39;s <code>getPoisson()</code> with <code>getErlang(50, 48, .96)</code> and was about 1.2% off,  not too bad.  Although I&#39;d expect better - perhaps OP&#39;s numbers are off?  Maybe the test harness of my answer may help compare."}, {"owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1471990633, "post_id": 39111361, "comment_id": 65570419, "body": "@chux Thanks [and thank the stars]. I coded it [pre-coffee :-)], based upon some prior code I had done for Taylor series. I was treating it as a reference example and didn&#39;t test it. I desk checked it a few times, so I was pretty sure about it, but it&#39;s nice to know it worked &quot;out-of-the-box&quot;."}, {"owner": {"reputation": 413, "user_id": 6727451, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6453c7494a81ae40c5aaa958188e47ba?s=128&d=identicon&r=PG&f=1", "display_name": "T.Setso", "link": "https://stackoverflow.com/users/6727451/t-setso"}, "edited": false, "score": 0, "creation_date": 1471991137, "post_id": 39111361, "comment_id": 65570593, "body": "Hey Craig Estey, thanks for your help :) as chux said, the return value is a little bit differ :)) Anyway. Thanks! @CraigEstey"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1471991323, "post_id": 39111361, "comment_id": 65570645, "body": "<code>ratio *= u; ratio &#47;= (i + 1);</code> --&gt; <code>ratio *= u&#47;(i + 1);</code> may help range issues."}, {"owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1471991733, "post_id": 39111361, "comment_id": 65570775, "body": "@chux On the <code>ratio</code> calc, the optimizer might handle it. But, I&#39;ll give it a try. Also, you <i>had</i> a comment about <code>cumu</code> vs. not. I took a look and the code <i>may</i> need to increment <code>m</code> before the loop for the non-cumu case. I&#39;m going out for [much needed] coffee, so I&#39;ll fix this all later. Your thoughts?"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1471992274, "post_id": 39111361, "comment_id": 65570906, "body": "Further checking. <code>getPoisson( m,  u, cumu==false)</code> is wrong (At least it differs from EXCEL which matches OP&#39;s expectations), not by too much, but by more than should be."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1471993458, "post_id": 39111361, "comment_id": 65571215, "body": "When <code>(cumu == 0)</code> I think you want <code>double cur = 1; ... for (int i = 0; i &lt; m; i++) {       ratio *= u&#47;(i + 1);         cur = ehu * ratio;         sum += cur; }</code>  This is very close to Excel.  This may not be good when <code>cumu==true</code>"}], "tags": [], "owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "is_accepted": false, "score": 0, "last_activity_date": 1471989715, "creation_date": 1471989715, "answer_id": 39111361, "question_id": 39110184, "link": "https://stackoverflow.com/questions/39110184/poisson-calculation-erlang-c/39111361#39111361", "title": "Poisson calculation (erlang C)", "body": "<p>Your large recursive <code>factorial</code> is a problem as it might produce a stack overflow as well as a value overflow. <code>pow</code> might also get large.</p>\n\n<p>Here's a way to combine things incrementally:</p>\n\n<pre><code>double\ngetPoisson(double m, double u, bool cumu)\n{\n    double sum = 0;\n    double facto = 1;\n    double u_i = 1;\n    double ehu = exp(-u);\n    double cur = ehu;\n\n    // u_i -- pow(u,i)\n    // cur -- current/last term in series\n    // sum -- sum of terms\n\n    for (int i = 0; i &lt; m; i++) {\n        cur = (ehu * u_i) / facto;\n        sum += cur;\n\n        u_i *= u;\n        facto *= (i + 1);\n    }\n\n    return cumu ? sum : cur;\n}\n</code></pre>\n\n<p>The above is \"okay\", but still might overflow some values because of the <code>u_i</code> and <code>facto</code> terms.</p>\n\n<p>Here is an alternate that combines the terms as a ratio. It is less likely to overflow:</p>\n\n<pre><code>double\ngetPoisson(double m, double u, bool cumu)\n{\n    double sum = 0;\n    double ehu = exp(-u);\n    double cur = ehu;\n    double ratio = 1;\n\n    // cur -- current/last term in series\n    // sum -- sum of terms\n    // ratio -- u^i / factorial(i)\n\n    for (int i = 0; i &lt; m; i++) {\n        cur = ehu * ratio;\n        sum += cur;\n\n        ratio *= u;\n        ratio /= (i + 1);\n    }\n\n    return cumu ? sum : cur;\n}\n</code></pre>\n\n<p>The above might <em>still</em> produce some large values. If so, you might have to use <code>long double</code>, <code>quadmath</code>, or multiprecision arithmetic. Or, come up with an \"analog\" of the equation/algorithm.</p>\n"}], "owner": {"reputation": 413, "user_id": 6727451, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6453c7494a81ae40c5aaa958188e47ba?s=128&d=identicon&r=PG&f=1", "display_name": "T.Setso", "link": "https://stackoverflow.com/users/6727451/t-setso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 924, "favorite_count": 0, "accepted_answer_id": 39110791, "answer_count": 3, "score": 0, "last_activity_date": 1472053959, "creation_date": 1471984349, "last_edit_date": 1472014131, "question_id": 39110184, "link": "https://stackoverflow.com/questions/39110184/poisson-calculation-erlang-c", "title": "Poisson calculation (erlang C)", "body": "<p>i posted this before, user told me to post it on codereview. i did, and they closed it...so one more time here: (i deleted the old question)</p>\n\n<p>I have these formulas:</p>\n\n<p><a href=\"https://i.stack.imgur.com/nZzLd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nZzLd.png\" alt=\"enter image description here\"></a></p>\n\n<p>and I need the Poisson formulas for the erlangC formula:</p>\n\n<p><a href=\"https://i.stack.imgur.com/CKBUB.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CKBUB.gif\" alt=\"enter image description here\"></a></p>\n\n<p>I tried to rebuild the formulas in C:</p>\n\n<pre><code>double getPoisson(double m, double u, bool cumu)\n{\n    double ret = 0;\n    if(!cumu)\n    {\n        ret = (exp(-u)*pow(u,m)) / (factorial(m));\n    }\n    else\n    {\n        double facto = 1;\n        double ehu = exp(-u);\n        for(int i = 0; i &lt; m; i++)\n        {\n            ret = ret + (ehu * pow(u,i)) / facto;\n            facto *= (i+1);\n        }\n     }\n     return ret;\n}\n</code></pre>\n\n<p>The Erlang C Formula:</p>\n\n<pre><code>double getErlangC(double m, double u, double p)\n{\n    double numerator = getPoisson(m, u, false);\n    double denominator = getPoisson(m, u, false) + (1-p) * getPoisson(m, u, true);\n    return numerator/denominator;\n}\n</code></pre>\n\n<p>The main problem is, the <code>m</code> parameter in <code>getPoisson</code> is a big value (>170)\nso it wants to calculate >170! but it cannot handle it.  I think the primitive data types are too small to work correctly, or what do you say?</p>\n\n<p>BTW: This is the factorial function I use for the first Poisson:</p>\n\n<pre><code>double factorial(double n)\n{\n    if(n &gt;= 1)\n        return n*factorial(n-1);\n    else\n        return 1;\n}\n</code></pre>\n\n<p>Some samples:</p>\n\n<p>Input:</p>\n\n<pre><code>double l = getErlangC(50, 48, 0.96);\nprintf(\"%g\", l);\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>0.694456 (correct)\n</code></pre>\n\n<p>Input:</p>\n\n<pre><code>double l = getErlangC(100, 96, 0.96);\nprintf(\"%g\", l);\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>0.5872811 (correct)\n</code></pre>\n\n<p>if i use a value higher than 170 for the first parameter (m) of getErlangC like:</p>\n\n<p>Input:</p>\n\n<pre><code>double l = getErlangC(500, 487, 0.974);\nprintf(\"%g\", l);\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>naN (incorrect)\n</code></pre>\n\n<p>Excepted:</p>\n\n<pre><code>0.45269\n</code></pre>\n\n<p>How's my approach? Would be there a better way to calculate Poisson and erlangC?</p>\n\n<p>Some Info: Excel has the POISSON Function, and on Excel it works perfekt... would there be a way to see the algorithm(code) EXCEL uses for POISSON?</p>\n"}, {"tags": ["c", "linux", "sockets", "send", "recv"], "comments": [{"owner": {"reputation": 2445, "user_id": 3476780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/abf771bddcd864626a0e1499ccfc699b?s=128&d=identicon&r=PG&f=1", "display_name": "yano", "link": "https://stackoverflow.com/users/3476780/yano"}, "edited": false, "score": 0, "creation_date": 1471984827, "post_id": 39110113, "comment_id": 65567987, "body": "checked Wireshark to see if the data is making it to the wire?"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1471985180, "post_id": 39110113, "comment_id": 65568156, "body": "This is unreadable! Format&amp;indent this mess first."}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1471995312, "post_id": 39110113, "comment_id": 65571688, "body": "Please format this illegible mess properly."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 1, "creation_date": 1472008800, "post_id": 39110113, "comment_id": 65574721, "body": "TCP is not a message protocol. If you want to send and receive messages, you have to implement a message protocol on top of TCP."}], "answers": [{"comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 1, "creation_date": 1471995427, "post_id": 39110564, "comment_id": 65571720, "body": "He is calling <code>perror()</code> most of the time, which is adequate. You haven&#39;t identified the actual problem here."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471997641, "post_id": 39110564, "comment_id": 65572214, "body": "And what is the <b>actual</b> problem?"}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1472007523, "post_id": 39110564, "comment_id": 65574459, "body": "@Olaf The actual problem is stated in the question. It is that his second <code>recv()</code> is blocking, and this answer hasn&#39;t addressed it at all."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1472039462, "post_id": 39110564, "comment_id": 65590483, "body": "@EJP: Sorry, I meant &quot;what is the solution to the <b>actual</b> problem?&quot;, of course. (I always wonder who upvotes such comments)."}], "tags": [], "owner": {"reputation": 6544, "user_id": 451601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/164602d512ce01f188e5a50593b46c5f?s=128&d=identicon&r=PG", "display_name": "James K. Lowden", "link": "https://stackoverflow.com/users/451601/james-k-lowden"}, "is_accepted": false, "score": 1, "last_activity_date": 1471985894, "creation_date": 1471985894, "answer_id": 39110564, "question_id": 39110113, "link": "https://stackoverflow.com/questions/39110113/second-recv-call-doesnt-receive-data-halts-the-execution-in-c/39110564#39110564", "title": "Second recv call doesn&#39;t receive data, halts the execution in C", "body": "<p>Your error-checking is haphazard, and consequently you're certainly missing a problem that occurs before the behavior you're observing.  I recommend you follow RW Steven's idiom:</p>\n\n<pre><code>int n;\nif( (n = recv(new_s, buf, sizeof(buf), 0)) &lt; 0 ) {\n    err(EXIT_FAILURE, \"recv %d\", __LINE__);\n}\n</code></pre>\n\n<p>Test every function call, and handle every error.  For simple programs, just call <strong>err</strong>(3) on error.  Do that consistently, and the program's behavior will be much less mysterious (if still occasionally surprising). And don't be afraid of the spacebar!  It's easy to hit, and easier still to read.  </p>\n\n<p>My other bit of advice, if I may, concerns</p>\n\n<pre><code>int send_file_name,rec_msg;\n</code></pre>\n\n<p>Names like that are confusing.  A name is almost never an integer.  For I/O sizes, just use one simple name like <code>n</code>, <code>len</code>, or <code>size</code>.  Even if you don't care for yourself, you want to care before publishing your question in an open forum.  Otherwise, when people see</p>\n\n<pre><code>send_file_name=send(s,filename,strlen(filename)+1,0);\n</code></pre>\n\n<p>they may think <code>send</code> is some function other than <strong>send</strong>(2), or that the person asking the question was careless.  </p>\n"}, {"tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": false, "score": 1, "last_activity_date": 1472011044, "last_edit_date": 1472011044, "creation_date": 1472008473, "answer_id": 39113827, "question_id": 39110113, "link": "https://stackoverflow.com/questions/39110113/second-recv-call-doesnt-receive-data-halts-the-execution-in-c/39113827#39113827", "title": "Second recv call doesn&#39;t receive data, halts the execution in C", "body": "<p>The main problem I see is that neither the client nor the server are handling socket I/O correctly in general.  They are not handling the cases where reads and writes transfer fewer bytes then requested, you need to loop the I/O.  And the client is reading too many bytes from the server anyway, which is why your second <code>recv()</code> is blocking.  And you are relying on a disconnect to indicate the end of the file has been reached, but that does not allow the client to do adequate error checking to know if the full file was actually received or not.</p>\n\n<p>Also, when sending the content of a file, the server is attempting to read the entire file into memory (bad!), not doing adequate error checking on the file I/O, and it is treating the file content as text instead of as binary (don't use <code>strlen()</code> on binary data!).</p>\n\n<p>Try something more like this instead:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;strings.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;netdb.h&gt;\n\n#define SERVER_PORT 5959\n#define MAX_LINE 512\n\nint sendstring(int sock, const char *str) {\n    if (!str) str = \"\";\n    int len = strlen(str) + 1;\n\n    do {\n        int ret = send(sock, str, len, 0);\n        if (ret &lt;= 0) return -1;\n        str += ret;\n        len -= ret;\n    }\n    while (len &gt; 0);\n\n    return 0;\n}\n\nint readbuf(int sock, void *buf, int buflen) {\n    char *pbuf = (char*) buf;\n\n    while (buflen &gt; 0) {\n        int len = recv(sock, pbuf, buflen, 0);\n        if (len &lt;= 0) return -1;\n        pbuf += len;\n        buflen -= len;\n    }\n\n    return 0;\n}\n\nint readstring(int sock, char *str, int maxlen) {\n    while (maxlen &gt; 0) {\n        if (recv(sock, str, 1, 0) &lt;= 0) return -1;\n        if (*str == '\\0') return 0;\n        ++str;\n        --maxlen;\n    }\n    return -2;\n}\n\nint readfile(int sock, int fd) {\n    int filesize;\n    char buf[MAX_LINE];\n\n    if (readbuf(sock, &amp;filesize, sizeof(filesize)) &lt; 0) return -1;\n    filesize = ntohl(filesize);\n\n    while (filesize &gt; 0) {\n        int len = readbuf(sock, buf, min(sizeof(buf), filesize));\n        if (len &lt; 0) return -1;\n        if (fwrite(buf, len, 1, fp) != 1) return -2;\n        filesize -= len;\n    }\n\n    return 0;\n}\n\nint main(int argc, char * argv[]) {\n    char filename[MAX_LINE], reply[MAX_LINE];\n\n    if (argc != 2) {\n        fprintf(stderr, \"usage: simplex-talk host\\n\");\n        exit(1);\n    }\n\n    char *host = argv[1];\n\n    /* translate host name into peer's IP address */\n    struct hostent *hp = gethostbyname(host);\n    if (!hp) {\n        fprintf(stderr, \"simplex-talk: unknown host: %s\\n\", host);\n        exit(1);\n    }\n\n    if (hp-&gt;h_addrtype != AF_INET) {\n        fprintf(stderr, \"simplex-talk: unsupported address type %d for host: %s\\n\", hp-&gt;h_addrtype, host);\n        exit(1);\n    }\n\n    /* build address data structure */  \n    struct sockaddr_in sin;\n    bzero((char *)&amp;sin, sizeof(sin));\n    sin.sin_family = AF_INET;\n    bcopy(hp-&gt;h_addr, &amp;sin.sin_addr, hp-&gt;h_length);\n    sin.sin_port = htons(SERVER_PORT);\n\n    printf(\"Host's remote IP: %s\\n\", inet_ntoa(&amp;sin.sin_addr));\n\n    /* active open */\n    int s = socket(PF_INET, SOCK_STREAM, 0);\n    if (s &lt; 0) {\n        perror(\"simplex-talk: socket\");\n        exit(1);\n    }\n\n    printf(\"Client created socket.\\n\");\n\n    if (connect(s, (struct sockaddr *)&amp;sin, sizeof(sin)) &lt; 0)\n    {\n        perror(\"simplex-talk: connect\");\n        close(s);\n        exit(1);\n    }\n\n    printf(\"Client connected.\\n\");\n\n    /* main loop: get and send lines of text */\n    do {\n        printf(\"Enter the file name ('bye' to quit):\\n\");\n\n        if (scanf(\"%512s\", filename) != 1) {\n            printf(\"Error reading filename\\n\");\n            break;\n        }\n\n        if (strcmp(filename, \"bye\") == 0) {\n            sendstring(s, \"bye\");\n            break;\n        }\n\n        if (sendstring(s, filename) &lt; 0) {\n            printf(\"Error sending filename\\n\");\n            break;\n        }\n\n        if (readstring(s, reply, sizeof(reply)) &lt; 0) {\n            printf(\"Error reading reply\\n\");\n            break;\n        }\n\n        if (strcmp(reply, \"OK\") != 0) {\n            printf(\"%s\\n\", reply);\n            if (strcmp(reply, \"bye\") == 0) break;\n            continue;\n        }\n\n        FILE *fp = fopen(filename, \"wb\");\n        if (!fp) {\n            printf(\"Error opening file\\n\");\n            break;\n        }\n\n        printf(\"Receiving file\\n\");\n\n        int ret = readfile(s, fd);\n        fclose(fp);\n\n        if (ret &lt; 0) {\n            if (ret == -2)\n                printf(\"Error writing file\\n\");\n            else\n                printf(\"Error reading file\\n\");\n\n            break;\n        }\n\n        printf(\"Received file\\n\");\n    }\n    while (1);\n\n    close(s);\n    return 0;\n}\n</code></pre>\n\n<p>    </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt; \n#include &lt;string.h&gt;\n#include &lt;strings.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;netdb.h&gt;\n\n#define SERVER_PORT 5959\n#define MAX_PENDING 5\n#define MAX_LINE 512\n\nint sendbuf(int sock, void *buf, int buflen) {\n    char *pbuf = (char*) buf;\n\n    while (len &gt; 0) {\n        int len = send(sock, pbuf, buflen, 0);\n        if (len &lt;= 0) return -1;\n        pbuf += len;\n        buflen -= len;\n    }\n\n    return 0;\n}\n\nint sendstring(int sock, const char *str) {\n    if (!str) str = \"\";\n    return sendbuf(sock, str, strlen(str) + 1);\n}\n\nint sendfile(int sock, int fd) {\n    char buf[MAX_LINE];\n\n    struct stat s;\n    if (fstat(fd, &amp;s) &lt; 0) return -2;\n\n    int pos = ftell(fp);\n    if (pos == -1) return -2;\n\n    int file_size = s.st_size - pos;\n    int tmp_file_size = htonl(file_size);\n    if (sendbuf(sock, &amp;tmp_file_size, sizeof(tmp_file_size)) &lt; 0) return -1;\n\n    while (file_size &gt; 0) {\n        int len = fread(buf, 1, min(sizeof(buf), file_size), fp);\n        if (len &lt; 1) return -2;\n        if (sendbuf(sock, buf, len) &lt; 0) return -1;\n        file_size -= len;\n    }\n\n    return 0;\n}\n\nint readstring(int sock, char *str, int maxlen) {\n    while (maxlen &gt; 0) {\n        if (recv(sock, str, 1, 0) &lt;= 0) return -1;\n        if (*str == '\\0') return 0;\n        ++str;\n        --maxlen;\n    }\n    return -2;\n}\n\nint main() {\n    char msg[MAX_LINE];\n\n    struct sockaddr_in sin;\n    bzero((char *)&amp;sin, sizeof(sin));\n    sin.sin_family = AF_INET;\n    sin.sin_addr.s_addr = INADDR_ANY;\n    sin.sin_port = htons(SERVER_PORT);\n\n    /* setup passive open */\n    int s = socket(PF_INET, SOCK_STREAM, 0);\n    if (s &lt; 0) {\n        perror(\"simplex-talk: socket\");\n        exit(1);\n    }\n\n    printf(\"Server is using address %s and port %d.\\n\", inet_ntoa(&amp;(sin.sin_addr)), SERVER_PORT);\n\n    if (bind(s, (struct sockaddr *)&amp;sin, sizeof(sin)) &lt; 0) {\n        perror(\"simplex-talk: bind\");\n        close(s);\n        exit(1);\n    }\n\n    printf(\"Server bind done.\\n\");\n\n    if (listen(s, MAX_PENDING) &lt; 0) {\n        perror(\"simplex-talk: listen\");\n        close(s);\n        exit(1);\n    }\n\n    printf(\"Server Listening.\\n\");\n\n    /* wait for connection, then receive and print text */\n    do {\n        int len = sizeof(sin);\n        int cli_s = accept(s, (struct sockaddr *)&amp;sin, &amp;len);\n        if (cli_s &lt; 0) {\n            perror(\"simplex-talk: accept\");\n            close(s);\n            exit(1);\n        }\n\n        printf(\"Client connected\\n\");\n\n        do {\n            if (readstring(cli_s, msg, sizeof(msg)) &lt; 0) {\n                printf(\"Error reading request\\n\");\n                break;\n            }\n\n            if (strcmp(msg, \"bye\") == 0) break;\n\n            printf(\"File requested: %s\\n\", msg);\n\n            FILE *fp = fopen(msg, \"rb\");\n            if (!fp)\n            {\n                printf(\"Cannot open file\\n\");\n                if (sendstring(cli_s, \"Cannot open file\") &lt; 0) {\n                    printf(\"Error sending reply\\n\");\n                    break;\n                }\n                continue;\n            }\n\n            printf(\"File found :) \\n\");\n\n            if (sendstring(cli_s, \"OK\") &lt; 0) {\n                printf(\"Error sending reply\\n\");\n                fclose(fp);\n                break;\n            }\n\n            ret = sendfile(cli_s, fp);\n            fclose(fp);\n\n            if (ret &lt; 0) {\n                printf(\"Error sending file\\n\");\n                break;\n            }\n\n            printf(\"File sent to client\\n\");\n        }\n        while (1);\n\n        close(cli_s);   \n    } \n    while (1);\n\n    close(s);\n    return 0;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100407, "user_id": 16406, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/fadf252892475e9b177d5cd5e8b24145?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Dodd", "link": "https://stackoverflow.com/users/16406/chris-dodd"}, "is_accepted": true, "score": 2, "last_activity_date": 1472008536, "creation_date": 1472008536, "answer_id": 39113836, "question_id": 39110113, "link": "https://stackoverflow.com/questions/39110113/second-recv-call-doesnt-receive-data-halts-the-execution-in-c/39113836#39113836", "title": "Second recv call doesn&#39;t receive data, halts the execution in C", "body": "<p>The basic problem is that you're not checking the return values to see how much data you actually sent and received.  So when the client calls:</p>\n\n<pre><code>rec_msg=recv(s,msg,sizeof(msg),0);\n</code></pre>\n\n<p>it will receive up to <code>sizeof(msg)</code> (512) bytes, which is probably both the <code>OK</code> message the server is sending AND the file contents (after the NUL).  Which means when it does a second <code>recv</code> call to get the contents, it blocks, because it already read the contents in the first call and there's no more data waiting in the receive buffer.</p>\n"}], "owner": {"reputation": 21, "user_id": 4057952, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001891837818/picture?type=large", "display_name": "Kanishk Anand", "link": "https://stackoverflow.com/users/4057952/kanishk-anand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 506, "favorite_count": 0, "accepted_answer_id": 39113836, "answer_count": 3, "score": 0, "last_activity_date": 1472011044, "creation_date": 1471984012, "last_edit_date": 1472005335, "question_id": 39110113, "link": "https://stackoverflow.com/questions/39110113/second-recv-call-doesnt-receive-data-halts-the-execution-in-c", "title": "Second recv call doesn&#39;t receive data, halts the execution in C", "body": "<p>This is my client program that requests files from the server:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;strings.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;netdb.h&gt;\n\n#define SERVER_PORT 5959\n#define MAX_LINE 512\n\nvoid setstring(char *str){\n    str[MAX_LINE-1]='\\0';\n}\n\nint main(int argc, char * argv[]){\n    FILE *fp;\n    struct hostent *hp;\n    struct sockaddr_in sin;\n    char *host;\n    char filename[MAX_LINE],buf[MAX_LINE],reply[MAX_LINE],rec_line[MAX_LINE];\n    int s;\n    char msg[MAX_LINE];\n    int len,new_len,rec_file;\n    if (argc==2) {\n        host = argv[1];\n    }\n    else {\n        fprintf(stderr, \"usage: simplex-talk host\\n\");\n        exit(1);\n    }\n\n    /* translate host name into peer's IP address */\n    hp = gethostbyname(host);\n    if (!hp) {\n        fprintf(stderr, \"simplex-talk: unknown host: %s\\n\", host);\n        exit(1);\n    }\n    else\n        printf(\"Client's remote host: %s\\n\", argv[1]);\n\n    /* build address data structure */  \n    bzero((char *)&amp;sin, sizeof(sin));\n    sin.sin_family = AF_INET;\n    bcopy(hp-&gt;h_addr, (char *)&amp;sin.sin_addr, hp-&gt;h_length);\n    sin.sin_port = htons(SERVER_PORT);\n\n    /* active open */\n    if ((s = socket(PF_INET, SOCK_STREAM, 0)) &lt; 0) {\n        perror(\"simplex-talk: socket\");\n        exit(1);\n    }\n    else\n        printf(\"Client created socket.\\n\");\n\n    int send_file_name,rec_msg;\n    if (connect(s, (struct sockaddr *)&amp;sin, sizeof(sin)) &lt; 0)\n    {\n        perror(\"simplex-talk: connect\");\n        close(s);\n        exit(1);\n    }\n    else{\n        printf(\"Client connected.\\n\");\n        /* main loop: get and send lines of text */\n    printf(\"Hello from server\\n\");\n    while(!(strcmp(reply,\"bye\")==0)){\n            printf(\"Enter the file name:\\n\");\n            scanf(\"%s\",filename);\n            setstring(filename);\n            send_file_name=send(s,filename,strlen(filename)+1,0);\n            if(send_file_name&lt;0)\n                fputs(\"Error sending filename\",stdout);\n            rec_msg=recv(s,msg,sizeof(msg),0);\n            if(strcmp(msg,\"File not found\")==0)\n                printf(\"File not found\\n\");\n            else{\n                printf(\"%s\\n\",msg);\n                fp=fopen(filename,\"w\");\n                printf(\"CP1\\n\");\n                if(rec_file=recv(s,rec_line,sizeof(rec_line),0)&gt;0){\n                    printf(\"CP2\");\n                    printf(\"String recieved:%s\\n\",rec_line);\n                    if(len=fwrite(rec_line,1,rec_file+1,fp)&gt;0)\n                        printf(\"Recieved file\\n\");\n                    else\n                        printf(\"Error writing to file\\n\");\n                }\n                else\n                    printf(\"Not recieved\\n\");\n            }\n            printf(\"Enter 'bye' to terminate requesting files\\n\");\n            scanf(\"%s\",reply);\n        }\n    }\n    return 0;\n}\n</code></pre>\n\n<p>This is my server program that accepts request for files from the client:</p>\n\n<pre><code> #include &lt;stdio.h&gt;\n #include &lt;stdlib.h&gt; \n #include &lt;string.h&gt;\n #include &lt;strings.h&gt;\n #include &lt;sys/types.h&gt;\n #include &lt;sys/socket.h&gt;\n #include &lt;netinet/in.h&gt;\n #include &lt;netdb.h&gt;\n\n #define SERVER_PORT 5959\n #define MAX_PENDING 5\n #define MAX_LINE 256\n\n void setstring(char* str){\n    str[MAX_LINE-1]='\\0';\n }\n\n int main(){\n    FILE *fp;\n    struct sockaddr_in sin;\n    char buf[MAX_LINE],msg[MAX_LINE],*rec_line;\n    int len;\n    int s, new_s,count;\n    char str[INET_ADDRSTRLEN];\n    int error_file,send_msg,read_line,send_file;\n\n    bzero((char *)&amp;sin, sizeof(sin));\n    sin.sin_family = AF_INET;\n    sin.sin_addr.s_addr = inet_addr(\"0.0.0.0\");\n    sin.sin_port = htons(SERVER_PORT);\n\n    /* setup passive open */\n    if ((s = socket(PF_INET, SOCK_STREAM, 0)) &lt; 0) {\n        perror(\"simplex-talk: socket\");\n        exit(1);\n    }\n\n    inet_ntop(AF_INET, &amp;(sin.sin_addr), str, INET_ADDRSTRLEN);\n    printf(\"Server is using address %s and port %d.\\n\", str, SERVER_PORT);\n\n    if ((bind(s, (struct sockaddr *)&amp;sin, sizeof(sin))) &lt; 0) {\n        perror(\"simplex-talk: bind\");\n        exit(1);\n    }\n    else\n        printf(\"Server bind done.\\n\");\n\n    listen(s, MAX_PENDING);\n    /* wait for connection, then receive and print text */\n    while(1) {\n        if ((new_s = accept(s, (struct sockaddr *)&amp;sin, &amp;len)) &lt; 0) {\n            perror(\"simplex-talk: accept\");\n            exit(1);\n        }\n\n        printf(\"Server Listening.\\n\");\n        printf(\"Greetings\\n\");\n        int rec_file_name=recv(new_s,buf,sizeof(buf),0);\n        if(rec_file_name&gt;0)\n            printf(\"File requested:%s\\n\",buf);\n            fp=fopen(buf,\"r\");\n            if(fp==NULL)\n            {\n                fputs(\"File not found\\n\",stdout);\n                strcpy(buf,\"File not found\");\n                if(error_file=send(new_s,buf,strlen(buf)+1,0)&gt;0)\n                    fputs(\"Successfully send error message to client\\n\",stdout);\n            }\n            else{\n                bzero(buf,MAX_LINE);\n                printf(\"File found :) \\n\");\n                strcpy(buf,\"OK\");\n                if(send_msg=send(new_s,buf,strlen(buf)+1,0)&gt;0)\n                    fputs(\"File found message sent to client\\n\",stdout);\n\n                fseek(fp,0,SEEK_END);\n                int file_size=ftell(fp);\n                fseek(fp,0,SEEK_SET);\n                printf(\"File size:%d\\n\",file_size);\n                rec_line=(char *)malloc(sizeof(char)*(file_size));\n                read_line=fread(rec_line,1,file_size+1,fp);\n                printf(\"File read: %s\\n\",rec_line);\n\n                if(send_file=send(new_s,rec_line,strlen(rec_line)+1,0)&gt;0)\n                    printf(\"File string sent to client\\n\");\n            }\n        }\n\n        close(new_s);   \n    } \n</code></pre>\n\n<p>The problem is that in the client, my second <code>recv()</code> call, where it is supposed to receive the contents of a file, shows nothing.  The programs halts at that point, but the server programs displays that it has sent the file contents.  The client doesn't receive it.</p>\n"}, {"tags": ["c", "linux", "performance", "memory-management"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471985094, "post_id": 39110026, "comment_id": 65568109, "body": "What worth would the amount of swapped memory be? There is no simple relation between performance and swapped memory on Linux. Worse: it is not under control of the program whether its pages are actually swapped. What does it tell you about a program if another program uses more RAM than available?"}, {"owner": {"reputation": 323, "user_id": 3108787, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e104f53d6d6b601c9d357a654429ea81?s=128&d=identicon&r=PG&f=1", "display_name": "anthozep", "link": "https://stackoverflow.com/users/3108787/anthozep"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471985608, "post_id": 39110026, "comment_id": 65568362, "body": "I was thinking more about the rate at which a process is swapping. However, I see what you&#39;re saying, swapping isn&#39;t necessarily detrimental. I suppose a better question is how can I tell if a process or cgroup is causing thrash?"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471988208, "post_id": 39110026, "comment_id": 65569582, "body": "As I already wrote: it is <b>not</b> the process which is swapping, but the OS! The conditions are not under control of the process. Heck, Linux even swapps if there <b>is</b> enough RAM if it thinks buffers are more important. And most of the time it is right."}], "owner": {"reputation": 323, "user_id": 3108787, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e104f53d6d6b601c9d357a654429ea81?s=128&d=identicon&r=PG&f=1", "display_name": "anthozep", "link": "https://stackoverflow.com/users/3108787/anthozep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1471983602, "creation_date": 1471983602, "question_id": 39110026, "link": "https://stackoverflow.com/questions/39110026/program-to-calculate-how-much-a-process-is-swapping-in-linux", "title": "Program to calculate how much a process is swapping in linux", "body": "<p>I have been working on several small C programs to measure system performance and utilization. Calculating things like CPU utilization seems to be fairly easy, but now I'm working on a way to assign different processes a \"score\" based on how much they are swapping, or being swapped.</p>\n\n<p>Basically, I'm trying to see which process might be causing the system to thrash.</p>\n\n<p>I'm looking into using cgroups, specifically the <code>/sys/fs/cgroup/memory/.../memory.stat</code> file. Cgroups are ubiquitous in my environment. These are the fields available to me:</p>\n\n<pre><code>cache 997203968\nrss 4679643136\nmapped_file 494514176\npgpgin 454901845\npgpgout 453515896\npgfault 741229338\npgmajfault 250671\ninactive_anon 74235904\nactive_anon 4605407232\ninactive_file 815894528\nactive_file 181309440\nunevictable 0\nhierarchical_memory_limit 9223372036854775807\ntotal_cache 997203968\ntotal_rss 4679643136\ntotal_mapped_file 494514176\ntotal_pgpgin 454901845\ntotal_pgpgout 453515896\ntotal_pgfault 741229338\ntotal_pgmajfault 250671\ntotal_inactive_anon 74235904\ntotal_active_anon 4605407232\ntotal_inactive_file 815894528\ntotal_active_file 181309440\ntotal_unevictable 0\n</code></pre>\n\n<p>I was thinking I could sample the pgpgout field over a few seconds and see how much a process is swapping. I want to assign a score based on which processes are the worst offenders. Any other suggestions are welcome!</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 446, "user_id": 888624, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/392039c3c5ee1f883b68b52edf8413bf?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/888624/chris"}, "edited": false, "score": 6, "creation_date": 1471980726, "post_id": 39109280, "comment_id": 65565932, "body": "Your <code>uname</code> and <code>passwd</code>variables are single characters. What you really want are char arrays."}, {"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 1, "creation_date": 1471980901, "post_id": 39109280, "comment_id": 65566007, "body": "Your question needs a title that reflects what you&#39;re asking about. &quot;How do I deal with this?&quot; doesn&#39;t tell us anything."}, {"owner": {"reputation": 2432, "user_id": 793716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06452b91c9651f991d26d28ba873e760?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/793716/rob"}, "edited": false, "score": 2, "creation_date": 1471980927, "post_id": 39109280, "comment_id": 65566019, "body": "Also if you want to compare string you need to use strcmp(uname, &quot;waw&quot;) == 0,  not == directly otherwise you are comparing a char (integer) with a pointer to a array of characters &quot;waw&quot; or &quot;wow&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 88126, "user_id": 1329652, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/fa4ef026ee4be15d3dbacc95f1773d03?s=128&d=identicon&r=PG&f=1", "display_name": "Kuba hasn&#39;t forgotten Monica", "link": "https://stackoverflow.com/users/1329652/kuba-hasnt-forgotten-monica"}, "edited": false, "score": 0, "creation_date": 1471981160, "post_id": 39109378, "comment_id": 65566133, "body": "Please clarify that <code>MAX_LENGTH_UNAME</code> isn&#39;t a divine revelation but an integer constant that the op should define."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1471981366, "post_id": 39109378, "comment_id": 65566233, "body": "<code>char *</code> are <b>not</b> strings (and they are also not arrays)! C does not have a string type. And as you <code>malloc</code> the buffers with a fixed size anyway, there is no reason to use <code>malloc</code>, but just use arrays. Also your code is prone to undefined behaviour."}, {"owner": {"reputation": 88126, "user_id": 1329652, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/fa4ef026ee4be15d3dbacc95f1773d03?s=128&d=identicon&r=PG&f=1", "display_name": "Kuba hasn&#39;t forgotten Monica", "link": "https://stackoverflow.com/users/1329652/kuba-hasnt-forgotten-monica"}, "edited": false, "score": 0, "creation_date": 1471981491, "post_id": 39109378, "comment_id": 65566302, "body": "Prefer a<code>static const int</code> to a <code>#define</code>. There&#39;s no reason to use these macros unless the compiler is completely backwards."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 88126, "user_id": 1329652, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/fa4ef026ee4be15d3dbacc95f1773d03?s=128&d=identicon&r=PG&f=1", "display_name": "Kuba hasn&#39;t forgotten Monica", "link": "https://stackoverflow.com/users/1329652/kuba-hasnt-forgotten-monica"}, "edited": false, "score": 0, "creation_date": 1472009357, "post_id": 39109378, "comment_id": 65574824, "body": "@KubaOber: This is C, not C++.  Using a <code>static const int</code> would make the arrays into VLAs \u2014 variable length arrays.  That&#39;s not appropriate.  In C, the better choice is normally <code>enum</code>.  See also <a href=\"http://stackoverflow.com/questions/1674032/\">&quot;<code>static const</code> vs &quot;<code>#define</code>&quot; vs &quot;<code>enum</code>&quot;</a>."}], "tags": [], "owner": {"reputation": 4751, "user_id": 5649326, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/a82Se.jpg?s=128&g=1", "display_name": "Marievi", "link": "https://stackoverflow.com/users/5649326/marievi"}, "is_accepted": false, "score": 0, "last_activity_date": 1471981529, "last_edit_date": 1471981529, "creation_date": 1471980974, "answer_id": 39109378, "question_id": 39109280, "link": "https://stackoverflow.com/questions/39109280/how-do-i-deal-with-string-input-in-c/39109378#39109378", "title": "How do I deal with string input in C?", "body": "<p>First of all, you have declared <code>uname</code> and <code>passwd</code> as single characters, but you want to read strings. So you need to define the maximum length for each one and declare them as following:</p>\n\n<pre><code>char [X] uname;     //where X is the maximum length for uname, for instance 25\nchar [Y] passwd;   //where Y is the maximum length for passwd, for instance 20\n</code></pre>\n\n<p>Accordingly, your <code>scanf()</code> function should then be modified to :</p>\n\n<pre><code>scanf(\"%s\", uname);\nscanf(\"%s\", passwd);\n</code></pre>\n\n<p>Apart from that, you need <code>strcmp()</code> to compare a string with a value. Change your <code>if</code> statement to :</p>\n\n<pre><code>if ( (strcmp(uname, \"waw\") == 0) &amp;&amp; (strcmp(passwd, \"wow\") == 0) ) {\n   printf(\"You have logged in\\n\");\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61, "user_id": 6749438, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cm3aqiQfR_c/AAAAAAAAAAI/AAAAAAAAAcY/9xbt76NFwKA/photo.jpg?sz=128", "display_name": "francis kyle flores", "link": "https://stackoverflow.com/users/6749438/francis-kyle-flores"}, "edited": false, "score": 0, "creation_date": 1472012055, "post_id": 39109415, "comment_id": 65575437, "body": "thanks sir your knowledge really helped to understand c for a bit"}], "tags": [], "owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "is_accepted": false, "score": 4, "last_activity_date": 1471982039, "last_edit_date": 1471982039, "creation_date": 1471981164, "answer_id": 39109415, "question_id": 39109280, "link": "https://stackoverflow.com/questions/39109280/how-do-i-deal-with-string-input-in-c/39109415#39109415", "title": "How do I deal with string input in C?", "body": "<p>1) Don't read (scan) into a char. You need a string. Use format specifier %s instead of %c</p>\n\n<p>2) Use strcmp to compare string values</p>\n\n<p>Try this:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(){\n   int res;\n   char uname[40];   // char arrays instead of single char\n   char passwd[40];\n\n   printf(\"Enter your username: \");\n   res = scanf(\"%39s\", uname);  // Set a maximum number of chars to read to\n                                // 39 to avoid overflow\n   if (res != 1) exit(1);       // Error on stdin. End program\n\n   printf(\"Enter your password: \");\n   res = scanf(\"%39s\", passwd);\n   if (res != 1) exit(1); // Error on stdin\n\n   printf(\" \\n\");\n\n   // Use strcmp to compare values of two strings.\n   // If strcmp returns zero, the strings are identical\n   if ((strcmp(uname, \"waw\") == 0) &amp;&amp; (strcmp(passwd, \"wow\") == 0)){\n       printf(\"You have logged in\\n\");\n   } else{\n       printf(\"Failed, please try again\\n\");\n   }\n   return 0;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61, "user_id": 6749438, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cm3aqiQfR_c/AAAAAAAAAAI/AAAAAAAAAcY/9xbt76NFwKA/photo.jpg?sz=128", "display_name": "francis kyle flores", "link": "https://stackoverflow.com/users/6749438/francis-kyle-flores"}, "edited": false, "score": 0, "creation_date": 1472011930, "post_id": 39110395, "comment_id": 65575405, "body": "Thanks for the answer and also so sorry for the late response... and again thank you for this solves my question!"}, {"owner": {"reputation": 7405, "user_id": 5735010, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/znAEN.jpg?s=128&g=1", "display_name": "abhiarora", "link": "https://stackoverflow.com/users/5735010/abhiarora"}, "reply_to_user": {"reputation": 61, "user_id": 6749438, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cm3aqiQfR_c/AAAAAAAAAAI/AAAAAAAAAcY/9xbt76NFwKA/photo.jpg?sz=128", "display_name": "francis kyle flores", "link": "https://stackoverflow.com/users/6749438/francis-kyle-flores"}, "edited": false, "score": 0, "creation_date": 1472012598, "post_id": 39110395, "comment_id": 65575579, "body": "You can upvote if it helped. And marked one of the answer that helped you."}], "tags": [], "owner": {"reputation": 7405, "user_id": 5735010, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/znAEN.jpg?s=128&g=1", "display_name": "abhiarora", "link": "https://stackoverflow.com/users/5735010/abhiarora"}, "is_accepted": true, "score": 1, "last_activity_date": 1471985791, "last_edit_date": 1471985791, "creation_date": 1471985252, "answer_id": 39110395, "question_id": 39109280, "link": "https://stackoverflow.com/questions/39109280/how-do-i-deal-with-string-input-in-c/39110395#39110395", "title": "How do I deal with string input in C?", "body": "<p>There is no <code>string</code> data type in C programming language. Strings in C are represented as <code>array of characters</code>. </p>\n\n<p>In C, <code>char</code> is a data type to represent a character. So, all you need to do is declare a <code>array of char data type</code> to represent a string in C. Each element in that array will hold a character of your string. </p>\n\n<p>Also, operators in C like <code>==, !=, +=, +</code> are defined for <code>build-in data types</code> in C and since, there is no operator overloading in C, you can't use these operators with your C-String as C-Strings are not build-in data type in C programming language. </p>\n\n<p><strong>Note: C-Strings are actually Null-terminated array of char data types. That means, last character in any C-String in C will be used to store a Null Character <code>('\\0')</code> which marks the end of the string.</strong></p>\n\n<p>The Header file <code>&lt;string.h&gt;</code> has predefined functions that you can use to operate on C-String(Null-terminated array of char data type). You can read more about it over <a href=\"https://www.cs.cf.ac.uk/Dave/C/node19.html\" rel=\"nofollow\">here</a>.</p>\n\n<p>So, your program should look like:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\n#define CSTR_MAX_LEN 100\nint main()\n{\n    char uname[CSTR_MAX_LEN+1];   //An extra position to store Null Character if 100 characters are to be stored in it.\n    char passwd[CSTR_MAX_LEN+1];\n\n    printf(\"Enter your username: \");\n    scanf(\"%s\", uname); \n\n\n    printf(\"Enter your password: \");\n    scanf(\"%s\", passwd);\n\n    // Use strcmp to compare values of two strings.\n    // If strcmp returns zero, the strings are identical\n    if ((strcmp(uname, \"waw\") == 0) &amp;&amp; (strcmp(passwd, \"wow\") == 0)){\n         printf(\"You have logged in\\n\");\n    } else{\n         printf(\"Failed, please try again\\n\");\n    }\n    return 0;\n }\n</code></pre>\n\n<p>Remember, the correct format specifier to handle C-Strings are <code>%s</code> in C programming language. So, i have to change your <code>scanf()</code> function call. Also, i have used <code>strcmp()</code> function which is declared in header file <code>&lt;string.h&gt;</code> (i have included this header file in the above program). It returns numeric zero if strings match. You can read more about it above <a href=\"http://www.cplusplus.com/reference/cstring/strcmp/\" rel=\"nofollow\">here</a>. Also, have a look at <code>strncmp()</code> which is safer version of <code>strcmp()</code>. Also, remember that it can lead to <code>undefined behavior</code> if you try to access any array out of it's bound. So, it would be good idea to include checking in your program. As, someone included in their answer you can change my <code>scanf()</code> function call to:</p>\n\n<pre><code>scanf(\"%100s\", uname);\n</code></pre>\n\n<p>It avoids to read more than 100 characters in array <code>uname</code> as it is allocated only to store 100 characters(excluding the Null character).</p>\n"}, {"tags": [], "owner": {"reputation": 91, "user_id": 4597091, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/377e31cca560431f5074b8336aa7f4c6?s=128&d=identicon&r=PG", "display_name": "archimedes", "link": "https://stackoverflow.com/users/4597091/archimedes"}, "is_accepted": false, "score": 1, "last_activity_date": 1472037793, "creation_date": 1472037793, "answer_id": 39121986, "question_id": 39109280, "link": "https://stackoverflow.com/questions/39109280/how-do-i-deal-with-string-input-in-c/39121986#39121986", "title": "How do I deal with string input in C?", "body": "<p>This is how you can do it with <a href=\"https://github.com/spitstec/milkstrings\" rel=\"nofollow\">milkstrings</a></p>\n\n<pre><code>tXt ask(tXt prmp) {\n  printf(\"%s ?\",prmp) ;\n  return(txtFromFile(stdin)) ; }\n\n\n\nvoid main(void) {\n  tXt user = ask(\"user\") ;\n  if ( strcmp(txtConcat(user,\"/\",ask(\"password\"),NULL),\"waw/wow\") == 0)\n    printf(\"You have logged in\\n\"); \n  else\n    printf(\"Failed, please try again\\n\");\n}\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 6749438, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cm3aqiQfR_c/AAAAAAAAAAI/AAAAAAAAAcY/9xbt76NFwKA/photo.jpg?sz=128", "display_name": "francis kyle flores", "link": "https://stackoverflow.com/users/6749438/francis-kyle-flores"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 39110395, "answer_count": 4, "score": 2, "last_activity_date": 1472037793, "creation_date": 1471980602, "last_edit_date": 1471981352, "question_id": 39109280, "link": "https://stackoverflow.com/questions/39109280/how-do-i-deal-with-string-input-in-c", "title": "How do I deal with string input in C?", "body": "<p>I'm just practicing C and I would like to make a simple Login program with a username and a password... here is my code:</p>\n\n<pre><code>int main(){\n   char uname, passwd;\n\n   printf(\"Enter your username: \");\n   scanf(\"%c\", uname);\n   printf(\"Enter your password: \");\n   scanf(\"%c\", passwd);\n\n   printf(\" \\n\");\n\n   if (uname == \"waw\" &amp;&amp; passwd == \"wow\"){\n      printf(\"You have logged in\\n\");\n   } else {\n      printf(\"Failed, please try again\\n\");\n   }\n   return 0;\n}\n</code></pre>\n\n<p>And then I got this error when I try to compile it</p>\n\n<pre><code>log.c: In function \u2018main\u2019:\nlog.c:7:10: warning: format \u2018%c\u2019 expects argument of type \u2018char *\u2019, but     argument 2 has type \u2018int\u2019 [-Wformat=]\n    scanf(\"%c\", uname);\n          ^\nlog.c:9:10: warning: format \u2018%c\u2019 expects argument of type \u2018char *\u2019, but     argument 2 has type \u2018int\u2019 [-Wformat=]\n    scanf(\"%c\", passwd);\n          ^\nlog.c:13:14: warning: comparison between pointer and integer\n    if (uname == \"waw\" &amp;&amp; passwd == \"wow\"){\n              ^\nlog.c:13:33: warning: comparison between pointer and integer\n    if (uname == \"waw\" &amp;&amp; passwd == \"wow\"){\n                                 ^\n</code></pre>\n"}, {"tags": ["c", "glibc", "mkfifo"], "comments": [{"owner": {"reputation": 42370, "user_id": 3980929, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xyKrD.png?s=128&g=1", "display_name": "Rakete1111", "link": "https://stackoverflow.com/users/3980929/rakete1111"}, "edited": false, "score": 1, "creation_date": 1471978059, "post_id": 39108574, "comment_id": 65564560, "body": "So, C or C++. I would say C, but that&#39;s your call. Please choose <i>one</i> language, not 2 (your question doesn&#39;t seem to apply to different languages)."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 2, "creation_date": 1471978081, "post_id": 39108574, "comment_id": 65564570, "body": "There is no language C/C++, but the two <b>different</b> languages C and C++. Pick <b>one</b> of them."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471978193, "post_id": 39108574, "comment_id": 65564628, "body": "What does the debugger say?"}, {"owner": {"reputation": 33, "user_id": 6749234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/128994cf51398ef1b184c19c85dd0005?s=128&d=identicon&r=PG&f=1", "display_name": "daniel.kish", "link": "https://stackoverflow.com/users/6749234/daniel-kish"}, "edited": false, "score": 0, "creation_date": 1471978323, "post_id": 39108574, "comment_id": 65564706, "body": "I chose C). I didn&#39;t use debugger, it&#39;s a shame but I don&#39;t know how to use gdb and I don&#39;t have an IDE installed right now (it&#39;s just a VM with Ubuntu 14.04)"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1471978326, "post_id": 39108574, "comment_id": 65564709, "body": "<code>if (mkfifo (&quot;myfifo&quot;, 0600) != 0)</code> is using an octal value, 384 decimal, if that is relevant."}, {"owner": {"reputation": 33, "user_id": 6749234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/128994cf51398ef1b184c19c85dd0005?s=128&d=identicon&r=PG&f=1", "display_name": "daniel.kish", "link": "https://stackoverflow.com/users/6749234/daniel-kish"}, "edited": false, "score": 0, "creation_date": 1471978391, "post_id": 39108574, "comment_id": 65564739, "body": "I sincerely admit that don&#39;t know what exactly 0600 means but it&#39;s supposed to work since everybody I read use that value. And yes I know it&#39;s an octal value."}, {"owner": {"reputation": 532, "user_id": 4520911, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uzPkX.png?s=128&g=1", "display_name": "iRove", "link": "https://stackoverflow.com/users/4520911/irove"}, "edited": false, "score": 0, "creation_date": 1471978447, "post_id": 39108574, "comment_id": 65564775, "body": "You yourself don&#39;t understand the code <i>you</i> wrote?"}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1471978798, "post_id": 39108574, "comment_id": 65564929, "body": "@daniel.kish <code>man 2 umask</code>. should fill you in on the relevance of that value."}, {"owner": {"reputation": 698, "user_id": 6697083, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zwg0f.png?s=128&g=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/6697083/riley"}, "edited": false, "score": 0, "creation_date": 1471981722, "post_id": 39108574, "comment_id": 65566414, "body": "That while loop in the reader looks like it would be better as a for loop. That doesn&#39;t help your problem, but it makes the code more clear."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472073833, "post_id": 39108574, "comment_id": 65611830, "body": "regarding <code>0600</code>  this is the permissions for the fifo node.  it says <code>octal</code>, <code>owner=read&#47;write</code>, <code>group=no permissions</code>, <code>world=no permissions</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472073933, "post_id": 39108574, "comment_id": 65611873, "body": "in the writer code, this line: <code>int r = write (fd, msg, len);</code> is not quite correct.  the function: <code>write()</code> returns a <code>ssize_t</code>, not an <code>int</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472074036, "post_id": 39108574, "comment_id": 65611920, "body": "when the call to <code>mkfifo()</code> fails, there is no reason to continue with the code execution after outputting the error message, so the call to <code>perror()</code> should be followed by a call to <code>exit( EXIT_FAILURE );</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472074322, "post_id": 39108574, "comment_id": 65612055, "body": "the call to <code>mkfifo()</code> will fail, with error code <code>EEXIST</code> when the fifo already exists.  Strongly suggest 1) check for failure 2) delete the fifo file after all communication is completed"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472074559, "post_id": 39108574, "comment_id": 65612171, "body": "the reader code is missing the statement: <code>#include &lt;unistd.h&gt;</code>, so the functions: <code>read()</code> and <code>write()</code> are not defined"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472074784, "post_id": 39108574, "comment_id": 65612247, "body": "when this line evaluates to &#39;true&#39; <code>if (r == -1)</code>, then is followed by all call to <code>perror()</code>, it needs a following statement: <code>exit( EXIT_FAILURE );</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472074946, "post_id": 39108574, "comment_id": 65612303, "body": "a fifo has no concept of records, it is just a stream of bytes, so the code needs to implement a check that a full record was read, and if not, try to read the rest of the record.    And the code needs to call <code>close(fd);</code> when done reading the fifo"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472075075, "post_id": 39108574, "comment_id": 65612352, "body": "for ease of readability and understanding, 1) use meaningful variable names.  <code>r</code> is NOT a meaningful variable name.  2) separate code blocks (for, if, else, while, do...while, switch, case, default) via a blank line"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472075160, "post_id": 39108574, "comment_id": 65612386, "body": "when compiling, always enable all the warnings, then fix those warnings. (for <code>gcc</code>, at a minimum use: <code>-Wall -Wextra -pedantic</code>   I also use: <code>-Wconversion -std=gnu99</code> )"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472075330, "post_id": 39108574, "comment_id": 65612463, "body": "the code contains some &#39;magic&#39; numbers.  &#39;magic&#39; numbers are numbers with no basis.  in this case, 10 and 50.   Strongly suggest using an <code>enum</code> statement or <code>#define</code> statements to give those &#39;magic&#39; numbers meaningful names, then use those meaningful names throughout the code"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1472075469, "post_id": 39108574, "comment_id": 65612526, "body": "in modern C, when the <code>main()</code> function has no &#39;return 0;` statement at the end, the compiler will automatically cause a return of 0, so no longer necessary to have the <code>return 0;</code> statement at the end"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 6749234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/128994cf51398ef1b184c19c85dd0005?s=128&d=identicon&r=PG&f=1", "display_name": "daniel.kish", "link": "https://stackoverflow.com/users/6749234/daniel-kish"}, "edited": false, "score": 0, "creation_date": 1471980376, "post_id": 39108857, "comment_id": 65565765, "body": "Alright, now i&#39;ve specified a signal handler for SIGPIPE and everything seems to work. Thanks."}], "tags": [], "owner": {"reputation": 106438, "user_id": 1275169, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4c6dbda4e65af6d2ceaabdfad538b319?s=128&d=identicon&r=PG&f=1", "display_name": "P.P", "link": "https://stackoverflow.com/users/1275169/p-p"}, "is_accepted": true, "score": 1, "last_activity_date": 1471978994, "creation_date": 1471978994, "answer_id": 39108857, "question_id": 39108574, "link": "https://stackoverflow.com/questions/39108574/reader-process-termination-on-fifo-file-closing/39108857#39108857", "title": "Reader-process termination on FIFO-file closing", "body": "<p>When the exits (after 10 iterations), the writer receives a <code>SIGPIPE</code> due to the read end being closed. So, the default action for the signal <code>SIGPIPE</code> is executed which to terminate the program. That's why you don't see the final printf() is not executed.</p>\n\n<p>Instead you could ignore (<code>SIG_IGN</code>) the signal <code>SIGPIPE</code> in the writer by calling <code>sigaction()</code> and then handle the write error yourself.</p>\n"}], "owner": {"reputation": 33, "user_id": 6749234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/128994cf51398ef1b184c19c85dd0005?s=128&d=identicon&r=PG&f=1", "display_name": "daniel.kish", "link": "https://stackoverflow.com/users/6749234/daniel-kish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 402, "favorite_count": 0, "accepted_answer_id": 39108857, "answer_count": 1, "score": 1, "last_activity_date": 1471979062, "creation_date": 1471977895, "last_edit_date": 1471979062, "question_id": 39108574, "link": "https://stackoverflow.com/questions/39108574/reader-process-termination-on-fifo-file-closing", "title": "Reader-process termination on FIFO-file closing", "body": "<p>I've written a simple reader-writer pair of programs. Writer creates/opens a FIFO-file and is constantly writing a string into it. The reader is just reading it and writing to stdout. The reader does so only for 10 times and then quits. Surprisingly (for me) the writer almost immediately exits too. It does not just go out of writing loop, it seems to jump out of it, I can tell it by not seeing the final \"byebye\" on the screen. I could sort of accept such behaviour, but I still can't understand why.\nCould someone please kindly share their knowledge with me?</p>\n\n<pre><code>/* writer code */\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;unistd.h&gt;\n\nint main()\n{\n    char msg [] = \"Leo_Tolstoy\";\n\n    size_t len = strlen(\"Leo_Tolstoy\");\n\n    if (mkfifo (\"myfifo\", 0600) != 0) {\n        perror (\"creating fifo\");\n    }\n    int fd;\n    if ( (fd = open (\"myfifo\", O_WRONLY)) == -1) {\n        perror (\"opening fifo\");\n        exit (1);\n    }\n    while (1)\n    {\n        int r = write (fd, msg, len);\n        if (r == -1)\n            perror (\"writing\");\n        sleep(1);\n    }\n    printf (\"byebye\\n\");\n    close (fd);\n    return 0;\n}\n/* reader code */\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;sys/shm.h&gt;\n\nint main()\n{\n    char buf[50];\n\n    printf (\"bef opening\\n\");\n    int fd = open (\"myfifo\", O_RDONLY);\n    if (fd == -1) {\n        perror (\"opening fifo\");\n        exit (1);\n    }\n\n    printf (\"bef reading\\n\");\n    int cnt=0;\n    while (cnt &lt; 10)\n    {\n        int r = read (fd, buf, 50);\n        if (r == 0)\n            break;\n        if (r == -1)\n            perror (\"reading\");\n        write (1, buf, r);\n        cnt++;\n    }\n//  close (fd);\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["matlab", "c", "moving-average"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1471979911, "post_id": 39109043, "comment_id": 65565522, "body": "Start using self-explaining names (to post here preferably in English). Single-character macros like <code>m</code> at file-level are a no-go (and lowercase names anyway). Then split the wall of code into functions to get a better overview. Finally debug the code. We are not a debugging service. See <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>!"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1472004847, "post_id": 39109043, "comment_id": 65573899, "body": "Note: <code>int main() { ... return;</code> is a minor problem."}], "answers": [{"comments": [{"owner": {"reputation": 342, "user_id": 6437471, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/q4sUu.png?s=128&g=1", "display_name": "Mutante", "link": "https://stackoverflow.com/users/6437471/mutante"}, "edited": false, "score": 1, "creation_date": 1471985673, "post_id": 39109325, "comment_id": 65568398, "body": "Sultan, using your answer, the moving average get&#39;s correctly in the end of the signal, but in the beggining of the signal still an interference. I try to debug the code but i didn&#39;t find the problem. I will update a screen to you see in the original post. Maybe you know what&#39;s happening."}], "tags": [], "owner": {"reputation": 148, "user_id": 6732432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79d7480cfbb04061a580aed28b1e240?s=128&d=identicon&r=PG&f=1", "display_name": "Sultan", "link": "https://stackoverflow.com/users/6732432/sultan"}, "is_accepted": false, "score": 3, "last_activity_date": 1471983147, "last_edit_date": 1471983147, "creation_date": 1471980790, "answer_id": 39109325, "question_id": 39109043, "link": "https://stackoverflow.com/questions/39109043/moving-average-in-c-language/39109325#39109325", "title": "Moving Average in C Language", "body": "<p>There are a few issues with your main signal processing loop.</p>\n\n<pre><code>for (i=0; i &lt; itera; i++) {\n    y[0] = x[i];\n    aux=0;\n    for (n=0; n&lt;m; n++){\n        aux += coef[n] * y[n];\n    }\n    saida[i]=aux;\n    for (n=m; n &lt;2; n--){\n        x[n] = x[n-1];\n    }\n}\n</code></pre>\n\n<p>Every element of your coef array is the same, so you may as well make it a single constant value of 1.0 / m. For the y array, you are not setting any of its elements apart from the first. Thus your loop adds a constant multiplied by an uninitialized value 16 times over to aux. This is what produces the garbage output. I'm not sure what your (n=m; n &lt;2; n--) loop is supposed to do, but it will never even run since m > 2.</p>\n\n<p>A (inefficient) simple moving average would look something more like this:</p>\n\n<pre><code>for (i = 0; i &lt; itera - m; i++) {\n    aux = 0;\n    for (n = 0; n &lt; m; n++){\n        aux += x[i+n];\n    }\n    saida[i] = aux * (1.0 / m);\n}\n</code></pre>\n\n<p>A more efficient version could avoid repeatedly processing intermediate elements, and instead just add the new number entering the sliding window and subtract the old number leaving the window each iteration. If dealing with floating point numbers, care would have to be taken with numerical stability when handling ill conditioned numbers etc, but that's a whole different problem that you don't have to concern yourself about for now.</p>\n"}], "migrated_from": {"other_site": {"aliases": ["http://signals.stackexchange.com"], "markdown_extensions": ["MathJax"], "launch_date": 1447708127, "open_beta_date": 1315343961, "closed_beta_date": 1313521200, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/dsp/Img/apple-touch-icon@2.png", "twitter_account": "StackSignals", "favicon_url": "https://cdn.sstatic.net/Sites/dsp/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/dsp/Img/apple-touch-icon.png", "audience": "practitioners of the art and science of signal, image and video processing", "site_url": "https://dsp.stackexchange.com", "api_site_parameter": "dsp", "logo_url": "https://cdn.sstatic.net/Sites/dsp/Img/logo.png", "name": "Signal Processing", "site_type": "main_site"}, "on_date": 1471979646, "question_id": 33836}, "owner": {"reputation": 342, "user_id": 6437471, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/q4sUu.png?s=128&g=1", "display_name": "Mutante", "link": "https://stackoverflow.com/users/6437471/mutante"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5825, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1471985811, "creation_date": 1471976840, "last_edit_date": 1471985811, "question_id": 39109043, "link": "https://stackoverflow.com/questions/39109043/moving-average-in-c-language", "title": "Moving Average in C Language", "body": "<p>I am trying to do a moving average filter in C language, I've adapted a matlab program that works correctly, the input of my filter is a .pcm archive (a sweep audio signal), the problem to me is the output archive of the moving average in C language, the output goes wrong, the signal only decreases along the time (don't filtter).</p>\n\n<p>Below My C code: </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n\n\n#define m 16  // MEDIA LENGTH\n\nint main()\n{\n    short *x;                              // X VECTOR = 0\n    double coef[m];                           // COEF VECTOR = 0\n    int i;                                  // FOR COUNT VARIABLE\n    int n;                                  // FOR COUNT VARIABLE\n    int itera;                              // LENGTH OF THE INPUT FILE\n    double aux;                                // AUX VARIABLE TO MAKE THE SUM\n    double *y;                              // AUX VECTOR TO RECEIVE X VECTOR\n    double *saida;                          // OUTPUT VECTOR\n    FILE *arq;                                 // POINTER TO THE FILE\n\n    for (i = 0; i &lt; m; i++) {\n        coef[i] = 1.0/m;\n    }\n    arq = fopen(\"sweep_100_3400.pcm\", \"rb\");\n    if (arq == NULL)\n    {\n        printf(\"ERROR WHILE OPENING THE FILE\\n\");\n        return;\n    }\n    // compute size of file\n    fseek(arq,0,SEEK_END);\n    itera = ftell(arq)/sizeof(short);\n    rewind(arq);\n\n    // alloc mem for x, read the vector from input file\n    x = malloc(itera*sizeof(short));\n    fread(x,sizeof(short),itera,arq);\n    fclose(arq);\n    // alloc mem for y\n\n    y = malloc(itera*sizeof(double));\n    saida = malloc(itera*sizeof(double));\n\n    for (i=0; i &lt; itera; i++) {\n        y[0] = x[i];\n        aux=0;\n        for (n=0; n&lt;m; n++){\n            aux += coef[n] * y[n];\n        }\n        saida[i]=aux;\n        for (n=m; n &lt;2; n--){\n            x[n] = x[n-1];\n        }\n    }\n    arq=fopen(\"saida_medial_movel_c.pcm\",\"wb\");\n    fwrite(saida, sizeof(double),itera,arq);\n    fclose(arq);\n    free(saida);\n    free(y);\n    free(x);\n}\n</code></pre>\n\n<p>The image below is the output of the matlab program to moving average with length 16:</p>\n\n<p><a href=\"https://i.stack.imgur.com/aD79R.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/aD79R.png\" alt=\"enter image description here\"></a></p>\n\n<p>This image is the output in C language with moving average with length 16:</p>\n\n<p><a href=\"https://i.stack.imgur.com/iEIu6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/iEIu6.png\" alt=\"enter image description here\"></a></p>\n\n<p>Someone knows what may be?</p>\n\n<p>Below the code in matlab, that I've adapted:</p>\n\n<pre><code>%MOVING AVERAGE EXAMPLE SCRIPT\nclear all;\nclose all;\nclc;\n% DEFINES MEDIA LENGTH\nm = 16;\n%VECTOS EQUAL ZERO\nx = zeros (m,1); \ncoef = zeros (m,1);\n%INITIALIZE VECTOR \nfor j = 1 : m,\n        coef (j,1) = 1/m;\nend\n%READ INPUT FILE\nfid = fopen ('sweep_100_3400.pcm','rb');\ns = fread (fid, 'int16');\nfclose(fid);\nsubplot(2,1,1);\nplot(s);\ngrid on;\ntitle('ENTRADA DO FILTRO');\n%PROCESS\nitera = length(s);\nsav_y = zeros (itera, 1);\n%EXECUTE PROCESS\nfor j = 1 : itera,\n    x(1,1) = s (j,1);\n    %PRODUCTS SUM\n    y=0;\n    for n = 1 : m,\n        y = y + coef(n,1) * x(n,1);\n    end\n    sav_y(j,1) = y;\n    %SHIFT THE VECTOR\n    for n = m: -1 : 2,\n        x (n,1) = x(n-1,1);\n    end \nend \n%PLOT OUTPUT\nsubplot (2,1,2);\nplot (sav_y);\ngrid on;\ntitle('SA\u00cdDA DO FLITRO');\n%SAVE THE OUTPUT IN ANOTHER FILE\nfid = fopen('saida_mm_manual.pcm','wb');\nfwrite(fid,sav_y,'int16');\nfclose(fid);\n</code></pre>\n\n<hr>\n\n<p>Update 1 (Using the answer above):</p>\n\n<p><a href=\"https://i.stack.imgur.com/gW0eP.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/gW0eP.png\" alt=\"enter image description here\"></a></p>\n\n<p>The begining of the signal still with interference, but from the middle to the end of the signal is correctly.</p>\n"}, {"tags": ["c", "file", "debugging", "ssl", "wireshark"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1471976690, "post_id": 39108198, "comment_id": 65563817, "body": "Any reason you <code>fflush</code> a newly opened file? And where is your error-checking? What does the debugger say? What does &quot;I am still not able ...&quot; mean?"}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1471977588, "post_id": 39108198, "comment_id": 65564306, "body": "After the fopen, add a <code>fprintf(stderr, &quot;f=%p\\n&quot;, f);</code> line. Does it display a sensible address, or 0, or nothing?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1471977722, "post_id": 39108198, "comment_id": 65564368, "body": "I hope you declared the <code>FILE</code> pointer as <code>*f</code> and not, as you say, <code>f</code>."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1471979202, "post_id": 39108198, "comment_id": 65565150, "body": "@MarkPlotnick: Why not use the debugger? And adding a proper <b>permanent</b> check with error handling is the way to go, not <code>printf</code> debugging."}, {"owner": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "edited": false, "score": 0, "creation_date": 1471980022, "post_id": 39108198, "comment_id": 65565585, "body": "You didn&#39;t test if <code>open</code> worked successfully, it may happen that the working directory of the process is protected."}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471980384, "post_id": 39108198, "comment_id": 65565769, "body": "@Olaf By all means, good error handling, with a Qt popup window, should be added in the fullness of time. But here&#39;s my thinking: since the OP&#39;s program is not getting a segv nor creating the file, I suspect the wrong program is being run, or the file is being created in the wrong directory. That&#39;s what I want to determine first."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1471980795, "post_id": 39108198, "comment_id": 65565965, "body": "@MarkPlotnick: Hmm, uses Wireshark QT? Anyway, this is C, not wure why you bring up a GUI framework here. A simple <code>exit(WHATEVER);</code> would be sufficient in the first place. But you completely missed the actual point: use a debugger for debugging."}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1471980936, "post_id": 39108198, "comment_id": 65566024, "body": "@Olaf Yes, Wireshark uses Qt. You made two points, the second of which was to do proper error handling. And I completely agree. Shouldn&#39;t proper error handling in a GUI program ultimately use the GUI to communicate an error?"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1471981182, "post_id": 39108198, "comment_id": 65566145, "body": "@MarkPlotnick: They are actually related and should be both used. One is a permanent measure (maybe expanded lateron), the other temporary to find out details."}, {"owner": {"reputation": 121, "user_id": 5086000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/490465054440553/picture?type=large", "display_name": "Choi", "link": "https://stackoverflow.com/users/5086000/choi"}, "edited": false, "score": 0, "creation_date": 1471983803, "post_id": 39108198, "comment_id": 65567505, "body": "Thank your for the feedback. I shall get back here with the results once I incorporate a better debugger"}, {"owner": {"reputation": 121, "user_id": 5086000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/490465054440553/picture?type=large", "display_name": "Choi", "link": "https://stackoverflow.com/users/5086000/choi"}, "reply_to_user": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "edited": false, "score": 0, "creation_date": 1471984295, "post_id": 39108198, "comment_id": 65567741, "body": "@Jean-BaptisteYun&#232;s got me closer to the right direction. As he suggested, the working directory of wire shark was protected. The file was not being created in the directory and hence I could not write to the file.  As I changed directories the code and any other modifications starting working."}, {"owner": {"reputation": 121, "user_id": 5086000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/490465054440553/picture?type=large", "display_name": "Choi", "link": "https://stackoverflow.com/users/5086000/choi"}, "edited": false, "score": 0, "creation_date": 1471984568, "post_id": 39108198, "comment_id": 65567859, "body": "I am adding this as the answer below and resolve the thread. Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 121, "user_id": 5086000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/490465054440553/picture?type=large", "display_name": "Choi", "link": "https://stackoverflow.com/users/5086000/choi"}, "is_accepted": true, "score": 1, "last_activity_date": 1471984515, "creation_date": 1471984515, "answer_id": 39110221, "question_id": 39108198, "link": "https://stackoverflow.com/questions/39108198/fprintf-not-working-in-wireshark-source/39110221#39110221", "title": "fprintf not working in wireshark source", "body": "<p>The wireshark directory is write protected and hence any modifications that I made to wireshark code could not be written to a file in the same directory. </p>\n\n<p>@MarkPlotnick, @Olaf and @Jean-Bapiste all point towards the right direction and generally as a good practice one should write better debugging code with error handlers. </p>\n"}], "owner": {"reputation": 121, "user_id": 5086000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/490465054440553/picture?type=large", "display_name": "Choi", "link": "https://stackoverflow.com/users/5086000/choi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 39110221, "answer_count": 1, "score": 0, "last_activity_date": 1471984515, "creation_date": 1471976442, "question_id": 39108198, "link": "https://stackoverflow.com/questions/39108198/fprintf-not-working-in-wireshark-source", "title": "fprintf not working in wireshark source", "body": "<p>I am trying to make changes to the wireshark source code and I added the following code to the file: /epan/dissectors/packet-ssl-utils.c</p>\n\n<pre><code>f=fopen(\"keys.txt\",\"a+\"); \nfflush(f);\nfprintf(f,\"Test\"); \nssl_print_data(\"Client Write key\",c_wk,ssl_session-&gt;cipher_suite.bits/8); \nssl_print_data(\"Server Write key\",s_wk,ssl_session-&gt;cipher_suite.bits/8);\nfprintf(f,\"%s %s\",c_wk,s_wk);\n if(ssl_session-&gt;cipher_suite.block&gt;1) {\n ssl_print_data(\"Client Write IV\",c_iv,ssl_session-&gt;cipher_suite.block);\n ssl_print_data(\"Server Write IV\",s_iv,ssl_session-&gt;cipher_suite.block); \nfprintf(f,\"%s %s\",c_iv,s_iv); } \nelse { \nssl_print_data(\"Client Write IV\",c_iv,8); \nssl_print_data(\"Server Write IV\",s_iv,8); \nfprintf(f,\"%s %s\",c_iv,s_iv); } \nfflush(f); \nfclose(f);\n</code></pre>\n\n<p>I declared the FILE pointer as 'f' at the start of the function ssl_generate_keyring().\nAfter multiple attempts of running the scripts</p>\n\n<hr>\n\n<pre><code>sudo ./configure\nsudo make\nsudo make install\n</code></pre>\n\n<p>I am still not able to print the data from these variables to a file. The file itself is not created. </p>\n\n<p>Can anyone advise me on how to write these variables to a file ?</p>\n\n<p><strong>Background:</strong>\nYou must set export SSLKEYLOGFILE=/home/somefilename.txt in a terminal. Launch browser from terminal and then browse traffic.</p>\n\n<p>Go to wire shark preferences and then set keylog file in protocol tab -> ssl tab</p>\n"}]