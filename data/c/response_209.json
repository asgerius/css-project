[{"tags": ["c", "process"], "comments": [{"owner": {"reputation": 292, "user_id": 5661266, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/10205593199614644/picture?type=large", "display_name": "mmeisson", "link": "https://stackoverflow.com/users/5661266/mmeisson"}, "edited": false, "score": 0, "creation_date": 1547076510, "post_id": 54119886, "comment_id": 95072214, "body": "Why is your variable id a double ? The variable returned by getpid is an int like."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1547078507, "post_id": 54119886, "comment_id": 95072633, "body": "What is the problem with the code you added in the edit? A possible problem is that you might be sending the signal before the other process has called <code>signal()</code> to establish the handler. Try calling <code>signal()</code> before you fork."}], "answers": [{"tags": [], "owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "is_accepted": false, "score": 1, "last_activity_date": 1547076558, "creation_date": 1547076558, "answer_id": 54119958, "question_id": 54119886, "link": "https://stackoverflow.com/questions/54119886/how-to-save-a-process-id-on-a-global-variable/54119958#54119958", "title": "How to save a process id on a global variable?", "body": "<p>The issue here is the use of <code>printf</code>. Your id variable is of type <code>double</code>, and you pass that to <code>printf</code> when it's expecting an <code>int</code>. This will completely break the result.</p>\n\n<p>Replace </p>\n\n<pre><code>double id = 0;\n</code></pre>\n\n<p>with</p>\n\n<pre><code>long id;\n</code></pre>\n\n<p>to keep it as an integral type.</p>\n\n<p>Also, replace</p>\n\n<pre><code>printf(\"%d %d\", id, getpid());\n</code></pre>\n\n<p>with</p>\n\n<pre><code>printf(\"%ld %ld\", id, (long) getpid());\n</code></pre>\n\n<p>to ensure that the expected type is being passed to printf.</p>\n\n<p>Also, no need to initialize <code>id</code> to 0 since you unconditionally assign to it later.</p>\n"}, {"comments": [{"owner": {"reputation": 61, "user_id": 10654140, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XkLSo2j5ADw/AAAAAAAAAAI/AAAAAAAAB0k/PoOau9tye10/photo.jpg?sz=128", "display_name": "Jos&#233; Miranda", "link": "https://stackoverflow.com/users/10654140/jos%c3%a9-miranda"}, "edited": false, "score": 0, "creation_date": 1547077791, "post_id": 54119971, "comment_id": 95072473, "body": "But then i&#39;ll be able to send the id on a kill command? Like kill(id, SIGUSR1);"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 61, "user_id": 10654140, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XkLSo2j5ADw/AAAAAAAAAAI/AAAAAAAAB0k/PoOau9tye10/photo.jpg?sz=128", "display_name": "Jos&#233; Miranda", "link": "https://stackoverflow.com/users/10654140/jos%c3%a9-miranda"}, "edited": false, "score": 0, "creation_date": 1547077824, "post_id": 54119971, "comment_id": 95072479, "body": "All the functions that deal with process IDs use <code>pid_t</code> as the datatype."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 61, "user_id": 10654140, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XkLSo2j5ADw/AAAAAAAAAAI/AAAAAAAAB0k/PoOau9tye10/photo.jpg?sz=128", "display_name": "Jos&#233; Miranda", "link": "https://stackoverflow.com/users/10654140/jos%c3%a9-miranda"}, "edited": false, "score": 0, "creation_date": 1547077995, "post_id": 54119971, "comment_id": 95072525, "body": "I can&#39;t think of any reason why it wouldn&#39;t work. Make sure you&#39;ve included the proper headers."}, {"owner": {"reputation": 61, "user_id": 10654140, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XkLSo2j5ADw/AAAAAAAAAAI/AAAAAAAAB0k/PoOau9tye10/photo.jpg?sz=128", "display_name": "Jos&#233; Miranda", "link": "https://stackoverflow.com/users/10654140/jos%c3%a9-miranda"}, "edited": false, "score": 0, "creation_date": 1547078005, "post_id": 54119971, "comment_id": 95072527, "body": "Don&#39;t, i&#39;ll edit the post with the code that don&#39;t work"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 61, "user_id": 10654140, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XkLSo2j5ADw/AAAAAAAAAAI/AAAAAAAAB0k/PoOau9tye10/photo.jpg?sz=128", "display_name": "Jos&#233; Miranda", "link": "https://stackoverflow.com/users/10654140/jos%c3%a9-miranda"}, "edited": false, "score": 0, "creation_date": 1547078068, "post_id": 54119971, "comment_id": 95072541, "body": "What does any of this have to do with <code>printf()</code>?"}], "tags": [], "owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "is_accepted": true, "score": 1, "last_activity_date": 1547082896, "last_edit_date": 1547082896, "creation_date": 1547076628, "answer_id": 54119971, "question_id": 54119886, "link": "https://stackoverflow.com/questions/54119886/how-to-save-a-process-id-on-a-global-variable/54119971#54119971", "title": "How to save a process id on a global variable?", "body": "<p>The problem is that you're printing <code>id</code> with the wrong format. You should either use <code>%f</code>:</p>\n\n<pre><code>printf(\"%f %d\", id, getpid());\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/questions/4264127/correct-format-specifier-for-double-in-printf\">Correct format specifier for double in printf</a></p>\n\n<p>or cast it to <code>int</code>:</p>\n\n<pre><code>printf(\"%d %d\", (int)id, getpid());\n</code></pre>\n\n<p>A better idea would be to use the correct type when declaring <code>id</code>:</p>\n\n<pre><code>pid_t id;\n</code></pre>\n\n<p>This is an integer type, rather than a floating point type.</p>\n"}], "owner": {"reputation": 61, "user_id": 10654140, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XkLSo2j5ADw/AAAAAAAAAAI/AAAAAAAAB0k/PoOau9tye10/photo.jpg?sz=128", "display_name": "Jos&#233; Miranda", "link": "https://stackoverflow.com/users/10654140/jos%c3%a9-miranda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 54119971, "answer_count": 2, "score": -1, "last_activity_date": 1547082896, "creation_date": 1547076147, "last_edit_date": 1547078320, "question_id": 54119886, "link": "https://stackoverflow.com/questions/54119886/how-to-save-a-process-id-on-a-global-variable", "title": "How to save a process id on a global variable?", "body": "<p>i want save the current process id on a variable.</p>\n\n<p>So, i do this:</p>\n\n<pre><code>double id = 0; //Global variable\n\n.....\n\nid = getpid();\n\nprintf(\"%d %d\", id, getpid()); // the result ins't the same...\n</code></pre>\n\n<p>Well, i expected save the current process id on a global variable.</p>\n\n<p>Edit:</p>\n\n<pre><code>new_pid = fork();\n//new_pid2 = fork();\nswitch(new_pid) {\ncase -1:\n        perror(\"fork failed\");\n        exit(1);\ncase 0:\n        kill(getppid(), SIGUSR1);\n        signal(SIGUSR1, trata_SIGSEGV);\n        break;\ndefault:\n        signal(SIGUSR1, trata_SIGSEGV);\n        kill(new_pid, SIGUSR1);\n        break;\n}\nbreak;\n</code></pre>\n"}, {"tags": ["c", "makefile", "compilation"], "comments": [{"owner": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "edited": false, "score": 2, "creation_date": 1547076037, "post_id": 54119783, "comment_id": 95072101, "body": "To be complete, please explain what you mean by <i>...this does not work</i>."}, {"owner": {"reputation": 5339, "user_id": 1714692, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/bd72cbc200eb7c9aa507624f154b21a7?s=128&d=identicon&r=PG", "display_name": "Francesco Boi", "link": "https://stackoverflow.com/users/1714692/francesco-boi"}, "reply_to_user": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "edited": false, "score": 0, "creation_date": 1547132235, "post_id": 54119783, "comment_id": 95093945, "body": "see the <b>EDIT</b>"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1547132274, "post_id": 54119783, "comment_id": 95093972, "body": "Use <a href=\"http://bashdb.sourceforge.net/remake/\" rel=\"nofollow noreferrer\">remake</a> with <code>-x</code> to debug such issues"}, {"owner": {"reputation": 1589, "user_id": 1221106, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/446a06be40a16b516e0b9dc03cecd984?s=128&d=identicon&r=PG", "display_name": "igagis", "link": "https://stackoverflow.com/users/1221106/igagis"}, "edited": false, "score": 0, "creation_date": 1547496707, "post_id": 54119783, "comment_id": 95205103, "body": "I suggest you to use this for your project: <a href=\"https://github.com/igagis/prorab\" rel=\"nofollow noreferrer\">github.com/igagis/prorab</a>"}], "answers": [{"comments": [{"owner": {"reputation": 5339, "user_id": 1714692, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/bd72cbc200eb7c9aa507624f154b21a7?s=128&d=identicon&r=PG", "display_name": "Francesco Boi", "link": "https://stackoverflow.com/users/1714692/francesco-boi"}, "edited": false, "score": 0, "creation_date": 1547205755, "post_id": 54145373, "comment_id": 95122213, "body": "You mean <code>| (OBJDIRCOMMON)</code>? I don&#39;t think so take a look here: <a href=\"https://stackoverflow.com/questions/52643785/makefile-rule-to-regenerate-object-files-directory-without-recompiling-from-sc\" title=\"makefile rule to regenerate object files directory without recompiling from sc\">stackoverflow.com/questions/52643785/&hellip;</a>"}, {"owner": {"reputation": 45838, "user_id": 1362568, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/EAFi0.jpg?s=128&g=1", "display_name": "Mike Kinghan", "link": "https://stackoverflow.com/users/1362568/mike-kinghan"}, "edited": false, "score": 0, "creation_date": 1547208093, "post_id": 54145373, "comment_id": 95123375, "body": "It&#39;s not a pipe; this is not a shell-script. It&#39;s an <a href=\"https://www.gnu.org/software/make/manual/html_node/Prerequisite-Types.html\" rel=\"nofollow noreferrer\">order-only prerequisite</a>"}], "tags": [], "owner": {"reputation": 165, "user_id": 10569552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a19bab13980743df8c0947d5969894d?s=128&d=identicon&r=PG&f=1", "display_name": "anand", "link": "https://stackoverflow.com/users/10569552/anand"}, "is_accepted": false, "score": 0, "last_activity_date": 1547205097, "creation_date": 1547205097, "answer_id": 54145373, "question_id": 54119783, "link": "https://stackoverflow.com/questions/54119783/rule-to-call-another-makefile-from-inside-a-makefile/54145373#54145373", "title": "rule to call another Makefile from inside a Makefile", "body": "<p>Should there be &amp;&amp; instead of pipe</p>\n\n<pre><code>      $(OBJDIRCOMMON)/%.o: $(COMMONDIR)/Makefile | (OBJDIRCOMMON)\n+$(MAKE) -C $(COMMONDIR\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 45838, "user_id": 1362568, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/EAFi0.jpg?s=128&g=1", "display_name": "Mike Kinghan", "link": "https://stackoverflow.com/users/1362568/mike-kinghan"}, "is_accepted": true, "score": 2, "last_activity_date": 1547283934, "last_edit_date": 1547283934, "creation_date": 1547230022, "answer_id": 54151856, "question_id": 54119783, "link": "https://stackoverflow.com/questions/54119783/rule-to-call-another-makefile-from-inside-a-makefile/54151856#54151856", "title": "rule to call another Makefile from inside a Makefile", "body": "<p><strong>Why what you did was wrong</strong></p>\n\n<p>Recipe <strong>A</strong>:</p>\n\n<pre><code>$(OBJDIRCOMMON)/%.o: $(COMMONDIR)/%.c $(COMMONDIR)/Makefile | $(OBJDIRCOMMON)\n    +$(MAKE) -C $(COMMONDIR)\n</code></pre>\n\n<p>and recipe <strong>B</strong>:</p>\n\n<pre><code>$(OBJDIRCOMMON)/%.o: $(COMMONDIR)/Makefile | $(OBJDIRCOMMON)\n    +$(MAKE) -C $(COMMONDIR)\n</code></pre>\n\n<p>have essentially different meanings and will certainly not yield the same behaviour.</p>\n\n<p>Recipe <strong>A</strong> says:</p>\n\n<ol>\n<li>Any target <code>$(OBJDIRCOMMON)/file.o</code> must be made up-to-date if does not exist\nor is older than either <code>$(COMMONDIR)/file.c</code> or <code>$(COMMONDIR)/Makefile</code>.</li>\n<li>If a target <code>$(OBJDIRCOMMON)/file.o</code> must be made up-to-date, then <code>$(OBJDIRCOMMON)</code>\nmust be made up-to-date first.</li>\n<li>To make a target <code>$(OBJDIRCOMMON)/file.o</code> up-to-date, run the expansion of <code>$(MAKE) -C $(COMMONDIR)</code> in a shell.</li>\n</ol>\n\n<p>Recipe <strong>B</strong> says:</p>\n\n<ol>\n<li>Any target <code>$(OBJDIRCOMMON)/file.o</code> must be made up-to-date if does not exist\nor is older than <code>$(COMMONDIR)/Makefile</code>.</li>\n<li>If a target <code>$(OBJDIRCOMMON)/file.o</code> must be made up-to-date, then <code>$(OBJDIRCOMMON)</code>\nmust be made up-to-date first.</li>\n<li>To make a target <code>$(OBJDIRCOMMON)/file.o</code> up-to-date, execute the expansion of <code>$(MAKE) -C $(COMMONDIR)</code> in a shell.</li>\n</ol>\n\n<p>Notice that criterion <strong>A.1</strong> is different from criterion <strong>B.1</strong>. Recipe <strong>A</strong> will execute\nif <code>$(OBJDIRCOMMON)/file.o</code> is older than <code>$(OBJDIRCOMMON)/file.c</code>. Recipe <strong>B</strong> will not.\nRecipe <strong>B</strong> discards the dependency of the object files on the corresponding source files,\nand tells Make that <code>$(OBJDIRCOMMON)/file.o</code> is only ever to be remade if it\nis older than <code>$(COMMONDIR)/Makefile</code>.</p>\n\n<blockquote>\n  <p>at the end of the day the only real input required by the rule is the other Makefile</p>\n</blockquote>\n\n<p>What you mean by \"the rule\" here is actually the commandline (expanded from) <code>$(MAKE) -C $(COMMONDIR)</code>.\nThe inputs of this command are one thing; the criteria for executing it are another.</p>\n\n<p><strong>How what you did caused the error you see</strong>.</p>\n\n<p>This is thornier. Let's reproduce it.</p>\n\n<p>Here's a playpen:</p>\n\n<pre><code>$ ls -R\n.:\napp  common\n\n./app:\nfoo.c  main.c  Makefile\n\n./common:\nbar.c  Makefile\n</code></pre>\n\n<p>Here, <code>./app/Makefile</code> is exactly your Makefile with recipe <strong>A</strong>. <code>./common/Makefile</code>,\nwhich you didn't post, is just:</p>\n\n<pre><code>obj/bar.o: bar.c\n    gcc -MMD -MP -c -I. $&lt; -o $@\n</code></pre>\n\n<p>because that will do for illustration.</p>\n\n<p>We build in <code>./app</code>:</p>\n\n<pre><code>$ cd app\n$ make\nmkdir -p ./obj\ngcc -Wall -Wextra -MMD -MP -c -I../common/ foo.c -o obj/foo.o\ngcc -Wall -Wextra -MMD -MP -c -I../common/ main.c -o obj/main.o\nmkdir -p ../common/obj\nmake -C ../common\nmake[1]: Entering directory '/home/imk/develop/so/make_prob/common'\ngcc -MMD -MP -c -I. bar.c -o obj/bar.o\nmake[1]: Leaving directory '/home/imk/develop/so/make_prob/common'\ngcc -Wall -Wextra obj/foo.o obj/main.o ../common/obj/bar.o -o ../server\n</code></pre>\n\n<p>which is fine.</p>\n\n<p>Now I change <code>./app/Makefile</code> as you did, to use recipe <strong>B</strong>, and rebuild.</p>\n\n<pre><code>$ make\ngcc -Wall -Wextra -MMD -MP -c -I../common/ foo.c -o obj/foo.o\ngcc -Wall -Wextra -MMD -MP -c -I../common/ main.c -o obj/main.o\ngcc -Wall -Wextra obj/foo.o obj/main.o ../common/obj/bar.o -o ../server\n</code></pre>\n\n<p>Still fine... But wait a minute! That one didn't invoke the <code>./common</code> make\nat all, which is the one that the change might affect. Better <code>clean</code>:</p>\n\n<pre><code>$ make clean\nrm -f ./obj/foo.o ./obj/main.o ./obj/foo.d ./obj/main.d ../server\n</code></pre>\n\n<p>and try again:</p>\n\n<pre><code>$ make\ngcc -Wall -Wextra -MMD -MP -c -I../common/ foo.c -o obj/foo.o\ngcc -Wall -Wextra -MMD -MP -c -I../common/ main.c -o obj/main.o\ngcc -Wall -Wextra obj/foo.o obj/main.o ../common/obj/bar.o -o ../server\n</code></pre>\n\n<p>No difference? Ah, that's because this Makefile's <code>clean</code> fails to delete all\nthe files that <code>make</code> builds: it leaves out <code>../common/obj/bar.o</code>. So I'll just:</p>\n\n<pre><code>$ rm ../common/obj/*\n</code></pre>\n\n<p>And have another go:</p>\n\n<pre><code>$ make\nmake -C ../common\nmake[1]: Entering directory '/home/imk/develop/so/make_prob/common'\ngcc -MMD -MP -c -I. bar.c -o obj/bar.o\nmake[1]: Leaving directory '/home/imk/develop/so/make_prob/common'\ngcc   ../common/obj/bar.d.o   -o ../common/obj/bar.d\ngcc: error: ../common/obj/bar.d.o: No such file or directory\ngcc: fatal error: no input files\ncompilation terminated.\n</code></pre>\n\n<p>which is your mystery.</p>\n\n<p>When I zapped the <code>../common/obj</code> files, I deleted not only all the <em>object</em> files therein\nbut also the dependency file <code>../common/obj/bar.d</code>. And now Make is trying to remake it by running:</p>\n\n<pre><code>gcc   ../common/obj/bar.d.o   -o ../common/obj/bar.d\n</code></pre>\n\n<p>How come? To answer that, we'll first change <code>./app/Makefile</code> back to use recipe <strong>A</strong>\n - consider it done - and then do:</p>\n\n<pre><code>$ make --print-data-base &gt; out.txt\n</code></pre>\n\n<p>which dumps in <code>out.txt</code> all the information that Make gleans from reading all\nthe makefiles (<code>Makefile</code> and all the makefiles that it recursively <code>include</code>-s,\nin this case just the auto-generated <code>.d</code> files).</p>\n\n<p>Let's see what the database has to say about <code>../common/obj/bar.d</code>. It says:</p>\n\n<pre><code># Not a target:\n../common/obj/bar.d:\n# Implicit rule search has been done.\n# Last modified 2019-01-11 16:01:33.199263608\n# File has been updated.\n# Successfully updated.\n</code></pre>\n\n<p>Certainly we don't <em>want</em> <code>../common/obj/bar.d</code> to be a target, and it <em>isn't</em> a\ntarget because, having read all the makefiles, and considered all its builtin rules,\nand all of the files it can actually find, Make can't see any way in which <code>../common/obj/bar.d</code>\nhas to be made up-to-date with respect to any of those files. Good.</p>\n\n<p>Now let's revert to recipe <strong>B</strong> in <code>./app/Makefile</code> again - consider it done -\nand again do:</p>\n\n<pre><code>$ make --print-data-base &gt; out.txt\n</code></pre>\n\n<p>and again look in <code>out.txt</code> concerning <code>../common/obj/bar.d</code>. This time we find:</p>\n\n<pre><code>../common/obj/bar.d: ../common/obj/bar.d.o\n# Implicit rule search has been done.\n#  Implicit/static pattern stem: '../common/obj/bar.d'\n# Last modified 2019-01-11 16:01:33.199263608\n# File has been updated.\n# Successfully updated.\n#  recipe to execute (built-in):\n    $(LINK.o) $^ $(LOADLIBES) $(LDLIBS) -o $@\n</code></pre>\n\n<p>So this time <code>../common/obj/bar.d</code> <em>is</em> a target! And it depends on <code>../common/obj/bar.d.o</code>!\nAnd the recipe to make it is:</p>\n\n<pre><code>    $(LINK.o) $^ $(LOADLIBES) $(LDLIBS) -o $@\n</code></pre>\n\n<p>which will expand, of course, to:</p>\n\n<pre><code>gcc   ../common/obj/bar.d.o   -o ../common/obj/bar.d\n</code></pre>\n\n<p>How was Make able to work that out, thanks to recipe <strong>B</strong>?</p>\n\n<p>Well first it considered whether any of the rules in the makefiles or any of the\nbuiltin rules gave it direct way to make <code>../common/obj/bar.d</code> from any existing files,\nand drew a blank.</p>\n\n<p><em>Next</em> it considered whether any of those rules gave it a way to\nmake <code>../common/obj/bar.d</code> from an <a href=\"https://www.gnu.org/software/make/manual/html_node/Chained-Rules.html\" rel=\"nofollow noreferrer\"><em>intermediate file</em></a>. An <em>intermediate file</em> being a file that doesn't exist but itself <em>can</em> be made\nfrom existing files, by any of the rules it has read or its builtin-rules. This\ntime it saw a way.</p>\n\n<p>One of Make's builtin pattern rules is:</p>\n\n<pre><code>%: %.o\n#  recipe to execute (built-in):\n    $(LINK.o) $^ $(LOADLIBES) $(LDLIBS) -o $@\n</code></pre>\n\n<p>You can find it in right there in <code>out.txt</code>. And you can see this is the pattern rule that\nit matches with:</p>\n\n<pre><code>../common/obj/bar.d: ../common/obj/bar.d.o\n</code></pre>\n\n<p>The recipe there is a recipe to <em>link a program</em> called <code>../common/obj/bar.d</code> given\nan object file <code>../common/obj/bar.d.o</code>.</p>\n\n<p>There is no object file <code>../common/obj/bar.d.o</code>, but can it be an intermediate file? If\nMake can find a rule for making <code>../common/obj/bar.d.o</code> from files that <em>do</em> exist,\nthen it can also make <code>../common/obj/bar.d</code> with this <code>%: %.o</code> rule.</p>\n\n<p>And it <em>can</em> find a recipe for making <code>../common/obj/bar.d.o</code> from existing files\nbecause we just gave it one! - recipe <strong>B</strong>:</p>\n\n<pre><code>$(OBJDIRCOMMON)/%.o: $(COMMONDIR)/Makefile | $(OBJDIRCOMMON)\n    +$(MAKE) -C $(COMMONDIR)\n</code></pre>\n\n<p>That tells Make that if any target matching <code>$(OBJDIRCOMMON)/%.o</code> (like <code>../common/obj/bar.d.o</code>)\ndoes not exist, but <code>$(COMMONDIR)/Makefile</code> does exist (which it does), then that target\nis made up-to-date by running:</p>\n\n<pre><code>$(MAKE) -C $(COMMONDIR)\n</code></pre>\n\n<p>Make believed us. It ran <code>$(MAKE) -C $(COMMONDIR)</code>:</p>\n\n<pre><code>make -C ../common\nmake[1]: Entering directory '/home/imk/develop/so/make_prob/common'\ngcc -MMD -MP -c -I. bar.c -o obj/bar.o\nmake[1]: Leaving directory '/home/imk/develop/so/make_prob/common'\n</code></pre>\n\n<p>and then considered <code>../common/obj/bar.d.o</code> up-to-date. So it moved on to:</p>\n\n<pre><code>../common/obj/bar.d: ../common/obj/bar.d.o\n    $(LINK.o) $^ $(LOADLIBES) $(LDLIBS) -o $@\n</code></pre>\n\n<p>and ran:</p>\n\n<pre><code>gcc   ../common/obj/bar.d.o   -o ../common/obj/bar.d\n</code></pre>\n\n<p>which failed because we lied:</p>\n\n<pre><code>make -C ../common\n</code></pre>\n\n<p>does <em>not</em> make <code>../common/obj/bar.d.o</code> at all.</p>\n\n<pre><code>gcc: error: ../common/obj/bar.d.o: No such file or directory\n</code></pre>\n\n<p>This does not arise with recipe <strong>A</strong>, because</p>\n\n<pre><code>$(OBJDIRCOMMON)/bar.d.o: $(OBJDIRCOMMON)/bar.d.c $(COMMONDIR)/Makefile | $(OBJDIRCOMMON)\n    +$(MAKE) -C $(COMMONDIR)\n</code></pre>\n\n<p>does <em>not</em> offer Make a way to make <code>$(OBJDIRCOMMON)/bar.d.o</code> from existing files,\nbecause <code>$(OBJDIRCOMMON)/bar.d.c</code> does not exist. So <code>../common/obj/bar.d</code> is not\na target.</p>\n\n<p>Stick with recipe <strong>A</strong>, because it's right, and recipe <strong>B</strong> is wrong. Also review\nand fix the makefiles so that <code>make clean</code> always deletes all the non-<code>.PHONY</code> targets that might have been built, and nothing else. Lastly avoid writing recipes with non-<code>.PHONY</code> targets where the recipe does not  mention the target. </p>\n"}], "owner": {"reputation": 5339, "user_id": 1714692, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/bd72cbc200eb7c9aa507624f154b21a7?s=128&d=identicon&r=PG", "display_name": "Francesco Boi", "link": "https://stackoverflow.com/users/1714692/francesco-boi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2786, "favorite_count": 0, "accepted_answer_id": 54151856, "answer_count": 2, "score": 1, "last_activity_date": 1547283934, "creation_date": 1547075541, "last_edit_date": 1547132181, "question_id": 54119783, "link": "https://stackoverflow.com/questions/54119783/rule-to-call-another-makefile-from-inside-a-makefile", "title": "rule to call another Makefile from inside a Makefile", "body": "<p>I have a <code>Makefile</code> from which I run the command of another <code>Makefile</code> if some objects file do not exist already.</p>\n\n<p>The rule is the following:</p>\n\n<pre><code>$(OBJDIRCOMMON)/%.o: $(COMMONDIR)/%.c $(COMMONDIR)/Makefile | $(OBJDIRCOMMON)\n    +$(MAKE) -C $(COMMONDIR)\n</code></pre>\n\n<p>where the variables are defined as follows in the same <code>Makefile</code>:</p>\n\n<pre><code>COMMONDIR     := ../common\nSOURCESCOMMON := $(wildcard $(COMMONDIR)/*.c)\nOBJDIRCOMMON  := $(COMMONDIR)/obj\nOBJECTSCOMMON := $(patsubst $(COMMONDIR)/%.c,$(OBJDIRCOMMON)/%.o, $(SOURCESCOMMON))\nDEPENDSCOMMON := $(patsubst $(COMMONDIR)/%.c,$(OBJDIRCOMMON)/%.d, $(SOURCESCOMMON))\n</code></pre>\n\n<p>This rule works fine but at the end of the day the only real input required by the rule is the other <code>Makefile</code> so I tried:</p>\n\n<pre><code>$(OBJDIRCOMMON)/%.o: $(COMMONDIR)/Makefile | $(OBJDIRCOMMON)\n    +$(MAKE) -C $(COMMONDIR)\n</code></pre>\n\n<p>but this does not work, why is that?</p>\n\n<p>For completeness here is the complete <code>Makefile</code></p>\n\n<pre><code>CC = gcc\n\nINC_PATH = -I../common/\n\nSOURCEDIR := ./\nSOURCES := $(wildcard $(SOURCEDIR)/*.c)\nOBJDIR  :=./obj\nOBJECTS := $(patsubst $(SOURCEDIR)/%.c,$(OBJDIR)/%.o, $(SOURCES))\nDEPENDS := $(patsubst $(SOURCEDIR)/%.c,$(OBJDIR)/%.d, $(SOURCES))\n\nCOMMONDIR     := ../common\nSOURCESCOMMON := $(wildcard $(COMMONDIR)/*.c)\nOBJDIRCOMMON  := $(COMMONDIR)/obj\nOBJECTSCOMMON := $(patsubst $(COMMONDIR)/%.c,$(OBJDIRCOMMON)/%.o, $(SOURCESCOMMON))\nDEPENDSCOMMON := $(patsubst $(COMMONDIR)/%.c,$(OBJDIRCOMMON)/%.d, $(SOURCESCOMMON))\n\n# ADD MORE WARNINGS!\nWARNING := -Wall -Wextra\n\n# OBJS_LOC is in current working directory,\nEXECUTABLE := ../server\n# .PHONY means these rules get executed even if\n# files of those names exist.\n.PHONY: all clean\n\n# The first rule is the default, ie. \"make\",\n# \"make all\" and \"make parking\" mean the same\nall: $(EXECUTABLE)\n\nclean:\n    $(RM) $(OBJECTS) $(DEPENDS) $(EXECUTABLE)\n\n# Linking the executable from the object files\n# $^   # \"src.c src.h\" (all prerequisites)\n$(EXECUTABLE): $(OBJECTS) $(OBJECTSCOMMON)\n    $(CC) $(WARNING) $^ -o $@\n\n-include $(DEPENDS) $(DEPENDSCOMMON)\n\n$(OBJDIR):\n    mkdir -p $(OBJDIR)\n\n$(OBJDIR)/%.o: $(SOURCEDIR)/%.c Makefile | $(OBJDIR)\n    $(CC) $(WARNING) -MMD -MP -c $(INC_PATH) $&lt; -o $@\n\n$(OBJDIRCOMMON):\n    mkdir -p $(OBJDIRCOMMON)\n\n$(OBJDIRCOMMON)/%.o: $(COMMONDIR)/%.c $(COMMONDIR)/Makefile | $(OBJDIRCOMMON)\n    +$(MAKE) -C $(COMMONDIR)\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>The error I get is like this:</p>\n\n<pre><code>Entering directory '/home/user/Documents/UnixSystem/network/common'\ngcc -Wall -Wextra -MMD -MP -c utilities.c -o obj/utilities.o\ngcc -Wall -Wextra -MMD -MP -c error.c -o obj/error.o\nmake[2]: Leaving directory '/home/user/Documents/UnixSystem/network/common'\ngcc   ../common/obj/error.d.o   -o ../common/obj/error.d\ngcc: error: ../common/obj/error.d.o: No such file or directory\ngcc: fatal error: no input files\ncompilation terminated.\n</code></pre>\n\n<p>From which I understand the execution of the other <code>Makefile</code> was successful. However after that it is trying to execute this command <code>gcc   ../common/obj/error.d.o   -o ../common/obj/error.d</code>  which is wrong but I do not know which rule and why it's generating it.</p>\n"}, {"tags": ["c", "embedded"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547074844, "post_id": 54119593, "comment_id": 95071788, "body": "The first time <code>i=0</code>, then <code>i++;</code> and then <code>i</code> stays at <code>1</code> to the end of the universe. (there are no other expression that change the value of <code>i</code>). What would you expect to happen?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 2, "creation_date": 1547074939, "post_id": 54119593, "comment_id": 95071814, "body": "This is a simple logical bug unrelated to <code>volatile</code>. Think about <code>volatile</code> only when you have interrupts and/or hardware registers around."}, {"owner": {"reputation": 1, "user_id": 5725184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f5bb86b243e2059d66d4e3fddc784f4?s=128&d=identicon&r=PG&f=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/5725184/casper"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1547075590, "post_id": 54119593, "comment_id": 95071979, "body": "@Eugene Sh How can I reach? Could you advice me?"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547090754, "post_id": 54119593, "comment_id": 95075111, "body": "The gas might be <a href=\"https://en.wikipedia.org/wiki/Volatility_(chemistry)\" rel=\"nofollow noreferrer\">volatile</a>, the variable is not <a href=\"https://en.wikipedia.org/wiki/Volatile_(computer_programming)\" rel=\"nofollow noreferrer\">volatile</a>."}], "answers": [{"comments": [{"owner": {"reputation": 37414, "user_id": 204883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba29060be0758fa6537ff3d768a91757?s=128&d=identicon&r=PG", "display_name": "Arkku", "link": "https://stackoverflow.com/users/204883/arkku"}, "edited": false, "score": 1, "creation_date": 1547077914, "post_id": 54119816, "comment_id": 95072503, "body": "The else condition can also be removed since it\u2019s never set negative."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 37414, "user_id": 204883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba29060be0758fa6537ff3d768a91757?s=128&d=identicon&r=PG", "display_name": "Arkku", "link": "https://stackoverflow.com/users/204883/arkku"}, "edited": false, "score": 1, "creation_date": 1547090612, "post_id": 54119816, "comment_id": 95075088, "body": "@Arkku True: <code>else if (i &gt; 0)</code> --&gt; <code>else</code>."}, {"owner": {"reputation": 2432, "user_id": 117160, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0vdCM.jpg?s=128&g=1", "display_name": "u\u0250\u026a", "link": "https://stackoverflow.com/users/117160/u%c9%90%c9%aa"}, "edited": false, "score": 0, "creation_date": 1547123088, "post_id": 54119816, "comment_id": 95088453, "body": "You might also need to reverse the effects of <code>Sensor_Relay_Mechanism()</code>  in the final <code>else</code> where you reset the value of <code>i</code> so that the behaviour will be the same on subsequent detections."}], "tags": [], "owner": {"reputation": 38619, "user_id": 33252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d0b55a5e4a7eff1bf29eae5bd314f0d?s=128&d=identicon&r=PG", "display_name": "Doug Currie", "link": "https://stackoverflow.com/users/33252/doug-currie"}, "is_accepted": false, "score": 0, "last_activity_date": 1547075731, "creation_date": 1547075731, "answer_id": 54119816, "question_id": 54119593, "link": "https://stackoverflow.com/questions/54119593/how-to-use-volatile-variable-another-function-in-embedded-c/54119816#54119816", "title": "How to use volatile variable another function in embedded c", "body": "<p>How about setting <code>i</code> to zero if there is no gas leak</p>\n\n<pre><code>void Sensor_buzzer ()\n{\n    static uint8_t i = 0;\n\n    if (Check_Gas_Voltage(Sensor1))\n    {\n\n        if (i==0)\n        {\n            _delay_ms(300);              \n            Buzzer_Tune();\n            Sensor_Relay_Mechanism();\n            i++;\n        }\n        else if (i &gt; 0)\n        {\n            Buzzer_Tune();\n        } \n    }\n    else\n    {\n        i = 0;\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 5725184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f5bb86b243e2059d66d4e3fddc784f4?s=128&d=identicon&r=PG&f=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/5725184/casper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547075731, "creation_date": 1547074439, "last_edit_date": 1547074872, "question_id": 54119593, "link": "https://stackoverflow.com/questions/54119593/how-to-use-volatile-variable-another-function-in-embedded-c", "title": "How to use volatile variable another function in embedded c", "body": "<p>If (expression 1) runs that means gas leakage, it will run (expression2) and (expression 3). (Expressions 2) works only one time during the gas leakage. If gas sensor detects second time after returning sensor signal go down, it will have to run (expression 2). The problem is that code skips (expression 2) at the second time gas leakage.</p>\n\n<p>I am going to do that (expression 2) runs one time during the gas leakage. It must work second time gas leakage.</p>\n\n<pre><code>void Sensor_buzzer (){\n\nif (Check_Gas_Voltage(Sensor1)){        // expression 1\n\n    static uint8_t i=0;\n\n    if (i==0){                                           // expression 2\n\n        _delay_ms(300);              \n\n        Buzzer_Tune();\n\n        Sensor_Relay_Mechanism();\n\n        i++;\n\n    }\n\n    else if (i&gt;0){                                   // expression 3\n\n        Buzzer_Tune();\n\n    } \n\n}\n</code></pre>\n"}, {"tags": ["c", "performance", "memory"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 5, "creation_date": 1547074295, "post_id": 54119529, "comment_id": 95071631, "body": "It adds confusion, that&#39;s it."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 3, "creation_date": 1547074361, "post_id": 54119529, "comment_id": 95071659, "body": "No, it doesn&#39;t. The compiler is perfectly capable of minor optimisations of this form, as well as much more sophisticated optimisations."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547074616, "post_id": 54119529, "comment_id": 95071722, "body": "Remember of <a href=\"http://wiki.c2.com/?RulesOfOptimization\" rel=\"nofollow noreferrer\">RulesOfOptimization</a>"}, {"owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "edited": false, "score": 0, "creation_date": 1547075602, "post_id": 54119529, "comment_id": 95071987, "body": "The only way to know for sure is to write up both versions and profile each.  Having said that, I&#39;m pretty confident this won&#39;t make any difference except make your code harder to read and understand."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1547075876, "post_id": 54119529, "comment_id": 95072061, "body": "&quot;surprising&quot; results: <a href=\"https://godbolt.org/z/BYsgjS\" rel=\"nofollow noreferrer\">godbolt.org/z/BYsgjS</a>"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 3, "creation_date": 1547081052, "post_id": 54119529, "comment_id": 95073251, "body": "Note that if <code>(x-a)</code> leads to signed integer arithmetic overflow (big positive <code>x</code>, big negative <code>a</code>, or vice versa on the signs), then you&#39;re invoking undefined behaviour with the arithmetic whereas the behaviour of the comparison is perfectly well defined."}], "answers": [{"tags": [], "owner": {"reputation": 123967, "user_id": 251153, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4b25144c09555e7d5b5e288469e011ef?s=128&d=identicon&r=PG", "display_name": "zneak", "link": "https://stackoverflow.com/users/251153/zneak"}, "is_accepted": true, "score": 5, "last_activity_date": 1547074290, "creation_date": 1547074290, "answer_id": 54119557, "question_id": 54119529, "link": "https://stackoverflow.com/questions/54119529/using-x-a-instead-of-x-a-in-c/54119557#54119557", "title": "Using !(x-a) instead of x==a in C", "body": "<p>No, it does not. Using a tricky syntax to do something that there's a well-known syntax for is never the right answer. You should use x==a.</p>\n"}, {"comments": [{"owner": {"reputation": 41558, "user_id": 3204551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91bb06155f79d40ffecdf124deecb001?s=128&d=identicon&r=PG&f=1", "display_name": "Deduplicator", "link": "https://stackoverflow.com/users/3204551/deduplicator"}, "edited": false, "score": 0, "creation_date": 1547076142, "post_id": 54119715, "comment_id": 95072118, "body": "Get an upvote for pointing out that what looks like <a href=\"https://www.ioccc.org/\" rel=\"nofollow noreferrer\">novice training for the IOCCC</a> actually could have some subtle differences, depending on context."}], "tags": [], "owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "is_accepted": false, "score": 5, "last_activity_date": 1547075160, "creation_date": 1547075160, "answer_id": 54119715, "question_id": 54119529, "link": "https://stackoverflow.com/questions/54119529/using-x-a-instead-of-x-a-in-c/54119715#54119715", "title": "Using !(x-a) instead of x==a in C", "body": "<p>Depending upon the types of <code>x</code> and <code>a</code>, the semantics of <code>!(x-a)</code> may be different from those of <code>x==a</code>.  Depending upon what one is trying to do, such differences may be helpful, harmful, or irrelevant.  In cases where they are helpful, there should be a comment indicating how the semantics are expected to differ from <code>x==a</code>, and why that would be important.</p>\n\n<p>For example, if <code>x</code> and <code>a</code> are both floating-point values equal to positive infinity, <code>x==a</code> would yield 1, but computing <code>x-a</code> would yield <code>NaN</code>, and applying the <code>!</code> operator to that would yield zero.</p>\n\n<p>I am unaware of any common idioms that revolve around differences between <code>x==a</code> and <code>!(a-x)</code>, so any code which uses the latter form without specifying why should be viewed suspiciously.</p>\n"}, {"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 0, "last_activity_date": 1547090217, "last_edit_date": 1547090217, "creation_date": 1547089642, "answer_id": 54121429, "question_id": 54119529, "link": "https://stackoverflow.com/questions/54119529/using-x-a-instead-of-x-a-in-c/54121429#54121429", "title": "Using !(x-a) instead of x==a in C", "body": "<p><code>!(x-a)</code> instead of <code>x==a</code></p>\n\n<p><strong><code>x==a</code> better</strong></p>\n\n<p>As pointers <code>x, a</code>, <code>x==a</code> is well defined. <code>x-a</code> is undefined behavior unless <code>x,a</code> both point in/near the same object.</p>\n\n<p>As sign integers <code>x, a</code>, <code>x==a</code> is well defined. <code>x-a</code> is may overflow the signed integer range and is then undefined behavior <a href=\"https://stackoverflow.com/questions/54119529/using-x-a-instead-of-x-a-in-c#comment95073251_54119529\">@Jonathan Leffler </a>.</p>\n\n<p>As floating point <code>x, a</code>, <code>x==a</code> is well defined. <code>x-a</code> may have unexpected effects <a href=\"https://stackoverflow.com/a/54119715/2410359\">@supercat</a>.</p>\n\n<p><strong>Tie</strong></p>\n\n<p>With <code>x</code> as a pointer within an array and <code>a</code> as an <code>int</code>, <code>x-a</code>, could nicely result in a new address and <code>!(x-a)</code> is 0.  <code>x==a</code> will attempt to create a pointer out of <code>a</code> which <em>if</em> it makes for a valid pointer, code then results in 0 or 1.</p>\n\n<hr>\n\n<p>Code to what conveys the most clarity and leave the micro-optimization concerns to the compiler.</p>\n\n<p>With a <em>comparison</em> this is certainly <code>==</code>.</p>\n\n<hr>\n\n<p>On a theoretical level, say <code>!(x-a)</code> and <code>x==a</code> had the same  functionality  for all <code>a,x</code>.  If one was faster than the other, a <em>good</em> compiler would then emit code based on the faster of the two.</p>\n\n<p>A weaker compiler may benefit with the coder knowing better than the compiler.  <a href=\"https://sayingimages.com/wp-content/uploads/yeah-right-surreeee-meme.png\" rel=\"nofollow noreferrer\">Yeah, right</a></p>\n"}], "owner": {"reputation": 23, "user_id": 10892356, "user_type": "registered", "profile_image": "https://graph.facebook.com/2210970399177559/picture?type=large", "display_name": "George Bouroutzoglou", "link": "https://stackoverflow.com/users/10892356/george-bouroutzoglou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 54119557, "answer_count": 3, "score": 1, "last_activity_date": 1547090217, "creation_date": 1547074160, "question_id": 54119529, "link": "https://stackoverflow.com/questions/54119529/using-x-a-instead-of-x-a-in-c", "title": "Using !(x-a) instead of x==a in C", "body": "<p>I am writing a C program that does many comparisons and I was wondering if this actually saves memory.</p>\n\n<p>Any help appreciated</p>\n"}, {"tags": ["c", "makefile", "cmder"], "comments": [{"owner": {"reputation": 8780, "user_id": 318716, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2Jwj3.png?s=128&g=1", "display_name": "Joseph Quinsey", "link": "https://stackoverflow.com/users/318716/joseph-quinsey"}, "edited": false, "score": 0, "creation_date": 1547078718, "post_id": 54119488, "comment_id": 95072684, "body": "<code>CFLAGs</code>, with a lower-case <code>s</code>?"}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "reply_to_user": {"reputation": 8780, "user_id": 318716, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2Jwj3.png?s=128&g=1", "display_name": "Joseph Quinsey", "link": "https://stackoverflow.com/users/318716/joseph-quinsey"}, "edited": false, "score": 0, "creation_date": 1547197161, "post_id": 54119488, "comment_id": 95117501, "body": "@JosephQuinsey, what&#39;s the reason of <code>CFLAG[sS]</code> (in any lettercase) if then it&#39;s not used in the rest of Makefile.... there&#39;s no dependency info in that Makefile, so no automatic rule will be selected, and no use of <code>CFLAGS</code> variable will be made."}], "answers": [{"comments": [{"owner": {"reputation": 22818, "user_id": 509868, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/83450238b4ee0eddbf54d7ce5a3a64e4?s=128&d=identicon&r=PG", "display_name": "anatolyg", "link": "https://stackoverflow.com/users/509868/anatolyg"}, "edited": false, "score": 0, "creation_date": 1547075203, "post_id": 54119562, "comment_id": 95071890, "body": "Also, <code>ex1.exe</code> should be a prerequisite for <code>all</code> (<code>all: ex1.exe</code> instead of just <code>all:</code>), else <code>make</code> cannot detect if it&#39;s up-to-date. Also, optionally add <code>.PHONY: all</code> to avoid confusion with a file called literally <code>all</code>."}, {"owner": {"reputation": 393, "user_id": 10892372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qOkan.jpg?s=128&g=1", "display_name": "Jerry D", "link": "https://stackoverflow.com/users/10892372/jerry-d"}, "edited": false, "score": 0, "creation_date": 1547075335, "post_id": 54119562, "comment_id": 95071921, "body": "@tadman That&#39;s not what I&#39;m looking for, what I was meaning was to use only <code>make</code>. The <code>make all</code> is only for ex1, and I want to just use make."}, {"owner": {"reputation": 393, "user_id": 10892372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qOkan.jpg?s=128&g=1", "display_name": "Jerry D", "link": "https://stackoverflow.com/users/10892372/jerry-d"}, "edited": false, "score": 1, "creation_date": 1547075643, "post_id": 54119562, "comment_id": 95072003, "body": "My bad! This answer worked for the most part though! Thanks!"}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "reply_to_user": {"reputation": 22818, "user_id": 509868, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/83450238b4ee0eddbf54d7ce5a3a64e4?s=128&d=identicon&r=PG", "display_name": "anatolyg", "link": "https://stackoverflow.com/users/509868/anatolyg"}, "edited": false, "score": 0, "creation_date": 1547197335, "post_id": 54119562, "comment_id": 95117583, "body": "@anatolyg, nope... <code>ex1.exe</code> doesn&#39;t need to be a prerequisite of anything, as it&#39;s the <code>all</code> target what is only needed in the command line to build <code>ex1.exe</code>.  The way the <code>Makefile</code> is written is not my preferred one... but just saying <code>make all</code> will make the executable.  No dependency info has been wired on it."}], "tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": true, "score": 4, "last_activity_date": 1547074306, "creation_date": 1547074306, "answer_id": 54119562, "question_id": 54119488, "link": "https://stackoverflow.com/questions/54119488/set-up-my-makefile-to-compile-c-with-just-make/54119562#54119562", "title": "Set up my makefile to compile C with just &quot;make&quot;", "body": "<p>The default goal is the first goal, so switch the order of these so that <code>all</code> is the default.</p>\n\n<p>There's more detail in <a href=\"https://www.gnu.org/software/make/manual/html_node/Goals.html\" rel=\"nofollow noreferrer\">the documentation on goals</a>:</p>\n\n<blockquote>\nBy default, the goal is the first target in the makefile (not counting targets that start with a period). Therefore, makefiles are usually written so that the first target is for compiling the entire program or programs they describe. If the first rule in the makefile has several targets, only the first target in the rule becomes the default goal, not the whole list. You can manage the selection of the default goal from within your makefile using the <code>.DEFAULT_GOAL</code> variable\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1547197418, "post_id": 54119837, "comment_id": 95117624, "body": "please, if you use <code>ex1</code> as prerequisite of <code>all</code> then use that same <code>ex1</code> as the argument to <code>rm -f</code>"}], "tags": [], "owner": {"reputation": 393, "user_id": 10892372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qOkan.jpg?s=128&g=1", "display_name": "Jerry D", "link": "https://stackoverflow.com/users/10892372/jerry-d"}, "is_accepted": false, "score": 1, "last_activity_date": 1547199927, "last_edit_date": 1547199927, "creation_date": 1547075857, "answer_id": 54119837, "question_id": 54119488, "link": "https://stackoverflow.com/questions/54119488/set-up-my-makefile-to-compile-c-with-just-make/54119837#54119837", "title": "Set up my makefile to compile C with just &quot;make&quot;", "body": "<pre><code>CFLAGS = -Wall -g\n\nall: ex1\n\nclean:\n    $(RM) ex1\n\n.PHONY: all clean\n</code></pre>\n\n<p>Fixed my <code>CFLAGS</code> definition at the beginning and added the <code>.PHONY</code> at the end for <code>all</code> and <code>clean</code> so <code>make</code> knows not to make files for these.</p>\n"}, {"tags": [], "owner": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "is_accepted": false, "score": 0, "last_activity_date": 1547076586, "creation_date": 1547076586, "answer_id": 54119962, "question_id": 54119488, "link": "https://stackoverflow.com/questions/54119488/set-up-my-makefile-to-compile-c-with-just-make/54119962#54119962", "title": "Set up my makefile to compile C with just &quot;make&quot;", "body": "<p>For a very simple makefile, I do this:</p>\n\n<pre><code>qsorttest: qsorttest.c \n     gcc -Wall -g qsorttest.c -o qsorttest -lm\n\nclean:\n     rm -f qsorttest\n</code></pre>\n\n<p>\"qsorttest.c\" is the name of my source file and the executable I create is \"qsorttest\"\nBe sure lines under \"program name: source file\" and \"clean:\" are tabbed in and not moved with the space key.  I beat my head against the wall for a while until I googled my way out of that.</p>\n\n<p>I save that as \"Makefile\" in the same directory as my other files for the program and make works every time.  I just change the source file &amp; program names as needed and add extra parameters for linking libraries if I need them.</p>\n"}, {"comments": [{"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 1, "creation_date": 1547200202, "post_id": 54143712, "comment_id": 95119105, "body": "What&#39;s the reason you use <code>$(CC) $(LDFLAGS)</code> rather than the standard <code>$(LINK.o)</code>?  (That prevents a target-specific <code>LINK.o = LINK.cc</code> for linking C++ objects, for example).  Similarly, it&#39;s standard practice to use <code>$(RM)</code> rather than <code>rm -f</code>, though the need to override that is rarer."}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 1, "creation_date": 1547200284, "post_id": 54143712, "comment_id": 95119152, "body": "I&#39;d also use a target-specific <code>bar: LDLIBS += -lm -lintl -lX</code>, but perhaps that&#39;s just a personal preference?"}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "reply_to_user": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1547200371, "post_id": 54143712, "comment_id": 95119192, "body": "Well, there&#39;s a good reason to call the compiler to do the linking phase.  It will include the language runtime modules needed to support that language.  If you call the linker directly, you&#39;ll have to provide those files yourself.  The same applies to the standard C library."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "reply_to_user": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1547200471, "post_id": 54143712, "comment_id": 95119245, "body": "use of a <code>LDLIBS</code> global variable of <code>make</code> doesn&#39;t allow you to specify different libraries for each exacutable.  You can use that for general project libraries, and then have a program-specific set of libraries for each executable.  This is not as important as with the compilation flags, because no automatic rules for linking are normally included by default in <code>make</code>, but it is important on compiling.  As you see, both programs use different objects and libraries."}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1547200867, "post_id": 54143712, "comment_id": 95119489, "body": "Indeed; that&#39;s why I write a <i>target-specific</i> <code>LDLIBS</code>."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "reply_to_user": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1547201144, "post_id": 54143712, "comment_id": 95119649, "body": "yes... but that&#39;s a GNU <code>make</code> extension.  As you see, I was most care of not using GNU make extensions and used the non-preferred old notation of <code>.c.o:</code> target."}], "tags": [], "owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "is_accepted": false, "score": 4, "last_activity_date": 1547199945, "last_edit_date": 1547199945, "creation_date": 1547199140, "answer_id": 54143712, "question_id": 54119488, "link": "https://stackoverflow.com/questions/54119488/set-up-my-makefile-to-compile-c-with-just-make/54143712#54143712", "title": "Set up my makefile to compile C with just &quot;make&quot;", "body": "<p>Your <code>Makefile</code> has no dependency info included in the form of <em>Rules</em>.  Rules are lines beginning at the left column (in column 0) and having a <code>:</code> separator between targets (objects to be built) and requisites (objects provided to the rule)</p>\n\n<p>Make does the chaining of rules so no target can be build before its prerequisites have, so a good starting point would be:</p>\n\n<pre><code>ex1.exe: ex1.o\n</code></pre>\n\n<p>this means that <code>ex1.exe</code> (the first target in your <code>Makefile</code>) depends on <code>ex1.o</code> (the compiled object).... but how.  You add the commands just below, but inserting in front of the command line a tab character:</p>\n\n<pre><code>[tab char]gcc -Wall -g ex1.o -o ex1.exe\n</code></pre>\n\n<p>First of all, see how the command takes <code>ex1.o</code> as input for <code>gcc</code> and generates (by means of option <code>-o</code>) the file <code>ex1.exe</code>.</p>\n\n<p>The meaning of all of this is that always that you lack <code>ex1.exe</code> or it happens to be modified (from its modification date in the file) before the prerequisite (<code>ex1.o</code>) that command will be used.</p>\n\n<p>Now, how we compile the object file? (in your Makefile it is made directly)</p>\n\n<pre><code>ex1.o: ex1.c\n    $(CC) $(CFLAGS) -c -o $@ $&lt;\n</code></pre>\n\n<p>this line needs more explanation (although if you don't use it, it is automatically provided by the <code>make</code> program)  It uses substitution variables: <code>$(CC)</code> expands to the default C compiler (<code>cc</code> normally, but you can change it). <code>$(CFLAGS)</code> is the variable you defined on top of your <code>Makefile</code> and expands to the compiler options used normally to compile programs.  <code>$@</code> is expanded by the target file (in this case, the <code>ex1.o</code> file) and the <code>$&lt;</code>  expands to the left prerequisite of the right part of the rule.  This rule, which is so common to compile C files into object files, is automatically generated for you by <code>make</code>, and more can be created in <code>make</code> advanced used (I'm not going to enter here, due to the amount of space needed)  just to say that it can be written like this:</p>\n\n<pre><code>.c.o:\n    $(CC) $(CFLAGS) -c -o $@ $&lt;\n</code></pre>\n\n<p>which means: any file with extension <code>.o</code> can be created from a file with the same name, but extension <code>.c</code> by using the next command line below.  This makes automatically to depend each <code>.o</code> file of a file with the same name but extension <code>.c</code> and is preloaded in <code>make</code>.</p>\n\n<p>So, your simplest <code>Makefile</code> could be:</p>\n\n<pre><code>CFLAGS=-Wall -g\nsrc=ex1.c\nex1.exe: $(src)\n    $(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(src)\n</code></pre>\n\n<p>as you see I've used a variable <code>src</code> to describe the C source files used to compile my program.  The dependency will be issued <em>only</em> when you have modified any or the prerequisites (there's only one now, on <code>ex1.c</code> but could be more) and as I'm doing compiling and linking in the same compilation, I need to pass the compilation flags and the link flags (not used, you can delete the reference to <code>$(LDFLAGS)</code> here)  Indeed you could have written:</p>\n\n<pre><code>ex1.exe: ex1.c\n     cc -g -Wall -o ex1.exe ex1.c\nclean:\n     rm -f ex1.exe\n</code></pre>\n\n<p>so, the default action is to create <code>ex1.exe</code>, which depends on <code>ex1.c</code> (so only when <code>ex1.c</code> is modified, does <code>ex1.exe</code> is being recompiled.  To compile it, just do:</p>\n\n<pre><code>make ex1.exe\n</code></pre>\n\n<p>or</p>\n\n<pre><code>make\n</code></pre>\n\n<p>that will use the default first rule of the <code>Makefile</code>.</p>\n\n<p><code>clean</code> is a fake target (there's no file called <code>clean</code> to generate) so when you use</p>\n\n<pre><code>make clean\n</code></pre>\n\n<p>its associated command is always executed.  It makes <code>make</code> to delete your target files (as it removes all the make generated files), so next time you run <code>make</code> it will re-create all files by doing the necessary compilations.</p>\n\n<h1>COMMON USE</h1>\n\n<p>For simple programs, let's say, several source <code>.c</code> files, and some <code>.h</code> files, with separate compilation of each (<code>-c</code> option in compilation) and linking, I normally use this approach (definining the object files needed for each target program in a different variable)</p>\n\n<pre><code># makefile for programs foo and bar.\n\ntargets = foo bar\nTOCLEAN = $(TARGETS)  # this variable stores what should be erased on clean target.  Here we store the programs to erase.\n\nfoo_objs = a.o b.o c.o\nTOCLEAN += $(foo_objs)  # here, we add the objects of foo\n\nfoo: $(foo_objs)\n    $(CC) $(LDFLAGS) -o $@ $(foo_objs)\n\nbar_objs = d.o e.o f.o\nbar_libs = -lm -lintl -lX\nTOCLEAN += $(bar_objs)  # here we add the objects of bar\n\nbar: $(bar_objs)\n    $(CC) $(LDFLAGS) -o $@ $(bar_objs) $(bar_libs)\n\nclean:\n    rm -f $(TOCLEAN)\n\na.o b.o c.o: a.h b.h c.h globals.h\nb.o c.o d.o e.o f.o: my_defs.h\n</code></pre>\n\n<p>(as you see, the dependency on the header files is to the compiled object --- not the <code>.c</code> source file... the source file builds the dependency, but is the object file what has to be recreated in case the included file is modified, not the including <code>.c</code> file)</p>\n"}], "owner": {"reputation": 393, "user_id": 10892372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qOkan.jpg?s=128&g=1", "display_name": "Jerry D", "link": "https://stackoverflow.com/users/10892372/jerry-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2048, "favorite_count": 0, "accepted_answer_id": 54119562, "answer_count": 4, "score": 5, "last_activity_date": 1552856348, "creation_date": 1547073898, "last_edit_date": 1552856348, "question_id": 54119488, "link": "https://stackoverflow.com/questions/54119488/set-up-my-makefile-to-compile-c-with-just-make", "title": "Set up my makefile to compile C with just &quot;make&quot;", "body": "<p>I'm doing the Learn C The Hard Way course by Zed Shaw, and on Lesson 2 I find that in the videos and book, the author only uses <code>make ex1</code> to compile his C, while I need to run <code>gcc -Wall -g ex1.c -o ex1</code>. Here is my Makefile, It seems like the first part is what is supposed to make the make command work to compile, but the \"make\" command doesn't compile it.</p>\n\n<pre><code>CFLAGs=-Wall -g\n\nclean:\n    rm -f ex1.exe\n\nall:\n    gcc -Wall -g ex1.c -o ex1.exe\n\n\n\n\n</code></pre>\n"}, {"tags": ["c++", "c", "sockets", "winsock"], "comments": [{"owner": {"reputation": 5195, "user_id": 4005175, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/3N6Ze.jpg?s=128&g=1", "display_name": "Martin Heraleck&#253;", "link": "https://stackoverflow.com/users/4005175/martin-heraleck%c3%bd"}, "edited": false, "score": 4, "creation_date": 1547072745, "post_id": 54119198, "comment_id": 95071166, "body": "Call <code>WSAGetLastError</code> to find out what the error is. <a href=\"https://docs.microsoft.com/cs-cz/windows/desktop/api/winsock/nf-winsock-wsagetlasterror\" rel=\"nofollow noreferrer\">docs.microsoft.com/cs-cz/windows/desktop/api/winsock/&hellip;</a>"}, {"owner": {"reputation": 101, "user_id": 10279509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a253a20d69697ef6e07324f7532a290?s=128&d=identicon&r=PG&f=1", "display_name": "M. Sol", "link": "https://stackoverflow.com/users/10279509/m-sol"}, "edited": false, "score": 2, "creation_date": 1547073049, "post_id": 54119198, "comment_id": 95071273, "body": "Did you include <code>WSAStartup</code> before opening the socket?"}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 1, "creation_date": 1547073169, "post_id": 54119198, "comment_id": 95071309, "body": "<code>sockaddr.sin_port = htons(69);</code>"}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 0, "creation_date": 1547073632, "post_id": 54119198, "comment_id": 95071446, "body": "EDIT 2 is an unrelated issue as originally posted."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "edited": false, "score": 0, "creation_date": 1547074065, "post_id": 54119481, "comment_id": 95071555, "body": "I did that, and it says it completed successfully, so currently I&#39;m trying to figure out if it&#39;s a server side problem."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "reply_to_user": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "edited": false, "score": 0, "creation_date": 1547074199, "post_id": 54119481, "comment_id": 95071597, "body": "@augboi666: Yes, but it would be a different question."}, {"owner": {"reputation": 101, "user_id": 10279509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a253a20d69697ef6e07324f7532a290?s=128&d=identicon&r=PG&f=1", "display_name": "M. Sol", "link": "https://stackoverflow.com/users/10279509/m-sol"}, "reply_to_user": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "edited": false, "score": 0, "creation_date": 1547074231, "post_id": 54119481, "comment_id": 95071609, "body": "@augboi666 a bit confused, you saying there is a problem on creating a socket so how is that possible that the port is opened, are you trying to open a port on already existed socket?"}, {"owner": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "reply_to_user": {"reputation": 101, "user_id": 10279509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a253a20d69697ef6e07324f7532a290?s=128&d=identicon&r=PG&f=1", "display_name": "M. Sol", "link": "https://stackoverflow.com/users/10279509/m-sol"}, "edited": false, "score": 0, "creation_date": 1547074335, "post_id": 54119481, "comment_id": 95071645, "body": "@M.Sol I had a problem connecting the socket to the server. It always return -1 until I did WSAStartup and then htons on the port. Now I am believing that the problem is server side."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "reply_to_user": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "edited": false, "score": 0, "creation_date": 1547074346, "post_id": 54119481, "comment_id": 95071649, "body": "@augboi666: You may also want to <code>memset()</code> the <code>sockaddr</code> to zeros."}, {"owner": {"reputation": 101, "user_id": 10279509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a253a20d69697ef6e07324f7532a290?s=128&d=identicon&r=PG&f=1", "display_name": "M. Sol", "link": "https://stackoverflow.com/users/10279509/m-sol"}, "reply_to_user": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "edited": false, "score": 0, "creation_date": 1547074450, "post_id": 54119481, "comment_id": 95071680, "body": "@augboi666 Ok got it, then please share with us part of server side otherwise can&#39;t help any further, everything seems good here."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "reply_to_user": {"reputation": 101, "user_id": 10279509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a253a20d69697ef6e07324f7532a290?s=128&d=identicon&r=PG&f=1", "display_name": "M. Sol", "link": "https://stackoverflow.com/users/10279509/m-sol"}, "edited": false, "score": 0, "creation_date": 1547074586, "post_id": 54119481, "comment_id": 95071712, "body": "@M.Sol: If the issue is now debugging the server, it is better to ask a new question."}], "tags": [], "owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "is_accepted": false, "score": 0, "last_activity_date": 1547073860, "creation_date": 1547073860, "answer_id": 54119481, "question_id": 54119198, "link": "https://stackoverflow.com/questions/54119198/winsock-always-returning-1-on-socket/54119481#54119481", "title": "winsock always returning -1 on socket", "body": "<p>Berkeley sockets require the address and port information to be presented in network byte order. Winsock follows this API:</p>\n\n<blockquote>\n  <p>All of the data in the SOCKADDR_IN structure, except for the address family, must be specified in network-byte-order (big-endian).<br>\n  <sub><a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/ws2def/ns-ws2def-sockaddr_in\" rel=\"nofollow noreferrer\">Windows Dev Center</a></sub></p>\n</blockquote>\n\n<p>Use <code>htons()</code> to convert the port value from host to network byte order.</p>\n\n<pre><code>sockaddr.sin_port = htons(69);\n</code></pre>\n\n<p><code>inet_addr()</code> already returns a value in network byte order.</p>\n"}, {"tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": false, "score": 1, "last_activity_date": 1547075887, "creation_date": 1547075887, "answer_id": 54119842, "question_id": 54119198, "link": "https://stackoverflow.com/questions/54119198/winsock-always-returning-1-on-socket/54119842#54119842", "title": "winsock always returning -1 on socket", "body": "<p>Your error handling is a bit lacking.</p>\n\n<p>First off, when an error does occur, STOP what you are doing. Right now, you are not stopping, you just move on to the next API call as if no error occured.</p>\n\n<p>Second, your error handling on <code>connect()</code> is wrong. <code>connect()</code> returns 0 on success and -1 on failure, but you are checking its return value for <code>!= 1</code> so you are going to treat successes and failures the same way.</p>\n\n<p>Try this instead:</p>\n\n<pre><code>static SOCKET establishconn(const char *addr, u_short port)\n{\n    SOCKET commsock = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);\n    if (commsock == INVALID_SOCKET)\n        return INVALID_SOCKET;\n\n    //OutputDebugStringA(addr);\n\n    SOCKADDR_IN sockaddr = {};\n    sockaddr.sin_family = AF_INET;\n    sockaddr.sin_port = htons(port);\n    sockaddr.sin_addr.s_addr = inet_addr(addr);\n\n    if (sockaddr.sin_addr.s_addr == INADDR_NONE)\n    {\n        struct hostent *host = gethostbyname(addr);\n        if (!host)\n        {\n            closesocket(commsock);\n            return INVALID_SOCKET;\n        }\n        sockaddr.sin_addr.s_addr = *((u_long*) host-&gt;h_addr);\n    }\n\n    if (connect(commsock, (SOCKADDR &amp;sockaddr, sizeof(sockaddr)) == SOCKET_ERROR)\n    {\n        closesocket(commsock);\n        return INVALID_SOCKET;\n    }\n\n    return commsock;\n}\n</code></pre>\n\n<p>Then you can do this:</p>\n\n<pre><code>WSAStartup(...);\n...\nSOCKET maincommsock = establishconn(\"127.0.0.1\", 69);\nif (maincommsock != INVALID_SOCKET)\n{\n    ...\n    closesocket(maincommsock);\n}\n...\nWSACleanup();\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10892301, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GXVxbhXS9MQ/AAAAAAAAAAI/AAAAAAAAABA/jGRBhP1Afy4/photo.jpg?sz=128", "display_name": "augboi666", "link": "https://stackoverflow.com/users/10892301/augboi666"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1547130268, "creation_date": 1547072251, "last_edit_date": 1547130268, "question_id": 54119198, "link": "https://stackoverflow.com/questions/54119198/winsock-always-returning-1-on-socket", "title": "winsock always returning -1 on socket", "body": "<p>I'm trying to connect to my server on port 69 using winsock2.h. Everything appears to be compiling correctly but in a debugger maincommsock is always equal to -1. I can't seem to figure out why it isn't working, and need help. Not very experienced with socket programming, and not sure what to do now!. Any help will be greatly appreciated.</p>\n\n<p>I'm not 100% sure what else to try. This is basically a function that establishes a connection on a socket, and sets connection to true, so that it can loop until it connects.</p>\n\n<pre><code>    int maincommsock;\n    bool connection = false;\n\nstatic void establishconn() {\n    maincommsock = socket(AF_INET, SOCK_STREAM, 0);\n    if (maincommsock == -1) {\n        connection = false;\n    }\n\n    //OutputDebugString((LPCSTR)commservers[1]);\n\n    /*\n    struct hostent *host;\n    if ((host = gethostbyname(SERV_ADDR)) == NULL) {\n        connection = FALSE;\n    }\n    */\n    SOCKADDR_IN sockaddr;\n    sockaddr.sin_port = 69;\n    sockaddr.sin_family = AF_INET;\n    sockaddr.sin_addr.s_addr = inet_addr(\"127.0.0.1\");\n    //sockaddr.sin_addr.s_addr = *((unsigned long*)host-&gt;h_addr);\n    if (connect(maincommsock, (SOCKADDR *)(&amp;sockaddr), sizeof(sockaddr)) != 1) {\n        connection = true;\n    }\n}\n</code></pre>\n\n<p>EDIT</p>\n\n<p>I used WSAStartup, and the error I'm currently getting is No connection could be made because the target machine actively refused it.\"</p>\n\n<p>EDIT 2</p>\n\n<p>used htons on the port. It says the operation completed successfully but no connections show up on the server</p>\n\n<p>EDIT 3</p>\n\n<p>I'm going to test it on linux, to make sure that it is actually a server side error and not a problem with my code. I'll keep you guys updated.</p>\n"}, {"tags": ["c", "file", "io", "binary"], "comments": [{"owner": {"reputation": 2784, "user_id": 8413636, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8c46d1ea221e93d32a1b3d2ee354cae?s=128&d=identicon&r=PG&f=1", "display_name": "zzxyz", "link": "https://stackoverflow.com/users/8413636/zzxyz"}, "edited": false, "score": 2, "creation_date": 1547072233, "post_id": 54119169, "comment_id": 95070983, "body": "The easy normal way is to use a cross-platform serialization library like msgpack or Google protocol buffers"}, {"owner": {"reputation": 17, "user_id": 3984819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa5f30e9b0bd3eea0bf40aa570025c8?s=128&d=identicon&r=PG&f=1", "display_name": "nc404", "link": "https://stackoverflow.com/users/3984819/nc404"}, "reply_to_user": {"reputation": 2784, "user_id": 8413636, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8c46d1ea221e93d32a1b3d2ee354cae?s=128&d=identicon&r=PG&f=1", "display_name": "zzxyz", "link": "https://stackoverflow.com/users/8413636/zzxyz"}, "edited": false, "score": 0, "creation_date": 1547072502, "post_id": 54119169, "comment_id": 95071089, "body": "Interesting, I&#39;ll check it out."}, {"owner": {"reputation": 2784, "user_id": 8413636, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8c46d1ea221e93d32a1b3d2ee354cae?s=128&d=identicon&r=PG&f=1", "display_name": "zzxyz", "link": "https://stackoverflow.com/users/8413636/zzxyz"}, "edited": false, "score": 0, "creation_date": 1547073025, "post_id": 54119169, "comment_id": 95071261, "body": "it&#39;s overkill if the <i>only</i> thing you need to serialize is doubles, but that&#39;s exceedingly unlikely."}, {"owner": {"reputation": 17, "user_id": 3984819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa5f30e9b0bd3eea0bf40aa570025c8?s=128&d=identicon&r=PG&f=1", "display_name": "nc404", "link": "https://stackoverflow.com/users/3984819/nc404"}, "reply_to_user": {"reputation": 2784, "user_id": 8413636, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8c46d1ea221e93d32a1b3d2ee354cae?s=128&d=identicon&r=PG&f=1", "display_name": "zzxyz", "link": "https://stackoverflow.com/users/8413636/zzxyz"}, "edited": false, "score": 0, "creation_date": 1547073490, "post_id": 54119169, "comment_id": 95071398, "body": "Yeah I actually need to write some integers too, except I thought I had that figured out since there are fixed size integer data types provided (int16_t, int32_t) but I forgot that the endianness can change from machine to machine. So I&#39;ll probably use msgpack. Thanks1"}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1547074290, "post_id": 54119169, "comment_id": 95071626, "body": "You&#39;re trying to save space because storage is so expensive?  Are you writing out more than 1 million doubles?  Just use a JSON library."}, {"owner": {"reputation": 17, "user_id": 3984819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa5f30e9b0bd3eea0bf40aa570025c8?s=128&d=identicon&r=PG&f=1", "display_name": "nc404", "link": "https://stackoverflow.com/users/3984819/nc404"}, "edited": false, "score": 0, "creation_date": 1547074721, "post_id": 54119169, "comment_id": 95071759, "body": "Yeah I do write a lot of doubles. Why JSON and why not msgpack?"}, {"owner": {"reputation": 2784, "user_id": 8413636, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8c46d1ea221e93d32a1b3d2ee354cae?s=128&d=identicon&r=PG&f=1", "display_name": "zzxyz", "link": "https://stackoverflow.com/users/8413636/zzxyz"}, "edited": false, "score": 0, "creation_date": 1547079742, "post_id": 54119169, "comment_id": 95072951, "body": "@nc404 - Typical usage of JSON will make your data 1) somewhat self-documenting, 2) human readable, 3) easily changeable, 4) readable by many languages, and 5) readable by many languages natively and 6) without compilation changes automatically required for data changes.  It&#39;s also (usually) 7) larger and slower.  Typical usage of google protocol buffers will give you 1, 3, &amp; 4."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1547088583, "post_id": 54119169, "comment_id": 95074753, "body": "It is not possible to write <code>double</code> values in a format that is universally portable across C implementations. Proof: C defines a floating-point value to be a numeral in a base multiplied by the base to a power (C 2018 5.2.4.2.2 3). The numeral length and the base are implementation-defined. Some numbers that are representable in one C implementation, such as 1/10 in a base-ten implementation, are not representable in others. Therefore, regardless of what string is written to a file, it is not possible to reconstruct the value in a C implementation that uses binary floating-point."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1547088765, "post_id": 54119169, "comment_id": 95074780, "body": "If you can assume the systems involved use the same binary-base format for <code>double</code> (or at least use some binary-base format and each system is capable of representing all required values), then use the <code>%a</code> format for input and output. This uses a hexadecimal notation that represents values easily and exactly (that is, without any rounding needed)."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1547088912, "post_id": 54119169, "comment_id": 95074802, "body": "If you need to compress further than that, and again can assume a binary base, then write a bit for the sign, the bits for the significand, and the exponent in binary. You can obtain the bits for the significand and the exponent using <code>frexp</code>. You will need to decide how to encode NaNs and infinities."}, {"owner": {"reputation": 2784, "user_id": 8413636, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8c46d1ea221e93d32a1b3d2ee354cae?s=128&d=identicon&r=PG&f=1", "display_name": "zzxyz", "link": "https://stackoverflow.com/users/8413636/zzxyz"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1548462354, "post_id": 54119169, "comment_id": 95563339, "body": "@EricPostpischil - I&#39;ve been pondering your comments.  If we assume typical double usage where the range and precision of a 4-byte float is insufficient, but the range and precision of an 8-byte float is massive overkill, such a case being able to translate <code>124.56054</code> from <code>text</code> to <code>IEEE double</code> to <code>base-ten double</code> back to <code>IEEE double</code> and back to <code>text</code> without the text changing, could we then consider an implementation &quot;portable enough&quot; for a specific use/implementation?  I&#39;m assuming your definition of <code>portable</code> is very strict, and would like to make sure that&#39;s correct."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 2784, "user_id": 8413636, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8c46d1ea221e93d32a1b3d2ee354cae?s=128&d=identicon&r=PG&f=1", "display_name": "zzxyz", "link": "https://stackoverflow.com/users/8413636/zzxyz"}, "edited": false, "score": 0, "creation_date": 1548472426, "post_id": 54119169, "comment_id": 95564974, "body": "@zzxyz: It is likely some portable representation can be defined, but the problem statement needs clarification. I am not sure what is meant by going from text to IEEE double to base-ten double to IEEE double to text. That is more conversions than is needed for \u201cI have a floating-point value in my program, and I write some data to a file, and I read it in another program, and I end with the original value (or something within a defined distance) in the new program.\u201d"}, {"owner": {"reputation": 2784, "user_id": 8413636, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8c46d1ea221e93d32a1b3d2ee354cae?s=128&d=identicon&r=PG&f=1", "display_name": "zzxyz", "link": "https://stackoverflow.com/users/8413636/zzxyz"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1548702675, "post_id": 54119169, "comment_id": 95628234, "body": "@EricPostpischil (I was imagining a trip from one computer&#39;s UI to maybe a weird server back to another computer&#39;s UI).  I think your first sentence answers my question well enough for my purposes, which is basically idle curiosity :)"}], "answers": [{"tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": false, "score": 0, "last_activity_date": 1547072410, "creation_date": 1547072410, "answer_id": 54119245, "question_id": 54119169, "link": "https://stackoverflow.com/questions/54119169/how-to-portably-write-double-data-type-to-file-in-c/54119245#54119245", "title": "How to portably write double data type to file in C", "body": "<p>You can always externalize the number according to IEEE 754. This is also the most used format in current CPUs, but if you want to be portable, you have to calculate the relevant fields (sign/exponent/fraction) in the required precision programmatically instead of directly using the in-memory representation of the current platform.</p>\n\n<p>Another alternative is using fixed-point numbers. If the number range and precision you want to represent allows it, this might be the easier alternative.</p>\n"}, {"comments": [{"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1547088993, "post_id": 54119749, "comment_id": 95074816, "body": "C has <code>frexp</code> to provide the significand and the exponent; there is no need for unions or assuming an IEEE-754 format."}], "tags": [], "owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "is_accepted": false, "score": 0, "last_activity_date": 1547075374, "creation_date": 1547075374, "answer_id": 54119749, "question_id": 54119169, "link": "https://stackoverflow.com/questions/54119169/how-to-portably-write-double-data-type-to-file-in-c/54119749#54119749", "title": "How to portably write double data type to file in C", "body": "<p>If the machine you're using to serialize the <code>double</code> value uses IEEE 754 double precision for <code>double</code> values, you can store the sign, exponent, and mantissa separately, so that you can use that information to rebuild the double value in whatever other system you want to load it on:</p>\n\n<pre><code>typedef union _DI\n{\n    double d;\n    uint64_t bits;\n} DI;\n\n\nDI foo;\nuint64_t mask = 0x8000000000000000, sign, exp, mantissa, base;\nint i;\n\nfoo.d = 3.141;\nsign = !!(foo.bits &amp; mask);\n\nmask = 0x7FF0000000000000;\nexp = ((foo.bits &amp; mask) &gt;&gt; 52) - 1023;\n\nmask = 0x000FFFFFFFFFFFFF;\nmantissa = (foo.bits &amp; mask);\n</code></pre>\n\n<p>Do note that the mantissa needs to be <a href=\"https://stackoverflow.com/questions/28800565/how-to-normalize-a-mantissa\">normalized</a> as well.</p>\n"}, {"tags": [], "owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "is_accepted": false, "score": 0, "last_activity_date": 1547194232, "creation_date": 1547194232, "answer_id": 54142597, "question_id": 54119169, "link": "https://stackoverflow.com/questions/54119169/how-to-portably-write-double-data-type-to-file-in-c/54142597#54142597", "title": "How to portably write double data type to file in C", "body": "<p>The easy answer is no.  There's no binary portable way to write floating point numbers in binary form.  Even if you follow the IEEE-752 document, you'll find that you can store the bytes conforming a floating point in different orders (like big/little endian forms for integers)</p>\n\n<p>There are several IETF protocols (most notable IPFIX protocol) that define a format for transmitting IEEE-752 floating point numbers into what is called (there) network format.  This forces the number to be written in a major to minor weight basis, but for example this forces low endian machines (like intel's) to swap the bytes on reading/writing to the wire.</p>\n\n<p>So, what is the people doing? well, if you want to conserve your data, you had better to define your own format and follow it always in your projects. In a way independent of the architecture.  If you have the luck of being the first, when others need to access your data, you can tell them the way those data is stored and all can follow your specification, instead of being you who has to adapt to theirs.</p>\n"}], "owner": {"reputation": 17, "user_id": 3984819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa5f30e9b0bd3eea0bf40aa570025c8?s=128&d=identicon&r=PG&f=1", "display_name": "nc404", "link": "https://stackoverflow.com/users/3984819/nc404"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 157, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1547194232, "creation_date": 1547072043, "question_id": 54119169, "link": "https://stackoverflow.com/questions/54119169/how-to-portably-write-double-data-type-to-file-in-c", "title": "How to portably write double data type to file in C", "body": "<p>I need to store <code>double</code> values in a file in a way that will be portable. I know I can just write them in human readable form like <code>1.23456789</code>, but I am hoping to save space by writing them as binary.</p>\n\n<p>I know how to write binary to a file, but is there a way to do that in a way in which the resulting file will be the same regardless of the machine on which the code was compiled and executed? I am hoping to be able to read/write such files across machines in this way.</p>\n"}, {"tags": ["c", "printf"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 6, "creation_date": 1547070967, "post_id": 54118934, "comment_id": 95070479, "body": "The first char of <code>&quot;255&quot;</code> is <code>&#39;2&#39;</code>  which has the value <code>50</code> in ascii."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1547071246, "post_id": 54118934, "comment_id": 95070599, "body": "@tkausl What keeps you from making an answer?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1547071746, "post_id": 54118934, "comment_id": 95070784, "body": "Will you <i>ever</i> get <code>255</code> by using a different format specifier? The <code>char</code> is presumed signed, since you use an <code>(unsigned char)</code> cast rather than <code>(char)</code>. So you would get <code>-1</code>."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1547079873, "post_id": 54118934, "comment_id": 95072979, "body": "<code>buffer[1]</code> has type <code>char</code>, it is literally impossible for it to store 255 (assuming your system has plain char as signed)"}, {"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1547133732, "post_id": 54118934, "comment_id": 95094849, "body": "@M.M - yes that is why I was trying to use an usigned char. I&#39;ve figured it out and you can see my solution in my answer."}], "answers": [{"comments": [{"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 0, "creation_date": 1547074851, "post_id": 54119143, "comment_id": 95071792, "body": "Right, but doing that does not return 255 in the variable &#39;length_rc&#39;. Please see modified code above. And if I change &#39;length&#39; to 127 (largest signed character number) output is produced as expected."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 1, "creation_date": 1547075409, "post_id": 54119143, "comment_id": 95071941, "body": "I see the problem. The buffer is <code>char[]</code>, not <code>unsigned char[]</code>. So <code>buffer[1]</code> is signed. Storing <code>255</code> into the buffer results in undefined behavior."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 1, "creation_date": 1547075852, "post_id": 54119143, "comment_id": 95072054, "body": "I&#39;ve updated the answer to show how you can do this more safely."}, {"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 0, "creation_date": 1547096200, "post_id": 54119143, "comment_id": 95076155, "body": "Thanks a ton @Bamar - i&#39;ve incorporated your solution. My post is updated to reflect the working changes."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 1, "creation_date": 1547102322, "post_id": 54119143, "comment_id": 95077808, "body": "You should put the working solution in an answer, not the question."}, {"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 0, "creation_date": 1547133885, "post_id": 54119143, "comment_id": 95094935, "body": "Done. Thanks again."}], "tags": [], "owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "is_accepted": true, "score": 3, "last_activity_date": 1547075833, "last_edit_date": 1547075833, "creation_date": 1547071927, "answer_id": 54119143, "question_id": 54118934, "link": "https://stackoverflow.com/questions/54118934/unsigned-characters-and-sprintf-c/54119143#54119143", "title": "unsigned characters and sprintf() C", "body": "<p>I don't think you can use <code>sprintf()</code> to store <code>255</code> into the buffer. The buffer argument to <code>sprintf()</code> is a <code>char</code> array. Whether <code>char</code> is <code>signed</code> or <code>unsigned</code> by default is implementation-defined; see <a href=\"https://stackoverflow.com/questions/2054939/is-char-signed-or-unsigned-by-default\">Is char signed or unsigned by default?</a>. If  <code>255</code> is greater than <code>CHAR_MAX</code>, trying to store <code>255</code> results in undefined behavior; if the implementation defaults to <code>signed</code> then <code>CHAR_MAX</code> will probably be <code>127</code>.</p>\n\n<p>I suggest not using <code>sprintf()</code> to store numbers into the buffer. Declare it as:</p>\n\n<pre><code>unsigned char buffer[127];\n</code></pre>\n\n<p>Then you can do:</p>\n\n<pre><code>buffer[0] = port;\nbuffer[1] = length;\nsnprintf((char *)(buffer + 2), sizeof buffer - 2, \"%s\", record);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "is_accepted": false, "score": 0, "last_activity_date": 1547133860, "creation_date": 1547133860, "answer_id": 54131851, "question_id": 54118934, "link": "https://stackoverflow.com/questions/54118934/unsigned-characters-and-sprintf-c/54131851#54131851", "title": "unsigned characters and sprintf() C", "body": "<p>WORKING SOLUTION:</p>\n\n<pre><code>int main(){\n\nunsigned char buffer[1024];\nchar port = 1;\nint length = 255;\nchar * record = \"$TAG ,0 ,89 ,0, 1\\n\";\n\nif(length &lt; 0 || length &gt; 255){\n    printf(\"Error - length out of range for an unsigned char.\\n\");\n    exit(1);\n}\n\nbuffer[0] = port;\nbuffer[1] = length;\nsnprintf((char *)(buffer), sizeof buffer - 2, \"%c%c%s\", port,length,record);\n\nint port_rc     = buffer[0];\nint length_rc   = buffer[1]; \nchar char_first = buffer[2];\n\nprintf(\"port_rc: %d\\n\",port_rc);\nprintf(\"length_rc: %d\\n\",length_rc);\nprintf(\"char_first: %c\\n\",char_first);\n\n\nreturn 0;\n</code></pre>\n\n<p>}</p>\n\n<p>RETURNS:</p>\n\n<p><code>port_rc: 1\nlength_rc: 255\nchar_first: $\n</code></p>\n"}, {"comments": [{"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 0, "creation_date": 1548176531, "post_id": 54132407, "comment_id": 95446280, "body": "I agree but I do make sure the valid return is 0-255 to make sure."}], "tags": [], "owner": {"reputation": 7429, "user_id": 4811873, "user_type": "registered", "accept_rate": 6, "profile_image": "https://www.gravatar.com/avatar/2ef5bab087ac0b70e03e34b0b0009fd5?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Robinson", "link": "https://stackoverflow.com/users/4811873/mike-robinson"}, "is_accepted": false, "score": 1, "last_activity_date": 1547135725, "creation_date": 1547135725, "answer_id": 54132407, "question_id": 54118934, "link": "https://stackoverflow.com/questions/54118934/unsigned-characters-and-sprintf-c/54132407#54132407", "title": "unsigned characters and sprintf() C", "body": "<p><em>\"Be careful, though,\"</em> when judging such a \"solution.\"</p>\n\n<p>In my humble, the root problem \u2013 in your original post - is that the variables <code>port_rc</code> and <code>length_rc</code> should have been declared as <em>unsigned</em> integers. You do not want a value such as <code>$FF</code> to be erroneously \"sign-extended\" to become <code>$FFFFFFFF == -1</code> ...</p>\n\n<p>Your \"solution\" is quite different from the original because, as you see, it now <em>stores into</em> both <code>buffer[0]</code> and <code>buffer[1]</code> before then retrieving and examining those values!</p>\n"}], "owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 644, "favorite_count": 0, "accepted_answer_id": 54119143, "answer_count": 3, "score": 2, "last_activity_date": 1547135725, "creation_date": 1547070826, "last_edit_date": 1547133903, "question_id": 54118934, "link": "https://stackoverflow.com/questions/54118934/unsigned-characters-and-sprintf-c", "title": "unsigned characters and sprintf() C", "body": "<p>I have this code:</p>\n\n<pre><code>int main(){\n\nchar buffer[1024];\nchar port = 1;\nint length = 255;\nchar * record = \"$TAG ,0 ,89 ,0, 1\\n\";\n\nif(length &lt; 0 || length &gt; 255){\n    printf(\"Error - length out of range for an unsigned char.\\n\");\n    exit(1);\n}\n\nsnprintf(buffer, 1024, \"%c%c%s\", port, (unsigned char) length, record);\n\nint port_rc     = buffer[0];\nint length_rc   = buffer[1]; \n\nprintf(\"port_rc: %d\\n\",port_rc);\nprintf(\"length_rc: %d\\n\",length_rc);\n\nreturn 0;\n</code></pre>\n\n<p>}</p>\n\n<p>Output when I run it:</p>\n\n<p><code>port_rc: 1\nlength_rc: -1</code> </p>\n\n<p>I think I am missing something here in terms of snprintf() as i'm not seeing the 255 value when reading the array it created back. My guess is that snprintf() is promoting the variable 'length' to an int or something. Does anyone know how I can achieve this?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["c", "embedded", "misra"], "comments": [{"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 2, "creation_date": 1547162138, "post_id": 54118906, "comment_id": 95108041, "body": "You should not be using SO as a MISRA C training course - you are posting many similar questions."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1547162350, "post_id": 54118906, "comment_id": 95108095, "body": "The note 9075 in case 1 refers to <i>main.c</i> : you have posted code form test.c - we have to conclude that this is not the same code.  The second cse does not mention a source file at all.  Are you sure you have transcribed these reports verbatim?"}, {"owner": {"reputation": 415, "user_id": 10669327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6051fc808e6d6c453bf165e339d09a6a?s=128&d=identicon&r=PG&f=1", "display_name": "raj123", "link": "https://stackoverflow.com/users/10669327/raj123"}, "reply_to_user": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1547177698, "post_id": 54118906, "comment_id": 95111478, "body": "Here I posted demo code for issue regarding to particular variable declaration and solution  given by John is working fine@Clifford"}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 1, "creation_date": 1547193897, "post_id": 54118906, "comment_id": 95116054, "body": "yes, but John had to provide two possible solutions because from the fragment, it was not possible to determine how you were using buf that would cause this error. We should not have to guess. Moreover my point stands, if you minimise the code, the error message should refer to that code, not to some other code. You need to demonstrate that the &quot;demo&quot; code reproduced the error, and that you have provided everything necessary to reproduce the error. This fragment alone would not do that. You have removed all necessary context. It is how you have used buf that causes this error, not this alone."}, {"owner": {"reputation": 415, "user_id": 10669327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6051fc808e6d6c453bf165e339d09a6a?s=128&d=identicon&r=PG&f=1", "display_name": "raj123", "link": "https://stackoverflow.com/users/10669327/raj123"}, "reply_to_user": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1547587873, "post_id": 54118906, "comment_id": 95240829, "body": "Ok  I got your point. @Clifford"}], "answers": [{"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 4, "last_activity_date": 1547071473, "creation_date": 1547071473, "answer_id": 54119071, "question_id": 54118906, "link": "https://stackoverflow.com/questions/54118906/how-to-resolve-misra-c2012-rule8-4/54119071#54119071", "title": "How to resolve MISRA C:2012 Rule:8.4?", "body": "<blockquote>\n  <p>How can I define it an another way so it will follow MISRA rule ?</p>\n</blockquote>\n\n<p><strong>If the array is meant to be accessed by code from multiple different files</strong>, then put a declaration of it into <code>header.h</code>:</p>\n\n<pre><code>extern uint32_t buf[BUF_SIZE];\n</code></pre>\n\n<p>Do not omit the <code>extern</code>.  Do not omit the array size, although standard C permits doing so.  Keep the definition already present in the .c file, unmodified.</p>\n\n<p><strong>If the array is meant for use only in the file in which it is declared</strong>, then make it static:</p>\n\n<pre><code>static uint32_t buf[BUF_SIZE];\n</code></pre>\n\n<p><em>Do not</em> declare it in any header in this case.</p>\n"}], "owner": {"reputation": 415, "user_id": 10669327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6051fc808e6d6c453bf165e339d09a6a?s=128&d=identicon&r=PG&f=1", "display_name": "raj123", "link": "https://stackoverflow.com/users/10669327/raj123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4028, "favorite_count": 1, "accepted_answer_id": 54119071, "answer_count": 1, "score": -1, "last_activity_date": 1547162385, "creation_date": 1547070704, "last_edit_date": 1547162385, "question_id": 54118906, "link": "https://stackoverflow.com/questions/54118906/how-to-resolve-misra-c2012-rule8-4", "title": "How to resolve MISRA C:2012 Rule:8.4?", "body": "<p>I have a C code which I am trying to make it MISRA Compliance.I am getting following error in two different case:</p>\n\n<p>Case 1]note 9075: external symbol 'buf' defined without a prior declaration [MISRA 2012 Rule 8.4, required] uint32_t buf[BUF_SIZE](in main.c);</p>\n\n<p>How can I define it an another way so it will follow MISRA rule ?</p>\n\n<p>Case 2] note 9075: external symbol 'buf' defined without a prior declaration [MISRA 2012 Rule 8.4, required] uint32_t buf[64U];</p>\n\n<pre><code>case1:\nheader.h\n#define BUF_SIZE 64U\ntest.c\n#include \"header.h\"\nuint32_t buf[BUF_SIZE];\n\ncase2:\ntest.c\nuint32_t buf[64U];\n</code></pre>\n"}, {"tags": ["c", "linux", "debugging", "sleep", "blocking"], "comments": [{"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1547196120, "post_id": 54118358, "comment_id": 95117006, "body": "Do you have some code to show?  please have a look at <a href=\"https://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example</a>"}, {"owner": {"reputation": 10901, "user_id": 578749, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/40231a11da5f1c627fd21d6700edddff?s=128&d=identicon&r=PG", "display_name": "lvella", "link": "https://stackoverflow.com/users/578749/lvella"}, "reply_to_user": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1547202936, "post_id": 54118358, "comment_id": 95120716, "body": "Not really. It is a huge old code, and this a question about debuging and finding something inside it."}], "answers": [{"tags": [], "owner": {"reputation": 100758, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": true, "score": 3, "last_activity_date": 1547068521, "creation_date": 1547068521, "answer_id": 54118469, "question_id": 54118358, "link": "https://stackoverflow.com/questions/54118358/on-what-calls-the-process-is-blocking/54118469#54118469", "title": "On what call(s) the process is blocking?", "body": "<p><code>strace</code> is an option:</p>\n\n<pre><code>$ strace -wc sleep 1\n% time     seconds  usecs/call     calls    errors syscall\n------ ----------- ----------- --------- --------- ----------------\n 99.96    1.000146     1000146         1           nanosleep\n  0.01    0.000131         131         1           execve\n  0.01    0.000082          10         8           mmap\n[...]\n</code></pre>\n"}], "owner": {"reputation": 10901, "user_id": 578749, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/40231a11da5f1c627fd21d6700edddff?s=128&d=identicon&r=PG", "display_name": "lvella", "link": "https://stackoverflow.com/users/578749/lvella"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 54118469, "answer_count": 1, "score": 3, "last_activity_date": 1547068521, "creation_date": 1547067948, "question_id": 54118358, "link": "https://stackoverflow.com/questions/54118358/on-what-calls-the-process-is-blocking", "title": "On what call(s) the process is blocking?", "body": "<p>I have a program that should be CPU bound, but it is using well less than 100% CPU, and is not consuming input as fast as it can. It means my process is blocking or sleeping somewhere.</p>\n\n<p>How to find what calls are blocking my process for the most time? Is there a tool or debugging procedure that measures the time how much time the process is asleep on each blocking system call?</p>\n"}, {"tags": ["c", "dbus", "bluez", "gdbus"], "answers": [{"comments": [{"owner": {"reputation": 492, "user_id": 2292492, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/CD9c7.jpg?s=128&g=1", "display_name": "deltamind106", "link": "https://stackoverflow.com/users/2292492/deltamind106"}, "edited": false, "score": 0, "creation_date": 1547131067, "post_id": 54118762, "comment_id": 95093140, "body": "Okay that&#39;s what I was assuming I could avoid.  I figured that among the plethora of gdbus API functions, surely there would be a way to discover an object&#39;s child nodes without resorting to parsing a giant XML string, with piles of irrelevant data.  If gdbus API designers decided that this should be the best-practice way to discover child nodes in a tree, then boy they must need a lesson in KISS design."}, {"owner": {"reputation": 492, "user_id": 2292492, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/CD9c7.jpg?s=128&g=1", "display_name": "deltamind106", "link": "https://stackoverflow.com/users/2292492/deltamind106"}, "edited": false, "score": 0, "creation_date": 1547131307, "post_id": 54118762, "comment_id": 95093294, "body": "Of course if this is the best way to discover child nodes, then that leads to the next question of the best-practice method for keeping updated as child nodes appear/vanish.  Of course there is the signal_subscribe API, but this only tells you when new nodes appear (it doesn&#39;t tell you about pre-existing nodes).  But that is another question, so I will ask it separately."}], "tags": [], "owner": {"reputation": 5566, "user_id": 530160, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/xRnFS.jpg?s=128&g=1", "display_name": "Nick ODell", "link": "https://stackoverflow.com/users/530160/nick-odell"}, "is_accepted": true, "score": 1, "last_activity_date": 1547069995, "creation_date": 1547069995, "answer_id": 54118762, "question_id": 54118348, "link": "https://stackoverflow.com/questions/54118348/what-gdbus-function-returns-a-list-of-child-object-nodes/54118762#54118762", "title": "What gdbus function returns a list of child object nodes?", "body": "<p>I think your best bet is to use the built-in XML parser. It's how the <code>gdbus introspect</code> command line tool is implemented.</p>\n\n<p>Call the <a href=\"https://developer.gnome.org/gio/stable/gio-D-Bus-Introspection-Data.html#g-dbus-node-info-new-for-xml\" rel=\"nofollow noreferrer\">g_dbus_node_info_new_for_xml</a> function to parse the XML. This give you back a <code>GDBusNodeInfo</code>, which you must free with <code>g_dbus_node_info_unref()</code>. The best example I can find of how to use it is <a href=\"https://github.com/GNOME/glib/blob/cbfa776fc149fcc3e351fbdf68c1a299519f4905/gio/gdbus-tool.c#L261\" rel=\"nofollow noreferrer\">here</a>, which parses the XML, then loops through the <code>nodes</code> element of the struct that's returned.</p>\n"}], "owner": {"reputation": 492, "user_id": 2292492, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/CD9c7.jpg?s=128&g=1", "display_name": "deltamind106", "link": "https://stackoverflow.com/users/2292492/deltamind106"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 54118762, "answer_count": 1, "score": 0, "last_activity_date": 1547069995, "creation_date": 1547067913, "question_id": 54118348, "link": "https://stackoverflow.com/questions/54118348/what-gdbus-function-returns-a-list-of-child-object-nodes", "title": "What gdbus function returns a list of child object nodes?", "body": "<p>I am able to introspect a DBus node, and get some XML which includes information about the child nodes.  However, this requires me to parse XML, and I'm trying to keep the application lightweight.  What gdbus function can I use to simply get a list of child node object names?</p>\n\n<p>Here is the code that fetches the XML.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;gio/gio.h&gt;\n\nint main(int argc,char *argv[])\n{\nGError *err=NULL;\nGVariant *result;\nGDBusConnection *c;\nconst char *xml;\n\n    if ((c = g_bus_get_sync(G_BUS_TYPE_SYSTEM,NULL,&amp;err)) == NULL) {\n        if (err) fprintf(stderr,\"g_bus_get error: %s\\n\",err-&gt;message);\n        exit(1);\n    } /* if */\n    result = g_dbus_connection_call_sync(c,\"org.bluez\",\"/org/bluez\",\n                        \"org.freedesktop.DBus.Introspectable\",\n                        \"Introspect\",NULL,G_VARIANT_TYPE(\"(s)\"),\n                        G_DBUS_CALL_FLAGS_NONE,3000,NULL,&amp;err);\n    if (result==NULL) {\n        if (err) fprintf(stderr,\"gbus_connection_call error: %s\\n\",\n            err-&gt;message);\n        exit(1);\n    } /* if */\n    g_variant_get(result,\"(&amp;s)\",&amp;xml);\n    printf(\"%s\\n\",xml);\n    exit(0);\n}\n</code></pre>\n\n<p>So the above code works.  Deep down in the returned XML there are elements describing the children of the org.bluez object node.  In my case there is an element like this:</p>\n\n<pre><code>&lt;node name=\"hci0\"&gt;&lt;/node&gt;.\n</code></pre>\n\n<p>However, I don't want to parse the XML to find this.  What other gdbus function can be used to simply retrieve the names of the children of the org.bluez, without requiring an XML parser?</p>\n"}, {"tags": ["c", "pointers", "linked-list", "infinite-loop"], "comments": [{"owner": {"reputation": 5566, "user_id": 530160, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/xRnFS.jpg?s=128&g=1", "display_name": "Nick ODell", "link": "https://stackoverflow.com/users/530160/nick-odell"}, "edited": false, "score": 0, "creation_date": 1547068102, "post_id": 54118331, "comment_id": 95069250, "body": "I don&#39;t think you set the <code>aux</code> pointer to point to anything. You don&#39;t initialize it."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1547149537, "post_id": 54118331, "comment_id": 95103290, "body": "the posted code does not compile!  When compiling, always enable the warnings, then fix those warnings.  ( for <code>gcc</code>, at a minimum use: <code>-Wall -Wextra -Wconversion -pedantic -std=gnu11</code> )  Note, other compilers use different options to perform the same actions"}], "answers": [{"tags": [], "owner": {"reputation": 54577, "user_id": 1339987, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/76aa5ba88e0d95b6480113239fe50008?s=128&d=identicon&r=PG", "display_name": "djechlin", "link": "https://stackoverflow.com/users/1339987/djechlin"}, "is_accepted": false, "score": 0, "last_activity_date": 1547068352, "creation_date": 1547068352, "answer_id": 54118437, "question_id": 54118331, "link": "https://stackoverflow.com/questions/54118331/infinite-loop-when-trying-to-work-with-linked-lists/54118437#54118437", "title": "Infinite loop when trying to work with linked lists", "body": "<p>You don't allocate any memory so <code>aux</code> isn't pointing to anything. If you initialized it at least, <code>nodo *aux = nullptr;</code>, you would at least be lucky enough to see a segfault. Beyond that, you never allocate another <code>aux</code> or <code>l</code>, so it's quite clear that the line <code>l=aux; ..., aux-&gt;sig=l</code> just makes <code>aux</code> a length-1 cyclic list, pointing to itself.</p>\n"}, {"comments": [{"owner": {"reputation": 125, "user_id": 10554572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jjCZA.jpg?s=128&g=1", "display_name": "Moria", "link": "https://stackoverflow.com/users/10554572/moria"}, "edited": false, "score": 0, "creation_date": 1547070007, "post_id": 54118454, "comment_id": 95070048, "body": "Thank you! Fixed it using aux=(nodo*) malloc(sizeof(nodo)) inside the while loop :-)"}], "tags": [], "owner": {"reputation": 292, "user_id": 5661266, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/10205593199614644/picture?type=large", "display_name": "mmeisson", "link": "https://stackoverflow.com/users/5661266/mmeisson"}, "is_accepted": true, "score": 0, "last_activity_date": 1547068466, "creation_date": 1547068466, "answer_id": 54118454, "question_id": 54118331, "link": "https://stackoverflow.com/questions/54118331/infinite-loop-when-trying-to-work-with-linked-lists/54118454#54118454", "title": "Infinite loop when trying to work with linked lists", "body": "<p>I think that before trying to understand linked list, you should work on understanding pointers and dynamic allocation, as linked lists uses these two notions.</p>\n\n<p>A linked list is a list of memory areas you have to allocate ( and dynamically ), I don't know what your program is doing here, but it should not be stable on a system with any kind of memory protection.</p>\n\n<p>\"aux\" is a pointer wich points ... Somewhere. We don't know where, but probably not where it should.</p>\n\n<p>In C, there is no magic stuff like in higher level languages ( python, etc ). You have to build your linked list by yourself</p>\n"}], "owner": {"reputation": 125, "user_id": 10554572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jjCZA.jpg?s=128&g=1", "display_name": "Moria", "link": "https://stackoverflow.com/users/10554572/moria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 54118454, "answer_count": 2, "score": 0, "last_activity_date": 1547068466, "creation_date": 1547067820, "question_id": 54118331, "link": "https://stackoverflow.com/questions/54118331/infinite-loop-when-trying-to-work-with-linked-lists", "title": "Infinite loop when trying to work with linked lists", "body": "<p>I'm just starting with C and I tried to write a simple linked list that adds integers until the number is 0, however I keeping getting an infinite loop with the last number I put on the list.\nI know it's probably because the last element isn't pointing to null, but I can't seem to fix it.</p>\n\n<p>Thank you :-)</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\nint main () {\n    struct nodo { \n        int num;\n        struct nodo *sig;\n    };\n    nodo *l;\n    nodo *aux;\n    l=nullptr;\n    int elem;\n    scanf(\"%d\", &amp;elem);\n    while (elem!=0) {\n        aux-&gt;num=elem;\n        aux-&gt;sig=l;\n        l=aux;\n        scanf(\"%d\", &amp;elem);\n    }\n    while (l!=nullptr) { \n        printf(\"%d\", l-&gt;num);\n        l=l-&gt;sig;\n    }\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 4, "creation_date": 1547067206, "post_id": 54118176, "comment_id": 95068875, "body": "Unfortunately, this questions shows lack of basic C++ (or C) knowledge. It is my suggestion to OP to read a good C++ book instead of try and error approach to C++ learning."}, {"owner": {"reputation": 9, "user_id": 10892012, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2ERslE0u0Ro/AAAAAAAAAAI/AAAAAAAAAGc/vYPXECU1wz0/photo.jpg?sz=128", "display_name": "Harmie176", "link": "https://stackoverflow.com/users/10892012/harmie176"}, "edited": false, "score": 0, "creation_date": 1547068406, "post_id": 54118176, "comment_id": 95069399, "body": "I cant change the return value &quot;void&quot; into anything else. Do you have any different solutions?"}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1547074766, "post_id": 54118176, "comment_id": 95071774, "body": "@SergeyA : the lack of understanding is perhaps why the question is unclear, but there is a useful question here perhaps regarding _how to capture a function&#39;s side-effect output for to unit-testing.  It is a legitimate aim, with an implausible suggestion.  I don&#39;t think many books (and in this case C rather then C++) will help with that.  Perhaps something un unit test frameworks?"}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1547075136, "post_id": 54118176, "comment_id": 95071872, "body": "@Harmie176  I advise always to leave out any &quot;<i>my idea</i>&quot; suggestions - expecially ones that demonstrably will not work.  What you will get in response is lots of explanation of why your suggestion won&#39;r work, rather than a solution that will work.  There is a good question here despite the down-votes caused I suspect primarily by your naive and implausible suggestion. Omit that and just ask about capturing standard output for the purposed of unit testing.  Getting the right terminology and omitting unnecessary distraction is key to a good clear question."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "reply_to_user": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1547136713, "post_id": 54118176, "comment_id": 95096761, "body": "@Clifford there is a certain wisdom in your words, I admit."}], "answers": [{"comments": [{"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 2, "creation_date": 1547067766, "post_id": 54118289, "comment_id": 95069107, "body": "Do not pose off-site images, and do not post imaged of <i>text</i> that could easily be copy&amp;pasted to your answer."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 3, "creation_date": 1547067779, "post_id": 54118289, "comment_id": 95069115, "body": "Please post code directly in your answer instead of linking to an image. You can read about why images of code and errors are discouraged <a href=\"https://meta.stackoverflow.com/questions/285551/why-not-upload-images-of-code-on-so-when-asking-a-question\">here</a>."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1547069590, "post_id": 54118289, "comment_id": 95069881, "body": "He is trying to test the <i>side-effect</i> of a function - changing the function rather defeats the purpose."}], "tags": [], "owner": {"reputation": 11, "user_id": 9994557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e882e718e6d052e6756fd238a4c26b9?s=128&d=identicon&r=PG&f=1", "display_name": "irem beyaz", "link": "https://stackoverflow.com/users/9994557/irem-beyaz"}, "is_accepted": false, "score": -1, "last_activity_date": 1547067631, "creation_date": 1547067631, "answer_id": 54118289, "question_id": 54118176, "link": "https://stackoverflow.com/questions/54118176/how-do-i-save-a-printed-string-from-another-function/54118289#54118289", "title": "how do I save a printed string from another function?", "body": "<p>you should use return instead of print function,\nthen it will have an output as \"This is a string\".\nLike in this photo:\n<a href=\"https://i.stack.imgur.com/NZwYe.png\" rel=\"nofollow noreferrer\">enter image description here</a></p>\n"}, {"tags": [], "owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "is_accepted": false, "score": 1, "last_activity_date": 1547069505, "last_edit_date": 1547069505, "creation_date": 1547067669, "answer_id": 54118302, "question_id": 54118176, "link": "https://stackoverflow.com/questions/54118176/how-do-i-save-a-printed-string-from-another-function/54118302#54118302", "title": "how do I save a printed string from another function?", "body": "<p>The <code>printf</code> output is known a <em>\"side effect\"</em> it is not returned by the function.</p>\n\n<p>The somewhat complex solution in this case is to redirect <code>stdout</code> to a file, and then inspect the content of the file.</p>\n\n<p>Something such as:</p>\n\n<pre><code>char* testString()\n{\n    // Redirect stdout to stdout.log\n    int out = open(\"stdout.log\", O_RDWR|O_CREAT|O_APPEND, 0600);\n    int save_out = dup(fileno(stdout));\n\n    // Run function to be tested\n    printExample() ;\n\n    // restore stdout    \n    fflush(stdout); close(out);\n    dup2(save_out, fileno(stdout));\n    close(save_out);\n\n    // Read back captured output\n    static char stdout_capture[100] ;\n    memset( stdout_capture, 0, 100 ) ;\n    FILE* fp = fopen( \"stdout.log\", \"r\" ) ;\n    fread( stdout_capture, 1, sizeof(stdout_capture) - 1, fp ) ;\n    fclose( fp ) ;\n\n    // return captured text to caller  \n    return stdout_capture ;\n\n}\n\nint main()\n{\n   printf( \"%s\\n\", testString() ) ;\n}\n</code></pre>\n\n<p>Note I have omitted any error checking code in the file I/O for clarity.  You might want to add some!</p>\n"}, {"comments": [{"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1547068019, "post_id": 54118346, "comment_id": 95069213, "body": "But you have changed the behaviour of the function he is trying to test - which is not the point of a test.  The function no longer prints <i>anything</i>."}, {"owner": {"reputation": 33645, "user_id": 2630032, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hQF09.jpg?s=128&g=1", "display_name": "Stephan Lechner", "link": "https://stackoverflow.com/users/2630032/stephan-lechner"}, "reply_to_user": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1547070052, "post_id": 54118346, "comment_id": 95070067, "body": "@Clifford: right; probably did not get OPs intent."}], "tags": [], "owner": {"reputation": 33645, "user_id": 2630032, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hQF09.jpg?s=128&g=1", "display_name": "Stephan Lechner", "link": "https://stackoverflow.com/users/2630032/stephan-lechner"}, "is_accepted": false, "score": 1, "last_activity_date": 1547069887, "last_edit_date": 1547069887, "creation_date": 1547067910, "answer_id": 54118346, "question_id": 54118176, "link": "https://stackoverflow.com/questions/54118176/how-do-i-save-a-printed-string-from-another-function/54118346#54118346", "title": "how do I save a printed string from another function?", "body": "<p>Function <code>printf</code> writes to the console, but it has nothing to do with the return value of a function in which it is used.</p>\n\n<p>So <code>void printExample()</code> will print <code>This is a string</code>, but it will - as the return type correctly indicates - not return anything that could be used by the caller of <code>printExample</code>. </p>\n\n<p>Using <code>printExample</code> as is as parameter to an <code>sprintf(stringArray,\"%s\",printExample())</code> is undefined behaviour; <code>sprintf(...,\"%s\"</code> expects a <code>char*</code>-argument, but <code>printExample</code> is <code>void</code>. Your compiler should have warned you.</p>\n\n<p>If you want <code>printExample</code> to return a string, you'd have to write</p>\n\n<pre><code>const char* printExample() {\n   return \"This is a string\";\n}\n</code></pre>\n\n<p>Then you can use the result of a call to <code>printExample</code> directly as argument to another <code>printf</code>.</p>\n\n<p>If, however, you just want to capture everything that is printed to <code>stdout</code> also in a string (e.g. in order to do automated tests), then you could temporarily buffer  <code>stdout</code> and access this buffer then.</p>\n\n<pre><code>void printExample(){\n\n    printf(\"This is a string\");\n}\n\nvoid testString(){\n    char string[100] = {0};\n    setbuf(stdout, string);\n    printExample();\n    setbuf(stdout, NULL);\n    printf(\"\\noutput of printExample: '%s'\\n\",string);\n}\n\nint main() {\n    testString();\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 10892012, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2ERslE0u0Ro/AAAAAAAAAAI/AAAAAAAAAGc/vYPXECU1wz0/photo.jpg?sz=128", "display_name": "Harmie176", "link": "https://stackoverflow.com/users/10892012/harmie176"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "closed_date": 1547068941, "answer_count": 3, "score": -5, "last_activity_date": 1547069887, "creation_date": 1547067119, "last_edit_date": 1547067905, "question_id": 54118176, "link": "https://stackoverflow.com/questions/54118176/how-do-i-save-a-printed-string-from-another-function", "closed_reason": "Needs details or clarity", "title": "how do I save a printed string from another function?", "body": "<p>I want to test a function with type \"void\" which prints something.\nTherefore I thought about using <code>sprintf</code> and saving the output of <code>printExample</code> in an array in the <code>testString</code> function.</p>\n\n<p>my idea:</p>\n\n<pre><code>void printExample(){\n\n   printf(\"This is a string\");\n}\n\nvoid testString(){\n   char stringArray[100];\n   sprintf(stringArray,\"%s\",printExample());\n   printf(\"%s\",stringArray);\n}\n\nint main(){\n   testString();\n}\n</code></pre>\n\n<p>wanted output on console: This is a string</p>\n\n<p>something seems to be wrong with the call of <code>printExample()</code> in my <code>sprintf</code>, any suggestions? :)</p>\n"}, {"tags": ["c", "sockets", "udp", "epoll", "dup2"], "comments": [{"owner": {"reputation": 10928, "user_id": 1358308, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d9448dee25fd2278def77cb7f0353574?s=128&d=identicon&r=PG", "display_name": "Sam Mason", "link": "https://stackoverflow.com/users/1358308/sam-mason"}, "edited": false, "score": 0, "creation_date": 1547144686, "post_id": 54117986, "comment_id": 95101027, "body": "my guess is that calling <code>connect()</code> again on a <code>dup()</code>ed descriptor would also affect the original FD as well\u2026  I&#39;d also guess that <code>epoll()</code> wouldn&#39;t see any difference, and they&#39;d all become readable at the same time when a packet is received"}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1560681996, "post_id": 54117986, "comment_id": 99809708, "body": "No need to dup(), for UDP you can just use <code>sendto()</code> on a single socketfd  [remember: UDP is connectionless]"}], "owner": {"reputation": 115, "user_id": 1715587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/413bcb7a5acbdc047d6198aa517060fe?s=128&d=identicon&r=PG", "display_name": "user1715587", "link": "https://stackoverflow.com/users/1715587/user1715587"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560681283, "creation_date": 1547066334, "last_edit_date": 1560681283, "question_id": 54117986, "link": "https://stackoverflow.com/questions/54117986/connect-and-dup-and-epoll-interactions-for-udp-descriptors", "title": "connect() and dup() and epoll() interactions for UDP descriptors", "body": "<p>Per the Linux man page on <code>connect()</code>, it is possible to invoke it on a UDP descriptor in order to default the peer addr/port to and from which datagrams are sent and received.  This also has a performance benefit in that a route lookup need only occur once instead of on every datagram sent.</p>\n\n<p>My question is on how this interacts with <code>epoll()</code> when using a duplicate descriptor from <code>dup()</code>.  This may be Linux specific as well.</p>\n\n<p>Say I have a single UDP listener and multiple UDP sessions, differentiated by peer addr/port, where each session has a duplicate of the listener socket descriptor and has called <code>connect()</code> on it.</p>\n\n<p>Will <code>connect()</code> default the peer addr/port on the duplicate descriptor only, or will it pass through to the listener descriptor?  That is, can each duplicate descriptor be uniquely defaulted?</p>\n\n<p>If so, will each duplicate descriptor behave uniquely for the purposes of EPOLLIN events?  That is, will an incoming datagram only trigger EPOLLIN on the duplicate descriptor associated with the peer addr/port?</p>\n\n<p>I may need to just code this up and see, but wanted to ask first in the hopes of saving the effort. </p>\n\n<hr>\n\n<p>The NetBSD man page for <code>dup()</code> specifically states...</p>\n\n<p><em>\"...all object modes, settings, properties, and behavior other than the close-on-exec flag are shared between references.  This includes the setting of append mode, non-blocking I/O actions, asynchronous I/O operations in progress, socket options, and so forth.\"</em></p>\n\n<p>So I think I have my answer in that <code>connect()</code> on any duplicate descriptor will affect the listener descriptor and all of the other duplicate descriptors equally.</p>\n"}, {"tags": ["c", "function"], "comments": [{"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 1, "creation_date": 1547065739, "post_id": 54117818, "comment_id": 95068264, "body": "Lookup &quot;pointer&quot; and &quot;dereference operator <code>*</code>&quot; in whatever tutorial/text you&#39;re using."}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 5334693, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8rzv6HMw48E/AAAAAAAAAAI/AAAAAAAAADA/kGID2Dr_hKo/photo.jpg?sz=128", "display_name": "Brian Strugnell", "link": "https://stackoverflow.com/users/5334693/brian-strugnell"}, "edited": false, "score": 1, "creation_date": 1547066200, "post_id": 54117857, "comment_id": 95068463, "body": "Wonderfull! This fixed the problem. Thanks"}], "tags": [], "owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "is_accepted": false, "score": 2, "last_activity_date": 1547065797, "creation_date": 1547065797, "answer_id": 54117857, "question_id": 54117818, "link": "https://stackoverflow.com/questions/54117818/incompatible-types-when-assigning-types-and-invalid-operands-to-binary/54117857#54117857", "title": "Incompatible types when assigning types and invalid operands to binary", "body": "<p>When you pass a pointer argument to a function, as you do with <code>float *resistance</code> and <code>float *current</code>, you also have to dereference it when you're assigning to it as an l-value or accessing the pointed-to value:</p>\n\n<pre><code>*resistance = ((resistivity*length) / area_circle);\n*current = (voltage / *resistance);\n</code></pre>\n\n<p>Do note that I put a space between the division operator <code>/</code> and the dereference operator <code>*</code> to prevent the compiler from seeing a multiline comment start.</p>\n"}], "owner": {"reputation": 35, "user_id": 5334693, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8rzv6HMw48E/AAAAAAAAAAI/AAAAAAAAADA/kGID2Dr_hKo/photo.jpg?sz=128", "display_name": "Brian Strugnell", "link": "https://stackoverflow.com/users/5334693/brian-strugnell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1547065797, "creation_date": 1547065621, "question_id": 54117818, "link": "https://stackoverflow.com/questions/54117818/incompatible-types-when-assigning-types-and-invalid-operands-to-binary", "title": "Incompatible types when assigning types and invalid operands to binary", "body": "<p>I'm working on what I thought would be simple but I have ran into some issues I can't seem to solve. The issues revolve around the resitance_current function in the code. The two error message I receive are: </p>\n\n<p>1) incompatible types when assigning to type 'float *' from type 'float'</p>\n\n<p>2) invalid operands to binary / (have 'float' and 'float *')</p>\n\n<p>I'm trying to use the function resitance_current to calculate resistance and current. to do this I pass the values of \"length\" of wire \"area_circle\" of wire and \"voltage\" and by using the resistivity formula to find R:</p>\n\n<p>R = \u03c1 L / A</p>\n\n<p>and ohms law to find I</p>\n\n<p>V = R * I</p>\n\n<p>I can't seem to resolve why the float types are clashing. I have to keep the one resitance_current function to calculate resistance and current so help with passing the float pointers and resolving the current issue will be much appreciated.</p>\n\n<p>Thanks in advance for the help ;)</p>\n\n<p>Code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;math.h&gt;\n\nfloat areaOfcircle(float radius_circle)\n{\n    float area_circle;\n    area_circle = M_PI * radius_circle * radius_circle;\n\n    return area_circle;\n}\nvoid resitance_current(float length, float area_circle, float voltage, float* resistance, float* current)\n{\n    float resistivity;\n    printf(\"%f %f %f\", length, area_circle, voltage);\n    resistivity = 1.782*exp(-8);\n    resistance = ((resistivity*length)/area_circle);\n    current = (voltage/resistance);\n}\nint main()\n{\n    float radius, voltage, length, current, resistance;\n\n    // take radius as input\n    printf(\"Enter the radius of wire : \");\n    scanf(\"%f\", &amp;radius);\n    if (radius &lt; 0)\n    {\n        exit(1);\n    }\n    else\n    {\n        printf(\"Enter the Voltage of circuit : \");\n        scanf(\"%f\", &amp;voltage);\n        if (voltage &lt; 0)\n        {\n            exit(1);\n        }\n        else\n        {\n            printf(\"Enter the Length of Wire : \");\n            scanf(\"%f\", &amp;length);\n            if (length &lt; 0)\n            {\n                exit(1);\n            }\n            else\n            {\n                printf(\"Cross Sectional Area of Wire : %.2f\", areaOfcircle(radius));\n                resitance_current(length, areaOfcircle(radius), voltage, &amp;resistance, &amp;current);\n                printf(\"Resistance = %f , Current = %f\", resistance, current);\n                printf(\"\\n\");\n            }\n\n        }\n    }\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "arrays", "function", "random"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547065389, "post_id": 54117726, "comment_id": 95068113, "body": "You have to go through already assigned numbers and see if the new <code>rand()</code> is a duplicate of already existing ones. Show the code you have now."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 6, "creation_date": 1547065429, "post_id": 54117726, "comment_id": 95068126, "body": "Because you have a problem of properly formulating the requirement. You need not to generate, but to <i>shuffle</i> numbers."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1547065452, "post_id": 54117726, "comment_id": 95068134, "body": "What is the <i>range</i> of the random numbers? Would <code>array[10]</code> be filled using the numbers 0..9?"}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 0, "creation_date": 1547065654, "post_id": 54117726, "comment_id": 95068227, "body": "This is not a C question if you are not showing a program that you need help with. If you are having problems developing an algorithm, tag the question as such."}], "answers": [{"comments": [{"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 1, "creation_date": 1547132488, "post_id": 54117795, "comment_id": 95094105, "body": "Shuffling will be way more efficient unless the range of values is very large relative to the quantity of values desired."}, {"owner": {"reputation": 13906, "user_id": 1187220, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/AwroB.jpg?s=128&g=1", "display_name": "Michel Keijzers", "link": "https://stackoverflow.com/users/1187220/michel-keijzers"}, "reply_to_user": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1547132652, "post_id": 54117795, "comment_id": 95094207, "body": "@pjs indeed, but this is not clear from the code/description."}], "tags": [], "owner": {"reputation": 13906, "user_id": 1187220, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/AwroB.jpg?s=128&g=1", "display_name": "Michel Keijzers", "link": "https://stackoverflow.com/users/1187220/michel-keijzers"}, "is_accepted": true, "score": 1, "last_activity_date": 1547065475, "creation_date": 1547065475, "answer_id": 54117795, "question_id": 54117726, "link": "https://stackoverflow.com/questions/54117726/i-have-a-problem-generating-random-numbers-c/54117795#54117795", "title": "I have a problem generating random numbers (C)", "body": "<p>Why couldn't there be two equal numbers in an array of random numbers?</p>\n\n<p>Anyway, if you want to prevent it, for every new value to be added in the array, iterate from the start and check if that number is already in. If so, generate a new number and check again.</p>\n\n<p>Of course there should be enough unique numbers to be fit in the array (you can check this before you start), and in theory it could take forever, but in reality this does not happen.</p>\n"}, {"tags": [], "owner": {"reputation": 28085, "user_id": 1025391, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/76a088ae59745a0c4a377f362fec0fc4?s=128&d=identicon&r=PG", "display_name": "moooeeeep", "link": "https://stackoverflow.com/users/1025391/moooeeeep"}, "is_accepted": false, "score": 4, "last_activity_date": 1547107134, "last_edit_date": 1547107134, "creation_date": 1547106565, "answer_id": 54124024, "question_id": 54117726, "link": "https://stackoverflow.com/questions/54117726/i-have-a-problem-generating-random-numbers-c/54124024#54124024", "title": "I have a problem generating random numbers (C)", "body": "<p>You are not supposed to re-seed the PRNG in every loop iteration. You should do it once at the start of your program instead. </p>\n\n<p>You'll produce a duplicate sequence of numbers as soon as you have multiple calls to <code>srand(time(NULL))</code> per second. Which doesn't seem to be unlikely in your code.</p>\n\n<p>For reference:</p>\n\n<ul>\n<li><a href=\"https://en.cppreference.com/w/c/numeric/random/srand\" rel=\"nofollow noreferrer\">https://en.cppreference.com/w/c/numeric/random/srand</a></li>\n</ul>\n"}], "owner": {"reputation": 13, "user_id": 10891912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b849ae24d81e0a3673b3f27c20e12170?s=128&d=identicon&r=PG&f=1", "display_name": "Nitzan sm", "link": "https://stackoverflow.com/users/10891912/nitzan-sm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 54117795, "answer_count": 2, "score": 1, "last_activity_date": 1547107134, "creation_date": 1547065256, "last_edit_date": 1547066610, "question_id": 54117726, "link": "https://stackoverflow.com/questions/54117726/i-have-a-problem-generating-random-numbers-c", "title": "I have a problem generating random numbers (C)", "body": "<p>My problem is that i cant figure how to make sure the rand function doesn't give the same number to 2 different cells and if it does how can i change it without getting to a number thats already in other cell.(the if(arr[j] != -1) is because i had other function that filled some cells with (-1) )</p>\n\n<p>this is one version of how i tried to do it (all the // are leftovers from different tries)</p>\n\n<pre><code>void fillArr(int arr[], int n)\n{\n    int i,j=0;\n    for (i = 0; i &lt; n; i++)\n    {\n        while (arr[j] == arr[j + 2] &amp;&amp;j + 2&lt;n)\n        {\n        //srand(time(NULL));\n            if (arr[j] != -1)\n            {\n                if (j % 2 == 0)\n                {\n\n                    arr[j] = rand() % (N - 1);\n                    if (arr[j + 2] != -1)\n                        arr[j + 2] = rand() % (N - 1);\n                    //arr[i] = rand() % (N - 1)-rand()%(i-1);\n                    srand(time(NULL));\n                }\n                else\n                {\n                    arr[j] = rand() % (N - i);\n                    arr[j + 2] = rand() % (N - 1);\n                    //arr[i] = rand() % (N - 1) - rand() % (i +1);\n                    //srand(time(NULL));\n                }\n            }\n            j++;\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "memory-leaks", "valgrind"], "comments": [{"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1547065267, "post_id": 54117683, "comment_id": 95068051, "body": "<code>free(new_string);</code> after <code>return</code> does nothing. And you have a memory leak because you&#39;re not storing the pointer but just feeding it to <code>printf</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1547152836, "post_id": 54117683, "comment_id": 95104652, "body": "OT: regarding: <code>char *new_string = (char*) malloc(strlen(str) * sizeof(char) + 1);</code> and similar statements.  1) In C, the returned type is <code>void*</code> which can be assigned to any pointer.  Casting just clutters the code, making it more difficult to understand, debug, etc  2) always check (!=NULL) the returned value to assure the operation was successful.  3) regarding the expression: ` sizeof(char)`  this is defined in the C standard as 1.  multiplying anything by 1 has no effect.  Suggest removing that expressing and the casting"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1547152897, "post_id": 54117683, "comment_id": 95104676, "body": "regarding: `  return new_string;   free(new_string);`  The &#39;return&#39; exits the function, so the call to <code>free()</code> will never be executed"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1547153125, "post_id": 54117683, "comment_id": 95104767, "body": "regarding: <code>new_string =  realloc(new_string, strlen(new_string) + 1);</code>  Why bother with the <code>realloc()</code>   it hurts nothing if a slightly oversized amount of heap memory is allocated"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1547153298, "post_id": 54117683, "comment_id": 95104861, "body": "in the function: <code>main()</code>, after the call to <code>printf()</code> is the proper place to call <code>free()</code>  However, the pointer returned from the function: <code>cutstring()</code> is not visible outside the call to <code>printf()</code>.  Suggest saving the returned value to a pointer, then passing the pointer to <code>printf()</code> and to <code>free()</code>"}], "answers": [{"tags": [], "owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "is_accepted": true, "score": 1, "last_activity_date": 1547065414, "creation_date": 1547065414, "answer_id": 54117780, "question_id": 54117683, "link": "https://stackoverflow.com/questions/54117683/memory-leak-at-allocated-reallocted-memory-5-bytes-in-1-blocks-are-definitely/54117780#54117780", "title": "Memory leak at allocated/reallocted memory, &quot;5 bytes in 1 blocks are definitely lost&quot;", "body": "<p><code>cutString</code> has to allocate memory and return it. Of course (and fortunately), all statements <em>after</em> an inconditional <code>return</code> aren't reached.</p>\n\n<pre><code>  return new_string;\n  free(new_string);   // never executed\n}\n</code></pre>\n\n<p>Fortunately! because else you'd return unallocated memory: undefined behaviour.</p>\n\n<p>The issue here is that you're passing the returned value to <code>printf</code>, but after that call, the pointer is lost. You have to store it to be able to free it, but <em>only after having printed it</em>.</p>\n\n<pre><code>int main()\n{\n  char *s = cutString(\"Hello World!\", 'o'));\n  printf(\"%s\\n\", s);\n  free(s);\n  return 0;\n}\n</code></pre>\n\n<p>In C it's not possible to pipeline a function which allocates memory to <code>printf</code> without creating a memory leak. Other languages have garbage collectors or object destructors, but not C.</p>\n"}], "owner": {"reputation": 47, "user_id": 7196375, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-pUk2DxpjauI/AAAAAAAAAAI/AAAAAAAAAA8/8US5kkhM7yQ/photo.jpg?sz=128", "display_name": "werther", "link": "https://stackoverflow.com/users/7196375/werther"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 54117780, "answer_count": 1, "score": 0, "last_activity_date": 1547065414, "creation_date": 1547065086, "question_id": 54117683, "link": "https://stackoverflow.com/questions/54117683/memory-leak-at-allocated-reallocted-memory-5-bytes-in-1-blocks-are-definitely", "title": "Memory leak at allocated/reallocted memory, &quot;5 bytes in 1 blocks are definitely lost&quot;", "body": "<p>I'm getting a valgrind error when checking my program for memory leaks.\nThe error happens somewhere in my cutString function when allocating/reallocating memory, but I'm not sure what I'm doing wrong.</p>\n\n<p>Am I allocating my memory incorrectly?</p>\n\n<p>Here's the valgrind output:</p>\n\n<pre><code>$ valgrind --leak-check=full --track-origins=yes ./cutstring\n==7017== Memcheck, a memory error detector\n==7017== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.           \n==7017== Using Valgrind-3.14.0 and LibVEX; rerun with -h for copyright info                                     \n==7017== Command: ./cutstring\n==7017==\nHell\n==7017==\n==7017== HEAP SUMMARY:\n==7017==     in use at exit: 5 bytes in 1 blocks\n==7017==   total heap usage: 3 allocs, 2 frees, 1,042 bytes allocated                                           \n==7017==\n==7017== 5 bytes in 1 blocks are definitely lost in loss record 1 of 1                          \n==7017==    at 0x4839D7B: realloc (vg_replace_malloc.c:826)\n==7017==    by 0x109205: cutString (in cutstring)\n==7017==    by 0x109228: main (in cutstring)\n==7017==\n==7017== LEAK SUMMARY:\n==7017==    definitely lost: 5 bytes in 1 blocks\n==7017==    indirectly lost: 0 bytes in 0 blocks\n==7017==      possibly lost: 0 bytes in 0 blocks\n==7017==    still reachable: 0 bytes in 0 blocks\n==7017==         suppressed: 0 bytes in 0 blocks\n==7017==\n==7017== For counts of detected and suppressed errors, rerun with: -v\n==7017== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)\n</code></pre>\n\n<p>This is my code:</p>\n\n<pre><code>#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nchar *cutString(char *str, char del)\n{ \n  char *new_string = (char*) malloc(strlen(str) * sizeof(char) + 1);\n\n  int i = 0;\n  while (str[i] != del)\n  {\n    new_string[i] = str[i];\n    i++;\n  }\n\n  new_string[i] = '\\0';\n\n  new_string = (char*) realloc(new_string, strlen(new_string) + 1);\n\n  return new_string;\n  free(new_string);\n}\n\nint main()\n{\n  printf(\"%s\\n\", cutString(\"Hello World!\", 'o'));\n  return 0;\n}\n</code></pre>\n\n<p>I'm guessing that I used realloc incorrectly, but I can't figure out why.<br>\nSome help would be appreciated, thanks!</p>\n"}, {"tags": ["c#", "c", "windows", "security", "ntfs"], "comments": [{"owner": {"reputation": 28373, "user_id": 5015238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8790f8091d3c6c58fd45664a165117a?s=128&d=identicon&r=PG", "display_name": "jdweng", "link": "https://stackoverflow.com/users/5015238/jdweng"}, "edited": false, "score": 0, "creation_date": 1547064491, "post_id": 54117283, "comment_id": 95067735, "body": "See pinvoke : <a href=\"http://www.pinvoke.net/default.aspx/ntdll/NtQueryInformationFile.html\" rel=\"nofollow noreferrer\">pinvoke.net/default.aspx/ntdll/NtQueryInformationFile.html</a>"}, {"owner": {"reputation": 157, "user_id": 7016967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1Nb1tdGhGNs/AAAAAAAAAAI/AAAAAAAABTg/GXJ-sCh0nPo/photo.jpg?sz=128", "display_name": "Cade Bryant", "link": "https://stackoverflow.com/users/7016967/cade-bryant"}, "reply_to_user": {"reputation": 28373, "user_id": 5015238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8790f8091d3c6c58fd45664a165117a?s=128&d=identicon&r=PG", "display_name": "jdweng", "link": "https://stackoverflow.com/users/5015238/jdweng"}, "edited": false, "score": 0, "creation_date": 1547068202, "post_id": 54117283, "comment_id": 95069297, "body": "I can&#39;t find anything on that site that deals with ACLs/permissions."}, {"owner": {"reputation": 28373, "user_id": 5015238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8790f8091d3c6c58fd45664a165117a?s=128&d=identicon&r=PG", "display_name": "jdweng", "link": "https://stackoverflow.com/users/5015238/jdweng"}, "edited": false, "score": 0, "creation_date": 1547119641, "post_id": 54117283, "comment_id": 95086575, "body": "Here is the c++ wrapper : FileAccessInformation,  The structure has FileInformationClass which is defined here : <a href=\"https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/content/ntifs/ns-ntifs-_file_all_information\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/windows-hardware/drivers/ddi/conten&zwnj;&#8203;t/&hellip;</a>.  And then you get : FILE_ACCESS_INFORMATION and finally : ACCESS_MASK defined here : <a href=\"https://docs.microsoft.com/en-us/windows-hardware/drivers/kernel/access-mask\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/windows-hardware/drivers/kernel/&hellip;</a>"}, {"owner": {"reputation": 157, "user_id": 7016967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1Nb1tdGhGNs/AAAAAAAAAAI/AAAAAAAABTg/GXJ-sCh0nPo/photo.jpg?sz=128", "display_name": "Cade Bryant", "link": "https://stackoverflow.com/users/7016967/cade-bryant"}, "reply_to_user": {"reputation": 28373, "user_id": 5015238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8790f8091d3c6c58fd45664a165117a?s=128&d=identicon&r=PG", "display_name": "jdweng", "link": "https://stackoverflow.com/users/5015238/jdweng"}, "edited": false, "score": 0, "creation_date": 1547152289, "post_id": 54117283, "comment_id": 95104441, "body": "The PInvoke documentation doesn&#39;t help me, because the sample code involves creating a FileStream object on the files I want to retrieve information about.  I am trying to avoid directly accessing the files.  Instead I want to retrieve the Security IDs from all the files via the $MFT file (which I&#39;ve figured out how to do already)....and then use those SecurityIDS to retrieve the related ACLs from the $Secure file.  In order to do this, I need to know what to pass to the lpOverlapped parameter of the kernel32 function ReadFile()."}], "owner": {"reputation": 157, "user_id": 7016967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1Nb1tdGhGNs/AAAAAAAAAAI/AAAAAAAABTg/GXJ-sCh0nPo/photo.jpg?sz=128", "display_name": "Cade Bryant", "link": "https://stackoverflow.com/users/7016967/cade-bryant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547063650, "creation_date": 1547063254, "last_edit_date": 1547063650, "question_id": 54117283, "link": "https://stackoverflow.com/questions/54117283/how-i-programmatically-retrieve-data-from-the-ntfs-secure-file", "title": "How I programmatically retrieve data from the NTFS $Secure file?", "body": "<p>I figured out how to read the NTFS $MFT file by accessing the boot sector and passing in the appropriate MftStartLcn value into the third parameter of ReadFile().  Now I want to access the $Secure file in a similar way.  How do I do this?</p>\n\n<p>I'm writing this code in order to return the ACL for each folder and file on my hard drive (Windows 10).  My code below gets me the basic file metadata, but not the ACLs and other security information.  I <em>do</em> get the Security ID.  I'm assuming that I can then use this value to retrieve the related Security Descriptor (and thus the ACLs) in the $Secure file.  Thanks in advance for showing me how to do this.</p>\n\n<pre><code>//Read the $MFT record from disk into memory, which is always the first record in the MFT. \nReadFile(buffer, _diskInfo.BytesPerMftRecord, _diskInfo.MftStartLcn * _diskInfo.BytesPerSector * _diskInfo.SectorsPerCluster);\n//This brings back the basic file metadata but not the security/permissions data\n</code></pre>\n"}, {"tags": ["c", "arrays", "pointers", "dynamic", "allocation"], "comments": [{"owner": {"reputation": 568, "user_id": 9611958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f5b1e352ee137da725e261d42524f27?s=128&d=identicon&r=PG&f=1", "display_name": "Countingstuff", "link": "https://stackoverflow.com/users/9611958/countingstuff"}, "edited": false, "score": 0, "creation_date": 1547060407, "post_id": 54116560, "comment_id": 95066026, "body": "It&#39;s not entirely clear to me what your question is, but here are two options as I see it, either you modify the array passed in and just move the first even element (say you&#39;re doing even) to the start of the array, the next even to the next element of the array, etc. Or before calling the function you create an array of size the same as the size of the array you want to filter which you pass to your function and as you go through it you put the appropriate elements into the array."}, {"owner": {"reputation": 280, "user_id": 10817377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879d8990cccfc2856cf1ca6279a7afda?s=128&d=identicon&r=PG&f=1", "display_name": "I Funball", "link": "https://stackoverflow.com/users/10817377/i-funball"}, "edited": false, "score": 0, "creation_date": 1547060618, "post_id": 54116560, "comment_id": 95066121, "body": "What is the purpose of <code>rewind(stdin)</code> here? I don&#39;t think you should be doing that... and it also seems pointless."}, {"owner": {"reputation": 198, "user_id": 7276664, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210177874830608/picture?type=large", "display_name": "Amitay Tsinis", "link": "https://stackoverflow.com/users/7276664/amitay-tsinis"}, "edited": false, "score": 0, "creation_date": 1547060781, "post_id": 54116560, "comment_id": 95066208, "body": "Thanks for your answer I need to return the new array without the unnecessary elements. the 2nd option I cant use since the function receives only,3 parameters, array, size,is_even. in my case, I sent the dynamic allocation as an &quot;array&quot; and used p to point to this memory allocation with the content."}, {"owner": {"reputation": 568, "user_id": 9611958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f5b1e352ee137da725e261d42524f27?s=128&d=identicon&r=PG&f=1", "display_name": "Countingstuff", "link": "https://stackoverflow.com/users/9611958/countingstuff"}, "edited": false, "score": 0, "creation_date": 1547061230, "post_id": 54116560, "comment_id": 95066390, "body": "Why can you not add a parameter? If you want to declare an array on the stack inside the function it won&#39;t work since the stack will be lost after the function returns. But I suppose you could malloc inside the function so that the array you put the even/odd values in is on the heap and can be accessed after the function returns."}, {"owner": {"reputation": 1619, "user_id": 7864413, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208517922736756/picture?type=large", "display_name": "Phil M", "link": "https://stackoverflow.com/users/7864413/phil-m"}, "edited": false, "score": 0, "creation_date": 1547061327, "post_id": 54116560, "comment_id": 95066417, "body": "Is there a common professor to so many of these questions lately, who prefers to teach people to use <code>*(array+index)</code> rather than <code>array[index]</code> ?"}, {"owner": {"reputation": 2445, "user_id": 3476780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/abf771bddcd864626a0e1499ccfc699b?s=128&d=identicon&r=PG&f=1", "display_name": "yano", "link": "https://stackoverflow.com/users/3476780/yano"}, "edited": false, "score": 0, "creation_date": 1547061879, "post_id": 54116560, "comment_id": 95066657, "body": "just create 2 memory locations, it will make your life easier. <code>int* newArr = malloc(n * sizeof(*newArr)); newArr = new_array(p,n,is_even);</code> Modifying <code>p</code> in place, then <code>realloc</code>ing it to shave unused space is harder than it&#39;s worth... unless you&#39;re working on some embedded system with EXTREMELY limited memory, in which case you probably shouldn&#39;t be <code>malloc</code>ing anyway. Memory is cheap and there&#39;s a lot of it, you can use a little extra."}, {"owner": {"reputation": 2445, "user_id": 3476780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/abf771bddcd864626a0e1499ccfc699b?s=128&d=identicon&r=PG&f=1", "display_name": "yano", "link": "https://stackoverflow.com/users/3476780/yano"}, "edited": false, "score": 0, "creation_date": 1547062511, "post_id": 54116560, "comment_id": 95066922, "body": "Also don&#39;t recommend editing your source data anyway. What if it turns out you want to get all the even <i>and</i> odd numbers? Or all the even numbers and then numbers that are factors of 200? If you corrupt your source you&#39;re limited in what you can do next."}], "answers": [{"tags": [], "owner": {"reputation": 527, "user_id": 10488746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vTDhZ.jpg?s=128&g=1", "display_name": "H.cohen", "link": "https://stackoverflow.com/users/10488746/h-cohen"}, "is_accepted": false, "score": 0, "last_activity_date": 1547062173, "last_edit_date": 1547062173, "creation_date": 1547061305, "answer_id": 54116827, "question_id": 54116560, "link": "https://stackoverflow.com/questions/54116560/how-to-return-array-with-only-even-odd-numbers-and-delete-the-unnecessary-cells/54116827#54116827", "title": "How to return array with only even/odd numbers and delete the unnecessary cells?", "body": "<p>You could place all of your even/odd numbers at the beginning of the array, realloc() the array for its new size, and send the value of its new length back in your return. but you will need your function to receive (int** Array) in order to change the pointer for the array </p>\n\n<p>so function declaration could be <strong>int new_array(int **p ,int number ,int is_even)</strong></p>\n\n<p>The problem is not deleting the cells the problem is that when you delete them your arrays length is not the same anymore.. </p>\n\n<p>By the way you can also change the value of length and return the new add for the new array with <strong>int* new_array(int *p, int *number, int is_even)</strong> </p>\n"}, {"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 1, "last_activity_date": 1547062788, "creation_date": 1547062788, "answer_id": 54117184, "question_id": 54116560, "link": "https://stackoverflow.com/questions/54116560/how-to-return-array-with-only-even-odd-numbers-and-delete-the-unnecessary-cells/54117184#54117184", "title": "How to return array with only even/odd numbers and delete the unnecessary cells?", "body": "<p>Part of your problem is that you are not accounting for one of the pieces of information you need to convey to the caller: the effective number of integers in the returned array.  Your print loop assumes the same number of elements as were originally read, but by the nature of the function, this will typically be too many.</p>\n\n<p>You ask,</p>\n\n<blockquote>\n  <p>how do I erase cells?</p>\n</blockquote>\n\n<p>, but \"erasure\" is not a thing you can do.  You can overwrite array elements with different values, but you cannot make an individual array element cease to exist, especially not from the middle of an array.  The usual idiom would be to put the elements you want to keep in the initial elements of either the original array or a new one, and return how many elements that is.  In the case of a new array, you must also return a pointer to the (dynamically allocated) array.  The function signature you present is not adequate, because it provides no good means to return the count of elements.</p>\n\n<p>There is a number of ways to address that.  A simple one would be to make <code>number</code> an in/out parameter, by passing a <em>pointer</em> to the number of elements instead of the number of elements value:</p>\n\n<pre><code>int *new_array(int *p, int *number, int is_even) {\n    // ... 'j' keeps a running count of the number of is_even elements\n\n    *number = j;  // Write the final number of elements back to the caller\n    return p;     // return the allocated array\n}\n</code></pre>\n\n<p>The details of the implementation would need to change a bit to accommodate the change in type and usage of the <code>number</code> parameter, and also to fix bugs.</p>\n\n<p>You might then call it like so:</p>\n\n<pre><code>p = new_array(p, &amp;n, is_even);\n</code></pre>\n\n<p>... and afterward continue just as you already were doing.</p>\n"}], "owner": {"reputation": 198, "user_id": 7276664, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210177874830608/picture?type=large", "display_name": "Amitay Tsinis", "link": "https://stackoverflow.com/users/7276664/amitay-tsinis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1547063925, "creation_date": 1547059958, "last_edit_date": 1547060169, "question_id": 54116560, "link": "https://stackoverflow.com/questions/54116560/how-to-return-array-with-only-even-odd-numbers-and-delete-the-unnecessary-cells", "title": "How to return array with only even/odd numbers and delete the unnecessary cells?", "body": "<p>I try to get an array, an number and is_even bool variable from the user and return an only even numbers new array, else return only odd numbers array depending on is_even.\nfor example: the array {1,2,3,4} and is_even=1 will return {2,4} ,if is_even=0 the returned array will be {1,3}\nas I get it I should allocate the array dynamically prior to passing it to a function. what I have done so far is. </p>\n\n<p>I got stuck with the return. I checked whether the content pointed by p is even or odd but how do I erase cells? </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;malloc.h&gt;\n\n  int *new_array(int *p,int number,int is_even){\n  int j,i=0;\n  int counter=0;\n    if(is_even){\n      for(j=0;j&lt;number;j++){\n        if(*(p+j)%2==0){\n        }\n      }\n      return p;\n    }\n  }\n\n\n  void main() {\n    int n,i,is_even;\n    int *p;\n    printf(\"enter number of elements\");\n    scanf(\"%d\",&amp;n); rewind(stdin);\n    printf(\"hoose is_even 1 or 0\");\n    scanf(\"%d\",&amp;is_even);rewind(stdin);\n\n    p=(int *)malloc(n* sizeof(int));\n    for(i=0;i&lt;n;i++){\n      scanf(\"%d\",p+i);\n    }\n    p=new_array(p,n,is_even);\n    for(i=0;i&lt;n;i++){\n      printf(\"%4d\",*(p+i));\n    }\n  }\n</code></pre>\n"}, {"tags": ["android", "c", "renderscript"], "comments": [{"owner": {"reputation": 10261, "user_id": 295004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a29d6038e4dcb7fac98ef41c002975e1?s=128&d=identicon&r=PG", "display_name": "Morrison Chang", "link": "https://stackoverflow.com/users/295004/morrison-chang"}, "edited": false, "score": 0, "creation_date": 1547096573, "post_id": 54116462, "comment_id": 95076241, "body": "You didn&#39;t show how you are reading the value. My guess is that as <code>int color</code> a packed 32 bit integer value, you have to be aware of big-endian/little-endian differences between ARM and Intel."}, {"owner": {"reputation": 737, "user_id": 2370725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1712168e167f14445f38f79e581bb87e?s=128&d=identicon&r=PG", "display_name": "Pdroid", "link": "https://stackoverflow.com/users/2370725/pdroid"}, "reply_to_user": {"reputation": 10261, "user_id": 295004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a29d6038e4dcb7fac98ef41c002975e1?s=128&d=identicon&r=PG", "display_name": "Morrison Chang", "link": "https://stackoverflow.com/users/295004/morrison-chang"}, "edited": false, "score": 0, "creation_date": 1547137481, "post_id": 54116462, "comment_id": 95097216, "body": "In fact I did, look at the last 3 lines ofvthe java code. I got it thanks to an answer on androidev reddit, I&#39;ll post an update, anyway thanks."}], "answers": [{"tags": [], "owner": {"reputation": 737, "user_id": 2370725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1712168e167f14445f38f79e581bb87e?s=128&d=identicon&r=PG", "display_name": "Pdroid", "link": "https://stackoverflow.com/users/2370725/pdroid"}, "is_accepted": false, "score": 0, "last_activity_date": 1547138246, "creation_date": 1547138246, "answer_id": 54133180, "question_id": 54116462, "link": "https://stackoverflow.com/questions/54116462/issue-when-boxing-4-uchar-into-an-int-renderscript/54133180#54133180", "title": "Issue when boxing 4 uchar into an int (RenderScript)", "body": "<p>Ok, I got it thanks to an answer (thank you @Izacus) on androidev reddit. \nFirst:</p>\n\n<ul>\n<li><p><code>vect.r &amp; 0xff</code> and other clipping operations in the return statement won't do a thing, because vect.r is uchar and it'll wrap around [0, 255] range by itself. So to avoid confusion I changed that line to:</p>\n\n<pre><code>return 0xff &lt;&lt; 24 | vect.r &lt;&lt; 16 | vect.g &lt;&lt; 8 | vect.b;\n</code></pre></li>\n<li><p>Using <code>int</code> type is dangerous when targeting multiple platform, use <code>int32_t</code> instead.</p></li>\n</ul>\n\n<p>So, the problem was in fact into the bitwise operation. <code>vect.r</code>, <code>vect.g</code> and <code>vect.b</code> are <strong>unsigned</strong> chars and it seems to cause an overflow or a shift or something when summing them with <code>|</code> operator to create a <strong>signed</strong> 32bit integer. </p>\n\n<p>To fix it, I changed <code>uchar3 vect;</code> to <code>int3 vect;</code></p>\n"}], "owner": {"reputation": 737, "user_id": 2370725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1712168e167f14445f38f79e581bb87e?s=128&d=identicon&r=PG", "display_name": "Pdroid", "link": "https://stackoverflow.com/users/2370725/pdroid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 150, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547138246, "creation_date": 1547059509, "last_edit_date": 1547071621, "question_id": 54116462, "link": "https://stackoverflow.com/questions/54116462/issue-when-boxing-4-uchar-into-an-int-renderscript", "title": "Issue when boxing 4 uchar into an int (RenderScript)", "body": "<p>In my RenderScript program, I want to return a 32bit integer representing color (to be directly a color in the Java framework), so I do this that way:</p>\n\n<p>RS code:</p>\n\n<pre><code>static const uchar k = 51;\nstatic const uchar d = 5;\nstatic int32_t histo[52][52][52];\n....\n\nint __attribute__((kernel)) getResult() {\n    int maximum = 0;\n    uchar3 vect = {0, 0, 0};\n    ....\n    loops through histogram and puts max's coordinates into vect\n    ...\n    // Convert coords back to [0, 255] space\n    vect.r = (uchar) (vect.s0*d + d/2);\n    vect.g = (uchar) (vect.s1*d + d/2);\n    vect.b = (uchar) (vect.s2*d + d/2);\n\n    return (0xff) &lt;&lt; 24 | (vect.r &amp; 0xff) &lt;&lt; 16 | (vect.g &amp; 0xff) &lt;&lt; 8 | (vect.b &amp; 0xff);\n}\n</code></pre>\n\n<p>Java code:</p>\n\n<pre><code> Allocation bmpAlloc = Allocation.createFromBitmap(rs, bitmap);\n\n // Allocation where to store the result color (for output purposes)\n Allocation colorAlloc = Allocation.createSized(rs, Element.I32(rs), 1);\n\n ScriptC_findcolor scriptC = new ScriptC_findcolor(rs);\n scriptC.forEach_channelHist(bmpAlloc);\n scriptC.forEach_getResult(colorAlloc);\n\n int[] a = new int[1];\n colorAlloc.copyTo(a);\n int color = a[0];\n</code></pre>\n\n<p>It works perfectly when using a x86 emulator, but for some reason with a real device the value received in Java side is completely random.</p>\n\n<p>As you can see, the alpha channel is hardcoded to 255 (0xff) in the .rs script, but on the Java side value is not 255 at all (102, 164 ...).</p>\n\n<p>Can someone help ? Thanks</p>\n"}, {"tags": ["c", "sockets", "unix", "file-descriptor", "dup2"], "comments": [{"owner": {"reputation": 102109, "user_id": 1600898, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/01377f8b31f24b0265854666b29d0c03?s=128&d=identicon&r=PG", "display_name": "user4815162342", "link": "https://stackoverflow.com/users/1600898/user4815162342"}, "edited": false, "score": 4, "creation_date": 1547059379, "post_id": 54116344, "comment_id": 95065613, "body": "&quot;the first dup2() closes fd1, which closes also fd3&quot; - have you actually verified that that&#39;s the case? The fact that <code>fd1</code> and <code>fd3</code> point to the same open file does <b>not</b> mean that closing one automatically closes the other. If that were the case, redirections would be impossible."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1547059518, "post_id": 54116344, "comment_id": 95065667, "body": "What do you mean &quot;aware&quot;? A low-level file descriptor is just a number. You can copy it over."}, {"owner": {"reputation": 5867, "user_id": 2252087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/020cbe41b02f03d59f3adae022c0ce7d?s=128&d=identicon&r=PG", "display_name": "ensc", "link": "https://stackoverflow.com/users/2252087/ensc"}, "edited": false, "score": 0, "creation_date": 1547065747, "post_id": 54116344, "comment_id": 95068271, "body": "API sounds error prone; what is when application makes <code>dup(fd1)</code> before <code>api_select()</code> and works on this copy?  If possible you should change the API so that e.g. <code>api_select()</code> returns an fd, and/or provide functions operating on your fd (e.g. <code>api_read()</code>)"}, {"owner": {"reputation": 55, "user_id": 4514738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qy83d.jpg?s=128&g=1", "display_name": "Muffin", "link": "https://stackoverflow.com/users/4514738/muffin"}, "edited": false, "score": 0, "creation_date": 1547066224, "post_id": 54116344, "comment_id": 95068479, "body": "The application doesn\u2019t call dup(), api_select() does. Moreover api_select() needs to be transparent to the application that why it returns the same codes that select() would return."}, {"owner": {"reputation": 10928, "user_id": 1358308, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d9448dee25fd2278def77cb7f0353574?s=128&d=identicon&r=PG", "display_name": "Sam Mason", "link": "https://stackoverflow.com/users/1358308/sam-mason"}, "edited": false, "score": 0, "creation_date": 1547071112, "post_id": 54116344, "comment_id": 95070545, "body": "<a href=\"https://en.wikipedia.org/wiki/File_descriptor\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/File_descriptor</a> and <a href=\"https://stackoverflow.com/q/5256599/1358308\">stackoverflow.com/q/5256599/1358308</a> have reasonable descriptions of how file descriptors work\u2026  I&#39;d suggest just keeping track of the &quot;right&quot; file descriptor, rather than using <code>dup*()</code> functions which tend to be useful when you&#39;re implementing a shell and need to make sure that &quot;FD1&quot; is actually standard input"}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 4514738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qy83d.jpg?s=128&g=1", "display_name": "Muffin", "link": "https://stackoverflow.com/users/4514738/muffin"}, "edited": false, "score": 0, "creation_date": 1547064565, "post_id": 54116778, "comment_id": 95067774, "body": "Thanks for your answer. The last part is somewhat confusing to me, so I want to elaborate a little bit more on what the API does. Please see my EDIT in the question."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 55, "user_id": 4514738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qy83d.jpg?s=128&g=1", "display_name": "Muffin", "link": "https://stackoverflow.com/users/4514738/muffin"}, "edited": false, "score": 0, "creation_date": 1547070436, "post_id": 54116778, "comment_id": 95070249, "body": "@Muffin, I have added commentary directed toward your edit."}, {"owner": {"reputation": 55, "user_id": 4514738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qy83d.jpg?s=128&g=1", "display_name": "Muffin", "link": "https://stackoverflow.com/users/4514738/muffin"}, "edited": false, "score": 0, "creation_date": 1547072447, "post_id": 54116778, "comment_id": 95071066, "body": "Ok I can see where the problems can arise, I just want to clarify the workings of <code>api_select()</code>. In the API every fd is just a member of a much more complex data structure called socketlist, which as the name implies is a linked list. The first element of the list has the fd the caller is aware of, all the new connection attempts with their fd follow. When api_select() gets called it goes through the list and before the actual select() calles FD_SET() on every fd that&#39;s in the list. So if for example fd2 is the one that conneced FD_ISSET(fd2, write_set) will be true."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 55, "user_id": 4514738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qy83d.jpg?s=128&g=1", "display_name": "Muffin", "link": "https://stackoverflow.com/users/4514738/muffin"}, "edited": false, "score": 0, "creation_date": 1547073305, "post_id": 54116778, "comment_id": 95071341, "body": "Fine, @Muffin, but after <code>select()</code> returns, only those file descriptors that it determined were ready will be set any longer.  If you <i>then</i> swap file descriptors, the caller will not see the expected FD set, even though, courtesy of the swap, it actually is ready."}, {"owner": {"reputation": 55, "user_id": 4514738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qy83d.jpg?s=128&g=1", "display_name": "Muffin", "link": "https://stackoverflow.com/users/4514738/muffin"}, "edited": false, "score": 0, "creation_date": 1550177031, "post_id": 54116778, "comment_id": 96184418, "body": "Sorry it took so long to actually update you on the matter. Anyway, I know that trying to explain how my APIs work would be impossible, but I wanted to let you know that doing what I had in mind worked with some adjustments I&#39;ve done thanks to your answer. Thanks!"}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 4, "last_activity_date": 1547070784, "last_edit_date": 1547070784, "creation_date": 1547061024, "answer_id": 54116778, "question_id": 54116344, "link": "https://stackoverflow.com/questions/54116344/how-to-swap-two-open-file-descriptors/54116778#54116778", "title": "How to swap two open file descriptors?", "body": "<blockquote>\n  <p>I think my best options are using <code>dup()</code> and/or <code>dup2()</code>, but according\n  to the their man page, <code>dup()</code> creates a copy of the fd passed to the\n  function, but which refers to the same open file description,</p>\n</blockquote>\n\n<p>Yes.</p>\n\n<blockquote>\n  <p>meaning\n  that the two can be used interchangeably,</p>\n</blockquote>\n\n<p>Maybe.  It depends on what you mean by \"interchangeably\".</p>\n\n<blockquote>\n  <p>and <code>dup2()</code> closes the new fd\n  which replaces the old fd.</p>\n</blockquote>\n\n<p><code>dup2()</code> closes the <em>target</em> file descriptor, if it is open, before duping the source descriptor onto it.  Perhaps that's what you meant, but I'm having trouble reading your description that way.</p>\n\n<blockquote>\n  <p>So my assumptions on what would happen are (excuse my crappy pseudo\n  code)</p>\n\n<pre><code>int fd1, fd2, fd3;\n\nfd1 = socket(x); // what the app is aware of\nfd2 = socket(y); // first to connect\n\nfd3 = dup(fd1); // fd1 and fd3 indentify the same description\n</code></pre>\n</blockquote>\n\n<p>Good so far.</p>\n\n<blockquote>\n<pre><code>dup2(fd2, fd1); // The description identified by fd2 is now identified by fd1, the description previously identified by fd1 (and fd3) is closed\n</code></pre>\n</blockquote>\n\n<p>No, the comment is incorrect.  <em>File descriptor</em> <code>fd1</code> is first closed, and then made to be a duplicate of <code>fd2</code>.  The underlying open file description to which <code>fd1</code> originally referred is <strong>not</strong> closed, because the process has another open file descriptor associated with it, <code>fd3</code>.</p>\n\n<blockquote>\n<pre><code>dup2(fd3, fd2); // The description identified by fd3 (copy of fd1, closed in the line above) is identified by fd2 (which can be closed and reassigned to fd3) since now the thescription that was being identified by fd2 is being identified by fd1.\n</code></pre>\n  \n  <p>Which looks fine, except for the fact that the first <code>dup2()</code> closes\n  fd1,</p>\n</blockquote>\n\n<p>Yes it does.</p>\n\n<blockquote>\n  <p>which closes also fd3</p>\n</blockquote>\n\n<p>No it doesn't.</p>\n\n<blockquote>\n  <p>since they are identifying the same file\n  description.</p>\n</blockquote>\n\n<p>Irrelevant.  Closing is a function on file descriptors, not, directly, on the underlying open file descriptions.  In fact, it would be best not to use the word \"identifying\" here, for that suggests that file descriptors are some kind of identifier or alias for open file descriptions.  They are not.  File descriptors identify entries in a table of associations with open file descriptions, but are not themselves open file descriptions.</p>\n\n<p>In short, your sequence of <code>dup()</code>, <code>dup2()</code>, and <code>dup2()</code> calls should effect exactly the kind of swap you want, provided that they all succeed.  They do, however, leave an extra open file descriptor hanging around, which would yield a file descriptor leak under many circumstances.  Therefore, don't forget to finish up with a</p>\n\n<pre><code>close(fd3);\n</code></pre>\n\n<hr>\n\n<p>Of course, <strong>all that assumes that it is the <em>value</em> of <code>fd1</code> that is special to the application, not the <em>variable</em> containing it</strong>.  File descriptors are just numbers.  There is nothing inherently special about the objects that contain them, so if it is the variable <code>fd1</code> that the application needs to use, regardless of its specific value, then all you need to do is perform an ordinary swap of integers:</p>\n\n<pre><code>fd3 = fd1;\nfd1 = fd2;\nfd2 = fd3;\n</code></pre>\n\n<p><strong>With respect to the edit</strong>, you write,</p>\n\n<blockquote>\n  <p>When the application calls <code>api_connect()</code>, it passes to the function a\n  pointer to an int (together with all the necessary addresses and\n  protocols etc). api_connect() will call socket(), bind() and\n  connect(), the important part is that it will write the return value\n  of socket() in the memory parsed through the pointer.</p>\n</blockquote>\n\n<p>Whether <code>api_connect()</code> returns the file descriptor value by writing it through a pointer or by conveying it as or in the function's return value is irrelevant.  The point remains that it is the <em>value</em> that matters, not the object, if any, containing it.</p>\n\n<blockquote>\n  <p>This is what I\n  mean by \"The socket is only aware of one fd\". The application will\n  then call <code>FD_SET(fd1, write_set)</code>, call a <code>api_select()</code> and then check\n  if the fd is writable by calling <code>FD_ISSET(fd1, write_set)</code>.</p>\n</blockquote>\n\n<p>Well that sounds problematic in light of the rest of your description.</p>\n\n<blockquote>\n  <p>[Under some conditions,]\n  <code>api_select()</code> creates a new connection on a different interface\n  (calling all the necessary socket(), bind() and connect()). This\n  connection is identified by a new fd -fd2- the application doesn't\n  know about, and which is tracked in the API.</p>\n  \n  <p>Now, if the application calls <code>api_select()</code> with <code>FD_SET(fd1, write_set)</code>\n  and the API realises that is the second connection that has completed,\n  thus making fd2 writable, I want the application to use fd2. The\n  problem is that the application will only call <code>FD_ISSET(fd1,\n  write_set)</code> and <code>write(fd1)</code> afterwards, that's why I need to replace fd2\n  with fd1.</p>\n</blockquote>\n\n<p>Do note that even if you do swap file descriptors as described in the first part of this answer, that will have no effect on either FD's membership in any <code>fd_set</code>, for such membership is <em>logical</em>, not physical.  You will have to manage <code>fd_set</code> membership manually if the caller relies on that.</p>\n\n<p>It is unclear to me whether <code>api_select()</code> is intended to provide services for more than one (caller-specified) file descriptor at the same time, as <code>select()</code> can do, but I imagine that the bookkeeping required for it to do so would be monstrous.  On the other hand, if in fact the function handles only one caller-provided FD at a time, then mimicking the interface of <code>select()</code> is ... odd.</p>\n\n<p>In that case, I would strongly urge you to design a more suitable interface.  Among other things, such an interface should moot the question of swapping FDs.  Instead, it can directly tell the caller what FD, if any, is ready for use, either by returning it or by writing it through a pointer to a variable specified by the caller.</p>\n\n<p>Also, in the event that you do switch, one way or another, to an alternative FD, do not overlook managing the old one lest you leak a file descriptor.  Each process has a pretty limited quantity of those available, so a file descriptor leak can be much more troublesome than a memory leak.  In the event that you do switch, then, are you sure you really need to swap, as opposed to just <code>dup2()</code>ing the new FD onto the old, then closing the new?</p>\n"}], "owner": {"reputation": 55, "user_id": 4514738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qy83d.jpg?s=128&g=1", "display_name": "Muffin", "link": "https://stackoverflow.com/users/4514738/muffin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 596, "favorite_count": 0, "accepted_answer_id": 54116778, "answer_count": 1, "score": 3, "last_activity_date": 1560681360, "creation_date": 1547058986, "last_edit_date": 1560681360, "question_id": 54116344, "link": "https://stackoverflow.com/questions/54116344/how-to-swap-two-open-file-descriptors", "title": "How to swap two open file descriptors?", "body": "<p>For my master thesis project I am building an API in C that works with Unix sockets. To make it short, I have two sockets identified by their two fds, on which I have called a <code>O_NONBLOCK</code> <code>connect()</code>. At this point, I am calling <code>select()</code> to check which one connects first and is ready for writing.</p>\n\n<p>The problems start now, as the application which is using this API is aware of only one of those sockets, let's say the one identified by fd1. If the socket identified by fd2 is the first to connect, the application has no way to know it can write to that socket. </p>\n\n<p>I think my best options are using <code>dup()</code> and/or <code>dup2()</code>, but according to the their man page, <code>dup()</code> creates a copy of the fd passed to the function, but which refers to the same open file description, meaning that the two can be used interchangeably, and <code>dup2()</code> closes the new fd which replaces the old fd.</p>\n\n<p>So my assumptions on what would happen are (in pseudo code)</p>\n\n<pre><code>int fd1, fd2, fd3;\n\nfd1 = socket(x); // what the app is aware of\nfd2 = socket(y); // first to connect\n\nfd3 = dup(fd1); // fd1 and fd3 identify the same description\ndup2(fd2, fd1); // The description identified by fd2 is now identified by fd1, the description previously identified by fd1 (and fd3) is closed\ndup2(fd3, fd2); // The description identified by fd3 (copy of fd1, closed in the line above) is identified by fd2 (which can be closed and reassigned to fd3) since now the the description that was being identified by fd2 is being identified by fd1.\n</code></pre>\n\n<p>Which looks fine, except for the fact that the first <code>dup2()</code> closes fd1, which closes also fd3 since they are identifying the same file description. The second <code>dup2()</code> works fine but it's replacing the fd of a connection which has been closed by the first one, while I want it to keep trying to connect.</p>\n\n<p>Can anyone with a better understanding of Unix file descriptors help me out?</p>\n\n<p>EDIT: I want to elaborate a little bit more on what the API does and why the application only sees one fd. </p>\n\n<p>The API provides to the application the means to call a very \"fancy\" version of <code>connect()</code> <code>select()</code> and <code>close()</code>.</p>\n\n<p>When the application calls <code>api_connect()</code>, it passes to the function a pointer to an int (together with all the necessary addresses and protocols etc). <code>api_connect()</code> will call  <code>socket()</code>, <code>bind()</code> and <code>connect()</code>, the important part is that it will write the return value of <code>socket()</code> in the memory parsed through the pointer. This is what I mean by \"The socket is only aware of one fd\". The application will then call <code>FD_SET(fd1, write_set)</code>, call a api_select() and then check if the fd is writable by calling <code>FD_ISSET(fd1, write_set)</code>. <code>api_select()</code> works more or less like <code>select()</code>, but has a timer which can trigger a timeout if the connection takes more than a set amount of time to connect (since it's <code>O_NONBLOCK</code>). If this happens, <code>api_select()</code> creates a new connection on a different interface (calling all the necessary <code>socket()</code>, <code>bind()</code> and <code>connect()</code>). This connection is identified by a new fd -fd2- the application doesn't know about, and which is tracked in the API. </p>\n\n<p>Now, if the application calls <code>api_select()</code> with <code>FD_SET(fd1, write_set)</code> and the API realises that is the second connection that has completed, thus making fd2 writable, I want the application to use fd2. The problem is that the application will only call <code>FD_ISSET(fd1, write_set)</code> and <code>write(fd1)</code> afterwards, that's why I need to replace fd2 with fd1. </p>\n\n<p>At this point I'm really confused on whether I really need to dup or just do an integer swap (my understanding of Unix file descriptors is just a little bit more than basic). </p>\n"}, {"tags": ["c", "string", "file"], "comments": [{"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 1, "creation_date": 1547058939, "post_id": 54116297, "comment_id": 95065446, "body": "Simple question - but any reason why you chose C to do this?  Higher level languages make it muck easier to do string manipulations and usually have better built-in libraries."}, {"owner": {"reputation": 19, "user_id": 7350229, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae388001f875b6ffc37def2706978355?s=128&d=identicon&r=PG&f=1", "display_name": "Yusmen Rashidov", "link": "https://stackoverflow.com/users/7350229/yusmen-rashidov"}, "reply_to_user": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1547059110, "post_id": 54116297, "comment_id": 95065508, "body": "I have a university project and it must be in C otherwise I would use Java for this task"}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 3, "creation_date": 1547059444, "post_id": 54116297, "comment_id": 95065639, "body": "What you are asking is not trivial.  Getting comment blocks correct and dealing with weird edge cases like : <code>&#47;&#47; &#47;*</code> make this a real debugging task.  I cleaned up your paste above, but now, I will ask you how much time an effort you have put in with your debugger?  Walking through it should tell you when things are not working as expected.  Also, your &quot;int...&quot; line - are you missing a double quote here?  Otherwise, I would see 6 values with your requirements."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1547059549, "post_id": 54116297, "comment_id": 95065683, "body": "You may want to roll in a C regular expression library and side-step all this messy parsing. You&#39;ll end up writing your own by accident if you&#39;re not careful."}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1547059717, "post_id": 54116297, "comment_id": 95065755, "body": "<code>strtok()</code> will help with delimiting if you wish as well."}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1547064200, "post_id": 54116297, "comment_id": 95067621, "body": "FYI on the quote step - I missed that you had &quot;quoted&quot; the quote with a backslash C-Style.  Gonna have to add code to check for that too."}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 1, "creation_date": 1547064465, "post_id": 54116297, "comment_id": 95067726, "body": "More advice - You have tried to do everything at once and caused somewhat of a train wreck.  Instead, first, get a word counter working, then get it working with delimiters, then add <code>&#47;&#47;</code> checks, then add more... until you have a working prototype.  This will help you keep it all working together correctly.  When you do it all at once, you have no idea where any bugs actually exist."}], "answers": [{"comments": [{"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1547064080, "post_id": 54117416, "comment_id": 95067576, "body": "Notice also that all OP&#39;s current special comment cases are only checking from the first character of the string..."}], "tags": [], "owner": {"reputation": 2649, "user_id": 4022617, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/nk22l.png?s=128&g=1", "display_name": "dgnuff", "link": "https://stackoverflow.com/users/4022617/dgnuff"}, "is_accepted": false, "score": 0, "last_activity_date": 1547065854, "last_edit_date": 1547065854, "creation_date": 1547063848, "answer_id": 54117416, "question_id": 54116297, "link": "https://stackoverflow.com/questions/54116297/finding-words-in-a-file-does-not-work-correctly/54117416#54117416", "title": "Finding words in a file does not work correctly", "body": "<p>Expanding on @MichaelDorgan's comment, there are several other edge cases you need to deal with regarding strings.  Both of these will cause your current parser to fail:</p>\n\n<pre><code>\"This string \\\" contains a double quote\"\n\"This one contains ' a single quote\"\n</code></pre>\n\n<p>I would strongly advise changing the fundamental architecture of the parser to start in a state where words are recognized, but if you see any of <code>/*</code> <code>//</code> <code>\"</code> or <code>'</code> you switch to a state that (A) ignores words, and (B) uses a separate loop to consume input until it correctly recognizes a valid termination for the current state, after which it returns to the initial state.</p>\n\n<p>So <code>/*</code> will continue to read text until it finds a <code>*/</code>, while <code>//</code> simply discards the remainder of the current line and then resets.  Likewise <code>\"</code> and <code>'</code> scan forward till they find a second unescaped copy, ignoring everything else.  You'll need to pay special attention to backslashes in this mode so you correctly process things like <code>\"\\\"\"</code>, <code>\"\\\\\"</code> <code>\"\\\\\\\"\"</code> etc.</p>\n"}], "owner": {"reputation": 19, "user_id": 7350229, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae388001f875b6ffc37def2706978355?s=128&d=identicon&r=PG&f=1", "display_name": "Yusmen Rashidov", "link": "https://stackoverflow.com/users/7350229/yusmen-rashidov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1547065854, "creation_date": 1547058784, "last_edit_date": 1547063687, "question_id": 54116297, "link": "https://stackoverflow.com/questions/54116297/finding-words-in-a-file-does-not-work-correctly", "title": "Finding words in a file does not work correctly", "body": "<p>I am making a function in C that reads file and finds the word that are not in a comment and in string(e.g. printf(\"Hello world\") I need only printf, \"hello\" and \"world\" must not be counted) but in some files my program counts also the words in string</p>\n\n<pre><code>int isDelimiter(char *delim, char c){\n  int i = 0;\n  while (delim[i])\n  {\n    if (delim[i] == c)\n        return 1;\n    i++;\n  }\n  return 0;\n}\n\nint getIdentifiers(FILE *filePointer){\n\n  char line[256], identifier[100];\n\n  //char delimiters[] = \"\\n\\[]();~`!=&gt;&lt;|*/:&amp;% \\t\\\"{},-+#^$'&amp;\";\n  char delimiters[] = {'\\n', '\\\"', '[', ']', '(', ')', ';', '~', '`', \n    '!', '=', '&lt;','&gt;', '|', '*','/',':','&amp;',\n    '%','\\t', '{', '}', ',','-','+','#','^','$','&amp;','\\0'};\n\n  int cnt=0, inWord=0, isString=0, isSingleLineComment=0, \n     isMultiComment=0, isChar=0;\n\n  rewind(filePointer);\n\n  while(fgets(line, sizeof(line), filePointer)!=NULL){\n\n    int i=0, j=0;\n\n    isSingleLineComment=0;\n\n    while(line[i]){\n\n      //multi line comment check\n      if(line[i]=='/' &amp;&amp; line[i+1]=='*') isMultiComment=1;\n\n      //single line comment\n      if(line[i]=='/' &amp;&amp; line[i+1]=='/') isSingleLineComment=1;\n\n      //ending multi line comment\n      if(line[i]=='*' &amp;&amp; line[i+1]=='/' &amp;&amp; isMultiComment==1) isMultiComment=0;\n\n      //checking for string\n      if(line[i]=='\"' &amp;&amp; isString==0) isString=1;\n\n      //check if assignment char is in quote\n      if(line[i]=='\\'' &amp;&amp; isChar==0) isChar =1;\n      else if(line[i]=='\\'' &amp;&amp; isChar==1) isChar=0;\n\n      //splitting textline into words\n      if(inWord==0){\n        if(!isDelimiter(delimiters, line[i])) {\n          inWord = 1;\n          identifier[j] = line[i];\n          j++;\n        } else {\n          i++;\n          continue;\n        }\n      } else {\n        //ending word\n        if(isDelimiter(delimiters, line[i])) {\n          if(line[i]=='\"' ) isString=1;\n\n          inWord=0;\n          identifier[j]= '\\0';\n          j=0;\n\n          // identifier checking\n          if(!isString &amp;&amp; !isMultiComment &amp;&amp; !isSingleLineComment &amp;&amp; \n             !isChar &amp;&amp;\n             !isdigit(identifier[0])){\n             cnt++;\n          }\n        } else {\n          identifier[j]= line[i];\n          j++;\n        }\n      }\n\n      if(line[i]=='\"' &amp;&amp; isString){\n        isString=0;\n      }\n      i++;\n    }\n  }\n\n  return cnt;\n}\n</code></pre>\n\n<p>The file that i test contains:</p>\n\n<blockquote>\n  <p><br>int a;\n           <br> //int c;\n           <br> /*int k;\n           <br> */\n           <br> \"int i;\\\"int c;\"\n           <br> int =e;</p>\n</blockquote>\n\n<p>The expected return value must be 4(the words i need are 'int', 'a', 'int' and 'e' but the value is 2.</p>\n"}, {"tags": ["c", "struct", "segmentation-fault", "malloc", "calloc"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1547058854, "post_id": 54116259, "comment_id": 95065405, "body": "<code>blocks[i].mesh-&gt;x = &amp;i8;</code> has overwritten the pointer to the memory allocation just returned by <code>calloc</code>. It&#39;s unclear what you are trying to do by allocating memory which is enough for only one <code>double</code> variable."}, {"owner": {"reputation": 53, "user_id": 10445266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VLWMIAM17kA/AAAAAAAAAAI/AAAAAAAAABk/0o8RN4GwWnE/photo.jpg?sz=128", "display_name": "federico rovere", "link": "https://stackoverflow.com/users/10445266/federico-rovere"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1547059291, "post_id": 54116259, "comment_id": 95065583, "body": "i am trying to assign the variable."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1547059516, "post_id": 54116259, "comment_id": 95065665, "body": "Try <code>*blocks[i].mesh-&gt;x = i8;</code>"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547059549, "post_id": 54116259, "comment_id": 95065682, "body": "Which variable? <code>x</code> inside <code>strut vect3d1</code> is a <i>pointer</i>. It <i>points</i> to a variable, but is a variable itself (has a value). <code>blocks[i].mesh-&gt;x = calloc(1,sizeof(double));</code> allocates memory for a single double variable and stores the pointer value inside the <code>blocks[i].mesh-&gt;x</code> vairable. You can modify the <i>memory</i> by using the * operator, like <code>*blocks[i].mesh-&gt;x  = 0.5</code>."}, {"owner": {"reputation": 53, "user_id": 10445266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VLWMIAM17kA/AAAAAAAAAAI/AAAAAAAAABk/0o8RN4GwWnE/photo.jpg?sz=128", "display_name": "federico rovere", "link": "https://stackoverflow.com/users/10445266/federico-rovere"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1547059723, "post_id": 54116259, "comment_id": 95065756, "body": "@WeatherVane it gives segmentation fault as well"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1547059780, "post_id": 54116259, "comment_id": 95065777, "body": "My comment agrees with the one from Kamil. Did you copy it correctly?"}, {"owner": {"reputation": 53, "user_id": 10445266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VLWMIAM17kA/AAAAAAAAAAI/AAAAAAAAABk/0o8RN4GwWnE/photo.jpg?sz=128", "display_name": "federico rovere", "link": "https://stackoverflow.com/users/10445266/federico-rovere"}, "edited": false, "score": 0, "creation_date": 1547059943, "post_id": 54116259, "comment_id": 95065843, "body": "Initially not, sorry. I have modified my previous comment. It gives again segmentation fault."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1547060242, "post_id": 54116259, "comment_id": 95065958, "body": "You have not allocated any memory for <code>struct vect3d1 *mesh</code>"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1547063896, "post_id": 54116259, "comment_id": 95067499, "body": "Do you need <code>mesh</code> to be a pointer?  Structures can contain other structures directly if that would serve your purpose.  There are several reasons why it might not, but none of them are evident in the code presented."}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 10445266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VLWMIAM17kA/AAAAAAAAAAI/AAAAAAAAABk/0o8RN4GwWnE/photo.jpg?sz=128", "display_name": "federico rovere", "link": "https://stackoverflow.com/users/10445266/federico-rovere"}, "edited": false, "score": 0, "creation_date": 1547112245, "post_id": 54117340, "comment_id": 95082265, "body": "Thank you for your help, i am sorry but i am not sure to understand properly. I have to allocate memory also for mesh? Why? malloc for block is not enough?"}, {"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "reply_to_user": {"reputation": 53, "user_id": 10445266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VLWMIAM17kA/AAAAAAAAAAI/AAAAAAAAABk/0o8RN4GwWnE/photo.jpg?sz=128", "display_name": "federico rovere", "link": "https://stackoverflow.com/users/10445266/federico-rovere"}, "edited": false, "score": 0, "creation_date": 1547112833, "post_id": 54117340, "comment_id": 95082620, "body": "<code>mesh</code> is a pointer inside <code>block</code>. When you allocate space for <code>block</code> you allocate just enough space for the <code>block</code> structure, which includes <code>int ibl</code>, <code>int i,j,k</code> and the pointer <code>struct vect3d1 *mesh</code>, so <code>mesh</code> (along with <code>ibl</code>, <code>i</code>, <code>j</code>, <code>k</code>) contains indeterminate value. And what would happen if you deference a pointer with indeterminate value? only god knows. So you need to allocate memory of size <code>struct vect3d1</code> and put the address in <code>mesh</code>. so <code>mesh = (struct vect3d1 *)malloc(sizeof (struct vect3d1))</code>"}], "tags": [], "owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "is_accepted": false, "score": 1, "last_activity_date": 1547063855, "last_edit_date": 1547063855, "creation_date": 1547063482, "answer_id": 54117340, "question_id": 54116259, "link": "https://stackoverflow.com/questions/54116259/segmentation-fault-allocating-memory-with-struct-of-struct/54117340#54117340", "title": "Segmentation fault allocating memory with struct of struct", "body": "<p>The reason for the seg fault is because you are dereferencing uninitialized pointer <code>blocks[i].mesh</code>. The address in <code>mesh</code> member is unknown as <code>malloc</code> returns uninitialized memory (<code>mesh</code> got it's value from memory allocated using the <code>malloc</code> of the <code>block</code>) and dereferencing such pointer is undefined behavior.</p>\n\n<p>Quoting C11, chapter \u00a77.22.3.5, The malloc function:</p>\n\n<blockquote>\n  <p>The malloc function allocates space for an object whose size is\n  specified by size and whose value is indeterminate.</p>\n</blockquote>\n\n<p>Quoting C11, annex \u00a7J.2, Undefined behavior:</p>\n\n<blockquote>\n  <p>The value of the object allocated by the malloc function is used</p>\n</blockquote>\n"}], "owner": {"reputation": 53, "user_id": 10445266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VLWMIAM17kA/AAAAAAAAAAI/AAAAAAAAABk/0o8RN4GwWnE/photo.jpg?sz=128", "display_name": "federico rovere", "link": "https://stackoverflow.com/users/10445266/federico-rovere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547063855, "creation_date": 1547058596, "question_id": 54116259, "link": "https://stackoverflow.com/questions/54116259/segmentation-fault-allocating-memory-with-struct-of-struct", "title": "Segmentation fault allocating memory with struct of struct", "body": "<p>i am quite new using allocate memory and pointers,</p>\n\n<p>my idea is try to create a struct inside a struct in order to use them after in the code, however far now i obtained a segmentation fault error that i cannot manage.\nThank you for any help </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main()\n\n{\n\nint nb;\ndouble i8,i9,i10;\n\nstruct vect3d1\n{\n        double *x,*y,*z;\n};\n\nstruct block\n{\n        int ibl;\n        int i,j,k;\n        struct vect3d1 *mesh;\n\n};\n\n\nstruct block *blocks;\n\ni8=8.0;\n\n\nnb=2;\nblocks=(struct block *)malloc(nb*sizeof(struct block));\n\nfor(int i=0;i&lt;nb;i++){\n\nblocks[i].ibl=i;\nblocks[i].mesh-&gt;x = calloc(1,sizeof(double));\nblocks[i].mesh-&gt;x = &amp;i8;\n</code></pre>\n\n<p>}\n}</p>\n"}, {"tags": ["c", "gdb", "global-variables", "lldb", "static-variables"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1547058227, "post_id": 54116157, "comment_id": 95065122, "body": "Your problem might be unsolvable in general. Be aware of <a href=\"https://en.wikipedia.org/wiki/Rice&#39;s_theorem\" rel=\"nofollow noreferrer\">Rice&#39;s theorem</a>"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 2, "creation_date": 1547058264, "post_id": 54116157, "comment_id": 95065137, "body": "Just the function itself, directly in its source code, or all the functions the function calls, directly and indirectly, including standard library routines?"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1547058340, "post_id": 54116157, "comment_id": 95065172, "body": "What about something equivalent to <code>if (false) printf(&quot;%d&quot;,x);</code> ? Does that access <code>x</code> ? Be aware of the <a href=\"https://en.wikipedia.org/wiki/As-if_rule\" rel=\"nofollow noreferrer\">as-if rule</a>"}, {"owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 1, "creation_date": 1547058519, "post_id": 54116157, "comment_id": 95065253, "body": "Just the source code that are compiled excluding system library."}, {"owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 2, "creation_date": 1547058680, "post_id": 54116157, "comment_id": 95065332, "body": "If at run time, that x should not be considered as accessed. At compile that x should be considered as accessed at syntactic level but unaccessed at semantic level."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547058868, "post_id": 54116157, "comment_id": 95065415, "body": "Undex Linux You can known a binary/lib uses a global var (or other thing) not defined in the object/lib through <code>nm -u | grep thenameyouwant</code> (managing the fact thenameyouwant is a prefix of course )"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1547061373, "post_id": 54116157, "comment_id": 95066432, "body": "Consider this: Delete any source code after the function. For any source code prior to the function, change any definitions to declarations. Compile the module. Use <code>nm -u</code> to see the symbols it refers to. Would that do what you want? If so, why not? (The difference will help clarify your question.)"}, {"owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 0, "creation_date": 1547061549, "post_id": 54116157, "comment_id": 95066511, "body": "There are thousands of functions. I can not delete each function and compile as it will take too much time."}, {"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "edited": false, "score": 0, "creation_date": 1547065814, "post_id": 54116157, "comment_id": 95068303, "body": "you can do it by compiling the code with debug information, than using <code>objdump</code> (or equivalent) you will be able to view the DWARF (or equivalent) debug information which contain whole lot of who refers to who and in which line, down side is that if you compiled with libraries without debug information then those libraries would not appear in the debug information."}, {"owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 1, "creation_date": 1547076121, "post_id": 54116157, "comment_id": 95072110, "body": "On Mac objdump is available natively and in binutils. Are you referring to the binutils&#39; objdump? Is Mac&#39;s native objdump still appropriate? What options I should use? Thanks."}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1547152957, "post_id": 54116157, "comment_id": 95104696, "body": "If you want a runtime tool: With the Intel pin tool, you can probably write out a trace of all the memory locations accessed along with the pc, then post-process it to get the info you want."}, {"owner": {"reputation": 9358, "user_id": 35989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/320239374ee6d1ae0d8c6889b0de89a9?s=128&d=identicon&r=PG", "display_name": "Dipstick", "link": "https://stackoverflow.com/users/35989/dipstick"}, "edited": false, "score": 0, "creation_date": 1547599981, "post_id": 54116157, "comment_id": 95244316, "body": "Doxygen? Cscope? Kscope?"}], "answers": [{"tags": [], "owner": {"reputation": 20083, "user_id": 2465073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0f7ba796598ce99fe9d17b66c119b00?s=128&d=identicon&r=PG", "display_name": "Jim Ingham", "link": "https://stackoverflow.com/users/2465073/jim-ingham"}, "is_accepted": false, "score": 0, "last_activity_date": 1547598769, "creation_date": 1547598769, "answer_id": 54208816, "question_id": 54116157, "link": "https://stackoverflow.com/questions/54116157/how-to-know-what-global-variables-or-static-variales-are-referred-by-what-functi/54208816#54208816", "title": "How to know what global variables or static variales are referred by what functions? (C)", "body": "<p>To answer the \"Alternatively\" part of your question, lldb doesn't support software implemented watchpoints as they don't actually work very well.  So like gdb we are limited to the hardware resources of the machine you are running on.  Unless the globals you want to watch are really big, you should be able to put watchpoints on them one by one, however.</p>\n\n<p>Of course the debugger will only be able to tell you who accessed the watched data in the code that was actually run during the debug session.  So if you want a comprehensive answer for the whole program, the debugger is not the right tool.</p>\n"}], "owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 120, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1547598769, "creation_date": 1547058090, "question_id": 54116157, "link": "https://stackoverflow.com/questions/54116157/how-to-know-what-global-variables-or-static-variales-are-referred-by-what-functi", "title": "How to know what global variables or static variales are referred by what functions? (C)", "body": "<p>I'd like to know what functions refer (read or write) global or static variables in an executable compiled from C.</p>\n\n<p>I don't think gdb or lldb offer such a function out-of-the-box. Is there some other  tool that can do this?</p>\n\n<p>Alternatively, one can get all the global and static variables from gdb/lldb and set a watchpoint on each variable. However, gdb seems not able to allow soft only watchpoint for read as this will require a large number of watchpoints that hardware watchpoints just can not do it. So I'd assume gdb is not appropriate to know what functions refer to what global/static variables.</p>\n\n<p>Is lldb suitable for this task? Is there a ready to use solution for it?</p>\n"}, {"tags": ["c", "database", "file", "passwords", "fstream"], "comments": [{"owner": {"reputation": 527, "user_id": 10488746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vTDhZ.jpg?s=128&g=1", "display_name": "H.cohen", "link": "https://stackoverflow.com/users/10488746/h-cohen"}, "edited": false, "score": 0, "creation_date": 1547058447, "post_id": 54116105, "comment_id": 95065218, "body": "if you check out fopen() man page you have: &quot;a&quot; this Appends to a file. Writing operations, append data at the end of the file. The file is created if it does not exist.&quot;w&quot; Creates an empty file for writing. If a file with the same name already exists, its content is erased and the file is considered as a new empty file."}], "answers": [{"tags": [], "owner": {"reputation": 323, "user_id": 9197527, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X2zXf.jpg?s=128&g=1", "display_name": "mjung", "link": "https://stackoverflow.com/users/9197527/mjung"}, "is_accepted": true, "score": 0, "last_activity_date": 1547065497, "creation_date": 1547065497, "answer_id": 54117801, "question_id": 54116105, "link": "https://stackoverflow.com/questions/54116105/c-password-database/54117801#54117801", "title": "C password database", "body": "<p>Have a look at the <a href=\"https://www.tutorialspoint.com/c_standard_library/c_function_fopen.htm\" rel=\"nofollow noreferrer\">fopen documentation</a>. The magic phrase here is \"access mode\". As you open the file, the FILE pointer points to a certain position inside of the file. By setting the appropriate access mode, you can choose where the position pointer will be placed when the file is opened. Maybe the function <a href=\"https://www.tutorialspoint.com/c_standard_library/c_function_fseek.htm\" rel=\"nofollow noreferrer\">fseek</a> is interesting for you, too. It allows you to move that pointer.</p>\n\n<p><strong>A few more tips for your code:</strong></p>\n\n<ul>\n<li>Make sure that you don't use to many unneccessary variables, since\nthey make your code confusing.</li>\n<li>When you use fopen, always check wether the pointer is set correctly\n(check for NULL), otherwise your program may crash with a\nsegmentation fault if it is unable to find or access the file.</li>\n<li>In C everything that differs from 0 or NULL is true. That applies for\npointers as for numeric values. Feel free to use the negation\noperator \"!\" in combination with such tests.</li>\n</ul>\n"}], "owner": {"reputation": 13, "user_id": 10846939, "user_type": "registered", "profile_image": "https://graph.facebook.com/1984432125006596/picture?type=large", "display_name": "Stefan Catalin", "link": "https://stackoverflow.com/users/10846939/stefan-catalin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 54117801, "answer_count": 1, "score": 0, "last_activity_date": 1547065497, "creation_date": 1547057808, "question_id": 54116105, "link": "https://stackoverflow.com/questions/54116105/c-password-database", "title": "C password database", "body": "<p>I've created a program that let's you change the password from a file if you enter the previous password that was in that file.What I want to do is to be able to create a username that's gets assigned with a password.The username and the password should be written in the file without deleting anything that was there before.The program should also be able to validate the password for the username in the file.Here is my current code,but i can't manage to write multiple things in the given file.I don't want you to give me the code for my question, only the algorythm with some tips.Thank you!</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include &lt;conio.h&gt;\n#include &lt;fstream&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;     \nint main()\n{\n    FILE *passwords;\n    int p='*',i,j,count,triesLeft,a,numberofTries=0;\n    char password[5] = {0,0,0,0,0};\n    char passwordCheck[5] = {0,0,0,0,0};\n    passwords = fopen(\"passwords.txt\",\"r\"); \n    printf(\"You have 3 tries to enter your password!\\n\");\n    for(count=0;count&lt;3;count++) \n        {\n            numberofTries++;\n            triesLeft = 3 - count;\n            printf(\"You have %d tries left!\\n\", triesLeft);\n            printf(\"Enter your password: \");\n            scanf(\"%s\", &amp;passwordCheck);\n            fscanf(passwords,\"%s\",&amp;password);\n            if(strcmp(password, passwordCheck) == 0)\n                {\n                    numberofTries--;\n                    printf(\"Press 0 if you want to set up a new password, press 1 to stop the program\\n\");\n                    scanf(\"%d\", &amp;a);\n                    if(a==0)\n                        {\n                            passwords = fopen(\"passwords.txt\",\"w\");\n                            printf(\"New password:\");\n                            for(i=0;i&lt;5;i++)\n                                {\n                                    password[i] = getch();\n                                    putchar(p); \n                                }\n                            for(j=0;j&lt;5;j++)\n                                {\n                                    fprintf(passwords,\"%c\",password[j]); \n                                }\n                        }\n                    else if(a==1)\n                        {\n                            printf(\"Old password still in place\");\n                        }\n                    break;\n                }\n            else\n                {\n                    printf(\"Wrong password!\");  \n                }\n        }\n    if(numberofTries == 3)\n        {\n            printf(\"You are out tries!\");\n        }\n    fclose(passwords); \n}\n</code></pre>\n"}, {"tags": ["c", "file", "unix", "io"], "answers": [{"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 2, "last_activity_date": 1547058029, "creation_date": 1547058029, "answer_id": 54116145, "question_id": 54116077, "link": "https://stackoverflow.com/questions/54116077/can-i-write-to-two-different-file-pointers-at-once/54116145#54116145", "title": "Can I write to two different FILE pointers at once?", "body": "<p>A <code>FILE</code> object is associated with one file only, so you can't write to one <code>FILE</code> and have it write to two physical files.</p>\n\n<p>What you can do however is create a wrapper around <code>fprintf</code> that takes two <code>FILE *</code> and do the duplication there.</p>\n\n<pre><code>void dup_fprintf(FILE *f1, FILE *f2, const char *format, ...)\n{\n    va_list args1;\n    va_start(args1, format);\n    vfprintf(f1, format, args1);\n    va_end(args1);\n\n    va_list args2;\n    va_start(args2, format);\n    vfprintf(f2, format, args2);\n    va_end(args2);\n}\n</code></pre>\n\n<p>Then you can do this:</p>\n\n<pre><code>dup_fprintf(stdout, cache, \"My data\\n\");\nfor (int i = 0; i &lt; 10; ++i)\n{\n    dup_fprintf(stdtout, cache, \"%d \", i);\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2201041"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 24, "favorite_count": 0, "closed_date": 1547058063, "answer_count": 1, "score": 0, "last_activity_date": 1547058029, "creation_date": 1547057639, "question_id": 54116077, "link": "https://stackoverflow.com/questions/54116077/can-i-write-to-two-different-file-pointers-at-once", "closed_reason": "Duplicate", "title": "Can I write to two different FILE pointers at once?", "body": "<p>I have a program where I want to duplicate some of the output to stdout in a text file for caching. It looks something like this:</p>\n\n<pre><code>FILE* cache;\n// Open file, check for errors, etc.\nfprintf(stdout, \"My data\\n\");\nfprintf(cache, \"My data\\n\");\nfor (int i = 0; i &lt; 10; ++i)\n{\n    fprintf(stdtout, \"%d \", i);\n    fprintf(cache, \"%d \", i);\n}\n</code></pre>\n\n<p>Is there some way to get a <code>FILE *</code> where if I write to it, I get output in both <code>stdout</code> and my cache file?</p>\n\n<p>(It doesn't work to just redirect it in the shell; the program needs to decide this, not the caller.)</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 3, "creation_date": 1547057620, "post_id": 54116058, "comment_id": 95064844, "body": "They are bitwise operations. But you should initialize <code>a</code> and <code>b</code>"}, {"owner": {"reputation": 527, "user_id": 10488746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vTDhZ.jpg?s=128&g=1", "display_name": "H.cohen", "link": "https://stackoverflow.com/users/10488746/h-cohen"}, "edited": false, "score": 1, "creation_date": 1547057731, "post_id": 54116058, "comment_id": 95064892, "body": "what you have now are junk values . those values are manipulated in your main"}, {"owner": {"reputation": 9, "user_id": 10891410, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IINao9sPpSo/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcabRaNxoTdWcMQOSTW-m-CnJemszg/mo/photo.jpg?sz=128", "display_name": "fallenswor f", "link": "https://stackoverflow.com/users/10891410/fallenswor-f"}, "edited": false, "score": 0, "creation_date": 1547057739, "post_id": 54116058, "comment_id": 95064896, "body": "Yes i know but i tried to not initialize the values and the result for OR it&#39;s 62 and for AND it&#39;s 6"}, {"owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "edited": false, "score": 2, "creation_date": 1547058191, "post_id": 54116058, "comment_id": 95065102, "body": "@fallensworf: If you don&#39;t initialize <code>a</code> or <code>b</code>, then they will contain some random garbage, thus the results of <code>a|b</code> and <code>a%b</code> (which is a modulus operation, not a bitwise AND operation) will also be random garbage."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user10415043"}, "edited": false, "score": 0, "creation_date": 1547068266, "post_id": 54116090, "comment_id": 95069332, "body": "Is an uninitialized variable is as good as assigning it to null i.e. <code>int a = null</code> ?"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 1, "creation_date": 1547098980, "post_id": 54116090, "comment_id": 95076875, "body": "Sorry, your question makes no sense. <code>null</code> has no meaning in C, and <code>NULL</code> is a pointer, not an <code>int</code>; so you won&#39;t initialize an  <code>int</code> variable from a pointer."}], "tags": [], "owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "is_accepted": false, "score": 3, "last_activity_date": 1547101896, "last_edit_date": 1547101896, "creation_date": 1547057722, "answer_id": 54116090, "question_id": 54116058, "link": "https://stackoverflow.com/questions/54116058/how-does-and-works-in-this-example-of-c/54116090#54116090", "title": "How does &amp; and | works in this example of C?", "body": "<p>An uninitialized variable contains garbage value, and using it may become <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behavior</a>. Be <a href=\"https://stackoverflow.com/a/46526702/841108\">scared</a>.</p>\n\n<p>The memory location or register holding these variables have some content (which cannot be predicted in general), even before the bitwise operation. Consider that content as at least random (or \"buggy\").</p>\n\n<p>BTW, you should enable all warnings and debug info when compiling. With <a href=\"https://gcc.gnu.org/\" rel=\"nofollow noreferrer\">GCC</a>, use <code>gcc -Wall -Wextra -g</code>. Your source code would probably trigger some warning. I recommend to <em>always</em> initialize your <a href=\"https://en.wikipedia.org/wiki/Automatic_variable\" rel=\"nofollow noreferrer\">automatic variables</a> (perhaps the <a href=\"https://en.wikipedia.org/wiki/Optimizing_compiler\" rel=\"nofollow noreferrer\">optimizing compiler</a> would figure out that the initialization is useless, then it skips it, per the <a href=\"https://en.wikipedia.org/wiki/As-if_rule\" rel=\"nofollow noreferrer\">as-if rule</a>; but you are sure that the variable has some well known value).</p>\n\n<p>Imagine that you compile and run the same program on some very different computer (with another operating system, another compiler, another processor). You are very likely to observe different program behavior.</p>\n"}, {"tags": [], "owner": {"reputation": 885, "user_id": 1169785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cb88c0410d5380a5b590a2e993b053a?s=128&d=identicon&r=PG", "display_name": "G. Allen Morris III", "link": "https://stackoverflow.com/users/1169785/g-allen-morris-iii"}, "is_accepted": false, "score": 1, "last_activity_date": 1547070082, "last_edit_date": 1547070082, "creation_date": 1547068020, "answer_id": 54118371, "question_id": 54116058, "link": "https://stackoverflow.com/questions/54116058/how-does-and-works-in-this-example-of-c/54118371#54118371", "title": "How does &amp; and | works in this example of C?", "body": "<p>Without knowing what complier you are using it is difficult to know what the result will be, but most likely it will either be 0 or some</p>\n\n<p>One of the beautiful things about C is that you can generate assembly language that is (some what) human readable, and using that you can see what your C code will do.</p>\n\n<p>I used an ARM compiler as ARM CPU is a Reduced Instruction Set Computer (RISC) and it's assembly code is a bit easier to read.</p>\n\n<p>To compile you code I ran the instruction</p>\n\n<pre><code>arm-linux-gnueabi-gcc-7 -S -O0 -fverbose-asm  main.c\n</code></pre>\n\n<p>which generated a <code>main.s</code> file.  The <code>-S</code> causes the assembly code to be generated.  The <code>-fverbose-asm</code> add the sorce code as comments in assmenly code.\nAnd the <code>-O0</code> keeps that complier from optimizing the code into something harder to read.</p>\n\n<p>Your OR code generates:</p>\n\n<pre><code>@ main.c:7:  c = a | b;\n        ldr     r2, [fp, #-8]   @ tmp115, a\n        ldr     r3, [fp, #-12]  @ tmp116, b\n        orr     r3, r2, r3      @ tmp114, tmp115, tmp116\n        str     r3, [fp, #-16]  @ tmp114, c\n@ main.c:8:  printf(\"OR: %d\\n\",c);\n        ldr     r1, [fp, #-16]  @, c\n        ldr     r3, .L3+4       @ tmp117,\n.LPIC1:\n        add     r3, pc, r3      @ tmp117, tmp117\n        mov     r0, r3  @, tmp117\n        bl      printf(PLT)     @\n</code></pre>\n\n<p>Your AND code (corrected by replacing <code>%</code> with <code>&amp;</code>) generates:</p>\n\n<pre><code>@ main.c:9:  d = a &amp; b;\n        ldr     r2, [fp, #-8]   @ tmp119, a\n        ldr     r3, [fp, #-12]  @ tmp120, b\n        and     r3, r3, r2      @ tmp118, tmp120, tmp119\n        str     r3, [fp, #-20]  @ tmp118, d\n@ main.c:10:  printf(\"AND: %d\\n\",d);\n        ldr     r1, [fp, #-20]  @, d\n        ldr     r3, .L3+8       @ tmp121,\n.LPIC2:\n        add     r3, pc, r3      @ tmp121, tmp121\n        mov     r0, r3  @, tmp121\n        bl      printf(PLT)     @\n</code></pre>\n\n<p>To get to your question, not initializing the integers <code>a</code> and <code>b</code> does not change the code.\nThe assembly code generated will used what ever is located in the memory that is pointed to by the <a href=\"http://hhttps://en.wikipedia.org/wiki/Call_stack#Structure]\" rel=\"nofollow noreferrer\">frame pointer</a> (<code>fp</code>) minus 8 bytes and the <code>fp</code> minus 12 bytes.\nIf the integers <code>a</code> and <code>b</code> are not set to a particular value then, depending to the compiler, you will get a random value or with some compilers you might always get zero value.</p>\n\n<p>NOTE: It is likely that your C compiler can generate assembly code.  The output will most likely be in i386 or X86 assembly code, but you should be able to use it to see how changing your code changes the code that gets generated by your compiler.</p>\n\n<p>Here is an example program that shows (at least with <code>gcc</code>) how not setting a default value can lead to side effects.  Here the values passed to one subroutine effect another one.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint first(int x, int y)\n{\n    int a, b, c, d;\n\n    a = x;\n    b = y;\n}\n\nint second()\n{\n    int a,b,c,d;\n    c = a | b;\n    printf(\"OR: %d\\n\",c);\n    d = a &amp; b;\n    printf(\"AND: %d\\n\",d);\n}\n\nint main()\n{\n    first(5, 3);\n    second();\n    first(7, 5);\n    second();\n    return 0;\n}\n</code></pre>\n\n<p>The output being</p>\n\n<pre><code>OR: 7\nAND: 1\n</code></pre>\n\n<p>for 5 and 3 and</p>\n\n<pre><code>OR: 7\nAND: 5\n</code></pre>\n\n<p>for 7 and 5.</p>\n"}], "owner": {"reputation": 9, "user_id": 10891410, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IINao9sPpSo/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcabRaNxoTdWcMQOSTW-m-CnJemszg/mo/photo.jpg?sz=128", "display_name": "fallenswor f", "link": "https://stackoverflow.com/users/10891410/fallenswor-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1547101896, "creation_date": 1547057532, "last_edit_date": 1547081540, "question_id": 54116058, "link": "https://stackoverflow.com/questions/54116058/how-does-and-works-in-this-example-of-c", "title": "How does &amp; and | works in this example of C?", "body": "<p>I'm trying this example and I don't understand how these values appear. How it's done the bitwise operation if the values are not initialized?</p>\n\n<pre><code>int main() {\n  int a, b, c, d;\n  d = a % b;\n  c = a | b;\n  printf(\"OR: %d\", c);\n  printf(\"AND: %d\", d);\n  return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "assembly", "bcc-compiler"], "comments": [{"owner": {"reputation": 32321, "user_id": 173397, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pqKT8.jpg?s=128&g=1", "display_name": "pm100", "link": "https://stackoverflow.com/users/173397/pm100"}, "edited": false, "score": 1, "creation_date": 1547057406, "post_id": 54115974, "comment_id": 95064748, "body": "i think you are going to have to show some code"}, {"owner": {"reputation": 155, "user_id": 7196604, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3843a75b29c516c119b52d481edfe9bd?s=128&d=identicon&r=PG&f=1", "display_name": "Oppa", "link": "https://stackoverflow.com/users/7196604/oppa"}, "reply_to_user": {"reputation": 32321, "user_id": 173397, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pqKT8.jpg?s=128&g=1", "display_name": "pm100", "link": "https://stackoverflow.com/users/173397/pm100"}, "edited": false, "score": 0, "creation_date": 1547059288, "post_id": 54115974, "comment_id": 95065582, "body": "I added my code"}, {"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1547059690, "post_id": 54115974, "comment_id": 95065742, "body": "What command line do you use to compile the <i>C</i> code with bcc?"}, {"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1547059818, "post_id": 54115974, "comment_id": 95065792, "body": "The concern I do have though is that as far as I remember, many of the functions in BCC&#39;s libc use DOS interrupts (int21h) to do input and output. When running as a bootloader DOS hasn&#39;t been loaded yet and int 21h won&#39;t be available."}, {"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1547059969, "post_id": 54115974, "comment_id": 95065854, "body": "Oh, looking at your code - I guess you are trying to ovr ride some of the fundamental low level input/output routines using the BIOS."}, {"owner": {"reputation": 155, "user_id": 7196604, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3843a75b29c516c119b52d481edfe9bd?s=128&d=identicon&r=PG&f=1", "display_name": "Oppa", "link": "https://stackoverflow.com/users/7196604/oppa"}, "edited": false, "score": 0, "creation_date": 1547061072, "post_id": 54115974, "comment_id": 95066321, "body": "Michael, yes. I am overriding things using the bios. And will be using dd to replace the first segment on an OS image with my own. Just cant get that far due to ld86 not compiling correctly."}], "answers": [{"tags": [], "owner": {"reputation": 155, "user_id": 7196604, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3843a75b29c516c119b52d481edfe9bd?s=128&d=identicon&r=PG&f=1", "display_name": "Oppa", "link": "https://stackoverflow.com/users/7196604/oppa"}, "is_accepted": true, "score": 0, "last_activity_date": 1547062702, "creation_date": 1547062702, "answer_id": 54117166, "question_id": 54115974, "link": "https://stackoverflow.com/questions/54115974/issue-compiling-ld86-undefined-symbol-auto-start/54117166#54117166", "title": "Issue compiling ld86: Undefined symbol auto_start", "body": "<p>After much trouble shooting: I found that I needed to remove the include statements at the top of the C file, as well as remove the arguments within the main function. so, the linked page was partially correct. </p>\n"}], "owner": {"reputation": 155, "user_id": 7196604, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3843a75b29c516c119b52d481edfe9bd?s=128&d=identicon&r=PG&f=1", "display_name": "Oppa", "link": "https://stackoverflow.com/users/7196604/oppa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 376, "favorite_count": 0, "accepted_answer_id": 54117166, "answer_count": 1, "score": 0, "last_activity_date": 1547062702, "creation_date": 1547057125, "last_edit_date": 1547061362, "question_id": 54115974, "link": "https://stackoverflow.com/questions/54115974/issue-compiling-ld86-undefined-symbol-auto-start", "title": "Issue compiling ld86: Undefined symbol auto_start", "body": "<p>Im attempting to compile some assembly and C code using ld86. When doing so, I run into a problem: \"Undefined symbol: auto_start\"</p>\n\n<p>I have already searched this, and came across <a href=\"https://stackoverflow.com/questions/9678340/auto-start-error-in-ld86-compiling\">this</a> stack overflow question, which is exactly like mine. But, their solution of removing the arguments from the main function did not work for me. I am looking for some more potential options.</p>\n\n<pre><code>ld86 -d bs.o t.o /usr/lib/bcc/libc.a\nld86: warning: _gets redefined in file \n/usr/lib/bcc/libc_s.a(gets.o); using definition in t.o\nundefined symbol: auto_start\n</code></pre>\n\n<p>My code for t.c:</p>\n\n<pre><code>1 #include &lt;string.h&gt;\n2 #include &lt;stdio.h&gt;\n3 int prints(char *s)\n4 {\n5   int i;\n6   for(i = 0; i&lt;strlen(s); i++)\n7   {\n8     putchar(s[i]);\n9   }\n10   return 0;\n11 }\n12 \n13 int gets(char name[])\n14 {\n15   int i = 0;\n16   char c = 0;\n17   while(c != '\\n')\n18   {\n19     c = getc(stdin);\n20     name[i] = c;\n21     i++;\n22   }\n23   name[i-1] = 0;\n24   return 0;\n25 }\n26 \n27 int main()\n28 {\n29   char name[64];\n30   prints(\"Welcome to my Booter!\\n\");\n31   while(1)\n32   {\n33     memset(name,0,64);\n34     prints(\"What is your name?\\n\");\n35     gets(name);\n36     if(name[0] == 0)\n37     {\n38       break;\n39     }\n40     prints(\"Welcome \"); prints(name); prints(\"\\n\\r\");\n41   }\n42   prints(\"Return to assembly and hang\\n\\r\");\n</code></pre>\n\n<p>And for bs.s:</p>\n\n<pre><code>BOOTSEG =  0x9000        ! Boot block is loaded again to here.\n    SSP      =   8192        ! Stack pointer at SS+8KB\n\n    .globl _main,_prints              ! IMPORT symbols\n    .globl _getc,_putc                ! EXPORT symbols\n\n.globl _readfd,_setes,_inces,_error  \n\n    !-------------------------------------------------------\n    ! Only one SECTOR loaded at (0000,7C00). Get entire BLOCK in\n    !-------------------------------------------------------\n    mov  ax,#BOOTSEG    ! set ES to 0x9000\n    mov  es,ax\n    xor  bx,bx          ! clear BX = 0\n\n    !---------------------------------------------------\n    !  read boot BLOCK to [0x9000,0]     \n    !---------------------------------------------------\n    xor  dx,dx          ! drive 0, head 0\n    xor  cx,cx          ! cyl 0    sector 0\n    incb cl             ! cyl 0, sector 1\n    mov  ax, #0x0202    ! READ 1 block\n    int  0x13\n\n    jmpi    start,BOOTSEG           ! CS=BOOTSEG, IP=start\n\nstart:                    \n    mov     ax,cs                   ! Set segment registers for CPU\n    mov     ds,ax                   ! we know ES,CS=0x9000. Let DS=CS  \n    mov     ss,ax                   ! SS = CS ===&gt; all point at 0x9000\n    mov     es,ax\n    mov     sp,#SSP                 ! SP = 8KB above SS=0x9000\n\n    mov     ax,#0x0012              ! 640x480 color     \nint     0x10 \n\n    call _main                      ! call main() in C\n\n    test ax, ax\nje  _error \n\n    jmpi 0,0x1000\n\n\n    !---------------------------------------------\n    !  char getc()   function: returns a char\n    !---------------------------------------------\n_getc:\n    xorb   ah,ah           ! clear ah\n    int    0x16            ! call BIOS to get a char in AX\n    ret \n\n    !----------------------------------------------\n    ! void putc(char c)  function: print a char\n    !----------------------------------------------\n_putc:           \n    push   bp\n    mov    bp,sp\n\n    movb   al,4[bp]        ! get the char into aL\n    movb   ah,#14          ! aH = 14\n    movb   bl,#0x0D        ! bL = cyan color \n    int    0x10            ! call BIOS to display the char\n\n    pop    bp\n    ret\n\n\n\n\n   !---------------------------------------\n   ! readfd(cyl, head, sector, buf)\n   !         4     6     8     10\n   !---------------------------------------\n_readfd:                             \n    push  bp\n    mov   bp,sp            ! bp = stack frame pointer\n\n    movb  dl, #0x00        ! drive 0=FD0\n    movb  dh, 6[bp]        ! head\n    movb  cl, 8[bp]        ! sector\n    incb  cl               ! BIOS count sector from 1\n    movb  ch, 4[bp]        ! cyl\n    mov   bx, 10[bp]       ! BX=buf ==&gt; memory addr=(ES,BX)\n    mov   ax, #0x0202      ! READ 2 sectors to (EX, BX)\n\n    int  0x13              ! call BIOS to read the block \n    jb   _error            ! to error if CarryBit is on [read failed]\n\n    pop  bp                \n    ret\n\n\n_setes:  push  bp\n     mov   bp,sp\n\n     mov   ax,4[bp]        \n     mov   es,ax\n\n     pop   bp\n     ret\n\n_inces:                         ! inces() inc ES by 0x40, or 1K\n     mov   ax,es\n     add   ax,#0x40\n     mov   es,ax\n     ret\n\n    !------------------------------\n    !       error &amp; reboot\n    !------------------------------\n_error:\n    mov  bx, #bad\n    push bx\n    call _prints\n\n    int  0x19                       ! reboot\n</code></pre>\n"}, {"tags": ["c++", "c"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 11, "creation_date": 1547055429, "post_id": 54115562, "comment_id": 95063901, "body": "C and C++ are different languages.  Don&#39;t expect what works in one to work in the other"}], "answers": [{"tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": true, "score": 1, "last_activity_date": 1547056083, "last_edit_date": 1592644375, "creation_date": 1547055841, "answer_id": 54115681, "question_id": 54115562, "link": "https://stackoverflow.com/questions/54115562/gcc-g-different-attitudes-for-void-to-int/54115681#54115681", "title": "GCC/G++ different attitudes for: void* to int", "body": "<blockquote>\n<pre><code>int k = (int *)arg;\n</code></pre>\n<p>this statement  can not compaile  with G++,But GCC only Warning,why?</p>\n</blockquote>\n<p>It doesn't compile in C++ because <code>int*</code> is not implicitly convertible to <code>int</code> and therefore the statement is ill-formed.</p>\n<blockquote>\n<pre><code>// int k=*(int *)arg;\n</code></pre>\n<p>why this statement not right?</p>\n</blockquote>\n<p>That statement is syntactically well-formed in C++. But <code>arg</code> doesn't point to an <code>int</code> object (or object of compatible type), so the behaviour of indirecting through the pointer is undefined.</p>\n"}], "owner": {"reputation": 25, "user_id": 7090534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rUZsA.jpg?s=128&g=1", "display_name": "takethat", "link": "https://stackoverflow.com/users/7090534/takethat"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "closed_date": 1547056154, "accepted_answer_id": 54115681, "answer_count": 1, "score": -3, "last_activity_date": 1547056083, "creation_date": 1547055320, "last_edit_date": 1547055458, "question_id": 54115562, "link": "https://stackoverflow.com/questions/54115562/gcc-g-different-attitudes-for-void-to-int", "closed_reason": "Needs details or clarity", "title": "GCC/G++ different attitudes for: void* to int", "body": "<pre><code>#include&lt;stdio.h&gt;\nvoid test(void *arg)\n{\n    if (arg != NULL)\n    {\n        int temp = (int *)arg;\n        printf(\"[temp]%d\\n\", temp);\n    }\n}\n\nint main()\n{\n    int a = 3;\n    int *b = &amp;a;\n    int t = b;\n    test((void *)11);\n    void * arg = (void *)22;\n    int k = (int *)arg;//this statement  can not compaile  with G++,But GCC only Warning,why?\uff08evernt use cpp rewrite it again\uff09\n    // int k=*(int *)arg;// why this statement not right?\n    printf(\"[k]%d\\n\", k);\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "linux-kernel", "kernel"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1547055210, "post_id": 54115372, "comment_id": 95063798, "body": "To be clear: yours is a 32-bit process running on a 32-bit kernel, yes?  Because the 3GB limit does not apply to 64-bit processes."}, {"owner": {"reputation": 1, "user_id": 3172612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc7cd3f5298842153042cb9a48c508ff?s=128&d=identicon&r=PG&f=1", "display_name": "user3172612", "link": "https://stackoverflow.com/users/3172612/user3172612"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1547126622, "post_id": 54115372, "comment_id": 95090401, "body": "Ok. I got it. I am running 32 application on 64 bit kernel.  Thanks for your update"}, {"owner": {"reputation": 38430, "user_id": 429063, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fd38783123814dee889d28c991e56fb?s=128&d=identicon&r=PG", "display_name": "Chris Stratton", "link": "https://stackoverflow.com/users/429063/chris-stratton"}, "edited": false, "score": 0, "creation_date": 1547319088, "post_id": 54115372, "comment_id": 95155517, "body": "One of you please post that as an answer so that this can be marked as resolved.  Also, please don&#39;t abuse the embedded tag, this issue had nothing to do with embedded systems."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 3172612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc7cd3f5298842153042cb9a48c508ff?s=128&d=identicon&r=PG&f=1", "display_name": "user3172612", "link": "https://stackoverflow.com/users/3172612/user3172612"}, "is_accepted": true, "score": 0, "last_activity_date": 1547383926, "creation_date": 1547383926, "answer_id": 54169056, "question_id": 54115372, "link": "https://stackoverflow.com/questions/54115372/why-it-is-showing-frame-pointer-in-out-of-3gb-address-space/54169056#54169056", "title": "Why it is showing frame pointer in out of 3GB address space?", "body": "<p>3GB limit does not apply to 64-bit processes</p>\n"}], "owner": {"reputation": 1, "user_id": 3172612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc7cd3f5298842153042cb9a48c508ff?s=128&d=identicon&r=PG&f=1", "display_name": "user3172612", "link": "https://stackoverflow.com/users/3172612/user3172612"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 54169056, "answer_count": 1, "score": 0, "last_activity_date": 1547383926, "creation_date": 1547054576, "last_edit_date": 1547319050, "question_id": 54115372, "link": "https://stackoverflow.com/questions/54115372/why-it-is-showing-frame-pointer-in-out-of-3gb-address-space", "title": "Why it is showing frame pointer in out of 3GB address space?", "body": "<p>I get the frame at <code>0xffffd3d0</code> and saveed <code>eip = 0xf7e04e7e</code> in stack level 0 while doing gdb debug. </p>\n\n<pre><code>(gdb) info frame\nStack level 0, frame at 0xffffd3d0:\n eip = 0x8048452 in main (test.c:13); saved eip = 0xf7e04e7e\n source language c.\n Arglist at 0xffffd3b8, args:\n Locals at 0xffffd3b8, Previous frame's sp is 0xffffd3d0\n Saved registers:\n  ebp at 0xffffd3b8, eip at 0xffffd3cc\n(gdb)\n</code></pre>\n\n<p>Here is my question about 3GB address space of userspace. Why it is showing frame pointer in out of 3GB address space ?\nNormally, the address space of the user space is 0 to <code>0xc000000</code> in a 3: 1 virtual address distribution.</p>\n"}, {"tags": ["c", "linux", "emacs"], "comments": [{"owner": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 0, "creation_date": 1547054792, "post_id": 54115359, "comment_id": 95063588, "body": "Have you thought to try setting the environment variable TERM?"}, {"owner": {"reputation": 21, "user_id": 10724691, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hMwDff9UlWY/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gQwzgzohZEvEPctqdCS3ektyx5Gw/mo/photo.jpg?sz=128", "display_name": "haxor12", "link": "https://stackoverflow.com/users/10724691/haxor12"}, "reply_to_user": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 0, "creation_date": 1547054891, "post_id": 54115359, "comment_id": 95063641, "body": "yes i did but nothing changed ;("}, {"owner": {"reputation": 3612, "user_id": 1813336, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1zONI.jpg?s=128&g=1", "display_name": "cleblanc", "link": "https://stackoverflow.com/users/1813336/cleblanc"}, "edited": false, "score": 0, "creation_date": 1547055187, "post_id": 54115359, "comment_id": 95063785, "body": "try <code>emacs -nw</code> to run emacs in your shell?"}, {"owner": {"reputation": 21, "user_id": 10724691, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hMwDff9UlWY/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gQwzgzohZEvEPctqdCS3ektyx5Gw/mo/photo.jpg?sz=128", "display_name": "haxor12", "link": "https://stackoverflow.com/users/10724691/haxor12"}, "edited": false, "score": 0, "creation_date": 1547055330, "post_id": 54115359, "comment_id": 95063855, "body": "$&gt;\u30d5\u30a1\u30c3\u30af\u30e6\u30fcemacs -nw Please set the environment variable TERM; see `tset&#39;."}, {"owner": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 0, "creation_date": 1547055663, "post_id": 54115359, "comment_id": 95064023, "body": "It&#39;s probably how your code runs commands that is the problem - see if you can produce a simple <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that demonstrates the problem and that might lead to an answer"}, {"owner": {"reputation": 3612, "user_id": 1813336, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1zONI.jpg?s=128&g=1", "display_name": "cleblanc", "link": "https://stackoverflow.com/users/1813336/cleblanc"}, "edited": false, "score": 0, "creation_date": 1547055891, "post_id": 54115359, "comment_id": 95064120, "body": "It has something to do with the fact that your shell isn&#39;t connected to the X server.  Check out this answer <a href=\"https://stackoverflow.com/questions/27083182/running-emacs-in-a-docker-container\">here</a>"}, {"owner": {"reputation": 137100, "user_id": 874188, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ZcY77.png?s=128&g=1", "display_name": "tripleee", "link": "https://stackoverflow.com/users/874188/tripleee"}, "edited": false, "score": 0, "creation_date": 1547095380, "post_id": 54115359, "comment_id": 95075987, "body": "It says to &quot;see <code>tset</code>&quot;; did you try that?"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 10724691, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hMwDff9UlWY/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gQwzgzohZEvEPctqdCS3ektyx5Gw/mo/photo.jpg?sz=128", "display_name": "haxor12", "link": "https://stackoverflow.com/users/10724691/haxor12"}, "edited": false, "score": 0, "creation_date": 1547128324, "post_id": 54121708, "comment_id": 95091398, "body": "i didn&#39;t creat a export function for my shell"}, {"owner": {"reputation": 65926, "user_id": 324105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b1ad4e4bdf8feaef18504593914fe16?s=128&d=identicon&r=PG", "display_name": "phils", "link": "https://stackoverflow.com/users/324105/phils"}, "reply_to_user": {"reputation": 21, "user_id": 10724691, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hMwDff9UlWY/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gQwzgzohZEvEPctqdCS3ektyx5Gw/mo/photo.jpg?sz=128", "display_name": "haxor12", "link": "https://stackoverflow.com/users/10724691/haxor12"}, "edited": false, "score": 0, "creation_date": 1547174337, "post_id": 54121708, "comment_id": 95110781, "body": "Well that rather sounds like your issue then.  You could perhaps work around that by running the command <code>env TERM=xterm emacs -nw</code>"}, {"owner": {"reputation": 28248, "user_id": 2415684, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e0fb12778bde5d0dddddd3b8b619681b?s=128&d=identicon&r=PG", "display_name": "Rorschach", "link": "https://stackoverflow.com/users/2415684/rorschach"}, "edited": false, "score": 0, "creation_date": 1547238716, "post_id": 54121708, "comment_id": 95138286, "body": "or just export the variable in the shell you start your shell from"}], "tags": [], "owner": {"reputation": 65926, "user_id": 324105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b1ad4e4bdf8feaef18504593914fe16?s=128&d=identicon&r=PG", "display_name": "phils", "link": "https://stackoverflow.com/users/324105/phils"}, "is_accepted": false, "score": 1, "last_activity_date": 1547092127, "creation_date": 1547092127, "answer_id": 54121708, "question_id": 54115359, "link": "https://stackoverflow.com/questions/54115359/emacs-when-implementing-a-linux-shell/54121708#54121708", "title": "emacs when implementing a linux shell", "body": "<p>I can reproduce your issue by unsetting <code>TERM</code> in my shell, and can confirm that <code>vim</code> does indeed run without a <code>TERM</code>.</p>\n\n<p>It very much sounds as if you have not <em>exported</em> your <code>TERM</code> environment variable, such that inferior commands will see it.</p>\n\n<p>e.g. in bash:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ unset TERM\n$ emacs -nw\nPlease set the environment variable TERM; see 'tset'.\n$ TERM=xterm\n$ emacs -nw\nPlease set the environment variable TERM; see 'tset'.\n$ export TERM\n$ emacs -nw\n(works)\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 10724691, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hMwDff9UlWY/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gQwzgzohZEvEPctqdCS3ektyx5Gw/mo/photo.jpg?sz=128", "display_name": "haxor12", "link": "https://stackoverflow.com/users/10724691/haxor12"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1547092127, "creation_date": 1547054539, "last_edit_date": 1547054850, "question_id": 54115359, "link": "https://stackoverflow.com/questions/54115359/emacs-when-implementing-a-linux-shell", "title": "emacs when implementing a linux shell", "body": "<p>i'm working on a school project that is a  mini linux shell implementation \nI've finished all the things that they asked me to do<br>\nbut when i write in my shell the command \"emacs\"\nMy shell return a error message \"Please set the environment variable TERM; see `tset'.\"\nknowing that vim and all other executables are working.\nand all that's all the environment variables in my linux shell : </p>\n\n<pre><code>SSH_AUTH_SOCK=/private/tmp/com.apple.launchd.Xy6gRH9Mm5/Listeners\nApple_PubSub_Socket_Render=/private/tmp/com.apple.launchd.w6n2eFUJIt/Render\nCOLORFGBG=7;0\nITERM_PROFILE=Default\nXPC_FLAGS=0x0\nLANG=en_US.UTF-8\nPWD=/Users/helmanso/Desktop/w\nSHELL=/bin/zsh\nSECURITYSESSIONID=186bd\nTERM_PROGRAM_VERSION=3.2.5\nTERM_PROGRAM=iTerm.app\nPATH=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/Library/Frameworks/Mono.framework/Versions/Current/Commands:/usr/local/munki\nCOLORTERM=truecolor\nCOMMAND_MODE=unix2003\nTERM=xterm\nHOME=/Users/helmanso\nTMPDIR=/var/folders/zz/zyxvpxvq6csfxvn_n0000490000128/T/\nUSER=helmanso\nXPC_SERVICE_NAME=0\nLOGNAME=helmanso\n__CF_USER_TEXT_ENCODING=0x448:0:0\nITERM_SESSION_ID=w0t0p0:6CFA1D4A-182E-4981-B8D2-C8AAAD0FBADF\nSHLVL=1\nOLDPWD=/Users/helmanso/Desktop/w\n_=/Users/helmanso/Desktop/w/./a.out\n</code></pre>\n"}, {"tags": ["c", "misra"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1547052960, "post_id": 54114895, "comment_id": 95062554, "body": "Well, the comment is explaining it and it looks like the standard is simply makes no exceptions. I highly dislike MISRA for it being too strict up to a point making a completely different language out of C."}, {"owner": {"reputation": 5867, "user_id": 2252087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/020cbe41b02f03d59f3adae022c0ce7d?s=128&d=identicon&r=PG", "display_name": "ensc", "link": "https://stackoverflow.com/users/2252087/ensc"}, "edited": false, "score": 1, "creation_date": 1547053626, "post_id": 54114895, "comment_id": 95062962, "body": "MISRA is from the K&amp;R age where compilers where stupid and did not provide much diagnostics.  It contains a lot of rules which do not make much sense nowadays and which will make the program unsafe.  E.g. MISRA requires lot of explicit casts which disables type safety completely.  Your rule is a another example. ... Best thing in MISRA is that you can define exemptions."}, {"owner": {"reputation": 3126, "user_id": 2955790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vShcC.png?s=128&g=1", "display_name": "Duck Dodgers", "link": "https://stackoverflow.com/users/2955790/duck-dodgers"}, "reply_to_user": {"reputation": 5867, "user_id": 2252087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/020cbe41b02f03d59f3adae022c0ce7d?s=128&d=identicon&r=PG", "display_name": "ensc", "link": "https://stackoverflow.com/users/2252087/ensc"}, "edited": false, "score": 1, "creation_date": 1547054011, "post_id": 54114895, "comment_id": 95063181, "body": "@ensc, <i>&quot;MISRA is from the K&amp;R age&quot;</i> Hmm, really?"}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1547054112, "post_id": 54114895, "comment_id": 95063243, "body": "What I read is that the rule says that it is not allowed if you call a function that e.g. modifies a global variable (a &quot;persistent side efect&quot; of the function). The rule does not forbid the construction."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 5867, "user_id": 2252087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/020cbe41b02f03d59f3adae022c0ce7d?s=128&d=identicon&r=PG", "display_name": "ensc", "link": "https://stackoverflow.com/users/2252087/ensc"}, "edited": false, "score": 1, "creation_date": 1547054565, "post_id": 54114895, "comment_id": 95063470, "body": "@ensc, 2012 is hardly &quot;the K&amp;R age&quot;, and MISRA <i>started</i> in the early 90s, after the original C standard was published.  It could hardly have been written without the standard, as there was significant variation among pre-standard compilers on various relevant matters."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 5867, "user_id": 2252087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/020cbe41b02f03d59f3adae022c0ce7d?s=128&d=identicon&r=PG", "display_name": "ensc", "link": "https://stackoverflow.com/users/2252087/ensc"}, "edited": false, "score": 1, "creation_date": 1547054919, "post_id": 54114895, "comment_id": 95063656, "body": "@ensc the C standard does not require a compiler to be intelligent, only to compile correct code. There is no guarantee that a cross-compiler supplied with a MCU has the intelligence you might expect. I think the point of MISRA is that code is often destined for an operating environment where diagnostics are difficult and the code has to be 100% reliable and work as intended."}, {"owner": {"reputation": 5867, "user_id": 2252087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/020cbe41b02f03d59f3adae022c0ce7d?s=128&d=identicon&r=PG", "display_name": "ensc", "link": "https://stackoverflow.com/users/2252087/ensc"}, "reply_to_user": {"reputation": 3126, "user_id": 2955790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vShcC.png?s=128&g=1", "display_name": "Duck Dodgers", "link": "https://stackoverflow.com/users/2955790/duck-dodgers"}, "edited": false, "score": 0, "creation_date": 1547054999, "post_id": 54114895, "comment_id": 95063694, "body": "@JoeyMallone nearly... it is from 1996.  Ok; there was C89/90, but K&amp;R coding style and compilers still alive."}, {"owner": {"reputation": 5867, "user_id": 2252087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/020cbe41b02f03d59f3adae022c0ce7d?s=128&d=identicon&r=PG", "display_name": "ensc", "link": "https://stackoverflow.com/users/2252087/ensc"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1547055159, "post_id": 54114895, "comment_id": 95063768, "body": "@WeatherVane exactly; MISRA was from a time where compilers were shipped in 5.25&quot; discs and provided zero diagnostics.  Haiving rules to catch common programming errors was useful at this time.  But today, it makes more harm than use."}, {"owner": {"reputation": 518, "user_id": 4637938, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dtHFq.png?s=128&g=1", "display_name": "bd2357", "link": "https://stackoverflow.com/users/4637938/bd2357"}, "edited": false, "score": 2, "creation_date": 1547055387, "post_id": 54114895, "comment_id": 95063876, "body": "This specific example was from MISRA-2012, also I work primarially in Embedded and while I don&#39;t always agree with MISRA I like my development tools to be a pedantic as possible to keep me honest."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 5867, "user_id": 2252087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/020cbe41b02f03d59f3adae022c0ce7d?s=128&d=identicon&r=PG", "display_name": "ensc", "link": "https://stackoverflow.com/users/2252087/ensc"}, "edited": false, "score": 1, "creation_date": 1547055426, "post_id": 54114895, "comment_id": 95063899, "body": "@ensc please point me to the modern standard that obliges compilers to catch common programming errors, or obliges a certain warning level for code destinated for a sensitive application, and what those warning levels should include. Your casual approach seems to be &quot;heck, trust the compiler, I know what I am doing&quot; which is perhpas why MISRA was needed in the first place."}, {"owner": {"reputation": 1040, "user_id": 1614319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff0ff3e7d5ad91f5432ad168d4f4c9f5?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/1614319/andrew"}, "edited": false, "score": 0, "creation_date": 1609679620, "post_id": 54114895, "comment_id": 115892241, "body": "There is no reason not to DEVIATE the rule... this requires you to justify why the violation can be accepted.  MISRA Compliance explains the process."}], "answers": [{"comments": [{"owner": {"reputation": 518, "user_id": 4637938, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dtHFq.png?s=128&g=1", "display_name": "bd2357", "link": "https://stackoverflow.com/users/4637938/bd2357"}, "edited": false, "score": 0, "creation_date": 1547055110, "post_id": 54115245, "comment_id": 95063744, "body": "This is what I was thinking also, and I would also generally use the &quot;if&quot; statement.  It just struck me as an odd example.  The particular form is so common in things like BASH scripts and some other languagues."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 4, "last_activity_date": 1547054877, "last_edit_date": 1547054877, "creation_date": 1547054045, "answer_id": 54115245, "question_id": 54114895, "link": "https://stackoverflow.com/questions/54114895/misra-13-5-question-about-non-compilant-example/54115245#54115245", "title": "MISRA 13.5 question about non-compilant example", "body": "<blockquote>\n  <p>This construct seems perfectly safe in that the condition and the decision to call the function are directly tied, where the intent is to not dereference a NULL pointer. I understand an if statement would be clearer but would be interested if anyone has further insight.</p>\n</blockquote>\n\n<p>MISRA attempts to define rules that can be interpreted without having to guess the programmer's intent.  So yes, the construct you present is fine if it is intentional to avoid the function call in the event that the pointer is NULL, but a machine performing MISRA analysis of that code does not necessarily recognize that likelihood.  The rule is primarily aimed at conditional statements where the two operands of <code>&amp;&amp;</code> or <code>||</code> are not directly related.  Rejecting the case you describe is collateral damage.</p>\n\n<p>Of course, you can replace your case with</p>\n\n<pre><code>if (fp != NULL) {\n    (*fp)(0);\n}\n</code></pre>\n\n<p>.  Personally, I find the <code>if</code> statement clearer than the original expression statement.  That's not such a clear call when an expression such as your original one appears in the condition of an <code>if</code>, <code>while</code>, or <code>for</code> statement, but all of those can be restructured to comply with MISRA, too.</p>\n"}], "owner": {"reputation": 518, "user_id": 4637938, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dtHFq.png?s=128&g=1", "display_name": "bd2357", "link": "https://stackoverflow.com/users/4637938/bd2357"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1373, "favorite_count": 0, "accepted_answer_id": 54115245, "answer_count": 1, "score": 0, "last_activity_date": 1547054877, "creation_date": 1547052687, "last_edit_date": 1547054025, "question_id": 54114895, "link": "https://stackoverflow.com/questions/54114895/misra-13-5-question-about-non-compilant-example", "title": "MISRA 13.5 question about non-compilant example", "body": "<p>Trying to understand a non-compliant example of Rule 13.5.</p>\n\n<p>MISRA-2012 Rule 13.5 states \"The right hand operand of a logical &amp;&amp; or || operator shall not contain persistent side e\ufb00ects\"  With the rationale being \"... the side effects may or may not occure which may be contrary to programmer expectations.\"\nI understand and totally agree with this.  However their final example of non-compliant code is:</p>\n\n<pre><code>/* Non-compliant if fp points to a function with persistent side effects */ \n\n( fp != NULL ) &amp;&amp; ( *fp ) ( 0 );\n</code></pre>\n\n<p>This construct seems perfectly safe in that the condition and the decision to call the function are directly tied, where the intent is to not dereference a NULL pointer.  I understand an if statement would be clearer but would be interested if anyone has further insight.</p>\n"}, {"tags": ["c", "pointers", "malloc", "mpi"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547052325, "post_id": 54114696, "comment_id": 95062203, "body": "<code>world_rank == 0</code> is true or false? What do you think happens on <code>long **obs_sum;</code> and then you do <code>obs_sum[k]</code> without initializing <code>obs_sum</code> ?"}, {"owner": {"reputation": 611, "user_id": 5050926, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/CI6b8.jpg?s=128&g=1", "display_name": "styko", "link": "https://stackoverflow.com/users/5050926/styko"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547052675, "post_id": 54114696, "comment_id": 95062399, "body": "Do you know about MPI? The program is to be sent in multiple copies (processes) with world_rank = 0, 1, 2, ... <code>obs_sum</code> will be used <i>only</i> on process 0 (that&#39;s why <code>obs_sum[k]</code> does not need to be allocated). My question is: if <code>obs_sum</code> is completely useless on processes 1, 2, ... why does it have to exist at all?"}, {"owner": {"reputation": 611, "user_id": 5050926, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/CI6b8.jpg?s=128&g=1", "display_name": "styko", "link": "https://stackoverflow.com/users/5050926/styko"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547053073, "post_id": 54114696, "comment_id": 95062634, "body": "That said, you should be right, writing <code>obs_sum[k]</code> may imply that it is allocated even if completely useless."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547053310, "post_id": 54114696, "comment_id": 95062783, "body": "The <code>obs_sum[k]</code>  is equal to <code>*(obs_sum + k)</code> and only <i>writing</i> it is enough for the * operator to execute on an invalid pointer value (as <code>obs_sum</code> is not initialized), which is enough for undefined behavior and seg fault. So <code>world_rank</code> is <code>!= 0</code>, right?"}], "answers": [{"comments": [{"owner": {"reputation": 611, "user_id": 5050926, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/CI6b8.jpg?s=128&g=1", "display_name": "styko", "link": "https://stackoverflow.com/users/5050926/styko"}, "edited": false, "score": 0, "creation_date": 1547053641, "post_id": 54115079, "comment_id": 95062971, "body": "Thanks for your clarification. And thanks for the suggestion, although it may require a significant to my whole code."}, {"owner": {"reputation": 4505, "user_id": 1168733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5ewxJ.jpg?s=128&g=1", "display_name": "Sigi", "link": "https://stackoverflow.com/users/1168733/sigi"}, "reply_to_user": {"reputation": 611, "user_id": 5050926, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/CI6b8.jpg?s=128&g=1", "display_name": "styko", "link": "https://stackoverflow.com/users/5050926/styko"}, "edited": false, "score": 0, "creation_date": 1547054116, "post_id": 54115079, "comment_id": 95063246, "body": "I see. To make the long story short, the horrific array-of-arrays style was adopted in &quot;Numerical Recipes in C&quot;, and A LOT of scientific computing in C got it. Unfortunately it leads to a lot of troubles in handling the non-flat memory, as you have seen with this example, possible performance penalties for a minimal syntactical sugar to let C be similar to Fortran. And guess what, Fortran memory layout for 2D arrays is flat."}], "tags": [], "owner": {"reputation": 4505, "user_id": 1168733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5ewxJ.jpg?s=128&g=1", "display_name": "Sigi", "link": "https://stackoverflow.com/users/1168733/sigi"}, "is_accepted": true, "score": 2, "last_activity_date": 1547053393, "creation_date": 1547053393, "answer_id": 54115079, "question_id": 54114696, "link": "https://stackoverflow.com/questions/54114696/does-mpi-reduce-need-an-existing-pointer-for-the-receive-buffer/54115079#54115079", "title": "Does MPI_Reduce need an existing pointer for the receive buffer?", "body": "<p>The problem is not MPI, but the fact that you are passing <code>obs_sum[k]</code>, but you haven't defined/allocated it at all.</p>\n\n<pre><code>for (int k = 0 ; k &lt; n1 ; ++k) {\n    // This is the line that results in a segfault if OLD is defined\n    MPI_Reduce(observables[k], obs_sum[k], n2, MPI_LONG, MPI_SUM, 0,\n               MPI_COMM_WORLD);\n}\n</code></pre>\n\n<p>Even if <code>MPI_Reduce()</code> is not getting its value, the generated code will get <code>obs_sum</code> (undefined and not allocated), add <code>k</code> to it and try to read this pointer (segfault) to be passed to <code>MPI_Reduce()</code>.</p>\n\n<p>For example the allocation of the rows should be sufficient for it to work:</p>\n\n<pre><code>#else // Correct version\n      // We define all the pointers in all the processes.\n      obs_sum = (long **) malloc(n2 * sizeof(long *));\n      // try commenting out the following lines\n      // if (world_rank == 0) {\n      //   for (int k = 0 ; k &lt; n2 ; ++k) {\n      //     obs_sum[k] = (long *) calloc(n2, sizeof(long));\n      //   }\n      // }\n#endif\n</code></pre>\n\n<p>I would allocate a 2D array as a flat array - I really <em>hate</em> this array-of-arrays representation. Wouldn't this be better?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;mpi.h&gt;\n\nint main(int argc, char **argv) {\n   // MPI initialization\n    int world_rank, world_size;\n    MPI_Init(NULL, NULL);\n    MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);\n    MPI_Comm_size(MPI_COMM_WORLD, &amp;world_size);\n\n    int n1 = 3, n2 = 10; // Sizes of the 2d arrays\n\n    long *observables = (long *) malloc(n1*n2*sizeof(long));\n    for (int k = 0 ; k &lt; n1 ; ++k) {\n        for (long i = 0 ; i &lt; n2 ; ++i) {\n            observables[k*n2+i] = k * i * world_rank; // Whatever\n        }\n    }\n\n    long *obs_sum = nullptr; // This will hold the sum on process 0\n    if (world_rank == 0) {\n        obs_sum = (long *) malloc(n1*n2*sizeof(long));\n    }\n\n    MPI_Reduce(observables, obs_sum, n1*n2, MPI_LONG, MPI_SUM, 0, MPI_COMM_WORLD);\n\n    MPI_Barrier(MPI_COMM_WORLD);\n    MPI_Finalize();\n    // You may free memory here\n\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 611, "user_id": 5050926, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/CI6b8.jpg?s=128&g=1", "display_name": "styko", "link": "https://stackoverflow.com/users/5050926/styko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 54115079, "answer_count": 1, "score": 0, "last_activity_date": 1547053393, "creation_date": 1547052009, "last_edit_date": 1547052900, "question_id": 54114696, "link": "https://stackoverflow.com/questions/54114696/does-mpi-reduce-need-an-existing-pointer-for-the-receive-buffer", "title": "Does MPI_Reduce need an existing pointer for the receive buffer?", "body": "<p>The <a href=\"https://www.mpich.org/static/docs/v3.2.x/www3/MPI_Reduce.html\" rel=\"nofollow noreferrer\">MPI documentation</a> asserts that the adress of address of the receive buffer (<code>recvbuf</code>) is significant only at root. Meaning that the memory may not be allocated in the other processes. This is confirmed by <a href=\"https://stackoverflow.com/questions/34796403/about-mpi-reduce\">this question</a>.</p>\n\n<pre><code>int MPI_Reduce(const void *sendbuf, void *recvbuf, int count, MPI_Datatype datatype,\n               MPI_Op op, int root, MPI_Comm comm)\n</code></pre>\n\n<p>At first I thought that <code>recvbuf</code> did not even have to exist: that the memory for <code>recvbuf</code> itself did not have to be allocated (eg by dynamical allocation). Unfortunately (it took me a lot of time to understand my mistake!), it seems that even if the memory that it points to is not valid, the pointer itself has to exist.</p>\n\n<p>See below for the code I have in mind, with a version that gives a segfault, and one that does not.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;mpi.h&gt;\n\nint main(int argc, char **argv) {\n   // MPI initialization\n    int world_rank, world_size;\n    MPI_Init(NULL, NULL);\n    MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);\n    MPI_Comm_size(MPI_COMM_WORLD, &amp;world_size);\n\n    int n1 = 3, n2 = 10; // Sizes of the 2d arrays\n\n    long **observables = (long **) malloc(n1 * sizeof(long *));\n    for (int k = 0 ; k &lt; n1 ; ++k) {\n        observables[k] = (long *) calloc(n2, sizeof(long));\n        for (long i = 0 ; i &lt; n2 ; ++i) {\n            observables[k][i] = k * i * world_rank; // Whatever\n        }\n    }\n\n    long **obs_sum; // This will hold the sum on process 0\n#ifdef OLD  // Version that gives a segfault\n    if (world_rank == 0) {\n        obs_sum = (long **) malloc(n2 * sizeof(long *));\n        for (int k = 0 ; k &lt; n2 ; ++k) {\n            obs_sum[k] = (long *) calloc(n2, sizeof(long));\n        }\n    }\n#else // Correct version\n   // We define all the pointers in all the processes.\n    obs_sum = (long **) malloc(n2 * sizeof(long *));\n    if (world_rank == 0) {\n        for (int k = 0 ; k &lt; n2 ; ++k) {\n            obs_sum[k] = (long *) calloc(n2, sizeof(long));\n        }\n    }\n#endif\n\n    for (int k = 0 ; k &lt; n1 ; ++k) {\n        // This is the line that results in a segfault if OLD is defined\n        MPI_Reduce(observables[k], obs_sum[k], n2, MPI_LONG, MPI_SUM, 0,\n                   MPI_COMM_WORLD);\n    }\n\n    MPI_Barrier(MPI_COMM_WORLD);\n    MPI_Finalize();\n    // You may free memory here\n\n    return 0;\n}\n</code></pre>\n\n<p>Am I interpreting this correctly? What is the rationale behind this behavior?</p>\n"}, {"tags": ["c", "pointers", "struct", "malloc"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 2, "creation_date": 1547051858, "post_id": 54114624, "comment_id": 95061900, "body": "Just one [C] question before this one..."}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 2, "creation_date": 1547051877, "post_id": 54114624, "comment_id": 95061916, "body": "<code>To be sure the allocation is done correcty I expect to see a SegFault if VALUE&gt;=dataset.mFeatures</code> undefined behavior is undefined."}, {"owner": {"reputation": 130, "user_id": 9123683, "user_type": "registered", "profile_image": "https://graph.facebook.com/432602493747247/picture?type=large", "display_name": "Luca Jungla", "link": "https://stackoverflow.com/users/9123683/luca-jungla"}, "edited": false, "score": 0, "creation_date": 1547052410, "post_id": 54114624, "comment_id": 95062243, "body": "Why it should be undefined?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1547052487, "post_id": 54114624, "comment_id": 95062285, "body": "@LucaJungla This question (in the comment) doesn&#39;t make sense. It is undefined if no one have defined it."}, {"owner": {"reputation": 2445, "user_id": 3476780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/abf771bddcd864626a0e1499ccfc699b?s=128&d=identicon&r=PG&f=1", "display_name": "yano", "link": "https://stackoverflow.com/users/3476780/yano"}, "edited": false, "score": 0, "creation_date": 1547052656, "post_id": 54114624, "comment_id": 95062387, "body": "@LucaJungla for speed. C is meant to be close to the hardware and fast. If it had to do bounds checking on every array access, that would add overhead and slow things down (I think java and c# do this, for instance). C happily lets you shoot yourself in the foot if you do something wrong. It&#39;s up to the programmer <i>not</i> to do anything wrong."}, {"owner": {"reputation": 130, "user_id": 9123683, "user_type": "registered", "profile_image": "https://graph.facebook.com/432602493747247/picture?type=large", "display_name": "Luca Jungla", "link": "https://stackoverflow.com/users/9123683/luca-jungla"}, "edited": false, "score": 0, "creation_date": 1547052714, "post_id": 54114624, "comment_id": 95062417, "body": "Ok now is clear after the answer."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 1, "creation_date": 1547052751, "post_id": 54114624, "comment_id": 95062440, "body": "@LucaJungla We have to do a lot of supposition from your code because it is complicated for nothing and lot of definitions / values are unknown. Please next time just limit your example to the interesting part, could be <code>int main() { float * p = malloc(2*sizeof(float)); printf(&quot;%g\\n&quot;, p[5]); return 0; }</code>"}, {"owner": {"reputation": 130, "user_id": 9123683, "user_type": "registered", "profile_image": "https://graph.facebook.com/432602493747247/picture?type=large", "display_name": "Luca Jungla", "link": "https://stackoverflow.com/users/9123683/luca-jungla"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547052828, "post_id": 54114624, "comment_id": 95062484, "body": "@bruno Thanks for the advice!"}], "answers": [{"tags": [], "owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "is_accepted": true, "score": 0, "last_activity_date": 1547052314, "creation_date": 1547052314, "answer_id": 54114781, "question_id": 54114624, "link": "https://stackoverflow.com/questions/54114624/malloc-for-pointers-in-struct-dont-bound-memory-to-declared-size/54114781#54114781", "title": "malloc() for pointers in struct don&#39;t bound memory to declared size", "body": "<p>The C language standard does not mandate bounds checking on array accesses (individual implementations <em>may</em> add bounds checking, but I'm not aware of any that do).  Neither does it specify what the behavior should be if you index outside of an array (or <code>malloc</code>'ed buffer).  Neither the compiler nor the runtime environment are required to handle the situation in any particular way (the behavior is left <em>undefined</em>).  </p>\n\n<p>It's up to the programmer to not read or write past the end of the array.  </p>\n"}], "owner": {"reputation": 130, "user_id": 9123683, "user_type": "registered", "profile_image": "https://graph.facebook.com/432602493747247/picture?type=large", "display_name": "Luca Jungla", "link": "https://stackoverflow.com/users/9123683/luca-jungla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "closed_date": 1547052293, "accepted_answer_id": 54114781, "answer_count": 1, "score": -1, "last_activity_date": 1547052440, "creation_date": 1547051768, "question_id": 54114624, "link": "https://stackoverflow.com/questions/54114624/malloc-for-pointers-in-struct-dont-bound-memory-to-declared-size", "closed_reason": "Duplicate", "title": "malloc() for pointers in struct don&#39;t bound memory to declared size", "body": "<p>I want to bound <code>*float vec_value</code> (member of <code>struct vec</code>) to be large a defined size. I do with malloc():</p>\n\n<pre><code>     pattern_ptr-&gt;vec_value=malloc(dataset.mFeatures * sizeof(float))\n</code></pre>\n\n<p>To be sure the allocation is done correcty I expect to see a SegFault if VALUE>=dataset.mFeatures when:</p>\n\n<pre><code>     printf(\"%f\\n\",pattern_ptr[N].vec_value[VALUE]);\n</code></pre>\n\n<p>But it compiles and prints the value in the adjacent area in memory.</p>\n\n<p>This is the code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include \"parser.h\"\n\nstruct vec{\n    int id_vec;\n    float *vec_value;\n};\n\n//prototipi\nDataset loadDataset(void); // struct { int nPattern; int mFeatures; float *dataset_ptr;  }\n\nint main(){\n\n    int i,j;\n    Dataset dataset=loadDataset();\n    struct vec *pattern_ptr=malloc(dataset.nPattern * sizeof(struct vec));\n    pattern_ptr-&gt;vec_value=malloc(dataset.mFeatures * sizeof(float));\n    for(i=0;i&lt;dataset.nPattern;i++){\n        pattern_ptr[i].id_vec=i;\n        pattern_ptr[i].vec_value=&amp;dataset.dataset_ptr[i*dataset.mFeatures];\n    }\n\n    printf(\"%f\\n\",pattern_ptr[1].vec_value[10]);\n</code></pre>\n\n<p>What's wrong?</p>\n"}, {"tags": ["c", "arrays", "memory", "dynamic", "malloc"], "comments": [{"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 0, "creation_date": 1547051701, "post_id": 54114574, "comment_id": 95061802, "body": "Do not cast <code>malloc()</code> and generally <code>void *</code>, it&#39;s too verbose and thus frowned upon"}, {"owner": {"reputation": 2445, "user_id": 3476780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/abf771bddcd864626a0e1499ccfc699b?s=128&d=identicon&r=PG&f=1", "display_name": "yano", "link": "https://stackoverflow.com/users/3476780/yano"}, "edited": false, "score": 2, "creation_date": 1547051764, "post_id": 54114574, "comment_id": 95061833, "body": "overflowing a memory buffer is undefined behavior, which means you don&#39;t know what will happen. <code>malloc</code> doesn&#39;t have to return <i>exactly</i> the amount of memory you request. It returns <i>at least</i> as much memory as you request, or nothing."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1547051767, "post_id": 54114574, "comment_id": 95061835, "body": "It doesn&#39;t give you more memory. Accessing memory that does not belong to you is <i>undefined behaviour</i> (google that term)."}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1547051778, "post_id": 54114574, "comment_id": 95061846, "body": "You have <b>undefined behavior</b>. You should be <a href=\"https://stackoverflow.com/a/46526702/841108\">very scared</a>"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1547051818, "post_id": 54114574, "comment_id": 95061871, "body": "There must be a dupe of this."}, {"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1547051865, "post_id": 54114574, "comment_id": 95061904, "body": "@BasileStarynkevitch We need a canonical &quot;my program is letting me do UB&quot; Q&amp;A to close duplicates."}, {"owner": {"reputation": 93, "user_id": 8918792, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155848049793048/picture?type=large", "display_name": "AspiringNewbie", "link": "https://stackoverflow.com/users/8918792/aspiringnewbie"}, "edited": false, "score": 2, "creation_date": 1547052718, "post_id": 54114574, "comment_id": 95062420, "body": "Sorry for the people who felt this was a duplicate. I didn&#39;t even know what undefined behavior was and that is what my program was experiencing, so it&#39;s difficult to search for that term before making a thread like this. Believe me I googled a lot before I asked here, and checked other stackoverflow posts.  My apologies anyway and thank you for everyone who replied so quickly, you&#39;ve helped more than you realize :)"}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1547053952, "post_id": 54114574, "comment_id": 95063157, "body": "&quot;<i>... explain why this is.</i>&quot;: Undefined behaviour is undefined."}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1547054135, "post_id": 54114574, "comment_id": 95063263, "body": "OT: If your compiler told you to cast <code>malloc()</code> it&#39;s not a C compiler, but most likely a C++ compiler. If you you want to do C, use a C compiler, not a C++ compiler."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547054703, "post_id": 54114574, "comment_id": 95063543, "body": "&quot;I expected the loop to only run 10 times before hitting an error.&quot; is like diving attempting to drive faster than the speed limit and expecting a speeding ticket.  C expect coders to follow the rules and leaves much policing to the coder.  C is not specified to detect the error.  Welcome to programming without training wheels."}, {"owner": {"reputation": 93, "user_id": 8918792, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155848049793048/picture?type=large", "display_name": "AspiringNewbie", "link": "https://stackoverflow.com/users/8918792/aspiringnewbie"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547055072, "post_id": 54114574, "comment_id": 95063730, "body": "@chux It was pretty ignorant of me to not know that C doesn&#39;t handle out of bounds exceptions etc, for some reason I thought it did. I&#39;m still very new to C, and didn&#39;t realize how much Java and C++ were babysitting me until now. Trust me I feel stupid for not realizing but I&#39;ve learnt my lesson with this feedback. I can&#39;t apologise for trying to playwith malloc to try to better understand it though.."}, {"owner": {"reputation": 8154, "user_id": 2470782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921783e0584f9ace7e05d303e4d48869?s=128&d=identicon&r=PG", "display_name": "Ingo Leonhardt", "link": "https://stackoverflow.com/users/2470782/ingo-leonhardt"}, "edited": false, "score": 2, "creation_date": 1547058060, "post_id": 54114574, "comment_id": 95065024, "body": "There&#39;s absolutely nothing to apologize or to feel stupid for. You&#39;ve learned a difference between C and the languages you have come from and that&#39;s great"}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 1, "creation_date": 1547067026, "post_id": 54114574, "comment_id": 95068799, "body": "If one of these answers helped you, you should <a href=\"https://stackoverflow.com/help/accepted-answer\">accept it</a>."}], "answers": [{"comments": [{"owner": {"reputation": 93, "user_id": 8918792, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155848049793048/picture?type=large", "display_name": "AspiringNewbie", "link": "https://stackoverflow.com/users/8918792/aspiringnewbie"}, "edited": false, "score": 0, "creation_date": 1547052141, "post_id": 54114627, "comment_id": 95062092, "body": "Thank you for the answer, I&#39;m quite new too C and well programming generally. I didn&#39;t know the program would still run even when I thought it shouldn&#39;t.  So essentially as long as be careful to never go past the memory I allocate to it with some kind of check I should be fine using it?"}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "reply_to_user": {"reputation": 93, "user_id": 8918792, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155848049793048/picture?type=large", "display_name": "AspiringNewbie", "link": "https://stackoverflow.com/users/8918792/aspiringnewbie"}, "edited": false, "score": 2, "creation_date": 1547052226, "post_id": 54114627, "comment_id": 95062147, "body": "@ChrisRafferty Correct.  You need to keep track of the size yourself and ensure you don&#39;t do something you shouldn&#39;t."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1547054895, "post_id": 54114627, "comment_id": 95063643, "body": "A subtle point to this good answer: C does not <i>require</i> bounds checking.  A C compiler could emit code to perform such checks on array access - or not."}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 9, "last_activity_date": 1547220938, "last_edit_date": 1547220938, "creation_date": 1547051781, "answer_id": 54114627, "question_id": 54114574, "link": "https://stackoverflow.com/questions/54114574/using-malloc-is-giving-me-more-memory-than-expected/54114627#54114627", "title": "Using malloc is giving me more memory than expected?", "body": "<p>C isn't required to perform any bounds checking on array access.  It can allow you read/write past that without any warning or error.</p>\n\n<p>You're invoking <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behavior</a> by reading and writing past the end of allocated memory.  This means the behavior of your program can't be predicted.  It could crash, it could output strange results, or it could (as in your case) appear to work properly.</p>\n\n<p>Just because the program can crash doesn't mean it will.</p>\n"}, {"comments": [{"owner": {"reputation": 93, "user_id": 8918792, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155848049793048/picture?type=large", "display_name": "AspiringNewbie", "link": "https://stackoverflow.com/users/8918792/aspiringnewbie"}, "edited": false, "score": 0, "creation_date": 1547052588, "post_id": 54114648, "comment_id": 95062345, "body": "Thank you for clearing that up like some of the other users before you. The main thing is that it that at least gives me as much as I requested, and then I set up checks to make sure it never goes over. I just didn&#39;t understand the fact the program would run when past what was allocated, but now I know, thanks again."}], "tags": [], "owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "is_accepted": false, "score": 1, "last_activity_date": 1547052395, "last_edit_date": 1547052395, "creation_date": 1547051851, "answer_id": 54114648, "question_id": 54114574, "link": "https://stackoverflow.com/questions/54114574/using-malloc-is-giving-me-more-memory-than-expected/54114648#54114648", "title": "Using malloc is giving me more memory than expected?", "body": "<p>Undefined behavior doesn't mean \"guaranteed segmentation fault\"; it may work in some cases. </p>\n\n<p>There is no way of knowing how far beyond an array's bounds you can go before you finally crash; even dereferencing one element beyond a boundary is undefined behavior.</p>\n\n<p>Also: if <code>malloc</code> succeeds, it will allocate <em>at least</em> as much space as you requested, possibly more.</p>\n"}, {"comments": [{"owner": {"reputation": 93, "user_id": 8918792, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155848049793048/picture?type=large", "display_name": "AspiringNewbie", "link": "https://stackoverflow.com/users/8918792/aspiringnewbie"}, "edited": false, "score": 0, "creation_date": 1547052446, "post_id": 54114650, "comment_id": 95062267, "body": "Thank you for your time replying. I didn&#39;t actually know the program can run when it shouldn&#39;t be. I was just expected some kind of out of bounds error and then it to crash. Guess i learnt something valuable, thanks again!"}], "tags": [], "owner": {"reputation": 1495, "user_id": 2432128, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/61d3f32e007af4246ee7f1589686e831?s=128&d=identicon&r=PG", "display_name": "Norw&#230;", "link": "https://stackoverflow.com/users/2432128/norw%c3%a6"}, "is_accepted": false, "score": 4, "last_activity_date": 1547051858, "creation_date": 1547051858, "answer_id": 54114650, "question_id": 54114574, "link": "https://stackoverflow.com/questions/54114574/using-malloc-is-giving-me-more-memory-than-expected/54114650#54114650", "title": "Using malloc is giving me more memory than expected?", "body": "<p>The codes runs without an error, but it is still wrong. You just do not notice it. Your loop runs out of the allocated area, but the system remains unaware of that fact until you run out of a much larger area your program can potentially access. </p>\n\n<p>Picture it this way:</p>\n\n<pre><code>&lt;UNAVAILABLE&gt;&lt;other data&gt;1234567890&lt;other data&gt;&lt;UNAVAILABLE&gt;\n</code></pre>\n\n<p>Your 10 <code>int</code>s are in the middle of other data, which you can read and even write - to very unpleasant effects. C is not holding your hand here - only once you go out of the total available memory, the program will crash, not before.</p>\n"}], "owner": {"reputation": 93, "user_id": 8918792, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155848049793048/picture?type=large", "display_name": "AspiringNewbie", "link": "https://stackoverflow.com/users/8918792/aspiringnewbie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 54114627, "answer_count": 3, "score": 2, "last_activity_date": 1547220938, "creation_date": 1547051605, "last_edit_date": 1547066930, "question_id": 54114574, "link": "https://stackoverflow.com/questions/54114574/using-malloc-is-giving-me-more-memory-than-expected", "title": "Using malloc is giving me more memory than expected?", "body": "<p>I'm trying to get to grips with <code>malloc</code>, and so far I'm mostly getting unexpected results when testing and playing around with it.</p>\n\n<pre><code>int main(int argc, char** argv)\n{\n    int size = 10;\n    int *A;\n    A = (int *)malloc(size * sizeof(int));\n    for (int i = 0; i &lt; 10000; i++)\n    {\n        A[i] = i;\n    }\n    for (int i = 0; i &lt; 10000; i++)\n    {\n        printf(\"%d) %d\\n\", i, A[i]);\n    }\n}\n</code></pre>\n\n<p>With this example code above for example, the code runs without an error. Even though I only allocated <code>A</code> to hold 10 * int, so I expected the loop to only run 10 times before hitting an error. If I increment the loop to about 30-40k instead, it then hits a segmentation error. However if I increase my size to the loop amount, it would always work like expected. So I know how to avoid the error.. kinda, I was just hoping someone might be kind enough to explain why this is. </p>\n\n<p>Edit: Turned out I didn't appreciate that C doesn't detect out of bounds, I've been looked after way too much by Java and C++. I had <strong>undefined behavior</strong> and now know it's my job to prevent them. Thanks for everyone that replied.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1547051739, "post_id": 54114571, "comment_id": 95061824, "body": "There is an ancient belief that every duplicate to this question is counting towards the Apocalypse."}, {"owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1547052424, "post_id": 54114571, "comment_id": 95062253, "body": "@EugeneSh.: Given the number of duplicates, I&#39;m inclined to believe this <i>is</i> the Apocalypse."}], "owner": {"reputation": 1, "user_id": 10890890, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xVuFnAAsXjc/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYZ_Mo9Sctm6vSGaJhlmKA_yJ_NJg/mo/photo.jpg?sz=128", "display_name": "Tung Phan", "link": "https://stackoverflow.com/users/10890890/tung-phan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 28, "favorite_count": 0, "closed_date": 1547051659, "answer_count": 0, "score": 0, "last_activity_date": 1547051599, "creation_date": 1547051599, "question_id": 54114571, "link": "https://stackoverflow.com/questions/54114571/post-increment-and-pre-increment-how-does-it-really-work", "closed_reason": "Duplicate", "title": "post increment and pre increment how does it really work?", "body": "<p>I understood that ++a will make +1 first and a++ will do +1 later. But i have a problem that i couldnt find out.</p>\n\n<pre><code>int a=2\na++ + a++ + a++ = 2 + 3 + 4=9\nno problem\na++ + ++a + ++a = 2 + 4 + 5=11 \nok\n</code></pre>\n\n<p>but how does <code>++a + a++ + ++a=12 ?</code>\nI tried with serveral compilers and still got this result.</p>\n"}, {"tags": ["java", "c", "linux", "eclipse", "java-native-interface"], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 6928286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff8c701b1f22bdb715c93a7f726987cc?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/6928286/steve"}, "edited": false, "score": 0, "creation_date": 1547061545, "post_id": 54116801, "comment_id": 95066509, "body": "Yes, my libhello.so file is in the helloJNI directory. I tried your suggestions. It seems to fix the problem, but then I get a different error. Now it says: Error: Could not find or load main class HelloJNI Caused by: java.lang.ClassNotFoundException: HelloJNI"}, {"owner": {"reputation": 27, "user_id": 6928286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff8c701b1f22bdb715c93a7f726987cc?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/6928286/steve"}, "edited": false, "score": 0, "creation_date": 1547065717, "post_id": 54116801, "comment_id": 95068259, "body": "The error still persists even with the prefix, unfortunately."}, {"owner": {"reputation": 52300, "user_id": 192373, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/83a45711c4c32eeeb3826d279e50f8ab?s=128&d=identicon&r=PG", "display_name": "Alex Cohn", "link": "https://stackoverflow.com/users/192373/alex-cohn"}, "reply_to_user": {"reputation": 27, "user_id": 6928286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff8c701b1f22bdb715c93a7f726987cc?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/6928286/steve"}, "edited": false, "score": 0, "creation_date": 1547066349, "post_id": 54116801, "comment_id": 95068530, "body": "You are supposed to run this command when <code>~&#47;eclipse-workspace&#47;HelloJNI&#47;src</code> is your current directory"}, {"owner": {"reputation": 27, "user_id": 6928286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff8c701b1f22bdb715c93a7f726987cc?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/6928286/steve"}, "edited": false, "score": 0, "creation_date": 1547066802, "post_id": 54116801, "comment_id": 95068706, "body": "I see, but running the command from <code>~&#47;eclipse-workspace&#47;HelloJNI&#47;src</code> produces the old error. I&#39;ve also tried editing my <code>LD_LIBRARY_PATH</code> by adding my workspace directory, though with no luck."}, {"owner": {"reputation": 52300, "user_id": 192373, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/83a45711c4c32eeeb3826d279e50f8ab?s=128&d=identicon&r=PG", "display_name": "Alex Cohn", "link": "https://stackoverflow.com/users/192373/alex-cohn"}, "reply_to_user": {"reputation": 27, "user_id": 6928286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff8c701b1f22bdb715c93a7f726987cc?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/6928286/steve"}, "edited": false, "score": 0, "creation_date": 1547068775, "post_id": 54116801, "comment_id": 95069567, "body": "make sure you have files <code>~&#47;eclipse-workspace&#47;HelloJNI&#47;src&#47;helloJNI&#47;HelloJNI.class</code> and <code>~&#47;eclipse-workspace&#47;HelloJNI&#47;src&#47;helloJNI&#47;libhello.so</code>."}, {"owner": {"reputation": 27, "user_id": 6928286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff8c701b1f22bdb715c93a7f726987cc?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/6928286/steve"}, "edited": false, "score": 0, "creation_date": 1547103633, "post_id": 54116801, "comment_id": 95078272, "body": "I did make sure of that, but I&#39;m still getting the error."}, {"owner": {"reputation": 27, "user_id": 6928286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff8c701b1f22bdb715c93a7f726987cc?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/6928286/steve"}, "edited": false, "score": 0, "creation_date": 1547110490, "post_id": 54116801, "comment_id": 95081264, "body": "No. But I&#39;m pretty sure I need it."}, {"owner": {"reputation": 52300, "user_id": 192373, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/83a45711c4c32eeeb3826d279e50f8ab?s=128&d=identicon&r=PG", "display_name": "Alex Cohn", "link": "https://stackoverflow.com/users/192373/alex-cohn"}, "reply_to_user": {"reputation": 27, "user_id": 6928286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff8c701b1f22bdb715c93a7f726987cc?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/6928286/steve"}, "edited": false, "score": 0, "creation_date": 1547214124, "post_id": 54116801, "comment_id": 95126420, "body": "<i>&quot;I&#39;m pretty sure I need it&quot;</i> Oh, I didn&#39;t express myself correctly.What I wanted to suggest: perform minimal change to this Java class so that it does not need the native lib, check that in your environment it now works as expected, and only after that try to find what must be done to have the native lib work, too."}, {"owner": {"reputation": 27, "user_id": 6928286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff8c701b1f22bdb715c93a7f726987cc?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/6928286/steve"}, "edited": false, "score": 0, "creation_date": 1547494896, "post_id": 54116801, "comment_id": 95204340, "body": "Hi, I figured it out. I forgot to add the package name in the function inside the C file... Embarrassing. Thanks for your help anyway."}], "tags": [], "owner": {"reputation": 52300, "user_id": 192373, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/83a45711c4c32eeeb3826d279e50f8ab?s=128&d=identicon&r=PG", "display_name": "Alex Cohn", "link": "https://stackoverflow.com/users/192373/alex-cohn"}, "is_accepted": false, "score": 0, "last_activity_date": 1547064702, "last_edit_date": 1547064702, "creation_date": 1547061182, "answer_id": 54116801, "question_id": 54114547, "link": "https://stackoverflow.com/questions/54114547/unsatisfiedlinkerror-no-libhello-in-java-library-path/54116801#54116801", "title": "UnsatisfiedLinkError: no libhello in java.library.path", "body": "<blockquote>\n  <p>I moved up one directory to <code>~/eclipse-workspace/HelloJNI/src</code></p>\n</blockquote>\n\n<p>This means that your <strong>libhello.so</strong> is in <code>~/eclipse-workspace/HelloJNI/src/helloJNI</code> directory, isn't it?</p>\n\n<p>Now, to let Java find this library, run</p>\n\n<pre><code>java -Djava.library.path=helloJNI helloJNI.HelloJNI\n</code></pre>\n\n<p>or use the absolute path</p>\n\n<pre><code>java -Djava.library.path=~/eclipse-workspace/HelloJNI/src/helloJNI helloJNI.HelloJNI\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 6928286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff8c701b1f22bdb715c93a7f726987cc?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/6928286/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 694, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1547064702, "creation_date": 1547051507, "last_edit_date": 1547056000, "question_id": 54114547, "link": "https://stackoverflow.com/questions/54114547/unsatisfiedlinkerror-no-libhello-in-java-library-path", "title": "UnsatisfiedLinkError: no libhello in java.library.path", "body": "<p>I'm doing a tutorial about JNI to get comfortable with it for my project. However, I'm stuck on this particular part of the tutorial which is running the Java program. I'm using Eclipse where I've created a Java project and put the files inside a package. When I try to follow the tutorial without using Eclipse, I get no errors, so I assume it's a path related issue.</p>\n\n<p>As for my error, I get an</p>\n\n<blockquote>\n  <p>UnsatisfiedLinkError: no libhello in java.library.path</p>\n</blockquote>\n\n<p>when I run this in my terminal:</p>\n\n<pre><code>java -Djava.library.path=. helloJNI.HelloJNI\n</code></pre>\n\n<p>Even when I specify my path, it doesn't work. If you want to reproduce my steps, here's what I did:</p>\n\n<ol>\n<li><p>After creating <code>HelloJNI.java</code>, I ran the following in the terminal:</p>\n\n<pre><code>javac -h . HelloJNI.java\n</code></pre></li>\n</ol>\n\n<p>This command created the generated header file given below.</p>\n\n<ol start=\"2\">\n<li><p>After this, I wrote <code>HelloJNI.c</code>, navigated to the package folder and then compiled it using this command in the same directory:</p>\n\n<pre><code> gcc -fPIC -I\"$JAVA_HOME/include\" -I\"$JAVA_HOME/include/linux\" -shared -o libhello.so HelloJNI.c\n</code></pre></li>\n<li><p>Then I moved up one directory to <code>~/eclipse-workspace/HelloJNI/src</code> and ran this command:</p>\n\n<pre><code> java -Djava.library.path=. HelloJNI\n</code></pre></li>\n</ol>\n\n<p>Which yields the error described above.</p>\n\n<p>Here's my code:</p>\n\n<p><strong>HelloJNI.java</strong></p>\n\n<pre><code>package helloJNI;\n\npublic class HelloJNI {  // Save as HelloJNI.java\n       static {\n          System.loadLibrary(\"hello\"); // Load native library hello.dll (Windows) or libhello.so (Unixes)\n                                       //  at runtime\n                                       // This library contains a native method called sayHello()\n       }\n\n       // Declare an instance native method sayHello() which receives no parameter and returns void\n       private native void sayHello();\n\n       // Test Driver\n       public static void main(String[] args) {\n          new HelloJNI().sayHello();  // Create an instance and invoke the native method\n       }\n    } \n</code></pre>\n\n<p><strong>HelloJNI.c</strong></p>\n\n<pre><code>// Save as \"HelloJNI.c\"\n#include &lt;jni.h&gt;        // JNI header provided by JDK\n#include &lt;stdio.h&gt;      // C Standard IO Header\n#include \"helloJNI_HelloJNI.h\"   // Generated\n\n// Implementation of the native method sayHello()\nJNIEXPORT void JNICALL Java_HelloJNI_sayHello(JNIEnv *env, jobject thisObj) {\n   printf(\"Hello World!\\n\");\n   return;\n}\n</code></pre>\n\n<p><strong>helloJNI_HelloJNI.h</strong></p>\n\n<pre><code>/* DO NOT EDIT THIS FILE - it is machine generated */\n#include &lt;jni.h&gt;\n/* Header for class helloJNI_HelloJNI */\n\n#ifndef _Included_helloJNI_HelloJNI\n#define _Included_helloJNI_HelloJNI\n#ifdef __cplusplus\nextern \"C\" {\n#endif\n/*\n * Class:     helloJNI_HelloJNI\n * Method:    sayHello\n * Signature: ()V\n */\nJNIEXPORT void JNICALL Java_helloJNI_HelloJNI_sayHello\n  (JNIEnv *, jobject);\n\n#ifdef __cplusplus\n}\n#endif\n#endif \n</code></pre>\n\n<p>I have also tried setting the path to my working directory, but I still get the same result. What am I doing wrong?</p>\n"}, {"tags": ["c", "char", "ascii"], "comments": [{"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 2, "creation_date": 1547052038, "post_id": 54114474, "comment_id": 95062028, "body": "Why would someone use <code>printf</code> in C++ code???"}, {"owner": {"reputation": 1271, "user_id": 1296597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/A1Puh.jpg?s=128&g=1", "display_name": "Adam Hess", "link": "https://stackoverflow.com/users/1296597/adam-hess"}, "edited": false, "score": 0, "creation_date": 1547052254, "post_id": 54114474, "comment_id": 95062166, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/42277132/when-does-underflow-occur\">When does underflow occur?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 10, "creation_date": 1547051622, "post_id": 54114530, "comment_id": 95061742, "body": "Eliminating the risk of using the wrong format string is a good reason for using <code>std::cout</code> over <code>printf</code> as it&#39;s type safe."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 1, "creation_date": 1547052346, "post_id": 54114530, "comment_id": 95062213, "body": "To re-word for clarity: OP is trying to print <code>long long int</code> using the specifier that is meant for <code>unsigned long long int</code>. The behaviour of the program is undefined."}], "tags": [], "owner": {"reputation": 1569, "user_id": 1694593, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9ec320e3d57fdbde4b7ecc8194b2a2d1?s=128&d=identicon&r=PG", "display_name": "Wander3r", "link": "https://stackoverflow.com/users/1694593/wander3r"}, "is_accepted": true, "score": 5, "last_activity_date": 1547051459, "creation_date": 1547051459, "answer_id": 54114530, "question_id": 54114474, "link": "https://stackoverflow.com/questions/54114474/why-does-subtraction-of-smaller-character-with-greater-character-give-a-big-posi/54114530#54114530", "title": "Why does subtraction of smaller character with greater character give a big positive integer instead of a negative integer?", "body": "<p><code>printf(\"Current value : %llu\\n\", curr_diff);</code> </p>\n\n<p>You are printing <code>long long unsigned</code> value. Use <code>%lld</code> to get the right output</p>\n"}], "owner": {"reputation": 68, "user_id": 8746895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460df7fe2bc264efe8c4f174bd25141f?s=128&d=identicon&r=PG&f=1", "display_name": "hrishikeshs", "link": "https://stackoverflow.com/users/8746895/hrishikeshs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "closed_date": 1547054200, "accepted_answer_id": 54114530, "answer_count": 1, "score": 0, "last_activity_date": 1547224547, "creation_date": 1547051293, "last_edit_date": 1547224547, "question_id": 54114474, "link": "https://stackoverflow.com/questions/54114474/why-does-subtraction-of-smaller-character-with-greater-character-give-a-big-posi", "closed_reason": "Not suitable for this site", "title": "Why does subtraction of smaller character with greater character give a big positive integer instead of a negative integer?", "body": "<p><b>When I subtract a larger character with a smaller one, I'm getting a huge positive number instead of a much smaller, negative number, while assigning it to a long long int variable.</b></p>\n\n<p>If I subtract ' N ' with ' A 'and if I assign it a long long int variable, it turns out to be 18446744073709551605 instead of -13.</p>\n\n<p>When I use abs() function while computing, I get the value correctly, but obviously it will be positive instead of negative. So how to get the value correctly?</p>\n\n<pre><code>char s[] = \"ABCT\";\nchar t[] = \"PBDI\";\nlong long int curr_diff;\nfor(int i=0; i&lt;4; i++){\ncurr_diff = (t[i] - '0') - (s[i] - '0');\nprintf(\"Current value : %llu\\n\", curr_diff);\n}\n</code></pre>\n\n<p><strong>Result from my code</strong></p>\n\n<pre><code>Current value : 15\nCurrent value : 0\nCurrent value : 1\nCurrent value : 18446744073709551605\n</code></pre>\n\n<p><strong>Expected result</strong></p>\n\n<pre><code>Current value : 15\nCurrent value : 0\nCurrent value : 1\nCurrent value : -11\n</code></pre>\n"}, {"tags": ["c", "ncurses"], "comments": [{"owner": {"reputation": 3126, "user_id": 2955790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vShcC.png?s=128&g=1", "display_name": "Duck Dodgers", "link": "https://stackoverflow.com/users/2955790/duck-dodgers"}, "edited": false, "score": 1, "creation_date": 1547050156, "post_id": 54114075, "comment_id": 95060852, "body": "Works error-free for me. I see a complete rectangle. (On Ubuntu 18.04, running in a bash terminal, and compiled with g++ 7.3.0.)"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1547051523, "post_id": 54114075, "comment_id": 95061682, "body": "Side comment: shouldn&#39;t <code>cbreak;</code> be <code>cbreak();</code>?"}, {"owner": {"reputation": 23, "user_id": 5608945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/i286T.png?s=128&g=1", "display_name": "syril", "link": "https://stackoverflow.com/users/5608945/syril"}, "edited": false, "score": 0, "creation_date": 1547051678, "post_id": 54114075, "comment_id": 95061786, "body": "Alright, thanks for testing. I had a feeling it was something on my end. I&#39;ll do some investigating."}, {"owner": {"reputation": 23, "user_id": 5608945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/i286T.png?s=128&g=1", "display_name": "syril", "link": "https://stackoverflow.com/users/5608945/syril"}, "edited": false, "score": 0, "creation_date": 1547051954, "post_id": 54114075, "comment_id": 95061964, "body": "You&#39;re right Ian, I&#39;ll fix it on my end and in the question."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1547052494, "post_id": 54114075, "comment_id": 95062289, "body": "Works for me as well. Each time I press a key the box cranks up one stop bigger. This could be terminal related. Can you try with a different terminal, or on a different machine to narrow down the probable cause?"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1547052598, "post_id": 54114075, "comment_id": 95062351, "body": "What is your <code>TERM</code> environment variable set to? Try setting it to <code>putty</code>."}, {"owner": {"reputation": 23, "user_id": 5608945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/i286T.png?s=128&g=1", "display_name": "syril", "link": "https://stackoverflow.com/users/5608945/syril"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1547053149, "post_id": 54114075, "comment_id": 95062680, "body": "@IanAbbott It was set to <code>xterm</code>, setting it to <code>putty</code> solved the problem! Want to answer and I can mark you as correct? :-) thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "is_accepted": true, "score": 3, "last_activity_date": 1599469469, "last_edit_date": 1599469469, "creation_date": 1547055944, "answer_id": 54115698, "question_id": 54114075, "link": "https://stackoverflow.com/questions/54114075/borders-dont-draw-properly-when-window-has-more-than-8-columns/54115698#54115698", "title": "Borders don&#39;t draw properly when window has more than 8 columns", "body": "<p><strong>ncurses</strong> uses a terminal capability database to get information about terminal control sequences that a terminal supports.  It uses the value of the <code>TERM</code> environment variable to look up this information.  PuTTY or KiTTY passes a desired value of the <code>TERM</code> environment variable to the SSH server.  Often it is set to &quot;xterm&quot; by default, but it can be changed in the session settings under <strong>Connection</strong> -&gt; <strong>Data</strong> -&gt; <strong>Terminal-type string</strong>.</p>\n<p>PuTTY and KiTTY used to support the control sequences for &quot;xterm&quot; in the terminal capability database quite well, but recent (mid-2017 onwards) versions of the database optimized the sequences defined for &quot;xterm&quot; to use sequences not currently supported by PuTTY or KiTTY. Specifically, it now makes use of the ECMA-48 <strong>REP</strong> (repeat character) control sequence which is not supported by PuTTY. To make line drawing work properly on systems with a recent terminal capability database, the <code>TERM</code> environment variable needs to be changed for PuTTY or KiTTY.  (It can be changed in the session settings as discussed above.)  Suitable values for recent versions of the terminal capability database include &quot;putty&quot; or &quot;putty-256color&quot;.  The value &quot;xterm-old&quot; may also work.</p>\n<p>Check the &quot;/usr/share/terminfo&quot; directory on your host system to see which terminal types are actually defined by the system. The first letter of the terminal type is split off as a subdirectory so that, for example, the terminal capabilities for the &quot;putty&quot; terminal type are defined by the &quot;/usr/share/terminfo/p/putty&quot; file.</p>\n<p>Note that this problem affects not only line-drawing, but any horizontal repeats of the same character more than six times. It is addressed by the <a href=\"https://invisible-island.net/ncurses/ncurses.faq.html#xterm_generic\" rel=\"nofollow noreferrer\"><strong>ncurses</strong> FAQ</a>:</p>\n<blockquote>\n<p>That only covers the features which are in the terminal description, and does not address differences between terminal emulators. For example, in <a href=\"https://invisible-island.net/ncurses/terminfo.src.html#t20170729\" rel=\"nofollow noreferrer\">mid-2017</a>, an update to the xterm terminal description added the ECMA-48 <strong>REP</strong> (repeat character) control. It was part of xterm since January 1997, but a terminal description using the feature was part of <em>xterm</em> only (not <em>ncurses</em>). After adding it to ncurses, it was observed that:</p>\n<ul>\n<li>rxvt is unaffected, since it does not use <code>TERM=xterm</code>.</li>\n<li>mlterm and OSX Terminal supported <strong>REP</strong>, using <code>TERM=xterm</code>.</li>\n<li>VTE, konsole, PuTTY, iTerm2 did not support this standard, longstanding feature, of <a href=\"https://invisible-island.net/xterm/xterm.html\" rel=\"nofollow noreferrer\">xterm</a> although they set <code>TERM</code> to <strong><code>xterm</code></strong> or <strong><code>xterm-256color</code></strong>.</li>\n<li>screen and tmux use a different <code>TERM</code> setting, and seemed to work (although tmux had some other issue with the test).</li>\n</ul>\n</blockquote>\n<p><strong>FOLLOW-UP 2020-09-07</strong></p>\n<p>PuTTY version 0.71 (released 2019-03-16) added support for the <strong>REP</strong> escape sequence. (See the <a href=\"https://www.chiark.greenend.org.uk/%7Esgtatham/putty/changes.html\" rel=\"nofollow noreferrer\">change log</a>.)</p>\n"}], "owner": {"reputation": 23, "user_id": 5608945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/i286T.png?s=128&g=1", "display_name": "syril", "link": "https://stackoverflow.com/users/5608945/syril"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 424, "favorite_count": 0, "accepted_answer_id": 54115698, "answer_count": 1, "score": 2, "last_activity_date": 1599469469, "creation_date": 1547049995, "last_edit_date": 1547052010, "question_id": 54114075, "link": "https://stackoverflow.com/questions/54114075/borders-dont-draw-properly-when-window-has-more-than-8-columns", "title": "Borders don&#39;t draw properly when window has more than 8 columns", "body": "<p>The border drawing functions just don't seem to draw the top and bottom borders properly when the window's width is above 8. As a disclaimer, I'm using KiTTY to SSH into an Arch Linux server.</p>\n\n<p>I'm a newbie to ncurses, so there's a good chance I'm doing something wrong, but from what I've read this should be right...</p>\n\n<pre><code>#include &lt;ncurses.h&gt;\nint main() {\n  initscr(); cbreak();\n  WINDOW *win = newwin(1,1, 1,1);\n  for(int i=1; i &lt; 16; ++i) {\n    wresize(win, i, i);\n    wclear(win);\n    box(win, 0,0); // I've also tested wborder()\n    wrefresh(win);\n    mvprintw(0,0, \"size: %i\", i);\n    getch(); //pause\n  }\n  endwin();\n  return 0;\n}\n</code></pre>\n\n<p>Running this code, this is what I see:</p>\n\n<pre><code>size: 8\n +------+\n \u00a6      \u00a6 Displays like this (normally)\n \u00a6      \u00a6 for both top and bottom borders\n \u00a6      \u00a6\n \u00a6      \u00a6\n \u00a6      \u00a6\n \u00a6      \u00a6\n +------+\n\nsize: 9\n +-+\n \u00a6       \u00a6 Each size up it will continue\n \u00a6       \u00a6 to look like this, with the\n \u00a6       \u00a6 top and bottom borders looking\n \u00a6       \u00a6 like `+-+`\n \u00a6       \u00a6\n \u00a6       \u00a6\n \u00a6       \u00a6\n +-+\n</code></pre>\n"}, {"tags": ["c", "struct", "initialization", "lvalue"], "comments": [{"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1547049053, "post_id": 54113753, "comment_id": 95060115, "body": "You need to ask a question.  The one in your title is too broad."}, {"owner": {"reputation": 599, "user_id": 2289030, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6dce60b9c9d6ff1f7852d2e553b70648?s=128&d=identicon&r=PG", "display_name": "ijustlovemath", "link": "https://stackoverflow.com/users/2289030/ijustlovemath"}, "reply_to_user": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1547049137, "post_id": 54113753, "comment_id": 95060191, "body": "I&#39;ve added one to the main post body, does that clarify?"}, {"owner": {"reputation": 2445, "user_id": 3476780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/abf771bddcd864626a0e1499ccfc699b?s=128&d=identicon&r=PG&f=1", "display_name": "yano", "link": "https://stackoverflow.com/users/3476780/yano"}, "edited": false, "score": 0, "creation_date": 1547050513, "post_id": 54113753, "comment_id": 95061069, "body": "is using macros a requirement? Seems like there are simpler/more straight-forward ways to initialize variables (I hate macros with a passion so my personal bias is surfacing)."}, {"owner": {"reputation": 599, "user_id": 2289030, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6dce60b9c9d6ff1f7852d2e553b70648?s=128&d=identicon&r=PG", "display_name": "ijustlovemath", "link": "https://stackoverflow.com/users/2289030/ijustlovemath"}, "edited": false, "score": 0, "creation_date": 1547050657, "post_id": 54113753, "comment_id": 95061154, "body": "The end goal is automatically generate many parts of the code from the base macro (see: X macros), so yes, it is. If you have an alternate solution, perhaps I could adapt it?"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 1, "creation_date": 1547051590, "post_id": 54113753, "comment_id": 95061731, "body": "@ijustlovemath Today I learn on S.O. it is possible to use <code>...</code> in macro, so I applied for you case, see my answer"}], "answers": [{"comments": [{"owner": {"reputation": 599, "user_id": 2289030, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6dce60b9c9d6ff1f7852d2e553b70648?s=128&d=identicon&r=PG", "display_name": "ijustlovemath", "link": "https://stackoverflow.com/users/2289030/ijustlovemath"}, "edited": false, "score": 0, "creation_date": 1547052045, "post_id": 54114444, "comment_id": 95062030, "body": "This works! I only have one of these arrays, so if you have more than one, the varargs approach won&#39;t fly. Thanks!"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 599, "user_id": 2289030, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6dce60b9c9d6ff1f7852d2e553b70648?s=128&d=identicon&r=PG", "display_name": "ijustlovemath", "link": "https://stackoverflow.com/users/2289030/ijustlovemath"}, "edited": false, "score": 0, "creation_date": 1547052131, "post_id": 54114444, "comment_id": 95062086, "body": "@ijustlovemath yes, there is cheating in the solution ;-)"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1547052913, "post_id": 54114444, "comment_id": 95062530, "body": "Note that this relies on the GNU-specific syntax for variadic macros.  There is a standard syntax supported by all compilers conforming to C99 or later, including GCC except when in C90 mode."}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": false, "score": 2, "last_activity_date": 1547051196, "creation_date": 1547051196, "answer_id": 54114444, "question_id": 54113753, "link": "https://stackoverflow.com/questions/54113753/how-to-create-an-array-literal-of-struct-literals-in-c/54114444#54114444", "title": "How to create an array literal of struct literals in C?", "body": "<p>What about that :</p>\n\n<pre><code>#define CHANGES \\\nCHANGE(1, {{.id=1,.quantity=qty_None,.argument=arg_X}, \\\n            {.id=2,.quantity=qty_Many,.argument=arg_Z}\\\n            }\\\n           \\\n    )\\\nCHANGE(2, {{.id=1,.quantity=qty_Some,.argument=arg_Y}})\n\nint main(void) {\n    // your code goes here\n#define CHANGE(change_id, actions ...) \\\n    action_t current_actions ## change_id[] = actions;\n\n    CHANGES\n\n#undef CHANGE\n    return 0;\n}\n</code></pre>\n\n<p>I removed the parenthesis in CHANGES and added  <code>...</code> in CHANGE</p>\n\n<p>That compile and <code>gcc -E foo.c</code> gives :</p>\n\n<pre><code>   int main(void) {\n\n\n\n\n        action_t current_actions1[] = {{.id=1,.quantity=qty_None,.argument=arg_X}, {.id=2,.quantity=qty_Many,.argument=arg_Z} }; action_t current_actions2[] = {{.id=1,.quantity=qty_Some,.argument=arg_Y}};\n\n\n        return 0;\n    }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 599, "user_id": 2289030, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6dce60b9c9d6ff1f7852d2e553b70648?s=128&d=identicon&r=PG", "display_name": "ijustlovemath", "link": "https://stackoverflow.com/users/2289030/ijustlovemath"}, "edited": false, "score": 0, "creation_date": 1547052360, "post_id": 54114752, "comment_id": 95062218, "body": "Ah, I didn&#39;t think to consider the commas within the initializer being the problem. Also, sorry for conflating initializers with literals, I thought a literal was just a constant for a given type and the two were equivalent."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 599, "user_id": 2289030, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6dce60b9c9d6ff1f7852d2e553b70648?s=128&d=identicon&r=PG", "display_name": "ijustlovemath", "link": "https://stackoverflow.com/users/2289030/ijustlovemath"}, "edited": false, "score": 1, "creation_date": 1547052576, "post_id": 54114752, "comment_id": 95062337, "body": "@ijustlovemath, as long as I&#39;m being pedantic, a literal <i>is</i> reasonably described as a constant of a given type (though the standard has a more restrictive definition of &quot;constant&quot;).  But array and struct initializers are not literals, and initialization is not assignment."}, {"owner": {"reputation": 599, "user_id": 2289030, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6dce60b9c9d6ff1f7852d2e553b70648?s=128&d=identicon&r=PG", "display_name": "ijustlovemath", "link": "https://stackoverflow.com/users/2289030/ijustlovemath"}, "edited": false, "score": 0, "creation_date": 1547052685, "post_id": 54114752, "comment_id": 95062405, "body": "Re: your edit. This code is just a toy example of the real code, in which the equivalent of the <code>CHANGES</code> macro is used all over the place. This code is used to automatically generate the control logic of an old-school knowledge-based system, which is essentially a series of hundreds of similarly structured if-then statements. We also want to know properties of these statements in a sort of reflection, which the macros assist in generating."}, {"owner": {"reputation": 599, "user_id": 2289030, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6dce60b9c9d6ff1f7852d2e553b70648?s=128&d=identicon&r=PG", "display_name": "ijustlovemath", "link": "https://stackoverflow.com/users/2289030/ijustlovemath"}, "edited": false, "score": 0, "creation_date": 1547053071, "post_id": 54114752, "comment_id": 95062631, "body": "Also, thank you for the pedantry, I hope that future people who come across this answer will learn something about terminology, as I have!"}, {"owner": {"reputation": 599, "user_id": 2289030, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6dce60b9c9d6ff1f7852d2e553b70648?s=128&d=identicon&r=PG", "display_name": "ijustlovemath", "link": "https://stackoverflow.com/users/2289030/ijustlovemath"}, "edited": false, "score": 0, "creation_date": 1547059083, "post_id": 54114752, "comment_id": 95065497, "body": "I ended up using this answer, as it allowed me to have multiple array initializers in my X macro."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 3, "last_activity_date": 1547052500, "last_edit_date": 1547052500, "creation_date": 1547052213, "answer_id": 54114752, "question_id": 54113753, "link": "https://stackoverflow.com/questions/54113753/how-to-create-an-array-literal-of-struct-literals-in-c/54114752#54114752", "title": "How to create an array literal of struct literals in C?", "body": "<p>There is no such thing as \"an array of struct literals\", whether a literal itself or not.  The elements of an array can be structs, and you can use struct literals to initialize elements of an array of structs (yuck), including in an array literal, but the elements of the array are not themselves literals.  This may sound -- indeed, may <em>be</em> -- pedantic, but using consistent and correct terminology improves clarity of thought and of communication.</p>\n\n<p>In fact, you are not using struct literals or array literals at all.  You are simply using struct <em>initializers</em> inside an initializer for an array of structs.  This simplifies the issue a bit already.</p>\n\n<p>The first problem with your code is the parentheses you placed in the definition of macro <code>CHANGE</code>, around the array initializers.  These are part of the second argument to each invocation of the <code>CHANGE</code> macro, and as such, they are emitted as part of the replacement text of macro <code>CHANGES</code>.  But they are not part of the the allowed syntax for initializers, so the resulting code is invalid.</p>\n\n<p>I presume that the parentheses are there in the first place to avoid the commas inside the initializers being interpreted as separating macro arguments.  An alternative way to solve that problem, atleast in this case, would be to make your definition of the <code>CHANGE</code> macro variadic:</p>\n\n<pre><code>#define CHANGE(change_id, ...) \\\n    action_t current_actions ## change_id[] = __VA_ARGS__;\n</code></pre>\n\n<p>This solves the problem for me, using the standard form of variadic macros as introduced in C99.</p>\n\n<p>Another, more structured alternative would be to add macros for the struct initializers, so that the commas within and between do not affect macro argument identification.  For example,</p>\n\n<pre><code>#define FIRST_ACTION(i,q,a) {.id=i,.quantity=q,.argument=a}\n#define ACTION(i,q,a) ,FIRST_ACTION(i,q,a)\n\n#define CHANGES \\\nCHANGE(1, {\\\n    FIRST_ACTION(1,qty_None,arg_X)\\\n    ACTION(2,qty_Many,arg_Z)\\\n})\\\nCHANGE(2, {\\\n    FIRST_ACTION(1,qty_Some,arg_Y)\\\n})\n\n// ...\n\n#define CHANGE(change_id, actions) \\\n    action_t current_actions ## change_id[] = actions;\n\n    CHANGES\n</code></pre>\n\n<p>Of course, all this supposes that there is some good value to be obtained from the X macro approach in your case.  That requires at minimum that there be another use of the <code>CHANGES</code> macro elsewhere in your code.  None such is evident in what you present, but that could have been omitted.  It's not immediately clear to me, however, that your particular <code>CHANGES</code> macro affords additional uses that would not be better served by a different approach.</p>\n"}], "owner": {"reputation": 599, "user_id": 2289030, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6dce60b9c9d6ff1f7852d2e553b70648?s=128&d=identicon&r=PG", "display_name": "ijustlovemath", "link": "https://stackoverflow.com/users/2289030/ijustlovemath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 336, "favorite_count": 0, "accepted_answer_id": 54114752, "answer_count": 2, "score": 1, "last_activity_date": 1547052804, "creation_date": 1547048960, "last_edit_date": 1547052804, "question_id": 54113753, "link": "https://stackoverflow.com/questions/54113753/how-to-create-an-array-literal-of-struct-literals-in-c", "title": "How to create an array literal of struct literals in C?", "body": "<p>My goal is to automatically generate the control logic of an old-school knowledge-based system, which is essentially a series of hundreds of similarly structured if-then statements. We also want to know properties of these statements in a sort of reflection, which the array literals assist in generating.</p>\n\n<p>I've reviewed many of the answers here on SO, but most of them are in regards to arrays of string literals, which is not what I'm trying to accomplish.</p>\n\n<p>I'm trying to make an X-macro which contains as one of its parameters an array of struct literals that can be used to initialize a stack-allocated array variable.</p>\n\n<p>Here's some code that doesn't compile that shows my attempt:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\ntypedef enum qty_t {\n    qty_None, qty_Some, qty_Many    \n} qty_t;\n\ntypedef enum arg_t {\n    arg_X, arg_Y, arg_Z\n} arg_t;\n\ntypedef struct action_t {\n    int id;\n    qty_t quantity;\n    arg_t argument;\n} action_t;\n\n/* a change is a sequence of actions, and a change identifier */\n/* the outermost {} are the array, the inner ones being the structs */\n#define CHANGES \\\nCHANGE(1, ({{.id=1,.quantity=qty_None,.argument=arg_X}, \\\n            {.id=2,.quantity=qty_Many,.argument=arg_Z}\\\n            }\\\n        )\\\n    )\\\nCHANGE(2, ({{1,qty_Some,arg_Y}}))\n\nint main(void) {\n    // your code goes here\n#define CHANGE(change_id, actions) \\\n    action_t current_actions ## change_id[] = actions;\n\n    CHANGES\n\n#undef CHANGE\n    return 0;\n}\n</code></pre>\n\n<p>How do I put an array literal of struct literals inside the CHANGE macro, specifically one that can be used to initialize the current_actions1 variable?</p>\n"}, {"tags": ["c++", "c", "visual-c++"], "comments": [{"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 1, "creation_date": 1547044530, "post_id": 54112438, "comment_id": 95057133, "body": "I would remove the <code>typedef U8 BOOL</code> definition. The <code>#ifndef</code> macro doesn&#39;t protect against typedef."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 5, "creation_date": 1547044618, "post_id": 54112438, "comment_id": 95057196, "body": "As a newbie in <i>both</i> C and C++, you should take to take to heart right now an important lesson: C and C++ are <b><i>different languages</i></b>.  There is no &quot;C/C++&quot;.  Random code written in either language cannot be assumed to have the same semantics in the other, and may not even compile in the other.  Writing code that has the same semantics in both languages is tricky."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1547044663, "post_id": 54112438, "comment_id": 95057224, "body": "@Jean-Fran&#231;oisFabre I don&#39;t think it&#39;s intended to. It&#39;s adding a new type alias in the case that a macro hasn&#39;t already done that job. Unfortunately some other type alias has also already done that job in this case."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 3, "creation_date": 1547044718, "post_id": 54112438, "comment_id": 95057264, "body": "This seems to be more about compat between your old library and Windows&#39;s headers, than it is about C or C++ in particular."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1547045137, "post_id": 54112438, "comment_id": 95057528, "body": "Remove that whole code and replace it with <code>#include &lt;stdint.h&gt;</code> and <code>#include &lt;windows.h&gt;</code>. Done."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1547045158, "post_id": 54112438, "comment_id": 95057539, "body": "You say you have &quot;cloned an <b><i>older</i></b> protocol stack solution&quot; (emphasis mine). Is it possible to get a <i>newer</i> version of that library, that have fixed Windows compatibility? Or perhaps find some other library that works on Windows?"}, {"owner": {"reputation": 3140, "user_id": 1624844, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/SXXv0.png?s=128&g=1", "display_name": "Amir-Mousavi", "link": "https://stackoverflow.com/users/1624844/amir-mousavi"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547045383, "post_id": 54112438, "comment_id": 95057705, "body": "@Someprogrammerdude bad usage of adj. :) and old (a legacy stack) which I am going to make a plugin and use that stack as the core. there is only one version of that"}], "answers": [{"comments": [{"owner": {"reputation": 3140, "user_id": 1624844, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/SXXv0.png?s=128&g=1", "display_name": "Amir-Mousavi", "link": "https://stackoverflow.com/users/1624844/amir-mousavi"}, "edited": false, "score": 0, "creation_date": 1547045537, "post_id": 54112581, "comment_id": 95057820, "body": "Thanks a lot, for the answer, I saw your comment in another answer which writer deleted it :("}, {"owner": {"reputation": 3140, "user_id": 1624844, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/SXXv0.png?s=128&g=1", "display_name": "Amir-Mousavi", "link": "https://stackoverflow.com/users/1624844/amir-mousavi"}, "edited": false, "score": 0, "creation_date": 1547045620, "post_id": 54112581, "comment_id": 95057888, "body": "That project is an old protocol stack implementing deferent layers of an standard (namely J1939 standard) no I want to use that stack and create plugin for a more modern tool."}], "tags": [], "owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "is_accepted": false, "score": 5, "last_activity_date": 1547044851, "creation_date": 1547044851, "answer_id": 54112581, "question_id": 54112438, "link": "https://stackoverflow.com/questions/54112438/bool-redefinition-after-including-minwindef-h/54112581#54112581", "title": "BOOL redefinition after including minwindef.h", "body": "<p>I don't know anything about the library you're trying to work with, because you did not tell us what it is. But I can make some guesses:</p>\n\n<ol>\n<li>The code did not used to interface with Windows code at all;</li>\n<li>By creating a Windows C++ application you have added Windows dependencies;</li>\n<li>The Windows dependencies (well-known for poisoning the namespace with short names like <code>BOOL</code>) are conflicting with the library's code (which is doing the same thing with its <code>BOOL</code> macro, when defined, and its <code>BOOL</code> type alias, otherwise).</li>\n</ol>\n\n<p>This isn't really to do with C vs C++ or anything like this, and there's no general fix you can make. You can either try to get rid of the Windows dependency (do you need that header for your task?) or you can patch your library not to touch <code>BOOL</code> (after making sure that Windows's <code>BOOL</code> is what you need it to be).</p>\n\n<p>And use this as a good lesson not to pollute namespaces!</p>\n"}], "owner": {"reputation": 3140, "user_id": 1624844, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/SXXv0.png?s=128&g=1", "display_name": "Amir-Mousavi", "link": "https://stackoverflow.com/users/1624844/amir-mousavi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 837, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1547045021, "creation_date": 1547044377, "last_edit_date": 1547045021, "question_id": 54112438, "link": "https://stackoverflow.com/questions/54112438/bool-redefinition-after-including-minwindef-h", "title": "BOOL redefinition after including minwindef.h", "body": "<p>I am a newbie in C/C++, just in case :)\nI have cloned an older protocol stack solution written in C with one main class in C++ imported it into VS \n(<em>Visual C++ 2017 v 15.9.5 targeting Windows SDK 10.0.17134.0</em>) it compiled correctly and working.</p>\n\n<p>Now made a C++ solution (windows console application) created a folder <code>lib</code> copy pasted all those <code>.h</code> and <code>.c</code> files into <code>lib</code> added the path to <code>additional include directories</code> and also in linker <code>additional library directories</code>.</p>\n\n<p>Building the Solution throwing tones of errors. the one I am trying to fix now is:</p>\n\n<p>One of the header files contains type definitions </p>\n\n<pre><code>typedef uint8_t U8;\n#ifndef BOOL\ntypedef U8 BOOL;\n#endif\n</code></pre>\n\n<p>but this is conflicting with <code>minwindef.h</code> from windows kit. though I <code>#include types.h</code> getting <code>C2371 'BOOL': redefinition; different basic types</code>\nin the whole solution, I want to use this definition of <code>BOOL</code> and all other ones defined in this header. </p>\n\n<p>How should I solve the issue? Or in General in case of using C codes in C++ projects what settings and MACRO (e.g. extern \"C\" in methods) should I follow</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 2289, "user_id": 2356414, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dff4a2241e2dcfc50615e4b7c709bd17?s=128&d=identicon&r=PG", "display_name": "KABoissonneault", "link": "https://stackoverflow.com/users/2356414/kaboissonneault"}, "edited": false, "score": 0, "creation_date": 1547044156, "post_id": 54112287, "comment_id": 95056867, "body": "What&#39;s the output you get?"}, {"owner": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 0, "creation_date": 1547044328, "post_id": 54112287, "comment_id": 95056986, "body": "Are you sure <code>getw</code> is the right function to use? Your example data doesn&#39;t look like a binary file"}, {"owner": {"reputation": 16761, "user_id": 1454708, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eSzgk.png?s=128&g=1", "display_name": "Nahuel Fouilleul", "link": "https://stackoverflow.com/users/1454708/nahuel-fouilleul"}, "edited": false, "score": 0, "creation_date": 1547044420, "post_id": 54112287, "comment_id": 95057040, "body": "<code>getw</code> reads a word (int) and printf converts it to string representing the number <code>od -An -tu4 &lt; file1.txt</code> should give similar output, also this dump command <code>od -c -x -tu4 &lt;file1.txt</code> may help"}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 9717256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6bac9753a5a8cb10667f063cd9af653?s=128&d=identicon&r=PG&f=1", "display_name": "Maria", "link": "https://stackoverflow.com/users/9717256/maria"}, "edited": false, "score": 0, "creation_date": 1547045410, "post_id": 54112474, "comment_id": 95057730, "body": "Yh that works now, i had it commented as well but i didnt know you needed &quot;==1&quot;, in order now to move the prime numbers to another text file i should include the code below this while statements right?"}, {"owner": {"reputation": 2026, "user_id": 1406083, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1gC8p.jpg?s=128&g=1", "display_name": "Billy Brown", "link": "https://stackoverflow.com/users/1406083/billy-brown"}, "reply_to_user": {"reputation": 51, "user_id": 9717256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6bac9753a5a8cb10667f063cd9af653?s=128&d=identicon&r=PG&f=1", "display_name": "Maria", "link": "https://stackoverflow.com/users/9717256/maria"}, "edited": false, "score": 0, "creation_date": 1547046316, "post_id": 54112474, "comment_id": 95058361, "body": "@Maria Inside the <code>while</code> loop, you check if the integer is prime and then you write it to the file with <code>fprintf(out_file, &quot;%d\\n&quot;, num)</code> (I will edit my answer with this)."}], "tags": [], "owner": {"reputation": 2026, "user_id": 1406083, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1gC8p.jpg?s=128&g=1", "display_name": "Billy Brown", "link": "https://stackoverflow.com/users/1406083/billy-brown"}, "is_accepted": true, "score": 4, "last_activity_date": 1547046529, "last_edit_date": 1547046529, "creation_date": 1547044525, "answer_id": 54112474, "question_id": 54112287, "link": "https://stackoverflow.com/questions/54112287/read-problems-using-getw/54112474#54112474", "title": "Read problems using getw()", "body": "<p>The <code>int getw(FILE *)</code> function is for reading an integer directly from the bytes of a file, not for reading an integer from the textual contents of a file.</p>\n\n<p>If you wish to read integers from a file, one by one, use <code>fscanf</code> instead:</p>\n\n<pre><code>FILE *in_file = fopen(\"file1.txt\", \"r\");\nFILE *out_file = fopen(\"file2.txt\", \"w\");\nint num;\nwhile (fscanf(in_file, \"%d\", &amp;num) == 1) {\n    if (is_prime(num)) {\n        fprintf(out_file, \"%d\\n\", num);\n    }\n}\nfclose(in_file);\nfclose(out_file);\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 9717256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6bac9753a5a8cb10667f063cd9af653?s=128&d=identicon&r=PG&f=1", "display_name": "Maria", "link": "https://stackoverflow.com/users/9717256/maria"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 54112474, "answer_count": 1, "score": -1, "last_activity_date": 1547166740, "creation_date": 1547043940, "last_edit_date": 1547166740, "question_id": 54112287, "link": "https://stackoverflow.com/questions/54112287/read-problems-using-getw", "title": "Read problems using getw()", "body": "<p>so I'm working on this program that read from a text file which is filled with non prime and prime numbers, so it first reads all the numbers from one text file and then it outputs only the prime numbers to another text file.</p>\n\n<p>Let say one text file has:</p>\n\n<pre><code>233\n179\n178\n199\n198\n157\n</code></pre>\n\n<p>On the second it should print or copy:</p>\n\n<pre><code>233\n179\n199\n157\n</code></pre>\n\n<p>So far I have worked on the following code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    FILE *in_file;\n    int numbers;\n\n    in_file = fopen(\"file1.txt\", \"r\");\n\n    while ( fscanf(in_file, \"%d\", &amp;numbers) == 1) {\n            printf(\"%d\\n\", numbers);\n        }\n        fclose(in_file);\n    }\n    return 0;\n}\n</code></pre>\n\n<p>The problem with the above code is that the reads are wrong, the output to the screen is not the same as in file1, and I'm not sure whether is to do with the getw() function or somewhere else in the code?</p>\n"}, {"tags": ["c++", "c", "visual-studio-2010", "security", "secure-coding"], "comments": [{"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1547043792, "post_id": 54112179, "comment_id": 95056607, "body": "I would remove the <code>c++</code> tag from this question. I believe the _s versions are non standard Microsoft additions however I am a <code>c++</code> programmer and never ever use these."}, {"owner": {"reputation": 213, "user_id": 5623335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e00e0647a5095f7b474c5b524828918d?s=128&d=identicon&r=PG&f=1", "display_name": "securityauditor", "link": "https://stackoverflow.com/users/5623335/securityauditor"}, "reply_to_user": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1547043951, "post_id": 54112179, "comment_id": 95056715, "body": "Why remove the C++ tag since I sometimes code in C++, or is it these secure versions only exist for C?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 3, "creation_date": 1547044035, "post_id": 54112179, "comment_id": 95056773, "body": "@securityauditor Because tags should describe what the question is about."}, {"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 1, "creation_date": 1547044115, "post_id": 54112179, "comment_id": 95056827, "body": "They exist in <code>c++</code> but <code>c++</code> has better ways of using strings in the standard library."}, {"owner": {"reputation": 213, "user_id": 5623335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e00e0647a5095f7b474c5b524828918d?s=128&d=identicon&r=PG&f=1", "display_name": "securityauditor", "link": "https://stackoverflow.com/users/5623335/securityauditor"}, "edited": false, "score": 0, "creation_date": 1547044195, "post_id": 54112179, "comment_id": 95056895, "body": "Lundin Well it&#39;s about using C and C++ with the standard library which is what my code bases use. I do not want to update each one to then not be able to execute them on our old legacy Win 2000 etc... computers!"}, {"owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 1, "creation_date": 1547044408, "post_id": 54112179, "comment_id": 95057036, "body": "Personally I feel it is debatable if these functions add any real security. Also, generally in <code>C++</code> code, you would not be handling raw buffers that do not know their length. That&#39;s one of the main benefits of OO."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 1, "creation_date": 1547045590, "post_id": 54112179, "comment_id": 95057859, "body": "&quot;If we write code for Windows I do not mind if it&#39;s not portable to Linux&quot; - I&#39;d caution against that unless it&#39;s purely Win32 gui / api stuff."}], "answers": [{"comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547044428, "post_id": 54112419, "comment_id": 95057050, "body": "Buffer overrun has plenty to do with security. Do you know how many vulnerabilities are exploitable through buffer overruns?"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547044477, "post_id": 54112419, "comment_id": 95057093, "body": "Granted, there are other ways to avoid such a bug and fix that security problem ;)"}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547044518, "post_id": 54112419, "comment_id": 95057117, "body": "@LightnessRacesinOrbit: Yup, I had a warped childhood and had a lot of fun on the exploiting side ;-) &quot;atdt&quot; still rings in my lugholes."}, {"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1547044611, "post_id": 54112419, "comment_id": 95057194, "body": "<code>strncpy</code> is <b>not</b> acceptable substitute when speaking about protecting against buffer overruns."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547044702, "post_id": 54112419, "comment_id": 95057243, "body": "@LightnessRacesinOrbit <code>strcpy</code> has nothing to do with buffer overruns. To protect against buffer overruns, you verify the data <i>before</i> you copy."}, {"owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1547044854, "post_id": 54112419, "comment_id": 95057353, "body": "@LightnessRacesinOrbit Adding a length parameter does not guarantee you won&#39;t overrun a buffer. It gives you additional code-sites where you have to make the same change when you come to maintain the code and more chances for error if you forget one imo. It is a choice between getting the code correct in one place (the caller) or trying to get the code right every time you use a function (in the callee)."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 0, "creation_date": 1547045133, "post_id": 54112419, "comment_id": 95057524, "body": "@Galik Maybe. There&#39;s ways to minimise that risk to the point that it&#39;s better than the risk of having no length checking at all. IMO those ways are numerous and easy when compared to the ghastly alternative. But YMMV"}], "tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": false, "score": 4, "last_activity_date": 1547044301, "creation_date": 1547044301, "answer_id": 54112419, "question_id": 54112179, "link": "https://stackoverflow.com/questions/54112179/backwards-compatibility-and-secure-versions-of-functions/54112419#54112419", "title": "Backwards compatibility and secure versions of functions", "body": "<p>Avoid <code>strcpy_s()</code> if you want to write <em>portable</em> C (or C++) as it's a non-standard function.</p>\n\n<p><code>strncpy()</code> is the standard way of copying up to a certain number of characters, and can help guard against buffer overrun for which the term \"security\" is abused.</p>\n\n<p>There's nothing wrong with using <code>strcpy</code> so long as you know what you're doing. Much of this sentiment applies to C in general: its power is in its simplicity and minimal run-time checking.</p>\n"}, {"comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 1, "creation_date": 1547044882, "post_id": 54112505, "comment_id": 95057376, "body": "Upped; nice and sensible."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1547045086, "post_id": 54112505, "comment_id": 95057492, "body": "UV warranted by &quot;the new library was a fiasco&quot; alone."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1547136645, "post_id": 54112505, "comment_id": 95096713, "body": "Indeed.  <a href=\"http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1967.htm\" rel=\"nofollow noreferrer\"><b>Field Experience With Annex K \u2014 Bounds Checking Interfaces</b></a>:  &quot;Microsoft Visual Studio implements an early version of the APIs. However, the implementation is incomplete and conforms neither to C11 nor to the original TR 24731-1. ...  As a result of the numerous deviations from the specification the Microsoft implementation cannot be considered conforming or portable.&quot;"}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 8, "last_activity_date": 1547044621, "creation_date": 1547044621, "answer_id": 54112505, "question_id": 54112179, "link": "https://stackoverflow.com/questions/54112179/backwards-compatibility-and-secure-versions-of-functions/54112505#54112505", "title": "Backwards compatibility and secure versions of functions", "body": "<p><code>strcpy</code> is perfectly safe, see <a href=\"https://stackoverflow.com/a/23490019/584518\">this</a>.</p>\n\n<p><code>strcpy_s</code> was only standardized as late as 2011 in the C11 optional bounds-checking interface. It is not supported by many compilers at all - the new library was a fiasco.</p>\n\n<p>Microsoft non-standard libraries are only partially compatible with the standardized bounds-checking interface. In some cases they don't follow the standard but have the same function name.</p>\n\n<p>Thus functions ending with <code>_s</code> are generally <em>unsafe</em>, since both standard and non-standard versions exists and are not necessarily compatible. They are certainly not portable.</p>\n\n<p>My advise is to avoid the following entirely:</p>\n\n<ul>\n<li>The C11 bounds-checking interface.</li>\n<li>Any function ending with <code>_s</code>.</li>\n<li>Visual Studio for the purpose of compiling C code.</li>\n</ul>\n\n<p>Instead use the safe and portable function <code>strcpy</code> which has been standardized and documented for over 30 years. Together with this, you should use an ISO C standard compliant compiler.</p>\n"}, {"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 3, "last_activity_date": 1547133268, "last_edit_date": 1547133268, "creation_date": 1547046747, "answer_id": 54113148, "question_id": 54112179, "link": "https://stackoverflow.com/questions/54112179/backwards-compatibility-and-secure-versions-of-functions/54113148#54113148", "title": "Backwards compatibility and secure versions of functions", "body": "<blockquote>\n  <p>My question is if I use the newer secure version will I still be able\n  to execute my programs on older versions of Windows, for example\n  Windows 95? Due to requirements we can only have a single executable\n  file.</p>\n</blockquote>\n\n<p>The <code>_s</code> versions are not \"secure\", whether you're talking about Microsoft's implementations or implementations conforming to the actual standard.  They do incorporate mechanisms intended to help avoid or mitigate certain programming errors that have security implications, but the effectiveness of those is limited.</p>\n\n<p>But with respect to whether they will be supported on very old Windows versions, no, not by default.  The _s functions did not exist during Windows 95's lifetime, so versions of the C runtime library distributed with that version of Windows do not support them.  It is relatively common, however, for Windows applications to be packaged with a version of the MS C runtime library that supports their needs.  It may be that you can take that route, but I cannot speak to whether there is any version of the MS C runtime that supports all Windows versions from the past 24 years and contains the _s functions.</p>\n\n<p>Your best bet is to limit yourself to functions from the C90 standard library, WinAPI functions supported across all targeted Windows versions, and functions provided by your application itself and any third-party libraries distributed with it (which themselves should comply with the same limitations).  Or you could consider limiting support to fewer versions of Windows.  Microsoft itself has not supported Windows 95 for 18 years.</p>\n"}], "owner": {"reputation": 213, "user_id": 5623335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e00e0647a5095f7b474c5b524828918d?s=128&d=identicon&r=PG&f=1", "display_name": "securityauditor", "link": "https://stackoverflow.com/users/5623335/securityauditor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 54113148, "answer_count": 3, "score": 0, "last_activity_date": 1547133268, "creation_date": 1547043534, "last_edit_date": 1547045423, "question_id": 54112179, "link": "https://stackoverflow.com/questions/54112179/backwards-compatibility-and-secure-versions-of-functions", "title": "Backwards compatibility and secure versions of functions", "body": "<p>I am writing some programs in C (rarely C++). Normally they are simple, but often they can get larger. </p>\n\n<p>I am looking to learn more about using the secure versions of functions, for example <code>strcpy()</code> is insecure and <code>strcpy_s()</code> is Microsoft's new secure version of that function.</p>\n\n<p>I normally use Visual Studio 2010 when coding for Windows <strong>* I removed part about Linux - focus on Windows only*</strong></p>\n\n<p>My question is if I use the newer secure version will I still be able to execute my programs on older versions of Windows, for example Windows 95? Due to requirements we can only have a single executable file.</p>\n\n<p>Thank you.</p>\n\n<p><strong>EDIT:</strong>\nSorry this just appeared in my mind now - ignore the Linux part above. If we write code for Windows I do not mind if it's not portable to Linux, I only care if it still works on older versions of Windows.</p>\n"}, {"tags": ["c++", "c", "linux", "ioctl", "block-device"], "comments": [{"owner": {"reputation": 2999, "user_id": 7520531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0107497596782a18d4a853214a883546?s=128&d=identicon&r=PG&f=1", "display_name": "Jose", "link": "https://stackoverflow.com/users/7520531/jose"}, "edited": false, "score": 1, "creation_date": 1547043406, "post_id": 54112087, "comment_id": 95056358, "body": "Are you looking for something beyond the return value (errno)? <a href=\"http://man7.org/linux/man-pages/man2/lseek.2.html\" rel=\"nofollow noreferrer\">man7.org/linux/man-pages/man2/lseek.2.html</a>"}, {"owner": {"reputation": 2257, "user_id": 1530018, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/bcbc00a1cd813900aedb1eebd7113d90?s=128&d=identicon&r=PG&f=1", "display_name": "kreuzerkrieg", "link": "https://stackoverflow.com/users/1530018/kreuzerkrieg"}, "reply_to_user": {"reputation": 2999, "user_id": 7520531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0107497596782a18d4a853214a883546?s=128&d=identicon&r=PG&f=1", "display_name": "Jose", "link": "https://stackoverflow.com/users/7520531/jose"}, "edited": false, "score": 0, "creation_date": 1547043541, "post_id": 54112087, "comment_id": 95056444, "body": "Sure, errno is equal to EIO, like here <a href=\"http://man7.org/linux/man-pages/man2/read.2.html\" rel=\"nofollow noreferrer\">man7.org/linux/man-pages/man2/read.2.html</a> Then what?"}, {"owner": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "edited": false, "score": 2, "creation_date": 1547045229, "post_id": 54112087, "comment_id": 95057592, "body": "@kreuzerkrieg I don&#39;t believe there is a way to do that. You should just check kernel logs. Also check <a href=\"https://yarchive.net/comp/linux/block_device_error_handling.html\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 2257, "user_id": 1530018, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/bcbc00a1cd813900aedb1eebd7113d90?s=128&d=identicon&r=PG&f=1", "display_name": "kreuzerkrieg", "link": "https://stackoverflow.com/users/1530018/kreuzerkrieg"}, "edited": false, "score": 0, "creation_date": 1547046684, "post_id": 54112087, "comment_id": 95058607, "body": "According to your link, looks like dead end... I guess nothing changed in the last decade and half :("}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 1, "creation_date": 1547048422, "post_id": 54112087, "comment_id": 95059684, "body": "File reads and writes are not 1:1 with device reads and writes due to logical volumes, write-back and readahead.  You would have to look for errors logged by the underlying kernel.  It will never be available to the user-space program."}], "answers": [{"comments": [{"owner": {"reputation": 2257, "user_id": 1530018, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/bcbc00a1cd813900aedb1eebd7113d90?s=128&d=identicon&r=PG&f=1", "display_name": "kreuzerkrieg", "link": "https://stackoverflow.com/users/1530018/kreuzerkrieg"}, "edited": false, "score": 0, "creation_date": 1547106855, "post_id": 54118314, "comment_id": 95079596, "body": "This is what I have right now, I wish to abandon the sg stuff, which does not work with NVMe, and switch to something more generic. As I understand there is no such a thing, so I would just drop work with block devices and switch to usermode NVMe (using SPDK)"}], "tags": [], "owner": {"reputation": 2626, "user_id": 300290, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wI1od.png?s=128&g=1", "display_name": "Mike Andrews", "link": "https://stackoverflow.com/users/300290/mike-andrews"}, "is_accepted": true, "score": 2, "last_activity_date": 1547067761, "creation_date": 1547067761, "answer_id": 54118314, "question_id": 54112087, "link": "https://stackoverflow.com/questions/54112087/how-to-retrieve-underlying-block-device-io-error/54118314#54118314", "title": "How to retrieve underlying block device IO error", "body": "<p>You can't get any more error detail out of the POSIX functions.  You're onto the right track with the SCSI generic stuff though.  But, boy, it's loaded with hair.  Check out the example in sg3_utils of how to do a SCSI READ(16).  This will let you look at the sense data when it comes back: </p>\n\n<p><a href=\"https://github.com/hreinecke/sg3_utils/blob/master/examples/sg_simple16.c\" rel=\"nofollow noreferrer\">https://github.com/hreinecke/sg3_utils/blob/master/examples/sg_simple16.c</a></p>\n\n<p>Of course, this technique doesn't work with NVMe drives.  (At least, not to my knowledge).</p>\n\n<p>One concept I've played with in the past is to use normal POSIX/libc block I/O functions like <code>pread</code> and <code>pwrite</code> until I get an EIO out.  At that point, you can bring in the SCSI-generic versions to try to figure out what happened.  In the ideal case, a <code>pread</code> or <code>lseek/read</code> fails with EIO.  You then turn around and re-issue it using a SG READ (10) or (16).  If it's not just a transient failure, this may return sense data that your application can use.</p>\n\n<p>Here's an example, using the command-line sg_read program.  I have an iSCSI attached disk that I'm reading and writing.  On the target, I remove its LUN mapping.  <code>dd</code> reports EIO:</p>\n\n<pre><code># dd if=/dev/sdb of=/tmp/output bs=512 count=1 iflag=direct\ndd: error reading \u2018/dev/sdb\u2019: Input/output error\n</code></pre>\n\n<p>but <code>sg_read</code> reports some more useful information:</p>\n\n<pre><code>[root@localhost src]# sg_read blk_sgio=1 bs=512 cdbsz=10 count=512 if=/dev/sdb odir=1 verbose=10\nOpened /dev/sdb for SG_IO with flags=0x4002\n    read cdb: 28 00 00 00 00 00 00 00 80 00\n      duration=9 ms\nreading: SCSI status: Check Condition\n Fixed format, current;  Sense key: Illegal Request\n Additional sense: Logical unit not supported\n Raw sense data (in hex):\n        70 00 05 00 00 00 00 0a  00 00 00 00 25 00 00 00\n        00 00\nsg_read: SCSI READ failed\nSome error occurred,  remaining block count=512\n0+0 records in\n</code></pre>\n\n<p>You can see the <code>Logical unit not supported</code> additional sense code in the above output, indicating that there's no such LU at the target.  </p>\n\n<p>Possible?  Yes.  But as you can see from the code in <code>sg_simple16.c</code>, it's not easy!</p>\n"}], "owner": {"reputation": 2257, "user_id": 1530018, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/bcbc00a1cd813900aedb1eebd7113d90?s=128&d=identicon&r=PG&f=1", "display_name": "kreuzerkrieg", "link": "https://stackoverflow.com/users/1530018/kreuzerkrieg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 0, "accepted_answer_id": 54118314, "answer_count": 1, "score": 2, "last_activity_date": 1547067761, "creation_date": 1547043175, "last_edit_date": 1547047488, "question_id": 54112087, "link": "https://stackoverflow.com/questions/54112087/how-to-retrieve-underlying-block-device-io-error", "title": "How to retrieve underlying block device IO error", "body": "<p>Consider a device in the system, something under /dev/hdd[sg][nvme]xx\nOpen the device, get the file descriptor and start working with it (<code>read(v)</code>/<code>write(v)</code>/<code>lseek</code>, etc), at some point you may get <code>EIO</code>. How do you retrieve the underlying error reported by the device driver?</p>\n\n<p>EDIT001: in case it is impossible using <code>unistd</code> functions, maybe there is other ways to work with block devices which can provide more low-level information like <code>sg_scsi_sense_hdr</code>?</p>\n"}, {"tags": ["c", "autocomplete", "codeblocks"], "comments": [{"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1547040767, "post_id": 54111210, "comment_id": 95054786, "body": "Check in  <code>&#47;Settings&#47;Editor&#47;General Settings&#47;</code> if <code>Code Completion</code> is Checked."}, {"owner": {"reputation": 11, "user_id": 10530951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efa4ce82dbe184932f79de7804fafb36?s=128&d=identicon&r=PG&f=1", "display_name": "MMFire", "link": "https://stackoverflow.com/users/10530951/mmfire"}, "reply_to_user": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1547041207, "post_id": 54111210, "comment_id": 95055028, "body": "Yes the setting is ok <a href=\"https://cdn1.imggmi.com/uploads/2019/1/9/2e6d06e1f74ca1a7522a875553c3779a-full.png\" rel=\"nofollow noreferrer\">cdn1.imggmi.com/uploads/2019/1/9/&hellip;</a>"}], "owner": {"reputation": 11, "user_id": 10530951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efa4ce82dbe184932f79de7804fafb36?s=128&d=identicon&r=PG&f=1", "display_name": "MMFire", "link": "https://stackoverflow.com/users/10530951/mmfire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 455, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547040290, "creation_date": 1547040290, "question_id": 54111210, "link": "https://stackoverflow.com/questions/54111210/code-blocks-autocomplete-for-c-functions-not-working", "title": "code blocks autocomplete for C functions not working", "body": "<p>like explained  <a href=\"https://stackoverflow.com/questions/36444091/codeblocks-autocomplete-calltips-not-working-for-c-standard-library-functions\">here</a></p>\n\n<p>I am using code blocks 13.12 mingw TDM-GCC and when I for example write <code>#include &lt;stdio.h&gt;</code> and then try to type printf, no suggestions would appear! What should I do?</p>\n\n<p>more explanation:</p>\n\n<p>I use .cpp for writing c but it doesn't make any difference when i use .c</p>\n\n<p>codecompletion works fine for C++ functions like cout and cin.</p>\n\n<p>It doesn't work for header files both for C and C++ (like stdio.h and iostream)</p>\n\n<p>after including stdio.h, when i type 'prin' there is no suggestion for printf</p>\n\n<p>It works fine for keywords like int or char</p>\n\n<p>autocomplete in 17.12 doesn't work, too. (I think this is not about code blocks version due to my next clue)</p>\n\n<p>In my university computers, they use the exact same code blocks but autocomplete completely works! so i wonder what i should have done! (both windows 10)</p>\n\n<p>for me, code blocks is installed in D:\\Programs\\CodeBlocks</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 2, "creation_date": 1547039300, "post_id": 54110868, "comment_id": 95053892, "body": "So your question is... how to forward a variable argument list to a function?"}, {"owner": {"reputation": 3126, "user_id": 2955790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vShcC.png?s=128&g=1", "display_name": "Duck Dodgers", "link": "https://stackoverflow.com/users/2955790/duck-dodgers"}, "edited": false, "score": 1, "creation_date": 1547039468, "post_id": 54110868, "comment_id": 95053995, "body": "<i>&quot;but anyway I&#39;d prefer to know how to include ellipsis (3 dots) in macro.&quot;</i> The answer to that is use inside the macro  <code>__VA_ARGS__</code>. And as parameter for the macro, you can pass the macro also <code>...</code>. So, <code>#define a(deb, str, ...) a_special(deb, __func__, str, __VA_ARGS__)</code>."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1547043730, "post_id": 54110868, "comment_id": 95056565, "body": "Some good C programming practice: 1) avoid variadic functions 2) avoid variadic macros 3) avoid function-like macros. Combining all these 3 cases of bad practice is not a brilliant idea."}], "answers": [{"tags": [], "owner": {"reputation": 3126, "user_id": 2955790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vShcC.png?s=128&g=1", "display_name": "Duck Dodgers", "link": "https://stackoverflow.com/users/2955790/duck-dodgers"}, "is_accepted": true, "score": 6, "last_activity_date": 1547039792, "creation_date": 1547039792, "answer_id": 54111040, "question_id": 54110868, "link": "https://stackoverflow.com/questions/54110868/how-to-get-caller-function-name-in-c-with-ellipsis-in-function-declaration/54111040#54111040", "title": "How to get caller function name in C with ellipsis in function declaration?", "body": "<p>If all you are asking for is how to forward the ellipses on to the macro and then from the macro to the function, then the following should be sufficient.</p>\n\n<p>Basically, you pass the macro also the ellipses <code>...</code> and inside the macro you can use <code>__VA_ARGS__</code>.</p>\n\n<pre><code>void a(int deb, char *str, ...)\n{\n    va_list args;\n    va_start(args,str);\n    vprintf(str,args);\n    va_end(args);\n}\n\nvoid a_special(int deb, char const * caller_name, char *str, ...)\n{\n    printf( \"[%d] blablabla [%s] \", deb, caller_name);\n    a(deb, str);\n}\n\n#define a(deb, str, ...) a_special(deb, __func__, str, __VA_ARGS__)\n\nint main()\n{\n    a(1, \"mylog %d %s\", 1, \"param2\");\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 2670, "user_id": 3351141, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q41J5.jpg?s=128&g=1", "display_name": "Alejandro Galera", "link": "https://stackoverflow.com/users/3351141/alejandro-galera"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 1, "accepted_answer_id": 54111040, "answer_count": 1, "score": 7, "last_activity_date": 1547115850, "creation_date": 1547039210, "last_edit_date": 1547039320, "question_id": 54110868, "link": "https://stackoverflow.com/questions/54110868/how-to-get-caller-function-name-in-c-with-ellipsis-in-function-declaration", "title": "How to get caller function name in C with ellipsis in function declaration?", "body": "<p>I'm trying to know in a function its caller name.</p>\n\n<p>If you look to the following link, it's not duplicated because I add a difference: the ellipsis usage in function declaration.</p>\n\n<p>I've tried to do, starting from this solution <a href=\"https://stackoverflow.com/questions/16100090/how-can-we-know-the-caller-functions-name\">How can we know the caller function's name?</a> to do that, but I cannot get the solution.</p>\n\n<p>This works to me:</p>\n\n<pre><code>void a(int deb, char *str)\n{\n    printf(\"%s\\n\", str);\n}\n\nvoid a_special(int deb, char const * caller_name, char *str)\n{\n    printf( \"[%d] blablabla [%s] \", deb, caller_name);\n    a(deb, str);\n}\n\n#define a(deb, str) a_special(deb, __func__, str)\n\nint main()\n{\n    a(1, \"my log\");\n    return 0;\n}\n</code></pre>\n\n<p>But when I add the ellipsis (I say: \"...\") <strong>I don't know how to achieve it</strong> with the macro definition. \nIs possible in standard-C?</p>\n\n<pre><code>void a(int deb, char *str, ...) \n{\n    va_list args;\n    va_start(args,str);\n    vprintf(str,args);\n    va_end(args);\n}\n\nvoid a_special(int deb, char const * caller_name, char *str, ...) \n{\n    printf( \"[%d] blablabla [%s] \", deb, caller_name);\n    a(deb, str, ...); \n}\n\n#define a(deb, str) a_special(deb, __func__, str)\n\nint main()\n{\n    a(1, \"mylog %d %s\", 1, \"param2\");\n    return 0; \n}\n</code></pre>\n\n<p>I've also tried to get it using backtrace compiling with -rdynamic without success, but anyway I'd prefer to know how to include ellipsis (3 dots) in macro.\nThanks in advance!</p>\n"}, {"tags": ["c", "sockets", "udp", "getaddrinfo"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1547038197, "post_id": 54110492, "comment_id": 95053174, "body": "You seem to have multiple problems, that really are unrelated to each other and should be asked as separate questions. Also please read about <a href=\"http://stackoverflow.com/help/how-to-ask\">how to ask good questions</a>, as well as <a href=\"https://codeblog.jonskeet.uk/2012/11/24/stack-overflow-question-checklist/\" rel=\"nofollow noreferrer\">this question checklist</a>. Lastly please edit your question to actually <i>include</i> the code, as well as the expected and actual output from it."}, {"owner": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "edited": false, "score": 1, "creation_date": 1547038774, "post_id": 54110492, "comment_id": 95053556, "body": "Aside from your server code, note that <code>netcat</code> assumes <code>TCP</code> by default.  You might want to try <code>netcat -u 127.0.0.1 9001</code> to force <code>UDP</code>."}, {"owner": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "reply_to_user": {"reputation": 9720, "user_id": 6371123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f90991c1b06c79ae4c6e79fb616d608?s=128&d=identicon&r=PG", "display_name": "G.M.", "link": "https://stackoverflow.com/users/6371123/g-m"}, "edited": false, "score": 0, "creation_date": 1547039887, "post_id": 54110492, "comment_id": 95054244, "body": "@G.M. That was it! Thank you!"}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 1, "creation_date": 1547054711, "post_id": 54110492, "comment_id": 95063545, "body": "You might like to have look here: <a href=\"https://stackoverflow.com/questions/3229860/what-is-the-meaning-of-so-reuseaddr-setsockopt-option-linux\" title=\"what is the meaning of so reuseaddr setsockopt option linux\">stackoverflow.com/questions/3229860/&hellip;</a>"}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 1, "creation_date": 1547054764, "post_id": 54110492, "comment_id": 95063570, "body": "Also you probably want to implement (a more detailed) error handling and logging."}], "owner": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547037932, "creation_date": 1547037932, "question_id": 54110492, "link": "https://stackoverflow.com/questions/54110492/testing-udp-example-server-in-man-addrinfo", "title": "Testing UDP example server in `man addrinfo`", "body": "<p>In <a href=\"http://man7.org/linux/man-pages/man3/getaddrinfo.3.html\" rel=\"nofollow noreferrer\"><code>man addrinfo</code></a> there is example code for an UDP server.</p>\n\n<p>I compiled that code, and run it on a terminal using <code>a.out 9001</code>.</p>\n\n<p>On a second terminal I run <code>netcat 127.0.0.1 9001</code>, hoping that that will open an interactive session with the local server.</p>\n\n<p>And one of the times I tried it did right that, and I could write messages that would be echoed by the server, through in the first terminal the server would not print the received messages as I expected.</p>\n\n<p>But all other times the netcat command just executes and nothing happens. No error message nor output.</p>\n\n<p>This is what there is in the terminal:</p>\n\n<pre><code>jsevillamol@jsevillamol-N551JK:~/Documentos/C$ netcat 127.0.0.1 9000\njsevillamol@jsevillamol-N551JK:~/Documentos/C$ netcat 127.0.0.1 8000\nhola\nhola\nhola\nhola\ntest\ntest\ndo not copy me\ndo not copy me\n^Z\n[4]+  Detenido                netcat 127.0.0.1 8000\njsevillamol@jsevillamol-N551JK:~/Documentos/C$ netcat 127.0.0.1 9001\njsevillamol@jsevillamol-N551JK:~/Documentos/C$ netcat 127.0.0.1 9002\n</code></pre>\n\n<p>When I bond to 8000 is when the interactive session seemed to be working.</p>\n\n<p>Also, after stopping the server I cannot run the program again using the same port.</p>\n\n<p>What is going on?</p>\n"}, {"tags": ["c", "rsa", "stm32", "mbedtls", "polarssl"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1547038724, "post_id": 54110347, "comment_id": 95053524, "body": "What keeps you from asking your compiler, by using <code>sizeof()</code> on the whole thing in one go?"}, {"owner": {"reputation": 190, "user_id": 9149561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/240c2522443201ed7cb252fcae710814?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Eldor", "link": "https://stackoverflow.com/users/9149561/ron-eldor"}, "edited": false, "score": 0, "creation_date": 1547041021, "post_id": 54110347, "comment_id": 95054930, "body": "<code>sizeof()</code> will not return the RAM uage that each <code>mbedtls_mpi</code> uses on heap"}], "answers": [{"comments": [{"owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1547041632, "post_id": 54111418, "comment_id": 95055269, "body": "Ron Eldor, thanks for you prompt response. Unfortunately I have to use a 4096 bit RSA key."}], "tags": [], "owner": {"reputation": 190, "user_id": 9149561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/240c2522443201ed7cb252fcae710814?s=128&d=identicon&r=PG&f=1", "display_name": "Ron Eldor", "link": "https://stackoverflow.com/users/9149561/ron-eldor"}, "is_accepted": true, "score": 1, "last_activity_date": 1547040971, "creation_date": 1547040971, "answer_id": 54111418, "question_id": 54110347, "link": "https://stackoverflow.com/questions/54110347/what-is-size-in-bytes-of-mbed-tls-rsa-context/54111418#54111418", "title": "What is size (in bytes) of Mbed TLS rsa_context?", "body": "<p>Note that the struct <code>mbedtls_rsa_context</code> contains these 13 <code>mbedtls_mpi</code> structs, so if you do <code>sizeof(mbedtls_rsa_context)</code>, it already includes the <code>13 * sizeof(mbedtls_mpi )</code> part. So, no need to add that part.\nAs for the RAM that each <code>mbedtls_mpi</code> consumes, as you can see in <code>mbedtls_mpi_grow</code>, the size that is allocated is the number of limbs (x->n) multiplied with chars in limbs (CiL).\nIf you use <code>mbedtls_mpi_size</code> on every mpi, it will just give you the size in bytes that the big integer uses, without the leading zeros, if there are any, which also consume RAM.\nNote that this means accessing internal members of the struct, which is not recommended, however there isn't any public API to get that knowledge.</p>\n\n<p>If you are constrained with SRAM, have you considered using ECDSA keys, as same security strength keys consume less RAM?<br>\nRegards</p>\n"}], "owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 54111418, "answer_count": 1, "score": 0, "last_activity_date": 1547041671, "creation_date": 1547037369, "last_edit_date": 1547041671, "question_id": 54110347, "link": "https://stackoverflow.com/questions/54110347/what-is-size-in-bytes-of-mbed-tls-rsa-context", "title": "What is size (in bytes) of Mbed TLS rsa_context?", "body": "<p>I use MBED-TLS on STM32F103 device. STM 32F103 device  has little SRAM memory (20 Kbytes).</p>\n\n<p>I would like to calculate the ram used by <a href=\"https://tls.mbed.org/api/structmbedtls__rsa__context.html\" rel=\"nofollow noreferrer\">mbedtls_rsa_context</a></p>\n\n<p>How to do this?\nIs it :</p>\n\n<blockquote>\n  <p>sizeof(mbedtls_rsa_context) + 13 * sizeof(mbedtls_mpi ) + mbedtls_mpi_size (D) + ..... + mbedtls_mpi_size (Vf)</p>\n</blockquote>\n\n<p>Thanks,</p>\n\n<p>Regards.</p>\n"}, {"tags": ["c", "function", "pointers", "recursion", "count"], "comments": [{"owner": {"reputation": 20484, "user_id": 521776, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/60dd3c3417791c535860abc76ec01f28?s=128&d=identicon&r=PG", "display_name": "BlackBear", "link": "https://stackoverflow.com/users/521776/blackbear"}, "edited": false, "score": 1, "creation_date": 1547037474, "post_id": 54110314, "comment_id": 95052760, "body": "Do post some of the things you tried, so we can help you understand why they didn&#39;t work :)"}, {"owner": {"reputation": 1844, "user_id": 8238512, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ouYe.jpg?s=128&g=1", "display_name": "Rizwan", "link": "https://stackoverflow.com/users/8238512/rizwan"}, "edited": false, "score": 0, "creation_date": 1547037796, "post_id": 54110314, "comment_id": 95052918, "body": "No need to keep it global variable. Just give it a value in main() itself, or where ever you want to call move() from."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 10889697, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RY5H6fDrYpM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcatDE-Sj1DAl3SYcxFxnQ3PH59NxQ/mo/photo.jpg?sz=128", "display_name": "midas kortman", "link": "https://stackoverflow.com/users/10889697/midas-kortman"}, "edited": false, "score": 0, "creation_date": 1547038999, "post_id": 54110466, "comment_id": 95053699, "body": "Everytime i try this i get the error &quot;Too few arguments to function move&quot; I&#39;m not sure what i&#39;m doing wrong."}, {"owner": {"reputation": 1599, "user_id": 9948091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JANyt.png?s=128&g=1", "display_name": "HAL9000", "link": "https://stackoverflow.com/users/9948091/hal9000"}, "edited": false, "score": 1, "creation_date": 1547039412, "post_id": 54110466, "comment_id": 95053965, "body": "Nobody can know what you are doing wrong, unless you show your code"}, {"owner": {"reputation": 3, "user_id": 10889697, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RY5H6fDrYpM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcatDE-Sj1DAl3SYcxFxnQ3PH59NxQ/mo/photo.jpg?sz=128", "display_name": "midas kortman", "link": "https://stackoverflow.com/users/10889697/midas-kortman"}, "edited": false, "score": 1, "creation_date": 1547039921, "post_id": 54110466, "comment_id": 95054266, "body": "I found my fault and used this method to get to my goal. Thanks for the help!"}], "tags": [], "owner": {"reputation": 300, "user_id": 8800091, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/230f0c9c6f2224071a4c4dc45bd1087f?s=128&d=identicon&r=PG&f=1", "display_name": "andi8086", "link": "https://stackoverflow.com/users/8800091/andi8086"}, "is_accepted": true, "score": 2, "last_activity_date": 1547037830, "creation_date": 1547037830, "answer_id": 54110466, "question_id": 54110314, "link": "https://stackoverflow.com/questions/54110314/making-a-counter-in-a-recursive-function-using-pointers/54110466#54110466", "title": "Making a counter in a recursive function using pointers?", "body": "<p>If I understand you correctly, you want to alter a variable given in the parameter list. You can do so by using pointers. For example:</p>\n\n<pre><code>void move(int *pa)\n{\n    (*pa)++;  // increase the counter by one\n\n    if (*pa &lt; 5) move(pa);\n}\n\nvoid main(void)\n{\n    int a = 0;\n\n    move(&amp;a);\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 10889697, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RY5H6fDrYpM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcatDE-Sj1DAl3SYcxFxnQ3PH59NxQ/mo/photo.jpg?sz=128", "display_name": "midas kortman", "link": "https://stackoverflow.com/users/10889697/midas-kortman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 54110466, "answer_count": 1, "score": 0, "last_activity_date": 1547037830, "creation_date": 1547037272, "question_id": 54110314, "link": "https://stackoverflow.com/questions/54110314/making-a-counter-in-a-recursive-function-using-pointers", "title": "Making a counter in a recursive function using pointers?", "body": "<p>I would like to count how many moves there are made in the function move. If it is possible i would like to use pointers for it so i can learn more about that.</p>\n\n<p>I've made a counter using a global but now i would like to use pointers but everything i tried failed.</p>\n\n<pre><code>void move(unsigned int moves, char source, char spare, char dest)\n{\n    if (moves == 0) {\n    /* no move: nothing to do */\n    }\n    else {\n        move(moves - 1, source, dest, spare);\n        printf(\"Move disk %d from pole %c to pole %c.\\n\", moves, source, \ndest);\n        move(moves - 1, spare, source, dest);\n    }\n}\n\nint main()\n{\n    char source = 'A';\n    char spare = 'B';\n    char dest = 'C';\n\n    int moves = size();\n\n    move(moves, source, spare, dest);\n\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "linux", "signals", "bsd"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547034503, "post_id": 54109318, "comment_id": 95050955, "body": "First of all, you know that signals and signal handlers are very specific to the current process, and that you can&#39;t change the signal behavior of other unrelated processes? Secondly, <i>why</i> do you want to do this? What is the <i>real</i> problem you want to solve? And wouldn&#39;t it be easier to just fix it by setting the <code>SA_RESTART</code> flag when the process signal handlers are being initialized?"}, {"owner": {"reputation": 1591, "user_id": 955508, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c96c0fe10c21c73dcf3ed8afa75c762f?s=128&d=identicon&r=PG", "display_name": "leanid.chaika", "link": "https://stackoverflow.com/users/955508/leanid-chaika"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547034963, "post_id": 54109318, "comment_id": 95051215, "body": "My application use a lot of networking and filesystem downloading and updating files so I decide to set in one place (start of app) enable SA_RESTART like in BSD and forget about it. I think it simpler, then check every file open, read, write in all my code and libraries."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547035549, "post_id": 54109318, "comment_id": 95051594, "body": "Unless you set some signal handler before using the code you show, then none of the signal would have a handler. And the majority of the signals you list will <i>never</i> happen, ever, in your program. Properly set the signals <i>only</i> for the actual signals that can actually happen. Also, some of the signals you list will <i>kill</i> the process right of the bat, attempting to set the <code>SA_RESTART</code> flag for those is moot."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547035771, "post_id": 54109318, "comment_id": 95051721, "body": "And for networking and working with pipes, the only signal you realistically need to handle is <code>SIGPIPE</code>, which your program should be set to <i>ignore</i> (and without the <code>SA_RESTART</code> flag as that&#39;s an error condition you need to explicitly handle). If you use the <code>alarm</code> function (or some other timers) then also handle <code>SIGALRM</code>. Possibly also <code>SIGCHLD</code> and <code>SIGTERM</code>/<code>SIGINT</code> depending on use-case and design and requirements."}, {"owner": {"reputation": 1591, "user_id": 955508, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c96c0fe10c21c73dcf3ed8afa75c762f?s=128&d=identicon&r=PG", "display_name": "leanid.chaika", "link": "https://stackoverflow.com/users/955508/leanid-chaika"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547038983, "post_id": 54109318, "comment_id": 95053687, "body": "I not set any signal handlers but may be some library I use set some. Tested my code on Android and it works some signal handlers already had <code>SA_RESTART</code> flag enabled, most not. Later I try at home play with this on my Fedora loading and storing large files and try to interrapt it with <code>CTRL+C</code>"}], "owner": {"reputation": 1591, "user_id": 955508, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c96c0fe10c21c73dcf3ed8afa75c762f?s=128&d=identicon&r=PG", "display_name": "leanid.chaika", "link": "https://stackoverflow.com/users/955508/leanid-chaika"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1547034092, "creation_date": 1547034092, "question_id": 54109318, "link": "https://stackoverflow.com/questions/54109318/how-to-enable-on-linux-android-bsd-compatible-syscall-restart-on-eintr-error", "title": "How to enable on Linux (Android) BSD compatible syscall restart on EINTR error (using flag SA_RESTART)", "body": "<p>I want to ask OS to auto restart all system calls (like open, read, write, and etc...) on EINTR error in Linux(Android) like it work in BSD. I found <a href=\"http://man7.org/linux/man-pages/man2/sigaction.2.html\" rel=\"nofollow noreferrer\"><strong>sigaction</strong></a> with <strong>SA_RESTART</strong> flag. Now if I understand correctly I should enable flag <strong>SA_RESTART</strong> for every signal handler in system except (<strong>SIGKILL</strong> and <strong>SIGSTOP</strong>) Here is my solution:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>\n    auto EnableBSDStyleSyscallRestartOnEINTR = [](int sig) -&gt; bool {\n        int status;\n        struct sigaction act;\n\n        status = sigaction(sig, nullptr, &amp;act);\n        if (status == -1) {\n            LoggerError(\"error get sigaction for signal: %d\", sig);\n            return false;\n        }\n\n        if (act.sa_flags &amp; SA_RESTART) {\n            return true;\n        }\n\n        act.sa_flags |= SA_RESTART;\n        status = sigaction(sig, &amp;act, nullptr);\n        if (status != 0) {\n            LoggerError(\"can't update sigaction for signal: %d\", sig);\n            return false;\n        }\n        return true;\n    };\n\n    const auto listOfSignals = {\n            SIGHUP,\n            SIGINT,\n            SIGQUIT,\n            SIGILL,\n            SIGTRAP,\n            SIGABRT,\n            SIGIOT,\n            SIGBUS,\n            SIGFPE,\n            // SIGKILL - do not use with sigaction http://man7.org/linux/man-pages/man2/sigaction.2.html\n            // SIGUSR1\n            SIGSEGV,\n            // SIGUSR2\n            SIGPIPE,\n            SIGALRM,\n            SIGTERM,\n            SIGSTKFLT,\n            SIGCHLD,\n            SIGCONT,\n            // SIGSTOP - do not use with sigaction http://man7.org/linux/man-pages/man2/sigaction.2.html\n            SIGTSTP,\n            SIGTTIN,\n            SIGTTOU,\n            SIGURG,\n            SIGXCPU,\n            SIGXFSZ,\n            SIGVTALRM,\n            SIGPROF,\n            SIGWINCH,\n            SIGIO,\n            SIGPWR,\n            SIGSYS,\n            SIGSWI\n    };\n    bool all_good = true;\n    for (int sig : listOfSignals) {\n        all_good &amp;= EnableBSDStyleSyscallRestartOnEINTR(sig);\n    }\n    assert(all_good);\n\n</code></pre>\n\n<p>Is my solution correct? My be any more easy or elegant solution? Thanks in advance.</p>\n"}, {"tags": ["c", "linux"], "comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547034400, "post_id": 54109236, "comment_id": 95050889, "body": "why it is not the case ? fgets always put the \\0"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547034821, "post_id": 54109236, "comment_id": 95051117, "body": "@G.M. get a cofee with P.W ^^"}, {"owner": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 0, "creation_date": 1547034823, "post_id": 54109236, "comment_id": 95051121, "body": "the <code>while</code> expression should probably be using <code>||</code> not <code>&amp;&amp;</code> since if one file is shorter than the other, the <code>while</code> loop will end and it&#39;ll return 1."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 0, "creation_date": 1547034868, "post_id": 54109236, "comment_id": 95051149, "body": "@ChrisTurner yes, this is my second remark of my answer ;-)"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547035290, "post_id": 54109236, "comment_id": 95051431, "body": "If the first lines match and the second doesn&#39;t, your program will still return 0."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547035771, "post_id": 54109236, "comment_id": 95051722, "body": "@Don.Kielon l edited my answer to add a proposal"}, {"owner": {"reputation": 5012, "user_id": 2416647, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f471b80868ae9c93d0903127ed27e2f9?s=128&d=identicon&r=PG", "display_name": "schorsch312", "link": "https://stackoverflow.com/users/2416647/schorsch312"}, "edited": false, "score": 0, "creation_date": 1547038445, "post_id": 54109236, "comment_id": 95053342, "body": "Why don&#39;t you compute the md5 hash (e.g. using openssl/md5.h ). If the hashes are equal you know that the files are equal."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 5012, "user_id": 2416647, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f471b80868ae9c93d0903127ed27e2f9?s=128&d=identicon&r=PG", "display_name": "schorsch312", "link": "https://stackoverflow.com/users/2416647/schorsch312"}, "edited": false, "score": 0, "creation_date": 1547038749, "post_id": 54109236, "comment_id": 95053543, "body": "@schorsch312 for me if the md5 are different the files are different, if they are equal we don&#39;t know if the files are equals or different, a md5 cannot cover all the content of a file, else that means the md5 is the reversible compression of the file"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1547044158, "post_id": 54109236, "comment_id": 95056871, "body": "Read <a href=\"https://ericlippert.com/2014/03/05/how-to-debug-small-programs/\" rel=\"nofollow noreferrer\">How to debug small programs</a>"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547048067, "post_id": 54109236, "comment_id": 95059467, "body": "@Don Kielon Rolled edit back, else your question does not make sense."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 10615877, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-pMug-YAF-yw/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbAKaPP7gVPMpYJ6z-r82i9TTVibQA/mo/photo.jpg?sz=128", "display_name": "Don Kielon", "link": "https://stackoverflow.com/users/10615877/don-kielon"}, "edited": false, "score": 0, "creation_date": 1547036518, "post_id": 54109299, "comment_id": 95052195, "body": "it always return 0"}, {"owner": {"reputation": 31, "user_id": 10615877, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-pMug-YAF-yw/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbAKaPP7gVPMpYJ6z-r82i9TTVibQA/mo/photo.jpg?sz=128", "display_name": "Don Kielon", "link": "https://stackoverflow.com/users/10615877/don-kielon"}, "edited": false, "score": 0, "creation_date": 1547037407, "post_id": 54109299, "comment_id": 95052725, "body": "In one program i get always 1 in other always 0"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 31, "user_id": 10615877, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-pMug-YAF-yw/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbAKaPP7gVPMpYJ6z-r82i9TTVibQA/mo/photo.jpg?sz=128", "display_name": "Don Kielon", "link": "https://stackoverflow.com/users/10615877/don-kielon"}, "edited": false, "score": 0, "creation_date": 1547037433, "post_id": 54109299, "comment_id": 95052742, "body": "I changed again my definition, sorry. That one works in all cases"}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1547037567, "post_id": 54109299, "comment_id": 95052802, "body": "@bruno Why would you use <code>return (r1 == r2);</code>?"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1547037939, "post_id": 54109299, "comment_id": 95053017, "body": "@Michi I do to take into account the fact the file may not have the same size but have the same start, so r1 == 0 but r2 != 0 or the reverse"}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1547038790, "post_id": 54109299, "comment_id": 95053567, "body": "You should report what exactly are you returning. There are two <code>return 0;</code> in your code."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547039034, "post_id": 54109299, "comment_id": 95053723, "body": "it returns 1 when the files have the same content, 0 if at least one file cannot be open or if their content are not equal"}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1547039662, "post_id": 54109299, "comment_id": 95054102, "body": "How can we know which <code>fp</code> returns <code>0</code>? By the way <a href=\"https://pastebin.com/raw/d2HFYYmZ\" rel=\"nofollow noreferrer\">Your Code</a> The way is designed, if <a href=\"https://pastebin.com/raw/xPrQ06Em\" rel=\"nofollow noreferrer\">File_1 and File_2 has the following content</a> Then Works <a href=\"https://pastebin.com/raw/rzathdA8\" rel=\"nofollow noreferrer\">Like this</a>."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547052876, "post_id": 54109299, "comment_id": 95062513, "body": "The code fails to compare correctly when a file  contain a <i>null characters</i> due to use of <code>strcmp()</code>."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547052943, "post_id": 54109299, "comment_id": 95062544, "body": "@chux You are right, I supposed it is text files, the <i>fgets</i> is also not a good choice for a non text file."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547053410, "post_id": 54109299, "comment_id": 95062837, "body": "C does not require text files to not have <i>null characters</i> - even so, there are uncommon in classical ASCII text files. Note: <code>(char) 0</code> is very common in UTF-16 text files.    Perhaps Linux has requirements about <i>null characters</i> and text files?"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547053662, "post_id": 54109299, "comment_id": 95062982, "body": "@chux I am pretty sure you understand what I mean about text file ;-) Anyway it is easy to change the definition to be compatible with any files, do you think it is better to do ?"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547054032, "post_id": 54109299, "comment_id": 95063200, "body": "@bruno Using <code>fread()</code>, IMO, makes better sense as detailed <a href=\"https://stackoverflow.com/a/54114329/2410359\">here</a>.  Hard to say what folks think as better sometimes: Clear short code that well handles the common cases or   code to also handle many outlying cases.  Your call."}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 4, "last_activity_date": 1547037408, "last_edit_date": 1547037408, "creation_date": 1547034003, "answer_id": 54109299, "question_id": 54109236, "link": "https://stackoverflow.com/questions/54109236/comparing-2-files-in-c-linux-fgets/54109299#54109299", "title": "Comparing 2 files in c linux fgets", "body": "<p><code>strcmp(line1,line2)==0</code> means <em>line1</em> and <em>line2</em> are <strong>equals</strong>, your code supposes they are different</p>\n\n<p>There is an other error, if a file is starts with the content of the other you consider the files are equals (supposing you corrected the <em>strcmp</em>)</p>\n\n<hr>\n\n<p>I encourage you to check the result of the <em>fopen</em> in case at least one of them does not exist / cannot be open</p>\n\n<hr>\n\n<p>a solution can be :</p>\n\n<pre><code>int compare(char *file_1, char *file_2)\n{\n  FILE *fp1 = fopen(file_1,\"r\");\n\n  if (fp1 == 0)\n    return 0;\n\n  FILE *fp2 = fopen(file_2,\"r\");\n\n  if (fp2 == 0) {\n    fclose(fp1);\n    return 0;\n  }\n\n  char line1[1000];\n  char line2[1000];\n  char * r1, * r2;\n  int result;\n\n  for (;;) {\n    r1 = fgets(line1, sizeof(line1), fp1);\n    r2 = fgets(line2, sizeof(line2), fp2);\n\n    if ((r1 == 0) || (r2 == 0)) {\n      result = (r1 == r2);\n      break;\n    }\n\n    if (strcmp(line1,line2) != 0) {\n      result = 0;\n      break;\n    }\n  }\n\n  fclose(fp1);\n  fclose(fp2);\n\n  return result;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 3, "creation_date": 1547035517, "post_id": 54109571, "comment_id": 95051571, "body": "<i>reading whole file in one go</i> :  this is a <b>bad</b> solution, you loose time reading all even you can detect before they are different, and if the files are huge you may not have enough memory to read them"}], "tags": [], "owner": {"reputation": 329, "user_id": 10138568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9748c5fd9cad390ab9a0d8fdc26edfba?s=128&d=identicon&r=PG&f=1", "display_name": "vinodsaluja", "link": "https://stackoverflow.com/users/10138568/vinodsaluja"}, "is_accepted": false, "score": 0, "last_activity_date": 1547034902, "creation_date": 1547034902, "answer_id": 54109571, "question_id": 54109236, "link": "https://stackoverflow.com/questions/54109236/comparing-2-files-in-c-linux-fgets/54109571#54109571", "title": "Comparing 2 files in c linux fgets", "body": "<p>Try reading whole file in one go, the loop will run until whole of the file is read and If it matches once, it will always going to return 0.\nGet the file size something like this and use malloc and read></p>\n\n<pre><code>fseek(fp, 0, SEEK_END); \nsize = ftell(fp);\nfseek(fp, 0, SEEK_SET); \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547037625, "post_id": 54110081, "comment_id": 95052824, "body": "why do you use strcasecmp ? doing that you are not case sensitive"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547037820, "post_id": 54110081, "comment_id": 95052935, "body": "no, I did because your solution doesn&#39;t work if you cannot read all, there is no reason to be blocked by that kind of problem"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547038110, "post_id": 54110081, "comment_id": 95053114, "body": "for instance the case producing <code>fputs (&quot;Memory error&quot;,stderr);</code>"}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547038398, "post_id": 54110081, "comment_id": 95053304, "body": "To accomplish that I made those changes. Thank you."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547048612, "post_id": 54110081, "comment_id": 95059812, "body": "Why use <code>size_t length</code> to save result from <code>long ftell(file)</code>?  1) Code misses the error check and 2) a <code>(size_t)ftell (file)</code>  cast may lose information."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547048982, "post_id": 54110081, "comment_id": 95060058, "body": "Something like <code>long tel = ftell(file); if (tel &lt; 0 || tel &gt;= SIZE_MAX) error(); else length = (size_t) tel;</code> may help."}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1547049752, "post_id": 54110081, "comment_id": 95060597, "body": "Yes, you right. So and so I need a cast to size_t :D. But you right because there is no <code>-1</code> possible. Any way there will be a warning reported like <code>comparison of integer expressions of different signedness: \u2018long int\u2019 and \u2018long unsigned int\u2019</code>, here --&gt;&gt; <code>if ( tel &lt; 0 || tel &gt;= SIZE_MAX )</code>"}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1547050242, "post_id": 54110081, "comment_id": 95060898, "body": "I will just stick to check <code>-1</code>.  I updated the Answer according to your Suggestions."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547051543, "post_id": 54110081, "comment_id": 95061694, "body": "To avoid the warning, but not lose functionality, use <code>if (tel &lt; 0 || (unsigned long) tel &gt;= SIZE_MAX)</code>."}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547051580, "post_id": 54110081, "comment_id": 95061722, "body": "@chux Yes, I was thinking of that too, but I really HATE casts :| but I will add it."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1547051596, "post_id": 54110081, "comment_id": 95061734, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/186420/discussion-between-chux-and-michi\">continue this discussion in chat</a>."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547052471, "post_id": 54110081, "comment_id": 95062277, "body": "<code>(size_t) tel &gt;= SIZE_MAX</code> only makes sense when <code>SIZE_MAX &gt;= LONG_MAX</code>. C does not insure that though. <code>(unsigned long) tel &gt;= SIZE_MAX</code> does not bring in that problem. IAC, UV for the improvement."}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1547052578, "post_id": 54110081, "comment_id": 95062339, "body": "@chux Oh, now I see the Point, I&#39;ll update. Any way the OP asks about Linux, so I added a new Function too, which check file existence too."}], "tags": [], "owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "is_accepted": false, "score": 0, "last_activity_date": 1547053885, "last_edit_date": 1547053885, "creation_date": 1547036569, "answer_id": 54110081, "question_id": 54109236, "link": "https://stackoverflow.com/questions/54109236/comparing-2-files-in-c-linux-fgets/54110081#54110081", "title": "Comparing 2 files in c linux fgets", "body": "<p>Well, if those files are not to big, a good approach will be like this:</p>\n\n<pre><code>#include &lt;errno.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;unistd.h&gt;\n\nvoid fileExistence( const char *fileName );\nchar *readFile( const char *const fileName  );\nsize_t getFileSize ( FILE *const file );\n\nint main ( void )\n{\n    const char *const file_1 = \"file1.txt\";\n    const char *const file_2 = \"file2.txt\";\n\n    char *const getFile_01 = readFile( file_1 );\n    char *const getFile_02 = readFile( file_2 );\n\n    if (strcmp( getFile_01, getFile_02 ) == 0 )\n    {\n        printf( \"Files are the same\\n\" );\n    }else\n    {\n        printf( \"Files are not the same\\n\" );\n    }\n\n    free( getFile_01 );\n    free( getFile_02 );\n\n    return 0;\n}\n\nchar *readFile( const char *const fName )\n{\n    fileExistence( fName );\n    size_t size, length;\n    char *buffer;\n    FILE *file = fopen ( fName , \"rb\" );\n    if ( file == NULL )\n    {\n        fprintf( stderr, \"Can't open output file %s!\\n\", fName );\n        exit( EXIT_FAILURE );\n    }\n\n    length = getFileSize( file );\n    if ( length == 0 )\n    {\n        printf( \"Error, getFileSize()\\n\" );\n    }\n\n    buffer = malloc( length + 1 );\n    if ( buffer == NULL ){\n        printf( \"Error, malloc().\\n\" );\n        exit( EXIT_FAILURE );\n    }\n\n    size = fread ( buffer , 1 , length, file );\n    if ( size != length ){\n        printf( \"Error, fread().\\n\" );\n        exit( EXIT_FAILURE );\n    }\n\n    buffer[length] = '\\0';\n    fclose ( file );\n    return buffer;\n}\n\nsize_t getFileSize ( FILE *const file )\n{\n    int fsk = fseek ( file , 0 , SEEK_END );\n    if ( fsk == -1 )\n    {\n        printf( \"Error, fseek()\\n\" );\n        return 0;\n    }\n    long tel = ftell( file );\n\n    if ( tel &lt; 0 || (unsigned long) tel &gt;= SIZE_MAX )\n    {\n        printf( \"Error, ftell()\\n\" );\n        return 0;\n    }\n\n    fsk = fseek (file , 0 , SEEK_SET );\n    if ( fsk == -1 )\n    {\n        printf( \"Error, fseek()\\n\" );\n        return 0;\n    }\n    return ( size_t )tel;\n}\n\nvoid fileExistence( const char *const fileName )\n{\n    if( access(fileName, F_OK ) )\n    {\n        printf(\"The File %s\\t not Found\\n\",fileName);\n        exit( EXIT_FAILURE );\n    }\n\n    if( access(fileName, R_OK ) )\n    {\n        printf(\"The File %s\\t cannot be readed\\n\",fileName);\n        exit( EXIT_FAILURE );\n    }\n\n    if( access( fileName, W_OK ) )\n    {\n        printf(\"The File %s\\t it cannot be Edited\\n\",fileName);\n        exit( EXIT_FAILURE );\n    }\n}\n</code></pre>\n\n<p>Where you read both files and save them in two buffers and use <code>strcmp()</code> to compare both them.</p>\n\n<p>If you need compare files without capitalization you can use <code>strcasecmp()</code> function which is found in <code>strings.h</code></p>\n"}, {"comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547038330, "post_id": 54110459, "comment_id": 95053254, "body": "read the files char by char is very expensive, slower than to read block by block"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 1, "creation_date": 1547038409, "post_id": 54110459, "comment_id": 95053310, "body": "ch1 and ch2 must not be char but int, currently you cannot detect EOF"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547038471, "post_id": 54110459, "comment_id": 95053361, "body": "if the files are different you do not close the file"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547038515, "post_id": 54110459, "comment_id": 95053386, "body": "you also have 2 times <code>if (ch1 != ch2) return 0</code>"}, {"owner": {"reputation": 1599, "user_id": 9948091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JANyt.png?s=128&g=1", "display_name": "HAL9000", "link": "https://stackoverflow.com/users/9948091/hal9000"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 2, "creation_date": 1547042118, "post_id": 54110459, "comment_id": 95055558, "body": "@bruno Yes char by char is slower than block by block, but it is not very expensive (<code>fgetc</code> typically does buffered reads). For simpler code, the tradeoff may be worth it."}, {"owner": {"reputation": 1263, "user_id": 7099984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb73d10a9ce4b91379b514722601f9ee?s=128&d=identicon&r=PG&f=1", "display_name": "myxaxa", "link": "https://stackoverflow.com/users/7099984/myxaxa"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547042850, "post_id": 54110459, "comment_id": 95055980, "body": "@bruno fixed return by break and file closing"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 1, "creation_date": 1547043752, "post_id": 54110459, "comment_id": 95056579, "body": "@myxaxa consider these two consecutives lines : <code>if (ch1 != ch2) break; if (ch1 == EOF || ch2 == EOF) break;</code> , if the first test is false that means that ch1 == ch2, so it is useless to check both ch1 and ch2 equal  EOF. Can be <code>if ((ch1 != ch2) || (ch1 == EOF)) break;</code>"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 1, "creation_date": 1547043853, "post_id": 54110459, "comment_id": 95056650, "body": "@myxaxa you can also simplify <code>if (ch1 != ch2) return 0; return 1;</code> to be just <code>return (ch1 == ch2);</code>"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 1, "creation_date": 1547043917, "post_id": 54110459, "comment_id": 95056691, "body": "@myxaxa again, do not forget to change ch1 and ch2 to be int rather than char"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547045311, "post_id": 54110459, "comment_id": 95057654, "body": "Just a remark : because you do not check what <i>fopen</i> returns when the two files cannot be read (for instance they do not exist) you return 1. I preferred to return 0, to return 1 only when all is ok and the files are equal."}], "tags": [], "owner": {"reputation": 1263, "user_id": 7099984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb73d10a9ce4b91379b514722601f9ee?s=128&d=identicon&r=PG&f=1", "display_name": "myxaxa", "link": "https://stackoverflow.com/users/7099984/myxaxa"}, "is_accepted": false, "score": 1, "last_activity_date": 1547044405, "last_edit_date": 1547044405, "creation_date": 1547037812, "answer_id": 54110459, "question_id": 54109236, "link": "https://stackoverflow.com/questions/54109236/comparing-2-files-in-c-linux-fgets/54110459#54110459", "title": "Comparing 2 files in c linux fgets", "body": "<p>you can compare files char by char (or byte by byte) to get faster result in case then files are not equal:</p>\n\n<pre><code>int compare(char *file_1, char *file_2)\n{\n    FILE *data_1 = fopen(file_1,\"r\");\n    FILE *data_2 = fopen(file_2,\"r\");\n    int ch1, ch2;\n    for (;;) {\n        ch1 = getc(data_1); \n        ch2 = getc(data_2); \n\n        if ((ch1 != ch2) || (ch1 == EOF)) break;\n    }\n\n    fclose(data_1);\n    fclose(data_2);\n\n    return (ch1 == ch2);\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1263, "user_id": 7099984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb73d10a9ce4b91379b514722601f9ee?s=128&d=identicon&r=PG&f=1", "display_name": "myxaxa", "link": "https://stackoverflow.com/users/7099984/myxaxa"}, "edited": false, "score": 0, "creation_date": 1547045903, "post_id": 54112132, "comment_id": 95058102, "body": "do the check with 2 files with various first chars :)"}, {"owner": {"reputation": 1599, "user_id": 9948091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JANyt.png?s=128&g=1", "display_name": "HAL9000", "link": "https://stackoverflow.com/users/9948091/hal9000"}, "reply_to_user": {"reputation": 1263, "user_id": 7099984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb73d10a9ce4b91379b514722601f9ee?s=128&d=identicon&r=PG&f=1", "display_name": "myxaxa", "link": "https://stackoverflow.com/users/7099984/myxaxa"}, "edited": false, "score": 0, "creation_date": 1547046193, "post_id": 54112132, "comment_id": 95058278, "body": "I did that, but the result was boring. Essentially the same runtime as <code>&#47;bin&#47;true</code>"}], "tags": [], "owner": {"reputation": 1599, "user_id": 9948091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JANyt.png?s=128&g=1", "display_name": "HAL9000", "link": "https://stackoverflow.com/users/9948091/hal9000"}, "is_accepted": false, "score": 1, "last_activity_date": 1547043926, "last_edit_date": 1547043926, "creation_date": 1547043352, "answer_id": 54112132, "question_id": 54109236, "link": "https://stackoverflow.com/questions/54109236/comparing-2-files-in-c-linux-fgets/54112132#54112132", "title": "Comparing 2 files in c linux fgets", "body": "<p>Here are to solutions, one char by char read/comparisons (Inspired by the answer from myxaxa, but with bugfixes) And another block by block read/comparisons. Error checking has been skipped due to laziness, but a robust implementation MUST HAVE ERROR CHECKING. (See comments)</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(int argc, char **argv)\n{\n    int equal = 1;\n\n    // TODO: check argc == 3\n\n    FILE *data_1 = fopen(argv[1],\"r\");\n    FILE *data_2 = fopen(argv[2],\"r\");\n\n    // TODO: check data_1 and data_2 !=NULL\n\n    for (;;)\n      {\n        int ch1, ch2;\n        ch1 = fgetc(data_1); \n        ch2 = fgetc(data_2); \n\n        if (ch1 != ch2)\n         { \n           equal = 0;\n           break;\n         }\n        // We only need to test ch1, because at this point ch1 == ch2;   \n        if (ch1 == EOF)\n          break;\n      }\n\n    // TODO: check for read errors in data_1 and data_2 using ferror\n\n    fclose(data_1);\n    fclose(data_2);\n\n    if (equal)\n      printf(\"equal\\n\");\n    else\n      printf(\"not equal\\n\");\n}\n</code></pre>\n\n<p>Second solution using block reads/comparisons:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\n#define BUFFSIZE 4096\n\nint main(int argc, char **argv)\n{\n    int equal = 1;\n\n    // TODO: check argc == 3\n\n    FILE *data_1 = fopen(argv[1],\"r\");\n    FILE *data_2 = fopen(argv[2],\"r\");\n\n    // TODO: check data_1 and data_2 !=NULL\n\n    for (;;)\n      {\n        char b1[BUFFSIZE];\n        char b2[BUFFSIZE];\n\n        size_t r1 = fread(b1, 1, BUFFSIZE, data_1); \n        size_t r2 = fread(b2, 1, BUFFSIZE, data_2);\n\n        if (r1 != r2)\n          {\n            equal = 0;\n            break;\n          }\n\n        // We only need to test r1, because at this point r1 == r2;   \n        if (r1 == 0)\n          break;\n        if (memcmp(b1, b2, r1) != 0)\n          { \n            equal = 0;\n            break;\n          }\n      }\n\n    // TODO: check for read errors in data_1 and data_2 using ferror \n\n    fclose(data_1);\n    fclose(data_2);\n\n    if (equal)\n      printf(\"equal\\n\");\n    else\n      printf(\"not equal\\n\");\n}\n</code></pre>\n\n<p>Runtimes for char by char reads/comparisons on a 840Mb file compared with itself:</p>\n\n<pre><code>real    0m5.158s\nuser    0m4.880s\nsys     0m0.277s\n</code></pre>\n\n<p>... and for block by block on the same file:</p>\n\n<pre><code>real    0m0.353s\nuser    0m0.083s\nsys     0m0.270s\n</code></pre>\n\n<p>Both test did multiple runs to ensure file was already cached</p>\n"}, {"comments": [{"owner": {"reputation": 1599, "user_id": 9948091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JANyt.png?s=128&g=1", "display_name": "HAL9000", "link": "https://stackoverflow.com/users/9948091/hal9000"}, "edited": false, "score": 0, "creation_date": 1547120889, "post_id": 54114329, "comment_id": 95087286, "body": "The &quot;text vs. binary&quot; mode is only an issue on obscure platforms, like Windows"}], "tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 1, "last_activity_date": 1547053518, "last_edit_date": 1547053518, "creation_date": 1547050836, "answer_id": 54114329, "question_id": 54109236, "link": "https://stackoverflow.com/questions/54109236/comparing-2-files-in-c-linux-fgets/54114329#54114329", "title": "Comparing 2 files in c linux fgets", "body": "<p>Other issues concerning comparing files not covered in answers yet</p>\n\n<p><strong>File data with <code>'\\0'</code></strong></p>\n\n<p>Should a file contain a <em>null character</em>,  <code>fgets()</code> will read that character like any other non-end-of-line character.  Then a following <code>strcmp()</code> will <strong>not</strong> compare all the line that was read.  Better to use <code>fread()/memcmp()</code> to avoid this short-coming.</p>\n\n<p><strong>Comparing as text or binary?</strong></p>\n\n<p>Opening the file with <code>\"r\"</code> as in <code>fopen(file_1,\"r\")</code> allows various translations: end-of-line, end-of-file, byte-order marks.  </p>\n\n<p>Opening with <code>\"r\"</code> makes sense to compare as <em>text</em>.  Otherwise, open the file in <em>binary</em> mode <code>\"rb\"</code>.  Use <code>fread()</code> in either case.</p>\n\n<p>A line of text with <code>\"\\r\\n\"</code> in one file and a line of text with <code>\"\\n\"</code> in another file can compare equal in <em>text</em> mode, but differ in <em>binary</em> mode.</p>\n\n<p>As post is tagged [linux] though, no translations are expected in <em>text</em> mode.</p>\n\n<p><strong>Non-comparable</strong></p>\n\n<p>During readings an input error may occur rendering the compare moot.</p>\n\n<hr>\n\n<p>Sample compare code</p>\n\n<pre><code>#include &lt;stdbool.h&gt;\n#include &lt;stdio.h&gt;\n#define FILE_COMPARE_N 1024\n\n// 1: match\n// 0: mis-match\n// -1: failure\nint stream_compare(FILE *f1, FILE *f2) {\n  unsigned char buf1[FILE_COMPARE_N];\n  unsigned char buf2[FILE_COMPARE_N];\n  size_t l1, l2;\n  do {\n    l1 = fread(buf1, sizeof buf1[0], FILE_COMPARE_N, f1);\n    if (ferror(f1))\n      return -1;\n\n    l2 = fread(buf2, sizeof buf2[0], FILE_COMPARE_N, f2);\n    if (ferror(f2))\n      return -1;\n\n    if (l1 != l2 || memcmp(buf1, buf2, l1) != 0)\n      return 0; // mis-match\n\n  } while (l1);\n  return 1; //match\n}\n\nint file_compare(const char *name1, const char *name2, bool as_text) {\n  FILE *f1 = fopen(name1, as_text ? \"rb\" : \"r\");\n  if (f1 == NULL)\n    return -1;\n\n  FILE *f2 = fopen(name2, as_text ? \"rb\" : \"r\");\n  if (f2 == NULL) {\n    fclose(f1);\n    return -1;\n  }\n\n  int compare = stream_compare(f1, f2);\n\n  fclose(f1);\n  fclose(f2);\n  return compare;\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 10615877, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-pMug-YAF-yw/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbAKaPP7gVPMpYJ6z-r82i9TTVibQA/mo/photo.jpg?sz=128", "display_name": "Don Kielon", "link": "https://stackoverflow.com/users/10615877/don-kielon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "accepted_answer_id": 54109299, "answer_count": 6, "score": 1, "last_activity_date": 1547053885, "creation_date": 1547033787, "last_edit_date": 1547047981, "question_id": 54109236, "link": "https://stackoverflow.com/questions/54109236/comparing-2-files-in-c-linux-fgets", "title": "Comparing 2 files in c linux fgets", "body": "<p>I need to compare 2 files and return 1 if they are same or 0 if not, but function always return 0. I have no idea why. Maybe you know diferent function that can do this.</p>\n\n<pre><code>int compare(char *file_1, char *file_2)\n{\n    FILE *data_1 = fopen(file_1,\"r\");\n    FILE *data_2 = fopen(file_2,\"r\");\n    char line1[1000];\n    char line2[1000];\n    while(fgets(line1, sizeof(line1), data_1)&amp;&amp;fgets(line2, sizeof(line2), data_2)){\n        if(strcmp(line1,line2)==0){\n          fclose(data_1);\n          fclose(data_2);\n          return 0;\n        }\n    }\n    fclose(data_1);\n    fclose(data_2);\n    return 1;\n}\n</code></pre>\n"}, {"tags": ["c", "multithreading", "pthreads", "mutex"], "comments": [{"owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 1, "creation_date": 1547038881, "post_id": 54109128, "comment_id": 95053623, "body": "Is it possible for a thread to be pre-empted while it holds the lock? Try re-running with high priority in the FIFO scheduling class, with both threads bound to un-contended cores. If possible also make sure those cores won&#39;t be used for servicing interrupts."}, {"owner": {"reputation": 9246, "user_id": 1041868, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/6d476b07acb3919c356015e11ad97608?s=128&d=identicon&r=PG", "display_name": "bph", "link": "https://stackoverflow.com/users/1041868/bph"}, "reply_to_user": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 0, "creation_date": 1547039470, "post_id": 54109128, "comment_id": 95053997, "body": "i&#39;m not sure how to do the things you mention, but they sound very sensible - any relevant links to get me started? OS is ubuntu 16.04 and I haven&#39;t mucked about with any realtime kernel settings"}, {"owner": {"reputation": 9246, "user_id": 1041868, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/6d476b07acb3919c356015e11ad97608?s=128&d=identicon&r=PG", "display_name": "bph", "link": "https://stackoverflow.com/users/1041868/bph"}, "reply_to_user": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 0, "creation_date": 1547039966, "post_id": 54109128, "comment_id": 95054295, "body": "Interestingly when the packet taking/processing occurs in the main (parent?) thread then I rarely see the ring buffer fill up. Its much more problematic when the packet taking/processing occurs in a child thread. The packet adding always occurs in a child thread"}, {"owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 1, "creation_date": 1547043261, "post_id": 54109128, "comment_id": 95056246, "body": "Take a look at the <code>pthreads</code> man page, it should refer you to the <code>sched_setscheduler</code> etc. functions for scheduling policy and priority, and CPU affinity. If you have a multi-socket (NUMA) machine, you want to make sure both threads are bound to cores on the same socket. Use <code>numactl</code> in that case to control which node your memory is allocated on."}, {"owner": {"reputation": 9246, "user_id": 1041868, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/6d476b07acb3919c356015e11ad97608?s=128&d=identicon&r=PG", "display_name": "bph", "link": "https://stackoverflow.com/users/1041868/bph"}, "reply_to_user": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 0, "creation_date": 1547043550, "post_id": 54109128, "comment_id": 95056449, "body": "CPU is bog standard Intel&#174; Core\u2122 i5-5200U CPU @ 2.20GHz &#215; 4 so prob not multi-socket (NUMA)?"}, {"owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 1, "creation_date": 1547050607, "post_id": 54109128, "comment_id": 95061124, "body": "If you have one CPU, it&#39;s not NUMA. Multi-socket means a CPU in each socket, so you can ignore the <code>numactl</code> bit."}], "owner": {"reputation": 9246, "user_id": 1041868, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/6d476b07acb3919c356015e11ad97608?s=128&d=identicon&r=PG", "display_name": "bph", "link": "https://stackoverflow.com/users/1041868/bph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 137, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547036055, "creation_date": 1547033436, "last_edit_date": 1547036055, "question_id": 54109128, "link": "https://stackoverflow.com/questions/54109128/interpreting-mutrace-output", "title": "Interpreting mutrace output", "body": "<p>I have implemented multi-threaded software application that captures low-level ethernet packet data (using <code>pcap</code>) and places those packets into a ring buffer. In a separate thread packets are removed from the ring buffer and processed.</p>\n\n<p>I.e. I have a LIFO queue with one thread adding data and another taking it out.</p>\n\n<p>Performance analysis has shown that the ring buffer quickly fills up, i.e. packets cannot be removed as fast as they are being added. Even when I comment out all of the processing in the thread taking the packets, i.e. the application is reduced to simply adding and taking packets and performing no other processing.</p>\n\n<p>One thing I thought could be causing the problem was mutex lock contention on the queue.</p>\n\n<p>I ran the application with <code>mutrace</code> and got the following output:</p>\n\n<pre><code>mutrace: Showing 2 most contended mutexes:\n\nMutex #   Locked  Changed    Cont. tot.Time[ms] avg.Time[ms] max.Time[ms]  Flags\n   6    27740      209       35       75.672        0.003       59.944 M-.--.\n   5       19       13        0        0.021        0.001        0.004 M-.--.\n</code></pre>\n\n<p>This seems to suggest that contention on the mutex used for adding/taking packets (mutex 6) is not too bad, only 0.1% of the locks have been contentious. The only thing that seems to stand out is the huge difference between the avg. lock time and the max lock time. Has anyone else noticed huge disparities in lock times? Possibly its just an anomaly of mutrace and not something to be concerned about?</p>\n"}, {"tags": ["c", "arrays", "string", "initialization", "c-strings"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1547033230, "post_id": 54108978, "comment_id": 95050224, "body": "&quot;<i>[...] so why isn&#39;t that an error?</i>&quot; It is an error. It&#39;s just that C doesn&#39;t require the compiler or runtime system to <i>detect</i> the error. Anything can happen."}, {"owner": {"reputation": 315, "user_id": 10867418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1580131b81478b35551baeec813deddf?s=128&d=identicon&r=PG&f=1", "display_name": "Avi", "link": "https://stackoverflow.com/users/10867418/avi"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1547033984, "post_id": 54108978, "comment_id": 95050644, "body": "So can answers be different with different compilers?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1547034363, "post_id": 54108978, "comment_id": 95050865, "body": "They can even be different with different versions of the same compiler, or different compilation options, or just from running the same program multiple times. There are no guarantees and no expectation of consistency."}, {"owner": {"reputation": 315, "user_id": 10867418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1580131b81478b35551baeec813deddf?s=128&d=identicon&r=PG&f=1", "display_name": "Avi", "link": "https://stackoverflow.com/users/10867418/avi"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1547034483, "post_id": 54108978, "comment_id": 95050938, "body": "I get it now. Looks like I have been overthinking on this topic."}], "answers": [{"comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "reply_to_user": {"reputation": 315, "user_id": 10867418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1580131b81478b35551baeec813deddf?s=128&d=identicon&r=PG&f=1", "display_name": "Avi", "link": "https://stackoverflow.com/users/10867418/avi"}, "edited": false, "score": 0, "creation_date": 1547033416, "post_id": 54109036, "comment_id": 95050329, "body": "@Avi The character <code>&#39;\\0&#39;</code> is the octal value <code>0</code> in character form. It&#39;s exactly equal to <code>0</code>. It&#39;s also exactly equal to <code>&#39;\\x00&#39;</code>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 315, "user_id": 10867418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1580131b81478b35551baeec813deddf?s=128&d=identicon&r=PG&f=1", "display_name": "Avi", "link": "https://stackoverflow.com/users/10867418/avi"}, "edited": false, "score": 0, "creation_date": 1547033418, "post_id": 54109036, "comment_id": 95050332, "body": "@Avi Why not? <code>0</code> and <code>&#39;\\0&#39;</code> are exactly the same."}, {"owner": {"reputation": 315, "user_id": 10867418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1580131b81478b35551baeec813deddf?s=128&d=identicon&r=PG&f=1", "display_name": "Avi", "link": "https://stackoverflow.com/users/10867418/avi"}, "edited": false, "score": 0, "creation_date": 1547033524, "post_id": 54109036, "comment_id": 95050399, "body": "Sorry I got that. They both are same"}, {"owner": {"reputation": 315, "user_id": 10867418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1580131b81478b35551baeec813deddf?s=128&d=identicon&r=PG&f=1", "display_name": "Avi", "link": "https://stackoverflow.com/users/10867418/avi"}, "edited": false, "score": 0, "creation_date": 1547033625, "post_id": 54109036, "comment_id": 95050448, "body": "But how in case 2 that condition <i>(a [3]==&#39;\\0`)</i> true bcoz there is no a [3] present."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 315, "user_id": 10867418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1580131b81478b35551baeec813deddf?s=128&d=identicon&r=PG&f=1", "display_name": "Avi", "link": "https://stackoverflow.com/users/10867418/avi"}, "edited": false, "score": 2, "creation_date": 1547033839, "post_id": 54109036, "comment_id": 95050569, "body": "@Avi Undefined behavior is undefined."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "reply_to_user": {"reputation": 315, "user_id": 10867418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1580131b81478b35551baeec813deddf?s=128&d=identicon&r=PG&f=1", "display_name": "Avi", "link": "https://stackoverflow.com/users/10867418/avi"}, "edited": false, "score": 1, "creation_date": 1547034046, "post_id": 54109036, "comment_id": 95050677, "body": "@Avi C have never had any kind of bounds-checking. Going out of bounds leads to undefined behavior. Just don&#39;t do it."}], "tags": [], "owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": true, "score": 2, "last_activity_date": 1547033065, "creation_date": 1547033065, "answer_id": 54109036, "question_id": 54108978, "link": "https://stackoverflow.com/questions/54108978/printing-strings-and-concept-of-null-character-in-c/54109036#54109036", "title": "Printing strings and concept of null character in C", "body": "<p>If the size of an array is larger than the number of elements you explicitly initialize, then the remaining elements will be zero-initialized.</p>\n\n<p>So you can have e.g.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>char arr[50] = { 'a' };\n</code></pre>\n\n<p>The first element (<code>arr[0]</code>) will be initialized to contain <code>'a'</code>, the remaining 49 elements will all be zero.</p>\n\n<p>Also note that when you define an array of three elements (like in the second two examples in your question) and then use <code>arr[3]== '\\0'</code> you are indexing out of bounds and have <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\"><em>undefined behavior</em></a>.</p>\n\n<p>Furthermore, the contents of memory not inside your array is <em>indeterminate</em>. You can't rely on it being any value.</p>\n\n<p>And lastly,</p>\n\n<pre><code>char arr[3] = \"abc\";\n</code></pre>\n\n<p>and</p>\n\n<pre><code>char arr[3] = { 'a', 'b', 'c' };\n</code></pre>\n\n<p>are actually the same, both create an array of three elements with the contents <code>'a'</code>, <code>'b'</code> and <code>'c'</code>.</p>\n"}], "owner": {"reputation": 315, "user_id": 10867418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1580131b81478b35551baeec813deddf?s=128&d=identicon&r=PG&f=1", "display_name": "Avi", "link": "https://stackoverflow.com/users/10867418/avi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 2, "accepted_answer_id": 54109036, "answer_count": 1, "score": 5, "last_activity_date": 1547046381, "creation_date": 1547032808, "last_edit_date": 1547046381, "question_id": 54108978, "link": "https://stackoverflow.com/questions/54108978/printing-strings-and-concept-of-null-character-in-c", "title": "Printing strings and concept of null character in C", "body": "<p>While reading about printing strings, I came through a statement <strong>\"<code>printf</code> writes the character one by one untill it encounters a null character. If the null character is missing, <code>printf</code> continues past the end of the string until-eventually-it finds a null character in the memory\".</strong> So I wrote some codes:</p>\n\n<p><strong>Case 1:</strong></p>\n\n<pre><code>char arr[4] = { 'a', 'b', 'c' } ;\n\nif (arr[3]== '\\0')\n\nprintf (\"%s\",arr);\n</code></pre>\n\n<p>Output was <code>abc</code>.</p>\n\n<p>So does it mean compiler has automatically stored <code>'\\0'</code> at <code>arr[3]</code>. Because according to the statement, printf will only terminate when it encounters <code>'\\0'</code>.</p>\n\n<p><strong>Case 2:</strong></p>\n\n<pre><code>char arr[3] = { 'a', 'b', 'c' } ;\n\nif (arr[3]== '\\0')\n\nprintf (\"%s\",arr);\n</code></pre>\n\n<p>Output was <code>abc</code> again though there is no array block  <code>arr[3]</code> in existence, so why isn't that an error? Also printf has printed <code>abc</code> and stopped which means it must have encountered <code>'\\0'</code>. So does that mean compiler creates an extra array block after <code>arr[2]</code> to store <code>'\\0'</code>.If so then array size must be increased to 4 bytes (1 byte for each char type character). But executing the statement <code>printf (\"%d\",sizeof (arr));</code> gives me output <code>3</code>, showing that there is no increase in array size and indicating that there is no <code>arr[3]</code>. Then how does the condition <code>if (arr[3]== '\\0')</code> became true?</p>\n\n<p><strong>Case 3:</strong></p>\n\n<pre><code>char arr[3] = \"abc\";\n\nif (arr[3]== '\\0')\n\nprintf (\"%s\",arr);\n</code></pre>\n\n<p>Now it gives me an error saying that <em>\"array index 3 is past the end (which contains 3 elements)\".</em> So why isn't this same with <strong>case 2</strong>. Does that mean that declarations:</p>\n\n<p><code>char arr[3] = \"abc\";</code> and</p>\n\n<p><code>char arr[3] = { 'a', 'b', 'c' } ;</code> are different.</p>\n"}, {"tags": ["c", "recursion", "multidimensional-array", "connected-components"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 1, "creation_date": 1547031736, "post_id": 54108614, "comment_id": 95049405, "body": "<code>int graph[HEIGHT][WIDTH]</code> is a 2 dimensional array, it&#39;s not an <code>int **link</code> array of pointers. There is a huge difference. And compiler should warn you about it. <code>graph[a][b]</code> is equal to <code>*(graph + a * WIDTH + b)</code> while <code>link[a][b]</code> is equal to <code>*(*(link + a) + b)</code>"}, {"owner": {"reputation": 1, "user_id": 4613757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hsCVyUXj1Bs/AAAAAAAAAAI/AAAAAAAAACo/XYQZWFrdP_A/photo.jpg?sz=128", "display_name": "Anthony Gladiator", "link": "https://stackoverflow.com/users/4613757/anthony-gladiator"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547032446, "post_id": 54108614, "comment_id": 95049835, "body": "Sorry, I edited again the function change to link[HEIGHT][WIDTH]"}, {"owner": {"reputation": 29848, "user_id": 5958455, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/lBWIE.png?s=128&g=1", "display_name": "iBug", "link": "https://stackoverflow.com/users/5958455/ibug"}, "edited": false, "score": 7, "creation_date": 1547104377, "post_id": 54108614, "comment_id": 95078542, "body": "Please do not vandalize your posts.  By posting on Stack Overflow, you&#39;ve granted a non-revocable right for SO to distribute that content under the <a href=\"https://creativecommons.org/licenses/by-sa/3.0/\" rel=\"nofollow noreferrer\">CC BY-SA 3.0 license</a>. By SO policy, any vandalism will be reverted."}], "answers": [{"tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": false, "score": 3, "last_activity_date": 1547033700, "last_edit_date": 1547033700, "creation_date": 1547032941, "answer_id": 54109012, "question_id": 54108614, "link": "https://stackoverflow.com/questions/54108614/how-to-do-recursion-on-multidimensional-array/54109012#54109012", "title": "How to do recursion on multidimensional array", "body": "<p><code>lowest_label</code> does not return a value in all the cases because of the <code>else break;</code> in the <em>while</em></p>\n\n<p>Finaly after some recursive calls with access to non initialized values and invalid accesses out of <em>link</em> and <em>visitedLabelCheck</em> there is a crash in <code>if(link[currentLabel][currentCounter] != 0)</code> because <em>currentLabel</em> values 1991084090`</p>\n\n<hr>\n\n<p>I encourage you to compile with warning, if I use gcc with the options <em>-pedantic -Wall</em> the compiler indicates the missing return in <code>lowest_label</code> (and more)</p>\n"}], "owner": {"reputation": 1, "user_id": 4613757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hsCVyUXj1Bs/AAAAAAAAAAI/AAAAAAAAACo/XYQZWFrdP_A/photo.jpg?sz=128", "display_name": "Anthony Gladiator", "link": "https://stackoverflow.com/users/4613757/anthony-gladiator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "closed_date": 1547104406, "answer_count": 1, "score": -7, "last_activity_date": 1547104349, "creation_date": 1547031609, "last_edit_date": 1547104349, "question_id": 54108614, "link": "https://stackoverflow.com/questions/54108614/how-to-do-recursion-on-multidimensional-array", "closed_reason": "Needs more focus", "title": "How to do recursion on multidimensional array", "body": "<p>I am new to recursion, I am having trouble getting the right solution on how to do recursion on 2D array. Can you please give me idea how to fix my logic on my code. I think my algorithm is not correct.</p>\n\n<p>I tried to create recursion on some point but its not working.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n#define HEIGHT 21\n#define WIDTH 5\nint getLowestVertex(int graph[HEIGHT][WIDTH], int currLabel,int height, int width, int labelCount){\n    int counter = 0;\n    int low_label = 999;\n    int j;\n    int i;\n    int *visitedLabelCheck = NULL;         //This will identify the visted label already\n    visitedLabelCheck = (int *)malloc(labelCount * sizeof(int));\n\n    //set all value to 0\n    for(i = 0; i &lt; labelCount; i++){\n        visitedLabelCheck[i] = 0;\n    }\n    printf(\"\\n\");\n    low_label = lowest_label(graph, currLabel, visitedLabelCheck, low_label);\n\n    return low_label;\n}\n\nint lowest_label(int link[HEIGHT][WIDTH], int currentLabel, int *visitedLabelCheck, int low_label){\n    int currentCounter = 0;\n    int lowestLabel = 0;\n\n\n    while(1) {//loop for the current label vertices  \n        if(link[currentLabel][currentCounter] != 0){\n\n            if(visitedLabelCheck[currentLabel] == -1)\n                return link[currentLabel][currentCounter];\n\n            if (link[currentLabel][currentCounter] &lt; low_label) {\n                low_label = link[currentLabel][currentCounter];\n            }\n            lowestLabel = lowest_label(link, link[currentLabel][currentCounter], visitedLabelCheck, lowestLabel);\n            visitedLabelCheck[currentLabel] = -1;\n            if (lowestLabel &lt; low_label){\n                return link[currentLabel][currentCounter];\n            }\n            currentCounter++;\n        }else{\n            break;\n        }\n    }\n}\n\n\nint main(int argc, char *argv[]) {\n\n    int testThisVertex;\n    int lowestVertex;\n    int labelCount;\n    int height;\n    int width;\n    int g[HEIGHT][WIDTH] =   {{1, 21, 0, 0, 0}, //undirected graph\n                              {2,  0, 0, 0, 0},\n                              {3,  0, 0, 0, 0}, \n                              {4,  5, 0, 0, 0},\n                              {5,  4, 0, 0, 0},\n                              {6, 21, 0, 0, 0},\n                              {7,  8,2, 14, 0},\n                              {8,  7, 9, 0, 0},\n                              {9,  8,10, 0, 0},\n                              {10, 9,11, 0, 0},\n                              {11,10, 0, 0, 0},\n                              {12,13, 0, 0, 0},\n                              {13,12,14, 0, 0},\n                              {14,13,15, 7, 0},\n                              {15,14, 0, 0, 0},\n                              {16, 0, 0, 0, 0},\n                              {17, 0, 0, 0, 0},\n                              {18, 0, 0, 0, 0},\n                              {19,20, 0, 0, 0},\n                              {20,19, 0, 0, 0},\n                              {21,17,18, 6, 1}};\n\n    //find the least label if input is 12 \n    //12 -&gt; 13 \n    //      |  \\\n    //      12  14\n    //          | \\   \\\n    //         13  15  7\n    //              |   | \\  \\\n    //             14   8  2  14\n    //ANSWER: 2\n    testThisVertex=12;\n    labelCount = 21;\n    height = 21;\n    width = 5;\n    lowestVertex = getLowestVertex(g, testThisVertex, height, width, labelCount);\n    printf(\"\\nThe lowest value that is connected to %d vertex is %d\", testThisVertex, lowestVertex);\n\n    getchar();\n}\n</code></pre>\n\n<p>The expected output should be the lowest vertex that is connected to the vertex \"testThisVertex\" or current vertex. But in my result it ended looping and looping.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1547030566, "post_id": 54108188, "comment_id": 95048577, "body": "I think you mat be a bit confused, and are going on a false premise. Did you consult <a href=\"https://en.cppreference.com/w/c/language/operator_precedence\" rel=\"nofollow noreferrer\">en.cppreference.com/w/c/language/operator_precedence</a> ?"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1547030618, "post_id": 54108188, "comment_id": 95048618, "body": "&quot;, then a = 1 &lt;&lt; 8 results in 8&quot;. Um, no. Never."}, {"owner": {"reputation": 2999, "user_id": 7520531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0107497596782a18d4a853214a883546?s=128&d=identicon&r=PG&f=1", "display_name": "Jose", "link": "https://stackoverflow.com/users/7520531/jose"}, "edited": false, "score": 1, "creation_date": 1547030657, "post_id": 54108188, "comment_id": 95048647, "body": "Previous values does not matter for your examples. In both cases, you are assigning a constant to the variable (<code>8</code> or <code>1 &lt;&lt; 8 = 256</code>). Previous values matter when i.e. <code>a =&lt;&lt; 2</code>"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1547030672, "post_id": 54108188, "comment_id": 95048659, "body": "You seem to mix this up with <code>a |= (1 &lt;&lt; 8);</code>, don&#39;t you?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8695089"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1547030872, "post_id": 54108188, "comment_id": 95048772, "body": "@Ctx Not exactly, because doing that means: <code>a = a | ( 1 &gt;&gt; 8 )</code> which is clearly that the operation is on the <code>a</code>. Does <code>a = 1 &lt;&lt; 3</code> has another meaning then?"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1547030931, "post_id": 54108188, "comment_id": 95048812, "body": "<code>a = 1 &lt;&lt; 3</code> is equivalent to <code>a = 8</code> of course."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8695089"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1547031140, "post_id": 54108188, "comment_id": 95048940, "body": "@Ctx Moreover the operation is wrong, because <code>a</code> is not initialized here: <code>a |= (1 &lt;&lt; 8);</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8695089"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1547031216, "post_id": 54108188, "comment_id": 95048992, "body": "@ctx <code>a = 1 &lt;&lt; 3 is equivalent to a = 8 of course</code>Yes, but why. How exactly works here ?"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1547031280, "post_id": 54108188, "comment_id": 95049037, "body": "I have serious trouble to understand, what confuses you... <code>1 &lt;&lt; 3</code> is <code>8</code> if you calculate it, so <code>a = 1 &lt;&lt; 3</code> is the same as <code>a = 8</code>. I don&#39;t know what else I could explain about this."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547031426, "post_id": 54108188, "comment_id": 95049166, "body": "<a href=\"https://stackoverflow.com/questions/141525/what-are-bitwise-shift-bit-shift-operators-and-how-do-they-work\">What are bitwise shift (bit-shift) operators and how do they work?</a> does this help? <code>1 &lt;&lt; 3</code> is equal to in base 2 to <code>100</code> which is equal in base 10 to <code>8</code>, <code>1 &lt;&lt; 8</code> is equal to in base 2 to <code>100000000</code> which is equal in base 10 to <code>256</code>. The expression is parsed like <code>a = (1 &lt;&lt; 8)</code> , first <code>1&lt;&lt;8</code> is calculated then normal assignment happens."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8695089"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547031725, "post_id": 54108188, "comment_id": 95049395, "body": "@KamilCuk Let me put it different maybe you will understand my Question. when this <code>( 1 &lt;&lt; 3 )</code> happens does the compiler create a mask like <code>0000 0000 </code> and then makes operation on it, like <code>0000 0000 = 0000 0000 | ( 1 &lt;&lt; 3 )</code>? Hope is clear now."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547031951, "post_id": 54108188, "comment_id": 95049553, "body": "You don&#39;t know. You never know what (generic?) compiler does. See <a href=\"https://godbolt.org/z/S8blxV\" rel=\"nofollow noreferrer\">assembly output</a>. The compiler may optimize <code>1 &lt;&lt; 3</code> to 8 right away and never &quot;create a mask&quot; or anything.  When <code>1 &lt;&lt; 3</code> happens a compiler could generate instructions to ex. put 1 into a register, put 3 into another register, move the first register of the number of bits stored in the second register. Ot it may just store <code>8</code> in the resulting register. There is no &quot;mask&quot; in <code>1 &lt;&lt; 3</code>. What is the point of <code>00000000 | </code>? Are you assuming there are only 8 bits in <code>int</code> ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8695089"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547032102, "post_id": 54108188, "comment_id": 95049635, "body": "@KamilCuk This is a good Answer for my Question."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547032396, "post_id": 54108188, "comment_id": 95049808, "body": "<code>auto</code> is nothing special in C (ok, it is, I say it should be removed). It&#39;s just <a href=\"https://en.cppreference.com/w/cpp/language/storage_duration\" rel=\"nofollow noreferrer\">storage class spcifier</a>. And it&#39;s  <b>not</b> the <code>auto</code> from C++. It&#39;s completely different. Moreover the auto specifier is the default for variables inside block scope. So whenever you do <code>main() { int x; }</code> it&#39;s exactly the same as <code>main() { auto int x; }</code>."}, {"owner": {"reputation": 50126, "user_id": 1717300, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/81b91f602ce8acea8cbeb29f62725627?s=128&d=identicon&r=PG", "display_name": "hyde", "link": "https://stackoverflow.com/users/1717300/hyde"}, "edited": false, "score": 0, "creation_date": 1547032453, "post_id": 54108188, "comment_id": 95049838, "body": "In practice every compiler you are likely to ever use will calculate literal calculations at compile time. Maybe you want to add extra variable, like <i>unsigned volatile b=1; a=b&lt;&lt;8;</i> to force run time code generation?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8695089"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547033663, "post_id": 54108188, "comment_id": 95050475, "body": "@KamilCuk The <code>auto</code> keyword was there just to illustrate, that it is about a local variable. If I declare <code>unsigned int a;</code> then in <code>main</code> this: <code>a = a | ( 1 &lt;&lt; 3 );</code> is a valid operation on <code>a</code> because <code>a</code> is initialized with <code>0</code>. But you do know  what happens if  <code>unsigned int a;</code> is declared in <code>main</code> followed by <code>a = a | ( 1 &lt;&lt; 3 );</code>."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547034131, "post_id": 54108188, "comment_id": 95050723, "body": "<code>int x = x + 1</code> is also valid code and I don&#39;t see bit operations any special here. Uninitialized variables have what is called &quot;indeterminate value&quot; (read as: any value) <a href=\"https://port70.net/~nsz/c/c11/n1570.html#3.19.2p1\" rel=\"nofollow noreferrer\">C11 3.19.2p1</a>. You can even use it (if it isn&#39;t a trap representation, for <code>int</code> it hardly can be). But it could be anything. There even existed C code which used uninitialized variables to generate random numbers. It doesn&#39;t make the code &quot;invalid&quot; in itself."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1547042864, "post_id": 54108188, "comment_id": 95055993, "body": "<code>1 &lt;&lt; 3</code> is an <i>integer constant expression</i>. All such expressions are evaluated at compile time. The machine code generated will be the same as for <code>a = 8;</code>. This has nothing to do with the storage duration of the variable. The resulting machine code will be something that loads value 8 into a byte."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1547092362, "post_id": 54108188, "comment_id": 95075422, "body": "Assignment means that the new value completely replaces the old value. It is not a partial update or anything like that"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8695089"}, "edited": false, "score": 0, "creation_date": 1547031280, "post_id": 54108412, "comment_id": 95049038, "body": "<code>a |= (1 &lt;&lt; 8);</code> has nothing wiht my Question. I wasn&#39;t looking for an solution."}, {"owner": {"reputation": 36, "user_id": 10888335, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-R5zo65IT3yY/AAAAAAAAAAI/AAAAAAAAB_A/bsm3Toe_UiE/photo.jpg?sz=128", "display_name": "BlackBear", "link": "https://stackoverflow.com/users/10888335/blackbear"}, "edited": false, "score": 0, "creation_date": 1547037219, "post_id": 54108412, "comment_id": 95052605, "body": "Oh, I&#39;m so sorry. I&#39;m not good at english, so I was misunderstand. :&#39;("}], "tags": [], "owner": {"reputation": 36, "user_id": 10888335, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-R5zo65IT3yY/AAAAAAAAAAI/AAAAAAAAB_A/bsm3Toe_UiE/photo.jpg?sz=128", "display_name": "BlackBear", "link": "https://stackoverflow.com/users/10888335/blackbear"}, "is_accepted": false, "score": 0, "last_activity_date": 1547030991, "creation_date": 1547030991, "answer_id": 54108412, "question_id": 54108188, "link": "https://stackoverflow.com/questions/54108188/how-does-compiler-treat-an-automatic-variable-when-binary-operation-are-involved/54108412#54108412", "title": "How does compiler treat an automatic variable when binary operation are involved in assignment", "body": "<pre><code>auto unsigned int a; //a is garbage value yet\na = 1 &lt;&lt; 8; // a assign 1&lt;&lt;8(256) to a. a will be 1 &lt;&lt; 8.\n</code></pre>\n\n<p>if you want to setting 8th bitmask, then you have to like this:</p>\n\n<pre><code>a |= (1 &lt;&lt; 8); //not assign, just set bitmask.\n</code></pre>\n\n<p>then working like your expecting.</p>\n"}, {"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1547043113, "post_id": 54108642, "comment_id": 95056149, "body": "<code>1 &lt;&lt; 3</code> is an integer constant expression so it will not get translated to ROL or any other bit shifting instruction. Because it will be calculated at compile-time, regardless of optimizer settings. The machine code will be something that writes the value 8 to a byte."}], "tags": [], "owner": {"reputation": 2462, "user_id": 2705907, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/e2UTS.jpg?s=128&g=1", "display_name": "Vagish", "link": "https://stackoverflow.com/users/2705907/vagish"}, "is_accepted": true, "score": 1, "last_activity_date": 1547091901, "last_edit_date": 1592644375, "creation_date": 1547031667, "answer_id": 54108642, "question_id": 54108188, "link": "https://stackoverflow.com/questions/54108188/how-does-compiler-treat-an-automatic-variable-when-binary-operation-are-involved/54108642#54108642", "title": "How does compiler treat an automatic variable when binary operation are involved in assignment", "body": "<p>Lets go step by step for the expression  <code>a = 1&lt;&lt;3</code></p>\n<ol>\n<li><p>This is a simple assignment statement where <code>lvalue</code> should be evaluated. So <code>1 &lt;&lt; 3</code> will be evaluated to <code>8</code> . As Both <code>1</code> and <code>3</code> are integer literals and compiler may generate a assembly instruction somewhat like <code>ROL 1,3</code> --&gt; Rotate 1 to left by 8 and store result in accumulator.</p>\n<p><code>&lt;&lt;</code> has higher precedance than <code>=</code>.</p>\n</li>\n<li><p>Till now we dont know where we need to store the result of above step.\nAs <code>a</code> auto variable compiler may decide to store it on a <code>stack</code> segment. Pseudo\ninstruction could be  <code>MOV @SP+4, A</code> --&gt; Move data of accumulator into a location\npointed by stack pointer with offset 4.</p>\n</li>\n</ol>\n<p>As you said correctly <code>a</code> will have garbage value initially. But this does not affect the second statement.</p>\n<p>P.S: All assembly instructions will be platform specific, Above steps are for example only.</p>\n<p><strong>EDIT</strong></p>\n<p>As pointed out by Lundin <code>1&lt;&lt;3</code> is integer constant expression so it will b evaluated compile time. So we may end up with a single run-time step which will be copying <code>8</code> onto stack.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8695089"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 54108642, "answer_count": 2, "score": 1, "last_activity_date": 1547091901, "creation_date": 1547030307, "last_edit_date": 1547040166, "question_id": 54108188, "link": "https://stackoverflow.com/questions/54108188/how-does-compiler-treat-an-automatic-variable-when-binary-operation-are-involved", "title": "How does compiler treat an automatic variable when binary operation are involved in assignment", "body": "<p>I would like to know if Compile (or the language) treats different a variable like:</p>\n\n<pre><code>auto unsigned int a;\na = 8;\n</code></pre>\n\n<p>from:</p>\n\n<pre><code>auto unsigned int a;\na = 1 &lt;&lt; 3;\n</code></pre>\n\n<p>To be more precise , here <code>a = 8</code> in the location of <code>a</code> it will be written the value <code>8</code>, so there is no importance which value was there (even if there is garbage).</p>\n\n<p>What I am not sure is how does exactly works in this situation <code>a = 1 &lt;&lt; 3</code>.</p>\n\n<p>I am sure that, inside <code>a</code> there is a garbage value, and if for example <code>a == 1341</code> ( a garbage value ), then <code>a = 1 &lt;&lt; 3</code> results in <code>8</code>.</p>\n\n<p>But if <code>1341</code> in binary representation means:</p>\n\n<p><code>00000101 00111101</code></p>\n\n<p>then I was expecting to be <code>10728</code>:</p>\n\n<p><code>00101001 11101000</code>.</p>\n\n<p>What I am not really sure here is, does <code>a</code> being treated as <code>00000000</code>?</p>\n\n<p>In this form <code>a</code> gets initialized to <code>0</code> before the operation on the left is being executed?</p>\n\n<p>Something like <code>00000000 = 1 &lt;&lt; 3</code>?</p>\n\n<p>Where <code>a</code> becomes <code>0000 1000</code>, or how really works in this situation?</p>\n\n<p>I do understand this <code>unsigned int a = 0</code>, then <code>a = a &lt;&lt; 3</code> would be <code>8 = 0000 1000</code>, but this is different from my Question, because here <code>a &lt;&lt;</code> the operations is on <code>a</code> and not on <code>1</code> like in my Question.</p>\n"}, {"tags": ["c", "api", "tensorflow", "installation"], "owner": {"reputation": 23, "user_id": 7310691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9e02fd79925fc920769456bda1cf7f5?s=128&d=identicon&r=PG&f=1", "display_name": "Sarah Connorh", "link": "https://stackoverflow.com/users/7310691/sarah-connorh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 167, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1547036534, "creation_date": 1547030301, "last_edit_date": 1547036534, "question_id": 54108186, "link": "https://stackoverflow.com/questions/54108186/install-c-api-for-tensorflow-on-ubuntu", "title": "Install C API for TensorFlow on Ubuntu", "body": "<p>I'm trying to set TensorFlow C API on Ubuntu environment.Following <a href=\"https://www.tensorflow.org/install/lang_c\" rel=\"nofollow noreferrer\">https://www.tensorflow.org/install/lang_c</a> this guide.</p>\n\n<p>When I arrived to this point: <code>sudo tar -xz libtensorflow.tar.gz -C /usr/local</code></p>\n\n<p>ERROR: <code>missing -F parameters</code>;</p>\n\n<p>By the way, I tried another time with this procedure:</p>\n\n<pre><code>TF_TYPE=\"gpu\" # Change to \"gpu\" for GPU support\n\nOS=\"Linux\" # Change to \"darwin\" for macOS\n\nTARGET_DIRECTORY=\"/usr/local/\"\n\ncurl -L \"https://storage.googleapis.com/tensorflow/libtensorflow/libtensorflow-${TF_TYPE}-${OS}-x86_64-1.6.0.tar.gz\" | sudo tar -C $TARGET_DIRECTORY -xz\n</code></pre>\n\n<p>But I got an error too: <code>TARGET_DIRECTORY: cmd not found</code></p>\n\n<p>I tried: <a href=\"https://stackoverflow.com/q/49637146\">How to install C api for tensorflow 1.7, cuda 9.1</a></p>\n\n<p>I expected C TensorFlow API to be installed but it isn't.</p>\n"}, {"tags": ["c", "operator-precedence"], "comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 2, "creation_date": 1547030485, "post_id": 54107946, "comment_id": 95048520, "body": "Please note that the linked precedence table has errors (they put cast operator in the wrong group, there are 17 groups not 15 etc). Most such tables have errors, since the C standard doesn&#39;t list such a table. At one point I got sick of all these bad tables and attempted to made one myself <a href=\"https://stackoverflow.com/questions/17369090/operator-precedence-table-for-the-c-programming-language\">here</a>. However, the formatting is icky since it is a screen shot :/"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1547030841, "post_id": 54107946, "comment_id": 95048751, "body": "@Lundin I&#39;d say your table is wrong because it puts casts in the wrong group. Casts are unary (prefix) operators, and you cannot have prefix operators with different precedence levels. Also, primary expressions are not operators."}, {"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1547033432, "post_id": 54107946, "comment_id": 95050343, "body": "@melpomene Unary operators and casts are in different groups in standard (grouping specified in C17 draft 6.5 p3), with casts having lower precedence."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1547033522, "post_id": 54107946, "comment_id": 95050396, "body": "@melpomene The C standard C17 6.5.4 is the group with cast operators (there&#39;s just one). Which as indicated by the syntax has lower precedence than unary operators. My table follows the standard groups and syntax, unlike the one at cppreference."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1547033739, "post_id": 54107946, "comment_id": 95050515, "body": "@Lundin I see <code>cast-expression: unary-expression | ...</code> and <code>unary-expression: unary-operator cast-expression | ...</code>, so they&#39;re mutually recursive and neither has higher precedence than the other. The only reason they&#39;re in different groups is a sort of grammar hack to remove ambiguity with <code>sizeof</code>: According to the grammar, <code>sizeof (int) + 0</code> parses unambiguously as <code>(sizeof (int)) + 0</code>, not <code>sizeof ((int)+0)</code> (i.e. there is no cast in this expression)."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1547035638, "post_id": 54107946, "comment_id": 95051649, "body": "@melpomene The whole chapter 6.5 syntax is built so that each operator lists the one with higher precedence before the operators of its own group. You&#39;ll find <code>multiplicative-expression: cast-expression ...</code> next in line."}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 6595, "user_id": 5218277, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZuEZa.jpg?s=128&g=1", "display_name": "Alex Lop.", "link": "https://stackoverflow.com/users/5218277/alex-lop"}, "edited": false, "score": 0, "creation_date": 1547030029, "post_id": 54108020, "comment_id": 95048229, "body": "@AlexLop. It also says the first column is <i>Precedence</i>. All lines within the same row of the table have the same precedence."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "reply_to_user": {"reputation": 6595, "user_id": 5218277, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZuEZa.jpg?s=128&g=1", "display_name": "Alex Lop.", "link": "https://stackoverflow.com/users/5218277/alex-lop"}, "edited": false, "score": 0, "creation_date": 1547030036, "post_id": 54108020, "comment_id": 95048233, "body": "@AlexLop. It&#39;s the &quot;Precedence&quot; column that&#39;s listed from top to bottom, with <code>1</code> being the highest and <code>15</code> being the lowest. All operators on the same level have the same precedence."}, {"owner": {"reputation": 6595, "user_id": 5218277, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZuEZa.jpg?s=128&g=1", "display_name": "Alex Lop.", "link": "https://stackoverflow.com/users/5218277/alex-lop"}, "edited": false, "score": 0, "creation_date": 1547030988, "post_id": 54108020, "comment_id": 95048852, "body": "Thanks for the great answer. I am glad that I just misunderstood the chart."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 4, "last_activity_date": 1547030214, "last_edit_date": 1547030214, "creation_date": 1547029722, "answer_id": 54108020, "question_id": 54107946, "link": "https://stackoverflow.com/questions/54107946/operator-precedence-and-order-of-evaluation-for-complex-expression/54108020#54108020", "title": "Operator precedence and order of evaluation for complex expression", "body": "<p>The table you linked to shows all assignment operators (including <code>=</code> and <code>*=</code>) at the same precedence level: 14.</p>\n\n<p>They're also right associative, so <code>x = y *= z</code> parses as <code>x = (y *= z)</code>, as expected.</p>\n\n<hr>\n\n<p>If <code>=</code> had a higher precedence than <code>*=</code>, then <code>x = y *= z</code> would parse as <code>(x = y) *= z</code>, which would be a hard error because <code>=</code> doesn't yield an lvalue (you cannot assign to the result of an assignment). If <code>=</code> did return its left operand as an lvalue, then <code>(x = y) *= z</code> would have undefined behavior because it's modifying <code>x</code> twice without an intervening sequence point. And if there were a sequence point after the inner assignment, the final values of the variables after <code>(*pVal = i) *= 10</code> would be <code>i = 8</code> (unmodified) and <code>*pVal = 80</code>.</p>\n\n<p><a href=\"https://tio.run/##K0gtyjH9/7@0OFWhuKQoM7nEmgvELk8sysvMSy@25uLKrVRQKUvMUbBVMLAGcwrCwLwYkChEJBPItQAq1VCBSapkaipo2SoYArUUFGXmlSgoZYJFrRVgCsAqY/KUrP//BwA\" rel=\"nofollow noreferrer\">Live demo</a> (using Perl, which has a <code>=</code> that returns an lvalue as described above)</p>\n"}], "owner": {"reputation": 6595, "user_id": 5218277, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZuEZa.jpg?s=128&g=1", "display_name": "Alex Lop.", "link": "https://stackoverflow.com/users/5218277/alex-lop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 54108020, "answer_count": 1, "score": 5, "last_activity_date": 1547031282, "creation_date": 1547029524, "last_edit_date": 1547031282, "question_id": 54107946, "link": "https://stackoverflow.com/questions/54107946/operator-precedence-and-order-of-evaluation-for-complex-expression", "title": "Operator precedence and order of evaluation for complex expression", "body": "<p>I was looking at the following code:</p>\n\n<pre><code>#include &lt;stdint.h&gt;\n\nvoid foo(uint32_t *pVal)\n{\n  uint32_t i = 8;\n\n  *pVal = i *= 10;\n}\n</code></pre>\n\n<p>At the first glance it is clear that before returning from <code>foo()</code>, <code>*pVal</code> would be 80 as well as the value of <code>i</code>. And this is indeed what happens according to <a href=\"https://godbolt.org/z/elQqfE\" rel=\"nofollow noreferrer\">godbolt.org</a>:</p>\n\n<pre><code>foo:                                    # @foo\n        push    rbp\n        mov     rbp, rsp\n        mov     qword ptr [rbp - 8], rdi\n        mov     dword ptr [rbp - 12], 8\n        imul    eax, dword ptr [rbp - 12], 10\n        mov     dword ptr [rbp - 12], eax\n        mov     rdi, qword ptr [rbp - 8]\n        mov     dword ptr [rdi], eax\n        pop     rbp\n        ret\n</code></pre>\n\n<p>However after checking the operator precedence from <a href=\"https://en.cppreference.com/w/c/language/operator_precedence\" rel=\"nofollow noreferrer\">here</a>, the precedence of <code>=</code> is higher than the precedence of <code>*=</code>, so it seems that the value of <code>*pVal</code> should be 8 and the value of <code>i</code> should be 80...</p>\n\n<p>What am I missing here?</p>\n\n<p><strong>EDIT</strong>:</p>\n\n<p>In addition to the great answer by <a href=\"https://stackoverflow.com/users/1848654/melpomene\">melpomene</a>, there is also a nice <a href=\"https://en.wikipedia.org/wiki/Operators_in_C_and_C%2B%2B\" rel=\"nofollow noreferrer\">Wikipedia page</a>.</p>\n"}, {"tags": ["c", "ipc", "data-segment"], "answers": [{"tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": false, "score": 0, "last_activity_date": 1547029297, "creation_date": 1547029297, "answer_id": 54107870, "question_id": 54107602, "link": "https://stackoverflow.com/questions/54107602/memory-allocation-for-data-segment-not-happening-properly-for-each-static-and-gl/54107870#54107870", "title": "Memory allocation for Data segment not happening properly for each static and global(uninitialized/ initialized variable)", "body": "<blockquote>\n  <p>We can clearly see that bss and data segment is simultaneously getting updated</p>\n</blockquote>\n\n<p>This is the distinction between where the initial values != 0 are saved and where the static/global variables are</p>\n\n<p>Before the <em>main</em> execution the initial values !=0 are copied into the global/static variables, the global/static variables having the initial value 0 are also set to 0 of course</p>\n"}], "owner": {"reputation": 1, "user_id": 7980469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83e6cceeff5a1d139e4c2292425a3011?s=128&d=identicon&r=PG&f=1", "display_name": "pratik", "link": "https://stackoverflow.com/users/7980469/pratik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547029297, "creation_date": 1547028451, "question_id": 54107602, "link": "https://stackoverflow.com/questions/54107602/memory-allocation-for-data-segment-not-happening-properly-for-each-static-and-gl", "title": "Memory allocation for Data segment not happening properly for each static and global(uninitialized/ initialized variable)", "body": "<p>I am trying to understand how memory allocation works for any C code which is executed or compiled.</p>\n\n<p>I have written following 5 separate small codes which will help me understand the memory allocation process.</p>\n\n<ol>\n<li><p>segment_size1.c</p>\n\n<pre><code>int main(){\n    printf(\"hellow world\");\n    return 0;\n}\n</code></pre></li>\n<li><p>segment_size2.c</p>\n\n<pre><code>//Adding uninitialized static int variable This would increase the size of BSS by 4 bytes.\nint main()\n{\n    static int mystatic;\n    printf(\"Hellow world\");\n    return 0;\n}\n</code></pre></li>\n<li><p>segment_size3.c</p>\n\n<pre><code>// Adding initialized static int variable, this would increase the size of initialized data\n// segment by 4 bytes.\n\nint main()\n{\n        static int mystatic;\n        static int mystatic1 = 100;\n        printf(\"Hellow world\");\n        return 0;\n}\n</code></pre></li>\n<li><p>segment_size4.c</p>\n\n<pre><code>// Adding un-initialized global int variable, this would increase the size of BSS segment by 4 bytes.\n\nint myglobal;\nint main()\n{\n        static int mystatic;\n        static int mystatic1 = 100;\n        printf(\"Hellow world\");\n        return 0;\n}\n</code></pre></li>\n<li><p>segment_size5.c</p>\n\n<pre><code>// Adding initialized global int variable, this would increase the size of data segment by 4 bytes.\n\nint myglobal;\nint myglobal2 = 500;\nint main()\n{\n    static int mystatic;\n    static int mystatic1 = 100;\n    printf(\"Hellow world\");\n    return 0;\n}\n</code></pre></li>\n</ol>\n\n<p>According to my understanding, if we compile above files then after compiling segment_size2.c BSS size should get incremented by 4 bytes and after compiling segment_size3.c Data size should get incremented by 4 bytes. \nBut when I hit size command, I got following results,</p>\n\n<pre><code>    size segment_size1 segment_size2 segment_size3 segment_size4 segment_size5\n       text    data     bss     dec     hex filename\n       1217     560       8    1785     6f9 segment_size1\n       1217     560       8    1785     6f9 segment_size2\n       1217     564      12    1793     701 segment_size3\n       1217     564      12    1793     701 segment_size4\n       1217     568      16    1801     709 segment_size5\n</code></pre>\n\n<p>Here We can clearly see that bss and data segment is simultaneously getting updated after compiling segment_size3. How is this possible?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 7, "creation_date": 1547028393, "post_id": 54107505, "comment_id": 95047268, "body": "Where in your code is it crashing? Run it in a debugger and it will tell you what line number the problem is"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547028456, "post_id": 54107505, "comment_id": 95047315, "body": "Run your program under <i>valgrind</i>"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 1, "creation_date": 1547028529, "post_id": 54107505, "comment_id": 95047352, "body": "Without the content of <i>/Users/a123/Desktop/Ear_relo/plot_seis/iasp91.dat</i> it is not possible for us to execute your program"}, {"owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "edited": false, "score": 1, "creation_date": 1547028955, "post_id": 54107505, "comment_id": 95047578, "body": "<a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> needed!!!"}, {"owner": {"reputation": 12106, "user_id": 4431643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CoZjt.jpg?s=128&g=1", "display_name": "kiran Biradar", "link": "https://stackoverflow.com/users/4431643/kiran-biradar"}, "edited": false, "score": 0, "creation_date": 1547029251, "post_id": 54107505, "comment_id": 95047757, "body": "Where do you allocated memory to <code>float *radius=NULL,*alpha_s=NULL,*beta_s=NULL</code>? I see code which initializes the pointed out variables are commented out."}], "answers": [{"tags": [], "owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "is_accepted": false, "score": 1, "last_activity_date": 1547030262, "last_edit_date": 1547030262, "creation_date": 1547029841, "answer_id": 54108051, "question_id": 54107505, "link": "https://stackoverflow.com/questions/54107505/c-language-segmentation-fault-11-unclear-error/54108051#54108051", "title": "C language: Segmentation Fault: 11. Unclear error", "body": "<pre><code>source model_search(float evdp, float a_radius, char *file) {\n    float *radius=NULL, ...\n        fscanf(f,\"%f %f %f\", &amp;radius[i] ...\n</code></pre>\n\n<p><code>&amp;radius[i]</code> is here equal to <code>(uintptr_t)NULL + sizeof(float) * i</code> which is an invalid pointer value. <code>fscanf</code> tries to dereference thater point and assign float value to it. Dereferencing invalid pointer value is undefined behaviour and the assigment most probably results in seg fault on unix systems.</p>\n\n<ol>\n<li><a href=\"https://stackoverflow.com/help/mcve\">MCVE</a> is the <em>minimal</em> example needed to reproduce the error. One could debug your program with simple <code>printf</code> statements until seeing which statement produces seg fault.</li>\n<li><blockquote>\n  <p>It sounds like you may need to learn how to use a debugger to step through your code. With a good debugger, you can execute your program line by line and see where it is deviating from what you expect. This is an essential tool if you are going to do any programming.  Further reading: <strong><a href=\"http://ericlippert.com/2014/03/05/how-to-debug-small-programs/\" rel=\"nofollow noreferrer\">How to debug small programs</a></strong>]</p>\n</blockquote></li>\n<li>In code you have <code>for(...; feof(...); ...)</code> which is always wrong. See <a href=\"https://stackoverflow.com/questions/5431941/why-is-while-feof-file-always-wrong\">Why is \u201cwhile ( !feof (file) )\u201d always wrong?</a>. In your case on the last line, the <code>fscanf</code> finds EOF, so the last line is incorrectly handled in your code. You should check the return value of <code>fscanf</code>.</li>\n<li>Check errors. Try to check all errors.</li>\n<li>In <code>main()</code> the <code>float *takeoff=NULL,*takeoff1=NULL,*azi=NULL,*azi1=NULL;</code> are never assigned a valid pointer, only NULLs. Inside <code>linspace</code> you check <code>if (... &amp;&amp; u == 0) return 0;</code>, so <code>takeoff = linspace(..., takeoff)</code> still results in <code>takeoff = NULL</code>. Accessing NULL at <code>t0 = takeoff[i];</code> inside <code>main()</code> is undefined behavior and most probably will seg fault too.</li>\n<li>It's really a personal taste, but for simple programmer errors, it's nice to use assertions. <code>linspace(...., float u[]) { assert(u != NULL); ...}</code>.</li>\n</ol>\n"}], "owner": {"reputation": 1, "user_id": 10886951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dda237fc90e45419057399663852e4c1?s=128&d=identicon&r=PG&f=1", "display_name": "Hans", "link": "https://stackoverflow.com/users/10886951/hans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547030262, "creation_date": 1547028139, "last_edit_date": 1547029645, "question_id": 54107505, "link": "https://stackoverflow.com/questions/54107505/c-language-segmentation-fault-11-unclear-error", "title": "C language: Segmentation Fault: 11. Unclear error", "body": "<p>I am trying to use this c program to do the numerical modeling.  It has been successfully compiled. However, when I am trying to input:</p>\n\n<p><code>./forward 0.0 0.0 1.0 3.00 100.0</code>.</p>\n\n<p>It keeps reminding me: \n       <code>segmentation fault: 11</code>. </p>\n\n<p>I do not know what goes wrong. My code is as following: </p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\n#include&lt;string.h&gt;\n#include&lt;math.h&gt;\n#include\"util_err.h\"\n#define pi 3.1415926\n#define MAX_Array 16000\n\ntypedef struct source {\n    float vp;\n    float ev_radius;\n} source;\n\nsource model_search(float evdp, float a_radius, char *file){\n    int i;\n    float *radius=NULL,*alpha_s=NULL,*beta_s=NULL;\n    float *z_s=NULL;\n    source sour;\n    FILE *f;\n    /*radius = vector(0,MAX_Array-1);\n    alpha_s = vector(0,MAX_Array-1);\n    beta_s = vector(0,MAX_Array-1);\n    z_s = vector(0,MAX_Array-1);*/\n    f = fopen(file,\"r\");\n    if (f==NULL)\n    {\n        nrerror(\"unable to open the file\");\n    }\n    sour.vp = 0;\n    sour.ev_radius = 0;\n    for(i=0;!feof(f);i++){\n        fscanf(f,\"%f %f %f\",&amp;radius[i],&amp;alpha_s[i],&amp;beta_s[i]);\n        z_s[i] = a_radius - radius[i];\n        if(i==0) continue;\n        if(evdp&gt;=z_s[i-1]&amp;&amp;evdp&lt;=z_s[i]){\n            sour.vp = alpha_s[i-1]+(evdp-z_s[i-1])/(z_s[i]-z_s[i-1])\n                *(alpha_s[i]-alpha_s[i-1]);\n            sour.ev_radius = a_radius-evdp;\n            printf(\"vp = %f\\n\",sour.vp);\n            printf(\"ev_radius = %f\\n\",sour.ev_radius);\n            break;\n        }\n    } \n    fclose(f);  \n    return sour;\n}\n\nfloat* linespace(float fl, float fr, int n){\n    int i;\n    static float *u=NULL,interval;\n    interval = (fr-fl)/(n-1);\n    for(i=0;i&lt;n-1;i++){\n        u[i] = fl + i * interval;\n    }\n    u[n-1] = fr;\n    return u;\n}\n/* Input: x, y, z, t0, evdp*/\nint main(int argc,char **argv){\n    int i,j;\n    int sto,sto1,sa,sa1;\n    float x,y,z,origin_time;\n    float travel_time,evdp,a_radius=6371.1;\n    float *takeoff=NULL,*takeoff1=NULL,*azi=NULL,*azi1=NULL;\n    float t0,az;\n    char filename[160];\n    source sour;\n    FILE *fp=NULL,*fp1=NULL;\n    fp=fopen(\"data.dat\",\"w\");\n\n    if(fp==NULL){\n        nrerror(\"unable to allocate\");\n    }\n    fp1=fopen(\"data1.dat\",\"w\");\n    if(fp1==NULL){\n        nrerror(\"unable to allocate\");\n    }\n    if(argc&lt;6){\n        nrerror(\"Too few arguments!\");\n    }\n    x = atof(argv[1]);\n    y = atof(argv[2]);\n    z = atof(argv[3]);\n    origin_time = atof(argv[4]);\n    evdp = atof(argv[5]);\n    strcpy(filename,\"/Users/a123/Desktop/Ear_relo/plot_seis/iasp91.dat\");\n    sour = model_search(evdp,a_radius,filename);\n    printf(\"vp = %f, ev_radius = %f\",sour.vp,sour.ev_radius);\n    sto = 91;\n    sto1 = 10;\n    sa = 361;\n    sa1 = 37;\n    takeoff = linespace(0.0,90.0,sto);\n    takeoff1 = linespace(0.0,90.0,sto1);\n    azi = linespace(0.0,360.0,sa);\n    azi1 = linespace(0.0,360.0,sa1);\n/*  write data.dat for the background values */\n    for(i=0;i&lt;sto;i++){\n        t0 = takeoff[i];\n        for(j=0;j&lt;sa;j++){\n            az = azi[j];\n            travel_time = -x*cos(az*pi/180)*sin(t0*pi/180)\n                -y*sin(az*pi/180)*sin(t0*pi/180)+z*cos(t0*pi/180);\n            travel_time = travel_time/sour.vp + origin_time;\n            fprintf(fp, \"%5.1f %5.1f %13.8f\\n\", az,t0,travel_time); \n        }\n    }\n/* write data1.dat */\n    for(i=0;i&lt;sto1;i++){\n        t0 = takeoff1[i];\n        for(j=0;j&lt;sa1;j++){\n            az = azi1[j];\n            travel_time = -x*cos(az*pi/180)*sin(t0*pi/180)\n                -y*sin(az*pi/180)*sin(t0*pi/180)+z*cos(t0*pi/180);\n            travel_time = travel_time/sour.vp + origin_time;\n            fprintf(fp1, \"%5.1f %5.1f %13.8f\\n\", az,t0,travel_time);\n        }\n    }\n    free(takeoff);\n    free(takeoff1);\n    free(azi);\n    free(azi1);\n    fclose(fp);\n    fclose(fp1);\n    return 0;\n\n}\n</code></pre>\n\n<p>This is my iasp91.dat file:</p>\n\n<pre><code>6371 5.8 3.36\n6370 5.8 3.36\n6369 5.8 3.36\n6368 5.8 3.36\n6367 5.8 3.36\n6366 5.8 3.36\n6365 5.8 3.36\n6364 5.8 3.36\n6363 5.8 3.36\n6362 5.8 3.36\n6361 5.8 3.36\n6360 5.8 3.36\n6359 5.8 3.36\n6358 5.8 3.36\n6357 5.8 3.36\n6356 5.8 3.36\n6355 5.8 3.36\n6354 5.8 3.36\n6353 5.8 3.36\n6352 5.8 3.36\n6351 5.8 3.36\n6351 6.5 3.75\n6350 6.5 3.75\n6349 6.5 3.75\n6348 6.5 3.75\n6347 6.5 3.75\n6346 6.5 3.75\n6345 6.5 3.75\n6344 6.5 3.75\n6343 6.5 3.75\n6342 6.5 3.75\n6341 6.5 3.75\n6340 6.5 3.75\n6339 6.5 3.75\n6338 6.5 3.75\n6337 6.5 3.75\n6336 6.5 3.75\n6336 8.04 4.47\n6331 8.0406 4.4718\n6326 8.0412 4.4735\n6321 8.0418 4.4753\n6311 8.0429 4.4788\n6301 8.0441 4.4824\n6291 8.0453 4.4859\n6281 8.0465 4.4894\n6271 8.0476 4.4929\n6261 8.0488 4.4965\n6251 8.05 4.5\n6251 8.05 4.5\n6241 8.0778 4.502\n6231 8.1056 4.504\n6221 8.1333 4.506\n</code></pre>\n\n<p>And the \"util_err.h\" declares the function --- nrerror.</p>\n\n<p>I do not know what the exact problem is but it seems to me that the problem is in the block linespace. </p>\n"}, {"tags": ["c", "file"], "comments": [{"owner": {"reputation": 2754, "user_id": 9134576, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIuMX.jpg?s=128&g=1", "display_name": "Letsintegreat", "link": "https://stackoverflow.com/users/9134576/letsintegreat"}, "edited": false, "score": 0, "creation_date": 1547028158, "post_id": 54107464, "comment_id": 95047143, "body": "Why do you want to do that?"}, {"owner": {"reputation": 19, "user_id": 10721955, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vNktb4JFUCc/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hrYogHakxmY4klYr0jG0nDx6yKPA/mo/photo.jpg?sz=128", "display_name": "Aimin", "link": "https://stackoverflow.com/users/10721955/aimin"}, "reply_to_user": {"reputation": 2754, "user_id": 9134576, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIuMX.jpg?s=128&g=1", "display_name": "Letsintegreat", "link": "https://stackoverflow.com/users/9134576/letsintegreat"}, "edited": false, "score": 0, "creation_date": 1547028286, "post_id": 54107464, "comment_id": 95047216, "body": "@Zlytherin  because i have to display which lines are different"}, {"owner": {"reputation": 6751, "user_id": 1417063, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mwy5e.jpg?s=128&g=1", "display_name": "Davide Spataro", "link": "https://stackoverflow.com/users/1417063/davide-spataro"}, "edited": false, "score": 1, "creation_date": 1547028329, "post_id": 54107464, "comment_id": 95047235, "body": "I do not see why you need to jump to a specific line. According to the statement, you need to compare <i>all</i> lines and print the line number of those that differ."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547028394, "post_id": 54107464, "comment_id": 95047269, "body": "Unless each line is <i>exactly</i> the same length, then it&#39;s really impossible to &quot;jump&quot; (or seek) to a specific line without reading all previous lines."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1547028426, "post_id": 54107464, "comment_id": 95047291, "body": "Also note that <a href=\"https://en.cppreference.com/w/c/io/fgetc\" rel=\"nofollow noreferrer\"><code>getc</code></a> returns an <code>int</code>. That is actually very important for the <code>EOF</code> checks."}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1547028866, "post_id": 54107625, "comment_id": 95047519, "body": "You can jump to a specific byte in the file. That doesn&#39;t help with (variable length) lines, but you don&#39;t necessarily have to start at the beginning."}], "tags": [], "owner": {"reputation": 8351, "user_id": 4279155, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/841b7391f3f7873bec1a8d9d8d2dc759?s=128&d=identicon&r=PG&f=1", "display_name": "Dominique", "link": "https://stackoverflow.com/users/4279155/dominique"}, "is_accepted": false, "score": 0, "last_activity_date": 1547028539, "creation_date": 1547028539, "answer_id": 54107625, "question_id": 54107464, "link": "https://stackoverflow.com/questions/54107464/how-to-start-read-a-file-at-a-specific-position/54107625#54107625", "title": "how to start read a file at a specific position", "body": "<p>There are three ways to handle the content of a file:</p>\n\n<ul>\n<li>Read it : you always start at the beginning of the file.</li>\n<li>Write it (starting a new file) : as you start a new file, you automatically start at the beginning.</li>\n<li>Append : you add extra content, starting at the end of a file.</li>\n</ul>\n\n<p>As you can see, there is no way to start reading a file from a certain line number, or based on the existing content. The only thing you can do is start reading the file from the beginning and browse through the file until you get at the piece of content you're interested in.</p>\n"}, {"tags": [], "owner": {"reputation": 6751, "user_id": 1417063, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mwy5e.jpg?s=128&g=1", "display_name": "Davide Spataro", "link": "https://stackoverflow.com/users/1417063/davide-spataro"}, "is_accepted": true, "score": 1, "last_activity_date": 1547028995, "creation_date": 1547028995, "answer_id": 54107771, "question_id": 54107464, "link": "https://stackoverflow.com/questions/54107464/how-to-start-read-a-file-at-a-specific-position/54107771#54107771", "title": "how to start read a file at a specific position", "body": "<p>An approach would be to <strong>read the file line by line</strong> and start the actual processing when you reach the line that you are looking for:</p>\n\n<p>You can use something like the following to jump to a specific line:</p>\n\n<pre><code>char line[256]; /* or other suitable maximum line size */\n\nwhile (fgets(line, sizeof line, file) != NULL) /* read a line */\n{\n    if (count &gt;= lineNumber)\n    {\n        //process your line in here.\n    }\n    else\n    {\n        count++;\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>I do not think you need to jump to a specific line in order to solve that problem. I would personally solve using something like the following :</p>\n\n<p><strong>IT IS PSEUDO-C - NOT TESTED</strong></p>\n\n<pre><code>    int count = 0;\n    char line1[256]; /* or other suitable maximum line size */\n    char line2[256]; /* or other suitable maximum line size */\n\n    int read1 =  fgets(line1, sizeof line1, file1);\n    int read2 =  fgets(line2, sizeof line2, file2);\n    while (read1 != NULL &amp;&amp; read2 != NULL)\n    {\n        if( strcmp ( line1, line2))\n        {\n          //lines are different. print line number and other info   \n        }\n        read1 =  fgets(line1, sizeof line1, file1);\n        read2 =  fgets(line2, sizeof line2, file2);\n    }\n    fclose(file);\n}\n</code></pre>\n\n<p>The previous code is also not handling when files have different number of lines. You should be able to extend yourself.</p>\n"}], "owner": {"reputation": 19, "user_id": 10721955, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vNktb4JFUCc/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hrYogHakxmY4klYr0jG0nDx6yKPA/mo/photo.jpg?sz=128", "display_name": "Aimin", "link": "https://stackoverflow.com/users/10721955/aimin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 54107771, "answer_count": 2, "score": 1, "last_activity_date": 1547028995, "creation_date": 1547028005, "last_edit_date": 1592644375, "question_id": 54107464, "link": "https://stackoverflow.com/questions/54107464/how-to-start-read-a-file-at-a-specific-position", "title": "how to start read a file at a specific position", "body": "<blockquote>\n<p>Exercise</p>\n<p>Write a program that will compare two text files whose names will be given as a call arguments.\nThis comparison should be carried out line by line, printing out on the screen those lines that differ\nfrom the same line in the other file. Print the lines with its line numbers and names of the file they\ncome from. The line numbers should be relative to the beginning of the file, i.e. the first line should\nhave the number 1, the second number 2, etc.</p>\n</blockquote>\n<p>I wrote such a program, but I do not understand how to start read this file from a specific line</p>\n<pre><code>int main(void)\n{\n   FILE *a = fopen(&quot;D:\\\\lab9.txt&quot;);\n   FILE *b = fopen(&quot;D:\\\\lab9.1.txt&quot;);\n   \n   int position = 0, line = 1, error = 0;\n   \n   if(a == NULL || b == NULL)\n   {\n       perror(&quot;Error occured while opening file.&quot;);\n       exit(0);\n   }\n    \n    \n    char x = getc(a);\n    char y = getc(b);\n    \n    while(x != EOF &amp;&amp; y != EOF)\n    {\n       position++;\n       \n       if(x == '\\n' &amp;&amp; y == '\\n')\n       {\n           line++;\n           pos = 0;\n       }\n    \n    \n    if(x != y)\n    {\n        error++\n    }\n      x = getc(a);\n      y = getc(b);\n    \n    }\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547028148, "post_id": 54107449, "comment_id": 95047138, "body": "Are the &quot;input&quot; part of an array? Then use a simple loop with <code>strcat</code>?"}, {"owner": {"reputation": 65, "user_id": 10242754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b47a568d62141a009b80a391384a820?s=128&d=identicon&r=PG&f=1", "display_name": "gov", "link": "https://stackoverflow.com/users/10242754/gov"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547028203, "post_id": 54107449, "comment_id": 95047172, "body": "I have in existed code, where inputs are coming from different modules."}, {"owner": {"reputation": 65, "user_id": 10242754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b47a568d62141a009b80a391384a820?s=128&d=identicon&r=PG&f=1", "display_name": "gov", "link": "https://stackoverflow.com/users/10242754/gov"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1547028275, "post_id": 54107449, "comment_id": 95047207, "body": "@Someprogrammerdude no variables are different. :("}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1547028934, "post_id": 54107449, "comment_id": 95047569, "body": "Why do you have more than fifty separate variables in a single function?"}, {"owner": {"reputation": 1894, "user_id": 8473031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4878bfc9d6a80397a8446111fffa4dd?s=128&d=identicon&r=PG&f=1", "display_name": "RoQuOTriX", "link": "https://stackoverflow.com/users/8473031/roquotrix"}, "edited": false, "score": 3, "creation_date": 1547029522, "post_id": 54107449, "comment_id": 95047920, "body": "Sounds like a <a href=\"https://en.wikipedia.org/wiki/XY_problem\" rel=\"nofollow noreferrer\">XY-Problem</a>"}, {"owner": {"reputation": 65, "user_id": 10242754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b47a568d62141a009b80a391384a820?s=128&d=identicon&r=PG&f=1", "display_name": "gov", "link": "https://stackoverflow.com/users/10242754/gov"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1547029623, "post_id": 54107449, "comment_id": 95047984, "body": "@melpomene It&#39;s a performance stats module, having multiple stats inputs coming from different modules."}, {"owner": {"reputation": 1894, "user_id": 8473031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4878bfc9d6a80397a8446111fffa4dd?s=128&d=identicon&r=PG&f=1", "display_name": "RoQuOTriX", "link": "https://stackoverflow.com/users/8473031/roquotrix"}, "edited": false, "score": 0, "creation_date": 1547029716, "post_id": 54107449, "comment_id": 95048027, "body": "@GoWind could you please provide more code, how you get and access the incoming data"}, {"owner": {"reputation": 65, "user_id": 10242754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b47a568d62141a009b80a391384a820?s=128&d=identicon&r=PG&f=1", "display_name": "gov", "link": "https://stackoverflow.com/users/10242754/gov"}, "edited": false, "score": 0, "creation_date": 1547033508, "post_id": 54107449, "comment_id": 95050389, "body": "edited question."}], "answers": [{"tags": [], "owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "is_accepted": false, "score": 0, "last_activity_date": 1547036241, "last_edit_date": 1547036241, "creation_date": 1547033745, "answer_id": 54109224, "question_id": 54107449, "link": "https://stackoverflow.com/questions/54107449/what-is-the-better-way-to-use-sprintf-for-multiple-inputs/54109224#54109224", "title": "what is the better way to use sprintf for multiple inputs?", "body": "<p>If splitting the single <code>sprintf</code> with 50 variables is the only issue, then you can use multiple <code>sprintf</code> calls and use the return value to calculate the buffer position for the next part.</p>\n\n<p>untested example</p>\n\n<pre><code>int chars;\nint pos = 0;\n\nchars = sprintf(buffer+pos, \"%s\", one);\nif(chars &gt; 0) pos += chars;\n\nchars = sprintf(buffer+pos, \",%s\", two);\nif(chars &gt; 0) pos += chars;\n\nchars = sprintf(buffer+pos, \",%d\", three);\nif(chars &gt; 0) pos += chars;\n</code></pre>\n\n<p>...</p>\n\n<p>Of course you can use more than one value per <code>sprintf</code></p>\n\n<pre><code>chars = sprintf(buffer+pos, \"%s,%s,%d\", one, two, three);\nif(chars &gt; 0) pos += chars;\n</code></pre>\n\n<p>Note that the code doesn't prevent possible buffer overflow. You could use <code>snprintf</code> to fix this, but with <code>snprintf</code> the return code is a bit more difficult to handle.</p>\n\n<p>If all you want to do with the combined buffer is writing it to a file you can directly <code>fprintf</code> the individual values which would avoid the possible buffer overflow problem.</p>\n\n<pre><code>fprintf(File, \"%s,\",deviceSerialNum);\nfprintf(File, \"%s,\", one);\nfprintf(File, \"%s,\", two);\nfprintf(File, \"%d,\", three);\n/* ... */\nfprintf(File, \"%d\\n\", last);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "is_accepted": false, "score": 1, "last_activity_date": 1547034354, "last_edit_date": 1547034354, "creation_date": 1547033826, "answer_id": 54109246, "question_id": 54107449, "link": "https://stackoverflow.com/questions/54107449/what-is-the-better-way-to-use-sprintf-for-multiple-inputs/54109246#54109246", "title": "what is the better way to use sprintf for multiple inputs?", "body": "<p>There is no better way. Ex. see kernel proc outputing, ex. <a href=\"https://github.com/torvalds/linux/blob/master/fs/proc/meminfo.c#L34\" rel=\"nofollow noreferrer\">meminfo</a>. You just <em>need</em> to go through all variables.</p>\n\n<p>You can have a <a href=\"https://github.com/torvalds/linux/blob/master/fs/nfsd/stats.c#L41\" rel=\"nofollow noreferrer\">single big call</a>. Or chain multiple calls like:</p>\n\n<pre><code>int pos = 0;\npos += sprintf(&amp;buffer[pos], \"%d\", var1);\npos += sprintf(&amp;buffer[pos], \"%d\", var2);\npos += sprintf(&amp;buffer[pos], \"%d\", var3);\n</code></pre>\n\n<p>(without error checking), but you need to go through all variables anyway. Anyway I would advise you to use <code>snprintf</code>.</p>\n\n<p>If all variables have the same type, you can have some fun with it:</p>\n\n<pre><code>int pos = 0;\nint *list[] = { &amp;var1, &amp;var2, &amp;var3, ... };\nfor (size_t i = 0; i &lt; sizeof(list)/sizeof(*list); ++i) {\n    pos = sprintf(&amp;buffer[pos], \"%d,\", *list[i]);\n}\n</code></pre>\n\n<p>It looks fancy, but there is really no point in it. Once other people start reading your code, it will become unreadable and a mess. Stick to simple <code>snprintf</code>.</p>\n"}], "owner": {"reputation": 65, "user_id": 10242754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b47a568d62141a009b80a391384a820?s=128&d=identicon&r=PG&f=1", "display_name": "gov", "link": "https://stackoverflow.com/users/10242754/gov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 903, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1547036241, "creation_date": 1547027958, "last_edit_date": 1547033464, "question_id": 54107449, "link": "https://stackoverflow.com/questions/54107449/what-is-the-better-way-to-use-sprintf-for-multiple-inputs", "title": "what is the better way to use sprintf for multiple inputs?", "body": "<p>I have more than 50 input to add to buffer and make a string out of it.\nFor understanding purpose, lets say.</p>\n\n<p>L1, L2, L3 are structures having multiple variables like</p>\n\n<pre><code>struct L1{\nint a;\nint b;\nint c;\n};\nstruct L2{\nint l;\nint m;\n};\nstruct L3{\nint p;\nint q;\nint r;\nint s;\n};\n</code></pre>\n\n<p>.</p>\n\n<pre><code>sprintf(buffer, \"%s,%s,%d,%d,%d,%d,%d,%d,%d,%d,%d\",time, pDeviceMO-&gt;getName(), L1.a, L1.b, L2.l, L3.q, L3.s, L2.m, L3.p, L3.r, L1.c);\n</code></pre>\n\n<p>than write buffer to a File.</p>\n\n<pre><code>fprintf(File, \"%s,%s\\n\",deviceSerialNum, buffer);\n</code></pre>\n\n<p>is there a better way?</p>\n\n<p>Maybe like multiple sprintf for each input. (from a better coding perspective)</p>\n"}, {"tags": ["c++", "c", "performance", "assembly", "llvm-mca"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 3, "creation_date": 1547027929, "post_id": 54107384, "comment_id": 95047012, "body": "Total CPU cycles have stopped directly corresponding to CPU time around 1990s. There&#39;s much more at play nowadays that will impact the time to actually run a piece of code, e.g. caching, branch prediction, external influences etc. Such a static analysis would require not just the code, but also the exact CPU model the code is going to run to even have a chance of being accurate."}, {"owner": {"reputation": 6220, "user_id": 750378, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c2411ebeac78356652778daf47107db7?s=128&d=identicon&r=PG", "display_name": "DaveFar", "link": "https://stackoverflow.com/users/750378/davefar"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547028084, "post_id": 54107384, "comment_id": 95047099, "body": "Good to know, Bartek (+1). Because the CPU frequency can change, or why? Not directly corresponding is one thing, but no correlation at all (see the numbers in my details) was kind of shocking..."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547028197, "post_id": 54107384, "comment_id": 95047165, "body": "Performance of native code is a very complex topic nowadays. You&#39;d need to look around for modern resources regarding optimizations; I think looking at cache-friendly data layout is a good, practical starting point; virtually identical programs (most probably with exactly the same instruction length) differing just by the flip of two loops can have vastly different running times."}, {"owner": {"reputation": 6220, "user_id": 750378, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c2411ebeac78356652778daf47107db7?s=128&d=identicon&r=PG", "display_name": "DaveFar", "link": "https://stackoverflow.com/users/750378/davefar"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547028297, "post_id": 54107384, "comment_id": 95047221, "body": "Isn&#39;t the focus on <code>std::vector</code> and <code>std::accumulate</code> sufficient to have a cache-friendly data layout?"}, {"owner": {"reputation": 6220, "user_id": 750378, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c2411ebeac78356652778daf47107db7?s=128&d=identicon&r=PG", "display_name": "DaveFar", "link": "https://stackoverflow.com/users/750378/davefar"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547028422, "post_id": 54107384, "comment_id": 95047287, "body": "So it seems the subject is just extremely complex, but I did not misunderstand llvm-mca, i.e. focusing on some other output value that is a more accurate prediction. Right?"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547028436, "post_id": 54107384, "comment_id": 95047303, "body": "In this specific example, did you just change the value to <code>0ULL</code>, or did you also change the type of vector to <code>unsigned long long</code>? I am pretty sure the &quot;total cycles&quot; count could well be correct, and not useful at the same time, yes."}, {"owner": {"reputation": 6220, "user_id": 750378, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c2411ebeac78356652778daf47107db7?s=128&d=identicon&r=PG", "display_name": "DaveFar", "link": "https://stackoverflow.com/users/750378/davefar"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547028568, "post_id": 54107384, "comment_id": 95047373, "body": "Nope, I just sum into <code>unsigned long long</code> with an implicit conversion each iteration; the <code>vector::value_type</code> stays <code>double</code>."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1547029020, "post_id": 54107384, "comment_id": 95047630, "body": "Well, okay, in that case it might have to do with the fact that the compiler has to do a lot of conversions; seems that the <code>ull</code> version is actually being picked there. <a href=\"https://godbolt.org/z/FeBUzn\" rel=\"nofollow noreferrer\">Those two calls to double conversion seem particularly bad</a>, but that&#39;s just a guess. What compiler did you build this with to benchmark?"}, {"owner": {"reputation": 6220, "user_id": 750378, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c2411ebeac78356652778daf47107db7?s=128&d=identicon&r=PG", "display_name": "DaveFar", "link": "https://stackoverflow.com/users/750378/davefar"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547029691, "post_id": 54107384, "comment_id": 95048015, "body": "Thank you so much Bartek for looking thoroughly into this. What do you mean by &quot;particularly bad&quot;? Making runtime much slower, but not strongly increasing the CPU cycles would explain the missing correlation. When I look at your example with llvm-mca, including the timeline view (see <a href=\"https://godbolt.org/z/tTCyRW\" rel=\"nofollow noreferrer\">godbolt.org/z/tTCyRW</a>), I find no indication for much slower runtime. Do you find it somewhere in llvm-mca&#39;s output?"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547030209, "post_id": 54107384, "comment_id": 95048347, "body": "Nah, that was just a guess; we&#39;re looking at a very sensitive loop body, and in there, sandwiching the most critical operation, are two <code>call</code> operations. Those calls (<code>__ultod3</code> specifically) <i>should</i>, as far as I&#39;m aware, delegate to SSE2 instructions, which are backed by hardware. This is all Microsoft stuff, however, that&#39;s why I asked which compiler you used. Even if your compiler uses SIMD for conversions as well, I admit I have absolutely no idea how LLVM-MCA will report such calls (i.e. how many cycles they will count as)."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547030557, "post_id": 54107384, "comment_id": 95048573, "body": "That being said, it seems that <a href=\"https://reviews.llvm.org/rL331629#change-EYjqdjWuz1Ae\" rel=\"nofollow noreferrer\">LLVM-MCA</a> is actually much more potent than I initially thought; having all those processor architectures listed is a good indication they <i>might</i> actually interpret that properly. I don&#39;t think I can help you further; someone from LLMV-MCA would be best to shine some light on that."}, {"owner": {"reputation": 6220, "user_id": 750378, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c2411ebeac78356652778daf47107db7?s=128&d=identicon&r=PG", "display_name": "DaveFar", "link": "https://stackoverflow.com/users/750378/davefar"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 2, "creation_date": 1547031449, "post_id": 54107384, "comment_id": 95049192, "body": "If you look at the bottom of godbolt.org/z/tTCyRW&#39;s llvm-mca output, you see <code>error: invalid instruction mnemonic &#39;cvtsi2sdq&#39;</code> and <code>call instructions are not correctly modeled. Assume a latency of 100cy</code>. Maybe that is leading to bad measurements. However, in my original example, there are no call instructions in the measured assembly. I will forward this question to someone from LLVM-MCA..."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1547096548, "post_id": 54107384, "comment_id": 95076232, "body": "@BartekBanachewicz: a contiguous array (like <code>std::vector</code> or an array) is as good as it gets for data layout.  Aligning the data for SIMD can help a bit, depending on the loop.  As far as resources for <a href=\"https://stackoverflow.com/q/51607391\">static analysis of performance</a> of a loop on modern x86, <a href=\"https://stackoverflow.com/tags/x86/info\">stackoverflow.com/tags/x86/info</a> has links to lots of good stuff, especially Agner Fog&#39;s microarch guide (<a href=\"http://agner.org/optimize/\" rel=\"nofollow noreferrer\">agner.org/optimize</a>), which really does detail the pipeline / OoO exec of Intel and AMD CPUs in enough detail to make accurate predictions of performance for a lot of cases."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1547097173, "post_id": 54107384, "comment_id": 95076396, "body": "Total cycles and time are linearly correlated if the CPU is running at constant frequency.  Other things, like total (dynamic) instructions is very much variable, for superscalar / out-of-order pipelined CPUs, especially when cache-misses can stall the pipeline for hundreds of cycles.  Dynamic CPU frequency (for power-saving at idle / low workload) became a thing in the 2000s, not as early as the 90s.  It can be a problem for microbenchmarking if your test doesn&#39;t &quot;warm up&quot; the CPU to get it to max turbo first, but that&#39;s not the problem here.  (LLVM-MCA is analyzing code outside the loop.)"}], "answers": [{"comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547065956, "post_id": 54116927, "comment_id": 95068362, "body": "Not only is the <code>double</code> (picked with <code>0.0</code>) version faster, it&#39;s <a href=\"http://coliru.stacked-crooked.com/a/a267256083954d4f\" rel=\"nofollow noreferrer\">actually correct</a>. The intermediate conversions can provide quite unexpected results."}, {"owner": {"reputation": 18599, "user_id": 4230618, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KRWgI.jpg?s=128&g=1", "display_name": "Hadi Brais", "link": "https://stackoverflow.com/users/4230618/hadi-brais"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 2, "creation_date": 1547066340, "post_id": 54116927, "comment_id": 95068526, "body": "@BartekBanachewicz Note that <code>-ffast-math</code> was passed to gcc to generate the code. See <a href=\"https://stackoverflow.com/questions/7420665/what-does-gccs-ffast-math-actually-do\">What does gcc&#39;s ffast-math actually do?</a>. I have not examined the code thoroughly, but I do hope that both versions are correct with respect to <code>-ffast-math</code> (yes they may not produce the same result when using <code>-ffast-math</code>, that&#39;s OK) ."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1547097578, "post_id": 54116927, "comment_id": 95076497, "body": "@HadiBrais: an easy way to see (on Godbolt) where the start/end markers are:  add a <code>nop&quot;, like </code>nop # LLVM-MCA-END` into the asm statement.  Unchecking the &quot;//&quot; box on Godbolt works too so you can see the comment lines, but having an actual <code>nop</code> makes the &quot;scroll to assembly&quot; right-click menu option work."}, {"owner": {"reputation": 50907, "user_id": 149138, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/cfd457233c8ebbab383475fc097442d9?s=128&d=identicon&r=PG", "display_name": "BeeOnRope", "link": "https://stackoverflow.com/users/149138/beeonrope"}, "edited": false, "score": 1, "creation_date": 1559694942, "post_id": 54116927, "comment_id": 99498768, "body": "LLVM-MCA isn&#39;t even accurate for simple backend bound compute loops: because it has incorrect parameters like &quot;width = 6&quot; for Skylake, so it thinks Skylake can execute 6 nops (or other mixes of instructions) in 1 cycle. This often makes the answer blatantly wrong compared to IACA."}], "tags": [], "owner": {"reputation": 18599, "user_id": 4230618, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KRWgI.jpg?s=128&g=1", "display_name": "Hadi Brais", "link": "https://stackoverflow.com/users/4230618/hadi-brais"}, "is_accepted": false, "score": 4, "last_activity_date": 1547098087, "last_edit_date": 1547098087, "creation_date": 1547061693, "answer_id": 54116927, "question_id": 54107384, "link": "https://stackoverflow.com/questions/54107384/how-can-i-predict-the-runtime-of-a-code-snippet-using-llvm-machine-code-analyz/54116927#54116927", "title": "(How) can I predict the runtime of a code snippet using LLVM Machine Code Analyzer?", "body": "<p><strong>TL:DR: LLVM-MCA analyzed the entire chunk of code between those comments as if it were the <em>body</em> of a loop, and showed you the cycle count for 100 iterations of all those instructions.</strong></p>\n\n<p>But as well as the actually (tiny) loop, most of the instructions are loop setup and the SIMD horizontal sum after the loop that actually only run once.  (That's why the cycle count is in the thousands, not 400 = 100 time the 4-cycle latency of <code>vaddpd</code> on Skylake for the <code>0.0</code> version with a <code>double</code> accumulator.)</p>\n\n<p>If you uncheck the \"//\" box on the Godbolt compiler explorer, or modify the asm statements to add a nop like <code>\"nop # LLVM-MCA-END\"</code>, you'll be able to find those lines in the asm window and see what LLVM-MCA was looking at as it's \"loop\".</p>\n\n<hr>\n\n<p>LLVM MCA simulates a specified sequence of assembly instructions and calculates the number of cycles it's estimated to take to execute <em>per iteration</em> on the specified target architecture. LLVM MCA makes a number of simplifications such as (off the top of my head): (1) it assumes that all conditional branches fall through, (2) it assumes that all memory accesses are of the Write Back memory type and all hit in the L1 cache, (3) it assumes that the frontend works optimally, and (4) <code>call</code> instructions are not followed into the called procedure and they just fall through. There are other assumptions as well that I can't recall at the moment.</p>\n\n<p>Essentially, LLVM MCA (like Intel IACA) is only accurate for backend-compute-bound, simple loops. In IACA, while most instructions are supported, a few instructions are not modeled in detail. As an example, prefetch instructions are assumed to consume only microarchitectural resources but take basically zero latency and have no impact on the state of the memory hierarchy. It appears to me that MCA completely ignores such instructions, however. Anyway, this is not particularly relevant to your question.</p>\n\n<p>Now back to your code. In the Compiler Explorer link you have provided, you didn't pass any options to LLVM MCA. So the default target architecture takes effect, which is whatever architecture the tool is running on. This happens to be SKX. The total number of cycles you mentioned are for SKX, but it's not clear whether you ran the code on SKX or not. You should use the <code>-mcpu</code> option to specify the architecture. This is independent from the <code>-march</code> you passed to gcc. Also note that comparing core cycles to milliseconds is not meaningful. You can use the <code>RDTSC</code> instruction to measure the execution time in terms of core cycles.</p>\n\n<p>Notice how the compiler has inlined the call to <code>std::accumulate</code>. Apparently, this code starts at assembly line 405 and the last instruction of the <code>std::accumulate</code> is at line 444, a total of 38 instructions. The reason why the LLVM MCA estimation will not match the actual performance has become clear now. The tool is assuming that all of these instructions are being executed in a loop for a large number of iterations. Obviously this is not the case. There is only one loop from 420-424:</p>\n\n<pre><code>.L75:\n        vaddpd  ymm0, ymm0, YMMWORD PTR [rax]\n        add     rax, 32\n        cmp     rax, rcx\n        jne     .L75\n</code></pre>\n\n<p>Only this code should be the input to MCA. At the source code level, there is really no way to tell MCA to only analyze this code. You'd have to manually inline <code>std::accumulate</code> and place the <code>LLVM-MCA-BEGIN</code> and <code>LLVM-MCA-END</code> marks somewhere inside it.</p>\n\n<p>When passing <code>0ULL</code> instead of <code>0.0</code> to <code>std::accumulate</code>, the input to LLVM MCA would start at assembly instruction 402 and end at 441. Note that any instructions not supported by MCA (such as <code>vcvtsi2sdq</code>) will be completely omitted from the analysis. The part of the code that is actually in a loop is:</p>\n\n<pre><code>.L78:\n        vxorpd  xmm0, xmm0, xmm0\n        vcvtsi2sdq      xmm0, xmm0, rax\n        test    rax, rax\n        jns     .L75\n        mov     rcx, rax\n        and     eax, 1\n        vxorpd  xmm0, xmm0, xmm0\n        shr     rcx\n        or      rcx, rax\n        vcvtsi2sdq      xmm0, xmm0, rcx\n        vaddsd  xmm0, xmm0, xmm0\n.L75:\n        vaddsd  xmm0, xmm0, QWORD PTR [rdx]\n        vcomisd xmm0, xmm1\n        vcvttsd2si      rax, xmm0\n        jb      .L77\n        vsubsd  xmm0, xmm0, xmm1\n        vcvttsd2si      rax, xmm0\n        xor     rax, rdi\n.L77:\n        add     rdx, 8\n        cmp     rsi, rdx\n        jne     .L78\n</code></pre>\n\n<p>Note that there is a conditional jump, <code>jns</code>, in the code whose target address is somewhere in the block. MCA will just assume that the jump will fall through. If this was not the case in an actual run of the code, MCA will unnecessarily add the overhead of 7 instructions. There is another jump, <code>jb</code>, but this one I think is not important for large vectors and will fall through most of the time. The last jump, <code>jne</code>, is also the last instruction, so MCA will assume that the next instruction is the top one again. For a sufficiently large number of iterations, this assumption is perfectly fine.</p>\n\n<p>Overall, it's obvious that first code is much smaller than the second one, and so it's probably much faster. Your measurements do confirm this. You also don't really need to use a microarchitecture analysis tool to understand why. The second code just does a lot more computations. So you can quickly conclude that passing <code>0.0</code> is better in terms of performance and code size on all architectures.</p>\n"}], "owner": {"reputation": 6220, "user_id": 750378, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c2411ebeac78356652778daf47107db7?s=128&d=identicon&r=PG", "display_name": "DaveFar", "link": "https://stackoverflow.com/users/750378/davefar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 717, "favorite_count": 2, "answer_count": 1, "score": 5, "last_activity_date": 1547098087, "creation_date": 1547027780, "question_id": 54107384, "link": "https://stackoverflow.com/questions/54107384/how-can-i-predict-the-runtime-of-a-code-snippet-using-llvm-machine-code-analyz", "title": "(How) can I predict the runtime of a code snippet using LLVM Machine Code Analyzer?", "body": "<p>I used llvm-mca to compute the <strong>total cycles</strong> of a pice of code, thinking they would predict its runtime. However, measuring the runtime dynamically showed almost no correlation. So: <strong>Why does the total cycles computed by llvm-mca not accurately predict the runtime? Can I predict the runtime in some better way with llvm-mca?</strong></p>\n\n<hr>\n\n<p>Details:</p>\n\n<p>I wanted to know the runtime of the following code for different types of <code>begin</code> (and <code>end</code>) iterators, for <code>startValue</code> being <code>0.0</code> or <code>0ULL</code>:</p>\n\n<pre><code>std::accumulate(begin, end, starValue)\n</code></pre>\n\n<p>To predict the runtimes, I used the Compiler Explorer (<a href=\"https://godbolt.org/z/5HDzSF\" rel=\"noreferrer\">https://godbolt.org/z/5HDzSF</a>) with its LLVM Machine Code Analyzer (llvm-mca) plugin, since llvm-mca is \"a performance analysis tool that uses information available in LLVM (e.g. scheduling models) to statically measure the performance\". I used the following code:</p>\n\n<pre><code>using vec_t = std::vector&lt;double&gt;;\n\nvec_t generateRandomVector(vec_t::size_type size)\n{\n    std::random_device rnd_device;\n    std::mt19937 mersenne_engine {rnd_device()};\n    std::uniform_real_distribution dist{0.0,1.1};\n    auto gen = [&amp;dist, &amp;mersenne_engine](){\n        return dist(mersenne_engine);\n    };\n    vec_t result(size);\n    std::generate(result.begin(), result.end(), gen);\n    return result;\n}\n\ndouble start()\n{\n    vec_t vec = generateRandomVector(30000000);\n    vec_t::iterator vectorBegin = vec.begin();\n    vec_t::iterator vectorEnd = vec.end();\n    __asm volatile(\"# LLVM-MCA-BEGIN stopwatchedAccumulate\");\n    double result = std::accumulate(vectorBegin, vectorEnd, 0.0);\n    __asm volatile(\"# LLVM-MCA-END\");    \n    return result;\n}\n</code></pre>\n\n<p>However, I see no correlation between the total cycles computer by llvm-mca and the wall clock time from running the corresponding std::accumulate. For example, in the code above, the Total Cycles are 2806, the runtime is 14ms. When I switch to the startValue <code>0ULL</code>, the Total Cycles are 2357, but the runtime is 117ms.</p>\n"}, {"tags": ["c", "linux", "networking", "qos", "setsockopt"], "comments": [{"owner": {"reputation": 4989, "user_id": 3745413, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jQsNL.png?s=128&g=1", "display_name": "Ron Maupin", "link": "https://stackoverflow.com/users/3745413/ron-maupin"}, "edited": false, "score": 0, "creation_date": 1547046945, "post_id": 54106690, "comment_id": 95058766, "body": "Understand that simply setting the DSCP on a packet actually does nothing unless the network devices are configured to treat the packets based on DSCP, which they are not going to do by default. That is why QoS doesn&#39;t work across the public Internet. The QoS policies for a site can be very different. For example, you may think that marking a packet as <code>EF</code> would get you the best treatment, but a network could be configured to give such a packet the lowest priority, instead of the highest priority. In fact, many switches will remark traffic to <code>BE</code>."}, {"owner": {"reputation": 4989, "user_id": 3745413, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jQsNL.png?s=128&g=1", "display_name": "Ron Maupin", "link": "https://stackoverflow.com/users/3745413/ron-maupin"}, "edited": false, "score": 0, "creation_date": 1547048084, "post_id": 54106690, "comment_id": 95059476, "body": "The answer to <a href=\"https://networkengineering.stackexchange.com/q/48179/8499\">this question</a> explains more about IP and QoS, and there are a lot of QoS questions and answers on <a href=\"https://networkengineering.stackexchange.com\">Network Engineering</a>."}], "owner": {"reputation": 3800, "user_id": 795910, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/921b253c1d4b4aeaf444f8213c3b859e?s=128&d=identicon&r=PG", "display_name": "Ottavio Campana", "link": "https://stackoverflow.com/users/795910/ottavio-campana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1195, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1547025565, "creation_date": 1547025565, "question_id": 54106690, "link": "https://stackoverflow.com/questions/54106690/setting-dscp-on-a-per-socket-base", "title": "Setting DSCP on a per-socket base", "body": "<p>There are several examples about using iptable to set the DSCP field of the the IP packets. I am trying not to use iptables, but to set the DSCP field just on a few selected sockets.</p>\n\n<p>By reading <code>man 7 ip</code>, I found out that I can use something link </p>\n\n<pre><code>int tos_local = 0x28;\nsetsockopt(sockfd, IPPROTO_IP, IP_TOS,  &amp;tos_local, sizeof(tos_local));\n</code></pre>\n\n<p>There is one thing that it is not clear to me. <code>IP_TOS</code> is described to work on the old Type-Of-Service field, which has been redefined by <a href=\"https://tools.ietf.org/html/rfc2474\" rel=\"nofollow noreferrer\">RFC2474</a> to be used by Differentiated Services.</p>\n\n<p>So, my question is: can I user <code>setsockopt</code> with <code>IPPROTO_IP</code> and <code>IP_TOS</code> to set any DSCP value between 0 and 63, or am I limited to just <code>IPTOS_LOWDELAY</code>, <code>IPTOS_THROUGHPUT</code>, <code>IPTOS_RELIABILITY</code> and <code>IPTOS_MINCOST</code>?</p>\n"}, {"tags": ["c", "pointers", "structure", "dynamic-memory-allocation", "dynamic-arrays"], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 10852655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73915b6483f73bd706df774b617b7a7?s=128&d=identicon&r=PG&f=1", "display_name": "Boris", "link": "https://stackoverflow.com/users/10852655/boris"}, "edited": false, "score": 0, "creation_date": 1547025931, "post_id": 54106688, "comment_id": 95045805, "body": "Hi @Marco, I get your point. So in other words, it&#39;s safe to delete a cell without freeing it because this address is still in use in other cell. So when I will want to free all the array, I&#39;ll free that address, right?"}, {"owner": {"reputation": 424, "user_id": 3721542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bs2Md.jpg?s=128&g=1", "display_name": "Marco", "link": "https://stackoverflow.com/users/3721542/marco"}, "reply_to_user": {"reputation": 15, "user_id": 10852655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73915b6483f73bd706df774b617b7a7?s=128&d=identicon&r=PG&f=1", "display_name": "Boris", "link": "https://stackoverflow.com/users/10852655/boris"}, "edited": false, "score": 0, "creation_date": 1547029575, "post_id": 54106688, "comment_id": 95047950, "body": "That&#39;s right: you free an address only when you don&#39;t need the information that&#39;s stored there. Please upvote my answer if it&#39;s been useful."}], "tags": [], "owner": {"reputation": 424, "user_id": 3721542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bs2Md.jpg?s=128&g=1", "display_name": "Marco", "link": "https://stackoverflow.com/users/3721542/marco"}, "is_accepted": false, "score": 0, "last_activity_date": 1547025556, "creation_date": 1547025556, "answer_id": 54106688, "question_id": 54106566, "link": "https://stackoverflow.com/questions/54106566/the-right-way-to-delete-a-cell-in-dynamic-array-of-pointers/54106688#54106688", "title": "The right way to delete a cell in dynamic array of pointers", "body": "<p>You are not supposed to free the last cell, because you're keeping a pointer to that user.</p>\n\n<p>Just remove the second free.</p>\n\n<p>Also, the second loop should go up to <code>j &lt; *maleArrSize -1</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 15, "user_id": 10852655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73915b6483f73bd706df774b617b7a7?s=128&d=identicon&r=PG&f=1", "display_name": "Boris", "link": "https://stackoverflow.com/users/10852655/boris"}, "edited": false, "score": 0, "creation_date": 1547026673, "post_id": 54106888, "comment_id": 95046228, "body": "Thank you! but doesn&#39;t it mean that I have deleted a pointer to that memory but the memory is still left there? I have to free all the memory."}, {"owner": {"reputation": 527, "user_id": 10488746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vTDhZ.jpg?s=128&g=1", "display_name": "H.cohen", "link": "https://stackoverflow.com/users/10488746/h-cohen"}, "reply_to_user": {"reputation": 15, "user_id": 10852655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73915b6483f73bd706df774b617b7a7?s=128&d=identicon&r=PG&f=1", "display_name": "Boris", "link": "https://stackoverflow.com/users/10852655/boris"}, "edited": false, "score": 0, "creation_date": 1547027739, "post_id": 54106888, "comment_id": 95046908, "body": "well that depends on how you allocated the memory to begin with. if your array is an array of pointers and each pointer is malloced a struct then you do need to free it as well after freeing the inner struct mallocs and the space on heap for the last pointer in your array is freed by the realloc"}], "tags": [], "owner": {"reputation": 527, "user_id": 10488746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vTDhZ.jpg?s=128&g=1", "display_name": "H.cohen", "link": "https://stackoverflow.com/users/10488746/h-cohen"}, "is_accepted": false, "score": 0, "last_activity_date": 1547028754, "last_edit_date": 1547028754, "creation_date": 1547026269, "answer_id": 54106888, "question_id": 54106566, "link": "https://stackoverflow.com/questions/54106566/the-right-way-to-delete-a-cell-in-dynamic-array-of-pointers/54106888#54106888", "title": "The right way to delete a cell in dynamic array of pointers", "body": "<p>I have added notes on you code, hope this helps:</p>\n\n<pre><code>     //check if it's the last array cell\n        if (i != *maleArrSize - 1)\n        {\n            //shift cells\n            for (j = i;j &lt; *maleArrSize-1;j++)\n            {\n                pMaleArr[j] = pMaleArr[j + 1];/* you need till size -1 because of[j+1]*/\n\n            }//free the last cell\n            free(pMaleArr[*maleArrSize-1]); //I'm getting a problem here because now the 2 last cells of the array have the same pointer adress.\n        }\n        //remove the last cell- here if the cell to remove was the last one you don't free its inner allocations.\n        pMaleArr = (User **)realloc(pMaleArr, (*maleArrSize \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 15, "user_id": 10852655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73915b6483f73bd706df774b617b7a7?s=128&d=identicon&r=PG&f=1", "display_name": "Boris", "link": "https://stackoverflow.com/users/10852655/boris"}, "edited": false, "score": 0, "creation_date": 1547031770, "post_id": 54108497, "comment_id": 95049437, "body": "Thank you for the explanation! Regarding the first issue - I guess it was a spelling error O:-)"}], "tags": [], "owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "is_accepted": true, "score": 0, "last_activity_date": 1547031246, "creation_date": 1547031246, "answer_id": 54108497, "question_id": 54106566, "link": "https://stackoverflow.com/questions/54106566/the-right-way-to-delete-a-cell-in-dynamic-array-of-pointers/54108497#54108497", "title": "The right way to delete a cell in dynamic array of pointers", "body": "<p>There is a serious problem in this piece of code:</p>\n\n<pre><code>    if (strcmp(pMaleArr[i]-&gt;userName, onlineUser-&gt;userName) ==0) \n    {\n        //when the user is found, free all fields of the struct\n        freeUserFields(onlineUser);                  // NOOO !!!\n</code></pre>\n\n<p>You are freeing fields on a struct that was passed to control the username, while you should only access the content of the <code>*pMaleArr</code> array. You should write:</p>\n\n<pre><code>    if (strcmp(pMaleArr[i]-&gt;userName, onlineUser-&gt;userName) ==0) \n    {\n        //when the user is found, free all fields of the struct\n        freeUserFields(pMaleArr[i]);\n</code></pre>\n\n<p>And you should not free the last cell. You do not free a pointer, but where it points to. What is pointed to by last pointer is now pointed by previous pointer and has to be kept. So that other part should be:</p>\n\n<pre><code>        if (i != *maleArrSize - 1)\n        {\n            //shift cells\n            for (j = i;j &lt; *maleArrSize;j++)\n            {\n                pMaleArr[j] = pMaleArr[j + 1];\n\n            }//just ignore the last cell\n        }\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 10852655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73915b6483f73bd706df774b617b7a7?s=128&d=identicon&r=PG&f=1", "display_name": "Boris", "link": "https://stackoverflow.com/users/10852655/boris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 54108497, "answer_count": 3, "score": 1, "last_activity_date": 1547031246, "creation_date": 1547025059, "question_id": 54106566, "link": "https://stackoverflow.com/questions/54106566/the-right-way-to-delete-a-cell-in-dynamic-array-of-pointers", "title": "The right way to delete a cell in dynamic array of pointers", "body": "<p>in my current homework project I have built a dynamic pointers array, where each pointer points on a structure of data with some strings inside (indicating Users). I am trying to find the proper way to remove a specific cell (or User) inside the array, without any heap memory issues.</p>\n\n<p>So I've been trying to <code>free</code> the specific cell and then shift the other cells, so there will be no empty cell left. After that, I tried to \"cut\" the last cell which is currently empty, with <code>realloc</code> the array by -1. Please see comments in the code where I describe my problem.</p>\n\n<pre><code>User** deleteMale(User** pMaleArr, int *maleArrSize, User *onlineUser)\n{\n    int i,j;\n    //for each array element check if the username matches to the \n    // connected user\n    for (i = 0;i &lt; *maleArrSize;i++)\n    {\n        if (strcmp(pMaleArr[i]-&gt;userName, onlineUser-&gt;userName) ==0) \n        {\n            //when the user is found, free all fields of the struct\n            freeUserFields(onlineUser);\n            //check if it's the last array cell\n            if (i != *maleArrSize - 1)\n            {\n                //shift cells\n                for (j = i;j &lt; *maleArrSize;j++)\n                {\n                    pMaleArr[j] = pMaleArr[j + 1];\n\n                }//free the last cell\n                free(pMaleArr[*maleArrSize-1]); //I'm getting a problem here because now the 2 last cells of the array have the same pointer adress.\n            }\n            //remove the last cell\n            pMaleArr = (User **)realloc(pMaleArr, (*maleArrSize \n- 1)*sizeof(User*));\n            if (pMaleArr == NULL)\n            {\n                if (*maleArrSize != 1)\n                {\n                    printf(MA_FAILED);\n                    exit(1);\n                }\n            }\n            break;\n        }\n    }\n    *maleArrSize -= 1;\n    return pMaleArr;\n}\n\nvoid freeUserFields(User *person)\n{\n    if (person != NULL)\n    {\n        //free all fields\n        free(person-&gt;firstName);\n        free(person-&gt;lastName);\n        free(person-&gt;age);\n        free(person-&gt;userName);\n        free(person-&gt;userPassword);\n        free(person-&gt;about);\n        free(person-&gt;hobbies);\n        //free node itself\n        free(person);\n    }\n</code></pre>\n\n<p>} </p>\n\n<p>So as I noticed above, when I try to <code>free</code> the last cell, in order to delete it afterwards, it deletes also the (last-1) cell because I copied their adresses. I can't find another way to shift the cells in this case. Can I get an advice on how to handle it properly? \nThank you!</p>\n"}, {"tags": ["c", "windows"], "comments": [{"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 2, "creation_date": 1547025253, "post_id": 54106536, "comment_id": 95045443, "body": "The documentation of <code>_msize</code> clearly specifies it expects a pointer returned by <code>malloc</code>, <code>calloc</code> or <code>realloc</code>. A VLA is non of those. You should pay closer attention to a function&#39;s documented contract."}, {"owner": {"reputation": 1032, "user_id": 7462275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JtXPb.png?s=128&g=1", "display_name": "Stef1611", "link": "https://stackoverflow.com/users/7462275/stef1611"}, "reply_to_user": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1547026252, "post_id": 54106536, "comment_id": 95045992, "body": "@storyteller. OK, I agree with you and I am not surprised that _msize does not work. VLA memory allocation is on the stack and malloc memory allocation on the heap. My first question is &quot;is there an equivalent of _msize for VLA ?&quot; and, concerning the second one, I was expected an answer from a technical point of view. For example :    <code>int aaa;     printf(&quot;%d\\n&quot;,_msize(aaa));</code> returns -1 and the program does not hang."}, {"owner": {"reputation": 1032, "user_id": 7462275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JtXPb.png?s=128&g=1", "display_name": "Stef1611", "link": "https://stackoverflow.com/users/7462275/stef1611"}, "reply_to_user": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1547028075, "post_id": 54106536, "comment_id": 95047092, "body": "@storyteller. Following your remark, I edit the title."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 2, "creation_date": 1547029161, "post_id": 54106536, "comment_id": 95047707, "body": "A function such as <code>_msize()</code> that requires a pointer to memory allocated on the heap can&#39;t be safely used unless you have some way of knowing that the random <code>foo *</code> pointer you get actually references a heap object. Your <code>void myfoo(int *array)</code> can be passed an <code>int *</code> that refers to <code>int</code> value(s) <i>anywhere</i>. To use something like <code>_msize()</code>, you&#39;d have to carry around a &quot;this is a pointer to heap memory&quot; bit of data around with the pointer. Once you have to do that, you might as well just carry around the size of the memory along with the pointer and be able to use it on any pointer type."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 2, "creation_date": 1547029384, "post_id": 54106536, "comment_id": 95047838, "body": "(cont) <i>&quot;is there an equivalent of _msize for VLA ?&quot;</i>  If there were, it would only be useful on VLAs - and would again need a flag carried around with the pointer to say &quot;this is a VLA&quot; when you pass it to a function.  Again - just pass the size if you need it.  That&#39;s just the way C works - it started as a low-level language, and it has kept many vestiges of that.  One of those is that arrays decay to pointers when passed to functions, and the length of the array is lost."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1547030020, "post_id": 54106536, "comment_id": 95048223, "body": "So, IMO <code>_msize()</code> is actually anything but great - it&#39;s downright horrible. Using it plants a land mine in your code - your code works for a long time, then someone makes a change that passes a static array or VLA to it and your code blows up and fails.  Not only is <code>_msize()</code> a failure-waiting-to-happen, it an proprietary extension that needlessly makes your code non-portable."}, {"owner": {"reputation": 1032, "user_id": 7462275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JtXPb.png?s=128&g=1", "display_name": "Stef1611", "link": "https://stackoverflow.com/users/7462275/stef1611"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1547031684, "post_id": 54106536, "comment_id": 95049375, "body": "@AndrewHenle. Thanks a lot for all of your answers.Is malloc_usable_size (the equivalent of _msize on linux) more secure or is it the same ? If you have time, could read my comments to Jose (see the answer) about the sizeof operator on VLA. I read many documents on the net (array name is not a pointer, what &amp;array is ?, sizeof is an operator, array decays to a pointer, difference between &amp;array, array, *array, array[0], ...). If sizeof could evaluate the size, with the ptr that decays from arrayname, is it possible to look for this value in a table and get the size of the array."}, {"owner": {"reputation": 1032, "user_id": 7462275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JtXPb.png?s=128&g=1", "display_name": "Stef1611", "link": "https://stackoverflow.com/users/7462275/stef1611"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1547031899, "post_id": 54106536, "comment_id": 95049520, "body": "@AndrewHenle. In the last comment, with table, I mean some kind of structure that describe the stack and that I suppose, it is used by sizeof."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1547122767, "post_id": 54106536, "comment_id": 95088269, "body": "@Stef1611 <i>some kind of structure that describe the stack and that I suppose, it is used by sizeof</i>  No, because <code>sizeof()</code> can only work on a VLA in the scope the VLA is created - the compiler will be able to return the size of the array by any means it wants to.  Once you pass a VLA to another function, that context is lost and it&#39;s just a pointer.  Again, there&#39;s no way to safely use such functions as <code>malloc_usable_size()</code> or <code>_msize()</code> or you hypothetical <code>get_VLA_size()</code> without also passing the type of array. And once you have to pass the type, you might as well just pass the size."}], "answers": [{"comments": [{"owner": {"reputation": 1032, "user_id": 7462275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JtXPb.png?s=128&g=1", "display_name": "Stef1611", "link": "https://stackoverflow.com/users/7462275/stef1611"}, "edited": false, "score": 0, "creation_date": 1547026634, "post_id": 54106813, "comment_id": 95046198, "body": "I agree please read my comment to storyteller. And concerning the array that decays to a pointer I am aware of that (a long story : <a href=\"https://stackoverflow.com/questions/54073251/variable-declaration-in-function-prototype-and-in-block-code-difference\" title=\"variable declaration in function prototype and in block code difference\">stackoverflow.com/questions/54073251/&hellip;</a>)"}, {"owner": {"reputation": 1032, "user_id": 7462275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JtXPb.png?s=128&g=1", "display_name": "Stef1611", "link": "https://stackoverflow.com/users/7462275/stef1611"}, "edited": false, "score": 0, "creation_date": 1547027729, "post_id": 54106813, "comment_id": 95046902, "body": "Therefore, I should conclude that it is impossible to know the size of a VLA only from its pointer information. So, the following question, how is it possible with the operator sizeof ? Which supplementary information could be obtained with the array name that it is lost when it decays to a pointer ?"}, {"owner": {"reputation": 2999, "user_id": 7520531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0107497596782a18d4a853214a883546?s=128&d=identicon&r=PG&f=1", "display_name": "Jose", "link": "https://stackoverflow.com/users/7520531/jose"}, "reply_to_user": {"reputation": 1032, "user_id": 7462275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JtXPb.png?s=128&g=1", "display_name": "Stef1611", "link": "https://stackoverflow.com/users/7462275/stef1611"}, "edited": false, "score": 0, "creation_date": 1547028171, "post_id": 54106813, "comment_id": 95047147, "body": "You are not able to get the size of an array with just a pointer. In the same way that you are not able to know the size of an array with just the first element (or can you know the number of elements in <code>array</code> based on <code>array[0]</code>?). As I said, you have to pass the number of elements too."}, {"owner": {"reputation": 1032, "user_id": 7462275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JtXPb.png?s=128&g=1", "display_name": "Stef1611", "link": "https://stackoverflow.com/users/7462275/stef1611"}, "edited": false, "score": 0, "creation_date": 1547028696, "post_id": 54106813, "comment_id": 95047445, "body": "This is what I do in all my program and for a few days I use structure { int size, int array[]} and flexible array member. But I would like to understand much more subtilities. So, the question in my last comment, how is it possible with the operator sizeof ? Which supplementary information could be obtained with the array name that it is lost when it decays to a pointer ?"}, {"owner": {"reputation": 1032, "user_id": 7462275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JtXPb.png?s=128&g=1", "display_name": "Stef1611", "link": "https://stackoverflow.com/users/7462275/stef1611"}, "edited": false, "score": 0, "creation_date": 1547029417, "post_id": 54106813, "comment_id": 95047855, "body": "Thanks for your comment on accept. I am new in stackoverflow (I subscribed for a long time but I did not use it often and I had no answer on my first questions) so I voted up for interesting and helpful answers but I did not accept them. To be perfectly honest, I did not really see the difference. Now, it is clear. (When you have read this comment, let me know, I will remove it because it is not really a comment and I do not know how to write you directly)"}], "tags": [], "owner": {"reputation": 2999, "user_id": 7520531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0107497596782a18d4a853214a883546?s=128&d=identicon&r=PG&f=1", "display_name": "Jose", "link": "https://stackoverflow.com/users/7520531/jose"}, "is_accepted": false, "score": 0, "last_activity_date": 1547028339, "last_edit_date": 1592644375, "creation_date": 1547026028, "answer_id": 54106813, "question_id": 54106536, "link": "https://stackoverflow.com/questions/54106536/msizeptr-is-great-and-with-vla-decaying-pointer-what-could-i-do/54106813#54106813", "title": "_msize(ptr) is great and with VLA decaying pointer, what could I do?", "body": "<p>A VLA (on the stack) is not the expected value by <a href=\"https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/msize?view=vs-2017\" rel=\"nofollow noreferrer\"><code>_msize</code></a>, given that the expected bunch of memory is from the heap which has been allocated by a dynamic allocator:</p>\n<blockquote>\n<p>[...Returns the size of a memory block allocated in the heap. ...]</p>\n<p>[... The _msize function returns the size, in bytes, of the memory block allocated by a call to calloc, malloc, or realloc. ...]</p>\n</blockquote>\n<p>That is the reason why the first part of the code should work as expected, but not the second one.</p>\n<p>For the completeness sake, when you pass an array, it <a href=\"https://stackoverflow.com/questions/1461432/what-is-array-decaying\">decays</a> to a pointer, so the function is getting just a pointer. So the function should receive the number of elements in the array too (besides of the pointer). See this: <a href=\"https://stackoverflow.com/questions/14548753/passing-a-multidimensional-variable-length-array-to-a-function\">Passing a multidimensional variable length array to a function</a></p>\n"}], "owner": {"reputation": 1032, "user_id": 7462275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JtXPb.png?s=128&g=1", "display_name": "Stef1611", "link": "https://stackoverflow.com/users/7462275/stef1611"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547028339, "creation_date": 1547024967, "last_edit_date": 1547028033, "question_id": 54106536, "link": "https://stackoverflow.com/questions/54106536/msizeptr-is-great-and-with-vla-decaying-pointer-what-could-i-do", "title": "_msize(ptr) is great and with VLA decaying pointer, what could I do?", "body": "<p>(First of all : This code is intented to run only on Windows10 but behavior on other OS is interesting. Of course, change _msize by the appropriate function)</p>\n\n<p>Part I of the code. Memory allocation is done with malloc and I use _msize to print the element number of an array in a function (I know that, for memory allocation reason ..., I could have a superior value but I have not yet observed such a case. If you have real case where it happens, I am interested but it is not the main reason of my question )</p>\n\n<p>Part II of the code : Same idea but with variable lenght array. I have two questions. First, is there an equivalent of _msize for VLA ? and second,\nmy program hangs, why does not _msize return ?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;malloc.h&gt;\n\nvoid myfoo(int *array) {\n    printf(\"Nb elt of an array obtained from its pointer %d\\n\",_msize(array)/sizeof(int));\n}\n\nint main() {\n    int n=1;\n\n    printf(\"Part 1 : malloc\\n\");\n    while(n&gt;0) {\n        printf(\"n : \");scanf(\"%d\",&amp;n);\n        if (n&lt;0) break;\n        int *array;\n        array=malloc(n*sizeof(int));\n        for (int i=0;i&lt;n;i++) {array[i]=i;}\n        myfoo(array);\n        free(array);\n    }\n\n    n=1;\n    printf(\"Part 1I : Variable Length Array\\n\");\n    while(n&gt;0) {\n        printf(\"n : \");scanf(\"%d\",&amp;n);\n        if (n&lt;0) break;\n        int array[n];\n        for (int i=0;i&lt;n;i++) {array[i]=i;}\n        myfoo(array);\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "linux", "multithreading", "free"], "comments": [{"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 1, "creation_date": 1547024316, "post_id": 54106194, "comment_id": 95044932, "body": "&quot;i have problem in the free&quot; is not an accurate description! Describe what the problem is. BTW: please indent your code."}, {"owner": {"reputation": 15, "user_id": 9675928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75be874861ea6b4a96c9009b1242a07a?s=128&d=identicon&r=PG&f=1", "display_name": "\u05dc\u05d5\u05d0\u05d9 \u05d2\u05d1\u05e8", "link": "https://stackoverflow.com/users/9675928/%d7%9c%d7%95%d7%90%d7%99-%d7%92%d7%91%d7%a8"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1547024391, "post_id": 54106194, "comment_id": 95044971, "body": "memory leak problem using valgrind"}, {"owner": {"reputation": 12106, "user_id": 4431643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CoZjt.jpg?s=128&g=1", "display_name": "kiran Biradar", "link": "https://stackoverflow.com/users/4431643/kiran-biradar"}, "edited": false, "score": 0, "creation_date": 1547024999, "post_id": 54106194, "comment_id": 95045318, "body": "Have look at <a href=\"https://stackoverflow.com/questions/17369442/memory-leaks-when-using-pthead-exit-to-exit-thread\">memory-leaks-when-using-pthead-exit-to-exit-thread</a>."}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "reply_to_user": {"reputation": 12106, "user_id": 4431643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CoZjt.jpg?s=128&g=1", "display_name": "kiran Biradar", "link": "https://stackoverflow.com/users/4431643/kiran-biradar"}, "edited": false, "score": 0, "creation_date": 1547026433, "post_id": 54106194, "comment_id": 95046077, "body": "@kiranBiradar: No, C != C++. In particular, when a C thread exits, the thread stack is discarded, not unwound."}], "answers": [{"tags": [], "owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "is_accepted": false, "score": 0, "last_activity_date": 1547027976, "creation_date": 1547027976, "answer_id": 54107457, "question_id": 54106194, "link": "https://stackoverflow.com/questions/54106194/memory-leak-when-calling-pthread-exit/54107457#54107457", "title": "memory leak when calling pthread_exit()", "body": "<p>The pattern looks like a fairly standard thread pool:</p>\n\n<pre><code>typedef struct {\n    pthread_mutex_t   qlock;\n    pthread_cond_t    q_not_empty;\n    volatile work_t  *qhead;\n    volatile work_t  *qtail;\n    size_t            qsize; /* Not needed */\n    volatile int      shutdown;\n} threadpool;\n</code></pre>\n\n<p>Properly indenting OP's code would make it more readable.</p>\n\n<p>However, the implementation looks odd. I would expect</p>\n\n<pre><code>void *do_work(void *poolptr)\n{\n    threadpool *const  pool = poolptr;\n    work_t            *work;\n\n    pthread_mutex_lock(&amp;(pool-&gt;qlock));\n    while (!(pool-&gt;shutdown)) {\n\n        if (!(pool-&gt;qhead)) {\n            /* Queue empty */\n            pthread_cond_wait(&amp;(pool-&gt;q_not_empty), &amp;(pool-&gt;qlock));\n            continue;\n        }\n\n        work = pool-&gt;qhead;\n        pool-&gt;qhead = work-&gt;next;\n        if (!pool-&gt;qhead)\n             pool-&gt;qtail = NULL;\n        work-&gt;next = NULL;\n\n        pthread_unlock(&amp;(pool-&gt;qlock));\n\n        work-&gt;process(work);\n\n        pthread_lock(&amp;(pool-&gt;qlock));\n\n    }\n    pthread_mutex_unlock(&amp;(pool-&gt;qlock));\n\n    return (void *)0;\n}\n</code></pre>\n\n<p>and the code that appends a new work item to the queue to be</p>\n\n<pre><code>void append(threadpool *pool, work_t *work)\n{\n    work-&gt;next = NULL;\n\n    pthread_mutex_lock(&amp;(pool-&gt;qlock));\n    if (pool-&gt;qtail) {\n        pool-&gt;qtail-&gt;next = work;\n        pool-&gt;qtail = work;\n    } else {\n        pool-&gt;qhead = work;\n        pool-&gt;qtail = work;\n    }\n    pthread_cond_signal(&amp;(pool-&gt;q_not_empty));\n    pthread_mutex_unlock(&amp;(pool-&gt;qlock));\n}\n</code></pre>\n\n<p>It is difficult to say where OP's implementation leaks memory. The most likely candidate is OP's <code>arg</code> member in each <code>work_t</code>, if it is dynamically allocated. </p>\n\n<p>My implementation above passes the entire <code>work_t</code> to the <code>routine</code> function, which I renamed to <code>process</code>. It is responsible for freeing the work structure, too. The minimal definition for the work structure is</p>\n\n<pre><code>typedef struct work_t {\n    struct work_t  *next;\n    void          (*process)(struct work_t *);\n    /* Optional other fields */\n} work_t;\n</code></pre>\n\n<p>Other possible causes for the memory leaks is if the <code>qsize</code> member is not properly updated everywhere. Because there is no use for it, really, I just omit it altogether.</p>\n\n<p>The simpler the code, the easier it is to avoid bugs.</p>\n"}], "owner": {"reputation": 15, "user_id": 9675928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75be874861ea6b4a96c9009b1242a07a?s=128&d=identicon&r=PG&f=1", "display_name": "\u05dc\u05d5\u05d0\u05d9 \u05d2\u05d1\u05e8", "link": "https://stackoverflow.com/users/9675928/%d7%9c%d7%95%d7%90%d7%99-%d7%92%d7%91%d7%a8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1547027976, "creation_date": 1547023750, "last_edit_date": 1547024370, "question_id": 54106194, "link": "https://stackoverflow.com/questions/54106194/memory-leak-when-calling-pthread-exit", "title": "memory leak when calling pthread_exit()", "body": "<p>i need to create a thread pool it,it works but in function do_work that the function pthread_create calls i have problem in the free (memory leak) just when calling pthread_exit()</p>\n\n<p>*in function create threadpool i just initilaize the struct and call \nfunction do work *</p>\n\n<pre><code>void* do_work(void* p)\n  {\n   threadpool* pool = (threadpool*)p;\n   work_t* work;\nwhile(1)\n{\n    pthread_mutex_lock(&amp;pool-&gt;qlock);\n    if(pool-&gt;shutdown == 1)\n    {\n\n        pthread_mutex_unlock(&amp;pool-&gt;qlock);\n        //pthread_exit(EXIT_SUCCESS);// here is the free problem when deleting it all good\n        return NULL;\n    }\n    while(!pool-&gt;qsize)\n    { \n    if(pthread_cond_wait(&amp;pool-&gt;q_not_empty,&amp;pool-&gt;qlock)) \n         perror(\"pthread_cond_wait\\n\"); \n    if(pool-&gt;shutdown)\n         break;\n      } \n\n    //Check if the system is shutting down\n    if(pool-&gt;shutdown == 1)\n    {\n        pthread_mutex_unlock(&amp;pool-&gt;qlock);\n        //pthread_exit(EXIT_SUCCESS);y\n        return NULL;\n    }\n\n  work = pool-&gt;qhead;    //set the cur variable.\n\n    pool-&gt;qsize--;        //decriment the size.\n\n    if(pool-&gt;qsize == 0) {\n        pool-&gt;qhead = NULL;\n        pool-&gt;qtail = NULL;\n    }\n    else {\n        pool-&gt;qhead = work-&gt;next;\n    }\n\n    if(pool-&gt;qsize == 0 &amp;&amp; ! pool-&gt;shutdown) {\n        //the q is empty again, now signal that its empty.\n        pthread_cond_signal(&amp;(pool-&gt;q_empty));\n    }\n    pthread_mutex_unlock(&amp;(pool-&gt;qlock));\n    (work-&gt;routine) (work-&gt;arg);   //actually do work.\n    free(work);   \n\n}\n }\n</code></pre>\n"}, {"tags": ["c", "sockets", "tcp", "port"], "comments": [{"owner": {"reputation": 56858, "user_id": 131930, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/91536fe27d32713b8a154a0bf42f6748?s=128&d=identicon&r=PG", "display_name": "Jeremy Friesner", "link": "https://stackoverflow.com/users/131930/jeremy-friesner"}, "edited": false, "score": 1, "creation_date": 1547024194, "post_id": 54106160, "comment_id": 95044845, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/15198834/bind-failed-address-already-in-use\">Bind failed: Address already in use</a>"}, {"owner": {"reputation": 10928, "user_id": 1358308, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d9448dee25fd2278def77cb7f0353574?s=128&d=identicon&r=PG", "display_name": "Sam Mason", "link": "https://stackoverflow.com/users/1358308/sam-mason"}, "edited": false, "score": 0, "creation_date": 1547024480, "post_id": 54106160, "comment_id": 95045027, "body": "Sounds like <a href=\"https://stackoverflow.com/a/3233022/1358308\">stackoverflow.com/a/3233022/1358308</a>"}], "owner": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 332, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547025845, "creation_date": 1547023586, "question_id": 54106160, "link": "https://stackoverflow.com/questions/54106160/unbinding-ports", "title": "Unbinding ports", "body": "<p>I launched a process from terminal that bound some ports.</p>\n\n<p>The code in questions is this one:</p>\n\n<pre><code>#include &lt;sys/socket.h&gt;\n#include &lt;sys/un.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;netdb.h&gt;\n\n#define BUF_SIZE 500\n#define LISTEN_BACKLOG 50\n\n#define handle_error(msg) \\\n   do { perror(msg); exit(EXIT_FAILURE); } while (0)\n\nint\nmain(int argc, char *argv[])\n{\n   struct addrinfo hints;\n   struct addrinfo *res, *rp;\n   struct sockaddr_storage peer_addr;\n   socklen_t peer_addr_len;\n   int sfd, cfd;\n\n   if(argc != 3) {\n      fprintf(stderr, \"Usage: %s address port\\n\", argv[0]);\n      exit(EXIT_FAILURE);\n   }\n\n   memset(&amp;hints, 0, sizeof(struct addrinfo));\n   hints.ai_family = AF_UNSPEC;\n   hints.ai_socktype = SOCK_STREAM;\n   hints.ai_flags = AI_PASSIVE;\n   hints.ai_protocol = 0;\n   hints.ai_addr = NULL;\n   hints.ai_next = NULL;\n\n   if(getaddrinfo(argv[1], argv[2], &amp;hints, &amp;res) != 0)\n      handle_error(\"getaddrinfo\");\n\n   // Try each socket until we bind\n   for(rp = res; rp != NULL; rp = rp-&gt;ai_next){\n      sfd = socket(rp-&gt;ai_family, rp-&gt;ai_socktype, 0);\n      if(sfd == -1) continue;\n      if(bind(sfd, rp-&gt;ai_addr, rp-&gt;ai_addrlen) == 0) break;\n      else close(sfd);\n   }\n\n   freeaddrinfo(res);\n\n   if (rp == NULL){\n      fprintf(stderr, \"Could not bind to any socket\\n\");\n      exit(EXIT_FAILURE);\n   }\n\n   // Set the TCP socket to listen state\n   if (listen(sfd, LISTEN_BACKLOG) == -1) handle_error(\"listen\");\n\n   printf(\"Server started\");\n\n   for(;;){\n      // Accept\n      peer_addr_len = sizeof(struct sockaddr_storage);\n      cfd = accept(sfd, (struct sockaddr *) &amp;peer_addr, &amp;peer_addr_len);\n      if (cfd == -1) handle_error(\"accept\");\n\n      // Fork\n      pid_t pid = fork();\n\n      if (pid == 0){ //Child code\n         pid_t my_pid = getpid();\n         char buf[BUF_SIZE];\n         while(1){\n             ssize_t nread = recv(cfd, buf, BUF_SIZE, 0);\n             if (nread == 0) {\n                 close(cfd);\n                 exit(EXIT_SUCCESS);\n             } else {\n                 buf[nread] = 0;\n                 fprintf(stdout, \"Worker %i has received a message: %s\", my_pid, buf);\n                 ssize_t nsent = send(cfd, buf, nread, 0);\n                 if (nsent != nread) fprintf(stderr, \"Error sending response\");\n             }\n\n         }\n   }\n   close(sfd);\n}\n</code></pre>\n\n<p>After invoking the code I killed the process, and noticed that I could not run the program twice using the same port.</p>\n\n<p>I checked <code>sudo lsof -i -P -n | grep LISTEN</code> and it listed the ports I had used for testing as being in LISTEN state and my program being the culprit for that.</p>\n\n<p>How can I unbind the ports? How do I modify my code so it unbinds the ports itself after receiving a suitable signal?</p>\n"}, {"tags": ["c", "openmp", "qsort"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 2, "creation_date": 1547023868, "post_id": 54106118, "comment_id": 95044672, "body": "What is the purpose of nesting that function in that way? Why don&#39;t you define the function outside of other blocks?"}, {"owner": {"reputation": 6899, "user_id": 1212012, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gmBY7.png?s=128&g=1", "display_name": "Mathieu", "link": "https://stackoverflow.com/users/1212012/mathieu"}, "edited": false, "score": 0, "creation_date": 1547024660, "post_id": 54106118, "comment_id": 95045122, "body": "You want to sort <code>index</code> based on tmp_array values, but <code>index</code> is not initialized"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1547046252, "post_id": 54106118, "comment_id": 95058324, "body": "Note that nested function definitions aren&#39;t permitted in standard C."}, {"owner": {"reputation": 752, "user_id": 2167882, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/611e6218ee5392bc30415d2dd48ffbb4?s=128&d=identicon&r=PG", "display_name": "Agargara", "link": "https://stackoverflow.com/users/2167882/agargara"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1547078799, "post_id": 54106118, "comment_id": 95072703, "body": "@Yunnosch If you define the comparison function outside, tmp_array would need to be a global variable, which would screw up the multi-threading."}, {"owner": {"reputation": 752, "user_id": 2167882, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/611e6218ee5392bc30415d2dd48ffbb4?s=128&d=identicon&r=PG", "display_name": "Agargara", "link": "https://stackoverflow.com/users/2167882/agargara"}, "reply_to_user": {"reputation": 6899, "user_id": 1212012, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gmBY7.png?s=128&g=1", "display_name": "Mathieu", "link": "https://stackoverflow.com/users/1212012/mathieu"}, "edited": false, "score": 0, "creation_date": 1547078805, "post_id": 54106118, "comment_id": 95072705, "body": "@Mathieu sorry, my original code initializes index. I&#39;ll edit the question."}, {"owner": {"reputation": 752, "user_id": 2167882, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/611e6218ee5392bc30415d2dd48ffbb4?s=128&d=identicon&r=PG", "display_name": "Agargara", "link": "https://stackoverflow.com/users/2167882/agargara"}, "reply_to_user": {"reputation": 73919, "user_id": 44309, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iL4TW.png?s=128&g=1", "display_name": "High Performance Mark", "link": "https://stackoverflow.com/users/44309/high-performance-mark"}, "edited": false, "score": 0, "creation_date": 1547078810, "post_id": 54106118, "comment_id": 95072707, "body": "@HighPerformanceMark code compiles fine without the openmp."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1547079657, "post_id": 54106118, "comment_id": 95072932, "body": "The strangely named <code>tmp_array</code> variable is a single pointer, which can easily be given as an additional parameter. What else keeps you from avoiding compiler specific extensions?"}, {"owner": {"reputation": 752, "user_id": 2167882, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/611e6218ee5392bc30415d2dd48ffbb4?s=128&d=identicon&r=PG", "display_name": "Agargara", "link": "https://stackoverflow.com/users/2167882/agargara"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1547079826, "post_id": 54106118, "comment_id": 95072965, "body": "@Yunnosch are you saying there&#39;s a way to pass <code>tmp_array</code> to simcmp or qsort? How exactly would one do this?"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1547082111, "post_id": 54106118, "comment_id": 95073429, "body": "<code>double *tmp_array = (double*) malloc(sizeof(double)*10);</code> So it is a single variable of pointer to double type. I really do not get what your problem is. (you can and should skip the casting by the way.)"}, {"owner": {"reputation": 752, "user_id": 2167882, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/611e6218ee5392bc30415d2dd48ffbb4?s=128&d=identicon&r=PG", "display_name": "Agargara", "link": "https://stackoverflow.com/users/2167882/agargara"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1547094339, "post_id": 54106118, "comment_id": 95075826, "body": "@Yunnosch The problem is the comparison function needs to be able to see <code>tmp_array</code>. If I move the comparison function outside of the for loop, <code>tmp_array</code> will no longer be in scope."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1547114083, "post_id": 54106118, "comment_id": 95083321, "body": "The parameter you give to a function will always be visible to the function. How could it not be."}, {"owner": {"reputation": 752, "user_id": 2167882, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/611e6218ee5392bc30415d2dd48ffbb4?s=128&d=identicon&r=PG", "display_name": "Agargara", "link": "https://stackoverflow.com/users/2167882/agargara"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1547201490, "post_id": 54106118, "comment_id": 95119850, "body": "@Yunnosch I think you are fundamentally misunderstanding the problem. With qsort, you can only pass one pointer: the array to be sorted, in this case <code>index</code>. I would also need to pass a pointer to <code>tmp_array</code> because I am sorting <code>index</code> based on the corresponding values in <code>tmp_array</code>. Hence my solution below which uses qsort_r, which allows you to pass a pointer to additional data."}, {"owner": {"reputation": 752, "user_id": 2167882, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/611e6218ee5392bc30415d2dd48ffbb4?s=128&d=identicon&r=PG", "display_name": "Agargara", "link": "https://stackoverflow.com/users/2167882/agargara"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1547202818, "post_id": 54106118, "comment_id": 95120653, "body": "@Yunnosch this github page summarizes the problem <a href=\"https://github.com/noporpoise/sort_r\" rel=\"nofollow noreferrer\">github.com/noporpoise/sort_r</a>: &quot;If you want to qsort() an array with a comparison operator that takes parameters you need to use global variables to pass those parameters (not possible when writing multithreaded code), or use qsort_r/qsort_s which are not portable (there are separate GNU/BSD/Windows versions and they all take different arguments).&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 752, "user_id": 2167882, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/611e6218ee5392bc30415d2dd48ffbb4?s=128&d=identicon&r=PG", "display_name": "Agargara", "link": "https://stackoverflow.com/users/2167882/agargara"}, "is_accepted": false, "score": 1, "last_activity_date": 1547202744, "last_edit_date": 1547202744, "creation_date": 1547080707, "answer_id": 54120490, "question_id": 54106118, "link": "https://stackoverflow.com/questions/54106118/with-openmp-in-c-how-can-i-parallelize-a-for-loop-that-contains-a-nested-compar/54120490#54120490", "title": "With openmp in C, how can I parallelize a for loop that contains a nested comparison function for qsort?", "body": "<p>I solved my problem with <code>qsort_r</code>, which allows you to pass an additional pointer to the comparison function.</p>\n\n<pre><code>#define _GNU_SOURCE\n#include    &lt;stdio.h&gt;\n#include    &lt;stdlib.h&gt;\n#include    &lt;omp.h&gt;\n\nint simcmp(const void *a, const void *b, void *tmp_array){\n    int ia = *(int *)a;\n    int ib = *(int *)b;\n    double aa = ((double *)tmp_array)[ia];\n    double bb = ((double *)tmp_array)[ib];\n    if ((aa - bb) &gt; 1e-12){\n        return -1;\n    }else{\n        return 1;\n    }\n}\n\nint main(){\n    int i;\n#pragma omp parallel for\n    for(i = 0; i &lt; 100; i++){\n        int *index= (int *) malloc(sizeof(int)*10);\n        double *tmp_array = (double*) malloc(sizeof(double)*10);\n        int j;\n        for(j=0; j&lt;10; j++){\n            tmp_array[j] = rand();\n            index[j] = j;\n        }\n        // QuickSort the index array based on tmp_array:\n        qsort_r(index, 10, sizeof(*index), simcmp, tmp_array);\n        free(index);\n        free(tmp_array);\n    }\n    return 0;\n}\n</code></pre>\n\n<p>This compiles and runs with no issue. However, it is not completely ideal as <code>qsort_r</code> is platform and compiler dependent. There is a <a href=\"https://github.com/noporpoise/sort_r\" rel=\"nofollow noreferrer\">portable version of qsort_r here</a> where the author summarizes my problem nicely:</p>\n\n<blockquote>\n  <p>If you want to qsort() an array with a comparison operator that takes\n  parameters you need to use global variables to pass those parameters\n  (not possible when writing multithreaded code), or use qsort_r/qsort_s\n  which are not portable (there are separate GNU/BSD/Windows versions\n  and they all take different arguments).</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 752, "user_id": 2167882, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/611e6218ee5392bc30415d2dd48ffbb4?s=128&d=identicon&r=PG", "display_name": "Agargara", "link": "https://stackoverflow.com/users/2167882/agargara"}, "edited": false, "score": 0, "creation_date": 1547350514, "post_id": 54162220, "comment_id": 95161382, "body": "Thank you for providing some good alternative solutions. Would using <code>threadprivate</code> negatively impact performance compared to qsort_r or the C++11 solution?"}, {"owner": {"reputation": 852, "user_id": 2486527, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acb06de48f6a07656b7189e46f0e131c?s=128&d=identicon&r=PG", "display_name": "Tom Scogland", "link": "https://stackoverflow.com/users/2486527/tom-scogland"}, "reply_to_user": {"reputation": 752, "user_id": 2167882, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/611e6218ee5392bc30415d2dd48ffbb4?s=128&d=identicon&r=PG", "display_name": "Agargara", "link": "https://stackoverflow.com/users/2167882/agargara"}, "edited": false, "score": 1, "creation_date": 1547353723, "post_id": 54162220, "comment_id": 95161761, "body": "Accessing a thread private does incur some cost, depending on the implementation that can be calculating an offset or equivalent to an indirect call. Either way while it\u2019s measurable, it\u2019s at worst similar to the cost classic qsort has for using function pointers to the comparator. The C++ solution, since all calls are static, should be able to optimize out all the calls entirely. All algorithms and else being equal the C++ version should perform best, with the qsort variants all within a small margin of each other on most platforms."}, {"owner": {"reputation": 752, "user_id": 2167882, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/611e6218ee5392bc30415d2dd48ffbb4?s=128&d=identicon&r=PG", "display_name": "Agargara", "link": "https://stackoverflow.com/users/2167882/agargara"}, "edited": false, "score": 0, "creation_date": 1547528828, "post_id": 54162220, "comment_id": 95213457, "body": "I implemented <code>std::sort</code> in my program, and noticed that the comparison function caused my program to hang because it did not provide a strict weak ordering, which std::sort requires. (See <a href=\"https://stackoverflow.com/questions/18291620/why-will-stdsort-crash-if-the-comparison-function-is-not-as-operator\" title=\"why will stdsort crash if the comparison function is not as operator\">stackoverflow.com/questions/18291620/&hellip;</a>) Changing the comparison function to <code>return -1 * ((tmp_array[a] - tmp_array[b]) &gt; 1e-12);</code> fixed this problem. In terms of performance, I found that <code>std::sort</code> was not noticeably faster than <code>qsort_r</code> even when calling <code>sort</code> 100,000 times."}], "tags": [], "owner": {"reputation": 852, "user_id": 2486527, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acb06de48f6a07656b7189e46f0e131c?s=128&d=identicon&r=PG", "display_name": "Tom Scogland", "link": "https://stackoverflow.com/users/2486527/tom-scogland"}, "is_accepted": true, "score": 2, "last_activity_date": 1547314794, "creation_date": 1547314794, "answer_id": 54162220, "question_id": 54106118, "link": "https://stackoverflow.com/questions/54106118/with-openmp-in-c-how-can-i-parallelize-a-for-loop-that-contains-a-nested-compar/54162220#54162220", "title": "With openmp in C, how can I parallelize a for loop that contains a nested comparison function for qsort?", "body": "<p>I realize this has been self answered, but here are some standard C and OpenMP options.  The <code>qsort_r</code> function is a good classic choice, but it's worth noting that <code>qsort_s</code> is part of the c11 standard, and thus is portable wherever c11 is offered (which does not include Windows, they don't quite offer c99 yet).</p>\n\n<p>As to doing it in OpenMP without the nested comparison function, still using original qsort, there are two ways that come to mind.  First is to use the classic global variable in combination with OpenMP <code>threadprivate</code>:</p>\n\n<pre><code>static int *index = NULL;\nstatic double *tmp_array = NULL;\n\n#pragma omp threadprivate(index, tmp_array)\n\nint simcmp(const void *a, const void *b){\n    int ia = *(int *)a;\n    int ib = *(int *)b;\n    double aa = ((double *)tmp_array)[ia];\n    double bb = ((double *)tmp_array)[ib];\n    if ((aa - bb) &gt; 1e-12){\n        return -1;\n    }else{\n        return 1;\n    }\n}\n\nint main(){\n    int i;\n#pragma omp parallel for\n    for(i = 0; i &lt; 100; i++){\n        index= (int *) malloc(sizeof(int)*10);\n        tmp_array = (double*) malloc(sizeof(double)*10);\n        int j;\n        for(j=0; j&lt;10; j++){\n            tmp_array[j] = rand();\n            index[j] = j;\n        }\n        // QuickSort the index array based on tmp_array:\n        qsort_r(index, 10, sizeof(*index), simcmp, tmp_array);\n        free(index);\n        free(tmp_array);\n    }\n    return 0;\n}\n</code></pre>\n\n<p>The version above causes every thread in the parallel region to use a private copy of the global variables index and tmp_array, which takes care of the issue.  This is probably the most portable version you can write in standard C and OpenMP, with the only likely incompatible platforms being those that do not implement thread local memory (some microcontrollers, etc.).</p>\n\n<p>If you want to avoid the global variable and still have portability and use OpenMP, then I would recommend using C++11 and the <code>std::sort</code> algorithm with a lambda:</p>\n\n<pre><code>std::sort(index, index+10, [=](const int&amp; a,  const int&amp; b){\n    if ((tmp_array[a] - tmp_array[b]) &gt; 1e-12){\n        return -1;\n    }else{\n        return 1;\n    }\n});\n</code></pre>\n"}], "owner": {"reputation": 752, "user_id": 2167882, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/611e6218ee5392bc30415d2dd48ffbb4?s=128&d=identicon&r=PG", "display_name": "Agargara", "link": "https://stackoverflow.com/users/2167882/agargara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 54162220, "answer_count": 2, "score": 1, "last_activity_date": 1547314794, "creation_date": 1547023407, "last_edit_date": 1547079071, "question_id": 54106118, "link": "https://stackoverflow.com/questions/54106118/with-openmp-in-c-how-can-i-parallelize-a-for-loop-that-contains-a-nested-compar", "title": "With openmp in C, how can I parallelize a for loop that contains a nested comparison function for qsort?", "body": "<p>I want to parallelize a <code>for</code> loop which contains a nested comparison function for qsort:</p>\n\n<pre><code>#include    &lt;stdio.h&gt;\n#include    &lt;stdlib.h&gt;\n#include    &lt;omp.h&gt;\n\nint main(){\n    int i;\n#pragma omp parallel for\n    for(i = 0; i &lt; 100; i++){\n        int *index= (int *) malloc(sizeof(int)*10);\n        double *tmp_array = (double*) malloc(sizeof(double)*10);\n        int j;\n        for(j=0; j&lt;10; j++){\n            tmp_array[j] = rand();\n            index[j] = j;\n        }\n        // QuickSort the index array based on tmp_array:\n        int simcmp(const void *a, const void *b){\n            int ia = *(int *)a;\n            int ib = *(int *)b;\n            if ((tmp_array[ia] - tmp_array[ib]) &gt; 1e-12){\n                return -1;\n            }else{\n                return 1;\n            }\n        }\n        qsort(index, 10, sizeof(*index), simcmp);\n        free(index);\n        free(tmp_array);\n    }\n    return 0;\n}\n</code></pre>\n\n<p>When I try to compile this, I get the error:</p>\n\n<pre><code>internal compiler error: in get_expr_operands, at tree-ssa-operands.c:881\n }\n</code></pre>\n\n<p>As far as I can tell, this error is due to the nested comparison function. Is there a way to make openmp work with this nested comparison function? If not, is there a good way to achieve a similar result without a nested comparison function?</p>\n\n<p>Edit:\nI'm using GNU C compiler where nested functions are permitted. The code compiles and runs fine without the pragma statement. I can't define simcmp outside of the for loop because tmp_array would then have to be a global variable, which would mess up the multi-threading. However, if somebody has a suggestion to achieve the same result without a nested function, that would be most welcome. </p>\n"}, {"tags": ["c", "scanf"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1547022485, "post_id": 54105766, "comment_id": 95043976, "body": "Looks like you did not show sample input, that would be helpful."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547025735, "post_id": 54105766, "comment_id": 95045711, "body": "Can the <i>lines[]</i> contain the other separators? like <code>&quot;1.SA@#LAM&quot;</code>.  If they cannot, then consider using <code>&quot;%39[^|#@]&quot;</code> for uniformity.  Code will still have the current problem, but makes solutions cleaner."}], "answers": [{"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 3, "last_activity_date": 1547026025, "last_edit_date": 1547026025, "creation_date": 1547023131, "answer_id": 54106040, "question_id": 54105766, "link": "https://stackoverflow.com/questions/54105766/problem-with-matching-empty-string-with-scanf-in-a-special-format/54106040#54106040", "title": "Problem with matching empty string with scanf in a special format", "body": "<blockquote>\n  <p>Each of them can be empty so there is no characters between  ...<br>\n  ... is there some thing that i can add to CUSTOM_PROMPT_REGX to solve my problem?</p>\n</blockquote>\n\n<p>No.  <code>%[...]</code> stops the entire <code>sscanf()</code> when nothing is scanned into a specifier.  At least 1 character must meet the <em>scan set</em>.</p>\n\n<p>Alternatives:</p>\n\n<ol>\n<li><p>Scan using one <code>%[...]</code> directive at a time.   Easier enough to make a loop to do this.</p></li>\n<li><p>Use a non <code>sscanf()</code> approach.   Research <code>strtok(), strspn(), strcspn()</code>.</p></li>\n<li><p>Scan in the lead separator character into the string and later use the string starting from index 1.  In OP's case, no 2 of the 3 separators are use consecutively, so this is a possible approach.</p></li>\n<li><p>Scan into 5 groups per <code>\"%79[^#]#</code> and then sub-divide each.  Research  <code>strchr(buf80, '|');</code></p></li>\n</ol>\n\n<hr>\n\n<p>Tip</p>\n\n<p>Complex <code>sscanf()</code> formats are easier to code, review and maintain by using <em>string literal</em> concatenation.</p>\n\n<pre><code>#define VB_FMT \"%39[^|]|\"\n#define LB_FMT \"%39[^#]#\"\n#define AT_FMT \"%39[^@]@\"\n#define CUSTOM_PROMPT_REGX  \"@\" \\\n    VB_FMT LB_FMT VB_FMT LB_FMT VB_FMT LB_FMT VB_FMT LB_FMT VB_FMT AT_FMT\n</code></pre>\n\n<hr>\n\n<p>Sample code performing 1 <code>sscanf()</code> <code>\"%[]\"</code> specifier at a time.</p>\n\n<pre><code>int main() {\n  #define ATVB_FMT \"@%n%39[^|]%n\"\n  #define VBLB_FMT \"|%n%39[^#]%n\"\n  #define LBVB_FMT \"#%n%39[^|]%n\"\n  #define VBAT_FMT \"|%n%39[^@]@%n\"\n  #define N 10\n\n  const char *fmt[10] = {ATVB_FMT, VBLB_FMT, LBVB_FMT, VBLB_FMT, LBVB_FMT,\n      VBLB_FMT, LBVB_FMT, VBLB_FMT, LBVB_FMT, VBAT_FMT};\n\n  char lines[N][40];\n\n  const char *buf = \\\n      \"@1.SALAM|818BF4F2A8#2.BINGO|828BF8F0F7FE93#3.GOOGLE|838BF1F0F8F0#|#5.WINE|858BF6FE90F8@\";\n  const char *s = buf;\n\n  for (int i = 0; i&lt;N; i++) {\n    int n1 = 0;\n    int n2 = 0;\n    sscanf(s, fmt[i], &amp;n1, lines[i], &amp;n2);\n    if (n1 == 0) {\n      fprintf(stderr, \"Failed to find separator %d\\n\", i);\n      return EXIT_FAILURE;\n    }\n    if (n2 == 0) {\n      lines[i][0] = '\\0';\n      s += n1;\n    } else {\n      s += n2;\n    }\n  }\n\n  if (*s) {\n    fprintf(stderr, \"Failed end %d\\n\", N);\n    return EXIT_FAILURE;\n  }\n\n  for (int i = 0; i&lt;N; i++) {\n    printf(\"&lt;%s&gt;\\n\", lines[i]);\n  }\nreturn 0;\n}\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>&lt;1.SALAM&gt;\n&lt;818BF4F2A8&gt;\n&lt;2.BINGO&gt;\n&lt;828BF8F0F7FE93&gt;\n&lt;3.GOOGLE&gt;\n&lt;838BF1F0F8F0&gt;\n&lt;&gt;\n&lt;&gt;\n&lt;5.WINE&gt;\n&lt;858BF6FE90F8&gt;\n</code></pre>\n"}], "owner": {"reputation": 347, "user_id": 3211593, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3c9939cd088e2101ed406ee85096318d?s=128&d=identicon&r=PG", "display_name": "Hooman", "link": "https://stackoverflow.com/users/3211593/hooman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1547026025, "creation_date": 1547021917, "last_edit_date": 1547023649, "question_id": 54105766, "link": "https://stackoverflow.com/questions/54105766/problem-with-matching-empty-string-with-scanf-in-a-special-format", "title": "Problem with matching empty string with scanf in a special format", "body": "<p>I have <code>CUSTOM_PROMPT_REGX</code> pattern with special conditions.</p>\n\n<p>It's supposed to capture 10 texts which come after each other with <code>|</code> or <code>#</code> as separators.\nEach of them can be empty so there is no characters between <code>|</code> or <code>#</code> and it will be like <code>\"..|#...\"</code></p>\n\n<p>My code is :</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n\n\n#define CUSTOM_PROMPT_REGX  \"@%39[^|]|%39[^#]#%39[^|]|%39[^#]#%39[^|]|%39[^#]#%39[^|]|%39[^#]#%39[^|]|%39[^@]@\"\nstatic unsigned char lines[5][2][40];\n\nint main(void)\n{\n    memset(lines, 0, sizeof(lines));\n    int j = sscanf(\"@1.SALAM|818BF4F2A8#2.BINGO|828BF8F0F7FE93#3.GOOGLE|838BF1F0F8F0#|#5.WINE|858BF6FE90F8@\", CUSTOM_PROMPT_REGX,\n           lines[0][0], lines[0][1], lines[1][0], lines[1][1],\n           lines[2][0], lines[2][1], lines[3][0], lines[3][1], lines[4][0], lines[4][1]);\n\n    printf(\"%d\\n[%s &lt;=&gt; %s]\\n[%s &lt;=&gt; %s]\\n[%s &lt;=&gt; %s]\\n[%s &lt;=&gt; %s]\\n[%s &lt;=&gt; %s]\\n\", j,\n           lines[0][0], lines[0][1], lines[1][0], lines[1][1], lines[2][0], lines[2][1],\n           lines[3][0], lines[3][1], lines[4][0], lines[4][1]);\n    return 0;\n}\n</code></pre>\n\n<p>and the result is :</p>\n\n<pre><code>6\n[1.SALAM &lt;=&gt; 818BF4F2A8]\n[2.BINGO &lt;=&gt; 828BF8F0F7FE93]\n[3.GOOGLE &lt;=&gt; 838BF1F0F8F0]\n[ &lt;=&gt; ]\n[ &lt;=&gt; ]\nPress &lt;RETURN&gt; to close this window...\n</code></pre>\n\n<p>It should be :</p>\n\n<pre><code>8\n[1.SALAM &lt;=&gt; 818BF4F2A8]\n[2.BINGO &lt;=&gt; 828BF8F0F7FE93]\n[3.GOOGLE &lt;=&gt; 838BF1F0F8F0]\n[ &lt;=&gt; ]\n[5.WINE &lt;=&gt; 858BF6FE90F8]\n</code></pre>\n\n<p>Is there something that i can add to <code>CUSTOM_PROMPT_REGX</code> to solve my problem?</p>\n"}, {"tags": ["c", "arrays", "memory", "valgrind"], "comments": [{"owner": {"reputation": 3126, "user_id": 2955790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vShcC.png?s=128&g=1", "display_name": "Duck Dodgers", "link": "https://stackoverflow.com/users/2955790/duck-dodgers"}, "edited": false, "score": 1, "creation_date": 1547022073, "post_id": 54105727, "comment_id": 95043789, "body": "That is a lot of code."}, {"owner": {"reputation": 1978, "user_id": 7911776, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2jbsL.jpg?s=128&g=1", "display_name": "Nicol&#225;s Alarc&#243;n Rapela", "link": "https://stackoverflow.com/users/7911776/nicol%c3%a1s-alarc%c3%b3n-rapela"}, "edited": false, "score": 0, "creation_date": 1547022265, "post_id": 54105727, "comment_id": 95043867, "body": "You must be change the code and you must be specificated your problem with the porcion the code that produced the problem"}, {"owner": {"reputation": 2462, "user_id": 2705907, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/e2UTS.jpg?s=128&g=1", "display_name": "Vagish", "link": "https://stackoverflow.com/users/2705907/vagish"}, "edited": false, "score": 0, "creation_date": 1547022310, "post_id": 54105727, "comment_id": 95043891, "body": "I think we should consider this code for <a href=\"https://codereview.stackexchange.com/\">codereview.stackexchange.com</a> ."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547022340, "post_id": 54105727, "comment_id": 95043901, "body": "it is impossible to compile your code"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10888396, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-L9xBSpcDuW8/AAAAAAAAAAI/AAAAAAAAAAc/HbidHmEUjlM/photo.jpg?sz=128", "display_name": "Simo Bitton", "link": "https://stackoverflow.com/users/10888396/simo-bitton"}, "edited": false, "score": 0, "creation_date": 1547023156, "post_id": 54106017, "comment_id": 95044313, "body": "How can I prevent this from happening ?"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 1, "user_id": 10888396, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-L9xBSpcDuW8/AAAAAAAAAAI/AAAAAAAAAAc/HbidHmEUjlM/photo.jpg?sz=128", "display_name": "Simo Bitton", "link": "https://stackoverflow.com/users/10888396/simo-bitton"}, "edited": false, "score": 1, "creation_date": 1547023220, "post_id": 54106017, "comment_id": 95044334, "body": "You have to free the dynamic memory referenced from <i>dynamicArray</i> before the end of <i>main</i>, but for me this is useless because this is not a problem"}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": false, "score": 1, "last_activity_date": 1547023029, "creation_date": 1547023029, "answer_id": 54106017, "question_id": 54105727, "link": "https://stackoverflow.com/questions/54105727/memory-leaks-in-dynamic-array-of-structs-and-linkedlist-even-though-i-freed-ever/54106017#54106017", "title": "Memory leaks in dynamic array of structs and linkedlist even though I freed every malloc", "body": "<blockquote>\n  <p>I have 72 bytes still reachable</p>\n</blockquote>\n\n<p>These bytes are not a memory leak, there are still reachable through for instance the variable <em>dynamicArray</em> in <em>main</em></p>\n\n<p>Valgrind indicates explicitely when a it is a memory leak</p>\n"}], "owner": {"reputation": 1, "user_id": 10888396, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-L9xBSpcDuW8/AAAAAAAAAAI/AAAAAAAAAAc/HbidHmEUjlM/photo.jpg?sz=128", "display_name": "Simo Bitton", "link": "https://stackoverflow.com/users/10888396/simo-bitton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1547024729, "creation_date": 1547021731, "last_edit_date": 1547024729, "question_id": 54105727, "link": "https://stackoverflow.com/questions/54105727/memory-leaks-in-dynamic-array-of-structs-and-linkedlist-even-though-i-freed-ever", "title": "Memory leaks in dynamic array of structs and linkedlist even though I freed every malloc", "body": "<p>When I ran valgrind on my project 4 of 5 allocations weren't freed and I can't wrap my head around why.</p>\n\n<p>I tried dereferencing and freeing variables that seemed problematic.</p>\n\n<pre><code>      #include &lt;stdio.h&gt;\n    #include &lt;string.h&gt;\n    #include &lt;stdlib.h&gt;\n\n    #define MAX_LINE 1000\n    #define INPUT_NUM 9\n\n    enum hobbies{BASEBALL=1, BASKETBALL, BICYCLE, BOOKS,\n        DRAWING, GYM, MOVIES, POETRY};\n    typedef struct User{\n        char *ID, *firstName, *lastName, *userName, *password, *description;\n        char sex, hobbies;\n        int age;\n    }User;\n\n    typedef struct UserItem UserItem;\n    struct UserItem{\n        User* data;\n        UserItem* next;\n    };\n    typedef struct{\n        UserItem *head, *last;\n    }UserList;\n\n    typedef struct DynamicArray{\n        int size;\n        int capacity;\n        User** array;\n    }DynamicArray;\n\n    typedef int(*Comparator)(User*, User);\n\n    typedef enum {false, true} bool;\n\n\n    void updateData(char *info[9], DynamicArray *dynamicArray, UserList **userList){\n        //Male-Array\n        if(info[4][0]=='M')\n        {\n            incrementArray(dynamicArray);\n            dynamicArray-&gt;array[dynamicArray-&gt;size]=realloc(dynamicArray-&gt;array[dynamicArray-&gt;size],sizeof(User));\n            newUser(info,dynamicArray-&gt;array[dynamicArray-&gt;size]);\n            dynamicArray-&gt;size++;\n        }\n        //Female -Linked List\n        else {\n            User *user=malloc(sizeof(User));\n            newUser(info,user);\n            add(*userList,user);\n        }\n    }\n\n    User* newUser(char* info[INPUT_NUM],User* user){\n        user-&gt;ID=strdup(info[0]);\n        if((user-&gt;firstName =(char*)malloc(strlen(info[1])+1))==NULL)\n        {\n            printf(\"error\\n\");\n            exit(1);\n        }\n        strcpy(user-&gt;firstName,info[1]);\n        if((user-&gt;lastName =(char*)malloc(strlen(info[2])+1))==NULL)\n        {\n            printf(\"error\\n\");\n            exit(1);\n        }\n        strcpy(user-&gt;lastName,info[2]);\n        user-&gt;age=atoi(info[3]);\n        user-&gt;sex=*info[4];\n        if((user-&gt;userName =(char*)malloc(strlen(info[5])+1))==NULL)\n        {\n            printf(\"error\\n\");\n            exit(1);\n        }\n        strcpy(user-&gt;userName,info[5]);\n        if((user-&gt;password =(char*)malloc(strlen(info[6])+1))==NULL)\n        {\n            printf(\"error\\n\");\n            exit(1);\n        }\n        strcpy(user-&gt;password,info[6]);\n        user-&gt;hobbies|=1&lt;&lt;(8-(*(info[7])-'0'));\n        user-&gt;hobbies|=1&lt;&lt;(8-(*((info[7])+2)-'0'));\n        user-&gt;hobbies|=1&lt;&lt;(8-(*((info[7])+4)-'0'));\n        user-&gt;hobbies|=1&lt;&lt;(8-(*((info[7])+6)-'0'));\n        if((user-&gt;description =(char*)malloc(strlen(info[8])+1))==NULL)\n        {\n            printf(\"error\\n\");\n            exit(1);\n        }\n        strcpy(user-&gt;description,info[8]);\n        return user;\n    }\n\n    void newUserList(UserList** list){\n        *list=(UserList*)malloc(sizeof(UserList));\n        if(*list==NULL){\n            printf(\"error\\n\");\n            exit(1);\n        }\n        (*list)-&gt;head=(UserItem*)malloc(sizeof(UserItem));\n        (*list)-&gt;head-&gt;data=NULL;\n        (*list)-&gt;head-&gt;next=NULL;\n        (*list)-&gt;last=((*list)-&gt;head);\n    }\n\n    void newDynamicArray(DynamicArray *array){\n        array-&gt;size=0;\n        array-&gt;capacity=5;\n        array-&gt;array=(User**)calloc((array-&gt;capacity),sizeof(User*));\n    }\n\n\n    void freeUser(User* user){\n        if(user!=NULL){\n            free(user-&gt;ID);\n            free(user-&gt;firstName);\n            free(user-&gt;lastName);\n            free(user-&gt;userName);\n            free(user-&gt;password);\n            free(user-&gt;description);\n        }\n    }\n\n    void freeUserItem(UserItem* item){\n        if(item!=NULL){\n            freeUser(item-&gt;data);\n            freeUserItem(item-&gt;next);\n            free(item);\n            item=NULL;\n        }\n    }\n\n    void freeUserList(UserList* list){\n        freeUserItem(list-&gt;head);\n    }\n\n    void freeArray(DynamicArray *dynamicArray){\n        int i;\n        for (i=0;i&lt;dynamicArray-&gt;capacity;i++){\n            freeUser(dynamicArray-&gt;array[i]);\n            free(dynamicArray-&gt;array[i]);\n        }\n        free(dynamicArray-&gt;array);\n        dynamicArray-&gt;array=NULL;\n    }\n\n    void start(DynamicArray* dynamicArray, UserList* userList){\n        FILE *input;\n        int c,index;\n        char line[MAX_LINE];\n        char* info[INPUT_NUM];\n        input = fopen(\"input.txt\",\"rt\");\n        if(input) {\n            while (EOF != (c = fgetc(input))) {\n                ungetc(c, input);\n                fgets(line, MAX_LINE, input);\n                info[0] = strtok(line, \";\");\n                index = 1;\n                while (index &lt; INPUT_NUM) {\n                    info[index] = strtok(NULL, \";\");\n                    index++;\n                }\n                updateData(info, dynamicArray, &amp;userList);\n            }\n        }\n        else\n            exit(1);\n        fclose(input);\n    }\n\n    int main() {\n        int choice;\n        DynamicArray dynamicArray;\n        newDynamicArray(&amp;dynamicArray);\n        UserList* userList;\n        newUserList(&amp;userList);\n        start(&amp;dynamicArray, userList);\n        bubbleSort(&amp;userList, (Comparator) lastNameComparator);\n        do{\n            printf(\"Welcome! please choose an option\\n\"\n                   \"1 - Log in\\n\"\n                   \"2 - New member\\n\"\n                   \"3 \u2013 Exit\\n\");\n            scanf(\"%d\",&amp;choice);\n            switch(choice){\n                case 1:\n                    login(&amp;dynamicArray, &amp;userList);\n                    break;\n                case 2:\n                    addNewMember(&amp;dynamicArray, &amp;userList);\n                    break;\n                case 3:\n                    end(&amp;dynamicArray,userList);\n                    break;\n                default:\n                    printf(\"Bad choice, please try again\\n\");\n                    break;\n            }\n        }while(choice!=3);\n        return 0;\n    }\n\n    void end(DynamicArray* dynamicArray, UserList* userList){\n       // FILE *output;\n        //output=fopen(\"output.txt\",\"w\");\n        //fclose(output);\n        freeAllMemory(dynamicArray, userList);\n    }\n\n    void add(UserList *userList, User *newUser) {\n        UserItem* item=(UserItem*)malloc(sizeof(UserItem));\n        item-&gt;data=newUser;\n        item-&gt;next=NULL;\n        userList-&gt;last-&gt;next=item;\n        userList-&gt;last=item;\n        if(userList-&gt;head-&gt;data==NULL)\n            userList-&gt;head=userList-&gt;last;\n    }\n\n    void login(DynamicArray* dynamicArray, UserList** userList){\n        User* user;\n        char username[10],password[15];\n        printf(\"Please enter your username: \\n\");\n        scanf(\"%s\",username);\n        user=usernameExists(username,*userList,dynamicArray);\n        if(user==NULL){\n            printf(\"User do not exist in the system, please try again \\n\");\n            //Another try\n            printf(\"Please enter your username: \\n\");\n            scanf(\"%s\",username);\n            user=usernameExists(username,*userList,dynamicArray);\n            if(user==NULL)\n                return;\n        }\n        printf(\"Please enter your password: \\n\");\n        scanf(\"%s\",password);\n        //Wrong password\n        if(strcmp(password,user-&gt;password)!=0){\n            printf(\"Wrong password\\n\");\n            return;\n        }\n        //Login successful\n        printf(\"Hello %s!\\n\", user-&gt;firstName);\n        mainMenu(dynamicArray, userList, user);\n    }\n\n    void addNewMember(DynamicArray* dynamicArray, UserList** userList){\n        char* info[INPUT_NUM];\n        char id[9], tmp1[15], tmp2[10], age[3], sex, description[211];\n        int i;\n        //Prevent NULL\n        for(i=0;i&lt;INPUT_NUM;i++)//Prevent NULL\n            info[i]=\"\";\n        printf(\"Please enter your ID: \\n\");\n        //ID\n        scanf(\"%s\",id);\n        if(idExists(id,dynamicArray,*userList)) {\n            printf(\"Error: User already exists\");\n            return;\n        }\n        strcpy(id,info[0]);\n        //First name\n        printf(\"Please enter your first name:\\n\");\n        scanf(\"%s\",tmp1);\n        if(strlen(tmp1)&lt;3||(!containsOnlyLetters(tmp1)))\n            return;\n        strcpy(tmp1,info[1]);\n        //Last name\n        printf(\"Please enter your last name:\\n\");\n        scanf(\"%s\",tmp1);\n        if(strlen(tmp1)&lt;3||(!containsOnlyLetters(tmp1)))\n            return;\n        strcpy(tmp1,info[2]);\n        //Age\n        printf(\"Please enter your age (18 to 100):\\n\");\n        scanf(\"%s\",age);\n        if (atoi(age)&lt;18||atoi(age)&gt;100)\n            return;\n        strcpy(age,info[3]);\n        //Sex\n        printf(\"Please enter your gender (F-female, M-male):\\n\");\n        scanf(\"%c\", &amp;sex);//Dummy\n        scanf(\"%c\", &amp;sex);\n        if (sex!='M'&amp;&amp;sex!='F')\n            return;\n        info[4]=&amp;sex;\n        //Username\n        printf(\"Choose a username (3-10 characters):\\n\");\n        scanf(\"%s\", tmp2);\n        if(strlen(tmp2)&lt;3||tmp2[0]&lt;65||tmp2[0]&gt;122||(tmp2[0]&gt;=91&amp;&amp;tmp2[0]&lt;=96))\n            return;\n        strcpy(tmp2,info[5]);\n        printf(\"please choose 4 hobbies: Baseball=1, Basketball=2, Bicycle=3, Books=4,\"\n               \" Drawing=5, Gym=6, Movies=7, Poetry=8\\n\");\n        scanf(\" %8[^\\n]\",tmp2);\n        strcpy(tmp2,info[7]);\n        printf(\"Choose a password (attention-minimum 3 characters):\\n\");\n        scanf(\"%s\",tmp1);\n        if(strlen(tmp1)&lt;3)\n            return;\n        strcpy(tmp1,info[6]);\n        printf(\"Some words about yourself:\\n\");\n        scanf(\" %s\",description);\n        strcpy(description,info[8]);\n        updateData(info,dynamicArray,userList);\n        printf(\"Hi %s, lets find love!\\n\", info[1]);\n        mainMenu(dynamicArray,userList,usernameExists(info[5],*userList,dynamicArray));\n    }\n\n    User* usernameExists(char *username, UserList *userList, DynamicArray *dynamicArray){\n        int i;\n        for (i=0;i&lt;dynamicArray-&gt;size;i++)\n            if(strcmp(dynamicArray-&gt;array[i]-&gt;userName,username)==0)\n                return dynamicArray-&gt;array[i];\n        UserItem* iterator = newIterator(userList);\n        while(iterator!=NULL&amp;&amp;iterator-&gt;data!=NULL){\n            if(strcmp(iterator-&gt;data-&gt;userName,username)==0)\n                return iterator-&gt;data;\n            iterator=iterator-&gt;next;\n        }\n        return NULL;\n    }\n\n    UserItem* newIterator (UserList* userList){\n        return userList-&gt;head;\n    }\n\n    int idExists(char *ID, DynamicArray *dynamicArray, UserList *userList){\n        int i=0;\n        for (i=0;i&lt;dynamicArray-&gt;size;i++)\n            if(strcmp(dynamicArray-&gt;array[i]-&gt;ID,ID)==0)\n                return 1;\n        UserItem* iterator = newIterator(userList);\n        while(iterator!=NULL&amp;&amp;iterator-&gt;data!=NULL){\n            if(strcmp(iterator-&gt;data-&gt;ID,ID)==0)\n                return 1;\n            iterator=iterator-&gt;next;\n        }\n        return 0;\n    }\n\n\n    int containsOnlyLetters(char str[]){\n        int i;\n        for(i=0;i&lt;strlen(str);i++)\n            if(str[i]&lt;65||str[i]&gt;122||(str[i]&gt;=91&amp;&amp;str[i]&lt;=96))\n                return 0;\n        return 1;\n    }\n\n    void freeAllMemory(DynamicArray* dynamicArray, UserList* userList){\n        freeArray(dynamicArray);\n        freeUserList(userList);\n    }\n\n    void removeUserFromList(UserList* list, User* user){\n        UserItem* iterator=newIterator(list);\n        UserItem* previous=list-&gt;head;\n\n        while(iterator!=NULL &amp;&amp; iterator-&gt;data!=NULL &amp;&amp; equal(iterator-&gt;data,user)== false){\n            previous=iterator;\n            iterator=iterator-&gt;next;\n        }\n        if(iterator!=NULL &amp;&amp; iterator-&gt;data!=NULL &amp;&amp; equal(iterator-&gt;data,user)== true){\n            previous-&gt;next=iterator-&gt;next;\n            iterator-&gt;next=NULL;\n            freeUserItem(iterator);\n            if(iterator==list-&gt;head) {\n                list-&gt;head = NULL;\n                list-&gt;last = NULL;\n            }\n            if(iterator==list-&gt;last)\n                list-&gt;last=previous;\n        }\n    }\n\n    bool equal(User* u1, User* u2){\n        if(u1-&gt;ID==u2-&gt;ID)\n            return true;\n        return false;\n    }\n\n    void removeUserFromArray(DynamicArray* dynamicArray, User* user){\n        int i,j,found=0;\n        User  *tmp;\n        //Find index\n        for (i=0;i&lt;dynamicArray-&gt;size;i++)\n            if(strcmp(dynamicArray-&gt;array[i]-&gt;ID,user-&gt;ID)==0) {\n                found = 1;\n                break;\n            }\n        if(found) {\n            tmp = dynamicArray-&gt;array[i];\n            for (j = i; j + 1 &lt; dynamicArray-&gt;size; j++) {\n                dynamicArray-&gt;array[j] = dynamicArray-&gt;array[j+1];\n            }\n            freeUser(tmp);\n            dynamicArray-&gt;size--;\n        }\n    }\n\n    void deleteMe(DynamicArray* dynamicArray, UserList* list, User *user){\n        removeUserFromArray(dynamicArray,user);\n        removeUserFromList(list,user);\n    }\n\n\n    void incrementArray(DynamicArray *array){\n        if(array-&gt;size&gt;=array-&gt;capacity){\n            array-&gt;capacity*=2;\n           array-&gt;array=realloc(array-&gt;array, sizeof(User*)*array-&gt;capacity);\n        }\n    }\n</code></pre>\n\n<p>I can't seen me to find the leak and what is causing it, valgrind shows I have 72 bytes still reachable in newDynamicArray function and in newUserList.</p>\n"}, {"tags": ["c", "permutation"], "comments": [{"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1547019166, "post_id": 54104925, "comment_id": 95042494, "body": "Your program does not create the output you claim. Please never ever modify the output by sorting etc. Instead show us what the program really prints. And of course also show us the wrong output. Not only the correct cases."}, {"owner": {"reputation": 1543, "user_id": 7267150, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/daaac3b040330dcbbbe64bcba04cfc82?s=128&d=identicon&r=PG&f=1", "display_name": "some user", "link": "https://stackoverflow.com/users/7267150/some-user"}, "edited": false, "score": 0, "creation_date": 1547019400, "post_id": 54104925, "comment_id": 95042589, "body": "backtracking is a way, if you&#39;re interested in iterative solution: <a href=\"https://www.geeksforgeeks.org/johnson-trotter-algorithm/\" rel=\"nofollow noreferrer\">geeksforgeeks.org/johnson-trotter-algorithm</a>"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1547021678, "post_id": 54104925, "comment_id": 95043622, "body": "I disagree with the duplicate mark, the problem here is more simple, the solution for &quot;Print all permutation in lexicographic order&quot; are more complicated and must not be followed for the current problem"}], "answers": [{"comments": [{"owner": {"reputation": 2268, "user_id": 10872397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca60fd27093da844faa62ca04d0fa7da?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/10872397/rahul"}, "edited": false, "score": 0, "creation_date": 1547019057, "post_id": 54105069, "comment_id": 95042427, "body": "Forgot to mention that I am aware of it. I will add it. My questions is how to correct it ?"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 2268, "user_id": 10872397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca60fd27093da844faa62ca04d0fa7da?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/10872397/rahul"}, "edited": false, "score": 0, "creation_date": 1547019989, "post_id": 54105069, "comment_id": 95042823, "body": "@user101 I hoped you can found by yourself from my remark about fact, anyway I edited my answer with a proposal"}, {"owner": {"reputation": 2268, "user_id": 10872397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca60fd27093da844faa62ca04d0fa7da?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/10872397/rahul"}, "edited": false, "score": 0, "creation_date": 1547020278, "post_id": 54105069, "comment_id": 95042965, "body": "Could you please explain that <i>permute</i> function ?"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 2268, "user_id": 10872397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca60fd27093da844faa62ca04d0fa7da?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/10872397/rahul"}, "edited": false, "score": 0, "creation_date": 1547021409, "post_id": 54105069, "comment_id": 95043497, "body": "@user101 I added comments to explain the role of the variables, if you still cannot understand please execute it under a debugger, the algorithm is trivial"}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": false, "score": 1, "last_activity_date": 1547021287, "last_edit_date": 1547021287, "creation_date": 1547018783, "answer_id": 54105069, "question_id": 54104925, "link": "https://stackoverflow.com/questions/54104925/listing-all-permutations-of-digits-without-repeating-in-c-language/54105069#54105069", "title": "Listing all permutations of digits without repeating in C language", "body": "<blockquote>\n  <p>What am I missing ?</p>\n</blockquote>\n\n<p>The number of possibilities to order n elements is <code>factorial(n)</code>, your two imbricated <em>for</em> cannot compute <code>factorial(n)</code> for any value of <em>n</em> so they cannot find all the orders.</p>\n\n<hr>\n\n<p>a possible solution is :</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n/* current is the number under fabrication \n   max is the max number of digit and also the max digit to use\n   n is the number of digits to add to current\n   used[n] is 0 if the digit n is not yet used, else 1 */\n\nvoid permut(unsigned current, unsigned max, unsigned n, int used[])\n{\n  if (n == 0)\n    printf(\"%d\\n\", current);\n  else {\n    unsigned i;\n\n    for (i = 1; i &lt;= max; ++i) {\n      if (!used[i]) {\n        used[i] = 1;\n        permut(current*10 + i, max, n - 1, used);\n        used[i] = 0;\n      }\n    }\n  }\n}\n\nint main()\n{\n  unsigned n;\n  int used[10] = { 0 }; /* used[n] is 0 if the digit n is not yet used */\n\n  printf(\"No of digits? : \");\n  if ((scanf(\"%u\", &amp;n) != 1) || (n == 0) || (n &gt; 9))\n    return 0;\n\n  permut(0, n, n, used);\n  return 0;\n}\n</code></pre>\n\n<p>for 2 :</p>\n\n<pre><code>12\n21\n</code></pre>\n\n<p>for 3 : </p>\n\n<pre><code>123\n132\n213\n231\n312\n321\n</code></pre>\n\n<p>for 4 :</p>\n\n<pre><code>1234\n1243\n1324\n1342\n1423\n1432\n2134\n2143\n2314\n2341\n2413\n2431\n3124\n3142\n3214\n3241\n3412\n3421\n4123\n4132\n4213\n4231\n4312\n4321\n</code></pre>\n"}], "owner": {"reputation": 2268, "user_id": 10872397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca60fd27093da844faa62ca04d0fa7da?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/10872397/rahul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2157, "favorite_count": 1, "closed_date": 1547020586, "answer_count": 1, "score": 3, "last_activity_date": 1547021287, "creation_date": 1547018146, "last_edit_date": 1547019416, "question_id": 54104925, "link": "https://stackoverflow.com/questions/54104925/listing-all-permutations-of-digits-without-repeating-in-c-language", "closed_reason": "Duplicate", "title": "Listing all permutations of digits without repeating in C language", "body": "<p>So I have this assignment question in C language which I have worked on for last 5 hours but can't figure out what's wrong.</p>\n\n<p><strong>Problem Statement:</strong></p>\n\n<p>Take n as number of digits from 1 to 9 and prints all the possible numbers formed without repeating digits. For E.g. If n = 3, then digits are 1,2,3 and numbers are 123, 132, 231, 213, 321, 312.   </p>\n\n<p>Input: 2    Output: 12, 21</p>\n\n<p>Input: 3    Output: 123, 132, 231, 213, 321, 312</p>\n\n<p><strong>This is what I have done so far:</strong></p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;string.h&gt;\n#include&lt;math.h&gt;\n#define N 10\n\nvoid print(int *num, int n)\n{\n    int i;\n    for ( i = 0 ; i &lt; n ; i++){\n        printf(\"%d\", num[i]);\n    }\n    printf(\"\\n\");\n}\n\nint main()\n{\n    int num[N];\n    int temp;\n    int i, n, j,k;\n\n    printf(\"\\nNo of digits? : \");\n    scanf(\"%d\", &amp;n);\n\n    for(k=0; k&lt;n; k++){\n        num[k] = k + 1; \n    }\n\n    for (j = 1; j &lt;= n; j++) {\n        for (i = 0; i &lt; n-1; i++) {\n            temp = num[i];\n            num[i] = num[i+1];\n            num[i+1] = temp;\n            print(num, n);\n        }\n    }\n    return 0;\n}\n</code></pre>\n\n<p>I am getting expected result for digits upto 3. \nBut from 4 it's not showing all permutations of digits. </p>\n\n<pre><code>No of digits? : 4\n\n2134\n2314\n2341\n3241\n3421\n3412\n4312\n4132\n4123\n1423\n1243\n1234\n</code></pre>\n\n<p>On setting counter to go till <strong>n!</strong> array will be out of index.</p>\n\n<p>So how to correctly count all permutations ?</p>\n"}, {"tags": ["c", "gdb"], "answers": [{"tags": [], "owner": {"reputation": 2837, "user_id": 9926721, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3uZyl-aeJ0M/AAAAAAAAAAI/AAAAAAAAACA/dTz1snmrSXQ/photo.jpg?sz=128", "display_name": "funnydman", "link": "https://stackoverflow.com/users/9926721/funnydman"}, "is_accepted": false, "score": 2, "last_activity_date": 1547017087, "creation_date": 1547017087, "answer_id": 54104695, "question_id": 54104555, "link": "https://stackoverflow.com/questions/54104555/gdb-execute-next-instruction-after-watchpoint-is-hit/54104695#54104695", "title": "GDB execute next instruction after watchpoint is hit", "body": "<p>Before <code>watch *a</code> you may run the program via <code>run</code>. </p>\n\n<p>If not you'll get something like this: <code>No symbol \"a\" in current context.</code></p>\n\n<p>So try this:</p>\n\n<pre><code>b foo\nrun\nwatch *a\ncommands\n    si\n    info reg\n    cont\nend\ncont\n</code></pre>\n"}], "owner": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547017087, "creation_date": 1547016425, "question_id": 54104555, "link": "https://stackoverflow.com/questions/54104555/gdb-execute-next-instruction-after-watchpoint-is-hit", "title": "GDB execute next instruction after watchpoint is hit", "body": "<p>I have a function of the following form:</p>\n\n<pre><code>void foo(){\n    int *a = //...\n    *a = 1;\n    //some actions\n    *a = 2;\n    //some actions\n    *a = 3;\n    //some actions\n    //etc...\n}\n</code></pre>\n\n<p>I want to set a watchpoint on <code>a</code>, execute next instruction with <code>si</code>, print registers and then continue until the watchpoint of <code>a</code> is hit again and repeat that.</p>\n\n<p>I wrote the following script:</p>\n\n<pre><code>b foo\nwatch *a\ncommands\n    si\n    info reg\n    cont\nend\ncont\n</code></pre>\n\n<p>The problem is it stops after the first watchpoint is hit and neither prints registers and nor continues execution. As I read in <a href=\"https://sourceware.org/gdb/onlinedocs/gdb/Break-Commands.html\" rel=\"nofollow noreferrer\">docs</a></p>\n\n<blockquote>\n  <p>Any other commands in the command list, after a command that resumes\n  execution, are ignored. This is because any time you resume execution\n  (even with a simple next or step), you may encounter another\n  breakpoint\u2014which could have its own command list, leading to\n  ambiguities about which list to execute.</p>\n</blockquote>\n\n<p>everything after <code>si</code> is simply ignored.</p>\n\n<p>Is there a way to write such a script (<code>gdb</code> or <code>python</code>)?</p>\n"}, {"tags": ["c", "gcc", "tcc"], "comments": [{"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1547016216, "post_id": 54104344, "comment_id": 95041233, "body": "Try to <code>#include &lt;winreg.h&gt;</code>"}, {"owner": {"reputation": 126, "user_id": 10887989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/231b9b3e837309154c6b7e96c7a7f263?s=128&d=identicon&r=PG&f=1", "display_name": "TimeLoad", "link": "https://stackoverflow.com/users/10887989/timeload"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1547596660, "post_id": 54104344, "comment_id": 95243618, "body": "I have tried that, still doesn&#39;t work."}, {"owner": {"reputation": 3698, "user_id": 1848585, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9JLaK.png?s=128&g=1", "display_name": "Brian Tiffin", "link": "https://stackoverflow.com/users/1848585/brian-tiffin"}, "edited": false, "score": 0, "creation_date": 1549093561, "post_id": 54104344, "comment_id": 95788049, "body": "@TimeLoad, from a quick glance at MSDN docs, and no experience.  Is there some name mangling in a macro going on? and the actual link symbol is <code>RegOpenKeyA</code>?  Maybe.  Not tried."}], "owner": {"reputation": 126, "user_id": 10887989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/231b9b3e837309154c6b7e96c7a7f263?s=128&d=identicon&r=PG&f=1", "display_name": "TimeLoad", "link": "https://stackoverflow.com/users/10887989/timeload"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547015273, "creation_date": 1547015273, "question_id": 54104344, "link": "https://stackoverflow.com/questions/54104344/tcc-cannot-find-windows-api-functions-but-gcc-can", "title": "TCC Cannot Find Windows API Functions But GCC Can", "body": "<p>I am writing a program that access registry keys using Windows APIs. I'm trying to compile my program with TCC but it's throwing an \"undefined symbol\" error regarding the functions I'm calling from the Windows APIs. I decided to try and compile it again with GCC and it works perfectly, no problems at all.</p>\n\n<p>I've written programs that utilise Windows APIs before and compiled them perfectly fine with TCC, but whenever I try to compile anything that has something to do with the registry side of Windows APIs, it returns \"undefined symbol\" errors.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;Windows.h&gt;\n\nint main(int argc, char *argv[])\n{\n  HKEY hkey = HKEY_LOCAL_MACHINE;\n  char key_name[] = \"SOFTWARE\\\\7-zip\";\n  HKEY key = NULL;\n\n  DWORD err = RegOpenKey(hkey, key_name, &amp;key);\n\n  if (err != ERROR_SUCCESS)\n  {\n    printf(\"error opening key: %d\\n\", err);\n  }\n  else\n  {\n    printf(\"success\");\n  }\n}\n</code></pre>\n"}, {"tags": ["c", "arrays"], "comments": [{"owner": {"reputation": 3222, "user_id": 5533928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/517d5a0e08d76cd446ac7e6b156093a4?s=128&d=identicon&r=PG&f=1", "display_name": "Susmit Agrawal", "link": "https://stackoverflow.com/users/5533928/susmit-agrawal"}, "edited": false, "score": 0, "creation_date": 1547015455, "post_id": 54104318, "comment_id": 95040989, "body": "Just declare <code>C</code> as <code>int **C;</code>. Then you can use the statement   : <code>C=cofactor(D, n, r, c);</code>"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1547015961, "post_id": 54104318, "comment_id": 95041142, "body": "Or... declare C with automatic storage duration (e.g. another normal 2D array) in the caller and pass C as a parameter to <code>cofactor</code> and manipulate it within the function. Declare <code>cofactor (int D[][100], int C[][100], n, r, c) {...}</code>"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1547024736, "post_id": 54104318, "comment_id": 95045172, "body": "Why do you have an API like <code>int A[100][100], n, r, c</code>? Isn&#39;t r and c supposed to be rows and columns? But you have those set to a fixed 100."}], "answers": [{"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1547016116, "post_id": 54104371, "comment_id": 95041191, "body": "&quot;<code>B</code> will go out of scope and be destroyed&quot; -- reference in the standard <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.2.4\" rel=\"nofollow noreferrer\">C11 Standard - 6.2.4 Storage durations of objects</a>"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1547024365, "post_id": 54104371, "comment_id": 95044954, "body": "Why do you take an array as parameter but return a look-up table? That&#39;s a different kind of data type, this API doesn&#39;t make any sense. Check <a href=\"https://stackoverflow.com/questions/42094465/correctly-allocating-multi-dimensional-arrays\">Correctly allocating multi-dimensional arrays</a>"}, {"owner": {"reputation": 12106, "user_id": 4431643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CoZjt.jpg?s=128&g=1", "display_name": "kiran Biradar", "link": "https://stackoverflow.com/users/4431643/kiran-biradar"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1547024459, "post_id": 54104371, "comment_id": 95045013, "body": "@Lundin I agree with you,To meet OP&#39;s expectation <code>and in my main function I just want to write : C=cofactor(D, n, r, c);</code>."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1547024584, "post_id": 54104371, "comment_id": 95045096, "body": "They want the function to return a 2D array. This function doesn&#39;t do that."}, {"owner": {"reputation": 12106, "user_id": 4431643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CoZjt.jpg?s=128&g=1", "display_name": "kiran Biradar", "link": "https://stackoverflow.com/users/4431643/kiran-biradar"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1547024710, "post_id": 54104371, "comment_id": 95045155, "body": "@Lundin Yes, I agree. But Op has constraint."}], "tags": [], "owner": {"reputation": 12106, "user_id": 4431643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CoZjt.jpg?s=128&g=1", "display_name": "kiran Biradar", "link": "https://stackoverflow.com/users/4431643/kiran-biradar"}, "is_accepted": true, "score": 1, "last_activity_date": 1547015446, "creation_date": 1547015446, "answer_id": 54104371, "question_id": 54104318, "link": "https://stackoverflow.com/questions/54104318/how-to-get-a-2-dimensional-array-as-output-of-a-user-defined-function/54104371#54104371", "title": "How to get a 2 dimensional array as output of a user defined function?", "body": "<p>Currently in your code <code>B</code> will go out of scope and will be destroyed when control exits <code>cofactor</code>.</p>\n\n<p>Thus use pointer to pointer as below.</p>\n\n<pre><code>   int **cofactor(int A[100][100], int n, int r, int c){\n        int **B = malloc(sizeof(int *)*r);\n\n         for (int i =0;i&lt;r;i++)\n           B[i] = malloc(sizeof(int)*c);\n\n          //B becomes the cofactor matrix of A after some operations//\n          return B;\n    }\n</code></pre>\n\n<p>And from <code>main</code>.</p>\n\n<pre><code> int **C=cofactor(D, n, r, c);\n</code></pre>\n\n<blockquote>\n  <p>Note:: <code>NULL</code> checks are not added and allocated memory needs to be freed once done with the processing.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 0, "last_activity_date": 1547026760, "last_edit_date": 1547026760, "creation_date": 1547026353, "answer_id": 54106916, "question_id": 54104318, "link": "https://stackoverflow.com/questions/54104318/how-to-get-a-2-dimensional-array-as-output-of-a-user-defined-function/54106916#54106916", "title": "How to get a 2 dimensional array as output of a user defined function?", "body": "<p>You are correct in that C doesn't allow us to return arrays from functions. This is one area where C is simply plain bad and you'll find yourself choosing between various evils. \nThe most obvious alternatives are to return an array pointer, or a <code>void</code> pointer. </p>\n\n<ul>\n<li><p><code>void</code> pointers should be avoided since they have non-existent type safety. </p>\n\n<pre><code>// bad code\nvoid* cofactor (int A[100][100], int n, size_t r, size_t c)\n</code></pre></li>\n<li><p>The array pointer option is rather ugly-looking, hard to read and enforces fixed-size dimensions:</p>\n\n<pre><code>// bad code\nint ( *cofactor (int A[100][100], int n, size_t r, size_t c) )[100][100];\n</code></pre></li>\n<li><p>Alternatively, also ugly and bad practice, is to hide the array type behind a typedef:</p>\n\n<pre><code>// bad code\ntypedef int arr_t [100][100];\n\narr_t* cofactor(int A[100][100], int n, size_t r, size_t c)\n</code></pre></li>\n</ul>\n\n<p>The array pointer versions also have the limit that you can't use variable dimensions. But <code>r</code> and <code>c</code> here seem to be rows and columns, so you probably <em>do</em> want the array to have variable size.</p>\n\n<p>This is where some start to use <code>int**</code> out of confusion. But <code>int**</code> cannot be used to point at a 2D array, nor to the first element of a 2D array. It can be used to point at the first element of a 1D array of <code>int*</code> pointers, and then emulate something that looks like an array, but doesn't behave like one. That's not what you want here either, because it is both slow and dangerous. See <a href=\"https://stackoverflow.com/questions/42094465/correctly-allocating-multi-dimensional-arrays\">Correctly allocating multi-dimensional arrays</a>.</p>\n\n<p>Sigh. So what to use!</p>\n\n<hr>\n\n<p>If you drop the requirement of \"function <code>return</code> ing array\" (with emphasis on using <code>return</code>), it turns easier and more flexible. Parameter passing to/from functions in C is most often done through the parameters, and most sound APIs reserve the return value for an error type describing the outcome of the function.</p>\n\n<p>The big advantage here is that when passing an array as parameter, we can use variable dimensions:</p>\n\n<pre><code>void func (size_t r, size_t c, int A[r][c])\n</code></pre>\n\n<p>Suddenly you can have a function accepting any array size, and somewhat type safe as long as <code>r</code> and <code>c</code> have correct values.</p>\n\n<p>The cleanest is to leave allocation to the caller. Then you get </p>\n\n<pre><code>void func (size_t r, size_t c, int A[r][c], int B[r][c])\n</code></pre>\n\n<p>Out of all options discussed, this is the only pretty one. But it won't work if the function must do the allocation. Then we must return an array through the parameter. And to that with this syntax, turns a bit ugly too:</p>\n\n<pre><code>void copy (size_t r, size_t c, int (**B)[r][c], int A[r][c])\n</code></pre>\n\n<p>But if we can live with this strange-looking \"pointer to array pointer to an array of <code>int[r][c]</code>\", then it solves all problems. It can return an array of variable size from a function to the caller.</p>\n\n<p>A function making a copy of any array and returning it would look like this:</p>\n\n<pre><code>void copy (size_t r, size_t c, int (**B)[r][c], int A[r][c])\n{\n  *B = malloc( sizeof(int[r][c]) );\n\n  int (*b)[c] = **B; // pointer to the first row in an array int[r][c]\n  for(size_t i=0; i&lt;r; i++)\n  {\n    for(size_t j=0; j&lt;c; j++)\n    {\n      b[i][j] = A[i][j];\n    }\n  }\n}\n</code></pre>\n\n<p>Or if you will:</p>\n\n<pre><code>#include &lt;string.h&gt;\n\nvoid copy (size_t r, size_t c, int (**B)[r][c], int A[r][c])\n{\n  *B = malloc( sizeof(int[r][c]) );\n  memcpy( *B, A, sizeof(int[r][c]) );  \n}\n</code></pre>\n\n<hr>\n\n<p>Full example:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\nvoid copy (size_t r, size_t c, int (**B)[r][c], int A[r][c])\n{\n  *B = malloc( sizeof(int[r][c]) );\n\n  int (*b)[c] = **B; // pointer to the first row in an array int[r][c]\n  for(size_t i=0; i&lt;r; i++)\n  {\n    for(size_t j=0; j&lt;c; j++)\n    {\n      b[i][j] = A[i][j];\n    }\n  }\n}\n\nint main (void)\n{\n  int array1[2][3] = { {1,2,3}, {4,5,6} };\n  int (*array2)[2][3];\n\n  copy(2, 3, &amp;array2, array1);\n\n  int (*arr)[3] = *array2;  \n  for(size_t i=0; i&lt;2; i++)\n  {\n    for(size_t j=0; j&lt;3; j++)\n    {\n      printf(\"%d \", arr[i][j]);\n    }\n    printf(\"\\n\");\n  }\n\n  free(array2);\n}\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 9605541, "user_type": "registered", "profile_image": "https://graph.facebook.com/354537311700947/picture?type=large", "display_name": "Amit Hasan Arpon", "link": "https://stackoverflow.com/users/9605541/amit-hasan-arpon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 54104371, "answer_count": 2, "score": 0, "last_activity_date": 1547026760, "creation_date": 1547015103, "last_edit_date": 1547023936, "question_id": 54104318, "link": "https://stackoverflow.com/questions/54104318/how-to-get-a-2-dimensional-array-as-output-of-a-user-defined-function", "title": "How to get a 2 dimensional array as output of a user defined function?", "body": "<p>I am trying to write a user defined function that takes some matrices and variables as inputs and gives a matrix as output. So something like this:</p>\n\n<pre><code>cofactor(int A[100][100], n, r, c){\nint B[100][100]\n//B becomes the cofactor matrix of A after some operations//\nreturn B;\n}\n</code></pre>\n\n<p>and in my main function I just want to write : </p>\n\n<pre><code>C=cofactor(D, n, r, c);\n</code></pre>\n\n<p>to turn C into the cofactor matrix of D. </p>\n\n<p>But for some reason c language does not support taking a whole 2D array as output of a function. How can I work around this? </p>\n\n<p>I don't want to keep all the junk in the main function. I want to write a separate function that gives me the matrix as output, and simply call that function in my main function.</p>\n"}, {"tags": ["c", "linux", "loopback", "socketcan"], "comments": [{"owner": {"reputation": 1447, "user_id": 671827, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/fdd49c2310be1ef3a4f7c1a61f579498?s=128&d=identicon&r=PG", "display_name": "While-E", "link": "https://stackoverflow.com/users/671827/while-e"}, "edited": false, "score": 0, "creation_date": 1601922038, "post_id": 54104285, "comment_id": 113550837, "body": "Did you ever find a solution for this? I&#39;m in the same boat."}], "answers": [{"tags": [], "owner": {"reputation": 169, "user_id": 5824889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fdee615286108ef66fb9cd0daf0c1d5?s=128&d=identicon&r=PG&f=1", "display_name": "fquinto", "link": "https://stackoverflow.com/users/5824889/fquinto"}, "is_accepted": false, "score": 0, "last_activity_date": 1553285166, "creation_date": 1553285166, "answer_id": 55307084, "question_id": 54104285, "link": "https://stackoverflow.com/questions/54104285/can-i-implement-loopback-in-linux-using-socketcan-without-can-hw-interface/55307084#55307084", "title": "Can i implement loopback in Linux using socketCAN without CAN HW interface?", "body": "<p>You can start here: <a href=\"https://python-can.readthedocs.io/en/3.1.1/interfaces/socketcan.html\" rel=\"nofollow noreferrer\">https://python-can.readthedocs.io/en/3.1.1/interfaces/socketcan.html</a></p>\n\n<p>It's using VIRTUAL SocketCAN and with Python.</p>\n"}], "owner": {"reputation": 11, "user_id": 10351302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/feb0ff4e5a24e5d2b8940c133371425d?s=128&d=identicon&r=PG&f=1", "display_name": "krnk", "link": "https://stackoverflow.com/users/10351302/krnk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 496, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553285166, "creation_date": 1547014913, "question_id": 54104285, "link": "https://stackoverflow.com/questions/54104285/can-i-implement-loopback-in-linux-using-socketcan-without-can-hw-interface", "title": "Can i implement loopback in Linux using socketCAN without CAN HW interface?", "body": "<p>I am new on socketCAN and wanted to use socketCAN lib in Linux but i don't have CAN hardware interface to my system so i thought to implement it using loopback as we do it in TCP/IP socket programming. but i am not sure whether I can implement socketCAN using loopback and without CAN interface in C, so please let me know how can i do it. Thanks in advance</p>\n"}, {"tags": ["c", "arrays"], "answers": [{"tags": [], "owner": {"reputation": 19499, "user_id": 3883560, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/ndXdL.jpg?s=128&g=1", "display_name": "Gopi", "link": "https://stackoverflow.com/users/3883560/gopi"}, "is_accepted": true, "score": 7, "last_activity_date": 1547012458, "last_edit_date": 1547012458, "creation_date": 1547012085, "answer_id": 54103800, "question_id": 54103737, "link": "https://stackoverflow.com/questions/54103737/why-does-it-prints-10-instead-of-3-in-c-lang/54103800#54103800", "title": "Why does it prints 10 instead of 3? in C Lang", "body": "<p>There is undefined behavior in your code which is</p>\n\n<pre><code>b[3] = 10;\n</code></pre>\n\n<p>When you initialized your array you have allocated space only for 2 items.You are trying to access 4th element and that memory is not owned by array so you are getting wierd results. It has happened that the varible <code>a</code> is stored in the same location as <code>b[3]</code> so that is overwritten</p>\n\n<p>Try to print <code>sizeof</code> your array and check how much memory is allocated for the array</p>\n"}], "owner": {"reputation": 471, "user_id": 9674126, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44106b552b4e54a48b78d0d013ab8645?s=128&d=identicon&r=PG&f=1", "display_name": "Thirumalai vasan", "link": "https://stackoverflow.com/users/9674126/thirumalai-vasan"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "closed_date": 1547016974, "accepted_answer_id": 54103800, "answer_count": 1, "score": -3, "last_activity_date": 1547050700, "creation_date": 1547011729, "last_edit_date": 1547050700, "question_id": 54103737, "link": "https://stackoverflow.com/questions/54103737/why-does-it-prints-10-instead-of-3-in-c-lang", "closed_reason": "Duplicate", "title": "Why does it prints 10 instead of 3? in C Lang", "body": "<pre><code>#include &lt;stdio.h&gt;\n\nint main(){\n    int a = 3;\n    int b[] = {1,2};\n    int c = 4;\n    b[3] = 10;\n\n    printf(\"a = %d\\n\",a);\n\n    return 0;\n}\n</code></pre>\n\n<blockquote>\n  <p>Output:  <strong>10</strong></p>\n</blockquote>\n\n<p>It is an integer output perhaps, it does not carry any garbage value too, but after when i assign the value to the variable <strong>a</strong> as <code>a = 5</code> and above value <code>5</code>, it just prints the output as it is, tell me what's going on here!</p>\n"}, {"tags": ["c", "linux", "arm", "kernel", "deadlock"], "comments": [{"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 3, "creation_date": 1547011599, "post_id": 54103521, "comment_id": 95039885, "body": "Welcome to Stack Overflow! Here we expect the <b>code in the question post</b> itself, not in the <i>linked image</i>. Please, fix that issue. Also, instead of colored arrows and numbers, which are uncleared, use some <i>textual notation</i> for explain the trace of execution."}, {"owner": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1547046217, "post_id": 54103521, "comment_id": 95058297, "body": "I got this message when I post Image.: &quot;You need at least 10 reputation to post images.&quot; T.T"}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1547049034, "post_id": 54103521, "comment_id": 95060103, "body": "No, you needn&#39;t to post an <i>image</i>. You need to post the code as a <b>text</b>. For format this text as a code, use <code>Ctrl+K</code> or <code>{}</code> button."}, {"owner": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1547051265, "post_id": 54103521, "comment_id": 95061514, "body": "@Tsyvarev I tried to write it in text, but because of the possibility of misunderstanding the execution flow sequence, I expressed it as images. I will remember your answer next time."}, {"owner": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "reply_to_user": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1547051871, "post_id": 54103521, "comment_id": 95061908, "body": "@old_timer Wow!! If so, do I have to write instructions with the deadlock in mind? in deadline scheduling?"}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1547051994, "post_id": 54103521, "comment_id": 95061999, "body": "1. It is a <b>requirement</b> of the Stack Overflow to have the code as a text. 2. Replacing &quot;image1&quot; with a code definitely wouldn&#39;t introduce a misunderstanding. 3. You may have <b>both</b> textual code and an image in the question post. Just make sure that the textual code is clear. 4. Your &quot;image2&quot; is unclear by itself."}, {"owner": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1547052549, "post_id": 54103521, "comment_id": 95062315, "body": "@Tsyvarev I&#39;m sorry I don&#39;t know the rules of stackoverflow. A little updated. Thanks a lot for teaching me."}, {"owner": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "reply_to_user": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1547071484, "post_id": 54103521, "comment_id": 95070701, "body": "@old_timer! Thank you very very much! I asked because I could not imagine that a deadlock would occur for an exclusive access. I thought it would have been designed so that it would not happen, even in very short time, very low probability."}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "reply_to_user": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1547151140, "post_id": 54103521, "comment_id": 95103967, "body": "@old_timer: &quot;... the memory unit sees load load store store and neither gets exclusive access.&quot; - in that case the first <code>store</code> will <b>succeed</b>: <i>exclusive-access</i> tag is cleared only when the other process <b>writes</b> to the given memory cell. The tag isn&#39;t cleared when other process just <i>reads</i> the cell."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1547177770, "post_id": 54103521, "comment_id": 95111489, "body": "Yep, I stand corrected, sorry."}, {"owner": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1547208633, "post_id": 54103521, "comment_id": 95123651, "body": "@Tsyvarev! Can some proccesses be state to exclusive access tag at the same time??"}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1547209847, "post_id": 54103521, "comment_id": 95124271, "body": "Yes, nothing prevents several processes to <i>exclusive-access</i> tag the same memory cell at the same time."}, {"owner": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1547227076, "post_id": 54103521, "comment_id": 95133536, "body": "@Tsyvarev. Thank you very much! I finally understood it by your comments and old_timer&#39;s comments and arm developer official site. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547207300, "post_id": 54140303, "comment_id": 95122950, "body": "Hmm. I see... So, Is not global monitor changed to the open state from the exclusive state by new load or exclusive load at between a exclusive load to a exclusive store???"}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547213280, "post_id": 54140303, "comment_id": 95125941, "body": "if you have one monitor then for that to work only the last ldrex id would be remembered and if the next strex has the same id then they match.  But this is implementation defined.  arm recommends you have a monitor per id, so ldrex a, ldrex b, strex a strex b.  the a and b monitors would record the ldrexes  the strex a lets assume works that resets any pending ldrexes (so the ldrex b is forgotten and the strex b fails).  a single monitor could not look at the id but in a multicore system that would fail.  so we would have to speculate as to a design for a single global monitor."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547213465, "post_id": 54140303, "comment_id": 95126040, "body": "we would also hope no bugs in the design from the chip vendor (or arm for that matter), on the chip vendor side it would be part and stepping and we would hope there is an errata (and even worse that someone applied the errata correctly to an open source operating system, I have seen that done very badly with linux).  arm errata is not always available to the general public.  if it is all done in a sane matter and there is a functionally correct monitor or set of and of course exclusive support then this code will work in one pass for the winner."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547213530, "post_id": 54140303, "comment_id": 95126079, "body": "if no exclusive support then your code/operating system hangs in this loop making it easy to detect the problem.  (been there seen that)"}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547213745, "post_id": 54140303, "comment_id": 95126202, "body": "you really should go to infocenter.arm.com yourself and give up an email address and download the technical reference manual(s) and the axi spec(s) (under amba perhaps amba/axi with some versions have to dig into that directory a little).  and read it yourself and draw your own conclusions.  at the end of the day it should either be not supported (at some layer) or supported such that the code you posted works.  one core should win first time through the others should get stuck in the ldrex loop and then one of those should win when the lock is released and so on."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547213999, "post_id": 54140303, "comment_id": 95126342, "body": "continuing to read, no surprise, the masters can have more than one transaction id each, so do this fully you would need enough monitors/storage of ids to cover all the masters times the number of possible ids per.  basically you look at the edge of the core and see how many bits there are in the id, which we dont have access to.  the dots I have not read enough or connected are if a master has multiple ids how do we control that in software and maybe that is because I mostly focus on a particular armv6 mpcore1 and not the armv7-a which is more complicated."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547214295, "post_id": 54140303, "comment_id": 95126500, "body": "was this a homework assignment or curiosity or desiging some code, while linux implementations are not all that great sometimes, then tend to be functional, so borrowing that knowledge/code, which in this case is taken directly from arm documentation, will function (if you are at a layer and an implementation that supports exclusive access).  Any chip vendor wanting to sell a chip and use linux today will have some sort of exclusive access support.  so just use this code as prescribed by arm."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547214435, "post_id": 54140303, "comment_id": 95126583, "body": "thanks to the reminder from  Tsyvarev the winner should win the first time through if you happen to have more than one make an attempt at nearly/exactly the same time.  I had forgotten that an ldrex does not interrupt an ldrex/strex pair from another master, it is only a successful store (or a non-esclusive store) that will cause the strex to fail."}, {"owner": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547229083, "post_id": 54140303, "comment_id": 95134417, "body": "Thank you your advice! It is Very helpful to me!"}, {"owner": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547229636, "post_id": 54140303, "comment_id": 95134642, "body": "Can I ask you about one more question? How do masters run if they exclusive access at exactly the same time?"}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547246515, "post_id": 54140303, "comment_id": 95140926, "body": "exclusive access only means that there are some bus bits that indicate the access type.  the axi bus design is such that multiple things can be going on at the same time there are actually if you want to think about it between two and four separate busses , a read address bus a read data bus a write address bus and a write data bus.  to do a read you put a request out on the read address bus with an id, later that is acked, later than that on the read data bus the slave asks the master if it wants the data, ack and the data is taken."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547246637, "post_id": 54140303, "comment_id": 95140965, "body": "so instruction fetches could be going on at the &quot;same time&quot; that a program is doing accesses for example the requests and responses can be mixed on these busses by design.  an exclusive access is no different than an normal access except that some signals on the bus are different that are specific to the access type.  and some handshaking on the write that may or may not be special would have to look at it (you can too)."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547246830, "post_id": 54140303, "comment_id": 95141017, "body": "so each master ultimately lands on the external to the core axi bus which the chip vendor connects up to and needs to be able to keep track of and perform some number of transactions in flight, arguably could complete one transaction at a time and that wouldnt be strange nor wrong depends on the busses in the rest of the chip which is the chip vendors problem.  so on one clock cycle master a could do a read  request with exclusive bits set and the next clock cycle master b could do a read request with exclusive bits asserted.  then at some point the slave acks those then at some point..."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547246835, "post_id": 54140303, "comment_id": 95141018, "body": "completes those."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547246958, "post_id": 54140303, "comment_id": 95141052, "body": "this is not some special arm thing their implementation is theirs but the days of a simple read/write line address and data lines are over for higher performance systems, you need to have busses that at least can start multiple transactions in flight at the same time, how the backend implements that plus any system rules (Dram is very slow, so if a uart status register read comes in AFTER a dram read, but we could possibly design it such that the uart read could start without waiting, does that break the overall architecture of the system?  answer is it depends)"}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547247054, "post_id": 54140303, "comment_id": 95141086, "body": "x86 will bury this info in chip and within the company where ip vendors like arm at least expose it to the chip vendors that buy the ip.  some will be under nda others like arm you can download or google for how it works."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547247280, "post_id": 54140303, "comment_id": 95141173, "body": "in no way shape or form does it take one clock to do something like a read or write like you might see on a microcontroller today or on an 8088/86 running with sram. if you get out to the axi it is several clocks at best, but like the pipeline in the processor this scheme relies on averages not individual transactions.  instead of the bus being tied up from start to finish for N number of clocks for one transaction, you break the transaction into parts and interleave the individual bus clocks for that transaction with possibly other transactions."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "edited": false, "score": 0, "creation_date": 1547247439, "post_id": 54140303, "comment_id": 95141211, "body": "a read/write address data bus might have a wait state signal and the peripheral could hold onto that for a while making one transaction which is really two clocks to perform the request but N clock cycles were burned most of them dead time."}], "tags": [], "owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "is_accepted": true, "score": 0, "last_activity_date": 1547180137, "creation_date": 1547180137, "answer_id": 54140303, "question_id": 54103521, "link": "https://stackoverflow.com/questions/54103521/do-exclusive-load-and-store-arm-instruction-raise-a-deadlock/54140303#54140303", "title": "Do Exclusive load and store arm instruction raise a deadlock?", "body": "<p>Yep, sorry I stand corrected....</p>\n\n<p>the load exclusive is going to check for a zero then try again until it is zero.</p>\n\n<pre><code>.spin_lock:\n    NOP\n.stxr_fail:\n    LDXR  R0, .data+0\n    CMP   R0, #0\n    BNE    .spin_lock\n</code></pre>\n\n<p>If not zero then you end up with a </p>\n\n<pre><code>load exclusive\nstore exclusive\ncheck if the store worked.\nrepeat the whole thing if not.\n</code></pre>\n\n<p>If two masters A and B were to perfectly line up</p>\n\n<pre><code>loadx a\nloadx b\nstorex a\nstorex b\n</code></pre>\n\n<blockquote>\n  <p>Between the Exclusive Read and the Exclusive Write there can be other\n  Non-exclusive transfers.</p>\n</blockquote>\n\n<p>...</p>\n\n<blockquote>\n  <p>If no other master has written to that location since the Exclusive\n  Read transfer, the Exclusive Write transfer is successful and updates\n  memory.  </p>\n</blockquote>\n\n<p>...</p>\n\n<blockquote>\n  <p>If another master has written to that location since the Exclusive\n  Read transfer, the Exclusive Write transfer is failed and the memory\n  location is not updated.</p>\n</blockquote>\n\n<p>the storex from master a would succeed, the storex from master b would fail so master a would exit the loop.  master b will continue to loop until the load returns non-zero.</p>\n\n<p>So it cant deadlock even for a little bit.</p>\n\n<p>I have to read some more (well you should since this is in the ARM documentation where your answer lies, stackoverflow is not here to read documentation for you which is at the root of this question) to confirm that loadx a, loadx b, storex a would have a valid store.  From the quotes above that would be the case.  If not then you would be in a situation where neither would obtain lock until such time as one gets interrupted or for any other reason changes its beat frequency possibly allowing the other master to get a clean load store exclusive.  for example can the logic simply remember the id of the last ldrex and compare that to the next strex</p>\n\n<blockquote>\n  <p>The Exclusive Access Monitor must be capable of concurrently\n  monitoring at least one address location for each Exclusive access\n  capable master in the system.</p>\n</blockquote>\n\n<p>...</p>\n\n<blockquote>\n  <p>A slave that does not support exclusive accesses can ignore the AxLOCK\n  signals. It must provide an OKAY response for both normal and\n  exclusive accesses. A slave that supports exclusive access must have\n  monitor hardware. This specification recommends that such a slave has\n  a monitor unit for each exclusive-capable master ID that can access\n  it. The ARM Architecture Reference Manual, ARMv7-A and ARMv7-R edition\n  defines an exclusive access monitor, and a single-ported slave can\n  have such an exclusive access monitor external to the slave. A\n  multiported slave might require internal monitoring.</p>\n</blockquote>\n\n<p>What that means is that if the slave supports exclusive access then it must have a monitor (must store the id from a prior ldrex and compare it to the current strex).  but it is only recommended that it have a monitor per master, so if it doesnt have a monitor per master then you likely end up in a situation like this</p>\n\n<p>ldrex a, ldrex b, strex a, strex b.   The ldrex b and strex a dont match so the store doesnt happen, now in that case the ldrex b and strex b do match so we would assume that master b gets the lock leaves the loop master a has to wait for master b to zero the memory location (clrex or perhaps a simple str).</p>\n\n<p>Arm has axi and ahb bus specifications as well as different revisions of these specifications and which one goes with which core is perhaps in the technical reference manual for that core.  And to get the complete answer you should at least try to match these up and read the right revision spec for the core you are using and not assume that they all are exactly the same.  Also understand the L1 cache is part of the arm core, the l2 cache is outside the core but you can buy an l2 from arm (or make your own) one would hope that ARMs logic supports exclusive access as documented.  Beyond that you are into the chip vendors territory and they can implement what they want broken or not, to truly share one would want these accesses to be in a common memory space shared by the various cores and not having the L1 or L2 cache answer and have coherency problem.  The chip vendor may choose not to support exclusive access and will return OKAY.  What that looks like to code like this is it will spin forever, the \"return value\" from the strex only passes on an EXOKAY if that is never returned because the design does not support exclusive access then the loop is infinite.  Been there, seen this, thats how I know.  An older document said that exclusive access support was not required for uniprocessor designs, current versions of the specs do not say that they simply say things related to if the slave supports or doesnt support exclusive access then.</p>\n\n<p>if the ldrex/strex lock is going to work you have to be working against a slave that supports exclusive access in that case you have a single monitor or a monitor per master and I believe I have shown the worst cases above if you get really really really lucky ldrex a, ldrex b, strex a, strex b for two masters a and b and one should win on that first pass through.  and the other gets stuck waiting as desired/designed.  add more masters and mix the loads and stores from them and you end up with the same situation, one will win the others will lose and go into the ldrex not zero loop.  now interestingly if you have two or more of them in that loop then when the one master that has lock releases it you dont need to be all that lucky for the others competing for the lock to get a load load store store situation.</p>\n"}], "owner": {"reputation": 3, "user_id": 10886059, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bSWb_sd0Ivc/AAAAAAAAAAI/AAAAAAAAAAg/0ATwhUgF6yc/photo.jpg?sz=128", "display_name": "TOT0Ro", "link": "https://stackoverflow.com/users/10886059/tot0ro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 773, "favorite_count": 2, "accepted_answer_id": 54140303, "answer_count": 1, "score": -1, "last_activity_date": 1547180137, "creation_date": 1547010241, "last_edit_date": 1547052351, "question_id": 54103521, "link": "https://stackoverflow.com/questions/54103521/do-exclusive-load-and-store-arm-instruction-raise-a-deadlock", "title": "Do Exclusive load and store arm instruction raise a deadlock?", "body": "<p>Do Simple Spin Lock raise a deadlock that be cause by exclusive memory access instruction? </p>\n\n<p>I have a idea about that <strong>LDXR/STXR</strong> occur a deadlock.\nIs this case possible?</p>\n\n<p>Two core access global variable in a few of instruction clock difference.\nAnd repeat. Both cores is running same code.</p>\n\n<p>My Exclusive Simple Spin Lock Assembly(Image):</p>\n\n<pre><code>.spin_lock:\n    NOP\n.stxr_fail:\n    LDXR  R0, .data+0\n    CMP   R0, #0\n    BNE    .spin_lock\n    MOV  R0, #1\n    STXR  W0, R0, .data+0\n    CMP   W0, #0\n    BNE   .stxr_fail\n    BL       critical_section()\n    MOV  R0, #0\n    STR     R0, .data+0\n    RET \n\n.data:\n    .word lock\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/GgGx1.png\" rel=\"nofollow noreferrer\">image1</a></p>\n\n<p>Do a deadlock occur on multi-core running? (Image):</p>\n\n<p><a href=\"https://i.stack.imgur.com/Y42Ln.png\" rel=\"nofollow noreferrer\">image2</a></p>\n\n<p>Each line of the same color is atomic step. \nIt operates sequentially in numerical step. \nThis is occurred a deadlock by 6~11 steps.</p>\n\n<p>If I misunderstand, Please kindly explain</p>\n"}, {"tags": ["c", "linux", "system"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1547006446, "post_id": 54102950, "comment_id": 95038729, "body": "If you want to use the original standard streams, then do not close them.  In general, you can open different streams in their places, but you cannot recover the original streams once they are closed."}, {"owner": {"reputation": 1, "user_id": 10729757, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lgdu5B-5YZo/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jrBsAw92Nv4DAdBR_EuF1mdLl5Rg/mo/photo.jpg?sz=128", "display_name": "\uc774\uc7a5\uad70", "link": "https://stackoverflow.com/users/10729757/%ec%9d%b4%ec%9e%a5%ea%b5%b0"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1547007436, "post_id": 54102950, "comment_id": 95038878, "body": "Thanks for a comment but it is a condition for this problem..."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 3, "creation_date": 1547008405, "post_id": 54102950, "comment_id": 95039115, "body": "You have not presented a problem, just some miscellaneous observations.  If you have a specific problem you are trying to solve then describe that problem clearly, and explain on what specific aspect of it you are stuck.  A <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> is probably warranted as part of all that."}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "edited": false, "score": 1, "creation_date": 1547010826, "post_id": 54102950, "comment_id": 95039679, "body": "<code>&#47;dev&#47;fd&#47;</code> is just a symlink to <code>&#47;proc&#47;self&#47;fd&#47;</code>. <code>&#47;proc&#47;self&#47;fd&#47;N</code> are pseudosymlinks provided by the kernel that refer to open file descriptor <code>N</code> in the process itself. If standard input is already closed, then <code>&#47;proc&#47;self&#47;fd&#47;0</code> does not exist. If standard input (or output or error) is open, you can duplicate the descriptor using <code>dup(0)</code> (or <code>dup(1)</code> or <code>dup(2)</code>, respectively). If a process has a controlling terminal, then it can open <code>&#47;dev&#47;tty</code> to that terminal. I&#39;d rather see you try to write something useful, instead of attempting to exploit something."}, {"owner": {"reputation": 1, "user_id": 10729757, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lgdu5B-5YZo/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jrBsAw92Nv4DAdBR_EuF1mdLl5Rg/mo/photo.jpg?sz=128", "display_name": "\uc774\uc7a5\uad70", "link": "https://stackoverflow.com/users/10729757/%ec%9d%b4%ec%9e%a5%ea%b5%b0"}, "edited": false, "score": 0, "creation_date": 1547011601, "post_id": 54102950, "comment_id": 95039886, "body": "I editted question."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1547012032, "post_id": 54102950, "comment_id": 95039996, "body": "You cannot reopen a closed stream. Please quote your assignment verbatim. Your edit hardly improves anything"}, {"owner": {"reputation": 44820, "user_id": 4492932, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8938ef2681650e100bc9f83434ef272?s=128&d=identicon&r=PG", "display_name": "DYZ", "link": "https://stackoverflow.com/users/4492932/dyz"}, "reply_to_user": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "edited": false, "score": 0, "creation_date": 1547012151, "post_id": 54102950, "comment_id": 95040046, "body": "@nominalanimal We are not here to judge the usefulness of what the OP is doing."}, {"owner": {"reputation": 1, "user_id": 10729757, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lgdu5B-5YZo/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jrBsAw92Nv4DAdBR_EuF1mdLl5Rg/mo/photo.jpg?sz=128", "display_name": "\uc774\uc7a5\uad70", "link": "https://stackoverflow.com/users/10729757/%ec%9d%b4%ec%9e%a5%ea%b5%b0"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1547012286, "post_id": 54102950, "comment_id": 95040095, "body": "@n.m as I writed, I reopened closed stdout and get output from process! but stdin is not."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1547013238, "post_id": 54102950, "comment_id": 95040345, "body": "Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. The approximate format is like this this. &quot;My assignment says ...(what your assignment says, <i>literally</i>, not in your own words, but copy and paste from the assignment). I have done ...(your simplified but still buildable program, <i>literally</i>, not a fragment, not a description but actual code). I expect to see ...(what you expect, <i>literally</i>, not a description but actual characters you want). But instead I see ...(what you see, <i>literally</i>, not a description but copy and paste from the output). Otherwise it is reading the entrails of a chicken."}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "reply_to_user": {"reputation": 44820, "user_id": 4492932, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8938ef2681650e100bc9f83434ef272?s=128&d=identicon&r=PG", "display_name": "DYZ", "link": "https://stackoverflow.com/users/4492932/dyz"}, "edited": false, "score": 0, "creation_date": 1547021687, "post_id": 54102950, "comment_id": 95043628, "body": "@DYZ: We are not here to spout social justice dogma."}], "owner": {"reputation": 1, "user_id": 10729757, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lgdu5B-5YZo/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jrBsAw92Nv4DAdBR_EuF1mdLl5Rg/mo/photo.jpg?sz=128", "display_name": "\uc774\uc7a5\uad70", "link": "https://stackoverflow.com/users/10729757/%ec%9d%b4%ec%9e%a5%ea%b5%b0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547011780, "creation_date": 1547005479, "last_edit_date": 1547011780, "question_id": 54102950, "link": "https://stackoverflow.com/questions/54102950/reopened-stdin-eoferror", "title": "Reopened stdin EOFerror", "body": "<p>I'm a pwnable newbie and have a question.</p>\n\n<p>this elf close stdout, stdin, stderr before main() function return.</p>\n\n<p>and I reropened them with calling <code>open(\"/dev/tty\",2)</code> three times.</p>\n\n<p>stdout is functioning well but when I change EIP to main() and trying to input, this process has EOF error.</p>\n\n<p>So I can't input anything to exploit it.</p>\n\n<p>as far as stdout is work, I leaked libc base and get system() address, \"/bin/sh\" address in libc.</p>\n\n<p>so I'm trying to restart main and execute system(\"/bin/sh\") with EIP control.</p>\n\n<p>I need to know how to reopen closed stdin with its own performance with functions below.</p>\n\n<p>puts, setbuf, strchr, lseek, close, read, fgets, open, atoi</p>\n\n<p>Help me out!</p>\n"}, {"tags": ["c++", "c", "loops", "pointers", "sdl"], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 8459853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/016c304d897ca7f34721176713b720a7?s=128&d=identicon&r=PG&f=1", "display_name": "Spencer Lutz", "link": "https://stackoverflow.com/users/8459853/spencer-lutz"}, "edited": false, "score": 0, "creation_date": 1547043696, "post_id": 54103447, "comment_id": 95056547, "body": "Thanks, This was helpful!"}], "tags": [], "owner": {"reputation": 15473, "user_id": 744720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65030f1bd22dbb4d1e6976cfac08a1c5?s=128&d=identicon&r=PG", "display_name": "keltar", "link": "https://stackoverflow.com/users/744720/keltar"}, "is_accepted": true, "score": 3, "last_activity_date": 1547009582, "creation_date": 1547009582, "answer_id": 54103447, "question_id": 54102709, "link": "https://stackoverflow.com/questions/54102709/no-matching-function-for-call-to-sdl-upperblit/54103447#54103447", "title": "No matching function for call to &#39;SDL_UpperBlit&#39;", "body": "<p><a href=\"https://wiki.libsdl.org/SDL_BlitSurface\" rel=\"nofollow noreferrer\">SDL_BlitSurface</a> function declaration is</p>\n\n<pre><code>int SDL_BlitSurface(SDL_Surface*    src,\n                    const SDL_Rect* srcrect,\n                    SDL_Surface*    dst,\n                    SDL_Rect*       dstrect)\n</code></pre>\n\n<p>Your code fragment</p>\n\n<pre><code>    SDL_Rect rec;\n    rec.x = 100;\n    rec.y = 100;\n    rec.h = 100;\n    rec.w = 100;\n    SDL_BlitSurface(currentImage, NULL, windowSurface, rec);\n</code></pre>\n\n<p>passes <code>rec</code> as last argument, which have type <code>SDL_Rect</code>, but <code>SDL_Rect*</code> is expected. It should be e.g. <code>SDL_BlitSurface(currentImage, NULL, windowSurface, &amp;rec);</code></p>\n\n<p>I would also advice against using <code>close</code> as function name as it is <a href=\"https://stackoverflow.com/questions/41946389/segmentation-fault-initializing-sdl2-what-am-i-doing-wrong-with-memory\">known</a> <a href=\"https://stackoverflow.com/questions/31304591/odd-segmentation-fault-with-cc-gcc-but-not-g-c-sdl2-linux\">to</a> <a href=\"https://stackoverflow.com/questions/42485907/sdl2-sdl-quit-segmentation-fault\">cause</a> problems (not as much true for C++ as it have name mangling, but still).</p>\n"}], "owner": {"reputation": 179, "user_id": 8459853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/016c304d897ca7f34721176713b720a7?s=128&d=identicon&r=PG&f=1", "display_name": "Spencer Lutz", "link": "https://stackoverflow.com/users/8459853/spencer-lutz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "accepted_answer_id": 54103447, "answer_count": 1, "score": 1, "last_activity_date": 1547009582, "creation_date": 1547003109, "question_id": 54102709, "link": "https://stackoverflow.com/questions/54102709/no-matching-function-for-call-to-sdl-upperblit", "title": "No matching function for call to &#39;SDL_UpperBlit&#39;", "body": "<p>I'm relatively new to c++, so despite my experience in other c languages this may just be a simple mistake. Here's my code:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;SDL2/SDL.h&gt;\n\nSDL_Window *window;\nSDL_Surface *windowSurface;\nSDL_Surface *image[3];\nSDL_Surface *currentImage;\nint close();\nSDL_Rect gRect(int, int, int, int); //for method described below\n\nint main(int argc, char *argv[]){\n\n    SDL_Init(SDL_INIT_VIDEO);\n    window = SDL_CreateWindow(\"Test\", SDL_WINDOWPOS_CENTERED, SDL_WINDOWPOS_CENTERED, 500, 500, SDL_WINDOW_SHOWN);\n    windowSurface = SDL_GetWindowSurface(window);\n    image[0] = SDL_LoadBMP(\"filepath/img.bmp\");\n    image[1] = SDL_LoadBMP(\"filepath/img2.bmp\");\n    image[2] = SDL_LoadBMP(\"filepath/img3.bmp\");\n    currentImage = image[0];\n\n\n    bool done = false;\n    while(!done){\n        SDL_Rect rec;\n        rec.x = 100;\n        rec.y = 100;\n        rec.h = 100;\n        rec.w = 100;\n        SDL_BlitSurface(currentImage, NULL, windowSurface, rec);\n        SDL_UpdateWindowSurface(window);\n    }\n    return close();\n}\nint close(){\n    for(int i = 0; i &lt; 3; i++){\n        SDL_FreeSurface(image[i]);\n        image[i] = nullptr;\n    }\n    currentImage = nullptr;\n    window = nullptr;\n    SDL_DestroyWindow(window);\n    SDL_Quit();\n    return 0;\n}\n</code></pre>\n\n<p>Upon running this program I receive the error \"No matching function for call to \"SDL_UpperBlit\"\". Apparently this has been replaced with SDL_BlitSurface, which I am using in my program. </p>\n\n<p>This error does not appear if I replace \"rec\" in the function call with \"NULL\", and my program compiles like normal, with the image filling the screen.</p>\n\n<p>I tried using a function to create an SDL_Rect like so:</p>\n\n<pre><code>SDL_Rect gRect(int x, int y, int w, int h){\n    SDL_Rect ret;\n    ret.h = h;\n    ret.w = w;\n    ret.x = x;\n    ret.y = y;\n    return ret;\n}\n</code></pre>\n\n<p>and changing the SDL_BlitSurface call to</p>\n\n<pre><code>SDL_BlitSurface(currentImage, NULL, windowSurface, gRect(100, 100, 100, 100));\n</code></pre>\n\n<p>This does not resolve the issue and the same error appears. If I could get any help with this it would be greatly appreciated! Thanks!</p>\n\n<p>(Optional) PS: I also would appreciate some help with putting the \"image[0]\", \"image[1]\", and \"image[2]\" declarations in a for loop. I tried it but had some issues with types and concatenation so if anyone knows how I could do this let me know.</p>\n"}, {"tags": ["c", "arrays", "pointers", "multidimensional-array"], "comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 2, "creation_date": 1547002778, "post_id": 54102668, "comment_id": 95038062, "body": "<code>int *row1 = arr5;</code> is a problem. <code>row1</code> is <code>int*</code>, <code>arr5</code> is not. <code>arr5</code> is <code>(int*)[3]</code>. <code>int *row1 = *arr5;</code> is OK as is <code>int *row2 = *(arr5 + 1);</code>"}, {"owner": {"reputation": 2867, "user_id": 3830884, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b813ef783427f54b6b9fb79acbb9afd1?s=128&d=identicon&r=PG&f=1", "display_name": "eric.mcgregor", "link": "https://stackoverflow.com/users/3830884/eric-mcgregor"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1547003097, "post_id": 54102668, "comment_id": 95038117, "body": "int *row1 = arr5; is not problematic.  printf(&quot;%d\\n&quot;, *row1); prints the first element in the first row as expected."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1547003241, "post_id": 54102668, "comment_id": 95038134, "body": "It is only by happy circumstance. Turn on your compiler warnings, e.g. <code>-Wall -Wextra -pedantic</code> for gcc/clang or <code>&#47;W3</code> for VS. <i>&quot;warning: initialization from incompatible pointer type</i>&quot;"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1547003260, "post_id": 54102668, "comment_id": 95038140, "body": "2D array problems have more clarity when the sample array is not a square array.  Consider a 3x4 array."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 1, "creation_date": 1547006029, "post_id": 54102668, "comment_id": 95038656, "body": "First sentence is wrong. There is no pointer. The array is 9 contiguous <code>int</code> objects."}], "answers": [{"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 3, "last_activity_date": 1547004052, "creation_date": 1547004052, "answer_id": 54102799, "question_id": 54102668, "link": "https://stackoverflow.com/questions/54102668/cannot-dereference-multidimensional-array-as-expected/54102799#54102799", "title": "Cannot dereference multidimensional array as expected", "body": "<p>Heed compiler warnings.  <code>*((arr5+1)+j)</code> is not an <code>int</code>, but an <code>int *</code>.</p>\n\n<blockquote>\n  <p>warning: format '%d' expects argument of type 'int', but argument 2 has type 'int *' [-Wformat=]</p>\n</blockquote>\n\n<p>Note: <code>(arr5+1)+j</code> is the same as <code>(arr5+1+j)</code>.  I suspect OP wanted <code>*(arr5+1)+j</code> here.</p>\n\n<pre><code>int main() {\n    int arr5[][3] = {{1,2,3}, {4,5,6}, {7,8,9}};\n    for (int j = 0; j &lt; 3; j++) {\n      printf(\"%d%c\", *((arr5+1)+j), (j==2)?'\\n':' '); // Warning here!!\n    } \n\n    for (int j = 0; j &lt; 3; j++) {\n      printf(\"%d%c\", *(*(arr5+1)+j), (j==2)?'\\n':' ');\n      //               ^ \n    }\nreturn 0;\n}\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>-13412 -13400 -13388  UB UB UB\n4 5 6                 OK OK OK\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547004392, "post_id": 54102813, "comment_id": 95038347, "body": "Good eye on the <code>= *arr5</code> part."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547004617, "post_id": 54102813, "comment_id": 95038383, "body": "Only sharpened by the number of times I&#39;ve stumbled off into something similar..."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1547005818, "post_id": 54102813, "comment_id": 95038619, "body": "Agreed, the <code>int[3]</code> compatibility with <code>int*</code> is loose way of explaining the equivalence. The access of the row array by dereferencing the 2D array will itself result in a pointer to the first element of the row."}, {"owner": {"reputation": 2867, "user_id": 3830884, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b813ef783427f54b6b9fb79acbb9afd1?s=128&d=identicon&r=PG&f=1", "display_name": "eric.mcgregor", "link": "https://stackoverflow.com/users/3830884/eric-mcgregor"}, "edited": false, "score": 0, "creation_date": 1547006588, "post_id": 54102813, "comment_id": 95038754, "body": "Wonderfully stated.  Thank you!"}], "tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": true, "score": 4, "last_activity_date": 1547005883, "last_edit_date": 1547005883, "creation_date": 1547004244, "answer_id": 54102813, "question_id": 54102668, "link": "https://stackoverflow.com/questions/54102668/cannot-dereference-multidimensional-array-as-expected/54102813#54102813", "title": "Cannot dereference multidimensional array as expected", "body": "<blockquote>\n  <p>Except when it is the operand of the <code>sizeof</code> operator, the <code>_Alignof</code>\n  operator, or the unary <code>'&amp;'</code> operator, or is a <em>string literal</em> used\n  to initialize an array, an expression that has type <em>\"array of type\"</em>\n  is converted to an expression with type <em>\"pointer to type\"</em> that\n  points to the initial element of the array object and is not an\n  lvalue.  <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.3.2.1p3\" rel=\"nofollow noreferrer\">C11 Standard - 6.3.2.1 Other Operands - Lvalues, arrays, and\n  function\n  designators(p3)</a></p>\n</blockquote>\n\n<p>So when you access <code>arr5</code>, you are effectively using a <em>pointer to array of int [3]</em>. When you attempt to assign:</p>\n\n<pre><code>int *row1 = arr5;\n</code></pre>\n\n<p>You are attempting to assign <code>arr5</code> which has type <code>int(*)[3]</code> to <code>row1</code> which is <code>int*</code> resulting in the warning:</p>\n\n<pre><code>\"initialization from incompatible pointer type\"\n</code></pre>\n\n<p>To eliminate the warning you need to derefernce <code>arr5</code> resulting in type <code>int[3]</code> (which on access is converted to a pointer to the first element in the row) which is compatible with <code>int*</code>. For example, rearranging your example a bit, you could do:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main (void) {\n\n    int arr5[][3] = {{1,2,3}, {4,5,6}, {7,8,9}},\n        *row1 = *arr5,\n        *row2 = *(arr5 + 1),\n        *row3 = *(arr5 + 2);\n    size_t  nrow = sizeof arr5 / sizeof *arr5,\n            ncol = sizeof *arr5 / sizeof **arr5;\n\n    puts (\"By row:\");\n    for (size_t j = 0; j &lt; ncol; j++)       /* output row1 */\n        printf (\"%3d\", *(row1 + j));\n    putchar ('\\n');\n\n    for (size_t j = 0; j &lt; ncol; j++)       /* output row2 */\n        printf (\"%3d\", *(row2 + j));\n    putchar ('\\n');\n\n    for (size_t j = 0; j &lt; ncol; j++)       /* output row3 */\n        printf (\"%3d\", *(row3 + j));\n    putchar ('\\n');\n\n    puts (\"\\nBy array:\");\n    for (size_t i = 0; i &lt; nrow; i++) {     /* output arr5 */\n        for (size_t j = 0; j &lt; ncol; j++)\n            printf (\"%3d\", *(*(arr5 + i) + j));\n        putchar ('\\n');\n    }\n}\n</code></pre>\n\n<p>(<strong>note:</strong> <code>row1[j]</code> and <code>arr5[i][j]</code> are generally more readable than their pointer notation equivalents)</p>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/ptr2arrayauto\nBy row:\n  1  2  3\n  4  5  6\n  7  8  9\n\nBy array:\n  1  2  3\n  4  5  6\n  7  8  9\n</code></pre>\n\n<p>Look things over and let me know if you have further questions.</p>\n"}], "owner": {"reputation": 2867, "user_id": 3830884, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b813ef783427f54b6b9fb79acbb9afd1?s=128&d=identicon&r=PG&f=1", "display_name": "eric.mcgregor", "link": "https://stackoverflow.com/users/3830884/eric-mcgregor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 54102813, "answer_count": 2, "score": 2, "last_activity_date": 1547005883, "creation_date": 1547002638, "last_edit_date": 1547002993, "question_id": 54102668, "link": "https://stackoverflow.com/questions/54102668/cannot-dereference-multidimensional-array-as-expected", "title": "Cannot dereference multidimensional array as expected", "body": "<pre><code>int arr5[][3] = {{1,2,3}, {4,5,6}, {7,8,9}};\n</code></pre>\n\n<p>The variable declaring a 2D array holds a pointer to the first element in the first array.  arr5 was defined as having 3 columns in each row. By adding 1 to arr5 we get the address of the first element in the second row, by adding 2 to arr5 we get the address of the first element in the third row.</p>\n\n<pre><code>int *row1 = arr5;\nint *row2 = arr5 + 1;\nint *row3 = arr5 + 2;\n</code></pre>\n\n<p>Dereferencing a pointer to an array gets the first element in the array.</p>\n\n<pre><code>printf(\"%d\\n\", *row1);  // prints 1\nprintf(\"%d\\n\", *row2);  // prints 4\nprintf(\"%d\\n\", *row3);  // prints 7\n</code></pre>\n\n<p>We can dereference the elements in those rows using [].</p>\n\n<pre><code>for (j = 0; j &lt; 3; j++) {\n  printf(\"%d%c\", row1[j], (j==2)?'\\n':' ');\n} // prints 1 2 3\n</code></pre>\n\n<p>We can print the second row without using brackets. Row2 now holds the address of the first element in the second row.</p>\n\n<pre><code>for (j = 0; j &lt; 3; j++) {\n  printf(\"%d%c\", *(row2+j), (j==2)?'\\n':' ');\n}  // prints 4 5 6\n</code></pre>\n\n<p>Why can't we substitute arr5+1 for row2 in the above example? row2 holds the address arr5+1.</p>\n\n<pre><code>for (j = 0; j &lt; 3; j++) {\n  printf(\"%d%c\", *((arr5+1)+j), (j==2)?'\\n':' ');\n}  // prints what looks to be addresses\n</code></pre>\n"}, {"tags": ["c", "embedded", "misra"], "comments": [{"owner": {"reputation": 3266, "user_id": 6854407, "user_type": "registered", "profile_image": "https://graph.facebook.com/10205840043960722/picture?type=large", "display_name": "Jim Rogers", "link": "https://stackoverflow.com/users/6854407/jim-rogers"}, "edited": false, "score": 2, "creation_date": 1547001957, "post_id": 54102531, "comment_id": 95037923, "body": "The variable count shown in the function UART_call is a global variable. Any modification of count produces a side effect. MISRA is insisting that such side effects are bad in safety critical software."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 1, "creation_date": 1547002331, "post_id": 54102531, "comment_id": 95037988, "body": "how are <code>buf</code> and <code>count</code> defined ?"}, {"owner": {"reputation": 6079, "user_id": 34989, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f16eae47ba215ccc1fe3f05f1750adc?s=128&d=identicon&r=PG", "display_name": "Gerhard", "link": "https://stackoverflow.com/users/34989/gerhard"}, "edited": false, "score": 1, "creation_date": 1547019128, "post_id": 54102531, "comment_id": 95042474, "body": "Why are you using global variables and not parameters?"}, {"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 0, "creation_date": 1549880731, "post_id": 54102531, "comment_id": 96049033, "body": "I don&#39;t think there&#39;s any point in replacing <code>count++</code> by <code>count = count + 1U</code>."}], "answers": [{"comments": [{"owner": {"reputation": 415, "user_id": 10669327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6051fc808e6d6c453bf165e339d09a6a?s=128&d=identicon&r=PG&f=1", "display_name": "raj123", "link": "https://stackoverflow.com/users/10669327/raj123"}, "edited": false, "score": 0, "creation_date": 1547058369, "post_id": 54105599, "comment_id": 95065185, "body": "Thanks appreciate your help."}, {"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 1, "creation_date": 1549838342, "post_id": 54105599, "comment_id": 96036290, "body": "It doesn&#39;t look like a false positive to me. <code>buf[count++] = count</code> has undefined behavior, because <code>count</code> is read and written without an intervening sequence point. But MISRA 13.3 is intended to prohibit well-defined code that the authors consider potentially confusing, such as <code>buf[count++] = unrelated_value</code>."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 0, "creation_date": 1549870220, "post_id": 54105599, "comment_id": 96043659, "body": "@KeithThompson Where did you get <code>buf[count++] = count</code> from? It&#39;s neither in the question nor this answer. Most of the time 13.3 is sound, there aren&#39;t many sound reasons why one would ever mix ++ with assignment expressions."}, {"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 0, "creation_date": 1549873640, "post_id": 54105599, "comment_id": 96045171, "body": "@Lundin: No, it&#39;s not in the question. It was just an example of undefined behavior. IMHO <code>buf[count++] = some_value;</code> is ok, but MISRA disagrees."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 0, "creation_date": 1549874335, "post_id": 54105599, "comment_id": 96045483, "body": "@KeithThompson I think the point is that <code>for(count=0; count&lt;n; count++) { buf[count] = some_value;</code> is much better code. And then there&#39;s also the volatile access aspect addressed in the answer."}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": true, "score": 5, "last_activity_date": 1547106422, "last_edit_date": 1547106422, "creation_date": 1547021145, "answer_id": 54105599, "question_id": 54102531, "link": "https://stackoverflow.com/questions/54102531/how-to-resolve-misra-c2012-rule-13-2-and-13-3-for-c-code/54105599#54105599", "title": "How to resolve MISRA C:2012 Rule 13.2 and 13.3 for C code?", "body": "<blockquote>\n  <ol>\n  <li>increment/decrement operation combined with other operation with side-effects [MISRA 2012 Rule 13.3, advisory]buf[count++] = U1RXREG;</li>\n  </ol>\n</blockquote>\n\n<p>This is as you seem to have noted, solved by moving the incrementation out of the assignment expression:</p>\n\n<pre><code>buf[count] = U1RXREG;\ncount++;\n</code></pre>\n\n<p>The rationale behind this is to prevent writing bugs such as <code>buf[count++] = count;</code></p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>both sides have side effects [MISRA 2012 Rule 1.3, required], [MISRA 2012 Rule 13.2, required] buf[count] = U1RXREG;</li>\n  </ol>\n</blockquote>\n\n<p>I'd say this is a false positive. The line <code>buf[count] = U1RXREG;</code> is harmless.</p>\n\n<p>The reason for the warning is that <code>U1RXREG</code> is obviously a volatile-qualified rx register of the UART hardware, and MISRA-C doesn't like mixing volatile access with other things in the same expression, particularly not with another \"side-effect\", in this case the <code>++</code> of count together with the assignment to <code>buf</code>. It's a common source for false positives from static analysers, though sometimes they do find real bugs related to this, as in the <code>&amp;&amp;</code> case you asked about <a href=\"https://stackoverflow.com/questions/54084453/how-to-make-c-code-to-misra-c2012-compliance\">yesterday</a>.</p>\n\n<p>Assuming 32 bit registers, then the pedantic way to fix it is to use a temporary variable:</p>\n\n<pre><code>uint32_t rxreg = U1RXREG\nbuf[count] = rxreg;\n</code></pre>\n\n<p>As far as machine code and program behavior are concerned, this is equivalent to the original code.</p>\n"}], "owner": {"reputation": 415, "user_id": 10669327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6051fc808e6d6c453bf165e339d09a6a?s=128&d=identicon&r=PG&f=1", "display_name": "raj123", "link": "https://stackoverflow.com/users/10669327/raj123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1661, "favorite_count": 0, "accepted_answer_id": 54105599, "answer_count": 1, "score": 3, "last_activity_date": 1547106422, "creation_date": 1547001289, "last_edit_date": 1547019049, "question_id": 54102531, "link": "https://stackoverflow.com/questions/54102531/how-to-resolve-misra-c2012-rule-13-2-and-13-3-for-c-code", "title": "How to resolve MISRA C:2012 Rule 13.2 and 13.3 for C code?", "body": "<p>I have C source code and I am making it MISRA Compliant. I got an following errors related to MISRA 2012 Rule 13.3 and 13.2:</p>\n\n<ol>\n<li><p>increment/decrement operation combined with other operation with side-effects [MISRA 2012 Rule 13.3, advisory]buf[count++] = U1RXREG;</p></li>\n<li><p>both sides have side effects [MISRA 2012 Rule 1.3, required], [MISRA 2012 Rule 13.2, required]   buf[count] = U1RXREG;</p></li>\n</ol>\n\n<p>Source code for problem 1:</p>\n\n<pre><code> void UART_call(void)\n {\n    if(count &lt; BUF_SIZE)\n    {\n        buf[count++] = U1RXREG;\n        Flag = 1;\n    }\n    else\n    {\n        count = 0;\n        Flag = 0;\n    }\n}\n</code></pre>\n\n<p>After resolving 13.3 error from problem 1 code I am getting MISRA 1.3 and 13.2 errors. Source code for problem 2:</p>\n\n<pre><code>void UART_call(void)\n {\n    if(count &lt; BUF_SIZE)\n    {\n        buf[count] = U1RXREG;\n        count = count + 1U;\n        Flag = 1;\n    }\n    else\n    {\n        count = 0;\n        Flag = 0;\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "linux", "multicast"], "comments": [{"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 0, "creation_date": 1547041592, "post_id": 54102377, "comment_id": 95055243, "body": "What is exactly is the problem here?  How is this code not working as you expect?"}, {"owner": {"reputation": 1, "user_id": 4715267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfdf98d11edda5b9d3548b098c0099f3?s=128&d=identicon&r=PG&f=1", "display_name": "xdyst", "link": "https://stackoverflow.com/users/4715267/xdyst"}, "reply_to_user": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 0, "creation_date": 1548050815, "post_id": 54102377, "comment_id": 95389871, "body": "Is there anyone can help me\uff1f"}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 0, "creation_date": 1548083409, "post_id": 54102377, "comment_id": 95406027, "body": "You need to give us more information for us to help you.  See my last message."}], "owner": {"reputation": 1, "user_id": 4715267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfdf98d11edda5b9d3548b098c0099f3?s=128&d=identicon&r=PG&f=1", "display_name": "xdyst", "link": "https://stackoverflow.com/users/4715267/xdyst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1546999864, "creation_date": 1546999864, "question_id": 54102377, "link": "https://stackoverflow.com/questions/54102377/how-to-send-multicast-report-on-virtual-interface", "title": "How to send multicast report on virtual interface?", "body": "<p>I want to send multicast report, and the source address is the virtual interface address, how to do that? thank you.</p>\n\n<p>for example:</p>\n\n<p>Interface information:</p>\n\n<p>eth0      Link encap:Ethernet  HWaddr 00:0C:35:00:11:22\n          inet addr:192.168.126.100  Bcast:192.168.126.255  Mask:255.255.255.0</p>\n\n<p>eth0:111  Link encap:Ethernet  HWaddr 00:0C:35:00:11:22\n          inet addr:192.168.200.52  Bcast:192.168.200.255  Mask:255.255.255.0</p>\n\n<p>I want to send multicast report and the source address is 192.168.200.52, how to do that?</p>\n\n<p>My code:</p>\n\n<pre><code>#include &lt;sys/types.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;arpa/inet.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;net/if.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nstruct sockaddr_in localSock;\nstruct ip_mreq group;\nint sd;\nint datalen;\nchar databuf[1024];\n\nint main(int argc, char *argv[])\n{\n    /* Create a datagram socket on which to receive. */\n    sd = socket(AF_INET, SOCK_DGRAM, 0);\n    if(sd &lt; 0)\n    {\n        perror(\"Opening datagram socket error\");\n        exit(1);\n    }\n    else\n    {\n        printf(\"Opening datagram socket....OK.\\n\");\n    }\n\n    /* Bind to the proper port number with the IP address */\n    /* specified as INADDR_ANY. */\n    memset((char *) &amp;localSock, 0, sizeof(localSock));\n    localSock.sin_family = AF_INET;\n    localSock.sin_port = htons(4321);\n    localSock.sin_addr.s_addr = inet_addr(\"192.168.200.52\");;\n    if(bind(sd, (struct sockaddr*)&amp;localSock, sizeof(localSock)))\n    {\n        perror(\"Binding datagram socket error\");\n        close(sd);\n        exit(1);\n    }\n    else\n    {\n        printf(\"Binding datagram socket...OK.\\n\");\n    }\n\n    /* Join the multicast group 226.1.1.1 on the local 203.106.93.94 */\n    /* interface. Note that this IP_ADD_MEMBERSHIP option must be */\n    /* called for each local interface over which the multicast */\n    /* datagrams are to be received. */\n    group.imr_multiaddr.s_addr = inet_addr(\"226.1.1.1\");\n    group.imr_interface.s_addr = inet_addr(\"192.168.200.52\");\n    if(setsockopt(sd, IPPROTO_IP, IP_ADD_MEMBERSHIP, (char *)&amp;group, sizeof(group)) &lt; 0)\n    {\n        perror(\"Adding multicast group error\");\n        close(sd);\n        exit(1);\n    }\n    else\n    {\n        printf(\"Adding multicast group...OK.\\n\");\n    }\n\n    /* Read from the socket. */\n    datalen = sizeof(databuf);\n    if(read(sd, databuf, datalen) &lt; 0)\n    {\n        perror(\"Reading datagram message error\");\n        close(sd);\n        exit(1);\n    }\n    else\n    {\n        printf(\"Reading datagram message...OK.\\n\");\n        printf(\"The message from multicast server is: \\\"%s\\\"\\n\", databuf);\n    }\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "raspberry-pi3", "unsigned-char", "lora"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 2, "creation_date": 1547000098, "post_id": 54102362, "comment_id": 95037599, "body": "Just because you changed the type of a function parameter to one that can accommodate larger values does not mean that the function <i>implementation</i> works with larger values."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 2, "creation_date": 1547000308, "post_id": 54102362, "comment_id": 95037652, "body": "But we generally answer questions only about code presented <i>here</i>, in the question, preferably in the form of a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>.  A hyperlink to an external repository is inadequate, because the context of the question is lost as soon as the code is changed or taken down or whatever."}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "edited": false, "score": 0, "creation_date": 1547011188, "post_id": 54102362, "comment_id": 95039782, "body": "The answer to the inferred, underlying problem OP is trying to solve is: <i>No, don&#39;t try to send longer messages; split the long message into short ones instead</i>. The simplest option is to use a character to indicate the end of a message. On the receiving end, concatenate messages, then split them at that character. Often, a linefeed/newline (<code>&#39;\\n&#39;</code>) is used for this, but it is completely up to you."}, {"owner": {"reputation": 1585, "user_id": 3670607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c0ac3a4aac38bc184c7b6c1e45e98e1?s=128&d=identicon&r=PG", "display_name": "Xypron", "link": "https://stackoverflow.com/users/3670607/xypron"}, "edited": false, "score": 0, "creation_date": 1547081944, "post_id": 54102362, "comment_id": 95073410, "body": "The network usage is limited. So you are not allowed to send a lot of messages in sequence. If your data does not fit into 51 bytes every few minutes,  you are probably using the wrong network. Think about WLAN or mobile."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1547082332, "post_id": 54102362, "comment_id": 95073467, "body": "The implementation details, the type of the variables, wheater it&#39;s unsigned short or unsigned char, is unrelated with LoRa communication."}], "answers": [{"tags": [], "owner": {"reputation": 1585, "user_id": 3670607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c0ac3a4aac38bc184c7b6c1e45e98e1?s=128&d=identicon&r=PG", "display_name": "Xypron", "link": "https://stackoverflow.com/users/3670607/xypron"}, "is_accepted": false, "score": 1, "last_activity_date": 1547081812, "creation_date": 1547081812, "answer_id": 54120604, "question_id": 54102362, "link": "https://stackoverflow.com/questions/54102362/difference-between-unsigned-short-and-unsigned-char-in-lora-communication/54120604#54120604", "title": "Difference between unsigned short and unsigned char in LoRa communication", "body": "<p>For the European 863-870MHz band, the application packet size varies between 51 bytes for the slowest data rate, and 222 bytes for faster rates. Cf. <a href=\"https://www.thethingsnetwork.org/forum/t/limitations-data-rate-packet-size-30-seconds-uplink-and-10-messages-downlink-per-day-fair-access-policy/1300\" rel=\"nofollow noreferrer\">https://www.thethingsnetwork.org/forum/t/limitations-data-rate-packet-size-30-seconds-uplink-and-10-messages-downlink-per-day-fair-access-policy/1300</a></p>\n\n<p>You definitively cannot have more than 255 bytes in a message including header bytes.</p>\n"}], "owner": {"reputation": 1, "user_id": 10778564, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Qk6jLtYV8dw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-iyVLKrKDMp3e11jtTGeEzxuhcFqg/mo/photo.jpg?sz=128", "display_name": "Tina S", "link": "https://stackoverflow.com/users/10778564/tina-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547081812, "creation_date": 1546999738, "question_id": 54102362, "link": "https://stackoverflow.com/questions/54102362/difference-between-unsigned-short-and-unsigned-char-in-lora-communication", "title": "Difference between unsigned short and unsigned char in LoRa communication", "body": "<p>I am working on establishing a lora communication between a gateway (RPI3 + LoRa hat) and a node (RPi3 + LoRa hat). As I would like to establish the communication channel without TTN, I tried the following example to setup communication between the two: <a href=\"https://github.com/dragino/rpi-lora-tranceiver/blob/master/dragino_lora_app/main.c\" rel=\"nofollow noreferrer\">https://github.com/dragino/rpi-lora-tranceiver/blob/master/dragino_lora_app/main.c</a></p>\n\n<p>The code works well on both as both the sender and receiver ends. That means that on the sender side, the message to be sent is being printed on the console. And on the receiver side, the received message is being displayed.</p>\n\n<p>This works well for short messages. However, I would like to send a message that is 600 bytes long. In order to send this long message, I edited typedef of <code>writeBuf()</code> argument as follows:</p>\n\n<pre><code>static void writeBuf(byte addr, byte *value, unsigned short len) {\n</code></pre>\n\n<p>I made this change because <code>byte len</code> was limiting message to be sent to 255 (due to the range of unsugned char which is 0-255). And so I needed to extend this range so that I can send a longer message. With this change being made, no message is being printed in the console. The for loop within <code>writeBuf()</code> goes from 0-n and then from 99-n continuously with no send message being printed on the console. Hence, the receiver is never receiving any message. I understand the difference between <code>unsigned short</code> and <code>unsigned char</code>. However, I am not able to understand the difference between <code>unsigned short</code> and <code>unsigned char</code> in this context. Any help/guidance would be highly appreciated. I would also like to know if I am making the right changes or looking at the right direction or not.</p>\n\n<p>Thank you </p>\n"}, {"tags": ["c++", "c", "struct", "typedef"], "comments": [{"owner": {"reputation": 14339, "user_id": 1466970, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/V1J6z.jpg?s=128&g=1", "display_name": "Richard Chambers", "link": "https://stackoverflow.com/users/1466970/richard-chambers"}, "edited": false, "score": 0, "creation_date": 1547000110, "post_id": 54102297, "comment_id": 95037605, "body": "I suggest that you just use <code>typedef</code> to define a type of something like <code>typedef struct A objectA;</code> and then in your code you can do <code>const objectA *pObject;</code> or you could do <code>objectA * const pObject;</code>. You could also use <code>typedef</code> to define a const variation of the pointer type if you wanted to go that route. In general it is much better to not hide a pointer definition within a <code>typedef</code> though I do have to admit that I have done it once or twice myself for a special implementation of an opaque data area that I wanted to use as an array. It was special circumstances."}, {"owner": {"reputation": 2955, "user_id": 4718288, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ee409c8a881d44d6fa6d728445962103?s=128&d=identicon&r=PG&f=1", "display_name": "Hatefiend", "link": "https://stackoverflow.com/users/4718288/hatefiend"}, "reply_to_user": {"reputation": 14339, "user_id": 1466970, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/V1J6z.jpg?s=128&g=1", "display_name": "Richard Chambers", "link": "https://stackoverflow.com/users/1466970/richard-chambers"}, "edited": false, "score": 0, "creation_date": 1547001190, "post_id": 54102297, "comment_id": 95037808, "body": "@RichardChambers Unfortunately I need to do the <code>typdef struct A *B</code> to <a href=\"https://stackoverflow.com/a/2672068/4718288\">completely protect my struct members</a>. In that link, you can see the strategy I&#39;m using to make de-referencing members of <code>B</code> impossible. That will ensure encapsulation."}, {"owner": {"reputation": 105, "user_id": 6119265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5ec8901128e7e20f0c9896efe755364?s=128&d=identicon&r=PG&f=1", "display_name": "dgsomerton", "link": "https://stackoverflow.com/users/6119265/dgsomerton"}, "edited": false, "score": 0, "creation_date": 1547002215, "post_id": 54102297, "comment_id": 95037975, "body": "the typedef evaluates to exactly what is expected. You are expecting to be able to insert a const after having created the typedef. Perhaps you need another typedef to describe the const version."}, {"owner": {"reputation": 14339, "user_id": 1466970, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/V1J6z.jpg?s=128&g=1", "display_name": "Richard Chambers", "link": "https://stackoverflow.com/users/1466970/richard-chambers"}, "edited": false, "score": 0, "creation_date": 1547017669, "post_id": 54102297, "comment_id": 95041822, "body": "@Hatefiend <code>typedef</code> is syntactic sugar, a way to label a particular type. In the link you provide the <code>typedef</code> is to there to make it less cumbersome, fewer characters to type, for the person using the library. The example forward declares the struct then does a <code>typedef</code> using the forward declared struct to define a type of pointer to the struct. However all the places where <code>SomeThing</code> is used, it could also be <code>struct SomeStruct *</code>."}], "owner": {"reputation": 2955, "user_id": 4718288, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ee409c8a881d44d6fa6d728445962103?s=128&d=identicon&r=PG&f=1", "display_name": "Hatefiend", "link": "https://stackoverflow.com/users/4718288/hatefiend"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "closed_date": 1546999935, "answer_count": 0, "score": 0, "last_activity_date": 1546999793, "creation_date": 1546999070, "question_id": 54102297, "link": "https://stackoverflow.com/questions/54102297/c-c-typedef-to-struct-and-const", "closed_reason": "Duplicate", "title": "C/C++ Typedef to struct* and const", "body": "<p>I have the following code</p>\n\n<pre><code>struct A { }\n\ntypedef struct A *B;\n</code></pre>\n\n<p>At this point, I want to declare a function which takes a <code>const B</code>. In other words, I want to create a function</p>\n\n<pre><code>void funct(const struct A *val);\n</code></pre>\n\n<p>However when I do</p>\n\n<pre><code>const B b1 = ...;\n</code></pre>\n\n<p>my compiler claims it evaluates to </p>\n\n<pre><code>struct A *const b1 = ...;\n</code></pre>\n\n<p>I want declare a variable of data type <code>B</code> such that it evaluates to either</p>\n\n<pre><code>const struct A *b1;\n// or\nconst struct A *const b1;\n</code></pre>\n\n<p>How can this be done? Why does the typedef evaluate to something I don't expect?</p>\n\n<p><a href=\"https://i.stack.imgur.com/Rm25L.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Rm25L.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 149158, "user_id": 524368, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oZ8Up.png?s=128&g=1", "display_name": "datenwolf", "link": "https://stackoverflow.com/users/524368/datenwolf"}, "edited": false, "score": 0, "creation_date": 1547026520, "post_id": 54102235, "comment_id": 95046127, "body": "<a href=\"https://en.wikipedia.org/wiki/Bit_banging\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Bit_banging</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1357, "user_id": 773102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/St5U2.gif?s=128&g=1", "display_name": "Jonny Schubert", "link": "https://stackoverflow.com/users/773102/jonny-schubert"}, "is_accepted": false, "score": 0, "last_activity_date": 1547023122, "creation_date": 1547023122, "answer_id": 54106037, "question_id": 54102235, "link": "https://stackoverflow.com/questions/54102235/upload-data-to-max-7219/54106037#54106037", "title": "Upload data to MAX 7219", "body": "<p>Your example is not complete so it's not possible to give a detail answer. Please provide full minimal running example and tell us something about the platform you are working on. For example the variable \"temp\" has not been declared or defined within your code snippet.\nFirst you have to know something about operator precdence. Have a look here: <a href=\"https://en.cppreference.com/w/c/language/operator_precedence\" rel=\"nofollow noreferrer\">https://en.cppreference.com/w/c/language/operator_precedence</a></p>\n\n<p>You can use this online gcc compiler to run and debug small test applications to test the behaviour of your code line. <a href=\"http://pythontutor.com/c.html\" rel=\"nofollow noreferrer\">http://pythontutor.com/c.html</a></p>\n\n<p>So I guess DIN is a register of a peripheral. You assign a value to this register. This value is a bit wise \"AND\" operation result from a the variable temp and MSBIT (\"Maybe a constant\") shifted i bits the the right. \nSo to make the expression more clear you can also write: <code>DIN = temp &amp; (MSBIT &gt;&gt; i).</code> </p>\n\n<p>For closer details about how the MAX7210 is working have a look here. \n<a href=\"https://howtomechatronics.com/tutorials/arduino/8x8-led-matrix-max7219-tutorial-scrolling-text-android-control-via-bluetooth/\" rel=\"nofollow noreferrer\">https://howtomechatronics.com/tutorials/arduino/8x8-led-matrix-max7219-tutorial-scrolling-text-android-control-via-bluetooth/</a></p>\n"}, {"tags": [], "owner": {"reputation": 3478, "user_id": 9061264, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TPing.jpg?s=128&g=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/9061264/mike"}, "is_accepted": false, "score": 0, "last_activity_date": 1547026399, "last_edit_date": 1547026399, "creation_date": 1547024654, "answer_id": 54106446, "question_id": 54102235, "link": "https://stackoverflow.com/questions/54102235/upload-data-to-max-7219/54106446#54106446", "title": "Upload data to MAX 7219", "body": "<p>Let me guess:</p>\n\n<p><code>CLK</code>:  Clock out pin of your microcontroller<br>\n<code>DIN</code>:  Data out pin of your microcontroller</p>\n\n<p>So you are shifting out the value in <code>temp</code> bit by bit on <code>DIN</code> with a clock signal on <code>CLK</code>.   </p>\n\n<pre><code>i = 0  -&gt; DIN = bit 7 of temp  \ni = 1  -&gt; DIn = bit 6 of temp  \n...  \ni = 7  -&gt; DIN = bit 0 of temp\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 10887210, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-V9ocMhsqpyM/AAAAAAAAAAI/AAAAAAAAAPo/2kx3gmfsSn0/photo.jpg?sz=128", "display_name": "Andre Montenegro", "link": "https://stackoverflow.com/users/10887210/andre-montenegro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1547026399, "creation_date": 1546998563, "last_edit_date": 1546998819, "question_id": 54102235, "link": "https://stackoverflow.com/questions/54102235/upload-data-to-max-7219", "title": "Upload data to MAX 7219", "body": "<p>I have the following code to write data on MAX7219 for light up a 8x8 LED Matrix:</p>\n\n<pre><code>for (i = 0; i &lt; 8; i++)  {          \n    CLK = LOW;      \n    DIN = temp &amp; MSBIT &gt;&gt; i;\n    CLK = HIGH;\n}\n</code></pre>\n\n<p>The thing is, sadly, I just know that the code line (<code>DIN = temp &amp; MSBIT &gt;&gt; i;</code>), must be exactly like that, otherwise the LED\u00b4s won't show the expected, but I don't understand how it works...</p>\n\n<p>Please, I really need explanation because I'm stuck....</p>\n\n<p>Note: variable \"temp\" is always a hexadecimal number like 0x20, and \"MSBIT\" = 0x80.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 13419, "user_id": 1405588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/01a91a47db3526000ffa9247f95fff62?s=128&d=identicon&r=PG", "display_name": "o11c", "link": "https://stackoverflow.com/users/1405588/o11c"}, "edited": false, "score": 0, "creation_date": 1546992248, "post_id": 54101479, "comment_id": 95035870, "body": "log10(max value of the type), rounding up. So usually 10."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 2, "creation_date": 1546992385, "post_id": 54101479, "comment_id": 95035899, "body": "A signed 4-byte integer can require up to 12-characters to display (includeing the <i>nul-terminating</i> char), e.g. <code>-2147483648</code>. And that is <i>without</i> any LOCALE specific separators."}, {"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1546992450, "post_id": 54101479, "comment_id": 95035914, "body": "@DavidC.Rankin - is there a reliable way to read the integer value?"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1546992587, "post_id": 54101479, "comment_id": 95035944, "body": "Sure, you can read an integer from a file stream with either <code>scanf&#47;fscanf</code> (not recommended) or read a complete line containing the integer with <code>fgets</code> and then parse with either <code>sscanf</code> (OK, but only success/failure reporting) or with <code>strtol</code> (full error checking, but you must make sure the value converted is <code>INT_MIN &lt;= intval &lt;= INT_MAX</code>)"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1546992986, "post_id": 54101479, "comment_id": 95036043, "body": "And, let me clarify -- you can simply &#39;read&#39; the characters that make up an integer with any input routine and if all you need is a character representation of what the value is, there is no need to convert to an actual integer. You only convert the string representation to an actual integer value (as explained above) -- if needed to perform calculations, etc... You can always use the string for display, etc..."}, {"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1546993349, "post_id": 54101479, "comment_id": 95036128, "body": "@DavidC.Rankin - how do I handle the 1 byte offset though? I want to step over the first character. Thanks."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1546993867, "post_id": 54101479, "comment_id": 95036241, "body": "<code>&amp;output_buffer[1]</code> is the same as <code>output_buffer + 1</code>; both address the character array starting at the second position in the buffer. However, you can&#39;t cast that to an <code>int</code> because it is not an <code>int</code>. It&#39;s a character string which, if printed out, would look like an integer to a human reader."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1546993923, "post_id": 54101479, "comment_id": 95036253, "body": "Perhaps you should clarify what it is exactly that you are trying to do."}, {"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1546994997, "post_id": 54101479, "comment_id": 95036500, "body": "@DavidC.Rankin - I&#39;m trying to reliably extract a, b, c as separate variables."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1546995544, "post_id": 54101479, "comment_id": 95036623, "body": "Well, I wrote an answer for <code>b</code> below, if you still have a question about <code>a</code> and <code>c</code> afterwards, let me know and I&#39;m happy to add to the example."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1546996083, "post_id": 54101479, "comment_id": 95036736, "body": "@Fra - I updated the answer to show how to separate <code>a, b &amp; c</code> from the filled <code>buffer</code>."}], "answers": [{"comments": [{"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 0, "creation_date": 1546993619, "post_id": 54101515, "comment_id": 95036191, "body": "So should I then make the value of &#39;b&#39; a short integer?"}, {"owner": {"reputation": 3439, "user_id": 220034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2ee5c3aaab4812b216c03f81ae897b5?s=128&d=identicon&r=PG", "display_name": "Ass3mbler", "link": "https://stackoverflow.com/users/220034/ass3mbler"}, "reply_to_user": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 0, "creation_date": 1546993872, "post_id": 54101515, "comment_id": 95036243, "body": "If you prefer yes, the value of b is low enough"}, {"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 0, "creation_date": 1546994020, "post_id": 54101515, "comment_id": 95036285, "body": "Thanks. And last question: how would I then receive the string on the end?"}, {"owner": {"reputation": 3439, "user_id": 220034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2ee5c3aaab4812b216c03f81ae897b5?s=128&d=identicon&r=PG", "display_name": "Ass3mbler", "link": "https://stackoverflow.com/users/220034/ass3mbler"}, "reply_to_user": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 0, "creation_date": 1546994190, "post_id": 54101515, "comment_id": 95036320, "body": "Sorry, I didn&#39;t understand your last question"}, {"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 0, "creation_date": 1546994555, "post_id": 54101515, "comment_id": 95036395, "body": "If I then wanted to retrieve the string &#39;c&#39; after short integer &#39;b&#39; should I do the same? See above."}, {"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 0, "creation_date": 1546996800, "post_id": 54101515, "comment_id": 95036885, "body": "Thank you - however, this doesn&#39;t work if &#39;b&#39; is more than 2 digits."}, {"owner": {"reputation": 3439, "user_id": 220034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2ee5c3aaab4812b216c03f81ae897b5?s=128&d=identicon&r=PG", "display_name": "Ass3mbler", "link": "https://stackoverflow.com/users/220034/ass3mbler"}, "reply_to_user": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 0, "creation_date": 1547047913, "post_id": 54101515, "comment_id": 95059383, "body": "do you need a generic solution for &quot;n&quot; digits?"}, {"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 0, "creation_date": 1547055773, "post_id": 54101515, "comment_id": 95064065, "body": "The basic problem is I don&#39;t know what the value of &#39;b&#39; is (don&#39;t know how many digits) so I need a way to just read 2 bytes (if it&#39;s a short int) or 4 bytes (if it&#39;s an int). Going to get back to this today."}], "tags": [], "owner": {"reputation": 3439, "user_id": 220034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2ee5c3aaab4812b216c03f81ae897b5?s=128&d=identicon&r=PG", "display_name": "Ass3mbler", "link": "https://stackoverflow.com/users/220034/ass3mbler"}, "is_accepted": false, "score": 0, "last_activity_date": 1546995547, "last_edit_date": 1546995547, "creation_date": 1546992348, "answer_id": 54101515, "question_id": 54101479, "link": "https://stackoverflow.com/questions/54101479/c-format-specifier-sizes/54101515#54101515", "title": "C Format Specifier Sizes", "body": "<p>In your example, assuming the character array you are asking about is output_buffer and that the size of char is 1 byte in your architecture, the %d will take 2 bytes, one for each digit of your int (b = 90). To get back the value, use:</p>\n\n<pre><code>int x; \nsscanf(&amp;output_buffer[1], \"%d\", &amp;x);\nchar buffer[255]; \nsscanf(&amp;output_buffer[3], \"%[^\\n]\", buffer);\n</code></pre>\n\n<p>Please, check the size of buffer to avoid overflows</p>\n"}, {"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547000107, "post_id": 54101590, "comment_id": 95037603, "body": "This is unclear &quot;some implementations require that the format string is located in read-only memory.&quot;  --&gt; How does the format read-only attribute relate to <code>&quot;%n&quot;</code>dangerousness?"}, {"owner": {"reputation": 5867, "user_id": 2252087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/020cbe41b02f03d59f3adae022c0ce7d?s=128&d=identicon&r=PG", "display_name": "ensc", "link": "https://stackoverflow.com/users/2252087/ensc"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1547028507, "post_id": 54101590, "comment_id": 95047338, "body": "@chux it is dangerous because <code>printf()</code> with <code>%n</code> behaves like <code>scanf()</code>(writes into memory); glibc tries to mitigate this by requiring read-only mapping when building with <code>-D_FORTIFY_SOURCE</code>"}], "tags": [], "owner": {"reputation": 5867, "user_id": 2252087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/020cbe41b02f03d59f3adae022c0ce7d?s=128&d=identicon&r=PG", "display_name": "ensc", "link": "https://stackoverflow.com/users/2252087/ensc"}, "is_accepted": false, "score": 2, "last_activity_date": 1547043395, "last_edit_date": 1547043395, "creation_date": 1546992932, "answer_id": 54101590, "question_id": 54101479, "link": "https://stackoverflow.com/questions/54101479/c-format-specifier-sizes/54101590#54101590", "title": "C Format Specifier Sizes", "body": "<p>There exists a %n modifiers which stores the actual number of written bytes into an <code>int</code>:</p>\n\n<pre><code>int main(int argc, char *argv[])\n{\n    int p0;\n    int p1;\n    char    buf[128];\n\n    sprintf(buf, \"%c%n%d%n%s\", argv[0][0], &amp;p0, atoi(argv[1]), &amp;p1, argv[1]);\n    printf(\"'%s' -&gt; %d, %d\\n\", buf, p0, p1);\n}\n</code></pre>\n\n<p>But this modifier is considered dangerous; some implementations require that the format string is located in read-only memory.</p>\n\n<p>To make the last sentence more clear, an example:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void)\n{\n        char    fmt[] = \"%n\";\n        int     pos;\n\n        printf(\"%n\", &amp;pos);\n        printf(\"ok\\n\");\n\n        printf(fmt, &amp;pos);\n        printf(\"ok\\n\");\n}\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>$ gcc x.c -D_FORTIFY_SOURCE=2 -O2\n$ ./a.out \nok\n*** %n in writable segment detected ***\nAborted (core dumped)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 1, "creation_date": 1547066505, "post_id": 54101865, "comment_id": 95068588, "body": "Glad it helped. There is a lot of learning wrapped up in the short example. Take it piece by piece to understand each part. If you have any question about how a function works, look at the man page, e.g. <a href=\"http://man7.org/linux/man-pages/man3/strtol.3.html\" rel=\"nofollow noreferrer\">strtol(3) - Linux manual page</a>. It&#39;s not enough to have a cursory understanding of how things work in C, instead, you must have an exact understanding of the details. The man pages are cryptic at first, but provide concise detail on exactly how each function works."}, {"owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "edited": false, "score": 0, "creation_date": 1547070881, "post_id": 54101865, "comment_id": 95070443, "body": "Yes it was a great help. I&#39;m still messing around with format specifiers and snprintf get unsigned chars working. My other post is <a href=\"https://stackoverflow.com/questions/54118934/unsigned-characters-and-sprintf-c\" title=\"unsigned characters and sprintf c\">stackoverflow.com/questions/54118934/&hellip;</a> it&#39;s quite the learning curve."}], "tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": true, "score": 3, "last_activity_date": 1546997730, "last_edit_date": 1546997730, "creation_date": 1546995489, "answer_id": 54101865, "question_id": 54101479, "link": "https://stackoverflow.com/questions/54101479/c-format-specifier-sizes/54101865#54101865", "title": "C Format Specifier Sizes", "body": "<p>In answer to your original question, \"how many characters will <code>\"%d\"</code> take?\", you can use a trick with <code>snprintf</code> by specifying the buffer as <code>NULL</code> and the number of characters as <code>0</code>, and then using your <code>\"%d\"</code> format string and your variable <code>b</code>, <code>snprintf</code> will return the number of digits the conversion will require, e.g.</p>\n\n<pre><code>    req = snprintf (NULL, 0, \"%d\", b);\n    printf (\"required digits: %d\\n\", req);\n</code></pre>\n\n<p>Which will output <code>\"required digits: 2\"</code>. (<em>\"the number of characters (excluding the terminating null byte) which would have been written to the final string if enough space had been available.\"</em>) Which is useful when dynamically allocating storage for <code>buffer</code>. In fact, you simply provide your full <em>format string</em> and all variables and <code>snprintf</code> will return the total number of characters needed (to which you add <code>+1</code> for the <em>nul-terminating</em> character)</p>\n\n<p>From the last few comments, I take it you want to read <code>90</code> back into an <code>int</code> from within <code>buffer</code>. That is simple enough to do.</p>\n\n<p>Rather than simply attempting to convert by using the 2nd character in <code>buffer</code> (e.g. <code>buffer[1]</code>), for the generic case, you simply want to start with the 1st character in buffer and scan forward until you find the first digit. (you can also check for <code>'+/-'</code> if you have explicit signed values).</p>\n\n<p>To scan forward in <code>buffer</code> to find the first digit, you iterate over the characters in <code>buffer</code> (either using indexes, e.g. <code>buffer[x]</code>, or using a pointer, e.g, <code>char *p = buffer;</code> and incrementing <code>p++</code>) and check whether each character is a digit. While you can simply use <code>if ('0' &lt;= *p &amp;&amp; *p &lt;= '9')</code>, the <code>ctype.h</code> header provides the <code>isdigit()</code> macro that makes this quite easy. To find the first digit, you could do something like:</p>\n\n<pre><code>#include &lt;ctype.h&gt;  /* for isdigit */\n...\nchar buffer[MAXC] = \"\",  /* buffer to hold a, b, c */\n    *p = buffer;\n...\n    while (*p &amp;&amp; !isdigit(*p))  /* scan forward in buffer to 1st digit */\n        p++;\n</code></pre>\n\n<p>Once you have found your first digit, you convert the sequence of digits to a <code>long</code> value using <code>strtol</code> (which provides full error checking), e.g.</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;errno.h&gt;  /* for errno   */\n#include &lt;limits.h&gt; /* for INT_MIN/INT_MAX */\n...\n    char *endptr;           /* end pointer to use with strtol */\n    long tmp;               /* long value for return of strtol */\n    ...\n    errno = 0;                      /* reset errno - to check after strtol */\n    tmp = strtol (p, &amp;endptr, 0);   /* save conversion result in tmp */\n</code></pre>\n\n<p>(<strong>note:</strong> avoid <code>atoi()</code> is provides <strong>zero</strong> error checking of the conversion)</p>\n\n<p>Now <code>tmp</code> holds the return of <code>strtol</code> which will contain a conversion to <code>long</code> of the digits found in <code>buffer</code> beginning at <code>p</code> (on success). But, before you can make use of the value returned as an <code>int</code>, you must <strong><em>validate</em></strong> that digits were converted, that no error occurred within the conversion, and that the value in <code>tmp</code> is within the range of <code>int</code>. You can do all with a few conditional checks. If all your checks are satisfied, you can then assign the value in <code>tmp</code> to an integer (with the appropriate cast) and have confidence in your final value, e.g.</p>\n\n<pre><code>    if (p == endptr)                /* check if pointer == end pointer */\n        fputs (\"error: no digits converted.\\n\", stderr);\n    else if (errno)             /* if errno set, over/underflow occurred */\n        fputs (\"error: invalid conversion to long.\\n\", stderr);\n    else if (tmp &lt; INT_MIN || INT_MAX &lt; tmp)    /* will fit in int? */\n        fputs (\"error: value exceeds range of int.\\n\", stderr);\n    else {      /* good value, assign to b_from_buf, output */\n        b_from_buf = (int)tmp;\n        printf (\"\\nint read from buffer: %d\\n\", b_from_buf);\n    }\n</code></pre>\n\n<p>Putting your example together (and including validation of your original write to <code>buffer</code> with <code>snprintf</code>, you could do something similar to the following):</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;ctype.h&gt;  /* for isdigit */\n#include &lt;errno.h&gt;  /* for errno   */\n#include &lt;limits.h&gt; /* for INT_MIN/INT_MAX */\n\n#define MAXC 1024\n\nint main (void) {\n\n    char a = 'A',\n        *c = \"A String\",\n        buffer[MAXC] = \"\",  /* buffer to hold a, b, c */\n        *p = buffer,        /* pointer to buffer */\n        *endptr;            /* end pointer to use with strtol */\n    int b = 90,\n        b_from_buf,         /* int to read from filled buffer */\n        rtn;                /* return for snprintf to validate */\n    long tmp;               /* long value for return of strtol */\n\n    rtn = snprintf (buffer, MAXC, \"%c%d%s\", a, b, c);\n    if (rtn &lt; 0) {  /* if &lt; 0, error occurred */\n        fputs (\"error: writing to buffer.\\n\", stderr);\n        return 1;\n    }\n    else if (rtn &gt;= MAXC)   /* if &gt; size, truncation occurred */\n        fputs (\"warning: buffer contains truncated string.\\n\", stderr);\n\n    printf (\"%s\\n\", buffer);    /* output buffer */\n\n    while (*p &amp;&amp; !isdigit(*p))  /* scan forward in buffer to 1st digit */\n        p++;\n\n    errno = 0;                      /* reset errno - to check after strtol */\n    tmp = strtol (p, &amp;endptr, 0);   /* save conversion result in tmp */\n    if (p == endptr)                /* check if pointer == end pointer */\n        fputs (\"error: no digits converted.\\n\", stderr);\n    else if (errno)             /* if errno set, over/underflow occurred */\n        fputs (\"error: invalid conversion to long.\\n\", stderr);\n    else if (tmp &lt; INT_MIN || INT_MAX &lt; tmp)    /* will fit in int? */\n        fputs (\"error: value exceeds range of int.\\n\", stderr);\n    else {      /* good value, assign to b_from_buf, output */\n        b_from_buf = (int)tmp;\n        printf (\"\\nint read from buffer: %d\\n\", b_from_buf);\n    }\n}\n</code></pre>\n\n<p>(<strong>note:</strong> if the value in <code>buffer</code> can have an explicit sign before it, e.g. <code>'-'</code> or <code>'+'</code>, then you add those to the same conditional with <code>isdigit()</code>)</p>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/snprintf_string\nA90A String\n\nint read from buffer: 90\n</code></pre>\n\n<p><strong>After Last Comment Wanting 'a, b &amp; c` Back</strong></p>\n\n<p>You already have all you need to get <code>a, b &amp; c</code> back from buffer. Since you used <code>strtol</code> and <code>endptr</code> will point to the next character after the last digit converted, you can get <code>a, b &amp; c</code> back from buffer by simply outputting the values, e.g.</p>\n\n<pre><code>    else {      /* good value, assign to b_from_buf, output */\n        b_from_buf = (int)tmp;\n        printf (\"\\n(a) 1st char in buffer        : %c\\n\"\n                \"(b) int read from buffer      : %d\\n\"\n                \"(c) remaining chars in buffer : %s\\n\", \n                *buffer, b_from_buf, endptr);\n    }\n</code></pre>\n\n<p><strong>Modified Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/snprintf_string\nA90A String\n\n(a) 1st char in buffer        : A\n(b) int read from buffer      : 90\n(c) remaining chars in buffer : A String\n</code></pre>\n\n<p>Look things over and let me know if you have further questions.</p>\n"}], "owner": {"reputation": 403, "user_id": 4151166, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/5d76f16f63fad4a2a697abbb7e9de58e?s=128&d=identicon&r=PG&f=1", "display_name": "Fra", "link": "https://stackoverflow.com/users/4151166/fra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 54101865, "answer_count": 3, "score": 0, "last_activity_date": 1547043395, "creation_date": 1546992120, "last_edit_date": 1546995320, "question_id": 54101479, "link": "https://stackoverflow.com/questions/54101479/c-format-specifier-sizes", "title": "C Format Specifier Sizes", "body": "<p>How do I access an integer value in a character array?</p>\n\n<pre><code>char a = 'A';\nint b = 90;\nchar * c = \"A String\";\nsnprintf(output_buffer, 1024, \"%c%d%s, a,b,c);`\n</code></pre>\n\n<p>How many bytes will the <code>%d</code> format specifier (I assume 4?) take up in this character array and how do I access the integer value b? </p>\n\n<p>I've tried:</p>\n\n<pre><code>int x = *((int *) &amp;output_buffer[1]\n</code></pre>\n\n<p>without success.</p>\n\n<pre><code>short x; \nsscanf(&amp;output_buffer[1], \"%d\", &amp;x);\nprintf(\"%d\\n\",x);`\n\nchar *buffer; \nsscanf(&amp;output_buffer[3], \"%s\", buffer);\nprintf(\"%s\\n\",buffer);`\n</code></pre>\n"}, {"tags": ["c", "sockets", "tcp", "netcat", "tcpserver"], "comments": [{"owner": {"reputation": 3439, "user_id": 220034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2ee5c3aaab4812b216c03f81ae897b5?s=128&d=identicon&r=PG", "display_name": "Ass3mbler", "link": "https://stackoverflow.com/users/220034/ass3mbler"}, "edited": false, "score": 2, "creation_date": 1546991597, "post_id": 54101368, "comment_id": 95035700, "body": "Are you running your executable as root?"}, {"owner": {"reputation": 9021, "user_id": 1250381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88331c480b23341e10b1b0c0051f4eee?s=128&d=identicon&r=PG", "display_name": "dAm2K", "link": "https://stackoverflow.com/users/1250381/dam2k"}, "edited": false, "score": 0, "creation_date": 1546996488, "post_id": 54101368, "comment_id": 95036821, "body": "only root can bind ports under 1025 because they are reserved ports, so as already said, you must run your program as root or use a port &gt; 1024"}], "answers": [{"tags": [], "owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "is_accepted": true, "score": 1, "last_activity_date": 1546992007, "creation_date": 1546992007, "answer_id": 54101467, "question_id": 54101368, "link": "https://stackoverflow.com/questions/54101368/testing-a-tcp-ip-server-locally/54101467#54101467", "title": "Testing a TCP/IP server locally", "body": "<p>Low-numbered ports are considered privileged by most operating systems. Try with a port like 8000 or 8080.</p>\n"}, {"tags": [], "owner": {"reputation": 307, "user_id": 10738788, "user_type": "registered", "profile_image": "https://graph.facebook.com/1439777192820975/picture?type=large", "display_name": "Deepak Bhavale", "link": "https://stackoverflow.com/users/10738788/deepak-bhavale"}, "is_accepted": false, "score": 0, "last_activity_date": 1547024736, "creation_date": 1547024736, "answer_id": 54106465, "question_id": 54101368, "link": "https://stackoverflow.com/questions/54101368/testing-a-tcp-ip-server-locally/54106465#54106465", "title": "Testing a TCP/IP server locally", "body": "<p>Since you are passing port 80 via command line argument i.e. ARGV[2]. The Port No. 80 is the port number assigned to commonly used internet communication protocol, Hypertext Transfer Protocol (HTTP).</p>\n\n<p>You can use the port according to the below classification: \n 1. Ports 0\u20131023 \u2013 system or well-known ports\n 2. Ports 1024\u201349151 \u2013 user or registered ports\n 3. Ports >49151 \u2013 dynamic / private ports</p>\n\n<p>So by this might, your problem will get solved.</p>\n"}], "owner": {"reputation": 1920, "user_id": 4841832, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hD1nI.jpg?s=128&g=1", "display_name": "Jsevillamol", "link": "https://stackoverflow.com/users/4841832/jsevillamol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 54101467, "answer_count": 2, "score": 0, "last_activity_date": 1547024736, "creation_date": 1546991205, "question_id": 54101368, "link": "https://stackoverflow.com/questions/54101368/testing-a-tcp-ip-server-locally", "title": "Testing a TCP/IP server locally", "body": "<p>I have written an echo TCP server in C.</p>\n\n<p>I wish to test my code to see if it works.</p>\n\n<pre><code>#include &lt;sys/socket.h&gt;\n#include &lt;sys/un.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;netdb.h&gt;\n\n#define BUF_SIZE 500\n#define LISTEN_BACKLOG 50\n\n#define handle_error(msg) \\\n   do { perror(msg); exit(EXIT_FAILURE); } while (0)\n\nint\nmain(int argc, char *argv[])\n{\n   struct addrinfo hints;\n   struct addrinfo *res, *rp;\n   struct sockaddr_storage peer_addr;\n   socklen_t peer_addr_len;\n   int sfd, cfd;\n\n   if(argc != 3) {\n      fprintf(stderr, \"Usage: %s address port\\n\", argv[0]);\n      exit(EXIT_FAILURE);\n   }\n\n   memset(&amp;hints, 0, sizeof(struct addrinfo));\n   hints.ai_family = AF_UNSPEC;\n   hints.ai_socktype = SOCK_STREAM;\n   hints.ai_flags = AI_PASSIVE;\n   hints.ai_protocol = 0;\n   hints.ai_addr = NULL;\n   hints.ai_next = NULL;\n\n   if(getaddrinfo(argv[1], argv[2], &amp;hints, &amp;res) != 0)\n      handle_error(\"getaddrinfo\");\n\n   // Try each socket until we bind\n   for(rp = res; rp != NULL; rp = rp-&gt;ai_next){\n      sfd = socket(rp-&gt;ai_family, rp-&gt;ai_socktype, 0);\n      if(sfd == -1) continue;\n      if(bind(sfd, rp-&gt;ai_addr, rp-&gt;ai_addrlen) == 0) break;\n      else close(sfd);\n   }\n\n   freeaddrinfo(res);\n\n   if (rp == NULL){\n      fprintf(stderr, \"Could not bind to any socket\\n\");\n      exit(EXIT_FAILURE);\n   }\n\n   // Set the TCP socket to listen state\n   if (listen(sfd, LISTEN_BACKLOG) == -1) handle_error(\"listen\");\n\n   for(;;){\n      // Accept\n      peer_addr_len = sizeof(struct sockaddr_storage);\n      cfd = accept(sfd, (struct sockaddr *) &amp;peer_addr, &amp;peer_addr_len);\n      if (cfd == -1) handle_error(\"accept\");\n\n      // Fork\n      pid_t pid = fork();\n\n      if (pid == 0){\n         //Child code\n         char buf[BUF_SIZE];\n         while(1){\n             ssize_t nread = recv(cfd, buf, BUF_SIZE, 0);\n             if (nread == 0) {\n                 close(cfd);\n                 exit(EXIT_SUCCESS);\n             } else {\n                 ssize_t nsent = send(cfd, buf, nread, 0);\n                 if (nsent != nread) fprintf(stderr, \"Error sending response\");\n             }\n\n         }\n      } else {\n         //Parent code\n\n      }\n   }\n   close(sfd);\n} \n</code></pre>\n\n<p>It compiles just fine, but when I try running it as <code>tcp_server 127.0.0.1 80</code> it gives me the error message <code>Could not bind to any socket</code>.</p>\n\n<p>In my understanding, this should have bound the server to the IPv4 loopback address, port 80, and then I would have been able to interact with it using <code>netcat</code>.</p>\n\n<p>What is going on?</p>\n"}, {"tags": ["c", "makefile"], "comments": [{"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "edited": false, "score": 1, "creation_date": 1546991864, "post_id": 54101337, "comment_id": 95035788, "body": "Why the double colon <code>::</code>? One would work."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 1, "creation_date": 1546991949, "post_id": 54101337, "comment_id": 95035809, "body": "What do you mean by &quot;this works&quot; and &quot;this fails&quot;? What actually happens? Please provide example output and explain what you want it to do differently."}, {"owner": {"reputation": 86085, "user_id": 128940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d35101b4060dc3af0d5c1b7c42c4935?s=128&d=identicon&r=PG&f=1", "display_name": "Beta", "link": "https://stackoverflow.com/users/128940/beta"}, "edited": false, "score": 0, "creation_date": 1546992767, "post_id": 54101337, "comment_id": 95035986, "body": "Your language is very confusing. Your first sentence suggests that you want each object to depend on all sources, your second makes that explicitly clear, your code confirms that, and your last sentence seems to contradict it (and is self-contradictory when taken literally), And if you want that, <i>for Heaven&#39;s sake WHY?</i>"}], "answers": [{"tags": [], "owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "is_accepted": true, "score": 0, "last_activity_date": 1546991809, "creation_date": 1546991809, "answer_id": 54101443, "question_id": 54101337, "link": "https://stackoverflow.com/questions/54101337/why-does-and-behave-differently-in-this-rule/54101443#54101443", "title": "Why does * and % behave differently in this rule?", "body": "<p>When <code>%</code> in a target pattern matches, the <code>%</code> in the prerequisites expand to the matched part in the target.</p>\n\n<p>For example, let's say you have a rule</p>\n\n<pre><code>%.o: %.c\n    $(CC) $(CFLAGS) -c $^\n</code></pre>\n\n<p>When <code>foo.o</code> matches the rule target (<code>%.o</code>), the prerequisite is <code>foo.c</code>.</p>\n\n<p>This is explained in for example the GNU Make manual, section <a href=\"https://www.gnu.org/software/make/manual/html_node/Pattern-Intro.html\" rel=\"nofollow noreferrer\">Introduction to Pattern Rules</a>, and works the same in all make variants.</p>\n"}], "owner": {"reputation": 11, "user_id": 5911478, "user_type": "registered", "profile_image": "https://graph.facebook.com/1571184163171725/picture?type=large", "display_name": "Charles Vorbach", "link": "https://stackoverflow.com/users/5911478/charles-vorbach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 54101443, "answer_count": 1, "score": -1, "last_activity_date": 1546999590, "creation_date": 1546991017, "last_edit_date": 1546999590, "question_id": 54101337, "link": "https://stackoverflow.com/questions/54101337/why-does-and-behave-differently-in-this-rule", "title": "Why does * and % behave differently in this rule?", "body": "<p>I'm trying to make each object file <code>foo.o</code> dependent on its source file <code>foo.c</code>.  For some reason, using * to make each dependent on every source file (so that <code>foo.o</code> depends on <code>foo.c, bar.c, etc.</code> works but using % gives an error.</p>\n\n<p>My directory structure is has just one source file right now, but I'm planning to add more. The error I get is: </p>\n\n<pre><code>$(PATHO)%.o:: $(PATHT)*.c  # This compiles properly\n  recipe\n\n$(PATHO)%.o:: $(PATHT)%.c  # This causes error 'No rule to make target'\n  recipe\n</code></pre>\n\n<p>EDIT: I clarified my question, apologies for any confusion.</p>\n"}, {"tags": ["c", "typedef"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1546988129, "post_id": 54100719, "comment_id": 95034755, "body": "You can do things with typedef that you can&#39;t do (at all easily) with macros \u2014 pointers to functions are an example; pointers generally are an issue, but you shouldn&#39;t be using typedef on pointers willy-nilly anyway.  <code>#pragma message</code> is not standard \u2014 the C standard does not define what it does.  There isn&#39;t a standard way to find the mappings for typedefs.  Your nearest approach might be to view the output from the C preprocessor (often <code>-E</code> or <code>-P</code> option to the C compiler, or perhaps run <code>cpp</code> as a standalone program), but that&#39;s not exactly neat or simple (it is very verbose, usually)."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 4, "creation_date": 1546988195, "post_id": 54100719, "comment_id": 95034773, "body": "There is always grepping for the typedef definition."}, {"owner": {"reputation": 32176, "user_id": 2173773, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/M8yh6.jpg?s=128&g=1", "display_name": "H&#229;kon H&#230;gland", "link": "https://stackoverflow.com/users/2173773/h%c3%a5kon-h%c3%a6gland"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1546989508, "post_id": 54100719, "comment_id": 95035178, "body": "@JohnBollinger Yes <code>grep</code> is a quite powerful, and I have used it. But sometimes it seems not enough. For example if the <code>typedef</code> is nested in an <code>#if</code> - <code>#elif</code> clause that depends on other defined symbols. However, in this case, I think using the approach suggested by @JonathanLeffler (in the comment above) and running <code>gcc -E ... | grep MY_TYPE_NAME</code> might come to rescue?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1547005818, "post_id": 54100719, "comment_id": 95038620, "body": "(a) Easy but requires manual work for each case: Pass an object of the type to a function taking some different type and read the compiler error message. (b) Hard, implementation-dependent, but can be automated: Interpret the debug information produced by the compiler. This requires digging up documentation on the data the compiler generates for use by debuggers and writing a lot of code to interpret that data. Alternatively, some scripting to run a debugger and make it print the type might work."}], "owner": {"reputation": 32176, "user_id": 2173773, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/M8yh6.jpg?s=128&g=1", "display_name": "H&#229;kon H&#230;gland", "link": "https://stackoverflow.com/users/2173773/h%c3%a5kon-h%c3%a6gland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1546986940, "creation_date": 1546986940, "question_id": 54100719, "link": "https://stackoverflow.com/questions/54100719/show-how-of-a-typedef-declaration-has-been-defined", "title": "Show how of a typedef declaration has been defined?", "body": "<p>How can I show the compiler's definition of a <code>typedef</code> during compilation of a C program?</p>\n\n<p>I know I can show how a macro is defined using e.g. <code>#pragma message</code>, see <a href=\"https://stackoverflow.com/q/1562074/2173773\">How do I show the value of a #define at compile-time?</a>, but I could not find a similar procedure for <code>typedef</code>s. </p>\n\n<p>Being able to dump a <code>typedef</code>s definition during compile time (or run time) could help debugging programs you did not write yourself.</p>\n"}, {"tags": ["c", "ansi", "ansi-c"], "comments": [{"owner": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 1, "creation_date": 1546986192, "post_id": 54100578, "comment_id": 95034061, "body": "You&#39;d need to cast to a <code>char*</code> for the arithmetic to be valid, but that is then equivalent to a <code>memset</code>"}, {"owner": {"reputation": 13, "user_id": 10806574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e7bdf0ea824815c08589a3bdafc3107?s=128&d=identicon&r=PG&f=1", "display_name": "Albert", "link": "https://stackoverflow.com/users/10806574/albert"}, "reply_to_user": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 0, "creation_date": 1546986568, "post_id": 54100578, "comment_id": 95034196, "body": "But, if I cast it to a pointer to a char, will it work everywhere? Is that solution compiler dependent? Is it the best solution?"}, {"owner": {"reputation": 2723, "user_id": 9017315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3229c3b31dc467c858d3d27f88c41c11?s=128&d=identicon&r=PG&f=1", "display_name": "Osiris", "link": "https://stackoverflow.com/users/9017315/osiris"}, "edited": false, "score": 1, "creation_date": 1546986643, "post_id": 54100578, "comment_id": 95034223, "body": "You should pass the length in bytes, otherwise it is meaningless."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1546988493, "post_id": 54100578, "comment_id": 95034866, "body": "Look at the standard C <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/bsearch.html\" rel=\"nofollow noreferrer\"><code>bsearch()</code></a> and <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/qsort.html\" rel=\"nofollow noreferrer\"><code>qsort()</code></a> functions.  Both operate on arbitrary sized arrays of arbitrary types.  Use them to guide your thinking.  Using a <code>void *</code> is part of it; you&#39;ll need the number of elements in the array and the size of each element, plus one or more pointers to functions to operate on the data.  Beware that GCC allows you to do things with <code>void *</code> that the C standard does not."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1546988785, "post_id": 54100578, "comment_id": 95034948, "body": "Your example is not very interesting since filling with zero is easily solved regardless of data type (and can be done using the standard function <code>memset()</code>).  I suggest you modify the example to make it more interesting - i.e. cannot be solved with <code>memset()</code>)."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1546988941, "post_id": 54100578, "comment_id": 95035001, "body": "You are right - casting to <code>char*</code> is not a solution - all bytes will have the value of the least significant byte of the data parameter <code>data</code>."}, {"owner": {"reputation": 13, "user_id": 10806574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e7bdf0ea824815c08589a3bdafc3107?s=128&d=identicon&r=PG&f=1", "display_name": "Albert", "link": "https://stackoverflow.com/users/10806574/albert"}, "reply_to_user": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1546990609, "post_id": 54100578, "comment_id": 95035450, "body": "@Clifford, actually, that&#39;s just a function, my aim isn&#39;t to fill the array with data, but to understand and learn how to pass data if I don&#39;t know its type, or allow my function to work with more than just one type of data."}, {"owner": {"reputation": 1149, "user_id": 2472827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t5rYY.jpg?s=128&g=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/2472827/neil"}, "edited": false, "score": 0, "creation_date": 1546990884, "post_id": 54100578, "comment_id": 95035534, "body": "You can&#39;t pass a parameter of unknown type without passing the size (or something that allows you to calculate the size) as well. <code>array_fill(array, sizeof array, 0)</code> (as I imagine it is supposed to work) is just <code>memset(array, 0, sizeof array)</code>, except <code>memset</code> is highly optimised and more clear to someone who reads your code."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1546992119, "post_id": 54100578, "comment_id": 95035835, "body": "@AlbertWilliams : I appreciate that; you have missed my point - it is better to use an example that actually <i>needs</i> the solution and demonstrates its generality.  i.e. I am not saying you can just use <code>memset()</code>; rather recommending that you change the example to something that cannot be implemented using <code>memset()</code> to better illustrate your requirements."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1546992460, "post_id": 54100578, "comment_id": 95035917, "body": "You have edited the question, and I suspect it now generates additional errors for the dereferencing of <code>*data</code>.  Changing your question in such a way that it invalidates existing otherwise valid answers might not win you friends. I shall not rework my answer, but it no longer matches your code since you changed the signatiure of <code>fill_array()</code>.  I suggest you roll it back - the change serves little purpose I think."}, {"owner": {"reputation": 13, "user_id": 10806574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e7bdf0ea824815c08589a3bdafc3107?s=128&d=identicon&r=PG&f=1", "display_name": "Albert", "link": "https://stackoverflow.com/users/10806574/albert"}, "edited": false, "score": 0, "creation_date": 1546992920, "post_id": 54100578, "comment_id": 95036026, "body": "I rolled it back, I&#39;m sorry if I did but, won&#39;t it give an extra error? I mean, I&#39;m assigning an int to a variable whose type I don&#39;t know, and I think I should cast it to the type in order to avoid errors, am I wrong?"}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1546994658, "post_id": 54100578, "comment_id": 95036419, "body": "All I am saying is that the code you post should be the code that generated the errors you posted.  If you change the code you should also update the error log.  But more importantly your changes make some parts of some existing answers plain wrong - you mar making a moving target.  Changing the code served no purpose because both versions will fail, and both versions  illustrate your problem."}], "answers": [{"comments": [{"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1546989041, "post_id": 54100658, "comment_id": 95035046, "body": "That explains why he is getting the error, but does not answer the question : <i>&quot;Is there a way...?&quot;</i>"}], "tags": [], "owner": {"reputation": 3927, "user_id": 1251851, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/hsmcR.jpg?s=128&g=1", "display_name": "Kartik Anand", "link": "https://stackoverflow.com/users/1251851/kartik-anand"}, "is_accepted": false, "score": 2, "last_activity_date": 1546986578, "creation_date": 1546986578, "answer_id": 54100658, "question_id": 54100578, "link": "https://stackoverflow.com/questions/54100578/is-there-any-way-to-pass-an-array-of-an-unknown-type-as-a-parameter-to-a-functio/54100658#54100658", "title": "Is there any way to pass an array of an unknown type as a parameter to a function in C?", "body": "<p>The problem here is two-fold. First is dereferencing the <code>void</code> pointer and the other is doing arithmetic with it. The compiler also warns you about it as you've shown in your post.</p>\n\n<p>You can't directly add to a <code>void</code> pointer since the compiler doesn't know how much further it needs to go when adding addresses, it needs the size of the thing being pointed to, to be able to do it. Therefore, you'd need to typecast the void to something concrete before you can add stuff to it.</p>\n\n<p>Similarly, you cannot dereference a void pointer because again the compiler doesn't know how many bytes to extract since <code>void</code> doesn't have any implicit length.</p>\n"}, {"comments": [{"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1546989145, "post_id": 54100679, "comment_id": 95035077, "body": "That explains the error, but does not provide an answer to the question."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 2, "creation_date": 1546989725, "post_id": 54100679, "comment_id": 95035223, "body": "There is no need to cast to <code>(void*)</code> in C. <code>void *</code> is assignable from any pointer type (qualifications aside)"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1547003609, "post_id": 54100679, "comment_id": 95038205, "body": "The pointer does not know the size of what it points to, only where it starts. The compiler knew the size, but by the time the cide executes the compiler is long-gone."}], "tags": [], "owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "is_accepted": false, "score": 4, "last_activity_date": 1546989762, "last_edit_date": 1546989762, "creation_date": 1546986699, "answer_id": 54100679, "question_id": 54100578, "link": "https://stackoverflow.com/questions/54100578/is-there-any-way-to-pass-an-array-of-an-unknown-type-as-a-parameter-to-a-functio/54100679#54100679", "title": "Is there any way to pass an array of an unknown type as a parameter to a function in C?", "body": "<p>Pointers point to the beginning of some object in memory. <em>Most</em> pointers also know the size of that object in memory through the type, the exception being <code>void *</code>.</p>\n\n<p>E.g. If the value of a pointer to 32-bit integer is 0, we know bits 0 through 31 contain the data corresponding to that 32-bit integer.</p>\n\n<pre><code>0  31\n|---| &lt;- 32 bits storing the data for a 32-bit integer\n</code></pre>\n\n<p>More importantly for your question, if we know that this pointer points to a sequence of 32-bit integers, we know that we can get the next integer by moving the pointer forward by 32 bits. E.g. the second integer would start at 32.</p>\n\n<pre><code>0  31 32 63\n|---| |---|\n\nThis is what int[2]. might look like in memory on a 32-bit system\n</code></pre>\n\n<p>This is how pointer arithmetic works. With a void pointer <code>void *array</code> you cannot do <code>array++</code> or even <code>*array</code> because there is no way to know how many bits to advance the pointer or how many bits correspond to <code>array</code>.</p>\n\n<pre><code>0    ??\n|----\n\nWe don't know how many bits a void pointer points to\n</code></pre>\n\n<p>You can <em>technically</em> get around this by passing the size of the object as well, although this is probably not a good idea.</p>\n\n<pre><code>// array points to the memory to be filled\n// len is the number of elements in the array\n// size is the size of an element (in bytes)\n// fill points to an object to be used to fill array\nvoid array_fill(void* array, int len, size_t size, void* fill) {\n    // char is always a single byte\n    char* byte_ptr = (char*) array;\n\n    for (int i = 0; i &lt; len; i++) {\n        // Fill the current element\n        memcpy(byte_ptr, fill, size);\n\n        // Advance byte_ptr the correct number of bytes\n        byte_ptr += size;\n    }\n}\n</code></pre>\n\n<p>If you don't want to use <code>memcpy</code> you could also manually copy the <code>fill</code> object to <code>byte_ptr</code> one byte at a time.</p>\n"}, {"tags": [], "owner": {"reputation": 292, "user_id": 5661266, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/10205593199614644/picture?type=large", "display_name": "mmeisson", "link": "https://stackoverflow.com/users/5661266/mmeisson"}, "is_accepted": false, "score": 0, "last_activity_date": 1546987995, "last_edit_date": 1546987995, "creation_date": 1546987341, "answer_id": 54100771, "question_id": 54100578, "link": "https://stackoverflow.com/questions/54100578/is-there-any-way-to-pass-an-array-of-an-unknown-type-as-a-parameter-to-a-functio/54100771#54100771", "title": "Is there any way to pass an array of an unknown type as a parameter to a function in C?", "body": "<p>If you expect to fill an array of  type with  data, let's say an array of double with the value 2.2 or even en array of structure { int a; anything b }; then basicaly the answer is no, you can't do this this way.</p>\n\n<p>You could use a macro for this, like</p>\n\n<pre><code># define FILL_ARRAY(arr, data, len) for (size_t i = 0; i &lt; len; i++) { arr[i] = data }\n</code></pre>\n\n<p>But it is not a function.</p>\n\n<p>But you could create a function that takes a callback able to assign a data, like :</p>\n\n<pre><code>void fill_array(void * array, size_t item_size, size_t array_len, void (*cb)(void *))\n{\n    unsigned char *bytes = array;\n    for (size_t i = 0; i &lt; array_len; i++) {\n        cb(&amp;bytes[i * item_size]);\n    }\n}\n\nvoid fill_double(void *data)\n{\n    const value = 2.2;\n    double *ptr = *data;\n\n    *data = value;\n}\n\nint main(void)\n{\n    double array[30];\n\n    fill_array(array, sizeof double, 30, fill_double);\n}\n</code></pre>\n\n<p>Not sure that this is worth, but it should look like a solution to your question ( not compiled, may contain errors )</p>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 10806574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e7bdf0ea824815c08589a3bdafc3107?s=128&d=identicon&r=PG&f=1", "display_name": "Albert", "link": "https://stackoverflow.com/users/10806574/albert"}, "edited": false, "score": 0, "creation_date": 1546992628, "post_id": 54101001, "comment_id": 95035958, "body": "Oh, thank you! I&#39;m getting it better, actually it&#39;s an interesting matter and I want to know more about it, where can I find more information? What books do you recommend?"}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "reply_to_user": {"reputation": 13, "user_id": 10806574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e7bdf0ea824815c08589a3bdafc3107?s=128&d=identicon&r=PG&f=1", "display_name": "Albert", "link": "https://stackoverflow.com/users/10806574/albert"}, "edited": false, "score": 0, "creation_date": 1546993983, "post_id": 54101001, "comment_id": 95036274, "body": "@AlbertWilliams : More about what in particular.  IMO good books on C stopped being written when it stopped being useful - it is a small, language there is not much more you can say about it beyond a certain point.  The minor additions to the language since its first standardisation in ANSI C89 / ISO C90 don&#39;t take much explaining,  Understanding C is helped by understanding the fundamentals of computer architecture at a relative low level because it exposes that architecture, so a more general reading of computing fundamental is in order perhaps."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "reply_to_user": {"reputation": 13, "user_id": 10806574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e7bdf0ea824815c08589a3bdafc3107?s=128&d=identicon&r=PG&f=1", "display_name": "Albert", "link": "https://stackoverflow.com/users/10806574/albert"}, "edited": false, "score": 0, "creation_date": 1546994214, "post_id": 54101001, "comment_id": 95036326, "body": "If I had to call it, despite not being updated to later ISO C standards, I&#39;d still recommend the seminal K&amp;R C Programming Language.  It will teach you the fundamentals of C,  however not necessarily how to program or construct software in a broader sense."}], "tags": [], "owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "is_accepted": true, "score": 1, "last_activity_date": 1546994882, "last_edit_date": 1546994882, "creation_date": 1546988633, "answer_id": 54101001, "question_id": 54100578, "link": "https://stackoverflow.com/questions/54100578/is-there-any-way-to-pass-an-array-of-an-unknown-type-as-a-parameter-to-a-functio/54101001#54101001", "title": "Is there any way to pass an array of an unknown type as a parameter to a function in C?", "body": "<p>Without a type the data referenced by <code>array</code> has not element size so the pointer arithmetic is undefined.  For the expression to be valid, you must cast <code>array</code> to an appropriate data type such as:</p>\n\n<pre><code>*((int*)array + i) = data; \n</code></pre>\n\n<p>But that defeats the purpose of having an undefined type.  The simple and most efficient solution is to define separate functions for array each type you wish to fill.  It is possible to define a function that will handle multiple <em>integer</em> types thus:</p>\n\n<pre><code>int array_fill(void* array, size_t array_length, long long data, size_t data_size )\n{\n    if( data_size &gt; sizeof(data) )\n    {\n        data_size = sizeof(data) ;\n    }\n\n    for( size_t i = 0; i &lt; array_length; i++)\n    {\n        for( int b = 0; b &lt; data_size; b++ )\n        {  \n            ((char*)array)[i * data_size + b] = (data &gt;&gt; (b * 8)) &amp; 0xff ;\n        }\n    }\n\n  return 0; \n}\n</code></pre>\n\n<p>The above makes two assumptions:</p>\n\n<ul>\n<li>the target uses is little-endian byte order,</li>\n<li>the target has an 8 bit <code>char</code> type.</li>\n</ul>\n\n<p>Modifications are necessary where those assumptions are not true.  Note I have also used array index notation rather than pointer arithmetic - it results in fewer parentheses so is easier to read.</p>\n\n<p>The function might then be called, in your case for example thus:</p>\n\n<pre><code>array_fill( array, array_length(array), 0, sizeof(*array) ) ;\n</code></pre>\n\n<p>and <code>array</code> may have any type.</p>\n\n<p>However filling an array with zero is a special case that does not need this complexity, (i.e. for your example usage it serves no purpose).  The following :</p>\n\n<pre><code>memset( array, sizeof(array), 0 ) ;\n</code></pre>\n\n<p>has the same effect some all bytes of the integer 0 are zero in any case.  The function is of more use for values where each byte differs. </p>\n\n<pre><code>array_fill( array, array_length(array), 0x01234ABCD, sizeof(*array) ) ;\n</code></pre>\n\n<p>Now if <code>array</code> is of type <code>uint8_t</code> for example it will be filled with <code>0xCD</code>, if it is <code>uint16_t</code> then <code>0xABCD</code>.  If it were <code>long long</code> and on the target that is a 64 bit type, it will be filled with <code>0x0000000001234ABCD</code>.</p>\n\n<p>It is possible if somewhat cumbersome to also use this function to fill a <code>float</code> or <code>double</code> array thus for example:</p>\n\n<pre><code>double array[ARBITRARY_SIZE];\ndouble x = 0.5 ;\narray_fill(array, ARBITRARY_SIZE, *(long long*)(&amp;x), sizeof(array) );\n</code></pre>\n\n<p>Another approach that allows also aggregate types or even arbitrary length sequences to be used as the fill is:</p>\n\n<pre><code>int array_fill( void* array, size_t array_length, \n                const void* fill_pattern, size_t fill_pattern_length )\n{\n    for( size_t i = 0; i &lt; array_length; i++)\n    {\n        for( int b = 0; b &lt; fill_pattern_length; b++ ) \n        {  \n            ((char*)array)[i * fill_pattern_length + b] = ((char*)fill_pattern)[b] ;\n        }\n    }\n\n  return 0; \n}\n</code></pre>\n\n<p>Then it can be used truly for any type.  Examples:</p>\n\n<p><strong>Double</strong></p>\n\n<pre><code>double array[ARBITRARY_SIZE], x = 0.5 ;\narray_fill( array, ARBITRARY_SIZE, &amp;x, sizeof(x) );\n</code></pre>\n\n<p><strong>int</strong></p>\n\n<pre><code>int array[ARBITRARY_SIZE], x = 123456 ;\narray_fill( array, ARBITRARY_SIZE, &amp;x, sizeof(x) );\n</code></pre>\n\n<p><strong>struct</strong></p>\n\n<pre><code>struct S{ int x; double f ; } array[ARBITRARY_SIZE], x = {1234, 0.5};\narray_fill( array, ARBITRARY_SIZE, &amp;x, sizeof(x) );\n</code></pre>\n\n<p><strong>2D array</strong></p>\n\n<pre><code>int array[ARBITRARY_SIZE][2], x[2] = { 12, 98 } ;\narray_fill( array, ARBITRARY_SIZE, &amp;x, sizeof(x) );\n</code></pre>\n\n<p>The implementation avoids endian issues, but cannot accept literal-constant initialisers, because you cannot take the address.</p>\n\n<p>This last implementation can be improved (simplified, and made more efficient); for example:</p>\n\n<pre><code>int array_fill( void* array, size_t array_length, \n                const void* fill_pattern, size_t fill_pattern_length )\n{\n    for( size_t i = 0, byte_index = 0; \n         i &lt; array_length; \n         i++, byte_index += fill_pattern_length )\n    {\n        memcpy( &amp;((char*)array)[byte_index], fill_pattern, fill_pattern_length ) ;\n    }\n\n  return 0; \n}\n</code></pre>\n\n<p>That's the version I'd go with.</p>\n"}, {"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 1, "last_activity_date": 1546989664, "last_edit_date": 1546989664, "creation_date": 1546989197, "answer_id": 54101089, "question_id": 54100578, "link": "https://stackoverflow.com/questions/54100578/is-there-any-way-to-pass-an-array-of-an-unknown-type-as-a-parameter-to-a-functio/54101089#54101089", "title": "Is there any way to pass an array of an unknown type as a parameter to a function in C?", "body": "<p>Too much like <a href=\"https://stackoverflow.com/a/54100679/2410359\">@Increasingly Idiotic</a> good answer.</p>\n\n<p>So I'll make this wiki. Useful as a reference.</p>\n\n<hr>\n\n<blockquote>\n  <p>Is there any way to pass an array of an unknown type as a parameter to a function in C?</p>\n</blockquote>\n\n<p>Yes code can call such a function with an array, yet the array will be converted to the address of the first element of the array.  It is that address the function will use.  </p>\n\n<pre><code>some_type a[N];\nfoo(a);\n</code></pre>\n\n<p>To make the function accept any array object type, the function parameter is <code>void *</code>.</p>\n\n<pre><code>int foo(void *address_of_first_element);\n</code></pre>\n\n<p>Unfortunately <code>foo()</code> has lost the type.  </p>\n\n<hr>\n\n<blockquote>\n  <p>Is there any way to achieve it?</p>\n</blockquote>\n\n<p>In OP's case, <code>array_fill()</code> only needs the size of the type and not the type itself.  So pass in the sizeof the type.</p>\n\n<p>OP sees the array size is needed and passes it - good.  What is also needed is the size of the element and a <em>pointer</em> to the fill value.</p>\n\n<p>To do pointer math, convert the <code>void*</code> to <code>char *</code> as pointer math on <code>void*</code> is not defined by C.</p>\n\n<pre><code>// int array_fill(void* array, int size, int data)\nint array_fill(void* array, size_t a_size, const char *fill, size_t e_size) {\n  char *data = array;\n  for(size_t a = 0; a &lt; a_size; a++) {\n    memcpy(data, fill, e_size);  // Copy `e_size` bytes.\n    data += e_size;              // Advance `e_size` bytes. \n  }\n  return 0; \n}\n\nint main(void) {\n  int array[ARBITRARY_SIZE], fill_value = 42;    \n  array_fill(array, array_length(array), &amp;fill_value, sizeof array[0]);\n\n  for(size_t i = 0; i &lt; array_length(array); i++) {\n    printf(\"array[%zu]: %d\\n\", i, *(array + i));\n  }\n\n  return 0;\n} \n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 10806574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e7bdf0ea824815c08589a3bdafc3107?s=128&d=identicon&r=PG&f=1", "display_name": "Albert", "link": "https://stackoverflow.com/users/10806574/albert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 516, "favorite_count": 0, "accepted_answer_id": 54101001, "answer_count": 5, "score": 1, "last_activity_date": 1546994882, "creation_date": 1546986074, "last_edit_date": 1592644375, "question_id": 54100578, "link": "https://stackoverflow.com/questions/54100578/is-there-any-way-to-pass-an-array-of-an-unknown-type-as-a-parameter-to-a-functio", "title": "Is there any way to pass an array of an unknown type as a parameter to a function in C?", "body": "<p>I've been trying to improve my skills and knowledge in C. Today I've tried to create a function that takes an array of any type, but I haven't found a successful way, I'm using ANSI C and I tried to pass it as a void pointer, but when I'm trying to go through the memory operating with the parameter, the compiler complains. Is there any way to achieve it? I was thinking that possibly it can be done through pre-processor directives, but I ain't sure.</p>\n<p>P.S: My aim isn't to fill the array with data, that's just a function, but to understand and learn how to pass data if I don't know its type, or allow my function to work with more than just one type of data.</p>\n<p>This is the output of the compilation process:</p>\n<blockquote>\n<p>array_test.c: In function 'array_fill':</p>\n<p>array_test.c:34:13: warning: pointer of type 'void *' used in arithmetic [-Wpointer-arith]</p>\n<p>*(array + i) = data;</p>\n<p>^</p>\n<p>array_test.c:34:5: warning: dereferencing 'void *' pointer</p>\n<p>*(array + i) = data;</p>\n<p>^~~~~~~~~~~~</p>\n<p>array_test.c:34:5: error: invalid use of void expression</p>\n<p>*(array + i) = data;</p>\n<p>^</p>\n</blockquote>\n<p>And this is my code:</p>\n<pre><code>#include &lt;stdio.h&gt;\n\n#define array_length(array) (sizeof(array)/sizeof(array[0]))\n\n#define ARBITRARY_SIZE 10    \n\ntypedef enum\n{\n  false,\n  true\n} bool;\n\nint array_fill(void*, int, int);\n\nint main(int argc, char* argv[])\n{\n  int array[ARBITRARY_SIZE];\n  int i;\n \n  array_fill(array, array_length(array), 0);\n\n  for(i = 0; i &lt; array_length(array); i++)\n  {\n    printf(&quot;array[%d]: %d\\n&quot;, i, *(array + i));\n  }\n\n  return 0;\n} \n\nint array_fill(void* array, int size, int data)\n{\n  int i;\n  \n  for(i = 0; i &lt; size; i++)\n  {\n    *(array + i) = data; \n  }\n\n  /*I will implement a check later, in case of errors.*/\n  return 0; \n}\n</code></pre>\n"}, {"tags": ["c", "malloc", "dynamic-memory-allocation"], "comments": [{"owner": {"reputation": 2445, "user_id": 3476780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/abf771bddcd864626a0e1499ccfc699b?s=128&d=identicon&r=PG&f=1", "display_name": "yano", "link": "https://stackoverflow.com/users/3476780/yano"}, "edited": false, "score": 2, "creation_date": 1546985927, "post_id": 54100524, "comment_id": 95033971, "body": "by doing <code>manufacture = &quot;Suzuki&quot;;</code> you&#39;re changing where <code>manufacture</code> points to a block of memory that was not <code>malloc</code>ed. You want to use <a href=\"https://linux.die.net/man/3/strcpy\" rel=\"nofollow noreferrer\"><code>strcpy</code></a> to store &quot;Suzuki&quot; in your newly <code>malloc</code>ed block. Also, always check the return of <code>malloc</code> to make sure it allocated memory for you."}], "answers": [{"tags": [], "owner": {"reputation": 33645, "user_id": 2630032, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hQF09.jpg?s=128&g=1", "display_name": "Stephan Lechner", "link": "https://stackoverflow.com/users/2630032/stephan-lechner"}, "is_accepted": false, "score": 4, "last_activity_date": 1546986018, "creation_date": 1546986018, "answer_id": 54100563, "question_id": 54100524, "link": "https://stackoverflow.com/questions/54100524/how-to-fix-pointer-being-freed-was-not-allocated/54100563#54100563", "title": "How to fix pointer being freed was not allocated", "body": "<p>Though you allocate memory with <code>malloc</code> and assign the address of this memory to a pointer, you overwrite this pointer in the second statement and let it point to a string literal. Note: with <code>manufacture = \"Suzuki\";</code>, the string literal is <em>not</em> copied into the memory block you reserved; you just let the pointer point to something different.</p>\n\n<p>Your code is actually doing something like <code>free(\"Suzuki\")</code>, which is clearly freeing something that has not been \"malloced\" before.</p>\n\n<p>Write...</p>\n\n<pre><code>char* manufacture = (char*)malloc(15*sizeof(char));\nstrcpy(manufacture,\"Suzuki\");\n...\nfree(manufacture);\n</code></pre>\n\n<p>and it should work.</p>\n"}, {"tags": [], "owner": {"reputation": 292, "user_id": 5661266, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/10205593199614644/picture?type=large", "display_name": "mmeisson", "link": "https://stackoverflow.com/users/5661266/mmeisson"}, "is_accepted": false, "score": 1, "last_activity_date": 1546986286, "creation_date": 1546986286, "answer_id": 54100613, "question_id": 54100524, "link": "https://stackoverflow.com/questions/54100524/how-to-fix-pointer-being-freed-was-not-allocated/54100613#54100613", "title": "How to fix pointer being freed was not allocated", "body": "<p>In fact, you are losing your allocated memory when you are doing</p>\n\n<pre><code>manufacture = \"Suzuki\";\n</code></pre>\n\n<p>Your string \"Suzuki\" here is an area of 7 bytes ( 6 + '\\0' ). And manufacture points to this area when you assign it like this.</p>\n\n<p>You can do something like this</p>\n\n<pre><code>manufacture = malloc(sizeof char * 7);\nif (manufacture != NULL)\n{\n    free(manufacture);\n}\n</code></pre>\n\n<p>( Yes, malloc can fail, check for errors )</p>\n\n<p>And then if you want to copy some data in the allocated area, you have to use functions like strcpy, strncpy, memcpy, etc. Here strcpy is the right tool :</p>\n\n<pre><code>manufacture = malloc(sizeof char * 7);\nif (manufacture != NULL)\n{\n    strcpy(manufacture, \"Suzuki\");\n    free(manufacture);\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10886752, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-H3KtZdIqMLg/AAAAAAAAAAI/AAAAAAABw8E/sZZ7h0jNL-M/photo.jpg?sz=128", "display_name": "Eden Rozenberg", "link": "https://stackoverflow.com/users/10886752/eden-rozenberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2528, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1547007047, "creation_date": 1546985816, "last_edit_date": 1547007047, "question_id": 54100524, "link": "https://stackoverflow.com/questions/54100524/how-to-fix-pointer-being-freed-was-not-allocated", "title": "How to fix pointer being freed was not allocated", "body": "<p>I'm trying to free space I allocated with the <code>malloc</code> function and yet every time I get this message: </p>\n\n<blockquote>\n  <p>\"malloc: *** error for object 0x7ffeefbff510: pointer being freed was\n  not allocated\"</p>\n</blockquote>\n\n<p>even though I clearly allocated it with <code>malloc()</code>.</p>\n\n<p>I've already tried sending <code>&amp; manufacture</code> and just <code>manufacture</code>. I am pretty new to the entire memory allocation.</p>\n\n<pre><code>char* manufacture = (char*)malloc(15*sizeof(char));   \nmanufacture = \"Suzuki\"; \n\nfree(manufacture);\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1546984746, "post_id": 54100323, "comment_id": 95033528, "body": "Is the exercise here to re-implement <code>strdup</code>? Just want to understand the goal."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 3, "creation_date": 1546984774, "post_id": 54100323, "comment_id": 95033537, "body": "Note: It&#39;s conventional to use <code>size_t</code> instead of <code>int</code> for lengths. This is an unsigned integer as obviously negative sizes don&#39;t make sense."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 6, "creation_date": 1546984840, "post_id": 54100323, "comment_id": 95033560, "body": "It also looks like you need to turn on way more warnings, even <code>-Wall</code>, as your <code>resize_memory</code> function does not return anything, yet promises to return <code>void*</code>. This code can&#39;t work until you <code>return d</code>."}, {"owner": {"reputation": 280, "user_id": 10817377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879d8990cccfc2856cf1ca6279a7afda?s=128&d=identicon&r=PG&f=1", "display_name": "I Funball", "link": "https://stackoverflow.com/users/10817377/i-funball"}, "edited": false, "score": 2, "creation_date": 1546984933, "post_id": 54100323, "comment_id": 95033604, "body": "Remember to free that memory!"}, {"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 5, "creation_date": 1546984986, "post_id": 54100323, "comment_id": 95033629, "body": "<code>resize_memory</code> should probably also copy the old buffer into the new one."}, {"owner": {"reputation": 1149, "user_id": 2472827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t5rYY.jpg?s=128&g=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/2472827/neil"}, "edited": false, "score": 1, "creation_date": 1546985716, "post_id": 54100323, "comment_id": 95033888, "body": "Ask yourself what exactly you want. I think you need a <code>char *join(const char *s, const char *t)</code>which allocates <code>strlen(s) + strlen(t) + 1</code> then copies <code>s</code> (minus null) and <code>t</code> into the buffer, perhaps using <code>memcpy</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2785628"}, "edited": false, "score": 1, "creation_date": 1546986390, "post_id": 54100323, "comment_id": 95034135, "body": "oh I know its a beginner problem for C. I&#39;m a beginner."}, {"owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "edited": false, "score": 0, "creation_date": 1546988064, "post_id": 54100323, "comment_id": 95034733, "body": "@chargerfan619 Are you looking to write a new function or modify one of the existing functions you posted here?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2785628"}, "edited": false, "score": 0, "creation_date": 1546989950, "post_id": 54100323, "comment_id": 95035277, "body": "I&#39;m trying to get printf(&quot;Full path string: %s\\n&quot;, new_url); to equal &quot;http:// website.com/&quot; by modifying resize_memory function"}, {"owner": {"reputation": 351, "user_id": 4604759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6de599df6671db42349c8b438ec7a350?s=128&d=identicon&r=PG&f=1", "display_name": "MiCo", "link": "https://stackoverflow.com/users/4604759/mico"}, "edited": false, "score": 0, "creation_date": 1546990770, "post_id": 54100323, "comment_id": 95035501, "body": "OK, strlen(const char*) is a library function, but what is string_length(char*)?"}, {"owner": {"reputation": 351, "user_id": 4604759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6de599df6671db42349c8b438ec7a350?s=128&d=identicon&r=PG&f=1", "display_name": "MiCo", "link": "https://stackoverflow.com/users/4604759/mico"}, "edited": false, "score": 0, "creation_date": 1546990837, "post_id": 54100323, "comment_id": 95035523, "body": "The function resize_memory does not pass back anything. Either you may want to change the return value from void to char* or you want to use a double pointer."}], "answers": [{"tags": [], "owner": {"reputation": 351, "user_id": 4604759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6de599df6671db42349c8b438ec7a350?s=128&d=identicon&r=PG&f=1", "display_name": "MiCo", "link": "https://stackoverflow.com/users/4604759/mico"}, "is_accepted": false, "score": 0, "last_activity_date": 1546990508, "creation_date": 1546990508, "answer_id": 54101255, "question_id": 54100323, "link": "https://stackoverflow.com/questions/54100323/joining-two-strings-with-malloc/54101255#54101255", "title": "joining two strings with Malloc", "body": "<p>Try something like</p>\n\n<pre><code>char *url = string_dup(\"http://\");\nchar *path = string_dup(\"website.com/\");\nsize_t sTotal = strlen(url) + strlen(path) + 1u;\nchar *pStr = malloc(sTotal);\nsnprintf(pStr, sTotal, \"%s%s\", url, path);\nfree(url);\nfree(path);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 920, "user_id": 5482045, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/930882390318811/picture?type=large", "display_name": "Nunchy", "link": "https://stackoverflow.com/users/5482045/nunchy"}, "is_accepted": false, "score": 0, "last_activity_date": 1546992933, "creation_date": 1546992933, "answer_id": 54101591, "question_id": 54100323, "link": "https://stackoverflow.com/questions/54100323/joining-two-strings-with-malloc/54101591#54101591", "title": "joining two strings with Malloc", "body": "<p>I played about with your code for a bit then came up with this solution. This allows you to get rid of that  <code>string_dup()</code> function and create a single function that can allocate/assign a new string and append an existing string with more data.</p>\n\n<pre><code>int\nappend_string(char **append_to, char *append_this) {\n    char    *tmp;\n\n    // You might want to check that append_this is not\n    // NULL...\n\n    if (*append_to == NULL) {\n        *append_to = malloc(strlen(append_this) + 1);\n        strcpy(*append_to, append_this);\n    }\n    else {\n        // Some data already exists on the append_to buffer...\n        //\n        // If you want to only use malloc() then make a temporary\n        // storage area and copy the append_to string there\n        //\n        if ((tmp = malloc(strlen(*append_to) + 1)) == NULL)\n            return -1;\n        strcpy(tmp, *append_to);\n\n        // Free up and re-allocate append_to.\n        //\n        free(*append_to);\n        *append_to = malloc(strlen(tmp) + strlen(append_this) + 1);\n\n        if (! append_to) {\n            fprintf(stderr, \"Malloc error...\");\n            exit(EXIT_FAILURE);\n        }\n\n        // Do it with realloc\n        //\n        // No temporary buffer required:\n        //\n        //      *append_to = realloc(\n        //          *append_to,\n        //          (strlen(append_to) + strlen(*append_this) + 1)\n        //      );\n        //      if (! eppend_to) ...realloc error\n\n        // Copy the data to the buffer and clean up.\n        //\n        sprintf(*append_to, \"%s%s\", tmp, append_this);\n        free(tmp);\n    }\n}\n\n\n/* In your main() or whatever... */\n\n    char *url = NULL;\n    char *path = NULL;\n\n    // Since url and path are both NULL the\n    // append string function will act like\n    // your string_dup() function...\n    append_string(&amp;url, \"http://\");\n    append_string(&amp;path, \"website.com/\");\n\n    // And not that url is not null it will be\n    // resized and the path appended.\n    append_string(&amp;url, path);\n\n    fprintf(stdout, \"URL: %s\\n\", url);\n\n    // Some housekeeping....\n    if (url) free(url);\n    if (path) free(path);\n}\n</code></pre>\n\n<p>Hope it's useful, I know it's kinda way off from what you originally had but thought I'd play along!</p>\n"}, {"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 2, "last_activity_date": 1547002741, "last_edit_date": 1547002741, "creation_date": 1547001351, "answer_id": 54102539, "question_id": 54100323, "link": "https://stackoverflow.com/questions/54100323/joining-two-strings-with-malloc/54102539#54102539", "title": "joining two strings with Malloc", "body": "<p>Trouble with OP's code:</p>\n\n<p><strong>Wrong size</strong></p>\n\n<p>Assuming <code>string_length()</code> is like <code>strlen()</code>.</p>\n\n<pre><code>// int new_length = url_length - 1 + path_length;\nint new_length = url_length + 1 + path_length;\n</code></pre>\n\n<p><strong>Ineffective resize</strong></p>\n\n<pre><code>void *resize_memory(void *ptr, int old_size, int new_size) {\n    char *d = (char*)ptr; // assign `d`\n    d = malloc(new_size); // Why re-assigned `d`???\n    // No use of old_size, new_size\n    // No copying of existing data \n    // No freeing of old allocation  \n}\n</code></pre>\n\n<p>I'd expect something like</p>\n\n<pre><code>// return failure status\nbool resize_memory(void **ptr_addr, size_t old_size, size_t new_size) {\n  void *new_ptr = NULL;\n  if (new_size &gt; 0) {\n    new_ptr = malloc(new_size);\n    if (new_ptr) {  // Out of memory, leave *ptr_addr alone\n      return true;\n    }\n    size_t min_size = old_size &lt; new_size ? old_size : new_size;\n    memcpy(new_ptr, *ptr_addr, min_size);\n  }\n  free(*ptr_addr);\n  *ptr_addr = new_ptr;  \n  return false;\n}\n</code></pre>\n\n<hr>\n\n<p>Ways to join strings with <code>realloc()</code> with allocation.</p>\n\n<ol>\n<li>Find lengths.</li>\n<li>Allocate memory.</li>\n<li>If successful, copy the first and then the second string.  Append a \\0.</li>\n</ol>\n\n<p>Sample code:</p>\n\n<pre><code>// s1, s2 may be NULL.  A NULL is treated as if \"\"\nchar *JoinStrings(const char *s1, const char *s2) {\n  size_t len1 = s1 ? strlen(s1) : 0;\n  size_t len2 = s2 ? strlen(s2) : 0;\n  char *joined = malloc(len1 + len2 + 1);\n  if (joined) {\n    memcpy(joined, s1, len1);\n    memcpy(joined + len1, s2, len2);\n    joined[len1 + len2] = '\\0';\n  }\n  return joined;\n}\n</code></pre>\n\n<p>Or via <code>snprintf()</code></p>\n\n<pre><code>char *JoinStrings(const char *s1, const char *s2) {\n  size_t sz = (s1 ? strlen(s1) : 0) + (s2 ? strlen(s2) : 0) + 1;\n  char *joined = malloc(sz);\n  if (joined) {\n    int len = snprintf(joined, sz, \"%s%s\", s1, s2);\n    assert(len &gt;= 0 &amp;&amp; (unsigned) len &lt; sz);  // Failure is very unexpected here.\n  }\n  return joined;\n}\n</code></pre>\n\n<p>To concatenate like (*s1) += s2</p>\n\n<pre><code>// *s1 is a prior allocated string, or NULL\n void ConcatenateString(char **s1, const char *s2) {\n  char *joined = JoinStrings(*s1, s2);\n  free(*s1);\n  *s1 = joined;\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2785628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1547002741, "creation_date": 1546984592, "last_edit_date": 1546987867, "question_id": 54100323, "link": "https://stackoverflow.com/questions/54100323/joining-two-strings-with-malloc", "title": "joining two strings with Malloc", "body": "<p>I have been working through a beginner C problem to try and learn the basics of C. I noticed the problem below will start at the index of where the last string takes off and will finish that string, but what I'm trying to do is join the two strings together. </p>\n\n<p>Can anyone point me in the right direction?  I'm trying to do this without realloc for learning xp.</p>\n\n<pre><code>char *string_dup(char *src)\n{\n  int len = strlen(src);\n  char *src2 = malloc(len + 1);\n  int i;\n  for(i = 0; i &lt; len; i++){\n    *(src2 + i) = *(src + i);\n  }\n  *(src2 + len )='\\0';\n  return src2;\n}\n\nvoid *resize_memory(void *ptr, int old_size, int new_size)\n{\n    char *d = (char*)ptr;\n    d = malloc(new_size);\n}\n\n\nchar *url = string_dup(\"http://\");\nchar *path = string_dup(\"website.com/\");\nint url_length = string_length(url);\nint path_length = string_length(path);\n\nint new_length = url_length - 1 + path_length;\nchar *new_url = resize_memory(url, url_length, new_length);\nchar *p = new_url + url_length;\n\n\nwhile (*path != '\\0') {\n    *p = *path;\n    p++;\n    path++;\n}\n\nprintf(\"Full path string: %s\\n\", new_url);\n</code></pre>\n"}, {"tags": ["c", "pointers"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 2, "creation_date": 1546984876, "post_id": 54100264, "comment_id": 95033573, "body": "A <code>%d</code> directive should never be used to attempt to print the address of anything.  To print an address (a.k.a. the value of a pointer), conforming code must use the <code>%p</code> directive."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10600929"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1546985461, "post_id": 54100264, "comment_id": 95033806, "body": "Is there a specific reason behind this fact?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1546987990, "post_id": 54100264, "comment_id": 95034711, "body": "Yes, @Sami.  For one, the language spec says so.  For another, integers and pointers do not necessarily have the same representation.  In fact, it is typical for them to have different representations on 64-bit machines, but their representations may differ on other machines, too.  <code>printf()</code> cannot know the types of its variable arguments <i>a priori</i>; it must discern how to interpret them by examining the format string.  If the directives in the format string do not correspond properly to the actual types of the arguments then all bets are off (the behavior is undefined)."}], "owner": {"user_type": "does_not_exist", "display_name": "user10600929"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "closed_date": 1546984977, "answer_count": 0, "score": 0, "last_activity_date": 1546985100, "creation_date": 1546984338, "question_id": 54100264, "link": "https://stackoverflow.com/questions/54100264/what-is-the-functionality-of-q2-type-of-pointers", "closed_reason": "Duplicate", "title": "What is the functionality of (*q)[2] type of pointers?", "body": "<pre><code>main()\n{\n    int s[5][2] = {\n    { 1234, 56 },\n    { 1212, 33 },\n    { 1434, 80 },\n    { 1312, 78 }\n    } ;\n\n    int (*q)[2];\n    q=(&amp;s[0]+1);\n    printf(\"%d %d\",q,*q);\n}\n</code></pre>\n\n<p>And the result is the same for both %d. \nAccording to me what should be printed is the address of 1212 (2nd row, 1st column) and then 1212. But rather **q prints 1212. What's going on here?</p>\n"}, {"tags": ["c", "stm32", "keil", "cubemx"], "comments": [{"owner": {"reputation": 6676, "user_id": 3716664, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fN14n.png?s=128&g=1", "display_name": "tilz0R", "link": "https://stackoverflow.com/users/3716664/tilz0r"}, "edited": false, "score": 1, "creation_date": 1546983752, "post_id": 54099705, "comment_id": 95033109, "body": "Do you test every day at 10:00? Are your NVIC interrupts enabled in software? Please debug the code."}, {"owner": {"reputation": 1237, "user_id": 1256234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/8hkBI.png?s=128&g=1", "display_name": "Andy J", "link": "https://stackoverflow.com/users/1256234/andy-j"}, "edited": false, "score": 0, "creation_date": 1546991295, "post_id": 54099705, "comment_id": 95035629, "body": "You may want to consider the pros and cons of HAL vs SPL.  CubeMX auto-generates a lot of code for you, but SPL has been around longer and is more stable.  Something worth reading: <a href=\"https://blog.domski.pl/spl-vs-hal-which-one-should-you-use/\" rel=\"nofollow noreferrer\">blog.domski.pl/spl-vs-hal-which-one-should-you-use</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 10886461, "user_type": "registered", "profile_image": "https://graph.facebook.com/2380035825388539/picture?type=large", "display_name": "Wojciech Rogman", "link": "https://stackoverflow.com/users/10886461/wojciech-rogman"}, "is_accepted": true, "score": 0, "last_activity_date": 1547157709, "creation_date": 1547157709, "answer_id": 54137548, "question_id": 54099705, "link": "https://stackoverflow.com/questions/54099705/stm32-rtc-default-interruption-doesnt-work-cubemx-config/54137548#54137548", "title": "STM32 RTC Default Interruption Doesn&#39;t Work, CubeMX Config", "body": "<p>I found the mistake. I made typo in Interruption void.... Thx.</p>\n"}], "owner": {"reputation": 1, "user_id": 10886461, "user_type": "registered", "profile_image": "https://graph.facebook.com/2380035825388539/picture?type=large", "display_name": "Wojciech Rogman", "link": "https://stackoverflow.com/users/10886461/wojciech-rogman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 945, "favorite_count": 0, "accepted_answer_id": 54137548, "answer_count": 1, "score": 0, "last_activity_date": 1547157709, "creation_date": 1546981571, "last_edit_date": 1546998731, "question_id": 54099705, "link": "https://stackoverflow.com/questions/54099705/stm32-rtc-default-interruption-doesnt-work-cubemx-config", "title": "STM32 RTC Default Interruption Doesn&#39;t Work, CubeMX Config", "body": "<p>I'm starting with C &amp; STM but..\nI am using STM32L4476RG adn CubeMx and trying make a interruption by RTC clock e.g every day at 10 A.M (to blink LED or change some parameter's value at the beggining).</p>\n\n<p>My code does not work, although it is generated by CubeMx, interrupt support is enabled, and the action at the interrupt is very easy so it can not be a problem.</p>\n\n<pre><code>#include \"main.h\"\n#include \"stm32l4xx_hal.h\"\n\n\n#include \"stdlib.h\"\n\nRTC_HandleTypeDef hrtc;\n\nTIM_HandleTypeDef htim6;\n\nstatic int mode_counter;\nRTC_TimeTypeDef sTime;\nRTC_DateTypeDef sDate;\n\n\nvoid SystemClock_Config(void);\nstatic void MX_GPIO_Init(void);\nstatic void MX_TIM6_Init(void);\nstatic void MX_RTC_Init(void);\n\nvoid HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim); //procedura przerwania od licznika\nvoid HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin); //procedura przerwania od BlueButton\nint Random_Number(int min, int max); //funkcja losujaca liczbe pseudolosowa z zakresu &lt;min; max&gt;\nvoid HAT_RTC_AlarmAEventCallback(RTC_HandleTypeDef *hrtc); //RTC Alarm procedura\n\n\nint main(void)\n{\n\n\n  HAL_Init();\n\n\n  SystemClock_Config();\n\n  MX_GPIO_Init();\n  MX_TIM6_Init();\n  MX_RTC_Init();\n\n  /* USER CODE BEGIN 2 */\nHAL_TIM_Base_Start_IT(&amp;htim6); \n\n  while (1)\n  {\n\n    HAL_RTC_GetTime(&amp;hrtc, &amp;sTime, RTC_FORMAT_BIN);  \n    HAL_RTC_GetDate(&amp;hrtc, &amp;sDate, RTC_FORMAT_BIN);\n    HAL_Delay(1000);\n\n  }\n\n\n}\n\n\nvoid SystemClock_Config(void)\n{\n\n  RCC_OscInitTypeDef RCC_OscInitStruct;\n  RCC_ClkInitTypeDef RCC_ClkInitStruct;\n  RCC_PeriphCLKInitTypeDef PeriphClkInit;\n\n  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI|RCC_OSCILLATORTYPE_LSI;\n  RCC_OscInitStruct.HSIState = RCC_HSI_ON;\n  RCC_OscInitStruct.HSICalibrationValue = 16;\n  RCC_OscInitStruct.LSIState = RCC_LSI_ON;\n  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;\n  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSI;\n  RCC_OscInitStruct.PLL.PLLN = 25;\n  RCC_OscInitStruct.PLL.PLLP = RCC_PLLP_DIV7;\n  RCC_OscInitStruct.PLL.PLLQ = RCC_PLLQ_DIV2;\n  RCC_OscInitStruct.PLL.PLLR = RCC_PLLR_DIV4;\n  if (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)\n  {\n    _Error_Handler(__FILE__, __LINE__);\n  }\n\n\n  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK\n                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;\n  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;\n  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;\n  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;\n  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;\n\n  if (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_2) != HAL_OK)\n  {\n    _Error_Handler(__FILE__, __LINE__);\n  }\n\n  PeriphClkInit.PeriphClockSelection = RCC_PERIPHCLK_RTC;\n  PeriphClkInit.RTCClockSelection = RCC_RTCCLKSOURCE_LSI;\n  if (HAL_RCCEx_PeriphCLKConfig(&amp;PeriphClkInit) != HAL_OK)\n  {\n    _Error_Handler(__FILE__, __LINE__);\n  }\n\n\n  if (HAL_PWREx_ControlVoltageScaling(PWR_REGULATOR_VOLTAGE_SCALE1) != HAL_OK)\n  {\n    _Error_Handler(__FILE__, __LINE__);\n  }\n\n\n  HAL_SYSTICK_Config(HAL_RCC_GetHCLKFreq()/1000);\n\n\n  HAL_SYSTICK_CLKSourceConfig(SYSTICK_CLKSOURCE_HCLK);\n\n  HAL_NVIC_SetPriority(SysTick_IRQn, 0, 0);\n}\n\n\nstatic void MX_RTC_Init(void)\n{\n  RTC_AlarmTypeDef sAlarm;\n\n  hrtc.Instance = RTC;\n  hrtc.Init.HourFormat = RTC_HOURFORMAT_24;\n  hrtc.Init.AsynchPrediv = 127;\n  hrtc.Init.SynchPrediv = 255;\n  hrtc.Init.OutPut = RTC_OUTPUT_DISABLE;\n  hrtc.Init.OutPutRemap = RTC_OUTPUT_REMAP_NONE;\n  hrtc.Init.OutPutPolarity = RTC_OUTPUT_POLARITY_HIGH;\n  hrtc.Init.OutPutType = RTC_OUTPUT_TYPE_OPENDRAIN;\n  if (HAL_RTC_Init(&amp;hrtc) != HAL_OK)\n  {\n    _Error_Handler(__FILE__, __LINE__);\n  }\n\n\n  if(HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR0) != 0x32F2){\n  sTime.Hours = 10;\n  sTime.Minutes = 0;\n  sTime.Seconds = 0;\n  sTime.DayLightSaving = RTC_DAYLIGHTSAVING_NONE;\n  sTime.StoreOperation = RTC_STOREOPERATION_RESET;\n  if (HAL_RTC_SetTime(&amp;hrtc, &amp;sTime, RTC_FORMAT_BIN) != HAL_OK)\n  {\n    _Error_Handler(__FILE__, __LINE__);\n  }\n\n  sDate.WeekDay = RTC_WEEKDAY_MONDAY;\n  sDate.Month = RTC_MONTH_JANUARY;\n  sDate.Date = 1;\n  sDate.Year = 19;\n\n  if (HAL_RTC_SetDate(&amp;hrtc, &amp;sDate, RTC_FORMAT_BIN) != HAL_OK)\n  {\n    _Error_Handler(__FILE__, __LINE__);\n  }\n\n    HAL_RTCEx_BKUPWrite(&amp;hrtc,RTC_BKP_DR0,0x32F2);\n  }\n\n  sAlarm.AlarmTime.Hours = 10;\n  sAlarm.AlarmTime.Minutes = 0;\n  sAlarm.AlarmTime.Seconds = 30;\n  sAlarm.AlarmTime.SubSeconds = 0;\n  sAlarm.AlarmTime.DayLightSaving = RTC_DAYLIGHTSAVING_NONE;\n  sAlarm.AlarmTime.StoreOperation = RTC_STOREOPERATION_RESET;\n  sAlarm.AlarmMask = RTC_ALARMMASK_DATEWEEKDAY;\n  sAlarm.AlarmSubSecondMask = RTC_ALARMSUBSECONDMASK_ALL;\n  sAlarm.AlarmDateWeekDaySel = RTC_ALARMDATEWEEKDAYSEL_WEEKDAY;\n  sAlarm.AlarmDateWeekDay = 1;\n  sAlarm.Alarm = RTC_ALARM_A;\n  if (HAL_RTC_SetAlarm_IT(&amp;hrtc, &amp;sAlarm, RTC_FORMAT_BIN) != HAL_OK)\n  {\n    _Error_Handler(__FILE__, __LINE__);\n  }\n\n}\n\n\nstatic void MX_TIM6_Init(void)\n{\n\n  TIM_MasterConfigTypeDef sMasterConfig;\n\n  htim6.Instance = TIM6;\n  htim6.Init.Prescaler = 2000;\n  htim6.Init.CounterMode = TIM_COUNTERMODE_UP;\n  htim6.Init.Period = 49999;\n  htim6.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;\n  if (HAL_TIM_Base_Init(&amp;htim6) != HAL_OK)\n  {\n    _Error_Handler(__FILE__, __LINE__);\n  }\n\n  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;\n  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;\n  if (HAL_TIMEx_MasterConfigSynchronization(&amp;htim6, &amp;sMasterConfig) != HAL_OK)\n  {\n    _Error_Handler(__FILE__, __LINE__);\n  }\n\n}\n\nstatic void MX_GPIO_Init(void)\n{\n\n  GPIO_InitTypeDef GPIO_InitStruct;\n\n\n  __HAL_RCC_GPIOC_CLK_ENABLE();\n  __HAL_RCC_GPIOH_CLK_ENABLE();\n  __HAL_RCC_GPIOA_CLK_ENABLE();\n  __HAL_RCC_GPIOB_CLK_ENABLE();\n\n\n  HAL_GPIO_WritePin(LED_GPIO_Port, LED_Pin, GPIO_PIN_RESET);\n\n\n  HAL_GPIO_WritePin(GPIOC, GPIO_PIN_10, GPIO_PIN_RESET);\n\n  GPIO_InitStruct.Pin = BlueButton_Pin;\n  GPIO_InitStruct.Mode = GPIO_MODE_IT_RISING;\n  GPIO_InitStruct.Pull = GPIO_NOPULL;\n  HAL_GPIO_Init(BlueButton_GPIO_Port, &amp;GPIO_InitStruct);\n\n\n  GPIO_InitStruct.Pin = USART_TX_Pin|USART_RX_Pin;\n  GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;\n  GPIO_InitStruct.Pull = GPIO_NOPULL;\n  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_VERY_HIGH;\n  GPIO_InitStruct.Alternate = GPIO_AF7_USART2;\n  HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);\n\n\n  GPIO_InitStruct.Pin = LED_Pin;\n  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;\n  GPIO_InitStruct.Pull = GPIO_NOPULL;\n  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;\n  HAL_GPIO_Init(LED_GPIO_Port, &amp;GPIO_InitStruct);\n\n\n  GPIO_InitStruct.Pin = GPIO_PIN_10;\n  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;\n  GPIO_InitStruct.Pull = GPIO_NOPULL;\n  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;\n  HAL_GPIO_Init(GPIOC, &amp;GPIO_InitStruct);\n\n\n  HAL_NVIC_SetPriority(EXTI15_10_IRQn, 0, 0);\n  HAL_NVIC_EnableIRQ(EXTI15_10_IRQn);\n\n}\n\n\nvoid HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)\n{\n if(htim-&gt;Instance == TIM6) \n    { \n        int _temp=Random_Number(1, htim6.Init.Period/2);\n        HAL_GPIO_TogglePin(GPIOC, GPIO_PIN_10); //buzzer\n\n        TIM6-&gt;ARR =(TIM6-&gt;ARR) +_temp;\n    }\n}\nvoid HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)\n{\n    if (GPIO_Pin == BlueButton_Pin)\n        {\n        if (HAL_GPIO_ReadPin(BlueButton_GPIO_Port, BlueButton_Pin)==GPIO_PIN_SET)\n            {\n            mode_counter=mode_counter+1;\n                switch(mode_counter)\n                {\n                    case 1: TIM6-&gt;PSC = htim6.Init.Prescaler*2; \n                        break;\n                    case 2: TIM6-&gt;PSC = htim6.Init.Prescaler*4;\n                        break;\n                    default: TIM6-&gt;PSC = htim6.Init.Prescaler; \n                                     mode_counter=0;\n                        break;\n                }\n            }\n        }\n}\n\nint Random_Number (int min, int max)\n{\n  int tmp;\n  if (max&gt;=min)\n    {\n  max-= min;\n    }\nelse\n {\n   tmp= min - max;\n   min= max;\n   max= tmp;\n }\nreturn max ? (rand() % max + min) : min;\n}\n\nvoid HAT_RTC_AlarmAEventCallback(RTC_HandleTypeDef *hrtc) // przerwanie od alarmu rtc\n{\n    HAL_GPIO_WritePin(LED_GPIO_Port, LED_Pin, GPIO_PIN_SET);\n    mode_counter=2;\n}\n\nvoid _Error_Handler(char * file, int line)\n{\n\n  while(1) \n  {\n  }\n\n}\n\n#ifdef USE_FULL_ASSERT\n\nvoid assert_failed(uint8_t* file, uint32_t line)\n{\n\n\n}\n\n#endif\n</code></pre>\n"}, {"tags": ["c", "struct", "malloc", "realloc"], "comments": [{"owner": {"reputation": 2723, "user_id": 9017315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3229c3b31dc467c858d3d27f88c41c11?s=128&d=identicon&r=PG&f=1", "display_name": "Osiris", "link": "https://stackoverflow.com/users/9017315/osiris"}, "edited": false, "score": 0, "creation_date": 1546981380, "post_id": 54099611, "comment_id": 95032116, "body": "OT: You should not hide a pointer behind a <code>typedef</code>."}, {"owner": {"reputation": 2723, "user_id": 9017315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3229c3b31dc467c858d3d27f88c41c11?s=128&d=identicon&r=PG&f=1", "display_name": "Osiris", "link": "https://stackoverflow.com/users/9017315/osiris"}, "edited": false, "score": 0, "creation_date": 1546981437, "post_id": 54099611, "comment_id": 95032140, "body": "Since <code>res-&gt;term</code> is of type <code>double *</code>, a pointer to double, you get the size of a pointer to double."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 2, "creation_date": 1546981586, "post_id": 54099611, "comment_id": 95032209, "body": "<code>realloc(5 * sizeof(double))</code> -- This does not have enough arguments for the call to the <code>realloc</code> function."}, {"owner": {"reputation": 141, "user_id": 7731733, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4326673ebb8b37ec113a5b7d17afce92?s=128&d=identicon&r=PG&f=1", "display_name": "homior", "link": "https://stackoverflow.com/users/7731733/homior"}, "edited": false, "score": 0, "creation_date": 1546981854, "post_id": 54099611, "comment_id": 95032322, "body": "Oh yeah, I forgot to add the pointer res-&gt;term as first argument. I just tried to write the code which is important for my question, so i rewrited it here and forgot to add the pointer."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1546984039, "post_id": 54099611, "comment_id": 95033221, "body": "It is incorrect to pass <code>res-&gt;term</code> as the first argument of <code>realloc()</code> until it has been assigned a value.  Your <code>malloc()</code> doesn&#39;t do that.  If you&#39;ve been extra good this year, it might happen to give you a block of memory in which the bytes corresponding to <code>term</code> happen to represent a null pointer.  In that case, your <code>realloc()</code> probably does what you want.  But do yourself a favor and either expicitly set <code>res-&gt;term</code> to <code>NULL</code> or <code>malloc()</code> the memory, not <code>realloc()</code>, the first time you assign a value to that member."}], "answers": [{"tags": [], "owner": {"reputation": 12296, "user_id": 452752, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a68d17cbd12e477e4a67745bd5b2452b?s=128&d=identicon&r=PG", "display_name": "Nickolay Olshevsky", "link": "https://stackoverflow.com/users/452752/nickolay-olshevsky"}, "is_accepted": true, "score": 2, "last_activity_date": 1546981444, "creation_date": 1546981444, "answer_id": 54099670, "question_id": 54099611, "link": "https://stackoverflow.com/questions/54099611/how-to-realloc-an-array-of-double-inside-a-struct/54099670#54099670", "title": "how to realloc an array of double inside a struct", "body": "<p><code>sizeof(res-&gt;term)</code> returns size of the pointer, not of the allocated memory.\nYou need to track manually the allocated amount, i.e. by res->size * sizeof(*term) or something similar.</p>\n"}, {"tags": [], "owner": {"reputation": 6673, "user_id": 4213662, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/693430827/picture?type=large", "display_name": "Persixty", "link": "https://stackoverflow.com/users/4213662/persixty"}, "is_accepted": false, "score": 2, "last_activity_date": 1547040559, "last_edit_date": 1547040559, "creation_date": 1546982972, "answer_id": 54099992, "question_id": 54099611, "link": "https://stackoverflow.com/questions/54099611/how-to-realloc-an-array-of-double-inside-a-struct/54099992#54099992", "title": "how to realloc an array of double inside a struct", "body": "<p>First you don't want this:</p>\n\n<pre><code>Polynom res = malloc(sizeof(struct PolynomStruct));\nres-&gt;size = 10;\n</code></pre>\n\n<p>You've allocated space for the struct but not initialised the <code>term</code> pointer you want:</p>\n\n<pre><code>Polynom res = malloc(sizeof(struct PolynomStruct));\nif(res==NULL){\n  //Handle allocation failure...\n}\nres_&gt;term=NULL;\nres-&gt;size = 0;\n\n//Later....\nfree(res-&gt;term);\nfree(res);\n</code></pre>\n\n<p>That allocates space for the <code>struct</code> and initialises the array as empty.\nNotice it's fine to pass <code>NULL</code> to <code>free()</code> it does nothing and returns normally.</p>\n\n<p>Or if you did want to preallocate 10 terms:</p>\n\n<pre><code>Polynom res = malloc(sizeof(struct PolynomStruct));\nif(res==NULL){\n  //Handle allocation failure...\n}\nres-&gt;size = 10;\nres_&gt;term=malloc(res-&gt;size*sizeof(double));\nif(res-&gt;term==NULL){\n  res-&gt;size=0;\n  //Handle error...\n}\n\n//Later (when finished with res)...\nfree(res-&gt;term);\nfree(res);\n</code></pre>\n\n<p>That preallocates the array to being 10. If you preallocate you may want to track a <code>capac</code> (how much is allocated) and <code>size</code> (how much is used). But that's beyond the scope here.</p>\n\n<p>To reallocate write a function ike this:</p>\n\n<pre><code>int reallocate(Polynom res,int newsize){\n    double *resized=realloc(res-&gt;term,newsize*sizeof(double));\n    if (resize==NULL){\n      //Allocation failed. The array is the same size as before.\n      return 1; //Or handle error your own way.\n    }\n    res-&gt;term=resized;\n    res-&gt;size=newsize;\n    //realloc may extend the space allocated in place or realloc space elsewhere.\n    //If it does reallocate elsewhere the current contents are just copied over \n    //(byte for byte) and the old space freed. \n    return 0;//Success. No error.\n}\n\n\n//Later (when finished with res)...\nfree(res-&gt;term);\nfree(res);\n</code></pre>\n\n<p>It's often wise to then <code>res=NULL;</code> to avoid confusing mishaps.</p>\n\n<p>Notice if a pointer was returned by <code>malloc</code> or <code>realloc</code> (and not <code>NULL</code>) it must go to <code>free()</code> (exactly once). </p>\n\n<p>Also notice <code>realloc</code> can reduce the size so <code>newsize &lt; res-&gt;size</code> is fine. </p>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 9336582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avsOc.jpg?s=128&g=1", "display_name": "Schwinn Zhang", "link": "https://stackoverflow.com/users/9336582/schwinn-zhang"}, "is_accepted": false, "score": 0, "last_activity_date": 1546996001, "last_edit_date": 1546996001, "creation_date": 1546995554, "answer_id": 54101869, "question_id": 54099611, "link": "https://stackoverflow.com/questions/54099611/how-to-realloc-an-array-of-double-inside-a-struct/54101869#54101869", "title": "how to realloc an array of double inside a struct", "body": "<p>I feel there might be some confusion over pointer vs array. Please read this helpful article: <a href=\"https://eli.thegreenplace.net/2009/10/21/are-pointers-and-arrays-equivalent-in-c\" rel=\"nofollow noreferrer\">Are pointers and arrays equivalent in C?</a> </p>\n\n<p>You don't \"change the size of an array inside a struct\" because the whole point of having a struct is keeping things stable. Therefore, Polynom res = malloc(sizeof(struct PolynomStruct)) will always allocate the same amount of memo on the heap for res. </p>\n\n<p>If you want to build a heap array of doubles and points term to it, you can do:</p>\n\n<pre><code>int member=10; // grow array size by member=member*2 for example\ndouble a[]=malloc(member*sizeof(double));\nterm=a; \n</code></pre>\n\n<p>This way, you can dynamically grow your array. </p>\n"}], "owner": {"reputation": 141, "user_id": 7731733, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4326673ebb8b37ec113a5b7d17afce92?s=128&d=identicon&r=PG&f=1", "display_name": "homior", "link": "https://stackoverflow.com/users/7731733/homior"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 54099670, "answer_count": 3, "score": 0, "last_activity_date": 1547040559, "creation_date": 1546981245, "last_edit_date": 1546981435, "question_id": 54099611, "link": "https://stackoverflow.com/questions/54099611/how-to-realloc-an-array-of-double-inside-a-struct", "title": "how to realloc an array of double inside a struct", "body": "<p>I would like to dynamically change the size of an array inside a struct.\nI got the following structure:</p>\n\n<pre><code>struct PolynomStruct {\n  double * term;\n  unsigned int size;\n};\n\ntypedef struct PolynomStruct *Polynom;\n</code></pre>\n\n<p>When I try to create a new Polynom I have to reserve memory for the struct to use the variables inside the struct, right?:</p>\n\n<pre><code>Polynom res = malloc(sizeof(struct PolynomStruct));\nres-&gt;size = 10;\n</code></pre>\n\n<p>Afterwards I want to add a double to the term array at index 4.\nSo it shall look like this [0,0,0,0,2.0000]. \nThe first thing I do is to reallocate the memory of the array.</p>\n\n<pre><code>  res-&gt;term = realloc(5 * sizeof(double));\n</code></pre>\n\n<p>In my opinion the sizeof(res->term) should be 5 * 8 bytes = 40 bytes.\nBut the following code returns 8.</p>\n\n<pre><code>printf(\"size term: %lu\\n\",sizeof(res-&gt;term));\n</code></pre>\n\n<p>\"size term: 8\"</p>\n\n<p>Afterwards I tried to do this:</p>\n\n<pre><code>res-&gt;term[4] = 2;\nprintf(\"%f\\n\",res-&gt;term[4] );\n</code></pre>\n\n<p>It prints \"2.000000\" to stdout. I really dont get how this works.\nI would be very happy if someone could give me a hint.\nSorry for my English.</p>\n"}, {"tags": ["ios", "c", "xcode"], "comments": [{"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 1, "creation_date": 1546989644, "post_id": 54099589, "comment_id": 95035207, "body": "It&#39;s not quite clear what the question is here. You have the path at line 2 (<code>ur</code>) which is usually what you want, and as a string at line 3 (&#39;imagePath&#39;). Don&#39;t forget to <code>CFRelease</code> <code>ur</code> and <code>imagePath</code>. The next two lines aren&#39;t related to getting the local file path. Those are trying to convert a CFString to a cstring (though there&#39;s no promise that <code>CFStringGetCStringPtr</code> will succeed). Is your real question &quot;how do I get cstrings out of CoreFoundation rather than just using CoreFoundation directly?&quot; Yes, entering and leaving CF has some overhead. Generally you should use CF directly."}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1546990889, "post_id": 54099589, "comment_id": 95035538, "body": "For example, if you just want to simply print out the result, <code>CFShow(ur)</code> would do that."}, {"owner": {"reputation": 29735, "user_id": 294884, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f8675693dfeb3908195657eb3a3fdda4?s=128&d=identicon&r=PG", "display_name": "Fattie", "link": "https://stackoverflow.com/users/294884/fattie"}, "reply_to_user": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1546993194, "post_id": 54099589, "comment_id": 95036090, "body": "@RobNapier - thanks for those excellent clarifying explanations  :O  Yes, I&#39;m needing a cstring and (in a word) I wondered if I was going about it very poorly ..."}, {"owner": {"reputation": 29735, "user_id": 294884, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f8675693dfeb3908195657eb3a3fdda4?s=128&d=identicon&r=PG", "display_name": "Fattie", "link": "https://stackoverflow.com/users/294884/fattie"}, "reply_to_user": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1546993267, "post_id": 54099589, "comment_id": 95036109, "body": "....... while at the same time, it seemed a bit of a convoluted way to get to a file path.  (I guess, I&#39;m simply &quot;wrong&quot; about that, there&#39;s no shorter code.)  Thanks!"}, {"owner": {"reputation": 486140, "user_id": 1187415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/LpTRB.png?s=128&g=1", "display_name": "Martin R", "link": "https://stackoverflow.com/users/1187415/martin-r"}, "edited": false, "score": 1, "creation_date": 1552733350, "post_id": 54099589, "comment_id": 97129289, "body": "If you need a \u201cnative C string representation\u201d e.g. for passing it to system calls (open, rename, ...) then <a href=\"https://developer.apple.com/documentation/corefoundation/1541515-cfurlgetfilesystemrepresentation\" rel=\"nofollow noreferrer\">CFURLGetFileSystemRepresentation</a> would be the right tool."}, {"owner": {"reputation": 29735, "user_id": 294884, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f8675693dfeb3908195657eb3a3fdda4?s=128&d=identicon&r=PG", "display_name": "Fattie", "link": "https://stackoverflow.com/users/294884/fattie"}, "reply_to_user": {"reputation": 486140, "user_id": 1187415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/LpTRB.png?s=128&g=1", "display_name": "Martin R", "link": "https://stackoverflow.com/users/1187415/martin-r"}, "edited": false, "score": 0, "creation_date": 1552745899, "post_id": 54099589, "comment_id": 97132784, "body": "That&#39;s a fantastic tip in many situations @MartinR , thanks again"}], "answers": [{"tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 2, "last_activity_date": 1547046758, "last_edit_date": 1547046758, "creation_date": 1547045904, "answer_id": 54112911, "question_id": 54099589, "link": "https://stackoverflow.com/questions/54099589/in-ios-in-pure-c-is-this-the-way-to-get-a-local-file-path/54112911#54112911", "title": "in iOS, in pure C, is this the way to get a local file path?", "body": "<p>Your code actually isn't quite long enough, and has a few minor mistakes:</p>\n\n<ul>\n<li>You must <code>CFRelease</code> all the objects you own. You might be doing this elsewhere, but that's not obvious from the code.</li>\n<li><code>CFStringGetCStringPtr</code> is not promised to return a value. It only returns a value if the string is already internally stored in the format you want. That's <em>probably</em> true in this code on every system it would likely actually run on, but it's not safe CoreFoundation practice.</li>\n<li>Similarly, it is not safe to pass the result of <code>CFStringGetSystemEncoding</code> to <code>CFStringGetCStringPtr</code>, since the latter requires an 8-bit encoding. This isn't promised, but....</li>\n<li><code>CFStringGetSystemEncoding</code> is almost never needed or appropriate anyway. You probably don't actually want MacRoman (which is what you're probably getting, unless you're perhaps configured for MacJapanese). You probably want UTF8, so you should ask for that.</li>\n</ul>\n\n<p>So this is how you would do that:</p>\n\n<pre><code>CFBundleRef mb = CFBundleGetMainBundle();\nCFURLRef ur = CFBundleCopyResourceURL(mb, CFSTR(\"blah\"), CFSTR(\"txt\"), NULL);\nCFStringRef imagePath = CFURLCopyFileSystemPath(ur, kCFURLPOSIXPathStyle);\n\n// Now convert to a C-string\nCFStringEncoding encoding = kCFStringEncodingUTF8;\nCFIndex length = CFStringGetLength(imagePath);\nCFIndex maxSize = CFStringGetMaximumSizeForEncoding(length, encoding);\n\nchar *filename = (char *)malloc(maxSize + 1); // +1 for \\0\n\n// Technically this can fail, but it really, really can't.\nCFStringGetCString(imagePath, filename, maxSize, encoding);\n\nprintf( \"\\n we did it! .. %s \\n\", filename );\n\n// Cleanup\nfree(filename); filename = NULL;\nCFRelease(imagePath); imagePath = NULL;\nCFRelease(ur); ur = NULL;\n</code></pre>\n\n<p>You may find the <a href=\"https://github.com/iosptl/ios7ptl/blob/master/ch10-CoreFoundation/CoreFoundation/MYStringConversion.c\" rel=\"nofollow noreferrer\">MYStringConversion</a> functions helpful. <code>MYCFStringCopyUTF8String</code> returns you a malloc buffer (i.e. you need to <code>free</code> it) containing the cstring. (These come from Chapter 10 of iOS Programming: Pushing the Limits.)</p>\n\n<p>One side note on string buffers. People are often tempted to use buffers based on <code>PATH_MAX</code>. Keep in mind that macOS permits paths with names much longer than <code>PATH_MAX</code>. I'm not aware of any hard limit on the length of a macOS path string. In practice, few real paths exceed <code>PATH_MAX</code>, but when you create one, it's entertaining (not actually entertaining) to see how many pieces of software break.</p>\n\n<p>Note that as a rule this code isn't necessary. In most CoreFoundation projects, you just use <code>ur</code> directly and it's quite nice compared to working on raw cstrings.</p>\n"}], "owner": {"reputation": 29735, "user_id": 294884, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f8675693dfeb3908195657eb3a3fdda4?s=128&d=identicon&r=PG", "display_name": "Fattie", "link": "https://stackoverflow.com/users/294884/fattie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 54112911, "answer_count": 1, "score": 2, "last_activity_date": 1547817873, "creation_date": 1546981110, "last_edit_date": 1546993741, "question_id": 54099589, "link": "https://stackoverflow.com/questions/54099589/in-ios-in-pure-c-is-this-the-way-to-get-a-local-file-path", "title": "in iOS, in pure C, is this the way to get a local file path?", "body": "<p>I need to end up with a cstring ... being the local path to a file in the bundle.</p>\n\n<p>First,</p>\n\n<pre><code>#include &lt;CoreFoundation/CoreFoundation.h&gt;\n</code></pre>\n\n<p>(which is pure C right? .. you can't use Foundation)</p>\n\n<p>and then</p>\n\n<pre><code>CFBundleRef mb = CFBundleGetMainBundle();\nCFURLRef ur = CFBundleCopyResourceURL(mb, CFSTR(\"blah\"), CFSTR(\"txt\"), NULL);\nCFStringRef imagePath = CFURLCopyFileSystemPath(ur, kCFURLPOSIXPathStyle);\n\nCFStringEncoding encodingMethod = CFStringGetSystemEncoding();\nconst char *filename = CFStringGetCStringPtr(imagePath, encodingMethod);\n\nprintf( \"\\n we did it! .. %s \\n\", filename );\n</code></pre>\n\n<p>Assuming \"blah.txt\" is in your bundle, it works.</p>\n\n<p>This is the only way I know to do it - seems long-winded. What's the deal?</p>\n\n<ol>\n<li><p>Is my code long-winded, pansy-assed, and pathetic?</p></li>\n<li><p>Is this is the correct and best idiom to get a cstring path from the filename?</p></li>\n</ol>\n\n<p>(Note I <strong><em>do not want</em></strong> to make it an obj-c or obj-cpp file. Pure C.)</p>\n"}, {"tags": ["c", "struct", "typedef"], "comments": [{"owner": {"reputation": 2723, "user_id": 9017315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3229c3b31dc467c858d3d27f88c41c11?s=128&d=identicon&r=PG&f=1", "display_name": "Osiris", "link": "https://stackoverflow.com/users/9017315/osiris"}, "edited": false, "score": 4, "creation_date": 1546980524, "post_id": 54099437, "comment_id": 95031750, "body": "You only declare a type <code>Coiso</code>, not a variable."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1546980529, "post_id": 54099437, "comment_id": 95031756, "body": "<code>Coiso</code> is a <i>type</i>, not a variable"}, {"owner": {"reputation": 43, "user_id": 10886441, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zGFQ72N5pTg/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZERGsndbeNNtf8KytVBQLGyr3E-w/mo/photo.jpg?sz=128", "display_name": "Carlos Mota", "link": "https://stackoverflow.com/users/10886441/carlos-mota"}, "edited": false, "score": 0, "creation_date": 1546980643, "post_id": 54099437, "comment_id": 95031820, "body": "Sorry my mistake. i have &quot;printf ( &quot;Insira a cor do cabelo do coiso\\n&quot;);     scanf ( &quot;%s&quot;, Coiso.cor_de_cabelo);      printf ( &quot;%s\\n&quot;, Coiso.cor_de_cabelo);"}, {"owner": {"reputation": 320, "user_id": 10133297, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9MB4NXZkZUg/AAAAAAAAAAI/AAAAAAAAAPU/GeL9jwCKUvg/photo.jpg?sz=128", "display_name": "Chief A", "link": "https://stackoverflow.com/users/10133297/chief-a"}, "edited": false, "score": 0, "creation_date": 1546981155, "post_id": 54099437, "comment_id": 95032016, "body": "you might want to give some value to <code>cor_de_cabelo</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2723, "user_id": 9017315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3229c3b31dc467c858d3d27f88c41c11?s=128&d=identicon&r=PG&f=1", "display_name": "Osiris", "link": "https://stackoverflow.com/users/9017315/osiris"}, "edited": false, "score": 3, "creation_date": 1546980982, "post_id": 54099518, "comment_id": 95031941, "body": "<code>scanf ( &quot;%s&quot;, var);</code> is not correct, it should be <code>scanf ( &quot;%s&quot;, var.cor_de_cabelo);</code>"}, {"owner": {"reputation": 43, "user_id": 10886441, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zGFQ72N5pTg/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZERGsndbeNNtf8KytVBQLGyr3E-w/mo/photo.jpg?sz=128", "display_name": "Carlos Mota", "link": "https://stackoverflow.com/users/10886441/carlos-mota"}, "edited": false, "score": 0, "creation_date": 1546981183, "post_id": 54099518, "comment_id": 95032030, "body": "Osiris, i understand the idea. it&#39;s perfect. now it&#39;s work"}, {"owner": {"reputation": 1032, "user_id": 7462275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JtXPb.png?s=128&g=1", "display_name": "Stef1611", "link": "https://stackoverflow.com/users/7462275/stef1611"}, "edited": false, "score": 0, "creation_date": 1546981369, "post_id": 54099518, "comment_id": 95032112, "body": "<code>typedef struct X {...}X; struct {...}X; typedef struct {...} X; struct X X; ...</code> This could be really confusing when you learn C. I recommend you read this post : <a href=\"https://stackoverflow.com/questions/1675351/typedef-struct-vs-struct-definitions\" title=\"typedef struct vs struct definitions\">stackoverflow.com/questions/1675351/&hellip;</a>. The explanations are realised in a very didactic manner."}], "tags": [], "owner": {"reputation": 31, "user_id": 9133299, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-8gpF7Bi-UbA/AAAAAAAAAAI/AAAAAAAAABw/eEKFLbBVl1Y/photo.jpg?sz=128", "display_name": "JBatstone", "link": "https://stackoverflow.com/users/9133299/jbatstone"}, "is_accepted": false, "score": 1, "last_activity_date": 1546980766, "creation_date": 1546980766, "answer_id": 54099518, "question_id": 54099437, "link": "https://stackoverflow.com/questions/54099437/why-do-i-get-an-error-expected-expression-before/54099518#54099518", "title": "Why do I get an error &quot;expected expression before ...&quot;?", "body": "<p>As others have said Coiso is just a custom type, like int or bool. \nYou have to declare a variable with it. So to edit your code.</p>\n\n<pre><code>Coiso var;\n\nscanf ( \"%s\", var);\n\nprintf ( \"%s\\n\", var.cor_de_cabelo);\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 10886441, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zGFQ72N5pTg/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZERGsndbeNNtf8KytVBQLGyr3E-w/mo/photo.jpg?sz=128", "display_name": "Carlos Mota", "link": "https://stackoverflow.com/users/10886441/carlos-mota"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546986771, "creation_date": 1546980411, "last_edit_date": 1546986771, "question_id": 54099437, "link": "https://stackoverflow.com/questions/54099437/why-do-i-get-an-error-expected-expression-before", "title": "Why do I get an error &quot;expected expression before ...&quot;?", "body": "<p>I'm new to coding, I'm portuguese, so my English is not so good.</p>\n\n<p>My question:</p>\n\n<pre><code>int main()\n{\n    typedef struct Coiso{\n        char cor_cabelo[100];\n        int idade;\n        float altura;\n\n    }Coiso;\n\n\n    printf ( \"Insira a cor do cabelo do coiso\\n\");\n    scanf ( \"%s\", Coiso);\n\n    printf ( \"%s\\n\", Coiso.cor_de_cabelo);\n\nreturn 0;\n}\n</code></pre>\n\n<p>So, I compiled this in geany and get an error: <code>expected expression before \"coiso\"</code>.</p>\n\n<p>Why do I get this error?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 50126, "user_id": 1717300, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/81b91f602ce8acea8cbeb29f62725627?s=128&d=identicon&r=PG", "display_name": "hyde", "link": "https://stackoverflow.com/users/1717300/hyde"}, "edited": false, "score": 0, "creation_date": 1546991459, "post_id": 54099288, "comment_id": 95035662, "body": "You should include some example code. Your description is a bit unclear to me at least."}], "answers": [{"tags": [], "owner": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "is_accepted": true, "score": 0, "last_activity_date": 1546990382, "creation_date": 1546990382, "answer_id": 54101238, "question_id": 54099288, "link": "https://stackoverflow.com/questions/54099288/whats-the-difference-between-single-pointer-and-double-pointers-for-array-of-st/54101238#54101238", "title": "What&#39;s the difference between Single pointer and Double pointers for array of strings", "body": "<p>** is a pointer to an existing pointer *\nI would review this link for a detailed explanation\n<a href=\"https://stackoverflow.com/questions/897366/how-do-pointer-to-pointers-work-in-c\">How do pointer to pointers work in C?</a></p>\n\n<p>For malloc, there are plenty of examples on this site</p>\n"}], "owner": {"reputation": 5, "user_id": 10878597, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Xj0K30LJD7k/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcbSxooqCPepl8kar6Ij_vTjed-s_g/mo/photo.jpg?sz=128", "display_name": "Yamen Massalha", "link": "https://stackoverflow.com/users/10878597/yamen-massalha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 54101238, "answer_count": 1, "score": -2, "last_activity_date": 1546990382, "creation_date": 1546979542, "question_id": 54099288, "link": "https://stackoverflow.com/questions/54099288/whats-the-difference-between-single-pointer-and-double-pointers-for-array-of-st", "title": "What&#39;s the difference between Single pointer and Double pointers for array of strings", "body": "<p>I have checked a lot of sources, but I didn't understand what's the difference between single pointer and double pointers exactly, like when I use *string, I can fill it with many strings, and when I use **string, I can do the same thing.</p>\n\n<p>Can any one give me a simple example that could make me understand ?, and how can I use malloc for both of them?.</p>\n"}, {"tags": ["c", "pointers"], "answers": [{"comments": [{"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "reply_to_user": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1547052102, "post_id": 54099204, "comment_id": 95062066, "body": "@old_timer The <code>volatile</code> keyword is generic C. But that it happens to do whatever platform-specific stuff happens to be needed to read from this hardware register is platform-specific."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1547056381, "post_id": 54099204, "comment_id": 95064340, "body": "the language stuff is generic C the specific address sure is specific to a not specified microcontroller, the question implies that it is asking about the C language not the register/address."}], "tags": [], "owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "is_accepted": false, "score": 0, "last_activity_date": 1546979114, "creation_date": 1546979114, "answer_id": 54099204, "question_id": 54099155, "link": "https://stackoverflow.com/questions/54099155/what-does-this-mean-exactly-in-c/54099204#54099204", "title": "What does this mean exactly in C?", "body": "<p>It is written like that because that is what happens to work on the particular compilers used with that particular microcontroller. Most likely, the <code>volatile</code> serves as an indication to the compiler that it shouldn't make optimizations that would result in not actually reading the hardware register.</p>\n"}, {"comments": [{"owner": {"reputation": 2723, "user_id": 9017315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3229c3b31dc467c858d3d27f88c41c11?s=128&d=identicon&r=PG&f=1", "display_name": "Osiris", "link": "https://stackoverflow.com/users/9017315/osiris"}, "edited": false, "score": 2, "creation_date": 1546979324, "post_id": 54099213, "comment_id": 95031278, "body": "Since you edited the original question, are you sure it is meant that the dereference operator is part of the define? That would make the <code>_Address</code> suffix very confusing."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1546980050, "post_id": 54099213, "comment_id": 95031565, "body": "Suggest &quot;1 int worth of data.&quot; --&gt; 1 unsigned worth of data."}, {"owner": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "reply_to_user": {"reputation": 2723, "user_id": 9017315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3229c3b31dc467c858d3d27f88c41c11?s=128&d=identicon&r=PG&f=1", "display_name": "Osiris", "link": "https://stackoverflow.com/users/9017315/osiris"}, "edited": false, "score": 0, "creation_date": 1546981142, "post_id": 54099213, "comment_id": 95032014, "body": "@Osiris, the dereference operator was in the original question.  It was just being interpreted by the UI as <i>italics</i> mode, instead of a literal *.  I added an escape character `\\` to clarify.  I believe it was a correct edit, but cannot be 100% sure."}, {"owner": {"reputation": 2723, "user_id": 9017315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3229c3b31dc467c858d3d27f88c41c11?s=128&d=identicon&r=PG&f=1", "display_name": "Osiris", "link": "https://stackoverflow.com/users/9017315/osiris"}, "edited": false, "score": 1, "creation_date": 1546981315, "post_id": 54099213, "comment_id": 95032084, "body": "@abelenky Oh I see now, guess it is really just a confusing name."}], "tags": [], "owner": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "is_accepted": false, "score": 3, "last_activity_date": 1546979157, "creation_date": 1546979157, "answer_id": 54099213, "question_id": 54099155, "link": "https://stackoverflow.com/questions/54099155/what-does-this-mean-exactly-in-c/54099213#54099213", "title": "What does this mean exactly in C?", "body": "<p>On whatever platform this is, memory address <code>0x400253FC</code> contains 1 <code>int</code> worth of data.</p>\n\n<p>If you dereference <code>0x400253FC</code>, you get that value.</p>\n\n<p>This is likely used for something like:</p>\n\n<pre><code>unsigned int GetCPUTemperature()\n{\n    unsigned int temp;\n    temp = RegisterX_Address;\n    return temp;\n}\n</code></pre>\n\n<p>It is not terribly common to have data mapped directly to a specific memory address, but happens in embedded development regularly.</p>\n\n<p>The <code>volatile</code> keyword tells the compiler it cannot cache, store or reuse the value it gets.  It must retrieve the value from memory on each access, because whatever is writing data there will update the value regularly and outside the scope of the program.</p>\n"}, {"tags": [], "owner": {"reputation": 1466, "user_id": 810658, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/62139de5517901ce4c7ba8184070d24f?s=128&d=identicon&r=PG", "display_name": "Philip", "link": "https://stackoverflow.com/users/810658/philip"}, "is_accepted": false, "score": 1, "last_activity_date": 1546982811, "creation_date": 1546982811, "answer_id": 54099960, "question_id": 54099155, "link": "https://stackoverflow.com/questions/54099155/what-does-this-mean-exactly-in-c/54099960#54099960", "title": "What does this mean exactly in C?", "body": "<p>It's a macro to access a (probably) memory-mapped I/O pin. </p>\n\n<p>The compiler or hardware itself knows that specific addresses of memory have an additional purpose. When your source code reads from that register it's really reading the value off of an input pin, a wire hooked up directly to the processor. That address is special, and these sort of things are typically exclusively tied to that particular hardware. (Which is why you need a shmorgas board of different drivers for different hardware and they're not all conveniently interchangeable). For all the misdirection and generalization that higher levels perform, at some point you need to direct read and writes to actual hardware with actual addresses. </p>\n\n<p>The inner <code>*</code> is declaring it as a pointer. The outer <code>*</code> is dereferencing it. And yeah, pointers in C are one of the most confusing parts of the language. The <code>*</code> symbol has two jobs really; one is during declarations, where it describes a chunk of data. And explicitly casting is declaration: <code>(volatile unsigned int*)</code>. That forces the compiler to treat the hex value as a pointer to a volatile unsigned integer. The second, in execution when using this macro: <code>*(myPointer)</code>, that pointer is dereferenced, so rather than using the value <code>0x400253FC</code>, you're looking at the data that lives at ADDRESS <code>0x400253FC</code> in memory. Which isn't even memory since it's probably mapped to HW. (It depends. Either way it's still called a register in ICDs. I think of registers as the specific registers on the chip, what assembly can use directly as opposed to going through the MMU. But everything is a \"register\" to the HW guys, they use it like we use \"address\"). </p>\n\n<p>And I'm guessing it's an I/O pin because it's volatile. This a an instruction to the compiler not to make presumptions when optimizing because it's value can change behind it's back. Like when hardware gets a signal. Or when an output line automatically resets low.  Volatile variables are also used for shared memory between threads, but on a microcontroller it's typically I/O.</p>\n"}, {"tags": [], "owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "is_accepted": false, "score": 0, "last_activity_date": 1547003055, "last_edit_date": 1547003055, "creation_date": 1547002747, "answer_id": 54102676, "question_id": 54099155, "link": "https://stackoverflow.com/questions/54099155/what-does-this-mean-exactly-in-c/54102676#54102676", "title": "What does this mean exactly in C?", "body": "<p>Just try it...</p>\n\n<pre><code>#define RegisterX_Address (*((volatile unsigned int*)0x400253FC))\nunsigned int fun ( void )\n{\n    return(RegisterX_Address);\n}\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>00000000 &lt;fun&gt;:\n   0:   4b01        ldr r3, [pc, #4]    ; (8 &lt;fun+0x8&gt;)\n   2:   6818        ldr r0, [r3, #0]\n   4:   4770        bx  lr\n\n   8:   400253fc\n</code></pre>\n\n<p>It is simpler to write than</p>\n\n<pre><code>volatile unsigned int *RegisterX_Address;\nRegisterX_Address = (volatile unsigned int *)0x400253FC;\nreturn(*RegisterX_Address);\n</code></pre>\n\n<p>That is why it is written that way.  Plus as written it doesnt consume memory as a variable.</p>\n"}], "owner": {"reputation": 21, "user_id": 10780341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5772a1cea24fd787e98834193b821081?s=128&d=identicon&r=PG&f=1", "display_name": "M.Noufale", "link": "https://stackoverflow.com/users/10780341/m-noufale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1547003055, "creation_date": 1546978839, "last_edit_date": 1547002970, "question_id": 54099155, "link": "https://stackoverflow.com/questions/54099155/what-does-this-mean-exactly-in-c", "title": "What does this mean exactly in C?", "body": "<pre><code>#define RegisterX_Address (*((volatile unsigned int*)0x400253FC))\n</code></pre>\n\n<p>I need to understand what this <code>(*((volatile unsigned int*)0x400253FC))</code> in C, I understands that is a pointer pointing to the address of one of the registers but why is it written like this???</p>\n"}, {"tags": ["c", "while-loop", "scanf"], "comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1546979244, "post_id": 54099154, "comment_id": 95031254, "body": "<code>scanf(&quot;%c&quot;, %command, 1);</code> is quit incorrect.  Try <code>scanf(&quot;%c&quot;, &amp;command);</code>"}, {"owner": {"reputation": 22818, "user_id": 509868, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/83450238b4ee0eddbf54d7ce5a3a64e4?s=128&d=identicon&r=PG", "display_name": "anatolyg", "link": "https://stackoverflow.com/users/509868/anatolyg"}, "edited": false, "score": 0, "creation_date": 1546979577, "post_id": 54099154, "comment_id": 95031389, "body": "Might use <code>scanf(&quot;%c%*[^\\n]%*c&quot;, &amp; command)</code> but it looks horrible and may fail"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 22818, "user_id": 509868, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/83450238b4ee0eddbf54d7ce5a3a64e4?s=128&d=identicon&r=PG", "display_name": "anatolyg", "link": "https://stackoverflow.com/users/509868/anatolyg"}, "edited": false, "score": 1, "creation_date": 1546979849, "post_id": 54099154, "comment_id": 95031488, "body": "@anatolyg <code>scanf(&quot;%c%*[^\\n]%*c&quot;, &amp; command)</code> with input <code>&quot;t\\n&quot;</code> will leave <code>&#39;\\n&#39;</code> in <code>stdin</code> for the next <code>scanf()</code> call.  <code>&quot;%*c&quot;</code> is not used when <code>&quot;%*[^\\n]&quot;</code> fails."}], "answers": [{"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": true, "score": 0, "last_activity_date": 1546980291, "last_edit_date": 1546980291, "creation_date": 1546979715, "answer_id": 54099319, "question_id": 54099154, "link": "https://stackoverflow.com/questions/54099154/how-to-ignore-the-n-character-in-the-input/54099319#54099319", "title": "How to ignore the &#39;\\n&#39; character in the input", "body": "<blockquote>\n  <p>How to ignore the '\\n' character in the input</p>\n</blockquote>\n\n<p>After all commands, except the bare <code>'\\n'</code>, consume the rest of the line.</p>\n\n<p>In the <code>t</code> case, it is the <code>'\\n'</code> after the entered <code>height</code> that the causes the issue.  Consume it before looking for a new command.</p>\n\n<pre><code>while(quit) {\n    printf(\"command? \");\n    scanf(\"%c\", &amp;command);\n    switch (command) {\n      ...\n    }\n    if (command != '\\n') {\n      int ch;\n      while ((ch = getchar()) != `'\\n'`) &amp;&amp; (ch != EOF)) {\n        ;\n      }\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>Tip: Consider using <code>fgets()</code> for user input and avoid using <code>scanf()</code>.</p>\n"}], "owner": {"reputation": 25, "user_id": 9421140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fWeHF.jpg?s=128&g=1", "display_name": "Boris Ivanov", "link": "https://stackoverflow.com/users/9421140/boris-ivanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 54099319, "answer_count": 1, "score": 2, "last_activity_date": 1546980291, "creation_date": 1546978837, "last_edit_date": 1592644375, "question_id": 54099154, "link": "https://stackoverflow.com/questions/54099154/how-to-ignore-the-n-character-in-the-input", "title": "How to ignore the &#39;\\n&#39; character in the input", "body": "<p>I need to make the program in such a way that when the return key is entered it  continues with the program and prints the initial lines again.</p>\n<p>I tried to resolve it with (case '\\n') but that didn't work and I tried some getchar() variants but I had the same issue.</p>\n<pre><code>    void main()\n{\nchar nameA[100];\nchar nameB[100];\nchar command;\nint height;\nint quit = 1;\n\nstruct node *ring1 = NULL;\nstruct node *ring2 = NULL;\n\nwhile(quit)\n{\n    printf(&quot;command? &quot;);\n    scanf(&quot;%c&quot;, %command, 1);\n    \n    switch (command)\n    {\n        case 'q':\n            printf(&quot;bye\\n&quot;);\n            quit = 0;\n            break;\n            \n        case 't':\n            printf(&quot;name? &quot;);\n            scanf(&quot; %[^\\n]&quot;, nameA);\n            printf(&quot;height? &quot;);\n            scanf(&quot; %d&quot;, &amp;height);\n            \n            ring1 = insert_tail(ring1, nameA, height);\n            break;\n            \n        case '\\n':\n            break;\n        \n        default:\n            break;\n    }\n}\n</code></pre>\n<p>}</p>\n<p>What I want to be able to print is</p>\n<blockquote>\n<p>command?</p>\n<p>command? ...</p>\n</blockquote>\n<p>The problem is that if I use &quot; %c&quot; I will ignore the new line and if I use &quot;%c&quot; the output will look like:</p>\n<blockquote>\n<p>command?</p>\n<p>command? ...</p>\n</blockquote>\n<p>but in the case that let's say I use the 't' command in my code the result will look like</p>\n<blockquote>\n<p>command? t</p>\n<p>name? Everest</p>\n<p>height? 8848</p>\n<p>command? command?</p>\n</blockquote>\n<p>How can I fix that ? I assume the problems is because I actually enter two characters, the &quot;t&quot; and &quot;\\n&quot; but I have no clue how to get around that.</p>\n"}]