[{"tags": ["c"], "comments": [{"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 2, "creation_date": 1565221337, "post_id": 57403453, "comment_id": 101288418, "body": "(Note to answerers: this is probably a continuation of an earlier question <a href=\"https://stackoverflow.com/questions/57385578/what-is-the-difference-between-linking-and-using-a-header-file/57385853\">here</a>.)"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1565221443, "post_id": 57403453, "comment_id": 101288444, "body": "Do you know what a <i>compiled</i> (as opposed to interpreted) language is?"}, {"owner": {"reputation": 47, "user_id": 11882086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93863851c832d54ba96dc7b6a938f52?s=128&d=identicon&r=PG&f=1", "display_name": "cprogrammer100", "link": "https://stackoverflow.com/users/11882086/cprogrammer100"}, "reply_to_user": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1565221838, "post_id": 57403453, "comment_id": 101288524, "body": "@SteveSummit yes"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 1, "creation_date": 1565222068, "post_id": 57403453, "comment_id": 101288568, "body": "The reason I ask is, there&#39;s clearly something about C&#39;s separate compilation model that you don&#39;t understand, but I can&#39;t figure out what it is."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565225951, "post_id": 57403453, "comment_id": 101289317, "body": "<a href=\"https://stackoverflow.com/questions/42578874/why-can-i-use-stdio-h-without-a-corresponding-stdio-c\" title=\"why can i use stdio h without a corresponding stdio c\">stackoverflow.com/questions/42578874/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 11882086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93863851c832d54ba96dc7b6a938f52?s=128&d=identicon&r=PG&f=1", "display_name": "cprogrammer100", "link": "https://stackoverflow.com/users/11882086/cprogrammer100"}, "edited": false, "score": 0, "creation_date": 1565221780, "post_id": 57403476, "comment_id": 101288512, "body": "If the functions and variables exist in the .c file, why use a .h file in the first place?"}, {"owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 4, "creation_date": 1565222754, "post_id": 57403476, "comment_id": 101288718, "body": "C was created decades ago, when computer time was expensive. Many of its rules, like having to declare a function before it is used, are designed to make the compilation process faster. Modern languages don&#39;t generally have these restrictions, because the programmer doesn&#39;t much care if code compiles in 100 milliseconds or 300 milliseconds. But back in the 70s, 1 minute or 3 minutes was a bigger deal."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1565223670, "post_id": 57403476, "comment_id": 101288897, "body": "A <code>.h</code> file allows the compiler to quickly understand how to use the code without having to compile it. This saves enormous amounts of time when assembling the final executable. If you had to recompile everything, every time, even the tiniest of changes to your code would require building the whole universe from the ground up."}], "tags": [], "owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "is_accepted": true, "score": 6, "last_activity_date": 1565221298, "creation_date": 1565221298, "answer_id": 57403476, "question_id": 57403453, "link": "https://stackoverflow.com/questions/57403453/what-is-the-difference-between-stdio-c-and-stdio-h/57403476#57403476", "title": "What is the difference between stdio.c and stdio.h?", "body": "<p>The functions defined in the header file have to be <em>implemented</em>. The <code>.c</code> file contains the implementation, though these have already been compiled into a static or shared library that your compiler can use.</p>\n\n<p>The header file should contain a <em>minimal description of the function</em> to save time when compiling. If it included the entire source it'd force the compiler to rebuild it <em>each and every time you compile</em> which is really wasteful since that source never changes.</p>\n\n<p>In effect, the header file serves as a cheat sheet on how to interact with the already compiled library.</p>\n\n<p>The reason the <code>.c</code> files are provided is primarily for debugging, so your debugger can step through in your debug build and show you source instead of raw machine code. In rare cases you may want to look at the implementation of a particular function in order to better understand it, or in even more rare cases, identify a bug. They're not actually used to compile your program.</p>\n\n<p>In your code you should only ever reference the header file version, the <code>.h</code> via an <code>#include</code> directive.</p>\n"}, {"comments": [{"owner": {"reputation": 47, "user_id": 11882086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93863851c832d54ba96dc7b6a938f52?s=128&d=identicon&r=PG&f=1", "display_name": "cprogrammer100", "link": "https://stackoverflow.com/users/11882086/cprogrammer100"}, "edited": false, "score": 0, "creation_date": 1565222659, "post_id": 57403581, "comment_id": 101288696, "body": "Would it be correct to say that C uses header files to declare functions and variables that will/may be used and the .c files which define them."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1565223746, "post_id": 57403581, "comment_id": 101288910, "body": "Turbo Pascal is one of the best examples of this with modules being a first-class feature of that language and the compilation times are positively <i>stupid</i> fast. C isn&#39;t anywhere near, but it is a lot faster once running, so that&#39;s why people use C and not Pascal. The good news is C++ is eventually going to get modules, so maybe compilation times will improve a bunch accordingly."}, {"owner": {"reputation": 107137, "user_id": 364696, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7eBCp.jpg?s=128&g=1", "display_name": "ShadowRanger", "link": "https://stackoverflow.com/users/364696/shadowranger"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1565225276, "post_id": 57403581, "comment_id": 101289181, "body": "@tadman: There was <a href=\"https://prog21.dadgum.com/47.html\" rel=\"nofollow noreferrer\">a lot more to Turbo Pascal compilation speed</a> than mere &quot;modules as language feature&quot;. Of the points mentioned there, C/C++ compilers aren&#39;t moving to an integrated build system, and the linker is getting more complicated, not less (to enable link time optimization to maximize speed while removing redundant/unused code). Modules may help, but modules alone aren&#39;t going to get you to Turbo Pascal compilation speeds (and that&#39;s a good thing, since much of Turbo Pascal&#39;s compilation speed came from foregoing optimization)."}], "tags": [], "owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "is_accepted": false, "score": 0, "last_activity_date": 1565265232, "last_edit_date": 1565265232, "creation_date": 1565222335, "answer_id": 57403581, "question_id": 57403453, "link": "https://stackoverflow.com/questions/57403453/what-is-the-difference-between-stdio-c-and-stdio-h/57403581#57403581", "title": "What is the difference between stdio.c and stdio.h?", "body": "<p>There are languages where if you want to make use of something someone else has written, you say something like</p>\n\n<pre><code>import module\n</code></pre>\n\n<p>and that takes care of everything.</p>\n\n<p>C is not one of those languages.</p>\n\n<p>You could put \"library\" source code in a file, and then use <code>#include</code> to pull it in wherever you needed it.  But this wouldn't work at all, for two reasons:</p>\n\n<ol>\n<li><p>If you used <code>#include</code> to pull it in from two different source files, and then linked the two resulting object files together, everything in the \"library\" would be defined twice.</p></li>\n<li><p>You might not want to deliver your \"library\" code as source; you might prefer to deliver it in compiled, object form.</p></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565225874, "post_id": 57403658, "comment_id": 101289301, "body": "Another reason <code>stdio.c</code> might not exist could be that the implementation is written in assembly or some other language. Or maybe even hardcoded in the compiler."}, {"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565226860, "post_id": 57403658, "comment_id": 101289479, "body": "@M.M: Yes, I mentioned that."}], "tags": [], "owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "is_accepted": false, "score": 3, "last_activity_date": 1565223044, "creation_date": 1565223044, "answer_id": 57403658, "question_id": 57403453, "link": "https://stackoverflow.com/questions/57403453/what-is-the-difference-between-stdio-c-and-stdio-h/57403658#57403658", "title": "What is the difference between stdio.c and stdio.h?", "body": "<p><code>stdio.h</code> is a standard header, required to be provided by every conforming hosted C implementation. It <em>declares</em>, but does not <em>define</em>, a number of entities, mostly library functions like <code>putchar</code> and <code>scanf</code>.</p>\n\n<p><code>stdio.c</code>, if it exists, is likely to be a C source file that <em>defines</em> the functions declared in <code>stdio.h</code>. There is no requirement that an implementation must make it available. It might not even exist; for example the implementations of the functions declared in <code>stdio.h</code> might appear in multiple <code>*.c</code> files.</p>\n\n<p>The declaration of <code>putchar</code> is:</p>\n\n<pre><code>int putchar(int c);\n</code></pre>\n\n<p>and that's all the compiler needs to know when it sees a call to <code>putchar</code> in your program. The code that implements <code>putchar</code> is typically provided as machine code, and the linker's job is to resolve your <code>putchar()</code> call so it ends up invoking that code. <code>putchar()</code> might not even be written in C (though it probably is).</p>\n\n<p>An executable program can be built from multiple <code>*.c</code> source files.  One and only one copy of the code that implements <code>putchar</code> is needed for an entire program. If the implementation of <code>putchar</code> were in the header file, then it would be included in each separately compiled source file, creating conflicts and, at best, wasting space. The code that implements <code>putchar()</code> (and all the other functions in the library) only needs to be compiled once.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 11899733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60d3362ddcbce889de7bf4459343b44e?s=128&d=identicon&r=PG&f=1", "display_name": "embeddedpc", "link": "https://stackoverflow.com/users/11899733/embeddedpc"}, "is_accepted": false, "score": 1, "last_activity_date": 1565242383, "last_edit_date": 1565242383, "creation_date": 1565239514, "answer_id": 57405329, "question_id": 57403453, "link": "https://stackoverflow.com/questions/57403453/what-is-the-difference-between-stdio-c-and-stdio-h/57405329#57405329", "title": "What is the difference between stdio.c and stdio.h?", "body": "<p>The <code>.c</code> files has specific function for any aim. For example <code>stdio.c</code> files has standart input-output functions to use within C program. In <code>stdio.h</code> header files has function prototypes for all <code>stdio.c</code> functions, all defines, all macros etc. When you <code>#include &lt;stdio.h</code>> in your main <code>code.c</code> file your main code assumes there is a \" <code>int printf(const char *format, ...)</code>\" function. Returns <code>int</code> value and you can pass argument ..... etc. When you call <code>printf()</code> function actually you use <code>stdio.c</code> files..</p>\n"}], "owner": {"reputation": 47, "user_id": 11882086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93863851c832d54ba96dc7b6a938f52?s=128&d=identicon&r=PG&f=1", "display_name": "cprogrammer100", "link": "https://stackoverflow.com/users/11882086/cprogrammer100"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1008, "favorite_count": 0, "accepted_answer_id": 57403476, "answer_count": 4, "score": -1, "last_activity_date": 1565265232, "creation_date": 1565221118, "question_id": 57403453, "link": "https://stackoverflow.com/questions/57403453/what-is-the-difference-between-stdio-c-and-stdio-h", "title": "What is the difference between stdio.c and stdio.h?", "body": "<p>Couldn't stdio functions and variables be defined in header files without having to use .c files.</p>\n\n<p>If not, what are .c files used for? </p>\n"}, {"tags": ["c", "cs50"], "comments": [{"owner": {"reputation": 54818, "user_id": 962089, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/b6SVs.jpg?s=128&g=1", "display_name": "chris", "link": "https://stackoverflow.com/users/962089/chris"}, "edited": false, "score": 3, "creation_date": 1565220404, "post_id": 57403308, "comment_id": 101288237, "body": "In propositional logic, &quot;but&quot; means &quot;and&quot;. Your attempt at using a logical and is of the most interest here."}, {"owner": {"reputation": 172529, "user_id": 140750, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c7af12cad08c95bc206a9636d164224?s=128&d=identicon&r=PG", "display_name": "William Pursell", "link": "https://stackoverflow.com/users/140750/william-pursell"}, "edited": false, "score": 0, "creation_date": 1565224694, "post_id": 57403308, "comment_id": 101289093, "body": "<code>printf(&quot;Usage : .&#47;caesar key\\n&quot;); return 1;</code> is inconsistent.  If you are printing the message to stdout (and usage messages should be written to stdout), then you should return 0.  If you consider this an error (as indicated by returning 1), then the error message should be written to stderr.  Usage statements are not error messages, so you should <code>return EXIT_SUCCESS</code>."}], "answers": [{"tags": [], "owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "is_accepted": true, "score": 6, "last_activity_date": 1565220702, "last_edit_date": 1565220702, "creation_date": 1565220384, "answer_id": 57403377, "question_id": 57403308, "link": "https://stackoverflow.com/questions/57403308/is-there-a-way-i-can-put-but-in-an-if-statement/57403377#57403377", "title": "Is there a way I can put &#39;but&#39; in an if statement?", "body": "<p>Use parenthesis to group mutually-inclusive logical expressions. Your <code>but</code> is actually an <code>and</code> (<code>&amp;&amp;</code>), like so:</p>\n\n<pre><code>if( ( ptext[i] + key &gt;= 90 &amp;&amp; ptext[i] + key &lt; 97 ) || ptext[i] &gt;= 122 )\n{\n    // etc\n}\n</code></pre>\n\n<p>That said, I would use an intermediate variable so it's immediately clear to the reader what's going on:</p>\n\n<pre><code>const char clear   = ptext[i];\nconst char shifted = ptext[i] + key;\n\nif( ( clear =&gt; 90 &amp;&amp; clear &lt; 97 ) || shifted &gt;= 122 ) \n{\n    // etc\n}\n</code></pre>\n\n<p>Or consider introducing named boolean values to make the code self-documenting:</p>\n\n<pre><code>#include &lt;stdbool.h&gt;\n\n...\n\nconst char clear   = ptext[i];\nconst char shifted = ptext[i] + key;\n\nconst bool isAscii        = clear =&gt; 90 &amp;&amp; clear &lt; 97;\nconst bool isOutsideRange = shifted &gt;= 122;\n\nif( isAscii || isOutsideRange ) \n{\n    // etc\n}\n</code></pre>\n\n<p>(Note that in most programming languages (and pretty much all compiled languages) intermediate variables do not hurt performance at all because compilers are smart enough to know they don't change the actual behaviour of a function at all. Sometimes they can even make a program faster because the compiler can infer more about your intent).</p>\n"}], "owner": {"reputation": 23, "user_id": 11893423, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ho6U9PILOdo/AAAAAAAAAAI/AAAAAAAAAyA/5UusniMlEVM/photo.jpg?sz=128", "display_name": "NuNu Duck", "link": "https://stackoverflow.com/users/11893423/nunu-duck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 57403377, "answer_count": 1, "score": 1, "last_activity_date": 1565220702, "creation_date": 1565219717, "last_edit_date": 1565220294, "question_id": 57403308, "link": "https://stackoverflow.com/questions/57403308/is-there-a-way-i-can-put-but-in-an-if-statement", "title": "Is there a way I can put &#39;but&#39; in an if statement?", "body": "<p>In my CS50 course I am making a program in which encrypts a message depending on the characters entered by the user. </p>\n\n<p>If the user inputs 3 each letter of the message is shifted 3 units right. To do this, I converted these letters into ASCII codes. Unfortunately, when the user tries to encrypt any message with any form of Z, the user is sent back a special character such as parentheses or brackets. This also happens when the original ASCII code plus the key(inputted by the user) is greater 90 or greater than 122. The ASCII code 90 being Z and 122 being z. To solve this, I've put a condition that states when the ASCII code is greater than 90 or 122, subtract the value of key. This of course also doesn't work because when inputting a value such as a with the value of key being 3. For example : when the user inputs ZzAa. Every letter besides a is encrypted to a letter. 'a' on the other hand is encrypted to '^'. The reason being a is 97 in ASCII code and 97 is greater than 90 but not 122 so it gets reduced to 94 which is '^'.</p>\n\n<p>I was wondering if there was a '<code>but</code>' condition in the <code>if</code> statement so I can put the condition : greater than 90 but less than 97, so that a (<code>97</code>) isn't reduced to 94 (<code>^</code>)</p>\n\n<p>I've tried putting in a Logical Or and a Logical AND. None of them seemed to work. One example of it not working is when you input 3 as the key and ZzAa as the test message being encrypted.</p>\n\n<pre><code>#include &lt;cs50.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint main(int argc, string argv[])\n{\n   if (argc != 2)\n   // If the user uses the program incorrectly, it shows them how to do it and quits the program\n   {\n       printf(\"Usage : ./caesar key\\n\");\n       return 1;\n   }\n   // stores the second value inputted by the user(key) into an integer key\n   int key = atoi(argv[1]) % 26;\n\n   char *ptext = get_string(\"Plaintext : \");\n\n   for (int i = 0, n = strlen(ptext); i &lt; n; i++)\n   {\n       if(ptext[i] + key &gt;= 90 || ptext[i] &gt;= 122)\n       {\n           printf(\"Cipher text: %c\\n \", ptext[i] - key);\n           printf(\"Cipher text: %i\\n \", ptext[i] - key);\n       }\n       else\n       {\n           printf(\"Cipher text: %c\\n \", ptext[i] + key);\n           printf(\"Cipher text: %i\\n \", ptext[i] + key);\n       }\n   }\n\n   return 0;\n\n}\n\n\nThis worked for the most part\n</code></pre>\n"}, {"tags": ["c", "arrays", "struct", "malloc"], "comments": [{"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 2, "creation_date": 1565218765, "post_id": 57403127, "comment_id": 101287928, "body": "The memory from <code>calloc</code> won&#39;t be part of the copy. <code>memcpy</code> is a <a href=\"https://en.wikipedia.org/wiki/Object_copying#Shallow_copy\" rel=\"nofollow noreferrer\">shallow copy</a>."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 1, "creation_date": 1565219044, "post_id": 57403127, "comment_id": 101287981, "body": "Don&#39;t include &quot;Thanks&quot; in your questions. It is frowned upon here."}], "answers": [{"tags": [], "owner": {"reputation": 5813, "user_id": 1075282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70efe94a6c2237ec96f429402a03a27d?s=128&d=identicon&r=PG", "display_name": "Renat", "link": "https://stackoverflow.com/users/1075282/renat"}, "is_accepted": false, "score": 1, "last_activity_date": 1565218500, "creation_date": 1565218500, "answer_id": 57403198, "question_id": 57403127, "link": "https://stackoverflow.com/questions/57403127/c-malloc-an-array-inside-a-struct/57403198#57403198", "title": "C, malloc an array inside a struct[]", "body": "<p>You're calculating size of <code>a</code> and <code>b</code> incorrectly. <code>a</code> and <code>b</code> are 4-elements array of <code>test_T</code>, each of <code>test_T</code> has a pointer to <code>int</code> array. <code>a</code> and <code>b</code> are not contiguous memory with size <code>4 * 10 * sizeof(int)</code>.</p>\n\n<p>You might need instead:</p>\n\n<pre><code>memcpy(b, a, sizeof(a));\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "is_accepted": false, "score": 2, "last_activity_date": 1565218644, "creation_date": 1565218644, "answer_id": 57403207, "question_id": 57403127, "link": "https://stackoverflow.com/questions/57403127/c-malloc-an-array-inside-a-struct/57403207#57403207", "title": "C, malloc an array inside a struct[]", "body": "<p>It's not clear what you're trying to copy, but <code>4 * 10 * sizeof(int)</code> is not correct in any case. You haven't allocated any single contiguous block that size.</p>\n\n<p>If you want to copy just the array of structs, which just copies the pointers to the array, it's:</p>\n\n<pre><code>memcpy(b, a, 4 * sizeof(test_t));\n</code></pre>\n\n<p>Note that this causes a memory leak, because you never freed the memory that was allocated in <code>b</code>.</p>\n\n<p>If you want to copy each of the arrays of ints, it's</p>\n\n<pre><code>for (int i = 0; i &lt; 4; i++) {\n    memcpy(b[i].val, a[i].val, 10 * sizeof(int));\n}\n</code></pre>\n\n<p>This doesn't leak anything, because it's just copying the integers in the arrays, not changing the pointers.</p>\n"}, {"tags": [], "owner": {"reputation": 20, "user_id": 4642828, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xwoZ9QJAESY/AAAAAAAAAAI/AAAAAAAAOoc/uEjpT71cQyA/photo.jpg?sz=128", "display_name": "Sarath Padakandla", "link": "https://stackoverflow.com/users/4642828/sarath-padakandla"}, "is_accepted": false, "score": 1, "last_activity_date": 1565219694, "creation_date": 1565219694, "answer_id": 57403305, "question_id": 57403127, "link": "https://stackoverflow.com/questions/57403127/c-malloc-an-array-inside-a-struct/57403305#57403305", "title": "C, malloc an array inside a struct[]", "body": "<p>Another easiest way is copy with for() instead of memcpy to avoid confusion,</p>\n\n<pre><code>for(i=0;i&lt;4;i++){\nb[i] = a[i];\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "is_accepted": false, "score": 0, "last_activity_date": 1565244898, "creation_date": 1565244898, "answer_id": 57406213, "question_id": 57403127, "link": "https://stackoverflow.com/questions/57403127/c-malloc-an-array-inside-a-struct/57406213#57406213", "title": "C, malloc an array inside a struct[]", "body": "<p>The data structures you have before <code>memcpy()</code> look like this in RAM:</p>\n\n<p><a href=\"https://i.stack.imgur.com/1lebc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1lebc.png\" alt=\"Picture\"></a></p>\n\n<p>Each of the rectangles is a continous block of memory. It can be in any place, not necessarily in a special order, and not in adjacent places.</p>\n\n<p>When you do </p>\n\n<pre><code>b[i] = a[i];\n</code></pre>\n\n<p>then the storage pointed to by <code>b[i]</code> will be \"leaked\", that means you lose the reference to it and you can't free it. Both <code>b[i]</code> and <code>a[i]</code> will point to the same array of 10 <code>int</code>s.</p>\n\n<p>When you do</p>\n\n<pre><code>memcpy(b, a, sizeof a);\n</code></pre>\n\n<p>then all storage pointed to by <code>b[0]</code> to <code>b[3]</code> will be leaked.</p>\n\n<p>To copy all <code>int</code>s from <code>a</code> to <code>b</code>, you could use @Barmar's loop, or this one:</p>\n\n<pre><code>for (int i = 0; i &lt; 4; i++) {\n    for (int j = 0; j &lt; 10; j++) {\n        b[i].val[j] = a[i].val[j];\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 11898802, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/289227c1bcf1142e3096f87bf0d99f55?s=128&d=identicon&r=PG&f=1", "display_name": "Requiem", "link": "https://stackoverflow.com/users/11898802/requiem"}, "is_accepted": false, "score": 0, "last_activity_date": 1565255192, "creation_date": 1565255192, "answer_id": 57408955, "question_id": 57403127, "link": "https://stackoverflow.com/questions/57403127/c-malloc-an-array-inside-a-struct/57408955#57408955", "title": "C, malloc an array inside a struct[]", "body": "<p>thank you all for the answers.\nMaybe I simplified this example too much. \nUnfortunately, there are many other variables in the structure in question</p>\n\n<p>An example closer to reality can be this:</p>\n\n<pre><code>#define    MALLOC_SIZE    (10) //in the original code is a variable\ntypedef struct{\n    int size;\n    int x;\n    double y;\n    char z[32];\n    int *val;\n}test_T;\n\nvoid setSize(test_T *in){\n    int i = 0;\n    for (i=0; i&lt;4; i++){\n        in[i].size = 0;\n        in[i].size += sizeof(int);//size\n        in[i].size += sizeof(int);//x\n        in[i].size += sizeof(double);//y\n        in[i].size += (sizeof(char)*32);//z\n        in[i].size += (sizeof(int)*MALLOC_SIZE);\n    }\n}\n\nvoid testAllocSingle(test_T *in){\n    in-&gt;val = (int *)calloc(MALLOC_SIZE, sizeof(int));\n}\n\nvoid testAlloc(test_T *in){\n    int i = 0;\n    for (i=0; i&lt;4; i++){\n        testAllocSingle(&amp;(in[i]));\n    }\n}\n\nint main(void){\n    int tot_size = 0;\n\n    test_T a[4];\n    test_T b[4];\n\n    testAlloc(a);\n    testAlloc(b);\n\n    setSize(a);\n    tot_size = a[0].size + a[1].size + a[2].size + a[3].size;\n\n    memcpy(b, a, tot_size);\n    //FATAL RUN-TIME ERROR: Array argument too small (16 bytes).  Argument    must contain at least 160 bytes (160 elements).\n    return 0;\n}\n</code></pre>\n\n<p>Copying everything \"manually\" remains possible but more inconvenient.\nThe strange thing is that I only have the problem if I compile and execute the code with NI CVI.\nIf I compile and execute the code with Eclipse+MinGW I haven't this error</p>\n"}], "owner": {"reputation": 21, "user_id": 11898802, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/289227c1bcf1142e3096f87bf0d99f55?s=128&d=identicon&r=PG&f=1", "display_name": "Requiem", "link": "https://stackoverflow.com/users/11898802/requiem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 5, "score": 0, "last_activity_date": 1565255192, "creation_date": 1565217903, "question_id": 57403127, "link": "https://stackoverflow.com/questions/57403127/c-malloc-an-array-inside-a-struct", "title": "C, malloc an array inside a struct[]", "body": "<p>I have a struct[4] with inside a pointer.\nI have to malloc this pointer for all the 4 structs</p>\n\n<pre><code>//Here a simplification of my code that produces the same error:\n\ntypedef struct{\n    int *val;\n}test_T;\n\nvoid testAllocSingle(test_T *in){\n    in-&gt;val = (int *)calloc(10, sizeof(int));\n}\n\nvoid testAlloc(test_T *in){\n    int i = 0;\n    for (i=0; i&lt;4; i++){\n        testAllocSingle(&amp;(in[i]));\n    }\n}\n\nvoid main(void){\n    test_T a[4];\n    test_T b[4];\n    testAlloc(a);\n    testAlloc(b);\n    memcpy(b, a, 4*10*sizeof(int));\n    //FATAL RUN-TIME ERROR: Array argument too small (16 bytes).  Argument    must contain at least 160 bytes (160 elements).\n}\n</code></pre>\n\n<p>My allocated array is not visible to main.\nI'm doing something wrong in passing variables, can anyone tell me where?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 5813, "user_id": 1075282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70efe94a6c2237ec96f429402a03a27d?s=128&d=identicon&r=PG", "display_name": "Renat", "link": "https://stackoverflow.com/users/1075282/renat"}, "edited": false, "score": 0, "creation_date": 1565217996, "post_id": 57403049, "comment_id": 101287764, "body": "It might be carriage return symbol goes first, as <code>\\r\\n</code>.Try <code>c == &#39;\\n&#39; || c == &#39;\\r&#39;</code>"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 5813, "user_id": 1075282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70efe94a6c2237ec96f429402a03a27d?s=128&d=identicon&r=PG", "display_name": "Renat", "link": "https://stackoverflow.com/users/1075282/renat"}, "edited": false, "score": 1, "creation_date": 1565218065, "post_id": 57403049, "comment_id": 101287781, "body": "@Renat No, it&#39;s a <code>scanf</code> limitation."}, {"owner": {"reputation": 927, "user_id": 11876201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a07428013837e21b446ccfe8bddab7e9?s=128&d=identicon&r=PG", "display_name": "phoenixstudio", "link": "https://stackoverflow.com/users/11876201/phoenixstudio"}, "edited": false, "score": 0, "creation_date": 1565218273, "post_id": 57403049, "comment_id": 101287816, "body": "I tested your code and it gave me 10 when I put 9876.54321 and it does enter into the if (c == &#39;\\n&#39;) { break; }"}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 1, "creation_date": 1565218341, "post_id": 57403049, "comment_id": 101287834, "body": "What is<code>num</code>? Where/how is it defined?"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 2, "creation_date": 1565218375, "post_id": 57403049, "comment_id": 101287841, "body": "Please include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1565220740, "post_id": 57403049, "comment_id": 101288291, "body": "Please see <a href=\"https://stackoverflow.com/questions/5240789/scanf-leaves-the-new-line-char-in-the-buffer\">scanf() leaves the newline char in the buffer</a>. The usual way to solve this is to rewrite <code>scanf(&quot;%c&quot;, &amp;c)</code> as <code>scanf(&quot; %c&quot;, &amp;c)</code> where the added space instructs <code>scanf</code> to filter out leading whitespace, if any. Most other format specifiers (<code>%d</code>, <code>%s</code> etc) do this automatically. It&#39;s bad practice to assume that there is always a newline to remove: the newline is not specifically considered or needed by <code>scanf</code> and may not always be present."}], "answers": [{"comments": [{"owner": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "edited": false, "score": 0, "creation_date": 1565218105, "post_id": 57403144, "comment_id": 101287791, "body": "I tried <code>getchar</code> but got the same problem, can you show how to use it right?"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "edited": false, "score": 0, "creation_date": 1565218329, "post_id": 57403144, "comment_id": 101287833, "body": "@vesii How is <code>num</code> declared?"}, {"owner": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "edited": false, "score": 0, "creation_date": 1565218407, "post_id": 57403144, "comment_id": 101287849, "body": "its <code>char*</code> (dynamic array of chars). what is <code>isspace</code>? can&#39;t I use <code>\\n</code>?"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "edited": false, "score": 0, "creation_date": 1565218440, "post_id": 57403144, "comment_id": 101287852, "body": "@vesii <code>\\n</code> only skips newline. <code>isspace</code> skips all spaces (tab, spacebar, carriage return, etc.)"}, {"owner": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "edited": false, "score": 0, "creation_date": 1565221197, "post_id": 57403144, "comment_id": 101288388, "body": "by doing your way, there are still white spaces so after the the first break and when I call this function second time, it reads the newline instead the new input. what to do?"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "edited": false, "score": 0, "creation_date": 1565224092, "post_id": 57403144, "comment_id": 101288980, "body": "@vesii I don&#39;t know. I can&#39;t test your program because it doesn&#39;t have a <code>main</code> function or a declaration for <code>num</code>."}], "tags": [], "owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "is_accepted": false, "score": 3, "last_activity_date": 1565218598, "last_edit_date": 1565218598, "creation_date": 1565218033, "answer_id": 57403144, "question_id": 57403049, "link": "https://stackoverflow.com/questions/57403049/understanding-why-the-newline-is-caught-on-the-next-iteration/57403144#57403144", "title": "Understanding why the newline is caught on the next iteration", "body": "<p>Here:</p>\n\n<pre><code>if(scanf(\"%c\", &amp;c) != 1) {\n</code></pre>\n\n<p><code>%c</code> in <code>scanf</code> leaves the leading and following whitespace in the input buffer.</p>\n\n<p>To fix this, don't use <code>scanf</code>. Use <code>getchar</code> or <code>getc</code> instead. Instead of using <code>c == '\\n'</code>, use <code>isspace(c)</code>.</p>\n\n<p>Don't do <code>char c</code>. You can't check for <code>EOF</code> if you do that. Instead, use <code>int c</code>.</p>\n\n<p>Full code sample:</p>\n\n<pre><code>int VALUE = 10;\nint counter = 0;\nint c;\nwhile (true) {\n    c = getchar();\n    if (isspace(c) || c == EOF) {\n        break;\n    }\n    if (counter % VALUE &lt; VALUE - 1) {\n        num[counter] = c;\n        counter++;\n    } else {\n        char* temp = (char*) malloc((counter + MAX_VALUE)*sizeof(char));\n        if (temp == NULL) {\n            return NULL;\n        }\n\n        for (int i = 0; i &lt; counter; i++) {\n            temp[i] = num[i];\n        }\n        free(num);\n        num = temp;\n        num[counter] = c;\n        counter++;\n    }\n}\nprintf(\"counter = %d\\n\",counter);\n</code></pre>\n"}], "owner": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1565218598, "creation_date": 1565217234, "question_id": 57403049, "link": "https://stackoverflow.com/questions/57403049/understanding-why-the-newline-is-caught-on-the-next-iteration", "title": "Understanding why the newline is caught on the next iteration", "body": "<p>I wrote the following code:</p>\n\n<pre><code>int VALUE = 10;\nint counter = 0;\nchar c;\nwhile (true) {\n    if(scanf(\"%c\", &amp;c) != 1) {\n        return NULL;\n    }\n    if (c == '\\n') {\n        break;\n    }\n    if (counter % VALUE &lt; VALUE - 1) {\n        num[counter] = c;\n        counter++;\n    } else {\n        char* temp = (char*) malloc((counter + MAX_VALUE)*sizeof(char));\n        if (temp == NULL) {\n            return NULL;\n        }\n\n        for (int i = 0; i &lt; counter; i++) {\n            temp[i] = num[i];\n        }\n        free(num);\n        num = temp;\n        num[counter] = c;\n        counter++;\n    }\n}\nprintf(\"counter = %d\\n\",counter);\n</code></pre>\n\n<p>It doesn't really matter what it does but I have some problem with the <code>counter</code>. For some reason, when I insert <code>9876.54321</code> (newline at the end), It does not enters into the <code>if (c == '\\n') { break; }</code> block when it scanfs <code>\\n</code>, only on the next iteration. The length of <code>9876.54321</code> is <code>10</code> but it will print <code>11</code>. What is the reason? I also tried to switch to <code>getchar()</code> but I get the same thing.</p>\n"}, {"tags": ["c", "arduino", "i2c", "eeprom"], "comments": [{"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 2, "creation_date": 1565214553, "post_id": 57402680, "comment_id": 101286908, "body": "I would start your debugging process by writing code that successfully writes a single byte on the eeprom at your chosen memory address."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 8828044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae4b92360b74b119f65dc6b521fadd8f?s=128&d=identicon&r=PG&f=1", "display_name": "balu", "link": "https://stackoverflow.com/users/8828044/balu"}, "edited": false, "score": 0, "creation_date": 1565255636, "post_id": 57404484, "comment_id": 101298588, "body": "I think you misunderstood something in the datasheet, the sheet clearly states that if /WC is driven high, it will acknowledge the address bytes, but no modification will be done."}], "tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": false, "score": 1, "last_activity_date": 1565232016, "creation_date": 1565232016, "answer_id": 57404484, "question_id": 57402680, "link": "https://stackoverflow.com/questions/57402680/cant-write-to-m24256-eeprom-using-i2c-and-arduino/57404484#57404484", "title": "Can&#39;t write to M24256 EEPROM using I2C and Arduino", "body": "<p>regarding your statement: <em>I grounded the /WC pin so it's not write protected</em></p>\n\n<p>given <a href=\"https://hu.mouser.com/datasheet/2/389/m24256-br-954988.pdf\" rel=\"nofollow noreferrer\">EEPROM SPEC SHEET</a> figure 8, the /WC MUST be high during the writing to the EEPROM. There fore, with (as you state) /WC is low, nothing will be written to the chip.</p>\n\n<p>Your code really needs to pay attention to the ack bit that is transmitted by the EEPROM between each byte written. Until the ACK bit is received (by your code), the EEPROM is not ready for another byte of data. Per the spec sheet, that can be as much as 5ms after the byte of data is completely transmitted by your code</p>\n\n<p>in general, unconnected pins will 'float' You cannot be sure that they will 'float' low. so, to be sure, E2 E1 and E0 should be tied to ground </p>\n\n<p>Suggest tying <code>/WC</code> to one of the output pins on your arduino and write code to properly handle that pin value</p>\n\n<p>The longest allowed write (and read) sequence is 64 bytes (all within the same 'page') so your code should be taking that into consideration</p>\n"}, {"comments": [{"owner": {"reputation": 51, "user_id": 8828044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae4b92360b74b119f65dc6b521fadd8f?s=128&d=identicon&r=PG&f=1", "display_name": "balu", "link": "https://stackoverflow.com/users/8828044/balu"}, "edited": false, "score": 0, "creation_date": 1565255483, "post_id": 57404727, "comment_id": 101298508, "body": "The datasheet states that if left unconnected, they will be read as low. I connected them to ground to sure.   I didn&#39;t know about the 7-bit addressing, thanks."}], "tags": [], "owner": {"reputation": 170455, "user_id": 149341, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/omfTQ.png?s=128&g=1", "display_name": "duskwuff -inactive-", "link": "https://stackoverflow.com/users/149341/duskwuff-inactive"}, "is_accepted": false, "score": 2, "last_activity_date": 1565234399, "creation_date": 1565234399, "answer_id": 57404727, "question_id": 57402680, "link": "https://stackoverflow.com/questions/57402680/cant-write-to-m24256-eeprom-using-i2c-and-arduino/57404727#57404727", "title": "Can&#39;t write to M24256 EEPROM using I2C and Arduino", "body": "<p>I see several problems here:</p>\n\n<ol>\n<li><blockquote>\n  <p>I left all E pins unconnected</p>\n</blockquote>\n\n<p>As stated on page 8 of the datasheet, \"These inputs must be tied to V<sub>CC</sub> or V<sub>SS</sub>\". Leaving them floating is not recommended.</p></li>\n<li><p><a href=\"https://www.arduino.cc/en/reference/wire\" rel=\"nofollow noreferrer\">The Arduino <code>Wire</code> library</a> uses 7-bit I<sub>2</sub>C addresses. If all E pins are grounded, the correct address to use for this part in this context will be <code>0x50</code> (<code>1010000</code> binary). You do not need to use a separate address for read and write -- the last bit is inferred by the library.</p></li>\n<li><p>As noted by user3629249 (what a name!), the ~WC pin must be pulled <em>low</em> to permit writes.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 8828044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae4b92360b74b119f65dc6b521fadd8f?s=128&d=identicon&r=PG&f=1", "display_name": "balu", "link": "https://stackoverflow.com/users/8828044/balu"}, "is_accepted": false, "score": 0, "last_activity_date": 1565255857, "creation_date": 1565255857, "answer_id": 57409134, "question_id": 57402680, "link": "https://stackoverflow.com/questions/57402680/cant-write-to-m24256-eeprom-using-i2c-and-arduino/57409134#57409134", "title": "Can&#39;t write to M24256 EEPROM using I2C and Arduino", "body": "<p>I figured out how to get it working, I'm posting the code if anyone has a similar issue in the future:</p>\n\n<pre><code>#define memoryAddr 0x50\nbyte in=0x00;\n\n#include &lt;Wire.h&gt;\n\nvoid setup() {\n  Serial.begin(9600);\n  Wire.begin();\n  Serial.println(\"writing\");\n\n  Wire.beginTransmission(memoryAddr);\n  Wire.write(0x00);  // first the MSB (8-bits)\n  Wire.write(0x00);\n  delay(10); \n  Wire.write(0x00); //data\n  Wire.endTransmission();\n\n  delay(10);\n  Serial.println(\"reading\");\n\n  Wire.beginTransmission(memoryAddr); //writing the address to be read\n  Wire.write(0x00);\n  Wire.write(0x00);\n  Wire.endTransmission();\n  delay(10);\n  Wire.beginTransmission(memoryAddr);\n  Wire.requestFrom(memoryAddr,10,true);\n  while(Wire.available()){\n    in=Wire.read();\n    Serial.println(in,HEX);\n\n  }\n  Wire.endTransmission();\n  Serial.println(\"Done\");\n}\n\nvoid loop() {\n}\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 8828044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae4b92360b74b119f65dc6b521fadd8f?s=128&d=identicon&r=PG&f=1", "display_name": "balu", "link": "https://stackoverflow.com/users/8828044/balu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 455, "favorite_count": 1, "answer_count": 3, "score": 0, "last_activity_date": 1565255857, "creation_date": 1565214371, "question_id": 57402680, "link": "https://stackoverflow.com/questions/57402680/cant-write-to-m24256-eeprom-using-i2c-and-arduino", "title": "Can&#39;t write to M24256 EEPROM using I2C and Arduino", "body": "<p>I'm pretty sure it's a minor mistake I've done, but I couldn't figure it out. I'm trying to use an <a href=\"https://hu.mouser.com/datasheet/2/389/m24256-br-954988.pdf\" rel=\"nofollow noreferrer\">M24256 EEPROM</a> with Arduino Mega2560 via I2C protocol. The datasheet states that the address is 1010(E2)(E1)(E0)(R/W). I left all E pins unconnected, which means it should be A0 for writing and A1 for reading. I grounded the /WC pin so it's not write protected. I checked the device with the I2C scanner sketch and for some reason it was seen as 0x50. What's strange that I can read from it by using any address (I tried 0x50, 0xA1 and some random addresses), but I can't write to it - every time I get the default 0xFF as readback.</p>\n\n<p>The code I tried:</p>\n\n<pre><code>#define memoryRead 0xA0\n#define memoryWrite 0xA1\nbyte in=0x00;\n\n#include &lt;Wire.h&gt;\n\nvoid setup() {\n  Serial.begin(9600);\n  Wire.begin();\n  Serial.println(\"writing\");\n  for(int i=0;i&lt;100;i++){\n    Wire.beginTransmission(memoryWrite);\n    Wire.write(byte(i &gt;&gt; 8));  // first the MSB (8-bits)\n    Wire.write(byte(i)); \n    Wire.write(byte(i));\n    Wire.endTransmission();\n  }\n  Serial.println(\"reading\");\n\n  Wire.beginTransmission(memoryWrite); //this should be resetting the pointer //to 0 if I got it well from the datasheet\n  Wire.write(0x00);\n  Wire.write(0x00);\n  Wire.beginTransmission(memoryRead);\n  for(int i=0;i&lt;100;i++){\n    in=Wire.read();\n    Serial.println(in,HEX);\n\n  }\n  Wire.endTransmission();\n  Serial.println(\"done\");\n}\n\nvoid loop() {\n}\n</code></pre>\n\n<p>What am I doing wrong? I double checked the wiring and the write protection, so it must be code.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["c", "struct", "linked-list", "malloc"], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 11667829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dAMpy.jpg?s=128&g=1", "display_name": "sdfrn42", "link": "https://stackoverflow.com/users/11667829/sdfrn42"}, "edited": false, "score": 0, "creation_date": 1565212982, "post_id": 57402451, "comment_id": 101286417, "body": "Okay, I see the problem, so how would I fix it?"}, {"owner": {"reputation": 4756, "user_id": 10001688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvhzK.jpg?s=128&g=1", "display_name": "Michael Bianconi", "link": "https://stackoverflow.com/users/10001688/michael-bianconi"}, "reply_to_user": {"reputation": 15, "user_id": 11667829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dAMpy.jpg?s=128&g=1", "display_name": "sdfrn42", "link": "https://stackoverflow.com/users/11667829/sdfrn42"}, "edited": false, "score": 0, "creation_date": 1565213019, "post_id": 57402451, "comment_id": 101286423, "body": "In the struct definition, change <code>Class data;</code> to <code>Class* data;</code>"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 15, "user_id": 11667829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dAMpy.jpg?s=128&g=1", "display_name": "sdfrn42", "link": "https://stackoverflow.com/users/11667829/sdfrn42"}, "edited": false, "score": 2, "creation_date": 1565213245, "post_id": 57402451, "comment_id": 101286494, "body": "@sdfrn42, better still might be to just do nothing.  Your <code>struct node</code> has a <code>Class</code> as a member, so the space allocated for a node <i>already includes</i> space for a Class.  You don&#39;t need to allocate that separately.  Change the member to a <code>Class *</code> only if that&#39;s what you actually want to have."}, {"owner": {"reputation": 15, "user_id": 11667829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dAMpy.jpg?s=128&g=1", "display_name": "sdfrn42", "link": "https://stackoverflow.com/users/11667829/sdfrn42"}, "edited": false, "score": 0, "creation_date": 1565213256, "post_id": 57402451, "comment_id": 101286498, "body": "Will do in a couple mins when it lets me."}, {"owner": {"reputation": 15, "user_id": 11667829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dAMpy.jpg?s=128&g=1", "display_name": "sdfrn42", "link": "https://stackoverflow.com/users/11667829/sdfrn42"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1565213348, "post_id": 57402451, "comment_id": 101286531, "body": "@JohnBollinger I didn&#39;t actually think of that... What exactly changes when i change it to <code>Class *</code>?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 15, "user_id": 11667829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dAMpy.jpg?s=128&g=1", "display_name": "sdfrn42", "link": "https://stackoverflow.com/users/11667829/sdfrn42"}, "edited": false, "score": 0, "creation_date": 1565213667, "post_id": 57402451, "comment_id": 101286644, "body": "I&#39;m not sure how to answer that, @sdfrn42.  I mean, the difference is that in one case the node contains a <code>Class</code>, whereas in the other it contains (only) a pointer to a <code>Class</code> that lives somewhere else.  There are applications for both, so I can&#39;t tell you which one you want."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 15, "user_id": 11667829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dAMpy.jpg?s=128&g=1", "display_name": "sdfrn42", "link": "https://stackoverflow.com/users/11667829/sdfrn42"}, "edited": false, "score": 0, "creation_date": 1565216298, "post_id": 57402451, "comment_id": 101287357, "body": "@sdfrn42 Please do not include &quot;thank you&quot; comments on Stack Overflow. They&#39;re (sadly) frowned upon here."}], "tags": [], "owner": {"reputation": 4756, "user_id": 10001688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvhzK.jpg?s=128&g=1", "display_name": "Michael Bianconi", "link": "https://stackoverflow.com/users/10001688/michael-bianconi"}, "is_accepted": true, "score": 1, "last_activity_date": 1565212906, "creation_date": 1565212906, "answer_id": 57402451, "question_id": 57402436, "link": "https://stackoverflow.com/questions/57402436/create-new-node-in-linked-list-with-data-type-struct-for-data/57402451#57402451", "title": "Create new node in linked list with data type &quot;struct&quot; for data", "body": "<p>You're saying that <code>data</code> is a <code>Class</code> but you're trying to assign it a <code>Class*</code>.</p>\n"}], "owner": {"reputation": 15, "user_id": 11667829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dAMpy.jpg?s=128&g=1", "display_name": "sdfrn42", "link": "https://stackoverflow.com/users/11667829/sdfrn42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 57402451, "answer_count": 1, "score": 0, "last_activity_date": 1565214035, "creation_date": 1565212804, "last_edit_date": 1565214035, "question_id": 57402436, "link": "https://stackoverflow.com/questions/57402436/create-new-node-in-linked-list-with-data-type-struct-for-data", "title": "Create new node in linked list with data type &quot;struct&quot; for data", "body": "<pre><code>typedef struct class\n{\n   ...\n}Class;\n\ntypedef struct node\n{\n    Class data;\n    struct node *next;\n}Node;\n\nNode* newNode()\n{\n    Node* temp = (Node*)malloc(sizeof(Node));\n    temp -&gt; data = malloc(sizeof(Class));\n    temp -&gt; next = NULL;\n    return temp;\n}\n</code></pre>\n\n<p>The compiler says there is a problem with the line: <code>temp -&gt; data = malloc(sizeof(Class));</code>, specifically \"incompatible types in assignment\".</p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["c", "opengl"], "comments": [{"owner": {"reputation": 2796, "user_id": 6121044, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d36000b5ea58961acf50354041457af9?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas", "link": "https://stackoverflow.com/users/6121044/andreas"}, "edited": false, "score": 0, "creation_date": 1565214644, "post_id": 57402039, "comment_id": 101286937, "body": "opengl texture sampling uses mipmap by default. you should either deactivate mipmap (glTexParameter) sampling or load/generate mipmaps (glGenerateMipmap)."}, {"owner": {"reputation": 1664, "user_id": 2649079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41a2c9d80a4b8917940e65858c9abc0?s=128&d=identicon&r=PG", "display_name": "Nadir", "link": "https://stackoverflow.com/users/2649079/nadir"}, "edited": false, "score": 0, "creation_date": 1565250796, "post_id": 57402039, "comment_id": 101296051, "body": "First, you don&#39;t need to activate texture slots when uploading your texture. Second, why are you activating from <code>GL_TEXTURE0+3</code> (==<code>GL_TEXTURE3</code>) when rendering?. Third, what is `bind textures to be referenced later? You will have to bind each texture when using it because each texture binding overrides the previous one. Finally, provide more information (code), like your render loop or wherever you are using the textures."}, {"owner": {"reputation": 11, "user_id": 11898418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c62add449999b731b76401710f54e376?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Plant", "link": "https://stackoverflow.com/users/11898418/richard-plant"}, "edited": false, "score": 0, "creation_date": 1565277213, "post_id": 57402039, "comment_id": 101311450, "body": "do I deactivate mipmap in my display function, or in my initialization when I create all of the textures?"}, {"owner": {"reputation": 11, "user_id": 11898418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c62add449999b731b76401710f54e376?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Plant", "link": "https://stackoverflow.com/users/11898418/richard-plant"}, "edited": false, "score": 0, "creation_date": 1565277506, "post_id": 57402039, "comment_id": 101311626, "body": "nadir, I removed the activateTexture calls in the initialization function. I removed the 0+ in the rendering, making it GL_TEXTURE3. However I am still not seeing my texture being displayed.  I setup the following variables in my render display: glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);   glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);   glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);   glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);"}, {"owner": {"reputation": 11, "user_id": 11898418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c62add449999b731b76401710f54e376?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Plant", "link": "https://stackoverflow.com/users/11898418/richard-plant"}, "edited": false, "score": 0, "creation_date": 1565283508, "post_id": 57402039, "comment_id": 101314638, "body": "I tried disabling the mipmap both in the initialization and the render via the following line:  glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);  That still did not work."}], "owner": {"reputation": 11, "user_id": 11898418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c62add449999b731b76401710f54e376?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Plant", "link": "https://stackoverflow.com/users/11898418/richard-plant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 191, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565210478, "creation_date": 1565210478, "question_id": 57402039, "link": "https://stackoverflow.com/questions/57402039/texture-not-loading-glactivetexture", "title": "Texture not loading glActiveTexture", "body": "<p>I have been having some issues trying to get my texture to be displayed. I am attempting to initialize textures, then use glActiveTexture to use them in my opengl display.</p>\n\n<p>I first get declare these textures via:</p>\n\n<pre><code>// Texture identifiers\n    GLuint texture0, texture1, texture2, texture3, texture4, texture5, texture6;\n</code></pre>\n\n<p>Then during my initialization I try and create the textures via the following code:</p>\n\n<pre><code>//Load the active textures for each of our textures\n    //Bind them, to be referenced later\n    glGenTextures(1, &amp;texture0);\n    glActiveTexture(GL_TEXTURE0);\n    glBindTexture(GL_TEXTURE_2D, texture0);\n    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, 1000, \n            1000,0, GL_RGBA, GL_UNSIGNED_BYTE, \n      ceiling_tile);\n    glGenTextures(1, &amp;texture1);\n    glActiveTexture(GL_TEXTURE1);\n    glBindTexture(GL_TEXTURE_2D, texture1);\n    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, 500, \n            500,0, GL_RGBA, GL_UNSIGNED_BYTE, \n      floor_tile);\n    glGenTextures(1, &amp;texture2);\n    glActiveTexture(GL_TEXTURE2);\n    glBindTexture(GL_TEXTURE_2D, texture2);\n    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, 64, \n                 64,0, GL_RGBA, GL_UNSIGNED_BYTE, \n                 lamp_color);\n    glGenTextures(1, &amp;texture3);\n    glActiveTexture(GL_TEXTURE3);\n    glBindTexture(GL_TEXTURE_2D, texture3);\n    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, 500, \n            500,0, GL_RGBA, GL_UNSIGNED_BYTE, \n      total_black);\n    glGenTextures(1, &amp;texture4);\n    glActiveTexture(GL_TEXTURE4);\n    glBindTexture(GL_TEXTURE_2D, texture4);\n    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, 500, \n            500,0, GL_RGBA, GL_UNSIGNED_BYTE, \n      flower_texture);\n    glGenTextures(1, &amp;texture5);\n    glActiveTexture(GL_TEXTURE5);\n    glBindTexture(GL_TEXTURE_2D, texture5);\n    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, 500, \n            500,0, GL_RGBA, GL_UNSIGNED_BYTE, \n      dinosaur_texture);\n    glGenTextures(1, &amp;texture6);\n    glActiveTexture(GL_TEXTURE6);\n    glBindTexture(GL_TEXTURE_2D, texture6);\n    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, 500, \n            500,0, GL_RGBA, GL_UNSIGNED_BYTE, \n      chair_texture);\n</code></pre>\n\n<p>and then during my opengl display function, when I want to activate each one of these textures, I run:</p>\n\n<pre><code>  glActiveTexture(GL_TEXTURE0+3); glBindTexture(GL_TEXTURE_2D, texture3);\n'''\n</code></pre>\n\n<p>However when I do all of this no texture is loading into them. I do not know if I am calling all of these correctly? Any Ideas?</p>\n\n<p>I have tried moving around the glActiveTextures to be stuff like glActiveTexture(GL_TEXTUREX) , where X equals 1-6.</p>\n"}, {"tags": ["c", "netbeans"], "answers": [{"tags": [], "owner": {"reputation": 2323, "user_id": 8350647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zJNHD.png?s=128&g=1", "display_name": "Nina", "link": "https://stackoverflow.com/users/8350647/nina"}, "is_accepted": true, "score": 1, "last_activity_date": 1565222872, "creation_date": 1565222872, "answer_id": 57403639, "question_id": 57401999, "link": "https://stackoverflow.com/questions/57401999/need-help-on-adding-openssl-library/57403639#57403639", "title": "Need help on adding openssl library", "body": "<p>You need to download the OpenSSL headers along with the static link libraries or dlls. Or download the OpenSSL library, compile the lib/dll for linkage then allow your compiler to locate the OpenSSL includes folder.</p>\n\n<p>Library source is located here : <a href=\"https://github.com/openssl/openssl\" rel=\"nofollow noreferrer\">https://github.com/openssl/openssl</a>\nInstructions on compiling here: <a href=\"https://wiki.openssl.org/index.php/Compilation_and_Installation\" rel=\"nofollow noreferrer\">https://wiki.openssl.org/index.php/Compilation_and_Installation</a> \nIf you scroll down to the windows/OSX section. I imagine that's what you are using.</p>\n"}], "owner": {"reputation": 619, "user_id": 9542076, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Carol Ward", "link": "https://stackoverflow.com/users/9542076/carol-ward"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 57403639, "answer_count": 1, "score": -1, "last_activity_date": 1565222872, "creation_date": 1565210232, "question_id": 57401999, "link": "https://stackoverflow.com/questions/57401999/need-help-on-adding-openssl-library", "title": "Need help on adding openssl library", "body": "<p>I'm currently using Netbeans to write/compile C code.</p>\n\n<p>I'm trying out a couple of openssl example codes that I found online, but I'm having a problem with the following error when I include the library:</p>\n\n<pre><code>Cannot find include file &lt;openssl/conf.h&gt;\nCannot find include file &lt;openssl/evp.h&gt;\nCannot find include file &lt;openssl/err.h&gt;\n</code></pre>\n\n<p>I was wondering how I can import openssl libraries.</p>\n\n<p>Would someone teach me or point me to a direction where I can learn about importing libraries?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["c", "string", "format"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565202098, "post_id": 57399945, "comment_id": 101282044, "body": "The original code isn&#39;t reading integers, even though the variables are named <code>index1</code> and <code>index2</code>. It&#39;s reading 3 strings. It&#39;s confusing because the characters <code>[</code> and <code>]</code> being filtered out are themselves part of the syntax. Split the format string at each <code>%</code> and figure out what each part is doing."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565202472, "post_id": 57399945, "comment_id": 101282199, "body": "...and note that the text <code>index1</code> and <code>index2</code> (and <code>index</code> in yours) are all truncated to the string <code>&quot;ind&quot;</code> by the <code>3</code> in the format spec."}, {"owner": {"reputation": 21, "user_id": 10540289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d49342a6cc777c05fdf647a30e25ffb?s=128&d=identicon&r=PG&f=1", "display_name": "not your business", "link": "https://stackoverflow.com/users/10540289/not-your-business"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565202557, "post_id": 57399945, "comment_id": 101282237, "body": "I just don&#39;t get how the format expression works, seems to be different from regex and couldn&#39;t find good documentation for it."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565202649, "post_id": 57399945, "comment_id": 101282267, "body": "The <code>scanf</code> function family is not simple. I suggest spending an hour with the man <a href=\"https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/sscanf-sscanf-l-swscanf-swscanf-l?view=vs-2017\" rel=\"nofollow noreferrer\">pages</a> (perhaps a <a href=\"https://docs.microsoft.com/en-us/cpp/c-runtime-library/format-specification-fields-scanf-and-wscanf-functions?view=vs-2017\" rel=\"nofollow noreferrer\">separate page</a>  for  for <a href=\"https://docs.microsoft.com/en-us/cpp/c-runtime-library/scanf-type-field-characters?view=vs-2017\" rel=\"nofollow noreferrer\">each aspect</a> of the function) and looking at examples."}], "answers": [{"comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1565205638, "post_id": 57400671, "comment_id": 101283650, "body": "This fails to detect the error case in which the closing <code>]</code> is omitted."}, {"owner": {"reputation": 21, "user_id": 10540289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d49342a6cc777c05fdf647a30e25ffb?s=128&d=identicon&r=PG&f=1", "display_name": "not your business", "link": "https://stackoverflow.com/users/10540289/not-your-business"}, "edited": false, "score": 0, "creation_date": 1565206685, "post_id": 57400671, "comment_id": 101284110, "body": "Yeah it doesn&#39;t pass pretty simple tests."}, {"owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1565207967, "post_id": 57400671, "comment_id": 101284625, "body": "@JohnBollinger that&#39;s exactly the case I am mentioning in my answer. \ud83d\ude42 As I mentioned this is a naive example, to get people into it.."}], "tags": [], "owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "is_accepted": false, "score": 0, "last_activity_date": 1565204563, "last_edit_date": 1565204563, "creation_date": 1565203903, "answer_id": 57400671, "question_id": 57399945, "link": "https://stackoverflow.com/questions/57399945/how-can-i-use-sscanf-to-analyze-string-data/57400671#57400671", "title": "How can I use sscanf to analyze string data?", "body": "<p>A naive example to get you started:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint main(void)\n{\n  char str[] = \"myArray[123]\";\n  char array_name[32] = {0}, idx[4] = {0};\n\n  if(sscanf(str, \"%31[^[][%3[^]]]\", array_name, idx) == 2)\n    printf(\"arrayName = %s\\nindex = %s\\n\", array_name, idx);\n  else\n    printf(\"Not in the expected format \\\"ArrayName[idx]\\\"\\n\");\n  return 0;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>arrayName = myArray\nindex = 123\n</code></pre>\n\n<p>which will find easy not-in-the-expected format cases, such as \"ArrayNameidx]\" and \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOP[idx]\", but not \"ArrayName[idx\".</p>\n\n<p>The essence of <a href=\"http://www.cplusplus.com/reference/cstdio/scanf/\" rel=\"nofollow noreferrer\"><code>sscanf()</code></a> is to tell it where to stop, otherwise <code>%s</code> would read until the next whitespace.</p>\n\n<p>This negated scanset <code>%[^[]</code> means read until you find an opening bracket.</p>\n\n<p>This negated scanset <code>%[^]]</code> means read until you find a closing bracket.</p>\n\n<p>Note: I used 31 and 3 as the width specifiers respectively, since we want to reserve the last slot for the NULL terminator, since the name of the array is assumed to be 31 characters at the most, and the index 3 at the most. The size of the array for its token is the max allowed length, plus one.</p>\n"}, {"comments": [{"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1565214558, "post_id": 57401441, "comment_id": 101286909, "body": "<i>You may at this point be wondering at how complicated and cryptic that all is...</i>  Hear, hear.  <i>If</i> you&#39;re doing something dirt-simple and <i>if</i> you don&#39;t care about error handling and <i>if</i> you&#39;re still learning C and don&#39;t know any better, one of the <code>scanf</code> functions might be an adequate tool for the job, for now.  But if you&#39;re doing anything at all complicated... forget it."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 1, "last_activity_date": 1565210283, "last_edit_date": 1565210283, "creation_date": 1565207423, "answer_id": 57401441, "question_id": 57399945, "link": "https://stackoverflow.com/questions/57399945/how-can-i-use-sscanf-to-analyze-string-data/57401441#57401441", "title": "How can I use sscanf to analyze string data?", "body": "<blockquote>\n  <p>How do I split a string into two strings (array name, index number) only if the string is matching the following string structure: \"ArrayName[index]\".</p>\n</blockquote>\n\n<p>With <code>sscanf</code>, you don't.  Not if you mean that you can rely on nothing being modified in the event that the input does not match the pattern.  This is because <code>sscanf</code>, like the rest of the <code>scanf</code> family, processes its input and format linearly, without backtracking, and by design it fills input fields as they are successfully matched.  Thus, if you scan with a format that assigns multiple fields or has trailing literal characters then it is possible for results to be stored for some fields despite a matching failure occurring.</p>\n\n<p>But if that's ok with you then <a href=\"https://stackoverflow.com/a/57400671/2402272\">@gsamaras's answer</a> provides a nearly-correct approach to parsing and validating a string according to your specified format, using <code>sscanf</code>.  That answer also presents a nice explanation of the meaning of the format string.  The problem with it is that it provides no way to distinguish between the input fully matching the format and the input failing to match at the final <code>]</code>, or including additional characters after.</p>\n\n<p>Here is a variation on that code that accounts for those tail-end issues, too:</p>\n\n<pre><code>  char array_name[32] = {0}, idx[4] = {0}, c = 0;\n  int n;\n\n  if (sscanf(str, \"%31[^[][%3[^]]%c%n\", array_name, idx, &amp;c, &amp;n) &gt;= 3\n          &amp;&amp; c == ']' &amp;&amp; str[n] == '\\0')\n    printf(\"arrayName = %s\\nindex = %s\\n\", array_name, idx);\n  else\n    printf(\"Not in the expected format \\\"ArrayName[idx]\\\"\\n\");\n</code></pre>\n\n<p>The difference in the format is the replacement of the literal terminating <code>]</code> with a <code>%c</code> directive, which matches any one character, and the addition of a %n directive, which causes the number of characters of input read so far to be stored, without itself consuming any input.</p>\n\n<p>With that, if the return value is at least 3 then we know that the whole format was matched (a <code>%n</code> never produces a matching failure, but docs are unclear and behavior is inconsistent on whether it contributes to the returned field count).  In that event, we examine variable <code>c</code> to determine whether there was a closing <code>]</code> where we expected to find one, and we use the character count recorded in <code>n</code> to verify that all characters of the string were parsed (so that <code>str[n]</code> refers to a string terminator).</p>\n\n<p>You may at this point be wondering at how complicated and cryptic that all is.  And you would be right to do so.  Parsing structured input is a complicated and tricky proposition, for one thing, but also the <code>scanf</code> family functions are pretty difficult to use.  You would be better off with a <a href=\"https://linux.die.net/man/3/regex\" rel=\"nofollow noreferrer\">regex</a> matcher for cases like yours, or maybe with a machine-generated lexical analyzer (see <a href=\"https://linux.die.net/man/1/lex\" rel=\"nofollow noreferrer\">lex</a>), possibly augmented by machine-generated parser (see <a href=\"https://linux.die.net/man/1/yacc\" rel=\"nofollow noreferrer\">yacc</a>).  Even a hand-written parser that works through the input string with string functions and character comparisons might be an improvement.  It's still complicated any way around, but those tools can at least make it less cryptic.</p>\n\n<p><strong><em>Note</strong>: the above assumes that the index can be any string of up to three characters.  If you meant that it must be numeric, perhaps specifically a decimal number, perhaps specifically non-negative, then the format can be adjusted to serve that purpose.</em></p>\n"}, {"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 0, "last_activity_date": 1565226538, "creation_date": 1565226538, "answer_id": 57403995, "question_id": 57399945, "link": "https://stackoverflow.com/questions/57399945/how-can-i-use-sscanf-to-analyze-string-data/57403995#57403995", "title": "How can I use sscanf to analyze string data?", "body": "<blockquote>\n  <p>How can I use sscanf to analyze string data?</p>\n</blockquote>\n\n<p>Use <code>\"%n\"</code> to detect a completed scan.</p>\n\n<hr>\n\n<blockquote>\n  <p>array name can be 31 characters at most and the index 3 at most.</p>\n</blockquote>\n\n<p>For illustration, let us assume the index needs to limit to a numeric value [0 - 999].</p>\n\n<p>Use string literal concatenation to present the format more clearly.</p>\n\n<pre><code>char name[32];  // array name can be 31 characters\n#define NAME_FMT \"%31[^[]\"\nchar idx[4];   // \n#define IDX_FMT \"%3[0-9]\"\n\nint n = 0;  // be sure to initialize\nsscanf(str,  NAME_FMT \"[\" IDX_FMT \"]\" \"%n\", array_name, idx, &amp;n);\n\n// Did scan complete (is `n` non-zero) with no extra text?\nif (n &amp;&amp; str[n] == '\\0') {\n  printf(\"arrayName = %s\\nindex = %d\\n\", array_name, atoi(idx));\n} else {\n  printf(\"Not in the expected format \\\"ArrayName[idx]\\\"\\n\");\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 10540289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d49342a6cc777c05fdf647a30e25ffb?s=128&d=identicon&r=PG&f=1", "display_name": "not your business", "link": "https://stackoverflow.com/users/10540289/not-your-business"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "accepted_answer_id": 57401441, "answer_count": 3, "score": 1, "last_activity_date": 1565226538, "creation_date": 1565200744, "last_edit_date": 1565204333, "question_id": 57399945, "link": "https://stackoverflow.com/questions/57399945/how-can-i-use-sscanf-to-analyze-string-data", "title": "How can I use sscanf to analyze string data?", "body": "<p>How do I split a string into two strings (array name, index number) only if the string is matching the following string structure: \"ArrayName[index]\".\nThe array name can be 31 characters at most and the index 3 at most. </p>\n\n<p>I found the following example which suppose to work with \"Matrix[index1][index2]\". I really couldn't understand how it does it in order to take apart the part I need to get my strings. </p>\n\n<pre><code>sscanf(inputString, \"%32[^[]%*[[]%3[^]]%*[^[]%*[[]%3[^]]\", matrixName, index1,index2) == 3\n</code></pre>\n\n<p>This try over here wasn't a success, what am I missing? </p>\n\n<pre><code>sscanf(inputString, \"%32[^[]%*[[]%3[^]]\", arrayName, index) == 2\n</code></pre>\n"}, {"tags": ["c++", "c", "arrays", "string"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 4, "creation_date": 1565197354, "post_id": 57399227, "comment_id": 101279977, "body": "String <i>is</i> a byte array with terminating <code>&#39;\\0&#39;</code> character. So yeah, you will need it&#39;s size to accommodate it too."}, {"owner": {"reputation": 1782, "user_id": 7970461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ee57a85b60ce9c462d95f972ea1811e?s=128&d=identicon&r=PG&f=1", "display_name": "R.J. Dunnill", "link": "https://stackoverflow.com/users/7970461/r-j-dunnill"}, "edited": false, "score": 0, "creation_date": 1565197608, "post_id": 57399227, "comment_id": 101280093, "body": "Aren&#39;t you missing a null-terminator?"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1565197624, "post_id": 57399227, "comment_id": 101280103, "body": "Why are you making a wonky typedef <code>BYTE</code>? This is like imposing the terminology of another language on C where it doesn&#39;t belong. In C we call these <code>unsigned char</code> or <code>uint8_t</code> if you prefer."}, {"owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "reply_to_user": {"reputation": 1782, "user_id": 7970461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ee57a85b60ce9c462d95f972ea1811e?s=128&d=identicon&r=PG&f=1", "display_name": "R.J. Dunnill", "link": "https://stackoverflow.com/users/7970461/r-j-dunnill"}, "edited": false, "score": 0, "creation_date": 1565197721, "post_id": 57399227, "comment_id": 101280154, "body": "@R.J.Dunnill, C++ understands a non-null terminated buffer representing a string when you specify the size."}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "reply_to_user": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 0, "creation_date": 1565197753, "post_id": 57399227, "comment_id": 101280170, "body": "@KonradRudolph It clearly isn&#39;t."}, {"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "reply_to_user": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 3, "creation_date": 1565197840, "post_id": 57399227, "comment_id": 101280212, "body": "@LeeDanielCrocker Please actually <b>read</b> the question, not just the code. OP has C++ code; but they want to know how to do the same in C."}, {"owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 0, "creation_date": 1565197876, "post_id": 57399227, "comment_id": 101280234, "body": "If the question is about C, then he should include C code."}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "reply_to_user": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 2, "creation_date": 1565197892, "post_id": 57399227, "comment_id": 101280243, "body": "@Konrad OK, sorry for the mess. I misread."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 0, "creation_date": 1565198801, "post_id": 57399227, "comment_id": 101280668, "body": "@KonradRudolph As per C++ and C tag policies, it is fine to use both tags for questions regarding &quot;Compatibility or porting code between C and C++&quot;. This tag usage is the community consensus - it should have both tags. <a href=\"https://stackoverflow.com/tags/c%2b%2b/info\">stackoverflow.com/tags/c%2b%2b/info</a>"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1565198956, "post_id": 57399227, "comment_id": 101280746, "body": "I&#39;ll add both tags. Anyone disagreeing kindly take it up on meta <a href=\"https://meta.stackoverflow.com/questions/374306/proposed-update-to-c-and-c-tag-usage-wikis\">here</a> instead of vandalizing this question with edits."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 0, "creation_date": 1565199546, "post_id": 57399227, "comment_id": 101280979, "body": "@LeeDanielCrocker: Requesting how to do something in C code does not require supplying C code as an example. Supplying C++ code to explain or illustrate some part of their question is fine, and it does not mean their question is about C++."}, {"owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 0, "creation_date": 1565202468, "post_id": 57399227, "comment_id": 101282194, "body": "Fair enough. Though we generally prefer &quot;here&#39;s my code, what&#39;s wrong&quot; questions to &quot;how do I write...&quot; questions."}, {"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565204993, "post_id": 57399227, "comment_id": 101283405, "body": "@Lundin I\u2019m not sure why you\u2019re addressing me: I\u2019m fine with both tags (although I don\u2019t find it strictly necessary here). I objected to people removing the C tag."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 0, "creation_date": 1565209909, "post_id": 57399227, "comment_id": 101285379, "body": "@LeeDanielCrocker: We who? Stack Overflow is a site for general programming questions and answers. \u201cWhat is wrong with this code?\u201d is a subset of suitable questions. As far as \u201cwe\u201d are concerned, it is at best a distraction from the main purpose and ought to be a minor subset. Most code with a bug does not exemplify general principles that would be useful for others to look up and learn from (and many of those that might just duplicate some previously explained issue, just in a different form is not conducive to searching). \u201cHow do I do X?\u201d questions are more suitable for the main purpose."}], "answers": [{"comments": [{"owner": {"reputation": 2078, "user_id": 1184801, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/03bdf23b59e23cfd6e479e4b0ba1eb35?s=128&d=identicon&r=PG", "display_name": "Dan James Palmer", "link": "https://stackoverflow.com/users/1184801/dan-james-palmer"}, "reply_to_user": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1565197780, "post_id": 57399288, "comment_id": 101280185, "body": "@\u03c0\u03ac\u03bd\u03c4\u03b1\u1fe5\u03b5\u1fd6 every changes my tags for the OP. The first line states the code IS in C++ but I want it in C. This works a treat and will accept when able"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 2078, "user_id": 1184801, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/03bdf23b59e23cfd6e479e4b0ba1eb35?s=128&d=identicon&r=PG", "display_name": "Dan James Palmer", "link": "https://stackoverflow.com/users/1184801/dan-james-palmer"}, "edited": false, "score": 0, "creation_date": 1565197857, "post_id": 57399288, "comment_id": 101280221, "body": "@DanJamesPalmer Please don&#39;t play games, even unintentionally. If you want C, show us C code. Don&#39;t use C++ as a way to demonstrate C code. <i>These are two different languages with different tools and approaches suitable to each</i>. That C++ can use C code is not a reason to confuse the two."}, {"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 6, "creation_date": 1565198105, "post_id": 57399288, "comment_id": 101280349, "body": "@tadman That\u2019s an unfair accusation. The tags say C, the title says C, the body of the question says C. We (me included!) are just all jumping at the sight of C++ code and ignore mentions of C in tags and title like Pavlovian dogs (because we\u2019ve been conditioned to expect mis-tagging between the two languages) but the question makes it clear why the C++ code is included, and how it\u2019s relevant and legitimate."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1565198199, "post_id": 57399288, "comment_id": 101280386, "body": "@KonradRudolph There is C++ code present which is a red herring, and that&#39;s really not called for. I&#39;m of the opinion that if there&#39;s C++ code in the question, it is, <i>by definition</i>, a C++ question and should be tagged as such. If you want C and C only, don&#39;t even go there, just use C and deal."}], "tags": [], "owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "is_accepted": true, "score": 12, "last_activity_date": 1565198190, "last_edit_date": 1565198190, "creation_date": 1565197639, "answer_id": 57399288, "question_id": 57399227, "link": "https://stackoverflow.com/questions/57399227/convert-c-byte-array-to-a-c-string/57399288#57399288", "title": "Convert C++ byte array to a C string", "body": "<p>Strings in C <em>are</em> byte arrays which are zero-terminated. So all you need to do is copy the array into a new buffer with sufficient space for a trailing zero byte:</p>\n\n<pre><code>#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n\ntypedef unsigned char BYTE;\n\nint main() {\n    BYTE byteArray[5] = { 0x48, 0x65, 0x6C, 0x6C, 0x6F };\n    char str[(sizeof byteArray) + 1];\n    memcpy(str, byteArray, sizeof byteArray);\n    str[sizeof byteArray] = 0; // Null termination.\n    printf(\"%s\\n\", str);\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "edited": false, "score": 0, "creation_date": 1565197747, "post_id": 57399305, "comment_id": 101280166, "body": "You&#39;re missing the <code>&#39;\\0&#39;</code>."}, {"owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "edited": false, "score": 0, "creation_date": 1565197973, "post_id": 57399305, "comment_id": 101280286, "body": "It looks slow. Why clear the entire buffer before a copy? Also <code>strcpy()</code> is incorrect since the source is not null terminated."}, {"owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "reply_to_user": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "edited": false, "score": 1, "creation_date": 1565198129, "post_id": 57399305, "comment_id": 101280361, "body": "@AlexisWilke right, I could just <code>memcpy()</code>, which doesn&#39;t need a cast also. No need to clear indeed, I could just append the NULL terminator, right?"}], "tags": [], "owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "is_accepted": false, "score": 1, "last_activity_date": 1565199615, "last_edit_date": 1565199615, "creation_date": 1565197693, "answer_id": 57399305, "question_id": 57399227, "link": "https://stackoverflow.com/questions/57399227/convert-c-byte-array-to-a-c-string/57399305#57399305", "title": "Convert C++ byte array to a C string", "body": "<p>C strings are null terminated, so the size of the string will be the size of the array plus one, for the null terminator. Then you could use <a href=\"http://www.cplusplus.com/reference/cstring/memcpy/\" rel=\"nofollow noreferrer\"><code>memcpy()</code></a> to copy the string, like this:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\ntypedef unsigned char BYTE;\n\nint main(void)\n{\n  BYTE byteArray[5] = { 0x48, 0x65, 0x6C, 0x6C, 0x6F };\n\n  // +1 for the NULL terminator\n  char str[sizeof(byteArray) + 1];\n  // Copy contents\n  memcpy(str, byteArray, sizeof(byteArray));\n  // Append NULL terminator\n  str[sizeof(byteArray)] = '\\0';\n\n  printf(\"%s\\n\", str);    \n  return EXIT_SUCCESS;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<blockquote>\n  <p>Hello</p>\n</blockquote>\n\n<p><a href=\"https://wandbox.org/permlink/mz0T7rUlQ0eVKd4B\" rel=\"nofollow noreferrer\">Run it online</a></p>\n"}, {"comments": [{"owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "edited": false, "score": 1, "creation_date": 1565198063, "post_id": 57399336, "comment_id": 101280329, "body": "Only if the string is really large the <code>.. = { &#39;\\0&#39; }</code> is going to be a real waste."}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "reply_to_user": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "edited": false, "score": 0, "creation_date": 1565198113, "post_id": 57399336, "comment_id": 101280352, "body": "@AlexisWilke So as I said the terminating zero can be appended manually.:)"}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "reply_to_user": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "edited": false, "score": 1, "creation_date": 1565198267, "post_id": 57399336, "comment_id": 101280418, "body": "@gsamaras No I need not. But this variant is already shown in my answer.:)"}, {"owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "edited": false, "score": 0, "creation_date": 1565198484, "post_id": 57399336, "comment_id": 101280509, "body": "I thought you meant <code>s</code> as the <code>byteArray</code>, which would be wrong, now it&#39;s fine, misread that, \u03c3\u03c5\u03b3\u03b3\u03bd\u03ce\u03bc\u03b7! :)"}], "tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 0, "last_activity_date": 1565198521, "last_edit_date": 1565198521, "creation_date": 1565197877, "answer_id": 57399336, "question_id": 57399227, "link": "https://stackoverflow.com/questions/57399227/convert-c-byte-array-to-a-c-string/57399336#57399336", "title": "Convert C++ byte array to a C string", "body": "<p>Here is a demonstrative program that shows how it can be done.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\ntypedef unsigned char BYTE;\n\nint main(void) \n{\n    BYTE byteArray[5] = { 0x48, 0x65, 0x6C, 0x6C, 0x6F };\n    char s[sizeof( byteArray ) + sizeof( ( char )'\\0' )] = { '\\0' };\n\n    memcpy( s, byteArray, sizeof( byteArray ) );\n\n    puts( s );\n\n    return 0;\n}\n</code></pre>\n\n<p>The program output is</p>\n\n<pre><code>Hello\n</code></pre>\n\n<p>Pay attention to that the character array is zero initialized. Otherwise after the call of memcpy you have to append the terminating zero \"manually\".</p>\n\n<pre><code>s[sizeof( s ) - 1] = '\\0';\n</code></pre>\n\n<p>or </p>\n\n<pre><code>s[sizeof( byteArray )] = '\\0';\n</code></pre>\n\n<p>The last variant should be used when the size of the character array much greater than the size of byteArray.</p>\n"}], "owner": {"reputation": 2078, "user_id": 1184801, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/03bdf23b59e23cfd6e479e4b0ba1eb35?s=128&d=identicon&r=PG", "display_name": "Dan James Palmer", "link": "https://stackoverflow.com/users/1184801/dan-james-palmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8743, "favorite_count": 0, "accepted_answer_id": 57399288, "answer_count": 3, "score": 1, "last_activity_date": 1565203289, "creation_date": 1565197322, "last_edit_date": 1565203289, "question_id": 57399227, "link": "https://stackoverflow.com/questions/57399227/convert-c-byte-array-to-a-c-string", "title": "Convert C++ byte array to a C string", "body": "<p>I'm trying to convert a byte array to a string in C but I can't quite figure it out.</p>\n\n<p>I have an example of what works for me in C++ but I need to convert it to C.</p>\n\n<p>The C++ code is below:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n\ntypedef unsigned char BYTE;\n\nint main(int argc, char *argv[])\n{\n  BYTE byteArray[5] = { 0x48, 0x65, 0x6C, 0x6C, 0x6F };\n  std::string s(reinterpret_cast&lt;char*&gt;(byteArray), sizeof(byteArray));\n  std::cout &lt;&lt; s &lt;&lt; std::endl;\n\n  return EXIT_SUCCESS;\n}\n</code></pre>\n\n<p>Can anyone point me in the right direction?</p>\n"}, {"tags": ["c", "segmentation-fault", "strlen"], "comments": [{"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 0, "creation_date": 1565197154, "post_id": 57399158, "comment_id": 101279876, "body": "It is not strlen that gives the segmentation fault. Use  printf(&quot;%s&quot;,&amp;s[j]); and printf(&quot;%s&quot;,&amp;s[k]) Or printf(&quot;%s&quot;,s + j); and printf(&quot;%s&quot;,s + k); If you want to output just one character then use the format specifier %c. For example printf(&quot;%c&quot;,s[j]);"}, {"owner": {"reputation": 1440, "user_id": 7973906, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/54a6d0e27146b174dd6a6c3cb5e54392?s=128&d=identicon&r=PG&f=1", "display_name": "j3141592653589793238", "link": "https://stackoverflow.com/users/7973906/j3141592653589793238"}, "edited": false, "score": 3, "creation_date": 1565197175, "post_id": 57399158, "comment_id": 101279890, "body": "I&#39;d recommend not even using <code>scanf()</code> to read strings from stdin. Instead, better use <code>fgets()</code>."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565197500, "post_id": 57399158, "comment_id": 101280041, "body": "This should be <code>scanf(&quot;%1023s&quot;, s);</code>."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1565197988, "post_id": 57399158, "comment_id": 101280296, "body": "<code>scanf</code> is a crutch you need to stop using as soon as possible. I&#39;ve seen way too many snippets of C code here where the problem is working around limitations of that tool. You also need to pay attention to return codes. <code>scanf</code> can return an error condition, which you completely ignore. You should also compile with all warnings turned on, <code>-Wall</code>, to be informed of any potential issues you may not be aware of."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1565198066, "post_id": 57399158, "comment_id": 101280330, "body": "@tadman Its error return is 0, in case anybody was wondering. That means that no format specifiers were matched."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565198121, "post_id": 57399158, "comment_id": 101280359, "body": "@JL2210 On what input data?"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565198231, "post_id": 57399158, "comment_id": 101280404, "body": "@mohamedArshad Did you want to print only half of the strings or print parts of the string more than once?"}], "answers": [{"tags": [], "owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "is_accepted": true, "score": 1, "last_activity_date": 1565198132, "last_edit_date": 1565198132, "creation_date": 1565197636, "answer_id": 57399287, "question_id": 57399158, "link": "https://stackoverflow.com/questions/57399158/strlen-gives-segmentation-fault-in-loop/57399287#57399287", "title": "strlen gives segmentation fault in loop", "body": "<p>These two lines:</p>\n\n<pre><code>printf(\"%s\",s[j]);\n...\nprintf(\"%s\",s[k]);\n</code></pre>\n\n<p>are printing characters as strings. Instead, do this:</p>\n\n<pre><code>printf(\"%c\",s[j]);\n...\nprintf(\"%c\",s[k]);\n</code></pre>\n\n<hr>\n\n<p>Also, to avoid buffer overflows, you should do this:</p>\n\n<pre><code>scanf(\"%1023s\", s);\n</code></pre>\n\n<p>instead of this:</p>\n\n<pre><code>scanf(\"%s\", s);\n</code></pre>\n\n<hr>\n\n<p>Full code with fixes (including declaring <code>main</code> as <code>int main(void)</code>):</p>\n\n<pre><code>int main(void) {\n    int n,c;\n    char s[1024];\n    scanf(\"%d\",&amp;n);\n    for(int i=0;i&lt;n;i++)\n    {\n        scanf(\"%1023s\", s);\n        c=strlen(s);\n        for(int j=0;j&lt;c;j+=2)\n        {\n            printf(\"%s\", &amp;s[j]);\n        }\n        printf(\" \");\n        for(int k=1;k&lt;c;k+=2)\n        {\n            printf(\"%s\", &amp;s[k]);\n        }\n\n    }\n\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 11897377, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-uFlSfAayQcY/AAAAAAAAAAI/AAAAAAAAOfY/zhdsP4s7-jQ/photo.jpg?sz=128", "display_name": "mohamed Arshad", "link": "https://stackoverflow.com/users/11897377/mohamed-arshad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "closed_date": 1565415446, "accepted_answer_id": 57399287, "answer_count": 1, "score": -2, "last_activity_date": 1565198734, "creation_date": 1565197060, "last_edit_date": 1565197973, "question_id": 57399158, "link": "https://stackoverflow.com/questions/57399158/strlen-gives-segmentation-fault-in-loop", "closed_reason": "Needs more focus", "title": "strlen gives segmentation fault in loop", "body": "<p>on a hackerrank problem i need to get the no of elements in string,\nhow to get strlen to work without giving segmentation fault</p>\n\n<p>already searched and got similar results that includes telling to put \"\\0\"\nat the end of string but idk how it works</p>\n\n<pre><code>int main() {\n\n    int n,c;\n    char s[1024];\n    scanf(\"%d\",&amp;n);\n    for(int i=0;i&lt;n;i++)\n    {\n        scanf(\"%s\", s);\n        c=strlen(s);\n        for(int j=0;j&lt;c;j+=2)\n        {\n            printf(\"%s\",s[j]);\n        }\n        printf(\" \");\n        for(int k=1;k&lt;c;k+=2)\n        {\n            printf(\"%s\",s[k]);\n        }\n\n    }\n\n\n    return 0;\n}\n</code></pre>\n\n<p>please explain me how to use strlen or any other alternative like isspace in this or a code to count the characters</p>\n"}, {"tags": ["c", "qr-code", "pixel"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1565196800, "post_id": 57399097, "comment_id": 101279724, "body": "I will bet that you bottleneck is not the loop, but the IO operation itself."}, {"owner": {"reputation": 1, "user_id": 11897192, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc4fa72eda67dc3d6cef59148aea68a7?s=128&d=identicon&r=PG&f=1", "display_name": "the_learning_kid", "link": "https://stackoverflow.com/users/11897192/the-learning-kid"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1565197064, "post_id": 57399097, "comment_id": 101279838, "body": "any way to improve that? coz i ve seen lot of displays doing that at great speed."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 3, "creation_date": 1565197182, "post_id": 57399097, "comment_id": 101279896, "body": "Only you know about the device internals and limitations at this point."}, {"owner": {"reputation": 144819, "user_id": 2836621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/suHg4.jpg?s=128&g=1", "display_name": "Mark Setchell", "link": "https://stackoverflow.com/users/2836621/mark-setchell"}, "edited": false, "score": 0, "creation_date": 1565197313, "post_id": 57399097, "comment_id": 101279955, "body": "Maybe you could clarify if this is a Raspberry Pi? And what device you have attached? And how?"}, {"owner": {"reputation": 144819, "user_id": 2836621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/suHg4.jpg?s=128&g=1", "display_name": "Mark Setchell", "link": "https://stackoverflow.com/users/2836621/mark-setchell"}, "edited": false, "score": 4, "creation_date": 1565197392, "post_id": 57399097, "comment_id": 101279996, "body": "Any reason you aren&#39;t using a library to update the screen? Do you know if it accepts bulk DMA or blitting?"}, {"owner": {"reputation": 529, "user_id": 11877195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ed77976acc203f50e7699ba07061865?s=128&d=identicon&r=PG&f=1", "display_name": "Sahsahae", "link": "https://stackoverflow.com/users/11877195/sahsahae"}, "edited": false, "score": 0, "creation_date": 1565198378, "post_id": 57399097, "comment_id": 101280462, "body": "Direct writing is slow, it means that your updated buffer needs to be redrawn for every change... Accessing data that&#39;s used to draw things directly to screen isn&#39;t as simple as it sounds, more often than not, it needs to be synchronized and that&#39;s very slow.  Maybe the only thing missing in here is double/triple buffering?"}], "answers": [{"tags": [], "owner": {"reputation": 186, "user_id": 4446393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a28f271bd64ad2a1d210b540cf1df19?s=128&d=identicon&r=PG&f=1", "display_name": "flott", "link": "https://stackoverflow.com/users/4446393/flott"}, "is_accepted": false, "score": 0, "last_activity_date": 1565261633, "creation_date": 1565261633, "answer_id": 57410940, "question_id": 57399097, "link": "https://stackoverflow.com/questions/57399097/how-can-i-print-array-of-pixels-at-a-faster-rate/57410940#57410940", "title": "How can i print array of pixels at a faster rate?", "body": "<p>As others already pointed out, the problem is probably that when you end a write sequence with <code>CS_IDLE</code> the controller (perhaps, I have not studied the datasheet very carefully) updates the whole display. I would suggest that you do something like this:</p>\n\n<ol>\n<li><code>CS_ACTIVE</code></li>\n<li><code>setAddrWindow(0, 0, TFTWIDTH-1, TFTHEIGHT-1);</code></li>\n<li><code>CD_COMMAND</code></li>\n<li><code>WriteComm(ST7735S_MEMORYWRITE)</code></li>\n<li>Write <strong>all</strong> display pixels (a whole frame), meaning that you also write the \"background\" pixels to white or what ever background you have defined. I looked at the ST7735S datasheet and it can automatically increment the x and y addresses. From the datasheet:</li>\n</ol>\n\n<blockquote>\n  <p>In horizontal addressing mode (V=0), the X-address increments after\n  each byte, after the last X-address (X=XE), X wraps around to XS and Y\n  increments to address the next row. After the every last address (X=XE\n  and Y=YE) the address pointers wrap around to address (X=XS and\n  Y=YS).</p>\n</blockquote>\n\n<ol start=\"6\">\n<li><code>CS_IDLE</code></li>\n</ol>\n\n<p>This way you also decrease the overhead of addressing the pixels from once every pixel to once for each frame. Give it a try and see if it performs faster.</p>\n"}], "owner": {"reputation": 1, "user_id": 11897192, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc4fa72eda67dc3d6cef59148aea68a7?s=128&d=identicon&r=PG&f=1", "display_name": "the_learning_kid", "link": "https://stackoverflow.com/users/11897192/the-learning-kid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1565261633, "creation_date": 1565196740, "last_edit_date": 1565198048, "question_id": 57399097, "link": "https://stackoverflow.com/questions/57399097/how-can-i-print-array-of-pixels-at-a-faster-rate", "title": "How can i print array of pixels at a faster rate?", "body": "<p>I've got an array of values and they need to be printed on the TFT screen(128*128). In the code below as we can see I've used scale variable (which print pixel to its adjacent cells ) which takes 2 loops and prints pixel by pixel. Is there a faster way of doing this, if so plz let me know...!\nAs I am not from an electronics background it will be great if things are explained in human language...!</p>\n\n<p>I've tried using bitmap which again prints pixel by pixel!</p>\n\n<pre><code>void draw_qr1(uint8_t x, uint8_t y,sFONT* font, uint8_t scale,uint16_t colored)\n{\n    int *ptr;\n    int i, j;\n    int p,q;\n\n    ptr=Fontr.table;    //ptr to array \n    for (j = 0; j &lt; font-&gt;Height; j++) {    //columns\n        for (i = 0; i &lt; font-&gt;Width; i++) {     //rows\n\n\n            if ((*ptr) &amp; (0x80 &gt;&gt; (i % 8))) {\n                for(p=0;p&lt;scale;p++)         /*scaling done here*/\n                for(q=0;q&lt;scale;q++)\n                {\n                    drawPixel(x+i*scale+q,y+j*scale+p,BLACK);\n                }\n\n\n            }\n\n            if (i % 8 == 7) {\n                ptr++;\n            }\n        }\n        if (font-&gt;Width % 8 != 0) {\n            ptr++;\n        }\n    }\n}\n</code></pre>\n\n<pre><code>void drawPixel(int16_t x, int16_t y, uint16_t color) {\n    int point_temp=0;\n    // Clip\n    if((x &lt; 0) || (y &lt; 0) || (x &gt;= TFTWIDTH) || (y &gt;= TFTHEIGHT)) return;\n\n    x = TFTWIDTH - x;\n    y = TFTHEIGHT - y;\n\n\n    setAddrWindow(x, y, TFTWIDTH-1, TFTHEIGHT-1);\n\n\n    CS_ACTIVE;\n    CD_COMMAND;\n\n\n    WriteComm(ST7735S_MEMORYWRITE);     //0x2C is MEMORYWRITE command\n\n\n    WriteData(color &gt;&gt; 8);\n    WriteData(color);\n\n\n    CS_IDLE;\n}\n</code></pre>\n"}, {"tags": ["c", "cs50"], "comments": [{"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 9, "creation_date": 1565194767, "post_id": 57398583, "comment_id": 101278709, "body": "<a href=\"https://codereview.stackexchange.com\">Code Review</a> is a better place to ask for advice on improving coding style for working code."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1565194830, "post_id": 57398583, "comment_id": 101278737, "body": "There isn&#39;t really much simplification you can make, although since you have the same loops multiple times, you could put those into functions."}, {"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 2, "creation_date": 1565195216, "post_id": 57398583, "comment_id": 101278930, "body": "Instead of using <code>printf</code>, you should use <code>putchar</code> for a single character."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565195388, "post_id": 57398583, "comment_id": 101279027, "body": "You did not show the code that inputs the height, but I venture to say that part might be <i>too</i> simple, as user input needs to be rigorous."}], "answers": [{"tags": [], "owner": {"reputation": 6544, "user_id": 451601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/164602d512ce01f188e5a50593b46c5f?s=128&d=identicon&r=PG", "display_name": "James K. Lowden", "link": "https://stackoverflow.com/users/451601/james-k-lowden"}, "is_accepted": true, "score": 1, "last_activity_date": 1565197290, "creation_date": 1565197290, "answer_id": 57399216, "question_id": 57398583, "link": "https://stackoverflow.com/questions/57398583/is-there-any-way-i-can-make-this-code-any-simpler/57399216#57399216", "title": "Is there any way I can make this code any simpler?", "body": "<p>The following is more efficient and afaict produces the same results: </p>\n\n<pre><code>static char hashes[80];\nmemset(hashes, '#', sizeof(hashes));\nassert( height &lt; sizeof(hashes) );\n\nfor( int line=0; line &lt; height; line++ ) {\n  printf( \"%*.*s  %-*.*s\\n\",\n    height, line+1, hashes,\n    height, line+1, hashes );\n}\n</code></pre>\n\n<p>You're a beginner, and there's more there than meets the eye.  The \"trick\" is that <strong>printf</strong>(3) has a language all its own in its format string, a language that's daunting at first.  Since your output is constant (hashes), you can work from a constant string and \"format\" the field by setting its size, truncating the string, and choosing left- or right-justification.  </p>\n\n<p>In learning C, you have to learn how to construct loops.  In using C, you have to learn the C standard library (and other libraries for the problem domain).  Frequently, those libraries let you avoid loops and thus simplify your code.  </p>\n"}], "owner": {"reputation": 23, "user_id": 11893423, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ho6U9PILOdo/AAAAAAAAAAI/AAAAAAAAAyA/5UusniMlEVM/photo.jpg?sz=128", "display_name": "NuNu Duck", "link": "https://stackoverflow.com/users/11893423/nunu-duck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "closed_date": 1565248963, "accepted_answer_id": 57399216, "answer_count": 1, "score": 0, "last_activity_date": 1565197290, "creation_date": 1565194630, "last_edit_date": 1565195604, "question_id": 57398583, "link": "https://stackoverflow.com/questions/57398583/is-there-any-way-i-can-make-this-code-any-simpler", "closed_reason": "Opinion-based", "title": "Is there any way I can make this code any simpler?", "body": "<p>I'm a beginner programmer learning C through the CS50 online course provided by Harvard. This program is supposed to prompt the user for a Height and when they type the height(1-8), a pyramid is printed according to the height inputted by the user. When you type 2, it outputs a tiny pyramid 2 lines tall with 2 spaces in the middle. My program does what it's supposed to do but I'm sure there's a better way than nesting loops. </p>\n\n<p>I've tried making one loop for one side of the pyramid instead of 2 loops. I think it was the right approach but it was executed horribly.</p>\n\n<pre><code>{\n\n    for (int spaces = height - line; spaces &gt; 1; spaces--)\n    {\n        printf(\" \");\n\n    }\n    for (int hashes = 0; hashes &lt; line + 1; hashes++)\n    {\n        printf(\"#\");\n    }\n\n    printf(\"  \");\n\n    for (int hashes = 0; hashes &lt; line + 1; hashes++)\n    {\n        printf(\"#\");\n    }\n    for (int spaces = height - line; spaces &gt; 1; spaces--)\n    {\n        printf(\" \");\n    }\n    printf(\"\\n\");\n\n}\n</code></pre>\n"}, {"tags": ["c", "winapi"], "comments": [{"owner": {"reputation": 17331, "user_id": 8950365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c6ba3b19f86f1bea8cf76e691db4349?s=128&d=identicon&r=PG&f=1", "display_name": "rafix07", "link": "https://stackoverflow.com/users/8950365/rafix07"}, "edited": false, "score": 3, "creation_date": 1565194383, "post_id": 57398499, "comment_id": 101278517, "body": "Why <code>text_box</code>  is local variable ? Every time window procedure is called this variable is created, so when <code>WM_COMMAND</code> message is processed this var is uninitialized. Make it <code>static</code> and try again."}, {"owner": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 1, "creation_date": 1565195001, "post_id": 57398499, "comment_id": 101278824, "body": "Please don&#39;t edit the question to say solved. If you want, you can add an answer. Although this is a dupe many times over so I don&#39;t think it will help future readers."}], "answers": [{"comments": [{"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1565206367, "post_id": 57398892, "comment_id": 101283974, "body": "The downside to this approach is that <code>WndProc()</code> would then only be usable for 1 parent <code>HWND</code> at a time. If you needed to make multiple instances of the parent widow, each with their own text box, the alternative would be to assign an ID number to the text box when creating it with <code>CreateWindow()</code> (change <code>(HMENU) 0</code> to <code>(HMENU) IDNumber</code>), and then the <code>WM_COMMAND</code> handler could use <a href=\"https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getdlgitem\" rel=\"nofollow noreferrer\"><code>GetDlgItem()</code></a> to get the calling parent&#39;s text box <code>HWND</code> from that ID: <code>GetWindowTextLength(GetDlgItem(hwnd, IDNumber))</code>"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1565206954, "post_id": 57398892, "comment_id": 101284218, "body": "@RemyLebeau I&#39;m not a Windows expert by any means. Please ask rafix07 (and feel free to edit, this is Community Wiki, after all)."}], "tags": [], "owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "is_accepted": true, "score": 0, "last_activity_date": 1565195876, "creation_date": 1565195876, "answer_id": 57398892, "question_id": 57398499, "link": "https://stackoverflow.com/questions/57398499/getwindowtextlength-returns-0-supposedly-because-of-invalid-window-handle/57398892#57398892", "title": "GetWindowTextLength() returns 0, supposedly because of invalid window handle", "body": "<p>Based on <a href=\"https://stackoverflow.com/questions/57398499/getwindowtextlength-returns-0-supposedly-because-of-invalid-window-handle#comment101278517_57398499\">a comment by rafix07</a>:</p>\n\n<p>You need to make <code>text_box</code> <code>static</code>. Every time the window procedure is called this variable is created, so when the <code>WM_COMMAND</code> message is processed this variable is uninitialized.</p>\n\n<p>To make <code>text_box</code> <code>static</code>, do this:</p>\n\n<pre><code>static HWND text_box; \n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 10304284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5199851395f7d8f46498056036ef766?s=128&d=identicon&r=PG&f=1", "display_name": "ntonk", "link": "https://stackoverflow.com/users/10304284/ntonk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 57398892, "answer_count": 1, "score": -1, "last_activity_date": 1565195876, "creation_date": 1565194316, "last_edit_date": 1565194954, "question_id": 57398499, "link": "https://stackoverflow.com/questions/57398499/getwindowtextlength-returns-0-supposedly-because-of-invalid-window-handle", "title": "GetWindowTextLength() returns 0, supposedly because of invalid window handle", "body": "<p>I'm trying to build a simple graph plotting application with C and Windows API for studying purposes. It is supposed to take user's input containing a math function of one real variable and then to plot it. I tried to implement user's input capabilities by creating textbox and submit button through calling CreateWindow() from the callback window function. However, when I attempted to test the textbox by evaluating input text size, I received 0 under any conditions (I also made sure that it is not an ASCII/UNICODE issue). GetLastError() got 1400 error code, i.e. invalid window handle. What could be possible reasons for this error and why respective window handle is considered invalid?</p>\n\n<p>I'm using Bloodshed Dev-C++ 5.11 on Windows 10 x64 with 64-bit TDM-GCC 4.9.2.</p>\n\n<p>Please find below the piece of callback function that is causing problems: </p>\n\n<pre><code>\n    LRESULT CALLBACK WndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam){\n        int len;\n        (...other declarations go here...)\n        HWND text_box; \n        HWND plot_button;\n\n        switch (message){ \n            case WM_CREATE:\n                text_box = CreateWindow(\"EDIT\",\n                                       \"\",\n                                       WS_BORDER | WS_CHILD | WS_VISIBLE,\n                                       10, 5, 390, 20,\n                                       hwnd, (HMENU) 0, NULL, NULL);\n                plot_button = CreateWindow(\"BUTTON\",\n                             \"Plot\",\n                             WS_VISIBLE | WS_CHILD | WS_BORDER,\n                             420, 5, 165, 20,\n                             hwnd, (HMENU) 1, NULL, NULL);\n                break;\n\n            case WM_COMMAND:\n                switch(LOWORD(wParam)){\n                    case 1: \n                        len = GetWindowTextLength(text_box); \n                        printf(\"%d\", len); // a simple console output for testing purposes only, returns 0 disregarding the text length\n                    (...other irrelevant code...)\n                    break;\n                }\n            break;\n         (...other irrelevant code...)\n    }\n\n</code></pre>\n"}, {"tags": ["ios", "c", "swift", "closures", "objective-c-blocks"], "answers": [{"comments": [{"owner": {"reputation": 1440, "user_id": 7973906, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/54a6d0e27146b174dd6a6c3cb5e54392?s=128&d=identicon&r=PG&f=1", "display_name": "j3141592653589793238", "link": "https://stackoverflow.com/users/7973906/j3141592653589793238"}, "edited": false, "score": 0, "creation_date": 1565796373, "post_id": 57487793, "comment_id": 101465148, "body": "Thanks for your answer. <code>At this point I can&#39;t give a good technical explanation as to why the above works.</code> I&#39;m even more curious about why Swift closures cannot always be passed to C functions, specifically regarding my example above. At the time, we just changed the C block to a C function pointer, which literally works the same and, luckily, worked fine. Anyways, I still think your solution is quite helpful to people who don&#39;t have direct access to the underlaying C code. Btw, do you think I could/should try filing a bug report?"}, {"owner": {"reputation": 4371, "user_id": 5196056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82e60f19699f947713c612d70b80524a?s=128&d=identicon&r=PG&f=1", "display_name": "Anatoli P", "link": "https://stackoverflow.com/users/5196056/anatoli-p"}, "reply_to_user": {"reputation": 1440, "user_id": 7973906, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/54a6d0e27146b174dd6a6c3cb5e54392?s=128&d=identicon&r=PG&f=1", "display_name": "j3141592653589793238", "link": "https://stackoverflow.com/users/7973906/j3141592653589793238"}, "edited": false, "score": 1, "creation_date": 1565926226, "post_id": 57487793, "comment_id": 101504838, "body": "Indeed, it is really strange that changing blocks to function pointers makes the code work, which I double-checked.  Another interesting observation is that the code seems to be looping for awhile before crashing (try inserting a <code>puts()</code> at the beginning of <code>api_trigger_block()</code>).  As for submitting a bug report, I would suggest asking another, even shorter, question that shows function pointers working, while blocks don&#39;t.  If no one comes up with a good explanation, I&#39;d file a bug report."}], "tags": [], "owner": {"reputation": 4371, "user_id": 5196056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82e60f19699f947713c612d70b80524a?s=128&d=identicon&r=PG&f=1", "display_name": "Anatoli P", "link": "https://stackoverflow.com/users/5196056/anatoli-p"}, "is_accepted": true, "score": 1, "last_activity_date": 1565753082, "creation_date": 1565753082, "answer_id": 57487793, "question_id": 57397906, "link": "https://stackoverflow.com/questions/57397906/exc-bad-access-exception-when-calling-a-swift-closure-from-c/57487793#57487793", "title": "EXC_BAD_ACCESS exception when calling a Swift closure from C", "body": "<p>Thank you for the interesting question.</p>\n\n<p>I see a few options.  </p>\n\n<p><strong>Option 1:</strong></p>\n\n<p>If you have control over the C API, make (some part of) it Objective-C by just changing the extension from <code>.c</code> to <code>.m</code>.  Then your Swift code should interoperate with it just fine.  At least the part of it that directly interacts with Swift code should be made Objective-C.  Objective-C portion will hopefully be interoperable with the remaining C parts (the ones in <code>.c</code> files).</p>\n\n<p><strong>Option 2:</strong></p>\n\n<p>Write an Objective-C wrapper (in a <code>.m</code> file) around the C API and use the wrapper in Swift code.  Sample wrapper based on your example:</p>\n\n<pre><code>// This is where we store the block passed in from Swift\nvoid (^cb_block_cb2)(int, int) = NULL;\n\n// This wrapper will be used in the block passed to C API\nvoid block_wrapper(int i1, int i2) {\n    cb_block_cb2(i1, i2);\n}\n\n// Obj-C wrapper around C API block setter\n// Make this available to Swift, e.g. via bridging header.\nvoid api_set_callback_block2(void (^cb_block)(int, int))\n{\n    if (cb_block == NULL)\n    {\n        puts(\"error: when setting callback block: cb_block is null\");\n        return;\n    }\n    cb_block_cb2 = cb_block;\n    api_set_callback_block(^(int a, int b){ block_wrapper(a, b);});\n}\n\n// Obj-C wrapper around C API block trigger\n// Make this available to Swift, e.g. via bridging header.\nvoid api_trigger_block2()\n{\n    puts(\"Entered api_trigger_block2()\");\n    if (cb_block_cb2 == NULL)\n    {\n        puts(\"error: when triggering callback block: cb_block_cb2 is null\");\n        return;\n    }\n    api_trigger_block();\n    puts(\"Returned from callback in api_trigger_block2()!!!!\");\n}\n</code></pre>\n\n<p>Conceptually, the above options are similar.  You may be able to come up with some other options along the same lines.  At this point I can't give a good technical explanation as to why the above works.  As far as I can tell from experimenting, Swift functions/closures can't always be passed to C functions compiled with a C compiler and taking compatible blocks.  However, it works fine if the same functions are compiled as Objective-C.  A block defined in an Objective-C file can be passed to C code just fine.  </p>\n\n<p>For the record, I also tried using <code>@objc</code> and <code>@convention(c)</code> annotations in Swift code trying to fix this, but to no avail.</p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 1440, "user_id": 7973906, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/54a6d0e27146b174dd6a6c3cb5e54392?s=128&d=identicon&r=PG&f=1", "display_name": "j3141592653589793238", "link": "https://stackoverflow.com/users/7973906/j3141592653589793238"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 458, "favorite_count": 1, "accepted_answer_id": 57487793, "answer_count": 1, "score": 1, "last_activity_date": 1565753082, "creation_date": 1565192077, "last_edit_date": 1565344691, "question_id": 57397906, "link": "https://stackoverflow.com/questions/57397906/exc-bad-access-exception-when-calling-a-swift-closure-from-c", "title": "EXC_BAD_ACCESS exception when calling a Swift closure from C", "body": "<p>I'm trying to call a Swift closure from C. </p>\n\n<p>The following piece of code shall represent what I'm currently working on.</p>\n\n<p>First, in Swift, I initialize a static constant, the closure that is supposed to be called later.</p>\n\n<p>This closure is then passed to a C function (<code>api_set_callback_block</code>) that stores the block pointer.</p>\n\n<p>Some time after that, the C function <code>api_trigger_block</code> is called. This function should invoke the Swift closure. Instead of doing so, it always throws a runtime error: EXC_BAD_ACCESS when trying to access <code>cb_block_cb()</code> (also see below).</p>\n\n<p>Usually, this should mean that something tries to access a previously stored variable was deallocated. However, I don't get how that could be the case as I was passing a static constant.</p>\n\n<p>I double-checked that <code>cb_block_cb</code> is not NULL when accessing it.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>void (^cb_block_cb)(int, int) = NULL;\nvoid api_set_callback_block(void (^cb_block)(int, int))\n{\n    if (cb_block == NULL)\n    {\n        puts(\"error: when setting callback block: cb_block is null\");\n        return;\n    }\n    cb_block_cb = cb_block;\n}\n\nvoid api_trigger_block()\n{\n    if (cb_block_cb == NULL)\n    {\n        puts(\"error: when triggering callback block: cb_block_cb is null\");\n        return;\n    }\n    cb_block_cb(3,3); // &lt;-- This is where the exception gets thrown\n}\n</code></pre>\n\n<pre class=\"lang-swift prettyprint-override\"><code>class CustomClass: NSObject {\n    public static let callback: (Int32, Int32) -&gt; Swift.Void = { (cid, aid) in\n        print(\"Callback block called!\")\n    }\n}\n\n@UIApplicationMain\nclass AppDelegate: UIResponder, UIApplicationDelegate {\n\n    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool {\n        // Override point for customization after application launch.\n\n        api_set_callback_block(CustomClass.callback)\n\n        DispatchQueue.main.asyncAfter(deadline: .now() + 7) {\n            api_trigger_block()\n        }\n        return true\n    }\n\n    // ...\n}\n</code></pre>\n"}, {"tags": ["c", "pointers", "struct"], "answers": [{"tags": [], "owner": {"reputation": 4756, "user_id": 10001688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvhzK.jpg?s=128&g=1", "display_name": "Michael Bianconi", "link": "https://stackoverflow.com/users/10001688/michael-bianconi"}, "is_accepted": true, "score": 0, "last_activity_date": 1565192336, "creation_date": 1565192336, "answer_id": 57397975, "question_id": 57397891, "link": "https://stackoverflow.com/questions/57397891/the-value-pointer-points-to-is-not-updated/57397975#57397975", "title": "the value pointer points to is not updated", "body": "<p><code>p</code> isn't actually pointing to <code>s2</code>!. You've copied <code>s2</code> into the address allocated at <code>p</code>. If you want <code>p</code> to point to <code>s2</code>, don't <code>malloc</code> it. Rather, simply say <code>struct S2 *p = &amp;s2;</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 0, "last_activity_date": 1565192435, "creation_date": 1565192435, "answer_id": 57398005, "question_id": 57397891, "link": "https://stackoverflow.com/questions/57397891/the-value-pointer-points-to-is-not-updated/57398005#57398005", "title": "the value pointer points to is not updated", "body": "<p><code>p</code> does not point to <code>s2</code>.  It points to allocated memory that contains a copy of what was in <code>s2</code> before it was modified.</p>\n"}, {"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 0, "last_activity_date": 1565194990, "last_edit_date": 1565194990, "creation_date": 1565194541, "answer_id": 57398557, "question_id": 57397891, "link": "https://stackoverflow.com/questions/57397891/the-value-pointer-points-to-is-not-updated/57398557#57398557", "title": "the value pointer points to is not updated", "body": "<p>After this initialization</p>\n\n<pre><code>struct S2 s2 = {1, 2, 3, 4};\n</code></pre>\n\n<p>the data members of the object <code>s2</code> have the following values</p>\n\n<pre><code>s2.p1 = 1;\ns2.s1.p1 = 2;\ns2.s1.p2 = 3;\ns2.p2 = 4;\n</code></pre>\n\n<p>Pay attention to that the pointer <code>p</code> points to a copy of the object <code>s2</code>. That is you have to objects one pointed to by the pointer <code>p</code> and other <code>s3</code> that became equal each other after the assignment</p>\n\n<pre><code>*p = s2;\n</code></pre>\n\n<p>bu they occupy different extents of memory.</p>\n\n<p>So taking into account this statement </p>\n\n<pre><code>s2.p1 = 0;\n</code></pre>\n\n<p>the expression </p>\n\n<pre><code>p-&gt;p1 + s2.p1 + p-&gt;p2 + p-&gt;s1.p2\n</code></pre>\n\n<p>is equivalent tp</p>\n\n<pre><code> 1 + 0 + 4 + 3 == 8\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11876580, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lkDA9i6ytW0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfPZBYjyir6Vo8ILnDeRw__p4Q_lQ/photo.jpg?sz=128", "display_name": "Yan Jin", "link": "https://stackoverflow.com/users/11876580/yan-jin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 57397975, "answer_count": 3, "score": 0, "last_activity_date": 1565195157, "creation_date": 1565192025, "question_id": 57397891, "link": "https://stackoverflow.com/questions/57397891/the-value-pointer-points-to-is-not-updated", "title": "the value pointer points to is not updated", "body": "<p>Why here p->p1 is 1 rather than 0? I thought p is pointer to struct s2, and s2.p1=0, so p->p1 should be 0 too?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nstruct S1 {\n    int p1,p2;\n};\n\nstruct S2 {\n    int p1;\n    struct S1 s1;\n    int p2;\n};\n\n\nint main(void) {\n    int s=0;\n    struct S2 s2 = {1, 2, 3, 4};\n    struct S2 *p;\n    p=(struct S2 *)malloc(sizeof(struct S2));\n    *p = s2;\n    s2.p1 = 0;\n    s=p-&gt;p1 + s2.p1 + p-&gt;p2 + p-&gt;s1.p2;\n    free(p);\n    printf(\"%d\", s);\n\n    return 0;\n}\n\n</code></pre>\n\n<p>I expected the output of 7, but the actual output is 8.</p>\n"}, {"tags": ["c", "logging", "daemon"], "comments": [{"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1565192041, "post_id": 57397796, "comment_id": 101277377, "body": "maybe <code>fd == -1</code> ?"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1565193247, "post_id": 57397796, "comment_id": 101277975, "body": "You&#39;re trying to write to the root directory:  <code>chdir(&quot;&#47;&quot;)</code>"}, {"owner": {"reputation": 83, "user_id": 11010869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e15421a384cb3301964a495ae844fce?s=128&d=identicon&r=PG&f=1", "display_name": "goodknight", "link": "https://stackoverflow.com/users/11010869/goodknight"}, "edited": false, "score": 0, "creation_date": 1565193974, "post_id": 57397796, "comment_id": 101278324, "body": "should I just write it to my home directory? So maybe <code>chdir(&quot;&#47;home&#47;md&quot;)</code> ? I am not sure as to why you couldn&#39;t log to root."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1565195471, "post_id": 57397796, "comment_id": 101279088, "body": "Are you running the process as <code>root</code>?  Any process with permission to write to the root directory effectively has complete control of everything on the machine."}], "owner": {"reputation": 83, "user_id": 11010869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e15421a384cb3301964a495ae844fce?s=128&d=identicon&r=PG&f=1", "display_name": "goodknight", "link": "https://stackoverflow.com/users/11010869/goodknight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565191656, "creation_date": 1565191656, "question_id": 57397796, "link": "https://stackoverflow.com/questions/57397796/daemon-does-not-write-to-file", "title": "Daemon does not write to file", "body": "<p>I wrote a daemon that is supposed to log itself when it recieves a signal. If I do not daemonize the process, it works correctly and writes to the file and I can see all the signals it recieved. But when I daemonize it, and send a signal for ex <code>kill -14 (pid)</code> , the daemon never writes to the file that the signal is recieved. Code is below</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include \"signalinfo.h\"\n#include &lt;errno.h&gt;\n#include &lt;string.h&gt;\n#include &lt;limits.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;syslog.h&gt;\n#include &lt;sys/resource.h&gt;\n#include &lt;sys/stat.h&gt;\n\nchar *newline = \"\\n \";\n\nvoid\ndaemonize(const char *cmd)\n{\n    int i, fd0, fd1, fd2;\n    pid_t  pid;\n    struct rlimit rl;\n    struct sigaction    sa;\n\n    umask(0);\n\n    if (getrlimit(RLIMIT_NOFILE, &amp;rl) &lt; 0) {\n        printf(\"Can't get file limit\\n\");\n        exit(EXIT_FAILURE);\n    }\n\n    if ((pid = fork()) &lt; 0) {\n        printf(\"Can't Fork\\n\");\n        exit(EXIT_FAILURE);\n    }\n    else if (pid != 0) /* parent */\n        exit(0);\n    setsid();\n\n    sa.sa_handler = SIG_IGN;\nsigemptyset(&amp;sa.sa_mask);\n    sa.sa_flags = 0;\n    if (sigaction(SIGHUP, &amp;sa, NULL) &lt; 0){\n        printf(\"Can't ignore SIGHUP\\n\");\n        exit(EXIT_FAILURE);\n    }\n\n    if ((pid = fork()) &lt; 0) {\n        printf(\"Can't Fork\\n\");\n        exit(EXIT_FAILURE);\n    }\n\n    else if (pid != 0) /* parent */\n        exit(0);\n\n    if (chdir(\"/\") &lt; 0) {\n        printf(\"Can't Change Directory to /\\n\");\n        exit(EXIT_FAILURE);\n}\n\n    if (rl.rlim_max == RLIM_INFINITY)\n        rl.rlim_max = 1024;\n    for (i = 0; i &lt; rl.rlim_max; i++)\n        close(i);\n\n    fd0 = open(\"/dev/null\", O_RDWR);\n    fd1 = dup(0);\n    fd2 = dup(0);\n\n    openlog(cmd, LOG_CONS, LOG_DAEMON);\n    if (fd0 != 0 || fd1 != 1 || fd2 != 2) {\n        syslog(LOG_ERR, \"unexpected file descriptors %d %d %d\",\n          fd0, fd1, fd2);\n        exit(1);\n    }\n}\n\nvoid \nsetsig(struct sigaction sa)\n{\n    int i;\n\n    for(i=0; i&lt;SIGNAL_LIST_LENGTH; i++) {\n        printf(\"%d Set\\n\", siglist[i].code);\n        if(sigaction(siglist[i].code, &amp;sa, NULL) == -1) { //Will error     on SIGSTOP &amp; SIGKILL\n        }           \n    }\n}\n\nvoid \nhandler(int sig)\n{\n    char path[PATH_MAX];\n    int fd, flags, i;\n\n    flags = S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP | S_IWOTH | S_IROTH;\n    getcwd(path, PATH_MAX);\n    strcat(path,\"/signal.log\");\n    fd = open(path, O_WRONLY | O_CREAT | O_APPEND | O_NONBLOCK , flags);\n\n    for(i=0; i&lt;SIGNAL_LIST_LENGTH; i++) {\n        if(sig == siglist[i].code) {\n            write(fd, siglist[i].name, strlen(siglist[i].name));\n            write(fd, newline, strlen(newline));\n        }\n    }\n\n    close(fd);\n}\n\nint\nmain(int argc, char *argv[])\n{   \n    char *cmd;\n    struct sigaction sa;\n    sa.sa_handler = handler;\n\n\n    setsig(sa);\n\n    if((cmd = strchr(argv[0], '/')) == NULL)\n        cmd = argv[0];\n    else\n        cmd++;\n    daemonize(cmd);\n\n    while(1) {\n        sleep(1);\n    }\n}\n</code></pre>\n\n<p>Any Idea as to why I can't write to the file that I created? It works correctly when I dont daemonize it but when I do, it doesn't work.</p>\n"}, {"tags": ["c", "fork", "zos"], "comments": [{"owner": {"reputation": 1684, "user_id": 1518927, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/0YFDr.jpg?s=128&g=1", "display_name": "Valerie R", "link": "https://stackoverflow.com/users/1518927/valerie-r"}, "edited": false, "score": 0, "creation_date": 1565220326, "post_id": 57397751, "comment_id": 101288219, "body": "Just a few other points that might help you. First, all the errno/errno2 values are defined in a book called &quot;z/OS UNIX System Services: Messages and Codes&quot;. You&#39;ll have better luck if you use &quot;printf(&quot;Error %x/%x - %s&quot;, errno, __errno2(), strerror(errno))&quot; or something similar immediately after encountering a problem (remember, many library functions reset errno, so you need to reference it soon as an error occurs). Also, since the document I referred you to lists errno&#39;s in hex, it&#39;s usually better to print them with &quot;%x&quot;."}, {"owner": {"reputation": 1684, "user_id": 1518927, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/0YFDr.jpg?s=128&g=1", "display_name": "Valerie R", "link": "https://stackoverflow.com/users/1518927/valerie-r"}, "edited": false, "score": 0, "creation_date": 1565221292, "post_id": 57397751, "comment_id": 101288407, "body": "Process limits are concurrent running processes, not a cumulative value. The &quot;ps&quot; command tells you what you have running, and I&#39;ve never seen a z/OS system configured with less than 25 processes/user. The setting comes from the UNIX Services configuration file - something like SYS1.PARMLIB(BPXPRM00). In there, MAXPROCSYS (systemwide process limit) and MAXPROCUSER (max processes per user) are key. It&#39;s also possible to override these values on a user-by-user basis if needs be. If you have access to a z/OS operator console, the &quot;D OMVS,LIMITS&quot; command will tell you the current settings."}], "answers": [{"comments": [{"owner": {"reputation": 869, "user_id": 8977557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9435a87062e0ef32514b0aafcfae5d20?s=128&d=identicon&r=PG&f=1", "display_name": "Agrudge Amicus", "link": "https://stackoverflow.com/users/8977557/agrudge-amicus"}, "edited": false, "score": 0, "creation_date": 1565199501, "post_id": 57398760, "comment_id": 101280961, "body": "I don&#39;t think it can be run on Z/OS"}, {"owner": {"reputation": 6544, "user_id": 451601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/164602d512ce01f188e5a50593b46c5f?s=128&d=identicon&r=PG", "display_name": "James K. Lowden", "link": "https://stackoverflow.com/users/451601/james-k-lowden"}, "reply_to_user": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1565205040, "post_id": 57398760, "comment_id": 101283425, "body": "@Joshua, he could have 1 process left.  From the shell, invoking the compiler uses that process.  All OK.  Then he runs his program, which he can also launch, just like he could launch the compiler.  Then it calls fork(2), and fails."}, {"owner": {"reputation": 6544, "user_id": 451601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/164602d512ce01f188e5a50593b46c5f?s=128&d=identicon&r=PG", "display_name": "James K. Lowden", "link": "https://stackoverflow.com/users/451601/james-k-lowden"}, "reply_to_user": {"reputation": 869, "user_id": 8977557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9435a87062e0ef32514b0aafcfae5d20?s=128&d=identicon&r=PG&f=1", "display_name": "Agrudge Amicus", "link": "https://stackoverflow.com/users/8977557/agrudge-amicus"}, "edited": false, "score": 0, "creation_date": 1565205136, "post_id": 57398760, "comment_id": 101283459, "body": "@AgrudgeAmicus, IBM seems to think z/OS has fork: <a href=\"https://www.ibm.com/support/knowledgecenter/en/SSLTBW_2.3.0/com.ibm.zos.v2r3.bpxbd00/rtfor.htm\" rel=\"nofollow noreferrer\">ibm.com/support/knowledgecenter/en/SSLTBW_2.3.0/&hellip;</a>.  If not, his system is seriously misconfigured with header files and libraries for unsupported system calls."}, {"owner": {"reputation": 869, "user_id": 8977557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9435a87062e0ef32514b0aafcfae5d20?s=128&d=identicon&r=PG&f=1", "display_name": "Agrudge Amicus", "link": "https://stackoverflow.com/users/8977557/agrudge-amicus"}, "edited": false, "score": 0, "creation_date": 1565205834, "post_id": 57398760, "comment_id": 101283746, "body": "@JamesK.Lowden System has <code>fork</code> in some current running file - I think your point related to 2 processes is right and I was somewhat thinking on the same lines. But there is another file which uses <code>fork</code> with <code>pthreads</code> - I guess that thread system makes difference."}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1565207873, "post_id": 57398760, "comment_id": 101284591, "body": "@JamesK.Lowden: Nope! <code>cc</code> invokes <code>ld</code>. They gotta have at least two to compile."}, {"owner": {"reputation": 869, "user_id": 8977557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9435a87062e0ef32514b0aafcfae5d20?s=128&d=identicon&r=PG&f=1", "display_name": "Agrudge Amicus", "link": "https://stackoverflow.com/users/8977557/agrudge-amicus"}, "reply_to_user": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1565210093, "post_id": 57398760, "comment_id": 101285470, "body": "@Joshua On setting <code>rlim_max</code> as 1 (not 2) the compilation take place successfully on <code>gcc 8.3 - centos</code>. though <code>fork()</code> fails."}, {"owner": {"reputation": 869, "user_id": 8977557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9435a87062e0ef32514b0aafcfae5d20?s=128&d=identicon&r=PG&f=1", "display_name": "Agrudge Amicus", "link": "https://stackoverflow.com/users/8977557/agrudge-amicus"}, "reply_to_user": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1565210282, "post_id": 57398760, "comment_id": 101285542, "body": "@Joshua check the link: <a href=\"https://stackoverflow.com/questions/32649829/setting-low-rlimit-nproc-value-doesnt-allow-even-a-single-fork\" title=\"setting low rlimit nproc value doesnt allow even a single fork\">stackoverflow.com/questions/32649829/&hellip;</a>  I have run the code using a non-root user access."}], "tags": [], "owner": {"reputation": 6544, "user_id": 451601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/164602d512ce01f188e5a50593b46c5f?s=128&d=identicon&r=PG", "display_name": "James K. Lowden", "link": "https://stackoverflow.com/users/451601/james-k-lowden"}, "is_accepted": false, "score": -2, "last_activity_date": 1565210046, "last_edit_date": 1565210046, "creation_date": 1565195342, "answer_id": 57398760, "question_id": 57397751, "link": "https://stackoverflow.com/questions/57397751/fork-failing-repeatedly/57398760#57398760", "title": "fork() failing repeatedly", "body": "<p>If you've been playing with <code>fork</code>(2) you may well have used up your limit of processes available to your process, see <code>ulimit</code> for your shell: </p>\n\n<pre><code>$ help ulimit | grep process\nUlimit provides control over the resources available to processes\n    -d      the maximum size of a process's data segment\n    -l      the maximum size a process may lock into memory\n    -u      the maximum number of user processes\n</code></pre>\n\n<p>If so, logging out and logging back in again will solve the problem.  </p>\n"}, {"comments": [{"owner": {"reputation": 869, "user_id": 8977557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9435a87062e0ef32514b0aafcfae5d20?s=128&d=identicon&r=PG&f=1", "display_name": "Agrudge Amicus", "link": "https://stackoverflow.com/users/8977557/agrudge-amicus"}, "edited": false, "score": 0, "creation_date": 1565208374, "post_id": 57401604, "comment_id": 101284759, "body": "Please go into <code>sys1.sceeh.sys.h</code> and check what value has been set for <code>_SC_CHILD_MAX</code>"}, {"owner": {"reputation": 1684, "user_id": 1518927, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/0YFDr.jpg?s=128&g=1", "display_name": "Valerie R", "link": "https://stackoverflow.com/users/1518927/valerie-r"}, "reply_to_user": {"reputation": 869, "user_id": 8977557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9435a87062e0ef32514b0aafcfae5d20?s=128&d=identicon&r=PG&f=1", "display_name": "Agrudge Amicus", "link": "https://stackoverflow.com/users/8977557/agrudge-amicus"}, "edited": false, "score": 0, "creation_date": 1565218897, "post_id": 57401604, "comment_id": 101287950, "body": "I believe you might be misunderstanding the use of _SC_CHILD_MAX."}, {"owner": {"reputation": 869, "user_id": 8977557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9435a87062e0ef32514b0aafcfae5d20?s=128&d=identicon&r=PG&f=1", "display_name": "Agrudge Amicus", "link": "https://stackoverflow.com/users/8977557/agrudge-amicus"}, "edited": false, "score": 0, "creation_date": 1565345474, "post_id": 57401604, "comment_id": 101333808, "body": "There is a big problem in this --&gt; in unix shell (to be precise in /etc/profile) -&gt; line <code>for _CMP in _C89 _CC _CXX; do</code> is commented and I don&#39;t have edit permission to un-comment it due to which on compiling a file I am getting <code>IKJ56228I DATA SET CEE.SCEELKEX NOT IN CATALOG OR CATALOG CAN NOT BE ACCESSED</code> error &amp; I can&#39;t test in unix environment.   Though MAXPROCSYS is 4096 and MAXPROCUSER is 2048"}, {"owner": {"reputation": 869, "user_id": 8977557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9435a87062e0ef32514b0aafcfae5d20?s=128&d=identicon&r=PG&f=1", "display_name": "Agrudge Amicus", "link": "https://stackoverflow.com/users/8977557/agrudge-amicus"}, "edited": false, "score": 0, "creation_date": 1565362832, "post_id": 57401604, "comment_id": 101343423, "body": "Here are the other values: <code>sysconf(_SC_MAX_CHILD)</code>  -&gt; -1, <code>errno --&gt; a0000 errno2 --&gt; c10f0001</code>  ------------- This is when the code is run in the non-unix environment."}, {"owner": {"reputation": 1684, "user_id": 1518927, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/0YFDr.jpg?s=128&g=1", "display_name": "Valerie R", "link": "https://stackoverflow.com/users/1518927/valerie-r"}, "reply_to_user": {"reputation": 869, "user_id": 8977557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9435a87062e0ef32514b0aafcfae5d20?s=128&d=identicon&r=PG&f=1", "display_name": "Agrudge Amicus", "link": "https://stackoverflow.com/users/8977557/agrudge-amicus"}, "edited": false, "score": 0, "creation_date": 1565648848, "post_id": 57401604, "comment_id": 101411033, "body": "A glance through IBM&#39;s &quot;z/OS UNIX Services Messages and Codes&quot; reveals that there is no error of &quot;a000&quot; and no errno2 of c10f0001, so there&#39;s something more dramatic going on here."}, {"owner": {"reputation": 1684, "user_id": 1518927, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/0YFDr.jpg?s=128&g=1", "display_name": "Valerie R", "link": "https://stackoverflow.com/users/1518927/valerie-r"}, "reply_to_user": {"reputation": 869, "user_id": 8977557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9435a87062e0ef32514b0aafcfae5d20?s=128&d=identicon&r=PG&f=1", "display_name": "Agrudge Amicus", "link": "https://stackoverflow.com/users/8977557/agrudge-amicus"}, "edited": false, "score": 0, "creation_date": 1565649575, "post_id": 57401604, "comment_id": 101411181, "body": "How are you compiling your code if you can&#39;t run the compiler due to the problems you mention? If you&#39;re running the compiler in batch, there are a variety of options you need when generating code for the UNIX environment. You may need other environment variables set if your site isn&#39;t configured normally: STEPLIB pointing to the CEE datasets (these are the C/C++ runtime libraries, by the way). Or, perhaps your organization doesn&#39;t actually license the IBM XLC product...there should be messages on the z/OS console indicating the problem in more detail - ask your z/OS person for help."}], "tags": [], "owner": {"reputation": 1684, "user_id": 1518927, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/0YFDr.jpg?s=128&g=1", "display_name": "Valerie R", "link": "https://stackoverflow.com/users/1518927/valerie-r"}, "is_accepted": false, "score": 3, "last_activity_date": 1565219477, "last_edit_date": 1565219477, "creation_date": 1565208231, "answer_id": 57401604, "question_id": 57397751, "link": "https://stackoverflow.com/questions/57397751/fork-failing-repeatedly/57401604#57401604", "title": "fork() failing repeatedly", "body": "<p>I copied your sample program to my z/OS system running z/OS Version 2.3, with a minor enhancement since you left out the <code>calling_child</code> function (UPDATED to add the sysconf() value for SC_MAX_CHILD):</p>\n\n<pre><code>  #include&lt;stdio.h&gt;\n  #include&lt;errno.h&gt;\n  #include&lt;unistd.h&gt;\n  #include&lt;stdlib.h&gt;\n\n   int main()\n   {\n       long int prc_id;\n       printf(\"SC_CHILD_MAX = %d\\n\", sysconf(_SC_CHILD_MAX));\n\n       prc_id=fork();\n\n       if(prc_id ==0)\n          calling_child();        \n       else if(prc_id &lt;0)\n       {\n           printf(\"errno - %d\\n\",errno); \n           printf(\"failed %d\\n\",prc_id);\n           exit(0);\n       }\n\n      return 0;\n     } \n\n   static void calling_child(void)\n   {\n      printf(\"Hello from PID %x\\n\", getpid());\n      return;\n   }\n</code></pre>\n\n<p>I put the code in a file called <code>test2.c</code> and built it with this shell command: <code>c99 -o test2 -g test2.c</code></p>\n\n<p>It compiles cleanly and I was able to run it with no problems. It produces this output: </p>\n\n<pre><code>SC_CHILD_MAX = 32767\nHello from PID 40100b2\n</code></pre>\n\n<p>Most likely your build or execution environment isn't configured properly. It absolutely works fine on my pretty basic system, and I didn't have to do anything unusual at all to get it running. </p>\n\n<p>A few small hints...</p>\n\n<p>How are you getting into the z/OS UNIX shell? If you're logging onto TSO then running the ISPF shell or the OMVS command, you might prefer simply SSH'ing into your z/OS system. I usually find this is the cleanest batch environment. </p>\n\n<p>Second thing is that you probably want to double-check your C/C++ environment. There are some good debugging features built into the IBM XLC compiler - try <code>man C99</code> (or whatever dialect you use) and have a read. </p>\n\n<p>Third thing is that IBM includes the dbx debugger in z/OS, so if you really get stuck, just try running your executable under dbx and you can step through your program line at a time. </p>\n\n<p>As for those ERRNOs and so on, don't forget to also look at the <code>__errno2()</code> values - they usually have a very specific reason code that goes along with the more generic errors. For example, your z/OS security administrator can certainly do things to limit your use of z/OS UNIX functions - that would be revealed in the <code>__errno2()</code> values pretty clearly. </p>\n\n<p>Stick with it though - if you know UNIX or Linux, all the skills you have from using the shell to coding pretty much transfer 100% to z/OS if you put in a little time to learning the basics. </p>\n"}], "owner": {"reputation": 869, "user_id": 8977557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9435a87062e0ef32514b0aafcfae5d20?s=128&d=identicon&r=PG&f=1", "display_name": "Agrudge Amicus", "link": "https://stackoverflow.com/users/8977557/agrudge-amicus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1565219477, "creation_date": 1565191506, "last_edit_date": 1565210129, "question_id": 57397751, "link": "https://stackoverflow.com/questions/57397751/fork-failing-repeatedly", "title": "fork() failing repeatedly", "body": "<p>I was trying to create a child process using <code>fork</code> but it is repeatedly returning <strong>-1</strong>, I tried to found the causes and I came to this:</p>\n\n<pre><code>Fork() will fail and no child process will be created if:\n[EAGAIN]           The system-imposed limit on the total number of pro-\n                   cesses under execution would be exceeded.  This limit\n                   is configuration-dependent.\n\n[EAGAIN]           The system-imposed limit MAXUPRC (&lt;sys/param.h&gt;) on the\n                   total number of processes under execution by a single\n                   user would be exceeded.\n\n[ENOMEM]           There is insufficient swap space for the new process. \n</code></pre>\n\n<p>Now I don't know how to check the first and third point but on looking at point <code>MAXUPRC</code> - I looked into <a href=\"https://unix.superglobalmegacorp.com/Net2/newsrc/sys/param.h.html\" rel=\"nofollow noreferrer\">sys/param.h</a>:</p>\n\n<pre><code>//&lt;sys/param.h&gt;\n#define MAXUPRC     CHILD_MAX   /* max simultaneous processes */\n</code></pre>\n\n<p><code>CHILD_MAX</code> has been mentioned here (<a href=\"http://man7.org/linux/man-pages/man3/sysconf.3.html\" rel=\"nofollow noreferrer\">unistd.h</a>): </p>\n\n<pre><code>//&lt;unistd.h&gt; - DEFINED IN MY SYSTEM\n#define _SC_CHILD_MAX            2 \n</code></pre>\n\n<blockquote>\n  <p>CHILD_MAX - _SC_CHILD_MAX\n                The maximum number of simultaneous processes per user ID.\n                Must not be less than _POSIX_CHILD_MAX (25).</p>\n</blockquote>\n\n<p>Now I can't establish if keeping <strong>_SC_CHILD_MAX</strong> less than <strong>25</strong> is the reason or do I have to look into 1st and 3rd causes (they are hard to check as the system is <strong>Z/OS</strong> with limited access and I don't have much idea about it).</p>\n\n<p><code>perror(\"\");</code> isn't printing anything and <code>errno</code> is printing 655360.</p>\n\n<pre><code>  #include&lt;stdio.h&gt;\n  #include&lt;errno.h&gt;\n  #include&lt;unistd.h&gt;\n  #include&lt;stdlib.h&gt;\n\n   int main()\n   {\n       long int prc_id;\n\n       prc_id=fork();\n\n       if(prc_id ==0)\n          calling_child();        \n       else if(prc_id &lt;0)\n       {\n           printf(\"errno - %d\\n\",errno); \n           printf(\"failed %d\\n\",prc_id);\n           exit(0);\n       }\n\n      return 0;\n }\n</code></pre>\n\n<p>This above code runs fine and creates a child process on my own laptop (centos) but in dev environment I guess there are some restrictions.</p>\n\n<p>calling_child is never called as the <code>prc_id</code> returned is -1 (not even first print statement is printed on entering the function).</p>\n"}, {"tags": ["c", "loops", "input", "fgets", "strtol"], "comments": [{"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 3, "creation_date": 1565191531, "post_id": 57397719, "comment_id": 101277065, "body": "Very simple: don&#39;t use <code>scanf</code>.  It&#39;s defined in terms of stream-based input; it has no concept of lines.  If you want to read and interpret lines of input, use <code>fgets</code> to read lines as strings, then process the strings.  (In doing so you&#39;ll also avoid <code>scanf</code>&#39;s myriad other difficulties.)"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 2, "creation_date": 1565191704, "post_id": 57397719, "comment_id": 101277164, "body": "When you use <code>%d</code> with <code>scanf</code>, it means, &quot;skip leading whitespace, then read an integer consisting of one or more digits&quot;.  There&#39;s no way to turn off the &quot;skip leading whitespace&quot; part, which is what&#39;s causing your problem."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 1, "creation_date": 1565191898, "post_id": 57397719, "comment_id": 101277287, "body": "One thing you can do (if you want to stick with <code>scanf</code>) is change your prompt from &quot;Enter numbers, terminated by blank line&quot; to &quot;Enter numbers, terminated by any non-numeric character&quot;.  If the user types <code>x</code> or something, that <i>will</i> cause <code>scanf</code> to fail and return 0."}], "answers": [{"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": true, "score": 2, "last_activity_date": 1565194154, "creation_date": 1565194154, "answer_id": 57398461, "question_id": 57397719, "link": "https://stackoverflow.com/questions/57397719/how-can-i-take-integer-input-dynamically-and-have-the-loop-terminate-on-pressing/57398461#57398461", "title": "How can I take integer input dynamically and have the loop terminate on pressing enter?", "body": "<p>You can use standard function <code>fgets</code> to read the input into a character array and then extract numbers using standard function <code>strtol</code>.</p>\n\n<p>Here is a demonstrative program</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n\nint is_empty( const char *s )\n{\n    return s[strspn( s, \" \\t\" )] == '\\n';   \n}\n\nint main(void) \n{\n    enum { N = 100 };\n    char line[N];\n\n    while ( fgets( line, N, stdin ) &amp;&amp; !is_empty( line ) )\n    {\n        char *endptr;\n\n        for ( const char *p = line; *p != '\\n'; p = endptr )\n        {\n            int num = strtol( p, &amp;endptr, 10 );\n            printf( \"%d \", num );\n\n        }\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>If to input the following lines</p>\n\n<pre><code>1\n2 3\n4 5 6\n7 8\n9\n</code></pre>\n\n<p>(the last line is empty that is the user just pressed Enter)</p>\n\n<p>then the output will look like</p>\n\n<pre><code>1 2 3 4 5 6 7 8 9\n</code></pre>\n"}], "owner": {"reputation": 4113, "user_id": 10305477, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--qRrIlzhZP8/AAAAAAAAAAI/AAAAAAAAAbg/OMHxlGTcZp4/photo.jpg?sz=128", "display_name": "Chase", "link": "https://stackoverflow.com/users/10305477/chase"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 57398461, "answer_count": 1, "score": 1, "last_activity_date": 1565194172, "creation_date": 1565191404, "last_edit_date": 1565194172, "question_id": 57397719, "link": "https://stackoverflow.com/questions/57397719/how-can-i-take-integer-input-dynamically-and-have-the-loop-terminate-on-pressing", "title": "How can I take integer input dynamically and have the loop terminate on pressing enter?", "body": "<p>I need to take integer input dynamically and have it terminated as soon as user pressed enter. I never had any problem with this when I'm taking chars as input as I can easily check for newlines and each char is a single character. But here, I can't just take a char input and substract it by '0' as when I enter 10, the char value is 1 and then 0.</p>\n\n<p>Here is a piece of the code I'm using :</p>\n\n<pre><code>int no;\nwhile (scanf_s(\" %d\", &amp;no) == 1)\n    {\n        printf(\"%d \", no);\n    }\n</code></pre>\n\n<p>And here's another piece of code that I use for inputting chars, this works fine for single digit integers too :</p>\n\n<pre><code>char no;\nwhile ((no=getchar()) != EOF &amp;&amp; no != '\\n')\n    {\n        printf(\" %d \", no - '0');\n    }\n</code></pre>\n\n<p>The scanf loop doesn't terminate when pressing enter but it does take the inputs all correctly. Whereas, the getchar loop terminates correctly but only stores 1 digit integers.</p>\n\n<p>How can I have integer inputs be terminated at blank line user input?</p>\n"}, {"tags": ["c", "arrays", "pointers", "initialization"], "answers": [{"tags": [], "owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "is_accepted": true, "score": 1, "last_activity_date": 1565199426, "last_edit_date": 1565199426, "creation_date": 1565197603, "answer_id": 57399281, "question_id": 57397600, "link": "https://stackoverflow.com/questions/57397600/correct-way-to-initialize-a-multidimensional-array-pointer-from-a-particular-add/57399281#57399281", "title": "correct way to initialize a multidimensional array pointer from a particular address", "body": "<p>You could cast the address as <code>(void *)0x40000000</code> as that can be converted to any object type.  Some compilers might issue a warning unless you cast the address as <code>(void *)(uintptr_t)0x40000000</code>.</p>\n\n<p>With <code>unsigned char (*vptr)[240][320]</code>, you would need to access the individual <code>unsigned char</code> elements using <code>(*vptr)[i][j]</code>. Therefore, to make things easier, it would be better to declare <code>vptr</code> as <code>unsigned char (*vptr)[320]</code> so that <code>vptr</code> is a pointer to the first element of an array of <code>char[320]</code>.  Then you can access the individual <code>unsigned char</code> elements using the more natural syntax <code>vptr[i][j]</code>.  For example <code>vptr[10][20]</code> would access the <code>unsigned char</code> element at address <code>0x40000000 + (10 * 320) + 20</code> (<code>0x40000c94</code>), or in general, <code>vptr[i][j]</code> would access the <code>unsigned char</code> element at address <code>0x40000000 + (i * 320) + j</code>.</p>\n\n<p>If you don't want to cast the address to <code>(void *)</code>, you can cast to the correct pointer type instead.  E.g. <code>unsigned char (*vptr)[240][320] = (unsigned char (*)[240][320])0x40000000;</code> or <code>unsigned char (*vptr)[320] = (unsigned char (*)[320])0x40000000;</code>. (You might still need the intermediate <code>(uintptr_t)</code> cast to avoid a compiler warning.)</p>\n\n<p>You mentioned that <code>&amp;vptr == 0x40000000</code> (disregarding casting), but that is not the case.  <code>vptr</code> is just a pointer variable at whatever address the compiler and linker decide to place it.  It is the <code>vptr</code> variable itself (not its address) that has the value <code>0x40000000</code> (disregarding casting).</p>\n"}], "owner": {"reputation": 65, "user_id": 11754252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1825f67b0846d4671a53ef2996857aed?s=128&d=identicon&r=PG&f=1", "display_name": "toby", "link": "https://stackoverflow.com/users/11754252/toby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 57399281, "answer_count": 1, "score": 0, "last_activity_date": 1565199426, "creation_date": 1565191046, "question_id": 57397600, "link": "https://stackoverflow.com/questions/57397600/correct-way-to-initialize-a-multidimensional-array-pointer-from-a-particular-add", "title": "correct way to initialize a multidimensional array pointer from a particular address", "body": "<p>I want to create a multidimensional array pointer in C with a particular starting address in memory. I don't fully understand the correct syntax for this. What i want to accomplish to do is something like follows:</p>\n\n<pre><code>unsigned char (*vptr)[240][320] =  (unsigned char*)0x40000000;\n</code></pre>\n\n<p>where <br>\n    <b>vptr[0][0] = 2;</b> would write 2 to address <b>0x40000000</b>;<br>\n    <b>vptr[0][1] = 3;</b> would write 3 to address <b>0x40000001</b>; <br>\n    ...<br>\n    <b>vptr[1][0] = 4;</b> would write 4 to address <b>0x40000240</b>;<br>\n<br><br>\nSo basically that my <b>vptr</b> would be functionally equivalent to </p>\n\n<pre><code>unsigned char vptr[240][320] = {....};\n</code></pre>\n\n<p>where <b>&amp;vptr == 0x40000000</b>.</p>\n\n<p>Could someone please write how this is supposed to be done?\nThank you very much for the help.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1565190930, "post_id": 57397536, "comment_id": 101276723, "body": "The function has static data?"}, {"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 1, "creation_date": 1565190960, "post_id": 57397536, "comment_id": 101276746, "body": "How do they interfere? If they access the same static variables, then changing the name or making a pointer to them won&#39;t work, you need to have seperate data being accessed. This concept is called <a href=\"https://en.wikipedia.org/wiki/Reentrancy_(computing)\" rel=\"nofollow noreferrer\">Reentrancy</a>"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 3, "creation_date": 1565190990, "post_id": 57397536, "comment_id": 101276768, "body": "What is the <i>real</i> problem you need to solve? What is the function supposed to do? Do you have threads? Please read <a href=\"http://stackoverflow.com/help\">the help pages</a>, take <a href=\"http://stackoverflow.com/tour\">the SO tour</a>, read about <a href=\"http://stackoverflow.com/help/how-to-ask\">how to ask good questions</a>, as well as <a href=\"https://codeblog.jonskeet.uk/2012/11/24/stack-overflow-question-checklist/\" rel=\"nofollow noreferrer\">this question checklist</a>. Lastly please learn how to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 1, "creation_date": 1565190991, "post_id": 57397536, "comment_id": 101276769, "body": "\u201cI want to call this function multiple times using different names\u201d \u2014 <b>why</b>? This requirement doesn\u2019t seem to make sense. As for the actual question, you need to post the actual function (minimal example) and the actual calls for us to be able to help you."}, {"owner": {"reputation": 9, "user_id": 11896678, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JQa1LWP8Xl8/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7reUXhA3kH5Ccy7GpNIXhTG9ZY06A/mo/photo.jpg?sz=128", "display_name": "Eric Thornton", "link": "https://stackoverflow.com/users/11896678/eric-thornton"}, "edited": false, "score": 0, "creation_date": 1565191271, "post_id": 57397536, "comment_id": 101276917, "body": "Sorry, you are right. This question is way to vague. Ill delete and repost with more specific info."}, {"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 6, "creation_date": 1565191347, "post_id": 57397536, "comment_id": 101276965, "body": "@EricThornton You can (and are encouraged to) edit the question instead of deleting and reposting."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1565192672, "post_id": 57397536, "comment_id": 101277680, "body": "This problem is why traditional functions like <code>strtok()</code> have been superceded by reentrant versions like <code>strtok_r()</code>. Instead of using a static variable in the function, you pass an additional parameter that holds the function&#39;s state."}], "answers": [{"tags": [], "owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "is_accepted": true, "score": 2, "last_activity_date": 1565193162, "last_edit_date": 1565193162, "creation_date": 1565191929, "answer_id": 57397873, "question_id": 57397536, "link": "https://stackoverflow.com/questions/57397536/calling-a-function-twice-without-interference-in-c/57397873#57397873", "title": "Calling a function twice without interference in C", "body": "<p>The usual way is to remove the static data from the function</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint function(int n) {\n    static int foo = 0;\n    foo += n;\n    return foo;\n}\nint main(void) {\n    function(10); // returns 10\n    function(-4); // returns 6\n    printf(\"%d, %d\\n\", function(1), function(-1)); // UB; functions call mess with each other\n}\n</code></pre>\n\n<p>See <a href=\"https://ideone.com/c1kW51\" rel=\"nofollow noreferrer\">https://ideone.com/c1kW51</a></p>\n\n<p>To remove the static data, I'd do something like</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nstruct fxdata {\n    int foo;\n};\nint function(int n, struct fxdata *p) {\n    p-&gt;foo += n;\n    return p-&gt;foo;\n}\nint main(void) {\n    struct fxdata f1 = {0};\n    struct fxdata f2 = {0};\n    function(10, &amp;f1); // returns 10\n    function(-4, &amp;f2); // returns -4\n    printf(\"%d, %d\\n\", function(1, &amp;f1), function(-1, &amp;f2));\n}\n</code></pre>\n\n<p>See <a href=\"https://ideone.com/aePprq\" rel=\"nofollow noreferrer\">https://ideone.com/aePprq</a></p>\n"}], "owner": {"reputation": 9, "user_id": 11896678, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JQa1LWP8Xl8/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7reUXhA3kH5Ccy7GpNIXhTG9ZY06A/mo/photo.jpg?sz=128", "display_name": "Eric Thornton", "link": "https://stackoverflow.com/users/11896678/eric-thornton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 57397873, "answer_count": 1, "score": -1, "last_activity_date": 1565193162, "creation_date": 1565190844, "last_edit_date": 1565192629, "question_id": 57397536, "link": "https://stackoverflow.com/questions/57397536/calling-a-function-twice-without-interference-in-c", "title": "Calling a function twice without interference in C", "body": "<p>I have a function that reads data from a serial line and processes it, simplified:</p>\n\n<pre><code>void serialData(int port){\n  static uint8_t byte;\n  static uint8_t store[];\n  //read one byte from specified port\n  //store this byte in the array\n  //process the data\n}\n</code></pre>\n\n<p>I need to read data from two different serial lines in a \"ping pong\" system and process the data in the same way for each line.</p>\n\n<pre><code>while (true){\n  serialData(port1);\n  serialData(port2);\n}\n</code></pre>\n\n<p>This does not work as the data from port1 and port2 gets mixed in the array on each successive call.</p>\n\n<p>I would like to only have the code for the function typed out once and then somehow reference the code using two different names so the variables do not interfere, is there a better solution beyond just copy/pasting the same code with a new name?</p>\n\n<p>I have tried #define, for example:</p>\n\n<pre><code>#define port1Data serialData\n#define port2Data serialData\n</code></pre>\n\n<p>and pointers:</p>\n\n<pre><code>void (*port1Data) (int) = &amp;serialData;\nvoid (*port2Data) (int) = &amp;serialData;\n</code></pre>\n\n<p>but successive calls to the two renamed functions still interfere. </p>\n"}, {"tags": ["c", "struct"], "comments": [{"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 1, "creation_date": 1565191096, "post_id": 57397451, "comment_id": 101276830, "body": "Please <a href=\"https://stackoverflow.com/posts/57397451/edit\">edit</a> your question and make the code complete to be compiled. Describe what is the exact problem. I suggest to parse the whole input in <code>main()</code> and pass <code>name</code> and <code>company</code> as function arguments to <code>AddName</code>. In <code>AddName</code> you have to store copies of the string values in your structure. One option would be <code>somebody[j].company = strdup(company);</code>"}, {"owner": {"reputation": 421, "user_id": 11521482, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QIrZ4uBKGpc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfy52SQZZoz_RBLxJ0jRvF-_uNwbQ/mo/photo.jpg?sz=128", "display_name": "Mathias Schmid", "link": "https://stackoverflow.com/users/11521482/mathias-schmid"}, "edited": false, "score": 0, "creation_date": 1565213706, "post_id": 57397451, "comment_id": 101286656, "body": "In <code>AddName</code> you assign the address of local variables created on the stack and only valid during function call to <code>name</code> and <code>company</code> field of <code>struct driver</code>. You can use suggestion of previous comment and bind a copy of <code>name</code> and  <code>company</code> input to <code>struct driver</code> record. However, don&#39;t forget to free memory of the copy later. Another possibility is to use character arrays for <code>name</code> and <code>company</code> in <code>struct driver</code> and assign input using <code>strcpy&#47;strncpy</code> or by <code>scanf</code> directly."}], "owner": {"reputation": 11, "user_id": 11896802, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-oQxFX1A2B0k/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdid13nPFqnIwQmL8nLNXJw7x4tPA/photo.jpg?sz=128", "display_name": "samuel girmay", "link": "https://stackoverflow.com/users/11896802/samuel-girmay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565196596, "creation_date": 1565190493, "last_edit_date": 1565196596, "question_id": 57397451, "link": "https://stackoverflow.com/questions/57397451/doesnt-add-into-struct", "title": "Doesn&#39;t add into struct", "body": "<p>How do I make an array of struct and how can I call them?  I want to make a struct list of drivers and their companies. Right now code only stores one struct but makes an error after I try to store another one. It stops at somebody = realloc(somebody, (sizeof(struct driver) * (j + 1))); for some reason.</p>\n\n<pre><code>struct Timer {\n    int hour;\n    int minutes;\n    int seconds;\n};\nstruct driver {\n    char* name;\n    char* company;\n    int total;\n    struct Timer time;\n};\n\nchar AddName(struct driver* somebody, int j) {\n    char name[30];\n    char company[30];\n    scanf(\"%s\", name);\n    scanf(\"%s\", company);\n    somebody = realloc(somebody, (sizeof(struct driver) * (j + 1)));\n    somebody[j].company = company;\n    somebody[j].name = name;\n    somebody[j].time.seconds = 0;\n    somebody[j].time.minutes = 0;\n    somebody[j].time.hour = 0;\n    somebody[j].total = 0;\n    return somebody;\n}\n\nint main(void) {\n    char text[100];\n    int num_drivers = 0;\n    struct driver* somebody = malloc(sizeof(struct driver));\n    printf(\"Enter text\\n\");\n    scanf(\"%s\",text);\n    printf(\"-------------------------------------------------\\n\");\n    while (text != \"Q\") {\n        if (strcmp(text,\"A\") == 0) {\n            somebody = AddName(somebody,num_drivers);\n            num_drivers++;\n        }\n</code></pre>\n\n<pre><code>A Sam Renault \nA Frank Volvo\n</code></pre>\n"}, {"tags": ["c", "image-processing", "pixel"], "comments": [{"owner": {"reputation": 42647, "user_id": 7328782, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/treJu.png?s=128&g=1", "display_name": "Cris Luengo", "link": "https://stackoverflow.com/users/7328782/cris-luengo"}, "edited": false, "score": 0, "creation_date": 1565188772, "post_id": 57396733, "comment_id": 101275552, "body": "Do you know what <code>&gt;&gt;</code>, <code>&amp;</code> and <code>|</code> do? Did you look up those operators? Next, just follow what happens to the bits in <code>pixels[ii]</code>."}, {"owner": {"reputation": 1458, "user_id": 6436977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6A0LS.jpg?s=128&g=1", "display_name": "T A", "link": "https://stackoverflow.com/users/6436977/t-a"}, "edited": false, "score": 0, "creation_date": 1565188919, "post_id": 57396733, "comment_id": 101275629, "body": "This does not look like any standard procedure to me. Out of curiosity where did you get that code snippet and how do you intend to use it?"}], "answers": [{"comments": [{"owner": {"reputation": 307, "user_id": 10468569, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-6OoMmR7ZK7k/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUeqUYFYLicdDTgf71JXspmB2_qMw/mo/photo.jpg?sz=128", "display_name": "abdullah celik", "link": "https://stackoverflow.com/users/10468569/abdullah-celik"}, "edited": false, "score": 0, "creation_date": 1565195614, "post_id": 57397864, "comment_id": 101279169, "body": "also, a  nice explanation. Thank you for your big effort. I appreciate that."}], "tags": [], "owner": {"reputation": 312, "user_id": 7712908, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc8ff5e444c5ef577c7c14adf34dd362?s=128&d=identicon&r=PG&f=1", "display_name": "blackbeard", "link": "https://stackoverflow.com/users/7712908/blackbeard"}, "is_accepted": false, "score": 0, "last_activity_date": 1565191891, "creation_date": 1565191891, "answer_id": 57397864, "question_id": 57396733, "link": "https://stackoverflow.com/questions/57396733/method-that-processes-pixels-in-a-certain-way/57397864#57397864", "title": "Method that processes pixels in a certain way", "body": "<p><a href=\"https://techpubs.jurassic.nl/manuals/0650/developer/DIVO_OG/sgi_html/apc.html\" rel=\"nofollow noreferrer\">There are different color packing schemes and sampling patterns out there.</a> Some have industry standards and some have not. Your code snippet looks like a non-standardized color packing, tailored for a custom application.</p>\n\n<p>Now let's dissect your code!</p>\n\n<p><code>R</code>, <code>G</code>, <code>B</code> definitely stands for Red, Green, and Blue. Each of them is given 256 entries which led me to believe we are dealing with <a href=\"https://en.wikipedia.org/wiki/8-bit_color\" rel=\"nofollow noreferrer\">8-bit</a> color graphics. <code>0x00FF0000</code> is hex value for bright red. Consecutively, <code>0x0000FF00</code> is for green and <code>0x000000FF</code> is for blue.</p>\n\n<p>The purpose of the bit shifting is to create space for each palette so that each Red, Blue and Green can be stored inside a 24-bit integer. Each color can be chosen from a palette of 16,777,216 colors (24 bits: 8 red, 8 green, 8 blue).</p>\n\n<p>Blue is the first 8 bits (<code>b[0]-B[7]</code>). Green is then bit shifted to left by 8 bits, So <code>b[8]-b[15]</code> represents green. And finally, Red is shifted to left by 16 bits. <code>b[16]-b[23]</code> represents red.</p>\n\n<p>The <code>hight</code> and <code>width</code> represents the dimension of the image you are trying to parse. However, this line below doesn't make much sense, because you are trying to combine them into an integer as you bit shifting right. I would verify this line:</p>\n\n<p><code>pixels[i] = (0xFF000000 &amp; pixels[i]) | (R[(pixels[i] &gt;&gt; 16) &amp; 0xFF]) | (G[(pixels[i] &gt;&gt; 8) &amp; 0xFF]) | (B[pixels[i] &amp; 0xFF]);</code></p>\n"}, {"comments": [{"owner": {"reputation": 307, "user_id": 10468569, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-6OoMmR7ZK7k/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUeqUYFYLicdDTgf71JXspmB2_qMw/mo/photo.jpg?sz=128", "display_name": "abdullah celik", "link": "https://stackoverflow.com/users/10468569/abdullah-celik"}, "edited": false, "score": 0, "creation_date": 1565195543, "post_id": 57398746, "comment_id": 101279131, "body": "wow, great explanation. Thank you. I am new to image processing. It all makes sense now."}], "tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": true, "score": 1, "last_activity_date": 1565195569, "last_edit_date": 1565195569, "creation_date": 1565195274, "answer_id": 57398746, "question_id": 57396733, "link": "https://stackoverflow.com/questions/57396733/method-that-processes-pixels-in-a-certain-way/57398746#57398746", "title": "Method that processes pixels in a certain way", "body": "<p>This function separately transforms each color in an image using an intensity map specified by <code>rgb</code>. By supplying an appropriate map, this can be used to implement any transformation in which the colors and pixels are independent, such as making a negative image, brightening, darkening, posterization, and more.</p>\n\n<p>The function <code>processPixels</code> accepts an image and a transformation map. The image is described by the parameters <code>width</code>, <code>height</code>, and <code>pixels</code>:</p>\n\n<ul>\n<li>The image is <code>width</code> pixels wide and <code>height</code> pixels high.</li>\n<li><code>pixels</code> points to an array of 32-bit <code>int</code>.</li>\n<li>Each <code>int</code> contains data about one pixel, containing an <em>alpha</em> value in the high eight bits, and intensities for red, green, and blue in the following three sets of eight bits. (An alpha value is a measure of opaqueness, from 0 being fully transparent to 255 being fully opaque.)</li>\n</ul>\n\n<p>The map is described by the parameter <code>rgb</code>:</p>\n\n<ul>\n<li><code>rgb</code> points to an array of 256 <code>int</code>, each of which contains, in its low eight bits, an intensity value.</li>\n</ul>\n\n<p>The function is intended to replace the intensity of each color in each pixel by an intensity specified by the map. Specifically, if any color has intensity <code>x</code>, it is replaced by <code>rgb[x]</code> (considering only the low eight bits).</p>\n\n<p>There is a shortcoming in the function: It uses <code>int</code> for the pixel data and shifts it right, but the values will be negative with any alpha value of 128 or greater, and the results of right shifting negative data are implementation-defined. It would have been better to use <code>unsigned int</code>.</p>\n\n<p>In the first loop, the function prepares lookup tables for each of the red, green, and blue positions:</p>\n\n<pre><code>for (int i = 0; i &lt; 256; i++) {\n    R[i] = (rgb[i] &lt;&lt; 16) &amp; 0x00FF0000;\n    G[i] = (rgb[i] &lt;&lt; 8) &amp; 0x0000FF00;\n    B[i] = rgb[i] &amp; 0x000000FF;\n}\n</code></pre>\n\n<p>In each case, the value in <code>rgb[i]</code> is shifted to the position corresponding to the color, and then a mask is applied to extract eight bits. In each case, the same eight bits are extracted, differing only in the locations to which they have been shifted. This code could have been written more clearly as:</p>\n\n<pre><code>for (int i = 0; i &lt; 256; ++i)\n{\n    unsigned x = rgb[i] &amp; 0xff;\n    R[i] = x &lt;&lt; 2*8;\n    G[i] = x &lt;&lt; 1*8;\n    B[i] = x &lt;&lt; 0*8;\n}\n</code></pre>\n\n<p>This makes it visually apparent that the code is using the same data for each array, and they differ solely in position. In other words, all this code is doing is preparing shifted copies of <code>rgb[i]</code>.</p>\n\n<p>In the second loop, the function substitutes the pixel intensities with those given by the map. <code>i</code> loops through each pixel in the image. Then, in:</p>\n\n<pre><code>    pixels[i] =\n            (0xFF000000 &amp; pixels[i]) | (R[(pixels[i] &gt;&gt; 16) &amp; 0xFF]) | (G[(pixels[i] &gt;&gt; 8) &amp; 0xFF]) | (B[pixels[i] &amp; 0xFF]);\n</code></pre>\n\n<p>we have these parts:</p>\n\n<ul>\n<li><code>0xFF000000 &amp; pixels[i]</code> separates the alpha component.</li>\n<li><code>R[(pixels[i] &gt;&gt; 16) &amp; 0xFF]</code> takes the data for one pixel, <code>pixels[i]</code>, and shifts it right 16 bits, which moves the red component to the low eight bits. Then it masks the shifted value to extract just the low eight bits. This produces the intensity for the red component. Then <code>R[\u2026]</code> looks up this intensity in the <code>R</code> array, which produces the pre-shifted value prepared in the first loop\u2014it contains the intensity from <code>rgb</code> already shifted to the red position.</li>\n<li><code>G[(pixels[i] &gt;&gt; 8) &amp; 0xFF]</code> and <code>B[pixels[i] &amp; 0xFF]</code> do the same for the green and blue components.</li>\n<li>Finally, the values for the alpha, red, blue, and green components are merged with OR operators (<code>|</code>) and stored back in the same pixel, <code>pixel[i]</code>.</li>\n</ul>\n\n<p>It should be noted that the code is defective in that it fails to document its purpose, requirements, and methods.</p>\n"}, {"tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": false, "score": 0, "last_activity_date": 1565223379, "creation_date": 1565223379, "answer_id": 57403701, "question_id": 57396733, "link": "https://stackoverflow.com/questions/57396733/method-that-processes-pixels-in-a-certain-way/57403701#57403701", "title": "Method that processes pixels in a certain way", "body": "<p>regarding:</p>\n\n<pre><code>        pixels[i] =\n            (0xFF000000 &amp; pixels[i]) | (R[(pixels[i] &gt;&gt; 16) &amp; 0xFF]) | (G[(pixels[i] &gt;&gt; 8) &amp; 0xFF]) | (B[pixels[i] &amp; 0xFF]);\n</code></pre>\n\n<p>and your question:</p>\n\n<p><em>I could not understand what the last line does.</em></p>\n\n<p>The last line keeps the 'alpha' of each pixel, However, it 'OR's all the color (Reg, blue, green) information into the 'blue' part of the pixel.</p>\n\n<p>I can think of no reason to do that.</p>\n"}], "owner": {"reputation": 307, "user_id": 10468569, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-6OoMmR7ZK7k/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUeqUYFYLicdDTgf71JXspmB2_qMw/mo/photo.jpg?sz=128", "display_name": "abdullah celik", "link": "https://stackoverflow.com/users/10468569/abdullah-celik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 1, "accepted_answer_id": 57398746, "answer_count": 3, "score": 1, "last_activity_date": 1565223379, "creation_date": 1565188087, "last_edit_date": 1565188782, "question_id": 57396733, "link": "https://stackoverflow.com/questions/57396733/method-that-processes-pixels-in-a-certain-way", "title": "Method that processes pixels in a certain way", "body": "<p>in a code snippet, I have found the following method that I could not understand: </p>\n\n<pre><code>static void processPixels(int width, int height, int *pixels, int *rgb) {\n    int R[256];\n    int G[256];\n    int B[256];\n    for (int i = 0; i &lt; 256; i++) {\n        R[i] = (rgb[i] &lt;&lt; 16) &amp; 0x00FF0000;\n        G[i] = (rgb[i] &lt;&lt; 8) &amp; 0x0000FF00;\n        B[i] = rgb[i] &amp; 0x000000FF;\n    }\n\n    for (int i = 0; i &lt; width * height; i++) {\n        pixels[i] =\n                (0xFF000000 &amp; pixels[i]) | (R[(pixels[i] &gt;&gt; 16) &amp; 0xFF]) | (G[(pixels[i] &gt;&gt; 8) &amp; 0xFF]) | (B[pixels[i] &amp; 0xFF]);\n    }\n\n}\n</code></pre>\n\n<p>Can somebody explain what the purpose of those shiftings are ? Are they extracting sth. ? And what is happening in the last line ?</p>\n\n<p>After a little search, I found out that each pixel consists of three channels: <code>Red</code>, <code>Green</code> and <code>Blue</code>. \nAnd because they use a <code>width</code> and <code>height</code> variable, I assume that the <code>*pixels</code> is a pointer to an image. So, the for-loop walks through the pixels of an image pointed to by <code>*pixels</code> and modifies them each.\nBut again, I could not understand what the last line does.</p>\n\n<p>So, every help would be nice. </p>\n"}, {"tags": ["c", "struct", "graph"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1565187834, "post_id": 57396595, "comment_id": 101274974, "body": "This is a typical structure to be used in something like <i>linked list</i>. Here you go, you have the search terms."}, {"owner": {"reputation": 8002, "user_id": 1143850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2927fac544c9960cd5433688fe4cae1d?s=128&d=identicon&r=PG", "display_name": "Serge", "link": "https://stackoverflow.com/users/1143850/serge"}, "edited": false, "score": 0, "creation_date": 1565188043, "post_id": 57396595, "comment_id": 101275111, "body": "there is <b>no</b> struct within struct in your example. <code>next</code> is a <code>pointer</code> to an object of type <code>struct Node</code> which is the same struct the pointer belongs to."}], "answers": [{"tags": [], "owner": {"reputation": 56, "user_id": 11896672, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/c2a3e41c439fcd45a9dd510cfe3da5c7?s=128&d=identicon&r=PG", "display_name": "TeaRex", "link": "https://stackoverflow.com/users/11896672/tearex"}, "is_accepted": false, "score": 0, "last_activity_date": 1565188479, "creation_date": 1565188479, "answer_id": 57396838, "question_id": 57396595, "link": "https://stackoverflow.com/questions/57396595/meaning-of-a-struct-within-a-struct-in-c/57396838#57396838", "title": "meaning of a struct within a struct in c", "body": "<p>\"struct\" itself is not a type. \"struct [tag]\" is a type, for example \"struct Node\" in your code.</p>\n\n<p>In your case you define a structure type. Every structure of that type will contain a pointer to another structure of that type as a member called \"next\".</p>\n\n<p>This allows you to chain the structures together in a so called linked list. You store a pointer to the first structure in a variable, then you can follow the chain of links down to the structure you need.</p>\n\n<p>For example, you can do</p>\n\n<pre><code>struct Node *start;\nstart = malloc(sizeof struct Node);\nstart-&gt;dest = 7;\nstart-&gt;next = malloc(sizeof struct Node);\nstart-&gt;next-&gt;dest = 13;\nstart-&gt;next-&gt;next = malloc(sizeof struct Node);\nstart-&gt;next-&gt;next-&gt;dest = 19;\nprintf(\"%d %d %d\\n\", start-&gt;dest, start-&gt;next-&gt;dest, start-&gt;next-&gt;next-&gt;dest);\nfree(start-&gt;next-&gt;next);\nfree(start-&gt;next);\nfree(start);\n</code></pre>\n\n<p>Please note that this code omits all error handling, in real code you have to handle the case when malloc returns NULL.</p>\n\n<p>Also, in real code you would use such a structure in loops that traverse the chain, not directly as above.</p>\n"}, {"tags": [], "owner": {"reputation": 35932, "user_id": 1606345, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/IwiIM.png?s=128&g=1", "display_name": "David Ranieri", "link": "https://stackoverflow.com/users/1606345/david-ranieri"}, "is_accepted": false, "score": 0, "last_activity_date": 1565425885, "last_edit_date": 1565425885, "creation_date": 1565188747, "answer_id": 57396928, "question_id": 57396595, "link": "https://stackoverflow.com/questions/57396595/meaning-of-a-struct-within-a-struct-in-c/57396928#57396928", "title": "meaning of a struct within a struct in c", "body": "<p>As @Serge is pointing out in comments, is not a <code>struct</code> within a <code>struct</code>, is a reference (a pointer) to an object of the same type, an example:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nstruct Node {\n    int dest;\n    struct Node* next;\n};\n\nint main(void)\n{\n    /* An array of nodes */\n    struct Node nodes[] = {\n        {1, &amp;nodes[1]}, // next points to the next element\n        {2, &amp;nodes[2]}, // next points to the next element\n        {3, NULL}       // next points to null\n    };\n    /* A pointer to the first element of the array */                           \n    struct Node *node = nodes;\n\n    while (node) {\n        printf(\"%d\\n\", node-&gt;dest);\n        node = node-&gt;next; // node moves to the next element\n    }\n    return 0;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>1\n2\n3\n</code></pre>\n\n<p>Of course, in my example there is no benefit in using a linked list, linked lists are useful when we don't know the number of elements before-hand.</p>\n\n<p>Another example using dynamic memory:</p>\n\n<pre><code>struct Node *head, *node;\n\nnode = head = calloc(1, sizeof *node);\nnode-&gt;dest = 1;\nwhile (more_elements_needed) {\n    node-&gt;next = calloc(1, sizeof *node);\n    node-&gt;next-&gt;dest = node-&gt;dest + 1;\n    node = node-&gt;next;\n}\nfor (node = head; node != NULL; node = node-&gt;next) {\n    printf(\"%d\\n\", node-&gt;dest);\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8393363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4e8d251310cb86db86d2948d37469ea?s=128&d=identicon&r=PG&f=1", "display_name": "Weez Khan", "link": "https://stackoverflow.com/users/8393363/weez-khan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "closed_date": 1565188921, "answer_count": 2, "score": -2, "last_activity_date": 1565425885, "creation_date": 1565187723, "question_id": 57396595, "link": "https://stackoverflow.com/questions/57396595/meaning-of-a-struct-within-a-struct-in-c", "closed_reason": "Duplicate", "title": "meaning of a struct within a struct in c", "body": "<p>Can someone explain what we mean when we do, like what does struct Node* next do. does it create a pointer of type struct? any help and resources about structures in c would be helpful</p>\n\n<pre><code>struct Node {\n    int dest;\n    struct Node* next;\n};\n</code></pre>\n"}, {"tags": ["c", "strncpy"], "comments": [{"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 8, "creation_date": 1565187648, "post_id": 57396537, "comment_id": 101274860, "body": "The pointer char *dest is not initialized."}, {"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 3, "creation_date": 1565187654, "post_id": 57396537, "comment_id": 101274864, "body": "This is undefined behaviour. You&#39;re using an uninitialized pointer. <code>strncpy</code> dereferences this pointer, which could have any value, and tries to write to that memory. You need to have a destination buffer, consisting of valid memory, and pass a pointer to that."}, {"owner": {"reputation": 3793, "user_id": 1416672, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/073c7255e805ac09e55b5a6046ce5238?s=128&d=identicon&r=PG&f=1", "display_name": "HTF", "link": "https://stackoverflow.com/users/1416672/htf"}, "reply_to_user": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 0, "creation_date": 1565187849, "post_id": 57396537, "comment_id": 101274984, "body": "@ThomasJager - thanks for the comment, any idea why this happens only when the <code>for</code> loop is enabled?"}, {"owner": {"reputation": 348, "user_id": 3713731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd8efb159fb72a9ed644104d73400266?s=128&d=identicon&r=PG&f=1", "display_name": "Yogesh Chuahan", "link": "https://stackoverflow.com/users/3713731/yogesh-chuahan"}, "edited": false, "score": 0, "creation_date": 1565188104, "post_id": 57396537, "comment_id": 101275143, "body": "For me even in the case when for loop is commented it is giving segmentation fault."}, {"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 2, "creation_date": 1565188117, "post_id": 57396537, "comment_id": 101275149, "body": "@HTF It&#39;s undefined behaviour. Anything can happen, or nothing bad might happen. You can&#39;t predict it. What you are doing is likely messing with other arbitrary variables. The scope of the effects of undefined behaviour is outside of just where you do the behaviour. As soon as you have any in your program, the entire program&#39;s behaviour is undefined, and you can no longer predict what will happen."}, {"owner": {"reputation": 50126, "user_id": 1717300, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/81b91f602ce8acea8cbeb29f62725627?s=128&d=identicon&r=PG", "display_name": "hyde", "link": "https://stackoverflow.com/users/1717300/hyde"}, "edited": false, "score": 2, "creation_date": 1565189424, "post_id": 57396537, "comment_id": 101275908, "body": "Also note that <i>strncpy</i> isn&#39;t really a string function, in the sense that it doesn&#39;t necessarily produce a NUL-terminated C string in destination. A good rule of thumb is &quot;never use <i>strncpy</i>&quot;, because 99% of the use cases, it doesn&#39;t do what you want. If you have that 1%, you would know."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 6, "creation_date": 1565189595, "post_id": 57396537, "comment_id": 101275989, "body": "<i>Any idea why this happens only when the for loop is enabled?</i> This is basically like asking, &quot;Yesterday, I drove my car through a red light, and nothing happened.  Today I had the radio on, and when I drove through the red light, a truck crashed into me.  Any idea why this happens only when I have the radio on?&quot;"}, {"owner": {"reputation": 348, "user_id": 3713731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd8efb159fb72a9ed644104d73400266?s=128&d=identicon&r=PG&f=1", "display_name": "Yogesh Chuahan", "link": "https://stackoverflow.com/users/3713731/yogesh-chuahan"}, "reply_to_user": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 0, "creation_date": 1565190321, "post_id": 57396537, "comment_id": 101276427, "body": "As per the comment by @VladfromMoscow, converting to this  char dest[5], *ret; solved the problem for me."}, {"owner": {"reputation": 2149, "user_id": 2096401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVjii.jpg?s=128&g=1", "display_name": "TripeHound", "link": "https://stackoverflow.com/users/2096401/tripehound"}, "edited": false, "score": 1, "creation_date": 1565191197, "post_id": 57396537, "comment_id": 101276872, "body": "The most probable reason is that <code>printf()</code> usually involves allocating memory (into which it builds the output string)... the more you interact with memory, the more likely you are to encounter the effects of undefined behaviour."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "reply_to_user": {"reputation": 348, "user_id": 3713731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd8efb159fb72a9ed644104d73400266?s=128&d=identicon&r=PG&f=1", "display_name": "Yogesh Chuahan", "link": "https://stackoverflow.com/users/3713731/yogesh-chuahan"}, "edited": false, "score": 0, "creation_date": 1565217535, "post_id": 57396537, "comment_id": 101287652, "body": "@YogeshChuahan changing to <code>char dest[5], *ret;</code> still leads to undefined behaviour because you go on to use <code>strlen</code> on a non-null-terminated string"}, {"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 0, "creation_date": 1565223329, "post_id": 57396537, "comment_id": 101288843, "body": "Be very careful with <code>strncpy</code>, or preferably avoid it altogether. <a href=\"https://the-flat-trantor-society.blogspot.com/2012/03/no-strncpy-is-not-safer-strcpy.html\" rel=\"nofollow noreferrer\">the-flat-trantor-society.blogspot.com/2012/03/&hellip;</a>"}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 1, "creation_date": 1565228019, "post_id": 57396537, "comment_id": 101289665, "body": "Reopened: writing through an uninitialized pointer  is a substantially different case to writing to a string literal"}], "answers": [{"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1565226827, "post_id": 57403031, "comment_id": 101289476, "body": "Worth a reference to <a href=\"https://stackoverflow.com/questions/2397984/undefined-unspecified-and-implementation-defined-behavior\">Undefined, unspecified and implementation-defined behavior</a>"}, {"owner": {"reputation": 2149, "user_id": 2096401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVjii.jpg?s=128&g=1", "display_name": "TripeHound", "link": "https://stackoverflow.com/users/2096401/tripehound"}, "edited": false, "score": 1, "creation_date": 1565246356, "post_id": 57403031, "comment_id": 101293958, "body": "While the <code>for</code> loop itself is almost certainly a red herring, the <code>printf()</code> inside it almost certainly isn&#39;t. A call to <code>printf()</code> almost always involves allocation of memory, and so very often acts as a &quot;detector&quot; of memory misuse earlier in the code (most commonly because the &quot;misuse&quot; has corrupted the library&#39;s internal &quot;housekeeping data&quot; around blocks of allocated and free heap space)."}, {"owner": {"reputation": 1774, "user_id": 1201456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b33a546c937f65ce7ef0f29ca0f6a84d?s=128&d=identicon&r=PG", "display_name": "nickelpro", "link": "https://stackoverflow.com/users/1201456/nickelpro"}, "reply_to_user": {"reputation": 2149, "user_id": 2096401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVjii.jpg?s=128&g=1", "display_name": "TripeHound", "link": "https://stackoverflow.com/users/2096401/tripehound"}, "edited": false, "score": 0, "creation_date": 1565262351, "post_id": 57403031, "comment_id": 101302341, "body": "@TripeHound Sure but the crash in OP is happening in the original <code>strncpy</code>. Any memory allocation happening in either of version the program, <code>for</code> loop or not, doesn&#39;t get involved. The only driver of the crash is that original <code>dest</code> dereference."}], "tags": [], "owner": {"reputation": 1774, "user_id": 1201456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b33a546c937f65ce7ef0f29ca0f6a84d?s=128&d=identicon&r=PG", "display_name": "nickelpro", "link": "https://stackoverflow.com/users/1201456/nickelpro"}, "is_accepted": true, "score": 3, "last_activity_date": 1565223051, "last_edit_date": 1565223051, "creation_date": 1565217073, "answer_id": 57403031, "question_id": 57396537, "link": "https://stackoverflow.com/questions/57396537/c-strncpy-segfaults-when-using-pointer/57403031#57403031", "title": "C - strncpy segfaults when using pointer", "body": "<p>The answer per the spec that you're going to hear from most people is something like this: The program crashes because you're invoking UB by writing to an uninitialized pointer. At this point, crashing is a valid behavior, so sometimes it crashes and sometimes it does something else which is also valid (because UB).</p>\n\n<p>This is <em>correct-ish</em>, but it doesn't answer your question. Your question was, \"Why doesn't it crash in all circumstances?\" In your case, you only achieved a segfault when you changed the structure of your program to include a <code>for</code> loop that seems to perform unrelated behavior. For this we need a basic introduction to program memory layout and the nature of segfaults, we'll start with segfaults.</p>\n\n<h2>Segmentation Faults and Virtual Memory</h2>\n\n<p>A segmentation fault is a somewhat complex beast under the hood if you're unfamiliar with CPU architecture. Its purpose is simple enough, if an executing process tries to access memory that it shouldn't, a segfault should be issued. The devil in the details being, what defines \"memory the process shouldn't touch\"? And how should the segfault be communicated to the operating system?</p>\n\n<p>On modern operating systems and CPU architectures, a process' valid memory space is controlled using a <a href=\"https://en.wikipedia.org/wiki/Virtual_memory\" rel=\"nofollow noreferrer\">virtual memory system</a>. The operation of virtual memory is outside the scope of your question, but suffice to say both the operating system and the CPU itself are aware of what addresses your process can and cannot access. If your process strays outside the bounds of its allowed memory space, a segfault will be issued.</p>\n\n<p>To \"issue\" a segfault the CPU will <a href=\"https://en.wikipedia.org/wiki/Interrupt\" rel=\"nofollow noreferrer\">synchronously interrupt</a> your program, and alert the operating system you've done a naughty thing. These are also called \"exceptions\" or \"traps\", but they're all just different nomenclature for \"your program asked the CPU to do something that it can't or won't do\". The operating system handles the interrupt, and then issues the signal (*Nix) or exception (Win32) to your program. If your program hasn't set up a handler for that signal/exception, the OS gracefully crashes you.</p>\n\n<p>An interesting <a href=\"http://www.perch-base.org/glossary.htm#O\" rel=\"nofollow noreferrer\">oolie</a> about virtual memory is that it is generally only issued in packages of 2^12 continuous bytes (4KiB). So even if your process only wants, say, 10 bytes it's going to get handed at least 4KiB. This continuous grouping of bytes is called a \"page\" because it groups \"lines\" of memory.</p>\n\n<h2>Program Memory and the Stack</h2>\n\n<p>Even if your process never asks for memory using <code>malloc</code> or its ilk, its going to get handed a couple pages in order to implement what's called <a href=\"https://en.wikipedia.org/wiki/Stack-based_memory_allocation\" rel=\"nofollow noreferrer\">the stack</a> (which lends its name to certain websites). This is where your locally declared variables like <code>src</code>, <code>dest</code>, <code>ret</code>, and <code>s</code> live. It's also used to spill non-volatile CPU registers when moving between function calls, but that is also outside the scope.</p>\n\n<p>So, if <code>dest</code> is just a piece of memory on the stack, and is never initialized in your program, what's it pointing to? Well, whatever random data happens to exist at that memory address is now your pointer. Your program's operation is now at the whim of garbage bytes from the stack page.</p>\n\n<h2>Conclusion</h2>\n\n<p>If the garbage in the stack space happens to point somewhere inside one of the memory pages that was issued to your process for stack space, your process won't access invalid memory and will keep on chugging (or it points somewhere nearby, Linux can automatically grow the stack if you're within one page of the last valid page). However, if it points anywhere else, you cause an invalid memory access and the CPU alerts the relevant authorities. Your process is a criminal and will be treated accordingly.</p>\n\n<p>\"But nickelpro,\" you intercede, \"what does any of that have to do with the <code>for</code> loop?\" Nothing, the <code>for</code> loop is a red herring. In this case it happens to be biasing the stack allocation into a place where the garbage happens to cause a segfault. That could be related to many things, possibly as a consequence of <a href=\"https://en.wikipedia.org/wiki/Address_space_layout_randomization\" rel=\"nofollow noreferrer\">ASLR</a> or just random happenstance. Someone who knows more than me about virtual memory implementations could shine a light on this.</p>\n\n<p><strong>Errata</strong></p>\n\n<p>Now your program's structure also has a (I think) unintended bug in it which is exasperating the problem. You perform the initial string copy with:</p>\n\n<pre><code>ret = strncpy(dest, src, 5);\n</code></pre>\n\n<p>Which <strong>does not null-terminate the destination string</strong>, which means when you call:</p>\n\n<pre><code>size_t s = strlen(ret);\n</code></pre>\n\n<p><code>strlen</code> is going to keep reading until it hits a null byte. So even if <code>dest</code> happened to point somewhere valid, bad luck with the memory garbage will cause <code>strlen</code> to read its way into invalid memory.</p>\n"}], "owner": {"reputation": 3793, "user_id": 1416672, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/073c7255e805ac09e55b5a6046ce5238?s=128&d=identicon&r=PG&f=1", "display_name": "HTF", "link": "https://stackoverflow.com/users/1416672/htf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "accepted_answer_id": 57403031, "answer_count": 1, "score": -1, "last_activity_date": 1565228008, "creation_date": 1565187544, "question_id": 57396537, "link": "https://stackoverflow.com/questions/57396537/c-strncpy-segfaults-when-using-pointer", "title": "C - strncpy segfaults when using pointer", "body": "<p>I've got the following piece of code:</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint main(void) {\n    char *src = \"This is my string.\";\n    char *dest, *ret;\n    //char dest[64], *ret;\n    ret = strncpy(dest, src, 5);\n    size_t s = strlen(ret);\n\n    printf(\"src: %s\\n\", src);\n    printf(\"dst: %s|\\n\", dest);\n    printf(\"ret: %s|\\n\", ret);\n    printf(\"len: %d\\n\", s);\n\n    //for (int i = 0; i &lt; 5; i++) {\n    //    printf(\"i: %d\\n\", i);\n    //}\n\n    return 0;\n}\n</code></pre>\n\n<p><strong><code>for</code> loop disabled</strong></p>\n\n<pre><code>$ gcc -g -o test test.c; ./test \nsrc: This is my string.\ndst: This |\nret: This |\nlen: 5\n</code></pre>\n\n<p><strong><code>for</code> loop enabled</strong></p>\n\n<pre><code>$ gcc -g -o test test.c; ./test \nSegmentation fault (core dumped)\n</code></pre>\n\n<p>I wonder why this is failing only when the <code>for</code> loop is enabled.</p>\n\n<p>Is this just an undefined behavior because I'm using a dangling pointer for the <code>dest</code> argument or there is another explanation for this?</p>\n\n<p>By looking at the <code>gdb</code> session, it crashed when trying to assign a value from <code>ecx</code> to <code>rdi</code> register?</p>\n\n<pre><code>(gdb) bt\n#0  0x00007ffff7f4a1a7 in __strncpy_avx2 () from /lib64/libc.so.6\n#1  0x000000000040116e in main () at stack.c:8\n(gdb) x/i 0x00007ffff7f4a1a7\n=&gt; 0x7ffff7f4a1a7 &lt;__strncpy_avx2+1591&gt;:    mov    DWORD PTR [rdi],ecx\n(gdb) x/i $rdi\n0x401060 &lt;_start&gt;:  endbr64\n(gdb) p $rdi\n$7 = 4198496\n(gdb) p $ecx\n$8 = 1936287828\n</code></pre>\n"}, {"tags": ["c", "linux-kernel", "suid"], "answers": [{"tags": [], "owner": {"reputation": 496, "user_id": 6396407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/861d9b64c5b7d42bebbdb280baf7f4bf?s=128&d=identicon&r=PG&f=1", "display_name": "Alessandro", "link": "https://stackoverflow.com/users/6396407/alessandro"}, "is_accepted": false, "score": 1, "last_activity_date": 1565190288, "creation_date": 1565190288, "answer_id": 57397372, "question_id": 57396386, "link": "https://stackoverflow.com/questions/57396386/check-suid-attribute-for-open-file-within-a-kernel-module/57397372#57397372", "title": "Check SUID attribute for open file within a kernel module", "body": "<p>I was already in the right direction, but somehow, I didn't realize it. </p>\n\n<p>The inode structure has a field:</p>\n\n<pre><code>umode_t                     i_mode;\n</code></pre>\n\n<p>Which represents the file permissions.</p>\n\n<p>In the file <strong>include/uapi/linux/stat.h</strong> you can see the file permissions starting from its very beginning.</p>\n\n<pre><code>#define S_IFMT  00170000\n#define S_IFSOCK 0140000\n#define S_IFLNK  0120000\n#define S_IFREG  0100000\n#define S_IFBLK  0060000\n#define S_IFDIR  0040000\n#define S_IFCHR  0020000\n#define S_IFIFO  0010000\n#define S_ISUID  0004000\n#define S_ISGID  0002000\n#define S_ISVTX  0001000\n\n#define S_ISLNK(m)  (((m) &amp; S_IFMT) == S_IFLNK)\n#define S_ISREG(m)  (((m) &amp; S_IFMT) == S_IFREG)\n#define S_ISDIR(m)  (((m) &amp; S_IFMT) == S_IFDIR)\n#define S_ISCHR(m)  (((m) &amp; S_IFMT) == S_IFCHR)\n#define S_ISBLK(m)  (((m) &amp; S_IFMT) == S_IFBLK)\n#define S_ISFIFO(m) (((m) &amp; S_IFMT) == S_IFIFO)\n#define S_ISSOCK(m) (((m) &amp; S_IFMT) == S_IFSOCK)\n\n#define S_IRWXU 00700\n#define S_IRUSR 00400\n#define S_IWUSR 00200\n#define S_IXUSR 00100\n\n#define S_IRWXG 00070\n#define S_IRGRP 00040\n#define S_IWGRP 00020\n#define S_IXGRP 00010\n\n#define S_IRWXO 00007\n#define S_IROTH 00004\n#define S_IWOTH 00002\n#define S_IXOTH 00001\n</code></pre>\n\n<p>I hope this answer can be useful to someone like me who can't see the obvious.</p>\n"}], "owner": {"reputation": 496, "user_id": 6396407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/861d9b64c5b7d42bebbdb280baf7f4bf?s=128&d=identicon&r=PG&f=1", "display_name": "Alessandro", "link": "https://stackoverflow.com/users/6396407/alessandro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565192422, "creation_date": 1565187033, "last_edit_date": 1565192422, "question_id": 57396386, "link": "https://stackoverflow.com/questions/57396386/check-suid-attribute-for-open-file-within-a-kernel-module", "title": "Check SUID attribute for open file within a kernel module", "body": "<p>I'm writing a kernel module which needs to check the attribute <strong>suid</strong> of a given <strong>file</strong> descriptor.\nI checked through the various kernel structure, but I couldn't find any clue on the topic. </p>\n\n<p>I expected somehow to find a field  containing a bitwise Unix-stile permission, but I couldn't find any.</p>\n\n<p>My goal is to write a function which just states if the file referenced by a given file descriptor has its suid attribute set or not.</p>\n\n<pre><code>int issuid(file *f){\n ...\n}\n</code></pre>\n\n<p>My best bet would be looking into the <strong>inode</strong> structure, where I did search (wihout success),  but considering the inode as the in-memory representation of a file on the physical disk, and considering some filesystem do not have Unix-style file permissions, I'm not still sure I'm looking in the right direction.</p>\n"}, {"tags": ["c", "unit-testing", "valgrind", "glib"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1565186149, "post_id": 57395919, "comment_id": 101273919, "body": "How about starting by taking Valgrind&#39;s advice to re-run with <code>--leak-check=full</code> to get details of the (possibly) leaked memory?  Presumably it will point to something in glib, but you should get a better idea what you&#39;re dealing with.  And that will also prepare you to write a Valgrind suppression file if that turns out to be the best available alternative."}, {"owner": {"reputation": 153, "user_id": 8086174, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/141413448f4bc1292d8bb3327db4165e?s=128&d=identicon&r=PG&f=1", "display_name": "Yannick", "link": "https://stackoverflow.com/users/8086174/yannick"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1565186575, "post_id": 57395919, "comment_id": 101274181, "body": "Yes I realised right after posting the question that I forgot to include that flag in my minimal example, I updated the question, thanks!"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1565187557, "post_id": 57395919, "comment_id": 101274800, "body": "Related: <a href=\"https://stackoverflow.com/q/17642433/2402272\">why pthread causes a memory leak</a> and <a href=\"https://stackoverflow.com/q/5610677/2402272\">valgrind memory leak errors when using pthread_create</a>."}], "answers": [{"comments": [{"owner": {"reputation": 7536, "user_id": 771066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d207f95c530f2b59f763d7b699f6d81?s=128&d=identicon&r=PG", "display_name": "ebassi", "link": "https://stackoverflow.com/users/771066/ebassi"}, "edited": false, "score": 2, "creation_date": 1565192428, "post_id": 57397029, "comment_id": 101277572, "body": "GLib ships its own suppression file, installed in the standard location of: <code>${datadir}&#47;glib-2.0&#47;valgrind</code>, where <code>datadir</code> typically expands to <code>&#47;usr&#47;share</code> on most common Linux systems. The suppression file is maintained by the GLib developers, so it should always be in sync with the version of GLib installed under the same prefix."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 7536, "user_id": 771066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d207f95c530f2b59f763d7b699f6d81?s=128&d=identicon&r=PG", "display_name": "ebassi", "link": "https://stackoverflow.com/users/771066/ebassi"}, "edited": false, "score": 0, "creation_date": 1565195164, "post_id": 57397029, "comment_id": 101278898, "body": "Excellent observation, @ebassi.  Indeed, if GLib provides a suppression file then one should engage that.  Only in the event that the possible leak was still reported would one need to generate one&#39;s own suppression file (which could then be used <i>in addition to</i> the one distributed with GLib)."}, {"owner": {"reputation": 153, "user_id": 8086174, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/141413448f4bc1292d8bb3327db4165e?s=128&d=identicon&r=PG&f=1", "display_name": "Yannick", "link": "https://stackoverflow.com/users/8086174/yannick"}, "edited": false, "score": 0, "creation_date": 1565262794, "post_id": 57397029, "comment_id": 101302599, "body": "Thank you for your help you two! It does seem like the issue is still reported even with the <code>glib.supp</code> file, generating a suppression file as you outlined makes it not report it anymore."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 2, "last_activity_date": 1565189104, "creation_date": 1565189104, "answer_id": 57397029, "question_id": 57395919, "link": "https://stackoverflow.com/questions/57395919/valgrind-gives-possibly-lost-memory-with-g-test-trap-subprocess/57397029#57397029", "title": "Valgrind gives possibly lost memory with g_test_trap_subprocess ()", "body": "<p>That's a somewhat odd stack trace for the allocation.  <code>g_test_trap_subprocess()</code> is supposed to run the specified test(s) in a subprocess, but it is creating a thread.  These are not mutually exclusive -- a subprocess may well also be forked -- but mixing threads with forking is a tricky, finicky business.</p>\n\n<p>In any event, the trace seems to indicate that the problem arises from glib starting a thread that is not properly terminated and cleaned up before your program exits.  Since the issue is with an internal thread, the best solution would involve calling an appropriate shutdown function.  I don't see such a function documented either specifically for g_test or more generally among the GLib utility functions, nor do I see any documentation of a need to call such a function, so I'm going to attribute the issue to a minor flaw in Glib.</p>\n\n<p>Unless you can find a glib-based solution that I missed, your best alternative is probably to accept that what you're seeing is a glib quirk, and to write <a href=\"http://valgrind.org/docs/manual/mc-manual.html#mc-manual.suppfiles\" rel=\"nofollow noreferrer\">a Valgrind suppression file</a> that you can then use to <a href=\"http://valgrind.org/docs/manual/manual-core.html#manual-core.suppress\" rel=\"nofollow noreferrer\">instruct Valgrind not to report on it</a>.  Note that although you can write such a file by hand, using the information provided in the leak report, the easiest way to get one is to run Valgrind with the <code>--gen-suppressions=yes</code> option.  However you get it, you can instruct valgrind to use it on subsequent runs by using a <code>--suppressions=/path/to/file.supp</code> option on the Valgrind command line.</p>\n\n<p>Do consult the Valgrind manual (linked above) for details on suppression files, including format, how to create and modify them, and how to use them.</p>\n"}], "owner": {"reputation": 153, "user_id": 8086174, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/141413448f4bc1292d8bb3327db4165e?s=128&d=identicon&r=PG&f=1", "display_name": "Yannick", "link": "https://stackoverflow.com/users/8086174/yannick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 57397029, "answer_count": 1, "score": 0, "last_activity_date": 1565189104, "creation_date": 1565185499, "last_edit_date": 1565186007, "question_id": 57395919, "link": "https://stackoverflow.com/questions/57395919/valgrind-gives-possibly-lost-memory-with-g-test-trap-subprocess", "title": "Valgrind gives possibly lost memory with g_test_trap_subprocess ()", "body": "<p>I am currently working on unit tests with glib-Testing for a C library I am writing. Part of these tests check that code fails on expected occasions (I am used to these sort of tests from Python where you would assert a certain Exception was raised). I am using the recipe in <a href=\"https://developer.gnome.org/glib/stable/glib-Testing.html#g-test-trap-subprocess\" rel=\"nofollow noreferrer\">the manual for glib-Testing for <code>g_test_trap_subprocess ()</code></a> (see minimal example below) which works fine from the unit-testing point of view and gives the correct tests.</p>\n\n<p>My problem is when I run valgrind on the following minimal example (<code>test_glib.c</code>):</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;glib.h&gt;\n\nvoid test_possibly_lost(){\n        if (g_test_subprocess()){\n                g_assert(1 &gt; 2);\n        }\n        g_test_trap_subprocess(NULL, 0, 0);\n        g_test_trap_assert_failed();\n}\n\nint main(int argc, char **argv){\n        g_test_init(&amp;argc, &amp;argv, NULL);\n\n        g_test_add_func(\"/set1/test\", test_possibly_lost);\n\n        return g_test_run();\n}\n</code></pre>\n\n<p>compiled with</p>\n\n<pre><code>gcc `pkg-config --libs --cflags glib-2.0` test_glib.c\n</code></pre>\n\n<p>The output of <code>valgrind --leak-check=full ./a.out</code> is then</p>\n\n<pre><code>==15260== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\n==15260== Using Valgrind-3.14.0 and LibVEX; rerun with -h for copyright info\n==15260== Command: ./a.out\n==15260== \n/set1/test: OK\n==15260== \n==15260== HEAP SUMMARY:\n==15260==     in use at exit: 24,711 bytes in 40 blocks\n==15260==   total heap usage: 2,507 allocs, 2,467 frees, 235,121 bytes allocated\n==15260== \n==15260== 272 bytes in 1 blocks are possibly lost in loss record 36 of 40\n==15260==    at 0x483AB65: calloc (vg_replace_malloc.c:752)\n==15260==    by 0x4012AC1: allocate_dtv (in /usr/lib/ld-2.29.so)\n==15260==    by 0x4013431: _dl_allocate_tls (in /usr/lib/ld-2.29.so)\n==15260==    by 0x4BD51AD: pthread_create@@GLIBC_2.2.5 (in /usr/lib/libpthread-2.29.so)\n==15260==    by 0x48BE42A: ??? (in /usr/lib/libglib-2.0.so.0.6000.6)\n==15260==    by 0x48BE658: g_thread_new (in /usr/lib/libglib-2.0.so.0.6000.6)\n==15260==    by 0x48DCBF0: ??? (in /usr/lib/libglib-2.0.so.0.6000.6)\n==15260==    by 0x48DCC43: ??? (in /usr/lib/libglib-2.0.so.0.6000.6)\n==15260==    by 0x48DCD11: g_child_watch_source_new (in /usr/lib/libglib-2.0.so.0.6000.6)\n==15260==    by 0x48B7DF4: ??? (in /usr/lib/libglib-2.0.so.0.6000.6)\n==15260==    by 0x48BEA93: g_test_trap_subprocess (in /usr/lib/libglib-2.0.so.0.6000.6)\n==15260==    by 0x1091DD: test_possibly_lost (in /dir/to/aout/a.out)\n==15260== \n==15260== LEAK SUMMARY:\n==15260==    definitely lost: 0 bytes in 0 blocks\n==15260==    indirectly lost: 0 bytes in 0 blocks\n==15260==      possibly lost: 272 bytes in 1 blocks\n==15260==    still reachable: 24,439 bytes in 39 blocks\n==15260==         suppressed: 0 bytes in 0 blocks\n==15260== Reachable blocks (those to which a pointer was found) are not shown.\n==15260== To see them, rerun with: --leak-check=full --show-leak-kinds=all\n==15260== \n==15260== For counts of detected and suppressed errors, rerun with: -v\n==15260== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)\n</code></pre>\n\n<p>The possibly lost memory bothers me, coincidentally my code also possibly loses 272 bytes so I think this might be a problem with the way I use glib rather than my own structs. Personally, I would treat possibly lost memory as definitely lost and I would like to get rid of it.</p>\n\n<p>So my question is whether there is a <code>free</code> that I could cleverly insert to free the memory, a different recipe to check for failed asserts or are these lost 272 bytes just something I will have to live with?</p>\n"}, {"tags": ["c", "memory-management", "memory-leaks", "malloc"], "comments": [{"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 2, "creation_date": 1565184717, "post_id": 57395666, "comment_id": 101272967, "body": "Provide a minimal complete example that reproduces the problem."}, {"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 1, "creation_date": 1565184832, "post_id": 57395666, "comment_id": 101273072, "body": "What is <code>len_b</code>?"}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "reply_to_user": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 0, "creation_date": 1565184905, "post_id": 57395666, "comment_id": 101273117, "body": "@ThomasJager It is unimportant."}, {"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 3, "creation_date": 1565185094, "post_id": 57395666, "comment_id": 101273237, "body": "Some error occurred in the code prior to the <code>malloc</code>. Something like memory corruption or double-free."}, {"owner": {"reputation": 8154, "user_id": 2470782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921783e0584f9ace7e05d303e4d48869?s=128&d=identicon&r=PG", "display_name": "Ingo Leonhardt", "link": "https://stackoverflow.com/users/2470782/ingo-leonhardt"}, "reply_to_user": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 1, "creation_date": 1565185602, "post_id": 57395666, "comment_id": 101273560, "body": "@VladfromMoscow maybe <code>len_b</code> is important. I&#39;ve seen implementations where <code>malloc(0)</code>  returns <code>NULL</code>"}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "reply_to_user": {"reputation": 8154, "user_id": 2470782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921783e0584f9ace7e05d303e4d48869?s=128&d=identicon&r=PG", "display_name": "Ingo Leonhardt", "link": "https://stackoverflow.com/users/2470782/ingo-leonhardt"}, "edited": false, "score": 0, "creation_date": 1565185677, "post_id": 57395666, "comment_id": 101273602, "body": "@IngoLeonhardt In this case the compiler issued an error for the declaration uint8_t hex_b[len_b];"}, {"owner": {"reputation": 8154, "user_id": 2470782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921783e0584f9ace7e05d303e4d48869?s=128&d=identicon&r=PG", "display_name": "Ingo Leonhardt", "link": "https://stackoverflow.com/users/2470782/ingo-leonhardt"}, "reply_to_user": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 0, "creation_date": 1565185816, "post_id": 57395666, "comment_id": 101273684, "body": "@VladfromMoscow Ive haven&#39;t had an issue here: <code>int main(int argc, char *argv[]) { char buf[argc-1]; printf(&quot;%p\\n&quot;, buf); return(0);}.</code> The compiler can&#39;t always detect 0"}, {"owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "edited": false, "score": 0, "creation_date": 1565190542, "post_id": 57395666, "comment_id": 101276537, "body": "Try running the program under [valgrind[(<a href=\"http://valgrind.org/\" rel=\"nofollow noreferrer\">valgrind.org</a>). It usually does a stellar job pointing to the source of such memory corruption errors."}], "owner": {"reputation": 91, "user_id": 11123197, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-KQySF1-8Bzs/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOUPGh-oZWLUUJLvD6hAhkPlG3oIQ/mo/photo.jpg?sz=128", "display_name": "superstack", "link": "https://stackoverflow.com/users/11123197/superstack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565184602, "creation_date": 1565184602, "question_id": 57395666, "link": "https://stackoverflow.com/questions/57395666/sysmalloc-assertion-failed-in-c", "title": "sysmalloc assertion failed in c", "body": "<p>I have use malloc() many time in my program. It works perfectly most of the time but for some inputdoes works, and  gdb prompt the following error:</p>\n\n<p><strong>Error:</strong></p>\n\n<pre><code> my_program: malloc.c:2394: sysmalloc: Assertion `(old_top==initial_top \n (av) &amp;&amp; old_size == 0) || ((unsigned long) (old_size) &gt;= MINSIZE &amp;&amp; prev_inuse \n (old_top) &amp;&amp; ((unsigned long) old_end &amp; (pagesize -  1)) == 0)' failed.\n Aborted\n</code></pre>\n\n<p><strong>The portion of code is:</strong></p>\n\n<pre><code> uint8_t *hex_b;\n if((hex_b = malloc(len_b))==NULL)\n {\n   fprintf(stderr,\" Malloc Failed\\n\");\n }\n</code></pre>\n\n<p><strong>But It works ,when i change the code as:</strong></p>\n\n<pre><code>uint8_t hex_b[len_b];\n</code></pre>\n"}, {"tags": ["c", "linux", "gcc", "cmake"], "comments": [{"owner": {"reputation": 11727, "user_id": 3987854, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/OV64v.jpg?s=128&g=1", "display_name": "squareskittles", "link": "https://stackoverflow.com/users/3987854/squareskittles"}, "edited": false, "score": 2, "creation_date": 1565184850, "post_id": 57395538, "comment_id": 101273081, "body": "Your CMake build is looking for the libraries here <code>&#47;home&#47;user&#47;cmake_libs&#47;core_c&#47;..&#47;lib64</code>, but it&#39;s not clear if your GCC build is looking there. Are there libraries in that folder that conflict with your system&#39;s libraries in <code>&#47;lib64&#47;</code>?"}, {"owner": {"reputation": 305, "user_id": 3360601, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d79fbdac0390c98c2ea588d1fe64e120?s=128&d=identicon&r=PG&f=1", "display_name": "user3360601", "link": "https://stackoverflow.com/users/3360601/user3360601"}, "reply_to_user": {"reputation": 11727, "user_id": 3987854, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/OV64v.jpg?s=128&g=1", "display_name": "squareskittles", "link": "https://stackoverflow.com/users/3987854/squareskittles"}, "edited": false, "score": 0, "creation_date": 1565185160, "post_id": 57395538, "comment_id": 101273277, "body": "@squareskittles, libprotocol_common.so , libthread.so, libvip.so, libcrypto.so.1.0.0 are only in my custom folder located. There are some duplicates in my lib64 and system /lib64/ but with other libs."}, {"owner": {"reputation": 305, "user_id": 3360601, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d79fbdac0390c98c2ea588d1fe64e120?s=128&d=identicon&r=PG&f=1", "display_name": "user3360601", "link": "https://stackoverflow.com/users/3360601/user3360601"}, "reply_to_user": {"reputation": 11727, "user_id": 3987854, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/OV64v.jpg?s=128&g=1", "display_name": "squareskittles", "link": "https://stackoverflow.com/users/3987854/squareskittles"}, "edited": false, "score": 0, "creation_date": 1565185666, "post_id": 57395538, "comment_id": 101273593, "body": "@squareskittles, gcc definitely takes looking in my lib64 folder, I checked that. Also I changed in cmake path for libs from <code>&#47;home&#47;user&#47;cmake_libs&#47;core_c&#47;..&#47;lib64</code> to <code>&#47;home&#47;user&#47;cmake_libs&#47;lib64</code> - and nothing happend"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1565185669, "post_id": 57395538, "comment_id": 101273595, "body": "Do you run the <code>cmake</code> and <code>make</code> commands from the same directory where you run your explicit <code>gcc</code> command? Will the CMake-handled linking be done in the same directory? With your explicit <code>gcc</code> command you use relative paths for the <code>-L</code> option and <code>-Wl,-rpath</code> options, but in the <code>CMakeLists.txt</code> file you show you have absolute paths for the <code>-L</code> options but keep the relative path for the <code>-Wl,-rpath</code> option. Make sure that the paths for both <code>-L</code> and <code>-Wl,-rpath</code> matches. The important option here is the <code>-Wl,-rpath</code> option."}, {"owner": {"reputation": 305, "user_id": 3360601, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d79fbdac0390c98c2ea588d1fe64e120?s=128&d=identicon&r=PG&f=1", "display_name": "user3360601", "link": "https://stackoverflow.com/users/3360601/user3360601"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565186452, "post_id": 57395538, "comment_id": 101274101, "body": "@Someprogrammerdude, I love you"}, {"owner": {"reputation": 11727, "user_id": 3987854, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/OV64v.jpg?s=128&g=1", "display_name": "squareskittles", "link": "https://stackoverflow.com/users/3987854/squareskittles"}, "edited": false, "score": 1, "creation_date": 1565186501, "post_id": 57395538, "comment_id": 101274133, "body": "Also, in your CMake <code>target_link_libraries</code> commands, you shouldn&#39;t have to bother with the <code>-L</code> and <code>-l</code> flags; you only need to specify the library names or paths."}], "answers": [{"tags": [], "owner": {"reputation": 305, "user_id": 3360601, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d79fbdac0390c98c2ea588d1fe64e120?s=128&d=identicon&r=PG&f=1", "display_name": "user3360601", "link": "https://stackoverflow.com/users/3360601/user3360601"}, "is_accepted": false, "score": 0, "last_activity_date": 1565186496, "creation_date": 1565186496, "answer_id": 57396226, "question_id": 57395538, "link": "https://stackoverflow.com/questions/57395538/compiling-difference-between-gcc-and-cmake-compilation-ldd-command/57396226#57396226", "title": "Compiling difference between gcc and cmake compilation - ldd command", "body": "<p>As said @Someprogrammerdude, </p>\n\n<blockquote>\n  <blockquote>\n    <p>Make sure that the paths for both -L and -Wl,-rpath matches. The important option here is the -Wl,-rpath option.</p>\n  </blockquote>\n</blockquote>\n"}], "owner": {"reputation": 305, "user_id": 3360601, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d79fbdac0390c98c2ea588d1fe64e120?s=128&d=identicon&r=PG&f=1", "display_name": "user3360601", "link": "https://stackoverflow.com/users/3360601/user3360601"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565186496, "creation_date": 1565184206, "last_edit_date": 1565184862, "question_id": 57395538, "link": "https://stackoverflow.com/questions/57395538/compiling-difference-between-gcc-and-cmake-compilation-ldd-command", "title": "Compiling difference between gcc and cmake compilation - ldd command", "body": "<p>I need to create shared library using cmake.\nIt compiles, but ldd command shows that not all links found.</p>\n\n<p>GCC build:</p>\n\n<pre><code>gcc -g -Wall -O0 -m64 -Wl,--unresolved-symbols=ignore-in-shared-libs  -fPIC -shared -o libcore.so  -Iinclude -Iinc -Itls -Llib64 -Wl,-rpath,protocol_so:lib64:libwifi -DLINUX -DCPU_64 -lprotocol_common -lthread -lvip -lcrypto -lglib-2.0 -lm -lpthread -lxml2\n</code></pre>\n\n<p>ldd command:</p>\n\n<pre><code>&gt; ldd libcore.so \n        linux-vdso.so.1 =&gt;  (0x00007fff30fff000)\n        libachk.so =&gt; /lib64/libachk.so (0x00007f2d9d7b5000)\n        libprotocol_common.so =&gt; lib64/libprotocol_common.so (0x00007f2d9d6b1000)\n        libthread.so =&gt; lib64/libthread.so (0x00007f2d9d5af000)\n        libvip.so =&gt; lib64/libvip.so (0x00007f2d9d20d000)\n        libcrypto.so.1.0.0 =&gt; lib64/libcrypto.so.1.0.0 (0x00007f2d9cef2000)\n        libglib-2.0.so.0 =&gt; lib64/libglib-2.0.so.0 (0x00007f2d9cd19000)\n        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f2d9caa0000)\n        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f2d9c882000)\n        libxml2.so.2 =&gt; /usr/lib64/libxml2.so.2 (0x00007f2d9c526000)\n        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f2d9c1af000)\n        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f2d9bfaa000)\n        librt.so.1 =&gt; /lib64/librt.so.1 (0x00007f2d9bda1000)\n        libstdc++.so.6 =&gt; /usr/lib64/libstdc++.so.6 (0x00007f2d9ba9b000)\n        libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007f2d9b884000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f2d9dbf1000)\n        libz.so.1 =&gt; /lib64/libz.so.1 (0x00007f2d9b66e000)\n</code></pre>\n\n<p>Now I need to build this library with cmake.\nCmake script:</p>\n\n<pre><code>cmake_minimum_required(VERSION 3.2)\nproject(core_lib C)\n\nset(CMAKE_C_STANDARD 11)\nset(CMAKE_VERBOSE_MAKEFILE ON)\nset(CMAKE_AUTOGEN_VERBOSE ON)\n\nset (CMAKE_C_FLAGS_COMMON \"-g -std=gnu89 -Wall -O0 -m64 -fPIC -DLINUX -DCPU_64\")\nif(NOT CMAKE_C_CREATE_SHARED_LIBRARY)\n    set(CMAKE_C_CREATE_SHARED_LIBRARY\n            \"&lt;CMAKE_C_COMPILER&gt; &lt;CMAKE_SHARED_LIBRARY_C_FLAGS&gt; &lt;LANGUAGE_COMPILE_FLAGS&gt; &lt;LINK_FLAGS&gt; &lt;CMAKE_SHARED_LIBRARY_CREATE_C_FLAGS&gt; &lt;SONAME_FLAG&gt;&lt;TARGET_SONAME&gt; -o &lt;TARGET&gt; &lt;OBJECTS&gt; &lt;LINK_LIBRARIES&gt;\")\nendif()\n\nfile(GLOB SOURCE_FILES\n        *.h\n        *.c\n        )\nadd_library(core_lib SHARED\n        ${SOURCE_FILES}\n        )\nset_target_properties(core_lib PROPERTIES LINKER_LANGUAGE C)\nset_target_properties(core_lib PROPERTIES COMPILE_FLAGS \" ${CMAKE_C_FLAGS_COMMON}\")\nset (CMAKE_SHARED_LINKER_FLAGS \"-Wl,--unresolved-symbols=ignore-in-shared-libs -shared -Wl,-rpath,protocol_so:lib64:libwifi\")\ntarget_link_libraries(core_lib  -L${PROJECT_SOURCE_DIR}/..)\ntarget_link_libraries(core_lib  -L${PROJECT_SOURCE_DIR}/../lib64)\ntarget_link_libraries(core_lib  -lprotocol_common -lthread -lvip -lcrypto -lglib-2.0 -lm -lpthread -lxml2)\ntarget_include_directories(core_lib PUBLIC\n        ${PROJECT_SOURCE_DIR}/../include\n        ${PROJECT_SOURCE_DIR}/../inc\n        ${PROJECT_SOURCE_DIR}/../tls\n        )\n</code></pre>\n\n<p>Some of generated commands:</p>\n\n<pre><code>/usr/bin/gcc  -Dcore_lib_EXPORTS -g -fPIC -I/home/user/cmake_libs/core_c/../include -I/home/user/cmake_libs/core_c/../inc -I/home/user/cmake_libs/core_c/../tls  -g -std=gnu89 -Wall -O0 -m64 -fPIC -DLINUX -DCPU_64 -o CMakeFiles/core_lib.dir/log.c.o   -c /home/user/cmake_libs/core_c/log.c\n\n/usr/bin/gcc  -fPIC -g -Wl,--unresolved-symbols=ignore-in-shared-libs -shared -Wl,-rpath,protocol_so:lib64:libwifi -shared -Wl,-soname,libcore_lib.so -o libcore_lib.so CMakeFiles/core_lib.dir/log.c.o CMakeFiles/core_lib.dir/logic.c.o CMakeFiles/core_lib.dir/json.c.o CMakeFiles/core_lib.dir/msg.c.o CMakeFiles/\u0441ore_lib.dir/buf.c.o -L/home/user/cmake_libs/core_c/.. -L/home/user/cmake_libs/core_c/../lib64 -lprotocol_common -lthread -lvip -lcrypto -lglib-2.0 -lm -lpthread -lxml2\n</code></pre>\n\n<p>ldd command:</p>\n\n<pre><code>&gt; ldd libcore_lib.so \n        linux-vdso.so.1 =&gt;  (0x00007fff329ff000)\n        libachk.so =&gt; /lib64/libachk.so (0x00007f9a91007000)\n        libprotocol_common.so =&gt; not found\n        libthread.so =&gt; not found\n        libvip.so =&gt; not found\n        libcrypto.so.1.0.0 =&gt; not found\n        libglib-2.0.so.0 =&gt; /usr/lib64/libglib-2.0.so.0 (0x00007f9a90d40000)\n        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f9a90ac7000)\n        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f9a908a9000)\n        libxml2.so.2 =&gt; /usr/lib64/libxml2.so.2 (0x00007f9a9054d000)\n        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f9a901d6000)\n        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f9a8ffd1000)\n        librt.so.1 =&gt; /lib64/librt.so.1 (0x00007f9a8fdc8000)\n        libpcre.so.0 =&gt; /usr/lib64/libpcre.so.0 (0x00007f9a8fb98000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f9a9146a000)\n        libz.so.1 =&gt; /lib64/libz.so.1 (0x00007f9a8f981000)\n\n</code></pre>\n\n<p>Why some of links not found in cmake build?\nI see no difference between building versions.</p>\n\n<p>What do I miss? May be some flags at linkage stage?</p>\n\n<p><strong>UPD.</strong></p>\n\n<p>Also it is interesting, that gcc links libs from my lib64 folder.</p>\n\n<p>Cmake links from /usr/lib64, but I didn't add this path. (eg. libglib-2.0.so.0)</p>\n\n<p>Why cmake ignores my custom path for libs (lib64)? </p>\n"}, {"tags": ["c", "c-preprocessor"], "comments": [{"owner": {"reputation": 2055, "user_id": 6564148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u3HL5.png?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/6564148/george"}, "edited": false, "score": 3, "creation_date": 1565183867, "post_id": 57395298, "comment_id": 101272382, "body": "Feels like this might be an XY problem. Can you show the code that assigns <code>function_pointer</code>?"}, {"owner": {"reputation": 3305, "user_id": 1428695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a843c704cdb7e32a93769cddfed4747?s=128&d=identicon&r=PG", "display_name": "yhyrcanus", "link": "https://stackoverflow.com/users/1428695/yhyrcanus"}, "edited": false, "score": 0, "creation_date": 1565184995, "post_id": 57395298, "comment_id": 101273176, "body": "How would your preprocessor know if a function pointer is mapped? Instead of using a function pointer, you could <code>#define FUNCTION_TO_USE</code> as your function, and then do <code>#ifndef FUNCTION_TO_USE</code>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1565185481, "post_id": 57395298, "comment_id": 101273486, "body": "You want the preprocessor to know how your code will execute. You are asking too much of it. The poor little text substitition engine doesn&#39;t even know what code <i>is</i>."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1565189965, "post_id": 57395298, "comment_id": 101276198, "body": "It is most likely that the C preprocessor will think that both <code>function_pointer</code> and <code>NULLpointer</code> are zero (integer zero) and therefore that they are &#39;the same value&#39;.  Function addresses aren&#39;t known until link time at the earliest \u2014 that&#39;s the other end of the compilation process from the preprocessing phase."}], "answers": [{"tags": [], "owner": {"reputation": 16785, "user_id": 3355476, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/YdMWy.jpg?s=128&g=1", "display_name": "Codor", "link": "https://stackoverflow.com/users/3355476/codor"}, "is_accepted": false, "score": 1, "last_activity_date": 1565183737, "creation_date": 1565183737, "answer_id": 57395379, "question_id": 57395298, "link": "https://stackoverflow.com/questions/57395298/is-it-possible-to-validate-an-expression-using-preprocessor-directives-like-i/57395379#57395379", "title": "Is it possible to validate an expression using preprocessor directives ? like #if (a == b)", "body": "<p>To my understanding this is <em>not</em> possible due to conceptual reasons because the sketched condition can be evaluated only at runtime, while the decision for inclusion and exclusion of code must be done at compile-time.</p>\n"}, {"tags": [], "owner": {"reputation": 51244, "user_id": 952747, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/86ebf3cf751f63acb38e763f7104a318?s=128&d=identicon&r=PG&f=1", "display_name": "masoud", "link": "https://stackoverflow.com/users/952747/masoud"}, "is_accepted": false, "score": 4, "last_activity_date": 1565183795, "creation_date": 1565183795, "answer_id": 57395405, "question_id": 57395298, "link": "https://stackoverflow.com/questions/57395298/is-it-possible-to-validate-an-expression-using-preprocessor-directives-like-i/57395405#57395405", "title": "Is it possible to validate an expression using preprocessor directives ? like #if (a == b)", "body": "<p>You can't. That's a run-time evaluation. So the logic is:</p>\n\n<pre><code>if (function_pointer != NULL)\n{\n   // Code block to be executed\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 1, "last_activity_date": 1565185491, "creation_date": 1565185491, "answer_id": 57395915, "question_id": 57395298, "link": "https://stackoverflow.com/questions/57395298/is-it-possible-to-validate-an-expression-using-preprocessor-directives-like-i/57395915#57395915", "title": "Is it possible to validate an expression using preprocessor directives ? like #if (a == b)", "body": "<p>You'll have to do it like this:</p>\n\n<pre><code>#define mapped // compiler switch, comment-out if function_pointer shouldn't be used\n\n#ifdef mapped\n  type function_pointer = something;\n#else\n  type function_pointer = NULL;\n#endif\n\n...\n\n#ifdef mapped\n  /* code to compile here */\n#endif\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 1, "last_activity_date": 1565186395, "creation_date": 1565186395, "answer_id": 57396192, "question_id": 57395298, "link": "https://stackoverflow.com/questions/57395298/is-it-possible-to-validate-an-expression-using-preprocessor-directives-like-i/57396192#57396192", "title": "Is it possible to validate an expression using preprocessor directives ? like #if (a == b)", "body": "<p>There are several steps in the compilation and running process. The full list is a bit daunting, but simplified it looks like this</p>\n\n<ol>\n<li>Preprocessing</li>\n<li>Compilation</li>\n<li>Linking</li>\n<li>Running</li>\n</ol>\n\n<p>They are executed sequentially. Since there is no time travel, a latter step cannot influence a preceding one.</p>\n\n<p>So preprocessing cannot use your function pointer value because function pointer values do not exist until the program is ran. A preprocessor can only make decisions based on values availabe at preprocessing time. All such values are integers. They all must be literals, expressions made up of literals, or something <code>#define</code>d in terms of those.</p>\n"}, {"comments": [{"owner": {"reputation": 8002, "user_id": 1143850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2927fac544c9960cd5433688fe4cae1d?s=128&d=identicon&r=PG", "display_name": "Serge", "link": "https://stackoverflow.com/users/1143850/serge"}, "edited": false, "score": 0, "creation_date": 1565231389, "post_id": 57396692, "comment_id": 101290249, "body": "this is wrong. it only works because undefined macro <code>a</code> is interpreted as <code>0</code> by the standard."}], "tags": [], "owner": {"reputation": 666, "user_id": 5313875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acee7297297a9395f80fa227107008a2?s=128&d=identicon&r=PG&f=1", "display_name": "cooljake", "link": "https://stackoverflow.com/users/5313875/cooljake"}, "is_accepted": false, "score": -1, "last_activity_date": 1565233264, "last_edit_date": 1565233264, "creation_date": 1565187993, "answer_id": 57396692, "question_id": 57395298, "link": "https://stackoverflow.com/questions/57395298/is-it-possible-to-validate-an-expression-using-preprocessor-directives-like-i/57396692#57396692", "title": "Is it possible to validate an expression using preprocessor directives ? like #if (a == b)", "body": "<p>This depends on the nature of the function pointer that you're checking. If the function pointer ever changes while the program is running, checking its value at compile time cannot be done.</p>\n\n<p>However, if your function pointer is defined at compile-time and never changes, you can declare it as a <code>const</code> variable. Constant expressions can be used in preprocessor conditions, so code like this is legal:</p>\n\n<pre><code>const int *a = NULL;               \n\nint main(int argc, char *argv[]) { \n#if a == 0                         \n  printf(\"null\\n\");                \n#else                              \n  printf(\"not null\\n\");            \n#endif                             \n  return 0;                        \n}       \n</code></pre>\n\n<p>The assembly code generated from this would be equivalent to that generated from:</p>\n\n<pre><code>const int *a = NULL;               \n\nint main(int argc, char *argv[]) {                \n  printf(\"null\\n\");                 \n  return 0;                        \n}                            \n</code></pre>\n\n<p>EDIT: @serge is right: this only works coincidentally. You may still be able to make some gains by making your function pointer const if your compiler can optimize away the unreachable branch of the conditional, but it won't be the same as removing the code with a preprocessor condition.</p>\n"}], "owner": {"reputation": 41, "user_id": 7184866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3818806a04d1b3fb21518c5199339911?s=128&d=identicon&r=PG&f=1", "display_name": "Taala", "link": "https://stackoverflow.com/users/7184866/taala"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 5, "score": 0, "last_activity_date": 1565233264, "creation_date": 1565183468, "last_edit_date": 1565183866, "question_id": 57395298, "link": "https://stackoverflow.com/questions/57395298/is-it-possible-to-validate-an-expression-using-preprocessor-directives-like-i", "title": "Is it possible to validate an expression using preprocessor directives ? like #if (a == b)", "body": "<p>To be precise I need to check a function pointer against null pointer. I need a part of a code to be compiled only if the function pointer is mapped to a valid function and not to a null pointer. Is it possible in c ?</p>\n\n<p>something similar to :</p>\n\n<pre><code>#if (function_pointer != NULLpointer)\n{\n// Code block to be compiled\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 2, "creation_date": 1565180487, "post_id": 57394359, "comment_id": 101270258, "body": "The documentation has quite a lot of explanation: <a href=\"https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/windows/win32/api/memoryapi/&hellip;</a> Do you have specific questions that are not addressed there ?"}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 1, "creation_date": 1565180490, "post_id": 57394359, "comment_id": 101270260, "body": "@Grewal Grewal Read the function description."}, {"owner": {"reputation": 21, "user_id": 11846020, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UGeLBKuEgpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re8i32QUlN_V3Q9jL0EespzWHF30g/photo.jpg?sz=128", "display_name": "Grewal Grewal", "link": "https://stackoverflow.com/users/11846020/grewal-grewal"}, "edited": false, "score": 0, "creation_date": 1565180760, "post_id": 57394359, "comment_id": 101270401, "body": "i am not from c or c++ background that&#39;s why i can&#39;t understand there language/way of explanation.i am learning python with ctypes."}, {"owner": {"reputation": 21, "user_id": 11846020, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UGeLBKuEgpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re8i32QUlN_V3Q9jL0EespzWHF30g/photo.jpg?sz=128", "display_name": "Grewal Grewal", "link": "https://stackoverflow.com/users/11846020/grewal-grewal"}, "edited": false, "score": 0, "creation_date": 1565181434, "post_id": 57394359, "comment_id": 101270788, "body": "<a href=\"https://stackoverflow.com/questions/26029374/virtualalloc-mem-commit-and-mem-reserve\" title=\"virtualalloc mem commit and mem reserve\">stackoverflow.com/questions/26029374/&hellip;</a>"}], "owner": {"reputation": 21, "user_id": 11846020, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UGeLBKuEgpQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re8i32QUlN_V3Q9jL0EespzWHF30g/photo.jpg?sz=128", "display_name": "Grewal Grewal", "link": "https://stackoverflow.com/users/11846020/grewal-grewal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 24, "favorite_count": 0, "closed_date": 1565182047, "answer_count": 0, "score": 0, "last_activity_date": 1565180346, "creation_date": 1565180346, "question_id": 57394359, "link": "https://stackoverflow.com/questions/57394359/what-is-the-meaning-of-these-parameters-in-winapi", "closed_reason": "Duplicate", "title": "what is the meaning of these parameters in winapi", "body": "<p>what is the meaning of MEM_COMMIT and MEM_RESERVE parameteres in the context of VirtualAlloc function.i want to understand the meaning of these parameters in simple words like what is the roll of these parameters here or what are they telling to do to VirtualAlloc function.</p>\n\n<p><code>ViruallAlloc(0,50,MEM_COMMIT | MEM_RESERVE,0x40</code>)</p>\n"}, {"tags": ["python", "c", "cython", "cythonize"], "comments": [{"owner": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1565274690, "post_id": 57394254, "comment_id": 101309961, "body": "You can check it via <code>nm my_extension.so | grep rand</code>, if <code>rand@@GLIB_XXX</code> has attribute <code>U</code> (most probably), then it will be provided by <code>libc.so</code> and the state is shared between all modules."}], "answers": [{"comments": [{"owner": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1565274922, "post_id": 57401703, "comment_id": 101310100, "body": "I think it is not for the standard to decide, whether <code>rand</code> is in a shared library or not: when the extension is linked it can be linked agains a shared version of libc or agains a static version (which is quite unusual but possible)."}, {"owner": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1565274992, "post_id": 57401703, "comment_id": 101310154, "body": "It is a very solid advice, as later on, one could easily replace the <code>rand&#47;srand</code> pair through c++11&#39;s random generator or roll out a handmade one."}], "tags": [], "owner": {"reputation": 23048, "user_id": 4657412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4915a27d01efa79d81d322511ee517a9?s=128&d=identicon&r=PG&f=1", "display_name": "DavidW", "link": "https://stackoverflow.com/users/4657412/davidw"}, "is_accepted": true, "score": 2, "last_activity_date": 1565208797, "creation_date": 1565208797, "answer_id": 57401703, "question_id": 57394254, "link": "https://stackoverflow.com/questions/57394254/how-do-i-make-independently-compiled-cython-packages-use-a-shared-random-number/57401703#57401703", "title": "How do I make independently compiled cython packages use a shared random number generator?", "body": "<p>I'm not sure it's well-defined in the C specification whether the random seed is shared between .so files or individual (that said - I haven't read the C standard, so I'm guessing slightly here). Therefore what behaviour you see <em>may</em> depend on the platform you're on.</p>\n\n<p>The simplest thing here would be to write a small Cython module that's sole purpose is to handle random number generation:</p>\n\n<pre><code># cy_rand.pxd\ncpdef void srand(unsigned int)\ncpdef int rand()\n\n# cy_rand.pyx\nfrom libc cimport stdlib\n\ncpdef void srand(unsigned int seed):\n    stdlib.srand(seed)\n\ncpdef int rand():\n    return stdlib.rand()\n</code></pre>\n\n<p>I've made the functions <code>cpdef</code> so that you can call them from Python too. If you don't care about being able to do this then just make them <code>cdef</code>.</p>\n\n<p>You need to compile this module in the normal way. In your other modules you can just do:</p>\n\n<pre><code>cimport cy_rand\n\ncy_rand.srand(1) # some seed\nrand_val = cy_rand.rand()\n</code></pre>\n\n<p>This way you know that random numbers are only being generated in one .so file. This adds a small layer of indirection so will be slightly slower than just calling it directly. Therefore it might be a good idea to add helper functions to generate random numbers in bulk (for speed).</p>\n\n<p>Be aware that other libraries could call <code>srand</code> or <code>rand</code> themselves, and because it's possibly global state this could affect you - this is one of the reasons why the C standard library random number generator isn't hugely robust...</p>\n"}], "owner": {"reputation": 83, "user_id": 4300390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4876754b0f63825d8d9142d1a6d0a53?s=128&d=identicon&r=PG&f=1", "display_name": "Tim Atkinson", "link": "https://stackoverflow.com/users/4300390/tim-atkinson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 1, "accepted_answer_id": 57401703, "answer_count": 1, "score": 1, "last_activity_date": 1565208797, "creation_date": 1565179994, "question_id": 57394254, "link": "https://stackoverflow.com/questions/57394254/how-do-i-make-independently-compiled-cython-packages-use-a-shared-random-number", "title": "How do I make independently compiled cython packages use a shared random number generator?", "body": "<p>I have an experimental programming language where programs are compiled to c. I've written a cython wrapper that wraps around the compiled c code and allows it to be callable from python. This lets you use compiled programs as fast low-level functions from within python. It's often the case that we want to use multiple such programs within the same python program. Then the pipeline for generating and importing each program is:</p>\n\n<ol>\n<li>Compile the program to c using the compiler.</li>\n<li>Compile the c code to a .so shared object using gcc.</li>\n<li>Generate a .pyx wrapper which can access the c functions we want to use from python.</li>\n<li>Compile the .pyx wrapper with cythonize to generate a .so.</li>\n<li>Import the .so shared object using python's import feature.</li>\n</ol>\n\n<p>In practice, steps 1-4 are actually merged into a single external call to make using sys, with a generated Makefile performing each of the 4 steps. This lets us call make via an external call with sys and then import the compiled program without ever leaving python.</p>\n\n<p>A compiled program may have probabilistic constructs. In particular, branching decisions are governed by random numbers. To do this, calls are made to c's native </p>\n\n<pre><code>rand()\n</code></pre>\n\n<p>function. When a wrapper compiled program is imported in python, an import call is made to the generated .so shared object which is produced using cythonize. So far I've tried calling</p>\n\n<pre><code>srand(&lt;long int&gt;time(NULL)\n</code></pre>\n\n<p>from within the .pyx file that wraps each compiled program. As far as I can tell, each imported .so will effectively be using its own random number generator. But it's not at all clear to me from the docs whether this is the case.</p>\n\n<p>Ultimately I want the different .so's to be using the same random number generator, but I have no idea how to go about this. Any guidance would be greatly appreciated. Much of the code is too long to include here, but if you'd like to see any snippets (e.g. 'how do you do x component?') I will happily oblige.</p>\n\n<p>Even if all you can offer is an explanation of how calls to rand() will interact between different shared objects generated with cythonize, that might give me enough to work out a solution.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1565179036, "post_id": 57393931, "comment_id": 101269458, "body": "It just calculates the address of the 20th int following the base and attempts to print that..whether it is a valid array alement or not. (Or it causes other undefined behavior, such as aborting your program)."}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1565179091, "post_id": 57393931, "comment_id": 101269486, "body": "What would you expect? It does nothing other than calculating the address. It is up to you not to pass the end of the array."}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 1, "creation_date": 1565179121, "post_id": 57393931, "comment_id": 101269508, "body": "No, you are completely right. Neither C nor C++ checks whether you access array elements beyond of size. It&#39;s just <a href=\"https://stackoverflow.com/a/4105123/1505939\">UB</a>. If you are lucky your application crashs. Otherwise, you might get to your wrong conclusion... ;-)"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1565190112, "post_id": 57393931, "comment_id": 101276300, "body": "You were not &quot;completely wrong&quot;, not at all.  You might have been a <i>little</i> bit wrong, if your expectation was that you&#39;d get a clear error message when you went beyond the bounds of the array.  Think of it like this: &quot;I thought you couldn&#39;t go through the intersection when the light was red.  But every night for the past week I&#39;ve been doing it (at 2am), and nothing bad has happened.  I guess I was completely wrong.&quot;"}, {"owner": {"reputation": 18939, "user_id": 2756409, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UIrGI.jpg?s=128&g=1", "display_name": "TylerH", "link": "https://stackoverflow.com/users/2756409/tylerh"}, "edited": false, "score": 1, "creation_date": 1574799111, "post_id": 57393931, "comment_id": 104356731, "body": "Please do not vandalize your posts by wiping the contents. Once posted, your content was immediately licensed for use under CC by-SA 4.0 (w/ attribution required)."}], "answers": [{"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 3, "last_activity_date": 1565179122, "creation_date": 1565179122, "answer_id": 57393986, "question_id": 57393931, "link": "https://stackoverflow.com/questions/57393931/how-does-arrays-bypass-its-declared-length/57393986#57393986", "title": "How does arrays bypass its declared length", "body": "<p>C and C++ don't have explicit bounds checking on array sizes.  When you read/write past the end of an array, you invoke <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behavior</a>.</p>\n\n<p>With undefined behavior, your program may crash, it may output strange results, or (as in your case) it could appear to work properly.  Also, making a seemingly unrelated change such as adding an unused local variable or adding a <code>printf</code> for debugging can change how UB manifests itself.</p>\n\n<p>Just because a program may crash doesn't mean it will.</p>\n"}], "owner": {"reputation": 75, "user_id": 11832637, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0719175f6fc0b9fea5562c111e48b05a?s=128&d=identicon&r=PG&f=1", "display_name": "emirhan422", "link": "https://stackoverflow.com/users/11832637/emirhan422"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "closed_date": 1565179186, "accepted_answer_id": 57393986, "answer_count": 1, "score": -3, "last_activity_date": 1574798985, "creation_date": 1565178948, "last_edit_date": 1574798985, "question_id": 57393931, "link": "https://stackoverflow.com/questions/57393931/how-does-arrays-bypass-its-declared-length", "closed_reason": "Duplicate", "title": "How does arrays bypass its declared length", "body": "<p>I was making practises on the logic of arrays in c and my thought on the array length declaration was unformattable if you declare an array length to be 10 integers, that array could not keep 20 integers in memory but when I tested it I saw that I was completely wrong</p>\n\n<pre><code>int main(){\n    int i;\n    int arr[10];\n    for (i = 0;i&lt;20;i++){\n        arr[i] = i;\n    }\n    for (i = 0;i&lt;20;i++){\n        printf(\"%d \\n\",arr[i]);\n    }\n\n\n}\n</code></pre>\n\n<p>I was expecting to see 10 printed numbers but it prints out 20 could someone explain how is it possible?</p>\n"}, {"tags": ["c", "pointers", "visual-studio-code", "void-pointers", "vscode-debugger"], "comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1565181329, "post_id": 57393837, "comment_id": 101270729, "body": "Posting text as text rather than a picture is more useful in creating answers and searching.  Consider editing in as text."}, {"owner": {"reputation": 667, "user_id": 6730526, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1131892593548201/picture?type=large", "display_name": "Yurkee", "link": "https://stackoverflow.com/users/6730526/yurkee"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1565184772, "post_id": 57393837, "comment_id": 101273015, "body": "I have written whole example in text, above. the picture is there to show how it looks like in the Debugger - as I cannot see a name of variable, just the ending (a-&gt;b-&gt;c-&gt; value)"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565185144, "post_id": 57393837, "comment_id": 101273264, "body": "Perhaps the problem is the <b>code</b> not the IDE."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 1, "creation_date": 1565192391, "post_id": 57393837, "comment_id": 101277555, "body": "Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> so we can reproduce the problem and help you debug it..  Also,, please clarify what the code is trying to accomplish"}, {"owner": {"reputation": 667, "user_id": 6730526, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1131892593548201/picture?type=large", "display_name": "Yurkee", "link": "https://stackoverflow.com/users/6730526/yurkee"}, "edited": false, "score": 0, "creation_date": 1565270886, "post_id": 57393837, "comment_id": 101307576, "body": "I&#39;m not asking for help in debugging or writing code. Code is what it is and for a project of this size rewriting core structure of data representation would be highly time-consuming. I wrote my intentions clearly - I want to give a <i>name</i> to variables that are added to the watch list (because now they all look the same) and also automatically cast such variables to char* in order for the debugger to show me contents."}], "answers": [{"comments": [{"owner": {"reputation": 667, "user_id": 6730526, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1131892593548201/picture?type=large", "display_name": "Yurkee", "link": "https://stackoverflow.com/users/6730526/yurkee"}, "edited": false, "score": 0, "creation_date": 1597998229, "post_id": 63493565, "comment_id": 112320499, "body": "But won&#39;t the addresses change after some period of time (or after re-set of the computer)?"}, {"owner": {"reputation": 648, "user_id": 1101802, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b6e0fd8d52addb5282773f71da60ac47?s=128&d=identicon&r=PG", "display_name": "gr0k", "link": "https://stackoverflow.com/users/1101802/gr0k"}, "reply_to_user": {"reputation": 667, "user_id": 6730526, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1131892593548201/picture?type=large", "display_name": "Yurkee", "link": "https://stackoverflow.com/users/6730526/yurkee"}, "edited": false, "score": 0, "creation_date": 1598028070, "post_id": 63493565, "comment_id": 112334381, "body": "Yea, it looks like you&#39;d have to reset each run? Could probs look into setting up your gdbinit so it initializes each time its run, not sure if that gets executed through VS Code or not.   <a href=\"https://sourceware.org/gdb/current/onlinedocs/gdb/gdbinit-man.html\" rel=\"nofollow noreferrer\">sourceware.org/gdb/current/onlinedocs/gdb/gdbinit-man.html</a>"}], "tags": [], "owner": {"reputation": 648, "user_id": 1101802, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b6e0fd8d52addb5282773f71da60ac47?s=128&d=identicon&r=PG", "display_name": "gr0k", "link": "https://stackoverflow.com/users/1101802/gr0k"}, "is_accepted": false, "score": 0, "last_activity_date": 1597864466, "creation_date": 1597864466, "answer_id": 63493565, "question_id": 57393837, "link": "https://stackoverflow.com/questions/57393837/visual-studio-code-debugging-name-a-variable-and-cast-it/63493565#63493565", "title": "Visual Studio Code debugging: name a variable and cast it", "body": "<p>Stumbled on this while searching how to look at the values in memory in the watchlist. It looks like you can set the variable name in the gdb window, and use that name in the watchlist.</p>\n<p>Debug Console:</p>\n<pre><code>-exec set $var_name = (const char *) (((((type *)0x844430)-&gt;a).b).c).value\n</code></pre>\n<p>Then in the watchlist you can just reference the convenience variable as <code>$var_name</code></p>\n<p><a href=\"https://i.stack.imgur.com/9C0id.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/9C0id.png\" alt=\"VS Code Debugger\" /></a></p>\n"}], "owner": {"reputation": 667, "user_id": 6730526, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1131892593548201/picture?type=large", "display_name": "Yurkee", "link": "https://stackoverflow.com/users/6730526/yurkee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 568, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1597864466, "creation_date": 1565178680, "last_edit_date": 1565271020, "question_id": 57393837, "link": "https://stackoverflow.com/questions/57393837/visual-studio-code-debugging-name-a-variable-and-cast-it", "title": "Visual Studio Code debugging: name a variable and cast it", "body": "<ol>\n<li>How to give a custom name to a variable listed on watch list in debug mode of VisualStudio Code?</li>\n<li>Is there a way to automatically cast variables to char* from pointer so that - if they contain text it will be visible for the user?</li>\n</ol>\n\n<p>I use VSCode to debug large C program. \nWhen debugging, there are large structures like:</p>\n\n<p><code>type variable;</code>\nwhere variable is a head of one directional list:</p>\n\n<pre><code>feature_type *variable-&gt;feature\nchar* variable-&gt;features-&gt;head-&gt;name // name of the 1st feature\nfeature_type *variable-&gt;features-&gt;head-&gt;next // 2nd feature, that has its own \"name\"\nvoid* variable-&gt;features-&gt;head-&gt;a-&gt;b-&gt;c-&gt;value // value of a 1st feature.\n</code></pre>\n\n<p>The problem is, that variable value is very often (95%?) char*, and I'd like to see it as such, but now - for each element of the list I have to manually select it, and cast to (const char *). Its annoying as it feels that printing those variables - thou less professional - would be a lot faster.</p>\n\n<p><a href=\"https://i.stack.imgur.com/VLkQ7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/VLkQ7.png\" alt=\"fragment of the code in VSCode\"></a></p>\n\n<pre><code>(const char *) (((((type *)0x844430)-&gt;a).b).c).value // rewritten what was important on the picture that you might want to copy.\n</code></pre>\n\n<p>The second problem is that variables casted in such way all have same name, but differ only in the memory address (which means I have to remember which is which). Is there a way to give them a name?</p>\n"}, {"tags": ["c", "loops", "while-loop", "c-strings", "getchar"], "comments": [{"owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "edited": false, "score": 3, "creation_date": 1565177149, "post_id": 57393309, "comment_id": 101268395, "body": "you need to complete the string with NULL character. Add <code>str[i] = &#39;\\0&#39;</code> after the while statement."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 3, "creation_date": 1565177154, "post_id": 57393309, "comment_id": 101268398, "body": "Because you never added a null terminator after the last character. Also, <code>char str[25];</code> only has room for 24 characters plus the <code>&#39;\\0</code>&#39; null terminator character, so you may want to increase its size to 26 or change <code>i &lt; 25</code> to <code>i &lt; 24</code>."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565177211, "post_id": 57393309, "comment_id": 101268429, "body": "Remember that <code>char</code> strings in C are really called <b><i>null-terminated</b> byte strings</i>."}, {"owner": {"reputation": 33, "user_id": 11895225, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KPM7kvGctxQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reb8cP9mcFg956tzwTHNHeCRvClXQ/photo.jpg?sz=128", "display_name": "Siddharth Awana", "link": "https://stackoverflow.com/users/11895225/siddharth-awana"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1565177715, "post_id": 57393309, "comment_id": 101268730, "body": "@IanAbbott Thank you! It worked. But I can&#39;t seem to mark this comment as the answer."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1565178374, "post_id": 57393309, "comment_id": 101269119, "body": "Note: good first posting, even if a common question."}], "answers": [{"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": true, "score": 3, "last_activity_date": 1565177818, "creation_date": 1565177818, "answer_id": 57393549, "question_id": 57393309, "link": "https://stackoverflow.com/questions/57393309/random-characters-printed-after-printing-result/57393549#57393549", "title": "Random characters printed after printing &#39;result&#39;", "body": "<p>For starters the operands of the condition </p>\n\n<pre><code>(str[i++]=getchar()) != '\\n' &amp;&amp; i &lt; 25\n</code></pre>\n\n<p>should be swapped.</p>\n\n<pre><code>i &lt; 25 &amp;&amp; (str[i++]=getchar()) != '\\n'\n</code></pre>\n\n<p>The input stored in the character array str should be zero-terminated. Otherwise the array will not contain a string.</p>\n\n<p>Here is a demonstrative program that shows how your code can be rewritten</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nchar *replacechar( char str[] )\n{\n    return str;\n}\n\nint main(void) \n{\n    enum { N = 25 };\n    char str[N];\n    char *result;\n\n    size_t i = 0;\n\n    while( i &lt; N - 1 &amp;&amp; ( str[i] = getchar() ) != '\\n' ) i++;\n\n    str[i] = '\\0';\n\n    result = replacechar( str );\n\n    puts( result ); \n\n    return 0;\n}\n</code></pre>\n\n<p>Its output might look like</p>\n\n<pre><code>Hello Siddharth Awana\nHello Siddharth Awana\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 11895225, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KPM7kvGctxQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reb8cP9mcFg956tzwTHNHeCRvClXQ/photo.jpg?sz=128", "display_name": "Siddharth Awana", "link": "https://stackoverflow.com/users/11895225/siddharth-awana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 57393549, "answer_count": 1, "score": 3, "last_activity_date": 1565177937, "creation_date": 1565177037, "last_edit_date": 1565177937, "question_id": 57393309, "link": "https://stackoverflow.com/questions/57393309/random-characters-printed-after-printing-result", "title": "Random characters printed after printing &#39;result&#39;", "body": "<p>I'm getting random characters after the actual output in <code>printf(\"%s\",result);</code>. \nWhy are these characters being printed? And how can I remove them?</p>\n\n<pre><code>#include&lt;stdio.h&gt;\nchar *replacechar(char[]);\n\nint main()\n{\n    char str[25];\n    char *result;\n    int i=0;\n    while( (str[i++]=getchar()) != '\\n' &amp;&amp; i &lt; 25);\n    result= replacechar(str);\n    printf(\"%s\",result);\n    return 0;\n}\n\nchar *replacechar(char str[])\n{\n    return str;\n}\n</code></pre>\n\n<h2>Expected Output:</h2>\n\n<pre><code>aaayt\naaayt\n</code></pre>\n\n<h2>Actual Output:</h2>\n\n<pre><code>aaayt\naaayt\n\u2191@\n</code></pre>\n"}, {"tags": ["c++", "c", "gcc", "compiler-optimization", "bit-fields"], "comments": [{"owner": {"reputation": 3355, "user_id": 4114447, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa93321ad023953eaaae28b490855e7a?s=128&d=identicon&r=PG&f=1", "display_name": "Dan M.", "link": "https://stackoverflow.com/users/4114447/dan-m"}, "edited": false, "score": 0, "creation_date": 1565175780, "post_id": 57392896, "comment_id": 101267608, "body": "Nothing prevents the <code>value</code> from changing even without reordering."}, {"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 0, "creation_date": 1565175855, "post_id": 57392896, "comment_id": 101267657, "body": "The short answer is: no there isn&#39;t."}, {"owner": {"reputation": 3355, "user_id": 4114447, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa93321ad023953eaaae28b490855e7a?s=128&d=identicon&r=PG&f=1", "display_name": "Dan M.", "link": "https://stackoverflow.com/users/4114447/dan-m"}, "edited": false, "score": 0, "creation_date": 1565175865, "post_id": 57392896, "comment_id": 101267665, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/1490092/c-c-force-bit-field-order-and-alignment\">C/C++: Force Bit Field Order and Alignment</a>"}, {"owner": {"reputation": 70, "user_id": 9209569, "user_type": "registered", "profile_image": "https://graph.facebook.com/1716064065122497/picture?type=large", "display_name": "Cactus&#39;as", "link": "https://stackoverflow.com/users/9209569/cactusas"}, "edited": false, "score": 1, "creation_date": 1565176008, "post_id": 57392896, "comment_id": 101267721, "body": "Yeah, it is not possible. But if you always use 32bit platforms with the same endianess, bit order should not change. I found a good article about bitfields <a href=\"http://jkz.wtf/bit-field-packing-in-gcc-and-clang\" rel=\"nofollow noreferrer\">jkz.wtf/bit-field-packing-in-gcc-and-clang</a>"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 5, "creation_date": 1565176013, "post_id": 57392896, "comment_id": 101267727, "body": "If you need to force the exact order and arrangement of bits, bitfields are not the right tool for the job.  You can spend time tinkering, and you can try using various compiler extensions, but in the end you&#39;ll still be unsure and without guarantees, and it will be (in my opinion) way more trouble than it&#39;s worth. Instead, if you need to force the exact order and arrangement of bits, just bite the bullet and use <code>unsigned int</code> along with some explicit masking and shifting techniques.  Bitfields are enticing, but then, so is <a href=\"https://en.wikipedia.org/wiki/Fool&#39;s_gold\" rel=\"nofollow noreferrer\">pyrite</a>."}, {"owner": {"reputation": 1817, "user_id": 4030665, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Dan", "link": "https://stackoverflow.com/users/4030665/dan"}, "reply_to_user": {"reputation": 3355, "user_id": 4114447, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa93321ad023953eaaae28b490855e7a?s=128&d=identicon&r=PG&f=1", "display_name": "Dan M.", "link": "https://stackoverflow.com/users/4114447/dan-m"}, "edited": false, "score": 0, "creation_date": 1565176178, "post_id": 57392896, "comment_id": 101267830, "body": "@DanM. That question doesn&#39;t speak about <code>union</code>, that is the specific case I&#39;m concerned about. Maybe that can be inferred from that question, but I would like a clear and direct answer for this particular case so I&#39;m sure that I&#39;m not deducing the wrong stuff."}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 0, "creation_date": 1565176470, "post_id": 57392896, "comment_id": 101268000, "body": "Be aware that C and C++ differ in allowing type punning via unions: C does allow it, in C++ it is undefined behaviour!"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565178334, "post_id": 57392896, "comment_id": 101269103, "body": "Just don&#39;t use bitfields and all the head ache will go away. They are superfluous and dangerous, with no benefits."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "reply_to_user": {"reputation": 3355, "user_id": 4114447, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa93321ad023953eaaae28b490855e7a?s=128&d=identicon&r=PG&f=1", "display_name": "Dan M.", "link": "https://stackoverflow.com/users/4114447/dan-m"}, "edited": false, "score": 1, "creation_date": 1565178417, "post_id": 57392896, "comment_id": 101269140, "body": "@Dan The containing <code>union</code> does not have any effect on the order of the bitfields in the contained <code>struct</code>. The direction in which bitfields are allocated within their underlying storage units (<code>uint32_t</code> in your case) is implementation defined."}, {"owner": {"reputation": 6533, "user_id": 1918193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b70a14318e0f417ecac47809f38fafc?s=128&d=identicon&r=PG", "display_name": "Marc Glisse", "link": "https://stackoverflow.com/users/1918193/marc-glisse"}, "edited": false, "score": 0, "creation_date": 1565280606, "post_id": 57392896, "comment_id": 101313328, "body": "Do you actually know a compiler that &quot;reorders&quot; the bitfields, even without pack/volatile/whatever?"}], "answers": [{"comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565176454, "post_id": 57393071, "comment_id": 101267990, "body": "<code>can&#39;t declare a union as volatile</code> - what do you mean by that? A variable that has the type union can be volatile. A typedef can be an union and volatile. I think you will be surprised that you can include <code>volatile</code> and ex. <code>const</code> in a typedef, like <code>typedef union { int a; } volatile MyUnion;</code>."}, {"owner": {"reputation": 1817, "user_id": 4030665, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Dan", "link": "https://stackoverflow.com/users/4030665/dan"}, "edited": false, "score": 0, "creation_date": 1565177507, "post_id": 57393071, "comment_id": 101268607, "body": "Yes, you are right, a type declaration (in this case <code>union</code>) cannot be volatile of course. But I meant variables of type <code>MyUnion</code> (I wrote it wrong), not the <code>union</code> itself. Now it&#39;s fixed."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565177951, "post_id": 57393071, "comment_id": 101268881, "body": "Unions can be declared volatile. <code>typedef union foo { int x; float y; } Foo; typedef volatile Foo VolatileFoo;</code> is valid C code that defines <code>VolatileFoo</code> to be a type that is a volatile union. Furthermore, after these statements, <code>Foo Convert(VolatileFoo *x) { return x; }</code> yields a compiler message that types are incompatible, showing the compiler knows that <code>x</code> points to a volatile union, not just a union, thus demonstrating that <code>volatile</code> is a part of the type <code>VolatileFoo</code>."}], "tags": [], "owner": {"reputation": 1726, "user_id": 1414496, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/c75b36035fb412c9f2629a888bfb977e?s=128&d=identicon&r=PG", "display_name": "Joel Bodenmann", "link": "https://stackoverflow.com/users/1414496/joel-bodenmann"}, "is_accepted": true, "score": 4, "last_activity_date": 1565176258, "creation_date": 1565176258, "answer_id": 57393071, "question_id": 57392896, "link": "https://stackoverflow.com/questions/57392896/prevent-gcc-from-reordering-bitfields-in-unions-of-structs/57393071#57393071", "title": "Prevent GCC from reordering bitfields in unions of structs", "body": "<p>I think the overall \"No\" answer has already been given in the comments. With this answer I'd like to address your question about <code>volatile</code>:</p>\n\n<blockquote>\n  <p>Would declaring <code>MyUnion</code> as <code>volatile</code> achieve this?</p>\n</blockquote>\n\n<p>The <code>volatile</code> keyword will not change anything in behavior that you're looking for here. Also, you can't declare a union as <code>volatile</code>. It's a keyword that's a qualifier for a variable declaration. It tells the compiler that the variable value can change at any time and that therefore the value should always be re-loaded (as in re-read from memory) instead of assuming the value based on previous statements that the compiler saw.\nThis is used for when a variable value can change by external factors such as when declaring variables that are linked to real, physical values such as registers in a microcontroller.</p>\n"}], "owner": {"reputation": 1817, "user_id": 4030665, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Dan", "link": "https://stackoverflow.com/users/4030665/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 57393071, "answer_count": 1, "score": 2, "last_activity_date": 1565177413, "creation_date": 1565175660, "last_edit_date": 1565177413, "question_id": 57392896, "link": "https://stackoverflow.com/questions/57392896/prevent-gcc-from-reordering-bitfields-in-unions-of-structs", "title": "Prevent GCC from reordering bitfields in unions of structs", "body": "<p>Having a piece of code like the following:</p>\n\n<pre><code>typedef union\n{\n    struct bits\n    {\n        uint32_t bit0 : 1;\n        uint32_t bit1 : 1;\n        uint32_t bit2 : 1;\n        ...\n        ...\n        uint32_t bit14 : 1;\n    }\n\n    uint32_t value;\n\n} MyUnion;\n</code></pre>\n\n<p>It's important to prevent the compiler from reordering the bitfields since, otherwise, the value of <code>value</code> will change depending on the platform and, possibly, even the size of the compiled binary.</p>\n\n<p><strong>Is there any way to tell the compiler \"do not re-order this fields\"?</strong></p>\n\n<p><strong>Would declaring variables of type <code>MyUnion</code> as <code>volatile</code> achieve this?</strong></p>\n\n<p>If the <code>union</code> is <code>packed</code> and <code>aligned(4)</code>, <strong>is it possible to assure that the bitfields won't be reordered, if you are 100% sure that you will be always working with 32 bits platforms, with the same endianness?</strong></p>\n\n<h2>EDIT</h2>\n\n<p>Can the above be done for only one specific compiler? That is, if being compatible across different compilers is not necessary.</p>\n"}, {"tags": ["c", "algorithm", "fgets", "c-strings", "memcmp"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 3, "creation_date": 1565175658, "post_id": 57392829, "comment_id": 101267520, "body": "Calling <code>fflush</code> with an input-only stream (like <code>stdin</code>) is explicitly mentioned in the C specification as <i>undefined behavior</i>. Some libraries add it as a <i>non-portable</i> extension. I suggest you instead read the whole line with e.g. <code>fgets</code> and then use <code>sscanf</code> to parse the string. And remember to check what <code>sscanf</code> <i>returns</i>. Oh and some nitpicking: <code>do ... while</code> is a <i>statement</i> not a function."}, {"owner": {"reputation": 26552, "user_id": 448932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QgLLl.png?s=128&g=1", "display_name": "500 - Internal Server Error", "link": "https://stackoverflow.com/users/448932/500-internal-server-error"}, "edited": false, "score": 1, "creation_date": 1565176037, "post_id": 57392829, "comment_id": 101267742, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/12784766/check-substring-exists-in-a-string-in-c\">Check substring exists in a string in C</a>"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 8796244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6316aeb548eaa187074b2a2732f7b7cf?s=128&d=identicon&r=PG&f=1", "display_name": "Abr", "link": "https://stackoverflow.com/users/8796244/abr"}, "edited": false, "score": 0, "creation_date": 1565176666, "post_id": 57393084, "comment_id": 101268109, "body": "using strcmp?  ex: while(strcmp(customerName, &quot;Mr &quot;)!= 0 || strcmp(customerName, &quot;Ms &quot;)!= 0 || strcmp(customerName, &quot;Mrs &quot;)!= 0);"}, {"owner": {"reputation": 788, "user_id": 9312233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1269dfa2b52b76d5462954279b393787?s=128&d=identicon&r=PG&f=1", "display_name": "code it up", "link": "https://stackoverflow.com/users/9312233/code-it-up"}, "reply_to_user": {"reputation": 15, "user_id": 8796244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6316aeb548eaa187074b2a2732f7b7cf?s=128&d=identicon&r=PG&f=1", "display_name": "Abr", "link": "https://stackoverflow.com/users/8796244/abr"}, "edited": false, "score": 0, "creation_date": 1565177703, "post_id": 57393084, "comment_id": 101268722, "body": "I would suggest rather <i>strstr</i> as you need to check for the presence of &#39;Mr.&#39; &#39;Mrs.&#39; etc at the very first position in the given input name"}], "tags": [], "owner": {"reputation": 788, "user_id": 9312233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1269dfa2b52b76d5462954279b393787?s=128&d=identicon&r=PG&f=1", "display_name": "code it up", "link": "https://stackoverflow.com/users/9312233/code-it-up"}, "is_accepted": false, "score": 0, "last_activity_date": 1565185176, "last_edit_date": 1565185176, "creation_date": 1565176308, "answer_id": 57393084, "question_id": 57392829, "link": "https://stackoverflow.com/questions/57392829/how-to-add-validation-mr-or-mrs-before-name/57393084#57393084", "title": "how to add validation mr or mrs before name", "body": "<p>You need to check if the substring <strong>'Mr.' 'Mrs.'</strong> or <strong>'Ms'</strong> exists in the input string provided by the user or not.\nIf it exists you can break out of the loop otherwise prompt him/her again.</p>\n\n<p>One thing to note that the substring position in this problem must be <strong>0</strong> (i.e at the <em>very beginning</em> of the input string) </p>\n\n<p>You can use <strong>strstr</strong> function as it not only checks for the substring but return a pointer to first occurrence of that also.</p>\n\n<p>e.g </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void) {\n\n    char customerName[50]; \n    char *titles[3] = {\"Mr.\",\"Mrs.\",\"Ms.\"}; \n    char *titlePos; \n    int istitle = 0;\n\n    do{\n\n       printf(\"Input Customer's Name [must have Mr. or Ms. or Mrs \\n\");\n       scanf(\"%[^\\n]%*c\",customerName);\n\n       for(int i=0;i&lt;3 &amp;&amp; !istitle;i++){\n       // checking if any of the title is present \n\n          titlePos=strstr(customerName,titles[i]);\n          if(titlePos &amp;&amp; (int)(titlePos-customerName)==0) {\n            istitle=1; // title found \n            printf(\"CustomerName Consist the Title of %s \\n\",titles[i]);\n\n        }\n    }\n}while(!istitle);\n\n  // ... Rest of Your Code\n\n    return 0;\n}\n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 1, "last_activity_date": 1565177223, "last_edit_date": 1565177223, "creation_date": 1565176812, "answer_id": 57393230, "question_id": 57392829, "link": "https://stackoverflow.com/questions/57392829/how-to-add-validation-mr-or-mrs-before-name/57393230#57393230", "title": "how to add validation mr or mrs before name", "body": "<p>Write a separate function that checks whether a name starts with the listed strings.</p>\n\n<p>For example</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint start_with( const char *s, const char * a[] )\n{\n    int success = 0;\n\n    s += strspn( s, \" \\t\" );\n\n    for ( ; *a != NULL &amp;&amp; !success; ++a )\n    {\n        success = memcmp( s, *a, strlen( *a ) ) == 0;\n    }\n\n    return success;;\n}\n\nint main(void) \n{\n    const char *title[] = { \"Mr.\", \"Ms.\", \"Mrs.\", NULL };\n    enum { N = 100 };\n    char name[N];\n\n    do\n    {\n        printf( \"Input Customer's Name [must have %s or %s or %s: \", title[0], title[1], title[2] );\n        name[0] = '\\0';\n        fgets( name, N, stdin );\n        name[strcspn( name, \"\\n\" )] = '\\0';\n    } while ( !start_with( name, title ) );\n\n    puts( name );\n\n    return 0;\n}\n</code></pre>\n\n<p>The program output might look like</p>\n\n<pre><code>Input Customer's Name [must have Mr. or Ms. or Mrs.: Bob\nInput Customer's Name [must have Mr. or Ms. or Mrs.: Mr. Bob\nMr. Bob\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13767, "user_id": 2413201, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rxfuw.jpg?s=128&g=1", "display_name": "Armali", "link": "https://stackoverflow.com/users/2413201/armali"}, "is_accepted": false, "score": -1, "last_activity_date": 1565178080, "creation_date": 1565178080, "answer_id": 57393637, "question_id": 57392829, "link": "https://stackoverflow.com/questions/57392829/how-to-add-validation-mr-or-mrs-before-name/57393637#57393637", "title": "how to add validation mr or mrs before name", "body": "<p>If you insist in only changing the <code>what should i fill here?</code> in your <em>coding example</em>, the most important thing to put in is <code>getchar()</code> to consume the leftover newline from the input, otherwise we'd get an endless loop. But normally, one would do this right in the <code>scanf()</code> with a format string <code>\"%[^\\n]\\n\"</code> or <code>\"%[^\\n] \"</code> (equivalent).</p>\n\n<p>Besides that, the expression</p>\n\n<pre><code>strncmp(\"Mr.\", customerName, 3) &amp;&amp;\nstrncmp(\"Ms.\", customerName, 3) &amp;&amp;\nstrncmp(\"Mrs\", customerName, 3)\n</code></pre>\n\n<p>would do.</p>\n"}], "owner": {"reputation": 15, "user_id": 8796244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6316aeb548eaa187074b2a2732f7b7cf?s=128&d=identicon&r=PG&f=1", "display_name": "Abr", "link": "https://stackoverflow.com/users/8796244/abr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 557, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1565185176, "creation_date": 1565175462, "last_edit_date": 1565177106, "question_id": 57392829, "link": "https://stackoverflow.com/questions/57392829/how-to-add-validation-mr-or-mrs-before-name", "title": "how to add validation mr or mrs before name", "body": "<p>I'm doing validation to input name using Mr or ms or Mrs before name with <strong>do while</strong> statement. what should I fill in the while section?.</p>\n\n<p>is it using strcmp or something else?</p>\n\n<p>coding example</p>\n\n<pre><code>do{\n    printf(\"Input Customer's Name [must have Mr. or Ms. or Mrs\");\n    scanf(\"%[^\\n]\", &amp;customerName);\n}while(what should i fill here?);\n</code></pre>\n"}, {"tags": ["c", "windows", "cmake", "clang", "llvm"], "answers": [{"tags": [], "owner": {"reputation": 75, "user_id": 4758971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ff947cf661dc8f9ad1ded9c0be4bb00?s=128&d=identicon&r=PG&f=1", "display_name": "lulle", "link": "https://stackoverflow.com/users/4758971/lulle"}, "is_accepted": false, "score": 2, "last_activity_date": 1566335729, "creation_date": 1566335729, "answer_id": 57581617, "question_id": 57392716, "link": "https://stackoverflow.com/questions/57392716/how-to-solve-libatomic-issue-in-windows/57581617#57581617", "title": "How to solve libatomic issue in windows?", "body": "<p>Use clang-cl (or MSVC cl), they dont require lib atomic.</p>\n"}, {"tags": [], "owner": {"reputation": 89, "user_id": 2751809, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/761a31a31cccd56b478324b79e630dbc?s=128&d=identicon&r=PG&f=1", "display_name": "Kuri", "link": "https://stackoverflow.com/users/2751809/kuri"}, "is_accepted": false, "score": 0, "last_activity_date": 1594940607, "creation_date": 1594940607, "answer_id": 62944743, "question_id": 57392716, "link": "https://stackoverflow.com/questions/57392716/how-to-solve-libatomic-issue-in-windows/62944743#62944743", "title": "How to solve libatomic issue in windows?", "body": "<p>As lulle mentioned, you need to use the right tools to compile. If you have installed Visual Studio, use the Developer Command prompt for Visual Studio instead of a regular cmd and you'll have the environment variables you need. It is located in your Visual Studio installation directory, under the Tools subdirectory.</p>\n<p>For example:</p>\n<p><em>C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Enterprise\\Common7\\Tools\\VsDevCmd.bat</em></p>\n"}, {"tags": [], "owner": {"reputation": 1036, "user_id": 209289, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/U4uT5.gif?s=128&g=1", "display_name": "facetus", "link": "https://stackoverflow.com/users/209289/facetus"}, "is_accepted": false, "score": 3, "last_activity_date": 1601366278, "last_edit_date": 1601366278, "creation_date": 1601349578, "answer_id": 64112384, "question_id": 57392716, "link": "https://stackoverflow.com/questions/57392716/how-to-solve-libatomic-issue-in-windows/64112384#64112384", "title": "How to solve libatomic issue in windows?", "body": "<p>I know why it fails. It's a bug in the LLVM's cmake files. In order to check if <code>atomic.lib</code> <em>is required</em> <code>CheckAtomic.cmake</code> tries compiling and linking a piece of code <em>with</em> <code>atomic.lib</code>. When it fails (because <code>atomic.lib</code> <em>is not required</em> and thus <em>is not present</em>) it falsely concludes that <code>atomic.lib</code> is needed. LLVM's cmake files is a hot mess with rarely fixed bugs. There are bugs staying there for years. I guess this is because nobody understands anymore how LLVM build system works.</p>\n<p>Long story short, I couldn't find why <code>CheckAtomic.cmake</code> inserts <code>atomic.lib</code> while checking that it is not required. As a workaround I just unconditionally set <code>HAVE_CXX_ATOMICS64_WITHOUT_LIB</code> and <code>HAVE_CXX_ATOMICS_WITHOUT_LIB</code> to <code>True</code> in <code>CheckAtomic.cmake</code>:</p>\n<pre><code>set(HAVE_CXX_ATOMICS64_WITHOUT_LIB True)\nset(HAVE_CXX_ATOMICS_WITHOUT_LIB True)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1910, "user_id": 2683842, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/LN9iq.png?s=128&g=1", "display_name": "nyanpasu64", "link": "https://stackoverflow.com/users/2683842/nyanpasu64"}, "is_accepted": false, "score": 2, "last_activity_date": 1603384976, "creation_date": 1603384976, "answer_id": 64486757, "question_id": 57392716, "link": "https://stackoverflow.com/questions/57392716/how-to-solve-libatomic-issue-in-windows/64486757#64486757", "title": "How to solve libatomic issue in windows?", "body": "<p>I'm trying to use Clang 11 (with MSVC ABI) to compile Clang 11. However, MSVC's headers won't compile in C++11 mode, which <code>CheckAtomic.cmake</code> uses:</p>\n<p><code>set(CMAKE_REQUIRED_FLAGS &quot;${CMAKE_REQUIRED_FLAGS} -std=c++11&quot;)</code></p>\n<p>results in:</p>\n<pre><code>C:\\Users\\nyanpasu\\code\\llvm-project&gt;clang  -Werror=unguarded-availability-new -std=c++11 uwu.cpp\nIn file included from uwu.cpp:1:\nIn file included from C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Tools\\MSVC\\14.27.29110\\include\\atomic:19:\nIn file included from C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Tools\\MSVC\\14.27.29110\\include\\xatomic.h:13:\nIn file included from C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Tools\\MSVC\\14.27.29110\\include\\type_traits:11:\nC:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Tools\\MSVC\\14.27.29110\\include\\xstddef:283:22: error: 'auto' return\n      without trailing return type; deduced return types are a C++14 extension\n_NODISCARD constexpr auto _Unfancy(_Ptrty _Ptr) noexcept { // converts from a fancy pointer to a plain pointer\n                     ^\n1 error generated.\n</code></pre>\n<p>I don't know if this is a MSVC bug where it ships an  header incompatible with C++11, or a Clang bug where it's using MSVC headers instead of its own.</p>\n<p>In any case, changing c++11 to c++14 fixes this error.</p>\n"}], "owner": {"reputation": 199, "user_id": 10938148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6e6c396abe4dfd500a3616338e3e4f8?s=128&d=identicon&r=PG&f=1", "display_name": "Jon marsh", "link": "https://stackoverflow.com/users/10938148/jon-marsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1058, "favorite_count": 0, "answer_count": 4, "score": 2, "last_activity_date": 1603384976, "creation_date": 1565175048, "last_edit_date": 1565176904, "question_id": 57392716, "link": "https://stackoverflow.com/questions/57392716/how-to-solve-libatomic-issue-in-windows", "title": "How to solve libatomic issue in windows?", "body": "<p>I am developing executables from source code of llvm. So I downloaded the llvm source code from github.</p>\n\n<p>I am trying everything from command line on <code>Windows OS</code></p>\n\n<p>I am following the link for libtooling in clang </p>\n\n<p><a href=\"http://clang.llvm.org/docs/LibASTMatchersTutorial.html\" rel=\"nofollow noreferrer\">http://clang.llvm.org/docs/LibASTMatchersTutorial.html</a></p>\n\n<p>I tried with 2 options</p>\n\n<blockquote>\n  <blockquote>\n    <p>Option First: I ran the below command<br>\n    <code>cmake -G Ninja \"C:\\Users\\amith.ks\\Desktop\\Clang-llvm\\llvm-project\\llvm\" -DLLVM_ENABLE_PROJECTS=\"clang;clang-tools-extra\" -DLLVM_BUILD_TESTS=ON -DCMAKE_BUILD_TYPE=Release</code></p>\n  </blockquote>\n</blockquote>\n\n<p>Everything Worked..</p>\n\n<blockquote>\n  <blockquote>\n    <p>Second option:\n    I wan to set <code>cmake_c_compiler</code> and <code>cmake_cxx_compiler</code> from command line.<br>\n    I dont want to use cmake-gui so I run the below command<br>\n    <code>cmake -G Ninja \"C:\\Users\\amith.ks\\Desktop\\Clang-llvm\\llvm-project\\llvm\" -DLLVM_ENABLE_PROJECTS=\"clang;clang-tools-extra\" -DLLVM_BUILD_TESTS=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++</code></p>\n  </blockquote>\n</blockquote>\n\n<p>From out of no where error was thrown</p>\n\n<pre><code>CMake Error at cmake/modules/CheckAtomic.cmake:53 (message):\n  Host compiler appears to require libatomic, but cannot find it.\nCall Stack (most recent call first):\n  cmake/config-ix.cmake:343 (include)\n  CMakeLists.txt:617 (include)\n</code></pre>\n\n<p>When I saw the cmake error log It was saying this</p>\n\n<pre><code>LINK : fatal error LNK1104: cannot open file 'atomic.lib'\n\nclang: error: linker command failed with exit code 1104 (use -v to see invocation)\n\nninja: build stopped: subcommand failed.\n</code></pre>\n\n<p>I searched my whole pc <code>atomic.lib</code> no where to be found.</p>\n\n<p>How to solve this issue on windows?\nPlease help me with answers.</p>\n"}, {"tags": ["c", "file", "file-io"], "comments": [{"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 2, "creation_date": 1565173622, "post_id": 57392220, "comment_id": 101266436, "body": "<code>fgetc()</code> returns an int value. So, <code>a</code> should be defined as an int."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565173707, "post_id": 57392220, "comment_id": 101266469, "body": "... which is especially important when reading binary data, to distinguish <code>EOF</code> from <code>0xFF</code>."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1565173814, "post_id": 57392220, "comment_id": 101266533, "body": "Default parameter promotion converts a <code>char</code> to an <code>int</code> when passing to <code>printf</code>. This include sign extensions for negative values."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565174023, "post_id": 57392220, "comment_id": 101266653, "body": "and the <code>fgetc</code> thing <b>is</b> relevant when you&#39;re working with binary files"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565174050, "post_id": 57392220, "comment_id": 101266673, "body": "also <code>long</code> might not be sufficiently large to contain every file size, but it perhaps wouldn&#39;t be a problem."}], "answers": [{"tags": [], "owner": {"reputation": 7877, "user_id": 914716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0ed96380268ce904eb69d0895915cfa?s=128&d=identicon&r=PG", "display_name": "jpa", "link": "https://stackoverflow.com/users/914716/jpa"}, "is_accepted": true, "score": 2, "last_activity_date": 1565173797, "creation_date": 1565173797, "answer_id": 57392337, "question_id": 57392220, "link": "https://stackoverflow.com/questions/57392220/binary-file-reading-add-extra-characters-in-c/57392337#57392337", "title": "Binary file Reading, add extra characters in c?", "body": "<pre><code>char *msg;\n</code></pre>\n\n<p>Your <code>msg</code> variable has datatype <code>char</code>, which is probably signed on your platform. That means, it represents values from -128 to +127.</p>\n\n<pre><code>printf(\"%x\",msg[i]);\n</code></pre>\n\n<p>Any arguments to <code>printf()</code> that have an integer datatype smaller than <code>int</code> will be expanded to <code>int</code>. That conversion will keep the arithmetic value, so -128 which is <code>0x80</code> in <code>char</code>, will expand to <code>0xFFFFFF80</code> for <code>int</code>.</p>\n\n<p>To avoid this, you need to store or cast the values to <code>unsigned char</code> first. The <code>uint8_t</code> type is same as <code>unsigned char</code> and easier to read, so:</p>\n\n<pre><code>printf(\"%x\", (uint8_t)msg[i]);\n</code></pre>\n\n<p>That way the numeric value will range from 0 to 255, like you would expect, and print as <code>0x00</code> to <code>0xFF</code> even after the implicit conversion to <code>int</code>.</p>\n"}], "owner": {"reputation": 91, "user_id": 11123197, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-KQySF1-8Bzs/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOUPGh-oZWLUUJLvD6hAhkPlG3oIQ/mo/photo.jpg?sz=128", "display_name": "superstack", "link": "https://stackoverflow.com/users/11123197/superstack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "closed_date": 1565173871, "accepted_answer_id": 57392337, "answer_count": 1, "score": 1, "last_activity_date": 1565173973, "creation_date": 1565173418, "question_id": 57392220, "link": "https://stackoverflow.com/questions/57392220/binary-file-reading-add-extra-characters-in-c", "closed_reason": "Duplicate", "title": "Binary file Reading, add extra characters in c?", "body": "<p>I try to read binary(executeable) files, butsome problem as it prints extra character(0xffffff) after every few bytes. But this code work perfectly for text file(Non-binary). The code is:</p>\n\n<pre><code>int main(int argc, char **argv) {\n  uint64_t i=0;\n  FILE * fp=fopen(argv[1],\"rb\");\n  uint8_t a;\n  long int size=0;\n  char *msg;\n  size=findSize(argv[1]);\n  msg=(char *)malloc(size+1);\n\n  while((a=fgetc(fp))!=EOF)\n  {\n    printf(\"%02x\",a);\n      msg[i]=(char)a;\n    i++;\n    if(i==size)\n      break;\n  }\n  i=0;\n  for(i=0;i&lt;size;i++)\n  {\n    printf(\"%x\",msg[i]);\n\n  }\n    return 0;\n}\n</code></pre>\n\n<p>When i try to print the value(s) of <strong>a</strong>, It works perfectly, while printing <strong>msg[i]</strong>, it prints extra bytes i,e:</p>\n\n<p><strong>Orginal bytes:</strong> <code>0xa31c4b1ab66b900</code></p>\n\n<p><strong>Output with extra bytes:</strong> <code>0xa31c4ffffffb1ffffffafffffffb66ffffffb900</code></p>\n"}, {"tags": ["c++", "c"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1565173083, "post_id": 57392102, "comment_id": 101266131, "body": "Please read <a href=\"http://stackoverflow.com/help\">the help pages</a>, especially <a href=\"http://stackoverflow.com/help/on-topic\">&quot;What topics can I ask about here?&quot;</a> and <a href=\"http://stackoverflow.com/help/dont-ask\">&quot;What types of questions should I avoid asking?&quot;</a>. Also <a href=\"http://stackoverflow.com/tour\">take the tour</a> and <a href=\"http://stackoverflow.com/help/how-to-ask\">read about how to ask good questions</a> and <a href=\"https://codeblog.jonskeet.uk/2012/11/24/stack-overflow-question-checklist/\" rel=\"nofollow noreferrer\">this question checklist</a>. Lastly don&#39;t forget how to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 7210, "user_id": 1421332, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/39f3da5b153edf32201b9e9100dad01a?s=128&d=identicon&r=PG", "display_name": "Silicomancer", "link": "https://stackoverflow.com/users/1421332/silicomancer"}, "edited": false, "score": 1, "creation_date": 1565173441, "post_id": 57392102, "comment_id": 101266334, "body": "Which language? You wrote &quot;C&quot; but your tags say also C++ and C++CLI"}, {"owner": {"reputation": 25, "user_id": 5396042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4af1dc3cd23f51eedd91bd116791e618?s=128&d=identicon&r=PG&f=1", "display_name": "archana", "link": "https://stackoverflow.com/users/5396042/archana"}, "edited": false, "score": 0, "creation_date": 1565173607, "post_id": 57392102, "comment_id": 101266427, "body": "Any of these 3 languages are okay, basically I need the answer."}, {"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "edited": false, "score": 0, "creation_date": 1565174029, "post_id": 57392102, "comment_id": 101266656, "body": "What have you tried and what is your difficulty?"}, {"owner": {"reputation": 25, "user_id": 5396042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4af1dc3cd23f51eedd91bd116791e618?s=128&d=identicon&r=PG&f=1", "display_name": "archana", "link": "https://stackoverflow.com/users/5396042/archana"}, "edited": false, "score": 0, "creation_date": 1565174469, "post_id": 57392102, "comment_id": 101266905, "body": "I need to call some python code in my c++/cli  program only if the system contains 64 bit version of python. So first I am supposed to check whether the python is of 64 bit or not.  If 64 bit then I need to embedded the python code."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565175023, "post_id": 57392102, "comment_id": 101267180, "body": "<i>which</i> Python?"}, {"owner": {"reputation": 25, "user_id": 5396042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4af1dc3cd23f51eedd91bd116791e618?s=128&d=identicon&r=PG&f=1", "display_name": "archana", "link": "https://stackoverflow.com/users/5396042/archana"}, "edited": false, "score": 0, "creation_date": 1565175242, "post_id": 57392102, "comment_id": 101267303, "body": "basically python 3, but problem is not with python. Instead how to know the python architecture using C/ C++ or c++/cli"}, {"owner": {"reputation": 722, "user_id": 6387948, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cbaNARBRWO4/AAAAAAAAAAI/AAAAAAAAAGM/lVLNlR9XqDE/photo.jpg?sz=128", "display_name": "Hans-Martin Mosner", "link": "https://stackoverflow.com/users/6387948/hans-martin-mosner"}, "edited": false, "score": 0, "creation_date": 1565177226, "post_id": 57392102, "comment_id": 101268436, "body": "There can be several versions of Python in different directories. You could have 32-bit and 64-bit versions of python2.x or python3.x."}, {"owner": {"reputation": 2485, "user_id": 11282404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1e3829cb91cc6be3541a37381b5ff21?s=128&d=identicon&r=PG&f=1", "display_name": "jpmarinier", "link": "https://stackoverflow.com/users/11282404/jpmarinier"}, "edited": false, "score": 0, "creation_date": 1565179721, "post_id": 57392102, "comment_id": 101269846, "body": "@archana You could try  <code>cmd = &quot;python3 -c \\&quot;import sys ; import platform; print (sys.version) ; print( platform.platform())\\&quot;;</code> . and then <code>fh = popen(cmd, &quot;r&quot;);</code>. Then you can read the required information from the <code>fh</code> file handle. Works on Linux, please note that the invocation syntax could be a bit different on a Windows system. Do not forget to call <code>pclose(fh);</code> when done."}, {"owner": {"reputation": 25, "user_id": 5396042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4af1dc3cd23f51eedd91bd116791e618?s=128&d=identicon&r=PG&f=1", "display_name": "archana", "link": "https://stackoverflow.com/users/5396042/archana"}, "reply_to_user": {"reputation": 2485, "user_id": 11282404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1e3829cb91cc6be3541a37381b5ff21?s=128&d=identicon&r=PG&f=1", "display_name": "jpmarinier", "link": "https://stackoverflow.com/users/11282404/jpmarinier"}, "edited": false, "score": 0, "creation_date": 1565241309, "post_id": 57392102, "comment_id": 101292193, "body": "@jpmarinier Thanks for your suggestion. I could use system() instead of popen()"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 5396042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4af1dc3cd23f51eedd91bd116791e618?s=128&d=identicon&r=PG&f=1", "display_name": "archana", "link": "https://stackoverflow.com/users/5396042/archana"}, "edited": false, "score": 0, "creation_date": 1565241239, "post_id": 57394472, "comment_id": 101292170, "body": "Thank you so much. It worked. Only diff is instead of &quot;32bit&quot; I have to write as &#39;32bit&#39;"}], "tags": [], "owner": {"reputation": 774, "user_id": 746618, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2e08fae44d9362af3127657e9fbb4a79?s=128&d=identicon&r=PG", "display_name": "ilia", "link": "https://stackoverflow.com/users/746618/ilia"}, "is_accepted": true, "score": 2, "last_activity_date": 1565180707, "creation_date": 1565180707, "answer_id": 57394472, "question_id": 57392102, "link": "https://stackoverflow.com/questions/57392102/version-check-of-python/57394472#57394472", "title": "Version check of python", "body": "<pre><code>char *cmd = \"python -c \\\"import sys,platform ;exit(platform.architecture()[0]==\\\"32bit\\\")\\\"\"\nint ret = system(cmd);\n</code></pre>\n\n<p>ret will be 1 for 32 bit and 0 for 64</p>\n"}], "owner": {"reputation": 25, "user_id": 5396042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4af1dc3cd23f51eedd91bd116791e618?s=128&d=identicon&r=PG&f=1", "display_name": "archana", "link": "https://stackoverflow.com/users/5396042/archana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "closed_date": 1565183164, "accepted_answer_id": 57394472, "answer_count": 1, "score": -4, "last_activity_date": 1565181654, "creation_date": 1565173003, "last_edit_date": 1565181654, "question_id": 57392102, "link": "https://stackoverflow.com/questions/57392102/version-check-of-python", "closed_reason": "Needs more focus", "title": "Version check of python", "body": "<p>I need to check if installed Python version is 32 bit or 64 bit using my C program running in Windows 10, not in my Python program. </p>\n\n<p>How can I check the Python architecture using C code?</p>\n"}, {"tags": ["c", "enums", "arm", "keil", "bitflags"], "comments": [{"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 5, "creation_date": 1565173335, "post_id": 57391948, "comment_id": 101266275, "body": "I think you&#39;re over engineering it.  Simple is often best.  Just create a setbit, clearbit function and use a normal int enum for the colours.  Don&#39;t typedef it. Just my opinion."}, {"owner": {"reputation": 1447, "user_id": 6746897, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1eb640fcdc6847c55c189ceddb6afca5?s=128&d=identicon&r=PG&f=1", "display_name": "Julien", "link": "https://stackoverflow.com/users/6746897/julien"}, "edited": false, "score": 0, "creation_date": 1565263440, "post_id": 57391948, "comment_id": 101302975, "body": "I&#39;ve never seen enums used for bitfields. Enum is always int type and so shouldn&#39;t be or&#39;ed with <code>|</code>. In your case, ` #define` is the cleanest way to do with <code>1u&lt;&lt;n</code> to have unsigned values"}], "answers": [{"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 3525, "user_id": 10927863, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OYbxO.jpg?s=128&g=1", "display_name": "Eliahu Aaron", "link": "https://stackoverflow.com/users/10927863/eliahu-aaron"}, "edited": false, "score": 1, "creation_date": 1565177291, "post_id": 57393083, "comment_id": 101268477, "body": "@EliahuAaron It may be that the compiler picked a smaller integer type for <code>LedType</code>. Regardless, it is a false positive since the result of <code>LED_RED | LED_GREEN | LED_YELLOW</code> will fit inside <code>LedType</code>. If so you could silence the compiler with <code>setOnLed((LedType)(LED_RED | LED_GREEN | LED_YELLOW));</code> but that&#39;s overly pedantic and doesn&#39;t really help readability."}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 2, "last_activity_date": 1574852493, "last_edit_date": 1574852493, "creation_date": 1565176304, "answer_id": 57393083, "question_id": 57391948, "link": "https://stackoverflow.com/questions/57391948/c-using-enum-for-bit-flags-warning-enumerated-type-mixed-with-another-type/57393083#57393083", "title": "C - Using enum for bit flags - warning: enumerated type mixed with another type", "body": "<blockquote>\n  <p>I would prefer to use an enum instead of defines for LED flags because I prefer to encapsulate theme in one meaningful type/object.</p>\n</blockquote>\n\n<p>This is perfectly fine but keep two things in mind:</p>\n\n<ul>\n<li>The type of an <em>enumeration constant</em>, <code>LED_RED</code> in your case, is always of type <code>int</code> which is signed.</li>\n<li>The type of an <em>enumerated type</em>, <code>LedType</code> in your case is implementation-defined. The compiler can pick a smaller integer type if the values used would fit inside one.</li>\n</ul>\n\n<p>Generally, you'll want to avoid signed types in embedded systems, because of integer promotion and various hiccups with bitwise operators.</p>\n\n<p>One such hiccup is left-shifting a signed integer constant <code>1</code>. This is of type <code>int</code> and signed, so on a 32 bit system, <code>1 &lt;&lt; 31</code> would mean an undefined behavior bug. Therefore, always unsign suffix your integer constants: always use <code>1u &lt;&lt; n</code> instead of <code>1 &lt;&lt; n</code>.</p>\n\n<blockquote>\n  <p>I get the warning: <code>warning: #188-D: enumerated type mixed with another type</code></p>\n</blockquote>\n\n<p>Yeah because the function expects a <code>uint32_t</code> but you pass a <code>int</code>, since all operands in the expression <code>LED_RED | LED_GREEN | LED_YELLOW</code> are <code>int</code> - they are enumeration constants as described above. You should rewrite the function to take <code>LedType</code> as parameter instead.</p>\n\n<p>Example:</p>\n\n<p>// led.h</p>\n\n<pre><code>typedef enum\n{\n  LED_NONE   = 0u,\n  LED_RED    = 1u &lt;&lt; 0,\n  LED_GREEN  = 1u &lt;&lt; 1,\n  LED_YELLOW = 1u &lt;&lt; 2,\n  LED_ORANGE = 1u &lt;&lt; 3,\n  LED_ALL = LED_RED | LED_GREEN | LED_YELLOW | LED_ORANGE;\n} led_t;\n\n#define LED_PORT PORTX\n\n\nvoid set_led (led_t leds);\n</code></pre>\n\n<p>// led.c</p>\n\n<pre><code>#include \"led.h\"\n\nvoid set_led (led_t leds)\n{\n  // this assuming you'll want to use the function both to set and clear leds\n  uint32_t led_port = LED_PORT;\n  led_port &amp;= (uint32_t) ~LED_ALL;\n  led_port |= (uint32_t) leds;\n  LED_PORT = (uint32_t) leds;\n}\n</code></pre>\n\n<p>The <code>(uint32_t)</code> casts are strictly speaking not necessary but will sate pedantic compilers and MISRA-C checkers.</p>\n"}], "owner": {"reputation": 3525, "user_id": 10927863, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OYbxO.jpg?s=128&g=1", "display_name": "Eliahu Aaron", "link": "https://stackoverflow.com/users/10927863/eliahu-aaron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 914, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1591094625, "creation_date": 1565172508, "last_edit_date": 1592644375, "question_id": 57391948, "link": "https://stackoverflow.com/questions/57391948/c-using-enum-for-bit-flags-warning-enumerated-type-mixed-with-another-type", "title": "C - Using enum for bit flags - warning: enumerated type mixed with another type", "body": "<p>I'm passing enumeration constants as bit-flags to a function that expects the enumeration type as input, like this:</p>\n<pre><code>// Enumeration type\ntypedef enum\n{\n    LED_RED    =        (1 &lt;&lt; 0),\n    LED_GREEN  =        (1 &lt;&lt; 1),\n    LED_YELLOW =        (1 &lt;&lt; 2),\n    LED_ORANGE =        (1 &lt;&lt; 3),\n} LedType;\n\n...\n\n// Function declaration\nvoid setOnLed(LedType led);\n\n...\n\n// Function call\nsetOnLed(LED_RED | LED_GREEN | LED_YELLOW);\n</code></pre>\n<p>When I call the function, I get a warning:</p>\n<blockquote>\n<p>warning:  #188-D: enumerated type mixed with another type</p>\n</blockquote>\n<p>The warning is because <code>LED_RED | LED_GREEN | LED_YELLOW</code> is converted to an integer and is not a <code>LedType</code>.</p>\n<p>I could avoid the warning by adding LED combinations to the <code>LedType</code> enumeration but that means I have to add all possible combinations... and if I add more LED options to the <code>enum</code>, it will become really messy...</p>\n<p>I could use arrays as an input to the function but that will require more code when calling the function, I prefer a simple function call to set LED's.</p>\n<p><em>I am programming an ARM based micro-controller (STM32) using Keil \u00b5Vision IDE.</em></p>\n<h2>My question</h2>\n<p>Is there a simple safe way to avoid this warning or another way to encapsulate all the LED's in one meaningful type/object so I can easily pass them to a function and process them in a loop?</p>\n<hr />\n<h2>The full story</h2>\n<p>I'm writing a program for an ARM based MCU which is connected to several LED's. In many places in the program, we will torn on/off, toggle and blink different combinations of the LED's. To make this clean and simple, I want to write several functions that get as input any combination of the LED's and do the same operations on all.</p>\n<p>I created a <code>struct</code> named <code>LedConfig</code> with the hardware configurations of a LED and an array of <code>LedConfig</code> that contains the configuration of each LED:</p>\n<pre><code>typedef struct\n{\n    // Hardware configurations of a LED\n    ...\n} LedConfig;\n\n...\n\nLedConfig LedArry[LEDS_LED_COUNT] = \n{\n    [0] = { /* Red LED config    */ }, \n    [1] = { /* Green LED config  */ }, \n    [2] = { /* Yellow LED config */ }, \n    [3] = { /* Orange LED config */ }\n};\n\n</code></pre>\n<p>Now, I would like a simple way to pass several LED's to a function and process them in a loop.</p>\n<p>I created a number of bit flags for each LED:</p>\n<pre><code>// Number of LED's defined in the system\n#define LED_COUNT           4\n\n// LED flags, for usage in LED's function\n#define LED_RED             (1 &lt;&lt; 0)\n#define LED_GREEN           (1 &lt;&lt; 1)\n#define LED_YELLOW          (1 &lt;&lt; 2)\n#define LED_ORANGE          (1 &lt;&lt; 3)\n</code></pre>\n<p>Defined a function:</p>\n<pre><code>void setOnLed(uint32_t led)\n{\n    uint32_t bitMask = 1;\n    for(int i = 0; i &lt; LED_COUNT; i++)\n    {\n        if(led &amp; bitMask)\n        {\n            LedConfig* ledConfig = &amp;LedArry[i];\n            // Turn on LED ...\n        }\n        bitMask &lt;&lt;= 1;\n    }\n}\n</code></pre>\n<p>Now I can pass the LED's to the function with bitwise or operation:</p>\n<pre><code>setOnLed(LED_RED | LED_GREEN | LED_YELLOW);\n</code></pre>\n<p>This works fine but...</p>\n<p>I would prefer to use an <code>enum</code> instead of defines for LED flags, in order to encapsulate theme in one meaningful type/object.</p>\n<p>I replaced the defines with an enumeration:</p>\n<pre><code>typedef enum\n{\n    LED_RED    =        (1 &lt;&lt; 0),\n    LED_GREEN  =        (1 &lt;&lt; 1),\n    LED_YELLOW =        (1 &lt;&lt; 2),\n    LED_ORANGE =        (1 &lt;&lt; 3),\n} LedType;\n</code></pre>\n<p>And modified <code>setOnLed</code> function input to get the enumeration type:</p>\n<pre><code>void setOnLed(LedType led)\n{\n    // ...\n}\n</code></pre>\n<p>When I call the function with several LED's:</p>\n<pre><code>setOnLed(LED_RED | LED_GREEN | LED_YELLOW);\n</code></pre>\n<p>I get the warning:</p>\n<blockquote>\n<p>warning:  #188-D: enumerated type mixed with another type</p>\n</blockquote>\n<p><strong>Note</strong>: <code>uint32_t</code> is from <a href=\"https://en.wikibooks.org/wiki/C_Programming/stdint.h\" rel=\"nofollow noreferrer\">stdint.h</a> and is an unsigned 32-bit integer.</p>\n"}, {"tags": ["c++", "c", "embedded"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1565172641, "post_id": 57391899, "comment_id": 101265891, "body": "The big problem is a read-modify-write cycle of the variables. Like e.g. <code>x++</code> or <code>x += y</code>."}], "answers": [{"comments": [{"owner": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 3, "creation_date": 1565174568, "post_id": 57391951, "comment_id": 101266956, "body": "<i>32-bit variables are already been written atomically</i> - they are not"}, {"owner": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "reply_to_user": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1565174622, "post_id": 57391951, "comment_id": 101266980, "body": "@VTT how so? at the assembly level they are."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565174642, "post_id": 57391951, "comment_id": 101266989, "body": "@MichaelChourdakis never assume anything about the assembly."}, {"owner": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565174704, "post_id": 57391951, "comment_id": 101267016, "body": "@AnttiHaapala When unless your compiler is severely weird, when it does x = 5, it writes it atomically, not bit by bit."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565174746, "post_id": 57391951, "comment_id": 101267041, "body": "@MichaelChourdakis as I said never assume anything. The C standard says it is not fine so at some point it might not be fine."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565174987, "post_id": 57391951, "comment_id": 101267156, "body": "Furthermore there are not many useful programs besides <code>&#47;bin&#47;true</code> or <code>&#47;bin&#47;false</code> that could just use constants everywhere ;)"}, {"owner": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 1, "creation_date": 1565175017, "post_id": 57391951, "comment_id": 101267176, "body": "On x86 atomic operations, including simple atomic store have strict alignment requirements. So for example a single <code>mov</code> instruction is not guaranteed to be atomic. If value crosses cache line boundary then it is guaranteed to be not atomic."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1565178099, "post_id": 57391951, "comment_id": 101268955, "body": "@VTT but so does C on x86"}], "tags": [], "owner": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "is_accepted": false, "score": 2, "last_activity_date": 1565172514, "creation_date": 1565172514, "answer_id": 57391951, "question_id": 57391899, "link": "https://stackoverflow.com/questions/57391899/do-we-need-to-use-lock-for-multi-threaded-x32-system-for-just-reading-or-writing/57391951#57391951", "title": "Do we need to use lock for multi-threaded x32 system for just reading or writing into a uint32_t variable", "body": "<p>The usage of locks is not (only) to ensure atomicity, 32-bit variables are already been written atomically.</p>\n\n<p>Your problem is to protect simultaneous writing:</p>\n\n<pre><code>int x = 0;\nFunction 1: x++;\nFunction 2: x++;\n</code></pre>\n\n<p>If there is no synchronization, x might up end as 1 instead of 2 because function 2 might be reading <code>x = 0</code>, before function 1 modifies x. The worst thing in all this is that it might happen or not at random (or at your client's PC),  so debugging is difficult.</p>\n"}, {"tags": [], "owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "is_accepted": false, "score": 3, "last_activity_date": 1565174895, "last_edit_date": 1565174895, "creation_date": 1565172751, "answer_id": 57392020, "question_id": 57391899, "link": "https://stackoverflow.com/questions/57391899/do-we-need-to-use-lock-for-multi-threaded-x32-system-for-just-reading-or-writing/57392020#57392020", "title": "Do we need to use lock for multi-threaded x32 system for just reading or writing into a uint32_t variable", "body": "<p>Yes, one needs to use locks or some other appropriate mechanism, like the atomics. </p>\n\n<p><a href=\"http://port70.net/~nsz/c/c11/n1570.html#5.1.2.4p4\" rel=\"nofollow noreferrer\">C11 5.1.2.4p4</a>:</p>\n\n<blockquote>\n  <ol start=\"4\">\n  <li>Two expression evaluations conflict if one of them modifies a memory location and the other one reads or modifies the same memory location. </li>\n  </ol>\n</blockquote>\n\n<p><a href=\"http://port70.net/~nsz/c/c11/n1570.html#5.1.2.4p25\" rel=\"nofollow noreferrer\">C11 5.1.2.4p25</a>:</p>\n\n<blockquote>\n  <ol start=\"25\">\n  <li>The execution of a program contains a data race if it contains two conflicting actions in different threads, at least one of which is not atomic, and neither happens before the other. Any such data race results in undefined behavior.</li>\n  </ol>\n</blockquote>\n\n<hr>\n\n<p>Additionally if you've got a variable that is not volatile-qualified then the C standard does not even require that the changes hit to the memory at all; unless you use some synchronization mechanism the data races could have much longer spans  in an optimized program than one would perhaps initially think could be possible - for example the writes can be totally out of order and so forth.</p>\n"}, {"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 3, "last_activity_date": 1565173914, "creation_date": 1565173914, "answer_id": 57392373, "question_id": 57391899, "link": "https://stackoverflow.com/questions/57391899/do-we-need-to-use-lock-for-multi-threaded-x32-system-for-just-reading-or-writing/57392373#57392373", "title": "Do we need to use lock for multi-threaded x32 system for just reading or writing into a uint32_t variable", "body": "<p>It is only atomic if you write the code in assembler and pick the appropriate instruction. When using a higher level language, you don't have any control over which instructions that will get picked. </p>\n\n<p>If you have some C code like <code>a = b;</code> then the machine code generated might be \"load b into register x\", \"store register x in the memory location of a\", which is more than one instruction. An interrupt or another thread executed between those two will mean data corruption if it uses the same variable. Suppose the other thread writes a different value to <code>a</code> - then that change will be lost when returning to the original thread.</p>\n\n<p>Therefore you must use some manner of protection mechanism, such as <code>_Atomic</code> qualifier, mutex or critical sections.</p>\n"}, {"tags": [], "owner": {"reputation": 2990, "user_id": 10803671, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mt-5s4Zqfyk/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-i_80atK5hWxwK60_Ren7qQV1TVuQ/mo/photo.jpg?sz=128", "display_name": "ALX23z", "link": "https://stackoverflow.com/users/10803671/alx23z"}, "is_accepted": false, "score": 0, "last_activity_date": 1565178044, "creation_date": 1565178044, "answer_id": 57393622, "question_id": 57391899, "link": "https://stackoverflow.com/questions/57391899/do-we-need-to-use-lock-for-multi-threaded-x32-system-for-just-reading-or-writing/57393622#57393622", "title": "Do we need to use lock for multi-threaded x32 system for just reading or writing into a uint32_t variable", "body": "<p>The issue is that variables aren't updated instantly.</p>\n\n<p>Each processor's core has its own private memory (L1 and L2 caches). So if you modify a variable, say <code>x++</code>, in two different threads on two different cores - then each core updates their own version of <code>x</code>.</p>\n\n<p>Atomic operations and mutexes ensure synchronization of these variables with the shared memory (RAM / L3 cache).</p>\n"}], "owner": {"reputation": 241, "user_id": 10876003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d6164bfa4c1e3acf244f14a5c679854?s=128&d=identicon&r=PG&f=1", "display_name": "jack sparow", "link": "https://stackoverflow.com/users/10876003/jack-sparow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1565178044, "creation_date": 1565172367, "question_id": 57391899, "link": "https://stackoverflow.com/questions/57391899/do-we-need-to-use-lock-for-multi-threaded-x32-system-for-just-reading-or-writing", "title": "Do we need to use lock for multi-threaded x32 system for just reading or writing into a uint32_t variable", "body": "<p>I have a question:\nConsider a x32 System,\ntherefore for a uint32_t  variable does the system read and write to it atomically?\nMeaning, that the entire operation of read or write can be completed in one instruction cycle.\nIf this is the case then for a multi-threaded x32 system we wont have to use locks for just reading or writing into a uint32_t variable.\nPlease confirm my understanding.</p>\n"}, {"tags": ["c", "linux-kernel"], "comments": [{"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 1, "creation_date": 1565180782, "post_id": 57391660, "comment_id": 101270417, "body": "There is a note in the <a href=\"https://www.oreilly.com/catalog/errata.csp?isbn=9780596005658\" rel=\"nofollow noreferrer\">errata</a>: <b>Change &quot;the stack is stored starting at address 0x015fc000&quot; to  &quot;the stack is stored at addresses below 0x015fc000&quot;</b>."}, {"owner": {"reputation": 31, "user_id": 9122245, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-0kMHqFmCoZA/AAAAAAAAAAI/AAAAAAAAAA0/S3YLQgqG0n4/photo.jpg?sz=128", "display_name": "jian wang", "link": "https://stackoverflow.com/users/9122245/jian-wang"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1565183466, "post_id": 57391660, "comment_id": 101272126, "body": "Great, it is found and updated, thanks."}], "owner": {"reputation": 31, "user_id": 9122245, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-0kMHqFmCoZA/AAAAAAAAAAI/AAAAAAAAAA0/S3YLQgqG0n4/photo.jpg?sz=128", "display_name": "jian wang", "link": "https://stackoverflow.com/users/9122245/jian-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565171715, "creation_date": 1565171715, "question_id": 57391660, "link": "https://stackoverflow.com/questions/57391660/about-the-thread-union-in-understanding-the-linux-kernel-3rd-edition", "title": "About the thread_union in understanding the linux kernel 3rd edition", "body": "<p>Is the description here fully correct? </p>\n\n<p>In page 86 of \"UnderStanding The Linux Kernel 3rd Edition\", \"Identifying the current process\"</p>\n\n<p>The thread_info structure shown in Figure 3-2 is stored starting at address 0x015fa000 , and the stack is stored starting at address 0x015fc000 . The value of the esp register points to the current top of the stack at 0x015fa878.</p>\n\n<p>See the union definition.</p>\n\n<h1>\"the stack is stored starting at address 0x015fc000\":</h1>\n\n<p>1.Regarding the union:\n  If using &amp;thread_union.stack to get the starting address of stack, then it should be same as &amp;thread_union.thread_info, with value 0x015fa000. </p>\n\n<p>2.As the stack grows down, then when fetching the start address of stack, the is a small computing like &amp;thread_union.thread_info + 4*2048, or &amp;thread_union.thread_info[2048]. </p>\n\n<p>Right?</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>union thread_union {\n  struct thread_info thread_info;\n  unsigned long stack[2048]; /* 1024 for 4KB stacks */\n};\n</code></pre>\n"}, {"tags": ["c", "assembly", "linux-kernel", "interrupt", "kernel-module"], "comments": [{"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1565171911, "post_id": 57391628, "comment_id": 101265471, "body": "If using the default AT&amp;T assembly language syntax in GCC the problem is that <code>int 0x3B</code> is treating 0x3B as a memory operand. You likely mean to tell the assembler that 0x3B is an immediate by prepending it with a dollar sign <code>$</code>. Should look like: <code>int $0x3B</code>"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1565172056, "post_id": 57391628, "comment_id": 101265553, "body": "Seems totally normal to me.  Luckily you have no driver waiting for hardware to raise that interrupt, so raising it from software hits a default handler than Linux apparently installs for otherwise-unused IDT entries.  The tutorial you&#39;re reading says &quot;if you want to ...&quot; so it&#39;s not claiming that this is something you <i>would</i> want to do for IRQ 11 specifically."}, {"owner": {"reputation": 89, "user_id": 6819537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b28e45a9f6258d1a1a8f9ddbc46824fd?s=128&d=identicon&r=PG&f=1", "display_name": "Massimiliano Di Cavio", "link": "https://stackoverflow.com/users/6819537/massimiliano-di-cavio"}, "edited": false, "score": 0, "creation_date": 1565172153, "post_id": 57391628, "comment_id": 101265609, "body": "Sorry, you are right, I&#39;ve done a mistake about post, in the original program there&#39;s asm(&quot;int $0x3B&quot;), but is the same result, &quot;do_IRQ: 1.59 No irq handler for vector&quot;"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "edited": false, "score": 0, "creation_date": 1565172190, "post_id": 57391628, "comment_id": 101265627, "body": "@MichaelPetch: If that was the problem, you&#39;d get an assemble time error (<code>Error: operand size mismatch for `int&#39;</code>).  The OP must be compiling with <code>-masm=intel</code>, because current <code>as</code> and clang both reject that in a <code>.s</code> file in AT&amp;T syntax mode.  Oh, or the OP didn&#39;t actually show a MCVE, glad that&#39;s fixed.  That makes more sense, I think most Linux kernel inline asm doesn&#39;t use dialect-alternatives to work with Intel-syntax mode."}, {"owner": {"reputation": 33092, "user_id": 5801661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D8ENZ.jpg?s=128&g=1", "display_name": "Margaret Bloom", "link": "https://stackoverflow.com/users/5801661/margaret-bloom"}, "edited": false, "score": 2, "creation_date": 1565172298, "post_id": 57391628, "comment_id": 101265693, "body": "Are you trying to raise interrupt 11 or <b>IRQ</b> 11? 0x3b is 59. Where does 0x3b come from?"}, {"owner": {"reputation": 89, "user_id": 6819537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b28e45a9f6258d1a1a8f9ddbc46824fd?s=128&d=identicon&r=PG&f=1", "display_name": "Massimiliano Di Cavio", "link": "https://stackoverflow.com/users/6819537/massimiliano-di-cavio"}, "edited": false, "score": 0, "creation_date": 1565172467, "post_id": 57391628, "comment_id": 101265791, "body": "In the tutorial is written: The IRQ0 is mapped to vector using the macro,  #define IRQ0_VECTOR (FIRST_EXTERNAL_VECTOR + 0x10)  where, FIRST_EXTERNAL_VECTOR = 0x20  So if we want to raise an interrupt IRQ11, programmatically we have to add 11 to vector of IRQ0.  0x20 + 0x10 + 11 = 0x3B (59 in Decimal).  Hence executing \u201casm(&quot;int $0x3B&quot;)\u201d will raise interrupt IRQ 11."}, {"owner": {"reputation": 33092, "user_id": 5801661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D8ENZ.jpg?s=128&g=1", "display_name": "Margaret Bloom", "link": "https://stackoverflow.com/users/5801661/margaret-bloom"}, "edited": false, "score": 2, "creation_date": 1565172929, "post_id": 57391628, "comment_id": 101266055, "body": "If that mapping is true, then your IRQ handler is not registered. What does <code>dmesg</code> say?"}, {"owner": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 1, "creation_date": 1565172971, "post_id": 57391628, "comment_id": 101266077, "body": "Also <code>cat &#47;proc&#47;interrupts</code>. You should see your handler registered."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1565173460, "post_id": 57391628, "comment_id": 101266341, "body": "Edit your question if you have info to add, like contents of <code>&#47;proc&#47;interrupts</code>"}, {"owner": {"reputation": 35113, "user_id": 3826372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P0peM.png?s=128&g=1", "display_name": "Ross Ridge", "link": "https://stackoverflow.com/users/3826372/ross-ridge"}, "edited": false, "score": 2, "creation_date": 1565189080, "post_id": 57391628, "comment_id": 101275731, "body": "You can&#39;t raise IRQs programatically using the INT instruction. Software interrupts generated by the INT instruction are handled differently than hardware interrupts delivered through the APIC. Also I&#39;m not if Linux uses the legacy IRQ number to IVT vector mappings when using the APIC."}], "answers": [{"tags": [], "owner": {"reputation": 56, "user_id": 12262349, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-CFabQIv0P10/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdDbckTdsKvUzVZQxy-sVOVsb5IeA/photo.jpg?sz=128", "display_name": "Rafi Moor", "link": "https://stackoverflow.com/users/12262349/rafi-moor"}, "is_accepted": true, "score": 2, "last_activity_date": 1577599543, "last_edit_date": 1577599543, "creation_date": 1577599256, "answer_id": 59517192, "question_id": 57391628, "link": "https://stackoverflow.com/questions/57391628/error-while-raising-interrupt-11-with-inline-asm-into-kernel-module/59517192#59517192", "title": "Error while raising interrupt 11 with inline asm into kernel module", "body": "<p>This used to work on older kernel versions, but fails on later versions. The reason is that the generic IRQ handler do_IRQ() has been changed for better IRQ handling performance. Instead of using the irq_to_desc() function to get the IRQ descriptor, it reads it from the per-CPU data. The descriptor is put there during the physical device initialization. Since this pseudo device driver don't have a physical device, do_IRQ() don't find it there and returns with an error.\nIf we want to simulate IRQ using software interrupt, we must first write the IRQ descriptor to the per-CPU data. Unfortunately, the symbol vector_irq, the array of the IRQ descriptors in the per-CPU data, is not exported to kernel modules during kernel compilation. The only way to change it, is to recompile the whole kernel. If you think it worth the effort, you can add the line:</p>\n\n<pre><code>EXPORT_SYMBOL (vector_irq);\n</code></pre>\n\n<p>in the file: <code>arch/x86/kernel/irq.c</code></p>\n\n<p>right after all the include lines.\nAfter compiling and booting from the newly compiled kernel, change your driver as follows:</p>\n\n<p>Add an include line:</p>\n\n<pre><code>    #include &lt;asm/hw_irq.h&gt;\n</code></pre>\n\n<p>change the read function to:</p>\n\n<pre><code>static ssize_t etx_read(struct file *filp,\n                char __user *buf, size_t len, loff_t *off)\n{\n        struct irq_desc *desc;\n\n        printk(KERN_INFO \"Read function\\n\");\n        desc = irq_to_desc(11);\n        if (!desc) return -EINVAL;\n        __this_cpu_write(vector_irq[59], desc);\n        asm(\"int $0x3B\");  // Corresponding to irq 11\n        return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 6819537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b28e45a9f6258d1a1a8f9ddbc46824fd?s=128&d=identicon&r=PG&f=1", "display_name": "Massimiliano Di Cavio", "link": "https://stackoverflow.com/users/6819537/massimiliano-di-cavio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 502, "favorite_count": 0, "accepted_answer_id": 59517192, "answer_count": 1, "score": 0, "last_activity_date": 1577599543, "creation_date": 1565171616, "last_edit_date": 1565173485, "question_id": 57391628, "link": "https://stackoverflow.com/questions/57391628/error-while-raising-interrupt-11-with-inline-asm-into-kernel-module", "title": "Error while raising interrupt 11 with inline asm into kernel module", "body": "<p>I 'm trying to raise interrupt 11 with inline asm inside a kernel module LKM</p>\n\n<pre><code>asm(\"int $0x3B\");\n</code></pre>\n\n<p>But after this line, I read in the dmesg</p>\n\n<pre><code>do_IRQ: 1.59 No irq handler for vector\n</code></pre>\n\n<p>This is driver code that I have taken from website <a href=\"https://embetronicx.com/tutorials/linux/device-drivers/linux-device-driver-tutorial-part-13-interrupt-example-program-in-linux-kernel/\" rel=\"nofollow noreferrer\">https://embetronicx.com/tutorials/linux/device-drivers/linux-device-driver-tutorial-part-13-interrupt-example-program-in-linux-kernel/</a>\nWhen I try to execute \"cat /dev/etx_device\" I got by dmesg</p>\n\n<pre><code>do_IRQ: 1.59 No irq handler for vector\n</code></pre>\n\n<p>My kernel version is 5.1.20-200.fc29.x86_64 AMD processor. What is the problem?</p>\n\n<pre><code>  cat /proc/interrupts: \n      CPU0       CPU1       \n  0:        110          0   IO-APIC   2-edge      timer\n  8:          1          0   IO-APIC   8-edge      rtc0\n  9:          0          0   IO-APIC   9-fasteoi   acpi\n 11:          0          0   IO-APIC  11-edge      etx_device\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565171794, "post_id": 57391620, "comment_id": 101265408, "body": "It is unclear whether you are using <code>int</code> or <code>unsigned int</code>, or what unsigned value you expect <code>-10000.0</code> to be stored as. You can store <code>float</code> values in the range of the integer type you are using."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1565174334, "post_id": 57391620, "comment_id": 101266830, "body": "Your first sentence says you want to store values in an <code>unsigned int</code>. The code you show to demonstrate this stores a value in an <code>int</code>. That is not an example of storing a value in an <code>unsigned int</code>. So your question is inconsistent and unclear. Edit it to talk about only <code>unsigned int</code> or only <code>int</code>. In any case, an <code>unsigned int</code> will never hold a negative value."}], "answers": [{"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 1, "last_activity_date": 1565180626, "last_edit_date": 1565180626, "creation_date": 1565178687, "answer_id": 57393840, "question_id": 57391620, "link": "https://stackoverflow.com/questions/57391620/converting-float-negative-values-to-integer-value-in-c-launguage/57393840#57393840", "title": "Converting float negative values to integer value in c launguage", "body": "<blockquote>\n  <p>can the negative (<code>float f</code>) value be stored in an integer?</p>\n</blockquote>\n\n<p>Yes, with limitations.</p>\n\n<hr>\n\n<p>With a <em>signed</em> integer type like <code>int16_t i</code>, <code>i = f</code> is well defined for </p>\n\n<pre><code>-32768.999... to 32767.999...\n</code></pre>\n\n<p>With an <em>unsigned</em> integer type like <code>unt16_t u</code>, <code>u = f</code> is well defined for </p>\n\n<pre><code>-0.999... to 65535.999...\n</code></pre>\n\n<p>The result is a truncated value (fraction thrown away).  All other <code>float</code> values result in <em>undefined behavior</em>.</p>\n\n<blockquote>\n  <p>If not, how can we store the negative values into integer variables?</p>\n</blockquote>\n\n<p>Best to use wide <em>signed</em> integer types and test for range limitations.</p>\n\n<p>In any case, <strong>the fraction of the <code>float</code> is lost</strong>.  A <code>-0.5f</code> can be stored in an <code>unsigned</code>, yet the value becomes <code>0u</code>.</p>\n\n<hr>\n\n<p>The below performs some simply tests to insure <code>y</code> is in range.</p>\n\n<pre><code>#include &lt;limits.h&gt;\nfloat x = ...;\nint y = 0;\n\nif (x &gt;= INT_MAX + 1u) puts(\"Too pos\");\nelse if (x &lt;= INT_MIN - 1.0) puts(\"Too neg\");\nelse y = (int) x;\n</code></pre>\n\n<hr>\n\n<p><strong>Note</strong> the  tests above are illustrative as they lack high portability. </p>\n\n<p>Example: <code>INT_MIN - 1.0</code> in inexact in select situations. </p>\n\n<p>To cope, with common 2's complement <code>int</code>, the below is better reformed.  As 2's complement, <code>INT_MIN</code> is a power of 2 (negated) and usually in the range of <code>float</code>, thus making for an exact subtraction near the negative threshold.  `</p>\n\n<pre><code>// if (x &lt;= INT_MIN - 1.0)\nif (x - INT_MIN &lt;= - 1.0f)\n</code></pre>\n\n<hr>\n\n<p>Another alternative is to explore a <code>union</code>.  Leave that for others to explain its possibilities and limitations.</p>\n\n<pre><code>union {\n  float f;\n  unsigned u;\n} x;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1565180421, "post_id": 57394303, "comment_id": 101270221, "body": "Why <code>x+0.5</code>?  Note <code>(int)(x+0.5)</code> does not round to nearest when <code>x &lt; 0</code>."}], "tags": [], "owner": {"reputation": 61, "user_id": 11895111, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--DR4B_tDTQU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf_FftmAmgeG0RianYEU9R0_n1emw/photo.jpg?sz=128", "display_name": "Amrik Singh", "link": "https://stackoverflow.com/users/11895111/amrik-singh"}, "is_accepted": false, "score": -2, "last_activity_date": 1565181304, "last_edit_date": 1565181304, "creation_date": 1565180166, "answer_id": 57394303, "question_id": 57391620, "link": "https://stackoverflow.com/questions/57391620/converting-float-negative-values-to-integer-value-in-c-launguage/57394303#57394303", "title": "Converting float negative values to integer value in c launguage", "body": "<pre><code>float x = 10000.0;\nint a;\n\na = (int)(x+0.5);\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 11894900, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jQmnPYmeEo0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd4PDjQ6o_ttlHiJNKsDc-ZEA58HQ/photo.jpg?sz=128", "display_name": "Parameswara Rao S", "link": "https://stackoverflow.com/users/11894900/parameswara-rao-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "closed_date": 1566054241, "answer_count": 2, "score": -1, "last_activity_date": 1565181304, "creation_date": 1565171601, "last_edit_date": 1565173142, "question_id": 57391620, "link": "https://stackoverflow.com/questions/57391620/converting-float-negative-values-to-integer-value-in-c-launguage", "closed_reason": "Needs details or clarity", "title": "Converting float negative values to integer value in c launguage", "body": "<p>I want to convert <code>float</code> negative values to <code>unsigned int</code> values. Is it possible?</p>\n\n<p>For example:</p>\n\n<pre><code>float x = -10000.0;\nint y;\ny = x;\n</code></pre>\n\n<p>When we assign x value to y, can the negative value be stored in an integer?\nIf not, how can we store the negative values into integer variables?</p>\n"}, {"tags": ["c++", "c", "arrays", "pointers"], "comments": [{"owner": {"reputation": 8766, "user_id": 451321, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7Sdao.jpg?s=128&g=1", "display_name": "Michael Chourdakis", "link": "https://stackoverflow.com/users/451321/michael-chourdakis"}, "edited": false, "score": 2, "creation_date": 1565170474, "post_id": 57391249, "comment_id": 101264709, "body": "Related:  <a href=\"https://stackoverflow.com/questions/55593936/c-multidimensional-array-in-existing-memory\">C++ Multidimensional array in existing memory</a>"}, {"owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "edited": false, "score": 0, "creation_date": 1565172891, "post_id": 57391249, "comment_id": 101266038, "body": "Maybe pass the array through as <code>void*</code>? see <a href=\"https://ideone.com/zOeKcE\" rel=\"nofollow noreferrer\">ideone.com/zOeKcE</a>"}, {"owner": {"reputation": 3693, "user_id": 11455384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e87a1e837a79a0248716b61a930f67fa?s=128&d=identicon&r=PG&f=1", "display_name": "Fareanor", "link": "https://stackoverflow.com/users/11455384/fareanor"}, "edited": false, "score": 0, "creation_date": 1565178242, "post_id": 57391249, "comment_id": 101269042, "body": "Can&#39;t you use directly an <code>int **</code> instead of <code>int *</code> ? This way you will be able to use the <code>[][]</code> semantics. A simple <code>int *</code> cannot do it. If you really want to convert it, you will need to create an <code>int **</code> and copy the <code>int *</code> contents according to the matrix dimensions you need."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565180295, "post_id": 57391249, "comment_id": 101270146, "body": "There is no such language as C/C++. You need to pick one. For a question anyway."}], "answers": [{"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1565179038, "post_id": 57391811, "comment_id": 101269459, "body": "The strict aliasing rule says &quot;An object shall have its stored value accessed only by an lvalue expression that has one of the following types: ... - an aggregate or union type that includes one of the aforementioned types among its members&quot; So the array case is covered, an array being an aggregate type."}, {"owner": {"reputation": 88, "user_id": 8474352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a94e9ffcf6149c99c6efacf4970dac2c?s=128&d=identicon&r=PG&f=1", "display_name": "Sergio", "link": "https://stackoverflow.com/users/8474352/sergio"}, "edited": false, "score": 0, "creation_date": 1565268692, "post_id": 57391811, "comment_id": 101306072, "body": "And can I asume that a <code>int[m][n]</code> is guaranteed to have the same memory representation than an <code>int[m*n]</code>?"}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 88, "user_id": 8474352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a94e9ffcf6149c99c6efacf4970dac2c?s=128&d=identicon&r=PG&f=1", "display_name": "Sergio", "link": "https://stackoverflow.com/users/8474352/sergio"}, "edited": false, "score": 1, "creation_date": 1565269244, "post_id": 57391811, "comment_id": 101306427, "body": "@Sergio Yes. Arrays are unpadded. Check out <a href=\"https://stackoverflow.com/questions/1066681/can-c-arrays-contain-padding-in-between-elements\" title=\"can c arrays contain padding in between elements\">stackoverflow.com/questions/1066681/&hellip;</a>"}], "tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": false, "score": 1, "last_activity_date": 1565172138, "creation_date": 1565172138, "answer_id": 57391811, "question_id": 57391249, "link": "https://stackoverflow.com/questions/57391249/convert-int-to-intn-in-c-c/57391811#57391811", "title": "Convert int* to int(*)[n] in C / C++", "body": "<p>I think that casting a pointer to an array pointer and subsequently using it ought not to be UB and that it technically isn't, as long as there's enough space where the pointer point. </p>\n\n<p>Pointer casts aren't UB provided you satisfy target alignment requirements. Pointer dereferences may be UB if they violate the strict aliasing rule. The caveat with array pointers, however, is that the strict aliasing rule only speaks about accesses through an lvalue of a given type and you can't ever use an lvalue of an array type for an access--you always end up accessing, presumably correctly typed, individual elements.</p>\n\n<p>In spite of that, I think explicit pointer arithmetic might be preferable in this case. It's most apparently UB-free, and it avoids pointer casts, which are very often dangerous and arguably should look jarring to most C/C++ programmers.</p>\n"}, {"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 0, "last_activity_date": 1565179412, "creation_date": 1565179412, "answer_id": 57394086, "question_id": 57391249, "link": "https://stackoverflow.com/questions/57391249/convert-int-to-intn-in-c-c/57394086#57394086", "title": "Convert int* to int(*)[n] in C / C++", "body": "<p><code>int (*mat)[5] = (int (*)[5])data;</code> is fine given that what's actually stored there is an <code>int[5]</code> array and nothing else. C is only concerned with the <em>effective type</em> of the object in memory.</p>\n\n<p>To do it without an explicit cast, you'd have to do some union hacking, which is only valid in C and not in C++:</p>\n\n<pre><code>typedef union\n{\n  int* ptr;\n  int(*arr)[5];\n}arr_t;\n\nint (*mat)[5] = (arr_t){ .ptr = data }.arr;\n</code></pre>\n\n<p>But that doesn't exactly improve readability so I wouldn't recommend it. Use a cast instead.</p>\n"}], "owner": {"reputation": 88, "user_id": 8474352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a94e9ffcf6149c99c6efacf4970dac2c?s=128&d=identicon&r=PG&f=1", "display_name": "Sergio", "link": "https://stackoverflow.com/users/8474352/sergio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1565179412, "creation_date": 1565170364, "last_edit_date": 1565171175, "question_id": 57391249, "link": "https://stackoverflow.com/questions/57391249/convert-int-to-intn-in-c-c", "title": "Convert int* to int(*)[n] in C / C++", "body": "<p>How can I convert a pointer to a \"pointer to array\"?\nAs an example, supose I have a pointer <code>int *data</code> to some memory block of 15 integers. I would like to do something like:</p>\n\n<pre><code>int (*mat)[5] = data;\n</code></pre>\n\n<p>so that I can now make:</p>\n\n<pre><code>for(int i = 0; i &lt; 3; i++){\n  for(int j = 0; j &lt; 5; j++){\n    mat[i][j] = // Something.\n  }\n}\n</code></pre>\n\n<p>However, I get a warning with gcc:</p>\n\n<pre><code>warning: initialization from incompatible pointer type [-Wincompatible-pointer-types]\n     int (*mat)[5] = data;\n</code></pre>\n\n<p>and an error with g++:</p>\n\n<pre><code>error: cannot convert \u2018int*\u2019 to \u2018int (*)[5]\u2019 in initialization\n     int (*mat)[5] = data;\n</code></pre>\n\n<p>If I add an explicit cast <code>int (*mat)[5] = (int (*)[5])data;</code> it compiles without warnings, but i don't know if this yields undefined behavior.</p>\n\n<p>What is the correct way to accomplish this? Can it be made without an explicit cast?</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>I know I can use the <code>int *</code> pointer like this:</p>\n\n<pre><code>data[5*i + j] = \\\\ Something.\n</code></pre>\n\n<p>but in my real situation I need to iterate the array through 3 dimensions,\nand the code inside the <code>[]</code> gets very long, thats why I want to use the\n<code>mat[i][j]</code> notation.</p>\n"}, {"tags": ["c", "i2c"], "comments": [{"owner": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 1, "creation_date": 1565168388, "post_id": 57390321, "comment_id": 101263583, "body": "What is <code>adcarray</code> or <code>Value</code> - you&#39;ve left out the declarations for those variables."}, {"owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "reply_to_user": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 0, "creation_date": 1565169281, "post_id": 57390321, "comment_id": 101264050, "body": "Hello Chris, Value is 2 x 8 bit values read consecutively from a 16bit register on the adc. I need to put those in an array or ideally an INT."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1565169454, "post_id": 57390321, "comment_id": 101264147, "body": "The function already takes a pointer and a length value where the data is to be stored. Why not call that function with the address of your array?"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1565169608, "post_id": 57390321, "comment_id": 101264235, "body": "Please always provide complete information about error messages. What is the exact text and for what line is it reported? The snippet is not part of the function above. Please always provide complete verifyable program to reproduce your problem."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1565169690, "post_id": 57390321, "comment_id": 101264279, "body": "How do you verify if you successfully read the data? Where do you compare the read values with the I2C analyser?"}, {"owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565169756, "post_id": 57390321, "comment_id": 101264305, "body": "Hello Gerhardh - I&#39;ve added  adcdata[count] = data ; immediately after the *buf++ = data ; but I am not sure it is working properly, the array seems to be empty"}, {"owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565169827, "post_id": 57390321, "comment_id": 101264343, "body": "I have a ZeroPlus logic state analyser which shows me the 2 bytes being read correctly, I just need to store them"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "reply_to_user": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565169908, "post_id": 57390321, "comment_id": 101264400, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/197600/discussion-between-gerhardh-and-ralph\">continue this discussion in chat</a>."}, {"owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565170160, "post_id": 57390321, "comment_id": 101264544, "body": "sorry, I will come back to you, I have other major issues with the I2C code"}, {"owner": {"reputation": 816, "user_id": 1254598, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d414cfcb5ebe38af8e65acbe8ad02a0a?s=128&d=identicon&r=PG", "display_name": "Sunil Shahu", "link": "https://stackoverflow.com/users/1254598/sunil-shahu"}, "edited": false, "score": 0, "creation_date": 1565177492, "post_id": 57390321, "comment_id": 101268594, "body": "If array has all zero values then your function I2C_SDA_IS_HIGH() seems to be problem. If you want to put this data in Integer variable, you would like to look into byte order of network and host. (<a href=\"https://linux.die.net/man/3/ntohl\" rel=\"nofollow noreferrer\">linux.die.net/man/3/ntohl</a>)"}, {"owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565180341, "post_id": 57390321, "comment_id": 101270173, "body": "Hello Sunil, note that there is nothing wrong with the I2C code as my analyser shows the 2 bytes being read in sequence and they contain the expected values. My problem is how do I put those 2 bytes into an array or int so I can perform maths etc (2&#39;s compliment number)"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1565182366, "post_id": 57390321, "comment_id": 101271379, "body": "Your code is still rather incomplete. What is <code>Value</code>? It should contain the 2 bytes  read by &#39;I2CM_In<code>. What&#39;s wrong with the content of </code>Value`? Is it different from what you see in your analyzer?"}, {"owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565183053, "post_id": 57390321, "comment_id": 101271879, "body": "Yes, very different, the values shown in the analyser are 3E for the first byte and f) for the second. The value of Value (according to IAR) is &#39;unknown or ambiguous sysmbol&#39;"}, {"owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565183475, "post_id": 57390321, "comment_id": 101272134, "body": "I have now shown &#39;all the code&#39; but that is likely to just confuse people, the issue is that I still cant figure out how to save the bytes so I can int / scale them etc. I suspect I am missing something simple."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 1, "creation_date": 1565184082, "post_id": 57390321, "comment_id": 101272527, "body": "<code>unsigned char Value;</code> How is this supposed to hold 2 bytes?"}, {"owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565184553, "post_id": 57390321, "comment_id": 101272851, "body": "I2C_Read_Register( ADC, 0x00 ) returns 2 bytes (according to the I2C analyser), holding them is the problem that I am looking for a solution for."}, {"owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565184808, "post_id": 57390321, "comment_id": 101273049, "body": "I need to add something after this *buf++ = data to store / hold the 2 bytes, but I don&#39;t know what (arrays, ints etc dont seem to work)"}, {"owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565184921, "post_id": 57390321, "comment_id": 101273128, "body": "Value is a fallback from TI&#39;s supposed I2C example code, it is no surprise to me that it doesn&#39;t work with more than one byte."}, {"owner": {"reputation": 3305, "user_id": 1428695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a843c704cdb7e32a93769cddfed4747?s=128&d=identicon&r=PG", "display_name": "yhyrcanus", "link": "https://stackoverflow.com/users/1428695/yhyrcanus"}, "edited": false, "score": 0, "creation_date": 1565186485, "post_id": 57390321, "comment_id": 101274116, "body": "The problem is that the actual variable behind <code>buf</code> <i>is</i> <code>Value</code>, which only allocates a byte of memory. Value should probably be an array or a 16 bit int, and the function <code>I2C_Read_Register</code> should return a 16 bit int. If you shove a breakpoint at <code>*buf++ = data ;</code>, do you see the same thing your analyzer sees?"}, {"owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565187271, "post_id": 57390321, "comment_id": 101274611, "body": "Thanks but solved, a very simple (albeit messy) if count = 0 or if count = 1 (immediately after  *buf++ = data) then store the associated byte in a separate char."}], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565190003, "post_id": 57397117, "comment_id": 101276222, "body": "Thanks, what I actually used (albeit fairly horrible) was -                                              if (count == 0)              {         ADC_Value2 = data ;         }                  if (count == 1)         {         ADC_Value1 = data ;         }"}, {"owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565190431, "post_id": 57397117, "comment_id": 101276485, "body": "Of course then attempting to combine the two separate chars into an int (for maths work) doesn&#39;t work (using standard shift first char 8 bits left, add second char etc (in IAR Workbench) but that&#39;s another story"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "reply_to_user": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "edited": false, "score": 0, "creation_date": 1565192410, "post_id": 57397117, "comment_id": 101277562, "body": "You might try to cast the value to int before shifting."}], "tags": [], "owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "is_accepted": false, "score": 0, "last_activity_date": 1565270977, "last_edit_date": 1565270977, "creation_date": 1565189401, "answer_id": 57397117, "question_id": 57390321, "link": "https://stackoverflow.com/questions/57390321/store-2-bytes-from-i2c-slave/57397117#57397117", "title": "Store 2 bytes from I2C Slave", "body": "<p>If you try to store the data in another array with the I2CM_In function, you are using it wrong.</p>\n\n<pre><code>static void I2CM_In( unsigned char* buf, int count )\n{\n    unsigned char data ;\n\n    for( ; count--; )\n    {\n        ....\n        //put the input data byte into the buffer, inc buffer pointer\n        *buf++ = data ;\n    }\n}\n</code></pre>\n\n<p>The data received is already stored in a buffer: <code>buf</code>.\nIt is your job to provide a buffer that is suitable to store the result.</p>\n\n<pre><code>static unsigned char I2C_Read_Register( char Device_Address, char Register_Address )\n{\n    unsigned char Value ;\n...\n    I2CM_In( &amp;Value, 2 ) ;  // &lt;&lt; Value is 1 byte!\n...\n  return Value ;\n}\n</code></pre>\n\n<p>If you want to read a register with 16 bit, you cannot return the value as an <code>unsigned char</code>. You must use a data type capable of holding (at least) 2 bytes.</p>\n\n<p>By telling the function that the buffer is 2 bytes long, you also cause undefined behaviour.</p>\n\n<pre><code>static uint16_t I2C_Read_Register( char Device_Address, char Register_Address )\n{\n    uint16_t Value ;\n...\n    I2CM_In( &amp;Value, 2 ) ;\n...\n    return Value ;\n}\n</code></pre>\n\n<p>Depending on the endianess you might also need to switch byte order:</p>\n\n<pre><code>static uint16_t I2C_Read_Register( char Device_Address, char Register_Address )\n{\n    uint8_t tmp_Value[2] ;\n...\n    I2CM_In( tmp_Value, 2 ) ;\n    uint16_t Value;\n\n#if MSB_FIRST\n    Value = ((uint16_t)tmp_Value[0]) &lt;&lt; 8 || tmp_Value[1];\n#else // LSB_FIRST\n    Value = ((uint16_t)tmp_Value[1]) &lt;&lt; 8 || tmp_Value[0];\n#endif\n...\n    return Value ;\n}\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 9586145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/836fa667af39c545d1cf95d56838a0dd?s=128&d=identicon&r=PG&f=1", "display_name": "Ralph", "link": "https://stackoverflow.com/users/9586145/ralph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 244, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565270977, "creation_date": 1565167332, "last_edit_date": 1565245888, "question_id": 57390321, "link": "https://stackoverflow.com/questions/57390321/store-2-bytes-from-i2c-slave", "title": "Store 2 bytes from I2C Slave", "body": "<p>struggling with what is probably a straightforward piece of code to copy 2 bytes received from an I2C slave into an array so I can then convert to INT and perform maths on the data.</p>\n\n<p>This code successfully (according to my I2C analyser) reads 2 consecutive bytes from one register address on a 16bit ADC.</p>\n\n<pre><code>void ADC_Initialise( void )\n{\n    _DINT() ;                              // disable all maskable interrupts\n\n    I2C_SCL_HIGH() ;\n    I2C_SCL_OUTPUT() ;\n    I2C_SDA_HIGH() ;\n    I2C_SDA_OUTPUT() ;\n\n    I2C_Write_Register_3B( ADC, 0x01, 0xC0, 0x83) ;  // Write 2 bytes to ADC Config Register\n\n    for(i=0; i &lt; 10000; i++);\n\n    I2C_Read_Register( ADC, 0x00 );      // Read the 2 byte ADC value\n\n    for(i=0; i &lt; 10000; i++);\n    _EINT() ;                             // re-enable the interrupts\n}\n\nstatic unsigned char I2C_Read_Register( char Device_Address, char Register_Address )\n\n{\n    unsigned char Value ;\n\n    I2CM_Start( ) ;\n\n    if( I2CM_Out( Device_Address &lt;&lt; 1 ) )    //send write control byte + chip address\n        return 0 ;\n\n    else if( I2CM_Out( Register_Address ) )  //send register number\n        return 0 ;\n\n    I2CM_Start( ) ;                          // Restart\n\n    if( I2CM_Out(( Device_Address &lt;&lt; 1 ) | 0x01 ))      //send read control byte + chip address\n    return 0 ;\n\n    I2CM_In( &amp;Value, 2 ) ;                    //RJ  6.8.19 input 2 byte ADC value to 'buf'\n\n//      return Value ;                          //rj placed after IC2M_In\n    I2CM_Stop( ) ;\n\n    return Value ;                              //rj placed after IC2M_Stop\n}\n\n\nstatic void I2CM_In( unsigned char* buf, int count )\n{\n    unsigned char data ;\n\n    for( ; count--; )  // How do I store these 2 bytes in a char[] or INT\n    {\n            data = 0 ;\n            I2C_SDA_INPUT() ;\n\n        volatile unsigned int i = 0 ;\n\n        for( ; i &lt; 8 ; ++i )\n        {\n            //Set Clock High\n            I2C_SCL_HIGH() ;              \n\n            //shift the bit over\n            data &lt;&lt;= 1 ;\n\n            if( I2C_SDA_IS_HIGH() )\n            {\n                data |= 0x01 ;\n            }\n            //Set Clock Low\n            brief_pause( 0x04 ) ;\n            I2C_SCL_LOW() ;\n        }\n        //put the input data byte into the buffer, inc buffer pointer\n        *buf++ = data ;\n\n        //take sda to output ack\n        I2C_SDA_OUTPUT() ;\n\n        //Set Clock High\n        I2C_SCL_HIGH() ;\n\n        //Set Clock Low\n        brief_pause( 0x04 ) ;\n        I2C_SCL_LOW() ;\n    }\n}\n</code></pre>\n\n<p>So, presumably I then need an array (unsigned char adcarray [2] to collect / store the resulting reads, so I tried -</p>\n\n<pre><code>*buf++ = data ;\n\nadcarray[] = data ;\n\nadcarray[] = buf ;\n</code></pre>\n\n<p>'expected an expression' presumably means I need some form of for loop to populate the array on each pass, even though the *buf line is already inside a count 2 loop.</p>\n\n<p>Assistance appreciated (C in IAR on MSP430 and ADS1115 ADC).\nRegards, Ralph  </p>\n"}, {"tags": ["c", "windows", "performance", "x86", "division"], "comments": [{"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1565200140, "post_id": 57389985, "comment_id": 101281250, "body": "Be curious of the dump of _alldiv to see what it is doing?  Could be a cached table of divides for small integer.  idiv is a known pig on x86 so perhaps that is faster?"}, {"owner": {"reputation": 18883, "user_id": 2612235, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/dpsjq.jpg?s=128&g=1", "display_name": "nowox", "link": "https://stackoverflow.com/users/2612235/nowox"}, "reply_to_user": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 2, "creation_date": 1565200427, "post_id": 57389985, "comment_id": 101281373, "body": "@MichaelDorgan It seems <code>__alldiv</code> is: <a href=\"http://www.jbox.dk/sanos/source/lib/lldiv.asm.html\" rel=\"nofollow noreferrer\">jbox.dk/sanos/source/lib/lldiv.asm.html</a>"}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1565209499, "post_id": 57389985, "comment_id": 101285206, "body": "Double check that optimizations were turned on for this build?"}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1565209788, "post_id": 57389985, "comment_id": 101285318, "body": "The only way i see this being faster is if the integer multiplier was smart enough to change those divides into fixed point muls.  I am stumped."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1565237262, "post_id": 57389985, "comment_id": 101291291, "body": "MSVC can make ELF executables?  WSL can&#39;t even run 32-bit Linux/ELF executables (only x86-64), so how did you even run this?  Also, why introduce a store/reload memory dependency by making both input variables <code>volatile</code> as well as incrementing them?"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1565237615, "post_id": 57389985, "comment_id": 101291339, "body": "Possible duplicate of <a href=\"//stackoverflow.com/q/44556614\">What is the reasoning behind x64 having such a different performance result from x86?</a> where it mostly boils down to 32-bit code checking and using one 32-bit <code>div</code> instead of one 64-bit <code>div</code> for those input numbers.  But that question has many levels of libraries and JIT to wade through before getting to that issue."}, {"owner": {"reputation": 3596, "user_id": 1753435, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b81cf3b8c8432e0bcac7322120a09b56?s=128&d=identicon&r=PG", "display_name": "andreee", "link": "https://stackoverflow.com/users/1753435/andreee"}, "edited": false, "score": 1, "creation_date": 1565249004, "post_id": 57389985, "comment_id": 101295197, "body": "@nowox: Slightly OT note: In case you don&#39;t know it already, you should have a look at Agner Fog&#39;s homepage: <a href=\"https://agner.org/optimize/\" rel=\"nofollow noreferrer\">agner.org/optimize</a>. It contains a lot of valueable resources regarding this topic..."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1565249293, "post_id": 57389985, "comment_id": 101295340, "body": "Why are you using the term &quot;<a href=\"https://en.wikipedia.org/wiki/Executable_and_Linkable_Format\" rel=\"nofollow noreferrer\">ELF</a>&quot;?  That&#39;s the name of an executable format used on Linux and Unix.  Is that just a typo for EXE / executable?  Windows uses the PE/COFF executable format for normal Windows <code>.exe</code> files like you&#39;re probably making, not ELF."}], "answers": [{"comments": [{"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 1, "creation_date": 1565236694, "post_id": 57404707, "comment_id": 101291172, "body": "<a href=\"https://stackoverflow.com/q/54438477/995714\">Clang has the same capability</a> and will check if the operands fit in 32 bits to use the 32-bit div"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1565237543, "post_id": 57404707, "comment_id": 101291326, "body": "Near duplicate for 64-bit <code>div</code> being much slower than 32-bit <code>div</code> on Intel CPUs: <a href=\"//stackoverflow.com/q/29983453\">Trial-division code runs 2x faster as 32-bit on Windows than 64-bit on Linux</a>."}], "tags": [], "owner": {"reputation": 100407, "user_id": 16406, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/fadf252892475e9b177d5cd5e8b24145?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Dodd", "link": "https://stackoverflow.com/users/16406/chris-dodd"}, "is_accepted": true, "score": 5, "last_activity_date": 1565234154, "creation_date": 1565234154, "answer_id": 57404707, "question_id": 57389985, "link": "https://stackoverflow.com/questions/57389985/division-performance-for-a-x32-elf-on-a-x64-os/57404707#57404707", "title": "Division performance for a x32 ELF on a x64 OS", "body": "<p>If you look at <a href=\"https://gmplib.org/~tege/x86-timing.pdf\" rel=\"noreferrer\">instruction timings for x86 processors</a>, it turns out that on recent Intel processors, a 64-bit divide is 3-4x as expensive as a 32-bit divide -- and if you look at the internals of alldiv (link in the comments above), for your values which will always fit in 32 bits, it will use a single 32-bit divide...</p>\n"}], "owner": {"reputation": 18883, "user_id": 2612235, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/dpsjq.jpg?s=128&g=1", "display_name": "nowox", "link": "https://stackoverflow.com/users/2612235/nowox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 1, "accepted_answer_id": 57404707, "answer_count": 1, "score": 3, "last_activity_date": 1565249034, "creation_date": 1565166228, "last_edit_date": 1565249034, "question_id": 57389985, "link": "https://stackoverflow.com/questions/57389985/division-performance-for-a-x32-elf-on-a-x64-os", "title": "Division performance for a x32 ELF on a x64 OS", "body": "<p>In the following example running a 32-bit ELF on a 64-bit architecture is faster and I don't understand why. I have tried with two examples one using a division the other one with a multiplication. The performance is as expected, however, the performance for the division is surprizing. </p>\n\n<p>We see on the assembly that the compiler is calling <code>_alldiv</code> which emulates a 64-bit division on a 32-bit architecture, so it must be slower than simply using the assembly instruction <code>idiv</code>. So I don't understand the results I got: </p>\n\n<p>My setup is: Windows 10 x64, Visual Studio 2019</p>\n\n<p>To time the code I use <code>Measure-Command { .\\out.exe }</code>:</p>\n\n<ul>\n<li>Multiplication\n\n<ul>\n<li>32-bit ELF: 3360 ms</li>\n<li>64-bit ELF: 1469 ms</li>\n</ul></li>\n<li>Division\n\n<ul>\n<li>32-bit ELF: 7383 ms</li>\n<li>64-bit ELF: 8567 ms</li>\n</ul></li>\n</ul>\n\n<h3>Code</h3>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;limits.h&gt;\n#include &lt;Windows.h&gt;\n\nvolatile int64_t m = 32;\nvolatile int64_t n = 12;\nvolatile int64_t result;\n\nint main(void)\n{\n    for (size_t i = 0; i &lt; (1 &lt;&lt; 30); i++)\n    {\n#       ifdef DIVISION\n        result = m / n;\n#       else \n        result = m * n;\n#       endif\n        m += 1;\n        n += 3;\n    }\n}\n</code></pre>\n\n<h3>64-bit disassembly (division)</h3>\n\n<pre><code>    for (size_t i = 0; i &lt; (1 &lt;&lt; 30); i++)\n00007FF60DA81000  mov         r8d,40000000h  \n00007FF60DA81006  nop         word ptr [rax+rax]  \n    {\n        result = m / n;\n00007FF60DA81010  mov         rcx,qword ptr [n (07FF60DA83038h)]  \n00007FF60DA81017  mov         rax,qword ptr [m (07FF60DA83040h)]  \n00007FF60DA8101E  cqo  \n00007FF60DA81020  idiv        rax,rcx  \n00007FF60DA81023  mov         qword ptr [result (07FF60DA83648h)],rax  \n        m += 1;\n00007FF60DA8102A  mov         rax,qword ptr [m (07FF60DA83040h)]  \n00007FF60DA81031  inc         rax  \n00007FF60DA81034  mov         qword ptr [m (07FF60DA83040h)],rax  \n        n += 3;\n00007FF60DA8103B  mov         rax,qword ptr [n (07FF60DA83038h)]  \n00007FF60DA81042  add         rax,3  \n00007FF60DA81046  mov         qword ptr [n (07FF60DA83038h)],rax  \n00007FF60DA8104D  sub         r8,1  \n00007FF60DA81051  jne         main+10h (07FF60DA81010h)  \n    }\n}\n</code></pre>\n\n<h3>32-bit disassembly (division)</h3>\n\n<pre><code>    for (size_t i = 0; i &lt; (1 &lt;&lt; 30); i++)\n00A41002  mov         edi,40000000h  \n00A41007  nop         word ptr [eax+eax]  \n    {\n        result = m / n;\n00A41010  mov         edx,dword ptr [n (0A43018h)]  \n00A41016  mov         eax,dword ptr ds:[00A4301Ch]  \n00A4101B  mov         esi,dword ptr [m (0A43020h)]  \n00A41021  mov         ecx,dword ptr ds:[0A43024h]  \n00A41027  push        eax  \n00A41028  push        edx  \n00A41029  push        ecx  \n00A4102A  push        esi  \n00A4102B  call        _alldiv (0A41CD0h)  \n00A41030  mov         dword ptr [result (0A433A0h)],eax  \n00A41035  mov         dword ptr ds:[0A433A4h],edx  \n        m += 1;\n00A4103B  mov         eax,dword ptr [m (0A43020h)]  \n00A41040  mov         ecx,dword ptr ds:[0A43024h]  \n00A41046  add         eax,1  \n00A41049  mov         dword ptr [m (0A43020h)],eax  \n00A4104E  adc         ecx,0  \n00A41051  mov         dword ptr ds:[0A43024h],ecx  \n        n += 3;\n00A41057  mov         eax,dword ptr [n (0A43018h)]  \n00A4105C  mov         ecx,dword ptr ds:[0A4301Ch]  \n00A41062  add         eax,3  \n00A41065  mov         dword ptr [n (0A43018h)],eax  \n00A4106A  adc         ecx,0  \n00A4106D  mov         dword ptr ds:[0A4301Ch],ecx  \n00A41073  sub         edi,1  \n00A41076  jne         main+10h (0A41010h)  \n    }\n}\n</code></pre>\n\n<h2>Edit</h2>\n\n<p>To investigate further as <a href=\"https://stackoverflow.com/users/16406/chris-dodd\">Chris Dodd</a>, I have slightly modified my code as follow:</p>\n\n<pre><code>volatile int64_t m = 32000000000;\nvolatile int64_t n = 12000000000;\nvolatile int64_t result;\n</code></pre>\n\n<p>This time I have these results:</p>\n\n<ul>\n<li>Division\n\n<ul>\n<li>32-bit ELF: 22407 ms</li>\n<li>64-bit ELF: 17812 ms</li>\n</ul></li>\n</ul>\n"}, {"tags": ["c++", "c", "algorithm"], "comments": [{"owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "edited": false, "score": 0, "creation_date": 1565164768, "post_id": 57389546, "comment_id": 101261682, "body": "Well ... if A is a power of 2, <code>numberofsetbits(A * B &#47;*no overflow, no wrapping*&#47;) == numberofsetbits(B)</code> :)"}, {"owner": {"reputation": 383, "user_id": 8216204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc75d2ed2c77d48af4bdbd45e8e355c?s=128&d=identicon&r=PG&f=1", "display_name": "mrpandey", "link": "https://stackoverflow.com/users/8216204/mrpandey"}, "edited": false, "score": 0, "creation_date": 1565164769, "post_id": 57389546, "comment_id": 101261685, "body": "Use <code>long long</code> to calculate <code>C</code>."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1565164794, "post_id": 57389546, "comment_id": 101261693, "body": "<i>&quot;of course calculating C and counting the bits is not the correct solution&quot;</i>... but there is no <b>other</b> solution, but to calculate C to know what its bits are. Or what do you think?! that if you multiply 2 numbers with 4 bits set you will get 8 bits set? 6 bits set?"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 2, "creation_date": 1565164985, "post_id": 57389546, "comment_id": 101261772, "body": "You can calculate <code>C</code> in <i>parts</i> though. you need not store the entire result in memory."}, {"owner": {"reputation": 1590, "user_id": 3796272, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zqSzP.jpg?s=128&g=1", "display_name": "Kampi", "link": "https://stackoverflow.com/users/3796272/kampi"}, "edited": false, "score": 0, "creation_date": 1565165029, "post_id": 57389546, "comment_id": 101261789, "body": "Why shouldn&#180;t bit counting work f&#252;r higher numbers? if you have a 64 bit integer, then you have 64 bits which can be possible 1 and possible numbers up to  1.8446744e+19 (or positive or negative). Checking for all bits set on a 64 bit integer will need  ~100 - 200 cycles,"}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1565165063, "post_id": 57389546, "comment_id": 101261802, "body": "@AnttiHaapala Not necessarily true, because you don&#39;t need to know the value of each individual bit. You only need to know how many 1:s there are."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1565165065, "post_id": 57389546, "comment_id": 101261803, "body": "&quot;it won&#39;t work for high values&quot; Why? The result can only have up to twice the length of your values <code>A</code> and <code>B</code>. Counting bits is no magic. There are libraries availebl for calculating with large numbers ."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 0, "creation_date": 1565165179, "post_id": 57389546, "comment_id": 101261869, "body": "@klutt exactly... and to know that you need to calculate each individual bit :D"}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565165265, "post_id": 57389546, "comment_id": 101261913, "body": "@AnttiHaapala For instance, if either of A or B is zero, then C will have zero set bits. We also know that if A contains exactly one set bit, then C will have the same number of set bits as B."}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 0, "creation_date": 1565165639, "post_id": 57389546, "comment_id": 101262079, "body": "You could quite easily write a function <code>void mul(unsigned A, unsigned B, char *C)</code> that stores the result of A*B as a binary number represented by a string. Then you just count the number of ones."}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1565165939, "post_id": 57389546, "comment_id": 101262231, "body": "@AnttiHaapala It starts to be a problem when both A and B have two or more set bits, but I&#39;m definitely not sure that it does not exist a method that doesn&#39;t require you to calculate each individual bit. I might add that I&#39;m not sure of the opposite either."}, {"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565166060, "post_id": 57389546, "comment_id": 101262288, "body": "@AnttiHaapala &quot;I can&#39;t think of another way to calculate this than the obvious and correct way&quot; is not proof for &quot;there is no other solution&quot;. For example, I can tell you whether the product is divisble by 3 (or any other prime) without calculating the product, so how can you be sure that there is no way to figure out the number of set bits without performing the multiplication?"}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 0, "creation_date": 1565166234, "post_id": 57389546, "comment_id": 101262387, "body": "Since this obviously is a homework problem, you should provide the exact instructions. Not your interpretation. Also, you&#39;re expected to provide your own attempt. Please read <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>"}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1565166560, "post_id": 57389546, "comment_id": 101262544, "body": "You might have better luck on the mathematics site: I conject there is a pattern (and can probably prove such a pattern exists) only I don&#39;t know what it is. My starting point would be to look at discrete Fourier transforms in a radix of 2."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1565168035, "post_id": 57389546, "comment_id": 101263382, "body": "@Bathsheba I bet there are way more numbers to multiply when you&#39;re dealing with Fourier transforms..."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565168731, "post_id": 57389546, "comment_id": 101263768, "body": "@AnttiHaapala: Indeed. The Fourier analysis would be part of the derivation of a possibly trivial formula. You&#39;d use the latter in the implementation."}, {"owner": {"reputation": 67, "user_id": 8354083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b084d8021f5ccc47006b7702bc358f3?s=128&d=identicon&r=PG&f=1", "display_name": "Mihnea", "link": "https://stackoverflow.com/users/8354083/mihnea"}, "reply_to_user": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 0, "creation_date": 1565177371, "post_id": 57389546, "comment_id": 101268524, "body": "@klutt it was an interview question in a hiring test over codility, that I had to do about 2 weeks ago. Didn&#39;t save the exact description, it is indeed what I remember when it comes to details, but it was A * B which should work with A and B up to 10 million or something like this. I already mentioned it is an algorithm problem, don&#39;t use predefined specialised libraries or long long and count the bits."}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 0, "creation_date": 1565182000, "post_id": 57389546, "comment_id": 101271126, "body": "@Mihnea I&#39;m a bit picky now, but you did not say that using longer types were not allowed. You only stated that it &quot;of course&quot; is not a correct solution. That&#39;s something completely different."}], "answers": [{"comments": [{"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 1, "creation_date": 1565166395, "post_id": 57389853, "comment_id": 101262458, "body": "Stating that there is no general solution is a pretty bold statement. Can you back it up? Just because you cannot see a pattern it does not mean that there is no pattern."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1565166513, "post_id": 57389853, "comment_id": 101262515, "body": "Actually I believe there is a pattern: this is related to convolution and whole number mathematics."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1565166974, "post_id": 57389853, "comment_id": 101262751, "body": "You may well find that the solution is in fact simple. I don&#39;t know for sure. Do you?"}, {"owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "edited": false, "score": 0, "creation_date": 1565167243, "post_id": 57389853, "comment_id": 101262914, "body": "I have not found the solution until now. Please enlighten me if you find a simple solution,"}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 2, "creation_date": 1565170092, "post_id": 57389853, "comment_id": 101264508, "body": "@RishikeshRaje I don&#39;t know if there is an easier solution, but just the fact that you have not found one is not good enough to state that they don&#39;t exist in an answer."}], "tags": [], "owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "is_accepted": false, "score": -1, "last_activity_date": 1565166879, "last_edit_date": 1565166879, "creation_date": 1565165698, "answer_id": 57389853, "question_id": 57389546, "link": "https://stackoverflow.com/questions/57389546/how-to-find-out-how-many-bits-are-set-equal-1-in-the-product-of-two-integers/57389853#57389853", "title": "How to find out how many bits are set (equal 1) in the product of two integers", "body": "<p>There is no simple general solution for this.</p>\n\n<p>e.g. see the following multiplication</p>\n\n<pre><code>3(0b0011) * 4(0b0100) = 12(0b1100)\n3(0b0011) * 5(0b0101) = 15(0b1111)\n3(0b0011) * 6(0b0110) = 18(0b10010)\n</code></pre>\n\n<p>The reason is that there may be some carry bits in the multiplication which will ripple through the output and change the number of ones in unpredictable ways.</p>\n\n<p>You need to do the multiplication, and then count the bits.</p>\n\n<p>Since <code>A</code> * <code>B</code> are <code>MAX_INT</code> (usually 31 bits), you need a 64 bit number. You can use <code>uint64_t</code></p>\n"}, {"comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1565166580, "post_id": 57390079, "comment_id": 101262548, "body": "&quot;that would be simpler than performing the multiplication and counting the bits in the result&quot; - yes I quite agree. Have an upvote."}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": false, "score": 0, "last_activity_date": 1565166610, "last_edit_date": 1565166610, "creation_date": 1565166535, "answer_id": 57390079, "question_id": 57389546, "link": "https://stackoverflow.com/questions/57389546/how-to-find-out-how-many-bits-are-set-equal-1-in-the-product-of-two-integers/57390079#57390079", "title": "How to find out how many bits are set (equal 1) in the product of two integers", "body": "<p>There seems to be no general solution to your problem that would be simpler than performing the multiplication and counting the bits in the result. If the numbers are really large, the multiplication can be performed in slices at a significant cost in execution time.</p>\n\n<p>There are however some special cases you might find useful:</p>\n\n<ul>\n<li>if either A or B has exactly 0 bits set (A == 0 or B == 0), then C will have 0 bits set (C == 0), and this is the only way for C to have 0 bits set.</li>\n<li>if either A or B has exactly 1 bit set (A or B is a power of 2), then C will have the same number of bits set as the other number. Furthermore, for C to have exactly 1 bit set, both A and B must be powers of 2.</li>\n<li>the number of bits set in C is less than the sum of the numbers of significant bits in A and B.</li>\n<li>the number of unset least significant bits in C is the sum of the number of unset least significant bits in A plus the number of unset least significant bits in C.</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "edited": false, "score": 2, "creation_date": 1565166741, "post_id": 57390117, "comment_id": 101262626, "body": "I believe this is an algorithm for multiplication."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "edited": false, "score": 0, "creation_date": 1565166929, "post_id": 57390117, "comment_id": 101262729, "body": "@RishikeshRaje the question asks about a product, which is a multiplication. But multiplication itself can be avoided here because the &quot;partial product bit&quot; is <code>1</code> only if both source bits are set. And the product itseff need not be stored, which is one of the OP&#39;s problems."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "edited": false, "score": 0, "creation_date": 1565167134, "post_id": 57390117, "comment_id": 101262859, "body": "@RishikeshRaje the problem does not state &quot;no multiplication&quot;. It just says computignthe product loses the high bits, and this algorithm does not."}, {"owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "edited": false, "score": 0, "creation_date": 1565167182, "post_id": 57390117, "comment_id": 101262878, "body": "The algorithm given is for binary multiplication. A much faster and easier solution would be to use 64 bits and use the CPU for multiplication."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "edited": false, "score": 0, "creation_date": 1565167245, "post_id": 57390117, "comment_id": 101262917, "body": "@RishikeshRaje and then how do you solve 64 bits * 64 bits? Anyway, the question is tagged <code>C</code>."}, {"owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "edited": false, "score": 0, "creation_date": 1565167359, "post_id": 57390117, "comment_id": 101262985, "body": "use a BigInt library or create one on your own. I would not multiply bitwise."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565168828, "post_id": 57390117, "comment_id": 101263818, "body": "do 32 bit multiplications and have 32-bit carry..."}], "tags": [], "owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "is_accepted": false, "score": 4, "last_activity_date": 1565166671, "creation_date": 1565166671, "answer_id": 57390117, "question_id": 57389546, "link": "https://stackoverflow.com/questions/57389546/how-to-find-out-how-many-bits-are-set-equal-1-in-the-product-of-two-integers/57390117#57390117", "title": "How to find out how many bits are set (equal 1) in the product of two integers", "body": "<p>The question asks for an algorithm. The problem can be solved without holding a complete product, by computing each bit at a time, starting with bit 0.</p>\n\n<p>Bit <code>C0</code> is found from the product of <code>A0 * B0</code> and is either <code>0</code> or <code>1</code>.</p>\n\n<p>Bit <code>C1</code> is found from the sum of the products <code>A0 * B1 + A1 * B0</code> and remembering any carry.</p>\n\n<p>Bit <code>C2</code> is found from the sum of <code>carry + A0 * B2 + A1 * B1 + A2 * B0</code> and so on.</p>\n\n<p>As you go, you sum the single product bits, which gives the required answer: number of set bits.</p>\n"}], "owner": {"reputation": 67, "user_id": 8354083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b084d8021f5ccc47006b7702bc358f3?s=128&d=identicon&r=PG&f=1", "display_name": "Mihnea", "link": "https://stackoverflow.com/users/8354083/mihnea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 969, "favorite_count": 0, "closed_date": 1565188541, "answer_count": 3, "score": -10, "last_activity_date": 1565166879, "creation_date": 1565164573, "question_id": 57389546, "link": "https://stackoverflow.com/questions/57389546/how-to-find-out-how-many-bits-are-set-equal-1-in-the-product-of-two-integers", "closed_reason": "Needs more focus", "title": "How to find out how many bits are set (equal 1) in the product of two integers", "body": "<p>I am looking for an algorithm solution to find out how many bits are set (equal 1)  if I multiply two integers. I have numbers A and B, between 0 and MAX_INT, to eliminate the negative numbers. How do I find out how many bits will be set in the product C = A * B.</p>\n\n<p>-of course calculating C and counting the bits is not the correct solution, it won't work for high values</p>\n\n<p>-I work in C and C++, but it is a rather general algorithm problem. I must solve it without any math/boost library help.</p>\n\n<p>Tried finding a general solution to know the bit count, but what I guessed only worked for quite some examples, it entirely failed with high numbers.</p>\n"}, {"tags": ["c", "linux", "embedded", "embedded-linux"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565163442, "post_id": 57389134, "comment_id": 101261093, "body": "Well the <code>system</code> function usually starts a shell to execute the command (with <code>fork</code> and <code>exec</code>), and unless the shell has the command <code>echo</code> built-in it in turn have to do a <code>fork</code> and <code>exec</code> to execute the command. That&#39;s two <code>fork</code> and <code>exec</code> calls to run the command. You can do it with only one each. However, if you do it yourself then you have to set up the file descriptors to handle the redirection yourself, so it&#39;s going to be more code. And more code means more complexity and more chances of bugs."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1565163500, "post_id": 57389134, "comment_id": 101261117, "body": "Lastly, if you&#39;re really curious, then <i>test it!</i> Do each variant a lot of times, and measure the attempts to get an average that you can compare."}], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 9223403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30a60a969d56d13f302c2519dbe7248a?s=128&d=identicon&r=PG&f=1", "display_name": "E. Kjd", "link": "https://stackoverflow.com/users/9223403/e-kjd"}, "edited": false, "score": 1, "creation_date": 1565238658, "post_id": 57389267, "comment_id": 101291552, "body": "Thank you, It good idea, but i don&#39;t know why, it doesn&#39;t work with fopen(), fputs() but work corretly with open(), write()"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 5, "user_id": 9223403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30a60a969d56d13f302c2519dbe7248a?s=128&d=identicon&r=PG&f=1", "display_name": "E. Kjd", "link": "https://stackoverflow.com/users/9223403/e-kjd"}, "edited": false, "score": 0, "creation_date": 1565240835, "post_id": 57389267, "comment_id": 101292060, "body": "Interestinh. Then do use open+write"}], "tags": [], "owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "is_accepted": false, "score": 10, "last_activity_date": 1565163604, "creation_date": 1565163604, "answer_id": 57389267, "question_id": 57389134, "link": "https://stackoverflow.com/questions/57389134/changing-from-system-to-exec-does-it-speed-up-my-code/57389267#57389267", "title": "Changing from system() to exec(), does it speed up my code?", "body": "<p>The <code>exec*</code> equivalent of </p>\n\n<pre><code>system(\"echo \\\"x = 800 , y = 480 , swap = swap_32_16\\\"&gt;\"\n       \"/sys/bus/platform/drivers/display/layer0\");\n</code></pre>\n\n<p>is something like</p>\n\n<pre><code>execl(\"/bin/sh\", \"/bin/sh\", \"-c\", \"echo \\\"x = 800 , y = 480,\"\n      \" swap = swap_32_16\\\"&gt;/sys/bus/platform/drivers/display/layer0\", (char*)NULL);\n</code></pre>\n\n<p>The problem is that it is the <strong>exact</strong> same command that <code>system</code> would execute (in a newly forked subprocess), only more to type. And since <code>exec</code> <strong>replaces</strong> the current process with the newly executed program, the <code>exec</code> call would be the last one your program executes, unless you <code>fork()</code> the process first... and handle failures and and... wait for the completion of the subprocess etc.</p>\n\n<hr>\n\n<p>The <strong>true solution</strong> of course is to not use an external command at all, just do that in C: </p>\n\n<pre><code>FILE *f = fopen(\"/sys/bus/platform/drivers/display/layer0\", \"w\");\nif (!f) { \n    // ... could not open ... \n}\nfputs(\"x = 800 , y = 480 , swap = swap_32_16\\n\", f);\nfclose(f);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565173754, "post_id": 57391115, "comment_id": 101266502, "body": "well in this case it is less overhead but as soon as you start formatting stuff the system calls will again have more ;)"}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565180159, "post_id": 57391115, "comment_id": 101270068, "body": "@AnttiHaapala I doubt that. The echo command may be lightweight when issued from the shell or shell script, but an entire command shell is being launched just to execute it from C code on every iteration."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1565180214, "post_id": 57391115, "comment_id": 101270099, "body": "@Clifford ah, I am contrasting this against my answer"}], "tags": [], "owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "is_accepted": true, "score": 1, "last_activity_date": 1565169980, "creation_date": 1565169980, "answer_id": 57391115, "question_id": 57389134, "link": "https://stackoverflow.com/questions/57389134/changing-from-system-to-exec-does-it-speed-up-my-code/57391115#57391115", "title": "Changing from system() to exec(), does it speed up my code?", "body": "<p>Or you could use POSIX <code>open()</code>/<code>write()</code>/<code>close()</code> for even less overhead (assuming your C compiler/runtime environment provides them):</p>\n\n<pre><code>static char data[] = \"x = 800 , y = 480 , swap = swap_32_16\\n\";\nint fd = open( \"/sys/bus/platform/drivers/display/layer0\", O_WRONLY );\nwrite( fd, data, strlen( data ) );\nclose( fd );\n</code></pre>\n\n<p>Proper headers and all error checking have been omitted for brevity.</p>\n"}], "owner": {"reputation": 5, "user_id": 9223403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30a60a969d56d13f302c2519dbe7248a?s=128&d=identicon&r=PG&f=1", "display_name": "E. Kjd", "link": "https://stackoverflow.com/users/9223403/e-kjd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 57391115, "answer_count": 2, "score": 0, "last_activity_date": 1565169980, "creation_date": 1565163150, "question_id": 57389134, "link": "https://stackoverflow.com/questions/57389134/changing-from-system-to-exec-does-it-speed-up-my-code", "title": "Changing from system() to exec(), does it speed up my code?", "body": "<p>I need to execute some Linux command line in my C code so I choose to use <code>system()</code>. Unfortunately, it place in <code>while(1)</code> and maybe it make my program slow down. Does it improve if I use <code>exec()</code> family? If yes, could you show me how to convert this line from <code>system()</code> to <code>exec()?</code></p>\n\n<pre><code>while(1) {\n........\nsystem(\"echo \\\"x = 800 , y = 480 , swap = swap_32_16\\\"&gt; /sys/bus/platform/drivers/display/layer0\");\n........\n}\n</code></pre>\n\n<p>Thank you</p>\n"}, {"tags": ["c", "sockets", "linux-kernel", "unix-socket"], "comments": [{"owner": {"reputation": 4173, "user_id": 4450651, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l6IMB.jpg?s=128&g=1", "display_name": "red0ct", "link": "https://stackoverflow.com/users/4450651/red0ct"}, "edited": false, "score": 0, "creation_date": 1582019105, "post_id": 57388814, "comment_id": 106622653, "body": "Did the answer help you? Or is there something unclear?"}], "answers": [{"comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1565168029, "post_id": 57390151, "comment_id": 101263377, "body": "Kind of them to break working code, and an API that is nearly 40 years old."}], "tags": [], "owner": {"reputation": 4173, "user_id": 4450651, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l6IMB.jpg?s=128&g=1", "display_name": "red0ct", "link": "https://stackoverflow.com/users/4450651/red0ct"}, "is_accepted": false, "score": 1, "last_activity_date": 1565166780, "creation_date": 1565166780, "answer_id": 57390151, "question_id": 57388814, "link": "https://stackoverflow.com/questions/57388814/error-struct-msghdr-has-no-member-named-msg-iov/57390151#57390151", "title": "error: \u2018struct msghdr\u2019 has no member named \u2018msg_iov\u2019", "body": "<p>It seems that you use Linux kernel >= 3.19. Since 3.19 kernel <a href=\"https://elixir.bootlin.com/linux/v3.19.8/source/include/linux/socket.h#L47\" rel=\"nofollow noreferrer\"><code>struct msghdr</code></a> is divided into <code>struct msghdr</code> and <code>struct user_msghdr</code>.</p>\n\n<p>Now <code>struct user_msghdr</code> containes <code>msg_iov</code> and <code>msg_iovlen</code>. But <strong><a href=\"https://elixir.bootlin.com/linux/v3.19.8/source/include/linux/uio.h#L28\" rel=\"nofollow noreferrer\"><code>struct iov_iter</code></a></strong> must be used instead of <code>msg_iov</code> and <code>msg_iovlen</code>.</p>\n\n<p>Something like:</p>\n\n<pre><code>struct msghdr msg;\nstruct iovec iov;\niov.iov_base = buffer;\niov.iov_len  = length;\n\n/* fill in msg */\n\n#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(3,19,0)\nmsg.msg_iov = &amp;iov;\nmsg.msg_iovlen = 1;\n#else\niov_iter_init(&amp;msg.msg_iter, READ, &amp;iov, 1, length);\n#endif\n\n/* ... */\n/* call sock_recvmsg() or kernel_recvmsg() */\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 7475762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3df3ea102c8a901f32fbc257bdf95597?s=128&d=identicon&r=PG&f=1", "display_name": "user3272", "link": "https://stackoverflow.com/users/7475762/user3272"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 658, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1565167274, "creation_date": 1565161910, "last_edit_date": 1565167274, "question_id": 57388814, "link": "https://stackoverflow.com/questions/57388814/error-struct-msghdr-has-no-member-named-msg-iov", "title": "error: \u2018struct msghdr\u2019 has no member named \u2018msg_iov\u2019", "body": "<p>I am writing unix socket in kernel module and when I try to compile, I get the following errors:</p>\n\n<blockquote>\n  <p>error: \u2018struct msghdr\u2019 has no member named \u2018msg_iov\u2019</p>\n  \n  <p>error: \u2018struct msghdr\u2019 has no member named \u2018msg_iovlen\u2019</p>\n</blockquote>\n\n<p>I try read the implementation of <code>msghdr</code> but I didn't find anything.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>ret = kernel_recvmsg(sock, msg, vec, BUFFER_SIZE, BUFFER_SIZE, 0);\n\nmsg_iov = msg-&gt;msg_iov;\nmsg_iovlen = msg-&gt;msg_iovlen;\n</code></pre>\n"}, {"tags": ["c", "graphics", "colors", "bitmap", "vga"], "answers": [{"tags": [], "owner": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "is_accepted": true, "score": 1, "last_activity_date": 1565159013, "last_edit_date": 1565159013, "creation_date": 1565158676, "answer_id": 57388044, "question_id": 57387883, "link": "https://stackoverflow.com/questions/57387883/trouble-drawing-pixels-in-640x480-16-color-vga-mode/57388044#57388044", "title": "Trouble drawing pixels in 640x480 16-color VGA mode", "body": "<p>The 16 color mode is <em>planar</em>, which means one byte is eight pixels and will set the specific bits of the pixels. There is a mask register in port 0x3c4 index 2 where you set which planes you want to set when you write to the memory. It\u2019s a lot more complicated than using a byte-per-pixel mode. </p>\n\n<p>You can get more information about the Plane Write Enable register and different graphics modes from for example the <a href=\"https://wiki.osdev.org/VGA_Hardware\" rel=\"nofollow noreferrer\">OSDev Wiki</a></p>\n"}], "owner": {"reputation": 113, "user_id": 9583282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/T97ED.jpg?s=128&g=1", "display_name": "Dagoth Ur", "link": "https://stackoverflow.com/users/9583282/dagoth-ur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 463, "favorite_count": 0, "accepted_answer_id": 57388044, "answer_count": 1, "score": 0, "last_activity_date": 1565159013, "creation_date": 1565157896, "question_id": 57387883, "link": "https://stackoverflow.com/questions/57387883/trouble-drawing-pixels-in-640x480-16-color-vga-mode", "title": "Trouble drawing pixels in 640x480 16-color VGA mode", "body": "<p>I am trying to draw a single red pixel in VGA video mode 12 in C. The code that I have written works as expected in video mode 13 (200p 256 colors).</p>\n\n<pre><code>volatile char *video = (volatile char*) 0xA0000;\n*video = 4;\n</code></pre>\n\n<p>In video mode 13, a single red pixel is drawn on-screen. This is what I want to happen in video mode 12. When this code is used with video mode 12, what appear to be representations of the bits in the byte sent are displayed (i.e. the byte 00011000 is copied, three black pixels, two white pixels, and three more black pixels are displayed.</p>\n"}, {"tags": ["c++", "c", "node.js"], "comments": [{"owner": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 2, "creation_date": 1565157606, "post_id": 57387654, "comment_id": 101258617, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/29165155/calling-javascript-from-c-with-node-js\">Calling JavaScript from C++ with node.js</a>"}, {"owner": {"reputation": 1255, "user_id": 1861447, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d61fb7b17b58891bf414b9d53e7bbb0d?s=128&d=identicon&r=PG", "display_name": "Austin", "link": "https://stackoverflow.com/users/1861447/austin"}, "reply_to_user": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 0, "creation_date": 1565159061, "post_id": 57387654, "comment_id": 101259151, "body": "@Alan Birtles, Thanks for pointing. I hope in that answer, still a .js file is used. My question is about to avoid .js file and execute the in-memory script. For second part of my question, probably the answer may be useful, I need to check though."}, {"owner": {"reputation": 1092, "user_id": 9167609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/141aa63001cf2ec7ffbb8672be1c97aa?s=128&d=identicon&r=PG&f=1", "display_name": "Vishal-Lia", "link": "https://stackoverflow.com/users/9167609/vishal-lia"}, "edited": false, "score": 0, "creation_date": 1565160002, "post_id": 57387654, "comment_id": 101259515, "body": "You mean the whole script is in form of a character buffer in C/C++ code which needs to be run? Why is everything in buffer which part of code is dynamic?"}, {"owner": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 0, "creation_date": 1565160138, "post_id": 57387654, "comment_id": 101259576, "body": "As far as I can tell the answer to that question is still valid which is basically node.js only has an addon API so the only way is to execute node from the command line."}, {"owner": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 0, "creation_date": 1565160328, "post_id": 57387654, "comment_id": 101259673, "body": "see also <a href=\"https://stackoverflow.com/questions/5525162/how-to-embed-node-js-interpreter-into-c-c\" title=\"how to embed node js interpreter into c c\">stackoverflow.com/questions/5525162/&hellip;</a>"}, {"owner": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 0, "creation_date": 1565160544, "post_id": 57387654, "comment_id": 101259749, "body": "and <a href=\"https://github.com/metacall/core\" rel=\"nofollow noreferrer\">github.com/metacall/core</a>"}, {"owner": {"reputation": 1255, "user_id": 1861447, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d61fb7b17b58891bf414b9d53e7bbb0d?s=128&d=identicon&r=PG", "display_name": "Austin", "link": "https://stackoverflow.com/users/1861447/austin"}, "reply_to_user": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 0, "creation_date": 1565753891, "post_id": 57387654, "comment_id": 101446353, "body": "@Alan Birtles, still I am not clear. Using addons, I can make a node module, and can call addon module apis from nodejs. In my case, process starts with c/c++ executable, and I need to call nodejs function/api. Can you please write the answer with an example code."}, {"owner": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 1, "creation_date": 1565764922, "post_id": 57387654, "comment_id": 101449068, "body": "I don&#39;t think it&#39;s easily possible, your best option looks like the meta call library"}, {"owner": {"reputation": 1255, "user_id": 1861447, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d61fb7b17b58891bf414b9d53e7bbb0d?s=128&d=identicon&r=PG", "display_name": "Austin", "link": "https://stackoverflow.com/users/1861447/austin"}, "reply_to_user": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 0, "creation_date": 1565796096, "post_id": 57387654, "comment_id": 101464987, "body": "@AlanBirtles I did some more R&amp;D. I am starting nodjs script from command line. Using N-API, I am able to execute simple javascripts from c/c++ code. But when I try to execute puppeteer script as shown in question above, it gets exception at require line (1st line). Any idea, why this happens."}, {"owner": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 0, "creation_date": 1565796412, "post_id": 57387654, "comment_id": 101465172, "body": "is puppeteer installed in the environment you are running the script under?"}, {"owner": {"reputation": 1255, "user_id": 1861447, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d61fb7b17b58891bf414b9d53e7bbb0d?s=128&d=identicon&r=PG", "display_name": "Austin", "link": "https://stackoverflow.com/users/1861447/austin"}, "edited": false, "score": 0, "creation_date": 1565798934, "post_id": 57387654, "comment_id": 101466413, "body": "Yes, puppeteer is installed. In index.js (that I run from command line), require(&#39;puppeteer&#39;); works fine. But when I keep it in a string and executes through napi_run_script api, it gets exception."}, {"owner": {"reputation": 1255, "user_id": 1861447, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d61fb7b17b58891bf414b9d53e7bbb0d?s=128&d=identicon&r=PG", "display_name": "Austin", "link": "https://stackoverflow.com/users/1861447/austin"}, "reply_to_user": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 0, "creation_date": 1565800711, "post_id": 57387654, "comment_id": 101467180, "body": "@AlanBirtles, is it true that whatever can be run by V8, only those syntax / function etc should be there in string that I run as javascript through  napi_run_script. Nodejs does more than V8, like DOM handling etc, can those be part of JS that can be executed by napi_run_script."}, {"owner": {"reputation": 1255, "user_id": 1861447, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d61fb7b17b58891bf414b9d53e7bbb0d?s=128&d=identicon&r=PG", "display_name": "Austin", "link": "https://stackoverflow.com/users/1861447/austin"}, "reply_to_user": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 0, "creation_date": 1565916334, "post_id": 57387654, "comment_id": 101503183, "body": "@AlanBirtles, did you use metacall anytime. I gave a try, though I could build, but execution result not satisfactory."}, {"owner": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 0, "creation_date": 1565935688, "post_id": 57387654, "comment_id": 101506600, "body": "No, i just found it through googling your problem"}], "owner": {"reputation": 1255, "user_id": 1861447, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d61fb7b17b58891bf414b9d53e7bbb0d?s=128&d=identicon&r=PG", "display_name": "Austin", "link": "https://stackoverflow.com/users/1861447/austin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 320, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1565159433, "creation_date": 1565156658, "last_edit_date": 1565159433, "question_id": 57387654, "link": "https://stackoverflow.com/questions/57387654/run-a-nodejs-in-memory-script", "title": "Run a nodejs in-memory script", "body": "<p>I am having C/C++ based application. I want to run nodejs script from my C code. The nodejs script looks as below.</p>\n\n<pre><code>const puppeteer = require('puppeteer');\n(async () =&gt; {\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n  await page.goto('https://google.com');\n  await page.screenshot({path: 'some.png'});\n  await browser.close();\n})();\n</code></pre>\n\n<p>This script is generated in C code and available in memory. I can dump it to a file and using system() api, I can run the script. I want to avoid that. Is it possible to run the script, present in memory directly using nodejs without dumping it to file.</p>\n\n<p>While executing, if any exception occurs I need to report it back to my C/C++ application through a callback. Is this possible?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I know there is a similar question / answer at <a href=\"https://stackoverflow.com/questions/29165155/calling-javascript-from-c-with-node-js\">Calling JavaScript from C++ with node.js</a> , but here still .js file will be in disk and it is executed. Here my question is, how to run nodjs from C/C++ application where the script is available in memory.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 3599, "user_id": 2487517, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/cRCpa.jpg?s=128&g=1", "display_name": "Tibrogargan", "link": "https://stackoverflow.com/users/2487517/tibrogargan"}, "edited": false, "score": 0, "creation_date": 1565152811, "post_id": 57386968, "comment_id": 101257404, "body": "Should be <code>%lf</code>, not <code>%1f</code>.  (Use a better font).  You&#39;re reading one character into a memory address you&#39;re claiming is a float (not a double).  lowercase <code>L</code>, not the number one"}, {"owner": {"reputation": 1084, "user_id": 11551238, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xSJfc.png?s=128&g=1", "display_name": "Cabbage Champion", "link": "https://stackoverflow.com/users/11551238/cabbage-champion"}, "edited": false, "score": 0, "creation_date": 1565205577, "post_id": 57386968, "comment_id": 101283625, "body": "It doesn&#39;t have to be my answer but you should choose a correct answer."}], "answers": [{"tags": [], "owner": {"reputation": 1084, "user_id": 11551238, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xSJfc.png?s=128&g=1", "display_name": "Cabbage Champion", "link": "https://stackoverflow.com/users/11551238/cabbage-champion"}, "is_accepted": true, "score": 3, "last_activity_date": 1565153534, "last_edit_date": 1565153534, "creation_date": 1565153103, "answer_id": 57387088, "question_id": 57386968, "link": "https://stackoverflow.com/questions/57386968/scanf-function-is-printing-out-irrelevancies/57387088#57387088", "title": "scanf function is printing out irrelevancies", "body": "<p><strong>Your Problem</strong> \nThe issue roots from that you are using %f to write into a <code>double</code> instead of a float. Thus to fix the issue you can either change you format specifier to <code>lf</code> or change the data type of your variables to <code>float</code></p>\n\n<p><strong>Solution 1</strong></p>\n\n<pre><code>float decOne,decTwo,mulOne;\n...\nscanf(\"%1f %1f\", &amp;decOne, &amp;decTwo);\n</code></pre>\n\n<p>or</p>\n\n<p><strong>Solution 2</strong></p>\n\n<pre><code>double decOne,decTwo,mulOne;\n...\nscanf(\"%lf %lf\", &amp;decOne, &amp;decTwo);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17, "user_id": 10742472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4aa33c28d72899a885a2882cf325be1?s=128&d=identicon&r=PG&f=1", "display_name": "Nitish", "link": "https://stackoverflow.com/users/10742472/nitish"}, "is_accepted": false, "score": -1, "last_activity_date": 1565153384, "creation_date": 1565153384, "answer_id": 57387135, "question_id": 57386968, "link": "https://stackoverflow.com/questions/57386968/scanf-function-is-printing-out-irrelevancies/57387135#57387135", "title": "scanf function is printing out irrelevancies", "body": "<p>The format specifier for double data type in C language is %lf. Replace %1f in your scanf to %lf. </p>\n"}], "owner": {"reputation": 11, "user_id": 7805416, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HZy04.jpg?s=128&g=1", "display_name": "saiasI", "link": "https://stackoverflow.com/users/7805416/saiasi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "closed_date": 1565153950, "accepted_answer_id": 57387088, "answer_count": 2, "score": 0, "last_activity_date": 1565154099, "creation_date": 1565152070, "question_id": 57386968, "link": "https://stackoverflow.com/questions/57386968/scanf-function-is-printing-out-irrelevancies", "closed_reason": "Duplicate", "title": "scanf function is printing out irrelevancies", "body": "<p>I recently (three days ago) began coding in c and i cannot understand why the final scanf is breaking my code.</p>\n\n<p>I checked the syntax and from what i can tell it is correct.\nI revised the final segment to multiply integers instead of doubles, and it worked.\nI revised the final segment to multiply floats instead of doubles, and it broke.</p>\n\n<pre><code>int main()\n{\n    // add two numbers\n    int addOne,addTwo,sumOne;\n    printf(\"Please enter two integers: \");\n    scanf(\"%d %d\",&amp;addOne,&amp;addTwo);\n    sumOne = addOne + addTwo;\n    printf(\"The sum of these two numbers is: %d\\n\",sumOne);\n\n    // above code works.\n    // multiply two decimals\n\n    double decOne,decTwo,mulOne;\n    printf(\"Please enter two decimals: \");\n    scanf(\"%1f %1f\",&amp;decOne,&amp;decTwo);\n    mulOne = decOne*decTwo;\n    printf(\"the multiplication of the two decimals entered is: %1f \\n\", mulOne);\n\n\n    return 0;\n}\n</code></pre>\n\n<p>I expect to be able to intput two decimals and see the product.\nInstead i can only enter one and it prints out: </p>\n\n<p>Please enter two decimals: 1.2\nthe multiplication of the two decimals entered is: 241638106882447.190000</p>\n"}, {"tags": ["c", "shell", "loops", "makefile"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1565151826, "post_id": 57386910, "comment_id": 101257174, "body": "Why in the Makefile? Why not just write a separate test script?"}, {"owner": {"reputation": 86085, "user_id": 128940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d35101b4060dc3af0d5c1b7c42c4935?s=128&d=identicon&r=PG&f=1", "display_name": "Beta", "link": "https://stackoverflow.com/users/128940/beta"}, "edited": false, "score": 0, "creation_date": 1565155036, "post_id": 57386910, "comment_id": 101257924, "body": "Do you want to run the tests in series, or in parallel?"}], "answers": [{"comments": [{"owner": {"reputation": 13458, "user_id": 1773798, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4Ljqn.png?s=128&g=1", "display_name": "Renaud Pacalet", "link": "https://stackoverflow.com/users/1773798/renaud-pacalet"}, "edited": false, "score": 1, "creation_date": 1565180769, "post_id": 57387837, "comment_id": 101270410, "body": "Nice proposal. May I suggest to declare <code>main</code> as a prerequisite of <code>output%.txt</code> and to get completely rid of the useless <code>all</code> target? And also to replace <code>rm *.txt</code> by <code>rm -f $(TESTS)</code>? I guess the OP does not want to delete his potentially precious <code>test*.txt</code> files and may also want to keep results of the other tests than the ones that were just performed..."}, {"owner": {"reputation": 12462, "user_id": 2298137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/JN0cS.png?s=128&g=1", "display_name": "code_fodder", "link": "https://stackoverflow.com/users/2298137/code-fodder"}, "reply_to_user": {"reputation": 13458, "user_id": 1773798, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4Ljqn.png?s=128&g=1", "display_name": "Renaud Pacalet", "link": "https://stackoverflow.com/users/1773798/renaud-pacalet"}, "edited": false, "score": 0, "creation_date": 1565184979, "post_id": 57387837, "comment_id": 101273164, "body": "@RenaudPacalet both good points, I wanted to stick in a rule to do more then one thing just for show - but as you say, it is not very useful. But what is <b>really</b> un-useful was to delete all the OPs <code>test*.txt</code> files - good spot : )))))"}, {"owner": {"reputation": 13458, "user_id": 1773798, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4Ljqn.png?s=128&g=1", "display_name": "Renaud Pacalet", "link": "https://stackoverflow.com/users/1773798/renaud-pacalet"}, "edited": false, "score": 1, "creation_date": 1565190632, "post_id": 57387837, "comment_id": 101276577, "body": "Better. But why do you declare <code>main</code> as a order-only prerequisite of the <code>.PHONY</code> special target (don&#39;t even know what the effect could be)? Why don&#39;t you just declare <code>main</code> as a regular target of all <code>output%.txt</code>? After all, if <code>main</code> changes, the tests should probably be re-run, don&#39;t you think?"}, {"owner": {"reputation": 12462, "user_id": 2298137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/JN0cS.png?s=128&g=1", "display_name": "code_fodder", "link": "https://stackoverflow.com/users/2298137/code-fodder"}, "reply_to_user": {"reputation": 13458, "user_id": 1773798, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4Ljqn.png?s=128&g=1", "display_name": "Renaud Pacalet", "link": "https://stackoverflow.com/users/1773798/renaud-pacalet"}, "edited": false, "score": 0, "creation_date": 1565199104, "post_id": 57387837, "comment_id": 101280808, "body": "@RenaudPacalet also good point, not sure what I was thinking there : )"}], "tags": [], "owner": {"reputation": 12462, "user_id": 2298137, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/JN0cS.png?s=128&g=1", "display_name": "code_fodder", "link": "https://stackoverflow.com/users/2298137/code-fodder"}, "is_accepted": false, "score": 4, "last_activity_date": 1565199076, "last_edit_date": 1565199076, "creation_date": 1565157715, "answer_id": 57387837, "question_id": 57386910, "link": "https://stackoverflow.com/questions/57386910/how-to-loop-through-n-test-cases-in-makefile/57387837#57387837", "title": "How To Loop through n Test cases In Makefile?", "body": "<p><strong>Now updated to answer the question properly</strong></p>\n\n<p>What you might want to do (by the look of it) is have your makefile do various things for you:</p>\n\n<pre><code># Target to build \"main\" its the first target and therefore the default \n# call \"make\" to run\nmain:\n    @gcc main.c -o main\n\n# Arbitrary max number of tests, can be overwritten by passing the variable in\nNUM_TESTS=100\n# Find all the tests, put them into an ordered list, then take the first \n# 1 to NUM_TESTS of them. Finally substitute test* for output*\nTEST_OUTPUTS=$(subst test,output,$(wordlist 1,$(NUM_TESTS),$(sort $(wildcard test*.txt))))\n\n# Target to do your testing, call \"make test NUM_TESTS=3\" or \"make test\" \n# to run all tests (up to 100).\n.PHONY: test\ntest: $(TEST_OUTPUTS)\n\n# Pattern rule to run each test - you don't call this directly\n# Note: this has a dependency on main so if main is not built it \n# will get built first\noutput%.txt: test%.txt main\n    @./main &lt; $&lt; &gt; $@\n\n# Target to clean up output files, call \"make clean\"\n.PHONY: clean\nclean:\n    rm -f main\n    rm -f $(TEST_OUTPUTS)\n</code></pre>\n\n<p>Use by:</p>\n\n<ul>\n<li><code>make build</code> - build main</li>\n<li><code>make test</code> - run all tests that are found upto 100 (the max can be changed)</li>\n<li><code>make test NUM_TESTS=3</code> - run the first 3 tests (if they exist found)</li>\n<li><code>make test NUM_TESTS=3 -j6</code> - same as before but run 6 parallel jobs (or use <code>-j</code> for as many parallel jobs as possible) - i.e. run the tests in parallel</li>\n</ul>\n\n<p>Explanation:\nThe pattern rule will generate a file output*.txt depending on the file test*.txt. But we want to call the rule <code>outputX.txt</code> for this we generate a list of output files by searching for all output files (in variable <code>TEST_OUTPUTS</code>) and then selecting the number of tests we want. We can do this by passing in a variable or if we don't pass in a variable then it does upto 100 tests (or whatever you set the maximum to be.</p>\n\n<p><strong>Note:</strong> I did not run this, so I would consider is to be pseudo code, but it should be pretty close)</p>\n"}], "owner": {"reputation": 83, "user_id": 4630878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e8f6fb623400f69dc13a25456d050f5?s=128&d=identicon&r=PG&f=1", "display_name": "Coder Motor", "link": "https://stackoverflow.com/users/4630878/coder-motor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1565199076, "creation_date": 1565151618, "question_id": 57386910, "link": "https://stackoverflow.com/questions/57386910/how-to-loop-through-n-test-cases-in-makefile", "title": "How To Loop through n Test cases In Makefile?", "body": "<p>I want my Makefile to automate my testing for me. Basically I would have a bunch of test cases that my code runs on. I want the user to specify the number of test cases rather than that being hard coded in.</p>\n\n<p>Basically I want something like this:</p>\n\n<pre><code>gcc main.c -o main\n\n./main &lt; test1.txt &gt; output1.txt\n./main &lt; test2.txt &gt; output2.txt\n./main &lt; test3.txt &gt; output3.txt\n./main &lt; test4.txt &gt; output4.txt\n.\n.\n.\n./main &lt; test&lt;n&gt;.txt &gt; output&lt;n&gt;.txt #for some value n\n</code></pre>\n\n<p>And turn it into something like this:</p>\n\n<pre><code>gcc main.c -o main\n\n#of course this wouldn't be the syntax, but I just need the Makefile version of a loop, where all one has to do is change the n value \nfor(int i = 0; i &lt; n+1; i++){\n   ./main &lt; test&lt;i&gt;.txt &gt; output&lt;i&gt;.txt;\n}\n\n</code></pre>\n\n<p>Thanks :)</p>\n"}, {"tags": ["c", "pointers", "memory", "stack"], "comments": [{"owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "edited": false, "score": 0, "creation_date": 1565151169, "post_id": 57386771, "comment_id": 101257032, "body": "can you show the structure definition of the list?"}, {"owner": {"reputation": 39, "user_id": 11800697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50e62603a5673cd420523e79cc5667a7?s=128&d=identicon&r=PG&f=1", "display_name": "psharma11", "link": "https://stackoverflow.com/users/11800697/psharma11"}, "reply_to_user": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "edited": false, "score": 0, "creation_date": 1565151585, "post_id": 57386771, "comment_id": 101257125, "body": "updated it :):)"}, {"owner": {"reputation": 3599, "user_id": 2487517, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/cRCpa.jpg?s=128&g=1", "display_name": "Tibrogargan", "link": "https://stackoverflow.com/users/2487517/tibrogargan"}, "edited": false, "score": 0, "creation_date": 1565151959, "post_id": 57386771, "comment_id": 101257196, "body": "Referring to this line (and the comment right after it): <code>int *test1 = &amp;chartonum;</code>  This is only chartonum for the infintesimal amount of time before it goes out of scope and wanders off into undefined behavior territory."}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 11800697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50e62603a5673cd420523e79cc5667a7?s=128&d=identicon&r=PG&f=1", "display_name": "psharma11", "link": "https://stackoverflow.com/users/11800697/psharma11"}, "edited": false, "score": 0, "creation_date": 1565151707, "post_id": 57386891, "comment_id": 101257151, "body": "The memory is allocated in the if statement right before that line"}, {"owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "reply_to_user": {"reputation": 39, "user_id": 11800697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50e62603a5673cd420523e79cc5667a7?s=128&d=identicon&r=PG&f=1", "display_name": "psharma11", "link": "https://stackoverflow.com/users/11800697/psharma11"}, "edited": false, "score": 1, "creation_date": 1565152054, "post_id": 57386891, "comment_id": 101257222, "body": "The memory for the element is allocated, but the <code>data</code> is also a pointer. This also needs to have memory allocated. You really do not need to use such a complicated structure for your stack, since you are storing characters anyway, But, if you insist on using this, you need to allocate memory for <code>data</code> and <code>free</code> at the end of the program"}], "tags": [], "owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "is_accepted": false, "score": 3, "last_activity_date": 1565151443, "creation_date": 1565151443, "answer_id": 57386891, "question_id": 57386771, "link": "https://stackoverflow.com/questions/57386771/stack-head-and-tail-updating-to-same-value-but-only-calling-update-on-head-c-pr/57386891#57386891", "title": "Stack head and tail updating to same value but only calling update on head- C programming", "body": "<p>Since this is a list of strings, you need to have a separate memory for the string per node.</p>\n\n<p>You are using <code>new_element-&gt;data = (void *)data;</code> This tells me that you are just copying the pointers. You need to allocate new memory for each string in the insert function by using <code>malloc</code> or <code>strdup</code> </p>\n"}], "owner": {"reputation": 39, "user_id": 11800697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50e62603a5673cd420523e79cc5667a7?s=128&d=identicon&r=PG&f=1", "display_name": "psharma11", "link": "https://stackoverflow.com/users/11800697/psharma11"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565151685, "creation_date": 1565150418, "last_edit_date": 1565151685, "question_id": 57386771, "link": "https://stackoverflow.com/questions/57386771/stack-head-and-tail-updating-to-same-value-but-only-calling-update-on-head-c-pr", "title": "Stack head and tail updating to same value but only calling update on head- C programming", "body": "<p>I am writing a program to add two strings of integers and push them onto a stack to add them.</p>\n\n<p>For some reason when I call the push method it is only pushing the very last digit of the number onto the stack.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#define list_data(l) ((l)-&gt;data)\n\ntypedef struct ListElmt_{ \n    void *data; //void pointer data because we cant point it to whatever\n                //kind of datatype that we want\n    struct ListElmt_ *next; //next pointer which points to next element\n\n}ListElmt;\n\n/*\n * Singly-linked list\n */\ntypedef struct List_{\n    int size; //number of elements that we want in the list\n\n    int (*match)(const void *key1, const void *key2);\n    void(*destroy)(void *data); //destroy is a pointer to a function that \n                                //takes a void pointer and returns void\n\n    ListElmt *head;\n    ListElmt *tail;\n\n}List;\n\n/*\n Public interface\n\n */\n\nvoid list_init(List *list, void (*destroy)(void *data));\n//a constructor for the list\n\nint list_ins_next(List *list, ListElmt *element, const void *data);\n//takes a list parameter, the pointer to element and a constant void parameter\n//if return type is 0 then it is success\n\nint list_rem_next(List *list, ListElmt *element, void **data);\n//pointer to list, second parameter is the pointer to the next element\n//third parameter is a pointer to a pointer allows caller to have a pointer to the pointer for the data that got removed\n\n\n#define list_size(list)((list)-&gt;size)\n//creates a function to access the size of the list\n\n#define list_head(list)((list)-&gt;head)\n//creates a function to access the head pointer of the list\n\n#define list_tail(list)((list)-&gt;tail)\n//creates a function to access the tail pointer\n\n#define list_is_head(list, element)((element)==(list)-&gt;head ? 1 :0)\n//returns true or false if the element is the head of the list\n\n#define list_is_tail(element)((element)-&gt;next == NULL ? 1:0)\n//returns true or false if the element is tail of the list if nextpointer is Null\n\n#define list_is_data(element)((element)-&gt;data)\n//takes an element pointer and gets the data in the element\n\n#define list_next(element)((element)-&gt;next)\n//takes an element and gets the next element\n\n</code></pre>\n\n<p>List Init Function:</p>\n\n<pre><code>    number-&gt;size = 0; //initializes size and a destroy function\n    number-&gt;destroy = destroy;\n    number-&gt;head = NULL;//initializes head and tail pointer\n    number-&gt;tail = NULL;\n\n}\n\ntypedef List Stack;\n\n#define stack_init list_init\n\n#define stack_destroy list_destroy\n\nint stack_push(Stack *stack, const void *data);\n\nint stack_pop(Stack *stack, void **data);\n\n#define stack_peek(stack)((stack)-&gt;head==NULL ? NULL: (stack)-&gt;head-&gt;data)\n\n#define stack_size list_size\n</code></pre>\n\n<p>Insert Function for the stack: </p>\n\n<pre><code>\n    ListElmt *new_element;\n    //allocate storage for the element;\n    if(((new_element) = (ListElmt *)malloc(sizeof(ListElmt))) == NULL){\n        return -1;\n    }\n\n        //insert the element into the list\n    new_element-&gt;data = (void *)data;\n    if(element == NULL){\n        /*Handle insertion at the head of the list*/\n        if(list_size(stack)==0){\n            printf(\"The list size is 0: \\n\");//if list is empty then new head is also tail\n            stack-&gt;tail = new_element; //sets tail as new element\n            printf(\"The tail is this jeint: %d\\n\",*(int *)stack-&gt;tail-&gt;data);\n            new_element -&gt;next = stack-&gt;head;//new element's next pointer is old head\n            stack -&gt;head = new_element;\n            printf(\"This is the head of the stack: %d\\n\",*(int *)list_head(stack)-&gt;data);\n            printf(\"This is the tail of the stack: %d\\n\",*(int *)list_tail(stack)-&gt;data);\n        }else{\n            new_element -&gt;next = stack-&gt;head;//new element's next pointer is old head\n            stack -&gt;head = new_element;\n            printf(\"This is the head of the stack: %d\\n\",*(int *)list_head(stack)-&gt;data);\n            printf(\"This is the tail of the stack: %d\\n\",*(int *)list_tail(stack)-&gt;data);\n        }\n\n\n        //lists head points to new element\n        //lists head and tail are the same, head has a next poitner to null\n\n    }else{\n        printf(\"We made it to the else: \");\n        if (element-&gt;next == NULL){\n            stack-&gt;tail = new_element;\n\n        }\n        new_element-&gt;next = element-&gt;next;\n        element-&gt;next = new_element;\n\n    }\n\n    stack -&gt;size++;\n    return 0;\n\n}\n</code></pre>\n\n<p>List remove function: </p>\n\n<pre><code>int list_rem_next(Stack *stack, ListElmt *element, void **data){\n\n    ListElmt *old_element;\n\n    if(stack_size(stack)==0){\n        return -1; //checks if the size if 0 because you can't remove anything\n    }\n    /*remove the element from the list*/\n    if(element == NULL){\n        //handle removal from the head of list\n        *data = stack-&gt;head-&gt;data;\n        old_element = stack-&gt;head;\n        stack-&gt;head = stack-&gt;head-&gt;next;\n\n        if(stack_size(stack)==1){\n            stack-&gt;tail = NULL;\n        }\n    }else{\n     //handle removal from somewhere other than the head\n        if(element -&gt;next == NULL){\n            return -1;\n\n        }\n        *data = element-&gt;next-&gt;data;\n        old_element = element -&gt;next;\n        element-&gt;next = element -&gt;next-&gt;next;\n        if(element-&gt;next == NULL){\n            stack-&gt;tail = element;\n        }\n\n    }\n    //Free the storage allocated by the abstract data type\n    free(old_element);\n\n    //Adjust the size of the list to account for the removed element\n    stack-&gt;size --;\n    return 0;\n}\n</code></pre>\n\n<p>Push method </p>\n\n<pre><code>int stack_push(Stack *stack, const void *data){\n    return list_ins_next(stack, NULL, data);\n}\n</code></pre>\n\n<p>Pop function</p>\n\n<pre><code>int stack_pop(Stack *stack, void **data){\n    return list_rem_next(stack,NULL,data);\n}\n</code></pre>\n\n<p>Function to get size of string:</p>\n\n<pre><code>int getsize(char *s){\n    char *t;\n    int size=0;\n    for(t=s;*t !='\\0';t++){\n        size++;\n    }\n    return size;\n\n}\n</code></pre>\n\n<p>Function to add the numbers: </p>\n\n<pre><code>void addLargeNumbers(char *number1, char *number2){  \n    Stack num1;\n    Stack num2;\n    Stack answer;\n\n    stack_init(&amp;num1,free);\n    stack_init(&amp;num2,free);\n    stack_init(&amp;answer,free);\n\n    int length1 = getsize(number1);\n    int length2 = getsize(number2);\n\n    for(int i=0;i&lt;length1;i++){\n\n        int chartonum = number1[i]-'0';\n        int *test1 = &amp;chartonum;\n        printf(\"This is chartonum: %d\\n\",chartonum);\n        printf(\"This is test1: %d\\n\",*test1);\n        stack_push(&amp;num1,test1);\n        printf(\"Just pushed: %d\\n\",*test1);\n\n    }\n\n    for(int j=0;j&lt;length2;j++){\n        printf(\"We are about to push %c in the second stack \\n\",number2[j]);\n        int chartonum2 = number2[j]-'0';\n        int *test2 = &amp;chartonum2;\n        stack_push(&amp;num2,test2);\n\n    }\n\n\n\n    int* checking;\n    stack_pop(&amp;num1,&amp;checking);\n    printf(\"This is the number we just popped: %d\\n\",*checking);\n\n\n    printf(\"This is the size of stack1 %d\\n\",num1.size);\n    printf(\"This is the size of stack2 %d\\n\",num2.size);\n\n    int carry;\n\n    while(num1.size &gt;0 &amp;&amp; num2.size &gt;0){\n        int *result1, *result2;\n        stack_pop(&amp;num1, (void **) &amp;result1);\n        stack_pop(&amp;num2, (void **) &amp;result2);\n\n        printf(\"This is the number we just popped from stack1: %d \\n\",*result1);\n        printf(\"This is the number we just popped:%d \\n\",*result2);\n\n        printf(\"result1: %d\\n\",*result1);\n        printf(\"result2: %d\\n\", *result2);\n        int sum = *result1 + *result2 + carry;\n        printf(\"sum:%d\\n\",sum);\n        int leastSigDig = sum % 10;\n\n        printf(\"lsd: %d\\n\", leastSigDig);\n\n        /* Push the least significant digit of the sum */\n        stack_push(&amp;answer, &amp;leastSigDig);\n\n        /* Carry the most significant digit to the next cycle */\n        carry = (sum &gt; 9) ? sum / 10 : 0;\n        printf(\"carry: %d\\n\", carry);\n    }\n\n//    printf(\"Result: %d\\n\", *(int *)answer.head-&gt;data);\n\n    printf(\"Stack size check: %d\\n\", answer.size);\n\n\n    while(answer.size)\n    {\n        char* elem;\n        stack_pop(&amp;answer, (void**) &amp;elem);\n        printf(\"%s\", elem);\n    }\n    /* Probably better to return the answer rather than print... */\n}\n</code></pre>\n\n<p>Main:</p>\n\n<pre><code>int main() {\n    addLargeNumbers(\"153\",\"329\");\n\n\n\n    return (EXIT_SUCCESS);\n}\n</code></pre>\n\n<p>This is the output </p>\n\n<pre><code>\nThis is chartonum: 1\nThis is test1: 1\nThe list size is 0: \nThe tail is this jeint: 1\nThis is the head of the stack: 1\nThis is the tail of the stack: 1\nJust pushed: 1\nThis is chartonum: 5\nThis is test1: 5\nThis is the head of the stack: 5\nThis is the tail of the stack: 5\nJust pushed: 5\nThis is chartonum: 3\nThis is test1: 3\nThis is the head of the stack: 3\nThis is the tail of the stack: 3\nJust pushed: 3\nWe are about to push 3 in the second stack \nThe list size is 0: \nThe tail is this jeint: 3\nThis is the head of the stack: 3\nThis is the tail of the stack: 3\nWe are about to push 2 in the second stack \nThis is the head of the stack: 2\nThis is the tail of the stack: 2\nWe are about to push 9 in the second stack \nThis is the head of the stack: 9\nThis is the tail of the stack: 9\nThis is the number we just popped: 3\nThis is the size of stack1 2\nThis is the size of stack2 3\nThis is the number we just popped from stack1: 3 \nThis is the number we just popped:9 \nresult1: 3\nresult2: 9\nsum:12\nlsd: 2\nThe list size is 0: \nThe tail is this jeint: 2\nThis is the head of the stack: 2\nThis is the tail of the stack: 2\ncarry: 1\nThis is the number we just popped from stack1: 3 \nThis is the number we just popped:9 \nresult1: 3\nresult2: 9\nsum:13\nlsd: 3\nThis is the head of the stack: 3\nThis is the tail of the stack: 3\ncarry: 1\nStack size check: 2\n</code></pre>\n"}, {"tags": ["c", "file"], "comments": [{"owner": {"reputation": 3885, "user_id": 652528, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a580420b66f89e76e1fb9a368f785b3f?s=128&d=identicon&r=PG", "display_name": "geckos", "link": "https://stackoverflow.com/users/652528/geckos"}, "edited": false, "score": 0, "creation_date": 1565144412, "post_id": 57386139, "comment_id": 101255888, "body": "Wont <code>O_TRUNC</code> truncate the file on opening?"}], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 11010869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e15421a384cb3301964a495ae844fce?s=128&d=identicon&r=PG&f=1", "display_name": "goodknight", "link": "https://stackoverflow.com/users/11010869/goodknight"}, "edited": false, "score": 0, "creation_date": 1565144417, "post_id": 57386167, "comment_id": 101255889, "body": "I added it to the flags section and it did not append the file. It is still only printing one line in the file."}, {"owner": {"reputation": 332, "user_id": 8778930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d1a2346b21fe5f024d1be413eb2588b?s=128&d=identicon&r=PG&f=1", "display_name": "mewi", "link": "https://stackoverflow.com/users/8778930/mewi"}, "reply_to_user": {"reputation": 83, "user_id": 11010869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e15421a384cb3301964a495ae844fce?s=128&d=identicon&r=PG&f=1", "display_name": "goodknight", "link": "https://stackoverflow.com/users/11010869/goodknight"}, "edited": false, "score": 0, "creation_date": 1565144442, "post_id": 57386167, "comment_id": 101255893, "body": "Ah sorry I missed this. You need to remove the truncate flag"}], "tags": [], "owner": {"reputation": 332, "user_id": 8778930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d1a2346b21fe5f024d1be413eb2588b?s=128&d=identicon&r=PG&f=1", "display_name": "mewi", "link": "https://stackoverflow.com/users/8778930/mewi"}, "is_accepted": true, "score": 3, "last_activity_date": 1565144591, "last_edit_date": 1565144591, "creation_date": 1565144249, "answer_id": 57386167, "question_id": 57386139, "link": "https://stackoverflow.com/questions/57386139/file-gets-overwritten-when-writing-to-file-using-write/57386167#57386167", "title": "File gets overwritten when writing to file using write()", "body": "<p>You need the append flag</p>\n\n<pre><code>O_APPEND\n</code></pre>\n\n<p>and remove</p>\n\n<pre><code>O_TRUNC\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 11010869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e15421a384cb3301964a495ae844fce?s=128&d=identicon&r=PG&f=1", "display_name": "goodknight", "link": "https://stackoverflow.com/users/11010869/goodknight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 57386167, "answer_count": 1, "score": 1, "last_activity_date": 1565144591, "creation_date": 1565143987, "question_id": 57386139, "link": "https://stackoverflow.com/questions/57386139/file-gets-overwritten-when-writing-to-file-using-write", "title": "File gets overwritten when writing to file using write()", "body": "<p>I am trying to log my signals that are recieved by my process. Whenever i write to the <code>signal.log</code> file, it just gets over written. Am I missing a file flag for appending by chance or something?</p>\n\n<p>Code :</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include \"signalinfo.h\"\n#include &lt;errno.h&gt;\n#include &lt;string.h&gt;\n#include &lt;limits.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;fcntl.h&gt;\n\n\nvoid \nsetsig(struct sigaction sa)\n{    \n\nint i;\n\nfor(i=0; i&lt;SIGNAL_LIST_LENGTH; i++) {\n    if(sigaction(siglist[i].code, &amp;sa, NULL) == -1) {\n        printf(\"Sigaction Error When: %s \\n\", siglist[i].name);\n        }           \n    }\n\n}\n\nvoid \nhandler(int sig)\n{\n    char path[PATH_MAX];\n    int fd, flags, i;\n\n    flags = S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP | S_IWOTH | S_IROTH;\n    getcwd(path, PATH_MAX);\n    strcat(path,\"/signal.log\");\n    fd = open(path, O_WRONLY | O_CREAT | O_TRUNC | O_NONBLOCK, flags);\n\n\n    for(i=0; i&lt;SIGNAL_LIST_LENGTH; i++) {\n        if(sig == siglist[i].code) {\n            write(fd, siglist[i].name, strlen(siglist[i].name));\n        }\n    }\n\n     close(fd);\n\n}\n\n    int\n    main(void)\n    {   \n        struct sigaction sa;\n        sa.sa_handler = handler;\n\n        setsig(sa);\n\n        while(1) {\n            printf(\"In loop with PID: %d\\n\", getpid());\n            sleep(1);\n        }\n     }\n</code></pre>\n\n<p>Is this happening by chance because I am missing a flag? After running it, the file is not appended and only one line is written</p>\n\n<pre><code>  SIGINT\n</code></pre>\n\n<p>I am using write as it is a async-signal-safe function</p>\n"}, {"tags": ["c", "embedded", "freertos"], "comments": [{"owner": {"reputation": 186, "user_id": 4446393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a28f271bd64ad2a1d210b540cf1df19?s=128&d=identicon&r=PG&f=1", "display_name": "flott", "link": "https://stackoverflow.com/users/4446393/flott"}, "edited": false, "score": 0, "creation_date": 1565274807, "post_id": 57386081, "comment_id": 101310032, "body": "Maybe the interrupt priority is the other way around on this processor? 0 = Highest priority (most urgent) and MAX_PRIO = Lowest priority (least urgent) or the other way around. How are the interrupt priorities defined in the settings? Try enabling all the available freeRTOS hooks (Idle, Tick, Mallocfailed, StackOverflow) and see where you end up? Did you port freeRTOS yourself or did you use an existing port?"}, {"owner": {"reputation": 314, "user_id": 11751217, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eWsMd.jpg?s=128&g=1", "display_name": "abonneville", "link": "https://stackoverflow.com/users/11751217/abonneville"}, "edited": false, "score": 0, "creation_date": 1565487094, "post_id": 57386081, "comment_id": 101369527, "body": "Verify the system tick timer / hardware was setup and initialized, without a heartbeat the scheduler will not perform any context switch. Set breakpoints in each of the RTOS specific ISR handlers to verify they are running. The RTOS ISR handlers in the vector table should match the three ISR handlers mapped in the FreeRTOSConfig.h."}, {"owner": {"reputation": 276, "user_id": 11910197, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pan5a.jpg?s=128&g=1", "display_name": "thisisbenmanley", "link": "https://stackoverflow.com/users/11910197/thisisbenmanley"}, "edited": false, "score": 0, "creation_date": 1565657400, "post_id": 57386081, "comment_id": 101412438, "body": "Not sure if this would be a cause, but you call <code>portDISABLE_INTERRUPTS()</code> in your <code>prvSetupHardware</code> and I don&#39;t see an explicit call to reenable them. They may very well be enabled in another setup function like <code>vTaskStartScheduler</code>, so that may not be a problem, but you should make sure they&#39;re actually getting reenabled."}], "answers": [{"tags": [], "owner": {"reputation": 13, "user_id": 3022477, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J6Ok2.jpg?s=128&g=1", "display_name": "netstv", "link": "https://stackoverflow.com/users/3022477/netstv"}, "is_accepted": false, "score": 0, "last_activity_date": 1567114997, "creation_date": 1567114997, "answer_id": 57718031, "question_id": 57386081, "link": "https://stackoverflow.com/questions/57386081/freertos-why-does-my-task-not-start-after-calling-vtaskstartscheduler/57718031#57718031", "title": "FreeRTOS: Why does my task not start after calling vTaskStartScheduler?", "body": "<p>Don't you need to portENABLE_INTERRUPTS()??</p>\n"}], "owner": {"reputation": 43, "user_id": 2888236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14d41a855e9ee1c7e8ae114b5373a904?s=128&d=identicon&r=PG&f=1", "display_name": "Candlejack", "link": "https://stackoverflow.com/users/2888236/candlejack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1445, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1567114997, "creation_date": 1565143431, "question_id": 57386081, "link": "https://stackoverflow.com/questions/57386081/freertos-why-does-my-task-not-start-after-calling-vtaskstartscheduler", "title": "FreeRTOS: Why does my task not start after calling vTaskStartScheduler?", "body": "<p>I am writing an application for the RPU on a Xilinx UltraScale+ ZCU102 device that needs to run a few tasks in FreeRTOS. My application starts by creating an 'start-up' task that will then create the rest of the tasks. After successfully creating my start-up task and calling vTaskStartScheduler() though, the start-up task does not run.</p>\n\n<p>I noticed the FreeRTOS FAQ page (<a href=\"http://www.freertos.org/FAQHelp.html\" rel=\"nofollow noreferrer\">http://www.freertos.org/FAQHelp.html</a>) says:</p>\n\n<blockquote>\n  <p>If the project you have created is compiling, and at least executing up to the point that the scheduler is started, but only a single task is executing or no tasks are executing at all after the call to vTaskStartScheduler(), then it is likely that the interrupt vector table is incorrect. </p>\n</blockquote>\n\n<p>So I first checked to make sure the interrupt vector table is correct. I am using FreeRTOS 10.0, which is being built as part of the ZCU102 BSP. </p>\n\n<p>In file \"port_asm_vectors.S\", which is created with the BSP, I have </p>\n\n<pre><code>// port_asm_vectors.S\n...\n.section .vectors,\"a\"\n_vector_table:\n    ldr pc,=_boot\n    ldr pc,=Undefined\n    ldr   pc, _swi\n    ldr pc,=PrefetchAbortHandler\n    ldr pc,=DataAbortHandler\n    NOP /* Placeholder for address exception vector*/\n    ldr   pc, _irq\n    ldr pc,=FIQHandler\n\n_irq:   .word FreeRTOS_IRQ_Handler\n_swi:   .word FreeRTOS_SWI_Handler\n...\n</code></pre>\n\n<p>In my application's linker script, I have the following</p>\n\n<pre><code>// lscript.ld\n...\nSECTIONS\n{\n.vectors : {\n   KEEP (*(.vectors))\n   *(.boot)\n} &gt; psu_r5_ddr_0_MEM_0\n...\n</code></pre>\n\n<p>Because I'm using files generated by the Xilinx SDK here, I think the interrupt vector table is set up correctly, so I'm thinking that my FreeRTOS configuration my have an issue.</p>\n\n<p>My FreeRTOSConfig.h file is mostly the same as the examples I've seen, although there are some changes I've made, like these: </p>\n\n<pre><code>// FreeRTOSConfig.h\n...\n#define configMINIMAL_STACK_SIZE             (250)\n#define configTOTAL_HEAP_SIZE                (0xC800)\n#define configSUPPORT_STATIC_ALLOCATION      1\n#define configUSE_TASK_FPU_SUPPORT           2\n...\n</code></pre>\n\n<p>The minimal stack size and total heap size are larger than the default values, and we only use statically allocated memory. No floats.</p>\n\n<p>At program entry, I call this function:</p>\n\n<pre><code>void prvSetupHardware( void )\n{\n   BaseType_t xStatus;\n   XScuGic_Config *pxGICConfig;\n\n   portDISABLE_INTERRUPTS();\n\n   pxGICConfig = XScuGic_LookupConfig( XPAR_SCUGIC_SINGLE_DEVICE_ID );\n\n   configASSERT( pxGICConfig );\n   configASSERT( pxGICConfig-&gt;CpuBaseAddress == ( configINTERRUPT_CONTROLLER_BASE_ADDRESS + configINTERRUPT_CONTROLLER_CPU_INTERFACE_OFFSET ) );\n   configASSERT( pxGICConfig-&gt;DistBaseAddress == configINTERRUPT_CONTROLLER_BASE_ADDRESS );\n\n   xStatus = XScuGic_CfgInitialize( &amp;xInterruptController, pxGICConfig, pxGICConfig-&gt;CpuBaseAddress );\n   configASSERT( xStatus == XST_SUCCESS );\n   ( void ) xStatus; /* Remove compiler warning if configASSERT() is not defined. \n   xStatus = XScuGic_SelfTest(&amp;xInterruptController);\n   configASSERT( xStatus == XST_SUCCESS );\n\n   ( void ) xStatus; /* Remove compiler warning if configASSERT() is not defined. */\n\n   xTxMutex = xSemaphoreCreateMutex();\n   configASSERT( xTxMutex );\n\n   xPort = xSerialPortInitMinimal( configCLI_BAUD_RATE, cmdQUEUE_LENGTH );\n\n   /* Disable cache on OCM */\n   Xil_SetTlbAttributes(OCM_START_ADDR,0x14de2);  // S=b1 TEX=b100 AP=b11, Domain=b1111, C=b0, B=b0\n}\n</code></pre>\n\n<p>In my application code, creating the init task is one of the first things that happen after the static memory regions have been created.</p>\n\n<pre><code>TaskHandle_t taskId = xTaskCreateStatic(\n           task_func,     // pointer to task entry code\n           \"STARTUP\",   // task name\n           0x3EA,         // stack depth\n           0x00000000,    // arguments\n           1,             // priority\n           task_stack_buffer, // statically allocated task stack buffer\n           pTaskBuffer);  // statically allocated, holds tasks data structures\n</code></pre>\n\n<p>This call exits successfully, and the call to vTaskStartScheduler happens, and the start-up task is not started. I stepped through the vTaskStartScheduler call, and it saw that it is not quitting early or erroring out. </p>\n\n<p>Any ideas with this? I need the start-up task to start so that the rest of the tasks can be scheduled as well.</p>\n\n<p>As a note: I've run the code I'm working with on other hardware platforms with FreeRTOS v10.0 successfully. All I needed to do is update the BSP, which builds the FreeRTOS library. So I'm not ruling out the problem being in the C code, I just don't think it is as likely as the problem being in project settings or FreeRTOS configurations.</p>\n"}, {"tags": ["c", "cs50"], "comments": [{"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 3, "creation_date": 1565138992, "post_id": 57385606, "comment_id": 101254995, "body": "What if <code>y</code> is equal to 25?"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1565139126, "post_id": 57385606, "comment_id": 101255018, "body": "Print a message instead of <code>return 0;</code>. For instance, <code>printf(&quot;%d\\n&quot;, y);</code> will lead you straight to the bug."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1565139209, "post_id": 57385606, "comment_id": 101255034, "body": "C and C++ are very different languages. Don&#39;t tag both &quot;just in case&quot; or because they look similar to you. As far as I know, CS50 is a C course."}, {"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 0, "creation_date": 1565139492, "post_id": 57385606, "comment_id": 101255062, "body": "And when you used your debugger to run your program with failing input, what observations did you make? This is exactly what a debugger is for: to run your program one line at a time, inspect the values of all variables as they change and observe your program&#39;s logical flow. Knowing how to use a debugger is a required skill for every C++ developer. No exceptions. You have a few simple bugs, and using a debugger you should be able to figure them out all by yourself. Don&#39;t you think it&#39;s better to be able to find and fix your own bugs, with a debugger, than post a question here, and wait?"}, {"owner": {"reputation": 523, "user_id": 7358866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250a27e4561d673ec0bdee5a90662b2c?s=128&d=identicon&r=PG&f=1", "display_name": "Darotudeen", "link": "https://stackoverflow.com/users/7358866/darotudeen"}, "edited": false, "score": 0, "creation_date": 1565140305, "post_id": 57385606, "comment_id": 101255183, "body": "Thanks everyone for the advice. just wanted something that would lead me or help spot the mistake."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1565140535, "post_id": 57385606, "comment_id": 101255224, "body": "@user4581301: Immediately after getting the input, which the assignment may necessitate doing with <code>get_float</code>, the program converts to a number of cents in an <code>int</code> and then does the remaining work with integer arithmetic. Do you fail to notice this when you wrote your suggestion?"}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1565141176, "post_id": 57385606, "comment_id": 101255326, "body": "I think you&#39;re missing a case for y &gt;= 100."}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1565141328, "post_id": 57385606, "comment_id": 101255353, "body": "@molbdnilo: In this case both tags are fine because the integer and floating point rules are identical."}, {"owner": {"reputation": 4562, "user_id": 9254539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b45538511384660bfaef5092e30b7ea?s=128&d=identicon&r=PG&f=1", "display_name": "BessieTheCookie", "link": "https://stackoverflow.com/users/9254539/bessiethecookie"}, "reply_to_user": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1565145640, "post_id": 57385606, "comment_id": 101256089, "body": "@Joshua But if this was C++ people should be telling the OP to use C++ I/O and C++ standard library headers instead of the C <code>.h</code> headers."}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "reply_to_user": {"reputation": 4562, "user_id": 9254539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b45538511384660bfaef5092e30b7ea?s=128&d=identicon&r=PG&f=1", "display_name": "BessieTheCookie", "link": "https://stackoverflow.com/users/9254539/bessiethecookie"}, "edited": false, "score": 0, "creation_date": 1565149195, "post_id": 57385606, "comment_id": 101256619, "body": "@AlexanderZhang: Use of C++ I/O instead of printf is a style debate in this case."}, {"owner": {"reputation": 523, "user_id": 7358866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250a27e4561d673ec0bdee5a90662b2c?s=128&d=identicon&r=PG&f=1", "display_name": "Darotudeen", "link": "https://stackoverflow.com/users/7358866/darotudeen"}, "edited": false, "score": 0, "creation_date": 1565155677, "post_id": 57385606, "comment_id": 101258072, "body": "Please am very sorry I tagged c++ earlier. forgive me"}, {"owner": {"reputation": 523, "user_id": 7358866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250a27e4561d673ec0bdee5a90662b2c?s=128&d=identicon&r=PG&f=1", "display_name": "Darotudeen", "link": "https://stackoverflow.com/users/7358866/darotudeen"}, "edited": false, "score": 0, "creation_date": 1565173055, "post_id": 57385606, "comment_id": 101266117, "body": "Thanks everyone once again. it has been dealt with.<a href=\"https://submit.cs50.io/users/darothub/cs50/problems/2019/x/cash\" rel=\"nofollow noreferrer\">submit.cs50.io/users/darothub/cs50/problems/2019/x/cash</a>"}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1565224451, "post_id": 57385606, "comment_id": 101289046, "body": "I&#39;m voting to close this question as off-topic because OP solved the problem and the rest of us still don&#39;t understand it."}], "owner": {"reputation": 523, "user_id": 7358866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250a27e4561d673ec0bdee5a90662b2c?s=128&d=identicon&r=PG&f=1", "display_name": "Darotudeen", "link": "https://stackoverflow.com/users/7358866/darotudeen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566749791, "creation_date": 1565138538, "last_edit_date": 1566749791, "question_id": 57385606, "link": "https://stackoverflow.com/questions/57385606/program-will-not-run-for-larger-values-in-tens-and-hundred-except-floating", "title": "Program will not run for larger values in tens and hundred except floating", "body": "<p>I am writing a program to solve the problem of changed owed after a customer purchases goods.</p>\n\n<p>The changes are meant to be mostly in floating variable like 0.50 for 50cents and that works fine but for situation where the change owed are in whole number like 10 and 9 the program will not carry out necessary operations</p>\n\n<p>I have converted the input from float to input but to no avail</p>\n\n<pre><code>#include &lt;cs50.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n\nint change(void);\nint main()\n{\n    float num;\n    int y;\n    int counter = 0;\n    do\n    {\n     num = get_float(\"Change owed: \");\n     num = round(num * 100);\n     y = (int) num;\n     printf(\"%d\\n\", y);\n\n    }\n    while(num &lt;= 0);\n    while(y&gt;0)\n    {\n        if(y &gt; 25)\n        {\n            y-=25;\n\n            counter++;\n        }\n        else if(y &lt; 25 &amp;&amp; y &gt;= 10)\n        {\n            y-=10;\n\n            counter++;\n        }\n        else if(y &lt; 10 &amp;&amp; y &gt;= 5)\n        {\n            y-=5;\n\n            counter++;\n        }\n          else if(y &lt; 5 &amp;&amp; y &gt;= 1)\n        {\n            y-=1;\n\n            counter++;\n        }\n        else\n        {\n            return 0;    \n        }\n\n    }\n    printf(\"%d \\n\", counter);\n\n}\n\n\n</code></pre>\n\n<p>I want to be able to run the program for all numeric data types</p>\n"}, {"tags": ["c", "compilation", "linker"], "comments": [{"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 2, "creation_date": 1565138522, "post_id": 57385578, "comment_id": 101254916, "body": "They don&#39;t accomplish the &quot;same thing&quot;. One is a build process, the other is the preparation of a translation unit submitted to that build process. Your first example has two translation units (think: compiled &quot;things&quot;). Your second is just the source behind one of those compiled &quot;things&quot;, and includes a preprocessor instruction to injest an external header file while preparing the source for later compilation."}, {"owner": {"reputation": 172529, "user_id": 140750, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c7af12cad08c95bc206a9636d164224?s=128&d=identicon&r=PG", "display_name": "William Pursell", "link": "https://stackoverflow.com/users/140750/william-pursell"}, "edited": false, "score": 0, "creation_date": 1565138546, "post_id": 57385578, "comment_id": 101254920, "body": "<code>func.h</code> is not <code>func.c</code>.   They serve different purposes."}, {"owner": {"reputation": 47, "user_id": 11882086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93863851c832d54ba96dc7b6a938f52?s=128&d=identicon&r=PG&f=1", "display_name": "cprogrammer100", "link": "https://stackoverflow.com/users/11882086/cprogrammer100"}, "reply_to_user": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1565139109, "post_id": 57385578, "comment_id": 101255016, "body": "@WhozCraig by &quot;same thing&quot; I meant that both ways allow the programmer to use the functions in the func file."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565140045, "post_id": 57385578, "comment_id": 101255132, "body": "You do both of these things at once to use the functions in func.c from main.c"}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 11882086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93863851c832d54ba96dc7b6a938f52?s=128&d=identicon&r=PG&f=1", "display_name": "cprogrammer100", "link": "https://stackoverflow.com/users/11882086/cprogrammer100"}, "edited": false, "score": 0, "creation_date": 1565141830, "post_id": 57385834, "comment_id": 101255456, "body": "So if both methods allow you to access functions outside your main file, When would I make my func file a .h file instead of making it a .c file and linking it with main.c?"}, {"owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 0, "creation_date": 1565165347, "post_id": 57385834, "comment_id": 101261943, "body": "You need both: The compiler needs the <b>declaration</b> of the external function to generate the correct code (and to give you meaningful messages if you did something wrong). The executable needs the <b>implementation</b> (aka definition) of the external function so that it can be executed. So the approved style is to provide &quot;func.h&quot; for inclusion in the using module and &quot;func.c&quot; for the implementation."}, {"owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 0, "creation_date": 1565165545, "post_id": 57385834, "comment_id": 101262043, "body": "Oh, and please don&#39;t put the <b>definition</b> of variables and/or functions in a header file. That is, nearly always; there are corner cases that do this."}], "tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": false, "score": 2, "last_activity_date": 1565141159, "creation_date": 1565141159, "answer_id": 57385834, "question_id": 57385578, "link": "https://stackoverflow.com/questions/57385578/what-is-the-difference-between-linking-and-using-a-header-file/57385834#57385834", "title": "What is the difference between linking and using a header file?", "body": "<p><code>#include</code> makes all the source code in the included file available to the compiler, effectively including it as part of the file being compiled. This is commonly used to declare names that are defined in other files. That tells the compiler what types of the named objects and functions are, and the compiler can use this to generate code that <strong>uses</strong> those objects and functions. But the code does not actually contain definitions for those objects and functions.</p>\n\n<p>When files are linked together, the link takes objects and functions from multiple files and builds them together into one executable program (or into a library or object module for further linking later). While putting these objects and functions together, the linker <strong>resolves</strong> references to objects and functions.</p>\n\n<p>Suppose the <code>main</code> function file main.c calls function <code>foo</code> in file function.c. The header function.h will declare <code>foo</code>, which tells the compiler what arguments the function requires and what type of value it returns. When compiling main.c, the compiler will produce an object module main.o that contains a <strong>call</strong> to <code>foo</code>. Inside the object file, <code>foo</code> is represented only by its name. When compiling function.c, the compiler will produce an object module function.o that contains the actual function <code>foo</code>.</p>\n\n<p>When the linker builds the executable, it will decide where the function <code>foo</code> will be placed inside the program. Then, it will go into the code for <code>main</code> where the call instruction is and modify the address or offset used in the call instruction so that it points to the <code>foo</code> function. Then, in the executable program file, the call to <code>foo</code> contains only an address or offset; it is no longer referred to by name. The different calls and definitions in the program have been linked together.</p>\n\n<p>Including headers is used to tell the compiler about types of objects and functions. The objects and functions remain in separate files, each in the object file corresponding to the source file in which it is defined.</p>\n\n<p>Linking is used to combine the different object modules into one executable program file.</p>\n"}, {"comments": [{"owner": {"reputation": 47, "user_id": 11882086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93863851c832d54ba96dc7b6a938f52?s=128&d=identicon&r=PG&f=1", "display_name": "cprogrammer100", "link": "https://stackoverflow.com/users/11882086/cprogrammer100"}, "edited": false, "score": 0, "creation_date": 1565141985, "post_id": 57385853, "comment_id": 101255481, "body": "Using your analogy, if both methods eventually result in an &quot;addition on your house&quot; in what situations would I use a header file instead of linking against a library"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "reply_to_user": {"reputation": 47, "user_id": 11882086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93863851c832d54ba96dc7b6a938f52?s=128&d=identicon&r=PG&f=1", "display_name": "cprogrammer100", "link": "https://stackoverflow.com/users/11882086/cprogrammer100"}, "edited": false, "score": 0, "creation_date": 1565142234, "post_id": 57385853, "comment_id": 101255523, "body": "@cprogrammer100 If you sign a contract but don&#39;t pay, you get sued.  If you skip the contract, then when the time comes to pay, you may find that what got built wasn&#39;t what you wanted.  When it comes to programming, if you include the header but don&#39;t link against the library, you get error messages like &quot;Undefined external: <code>_sqrt</code>&quot;.  If you skip the header but link against the library, you get wrong answer, because the compiler doesn&#39;t know to insert those int/double conversions when you called <code>sqrt</code>.  In general, you have to do <i>both</i>."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "reply_to_user": {"reputation": 47, "user_id": 11882086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93863851c832d54ba96dc7b6a938f52?s=128&d=identicon&r=PG&f=1", "display_name": "cprogrammer100", "link": "https://stackoverflow.com/users/11882086/cprogrammer100"}, "edited": false, "score": 0, "creation_date": 1565142590, "post_id": 57385853, "comment_id": 101255579, "body": "@cprogrammer100 If you had a header file which contained only declarations of things <i>other</i> than external functions -- perhaps it had only <code>struct</code> declarations and preprocessor <code>#define</code>s -- it would be fine and meaningful to include that header even though you didn&#39;t link a corresponding library.  And theoretically it might be possible to have a library full of functions which it was possible to call correctly without having included a corresponding header file, although in practice I would expect this to be exceedingly rare."}], "tags": [], "owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "is_accepted": false, "score": 5, "last_activity_date": 1565142883, "last_edit_date": 1565142883, "creation_date": 1565141276, "answer_id": 57385853, "question_id": 57385578, "link": "https://stackoverflow.com/questions/57385578/what-is-the-difference-between-linking-and-using-a-header-file/57385853#57385853", "title": "What is the difference between linking and using a header file?", "body": "<p>They don't \"accomplish the same thing\".  They accomplish complementary parts of the same thing.  Typically you have to do both: doing just one, or just the other, is totally insufficient.</p>\n\n<p>Here's an imperfect analogy: Suppose you want an addition on your house.  At the start of the project, you sign your name on a contract with the builder, specifying the size and finish of the addition.  At the end of the project, you sign your name on a check to pay the builder for his work.  What's the difference between signing the contract and signing the check?  Why do you have to do both, if they both do the same thing, namely getting you your new addition?</p>\n\n<p>Including a header is (sort of) like signing a contract.  When you say <code>#include &lt;math.h&gt;</code>, you're saying \"Hey, compiler, there are some math  functions.  Like <code>sqrt()</code>, which accepts a <code>double</code> and returns a <code>double</code>. So if I write <code>int x = sqrt(144)</code>, make sure you do a conversion from <code>int</code> to <code>double</code> before passing the number to <code>sqrt</code>, and make sure you do a conversion from <code>double</code> back to <code>int</code> before assigning the result to <code>x</code>.\"</p>\n\n<p>Linking against a library is (sort of) like paying your bill.  (Actually, if I'm honest, it's almost nothing like paying a bill, but bear with me.)  When you put <code>-lm</code> at the end of the command line, you're saying \"Hey, compiler, those math functions we agreed on, the ones whose details are specified in the contract called <code>&lt;math.h&gt;</code>, the ones I've been calling, now I'm paying up, here's where those functions actually <em>are</em>.\"</p>\n"}], "owner": {"reputation": 47, "user_id": 11882086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93863851c832d54ba96dc7b6a938f52?s=128&d=identicon&r=PG&f=1", "display_name": "cprogrammer100", "link": "https://stackoverflow.com/users/11882086/cprogrammer100"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1565142883, "creation_date": 1565138239, "question_id": 57385578, "link": "https://stackoverflow.com/questions/57385578/what-is-the-difference-between-linking-and-using-a-header-file", "title": "What is the difference between linking and using a header file?", "body": "<p>For example, what is the difference between linking two files</p>\n\n<pre><code>gcc -c func.c \ngcc -c main.c \ngcc func.o main.o -o main \n</code></pre>\n\n<p>and using a header file</p>\n\n<pre><code>#include func.h\n\nint main{\n....\n.. \n}\n</code></pre>\n\n<p>if they seem to accomplish the same thing?</p>\n"}, {"tags": ["c", "signals"], "comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 2, "creation_date": 1565135229, "post_id": 57385034, "comment_id": 101254374, "body": "Neither <code>printf()</code> or <code>exit()</code> can safely be called in a signal handler, btw. <a href=\"http://www.man7.org/linux/man-pages/man7/signal-safety.7.html\" rel=\"nofollow noreferrer\">List of signal-safe functions</a>"}, {"owner": {"reputation": 8002, "user_id": 1143850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2927fac544c9960cd5433688fe4cae1d?s=128&d=identicon&r=PG", "display_name": "Serge", "link": "https://stackoverflow.com/users/1143850/serge"}, "edited": false, "score": 1, "creation_date": 1565138385, "post_id": 57385034, "comment_id": 101254900, "body": "yes, you need to register a handler(s) for all signals of interest. note that not all signals can be caught. SIGKILL and SIGSTOP cannot be caught or masked.  So, do not bother registering them."}], "owner": {"reputation": 55, "user_id": 11711302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb00cae530390ce4187150985cfb6dd6?s=128&d=identicon&r=PG&f=1", "display_name": "gooddayjay", "link": "https://stackoverflow.com/users/11711302/gooddayjay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1568416218, "creation_date": 1565132552, "last_edit_date": 1568416218, "question_id": 57385034, "link": "https://stackoverflow.com/questions/57385034/how-to-receive-a-signal", "title": "How to receive a signal", "body": "<p>I wanted to write a daemon on receiving signals that I could run in the background. </p>\n\n<p>I am a little confused however on how could I receive a signal? Once I receive a signal, can I display that received signal?</p>\n\n<pre><code>#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;signal.h&gt;\n\n// Define the function to be called when ctrl-c (SIGINT) signal is sent to         process\nvoid\nsignal_callback_handler(int signum)\n{\n   printf(\"Caught signal %d\\n\",signum);\n   // Cleanup and close up stuff here\n\n   // Terminate program\n   exit(signum);\n}\n\nint main()\n{\n   // Register signal and signal handler\n   signal(SIGINT, signal_callback_handler);\n\n   while(1)\n   {\n      printf(\"Program processing stuff here.\\n\");\n      sleep(1);\n   }\n   return EXIT_SUCCESS;\n}\n</code></pre>\n\n<p>I feel like this code would work but if I wanted to do it for all 31 available signals, would i have to register each signal using <code>signal(SIGNAL, handler)</code>?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 5813, "user_id": 1075282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70efe94a6c2237ec96f429402a03a27d?s=128&d=identicon&r=PG", "display_name": "Renat", "link": "https://stackoverflow.com/users/1075282/renat"}, "edited": false, "score": 2, "creation_date": 1565126720, "post_id": 57384110, "comment_id": 101252477, "body": "<code>int used[N]</code> is not a c# syntax. You need to mention what is BFS. And what is data structure. And why your code doesn&#39;t work. Also please don&#39;t post homework questions as is, <a href=\"https://meta.stackoverflow.com/questions/334822/how-do-i-ask-and-answer-homework-questions\" title=\"how do i ask and answer homework questions\">meta.stackoverflow.com/questions/334822/&hellip;</a>"}, {"owner": {"reputation": 28373, "user_id": 5015238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8790f8091d3c6c58fd45664a165117a?s=128&d=identicon&r=PG", "display_name": "jdweng", "link": "https://stackoverflow.com/users/5015238/jdweng"}, "edited": false, "score": 0, "creation_date": 1565127405, "post_id": 57384110, "comment_id": 101252663, "body": "An adjacent graph is a square matrix.  A square matrix has 8 neighbor cells (except around the outside of the matrix where the corners have 3 neighbors and the edges have 5 neighbors).  The neighbors vertex are the non zero cells in the matrix.  So you need to go to transverse the matrix by testing all neighbor cells and transverse the ones that are not zero.  So if you are at cell (2,2)  you have to transverse cells (1,1), (1,2),(1,3), (2,1), (2,3), (3,1), (3,2), and (3,3) if they do not contain zero."}], "answers": [{"tags": [], "owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "is_accepted": false, "score": 0, "last_activity_date": 1565132275, "creation_date": 1565132275, "answer_id": 57384998, "question_id": 57384110, "link": "https://stackoverflow.com/questions/57384110/i-have-a-adj-matrix-graph-and-i-was-wondering-how-do-i-traverse-from-a-specific/57384998#57384998", "title": "I have a adj matrix graph and i was wondering how do i traverse from a specific vertex to another specific vertex", "body": "<p>Traditionally, an adjacency matrix is a represents a graph by indexing the matrix by two node ids:</p>\n\n<pre><code>int Graph[N][N];\n...\nint Edge(int from, int to) {\n     return Graph[from][to];\n}\n</code></pre>\n\n<p>A non-zero return value from Edge(1, 2) would indicate that there is an <em>Edge</em> between <em>vertices</em> 1 and 2; a zero would indicate no such <em>Edge</em> exists.\nAdjacency matrices can quickly answer questions like: which nodes is <em>k</em> connected to:</p>\n\n<pre><code>PrintConnection(int k) {\n   int i;\n   printf(\"%d:\", k);\n   for (i=0; i &lt; N; i++) {\n       if (Graph[k][i]) {\n           printf(\" %d\", i);\n       }\n   }\n   printf(\"\\n\");\n}\n</code></pre>\n\n<p>and you can perform transformations upon the adjacency matrix to tease out further information.   A useful one is the transitive closure, whereby you find the cases where <em>Edge(a, c) == 0 &amp;&amp; Edge(a, b) != 0 &amp;&amp; Edge(b, c) != 0</em>; then set Graph[a][c] = 1. for every case in the graph.    Once annotated, the function Edge(a,b) answers *is there a path from a to b, perhaps going through other vertices, in the graph\".  There is an efficient dynamic algorithm to produce this by Warshall.</p>\n\n<p>I hope this helps....</p>\n"}], "owner": {"reputation": 1, "user_id": 11891860, "user_type": "registered", "profile_image": "https://graph.facebook.com/1912391628907626/picture?type=large", "display_name": "Daniel Ding", "link": "https://stackoverflow.com/users/11891860/daniel-ding"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 23, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1565132275, "creation_date": 1565126172, "last_edit_date": 1565130130, "question_id": 57384110, "link": "https://stackoverflow.com/questions/57384110/i-have-a-adj-matrix-graph-and-i-was-wondering-how-do-i-traverse-from-a-specific", "title": "I have a adj matrix graph and i was wondering how do i traverse from a specific vertex to another specific vertex", "body": "<p>Traverse from 1 vertex to another using BFS.</p>\n\n<pre><code>#define N 9635\n\nint ChainOfWords(int Id1, int Id2, int used[N], int depth)\n{\n    depth = depth + 1;\n    used[Id1] = depth;\n    for(int i = 1; i&lt;n; i++){\n        if(!used[i] &amp;&amp; i!=Id2){\n            ChainOfWords(i, Id2, used, depth);\n        }   \n        else{\n            return 1\n        }\n    }\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "fortran"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1565125708, "post_id": 57384010, "comment_id": 101252152, "body": "<code>wtf</code> is <code>int*</code> and should not be printed with <code>%s</code>"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1565125756, "post_id": 57384010, "comment_id": 101252164, "body": "You are treating <code>int *wtf</code> as if it is a string with <code>%s</code>."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1565125769, "post_id": 57384010, "comment_id": 101252169, "body": "Also <code>var</code> is incorrect type"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1565125829, "post_id": 57384010, "comment_id": 101252190, "body": "I think you want something like <code>printf(&quot;string: %s wtf: %d var: %d\\n&quot;, string, *wtf, *var);</code> No comments about Fortran side(as I don&#39;t know it), but it looks suspicious that <code>cprint</code> is being called with two parameters only."}, {"owner": {"reputation": 5813, "user_id": 1075282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70efe94a6c2237ec96f429402a03a27d?s=128&d=identicon&r=PG", "display_name": "Renat", "link": "https://stackoverflow.com/users/1075282/renat"}, "edited": false, "score": 0, "creation_date": 1565126063, "post_id": 57384010, "comment_id": 101252265, "body": "This might help <a href=\"https://stackoverflow.com/questions/17845931/calling-c-function-subroutine-in-fortran-code\" title=\"calling c function subroutine in fortran code\">stackoverflow.com/questions/17845931/&hellip;</a>"}, {"owner": {"reputation": 24099, "user_id": 3157076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mB4zi.png?s=128&g=1", "display_name": "francescalus", "link": "https://stackoverflow.com/users/3157076/francescalus"}, "edited": false, "score": 2, "creation_date": 1565127852, "post_id": 57384010, "comment_id": 101252800, "body": "As you aren&#39;t using the standardized interoperability features of Fortran 2003, please say which compilers (including versions) you are using.  Many compilers for example pass an additional length argunent when using a C function with a character argument."}], "answers": [{"tags": [], "owner": {"reputation": 1145, "user_id": 11783812, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LFwV3.jpg?s=128&g=1", "display_name": "cocool97", "link": "https://stackoverflow.com/users/11783812/cocool97"}, "is_accepted": false, "score": 0, "last_activity_date": 1565128379, "creation_date": 1565128379, "answer_id": 57384488, "question_id": 57384010, "link": "https://stackoverflow.com/questions/57384010/what-is-the-extra-content-on-the-string-passed-from-fortran-to-c-and-how-to-stop/57384488#57384488", "title": "What is the extra content on the string passed from fortran to c and how to stop it?", "body": "<p>You are trying to print an <code>int *</code> with the <code>%s</code> formatter, which is string-reserved. <br>\nYou have to use <code>%d</code>, and don't forget that <code>wtf</code> in a pointer, so you have to dereference it with <code>*wtf</code> </p>\n"}, {"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 2, "last_activity_date": 1565128540, "creation_date": 1565128540, "answer_id": 57384514, "question_id": 57384010, "link": "https://stackoverflow.com/questions/57384010/what-is-the-extra-content-on-the-string-passed-from-fortran-to-c-and-how-to-stop/57384514#57384514", "title": "What is the extra content on the string passed from fortran to c and how to stop it?", "body": "<p>Fortran strings are equivalent to fixed-length character arrays.  Semantically, they are not null-terminated.  Instead, it is up to the implementation to track their length.  Historically, implementations track string length through function calls by various different means, but the most common is probably to pass the length as an additional, implicit parameter.  That's surely what you're seeing.</p>\n\n<p>In some implementations, the extra argument immediately follows the string, and in others all the string lengths come at the end of the argument list.  Typically, though, the length parameters are integers, not pointers, unlike the parameters that correspond directly to objects.</p>\n\n<p>Your test, though technically malformed, strongly suggests that your string length is being passed as the third argument (and indeed as an <code>int</code>, not an <code>int *</code>).  Thus, a first cut at an appropriate <code>cprint_</code> function might look like this:</p>\n\n<pre><code>void cprint_(char *string, int *integer, int string_len) {\n    printf(\"string: '%.*s'\\ninteger: %d\\n\", string, string_len, *integer);\n}\n</code></pre>\n\n<p>If you're going to print the string as received from Fortran, without modification, then it is appropriate to specify a suitable precision, as shown, because the string cannot be assumed to be terminated.  In practice, you may want to print fewer characters of the string than its actual length, however, because there is no explicit distinction between the size of the array and the number of meaningful characters in it.  Fortran strings are right-padded with blanks (<code>' '</code>) when values smaller than their sizes are assigned to them, and it is common for Fortran programs to assume that the real data extend only to the last non-blank character.</p>\n\n<p>Be careful, though: if you modify the string, by inserting a C string terminator, for example, then you are changing the data on the Fortran side, too.  Make a copy if you must, but often you can avoid doing so, as the above example does.</p>\n"}, {"tags": [], "owner": {"reputation": 1343, "user_id": 2088694, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ReW5D.png?s=128&g=1", "display_name": "King", "link": "https://stackoverflow.com/users/2088694/king"}, "is_accepted": false, "score": 1, "last_activity_date": 1565197066, "last_edit_date": 1565197066, "creation_date": 1565193508, "answer_id": 57398293, "question_id": 57384010, "link": "https://stackoverflow.com/questions/57384010/what-is-the-extra-content-on-the-string-passed-from-fortran-to-c-and-how-to-stop/57398293#57398293", "title": "What is the extra content on the string passed from fortran to c and how to stop it?", "body": "<p>The answer provided by @John Bollinger is correct. Fortran treats strings entirely differently from C. Here is an example code that I wrote a few days ago, which passes a char array from C to Fortran, then Fortran makes it lower-case and returns the result to C,</p>\n\n<pre><code>module String_mod\n    implicit none\ncontains\n    subroutine getLowerCase(StrVec,StrVecLowerCase,lenStrVec) bind(C, name=\"getLowerCase\")\n        use, intrinsic :: iso_c_binding, only: c_char, c_null_char, c_size_t\n        use, intrinsic :: iso_fortran_env, only: IK =&gt; int32\n        integer(c_size_t), intent(in), value        :: lenStrVec\n        character(len=1,kind=C_char), intent(in)    :: StrVec(lenStrVec)\n        character(len=1,kind=C_char), intent(inout) :: StrVecLowerCase(lenStrVec)\n        integer(IK), parameter                      :: duc = ichar('A') - ichar('a')\n        character                                   :: ch\n        integer(IK)                                 :: i\n        write(*,\"(*(g0))\") \"From Inside Fortran@getLowerCase(): StrVec = \", (StrVec(i),i=1,lenStrVec)\n        write(*,\"(*(g0))\") \"From Inside Fortran@getLowerCase(): lenStrVec = \", lenStrVec\n        do i = 1, lenStrVec\n            ch = StrVec(i)\n            if (ch&gt;='A' .and. ch&lt;='Z') ch = char(ichar(ch)-duc)\n            StrVecLowerCase(i) = ch\n        end do\n    end subroutine getLowerCase\nend module String_mod\n</code></pre>\n\n<p>and here is the C code calling Fortran,</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n// Fortran function's prototype\nextern void getLowerCase(char [], char [], size_t );\n\nint main(void)\n{\n    char StrVec[] = \"HELLO FORTRAN! YOU ROCK!\";\n    size_t lenStrVec = sizeof(StrVec) / sizeof(StrVec[0]);\n    char StrVecLowerCase[ lenStrVec ];\n\n    getLowerCase( StrVec\n                , StrVecLowerCase\n                , lenStrVec\n                );\n    printf(\"From Inside C: %s\\n\", StrVecLowerCase);\n    return 0;\n}\n</code></pre>\n\n<p>Compiling with Intel Fortran/C compiler gives,</p>\n\n<pre><code>$ ifort -c String_mod.f90\n$ icl -c main.c\n$ icl String_mod.obj main.obj -o a.exe \n$ a.exe\n\nFrom Inside Fortran@getLowerCase(): StrVec = HELLO FORTRAN! YOU ROCK!\nFrom Inside Fortran@getLowerCase(): lenStrVec = 25\nFrom Inside C: hello fortran! you rock!\n</code></pre>\n\n<p>The simplest Fortran-2003 approach to string interoperation is to declare the Fortran strings as char arrays and pass the lengths of the arrays explicitly from C to Fortran or vice versa, as done in the example above. Note that all of the allocations happen on the C side. Fortran 2018 provides more convenient ways to pass strings (including allocatable strings) between Fortran and C, some of which require <strong>no change</strong> to the Fortran code and minimal work on the C code via <code>ISO_Fortran_binding.h</code>. See, for example, <a href=\"https://software.intel.com/en-us/forums/intel-visual-fortran-compiler-for-windows/topic/815601\" rel=\"nofollow noreferrer\">this page</a>.</p>\n"}], "owner": {"reputation": 67, "user_id": 7940371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/887028274147b46a51e9837e24506bef?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/7940371/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1565197066, "creation_date": 1565125657, "question_id": 57384010, "link": "https://stackoverflow.com/questions/57384010/what-is-the-extra-content-on-the-string-passed-from-fortran-to-c-and-how-to-stop", "title": "What is the extra content on the string passed from fortran to c and how to stop it?", "body": "<p>I am trying to pass a string and a value from fortran to c and it is giving me weird results and I cannot figure out what is happening.</p>\n\n<pre><code>fortran      \n      integer rmat\n\n      rmat = 4\n      call cprint(\"rmat \", rmat)\n\n      END\n\ncprint_.c\n\n#include &lt;stdio.h&gt;\n\nvoid cprint_( char *string, int *wtf, int *var){\n    printf(\"string: %s wtf: %s var: %d\\n\", string, wtf, var);\n}\n</code></pre>\n\n<h3>output:</h3>\n\n<p>string: rmat convertedtest.f wtf:  var: 5</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1565124619, "post_id": 57383742, "comment_id": 101251763, "body": "How is it broken?  What does it do?  Is it generating errors or run or compile?  Or is the 2G buffer the issue?"}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1565124796, "post_id": 57383742, "comment_id": 101251833, "body": "Also, it seems you are passing in the double ** array, but treating it as a double * array in your compare?  Would you not want to treat it as a double pointer and read in the actual value you want to compare?"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565127801, "post_id": 57383742, "comment_id": 101252782, "body": "There is a proper type for all the sizes ... Which is <code>size_t</code>! Not int, not long, not long long but <code>size_t</code>."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 11844106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e9e5bedf1efbcaf42efec7aac3b077e?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/11844106/riley"}, "edited": false, "score": 0, "creation_date": 1565125391, "post_id": 57383846, "comment_id": 101252043, "body": "Thank you for your reply. I implemented your compare function but am now getting &quot;Process finished with exit code -1073741819 (0xC0000005)&quot;"}, {"owner": {"reputation": 41, "user_id": 11844106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e9e5bedf1efbcaf42efec7aac3b077e?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/11844106/riley"}, "edited": false, "score": 0, "creation_date": 1565125598, "post_id": 57383846, "comment_id": 101252116, "body": "As well, I&#39;m getting a &quot;narrowing conversion from double to int&quot; warning on return"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "reply_to_user": {"reputation": 41, "user_id": 11844106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e9e5bedf1efbcaf42efec7aac3b077e?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/11844106/riley"}, "edited": false, "score": 0, "creation_date": 1565130456, "post_id": 57383846, "comment_id": 101253527, "body": "You\u2019re passing the wrong element size, causing undefined behaviour. Your elements are <code>double*</code>, not arrays of doubles. (Pointers are not arrays and arrays are not pointers.)"}], "tags": [], "owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "is_accepted": false, "score": 0, "last_activity_date": 1565130025, "last_edit_date": 1565130025, "creation_date": 1565124776, "answer_id": 57383846, "question_id": 57383742, "link": "https://stackoverflow.com/questions/57383742/sort-dynamically-allocated-2d-array-by-first-column-in-c/57383846#57383846", "title": "Sort dynamically allocated 2D array by first column in C", "body": "<p>The actual arguments for the comparisons are <code>double**</code>, not <code>double*</code>.<br>\n(You get a pointer to each element, not the element itself.)</p>\n\n<p>If you want to sort on the first element, use something like this:</p>\n\n<pre><code>int Compare_Function (const void * a, const void * b) {\n    double* array_a = *(double**)a;\n    double* array_b = *(double**)b;\n    return (int) (array_a[0] - array_b[0]);\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 41, "user_id": 11844106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e9e5bedf1efbcaf42efec7aac3b077e?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/11844106/riley"}, "edited": false, "score": 0, "creation_date": 1565127444, "post_id": 57384153, "comment_id": 101252673, "body": "My apologies for the ambiguity, <i>[number_properties]</i> is an integer constant to be set prior to compile. Your answer works beautifully, thank you!"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 41, "user_id": 11844106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e9e5bedf1efbcaf42efec7aac3b077e?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/11844106/riley"}, "edited": false, "score": 0, "creation_date": 1565127759, "post_id": 57384153, "comment_id": 101252768, "body": "Note, you can also sort the pointers as @KamilCuk wrote, you just must limit your <code>qsort</code> call to <code>qsort(properties_array, (size_t)number_nodes, sizeof(double*), Double_Compare_Function);</code> (the benefit of allocating a single-block -- is you have only a single <code>free()</code> to call as well.)"}], "tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": true, "score": 1, "last_activity_date": 1565128074, "last_edit_date": 1565128074, "creation_date": 1565126411, "answer_id": 57384153, "question_id": 57383742, "link": "https://stackoverflow.com/questions/57383742/sort-dynamically-allocated-2d-array-by-first-column-in-c/57384153#57384153", "title": "Sort dynamically allocated 2D array by first column in C", "body": "<p>Your problem is you cannot <code>qsort</code> an object made from <em>pointer-to-pointer</em> as an array because there is no requirement that the allocated address be contiguous in memory. Instead you need to declare and allocate a <em>pointer-to-array of double [number_properties]</em> and allocate for both nodes and properties in a single call to ensure the object is contiguous in memory, e.g.</p>\n\n<pre><code>    /* Declare array */\n    double (*properties_array)[6];\n    properties_array = malloc(number_nodes * number_properties * sizeof(double));\n    if (!properties_array) {\n        perror (\"malloc-properties_array\");\n        return 1;\n    }\n</code></pre>\n\n<p>(<strong>note:</strong> that is technically a <em>pointer-to-VLA of double [number_properties]</em> unless an integer constant is used to specify the <code>number_properties</code> -- which is unclear from the way you declare <code>number_properties</code>, but then use an integer constant in your code. Just be aware if you choose to use a VLA in your code that feature is an implementation defined feature as of C11)</p>\n\n<p>Now your <code>qsort</code> compare can be written:</p>\n\n<pre><code>int Double_Compare_Function (const void * a, const void * b) {\n    if (*(double * const *)a &gt; *(double * const *)b) return 1;\n    else if (*(double * const *)a &lt; *(double * const *)b) return -1;\n    else return 0;\n}\n</code></pre>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/doublecmp\nInitial array...\n0: 2058999144.0 1013160096.0 499880968.0 1375376710.0 1398189150.0 579626176.0\n1: 35952305.0 349854458.0 1000340925.0 1397136257.0 2028006902.0 877319625.0\n2: 579560718.0 745830077.0 766399485.0 1052819099.0 1279742925.0 80594279.0\n3: 390212763.0 603717917.0 1542566382.0 654797188.0 957950686.0 807072250.0\n4: 1163825233.0 1748173998.0 261624942.0 152991913.0 269595164.0 2130895736.0\nSorted array...\n0: 35952305.0 349854458.0 1000340925.0 1397136257.0 2028006902.0 877319625.0\n1: 390212763.0 603717917.0 1542566382.0 654797188.0 957950686.0 807072250.0\n2: 579560718.0 745830077.0 766399485.0 1052819099.0 1279742925.0 80594279.0\n3: 1163825233.0 1748173998.0 261624942.0 152991913.0 269595164.0 2130895736.0\n4: 2058999144.0 1013160096.0 499880968.0 1375376710.0 1398189150.0 579626176.0\n</code></pre>\n\n<p><strong>Shorthand Compare Function</strong></p>\n\n<p>Note, you can also write the same double-compare function as a single return of the result of your conditionals, e.g.</p>\n\n<pre><code>int Double_Compare_Function (const void * a, const void * b)\n{\n    return (*(double * const *)a &gt; *(double * const *)b) -\n           (*(double * const *)a &lt; *(double * const *)b);\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 41, "user_id": 11844106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e9e5bedf1efbcaf42efec7aac3b077e?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/11844106/riley"}, "edited": false, "score": 0, "creation_date": 1565127928, "post_id": 57384298, "comment_id": 101252813, "body": "This works great as well! I will look this over until it makes sense to me. Thank you"}], "tags": [], "owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "is_accepted": false, "score": 1, "last_activity_date": 1565127999, "last_edit_date": 1565127999, "creation_date": 1565127258, "answer_id": 57384298, "question_id": 57383742, "link": "https://stackoverflow.com/questions/57383742/sort-dynamically-allocated-2d-array-by-first-column-in-c/57384298#57384298", "title": "Sort dynamically allocated 2D array by first column in C", "body": "<p>You would want to sort the pointers.</p>\n\n<p>Also you are missing <code>#include &lt;time.h&gt;</code></p>\n\n<p>Below I added the missing include, limited printing to only the first element of the array and limited the <code>rand()</code> output with <code>% 100</code>, so the numbers are smaller.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;time.h&gt;\n\nint Double_Compare_Function(const void *, const void *);\n\nint number_properties = 6; // number_properties\n\nint main()\n{\n    srand(time(0));\n    int p = 0; //property index\n    long long n = 0; //node index\n    long long number_nodes = 5; //number of nodes\n\n    /* Declare array */\n    double **properties_array;\n    properties_array = malloc(number_nodes * sizeof(double*));\n    for (n=0; n&lt;number_nodes; n++) {\n        properties_array[n] = malloc(number_properties * sizeof(double));\n    }\n\n    /* Fill array with numbers */\n    for (n=0; n&lt;number_nodes; n++) {\n        for (p=0; p&lt;number_properties; p++) {\n            properties_array[n][p] = rand() % 100;\n        }\n    }\n\n    printf(\"Initial array...\\n\");\n    for (n=0; n&lt;number_nodes; n++) {\n        printf(\"%lli: \", n);\n        for (p=0; p&lt;1; p++){\n            printf(\"%.1f \", properties_array[n][p]);\n        }\n        printf(\"\\n\");\n    }\n\n    /* Sort array */\n    qsort(properties_array, number_nodes, sizeof(double*),\n    Double_Compare_Function);\n\n    printf(\"Sorted array...\\n\");\n    for (n=0; n&lt;number_nodes; n++) {\n        printf(\"%lli: \", n);\n        for (p=0; p&lt;1; p++){\n            printf(\"%.1f \", properties_array[n][p]);\n        }\n        printf(\"\\n\");\n    }\n\n    return(0);\n}\n\nint Double_Compare_Function (const void * a, const void * b) {\n  const double * const *z = a;\n  const double * const *y = b;\n  // the z is a pointer to an array of doubles\n  // let's get the first element\n  const double k = (*z)[0];\n  const double m = (*y)[0];\n  return k &gt; m ? 1 : k &lt; m ? -1 : 0;\n}\n</code></pre>\n\n<p>The <code>Double_Compare_Function</code> receives two pointers that have the same type as <code>properties_array</code> - it's a <code>double**</code>. You need to dereference is twice. As each <code>properties_array</code> elements points to value returned by <code>malloc(number_properties * sizeof(double))</code>, I wanted to use the <code>[0]</code> to make it verbose I mean the first element of an array. The <code>(*z)[0]</code> is just the same as <code>**z</code>.</p>\n\n<p>Example execution:</p>\n\n<pre><code>Initial array...\n0: 3.0\n1: 94.0\n2: 35.0\n3: 24.0\n4: 71.0\nSorted array...\n0: 3.0\n1: 24.0\n2: 35.0\n3: 71.0\n4: 94.0\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 11844106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e9e5bedf1efbcaf42efec7aac3b077e?s=128&d=identicon&r=PG&f=1", "display_name": "Riley", "link": "https://stackoverflow.com/users/11844106/riley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 1, "accepted_answer_id": 57384153, "answer_count": 3, "score": 1, "last_activity_date": 1565130025, "creation_date": 1565124217, "last_edit_date": 1565127534, "question_id": 57383742, "link": "https://stackoverflow.com/questions/57383742/sort-dynamically-allocated-2d-array-by-first-column-in-c", "title": "Sort dynamically allocated 2D array by first column in C", "body": "<p>I have a large 2D array of doubles I would like to sort by first column. The array requires dynamic memory allocation as it is large (2GB).</p>\n\n<p>Below is a simplified example of my broken code using random numbers for example purposes.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint Double_Compare_Function ();\n\nint main()\n{\n    srand(time(0));\n    int p = 0; //property index\n    int number_properties = 6; // number_properties\n    long long n = 0; //node index\n    long long number_nodes = 5; //number of nodes\n\n    /* Declare array */\n    double **properties_array;\n    properties_array = malloc(number_nodes * sizeof(double*));\n    for (n=0; n&lt;number_nodes; n++) {\n        properties_array[n] = malloc(number_properties * sizeof(double));\n    }\n\n    /* Fill array with numbers */\n    for (n=0; n&lt;number_nodes; n++) {\n        for (p=0; p&lt;number_properties; p++) {\n            properties_array[n][p] = rand();\n        }\n    }\n\n    printf(\"Initial array...\\n\");\n    for (n=0; n&lt;number_nodes; n++) {\n        printf(\"%lli: \", n);\n        for (p=0; p&lt;number_properties; p++){\n            printf(\"%.1f \", properties_array[n][p]);\n        }\n        printf(\"\\n\");\n    }\n\n    /* Sort array */\n    qsort(properties_array, (int)number_nodes, number_properties*sizeof(double), Double_Compare_Function);\n\n    printf(\"Sorted array...\\n\");\n    for (n=0; n&lt;number_nodes; n++) {\n        printf(\"%lli: \", n);\n        for (p=0; p&lt;number_properties; p++){\n            printf(\"%.1f \", properties_array[n][p]);\n        }\n        printf(\"\\n\");\n    }\n\n    return(0);\n}\n\nint Double_Compare_Function (const void * a, const void * b) {\n    if (*(double*)a &gt; *(double*)b) return 1;\n    else if (*(double*)a &lt; *(double*)b) return -1;\n    else return 0;\n}\n</code></pre>\n\n<h2>Output</h2>\n\n<p>The program compiles without error (aside from random number generation warning). It appears to be pointing at memory I don't intend to.</p>\n\n<pre><code>Initial array...\n0: 17189.0 13476.0 24803.0 23588.0 9169.0 13351.0\n1: 20992.0 15638.0 23138.0 8580.0 32516.0 24064.0\n2: 27139.0 23745.0 19237.0 19279.0 19262.0 25303.0\n3: 19407.0 24529.0 23675.0 3102.0 23878.0 5831.0\n4: 15299.0 3845.0 27278.0 17467.0 28106.0 6918.0\nSorted array...\n0: 17189.0 13476.0 24803.0 23588.0 9169.0 13351.0\n1: 19262.0 25303.0 13104405306123376000000000000000000000000.0 0.0 32516.0 24064.0\n2: 27139.0 23745.0 1361751537953832600000000000000000000000000000000000000000000000000000.0 0.0 20992.0 15638.0\n3: 19407.0 24529.0 23675.0 3102.0 23878.0 5831.0\n4: 15299.0 3845.0 27278.0 17467.0 28106.0 6918.0\n</code></pre>\n\n<p>Question answered.</p>\n"}, {"tags": ["c++", "c", "unix", "linker"], "comments": [{"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1565123711, "post_id": 57383466, "comment_id": 101251429, "body": "I think, there is some misunderstanding there. static libraries are merely an archive of .o files, so there is no surprise that linker can treat a single .o file as a library. By itself it should not lead to any undefined behavior. I am afraid, you&#39;d have to work more on isolating the test case."}, {"owner": {"reputation": 1579, "user_id": 5215536, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/2b44d6db2f2f3fa384fd15d46f4f9c4d?s=128&d=identicon&r=PG&f=1", "display_name": "YiFei", "link": "https://stackoverflow.com/users/5215536/yifei"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1565124008, "post_id": 57383466, "comment_id": 101251534, "body": "@SergeyA, I understand <code>.a</code> is an archive of <code>.o</code> files. For simplicity let&#39;s just say <code>.a</code> is <code>.o</code>, the question is then how is <code>gcc a.o b.o</code> different from <code>gcc a.o -L. -l:b.o</code>."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1565124163, "post_id": 57383466, "comment_id": 101251595, "body": "This is exactly what I am saying, there is no real difference. Also, <code>-l:&lt;lib&gt;</code> is the syntax I am not familiar with, and I can&#39;t find it referenced anywhere. I assume it works, but I am pretty sure this is not conventional."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565124258, "post_id": 57383466, "comment_id": 101251629, "body": "<code>results undefined references</code> - what does that mean exactly?"}, {"owner": {"reputation": 1579, "user_id": 5215536, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/2b44d6db2f2f3fa384fd15d46f4f9c4d?s=128&d=identicon&r=PG&f=1", "display_name": "YiFei", "link": "https://stackoverflow.com/users/5215536/yifei"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565124613, "post_id": 57383466, "comment_id": 101251759, "body": "@KamilCuk, it literally just means <code>undefined reference to &lt;function&gt;</code> by the linker."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1565124621, "post_id": 57383466, "comment_id": 101251765, "body": "&quot;what are the differences between passing an object as a library and as a normal object file&quot; run gcc in verbose mode and check what it passes to the linker under the hood in both cases and see if there are any differences"}, {"owner": {"reputation": 1579, "user_id": 5215536, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/2b44d6db2f2f3fa384fd15d46f4f9c4d?s=128&d=identicon&r=PG&f=1", "display_name": "YiFei", "link": "https://stackoverflow.com/users/5215536/yifei"}, "reply_to_user": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1565124696, "post_id": 57383466, "comment_id": 101251794, "body": "@Slava, I&#39;ve run <code>ld</code> directly and saw no difference in some cases and failures in other cases. I believe it&#39;s not a <code>gcc</code> thing, but I will give it a try."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1565124745, "post_id": 57383466, "comment_id": 101251816, "body": "If that is the case then you should ask about <code>ld</code> not <code>gcc</code> or <code>g++</code>"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 1, "creation_date": 1565124820, "post_id": 57383466, "comment_id": 101251843, "body": "You know that the order of libraries matter in linker invocation? Maybe this could be an answer? The order of symbols doesn&#39;t matter when using .o files, while for .so files it&#39;s important?"}, {"owner": {"reputation": 1579, "user_id": 5215536, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/2b44d6db2f2f3fa384fd15d46f4f9c4d?s=128&d=identicon&r=PG&f=1", "display_name": "YiFei", "link": "https://stackoverflow.com/users/5215536/yifei"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565125054, "post_id": 57383466, "comment_id": 101251920, "body": "@KamilCuk, I do, so you&#39;re saying only the order matters not how it is passed in?"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565125144, "post_id": 57383466, "comment_id": 101251955, "body": "It&#39;s like connected? The order matters because .so files are passed using <code>-l</code> switch."}, {"owner": {"reputation": 1579, "user_id": 5215536, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/2b44d6db2f2f3fa384fd15d46f4f9c4d?s=128&d=identicon&r=PG&f=1", "display_name": "YiFei", "link": "https://stackoverflow.com/users/5215536/yifei"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565125629, "post_id": 57383466, "comment_id": 101252132, "body": "@KamilCuk, I guess that&#39;s why, at least very likely. When passing <code>.o</code> directly the objects were before external libraries, while when using <code>-l</code> they were appended at the end, and my crude experiments can confirm this. Can you please elaborate on the order difference between <code>.o</code> and <code>.so</code>?"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565125632, "post_id": 57383466, "comment_id": 101252133, "body": "But if you specify the <code>.a</code> files with <code>-l</code> switch, it will be the same, there is no difference."}], "answers": [{"comments": [{"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1565138583, "post_id": 57384030, "comment_id": 101254925, "body": "<i>Passing <code>-llibname.so</code> will make GNU linker traverse the library only once</i>...  <i>Specifying .a file directly to the linker makes it search for every symbol in all the object files inside the <code>.a</code> file</i>.  I&#39;m not seeing the distinction, and in fact I don&#39;t believe there <i>is</i> a distinction -- I&#39;ve always believed that specifying <code>-lx</code> versus (say) <code>&#47;lib&#47;libx.a</code> behaved identically."}], "tags": [], "owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "is_accepted": true, "score": 1, "last_activity_date": 1565125905, "last_edit_date": 1592644375, "creation_date": 1565125778, "answer_id": 57384030, "question_id": 57383466, "link": "https://stackoverflow.com/questions/57383466/passing-llibname-vs-passing-liblibname-a-directly-to-linker/57384030#57384030", "title": "Passing `-l&lt;libname&gt;` vs passing `lib&lt;libname&gt;.a` directly to linker?", "body": "<blockquote>\n<p>[How does] Passing <code>-l&lt;libname&gt;</code> vs [differ from] passing <code>lib&lt;libname&gt;.a</code> directly to linker?</p>\n</blockquote>\n<p>Passing <code>-llibname.so</code> will make GNU linker traverse the library only once when searching for a symbol (when not after <code>--whole-archive</code> option). Specifying <code>.a</code> file directly to the linker makes it search for every symbol in all the object files inside the <code>.a</code> file for every symbol, not only once.</p>\n<p>From the <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Link-Options.html\" rel=\"nofollow noreferrer\">GCC Linker options</a> (emphasis mine):</p>\n<blockquote>\n<p>-llibrary</p>\n<p>...</p>\n<p>It makes a difference where in the command you write this option; the linker searches and processes libraries and object files in the order they are specified. Thus, \u2018foo.o -lz bar.o\u2019 searches library \u2018z\u2019 after file foo.o but before bar.o. If bar.o refers to functions in \u2018z\u2019, those functions may not be loaded.</p>\n</blockquote>\n<p>From <a href=\"https://sourceware.org/binutils/docs-2.27/ld/Options.html#Options\" rel=\"nofollow noreferrer\">binutils ld options</a>:</p>\n<blockquote>\n<p>-l namespec</p>\n<p>...</p>\n<p>The linker will search an archive only once, at the location where it is specified on the command line. If the archive defines a symbol which was undefined in some object which appeared before the archive on the command line, the linker will include the appropriate file(s) from the archive. However, an undefined symbol in an object appearing later on the command line will not cause the linker to search the archive again.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 1, "last_activity_date": 1565126968, "creation_date": 1565126968, "answer_id": 57384240, "question_id": 57383466, "link": "https://stackoverflow.com/questions/57383466/passing-llibname-vs-passing-liblibname-a-directly-to-linker/57384240#57384240", "title": "Passing `-l&lt;libname&gt;` vs passing `lib&lt;libname&gt;.a` directly to linker?", "body": "<blockquote>\n  <p>what are the differences between passing an object as a library and as a normal object file, and are there any differences when it comes to C++?</p>\n</blockquote>\n\n<p>That depends on the implementation.  In the most general sense, Unix-style linkers such as you are asking about <em>search for</em> objects named via <code>-l</code> options in a library search path, whereas if you name a file directly, you must specify the exact file.</p>\n\n<p>Additionally, if you use an <code>-l</code> option to specify a file to link then, in the general case, the linker constructs a filename from the argument by prepending \"lib\" and appending \".a\", or in some other way, such as by searching also or instead for \".so\" files.  (The GNU linker that you appear to be using provides an exception to this behavior when the first character of the argument is <code>:</code>.  In that case it takes the rest of the argument as an exact file name, and searches for that.)</p>\n\n<p>Many linkers also accept explicit library names specified on the command line (e.g. <code>libfoo.a</code> instead of <code>-lfoo</code>), so these need to be able to determine what type of file each is.  Normally this is by examining the file, not by relying on its name.  And GNU <code>ld</code>, at least, extends this file type detection to files specified via <code>-l</code> options.</p>\n\n<p>The order in which objects and libraries are specified on the command line, by whatever specific form, matters to typical linker implementations.  For example, <a href=\"https://sourceware.org/binutils/docs/ld/index.html\" rel=\"nofollow noreferrer\">the docs for GNU ld</a> specify that</p>\n\n<blockquote>\n  <p>options which refer to files, such as \u2018-l\u2019 or \u2018-T\u2019, cause the file to\n  be read at the point at which the option appears in the command line,\n  relative to the object files and other file options</p>\n</blockquote>\n\n<p>which is important because</p>\n\n<blockquote>\n  <p>The linker will search an archive only once, at the location where it\n  is specified on the command line. If the archive defines a symbol\n  which was undefined in some object which appeared before the archive\n  on the command line, the linker will include the appropriate file(s)\n  from the archive. However, an undefined symbol in an object appearing\n  later on the command line will not cause the linker to search the\n  archive again.</p>\n</blockquote>\n\n<p>But of course</p>\n\n<blockquote>\n  <p>You may list the same archive multiple times on the command line.</p>\n</blockquote>\n\n<p>The docs are not altogether clear on this, but empirically, the use of the term \"archive\" in the above is significant.  It is effectively only <em>archive</em> files -- static libraries -- to which the \"searched only once\" provision applies.  To a first approximation, the relative order of different ordinary object files and shared libraries on the GNU linker's command line, no matter how designated, does not impact symbol resolution.</p>\n\n<p>So yes, it does matter whether you specify regular object files or static archives or shared libraries to the (GNU) linker, and their order matters to some extent, but the <em>manner</em> in which you specify them does not matter.</p>\n\n<blockquote>\n  <p>I have also seen case where this trick doesn't work and results undefined references.</p>\n</blockquote>\n\n<p>With the GNU linker, that will be because of genuinely missing libraries or objects, or because of an unsuitable order of static archives relative to other object files or archives.  Some other linkers are more sensitive.</p>\n"}, {"tags": [], "owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "is_accepted": false, "score": 0, "last_activity_date": 1565140686, "last_edit_date": 1565140686, "creation_date": 1565139137, "answer_id": 57385654, "question_id": 57383466, "link": "https://stackoverflow.com/questions/57383466/passing-llibname-vs-passing-liblibname-a-directly-to-linker/57385654#57385654", "title": "Passing `-l&lt;libname&gt;` vs passing `lib&lt;libname&gt;.a` directly to linker?", "body": "<p>Short answers:</p>\n\n<ol>\n<li><p>The <code>-L</code> and <code>-l</code> options provide a shortcut for locating library archives (and shared libraries).  But once you've used <code>-l</code> to locate a library (in the standard locations, or in a location specified by <code>-L</code>), the reading of that library is identical to the way it would be read if you specified its filename (e.g. <code>/lib/libx.a</code>) at the same spot on the command line explicitly.</p></li>\n<li><p>When you specify a single object (<code>.o</code>) file, the entire contents of that file get loaded unconditionally.  When you specify a library archive (<code>.a</code>) file, only those objects within it that are necessary (to satisfy outstanding undefined references) are loaded.</p></li>\n</ol>\n"}], "owner": {"reputation": 1579, "user_id": 5215536, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/2b44d6db2f2f3fa384fd15d46f4f9c4d?s=128&d=identicon&r=PG&f=1", "display_name": "YiFei", "link": "https://stackoverflow.com/users/5215536/yifei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 57384030, "answer_count": 3, "score": 1, "last_activity_date": 1565140686, "creation_date": 1565122911, "last_edit_date": 1565124099, "question_id": 57383466, "link": "https://stackoverflow.com/questions/57383466/passing-llibname-vs-passing-liblibname-a-directly-to-linker", "title": "Passing `-l&lt;libname&gt;` vs passing `lib&lt;libname&gt;.a` directly to linker?", "body": "<p>Suppose I have two files</p>\n\n<pre><code>// a.c\nint a() {return 1;}\n\n// b.c\nint a();\nint b() {return a();}\n</code></pre>\n\n<p>and I compile them to <code>a.o</code> and <code>b.o</code>, respectively.</p>\n\n<p>In an attempt to make an executable or shared library, one can call <code>gcc a.o b.o -o libab.so -shared</code>. But I also noticed that one can also call <code>gcc b.o -L. -l:a.o -o libab.so -shared</code> to generate (apparently) the same output. To my surprise, even running <code>gcc a.o -L. -l:b.o -shared</code> results in a library that has both <code>a()</code> and <code>b()</code>. (Shouldn't linker discard the unused library <code>b.o</code> since <code>a.o</code> does not depend on it?)</p>\n\n<p>The latter two presumably pass <code>a</code> in as if <code>a.o</code> was a library. Now if I run <code>ar rcs liba.a a.o</code>, <code>gcc b.o -L. -l:liba.a -shared</code> and <code>gcc b.o liba.a -shared</code> both run without any problem and give the same output.</p>\n\n<p>However, I have also seen case where this trick doesn't work and results undefined references. My question is therefore as the titles says: what are the differences between passing an object as a library and as a normal object file, and are there any differences when it comes to C++?</p>\n\n<p><em>The problem arose in a much larger project. Sorry for lacking mcve because I can't seem to isolate the problem.</em></p>\n"}, {"tags": ["c", "arrays"], "comments": [{"owner": {"reputation": 3092, "user_id": 648368, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/nsODi.jpg?s=128&g=1", "display_name": "Tomer W", "link": "https://stackoverflow.com/users/648368/tomer-w"}, "edited": false, "score": 1, "creation_date": 1565122853, "post_id": 57383419, "comment_id": 101251141, "body": "would just search for the dot in each array and align the dot with trailing Zeros... then it is a regular sum"}], "answers": [{"comments": [{"owner": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "edited": false, "score": 0, "creation_date": 1565127287, "post_id": 57384171, "comment_id": 101252635, "body": "thanks for the answer but it won&#39;t work for big numbers because of the limitation of double."}, {"owner": {"reputation": 51, "user_id": 9414276, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nAZUv0hj-YY/AAAAAAAAAAI/AAAAAAAAbBk/m-H19wONz1w/photo.jpg?sz=128", "display_name": "Abhishek Saxena", "link": "https://stackoverflow.com/users/9414276/abhishek-saxena"}, "reply_to_user": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "edited": false, "score": 0, "creation_date": 1565128001, "post_id": 57384171, "comment_id": 101252842, "body": "You simply use an array of integers and perform the arithmetic operations manually. reference: <a href=\"https://www.quora.com/Which-data-type-is-used-to-store-values-as-large-as-100-In-C\" rel=\"nofollow noreferrer\">quora.com/&hellip;</a>"}], "tags": [], "owner": {"reputation": 51, "user_id": 9414276, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nAZUv0hj-YY/AAAAAAAAAAI/AAAAAAAAbBk/m-H19wONz1w/photo.jpg?sz=128", "display_name": "Abhishek Saxena", "link": "https://stackoverflow.com/users/9414276/abhishek-saxena"}, "is_accepted": false, "score": 0, "last_activity_date": 1565126492, "creation_date": 1565126492, "answer_id": 57384171, "question_id": 57383419, "link": "https://stackoverflow.com/questions/57383419/performing-a-sum-between-two-arrays-of-digis/57384171#57384171", "title": "Performing a sum between two arrays of digis", "body": "<p>I am not sure whether this is the best solution or not but here's a solution and I hope it helps.</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;math.h&gt;\n\ndouble convertNumber(char *arr){\n   int i;\n   int flag_d=0; //To check whether we are reading digits before or after decimal\n   double a=0;\n   int j=1;\n   for(i=0;i&lt;arr[i]!='\\0';i++){\n       if(arr[i] !='.'){\n           if(flag_d==0)\n              a = a*10 + arr[i]-48;\n           else{\n              a = a + (arr[i]-48.0)/pow(10, j);\n              j++;\n           }\n       }else{\n           flag_d=1;\n       }\n   }\n   return a;\n}\n\nint main() {\n   char num1[] = \"23.20\";\n   char num2[] = \"20.2\";\n   printf(\"%.6lf\", convertNumber(num1) + convertNumber(num2));\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1780, "user_id": 715363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a863a21a7ba2588adc3fc69d4949110b?s=128&d=identicon&r=PG", "display_name": "wkz", "link": "https://stackoverflow.com/users/715363/wkz"}, "reply_to_user": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 0, "creation_date": 1565187133, "post_id": 57384455, "comment_id": 101274522, "body": "@thebusybee of course not, I never claimed that it did. I simply wanted to make the point that, given the loose requirements, this solution should be acceptable."}], "tags": [], "owner": {"reputation": 1780, "user_id": 715363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a863a21a7ba2588adc3fc69d4949110b?s=128&d=identicon&r=PG", "display_name": "wkz", "link": "https://stackoverflow.com/users/715363/wkz"}, "is_accepted": false, "score": 1, "last_activity_date": 1565128153, "creation_date": 1565128153, "answer_id": 57384455, "question_id": 57383419, "link": "https://stackoverflow.com/questions/57383419/performing-a-sum-between-two-arrays-of-digis/57384455#57384455", "title": "Performing a sum between two arrays of digis", "body": "<blockquote>\n  <p>The algorithm was not important</p>\n</blockquote>\n\n<p>Ok, I'll let <code>libc</code> do it for me in that case (obviously error handling is missing):</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>void sum(char *as, char *bs, char *out, int precision)\n{\n    float a, b;\n\n    sscanf(as, \"%f\", &amp;a);\n    sscanf(bs, \"%f\", &amp;b);\n\n    a += b;\n\n    sprintf(out, \"%.*f\", precision, a);\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 665, "user_id": 4946720, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/622978bee90b9bd34da2af337578bf32?s=128&d=identicon&r=PG&f=1", "display_name": "some user", "link": "https://stackoverflow.com/users/4946720/some-user"}, "is_accepted": false, "score": 1, "last_activity_date": 1565140198, "creation_date": 1565140198, "answer_id": 57385746, "question_id": 57383419, "link": "https://stackoverflow.com/questions/57383419/performing-a-sum-between-two-arrays-of-digis/57385746#57385746", "title": "Performing a sum between two arrays of digis", "body": "<p>It actually took me a lot longer than 20 mins to do this. The code is fairly long too so I don't plan on posting it here. In a nutshell, the code does:</p>\n\n<ol>\n<li>normalize the 2 numbers into 2 new strings so they have the same number of decimal digits</li>\n<li>allocate a new string with length of longer of the 2 strings above + 1</li>\n<li>add the 2 strings together, 2 digits at a time, with carrier</li>\n<li>it is not clear if the final answer needs to be rounded. If not, just expand/truncate the decimals to m digits. Remove any leading zero if needed. </li>\n</ol>\n"}], "owner": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1565140198, "creation_date": 1565122665, "question_id": 57383419, "link": "https://stackoverflow.com/questions/57383419/performing-a-sum-between-two-arrays-of-digis", "title": "Performing a sum between two arrays of digis", "body": "<p>Had an interview today and I was asked the following question - given two arrays <code>arr1</code> and <code>arr2</code> of chars where they contain only numbers and one dot and also given a value <code>m</code>, sum them into one array of chars where they contain <code>m</code> digits after the dot. The program should be written in <code>C</code>. The algorithm was not important for them, they just gave me a compiler and 20 minutes to pass their tests.</p>\n\n<p>First of all I though to find the maximum length and iterate through the array from the end and sum the values while keeping the carry:</p>\n\n<pre><code>int length = (firstLength &lt; secondLength) ? secondLength : firstLength;\nchar[length] result;\nfor (int i = length - 1; i &gt;= 0; i--) {\n    // TODO: add code\n}\n</code></pre>\n\n<p>The problem is that for some reason I'm not sure what is the right way to perform that sum while keeping with the dot. This loop should just perform the look and not counter to <code>k</code>. I mean that at this point I thought just adding the values and at the end i'll insert another loop which will print <code>k</code> values after the dot.\nMy question is how should look the first loop I mentioned (the one that actually sums), I'm really got stuck on it.</p>\n"}, {"tags": ["c", "linux", "embedded-linux", "ext4", "fsync"], "comments": [{"owner": {"reputation": 102109, "user_id": 1600898, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/01377f8b31f24b0265854666b29d0c03?s=128&d=identicon&r=PG", "display_name": "user4815162342", "link": "https://stackoverflow.com/users/1600898/user4815162342"}, "edited": false, "score": 0, "creation_date": 1565122640, "post_id": 57383333, "comment_id": 101251069, "body": "If you don&#39;t care when the changes will be written out, then don&#39;t call <code>fsync</code> - after all, its whole <i>point</i> is to notify you (by virtue of unblocking the thread when done) that the writing is finished. If <code>fsync</code> were really needed for crash safety, how would such scheme handle a crash right before the call to <code>fsync</code>?"}, {"owner": {"reputation": 8002, "user_id": 1143850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2927fac544c9960cd5433688fe4cae1d?s=128&d=identicon&r=PG", "display_name": "Serge", "link": "https://stackoverflow.com/users/1143850/serge"}, "edited": false, "score": 0, "creation_date": 1565122823, "post_id": 57383333, "comment_id": 101251131, "body": "i did not understand your question. As soon as you ask an operating system to write something, it will eventually write it. Crash of the application could prevent from all writes to finish. If you want to guarantee that your data is written before you continue the application, than you must block the application (use fsync or whatever). Which scheme you are interested int?"}, {"owner": {"reputation": 51, "user_id": 11891325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50c1f771d43bf3a14012420540823be4?s=128&d=identicon&r=PG&f=1", "display_name": "Peteman720", "link": "https://stackoverflow.com/users/11891325/peteman720"}, "reply_to_user": {"reputation": 102109, "user_id": 1600898, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/01377f8b31f24b0265854666b29d0c03?s=128&d=identicon&r=PG", "display_name": "user4815162342", "link": "https://stackoverflow.com/users/1600898/user4815162342"}, "edited": false, "score": 0, "creation_date": 1565123002, "post_id": 57383333, "comment_id": 101251199, "body": "@user4815162342 It was my understanding that <code>ext4</code> was (originally) susceptible to data-loss when <code>fsync</code> is not used due to the <b>delayed allocation</b> mechanism <a href=\"https://www.thomas-krenn.com/en/wiki/Ext4_Filesystem#Data_Loss_with_Applications_that_do_not_use_fsync()_correctly\" rel=\"nofollow noreferrer\">link</a>."}, {"owner": {"reputation": 51, "user_id": 11891325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50c1f771d43bf3a14012420540823be4?s=128&d=identicon&r=PG&f=1", "display_name": "Peteman720", "link": "https://stackoverflow.com/users/11891325/peteman720"}, "reply_to_user": {"reputation": 8002, "user_id": 1143850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2927fac544c9960cd5433688fe4cae1d?s=128&d=identicon&r=PG", "display_name": "Serge", "link": "https://stackoverflow.com/users/1143850/serge"}, "edited": false, "score": 0, "creation_date": 1565123448, "post_id": 57383333, "comment_id": 101251347, "body": "@Serge In my case, the data does not need to be written before the application continues. My concern is that the file remains valid (out-of-date is OK) even if power is lost during a write operation."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 1, "creation_date": 1565123560, "post_id": 57383333, "comment_id": 101251378, "body": "Create another thread. Call fsync in another thread. Notify the calling thread after fsync. There is also posix aio."}, {"owner": {"reputation": 8002, "user_id": 1143850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2927fac544c9960cd5433688fe4cae1d?s=128&d=identicon&r=PG", "display_name": "Serge", "link": "https://stackoverflow.com/users/1143850/serge"}, "edited": false, "score": 2, "creation_date": 1565124350, "post_id": 57383333, "comment_id": 101251666, "body": "@Peteman720 In this case i would follow the procedure you described in your post. You can probably run all those steps from a thread, to minimize blocking effect."}, {"owner": {"reputation": 51, "user_id": 11891325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50c1f771d43bf3a14012420540823be4?s=128&d=identicon&r=PG&f=1", "display_name": "Peteman720", "link": "https://stackoverflow.com/users/11891325/peteman720"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1565124355, "post_id": 57383333, "comment_id": 101251669, "body": "@KamilCuk I was hoping to avoid the added complexity of another thread, but perhaps that is my only feasible option."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 2, "creation_date": 1565124521, "post_id": 57383333, "comment_id": 101251728, "body": "There is <code>aio_fsync</code>. And glibcs implementation of <code>aio_fsync</code> just does the same work for you -  <code>aio_fsync</code> creates another thread, calls <code>fsync</code> in that thread and <code>raise</code>s a signal for you."}, {"owner": {"reputation": 102109, "user_id": 1600898, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/01377f8b31f24b0265854666b29d0c03?s=128&d=identicon&r=PG", "display_name": "user4815162342", "link": "https://stackoverflow.com/users/1600898/user4815162342"}, "edited": false, "score": 0, "creation_date": 1565126122, "post_id": 57383333, "comment_id": 101252288, "body": "@Peteman720 If ext4 is susceptible to data loss if fsync is not called, what happens if the application (or the whole system) crashes before being able to call it? The page you linked doesn&#39;t provide details, unfortunately."}, {"owner": {"reputation": 51, "user_id": 11891325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50c1f771d43bf3a14012420540823be4?s=128&d=identicon&r=PG&f=1", "display_name": "Peteman720", "link": "https://stackoverflow.com/users/11891325/peteman720"}, "reply_to_user": {"reputation": 102109, "user_id": 1600898, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/01377f8b31f24b0265854666b29d0c03?s=128&d=identicon&r=PG", "display_name": "user4815162342", "link": "https://stackoverflow.com/users/1600898/user4815162342"}, "edited": false, "score": 0, "creation_date": 1565127092, "post_id": 57383333, "comment_id": 101252580, "body": "@user4815162342 Good question! If we are following the 5 steps that I listed above, then I believe that only the <i>temporary</i> file would be lost if the program crashed before <code>fsync</code>.  Corruption of the <i>real</i> file would occur if the <code>rename</code> took place before all of the new data was written to disk:  1.) new temp file created (empty on disk).    2.) new data in RAM (waiting to go to disk).    3.) <code>rename</code> points the <i>real</i> path the <i>temp</i> file on disk.   4.) power loss!   5.) reboot, to find that the <i>real</i> path points to a file on disk that is 0 bytes.  That&#39;s my understanding anyway."}, {"owner": {"reputation": 102109, "user_id": 1600898, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/01377f8b31f24b0265854666b29d0c03?s=128&d=identicon&r=PG", "display_name": "user4815162342", "link": "https://stackoverflow.com/users/1600898/user4815162342"}, "edited": false, "score": 2, "creation_date": 1565161808, "post_id": 57383333, "comment_id": 101260319, "body": "@Peteman720 So, the point of <code>fsync</code> is to prevent the program from doing something unsafe (execute <code>rename</code>) before its time (all the new data was written to disk). The waiting is not just a nuisance, it&#39;s a crucial part of the algorithm. If the you don&#39;t plan to wait for the fsync in step 3 to finish, it doesn&#39;t make much sense to call it in the first place."}, {"owner": {"reputation": 51, "user_id": 11891325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50c1f771d43bf3a14012420540823be4?s=128&d=identicon&r=PG&f=1", "display_name": "Peteman720", "link": "https://stackoverflow.com/users/11891325/peteman720"}, "reply_to_user": {"reputation": 102109, "user_id": 1600898, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/01377f8b31f24b0265854666b29d0c03?s=128&d=identicon&r=PG", "display_name": "user4815162342", "link": "https://stackoverflow.com/users/1600898/user4815162342"}, "edited": false, "score": 0, "creation_date": 1565184217, "post_id": 57383333, "comment_id": 101272617, "body": "@user4815162342 Yes, it is essential that the new data is written to disk (<code>fsync</code>) before the <code>rename</code> operation is completed on disk, but I would rather not force my program to wait for this whole process. My hope is that the OS could &quot;buffer&quot; the <code>fsync</code> and <code>rename</code> operations in RAM, and then write them to disk <i>in the proper order</i> whenever it is convenient. My purpose with this question was to ask whether such a thing is possible on Linux with ext4."}, {"owner": {"reputation": 102109, "user_id": 1600898, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/01377f8b31f24b0265854666b29d0c03?s=128&d=identicon&r=PG", "display_name": "user4815162342", "link": "https://stackoverflow.com/users/1600898/user4815162342"}, "edited": false, "score": 1, "creation_date": 1565196410, "post_id": 57383333, "comment_id": 101279551, "body": "I think you should mention this &quot;buffering&quot; in the question, because it&#39;s far from obvious that that&#39;s the kind of thing you&#39;re looking for. I don&#39;t think it exists on linux or other Unix-like systems."}], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 3596665, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/86Nus.png?s=128&g=1", "display_name": "sander", "link": "https://stackoverflow.com/users/3596665/sander"}, "is_accepted": false, "score": 0, "last_activity_date": 1565637043, "creation_date": 1565637043, "answer_id": 57466934, "question_id": 57383333, "link": "https://stackoverflow.com/questions/57383333/how-to-write-a-file-atomically-and-asynchronously-in-linux-using-c/57466934#57466934", "title": "How to write a file atomically and asynchronously in Linux using C", "body": "<p>I've found that Linux file systems are remarkably resilient and reliable. I'd be suspicious discussions of ext4 issues that are mostly from 2009. Linux info goes stale.</p>\n\n<p>That said, if the requirement is to guarantee that you use the latest correct version of the file, add a step to check that the file is correct. One way is to use Linux tools to generate a hash of the file. Maybe there's a faster approach that works with your specific data, like looking for a specific file length.</p>\n\n<p>With that in place, your algorithm could be:</p>\n\n<ol>\n<li>Rename the current file to indicate that it is an old copy.</li>\n<li>Write the new file</li>\n<li>Calculate the hash of the new file</li>\n</ol>\n\n<p>Now when you boot, or whenever you use the file, you can check the hash and if that fails, revert to the latest old copy.</p>\n\n<p>The advantage to this plan is that the hash will protect you from any source of corruption to the file, not just ext4 file system issues.</p>\n"}], "owner": {"reputation": 51, "user_id": 11891325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50c1f771d43bf3a14012420540823be4?s=128&d=identicon&r=PG&f=1", "display_name": "Peteman720", "link": "https://stackoverflow.com/users/11891325/peteman720"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 244, "favorite_count": 2, "answer_count": 1, "score": 5, "last_activity_date": 1565637043, "creation_date": 1565122282, "last_edit_date": 1565202695, "question_id": 57383333, "link": "https://stackoverflow.com/questions/57383333/how-to-write-a-file-atomically-and-asynchronously-in-linux-using-c", "title": "How to write a file atomically and asynchronously in Linux using C", "body": "<h2>Question</h2>\n\n<p>How can I update a file atomically without requiring my program to wait for slow physical media (such as with <code>fsync</code>)?</p>\n\n<p>My hope is that the OS could \"buffer\" the typical <code>fsync</code> and <code>rename</code> operations in RAM, and then write them to disk <em>in the proper order</em> whenever it is convenient.</p>\n\n<hr>\n\n<h2>Background</h2>\n\n<p>I am developing software that runs in a custom embedded Linux environment with an <code>ext4</code> filesystem. The program makes periodic updates to a file on disk. I need to maintain the integrity of this file without sacrificing application performance.</p>\n\n<p>From what I have <a href=\"https://lwn.net/Articles/457667/\" rel=\"nofollow noreferrer\">read</a>, the accepted practice for <em>safely</em> updating a file is as follows:</p>\n\n<ol>\n<li>create a new temp file</li>\n<li>write data to the temp file </li>\n<li><code>fsync()</code> the temp file </li>\n<li>rename the temp file to the appropriate name </li>\n<li><code>fsync()</code> the containing directory</li>\n</ol>\n\n<p>This process makes sense to me, but in my particular application, I would like to avoid a blocking call to <code>fsync()</code>. I don't care when the data is written to disk, so long as the file is always in a valid state. If the file is out-of-date, that is OK.</p>\n\n<hr>\n\n<h2>What I've Learned So Far</h2>\n\n<p>It seems that there is already quite a bit of discussion around <code>ext4</code> and the proper use of <code>fsync</code>. If I understand correctly, I <em>might</em> be able to forgo the use of <code>fsync</code> if <code>auto_da_alloc</code> is enabled for my filesystem (<a href=\"https://unix.stackexchange.com/questions/464382\">link</a>), but I'm not convinced that is the best solution.</p>\n"}, {"tags": ["c", "arrays", "string", "pointers", "struct"], "answers": [{"comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565123691, "post_id": 57383406, "comment_id": 101251419, "body": "<code>calloc(256, sizeof(data-&gt;name[0][0]));</code> limits the size of the string to 255 bytes. What if this were pages of a book or extremely large numbers?"}, {"owner": {"reputation": 5813, "user_id": 1075282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70efe94a6c2237ec96f429402a03a27d?s=128&d=identicon&r=PG", "display_name": "Renat", "link": "https://stackoverflow.com/users/1075282/renat"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 1, "creation_date": 1565124347, "post_id": 57383406, "comment_id": 101251663, "body": "@JL2210, <code>%u</code> means decimal representation of <code>unsigned int</code> ( <a href=\"https://en.cppreference.com/w/cpp/io/c/fprintf\" rel=\"nofollow noreferrer\">en.cppreference.com/w/cpp/io/c/fprintf</a> ). Which is most probably 4 bytes ( <a href=\"https://en.cppreference.com/w/cpp/language/types\" rel=\"nofollow noreferrer\">en.cppreference.com/w/cpp/language/types</a> ), and not more than 8 bytes, so fits into 256 characters. Of course this is a toy example, better to measure before allocation."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1565154507, "post_id": 57383406, "comment_id": 101257793, "body": "&quot;Which is most probably 4 bytes ...  and not more than 8 bytes&quot; is unclear.  As a 32-bit <code>unsigned</code> a decimal representation would need 11 byes to store <code>&quot;4294967295&quot;</code> - which also fits in 256 bytes - yes quite excessive."}], "tags": [], "owner": {"reputation": 5813, "user_id": 1075282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70efe94a6c2237ec96f429402a03a27d?s=128&d=identicon&r=PG", "display_name": "Renat", "link": "https://stackoverflow.com/users/1075282/renat"}, "is_accepted": false, "score": 1, "last_activity_date": 1565128427, "last_edit_date": 1565128427, "creation_date": 1565122605, "answer_id": 57383406, "question_id": 57383327, "link": "https://stackoverflow.com/questions/57383327/how-to-use-sprintf-snprintf-with-double-pointer-char-arrays/57383406#57383406", "title": "How to use sprintf/snprintf with double pointer char arrays", "body": "<p>You need:</p>\n\n<pre><code> struct data *data = calloc(1, sizeof(*data)); \n data-&gt;name = calloc(DYNAMIC_ELEMENTS, sizeof(data-&gt;name[0]));\n\n for (int i = 0; i &lt; DYNAMIC_ELEMENTS; i++) { /* correctly count till 10 */\n     data-&gt;name[i] = calloc(256, sizeof(data-&gt;name[0][0])); /* allocate memory before copying to it */\n     ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "is_accepted": true, "score": 1, "last_activity_date": 1565123590, "last_edit_date": 1565123590, "creation_date": 1565122685, "answer_id": 57383422, "question_id": 57383327, "link": "https://stackoverflow.com/questions/57383327/how-to-use-sprintf-snprintf-with-double-pointer-char-arrays/57383422#57383422", "title": "How to use sprintf/snprintf with double pointer char arrays", "body": "<p>This:</p>\n\n<pre><code>i &lt;= DYNAMIC_ELEMENTS\n</code></pre>\n\n<p>is accessing past the bounds of the memory that you've allocated. You should use:</p>\n\n<pre><code>i &lt; DYNAMIC_ELEMENTS\n</code></pre>\n\n<p>You should also allocate memory for each individual string:</p>\n\n<pre><code>data-&gt;name[i] = calloc(1, snprintf(NULL, 0, \"Name %u\", i + 1));\n</code></pre>\n\n<p>Full example:</p>\n\n<pre><code>for (int i = 0; i &lt; DYNAMIC_ELEMENTS; i++) {\n    data-&gt;name[i] = calloc(1, snprintf(NULL, 0, \"Name %u\", i + 1));\n    sprintf(data-&gt;name[i], \"Name %u\", i + 1);\n    printf(\"%s\\n\", data-&gt;name[i]);\n}\n</code></pre>\n\n<p>The reason that this works:</p>\n\n<pre><code>//...\nchar buf[127];\nsprintf(buf, \"Name %u\", i + 1);     \ndata-&gt;name[i] = strdup(buf);\n//...\n</code></pre>\n\n<p>is because you're allocating memory with <code>strdup</code> and assigning it to <code>data-&gt;name[i]</code>.</p>\n"}], "owner": {"reputation": 312, "user_id": 7712908, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc8ff5e444c5ef577c7c14adf34dd362?s=128&d=identicon&r=PG&f=1", "display_name": "blackbeard", "link": "https://stackoverflow.com/users/7712908/blackbeard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 2, "accepted_answer_id": 57383422, "answer_count": 2, "score": 3, "last_activity_date": 1565128427, "creation_date": 1565122254, "question_id": 57383327, "link": "https://stackoverflow.com/questions/57383327/how-to-use-sprintf-snprintf-with-double-pointer-char-arrays", "title": "How to use sprintf/snprintf with double pointer char arrays", "body": "<p>The code below 'should' store arrays of strings in the varible <code>name</code> which <strong>needs</strong> to be under <code>struct data</code>. Suppose that the number of array elements are determined at the runtime, and in the example code below they are defined with <code>DYNAMIC_ELEMENTS</code>. The strings are formated using <code>sprintf</code>.</p>\n\n<pre><code>#define DYNAMIC_ELEMENTS 10\n\nstruct data {\n    char **name;\n};\n\nint main()\n{\n struct data *data = calloc(1, sizeof(*data));\n data-&gt;name = calloc(DYNAMIC_ELEMENTS, sizeof(data-&gt;name[0]));\n\n for (int i = 0; i &lt;= DYNAMIC_ELEMENTS; i++) {\n     sprintf(data-&gt;name[i], \"Name %u\", i + 1);\n     printf(\"%s\\n\", data-&gt;name[i]);\n }\n  return 0;\n}\n</code></pre>\n\n<p>As I run this code, I get a segfault. The error is coming from the line</p>\n\n<p><code>sprintf(data-&gt;name[i], \"Name %u\", i + 1);</code></p>\n\n<p>Any idea whats going wrong here?</p>\n\n<p>Update: The code complies if I take the approach below (but I would like to avoid this):</p>\n\n<pre><code>//...\nchar buf[127];\nsprintf(buf, \"Name %u\", i + 1);     \ndata-&gt;name[i] = strdup(buf);\n//...\n</code></pre>\n"}, {"tags": ["c", "loops"], "comments": [{"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 3, "creation_date": 1565122072, "post_id": 57383244, "comment_id": 101250897, "body": "You&#39;re potentially exceeding top-end array boundaries in every single one of those loops. And <code>n</code> is indeterminate when <code>arr[n]</code> is declared anyway, so that too, is wrong. Move the declaration of <code>arr[n]</code> <i>after</i> you read <code>n</code> from stdin (which you should be checking for success and in-range validity, but that&#39;s another separate issue)."}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1565122398, "post_id": 57383244, "comment_id": 101250998, "body": "You&#39;ll also should hard-set <i>just</i> <code>arr[0] = 0;</code> after the decl once it&#39;s moved."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565122592, "post_id": 57383244, "comment_id": 101251058, "body": "<a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a><a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a><a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}], "answers": [{"tags": [], "owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "is_accepted": false, "score": 1, "last_activity_date": 1565122738, "creation_date": 1565122738, "answer_id": 57383434, "question_id": 57383244, "link": "https://stackoverflow.com/questions/57383244/i-am-using-4-for-lopp-2-are-working-correct-rest-2-are-showing-issue-3-and-4-l/57383434#57383434", "title": "i am using 4 for lopp , 2 are working correct rest 2 are showing issue 3 and 4 loop are showing invalid answer", "body": "<p>Among the things wrong in this code</p>\n\n<ul>\n<li>Your decl of <code>arr[n]</code> is based on an <em>indeterminate</em> <code>n</code> value. The array doesn't magically resize when you read <code>n</code> later in your program. <code>n</code> has to be known before the <code>arr</code> decl.</li>\n<li>Your loop limits are potentially out of range (and <em>definitely</em> with the first loop).</li>\n<li>The <code>scanf</code> call to populate <code>n</code> isn't checked for successful stdin input. Never assume your IO works, <em>especially</em> the 'I' in IO.</li>\n</ul>\n\n<p>Just fixing those:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void)\n{\n    int n, i, l = 0, m = 0, u = 0, d = 0;\n\n    printf(\"enter the value of n\");\n    if (scanf(\"%d\", &amp;n) == 1 &amp;&amp; n &gt; 0)\n    {\n        int arr[n];\n        arr[0] = 0;\n\n        for (i = 0; i&lt;(n - 1); i++) {\n            arr[i + 1] = arr[i] + 10;\n        }\n\n        printf(\"%d\", arr[3]);\n\n        for (i = 1; i &lt; n; i += 4) {\n            l = arr[i] + l;\n        }\n\n        for (i = 2; i &lt; n; i += 4) {\n            u = arr[i] + u;\n        }\n\n        for (i = 3; i &lt; n; i += 4) {\n            m = arr[i] + m;\n        }\n\n        printf(\"\\n%d\\n\", l);\n        printf(\"%d\\n\", u);\n        printf(\"%d\\n\", m);\n        printf(\"%d\\n\", d);\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p><a href=\"https://ideone.com/t6zxlR\" rel=\"nofollow noreferrer\">See it live on ideone.com</a></p>\n"}], "owner": {"reputation": 9, "user_id": 11691059, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8YLHGFA7Bsc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdmBdKMQ2C2hp8zRhkgez_UPSOoMw/mo/photo.jpg?sz=128", "display_name": "Gaurav Garg", "link": "https://stackoverflow.com/users/11691059/gaurav-garg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 24, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1565122738, "creation_date": 1565121842, "last_edit_date": 1565122011, "question_id": 57383244, "link": "https://stackoverflow.com/questions/57383244/i-am-using-4-for-lopp-2-are-working-correct-rest-2-are-showing-issue-3-and-4-l", "title": "i am using 4 for lopp , 2 are working correct rest 2 are showing issue 3 and 4 loop are showing invalid answer", "body": "<p>i am using 4 for lopp , 2 are working correct rest 2 are showing issue 3 and 4 loop are showing invalid answer:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void) {\n  // your code goes here\n  int n,arr[n],i,l=0,m=0,u=0,d=0;\n\n  printf(\"enter the value of n\");\n  scanf(\"%d\",&amp;n);\n\n  arr[0]=0;\n\n  for(i=0;i&lt;n;i++) {\n    arr[i+1]=arr[i]+10;\n  }\n\n  printf(\"%d\",arr[3]);\n\n  for(i=1;i&lt;=n;i=i+4) {\n    l=arr[i]+l;\n  }\n\n  for(i=2;i&lt;=n;i=i+4) {\n    u=arr[i]+u;\n  }\n\n  for(i=3;i&lt;=n;i=i+4) {\n    m=arr[i]+m;\n  }\n\n  /* for(i=4;i&lt;=n;i=i+4) { d=arr[i]+d; } */\n\n  printf(\"\\n%d\\n\",l);\n  printf(\"%d\\n\",u);\n  printf(\"%d\\n\",m);\n  printf(\"%d\\n\",d);\n\n  return 0;\n}\n</code></pre>\n\n<p>answer in negative</p>\n"}, {"tags": ["c", "linux", "linux-kernel", "kernel-module"], "comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565120473, "post_id": 57382699, "comment_id": 101250195, "body": "Note that this will also remove the running kernel image, so it will stop before it erases all memory. It could also very likely ruin some filesystem details. Make a backup beforehand."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565120530, "post_id": 57382699, "comment_id": 101250216, "body": "Also, dereferencing a null pointer will cause an Oops and probably unload your module. You might consider starting at <code>1</code>."}, {"owner": {"reputation": 11, "user_id": 11891442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1544d17f671c4aca38debb5cf4a78ba0?s=128&d=identicon&r=PG&f=1", "display_name": "josh", "link": "https://stackoverflow.com/users/11891442/josh"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565120671, "post_id": 57382699, "comment_id": 101250272, "body": "but am I touching physical memory at this point, or it&#39;s still virtual memory? will the OS still block me?"}, {"owner": {"reputation": 11762, "user_id": 6530695, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/53a7a617c8e419f2562f0b00e6be10b1?s=128&d=identicon&r=PG&f=1", "display_name": "Tony", "link": "https://stackoverflow.com/users/6530695/tony"}, "edited": false, "score": 1, "creation_date": 1565120810, "post_id": 57382699, "comment_id": 101250321, "body": "You&#39;re touching a virtual memory. The C standard states dereferencing null pointer as undefined behavior."}, {"owner": {"reputation": 11, "user_id": 11891442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1544d17f671c4aca38debb5cf4a78ba0?s=128&d=identicon&r=PG&f=1", "display_name": "josh", "link": "https://stackoverflow.com/users/11891442/josh"}, "edited": false, "score": 0, "creation_date": 1565120989, "post_id": 57382699, "comment_id": 101250415, "body": "So how can I touch physical emory then? i&#39;m assume the Kernel Module has a process ID of its won then?"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 11762, "user_id": 6530695, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/53a7a617c8e419f2562f0b00e6be10b1?s=128&d=identicon&r=PG&f=1", "display_name": "Tony", "link": "https://stackoverflow.com/users/6530695/tony"}, "edited": false, "score": 0, "creation_date": 1565122373, "post_id": 57382699, "comment_id": 101250991, "body": "@Tony If this is a kernel module, then it&#39;s physical memory."}, {"owner": {"reputation": 215710, "user_id": 134633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6be45ddcfd038ba5e1e5fca319c7fa?s=128&d=identicon&r=PG", "display_name": "caf", "link": "https://stackoverflow.com/users/134633/caf"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 1, "creation_date": 1565141187, "post_id": 57382699, "comment_id": 101255328, "body": "@JL2210: No, that&#39;s not the case.  Paging is still enabled while kernel code is running.  On most architectures the kernel <i>does</i> maintain a mapping of all physical memory somewhere in virtual address space (the &quot;kernel direct map&quot;) but that isn&#39;t at virtual address zero."}, {"owner": {"reputation": 215710, "user_id": 134633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6be45ddcfd038ba5e1e5fca319c7fa?s=128&d=identicon&r=PG", "display_name": "caf", "link": "https://stackoverflow.com/users/134633/caf"}, "edited": false, "score": 0, "creation_date": 1565142089, "post_id": 57382699, "comment_id": 101255499, "body": "@josh: To find the virtual address for a physical address, use <code>__va()</code> from <code>asm&#47;page.h</code>."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 215710, "user_id": 134633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6be45ddcfd038ba5e1e5fca319c7fa?s=128&d=identicon&r=PG", "display_name": "caf", "link": "https://stackoverflow.com/users/134633/caf"}, "edited": false, "score": 0, "creation_date": 1565194515, "post_id": 57382699, "comment_id": 101278582, "body": "@caf Thanks. Nice to know."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11891442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1544d17f671c4aca38debb5cf4a78ba0?s=128&d=identicon&r=PG&f=1", "display_name": "josh", "link": "https://stackoverflow.com/users/11891442/josh"}, "edited": false, "score": 0, "creation_date": 1565120440, "post_id": 57382911, "comment_id": 101250174, "body": "__init and __exit are new ways of calling them, you can still use the old way of using <code>init_module</code> and <code>cleanup_module</code>"}, {"owner": {"reputation": 1590, "user_id": 3796272, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zqSzP.jpg?s=128&g=1", "display_name": "Kampi", "link": "https://stackoverflow.com/users/3796272/kampi"}, "reply_to_user": {"reputation": 11, "user_id": 11891442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1544d17f671c4aca38debb5cf4a78ba0?s=128&d=identicon&r=PG&f=1", "display_name": "josh", "link": "https://stackoverflow.com/users/11891442/josh"}, "edited": false, "score": 0, "creation_date": 1565120834, "post_id": 57382911, "comment_id": 101250334, "body": "Yes, you are right. I checked it with a newer version of Linux modules."}], "tags": [], "owner": {"reputation": 1590, "user_id": 3796272, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zqSzP.jpg?s=128&g=1", "display_name": "Kampi", "link": "https://stackoverflow.com/users/3796272/kampi"}, "is_accepted": false, "score": 3, "last_activity_date": 1565120262, "creation_date": 1565120262, "answer_id": 57382911, "question_id": 57382699, "link": "https://stackoverflow.com/questions/57382699/kernel-module-memory-access/57382911#57382911", "title": "Kernel Module memory access", "body": "<p>Kernel modules run with kernel privileges (including kernel memory and all peripherals). The reason why your code isn\u00b4t working is, that you don\u00b4t specify the <code>init</code> and <code>exit</code> module. So you can load the module, but the kernel doesn\u00b4t call your methods.</p>\n\n<p>Please take a look at <a href=\"https://github.com/markmester/skeleton-kernel-module/blob/master/module-skeleton.c\" rel=\"nofollow noreferrer\">this</a> example for a minimal kernel module. <a href=\"https://www.kernel.org/doc/htmldocs/kernel-hacking/routines-init-again.html\" rel=\"nofollow noreferrer\">Here</a> you will find some explanation about the needed macros.</p>\n"}], "owner": {"reputation": 11, "user_id": 11891442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1544d17f671c4aca38debb5cf4a78ba0?s=128&d=identicon&r=PG&f=1", "display_name": "josh", "link": "https://stackoverflow.com/users/11891442/josh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 410, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565123155, "creation_date": 1565119290, "last_edit_date": 1565123155, "question_id": 57382699, "link": "https://stackoverflow.com/questions/57382699/kernel-module-memory-access", "title": "Kernel Module memory access", "body": "<p>I'm new to kernel modules and currently experimenting with it.\nI've read that they have the same level access as the kernel itself.</p>\n\n<p>Does this mean they have access to physical memory and can see/overwrite \nvalues of other processes (including the kernel memory space)?</p>\n\n<p>I have written this simple C code to overwrite every memory address but it's not doing anything (expecting the system to just crash, not sure if this is touching physical memory or it's still virtual memory)</p>\n\n<p>I run it with <code>sudo insmod ./test.ko</code>, the code just hangs there (because of the infinite loop of course) but system works fine when I exit manually.</p>\n\n<pre><code>#include &lt;linux/module.h&gt;\n#include &lt;linux/kernel.h&gt;\n\nint init_module(void)\n{\n    unsigned char *p = 0x0;\n    while (true){\n      *p=0;\n      p++;\n    }\n\n    return 0;\n}\n\nvoid cleanup_module(void)\n{\n    //\n}\n\n</code></pre>\n"}, {"tags": ["c", "performance", "sdl-2", "frame-rate"], "comments": [{"owner": {"reputation": 47449, "user_id": 44729, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tyWaU.png?s=128&g=1", "display_name": "genpfault", "link": "https://stackoverflow.com/users/44729/genpfault"}, "edited": false, "score": 0, "creation_date": 1565120057, "post_id": 57382679, "comment_id": 101250000, "body": "What renderer backends are available and which one did you end up with at runtime?"}, {"owner": {"reputation": 23530, "user_id": 347964, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bE90m.png?s=128&g=1", "display_name": "flyx", "link": "https://stackoverflow.com/users/347964/flyx"}, "reply_to_user": {"reputation": 47449, "user_id": 44729, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tyWaU.png?s=128&g=1", "display_name": "genpfault", "link": "https://stackoverflow.com/users/44729/genpfault"}, "edited": false, "score": 0, "creation_date": 1565125509, "post_id": 57382679, "comment_id": 101252084, "body": "@genpfault I compiled SDL2 manually with only the kmsdrm backend, which I use."}], "owner": {"reputation": 23530, "user_id": 347964, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bE90m.png?s=128&g=1", "display_name": "flyx", "link": "https://stackoverflow.com/users/347964/flyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565119222, "creation_date": 1565119222, "question_id": 57382679, "link": "https://stackoverflow.com/questions/57382679/sdl2-rendering-does-not-go-beyond-30-fps-on-rockchip-based-board", "title": "SDL2 rendering does not go beyond 30 FPS on rockchip-based board", "body": "<p>I am trying to implement animations on a Rock64 ARM board, which has a Rockchip RK3328 with a Mali GPU. I am using SDL2 and I am experiencing a low framerate. So I wrote some testing code:</p>\n\n<pre><code>#include &lt;SDL2/SDL.h&gt;\n#include &lt;stdbool.h&gt;\n\n// generates a texture with the given color and the output's size\nSDL_Texture *colorTexture(SDL_Renderer *renderer,\n    unsigned char r, unsigned char g, unsigned char b) {\n  int w, h, pitch;\n  SDL_GetRendererOutputSize(renderer, &amp;w, &amp;h);\n  SDL_Texture *ret = SDL_CreateTexture(renderer, SDL_PIXELFORMAT_RGBA8888,\n      SDL_TEXTUREACCESS_STREAMING, w, h);\n  void *pixels;\n  SDL_LockTexture(ret, NULL, &amp;pixels, &amp;pitch);\n  for (int y = 0; y &lt; h; ++y) {\n    unsigned char *cur = pixels + y * pitch;\n    for (int x = 0; x &lt; w; ++x) {\n      *cur++ = 255; *cur++ = b; *cur++ = g; *cur++ = r;\n    }\n  }\n  SDL_UnlockTexture(ret);\n  return ret;\n}\n\nint main(int argc, char *argv[]) {\n  SDL_Init(SDL_INIT_VIDEO | SDL_INIT_EVENTS);\n  SDL_Window *window;\n  SDL_Renderer *renderer;\n  SDL_CreateWindowAndRenderer(640, 480, SDL_WINDOW_OPENGL,  &amp;window, &amp;renderer);\n  SDL_Texture *blue = colorTexture(renderer, 0, 0, 255);\n  SDL_Texture *red  = colorTexture(renderer, 255, 0, 0);\n  int w, h;\n  SDL_GetWindowSize(window, &amp;w, &amp;h);\n\n  bool running = true;\n  SDL_Texture *first = blue, *second = red;\n  uint32_t start = SDL_GetTicks();\n  int frameCount = 0;\n  while (running) {\n    SDL_Event evt;\n    for (int x = 0; x &lt; w; ++x) {\n      while (SDL_PollEvent(&amp;evt)) {\n        if (evt.type == SDL_QUIT) {\n          running = false;\n          goto after_animation;\n        }\n      }\n      SDL_Rect firstRect = {.x = 0, .y = 0, .w = x, .h = h},\n               secondRect = {.x = x, .y = 0, .w = w - x, .h = h};\n      SDL_RenderCopy(renderer, first, &amp;firstRect, &amp;firstRect);\n      SDL_RenderCopy(renderer, second, &amp;secondRect, &amp;secondRect);\n      SDL_RenderPresent(renderer);\n      frameCount++;\n      uint32_t cur = SDL_GetTicks();\n      if (cur - start &gt;= 1000) {\n        printf(\"%d FPS\\n\", frameCount);\n        frameCount = 0;\n        start = cur;\n      }\n    }\n    after_animation:;\n    SDL_Texture *tmp = first; first = second; second = tmp;\n  }\n  SDL_Quit();\n}\n</code></pre>\n\n<p>According to the post <a href=\"https://forum.pine64.org/showthread.php?tid=5626\" rel=\"nofollow noreferrer\">here</a>, the board is able to reach framerates higher than 60 FPS even for 4k output (my monitor is a 4k TV). However, my testing code reports only 30 FPS. It only renders two textures that have exactly the screen's size, and scrolls horizontally showing one texture on the left and one on the right. I believe I should be able to reach framerates beyond 30 FPS. How can I speed up the rendering? </p>\n"}, {"tags": ["c", "buffer-overflow", "integer-overflow", "fortify"], "comments": [{"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 1, "creation_date": 1565118840, "post_id": 57382450, "comment_id": 101249473, "body": "Further, <i>&quot;Adding 5 to guint32 couldn&#39;t possibly overflow.&quot;</i> - yes it can, and legally. Pretty sure Fortify is telling you  if that <code>guint32</code> value is inside (max - 5) for that type it will <i>definitely</i> overflow, leaving you with a severely undersized allocation, which will appear to have &quot;worked&quot;. Unrelated, are your TLV&#39;s, specifically the multi-byte scalars, already in host-order? I&#39;m genuinely curious (never used glib before, so I honestly don&#39;t know)."}, {"owner": {"reputation": 407, "user_id": 118691, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7e438941b64c5060bb188d0c64de9f8a?s=128&d=identicon&r=PG", "display_name": "Rob Paisley", "link": "https://stackoverflow.com/users/118691/rob-paisley"}, "reply_to_user": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1565119203, "post_id": 57382450, "comment_id": 101249623, "body": "@WhozCraig I cannot come up with any 32 bit value that adding 5 to could overflow 64 bits. I&#39;ve removed the host-to-network and network-to-host code for brevity."}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1565121726, "post_id": 57382450, "comment_id": 101250766, "body": "I must have missed where, in your post, there was any mention of a x64 build? The result of the expression <code>pkt.length + sizeof(pkt)</code> will be <code>guint32</code> unless <code>size_t</code> is a wider type (which is easy enough to check). Thereafter, regardless it will then become <code>gsize</code> (which defaults to <code>unsigned long</code>, not <code>size_t</code>) when fed to <code>g_malloc</code>. Therefore if <code>size_t</code> is 64bit, but <code>unsigned long</code> is 32bit, that&#39;s a problem."}, {"owner": {"reputation": 407, "user_id": 118691, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7e438941b64c5060bb188d0c64de9f8a?s=128&d=identicon&r=PG", "display_name": "Rob Paisley", "link": "https://stackoverflow.com/users/118691/rob-paisley"}, "reply_to_user": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 1, "creation_date": 1565127839, "post_id": 57382450, "comment_id": 101252793, "body": "@WhozCraig I was used to assuming 64 bits. I&#39;ve updated the question to state it explicitly along with adding printfs for sizes of various things of interest."}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1565127955, "post_id": 57382450, "comment_id": 101252827, "body": "That looks good. Thanks for the update. I&#39;m interested in seeing what comes from this."}, {"owner": {"reputation": 14968, "user_id": 673852, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/S5IZ5.png?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/673852/ruslan"}, "edited": false, "score": 0, "creation_date": 1565182317, "post_id": 57382450, "comment_id": 101271348, "body": "Could you post the output of Fortify with all the relevant context? There are two calls to <code>readFully</code>, and it would be useful to know which of the calls it thinks has buffer overflow. As for integer overflow, does Fortify still  report it if you explicitly cast <code>pkt.length</code> to <code>size_t</code>?"}, {"owner": {"reputation": 407, "user_id": 118691, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7e438941b64c5060bb188d0c64de9f8a?s=128&d=identicon&r=PG", "display_name": "Rob Paisley", "link": "https://stackoverflow.com/users/118691/rob-paisley"}, "reply_to_user": {"reputation": 14968, "user_id": 673852, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/S5IZ5.png?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/673852/ruslan"}, "edited": false, "score": 0, "creation_date": 1565185600, "post_id": 57382450, "comment_id": 101273559, "body": "@Ruslan, I&#39;ve added the Buffer Overflow Analysis Evidence diagram to the post. It still reports the integer overflow after explicitly casting <code>pkt.length</code> to <code>size_t</code>"}, {"owner": {"reputation": 14968, "user_id": 673852, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/S5IZ5.png?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/673852/ruslan"}, "edited": false, "score": 0, "creation_date": 1565188383, "post_id": 57382450, "comment_id": 101275303, "body": "Looks like Fortify knows that due to packing and flexible array <code>value</code> local structure <code>pkt</code> has size 5, but for some strange reason it evaluates <code>sizeof(pkt)</code> as if <code>value</code> had size 1, also forgetting about packing. And for integer overflow: what if you make separate <code>size_t</code> variables for the operands of the sum and another variable for the sum, and then pass the latter variable to <code>g_malloc</code>, does Fortify still report the overflow? Does the report point exactly to the line with the sum and nothing else? Does it report any particular numerical values leading to the overflow?"}, {"owner": {"reputation": 407, "user_id": 118691, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7e438941b64c5060bb188d0c64de9f8a?s=128&d=identicon&r=PG", "display_name": "Rob Paisley", "link": "https://stackoverflow.com/users/118691/rob-paisley"}, "reply_to_user": {"reputation": 14968, "user_id": 673852, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/S5IZ5.png?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/673852/ruslan"}, "edited": false, "score": 0, "creation_date": 1565191987, "post_id": 57382450, "comment_id": 101277350, "body": "@Ruslan It doesn&#39;t give values for the overflow. Separating the values didn&#39;t change anything. It reports the g_malloc call as the integer overflow."}, {"owner": {"reputation": 14968, "user_id": 673852, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/S5IZ5.png?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/673852/ruslan"}, "edited": false, "score": 0, "creation_date": 1565192136, "post_id": 57382450, "comment_id": 101277420, "body": "Oh, so it&#39;s not the sum which overflows, but the conversion of the argument? That&#39;s weird, given the sizes you&#39;ve printed. And what if you use <code>gsize</code> instead of <code>size_t</code> for the separated values? Is the overflow still reported at the call site?"}, {"owner": {"reputation": 407, "user_id": 118691, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7e438941b64c5060bb188d0c64de9f8a?s=128&d=identicon&r=PG", "display_name": "Rob Paisley", "link": "https://stackoverflow.com/users/118691/rob-paisley"}, "reply_to_user": {"reputation": 14968, "user_id": 673852, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/S5IZ5.png?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/673852/ruslan"}, "edited": false, "score": 0, "creation_date": 1565199758, "post_id": 57382450, "comment_id": 101281072, "body": "@Ruslan I just confirmed, all <code>size_t</code>, or <code>gsize</code>, or <code>guint64</code> all flag the <code>g_malloc</code> call as the integer overflow."}, {"owner": {"reputation": 14968, "user_id": 673852, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/S5IZ5.png?s=128&g=1", "display_name": "Ruslan", "link": "https://stackoverflow.com/users/673852/ruslan"}, "edited": false, "score": 0, "creation_date": 1565202371, "post_id": 57382450, "comment_id": 101282156, "body": "I&#39;d report this strangeness to the developers. If it&#39;s not a bug (which I suspect it is), then at least a usability problem \u2014 that it doesn&#39;t provide better clues to understand what&#39;s going on."}], "owner": {"reputation": 407, "user_id": 118691, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7e438941b64c5060bb188d0c64de9f8a?s=128&d=identicon&r=PG", "display_name": "Rob Paisley", "link": "https://stackoverflow.com/users/118691/rob-paisley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 305, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1565185763, "creation_date": 1565118172, "last_edit_date": 1565185763, "question_id": 57382450, "link": "https://stackoverflow.com/questions/57382450/fortify-reports-buffer-overflow-and-integer-overflow", "title": "Fortify Reports Buffer Overflow and Integer Overflow", "body": "<p>Fortify reports a \"Buffer Overflow\" on line 20 (the <code>read</code> call of <code>readFully</code>) claiming the buffer size is 5, and the write length is 9. Fortify also reports an \"Integer Overflow\" on line 36 (the <code>g_malloc</code> call) in the following code:</p>\n\n<pre><code> 1  #include &lt;glib.h&gt;\n 2  #include &lt;stdio.h&gt;\n 3  #include &lt;stdlib.h&gt;\n 4  #include &lt;string.h&gt;\n 5  #include &lt;unistd.h&gt;\n 6\n 7  struct __attribute__((__packed__)) tlv\n 8  {\n 9    guint8 type;\n10    guint32 length;\n11    guint8 value[];\n12  } tlv;\n13\n14  static gint32\n15  readFully(int fd, void *target, guint32 size)\n16  {\n17    guint32 count = 0;\n18    int bytes = 0;\n19    while(count &lt; size) {\n20      bytes = read(fd, (guint8*)target + count, size - count);\n21      if(-1 == bytes || 0 == bytes) {\n22        return -1;\n23      }\n24      count += bytes;\n25    }\n26    return 0;\n27  }\n28\n29  struct tlv *\n30  get_tlv(int fd)\n31  {\n32    struct tlv pkt;\n33    if(-1 == readFully(fd, &amp;pkt, sizeof(pkt))) {\n34      return NULL;\n35    }\n36    struct tlv* ret = g_malloc(pkt.length + sizeof(pkt));\n37    memcpy(ret, &amp;pkt, sizeof(pkt));\n38    if(-1 == readFully(fd, ret-&gt;value, pkt.length)) {\n39      g_free(ret);\n40      return NULL;\n41    }\n42    return ret;\n43  }\n44\n45  int\n46  main(void)\n47  {\n48    printf(\"struct tlv:\\t%lu\\n\", sizeof(struct tlv));\n49    printf(\"guint32:\\t%lu\\n\", sizeof(guint32));\n50    printf(\"gsize:\\t\\t%lu\\n\", sizeof(gsize));\n51    printf(\"size_t:\\t\\t%lu\\n\", sizeof(size_t));\n52    return 0;\n53  }\n</code></pre>\n\n<p>Output is as follows:</p>\n\n<blockquote>\n<pre><code>struct tlv:     5\nguint32:        4\ngsize:          8\nsize_t:         8\n</code></pre>\n</blockquote>\n\n<p>Buffer Overflow Analysis Evidence from Fortify:</p>\n\n<p><a href=\"https://i.stack.imgur.com/4lRNo.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4lRNo.png\" alt=\"Fortify Analysis Evidence\"></a></p>\n\n<p>The Taints listed are as follows:</p>\n\n<ol>\n<li>COMPARISON</li>\n<li>NOT_NULL_TERMINATED</li>\n<li>NUMBER</li>\n<li>STREAM</li>\n</ol>\n\n<p>This code is a smaller sample of code used to read a Type Length Value (TLV) field off of a network socket into a <code>struct tlv *</code>.</p>\n\n<p>I don't see how it could either of these could be true, nor do I understand why it would trigger either of these. The Integer Overflow doesn't make any sense to me. <a href=\"https://developer.gnome.org/glib/2.48/glib-Memory-Allocation.html#g-malloc\" rel=\"nofollow noreferrer\">g_malloc</a> takes a <a href=\"https://developer.gnome.org/glib/2.48/glib-Basic-Types.html#gsize\" rel=\"nofollow noreferrer\">gsize</a>. Adding 5 to <code>guint32</code> couldn't possibly overflow.</p>\n\n<p>Here's the way I'm running Fortify. I'm operating in a 64 bit environment on Red Hat Enterprise Linux (RHEL) 7.6.</p>\n\n<pre><code>$ sourceanalyzer -b sample gcc -I/usr/include/glib-2.0 -I/usr/lib64/glib-2.0/include -Wall -Wextra -Wcast-qual -Wformat=2 -Wlogical-op -Wpointer-arith -Wshadow -g3 -Werror -c -o sample.o sample.c\n$ sourceanalyzer -b sample -scan -f sample.fpr\n$ auditworkbench sample.fpr\n</code></pre>\n"}, {"tags": ["c", "swift"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2201041"}, "edited": false, "score": 1, "creation_date": 1565117633, "post_id": 57382279, "comment_id": 101248953, "body": "Pedantic note: C does not have pass-by-reference"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1565117758, "post_id": 57382279, "comment_id": 101249008, "body": "C functions are exclusively pass-by-value.  There is no pass-by-reference.  If you want a function to be able to change a local variable of the caller, then you must provide it a pointer to that variable.  Dunno how to do that in Swift."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565117774, "post_id": 57382279, "comment_id": 101249020, "body": "The problem with your code as it is, is that C doesn&#39;t really support pass by reference, you have to <i>emulate</i> it by passing a pointer to the variable you want to pass by reference. For pointer variables that means you have to pass a pointer <i>to the pointer</i>. With the code as shown, since the pointer passed to the function is passed by value, the assignment only modify the local variable, the copy you have in the function. The only solution is to change the contents of the memory where the pointer is pointing, with e.g. <code>strcpy</code>, which is kind of a show-stopper if the contents is constant."}, {"owner": {"reputation": 2162, "user_id": 2534472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92d8dce53c214aa63495ff868b09a1a4?s=128&d=identicon&r=PG", "display_name": "UniversE", "link": "https://stackoverflow.com/users/2534472/universe"}, "edited": false, "score": 0, "creation_date": 1565117796, "post_id": 57382279, "comment_id": 101249032, "body": "You want to modifiy the contents of a <code>const char*</code>? You cannot."}, {"owner": {"reputation": 11277, "user_id": 3657941, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/304d8d4cceca5f9ce2383ff97b53e36b?s=128&d=identicon&r=PG&f=1", "display_name": "David Cullen", "link": "https://stackoverflow.com/users/3657941/david-cullen"}, "edited": false, "score": 1, "creation_date": 1565117843, "post_id": 57382279, "comment_id": 101249052, "body": "Have a look at <a href=\"https://developer.apple.com/documentation/swift/imported_c_and_objective-c_apis/using_imported_c_functions_in_swift\" rel=\"nofollow noreferrer\">Using Imported C Functions in Swift</a>."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565118058, "post_id": 57382279, "comment_id": 101249147, "body": "<code>const char **</code>?"}, {"owner": {"reputation": 1, "user_id": 11891184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c87a3a0b240735ab92645c208df2f5cb?s=128&d=identicon&r=PG&f=1", "display_name": "matthewscott", "link": "https://stackoverflow.com/users/11891184/matthewscott"}, "reply_to_user": {"reputation": 11277, "user_id": 3657941, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/304d8d4cceca5f9ce2383ff97b53e36b?s=128&d=identicon&r=PG&f=1", "display_name": "David Cullen", "link": "https://stackoverflow.com/users/3657941/david-cullen"}, "edited": false, "score": 0, "creation_date": 1565126193, "post_id": 57382279, "comment_id": 101252311, "body": "thanks @DavidCullen that helped!"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11891184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c87a3a0b240735ab92645c208df2f5cb?s=128&d=identicon&r=PG&f=1", "display_name": "matthewscott", "link": "https://stackoverflow.com/users/11891184/matthewscott"}, "is_accepted": false, "score": 0, "last_activity_date": 1565126013, "creation_date": 1565126013, "answer_id": 57384083, "question_id": 57382279, "link": "https://stackoverflow.com/questions/57382279/how-to-pass-by-reference-from-swift-to-c-library/57384083#57384083", "title": "How to pass-by-reference from Swift to C library", "body": "<p>Found something that worked.</p>\n\n<p>In the C library:</p>\n\n<pre><code>int sayBye(const char** greetingString){\n    *greetingString = \"bye\";\n    return 0;\n}\n</code></pre>\n\n<p>Called in Swift:</p>\n\n<pre><code>var greeting = (\"hello\" as NSString).utf8String\nlet responseCode = sayBye(&amp;greeting)\nlet stringFromPointer = String.init(cString: greeting!)\n\nprint(stringFromPointer)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11891184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c87a3a0b240735ab92645c208df2f5cb?s=128&d=identicon&r=PG&f=1", "display_name": "matthewscott", "link": "https://stackoverflow.com/users/11891184/matthewscott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565126013, "creation_date": 1565117431, "last_edit_date": 1565118018, "question_id": 57382279, "link": "https://stackoverflow.com/questions/57382279/how-to-pass-by-reference-from-swift-to-c-library", "title": "How to pass-by-reference from Swift to C library", "body": "<p>I am creating a cross-platform library for Windows and macOS that is written in C, and I need to pass a variable by reference. How do I define the function in C so that it can receive a variable passed by reference, and how do I call the function in Swift?</p>\n\n<p>For example, if I were to define a function in my C library like:</p>\n\n<pre><code>int sayBye(const char* greetingString){\n    greetingString = \"bye\";\n    return 0;\n}\n</code></pre>\n\n<p>and call it in Swift like:</p>\n\n<pre><code>var greeting: String = \"hello\"\nlet responseCode = sayBye(greeting)\nprint(greeting)\n</code></pre>\n\n<p>I want the print statement to output \"bye\".</p>\n\n<p>Constraints: \"bye\" cannot be returned in the return statement.</p>\n\n<p>In short, I want to modify the contents of the string \"greeting\" after it has been passed by reference to a C-function.</p>\n\n<p>Note: I'm not sure if, in the code above, I am defining the C function correctly or if I am calling it correctly in swift, and I am open to recommendations.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 2670, "user_id": 7426932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZTx1H.png?s=128&g=1", "display_name": "Obsidian", "link": "https://stackoverflow.com/users/7426932/obsidian"}, "edited": false, "score": 0, "creation_date": 1565129512, "post_id": 57381803, "comment_id": 101253288, "body": "Be aware that &quot;wide characters&quot; in C don&#39;t refer to what you&#39;re presently asking about. Instead, it has to do with Unicode 16-bits encoded characters. Check out this entry : <a href=\"https://stackoverflow.com/questions/11287213/what-is-a-wide-character-string-in-c-language\" title=\"what is a wide character string in c language\">stackoverflow.com/questions/11287213/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 76, "user_id": 11882769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ee7a6e53eb8e521eee4b71f0329827c?s=128&d=identicon&r=PG&f=1", "display_name": "A. N. Tanvir", "link": "https://stackoverflow.com/users/11882769/a-n-tanvir"}, "is_accepted": false, "score": 0, "last_activity_date": 1565117508, "last_edit_date": 1565117508, "creation_date": 1565116823, "answer_id": 57382166, "question_id": 57381803, "link": "https://stackoverflow.com/questions/57381803/what-is-difference-between-character-wide-1-and-e-g-6/57382166#57382166", "title": "what is difference between character wide 1 and e.g 6", "body": "<pre><code> printf(\"%5.2f\\n\", 3.223467856);\n</code></pre>\n\n<p><strong>Consider the above statement:</strong></p>\n\n<p>printing with %5.2f will generate : _3.22 ( the symbol _ represents a blank space at the beginning, <strong>won't be printed in console</strong>) </p>\n\n<p><code>5:</code> The number will occupy space of 5 character wide. (.) dot occupies 1 char space too)</p>\n\n<p><code>2:</code> The number will occupy 2 digits after decimal point(.)</p>\n\n<pre><code>printf(\"%6.2f\\n\", 3.223467856);\n</code></pre>\n\n<p>printing with %6.2f will generate : __3.22 </p>\n\n<pre><code>printf(\"%6.3f\\n\", 3.223467856);\n</code></pre>\n\n<p>printing with %6.2f will generate : _3.223 </p>\n"}, {"tags": [], "owner": {"reputation": 1899, "user_id": 8854921, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8b76055b306b4dbab08ee558957f52e?s=128&d=identicon&r=PG&f=1", "display_name": "Bo R", "link": "https://stackoverflow.com/users/8854921/bo-r"}, "is_accepted": false, "score": 0, "last_activity_date": 1565122136, "creation_date": 1565122136, "answer_id": 57383306, "question_id": 57381803, "link": "https://stackoverflow.com/questions/57381803/what-is-difference-between-character-wide-1-and-e-g-6/57383306#57383306", "title": "what is difference between character wide 1 and e.g 6", "body": "<p>If you modify the program (with some cleanup):</p>\n\n<pre><code>    #include &lt;stdio.h&gt;\n    #include &lt;stdlib.h&gt;\n\n    int main(void) {\n        int const lower_limit = 0;\n        int const upper_limit = 300;\n        int const step = 20;\n\n        float fahrenheit = lower_limit;\n        while (fahrenheit &lt;= upper_limit) {\n            float const celsius = (5.0f / 9.0f) * (fahrenheit - 32.0f);\n            printf(\"%9.6f\\t%10.6f\\n\", fahrenheit, celsius);\n            fahrenheit += step;\n        }\n\n        return EXIT_SUCCESS;\n    }\n</code></pre>\n\n<p>You'll see the difference between <code>%9.6f</code> and <code>%10.6f</code> which should show something like:</p>\n\n<pre><code> 0.000000   -17.777779\n20.000000    -6.666667\n40.000000     4.444445\n60.000000    15.555556\n80.000000    26.666668\n100.000000   37.777779\n120.000000   48.888893\n140.000000   60.000004\n160.000000   71.111115\n180.000000   82.222229\n200.000000   93.333336\n220.000000  104.444450\n240.000000  115.555557\n260.000000  126.666672\n280.000000  137.777786\n300.000000  148.888901\n</code></pre>\n\n<p>You see a difference in behaviour when <code>fahrenheit</code> goes from <code>0</code> to <code>20</code> vs from <code>80</code> to <code>100</code>.</p>\n"}], "owner": {"reputation": 19, "user_id": 11860602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BPKwd32okmw/AAAAAAAAAAI/AAAAAAAAADw/Q571fuv_SCM/photo.jpg?sz=128", "display_name": "Dakuha", "link": "https://stackoverflow.com/users/11860602/dakuha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1565122136, "creation_date": 1565115114, "question_id": 57381803, "link": "https://stackoverflow.com/questions/57381803/what-is-difference-between-character-wide-1-and-e-g-6", "title": "what is difference between character wide 1 and e.g 6", "body": "<p>Im learning from start C basic.And i dont understand character wide.When i change it nothing visual happens,so i dont know what is purpose of this</p>\n\n<p>I was researching and at first i discovered that its not string length but \ncharacter datatype,but more info i wasnt able to find</p>\n\n<pre><code> main()\n {\n     float farh, celsium ;\n     int lower, upper, step;\n\n     lower = 0;\n     upper = 300;\n     step = 20;\n\n     farh = lower;\n     while(farh &lt;= upper) {\n         celsium = (5.0/9.0) * (farh - 32.0);\n         printf( \"%5.2f %5.2f\\n\",farh, celsium);\n         farh = farh + step;\n     }\n }\n</code></pre>\n\n<p>output is temperature in celsuim and fahrenheit (0.000000 -17.777779)</p>\n\n<p>in the code above </p>\n\n<pre><code>%5.2f \n</code></pre>\n\n<p>represent each argument to be alerted with character wide at least 5 and with 2 numbers after decimal point. But what changes if i write 2, 6 or other number instead of 5?</p>\n"}, {"tags": ["c", "object", "pointers", "macros"], "comments": [{"owner": {"reputation": 3723, "user_id": 1169091, "user_type": "registered", "accept_rate": 9, "profile_image": "https://i.stack.imgur.com/5vE4L.jpg?s=128&g=1", "display_name": "nicomp", "link": "https://stackoverflow.com/users/1169091/nicomp"}, "edited": false, "score": 0, "creation_date": 1565113991, "post_id": 57381542, "comment_id": 101247482, "body": "&quot; it would be great if I can assign a pointer to the object at compile time&quot;  - I don&#39;t think you really want to do this. Do you have that type of control over the memory management of your environment?"}, {"owner": {"reputation": 287, "user_id": 668773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/szllW.jpg?s=128&g=1", "display_name": "bluscape", "link": "https://stackoverflow.com/users/668773/bluscape"}, "reply_to_user": {"reputation": 3723, "user_id": 1169091, "user_type": "registered", "accept_rate": 9, "profile_image": "https://i.stack.imgur.com/5vE4L.jpg?s=128&g=1", "display_name": "nicomp", "link": "https://stackoverflow.com/users/1169091/nicomp"}, "edited": false, "score": 0, "creation_date": 1565114304, "post_id": 57381542, "comment_id": 101247615, "body": "Why not? Everytime I call NEW_OBJECT, the compiler will create a single instance of the struct TObject and the linker will place it in the section &quot;my_objects&quot;. Now I just want a variable pointing to that object. It is like any other variable pointing to a structure. Nothing wrong with that."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1565114334, "post_id": 57381542, "comment_id": 101247626, "body": "Just a heads-up, <code>#define _OBJECT_H_</code> is illegal.  Identifiers beginning with an underscore and a capital letter are reserved in all contexts."}, {"owner": {"reputation": 21832, "user_id": 882051, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f76d986b54e90fa6c431160e9a0796cd?s=128&d=identicon&r=PG", "display_name": "hmakholm left over Monica", "link": "https://stackoverflow.com/users/882051/hmakholm-left-over-monica"}, "edited": false, "score": 2, "creation_date": 1565114429, "post_id": 57381542, "comment_id": 101247662, "body": "Why not use <code>&amp;Object_SOBJECT1_E</code> directly as the pointer to the object?"}, {"owner": {"reputation": 3723, "user_id": 1169091, "user_type": "registered", "accept_rate": 9, "profile_image": "https://i.stack.imgur.com/5vE4L.jpg?s=128&g=1", "display_name": "nicomp", "link": "https://stackoverflow.com/users/1169091/nicomp"}, "edited": false, "score": 0, "creation_date": 1565115371, "post_id": 57381542, "comment_id": 101248024, "body": "&quot;the compiler will create a single instance of the struct&quot; -- No, it won&#39;t."}, {"owner": {"reputation": 287, "user_id": 668773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/szllW.jpg?s=128&g=1", "display_name": "bluscape", "link": "https://stackoverflow.com/users/668773/bluscape"}, "reply_to_user": {"reputation": 21832, "user_id": 882051, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f76d986b54e90fa6c431160e9a0796cd?s=128&d=identicon&r=PG", "display_name": "hmakholm left over Monica", "link": "https://stackoverflow.com/users/882051/hmakholm-left-over-monica"}, "edited": false, "score": 0, "creation_date": 1565116045, "post_id": 57381542, "comment_id": 101248292, "body": "@HenningMakholm I think I&#39;ve tried that. In theory it should work. I will give another try. Would still be &quot;nice&quot; if the macro can assign a pointer or return a pointer."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1565118995, "post_id": 57381542, "comment_id": 101249539, "body": "Doesn&#39;t the compiler for the last method you showed? You are defining the same variable twice with different declarations."}, {"owner": {"reputation": 287, "user_id": 668773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/szllW.jpg?s=128&g=1", "display_name": "bluscape", "link": "https://stackoverflow.com/users/668773/bluscape"}, "reply_to_user": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1565120762, "post_id": 57381542, "comment_id": 101250303, "body": "@AjayBrahmakshatriya That is what I said"}], "answers": [{"comments": [{"owner": {"reputation": 287, "user_id": 668773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/szllW.jpg?s=128&g=1", "display_name": "bluscape", "link": "https://stackoverflow.com/users/668773/bluscape"}, "edited": false, "score": 0, "creation_date": 1565119193, "post_id": 57382573, "comment_id": 101249616, "body": "Yes, it requires a constant initializer element.And assigning a variable to a variable in the global scope is not allowed. But I could overcome it with another macro?"}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 287, "user_id": 668773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/szllW.jpg?s=128&g=1", "display_name": "bluscape", "link": "https://stackoverflow.com/users/668773/bluscape"}, "edited": false, "score": 1, "creation_date": 1565119420, "post_id": 57382573, "comment_id": 101249717, "body": "You can move the declaration of the variable inside the macro too. Basically what you did in the last method in your question and then remove the extra declaration you have for the pointer."}], "tags": [], "owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "is_accepted": false, "score": 0, "last_activity_date": 1565118743, "creation_date": 1565118743, "answer_id": 57382573, "question_id": 57381542, "link": "https://stackoverflow.com/questions/57381542/c-macro-returning-a-pointer-or-assigning-a-value-to-a-pointer-passed-to-the-ma/57382573#57382573", "title": "C macro - Returning a pointer or assigning a value to a pointer passed to the macro", "body": "<p>The problem is that you are writing assignments at global scope. When <code>NEW_OBJECT</code> expands it creates - </p>\n\n<p><code>handle = &amp;Object_S0;</code></p>\n\n<p>for the first object. This is not allowed in C. </p>\n\n<p>You will have to move this assignment inside the main function or use <code>&amp;Object_S0</code> wherever you need to reference it. </p>\n\n<p>You can create the object inside a function and it would be fine. The object would be created statically and the assignment would happen at runtime. </p>\n"}, {"comments": [{"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1565119492, "post_id": 57382654, "comment_id": 101249752, "body": "Is the <code>const TObject_S *object1_PS;</code> before <code>NEW_OBJECT...</code> just redundant or infact wrong? Aren&#39;t those different definitions of the same variable?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1565119819, "post_id": 57382654, "comment_id": 101249892, "body": "No, @AjayBrahmakshatriya, they are not.  Multiple <i>declarations</i> of the same variable are allowed, provided the types are compatible, at most one declaration has an initializer, and a couple other requirements about the declared linkage are satisfied (including that the variable <i>have</i> linkage)."}, {"owner": {"reputation": 287, "user_id": 668773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/szllW.jpg?s=128&g=1", "display_name": "bluscape", "link": "https://stackoverflow.com/users/668773/bluscape"}, "edited": false, "score": 0, "creation_date": 1565120623, "post_id": 57382654, "comment_id": 101250260, "body": "@JohnBollinger About your addendum, wouldn&#39;t that set parameters and its members to const? Since the object is const? I explicitly declare them like that so that they are not const."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 287, "user_id": 668773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/szllW.jpg?s=128&g=1", "display_name": "bluscape", "link": "https://stackoverflow.com/users/668773/bluscape"}, "edited": false, "score": 0, "creation_date": 1565120905, "post_id": 57382654, "comment_id": 101250365, "body": "@user668773, the compound literal alternative does not make anything <code>const</code> that was not already <code>const</code>.  Compound literals represent modifiable objects (unlike string literals), so either way, what is <code>const</code> is the object id and <i>the pointer to</i> the parameters.  The parameters themselves are modifiable -- index, buffer pointer, and buffer elements.  Note also that whereas the handle points to a <code>const</code> structure, it itself (the pointer) is modifiable."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1565121903, "post_id": 57382654, "comment_id": 101250831, "body": "I am pretty sure bells are ringing in many chat rooms because of that word!"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 1, "creation_date": 1565123461, "post_id": 57382654, "comment_id": 101251351, "body": "Perhaps it&#39;s just my hubris, @AjayBrahmakshatriya, but from context and tone I took it as a complement.  I think they meant that they think I&#39;m so knowledgeable in this area that I must be stupid about other things to balance out.  (But perhaps I should be offended that they discount the possibility of me being an all-around genius?  :-) )"}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 287, "user_id": 668773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/szllW.jpg?s=128&g=1", "display_name": "bluscape", "link": "https://stackoverflow.com/users/668773/bluscape"}, "edited": false, "score": 0, "creation_date": 1565125663, "post_id": 57382654, "comment_id": 101252142, "body": "@user668773 it&#39;s not at all odd to find all-around geniuses here :)"}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 2, "last_activity_date": 1565120049, "last_edit_date": 1565120049, "creation_date": 1565119104, "answer_id": 57382654, "question_id": 57381542, "link": "https://stackoverflow.com/questions/57381542/c-macro-returning-a-pointer-or-assigning-a-value-to-a-pointer-passed-to-the-ma/57382654#57382654", "title": "C macro - Returning a pointer or assigning a value to a pointer passed to the macro", "body": "<p>Executable statements, such as assignment statements, must appear inside functions.  This is the main reason why the</p>\n\n<pre><code>    handle = &amp;Object_S##id; \\ &lt;----- This does not work\n</code></pre>\n\n<p>does not work (in your particular usage).  But you can <em>initialize</em> variables in (at most) one of their declarations.  For example, then:</p>\n\n<pre><code>#define NEW_OBJECT(id, size, handle) \\\n    static uint8_t Buffer_AU8##id[size]; \\\n    static TParameters_S Parameters_S##id = { \\\n        Buffer_AU8##id, 0 \\\n    }; \\\n    static const TObject_S __attribute__((used, section(\"my_objects\"))) Object_S##id = { \\\n        id, &amp;Parameters_S##id \\\n    }; \\\n    const TObject_S *handle = &amp;Object_S##id;\n\n\nconst TObject_S *object1_PS;  // This is redundant and can be dropped\n\nNEW_OBJECT(OBJECT1_E, 10, object1_PS);\n</code></pre>\n\n<p>Note that since you're declaring the structure itself as <code>const</code>, the pointer to it needs to accommodate that.  Note also that I've flipped the order of the element initializers for the <code>struct TParameters_S</code> to match the intent that seems apparent from the structure definition.</p>\n\n<p><strong>Addendum:</strong></p>\n\n<p>Note also that unless you actually want separate variables for the buffer and parameters then, given that you're declaring everything at file scope, you could substitute compound literals to achieve a cleaner namespace:</p>\n\n<pre><code>#define NEW_OBJECT(id, size, handle) \\\n    static const TObject_S __attribute__((used, section(\"my_objects\"))) Object_S##id = { \\\n        .ID_U8 = id, .Parameters_PS = &amp; (TParameters_S) { \\\n            .Buffer_PU8 = (uint8_t[]) { [size - 1] = 0 }, .Index_U8 = 0 } \\\n    }; \\\n    const TObject_S *handle = &amp;Object_S##id;\n</code></pre>\n\n<p>You could take that one step further to eliminate the <code>Object_S*</code>variables, leaving just the handle pointers as declared variables, but I don't know that you can apply attributes to compound literals.</p>\n"}, {"tags": [], "owner": {"reputation": 287, "user_id": 668773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/szllW.jpg?s=128&g=1", "display_name": "bluscape", "link": "https://stackoverflow.com/users/668773/bluscape"}, "is_accepted": false, "score": 1, "last_activity_date": 1565120141, "last_edit_date": 1565120141, "creation_date": 1565119611, "answer_id": 57382775, "question_id": 57381542, "link": "https://stackoverflow.com/questions/57381542/c-macro-returning-a-pointer-or-assigning-a-value-to-a-pointer-passed-to-the-ma/57382775#57382775", "title": "C macro - Returning a pointer or assigning a value to a pointer passed to the macro", "body": "<p>Ok, with the comments above (Henning and Ajay) I managed to come up with a solution.</p>\n\n<p>The problem is that the object requires a constant initilizer element. So I can't assign a variable to a variable in that scope. But I can overcome it with a macro. So what I have done is this:</p>\n\n<p>Header file:</p>\n\n<pre><code>#define NEW_OBJECT(id, size) \\\n    static uint8_t Buffer_AU8##id[size]; \\\n    static TParameters_S Parameters_S##id = { \\\n        0, Buffer_AU8##id \\\n    }; \\\n    static const TObject_S __attribute__((used, section(\"my_objects\"))) id = { \\\n        &amp;Parameters_S##id \\\n    }; \\\n\n#define GET_OBJECT(id) (TObject_S*)&amp;id\n</code></pre>\n\n<p>Source file:</p>\n\n<pre><code>NEW_OBJECT(OBJECT1, 10);\n\nconst TObject_S* object1_PS = (TObject_S*)GET_OBJECT(OBJECT1);\n\nvoid function(void)\n{\n    object1_PS-&gt;Parameters_PS-&gt;Buffer_PS[object1_PS-&gt;Parameters_PS-&gt;Index_U8];\n}\n</code></pre>\n\n<p>All the casting might not be necessary but it works.</p>\n"}], "owner": {"reputation": 287, "user_id": 668773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/szllW.jpg?s=128&g=1", "display_name": "bluscape", "link": "https://stackoverflow.com/users/668773/bluscape"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324, "favorite_count": 0, "accepted_answer_id": 57382654, "answer_count": 3, "score": 1, "last_activity_date": 1565120141, "creation_date": 1565113861, "question_id": 57381542, "link": "https://stackoverflow.com/questions/57381542/c-macro-returning-a-pointer-or-assigning-a-value-to-a-pointer-passed-to-the-ma", "title": "C macro - Returning a pointer or assigning a value to a pointer passed to the macro", "body": "<p>I'm trying to write \"object\" style C code because I need to declare the same object several times with different parameters. Everything works fine except for returning or assigning a pointer to the created object. I've searched and found couple examples but none of them are working.</p>\n\n<p>Here is what is working.</p>\n\n<p>Header file:</p>\n\n<pre><code>#ifndef _OBJECT_H_\n#define _OBJECT_H_\n\ntypedef struct\n{\n    uint8_t* Buffer_PU8;\n    uint8_t Index_U8;\n}TParameters_S;\n\ntypedef struct\n{\n    uint8_t ID_U8;\n    TParameters_S* Parameters_PS;\n}TObject_S;\n\n#define NEW_OBJECT(id, size) \\\n    static uint8_t Buffer_AU8##id[size]; \\\n    static TParameters_S Parameters_S##id = { \\\n        0, Buffer_AU8##id \\\n    }; \\\n    static const TObject_S __attribute__((used, section(\"my_objects\"))) Object_S##id = { \\\n        id, &amp;Parameters_S##id \\\n    }; \\\n\n#endif  // _OBJECT_H_\n</code></pre>\n\n<p>Source file:</p>\n\n<pre><code>#incldue \"object.h\"\n\ntypedef enum\n{\n    OBJECT1_E,\n    OBJECT2_E,\n}TObjects_E;\n\nNEW_OBJECT(OBJECT1_E, 10);\nNEW_OBJECT(OBJECT2_E, 20);\n\nvoid function(void)\n{\n}\n</code></pre>\n\n<p>This works fine and creates two \"objects\" in the section \"my_objects\". Each object having a different sized buffer.</p>\n\n<p>But I would like to get a pointer to the object so that I can operate on it. I can search for the objects in the \"my_objects\" section and point to that, but it would be great if I can assign a pointer to the object at compile time. Then I do not have to waste time or code space to search for the object.</p>\n\n<p>So I've tried this but it does not work (Hoping it would assign a object pointer to \"handle\"):</p>\n\n<p>Header file:</p>\n\n<pre><code>#define NEW_OBJECT(id, size, handle) \\\n    static uint8_t Buffer_AU8##id[size]; \\\n    static TParameters_S Parameters_S##id = { \\\n        0, Buffer_AU8##id \\\n    }; \\\n    static const TObject_S __attribute__((used, section(\"my_objects\"))) Object_S##id = { \\\n        id, &amp;Parameters_S##id \\\n    }; \\\n    handle = &amp;Object_S##id; \\ &lt;----- This does not work\n</code></pre>\n\n<p>Source file:</p>\n\n<pre><code>TObject_S* object1_PS;\nTObject_S* object1_PS;\n\n// therefore does not work\nNEW_OBJECT(OBJECT1_E, 10, object1_PS);\nNEW_OBJECT(OBJECT2_E, 20, object2_PS);\n\nvoid function(void)\n{\n    // Then operate on the object (and therefore this does not work)\n    object1_PS-&gt;Parameters_PS-&gt;Buffer_PS[object1_PS-&gt;Parameters_PS-&gt;Index_U8];\n}\n</code></pre>\n\n<p>I've also tried this, hoping it would return a pointer to the object (I think I'm taking a chance here):</p>\n\n<p>Header file:</p>\n\n<pre><code>#define NEW_OBJECT(id, size) \\\n    static uint8_t Buffer_AU8##id[size]; \\\n    static TParameters_S Parameters_S##id = { \\\n        0, Buffer_AU8##id \\\n    }; \\\n    static const TObject_S __attribute__((used, section(\"my_objects\"))) Object_S##id = { \\\n        id, &amp;Parameters_S##id \\\n    }; \\\n    &amp;Object_S##id; \\ &lt;----- This does not work\n</code></pre>\n\n<p>Source file:</p>\n\n<pre><code>// therefore this does not work\nTObject_S* object1_PS = NEW_OBJECT(OBJECT1_E, 10, object1_PS);\nTObject_S* object1_PS = NEW_OBJECT(OBJECT2_E, 20, object2_PS);\n\nvoid function(void)\n{\n    // Then operate on the object (and therefore this does not work)\n    object1_PS-&gt;Parameters_PS-&gt;Buffer_PS[object1_PS-&gt;Parameters_PS-&gt;Index_U8];\n}\n</code></pre>\n\n<p>This works, but I think it is creating two pointers for each object. Although I can only see one pointer for each object in the map file:</p>\n\n<p>Header file:</p>\n\n<pre><code>#define NEW_OBJECT(id, size, handle) \\\n    static uint8_t Buffer_AU8##id[size]; \\\n    static TParameters_S Parameters_S##id = { \\\n        0, Buffer_AU8##id \\\n    }; \\\n    static const TObject_S __attribute__((used, section(\"my_objects\"))) Object_S##id = { \\\n        id, &amp;Parameters_S##id \\\n    }; \\\n    static const TObject_S* __attribute__((used, section(\"my_objects_pointers\"))) handle = &amp;Object_S##id; \\ &lt;----- This works\n</code></pre>\n\n<p>Source file:</p>\n\n<pre><code>TObject_S* object1_PS;\nTObject_S* object1_PS;\n\n// therefore this works\nNEW_OBJECT(OBJECT1_E, 10, object1_PS);\nNEW_OBJECT(OBJECT2_E, 20, object2_PS);\n\nvoid function(void)\n{\n    // Then operate on the object (and therefore this works)\n    object1_PS-&gt;Parameters_PS-&gt;Buffer_PS[object1_PS-&gt;Parameters_PS-&gt;Index_U8];\n}\n</code></pre>\n"}, {"tags": ["c++", "c", "browser", "com", "embed"], "answers": [{"tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": true, "score": 0, "last_activity_date": 1565117908, "creation_date": 1565117908, "answer_id": 57382386, "question_id": 57381405, "link": "https://stackoverflow.com/questions/57381405/web-browser-events-using-mshtml-h/57382386#57382386", "title": "Web Browser Events using MsHTML.h", "body": "<p>HTML events \"bubble\" from child elements to parent elements.  So, you can simply assign a single <code>onClick</code> handler to the <code>IHTMLDocument2</code> itself, and then use the <a href=\"https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa703891(v=vs.85)\" rel=\"nofollow noreferrer\"><code>srcElement</code></a> property of the <a href=\"https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa703876(v%3Dvs.85)\" rel=\"nofollow noreferrer\"><code>IHTMLEventObj</code></a> object that is given to your handler every time on <code>onClick</code> event is fired by any child element on the page.  See <a href=\"https://msdn.microsoft.com/en-us/ie/ms533023(v=vs.94)\" rel=\"nofollow noreferrer\">Understanding the Event Model</a>.</p>\n"}], "owner": {"reputation": 21, "user_id": 11063004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78152d3c30ea14ecd92edd9302bced3e?s=128&d=identicon&r=PG&f=1", "display_name": "A. Beam", "link": "https://stackoverflow.com/users/11063004/a-beam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 57382386, "answer_count": 1, "score": -1, "last_activity_date": 1565117908, "creation_date": 1565113277, "question_id": 57381405, "link": "https://stackoverflow.com/questions/57381405/web-browser-events-using-mshtml-h", "title": "Web Browser Events using MsHTML.h", "body": "<p>I am using cwebpage integrated into my program. CWebpage information can be found here:</p>\n\n<p><a href=\"https://www.codeproject.com/Articles/3365/Embed-an-HTML-control-in-your-own-window-using-pla\" rel=\"nofollow noreferrer\">https://www.codeproject.com/Articles/3365/Embed-an-HTML-control-in-your-own-window-using-pla</a></p>\n\n<p>My question is regarding events. I currently have this setup to setup click events using get_anchors() in IHTMLDocument2. I then iterate over all of the elements to create a IDispatch in memory. This holds the event information. When an item is clicked, it sends a WM_NOTIFY to the window and then I can handle the event and parse out what I need to parse from the element that was selected. \nThis all works fine until I run into a page in my software with close to 50,000 anchor tags in which we run out of memory since we hold the events in memory until the the page is destroyed.</p>\n\n<p>Is there a simple way to obtain the clicked element without having to set an event for each individual element? Is it possible to set a click event at a document level and then find the element that tripped it? All I am trying to do is obtain the id of the element that is clicked.</p>\n\n<p>What I've tried:\nI tried to just use a WM_LBUTTONDOWN message read in our browser window and then use htmlDoc2->elementFromPoint() to simply get the information that I need from the element selected. This however does not work well if the page is zoomed or wraps.</p>\n\n<p>Please note this programming is in C/C++, not javascript or vb.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["c", "arrays", "loops", "for-loop"], "comments": [{"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 4, "creation_date": 1565112552, "post_id": 57381237, "comment_id": 101246837, "body": "Show how the array is declared."}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 0, "creation_date": 1565112629, "post_id": 57381237, "comment_id": 101246879, "body": "It seems you need to use the following loop for(int x = 0; x &lt; circlerow; x++)"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1565112971, "post_id": 57381237, "comment_id": 101247043, "body": "What output? Please show a bit more code here so we can see the full picture."}, {"owner": {"reputation": 33, "user_id": 7338064, "user_type": "registered", "profile_image": "https://graph.facebook.com/1501304186866333/picture?type=large", "display_name": "Aldiandya Irsyad Nur Farizi", "link": "https://stackoverflow.com/users/7338064/aldiandya-irsyad-nur-farizi"}, "reply_to_user": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 0, "creation_date": 1565113160, "post_id": 57381237, "comment_id": 101247126, "body": "@VladfromMoscow already editted it  @tadman I use normal 2D array output <code>for(int i = 0; i &lt;= circlerow; i++) { printf(&quot;\\n&quot;); \t\t for(int j = 0; j &lt;= circlecol; j++ ) { \t\t\t printf(&quot;\\t%f&quot;, circles[i][j]); \t\t} \t}</code>"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 7338064, "user_type": "registered", "profile_image": "https://graph.facebook.com/1501304186866333/picture?type=large", "display_name": "Aldiandya Irsyad Nur Farizi", "link": "https://stackoverflow.com/users/7338064/aldiandya-irsyad-nur-farizi"}, "edited": false, "score": 0, "creation_date": 1565113396, "post_id": 57381390, "comment_id": 101247222, "body": "I used circlerow as the array itself  So number of circle row is actually 2, but I input it as one, I already edited my post for the array format."}, {"owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "reply_to_user": {"reputation": 33, "user_id": 7338064, "user_type": "registered", "profile_image": "https://graph.facebook.com/1501304186866333/picture?type=large", "display_name": "Aldiandya Irsyad Nur Farizi", "link": "https://stackoverflow.com/users/7338064/aldiandya-irsyad-nur-farizi"}, "edited": false, "score": 0, "creation_date": 1565113542, "post_id": 57381390, "comment_id": 101247276, "body": "@AldiandyaIrsyadNurFarizi I saw it, see my updated answer, I believe it works now. :)"}], "tags": [], "owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "is_accepted": false, "score": 1, "last_activity_date": 1565113970, "last_edit_date": 1565113970, "creation_date": 1565113196, "answer_id": 57381390, "question_id": 57381237, "link": "https://stackoverflow.com/questions/57381237/inputting-value-on-2d-float-arrays-with-for-loops/57381390#57381390", "title": "Inputting value on 2D Float arrays with for loops", "body": "<p>Change this:</p>\n\n<pre><code>for(int x = 0; x &lt;= circlerow; x++)\n</code></pre>\n\n<p>to this:</p>\n\n<pre><code>for(int x = 0; x &lt; circlerow; x++)\n</code></pre>\n\n<p>since array indexing starts from 0 and ends at size of array - 1.</p>\n\n<p>Similarly, you would do <code>for(int j = 0; j &lt; circlecol; j++)</code>.</p>\n\n<p>In general, if an array is declared as:</p>\n\n<pre><code>array[rows][cols]\n</code></pre>\n\n<p>then its dimensions are <code>rows x cols</code>. <code>array[0][0]</code> is the element in the 1st row and 1st column, and <code>array[rows - 1][cols - 1]</code> is the element in the last column and in the last row.</p>\n\n<hr>\n\n<p>Minimal complete example:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n#define circlecol 1\n#define circlerow 1\n\nint main(void) {\n  float circles[circlerow][circlecol];\n  for(int x = 0; x &lt; circlerow; x++) {\n    scanf(\"%f\", &amp;circles[x][0]);\n    circles[x][1] = 3.14*circles[x][0]*circles[x][0];\n  }\n\n  for(int i = 0; i &lt; circlerow; i++)\n    for(int j = 0; j &lt; circlecol; j++)\n      printf(\"%f\", circles[i][j]);\n  return 0;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 33, "user_id": 7338064, "user_type": "registered", "profile_image": "https://graph.facebook.com/1501304186866333/picture?type=large", "display_name": "Aldiandya Irsyad Nur Farizi", "link": "https://stackoverflow.com/users/7338064/aldiandya-irsyad-nur-farizi"}, "edited": false, "score": 0, "creation_date": 1565113605, "post_id": 57381432, "comment_id": 101247303, "body": "ah, it works, but didn&#39;t it mean really the same thing?, I mean since array start from 0, and ends in 2, you just make the for loop using &lt; instead of &lt;= and increase array size?,   i mean array[x][y] has the size of x+1 and y+1 right?"}, {"owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "reply_to_user": {"reputation": 33, "user_id": 7338064, "user_type": "registered", "profile_image": "https://graph.facebook.com/1501304186866333/picture?type=large", "display_name": "Aldiandya Irsyad Nur Farizi", "link": "https://stackoverflow.com/users/7338064/aldiandya-irsyad-nur-farizi"}, "edited": false, "score": 0, "creation_date": 1565113673, "post_id": 57381432, "comment_id": 101247341, "body": "@AldiandyaIrsyadNurFarizi no, <code>array[x][y]</code> has the size of <code>x</code> and <code>y</code>. <code>array[0][0]</code> is the element in the 1st row and 1st column, and <code>array[x - 1][y - 1]</code> is the element in the last column and in the last row."}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "reply_to_user": {"reputation": 33, "user_id": 7338064, "user_type": "registered", "profile_image": "https://graph.facebook.com/1501304186866333/picture?type=large", "display_name": "Aldiandya Irsyad Nur Farizi", "link": "https://stackoverflow.com/users/7338064/aldiandya-irsyad-nur-farizi"}, "edited": false, "score": 0, "creation_date": 1565113705, "post_id": 57381432, "comment_id": 101247353, "body": "@AldiandyaIrsyadNurFarizi If an array has N elements then the valid range of indices is [0, N). So you have to add one more row and column and use the condition in the loop c &lt; circlerow. In this case valid indices will be 0 and 1 that is they both less than circlerow."}], "tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": true, "score": 0, "last_activity_date": 1565113427, "creation_date": 1565113427, "answer_id": 57381432, "question_id": 57381237, "link": "https://stackoverflow.com/questions/57381237/inputting-value-on-2d-float-arrays-with-for-loops/57381432#57381432", "title": "Inputting value on 2D Float arrays with for loops", "body": "<p>This array</p>\n\n<pre><code>float circles[circlerow][circlecol];\n</code></pre>\n\n<p>in fact is declared as</p>\n\n<pre><code>float circles[1][1];\n</code></pre>\n\n<p>that is it has one row and one column that is only one element that can be accessed using expression <code>circle[0][0]</code>.</p>\n\n<p>It seems you mean the following</p>\n\n<pre><code>#define circlecol 2\n#define circlerow 2\n\nint main( void ) {\n    float circles[circlerow][circlecol];\n    for(int x = 0; x &lt; circlerow; x++) {\n        scanf(\"%f\", &amp;circles[x][0]);\n        circles[x][1] = 3.14*circles[x][0]*circles[x][0];\n    }\n}\n</code></pre>\n\n<p>That is the array shall have two rows and two columns.</p>\n"}], "owner": {"reputation": 33, "user_id": 7338064, "user_type": "registered", "profile_image": "https://graph.facebook.com/1501304186866333/picture?type=large", "display_name": "Aldiandya Irsyad Nur Farizi", "link": "https://stackoverflow.com/users/7338064/aldiandya-irsyad-nur-farizi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31, "favorite_count": 0, "accepted_answer_id": 57381432, "answer_count": 2, "score": 3, "last_activity_date": 1565113970, "creation_date": 1565112460, "last_edit_date": 1565113539, "question_id": 57381237, "link": "https://stackoverflow.com/questions/57381237/inputting-value-on-2d-float-arrays-with-for-loops", "title": "Inputting value on 2D Float arrays with for loops", "body": "<p>I'm trying to make a 2D array that has 2 column and some row. The first column is inputted by using scanf is the radius, while the second column are dependent on the first column is the area.</p>\n\n<p>I already tried to leave them out of loops (manual input) then output them immediately but somehow only the last and first input are correct</p>\n\n<pre><code>#define circlecol 1\n#define circlerow 1\n\nint main() {\n    float circles[circlerow][circlecol];\n    for(int x = 0; x &lt;= circlerow; x++) {\n        scanf(\"%f\", &amp;circles[x][0]);\n        circles[x][1] = 3.14*circles[x][0]*circles[x][0];\n    }`\n</code></pre>\n\n<p>With the input of 8 and 3 I expected this to be the output</p>\n\n<p>Your Circle:\n        8.000000        200.960000\n        3.000000        28.260000</p>\n\n<p>But I get this instead</p>\n\n<p>Your Circle:\n        8.000000        0.000000\n        0.000000        28.260000</p>\n\n<p>The format was</p>\n\n<p>Your Circle: [0][0] [0][1] [1][0] [1][1]</p>\n"}, {"tags": ["c", "optimization", "x86", "switch-statement", "sse2"], "comments": [{"owner": {"reputation": 8154, "user_id": 2470782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921783e0584f9ace7e05d303e4d48869?s=128&d=identicon&r=PG", "display_name": "Ingo Leonhardt", "link": "https://stackoverflow.com/users/2470782/ingo-leonhardt"}, "edited": false, "score": 3, "creation_date": 1565111462, "post_id": 57380816, "comment_id": 101246365, "body": "honestly, I think it&#39;s hard to outperform <code>switch()</code> with a decent optimizer."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 2, "creation_date": 1565126822, "post_id": 57380816, "comment_id": 101252502, "body": "How are you benchmarking this (what kind of loop)?  And what CPU are you testing on?  Ryzen?  Skylake?  Core 2?  Also which gcc version?  (I think the question is mostly answerable without that, but a better implementation than both may be possible for CPUs with fast <code>cmov</code> because you only have 2 contiguous ranges).  Like <code>tmp = c - &#39;a&#39;</code> and if that wraps (unsigned) then assume it was a <code>0..9</code> digit.  Can you assume your input is a hex digit, or does this function <i>need</i> to return <code>0</code> otherwise?  What about chars between <code>&#39;9&#39;</code> and <code>&#39;a&#39;</code> : are those possible?"}, {"owner": {"reputation": 7053, "user_id": 1162141, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7db6bfbfbb420620e6df76c0e406098d?s=128&d=identicon&r=PG", "display_name": "technosaurus", "link": "https://stackoverflow.com/users/1162141/technosaurus"}, "edited": false, "score": 2, "creation_date": 1565137185, "post_id": 57380816, "comment_id": 101254683, "body": "An sse2 (or generalized vector extensions) solution <i>could</i> do 16 at a time (or more) instead of 1.  The switch solution is fast for single items because the compiler generates a lookup table that you can easily create using designated initializers.  Your sse2 solution can&#39;t be vectorized by normal compilers because you perform non-vectorizable ops on individual components.  Using gcc vector extensions only to mathematically compute the value will allow you to do 8, 16, 32, 64 or more at a time ... but you didn&#39;t state your use case.  Need more info to answer."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 7053, "user_id": 1162141, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7db6bfbfbb420620e6df76c0e406098d?s=128&d=identicon&r=PG", "display_name": "technosaurus", "link": "https://stackoverflow.com/users/1162141/technosaurus"}, "edited": false, "score": 0, "creation_date": 1565143451, "post_id": 57380816, "comment_id": 101255731, "body": "@technosaurus: we have mostly enough info to answer the question asked (why is switch faster), like I did in comments on the answer with asm output.  But yeah we don&#39;t have enough info to know if an answer that processes 4, 8, or 16 bytes at a time with <code>_mm_cmpgt_epi8</code> and a blend would be useful, and how much checking for out-of-bounds chars is needed.  But nice idea, that&#39;s the SIMD version of what I was thinking with <code>cmov</code>."}, {"owner": {"reputation": 7053, "user_id": 1162141, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7db6bfbfbb420620e6df76c0e406098d?s=128&d=identicon&r=PG", "display_name": "technosaurus", "link": "https://stackoverflow.com/users/1162141/technosaurus"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1565148126, "post_id": 57380816, "comment_id": 101256447, "body": "@PeterCordes yes, we have enough to answer the question asked, but not the question intended.  It goes back to your question about how it&#39;s benchmarked.  The answers are different if it&#39;s just called often in hot code (lut is fast) or if it&#39;s sequentially computed in large batches (simd may be faster).  The simd code may be different depending on whether the input and output data can be aligned or if it&#39;s in random sized chunks in random locations.  Your <code>cmov</code> solution can be done with vector extensions using compare+&amp; wizardry."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 7053, "user_id": 1162141, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7db6bfbfbb420620e6df76c0e406098d?s=128&d=identicon&r=PG", "display_name": "technosaurus", "link": "https://stackoverflow.com/users/1162141/technosaurus"}, "edited": false, "score": 1, "creation_date": 1565148651, "post_id": 57380816, "comment_id": 101256528, "body": "@technosaurus: yes exactly.  Hopefully that helps the OP figure out what they need.  In large batches SIMD will pretty <i>definitely</i> be faster if the input data is contiguous in memory.  (Especially if we can use SSE4.1 for <code>pblendvb</code> and run on a CPU where that doesn&#39;t create a port5 bottleneck.  AVX512BW would be the best case, giving us unsigned byte compares so range checks can be sub/unsigned-cmp without having to range-shift for <code>pcmpgtb</code> by flipping the top bit (or use saturating sub / pcmpeqb instead), and AVX512 makes blending nearly free as part of other operations.)"}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 11729009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1aeaab067fd7d266f8e47764ee6e2ad9?s=128&d=identicon&r=PG&f=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/11729009/jason"}, "edited": false, "score": 0, "creation_date": 1565111719, "post_id": 57380995, "comment_id": 101246468, "body": "it&#39;s not about compile time ... i test it with reading the content of a file so it&#39;s not compile time ... it&#39;s run time ... both functions are tested in run-time action ... but im sure SSE2 can act faster but i don&#39;t know what is problem with my SSE2 function"}, {"owner": {"reputation": 416, "user_id": 10291440, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bp4ZW.jpg?s=128&g=1", "display_name": "Bryan", "link": "https://stackoverflow.com/users/10291440/bryan"}, "reply_to_user": {"reputation": 75, "user_id": 11729009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1aeaab067fd7d266f8e47764ee6e2ad9?s=128&d=identicon&r=PG&f=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/11729009/jason"}, "edited": false, "score": 1, "creation_date": 1565111857, "post_id": 57380995, "comment_id": 101246543, "body": "And still the jump table will be faster. I was just stating that the result can and often is determined at compile time"}, {"owner": {"reputation": 416, "user_id": 10291440, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bp4ZW.jpg?s=128&g=1", "display_name": "Bryan", "link": "https://stackoverflow.com/users/10291440/bryan"}, "reply_to_user": {"reputation": 75, "user_id": 11729009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1aeaab067fd7d266f8e47764ee6e2ad9?s=128&d=identicon&r=PG&f=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/11729009/jason"}, "edited": false, "score": 0, "creation_date": 1565112080, "post_id": 57380995, "comment_id": 101246637, "body": "SIMD code is likely to be faster when there are a large number of cases but there aren&#39;t nearly enough here. The switch statement will also benefit performance wise due to the branch predictor"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 3, "creation_date": 1565126127, "post_id": 57380995, "comment_id": 101252291, "body": "Compilers aren&#39;t &quot;bad at optimizing intrinsics&quot;; the compiler makes pretty good asm given that C source.  It&#39;s just not the most efficient way to implement the desired output.  What makes this fast isn&#39;t a jump table but a <i>data</i> lookup table.  A jump table would suffer mispredicts and be slower than SSE2."}, {"owner": {"reputation": 416, "user_id": 10291440, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bp4ZW.jpg?s=128&g=1", "display_name": "Bryan", "link": "https://stackoverflow.com/users/10291440/bryan"}, "edited": false, "score": 0, "creation_date": 1565126932, "post_id": 57380995, "comment_id": 101252533, "body": "Compilers are generally bad at optimizing intrinsics as I said in my answer as there is not much they can optimize for. You are right a data look up table is an even faster optimization a compiler might make although a jump table this size should still be faster on average than SSE2."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1565143199, "post_id": 57380995, "comment_id": 101255687, "body": "If you want to see compilers be bad at optimizing intrinsics, look at gcc or older clang with ARM NEON intrinsics.  gcc and especially clang are quite good with x86 intrinsics.  e.g. clang&#39;s shuffle optimizer can totally transform your shuffles into different instructions.  I&#39;d say that <code>switch</code> is kind of a special case where compilers have <i>many</i> clever tricks to avoid just compiling it into a jump table. e.g. if many cases do the same thing, it might just check a bitmap.  Including using the bitmap as an immediate.  A jump table would be bad for unpredictable patterns."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 2, "creation_date": 1565143231, "post_id": 57380995, "comment_id": 101255693, "body": "I still wouldn&#39;t call it &quot;bad&quot; to compile the SSE2 version mostly as written.  That&#39;s the programmer&#39;s fault for using SSE2 to process only 1 letter at a time instead of 16, given the simple mapping they want to implement."}], "tags": [], "owner": {"reputation": 416, "user_id": 10291440, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bp4ZW.jpg?s=128&g=1", "display_name": "Bryan", "link": "https://stackoverflow.com/users/10291440/bryan"}, "is_accepted": false, "score": 0, "last_activity_date": 1565123048, "last_edit_date": 1565123048, "creation_date": 1565111444, "answer_id": 57380995, "question_id": 57380816, "link": "https://stackoverflow.com/questions/57380816/mapping-hex-digits-to-contiguous-integers-gccs-switch-works-1-5x-faster-than-m/57380995#57380995", "title": "Mapping hex digits to contiguous integers: GCC&#39;s switch works 1.5x faster than my hand-written SSE2 intrinsics cmpeq / movemask / bsf?", "body": "<p>Compilers are bad at optimizing intrinsics.<br>\nThis is definitely a case of premature optimization.<br>\nWhy is this function too slow?<br>\nAny mainstream compiler at these optimization levels is going to turn this switch statement into a jump table and resolve the answer at compile time if possible.<br>\nYou should stick with the switch statement for readability, portability and performance for such a small operation.</p>\n"}, {"comments": [{"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1565313038, "post_id": 57421510, "comment_id": 101323798, "body": "Also important to mention that <code>_mm_set1_epi8</code> is not particularly fast without SSSE3 for a single-uop broadcast with <code>pshufb</code> instead of a chain of 3 shuffles. On Intel Haswell and later, 1 shuf / clock + <code>movd xmm, eax</code> could be a port5 throughput bottleneck.  There enough total work in the stand-alone version of the function in another answer to fill the front-end for 3 cycles, but not 4.  But anyway, <code>movd</code> + 3x shuffles is not cheap, compared to AVX512BW <code>vpbroadcastb xmm0, eax</code> which is <a href=\"https://www.uops.info/html-instr/VPBROADCASTB_XMM_K_R32.html\" rel=\"nofollow noreferrer\">1 port5 uop total on SKX</a>"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1565313582, "post_id": 57421510, "comment_id": 101323908, "body": "I was going to say you can save the <code>set1(16)</code> constant by using a left shift to get <code>-16</code> from <code>0xFF</code>, but that doesn&#39;t work because x86 doesn&#39;t have SIMD shifts with byte granularity, only word and wider.  Also, clang with AVX512BW does a very good job with your function (<a href=\"https://godbolt.org/z/3lJkqu\" rel=\"nofollow noreferrer\">godbolt.org/z/3lJkqu</a>), using masked compare-into-mask to AND two compare results together for free."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1565313940, "post_id": 57421510, "comment_id": 101323989, "body": "gcc and clang pick interesting different strategies for a scalar version of your function: <a href=\"https://godbolt.org/z/eIXM0L\" rel=\"nofollow noreferrer\">godbolt.org/z/eIXM0L</a>.  gcc using <code>sbb edx,edx</code> to get a <code>-1</code> in a register to actually implement the code as written, clang using <code>cmov</code>."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565317071, "post_id": 57421510, "comment_id": 101324543, "body": "The GCC switch code is in Bwebb&#39;s answer: subtracts 48 and uses as an offset to 54-item table"}], "tags": [], "owner": {"reputation": 7053, "user_id": 1162141, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7db6bfbfbb420620e6df76c0e406098d?s=128&d=identicon&r=PG", "display_name": "technosaurus", "link": "https://stackoverflow.com/users/1162141/technosaurus"}, "is_accepted": false, "score": 4, "last_activity_date": 1565304201, "creation_date": 1565304201, "answer_id": 57421510, "question_id": 57380816, "link": "https://stackoverflow.com/questions/57380816/mapping-hex-digits-to-contiguous-integers-gccs-switch-works-1-5x-faster-than-m/57421510#57421510", "title": "Mapping hex digits to contiguous integers: GCC&#39;s switch works 1.5x faster than my hand-written SSE2 intrinsics cmpeq / movemask / bsf?", "body": "<p>Most compilers will convert your switch into a lookup table or jump table as if it were similar to the following code:</p>\n\n<pre><code>char lut_func(char c){\n    static const char lut[256] = {\n        ['0']=0x40, ['1']=0x41, ['2']=0x42, ['3']=0x43,\n        ['4']=0x44, ['5']=0x45, ['6']=0x46, ['7']=0x47,\n        ['8']=0x48, ['9']=0x49, ['a']=0x4a, ['b']=0x4b,\n        ['c']=0x4c, ['d']=0x4d, ['e']=0x4e, ['f']=0x4f,\n        /* everything else is set to 0 automatically */\n    };\n    return  lut[(unsigned char)c];\n}\n</code></pre>\n\n<p>The only problems with this:</p>\n\n<ul>\n<li>cannot vectorize</li>\n<li>the common? data (0-9,a-f) spans 2 64 byte data cache lines</li>\n</ul>\n\n<p>You can remedy the cache line misses by properly aligning and offsetting the data (your compiler may be able to do this if you profile your code) something like:</p>\n\n<pre><code>char lut_func(char c){\n    static const char __attribute__((aligned(64)))lut_data[256+16] = {\n        ['0'+16]=0x40, ['1'+16]=0x41, ['2'+16]=0x42, ['3'+16]=0x43,\n        ['4'+16]=0x44, ['5'+16]=0x45, ['6'+16]=0x46, ['7'+16]=0x47,\n        ['8'+16]=0x48, ['9'+16]=0x49, ['a'+16]=0x4a, ['b'+16]=0x4b,\n        ['c'+16]=0x4c, ['d'+16]=0x4d, ['e'+16]=0x4e, ['f'+16]=0x4f,\n        /* everything else is set to 0 automatically */\n    };\n    char lut = lut_data+16;\n    return  lut[(unsigned char)c];\n}\n</code></pre>\n\n<p>Its hard to say if this will help much since neither the makeup of the data nor the benchmark was included.</p>\n\n<p>The hand written SSE2 code (though clever) unfortunately contains non-SSE2 code that slows down the code and makes it difficult to auto-vectorize (<code>__builtin_ctz</code>, <code>if</code> and the char array access) especially if you are limited to SSE2.  This is just less efficient than a single data access when the data is already \"hot\".  It may still be worth using the SSE2 version if its infrequently called, but if that were the case you wouldn't need to optimize it.</p>\n\n<p>If you can access the data sequentially, you can use vector extensions to get SIMD code something like this:</p>\n\n<pre><code>//this vector extension syntax requires gcc or clang versions 5+\ntypedef __INT8_TYPE__ i8x16 __attribute__ ((__vector_size__ (16), aligned(16), __may_alias__));\ni8x16 vec_func(i8x16 c){\n    i8x16 is09 = (c&gt;='0') &amp; (c&lt;='9');\n    i8x16 isaf = (c&gt;='a') &amp; (c&lt;='f');\n    return (c &amp; (is09 | isaf)) + (16 &amp; is09) - (23 &amp; isaf);\n}\n</code></pre>\n\n<p>Compiled on architectures with SIMD instructions (x86_64, arm+neon, ppc+altivec, etc..) this compiles to ~20 instructions and accesses around 80 bytes of data to compute 16 sequential characters (with AVX2 you can do 32 with minimal modification)</p>\n\n<p>For example compilation with generic x86_64 yields:</p>\n\n<pre><code>vec_func:                                   # @lu16\n    movdqa  xmm1, xmm0\n    pcmpgtb xmm1, xmmword ptr [rip + .LCPI0_0]\n    movdqa  xmm2, xmmword ptr [rip + .LCPI0_1] # xmm2 = [58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58]\n    pcmpgtb xmm2, xmm0\n    movdqa  xmm3, xmm0\n    pcmpgtb xmm3, xmmword ptr [rip + .LCPI0_2]\n    pand    xmm2, xmm1\n    movdqa  xmm1, xmmword ptr [rip + .LCPI0_3] # xmm1 = [103,103,103,103,103,103,103,103,103,103,103,103,103,103,103,103]\n    pcmpgtb xmm1, xmm0\n    pand    xmm1, xmm3\n    movdqa  xmm3, xmm2\n    por     xmm3, xmm1\n    pand    xmm3, xmm0\n    pand    xmm2, xmmword ptr [rip + .LCPI0_4]\n    pand    xmm1, xmmword ptr [rip + .LCPI0_5]\n    por     xmm1, xmm2\n    paddb   xmm1, xmm3\n    movdqa  xmm0, xmm1\n    ret\n</code></pre>\n\n<p>or with AVX2 enabled</p>\n\n<pre><code>vec_func:\n    vpcmpgtb        xmm1, xmm0, xmmword ptr [rip + .LCPI0_0]\n    vmovdqa xmm2, xmmword ptr [rip + .LCPI0_1] # xmm2 = [58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58]\n    vpcmpgtb        xmm2, xmm2, xmm0\n    vpcmpgtb        xmm3, xmm0, xmmword ptr [rip + .LCPI0_2]\n    vpand   xmm1, xmm1, xmm2\n    vmovdqa xmm2, xmmword ptr [rip + .LCPI0_3] # xmm2 = [103,103,103,103,103,103,103,103,103,103,103,103,103,103,103,103]\n    vpcmpgtb        xmm2, xmm2, xmm0\n    vpand   xmm2, xmm3, xmm2\n    vpor    xmm3, xmm1, xmm2\n    vpand   xmm0, xmm3, xmm0\n    vpand   xmm1, xmm1, xmmword ptr [rip + .LCPI0_4]\n    vpand   xmm2, xmm2, xmmword ptr [rip + .LCPI0_5]\n    vpor    xmm1, xmm2, xmm1\n    vpaddb  xmm0, xmm1, xmm0\n    ret\n</code></pre>\n\n<p>and aarch64</p>\n\n<pre><code>vec_func:\n    movi    v2.16b, 0x61\n    movi    v4.16b, 0x66\n    movi    v1.16b, 0x30\n    movi    v5.16b, 0x39\n    cmge    v3.16b, v0.16b, v2.16b\n    cmge    v2.16b, v4.16b, v0.16b\n    cmge    v1.16b, v0.16b, v1.16b\n    cmge    v5.16b, v5.16b, v0.16b\n    movi    v4.16b, 0x10\n    and     v2.16b, v3.16b, v2.16b\n    and     v1.16b, v1.16b, v5.16b\n    movi    v5.16b, 0x17\n    and     v3.16b, v1.16b, v4.16b\n    orr     v1.16b, v1.16b, v2.16b\n    and     v2.16b, v2.16b, v5.16b\n    and     v1.16b, v1.16b, v0.16b\n    add     v1.16b, v1.16b, v3.16b\n    sub     v0.16b, v1.16b, v2.16b\n    ret\n</code></pre>\n\n<p>or power9</p>\n\n<pre><code>vec_func:\n    xxspltib 35, 47\n    xxspltib 36, 58\n    vcmpgtsb 3, 2, 3\n    vcmpgtsb 4, 4, 2\n    xxland 0, 35, 36\n    xxspltib 35, 96\n    xxspltib 36, 103\n    vcmpgtsb 3, 2, 3\n    vcmpgtsb 4, 4, 2\n    xxland 1, 35, 36\n    xxlor 2, 0, 1\n    xxlxor 3, 3, 3\n    xxsel 34, 3, 34, 2\n    xxspltib 2, 16\n    xxsel 35, 3, 2, 0\n    xxspltib 0, 233\n    xxsel 36, 3, 0, 1\n    xxlor 35, 36, 35\n    vaddubm 2, 3, 2\n    blr\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 11729009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1aeaab067fd7d266f8e47764ee6e2ad9?s=128&d=identicon&r=PG&f=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/11729009/jason"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1565304201, "creation_date": 1565110701, "last_edit_date": 1565126240, "question_id": 57380816, "link": "https://stackoverflow.com/questions/57380816/mapping-hex-digits-to-contiguous-integers-gccs-switch-works-1-5x-faster-than-m", "title": "Mapping hex digits to contiguous integers: GCC&#39;s switch works 1.5x faster than my hand-written SSE2 intrinsics cmpeq / movemask / bsf?", "body": "<p>I have a function which gets a character and checks it then return another character (depends on received character).</p>\n\n<p>I used (switch) to check the provided character and return what we want but I need more speed so I used (SSE2) too.</p>\n\n<p>My SSE2 function is 1.5x slower than switch function.  Why?  <strong>What's slow about my SSE2 function, and what is <code>gcc -O3</code> doing to implement <code>switch</code> that's so fast?</strong></p>\n\n<pre><code>char\nswitch_func(char c) {\n    switch (c) {\n        case '0':\n            return 0x40;\n        case '1':\n            return 0x41;\n        case '2':\n            return 0x42;\n        case '3':\n            return 0x43;\n        case '4':\n            return 0x44;\n        case '5':\n            return 0x45;\n        case '6':\n            return 0x46;\n        case '7':\n            return 0x47;\n        case '8':\n            return 0x48;\n        case '9':\n            return 0x49;\n        case 'a':\n            return 0x4a;\n        case 'b':\n            return 0x4b;\n        case 'c':\n            return 0x4c;\n        case 'd':\n            return 0x4d;\n        case 'e':\n            return 0x4e;\n        case 'f':\n            return 0x4f;\n        default:\n            return 0x00;\n    }\n}\n</code></pre>\n\n<p>and the SSE2 function -></p>\n\n<pre><code>char\nSSE2_func(char c) {\n\n    __m128i vec0 = _mm_set_epi8('f','e','d','c','b','a','9',\n            '8','7','6','5','4','3','2','1','0');\n    __m128i vec1 = _mm_set1_epi8(c);\n\n    static char list[] = {\n            0x40,0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x4b,0x4c,0x4d,0x4e,0x4f\n    };\n\n    vec1 = _mm_cmpeq_epi8(vec0, vec1); // Compare to find (c) in (vec0) list\n\n    int x;\n    if((x = _mm_movemask_epi8(vec1)) != 0) {\n        if((x = __builtin_ctz(x)) &lt; 16) { // x is the position of (c) character in (list[])\n            return list[__builtin_ctz(x)];\n        }\n    }\n    return 0x00;\n}\n</code></pre>\n\n<p>GCC compiler : (-O3 -msse2)</p>\n"}, {"tags": ["c", "pointers", "printf", "operators"], "comments": [{"owner": {"reputation": 65854, "user_id": 1374437, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/34xta.png?s=128&g=1", "display_name": "Hristo &#39;away&#39; Iliev", "link": "https://stackoverflow.com/users/1374437/hristo-away-iliev"}, "edited": false, "score": 2, "creation_date": 1565110598, "post_id": 57380737, "comment_id": 101245997, "body": "<code>%s</code> expects a pointer to a string. <code>*p</code> is a single char and hence the segfault. <code>&amp;p</code> is a pointer to a pointer and after dereferencing with the <code>*</code> operator you get back the original pointer."}], "answers": [{"comments": [{"owner": {"reputation": 308, "user_id": 3927579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79c6744b7d14faaaa0cf636601f0aeb5?s=128&d=identicon&r=PG", "display_name": "tbejos", "link": "https://stackoverflow.com/users/3927579/tbejos"}, "edited": false, "score": 0, "creation_date": 1565110729, "post_id": 57380811, "comment_id": 101246048, "body": "I would put a code block around <code>char *</code> to make it a little more readable but seems good otherwise."}], "tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": true, "score": 2, "last_activity_date": 1565111214, "last_edit_date": 1565111214, "creation_date": 1565110675, "answer_id": 57380811, "question_id": 57380737, "link": "https://stackoverflow.com/questions/57380737/what-is-the-difference-between-p-and-p/57380811#57380811", "title": "What is the difference between *p and *&amp;p", "body": "<p><code>*&amp;p</code> in fact is the same as <code>p</code> and has type char *.</p>\n\n<p>So these calls</p>\n\n<pre><code>printf(\"%s\\n\", *&amp;p);\nprintf(\"%s\\n\", p);\n</code></pre>\n\n<p>produce the same result.</p>\n\n<p><code>*p</code> has type <code>char</code> and may not be used with the format specifier <code>%s</code>. Otherwise using it with the format specifier <code>%s</code> results in undefined behavior</p>\n\n<p>You could write instead</p>\n\n<pre><code>printf(\"%c\\n\", *p);\n        ^^\n</code></pre>\n\n<p>Pay attention to that it is not always <code>*&amp;p</code> is equivalent to <code>p</code>.</p>\n\n<p>For example you may not apply the operator &amp; to a <code>non-lvalue</code>.</p>\n\n<p>Consider the following demonstrative program.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nchar * f( void )\n{\n    char *p = \"Hello\";\n\n    return p;\n}\n\nint main(void) \n{\n    printf( \"%s\\n\", f() );\n    // The statement below will not compile if to uncomment it\n    // printf( \"%s\\n\", *&amp;f() );\n\n    return 0;\n}\n</code></pre>\n\n<p>In this program the returned temporary object from the function <code>f</code> is not lvalue.</p>\n"}, {"tags": [], "owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "is_accepted": false, "score": 1, "last_activity_date": 1565111047, "last_edit_date": 1565111047, "creation_date": 1565110717, "answer_id": 57380819, "question_id": 57380737, "link": "https://stackoverflow.com/questions/57380737/what-is-the-difference-between-p-and-p/57380819#57380819", "title": "What is the difference between *p and *&amp;p", "body": "<p><code>&amp;p</code> is the address of the variable <code>p</code>, with a type <code>char **</code>. The value <code>*&amp;p</code> is then dereferencing this address, giving an l-value of type <code>char *</code> for the variable <code>p</code>. <code>*&amp;p</code> is exactly equivalent to <code>p</code>.</p>\n\n<p><code>*p</code> is dereferencing the variable <code>p</code>. This gives an l-value of type <code>char</code> to the character pointed to by <code>p</code>, in this case the <code>'e'</code> at the beginning of the string. (Note that although it is of type <code>char</code>, this value is read-only because <code>p</code> is a pointer to a string literal.)</p>\n\n<p>Due to default type conversions, you end up passing an <code>int</code> of value <code>'e'</code> to <code>printf</code>. <code>printf</code> treats this value as an address, because you use the format specifier <code>\"%s\"</code>, <code>printf</code> dereferences this pointer, which is an invalid memory access..</p>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 4537611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd843ef313a33be3768ab9222673d925?s=128&d=identicon&r=PG", "display_name": "marcelom", "link": "https://stackoverflow.com/users/4537611/marcelom"}, "is_accepted": false, "score": 0, "last_activity_date": 1565112033, "creation_date": 1565112033, "answer_id": 57381146, "question_id": 57380737, "link": "https://stackoverflow.com/questions/57380737/what-is-the-difference-between-p-and-p/57381146#57381146", "title": "What is the difference between *p and *&amp;p", "body": "<p>In this case:<br></p>\n\n<pre>\n1)   <b>p</b>   is a char pointer storing the <b>address</b> where is stored first 'e' letter in \"example\"\n2)   <b>*p</b>  is the value stored at that address stored in <b>p</b>, that means the value 'e' \n3)   <b>*&p</b> = *(&p) is the value pointed by the address of p then *&p == p \n</pre>\n\n<p>then given 1,2,3 :</p>\n\n<pre><code>printf(\"%s\\n\", *&amp;p);  // is equivalent to printf(\"%s\\n\",p)      which is OK\nprintf(\"%s\\n\", *p);   // is equivalent to printf(\"%s\\n\",'e')    which is wrong \n                      // because 'e' is interpreted as an address\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 11804391, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-rydPq_n9NsI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdw9_lqWBZ1sLwdBogKEEPXRbVhPQ/photo.jpg?sz=128", "display_name": "Arnab Bhowmick", "link": "https://stackoverflow.com/users/11804391/arnab-bhowmick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 57380811, "answer_count": 3, "score": 0, "last_activity_date": 1565112033, "creation_date": 1565110418, "last_edit_date": 1565111386, "question_id": 57380737, "link": "https://stackoverflow.com/questions/57380737/what-is-the-difference-between-p-and-p", "title": "What is the difference between *p and *&amp;p", "body": "<p>I'm having problem with this code, </p>\n\n<pre><code>int main()\n{\n char *p = \"example\";\n printf(\"%s\\n\", *&amp;p);   This is giving desired output\n printf(\"%s\\n\", *p);    Here giving segmentation fault\n return 0;\n} \n</code></pre>\n\n<p>My question is what is the difference between *&amp;p and *p here and how they are working in this code?</p>\n"}, {"tags": ["c", "matlab", "mingw"], "comments": [{"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 0, "creation_date": 1565109402, "post_id": 57380490, "comment_id": 101245478, "body": "The way that a newline is interpreted varies."}], "answers": [{"comments": [{"owner": {"reputation": 792, "user_id": 3007075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75a197e963f9bee28b4b692a594ee54f?s=128&d=identicon&r=PG&f=1", "display_name": "Mefitico", "link": "https://stackoverflow.com/users/3007075/mefitico"}, "edited": false, "score": 0, "creation_date": 1565273165, "post_id": 57384749, "comment_id": 101309053, "body": "Yep, that worked. Thanks for the code quality feedback as well."}], "tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": true, "score": 1, "last_activity_date": 1565130227, "creation_date": 1565130227, "answer_id": 57384749, "question_id": 57380490, "link": "https://stackoverflow.com/questions/57380490/how-to-print-n-in-windows/57384749#57384749", "title": "How to print \\n in windows?", "body": "<p>Open the file in binary mode so that the NL to CRLF mapping used with text files is not done for you.  So:</p>\n\n<pre><code>const char filename[] = \"out.txt\";\nFILE *fid = fopen(filename, \"wb\");\nif (fid == 0)\n{\n    fprintf(stderr, \"Failed to open file %s for binary writing\\n\", filename);\n    exit(EXIT_FAILURE);\n}\n</code></pre>\n\n<p>(assuming you include <code>&lt;stdlib.h&gt;</code> too).  I don't recommend <code>void main()</code> \u2014 the correct standard definition for no arguments is <code>int main(void)</code>, and then you could use <code>return 1;</code> instead of <code>exit(EXIT_FAILURE);</code> to report the error to the environment.  See also <a href=\"https://stackoverflow.com/questions/204476/what-should-main-return-in-c-and-c/18721336#18721336\">What should <code>main()</code> return in C and C++?</a> for more information.</p>\n"}], "owner": {"reputation": 792, "user_id": 3007075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75a197e963f9bee28b4b692a594ee54f?s=128&d=identicon&r=PG&f=1", "display_name": "Mefitico", "link": "https://stackoverflow.com/users/3007075/mefitico"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "closed_date": 1565130919, "accepted_answer_id": 57384749, "answer_count": 1, "score": 0, "last_activity_date": 1565130227, "creation_date": 1565109313, "question_id": 57380490, "link": "https://stackoverflow.com/questions/57380490/how-to-print-n-in-windows", "closed_reason": "Duplicate", "title": "How to print \\n in windows?", "body": "<p>I need to print a newline character to a file with a C program running in windows and compiling with MinGW. However, it has to print <code>\\n</code> only, instead of <code>\\r\\n</code>.</p>\n\n<p>Take for example the following program:</p>\n\n<pre><code>#include &lt;stdio&gt;\n\nvoid main() {\n    FILE * fid = fopen(\"out.txt\", \"w\");\n    fprintf(fid, \"\\n\");\n    fclose(fid);\n}\n</code></pre>\n\n<p>Reading the created file in Matlab with the command:</p>\n\n<p><code>text = int32(fileread('out.txt'))</code></p>\n\n<p>Yields:</p>\n\n<p><code>1x2 int32 row vector</code></p>\n\n<p><code>13 10</code></p>\n\n<p>Yet, somehow, I need it to print only <code>10</code> and not the <code>13</code> (=<code>\\r</code>) character.</p>\n"}, {"tags": ["c", "winapi", "path", "device", "createfile"], "comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1565109013, "post_id": 57380169, "comment_id": 101245308, "body": "Do not include a signoff or &quot;Thanks&quot; in a question."}, {"owner": {"reputation": 14659, "user_id": 2705055, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b1d5dfaf239229501a184c8858fbc954?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Rosenau", "link": "https://stackoverflow.com/users/2705055/martin-rosenau"}, "edited": false, "score": 1, "creation_date": 1565109789, "post_id": 57380169, "comment_id": 101245641, "body": "Not exactly what you are searching for: Using <code>QueryDosDevice(NULL,...)</code> you get a list of all devices and using <code>QueryDosDevice(&quot;jyezu-0&quot;,...)</code> you get the unique system-internal device name. Many USB devices have two or more names (like <code>jyezu-0</code> and <code>HID#VID_04B4&amp;PID_8613&amp;MI_06&amp;...</code>). You may search for a second device name belonging to the same system-internal device as <code>jyezu-0</code> that has the <code>HID#...</code> or <code>USB#...</code> format."}, {"owner": {"reputation": 21, "user_id": 7048417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f86b6213447f111612a133807654d3e4?s=128&d=identicon&r=PG", "display_name": "JMartin", "link": "https://stackoverflow.com/users/7048417/jmartin"}, "edited": false, "score": 0, "creation_date": 1565111626, "post_id": 57380169, "comment_id": 101246428, "body": "Thanks Martin, this is helpful.  I&#39;ll play around with it to verify it can give me the details I need."}, {"owner": {"reputation": 21, "user_id": 7048417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f86b6213447f111612a133807654d3e4?s=128&d=identicon&r=PG", "display_name": "JMartin", "link": "https://stackoverflow.com/users/7048417/jmartin"}, "reply_to_user": {"reputation": 14659, "user_id": 2705055, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b1d5dfaf239229501a184c8858fbc954?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Rosenau", "link": "https://stackoverflow.com/users/2705055/martin-rosenau"}, "edited": false, "score": 0, "creation_date": 1565117010, "post_id": 57380169, "comment_id": 101248709, "body": "@MartinRosenau - tried what you suggested, but it only returns \\Device\\jyezu-0 when I call QueryDosDevice(&quot;jyezu-0&quot;,...).  I need to somehow link to the path used / returned by the SetupAPI  (USB\\VID_0C9B&amp;PID_0011\\CAMERA_SN:___312)"}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1565125252, "post_id": 57380169, "comment_id": 101252002, "body": "<code>CM_Get_Device_ID_ListW(L&quot;USB\\\\VID_0C9B&amp;PID_0011&quot;, .., CM_GETIDLIST_FILTER_PRESENT|CM_GETIDLIST_FILTER_ENUMERATOR )</code> -&gt; <code>CM_Locate_DevNodeW</code> -&gt; <code>CM_Get_DevNode_PropertyW(.. &amp;DEVPKEY_Device_PDOName, )</code> -&gt; <code>NtOpenFile</code>"}], "owner": {"reputation": 21, "user_id": 7048417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f86b6213447f111612a133807654d3e4?s=128&d=identicon&r=PG", "display_name": "JMartin", "link": "https://stackoverflow.com/users/7048417/jmartin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 738, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565108985, "creation_date": 1565108045, "last_edit_date": 1565108985, "question_id": 57380169, "link": "https://stackoverflow.com/questions/57380169/how-to-resolve-xxx-path-to-usb-device-with-the-actual-device-path", "title": "How to resolve \\\\.\\xxx path to usb device with the actual device path", "body": "<p>I have a usb device that I use CreateFile to open. </p>\n\n<pre><code>hDev = CreateFile(\"\\\\\\\\.\\\\jyezu-0\",...);   // 0..32 for the dev number\nhDev2 = CreateFile(\"\\\\\\\\.\\\\jyezu-1\",....); // etc...\n</code></pre>\n\n<p>This is in legacy code and has worked properly for some time.  </p>\n\n<p>Now I am working with the SetupAPI and would like to link the device info enumerated by the SetupAPI with the above paths</p>\n\n<p>i.e. - \\.\\jyezu-0 --> USB\\VID_04B4&amp;PID_8613\\6&amp;11D0BADA&amp;0&amp;2\n       \\.\\jyezu-1 --> USB\\VID_04B4&amp;PID_8613\\6&amp;11D0BADA&amp;0&amp;3</p>\n\n<p>The hardware is generic (no serial numbers yet, as application is for production and assigns the serial numbers later.  </p>\n\n<p>I need to track the PHYSICAL device through firmware and product ID changes and the only way I can figure how to do this is through the LocationInformation field ( Port#_XXXX.Hub#_XXXX) </p>\n\n<p>I can't find much information on how the \"\\.\\jyezu-0\" path works for this device.  I want to avoid changing the startup code to use SetupAPI paths and only want to \"link\" on path to the other so I know, that after reprogram, restart, I'm still talking to the same physical device (by checking the Port/Hub info) </p>\n\n<p>Any info on the origin / configuration of the \\.\\ paths to the USB\\ paths would be appreciated.</p>\n"}, {"tags": ["c", "pointers", "struct"], "comments": [{"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 0, "creation_date": 1565107515, "post_id": 57380002, "comment_id": 101244610, "body": "Pass in a pointer to <code>head</code>, and change the rest of the code accordingly."}, {"owner": {"reputation": 22422, "user_id": 634919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f4a87fe094961af20263d8e7ff445b2?s=128&d=identicon&r=PG", "display_name": "Nate Eldredge", "link": "https://stackoverflow.com/users/634919/nate-eldredge"}, "edited": false, "score": 1, "creation_date": 1565107638, "post_id": 57380002, "comment_id": 101244672, "body": "&quot;It seems as if the Node *head is passed by value and not by reference.&quot;  Indeed.  <b>Everything</b> in C is passed by value"}, {"owner": {"reputation": 190, "user_id": 8671598, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cda90e7fcdcbd1c199365032da8c84e8?s=128&d=identicon&r=PG&f=1", "display_name": "Genjik", "link": "https://stackoverflow.com/users/8671598/genjik"}, "edited": false, "score": 0, "creation_date": 1565107660, "post_id": 57380002, "comment_id": 101244683, "body": "Thomas Jager, do you mean: head-&gt;data = temp-&gt;data head-&gt;next = temp-&gt;next ?"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 1, "creation_date": 1565107709, "post_id": 57380002, "comment_id": 101244694, "body": "<code>head = (Node*) malloc(sizeof(Node)); head = NULL;</code> Wow. Just allocate the memory and immediately throw it away. Talk about memory leaks."}, {"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 1, "creation_date": 1565107722, "post_id": 57380002, "comment_id": 101244698, "body": "You could bypass the confusion and pointer-to-pointer stuff by creating a struct for the linked list and passing around a pointer to that: <code>struct LinkedList {Node *head;};</code>"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 1, "creation_date": 1565107822, "post_id": 57380002, "comment_id": 101244738, "body": "You can also bypass the pointer-to-pointer stuff by returning the new <code>head</code> from the function. So the function declaration should be <code>Node *Insert(Node *head, int x)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 4756, "user_id": 10001688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvhzK.jpg?s=128&g=1", "display_name": "Michael Bianconi", "link": "https://stackoverflow.com/users/10001688/michael-bianconi"}, "is_accepted": false, "score": 3, "last_activity_date": 1565107612, "creation_date": 1565107612, "answer_id": 57380063, "question_id": 57380002, "link": "https://stackoverflow.com/questions/57380002/how-to-change-null-pointer-of-struct-return-type-to-declared-struct/57380063#57380063", "title": "How to change null pointer (of struct return type) to declared struct?", "body": "<p>Pass a pointer to a pointer to head. That way, you can set head to null.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>void Insert(Node **head, int x) {\n\n    ...\n\n    if (*head == NULL) {\n        *head = temp;\n    }\n\n    else {\n        ...\n        *head-&gt;next = temp;\n    }\n}\n</code></pre>\n\n<p>Usage:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>Node *head = NULL;\nInsert(&amp;head, 10);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 190, "user_id": 8671598, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cda90e7fcdcbd1c199365032da8c84e8?s=128&d=identicon&r=PG&f=1", "display_name": "Genjik", "link": "https://stackoverflow.com/users/8671598/genjik"}, "edited": false, "score": 0, "creation_date": 1565108225, "post_id": 57380070, "comment_id": 101244922, "body": "Thanks, it works. I have one more question. Some one in the comment above has told me that by declaring dynamic memory and throwing it away, I am creating memory leak. Question is: Should I create head node in heap or stack?"}, {"owner": {"reputation": 21832, "user_id": 882051, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f76d986b54e90fa6c431160e9a0796cd?s=128&d=identicon&r=PG", "display_name": "hmakholm left over Monica", "link": "https://stackoverflow.com/users/882051/hmakholm-left-over-monica"}, "reply_to_user": {"reputation": 190, "user_id": 8671598, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cda90e7fcdcbd1c199365032da8c84e8?s=128&d=identicon&r=PG&f=1", "display_name": "Genjik", "link": "https://stackoverflow.com/users/8671598/genjik"}, "edited": false, "score": 0, "creation_date": 1565108326, "post_id": 57380070, "comment_id": 101244971, "body": "@Genjik: JL2210&#39;s comment is right -- if you want to start with an empty list, that list consists only of the NULL pointer and <i>no</i> instances of <code>struct Node</code>. So it makes no sense for you to start by allocating a <code>struct Node</code> just to forget about it again afterwards. The allocation within your <code>Insert</code> method is what you want."}], "tags": [], "owner": {"reputation": 21832, "user_id": 882051, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f76d986b54e90fa6c431160e9a0796cd?s=128&d=identicon&r=PG", "display_name": "hmakholm left over Monica", "link": "https://stackoverflow.com/users/882051/hmakholm-left-over-monica"}, "is_accepted": true, "score": 4, "last_activity_date": 1565107946, "last_edit_date": 1565107946, "creation_date": 1565107634, "answer_id": 57380070, "question_id": 57380002, "link": "https://stackoverflow.com/questions/57380002/how-to-change-null-pointer-of-struct-return-type-to-declared-struct/57380070#57380070", "title": "How to change null pointer (of struct return type) to declared struct?", "body": "<blockquote>\n  <p>It seems as if the Node *head is passed by value and not by reference.</p>\n</blockquote>\n\n<p>That is exactly right -- in C every parameter is always passed by value. The <em>pointer</em> is a value, and that value is passed by value, and the call</p>\n\n<pre><code>Insert(head, 25);\n</code></pre>\n\n<p>can never change the <em>value</em> of the variable named <code>head</code>. It <em>reads the value</em> of the variable (this value is a null pointer), gives that value to the function and never touches the <em>variable</em> <code>head</code> again no matter what the function does.</p>\n\n<p>(Note that in your program you have two variables that are both named <code>head</code> -- one in <code>main()</code> and the other in <code>Insert()</code>. The variable in <code>Insert()</code> silently disappears when the function returns; nothing will automatically try to copy its value to the similarly-named variable in <code>main()</code>).</p>\n\n<p>If you want to (conceptually) pass <code>head</code> <em>by reference</em>, you need to actually pass a pointer to it -- that is, in this case, a pointer to a pointer! You'd need to declare your function as </p>\n\n<pre><code>void Insert(Node **head, int x) { ... }\n</code></pre>\n\n<p>and call it as</p>\n\n<pre><code>Insert(&amp;head, 25);\n</code></pre>\n\n<p>Then the actual parameter is a pointer to the variable <code>head</code> which gives the function a chance to update that variable, if you deference the parameter where appropriate:</p>\n\n<pre><code>// ...\ntemp-&gt;next = *head;\n// ...\n*head = temp;\n// ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1255, "user_id": 1861447, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d61fb7b17b58891bf414b9d53e7bbb0d?s=128&d=identicon&r=PG", "display_name": "Austin", "link": "https://stackoverflow.com/users/1861447/austin"}, "is_accepted": false, "score": 1, "last_activity_date": 1565109101, "last_edit_date": 1565109101, "creation_date": 1565108096, "answer_id": 57380182, "question_id": 57380002, "link": "https://stackoverflow.com/questions/57380002/how-to-change-null-pointer-of-struct-return-type-to-declared-struct/57380182#57380182", "title": "How to change null pointer (of struct return type) to declared struct?", "body": "<p>There are number of issues here.<br>\n1. Your printf statements need to be corrected.<br>\n2. To insert function you can pass double pointer.<br>\n3. Inside main function, you need not to do <code>Node *head = (Node*) malloc(sizeof(Node));</code>  </p>\n\n<p>I have modified your code as shown below. You can try running it and co-relate above points.</p>\n\n<pre><code>typedef struct Node {\n    int data;\n    struct Node *next;\n} Node;\n\nvoid Insert(Node **head, int x);\n\nvoid Insert(Node **head, int x) {\n    Node *temp = (Node*) malloc(sizeof(Node));\n    temp-&gt;data = x;\n    temp-&gt;next = *head;\n\n    printf(\"temp-&gt;next address: %d\\n\", temp-&gt;data); // also 100\n\n    *head = temp;\n\n    printf(\"%d\\n\", (*head)-&gt;data); // not 100, something else i.e  200\n}\n\nint main() {\n    Node *head = NULL;\n    head = NULL;\n\n    Insert(&amp;head, 25);\n    printf(\"head in main(): %d\\n\", head-&gt;data); // For example: 100\n    return 0;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1565118422, "post_id": 57380923, "comment_id": 101249303, "body": "&quot;Neither better nor worse&quot; in what sense? It is not exactly the same"}], "tags": [], "owner": {"reputation": 8154, "user_id": 2470782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921783e0584f9ace7e05d303e4d48869?s=128&d=identicon&r=PG", "display_name": "Ingo Leonhardt", "link": "https://stackoverflow.com/users/2470782/ingo-leonhardt"}, "is_accepted": false, "score": 2, "last_activity_date": 1565111082, "creation_date": 1565111082, "answer_id": 57380923, "question_id": 57380002, "link": "https://stackoverflow.com/questions/57380002/how-to-change-null-pointer-of-struct-return-type-to-declared-struct/57380923#57380923", "title": "How to change null pointer (of struct return type) to declared struct?", "body": "<p>Having three answers suggesting the same I would like to offer an alternative: \nInstead of passing a <code>Node **</code> to <code>Insert()</code> you could instead have it return the new <code>head</code>, thus:</p>\n\n<pre><code>Node *Insert( Node *head, int x )\n{\n     ... your code ...\n     return head;\n}\n</code></pre>\n\n<p>and if you call it by</p>\n\n<pre><code>head = Insert( head, 24 );\n</code></pre>\n\n<p>That is neither better nor worse then the other solution so you my do whatever you prefer</p>\n"}], "owner": {"reputation": 190, "user_id": 8671598, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cda90e7fcdcbd1c199365032da8c84e8?s=128&d=identicon&r=PG&f=1", "display_name": "Genjik", "link": "https://stackoverflow.com/users/8671598/genjik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 57380070, "answer_count": 4, "score": -1, "last_activity_date": 1565111082, "creation_date": 1565107359, "question_id": 57380002, "link": "https://stackoverflow.com/questions/57380002/how-to-change-null-pointer-of-struct-return-type-to-declared-struct", "title": "How to change null pointer (of struct return type) to declared struct?", "body": "<p>I am new to C programming. I am trying to implement Linked list by myself. I am encountering problem with pointers</p>\n\n<p>I have function</p>\n\n<pre><code>void Insert(Node* head, int x)\n</code></pre>\n\n<p>to insert node at the beginning of Linked list. The problem is that when I insert the very first node and Node *head is NULL, the function Insert is not able to change the pointer address of null pointer to the newly created node. It seems as if the Node *head is passed by value and not by reference. \n  Code is provided below. In order to debug how address is changed throughout the execution, I used printf function.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n\ntypedef struct Node {\n    int data;\n    struct Node *next;\n} Node;\n\nint main() {\n    Node *head = (Node*) malloc(sizeof(Node));\n    head = NULL;\n\n    printf(\"head in main(): %d\\n\", head); // For example: 100\n\n    Insert(head, 25);\n    return 0;\n}\n\nvoid Insert(Node *head, int x) {\n    Node *temp = (Node*) malloc(sizeof(Node));\n    temp-&gt;data = x;\n    temp-&gt;next = head;\n\n    printf(\"temp-&gt;next address: %d\\n\", temp-&gt;next); // also 100\n\n    head = temp;\n\n    printf(\"%d\\n\", head); // not 100, something else i.e  200\n}\n</code></pre>\n"}, {"tags": ["c", "http", "http-post"], "comments": [{"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1565110197, "post_id": 57379136, "comment_id": 101245816, "body": "The posted code seems to be a (almost) copy of <a href=\"http://souptonuts.sourceforge.net/code/http_post.c.html\" rel=\"nofollow noreferrer\">original code</a>   It is not nice to copy someone elses code and claim it as your own"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1565111175, "post_id": 57379136, "comment_id": 101246244, "body": "regarding: <code>&quot;POST %s HTTP&#47;1.0\\r\\n&quot;</code>   This is the wrong syntax   It should be: <code>&quot;POST %s HTTP1.0\\r\\n&quot;  Notice, no </code>/` after the <code>HTTP</code>"}], "owner": {"reputation": 1, "user_id": 9448666, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-6FmQOTuHhbY/AAAAAAAAAAI/AAAAAAAAFaA/jiUEPbNEyn4/photo.jpg?sz=128", "display_name": "zyron dias", "link": "https://stackoverflow.com/users/9448666/zyron-dias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565109394, "creation_date": 1565104438, "question_id": 57379136, "link": "https://stackoverflow.com/questions/57379136/http-post-with-parameters-and-return-status-code", "title": "HTTP POST with Parameters and return status code", "body": "<p>I am trying to send an HTTP post request to a web API that consumes: application/JSON and has certain parameters: in=body, required = true, type = string and name = name. But I can't figure out how to send the data and make the request with parameters.</p>\n\n<pre><code>#define SA struct sockaddr\n#define MAXLINE 4096\n#define MAXSUB  200\n\n\n#define LISTENQ 1024\n\nextern int h_errno;\n\nssize_t process_http(int sockfd, char *host, char *page, char *poststr){\nchar sendline[MAXLINE + 1], recvline[MAXLINE + 1];\nssize_t n;\nsnprintf(sendline, MAXSUB,\n     \"POST %s HTTP/1.0\\r\\n\"\n     \"Host: %s\\r\\n\"\n     \"Content-type: application/json\\r\\n\"\n     \"Content-length: %d\\r\\n\\r\\n\"\n     \"%s\", page, host, strlen(poststr), poststr);\nwrite(sockfd, sendline, strlen(sendline));\nwhile ((n = read(sockfd, recvline, MAXLINE)) &gt; 0) {\n    recvline[n] = '\\0';\n    printf(\"%s\", recvline);\n}\nreturn n;\n}\n\nint main(void){\nint sockfd;\nstruct sockaddr_in servaddr;\n\nchar **pptr;\n//********** You can change. Puy any values here *******\nchar *hname = \"some_api_.net\";\nchar *page = \"/path\";\nchar *poststr = \"in=body&amp;required=true&amp;type=string&amp;name=name\\r\\n\";\n//*******************************************************\n\nchar str[50];\nstruct hostent *hptr;\nif ((hptr = gethostbyname(hname)) == NULL) {\n    fprintf(stderr, \" gethostbyname error for host: %s: %s\",\n        hname, hstrerror(h_errno));\n    exit(1);\n}\nprintf(\"hostname: %s\\n\", hptr-&gt;h_name);\nif (hptr-&gt;h_addrtype == AF_INET\n    &amp;&amp; (pptr = hptr-&gt;h_addr_list) != NULL) {\n    printf(\"address: %s\\n\",\n           inet_ntop(hptr-&gt;h_addrtype, *pptr, str,\n             sizeof(str)));\n} else {\n    fprintf(stderr, \"Error call inet_ntop \\n\");\n}\n\nsockfd = socket(AF_INET, SOCK_STREAM, 0);\nbzero(&amp;servaddr, sizeof(servaddr));\nservaddr.sin_family = AF_INET;\nservaddr.sin_port = htons(80);\ninet_pton(AF_INET, str, &amp;servaddr.sin_addr);\n\nconnect(sockfd, (SA *) &amp; servaddr, sizeof(servaddr));\nprocess_http(sockfd, hname, page, poststr);\nclose(sockfd);\nexit(0);\n}\n</code></pre>\n\n<p>I expect to receive a status code and process it.</p>\n"}, {"tags": ["c", "algorithm", "recursion"], "comments": [{"owner": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 2, "creation_date": 1565099274, "post_id": 57377539, "comment_id": 101239592, "body": "Have you tried stepping through it on paper to see if you can find a pattern?"}, {"owner": {"reputation": 194, "user_id": 10322433, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ouTTb.png?s=128&g=1", "display_name": "blueheart", "link": "https://stackoverflow.com/users/10322433/blueheart"}, "edited": false, "score": 1, "creation_date": 1565099442, "post_id": 57377539, "comment_id": 101239722, "body": "<a href=\"https://en.wikipedia.org/wiki/Euclidean_algorithm\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Euclidean_algorithm</a>. This will help you understand."}, {"owner": {"reputation": 81, "user_id": 9889218, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O75bH.jpg?s=128&g=1", "display_name": "Ravi Raj", "link": "https://stackoverflow.com/users/9889218/ravi-raj"}, "reply_to_user": {"reputation": 4187, "user_id": 5567382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d204353cb4fa94da57ddf180e108cd1b?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Jager", "link": "https://stackoverflow.com/users/5567382/thomas-jager"}, "edited": false, "score": 0, "creation_date": 1565099579, "post_id": 57377539, "comment_id": 101239807, "body": "@Thomas Jager I have done it, but can&#39;t find any useful pattern."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1565101669, "post_id": 57377539, "comment_id": 101241198, "body": "I think an upper bound for the number of recursive calls (including the original call) when <code>n&gt;=m</code> is given by <code>1 + log(m) &#47; log(phi)</code>, where <code>phi</code> is the golden ratio <code>phi = (sqrt(5) + 1) &#47; 2</code>. The lower bound (including the original call) is 1. When <code>n&lt;m</code>, add  1 to the upper and lower bounds."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1565102001, "post_id": 57377539, "comment_id": 101241428, "body": "For an example of the worst case, try successive numbers from the Fibonnacci sequence for <code>m</code> and <code>n</code>."}, {"owner": {"reputation": 81, "user_id": 9889218, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O75bH.jpg?s=128&g=1", "display_name": "Ravi Raj", "link": "https://stackoverflow.com/users/9889218/ravi-raj"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1565105990, "post_id": 57377539, "comment_id": 101243749, "body": "@IanAbbott How you have derived the formula <code>1 + log(m) &#47; log(phi)</code>?"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 3, "creation_date": 1565107181, "post_id": 57377539, "comment_id": 101244436, "body": "It&#39;s easy enough to work out that consecutive Fibonacci sequence numbers are the worst case by working backwards from gcd(2,1). It is also known that the ratio between successive numbers in the Fibonacci sequence approaches phi the further along the sequence you go, so the sequence is approximately exponential with a base of phi. The <code>log(m) &#47; log(phi)</code> calculates log to the base phi of <code>m</code>. The 1 is added for the initial call to <code>gcd</code>."}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1565167936, "post_id": 57377539, "comment_id": 101263325, "body": "This question might be a better fit for <a href=\"https://cs.stackexchange.com\">Computer Science</a>."}], "answers": [{"tags": [], "owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "is_accepted": false, "score": 4, "last_activity_date": 1565166172, "last_edit_date": 1565166172, "creation_date": 1565110373, "answer_id": 57380728, "question_id": 57377539, "link": "https://stackoverflow.com/questions/57377539/number-of-recursive-calls-in-gcd-function/57380728#57380728", "title": "Number of recursive calls in gcd() function", "body": "<p><a href=\"https://en.wikipedia.org/wiki/Euclidean_algorithm\" rel=\"nofollow noreferrer\">Euclidean algorithm</a> gives #steps =</p>\n\n<blockquote>\n  <p>T(a, b) = 1 + T(b, r<sub>0</sub>) = 2 + T(r<sub>0</sub>, r<sub>1</sub>) = \u2026 = N + T(r<sub>N - 2</sub>, r<sub>N - 1</sub>) = N + 1</p>\n</blockquote>\n\n<p>where <code>a</code> and <code>b</code> are the inputs, and <code>r_i</code> the remainder. We used that <code>T(x, 0) = 0</code></p>\n\n<p>Running an example in paper would help you get a better grasp of the aforementioned equation:</p>\n\n<blockquote>\n  <p>gcd(1071, 462) is calculated from the equivalent gcd(462, 1071 mod 462) = gcd(462, 147). The latter GCD is calculated from the gcd(147, 462 mod 147) = gcd(147, 21), which in turn is calculated from the gcd(21, 147 mod 21) = gcd(21, 0) = 21</p>\n</blockquote>\n\n<p>So <code>a = 1071</code> and <code>b = 462</code>, and we have:</p>\n\n<pre><code>T(a, b) = \n1 + T(b, a % b)       = 1 + T(b, r_0)   =    (1)\n2 + T(r_0, b % r_0)   = 2 + T(r_0, r_1) =\n3 + T(r_1, r_0 % r_1) = 3 + T(r_1, r_2) =    (2)\n3 + T(r_1, 0)                           =\n3 + 0                                   =\n3\n</code></pre>\n\n<p>which says that we needed to take 3 steps to compute gcd(1071, 462).</p>\n\n<pre><code>(1): notice that the 1 is the step already done before, i.e. T(a, b)\n(2): r_2 is equal to 0 in this example\n</code></pre>\n\n<p>You could run a plethora of examples in paper, and see how this unfolds, and eventually you will be able to see the pattern, if you don't see it already.</p>\n\n<hr>\n\n<p>Note: While @Ian'Abott's comments are also correct, I decided to present this approach, since it's more generic, and can be applied to any similar recursive method.</p>\n"}], "owner": {"reputation": 81, "user_id": 9889218, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O75bH.jpg?s=128&g=1", "display_name": "Ravi Raj", "link": "https://stackoverflow.com/users/9889218/ravi-raj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 479, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565166172, "creation_date": 1565099171, "last_edit_date": 1565110408, "question_id": 57377539, "link": "https://stackoverflow.com/questions/57377539/number-of-recursive-calls-in-gcd-function", "title": "Number of recursive calls in gcd() function", "body": "<p>Recently I have been given a <code>gcd()</code> function, written in C programming language which takes two arguments <code>n</code> and <code>m</code> and compute the GCD of these two numbers using recursion.I have been asked that \"How many recursive calls are made by the function if <code>n&gt;=m</code>?\" Can any one provide the solution with explanation to my problem as I am unable to figure it out.\nHere is the source code of the function :</p>\n\n<pre><code>int gcd(int n, int m)\n{\n  if (n%m==0)\n    return m;\n  else\n    n=n%m;\n  return gcd(m, n);\n}\n</code></pre>\n"}, {"tags": ["c", "gcc", "optimization", "x86-64", "calling-convention"], "comments": [{"owner": {"reputation": 2244, "user_id": 5520680, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C1jQH.png?s=128&g=1", "display_name": "Tom&#39;s", "link": "https://stackoverflow.com/users/5520680/toms"}, "edited": false, "score": 0, "creation_date": 1565099063, "post_id": 57377314, "comment_id": 101239452, "body": "I don&#39;t understand what an &quot;hidden pointer&quot; is. Is it a synonyme for &quot;opaque pointer&quot; ? I don&#39;t see a problem with this code, granted that &quot;out&quot; must be allocated before &quot;use&quot; is called."}, {"owner": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "reply_to_user": {"reputation": 2244, "user_id": 5520680, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C1jQH.png?s=128&g=1", "display_name": "Tom&#39;s", "link": "https://stackoverflow.com/users/5520680/toms"}, "edited": false, "score": 0, "creation_date": 1565099231, "post_id": 57377314, "comment_id": 101239569, "body": "@Tom&#39;s please see <a href=\"https://en.wikipedia.org/wiki/X86_calling_conventions#System_V_AMD64_ABI\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/&hellip;</a>. I&#39;m asking why the resulting assembler isn&#39;t as optimal as I would like."}, {"owner": {"reputation": 2244, "user_id": 5520680, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C1jQH.png?s=128&g=1", "display_name": "Tom&#39;s", "link": "https://stackoverflow.com/users/5520680/toms"}, "edited": false, "score": 0, "creation_date": 1565099673, "post_id": 57377314, "comment_id": 101239879, "body": "Thanks ! I didn&#39;t understand your question before. That &quot;hidden&quot; parameter is handful, indeed, I always believed that the &quot;this&quot; argument in C++ was added by the c++ compilator (like the mangling is done), but it seems that they &quot;simply&quot; use the &quot;hidden&quot; parameter ...  Sorry, I don&#39;t have a clue for your question :/"}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1565178767, "post_id": 57377314, "comment_id": 101269307, "body": "what sense write such code <code>Vec3 do_something();</code> and force compiler use hidden pointer ? need <b>explicit</b> write <code>void do_something(Vec3* )</code> - because this is only way (impossible return <code>Vec3</code>). so if you want optimized binary code - you must at begin yourself write optimized source code"}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "reply_to_user": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 2, "creation_date": 1565219988, "post_id": 57377314, "comment_id": 101288149, "body": "@RbMm the whole idea of compiled language is to allow compilers to optimize"}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565221730, "post_id": 57377314, "comment_id": 101288502, "body": "@M.M - but for what try return value which is impossible return ? simply need understand that <code>Vec3</code> impossible return (by value) and write <code>void do_something(Vec3* )</code> (anyway this is will be real signature of function)"}], "answers": [{"comments": [{"owner": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 1, "creation_date": 1565100914, "post_id": 57377890, "comment_id": 101240677, "body": "I don&#39;t understand, what in the ABI prevents <code>out</code> to be passed as hidden pointer - <code>do_something</code> doesn&#39;t care where <code>%rdi</code> points to - whether it is in the stack of the caller or somewhere else."}, {"owner": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1565101234, "post_id": 57377890, "comment_id": 101240909, "body": "But I think my misundertanding is what <code>restrict</code> does - it only means &quot;no aliasing&quot; in the <code>use</code> and not in the whole code. Thanks."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1565106669, "post_id": 57377890, "comment_id": 101244140, "body": "@ead, I have rewritten this answer with rather greater attention to some of the details of the ABI specification and of the C standard, coming to a somewhat softer conclusion."}, {"owner": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1565202499, "post_id": 57377890, "comment_id": 101282210, "body": "I disagree with &quot;The difference in timing with respect to when *out is modified is irrelevant in the sense that use()&#39;s caller cannot tell the difference...&quot; I have tried to make it clear with an example in my question."}, {"owner": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1565202706, "post_id": 57377890, "comment_id": 101282297, "body": "I&#39;m also not entirely convinced that &quot;the caller provides space for the return value&quot;, means what you say - I cannot see, how callee can make any assumptions other that there will be memory pointed to by the hidden pointer."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1565204154, "post_id": 57377890, "comment_id": 101283012, "body": "@ead, since you seemed originally to address timing effects and aliasing effects as separate considerations, I responded to them as such.  The example now in your question suggests that you really mean these as one and the same thing, and that in fact highlights the key assumption that the ABI permits the callee to make: that the return-value storage does not overlap any data visible to it through any other identifier.  The ABI requires the <i>caller</i> to ensure this, which it can do only by relying on its own caller (in the TCO case) or by providing storage that it itself owns."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565219918, "post_id": 57377890, "comment_id": 101288135, "body": "IMO it would be a legal optimization in the <code>restrict</code> case to just write to <code>out</code> but I expect just that no compiler developer has investigated doing it yet"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565220614, "post_id": 57377890, "comment_id": 101288272, "body": "<i>A translator is free to ignore any or all aliasing implications of uses of restrict.</i>  I think your reasoning is backwards here.  It&#39;s UB to pass aliasing pointers with <code>restrict</code> whether any specific compiler optimizes based on that or not.  Plus, I think the real issue is (as I said in my answer) that the hidden pointer to the output object is implicitly <code>restrict</code>, and that applies to <code>do_something</code> not <code>use</code>.  @M.M I don&#39;t think you&#39;re correct, unless I&#39;m misunderstanding the scope of <code>restrict</code>."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1565265346, "post_id": 57377890, "comment_id": 101304003, "body": "@PeterCordes, it is not passing aliased pointers to <code>restrict</code>-qualified parameters that produces UB, but rather accessing restrict-pointed-to data via an alias that does. If such UB occurs, it occurs at execution time, not translation time, because it is data dependent.  Since the OP is asking about why a particular implementation performs translation as it does with and without <code>restrict</code>, the Standard&#39;s explicit remark disclaiming any requirement for <code>restrict</code>-qualification to yield different translation seems entirely on point to me."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1565265593, "post_id": 57377890, "comment_id": 101304146, "body": "Oh yes, I see what you&#39;re saying now.  Just that even if this optimization is allowed with <code>restrict</code>, compilers might not look for it."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1565265727, "post_id": 57377890, "comment_id": 101304233, "body": "However, @PeterCordes, I agree that it is a reasonable characterization of the ABI specifications to say that the hidden pointer is effectively <code>restrict</code>-qualified, and that that applies to <code>do_something()</code>, not <code>use()</code>.  I have approached that point from the direction of its implications for code generation, largely because I did not previously recognize that connection, but, retrospectively, because the semantics of <code>restrict</code> are a bit arcane for many people."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 2, "last_activity_date": 1565211427, "last_edit_date": 1565211427, "creation_date": 1565100209, "answer_id": 57377890, "question_id": 57377314, "link": "https://stackoverflow.com/questions/57377314/what-prevents-the-usage-of-a-function-argument-as-hidden-pointer/57377890#57377890", "title": "What prevents the usage of a function argument as hidden pointer?", "body": "<p><strong><em>Substantially rewritten:</em></strong></p>\n\n<blockquote>\n  <p>I understand, that an alias of pointer <code>out</code> (e.g. as global variable)\n  could be used in <code>do_something</code> and thus [<code>out</code>] cannot be passed as\n  hidden pointer to <code>do_something</code>: if it would, <code>out</code> would be changed\n  inside of <code>do_something</code> and not when <code>do_something</code> returns, thus\n  some calculations might become faulty.</p>\n</blockquote>\n\n<p>Except with respect to aliasing considerations inside <code>do_something()</code>, the difference in <em>timing</em> with respect to when <code>*out</code> is modified is irrelevant in the sense that <code>use()</code>'s caller cannot tell the difference.  Such issues arise only with respect to accesses from other threads, and if that's a possibility then they arise anyway unless appropriate synchronization is applied.</p>\n\n<p>No, the issue is primarily that the ABI defines how passing arguments to functions and receiving their return values works.  It specifies that</p>\n\n<blockquote>\n  <p>If the type has class MEMORY, then <strong><em>the caller provides space</em></strong> for the return\n  value and passes the address of this storage in\n  <code>%rdi</code></p>\n</blockquote>\n\n<p>(emphasis added).</p>\n\n<p>I grant that there's room for interpretation, but I take that as a stronger statement than just that the caller specifies where to store the return value.  That it \"provides\" space means to me that the space in question belongs to the caller (which your <code>*out</code> does not).  By analogy with argument passing, there's good reason to interpret that more specifically as saying that the caller provides space <em>on the stack</em> (and therefore in its own stack frame) for the return value, which in fact is exactly what you observe, though that detail doesn't really matter.</p>\n\n<p>With that interpretation, the called function is free to assume that the return-value space is disjoint from any space it can access via any pointer other than one of its arguments.  That this is supplemented by a more general requirement that the return space not be aliased (<em>i.e.</em> not through the function arguments either) does not contradict that interpretation.  It may therefore perform operations that would be incorrect if in fact the space were aliased to something else accessible to the function.</p>\n\n<p>The compiler is not at liberty to depart from the ABI specifications if the function call is to work correctly with a separately-compiled <code>do_something()</code> function.  In particular, with separate compilation, the compiler cannot make decisions based on characteristics of the function's caller, such as aliasing information known there.  If <code>do_something()</code> and <code>use()</code> were in the same translation unit, then the compiler might choose to inline <code>so_something()</code> into <code>use()</code>, or it might choose to perform the optimization you're looking for without inlining, but it cannot safely do so in the general case.</p>\n\n<blockquote>\n  <p>It was suggested to me, that using restrict should solve the problem,</p>\n</blockquote>\n\n<p><code>restrict</code> gives the compiler greater leeway to optimize, but that in itself does not give you any reason to expect specific optimizations that might then be possible.  In fact, the language standard explicitly specifies that</p>\n\n<blockquote>\n  <p>A translator is free to ignore any or all aliasing implications of uses of restrict.</p>\n</blockquote>\n\n<p>(C2011, <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.7.3.1p6\" rel=\"nofollow noreferrer\">6.7.3.1/6</a>)</p>\n\n<p><code>restrict</code>-qualifying <code>out</code> expresses that the compiler doesn't need to worry about it being aliased to any other pointer accessed within the scope of a call to <code>use()</code>, including during the execution of functions other functions it calls.  In principle, then, I could see a compiler taking advantage of that to shortcut the ABI by offering somebody else's space for the return value instead of providing space itself, but just because it could do does not mean that it will do.</p>\n\n<blockquote>\n  <p>What prevents the usage of <code>out</code> as hidden pointer?</p>\n</blockquote>\n\n<p>ABI compliance.  The caller is expected to provide space that belongs to it, not to someone else, for storage of the return value.  As a practical matter, however, I don't see anything in the <code>restrict</code>-qualified case that would invalidate shortcutting the ABI, so I take it that that's just not an optimization that has been implemented by the compiler in question.</p>\n\n<blockquote>\n  <p>NB: The desired (or very similar) behavior would be achieved for a slightly different function-signature: [...]</p>\n</blockquote>\n\n<p>That case looks like a tail-call optimization to me.  I don't see anything inherently inconsistent in the compiler performing that optimization, but not the one you're asking about, even though it is, to be sure, a different example of shortcutting the ABI.</p>\n"}, {"comments": [{"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565220657, "post_id": 57403379, "comment_id": 101288283, "body": "If it were <code>void use(struct Vec3 * restrict out)</code>, then the code would have undefined behaviour, therefore this is not a counterexample for the claim that in the presence of <code>restrict</code> the optimization in question would be allowed"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565220883, "post_id": 57403379, "comment_id": 101288321, "body": "@M.M: I don&#39;t think that&#39;s true.  <code>use()</code> doesn&#39;t directly read <code>glob3</code>; that&#39;s in a separate function outside the scope of the <code>*restrict out</code> variable.  Can you explain in more detail why that&#39;s wrong, if you still think so?"}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 1, "creation_date": 1565221435, "post_id": 57403379, "comment_id": 101288442, "body": "Informally, <code>void use(struct Vec3 * restrict out)</code> means that it is UB if, <i>at any points during the execution of <code>use</code></i>, the memory location designated by <code>*out</code> is accessed via <code>out</code> and also accessed in another way not via <code>out</code>,   Which does happen here, since <code>use</code> writes <code>*out</code> directly, and also <code>do_something()</code> (called within <code>use</code>) reads the same memory location via the name <code>glob3</code>..    Formally, see C17 6.7.3.1"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565224528, "post_id": 57403379, "comment_id": 101289060, "body": "@M.M: I think you&#39;re probably right.  The wording in the standard talks about the lifetime of a block, and doesn&#39;t appear to rule out function calls that do execution outside the scope of the current block B but later return back into it.  Anyway, the main point and example of my answer (about the no <code>restrict</code> case) doesn&#39;t depend on this argument at all.  It definitely shows that GCC code-gen assumes that the return-value pointer doesn&#39;t alias anything else."}, {"owner": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565247904, "post_id": 57403379, "comment_id": 101294681, "body": "Differently as JohnBollinger, you argue that the hidden pointer must be restrict, but can otherwise point to any memory location (and not only memory being in the stack-frame of the caller of the caller&#39;s caller). Thus, given the @M.M&#39;s interpertation of restrict is correct, it is a missed optimization (which every compiler out there makes)?"}, {"owner": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1565248127, "post_id": 57403379, "comment_id": 101294787, "body": "I agree, that x86-64 SysV doesn&#39;t give the caller license to introduce aliasing, but does is give the licence to callee to assume that the hidden pointer is restrict? Or is it a calling convention of the gcc-compiler, because only one copying in the caller would be enough (no need to copy in the callee as well)?"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1565248207, "post_id": 57403379, "comment_id": 101294825, "body": "@ead:  Yes, I can&#39;t see any reason why the callee could care about the return-value pointer being into the caller&#39;s stack-frame or not.  The ABI doesn&#39;t give it any mechanism to even check for that.  (Except maybe <code>.eh_frame</code> stack unwinding stuff.)  But yes, without <code>restrict</code> and M.M&#39;s interpretation of it, the caller could only do this if it knew which globals and other objects a function reads so it could ensure it didn&#39;t create aliasing for the callee.  (e.g. if the definition was visible but it still chose not to inline it)."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1565248445, "post_id": 57403379, "comment_id": 101294935, "body": "@ead: I think the wording in the x86-64 SysV ABI is the key to treating the output pointer as if it were restrict, that the caller provides space.  In the C abstract machine, the return-value object exists and is separate from the lvalue you assign the result to (if you assign it at all), as well as separate from any locals in the callee.  So the calling convention has to make it possible to respect that.  I think that fact should inform our interpretation of the calling-convention wording.  Passing a pointer to another C object would be an <i>optimization</i>, not something normal."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1565248624, "post_id": 57403379, "comment_id": 101295027, "body": "@ead: So I think the x86-64 SysV calling convention models the C abstract machine here by having <i>the caller</i> provide a real return-value object, not forcing the <i>callee</i> to invent that temporary if needed to make sure all the writes to the retval happened after any other writes.  That&#39;s not what &quot;the caller provides space&quot; means, IMO."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 0, "creation_date": 1565249058, "post_id": 57403379, "comment_id": 101295228, "body": "@ead: What gcc/clang/ICC do basically <i>is</i> how you need to interpret the x86-64 System V ABI.  There are a few other relevant compilers, like SunCC if it still exists.  The purpose of the document is to enable interoperability between their asm and existing compilers, and to document the rules  those compilers follow on Linux, OS X, and other OSes using that ABI.  So if there&#39;s ambiguity, that&#39;s normally considered a problem with the document, not with GCC."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "edited": false, "score": 1, "creation_date": 1565269268, "post_id": 57403379, "comment_id": 101306442, "body": "@ead, Peter&#39;s argument is couched in quite different terms, but fundamentally, it is <i>not</i> different from mine.  Peter has insightfully recognized the analogy with the semantics of C&#39;s <code>restrict</code>, whereas I go directly from ABI requirements to the implications for code generation, but either way, the point is that the non-aliasing requirements on the hidden pointer effectively require the caller to provide a pointer to space that belongs to it, thus ruling out the optimization you&#39;re looking for (in the original case).  Stack allocation of that data or not is not a central issue."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565680963, "post_id": 57403379, "comment_id": 101418102, "body": "@M.M: It seems you were correct about the interpretation of <code>restrict</code>.  Richard Biener (a gcc dev) thinks so, anyway, as long as GCC can prove the target function is <code>noexcept</code> and doesn&#39;t <code>longjmp</code>.  So that means it&#39;s only possible as an inter-procedural optimization when we can see the other function&#39;s body; there&#39;s a <code>noexecpt</code> declaration but there isn&#39;t (AFAIK) a <code>nolongjmp</code>.  Updated my answer with a link."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565693319, "post_id": 57403379, "comment_id": 101424088, "body": "@PeterCordes Good point about <code>longjmp</code> (and perhaps various non-standard constructs we can&#39;t think of right now?)"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1565693441, "post_id": 57403379, "comment_id": 101424159, "body": "@M.M: yup, that was well spotted <a href=\"https://gcc.gnu.org/bugzilla/show_bug.cgi?id=91398#c1\" rel=\"nofollow noreferrer\">by joseph@codesourcery.com</a> in the GCC bug report that \\@ead opened for this."}], "tags": [], "owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": true, "score": 5, "last_activity_date": 1565680811, "last_edit_date": 1565680811, "creation_date": 1565220393, "answer_id": 57403379, "question_id": 57377314, "link": "https://stackoverflow.com/questions/57377314/what-prevents-the-usage-of-a-function-argument-as-hidden-pointer/57403379#57403379", "title": "What prevents the usage of a function argument as hidden pointer?", "body": "<p>A function is allowed to assume its return-value object (pointed-to by a hidden pointer) is not the same object as <em>anything</em> else.  i.e. that its output pointer (passed as a hidden first arg) doesn't alias anything.</p>\n\n<p>You could think of this as the hidden first arg output pointer having an implicit <code>restrict</code> on it.  (<strong>Because in the C abstract machine, the return value is a separate object</strong>, and the x86-64 System V specifies that the caller provides space.  x86-64 SysV doesn't give the caller license to introduce aliasing.)</p>\n\n<p>Using an otherwise-private local as the destination (instead of separate dedicated space and then copying to a real local) is fine, but pointers that may point to something reachable another way must not be used.  This requires escape analysis to make sure that a pointer to such a local hasn't been passed outside of the function.</p>\n\n<p>I think the x86-64 SysV calling convention models the C abstract machine here by having <em>the caller</em> provide a real return-value object, not forcing the <em>callee</em> to invent that temporary if needed to make sure all the writes to the retval happened after any other writes.  That's not what \"the caller provides space for the return value\" means, IMO.</p>\n\n<p>That's definitely how GCC and other compilers interpret it in practice, which is a big part of what matters in a calling convention that's been around this long (since a year or two before the first AMD64 silicon, so very early 2000s).</p>\n\n<hr>\n\n<p>Here's a case where your optimization would break if it were done:</p>\n\n<pre><code>struct Vec3{\n    double x, y, z;\n};\nstruct Vec3 glob3;\n\n__attribute__((noinline))\nstruct Vec3 do_something(void) {  // copy glob3 to retval in some order\n    return (struct Vec3){glob3.y, glob3.z, glob3.x};\n}\n\n__attribute__((noinline))\nvoid use(struct Vec3 * out){   // copy do_something() result to *out\n    *out = do_something();\n}\n\n\nvoid caller(void) {\n    use(&amp;glob3);\n}\n</code></pre>\n\n<p>With the optimization you're suggesting, <code>do_something</code>'s output object would be <code>glob3</code>.  But it also reads <code>glob3</code>.</p>\n\n<p>A valid implementation for <code>do_something</code> would be to copy elements from <code>glob3</code> to <code>(%rdi)</code> in source order, which would do <code>glob3.x = glob3.y</code> before reading <code>glob3.x</code> as the 3rd element of the return value.</p>\n\n<p>That is in fact <em>exactly</em> what <code>gcc -O1</code> does (<strong><a href=\"https://godbolt.org/#g:!((g:!((g:!((g:!((h:codeEditor,i:(j:1,lang:c%2B%2B,source:&#39;struct+Vec3%7B%0A++++double+x,+y,+z%3B%0A%7D%3B%0Astruct+Vec3+glob3%3B%0A%0A__attribute__((noinline))%0Astruct+Vec3+do_something(void)+%7B++//+copy+glob3+to+retval+in+some+order%0A++++return+(struct+Vec3)%7Bglob3.y,+glob3.z,+glob3.x%7D%3B%0A%7D%0A%0A__attribute__((noinline))%0Avoid+use(struct+Vec3+*+out)%7B+++//+copy+do_something()+result+to+*out%0A++++*out+%3D+do_something()%3B%0A%7D%0A%0A%0Avoid+caller(void)+%7B%0A++++use(%26glob3)%3B%0A%7D%0A&#39;),l:&#39;5&#39;,n:&#39;0&#39;,o:&#39;C%2B%2B+source+%231&#39;,t:&#39;0&#39;)),k:35.760433462781705,l:&#39;4&#39;,m:50,n:&#39;0&#39;,o:&#39;&#39;,s:0,t:&#39;0&#39;),(g:!((h:compiler,i:(compiler:icc191,filters:(b:&#39;0&#39;,binary:&#39;1&#39;,commentOnly:&#39;0&#39;,demangle:&#39;0&#39;,directives:&#39;0&#39;,execute:&#39;1&#39;,intel:&#39;1&#39;,libraryCode:&#39;1&#39;,trim:&#39;1&#39;),lang:c%2B%2B,libs:!(),options:&#39;-xc+-O3+-fverbose-asm+&#39;,source:1),l:&#39;5&#39;,n:&#39;0&#39;,o:&#39;x86-64+icc+19.0.1+(Editor+%231,+Compiler+%231)+C%2B%2B&#39;,t:&#39;0&#39;)),header:(),l:&#39;4&#39;,m:50,n:&#39;0&#39;,o:&#39;&#39;,s:0,t:&#39;0&#39;)),k:35.15365843041961,l:&#39;3&#39;,n:&#39;0&#39;,o:&#39;&#39;,t:&#39;0&#39;),(g:!((h:compiler,i:(compiler:g91,filters:(b:&#39;0&#39;,binary:&#39;1&#39;,commentOnly:&#39;0&#39;,demangle:&#39;0&#39;,directives:&#39;0&#39;,execute:&#39;1&#39;,intel:&#39;1&#39;,libraryCode:&#39;1&#39;,trim:&#39;1&#39;),lang:c%2B%2B,libs:!(),options:&#39;-xc+-O1+-fverbose-asm+-maccumulate-outgoing-args&#39;,source:1),l:&#39;5&#39;,n:&#39;0&#39;,o:&#39;x86-64+gcc+9.1+(Editor+%231,+Compiler+%232)+C%2B%2B&#39;,t:&#39;0&#39;)),k:31.51300823624706,l:&#39;4&#39;,n:&#39;0&#39;,o:&#39;&#39;,s:0,t:&#39;0&#39;),(g:!((h:compiler,i:(compiler:clang800,filters:(b:&#39;0&#39;,binary:&#39;1&#39;,commentOnly:&#39;0&#39;,demangle:&#39;0&#39;,directives:&#39;0&#39;,execute:&#39;1&#39;,intel:&#39;1&#39;,libraryCode:&#39;1&#39;,trim:&#39;1&#39;),lang:c%2B%2B,libs:!(),options:&#39;-xc+-O3+-fverbose-asm&#39;,source:1),l:&#39;5&#39;,n:&#39;0&#39;,o:&#39;x86-64+clang+8.0.0+(Editor+%231,+Compiler+%233)+C%2B%2B&#39;,t:&#39;0&#39;)),k:33.33333333333333,l:&#39;4&#39;,n:&#39;0&#39;,o:&#39;&#39;,s:0,t:&#39;0&#39;)),l:&#39;2&#39;,n:&#39;0&#39;,o:&#39;&#39;,t:&#39;0&#39;)),version:4\" rel=\"nofollow noreferrer\">Godbolt compiler explorer</a></strong>)</p>\n\n<pre><code>do_something:\n    movq    %rdi, %rax               # tmp90, .result_ptr\n    movsd   glob3+8(%rip), %xmm0      # glob3.y, glob3.y\n    movsd   %xmm0, (%rdi)             # glob3.y, &lt;retval&gt;.x\n    movsd   glob3+16(%rip), %xmm0     # glob3.z, _2\n    movsd   %xmm0, 8(%rdi)            # _2, &lt;retval&gt;.y\n    movsd   glob3(%rip), %xmm0        # glob3.x, _3\n    movsd   %xmm0, 16(%rdi)           # _3, &lt;retval&gt;.z\n    ret     \n</code></pre>\n\n<p>Notice the <code>glob3.y, &lt;retval&gt;.x</code> store before the load of <code>glob3.x</code>.</p>\n\n<p><strong>So without <code>restrict</code> anywhere in the source, GCC already emits asm for <code>do_something</code> that assumes no aliasing between the retval and <code>glob3</code>.</strong></p>\n\n<hr>\n\n<p>I don't think using <code>struct Vec3 *restrict out</code> wouldn't help at all: that only tells the compiler that inside <code>use()</code> you won't access the <code>*out</code> object through any other name.  Since <code>use()</code> doesn't reference <code>glob3</code>, it's not UB to pass <code>&amp;glob3</code> as an arg to a <code>restrict</code> version of <code>use</code>.</p>\n\n<p>I may be wrong here; @M.M argues in comments that <code>*restrict out</code> might make this optimization safe because the execution of <code>do_something()</code> happens during <code>out()</code>.  (Compilers still don't actually do it, but maybe they would be allowed to for <code>restrict</code> pointers.)</p>\n\n<p><strong>Update: <a href=\"https://gcc.gnu.org/bugzilla/show_bug.cgi?id=91398#c5\" rel=\"nofollow noreferrer\">Richard Biener said</a> in the GCC missed-optimization bug-report that M.M is correct</strong>, and if the compiler can prove that the function returns normally (not exception or longjmp), the optimization is legal in theory (but still not something GCC is likely to look for):</p>\n\n<blockquote>\n  <blockquote>\n    <p>If so, restrict would make this optimization safe if we can prove that\n    do_something is \"noexcept\" and doesn't longjmp.</p>\n  </blockquote>\n  \n  <p>Yes.</p>\n</blockquote>\n\n<p>There's a <code>noexecpt</code> declaration, but there isn't (AFAIK) a <code>nolongjmp</code> declaration you can put on a prototype.</p>\n\n<p><strong>So that means it's only possible (even in theory) as an inter-procedural optimization when we can see the other function's body.</strong>  Unless <code>noexcept</code> also means no <code>longjmp</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1565404391, "post_id": 57436765, "comment_id": 101354928, "body": "&quot;uninitialized&quot; is a sufficient requirement; but as I commented on the GCC bug I think this would be safe if the compiler could prove that <code>do_something</code> was <code>noexcept</code> and didn&#39;t call <code>longjmp</code>, if <code>restrict</code> works the way M.M argues it does.  Or if <code>*out</code> was known to point to a local in a parent function that didn&#39;t catch exceptions, so if an exception did occur it would definitely unwind past the scope of the object pointed to by <code>out</code> (again making it impossible to see writes to <code>*out</code> done before the longjmp or exception, which don&#39;t happen in the C or C++ abstract machines.)"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1565404492, "post_id": 57436765, "comment_id": 101354942, "body": "So inter-procedural analysis / optimization could make this safe in theory.  Presumably still impractical for GCC to actually look for, though."}], "tags": [], "owner": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "is_accepted": false, "score": 2, "last_activity_date": 1565382695, "creation_date": 1565382695, "answer_id": 57436765, "question_id": 57377314, "link": "https://stackoverflow.com/questions/57377314/what-prevents-the-usage-of-a-function-argument-as-hidden-pointer/57436765#57436765", "title": "What prevents the usage of a function argument as hidden pointer?", "body": "<p>The answers of @JohnBollinger and @PeterCordes cleared a lot of things for me, but I decided to <a href=\"https://gcc.gnu.org/bugzilla/show_bug.cgi?id=91398\" rel=\"nofollow noreferrer\">bug gcc-developers</a>. Here is how I understand their answer.</p>\n\n<p>As @PeterCordes has pointed out, the callee assumes, that the hidden pointer is restrict. However it makes also another (less obvious) assumption: the memory to which the hidden pointer points is <strong>uninitialized</strong>.</p>\n\n<p>Why this is important, is probably simpler to see with the help of a C++-example:</p>\n\n<pre><code>struct Vec3 do_something(void){\n   struct Vec3 res;\n   res.x = 0.0; \n   res.y = func_which_throws(); \n   res.z = 0.0; \n   return res;\n}\n</code></pre>\n\n<p><code>do_something</code> writes directly to the memory pointed to by <code>%rdi</code> (as shown in the multiple listings in this Q&amp;A), and it is allowed do so, only because this memory is <strong>uninitialized</strong>: if <code>func_which_throws()</code> throws and the exception is caught somewhere, then nobody will know, that we have changed only the x-component ot the result, because nobody knows which original value it had prior to be passed to <code>do_something</code> (nobody could have read the original value, because it would be UB).</p>\n\n<p>The above would break for passing <code>out</code>-pointer as hidden pointer, because it could be observed, that only a part and not the whole memory was changed in case of an exception being thrown and caught.</p>\n\n<p>Now, C has something similar to C++'s exceptions: <a href=\"https://en.wikipedia.org/wiki/Setjmp.h\" rel=\"nofollow noreferrer\"><code>setjmp</code> and <code>longjmp</code></a>. Never heard of them before, but it looks like in comparison to C++-example <code>setjmp</code> is best described as <code>try ... catch ...</code> and <code>longjmp</code> as <code>throw</code>. </p>\n\n<p>This means, that also for C we must ensure, that the space provided by the caller is uninitialized.</p>\n\n<p>Even without <code>setjmp/longjmp</code> there are some other issues, among others: interoperability with C++-code, which has exceptions, and <code>-fexceptions</code> option of gcc-compiler.</p>\n\n<hr>\n\n<p>Corollary: The desired optimization would be possible if we had a qualifer for unitialized memory (which we don't have), e.g. <code>uninit</code>, then </p>\n\n<pre><code>void use(struct Vec3 *restrict uninit out);\n</code></pre>\n\n<p>would do the trick.</p>\n"}], "owner": {"reputation": 26689, "user_id": 5769463, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/71a28b5fac23ee656a32cc7ea6df54ec?s=128&d=identicon&r=PG&f=1", "display_name": "ead", "link": "https://stackoverflow.com/users/5769463/ead"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 57403379, "answer_count": 3, "score": 13, "last_activity_date": 1565680811, "creation_date": 1565098454, "last_edit_date": 1565220639, "question_id": 57377314, "link": "https://stackoverflow.com/questions/57377314/what-prevents-the-usage-of-a-function-argument-as-hidden-pointer", "title": "What prevents the usage of a function argument as hidden pointer?", "body": "<p>I try to understand the implication of <a href=\"https://stackoverflow.com/questions/18133812/where-is-the-x86-64-system-v-abi-documented\">System V AMD64 - ABI's</a> <a href=\"https://en.wikipedia.org/wiki/X86_calling_conventions#System_V_AMD64_ABI\" rel=\"nofollow noreferrer\">calling convention</a> and looking at the following example:</p>\n\n<pre><code>struct Vec3{\n    double x, y, z;\n};\n\nstruct Vec3 do_something(void);\n\nvoid use(struct Vec3 * out){\n    *out = do_something();\n}\n</code></pre>\n\n<p>A <code>Vec3</code>-variable is of type MEMORY and thus the caller (<code>use</code>) must allocate space for the returned variable and pass it as hidden pointer to the callee (i.e. <code>do_something</code>). Which is what we see in the resulting assembler (<a href=\"https://godbolt.org/z/DZoeHd\" rel=\"nofollow noreferrer\">on godbolt</a>, compiled with <code>-O2</code>):</p>\n\n<pre><code>use:\n        pushq   %rbx\n        movq    %rdi, %rbx           ;remember out\n        subq    $32, %rsp            ;memory for returned object\n        movq    %rsp, %rdi           ;hidden pointer to %rdi\n        call    do_something\n        movdqu  (%rsp), %xmm0        ;copy memory to out\n        movq    16(%rsp), %rax\n        movups  %xmm0, (%rbx)\n        movq    %rax, 16(%rbx)\n        addq    $32, %rsp            ;unwind/restore\n        popq    %rbx\n        ret\n</code></pre>\n\n<p>I understand, that an alias of  pointer <code>out</code> (e.g. as global variable) could be used in <code>do_something</code> and thus <code>out</code> cannot be passed as hidden pointer to <code>do_something</code>: if it would, <code>out</code> would be changed inside of <code>do_something</code> and not when <code>do_something</code> returns, thus some calculations might become faulty. For example this version of <code>do_something</code> would return faulty results:</p>\n\n<pre><code>struct Vec3 global; //initialized somewhere\nstruct Vec3 do_something(void){\n   struct Vec3 res;\n   res.x = 2*global.x; \n   res.y = global.y+global.x; \n   res.z = 0; \n   return res;\n}\n</code></pre>\n\n<p>if <code>out</code> where an alias for the global variable <code>global</code> and were used as hidden pointer passed in <code>%rdi</code>, <code>res</code> were also an alias of <code>global</code>, because the compiler would use the memory pointed to by hidden pointer directly (a kind of RVO in C), without actually creating a temporary object and copying it when returned, then <code>res.y</code> would be <code>2*x+y</code>(if <code>x,y</code> are old values of <code>global</code>) and not <code>x+y</code> as for any other hidden pointer.</p>\n\n<p>It was suggested to me, that using <code>restrict</code> should solve the problem, i.e.</p>\n\n<pre><code>void use(struct Vec3 *restrict out){\n    *out = do_something();\n}\n</code></pre>\n\n<p>because now, the compiler knows, that there are no aliases of <code>out</code> which could be used in <code>do_something</code>, so the assembler could be as simple as this:</p>\n\n<pre><code>use:\n    jmp     do_something ; %rdi is now the hidden pointer\n</code></pre>\n\n<p>However, this is not the case neither for gcc nor for clang - the assembler stays unchanged (see on <a href=\"https://godbolt.org/z/kUPFox\" rel=\"nofollow noreferrer\">godbolt</a>).</p>\n\n<p>What prevents the usage of <code>out</code> as hidden pointer?</p>\n\n<hr>\n\n<p>NB: The desired (or very similar) behavior would be achieved for a slightly different function-signature:</p>\n\n<pre><code>struct Vec3 use_v2(){\n    return do_something();\n}\n</code></pre>\n\n<p>which results in (see on <a href=\"https://godbolt.org/z/v1ESAZ\" rel=\"nofollow noreferrer\">godbolt</a>):</p>\n\n<pre><code>use_v2:\n    pushq   %r12\n    movq    %rdi, %r12\n    call    do_something\n    movq    %r12, %rax\n    popq    %r12\n    ret\n</code></pre>\n"}, {"tags": ["c", "sockets", "bind"], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 6180869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acadef5bcec74c11f44af5a79ccda4f6?s=128&d=identicon&r=PG&f=1", "display_name": "HacHac", "link": "https://stackoverflow.com/users/6180869/hachac"}, "edited": false, "score": 0, "creation_date": 1565169480, "post_id": 57378793, "comment_id": 101264158, "body": "Okay so without this broadcast flag, it&#39;s impossible to see the broadcast traffic on the socket ?  Bind is creating a kind of endpoint but on the local machine ? And with INADDR_ANY it chooses automatically a local IP available on the local machine ? Is my understanding correct ? Thanks"}], "tags": [], "owner": {"reputation": 141, "user_id": 11883343, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bb488758694f1aae503ff9704389e75?s=128&d=identicon&r=PG", "display_name": "Wocket", "link": "https://stackoverflow.com/users/11883343/wocket"}, "is_accepted": false, "score": 1, "last_activity_date": 1565103132, "creation_date": 1565103132, "answer_id": 57378793, "question_id": 57377180, "link": "https://stackoverflow.com/questions/57377180/udp-socket-c-programming-bind-and-broadcast/57378793#57378793", "title": "UDP socket - C programming Bind and broadcast", "body": "<p>You shouldn't have to worry about receiving broadcast packets on the socket. Assuming Linux, <code>man 7 ip</code> tells us \"Datagrams to broadcast addresses can be sent or received only  when the SO_BROADCAST socket flag is set\" (that flag can be set with setsockopt and is documented in <code>man 7 socket</code>).</p>\n\n<p><code>bind()</code> is used to select the port to listen to, but also which network interface. The interface is specified by its local address, and <code>INADDR_ANY</code> in this case means to listen on all network interfaces (see <code>man 7 ip</code>). The socket will receive data from any (valid) IP address on the selected interface(s).</p>\n"}], "owner": {"reputation": 147, "user_id": 6180869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acadef5bcec74c11f44af5a79ccda4f6?s=128&d=identicon&r=PG&f=1", "display_name": "HacHac", "link": "https://stackoverflow.com/users/6180869/hachac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565103132, "creation_date": 1565098027, "last_edit_date": 1565099017, "question_id": 57377180, "link": "https://stackoverflow.com/questions/57377180/udp-socket-c-programming-bind-and-broadcast", "title": "UDP socket - C programming Bind and broadcast", "body": "<p>So, below is the code I inherited from my company (written by i don't know who) and this code is currently working for my specific scenario which is :\nAn equipment (signal generator) sends me UDP datas, and i need to receive them, analyse them and sometimes send the equipment a command (based on the analysis). Here is what it looks like :  </p>\n\n<pre><code>/*********************************************\n        **  Communication Struct.\n    **********************************************/\n\ntypedef struct CtxCom\n{\n  int                   socket_client;     //socket\n  char*                 cmd;               //command\n  char*                 recepbuff;         //recepbuff\n\n  struct sockaddr_in    addr_client;       //contains IP and PORT\n\n}CtxCom;\n\n\nextern struct CtxCom init_Ctx_com ( char* IP_client, const int PORT_client, struct timeval timeout )\n{\n\n    CtxCom ClientCom; //define struct\n    ClientCom.socket_client = socket(AF_INET, SOCK_DGRAM, 0); //Create the socket\n\n    if(ClientCom.socket_client &lt; 0) //Check the creation of the socket\n    {\n      perror(\"[Init_Com] socket()\");\n      exit(errno);\n    }\n\n    struct sockaddr_in addr_me = { 0 }; //create the server struct\n\n    addr_me.sin_addr.s_addr = htonl(INADDR_ANY); //any incoming IP \n    addr_me.sin_port = htons(PORT_client);\n    addr_me.sin_family = AF_INET; //address family\n\n    if(bind(ClientCom.socket_client,(struct sockaddr *) &amp;addr_me, sizeof(addr_me)) &lt; 0) //bind the socket\n    {\n      perror(\"[Init_Com] bind()\");\n      exit(errno);\n    }\n\n    //conf equipment side\n    ClientCom.addr_client.sin_addr.s_addr = inet_addr(IP_client);\n    ClientCom.addr_client.sin_port = htons(PORT_client);\n    ClientCom.addr_client.sin_family = AF_INET;\n\n    //timeout\n    //setsockopt(ClientCom.socket_client , SOL_SOCKET, SO_RCVTIMEO, (const char *)&amp;timeout , sizeof (struct timeval));\n    //fcntl(ClientCom.socket_client, F_SETFL, O_NONBLOCK); //set socket to non block\n\n    //Printf info\n    printf(\"[Init CtxCom]\");\n    printf(\" Socket connected and Client[%s:%d] configured *************** \\n\",\n            inet_ntoa(ClientCom.addr_client.sin_addr),\n            ntohs(ClientCom.addr_client.sin_port) );\n\n  return ClientCom;\n\n}\n\n\n/*Write char* cmd of size cmdSize in the socket specified*/\nextern void write_client(struct CtxCom CtxCom, char* cmd, int cmdSize)\n{\n    //adding 0x0a 0x0d to the end of a CMD\n    cmdSize+=2;\n    cmd[cmdSize-2]='\\r';\n    cmd[cmdSize-1]='\\n';\n\n    //send CMD\n    if(sendto(CtxCom.socket_client, cmd, cmdSize, 0, (struct sockaddr *)&amp;(CtxCom.addr_client), sizeof(CtxCom.addr_client)) &lt; 0)\n    {\n      perror(\"[Write_client] send()\");\n      exit(errno);\n    }\n    else\n    {\n      //printf( \"\\n***************SEND OK [%s:%d]******************\\n\"\n        //    ,inet_ntoa(CtxCom.addr_client.sin_addr), ntohs(CtxCom.addr_client.sin_port) );\n    }\n}\n\n\n\n\n* Give in output the char* strings outStringLLRX with a size of sizeOutStringLLRX*/\nextern void read_client(\n    /*input*/  struct CtxCom CtxCom, struct timeval timeout,\n    /*output*/ char** outStringLLRX, int* sizeOutStringLLRX)\n{\n    //timeout forced\n    //timeout.tv_usec=TIMEOUT_LISTEN_GIII;\n\n    //Define variables\n    fd_set      readfs;\n    int         loop=1;\n    int         i=0, k=0, z=0, z_prev=0;\n    int         res;\n    char        buf[25500];\n    int         sizeBuf;\n\n    //Init variables\n    memset(buf, '\\0' ,sizeof(buf));\n    for(i=0;i&lt;NB_CHANNELS_LLRX;i++)\n    {\n        sizeOutStringLLRX[i]=0;\n        outStringLLRX[i][0]='\\0';\n    }\n\n    //Make sure buffer is empty\n    memset(buf, '\\0' ,sizeof(buf));         //empty recep buffer\n    FD_ZERO(&amp;readfs);                       //zero testing\n    FD_SET(CtxCom.socket_client, &amp;readfs);  // set testing\n\n    //block until input becomes available\n    res=select(CtxCom.socket_client+1, &amp;readfs, NULL, NULL, &amp;timeout);\n\n    switch (res)\n    {\n        case 0: //timeout\n            printf(\"TIMEOUT error [Read Client] - No data received \\n\");\n            break;\n\n        case -1: //error\n            printf(\"Error [Read Client] \\n\");\n            break;\n\n        default : //streams event\n            if( FD_ISSET(CtxCom.socket_client, &amp;readfs) )\n            {\n                sizeBuf=recvfrom (CtxCom.socket_client, buf , 25500, 0, NULL, NULL); //already now wich IP, no need to update\n                if ( sizeBuf&lt;0 )  //if &lt;0 =&gt; no data =&gt; error\n                {\n                    printf(\"[Read_Client] Read failed : SizeBuf&lt;0 \\n\");\n                }\n                else\n                {\n                    printf(\"[Read_Client] Got a buffer of size %d (round %d) \\n\", sizeBuf, k);\n                    (sizeOutStringLLRX[0])+=sizeBuf;\n                    for( z=0; z&lt;sizeBuf; z++) {outStringLLRX[0][z_prev]=buf[z]; z_prev++;}\n                }\n            }\n            break;\n\n    }//switch\n\n\n  //printf(\"[Read_Client] final size =%d\\n\", z_prev);\n  /*printf(\"***************RECV OK [%s:%d]******************\\n\",\n          inet_ntoa(CtxCom.addr_client.sin_addr),ntohs(CtxCom.addr_client.sin_port) );*/\n}\n</code></pre>\n\n<p>I have read socket lesson and bind() man, but i'm still wondering : If i have another equipment that sends data on the same subnet, but in broadcast (on the x.255). Can this pollute the socket? and sometimes on the same socket when I'm receiving datas from my equipment I received the broadcast instead (or in addition) ?\nIn my case, bind is actually here just to \"give a name\" to the socket and not to accept any incoming IP address like it's written in the comment ?</p>\n\n<p>(Btw, if anything written here is really bad, let me know, i'll be glad to make this code better)</p>\n"}, {"tags": ["c", "static-libraries", "win64"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565097333, "post_id": 57376925, "comment_id": 101238294, "body": "Perhaps your program <i>crashes</i>? Have you tried to use a debugger to run the program? What does it say?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565097464, "post_id": 57376925, "comment_id": 101238384, "body": "By the way, <code>(char*) *Params</code> looks <i>very</i> suspect... What is the type <code>UI8</code>? If it&#39;s <code>unsigned char</code> then <code>*Params</code> is a single <code>unsigned char</code> and not really something you can use as a pointer. Please try to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> to show us. And please enable more verbose warnings when building (if the compiler doesn&#39;t already warn about such things). If <code>UI8</code> is an alias for a pointer type, then don&#39;t do that. Hiding pointer types makes the code harder to read, understand and maintain. And don&#39;t make up your own type-aliases, use the standard unless there&#39;s a specific semantic meaning."}, {"owner": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 0, "creation_date": 1565098371, "post_id": 57376925, "comment_id": 101238971, "body": "should have said that the prog is not from me and i shouldn&#39;t touch it. I also doesn&#39;t like this <code>(char*) *Params</code> but it&#39;s how it is :&#39;(  I&#39;m already trying to make a reproducible example, but it&#39;s using a lot of particular functions from the lib so it&#39;s hard to do. And i&#39;m also trying to find what <code>UI8</code>and <code>I64</code>refers to. What may help is the way the function is called; i&#39;ll add that in the question."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1565100114, "post_id": 57376925, "comment_id": 101240127, "body": "Any reason you chose <code>fgets</code> instead of <code>fread</code> to handle the read of binary data? You may well have a <code>0xa</code> char in your binary data that would cause the read to stop prematurely, and you may well have a <code>0x0</code> in your data that would cause <code>strcpy</code> to stop prematurely as well. Bad juju to mix string functions with a binary read."}, {"owner": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1565100236, "post_id": 57376925, "comment_id": 101240206, "body": "@AndrewHenle: i&#39;m not allowed to change this <code>typedef long I64</code>. It comes from another lib, i put it here just to let you know exactly what was those I64 and UI8. I can&#39;t change them. In fact, if there wer an answer which doesn&#39;t involve changing the code, but instead add something to the dev environment, it would be perfect -_-"}, {"owner": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1565100494, "post_id": 57376925, "comment_id": 101240376, "body": "@DavidC.Rankin Frankly, i have no idea. I didn&#39;t made it, i barely understand what it does. The code is given to me; i can make litlle changes, but as less as possible. My point is just to make it works on every OS."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1565101491, "post_id": 57376925, "comment_id": 101241080, "body": "I got you. That is a big problem. In your function, you open <code>fic=fopen(filename, &quot;rb&quot;)</code> in binary mode. If <code>filename</code> contains binary data, and not just plain-old-text, then you should not be using <code>fgets</code> as binary data has no concept of what a line is. The ASCII value for the <code>&#39;\\n&#39;</code> is <code>0xa</code> (10) which may just as easily be the low-byte in a <code>short</code> with value <code>6922</code>. The <i>nul-character</i> <code>0x0</code> may just be the high byte in the <code>short</code> 10 in a binary file, but if you pass the buffer to <code>strcpy</code> and the first two bytes in the file as a <code>short 10</code> (e.g. <code>0000000000001010</code>) nothing is copied."}, {"owner": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1565102283, "post_id": 57376925, "comment_id": 101241594, "body": "@DavidC.Rankin then, why is it working when the function&#39;s code is in my prog? And why is it working on Win32 and Linux64?"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 2, "creation_date": 1565103049, "post_id": 57376925, "comment_id": 101242026, "body": "If your file contains plain-old-text, there is no problem. But without knowing what your content actually is, all I can go by is the <code>fic=fopen(filename, &quot;rb&quot;)</code> opening. If it is working, then you are fine. You can remove the <code>&#39;b&#39;</code> from the <code>mode</code> to eliminate the confusion."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 0, "creation_date": 1565101858, "post_id": 57378192, "comment_id": 101241334, "body": "If that was the problem, then the function shouldn&#39;t work even when i copy it in my file, right?   My problem is, since it works when i copy/paste the function in my file, the dev will say that it doesn&#39;t comes from the code, and then he won&#39;t change anything."}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "reply_to_user": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 0, "creation_date": 1565102779, "post_id": 57378192, "comment_id": 101241867, "body": "@Ablia Same file? Nope. The optimizer is squashing the bug because it can see the bad conversion now."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 0, "creation_date": 1565103117, "post_id": 57378192, "comment_id": 101242074, "body": "@Ablia <i>If that was the problem, then the function shouldn&#39;t work even when i copy it in my file</i>  Maybe, maybe not.  A botched call can work in some cases and fail in others."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1565103204, "post_id": 57378192, "comment_id": 101242135, "body": "@Joshua <i>The optimizer is squashing the bug because it can see the bad conversion now.</i> Or maybe the register layout is different and it just works because the proper value just happens to be in the expected register.  There are lots of reasons why undefined behavior can &quot;work&quot; sometimes but not others."}, {"owner": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 0, "creation_date": 1565179462, "post_id": 57378192, "comment_id": 101269701, "body": "On Win32, <code>I64</code>is defined as <code>long</code>, so 32 bits; it&#39;s working.  On Win64, <code>I64</code>is defined as <code>long long</code> (see the <code>if defined mingwx64</code>, so 64 bits, not 32. I can try to use <code>int64_t</code>instead, but as said those types come from another lib that i have to use and can&#39;t change at all, so i&#39;ll have to cast it back to <code>I64</code> later..."}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "reply_to_user": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 0, "creation_date": 1565184400, "post_id": 57378192, "comment_id": 101272753, "body": "@Ablia In my opinion no option. The bad code in the library must be fixed."}, {"owner": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 0, "creation_date": 1565189102, "post_id": 57378192, "comment_id": 101275742, "body": "I&#39;ve tried 3 ways: 1) change the I64 type: <code>typedef int64_t I64</code> in the lib. Not working better than before. 2) change the readParamFile function so that it takes a int64_t instead of I64, then cast to I64 later when i need it. Working, but i need to cast a lot and this is not really a &quot;solution&quot;. 3) just to limit the number of cast: since strncpy is the one who crash, make a <code>int64_t tmpVar</code> in the readParamFile function, and at the end of it cast <code>*ParamsLen = (I64) tmpVar</code>. Then it crash later, at the first function using ParamsLen."}], "tags": [], "owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "is_accepted": false, "score": 3, "last_activity_date": 1565101173, "creation_date": 1565101173, "answer_id": 57378192, "question_id": 57376925, "link": "https://stackoverflow.com/questions/57376925/functions-not-working-well-when-linked-via-a-static-lib-but-working-if-copied-i/57378192#57378192", "title": "functions not working well when linked via a static lib, but working if copied in the prog", "body": "<p>Windows is LLP64 not LP64; your I64 ended up being only 32 bits only when compiling for x64 and the high bits passed as garbage.</p>\n\n<p>Do <code>#include &lt;stdint.h&gt;</code> and use the types such as <code>int64_t</code> and <code>uint64_t</code> to avoid bugs like these.</p>\n\n<p>Not correcting the incorrect definitions is not going to work. Use a build process that applies patches if you have to, but use working type definitions.</p>\n"}, {"comments": [{"owner": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 0, "creation_date": 1565104675, "post_id": 57378517, "comment_id": 101242956, "body": "Well, for this one i can make a local copy. But i think others have a weird behavior and i don&#39;t want to copy the whole lib -_- i&#39;ve tried to re-wrote it, but i still have to use parts of the lib (like, i really can&#39;t get rid of those UI8 and I64), so there&#39;s still problems.  The company is not the problem. The dev is the client here :&#39;("}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 2, "creation_date": 1565105251, "post_id": 57378517, "comment_id": 101243271, "body": "@Ablia: <i>The dev is the client here :&#39;(</i>  you have all my sympathy. Do you compile the library yourself or do you link to a binary they provide?"}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1565106191, "post_id": 57378517, "comment_id": 101243863, "body": "<code>gcc</code> does not have flaky C99 support."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1565120646, "post_id": 57378517, "comment_id": 101250266, "body": "@Joshua: gcc is fine, but VS had little support for C99 and the combination gcc+MS runtime library used by the OP is problematic: its implementation of <code>printf</code> does not support many of the c99 standard modifiers, such as <code>ll</code>, <code>z</code>, <code>t</code>..."}, {"owner": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 0, "creation_date": 1565166730, "post_id": 57378517, "comment_id": 101262621, "body": "@chqrlie i&#39;m compiling the lib myself. But the Makefile is as horrible as the code. I&#39;m working on simplifying it (a lot). It&#39;s actually 240 lines and 15 targets just to put 6 .c files in a lib -_- (using another lib, that i don&#39;t compile myself, but this one should be ok)"}, {"owner": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 0, "creation_date": 1565167092, "post_id": 57378517, "comment_id": 101262826, "body": "@chqrlie about the I64 thing: here the architecture is define as mingwx64, so accordint to the <code>if defined</code> I64 is a <code>long long</code>. If windows keep <code>long</code> as 32-bits, then <code>long long</code> should be 64 bits. And on Win32, <code>I64</code> was then defined only as <code>long</code>, so 32 bits."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1565167146, "post_id": 57378517, "comment_id": 101262867, "body": "Given the sloppiness of the configuration tests, you need to ensure that all modules are compiled with the same settings and that these settings do not conflict with each other nor are redefined locally in some of the sources..."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1565167667, "post_id": 57378517, "comment_id": 101263171, "body": "I came to the same conclusion: <code>I64</code> must have been defined as <code>long</code> in the Win32 version, hence 32 bits! 64-bit support is cumbersome in applications that use the Microsoft Win32 runtime libraries, but naming a 32-bit type <code>I64</code> is downright evil. Although in this case, the situation is more likely attributable to stupidity and ignorance rather than malice. The system <i>works</i> by miracle in some architectures, I&#39;m afraid your job is not to fix the problems, but rather to find the magical spells that will hide the problems for your targets.  A blatant illustration of Sturgeon&#39;s principle."}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": true, "score": 3, "last_activity_date": 1565292802, "last_edit_date": 1565292802, "creation_date": 1565102233, "answer_id": 57378517, "question_id": 57376925, "link": "https://stackoverflow.com/questions/57376925/functions-not-working-well-when-linked-via-a-static-lib-but-working-if-copied-i/57378517#57378517", "title": "functions not working well when linked via a static lib, but working if copied in the prog", "body": "<p>There are multiple issues in the code fragments posted:</p>\n\n<ul>\n<li><p><code>#define FILENAME \"MyDir\\ParamFile.txt\"</code> is incorrect. You should either escape the backslashes as <code>#define FILENAME \"MyDir\\\\ParamFile.txt\"</code> or use plain forward slashes that work with all Windows versions: <code>#define FILENAME \"MyDir/ParamFile.txt\"</code></p></li>\n<li><p>The arbitrary definition of type <code>I64</code> is risky. You should include <code>&lt;stdint.h&gt;</code> and use <code>typedef uint64_t I64;</code></p></li>\n<li><p>the function prototype <code>void readFile(char* filename, UI8 *Params, I64 *ParamsLen)</code> is inconsistent with the expected API: <code>readFile</code> reads the file contents and stores a pointer to an allocated buffer of length <code>*ParamsLen</code> into <code>*Params</code>. The prototype should be:</p>\n\n<pre><code>int readFile(const char *filename, UI8 **Params, I64 *ParamsLen);\n</code></pre>\n\n<p><code>readFile</code> should return an error code in case the file cannot be open or read.</p></li>\n<li><p>There is a missing <code>}</code> after <code>exit (-1);</code> in function <code>readFile</code>.</p></li>\n<li><p>The temporary buffer should be allocate with an extra byte, just in case the file contains a single line not terminated with a newline.</p></li>\n<li><p><code>fgets()</code> does not necessarily store a <code>'\\n'</code> at the end of the array, especially if the file does not contain one. Stripping the last character unconditionally is incorrect.</p></li>\n<li><p>why not use <code>malloc()</code> instead of the non portable Windows specific <code>PtrAlloc()</code>.</p></li>\n<li><p>If you expect to use the file contents as a C string, you should allocate an extra byte for the null terminator and store it at the end of the array.</p></li>\n</ul>\n\n<p>This function uses a contorted approach to read a line from a file. You should try harder to understand what it does and fix it from the above remarks. C is a sharp and unforgiving language, programming without a good understanding of the elements used leads to bugs and failures with maximum frustration.</p>\n\n<p>The main issue in and around this code is the definition of type <code>I64</code>. Due to the overwhelming amount of non portable Win32 code that assumed <code>long</code> to be exactly 32-bits, Microsoft decided to keep <code>long</code> 32-bits on Win64 and to make matters worse delayed support for standard 64-bit types in the C library, making <code>%lld</code> non portable to Microsoft Windows default libraries. This explains the warning you get from the gcc compiler that checks the consistency of <code>printf</code> arguments with the format string. If it <em>worked</em> in the win32 version, they probably did not use 64 bit values (<code>long long</code>) at all.</p>\n\n<p>A possible explanation for the different behavior between the static library and embedding the functions' code in the program is the use of different compilers, compiler options or command line definitions. Did you check all these? Do you compile the library yourself or do you get it in binary form from a different team?</p>\n\n<p>Porting software between 32- and 64-bit architectures is non-trivial, especially on Windows platforms that encouraged non portable constructs and have flaky C99 support.</p>\n\n<p>The code is not only poorly written, the prototype for the function is incorrect: <code>Params</code> is not a <code>UI8 *</code> it should be a <code>UI8 **</code>, the function <em>works</em> by chance and it will break easily. If the <em>developper</em> won't change anything about it, I suggest a few possible solutions:</p>\n\n<ul>\n<li>copy the functions locally, fix the problems and don't use the bogus library,</li>\n<li>write your own functions.</li>\n<li>find yourself a better job at a different company: you are wasting your time there, you will learn so much more from a saner environment.</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 1, "creation_date": 1565105989, "post_id": 57379402, "comment_id": 101243747, "body": "thank&#39;s, gonna try something like this tomorrow. You&#39;re right, it doesn&#39;t fail but i&#39;m not sure the result is good (far from it). However, it&#39;s not a <code>UI8 *Param</code>but an <code>UI8* *Param</code> which is (i think?) equivalent to your <code>UI8 **Param</code>"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 0, "creation_date": 1565106110, "post_id": 57379402, "comment_id": 101243815, "body": "@Ablia <i>However, it&#39;s not a <code>UI8 *Param</code> but an <code>UI8* *Param</code></i> Yes, I just saw that edit.  That&#39;s a huge difference and pretty much invalidates the first few paragraphs of this answer."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1565106189, "post_id": 57379402, "comment_id": 101243860, "body": "@Joshua Probably because the question was edited while I was answering to replace <code>UI8 *Param</code> with <code>UI8* *Param</code>.  <b>HUGE</b> difference..."}, {"owner": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "edited": false, "score": 0, "creation_date": 1565163080, "post_id": 57379402, "comment_id": 101260913, "body": "yeah, taht was a typo from me, sorry abouth that. Your answer is still helpfull and I upvoted it. I&#39;m not sure if I have strdup or getline, but I may be able to get them (I have Mingw64 without cygwin or Msys, so it&#39;s not really POSIX)"}], "tags": [], "owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "is_accepted": false, "score": 2, "last_activity_date": 1565106632, "last_edit_date": 1565106632, "creation_date": 1565105341, "answer_id": 57379402, "question_id": 57376925, "link": "https://stackoverflow.com/questions/57376925/functions-not-working-well-when-linked-via-a-static-lib-but-working-if-copied-i/57379402#57379402", "title": "functions not working well when linked via a static lib, but working if copied in the prog", "body": "<p><strong>EDIT</strong> - the first portion of this answer refers to the question prior to editing.  The question as originally posted had <code>UI8 *Param</code> instead of <code>UI8* *Param</code>.</p>\n\n<p>========================================================================</p>\n\n<blockquote>\n  <p>but it IS working when directly copied in the prog, </p>\n</blockquote>\n\n<p>You haven't really established that it's working properly.  \"Doesn't appear to fail\" is not the same as \"working properly\".</p>\n\n<p>Given</p>\n\n<pre><code>void readParamFile (char* filename, UI8 *Params, I64 *ParamsLen){\n</code></pre>\n\n<p>this code is wrong:</p>\n\n<pre><code>*Params=NULL\n</code></pre>\n\n<p>as <code>*Params</code> is an <code>unsigned char</code> value, not a pointer that can hold <code>NULL</code>.</p>\n\n<p>So this code is wrong, too:</p>\n\n<pre><code>*Params= (UI8*)PtrAlloc(sizeof(UI8)*strlen(buf))\n</code></pre>\n\n<p>Again, <code>*Params</code> is a single <code>unsigned char</code> value.</p>\n\n<p>That's not questionable - it is wrong to assign a pointer of any value to <code>*Params</code> given the <code>UI8 *Params</code> definition of the variable.  It's incorrect code and undefined behavior.</p>\n\n<p>The code <em>appears</em> as if it would be better suited to a </p>\n\n<pre><code>void readParamFile (char* filename, UI8 **Params, I64 *ParamsLen)\n</code></pre>\n\n<p>declaration.</p>\n\n<p>The code as posted relies on questionable-at-best <code>typedef</code>'s, and has unneeded functionality - there's no need to get the file length, for example.</p>\n\n<p>Something like this is simpler, doesn't rely on non-standard <code>typedef</code>'s, and should work a lot better:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdint.h&gt;\n\nint readParamFileBis( const char *filename, unsigned char **params, uint64_t *paramsLen )\n{\n    *params = NULL;\n\n    FILE *fp = fopen( filename, \"r\" );\n    if ( fp == NULL )\n    {\n        return( -1 );\n    }\n\n    // assume we have POSIX getline()\n    // (Windows implementations abound...)\n    unsigned char *line = NULL;\n    size_t lineLen = 0UL;\n\n    // loop until a line that doesn't start with # is found\n    for ( ;; )\n    {\n        ssize_t bytesRead = getline( &amp;line, &amp;lineLen, fp );\n\n        // EOF - no more to read\n        if ( bytesRead == -1 )\n        {\n            break;\n        }\n\n        // line starts with # - skip it\n        if ( line[ 0 ] == '#' )\n        {\n            continue;\n        }\n\n        // we found the first line that\n        // doesn't start with #, so pass\n        // it back to the caller\n\n        // strip any trailing newline\n        line[ strcspn( \"\\n\" ) ] = '\\0';\n\n        // assume we have POSIX strdup()\n        // (could just do *params = line; but\n        // line could now refer to a vary large buffer\n        // if a long comment line was in the file)\n        *params = strdup( line );\n\n        // tell the caller how long the line is\n        // (extraneous as it's a string, but...)\n        *ParamsLen = strlen( line );\n\n        free( line );\n\n        // found the line, so break the loop\n        break;\n    }\n\n    fclose( fp );\n\n    // didn't find a line that doesn't start with '#'\n    if ( *params == NULL )\n    {\n         return( -1 );\n    }\n\n    // success\n    return( 0 );\n} \n</code></pre>\n\n<p>For Windows, it's not hard to find <code>getline()</code> and <code>strdup()</code> implementations.</p>\n\n<p>Even simpler - return the string (simplified and comments removed to make it as short as possible):</p>\n\n<pre><code>char *readParamFile( char* filename )\n{\n    FILE *fp = fopen( filename, \"r\" );\n    if ( fp == NULL ) return( NULL );\n\n    unsigned char *line = NULL;\n    size_t lineLen = 0UL;\n\n    for ( ;; )\n    {\n        ssize_t bytesRead = getline( &amp;line, &amp;lineLen, fp );\n        if ( bytesRead == -1 ) break;\n        if ( line[ 0 ] == '#' ) continue;\n\n        line[ strcspn( \"\\n\" ) ] = '\\0';\n        break;\n    }\n\n    fclose( fp );\n\n    // oops!  Don't return a comment line!\n    // could also strdup( line ) in loop above after finding proper line\n    if ( line != NULL &amp;&amp; line[ 0 ] == '#' )\n    {\n        free( line );\n        line = NULL:\n    }\n    return( line );\n} \n</code></pre>\n\n<p>That's all you really need to find the first line that doesn't start with a <code>'#'</code> character and return it to the caller.  It will return a pointer to the line that must be <code>free()</code>'d later on success, or <code>NULL</code> on failure.  No pointer indirection necessary.</p>\n"}], "owner": {"reputation": 143, "user_id": 11561992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb4342d8aa58498198e4a04321db2ae?s=128&d=identicon&r=PG", "display_name": "Ablia", "link": "https://stackoverflow.com/users/11561992/ablia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 0, "accepted_answer_id": 57378517, "answer_count": 3, "score": 1, "last_activity_date": 1565292802, "creation_date": 1565097246, "last_edit_date": 1565269492, "question_id": 57376925, "link": "https://stackoverflow.com/questions/57376925/functions-not-working-well-when-linked-via-a-static-lib-but-working-if-copied-i", "title": "functions not working well when linked via a static lib, but working if copied in the prog", "body": "<p>I have a static lib (.a) containing some useful functions that I'm using inside another program. \nThe link goes well, the functions from the lib are found, but when the program gets executed it doesn't work well. On the other hand, if I copy/paste the lib functions I need directly in my program code, it works well. Moreover, it was working well on win32, but now I'm on Win64.</p>\n\n<p><strong>Edit: I know the code is horrible (it's not mine), but it IS working when directly copied in the prog, which mean the developper won't change anything about it. What i need is to understand why it does not work well when i link the library where the function is, when it was working perfectly on Linux64 and Win32. You may find a lot of problems in this code, but it's just one example; since it doesn't explain why it works in the prog but not linked by the lib, it'll be useless to me since the dev doesn't care at all.</strong>  </p>\n\n<p>Here's ONE of the problematic functions in the lib (i took the simplest, which does not depends to much on the lib, but i suspect others not to work as expected): </p>\n\n<pre><code>#if defined(mingwx64)\ntypedef long long         I64;\n#else\ntypedef long              I64;\n#endif\ntypedef unsigned char     UI8;\n\nvoid readParamFile (char* filename, UI8* *Params, I64 *ParamsLen){\n    FILE* fic;\n    char* buf; int buf_Len;\n    *Params=NULL; *ParamsLen=0;\n\n    if(!(fic=fopen(filename, \"rb\"))){\n        fprintf(stderr, \"Error, can't open %s\\n\", filename);\n        exit (-1);\n    }\n    fseek(fic, 0, SEEK_END);\n    buf_Len=ftell(fic);\n    fseek(fic, 0, SEEK_SET);\n\n    if(!(buf=(char*)PtrAlloc(sizeof(char)*buf_Len))){\n        fprintf(stderr, \"Error: Can't allocate %d bytes\", buf_Len);\n        exit(-1);\n    }\n\n//the files are specifics, i read the lines until the first one which doesn't start with #\n    do{\n       if(!fgets(buf, buf_Len, fic)){\n          fprintf(stderr,\"Error: Can't read parameters\");\n          exit(-1);\n       }\n       buf[strlen(buf)-1]='\\0';\n    } while (buf[0]=='#');\n\n    if(!(*Params= (UI8*)PtrAlloc(sizeof(UI8)*strlen(buf)))){\n        fprintf(stderr,\"Error: can't allocate %d butes\", buf_Len);\n        exit(-1);\n    }\n\n    strncpy((char*) *Params , buf, *ParamsLen=strlen(buf));\n\n    PtrFree(buf);\n    fclose(fic);\n}\n</code></pre>\n\n<p>So, this function is in MyLib.a. I compiled it on Win64 using Mingw64 (just like I used Mingw on Win32), the compilation works. \nThen, when compiling MyProg, I link this lib. The compilation goes well. \nAnd when I launch MyProg, it will at some point use this function, and stop on the <code>strncpy</code>  (before was <code>memcpy</code> used, but it wasn't better). It won't throw any error message, nothing: I wait a bit and the prog stops just as if it has done everything well, except it didn't. If I try to make a print after this <code>strncpy</code>, it never goes to it, but the prog end \"normally\" (no crash that i can see).</p>\n\n<p>The weird point is, if I copy/paste this function inside the code of MyProg, let's say I call it <code>readFileBis</code>, then <code>readFileBis</code> works well. </p>\n\n<p>However, i'm not going to copy/paste every function of my lib inside every prog which needs it. Would be a waste.  </p>\n\n<p>EDIT: tried to make a reproducible example for it, but still working on it. So let's say this is the only file of MyProg: </p>\n\n<p><strong>MyProg.c</strong></p>\n\n<pre><code>#define FILENAME \"MyDir/ParamFile.txt\"\n\nvoid readParamFileBis (char* filename, UI8* *Params, I64 *ParamsLen){\n    //the exact same thing as in readFile, don't wanna make the question too long.\n}\n\nint main(int argc, char *argv[]){\n\n    UI8 *Params = NULL; \n    I64 ParamsLen = 0;\n\n//this is working:\n    readParamFileBis (FILENAME, &amp;Params, &amp;ParamsLen);\n//this is not working : \n    readParamFile (FILENAME, &amp;Params, &amp;ParamsLen);\n\n    exit(0);\n}\n</code></pre>\n\n<p>And ParamFile.txt looks like it (with a way more longer number): </p>\n\n<pre><code># Introduction text\n000500000000064F1B58372A27\n</code></pre>\n\n<p>I would like to know what may be wrong here. Knowing that it was working well on Win32, I guess it has something to do with the 64bit thing, but I don't know what. Since I recompiled both the lib and the prog on win64, it should be ok. I have no idea what's going on. </p>\n\n<p>Oh, and there's another weird thing which may or may not has something to do with it: when compiling, I may use the flag -D${ARCHI}. On Win32, ARCHI was <code>mnigw386</code>; on win64, it is <code>mingwx64</code>. When I compile with this flag on Win64, I got some warnings about my print formats (like, I'm using %ld to print some I64, and it doesn't like it) that I didn't had on win32.</p>\n\n<p><strong>EDIT/Solution:</strong> So the problem was indeed the I64. I managed to change it by a <code>int64_t</code> and it is working. Moreover, i managed to refont the Makefiles (from 250lines and 16 targets to 90 lines and 5 targets...), and then found out that the architecture was indeed defined...but not included in any compilation flag. So i guess that the prog couldn't see that <code>I64</code> was defined as a <code>long long</code> (since it's in a <code>if mingwx64</code>) and thought it was a <code>long</code>, and that was the big prob here. </p>\n"}, {"tags": ["c", "go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1565096441, "post_id": 57376607, "comment_id": 101237691, "body": "Have you read the documentation on callbacks? <a href=\"https://github.com/golang/go/wiki/cgo#function-pointer-callbacks\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/cgo#function-pointer-callbacks</a>"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user11213886"}, "is_accepted": true, "score": 1, "last_activity_date": 1565181839, "creation_date": 1565181839, "answer_id": 57394814, "question_id": 57376607, "link": "https://stackoverflow.com/questions/57376607/how-to-pass-a-go-function-as-an-argument-to-a-c-function/57394814#57394814", "title": "How to pass a Go function as an argument to a C function?", "body": "<p>the main problem is misunderstanding of definition of go in c. \nso final code is look like </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\n//export callOnMeGo\nfunc callOnMeGo(in int) int {\n    fmt.Printf(\"Go.callOnMeGo(): called with arg = %d\\n\", in)\n    return  in+ 1\n}\n\nfunc main() {\n\n    C.some_c_func((C.callback_fcn)(unsafe.Pointer(C.callOnMeGo_cgo)))\n    //dont forget to use (funcDefinedInGO_cgo) for with postfix _cgo\n\n...\n\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11213886"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 57394814, "answer_count": 1, "score": 1, "last_activity_date": 1565181839, "creation_date": 1565096194, "last_edit_date": 1565175636, "question_id": 57376607, "link": "https://stackoverflow.com/questions/57376607/how-to-pass-a-go-function-as-an-argument-to-a-c-function", "title": "How to pass a Go function as an argument to a C function?", "body": "<p>I'm trying to pass a Go function to a C function.</p>\n\n<p>Something like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>stm := C.struct_tray_menu{\n    ....\n    fn: // definition of method\n    ....\n}\nC.menu_cb(stm);\n</code></pre>\n\n<p>and pass that into a C function:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>static void menu_cb(struct tray_menu *item) {\n  (void)item;\n  printf(\"menu: clicked on %s\\n\", item-&gt;text);\n}\n</code></pre>\n\n<p>I'd just like to know how to define something like C.function.</p>\n"}, {"tags": ["c", "makefile", "kernel-module", "gnu-assembler"], "comments": [{"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 2, "creation_date": 1565099208, "post_id": 57376336, "comment_id": 101239549, "body": "Your module has two source files <code>driver.c</code> and <code>fileasm.s</code>, but you want to link them together into <code>driver.o</code>. In order to do that, you will need to rename <code>driver.c</code> and list both object files in <code>driver-objs</code>. For example, rename <code>driver.c</code> to <code>main.c</code> and set <code>obj-m += driver.o</code> and <code>driver-objs = main.o fileasm.o</code>."}, {"owner": {"reputation": 89, "user_id": 6819537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b28e45a9f6258d1a1a8f9ddbc46824fd?s=128&d=identicon&r=PG&f=1", "display_name": "Massimiliano Di Cavio", "link": "https://stackoverflow.com/users/6819537/massimiliano-di-cavio"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1565109185, "post_id": 57376336, "comment_id": 101245386, "body": "You&#39;re right, thank you very much. Now it&#39;s working"}], "owner": {"reputation": 89, "user_id": 6819537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b28e45a9f6258d1a1a8f9ddbc46824fd?s=128&d=identicon&r=PG&f=1", "display_name": "Massimiliano Di Cavio", "link": "https://stackoverflow.com/users/6819537/massimiliano-di-cavio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 142, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1565095312, "creation_date": 1565095312, "question_id": 57376336, "link": "https://stackoverflow.com/questions/57376336/how-to-compile-kernel-module-together-with-file-s-gas-assembly", "title": "How to compile kernel module together with file .s GAS Assembly", "body": "<p>I would like to compile a file .s GAS Assembly together with my kernel module (LKM). My kernel linux version is 5.1.20-200.fc29.x86_64. This is my assembly fileasm.s:</p>\n\n<pre><code> .globl  maxofthree\n\n        .text\nmaxofthree:\n        mov     %rdi, %rax              # result (rax) initially holds x\n        cmp     %rsi, %rax              # is x less than y?\n        cmovl   %rsi, %rax              # if so, set result to y\n        cmp     %rdx, %rax              # is max(x,y) less than z?\n        cmovl   %rdx, %rax              # if so, set result to z\n        ret                             # the max will be in eax\n\n\nAnd this is my driver.c:\n\n#include&lt;linux/kernel.h&gt;\n#include&lt;linux/init.h&gt;\n#include&lt;linux/module.h&gt;\n\nint64_t maxofthree(int64_t, int64_t, int64_t);\n\n\nstatic int __init hello_world_init(void)\n{\n    printk(KERN_INFO \"Welcome \\n\");\n        printk(KERN_INFO \"This is the Simple Module\\n\");\n        printk(KERN_INFO \"Kernel Module Inserted Successfully...\\n\");\n        printk(\"%lld\\n\", maxofthree(10, 20,30));\n    return 0;\n}\n\nvoid __exit hello_world_exit(void)\n{\n    printk(KERN_INFO \"Kernel Module Removed Successfully...\\n\");\n\n}\n\nmodule_init(hello_world_init);\nmodule_exit(hello_world_exit);\n\nEXPORT_SYMBOL_GPL(maxofthree);\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Max\");\nMODULE_DESCRIPTION(\"Simple driver\");\nMODULE_VERSION(\"2:1.0\");\n</code></pre>\n\n<p>In the Makefile I wrote:</p>\n\n<pre><code>obj-m += driver.o\ndriver-objs += fileasm.o\n\nKDIR = /lib/modules/$(shell uname -r)/build\n\nall:\n        make -C $(KDIR)  M=$(shell pwd) modules\nclean:\n        make -C $(KDIR)  M=$(shell pwd) clean\n</code></pre>\n\n<p>When I try to compile I have this warning message:</p>\n\n<pre><code>WARNING: modpost: missing MODULE_LICENSE()\n</code></pre>\n\n<p>And then if I try to do insmod driver.ko I receive:</p>\n\n<pre><code>module verification failed: signature and/or required key missing - tainting kernel\n</code></pre>\n\n<p>How can I do?</p>\n"}, {"tags": ["c", "compilation"], "comments": [{"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1565094638, "post_id": 57376096, "comment_id": 101236630, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/4260048/c-function-defined-as-int-but-having-no-return-statement-in-the-body-still-compi\" title=\"c function defined as int but having no return statement in the body still compi\">stackoverflow.com/questions/4260048/&hellip;</a>"}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1565094741, "post_id": 57376096, "comment_id": 101236690, "body": "There is also <a href=\"https://stackoverflow.com/questions/7280877/why-and-how-does-gcc-compile-a-function-with-a-missing-return-statement\">this</a>."}], "answers": [{"tags": [], "owner": {"reputation": 8002, "user_id": 1143850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2927fac544c9960cd5433688fe4cae1d?s=128&d=identicon&r=PG", "display_name": "Serge", "link": "https://stackoverflow.com/users/1143850/serge"}, "is_accepted": false, "score": 1, "last_activity_date": 1565096732, "creation_date": 1565096732, "answer_id": 57376784, "question_id": 57376096, "link": "https://stackoverflow.com/questions/57376096/missings-in-a-definition-of-function-which-returns-value-what-type-of-error/57376784#57376784", "title": "Missings in a definition of function which returns value - what type of error?", "body": "<p>This is not considered a bad syntax. It is ok in accordance with the 'c' standard. Therefore it would compile ok, but the results will be unpredictable. </p>\n\n<p>As mentioned in comments, it is just bad programming. Modern compilers can detect such common issues with the programs. So, with <code>gcc -Wall</code> you can get the following diagnostics for missing return statement (control reaches ...) and uninitialized variable.</p>\n\n<pre><code>%&gt; gcc a.c -Wall\n a.c: In function 'foo':\n a.c:1:1: warning: control reaches end of non-void function [-Wreturn-type]\n  int foo () { int x; x=x+2;}\n  ^~~\n a.c:1:22: warning: 'x' is used uninitialized in this function [-Wuninitialized]\n  int foo () { int x; x=x+2;}\n                      ~^~~~\n a.c:1:18: note: 'x' was declared here\n  int foo () { int x; x=x+2;}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1565097558, "post_id": 57376985, "comment_id": 101238437, "body": "The behaviour is not undefined. Only if the return value is used."}, {"owner": {"reputation": 15, "user_id": 11603524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7544c99fa22193a8cd280a07735e50b6?s=128&d=identicon&r=PG&f=1", "display_name": "galik", "link": "https://stackoverflow.com/users/11603524/galik"}, "edited": false, "score": 0, "creation_date": 1565104452, "post_id": 57376985, "comment_id": 101242826, "body": "Would you say, however, that the reason for this undefined behavior will be discovered during semantic analysis ?"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 15, "user_id": 11603524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7544c99fa22193a8cd280a07735e50b6?s=128&d=identicon&r=PG&f=1", "display_name": "galik", "link": "https://stackoverflow.com/users/11603524/galik"}, "edited": false, "score": 0, "creation_date": 1565106321, "post_id": 57376985, "comment_id": 101243926, "body": "@galik no. It is neither. A program having a function like that is a  correct program for as long as the nonexistent return value is ignored."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565112313, "post_id": 57376985, "comment_id": 101246726, "body": "@AnttiHaapala: A program having a function like that and that ignores the return value (and that has no other defects per the C standard) will be <b>accepted</b> by a conforming C implementation, but that does not make it <b>correct</b>. To be correct, a program must conform to its specification. That is, it must correctly perform whatever tasks are required of it and satisfy any other requirements (such as constraints on time and space, possibly constraints on verifiability, and so on)."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565118577, "post_id": 57376985, "comment_id": 101249366, "body": "@AnttiHaapala: Yes, the standard does define it, and the definition is not limited to satisfying the C standard\u2019s syntax and constraints but that it be \u201ccorrect in all other aspects.\u201d Lest you think those \u201c<b>all</b> other aspects\u201d are limited to the contents of the standard, it goes on to say \u201coperating on correct data,\u201d which is clearly outside the source code of the program itself, both in syntax and semantics. So a \u201ccorrect program\u201d must truly be correct in <b>all</b> other aspects, including the expectations of its specification."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1565118727, "post_id": 57376985, "comment_id": 101249431, "body": "@AnttiHaapala: It any case, it is wrong to say a program does not have a semantic error just because it does not violate any constraint of the C standard or because a compiler does not diagnose a problem. If a program\u2019s source code does not mean what its author intended it to mean, the author made a semantic error. A program that prints the sum of two numbers because the author typed &#39;+&#39; when they intended to type &#39;*&#39; has a semantic error."}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 1, "last_activity_date": 1565159069, "last_edit_date": 1565159069, "creation_date": 1565097429, "answer_id": 57376985, "question_id": 57376096, "link": "https://stackoverflow.com/questions/57376096/missings-in-a-definition-of-function-which-returns-value-what-type-of-error/57376985#57376985", "title": "Missings in a definition of function which returns value - what type of error?", "body": "<p>Neither. It is valid C but undefined behavior if the returned value is used by the caller. The C standard 6.9.1/12 (semantics) says:</p>\n\n<blockquote>\n  <p>If the } that terminates a function is reached, and the value of the function call is used by\n  the caller, the behavior is undefined.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 15, "user_id": 11603524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7544c99fa22193a8cd280a07735e50b6?s=128&d=identicon&r=PG&f=1", "display_name": "galik", "link": "https://stackoverflow.com/users/11603524/galik"}, "edited": false, "score": 0, "creation_date": 1565117855, "post_id": 57381148, "comment_id": 101249060, "body": "but suppose other information about the program or its intentions  is not provided  -   is it  necessarily an error which should be discovered during the semantic analysis ?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 15, "user_id": 11603524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7544c99fa22193a8cd280a07735e50b6?s=128&d=identicon&r=PG&f=1", "display_name": "galik", "link": "https://stackoverflow.com/users/11603524/galik"}, "edited": false, "score": 0, "creation_date": 1565118261, "post_id": 57381148, "comment_id": 101249230, "body": "@galik: What is \u201cthe semantic analysis\u201d? A compiler might or might not diagnose the issue."}, {"owner": {"reputation": 15, "user_id": 11603524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7544c99fa22193a8cd280a07735e50b6?s=128&d=identicon&r=PG&f=1", "display_name": "galik", "link": "https://stackoverflow.com/users/11603524/galik"}, "edited": false, "score": 0, "creation_date": 1565118936, "post_id": 57381148, "comment_id": 101249508, "body": "@ Eric Postpischil I mean theoretically. Suppose we only know that the way of defining the function above is false. Is it  necessarily  a semantic error ?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 15, "user_id": 11603524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7544c99fa22193a8cd280a07735e50b6?s=128&d=identicon&r=PG&f=1", "display_name": "galik", "link": "https://stackoverflow.com/users/11603524/galik"}, "edited": false, "score": 0, "creation_date": 1565119121, "post_id": 57381148, "comment_id": 101249578, "body": "@galik: I do not know what \u201cthe way of defining the function above is false\u201d means. Statements are true or false. Ways of defining things are not true or false. If the function does not do what it was intended to do, it is an error. There are formal mathematical/logical systems for verifying that programs conform to specifications, and this function might be proven, in such a system, to fail to comply to its specification."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 15, "user_id": 11603524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7544c99fa22193a8cd280a07735e50b6?s=128&d=identicon&r=PG&f=1", "display_name": "galik", "link": "https://stackoverflow.com/users/11603524/galik"}, "edited": false, "score": 0, "creation_date": 1565120830, "post_id": 57381148, "comment_id": 101250331, "body": "@galik: Some compilers will warn when compiling that function, depending on settings. From the source code of the function alone, a compiler cannot determine there is an error, as leaving a function without returning a value is permitted. A compiler could detect the error when the function is used, if both the use and the function definition are visible to it. Current versions of Clang and GCC do not seem to do this. Given that, the error could be discovered by good testing. If it is not, the program may be deployed with a bug."}, {"owner": {"reputation": 15, "user_id": 11603524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7544c99fa22193a8cd280a07735e50b6?s=128&d=identicon&r=PG&f=1", "display_name": "galik", "link": "https://stackoverflow.com/users/11603524/galik"}, "edited": false, "score": 0, "creation_date": 1565121306, "post_id": 57381148, "comment_id": 101250561, "body": "@ Eric Postpischil so in this case , it is not necessarily a semantic issue ?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 15, "user_id": 11603524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7544c99fa22193a8cd280a07735e50b6?s=128&d=identicon&r=PG&f=1", "display_name": "galik", "link": "https://stackoverflow.com/users/11603524/galik"}, "edited": false, "score": 0, "creation_date": 1565122037, "post_id": 57381148, "comment_id": 101250882, "body": "@galik: Semantics is the branch of linguistics and logic concerned with meaning. A program\u2019s source code is a sequence of symbols (text) that has some meaning. if the meaning is not what the author intended, then there is an error in meaning, which is an error in semantics. Computers are not able to detect all semantic errors, so the fact that a computer fails to diagnose a semantic error does not mean an error is not present. If you are working with some formal definition of semantics, as in a theoretical computer science class, then you will have to specify the definition you are using."}, {"owner": {"reputation": 15, "user_id": 11603524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7544c99fa22193a8cd280a07735e50b6?s=128&d=identicon&r=PG&f=1", "display_name": "galik", "link": "https://stackoverflow.com/users/11603524/galik"}, "edited": false, "score": 0, "creation_date": 1565239787, "post_id": 57381148, "comment_id": 101291817, "body": "to sum up, what type of error it could be: semantic error?  run time error ? or maybe not error ? if I have no indication that the nonexistent return value is really ignored - then I can not determine what type of error it constitutes ?"}], "tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": false, "score": 0, "last_activity_date": 1565112380, "last_edit_date": 1565112380, "creation_date": 1565112045, "answer_id": 57381148, "question_id": 57376096, "link": "https://stackoverflow.com/questions/57376096/missings-in-a-definition-of-function-which-returns-value-what-type-of-error/57381148#57381148", "title": "Missings in a definition of function which returns value - what type of error?", "body": "<p>When the meaning of a program is not what was intended, it is a semantic error.</p>\n\n<p>First, let us correct the function so it initializes <code>x</code>:</p>\n\n<pre><code>int foo(void)\n{\n    int x = 0;\n    x = x + 2;\n}\n</code></pre>\n\n<p>Second, let us suppose the return value of the function is used somewhere. Then C 6.9.1 12 tells us:</p>\n\n<blockquote>\n  <p>Unless otherwise specified, if the <code>}</code> that terminates a function is reached, and the value of the function call is used by the caller, the behavior is undefined.</p>\n</blockquote>\n\n<p>If we further presume that the author did not intend to write a program with undefined behavior and that nothing else, such as the compiler implementation, defines the behavior, then the meaning of the program <code>foo</code> is not what the author intended\u2014they intended it to execute with some defined behavior, but it does not, and therefore there is an error. It is an error in what the source code of the program means, and that is a semantic error.</p>\n"}], "owner": {"reputation": 15, "user_id": 11603524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7544c99fa22193a8cd280a07735e50b6?s=128&d=identicon&r=PG&f=1", "display_name": "galik", "link": "https://stackoverflow.com/users/11603524/galik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1565159069, "creation_date": 1565094531, "last_edit_date": 1565131527, "question_id": 57376096, "link": "https://stackoverflow.com/questions/57376096/missings-in-a-definition-of-function-which-returns-value-what-type-of-error", "title": "Missings in a definition of function which returns value - what type of error?", "body": "<p>Suppose I have the following function definition:</p>\n\n<pre><code>int foo () {\n    int x;\n    x = x + 2;\n}\n</code></pre>\n\n<p>As you can see, this function is declared to return an <code>int</code> value, but there is no <code>return</code> statement, and it also does not get any parameters. </p>\n\n<p>Given this  function as defined above,  what type of error does it constitute - syntactic ? semantic ? run-time ? not type of any error ? </p>\n"}, {"tags": ["c"], "answers": [{"comments": [{"owner": {"reputation": 21832, "user_id": 882051, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f76d986b54e90fa6c431160e9a0796cd?s=128&d=identicon&r=PG", "display_name": "hmakholm left over Monica", "link": "https://stackoverflow.com/users/882051/hmakholm-left-over-monica"}, "edited": false, "score": 0, "creation_date": 1565095393, "post_id": 57376239, "comment_id": 101237092, "body": "In fact I don&#39;t think <i>linkers</i> care much about which characters are used in symbols at all, but <i>assemblers</i> typically allow writing <code>$</code> in symbol names out of the box, so it is often used to create symbols that can&#39;t clash with those of a C program, or other higher level languages."}, {"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 0, "creation_date": 1565095931, "post_id": 57376239, "comment_id": 101237392, "body": "This only answers one of OP\u2019s question \u2014 arguably more interesting is the question about the name mangling on display here."}, {"owner": {"reputation": 198, "user_id": 6952291, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrMfk.jpg?s=128&g=1", "display_name": "Viton Zhang", "link": "https://stackoverflow.com/users/6952291/viton-zhang"}, "edited": false, "score": 0, "creation_date": 1565096836, "post_id": 57376239, "comment_id": 101237965, "body": "@HenningMakholm &quot;An assembler is a type of computer program that interprets software programs written in assembly language into machine language, code and instructions that can be executed by a computer.&quot; I think that the assembler is associated with assembly language not the c language. <a href=\"https://www.techopedia.com/definition/3971/assembler\" rel=\"nofollow noreferrer\">techopedia.com/definition/3971/assembler</a>"}, {"owner": {"reputation": 21832, "user_id": 882051, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f76d986b54e90fa6c431160e9a0796cd?s=128&d=identicon&r=PG", "display_name": "hmakholm left over Monica", "link": "https://stackoverflow.com/users/882051/hmakholm-left-over-monica"}, "reply_to_user": {"reputation": 198, "user_id": 6952291, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrMfk.jpg?s=128&g=1", "display_name": "Viton Zhang", "link": "https://stackoverflow.com/users/6952291/viton-zhang"}, "edited": false, "score": 1, "creation_date": 1565098496, "post_id": 57376239, "comment_id": 101239072, "body": "@Viton, correct. So the object file you&#39;re looking at was probably not produced from C source, but from a hand-written assembly source. (That doesn&#39;t mean the object file can&#39;t be designed to be <i>used</i> by C code)."}, {"owner": {"reputation": 2385, "user_id": 10306503, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c5d6c9b08dd045f4876591d703bda6?s=128&d=identicon&r=PG", "display_name": "mosvy", "link": "https://stackoverflow.com/users/10306503/mosvy"}, "edited": false, "score": 0, "creation_date": 1565104565, "post_id": 57376239, "comment_id": 101242897, "body": "@HenningMakholm how come they can&#39;t clash with C symbols? though not exactly standard, many (most?) C compilers allow <code>$</code> in identifiers. In fact, those identifiers are defined at C preprocessor level, look <a href=\"https://github.com/apple/darwin-xnu/blob/a449c6a3b8014d9406c2ddbdc81795da24aa7443/bsd/sys/cdefs.h#L675\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 2385, "user_id": 10306503, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c5d6c9b08dd045f4876591d703bda6?s=128&d=identicon&r=PG", "display_name": "mosvy", "link": "https://stackoverflow.com/users/10306503/mosvy"}, "edited": false, "score": 0, "creation_date": 1565105258, "post_id": 57376239, "comment_id": 101243274, "body": "Correction to my last sentence: the <code>$</code> is used in a string literal there, but those aliases/symbols are still callable from <code>C</code>."}, {"owner": {"reputation": 21832, "user_id": 882051, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f76d986b54e90fa6c431160e9a0796cd?s=128&d=identicon&r=PG", "display_name": "hmakholm left over Monica", "link": "https://stackoverflow.com/users/882051/hmakholm-left-over-monica"}, "reply_to_user": {"reputation": 2385, "user_id": 10306503, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c5d6c9b08dd045f4876591d703bda6?s=128&d=identicon&r=PG", "display_name": "mosvy", "link": "https://stackoverflow.com/users/10306503/mosvy"}, "edited": false, "score": 0, "creation_date": 1565105303, "post_id": 57376239, "comment_id": 101243300, "body": "@mosvy: The point is that they&#39;re not part of the namespace a C programmer rightly feels is his to define names in."}, {"owner": {"reputation": 2385, "user_id": 10306503, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c5d6c9b08dd045f4876591d703bda6?s=128&d=identicon&r=PG", "display_name": "mosvy", "link": "https://stackoverflow.com/users/10306503/mosvy"}, "edited": false, "score": 0, "creation_date": 1565105359, "post_id": 57376239, "comment_id": 101243332, "body": "Right, I was commenting on your 1st comment, not on the answer, which is OK."}], "tags": [], "owner": {"reputation": 21832, "user_id": 882051, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f76d986b54e90fa6c431160e9a0796cd?s=128&d=identicon&r=PG", "display_name": "hmakholm left over Monica", "link": "https://stackoverflow.com/users/882051/hmakholm-left-over-monica"}, "is_accepted": false, "score": 1, "last_activity_date": 1565094962, "creation_date": 1565094962, "answer_id": 57376239, "question_id": 57376016, "link": "https://stackoverflow.com/questions/57376016/whats-the-meaning-of-in-the-symbol-creatnocancel/57376239#57376239", "title": "What&#39;s the meaning of &quot;$&quot; in the symbol &quot;_creat$NOCANCEL&quot;?", "body": "<p>There is no particular meaning. The dollar sign counts as a letter in linker symbols (just like an underscore does), so they are just symbols someone has chosen to name that way. Probably they deliberately chose to include a dollar sign to reduce the risk of colliding with something that the programmer could have defined in C.</p>\n"}], "owner": {"reputation": 198, "user_id": 6952291, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrMfk.jpg?s=128&g=1", "display_name": "Viton Zhang", "link": "https://stackoverflow.com/users/6952291/viton-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1565096819, "creation_date": 1565094280, "last_edit_date": 1565096819, "question_id": 57376016, "link": "https://stackoverflow.com/questions/57376016/whats-the-meaning-of-in-the-symbol-creatnocancel", "title": "What&#39;s the meaning of &quot;$&quot; in the symbol &quot;_creat$NOCANCEL&quot;?", "body": "<p>I got the output in terminal when I run the command \n<code>nm -gU /usr/lib/system/libsystem_c.dylib</code>:</p>\n\n<pre><code>000000000007cb4c T ___opendir2\n000000000002a944 T ___opendir2$INODE64\n00000000000141d0 T ___ovfl_delete\n\n\n000000000003a9e1 T _fdopen\n000000000007af54 T _fdopen$DARWIN_EXTSN\n</code></pre>\n\n<ol>\n<li>What's the meaning of <code>$</code> in <code>___opendir2$INODE64</code>?</li>\n<li>What's the meaning of <code>INODE64</code> in <code>___opendir2$INODE64</code>?</li>\n</ol>\n\n<p>When looking at the symbols of <code>libdispatch</code>(Apple grand central dispatch): <a href=\"https://ios.ddf.net/symbols/D1654155-0D40-3E77-967B-D529061C87A4\" rel=\"nofollow noreferrer\">libdispatch symbols</a>, I found three symbols with the same prefix: <code>_dispatch_main_queue_callback_4CF</code></p>\n\n<pre><code>_dispatch_main_queue_callback_4CF$VARIANT$mp\n_dispatch_main_queue_callback_4CF\n_dispatch_main_queue_callback_4CF$VARIANT$armv81\n</code></pre>\n\n<ol start=\"3\">\n<li>Are these three symbols generated by the same source?</li>\n</ol>\n"}, {"tags": ["c", "xml", "parsing", "expat-parser"], "comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1565094822, "post_id": 57375894, "comment_id": 101236746, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/12573816/what-is-an-undefined-reference-unresolved-external-symbol-error-and-how-do-i-fix\">What is an undefined reference/unresolved external symbol error and how do I fix it?</a>"}, {"owner": {"reputation": 763, "user_id": 4429205, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-F-qS3dCm8i0/AAAAAAAAAAI/AAAAAAAAAGE/8trSZu5tpUY/photo.jpg?sz=128", "display_name": "Michal \u0160tein", "link": "https://stackoverflow.com/users/4429205/michal-%c5%a0tein"}, "edited": false, "score": 1, "creation_date": 1565101174, "post_id": 57375894, "comment_id": 101240874, "body": "This is more specific. I think we would confuse the hell out of this guy if we marked this as a duplicate."}, {"owner": {"reputation": 275558, "user_id": 522444, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/16b6783e9b99b1199c75761eaf5c0685?s=128&d=identicon&r=PG", "display_name": "Hovercraft Full Of Eels", "link": "https://stackoverflow.com/users/522444/hovercraft-full-of-eels"}, "edited": false, "score": 0, "creation_date": 1565101335, "post_id": 57375894, "comment_id": 101240979, "body": "But he&#39;s confusing me by tagging this as a <a href=\"https://stackoverflow.com/questions/tagged/java\">java</a> question. Please help me: where is the Java code and how does this question relate to Java?"}, {"owner": {"reputation": 227, "user_id": 6844163, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dD0t6.png?s=128&g=1", "display_name": "Ashwant Manikoth", "link": "https://stackoverflow.com/users/6844163/ashwant-manikoth"}, "edited": false, "score": 0, "creation_date": 1565160818, "post_id": 57375894, "comment_id": 101259888, "body": "okay i have removed it."}], "answers": [{"comments": [{"owner": {"reputation": 227, "user_id": 6844163, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dD0t6.png?s=128&g=1", "display_name": "Ashwant Manikoth", "link": "https://stackoverflow.com/users/6844163/ashwant-manikoth"}, "edited": false, "score": 0, "creation_date": 1565266052, "post_id": 57378387, "comment_id": 101304405, "body": "is it{{   gcc filename.c -llibexpat -LC:\\Users\\admin\\Desktop\\Expat\\bin }} is this right way?"}], "tags": [], "owner": {"reputation": 763, "user_id": 4429205, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-F-qS3dCm8i0/AAAAAAAAAAI/AAAAAAAAAGE/8trSZu5tpUY/photo.jpg?sz=128", "display_name": "Michal \u0160tein", "link": "https://stackoverflow.com/users/4429205/michal-%c5%a0tein"}, "is_accepted": true, "score": 1, "last_activity_date": 1565101855, "creation_date": 1565101855, "answer_id": 57378387, "question_id": 57375894, "link": "https://stackoverflow.com/questions/57375894/how-to-compile-an-expat-xml-parsing-in-c-program-and-where-to-install-the-expat/57378387#57378387", "title": "how to compile an expat xml parsing in c Program? and where to install the expat. where to put the files in cygwin compiler", "body": "<p>You seem to know that you have to do <code>-lexpat</code> so that the header files actually link to something, but you forgot to add Expat to the link path. Add this command line option: <code>-L /path/to/your/expat/lib/directory</code>. For the WinMain error, try adding <code>-Wl,-subsystem,console</code>. Hope it helps!</p>\n"}, {"tags": [], "owner": {"reputation": 227, "user_id": 6844163, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dD0t6.png?s=128&g=1", "display_name": "Ashwant Manikoth", "link": "https://stackoverflow.com/users/6844163/ashwant-manikoth"}, "is_accepted": false, "score": 0, "last_activity_date": 1565608751, "creation_date": 1565608751, "answer_id": 57460202, "question_id": 57375894, "link": "https://stackoverflow.com/questions/57375894/how-to-compile-an-expat-xml-parsing-in-c-program-and-where-to-install-the-expat/57460202#57460202", "title": "how to compile an expat xml parsing in c Program? and where to install the expat. where to put the files in cygwin compiler", "body": "<p>Mingw provides expat libraries, so while installing itself we must opt the option of expat to be installed.</p>\n\n<p><code>gcc filename.c -llibexpat</code> is enough to compile the code without error.\nno other path including isn't necessary.</p>\n"}], "owner": {"reputation": 227, "user_id": 6844163, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dD0t6.png?s=128&g=1", "display_name": "Ashwant Manikoth", "link": "https://stackoverflow.com/users/6844163/ashwant-manikoth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 0, "accepted_answer_id": 57378387, "answer_count": 2, "score": 0, "last_activity_date": 1565608751, "creation_date": 1565093891, "last_edit_date": 1565160603, "question_id": 57375894, "link": "https://stackoverflow.com/questions/57375894/how-to-compile-an-expat-xml-parsing-in-c-program-and-where-to-install-the-expat", "title": "how to compile an expat xml parsing in c Program? and where to install the expat. where to put the files in cygwin compiler", "body": "<p>This is my first time using external headers and i have no idea about expat.\nExpat official website is not useful for a beginner.\ni need to compile a XML parser code in C using expat.h.\ni have downloaded expat files and included the path in header file.\nbut while compiling i get error.\nin windows platform\n<a href=\"https://i.stack.imgur.com/oHkm3.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/oHkm3.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/nlGpK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nlGpK.png\" alt=\"enter image description here\"></a></p>\n\n<pre><code>    #include \"C:\\Program Files (x86)\\Expat 2.2.7\\Source\\lib\\expat.h\"\n    #include &lt;stdlib.h&gt;\n    #include &lt;stdio.h&gt;\n    #include &lt;string.h&gt;\n\n     int parse_xml(char *buff)\n     {\n    FILE *fp;\n    fp = fopen(\"config.xml\", \"r\");\n    if(fp == NULL)\n    {\n        printf(\"Failed to open file\\n\");\n        return 1;\n    }\n\n   /* Obtain the file size. */\n    fseek (fp, 0, SEEK_END);\n    size_t file_size = ftell(fp);\n    rewind(fp);\n\n    XML_Parser parser = XML_ParserCreate(NULL);\n    int done;\n    memset(buff, 0, sizeof(buff));\n\n    do\n    {\n        size_t len = fread(buff, 1, file_size, fp);\n        done = len &lt; sizeof(buff);\n\n        if(XML_Parse(parser, buff, len, done) == XML_STATUS_ERROR)\n        {\n            printf(\"%s at line %d\\n\", XML_ErrorString(XML_GetErrorCode(parser)),\n                                      XML_GetCurrentLineNumber(parser));\n            return 1;\n        }\n    }\n    while(!done);\n\n    fclose(fp);\n    XML_ParserFree(parser);\n\n    return 0;\n}\n</code></pre>\n\n<p>this is the code and the path is where the expat.h is located after installation.</p>\n\n<p>xml code</p>\n\n<pre><code>`&lt;catalog&gt;\n   &lt;book id=\"bk101\"&gt;\n      &lt;author&gt;Gambardella, Matthew&lt;/author&gt;\n      &lt;title&gt;XML Developer's Guide&lt;/title&gt;\n      &lt;genre&gt;Computer&lt;/genre&gt;\n      &lt;price&gt;44.95&lt;/price&gt;\n      &lt;publish_date&gt;2000-10-01&lt;/publish_date&gt;\n      &lt;description&gt;An in-depth look at creating applications\n      with XML.&lt;/description&gt;\n   &lt;/book&gt;\n   &lt;book id=\"bk102\"&gt;\n      &lt;author&gt;Ralls, Kim&lt;/author&gt;\n      &lt;title&gt;Midnight Rain&lt;/title&gt;\n      &lt;genre&gt;Fantasy&lt;/genre&gt;\n      &lt;price&gt;5.95&lt;/price&gt;\n      &lt;publish_date&gt;2000-12-16&lt;/publish_date&gt;\n      &lt;description&gt;A former architect battles corporate zombies,\n      an evil sorceress, and her own childhood to become queen\n      of the world.&lt;/description&gt;\n   &lt;/book&gt;\n   &lt;book id=\"bk103\"&gt;\n      &lt;author&gt;Corets, Eva&lt;/author&gt;\n      &lt;title&gt;Maeve Ascendant&lt;/title&gt;\n      &lt;genre&gt;Fantasy&lt;/genre&gt;\n      &lt;price&gt;5.95&lt;/price&gt;\n      &lt;publish_date&gt;2000-11-17&lt;/publish_date&gt;\n      &lt;description&gt;After the collapse of a nanotechnology\n      society in England, the young survivors lay the\n      foundation for a new society.&lt;/description&gt;\n   &lt;/book&gt;\n&lt;/catalog&gt;`\n</code></pre>\n\n<p>Please help!</p>\n"}, {"tags": ["c", "linux", "centos7"], "comments": [{"owner": {"reputation": 33642, "user_id": 620097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/820980fd43f2607a815c1f3dbfe152cc?s=128&d=identicon&r=PG", "display_name": "shellter", "link": "https://stackoverflow.com/users/620097/shellter"}, "edited": false, "score": 1, "creation_date": 1565093920, "post_id": 57375813, "comment_id": 101236222, "body": "please edit your Q to include the smallest amount of code that demonstrates your problem. Good luck."}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "edited": false, "score": 1, "creation_date": 1565095292, "post_id": 57375813, "comment_id": 101237029, "body": "What do you expect to get from <code>inet_addr(&quot;x.x.x.x&quot;);</code>?"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 2, "creation_date": 1565096166, "post_id": 57375813, "comment_id": 101237531, "body": "Did you read the <a href=\"http://man7.org/linux/man-pages/man2/connect.2.html\" rel=\"nofollow noreferrer\">Linux <code>connect</code> man page</a> to see why <code>connect</code> can fail with <code>errno == EACCESS</code>?  And eliminate those possibilities?"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 1, "creation_date": 1565112845, "post_id": 57375813, "comment_id": 101246981, "body": "OT: regarding: <code>printf(&quot;connection with the server failed with error: %d\\n&quot;,errno);</code> and <code>printf(&quot;socket creation failed...\\n&quot;);</code>   This doesn&#39;t tell the user the reason for the failure.  Suggest: calling <code>perror( &quot;your error message&quot; );</code>  as this outputs to <code>stderr</code> both your error message AND the text reason the system thinks the error occurred."}], "owner": {"reputation": 41, "user_id": 5877472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f89a2ae3785b7038aa48d25e3b89181f?s=128&d=identicon&r=PG&f=1", "display_name": "Supriya", "link": "https://stackoverflow.com/users/5877472/supriya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565095213, "creation_date": 1565093588, "last_edit_date": 1565095213, "question_id": 57375813, "link": "https://stackoverflow.com/questions/57375813/can-a-process-be-capable-of-creating-a-new-socket-but-not-have-the-permission-to", "title": "Can a process be capable of creating a new socket but not have the permission to access it?", "body": "<p>I am running a client code in CentOS. My process is able to create a socket successfully, but a bind() or connect() call to the socket return EACCES error. Verified that the O_RDWR flag is set on the socket. I am running the process as root</p>\n\n<pre><code>#define SA struct sockaddr \n\nint sockfd, connfd; \nstruct sockaddr_in servaddr, cli; \n\n// socket create and verification \nsockfd = socket(AF_INET, SOCK_STREAM, 0); \nif (sockfd == -1) { \n    printf(\"socket creation failed...\\n\"); \n    exit(0); \n} \nelse\n    printf(\"Socket successfully created..\\n\"); \nbzero(&amp;servaddr, sizeof(servaddr)); \n\n// assign IP, PORT \nservaddr.sin_family = AF_INET; \nservaddr.sin_addr.s_addr = inet_addr(\"x.x.x.x\"); \nservaddr.sin_port = htons(x); \n\n// connect the client socket to server socket \nif (connect(sockfd, (SA*)&amp;servaddr, sizeof(servaddr)) != 0) { \n    printf(\"connection with the server failed with error: %d\\n\",errno); \n    exit(0); \n} \nelse printf(\"connected to the server..\\n\");\n</code></pre>\n\n<p>Output:</p>\n\n<pre>Socket successfully created\nconnection with the server failed with error:13</pre>\n"}, {"tags": ["c", "tensorflow", "c-api"], "comments": [{"owner": {"reputation": 440, "user_id": 11160943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1165d73361bd3ff2b3e04a2c486f5d8?s=128&d=identicon&r=PG&f=1", "display_name": "Fisa", "link": "https://stackoverflow.com/users/11160943/fisa"}, "edited": false, "score": 0, "creation_date": 1598985435, "post_id": 57375218, "comment_id": 112631447, "body": "This is the answer <a href=\"https://stackoverflow.com/questions/63066248/tensorflow-c-api-logging-setting\" title=\"tensorflow c api logging setting\">stackoverflow.com/questions/63066248/&hellip;</a>"}], "owner": {"reputation": 11, "user_id": 2513214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/031f0882f8d61fd3856cc2b8e9898301?s=128&d=identicon&r=PG", "display_name": "Hikaru", "link": "https://stackoverflow.com/users/2513214/hikaru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 154, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1565106991, "creation_date": 1565091550, "last_edit_date": 1565106991, "question_id": 57375218, "link": "https://stackoverflow.com/questions/57375218/how-to-disable-warnings-in-tensorflow-written-to-output-when-using-the-c-api-of", "title": "How to disable warnings in tensorflow written to output when using the c api of tensorflow", "body": "<p>I use TensorFlow 1.13.1 by integrating it using the C-API (my program is in C++). Tensor flow writes a warning to the std output, and I want to suppress this warning as I a need the std output and std error under my control, not wanting tensorflow to write on it. How can I suppress it?</p>\n\n<p>I already tried to set the environment variable TF_CPP_MIN_LOG_LEVEL='3' but this seems not to work in TensorFlow 1.13.1 (<a href=\"https://github.com/tensorflow/tensorflow/issues/26348\" rel=\"nofollow noreferrer\">https://github.com/tensorflow/tensorflow/issues/26348</a>) But the solution in the link seems not to work for C API</p>\n\n<p>Hope someone can give me a hint on how I could solve this.</p>\n"}, {"tags": ["c", "udp", "raw-sockets"], "comments": [{"owner": {"reputation": 310, "user_id": 6612018, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a3473d948039560d8d4ca42c9de7b382?s=128&d=identicon&r=PG&f=1", "display_name": "Athul Sukumaran", "link": "https://stackoverflow.com/users/6612018/athul-sukumaran"}, "reply_to_user": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1565092053, "post_id": 57375198, "comment_id": 101235092, "body": "I was trying to fix it desperately."}, {"owner": {"reputation": 310, "user_id": 6612018, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a3473d948039560d8d4ca42c9de7b382?s=128&d=identicon&r=PG&f=1", "display_name": "Athul Sukumaran", "link": "https://stackoverflow.com/users/6612018/athul-sukumaran"}, "reply_to_user": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1565092163, "post_id": 57375198, "comment_id": 101235171, "body": "@ikegami Edited. Please check now."}, {"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1565092524, "post_id": 57375198, "comment_id": 101235395, "body": "Sorry, tired. I think it&#39;s because you are weirdly using an array. I think <code>sendto(sockfd, disc_req, sizeof(disc_req),      MSG_CONFIRM, (const struct sockaddr *) &amp;servaddr,          sizeof(servaddr));</code> will address the problem"}, {"owner": {"reputation": 310, "user_id": 6612018, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a3473d948039560d8d4ca42c9de7b382?s=128&d=identicon&r=PG&f=1", "display_name": "Athul Sukumaran", "link": "https://stackoverflow.com/users/6612018/athul-sukumaran"}, "reply_to_user": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1565092646, "post_id": 57375198, "comment_id": 101235467, "body": "I am using this array temporarily. It will be changed to something of size ~10. Finally, I need to send array contents completely over socket"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 1, "creation_date": 1565099440, "post_id": 57375198, "comment_id": 101239717, "body": "What is the reason to use RAW sockets? How do you create your socket?"}], "answers": [{"comments": [{"owner": {"reputation": 310, "user_id": 6612018, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a3473d948039560d8d4ca42c9de7b382?s=128&d=identicon&r=PG&f=1", "display_name": "Athul Sukumaran", "link": "https://stackoverflow.com/users/6612018/athul-sukumaran"}, "edited": false, "score": 0, "creation_date": 1565155006, "post_id": 57378212, "comment_id": 101257913, "body": "Thanks. How do I send the complete array over socket and not just disc_req[0]? I wanted to sniff it in wireshark in the exact same order."}, {"owner": {"reputation": 310, "user_id": 6612018, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a3473d948039560d8d4ca42c9de7b382?s=128&d=identicon&r=PG&f=1", "display_name": "Athul Sukumaran", "link": "https://stackoverflow.com/users/6612018/athul-sukumaran"}, "edited": false, "score": 0, "creation_date": 1565178052, "post_id": 57378212, "comment_id": 101268929, "body": "Also, can you explain how I can get back the array from char * type in recvfrom()?"}, {"owner": {"reputation": 314, "user_id": 11751217, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eWsMd.jpg?s=128&g=1", "display_name": "abonneville", "link": "https://stackoverflow.com/users/11751217/abonneville"}, "reply_to_user": {"reputation": 310, "user_id": 6612018, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a3473d948039560d8d4ca42c9de7b382?s=128&d=identicon&r=PG&f=1", "display_name": "Athul Sukumaran", "link": "https://stackoverflow.com/users/6612018/athul-sukumaran"}, "edited": false, "score": 0, "creation_date": 1565192693, "post_id": 57378212, "comment_id": 101277692, "body": "The &amp; on disc_req[0] is the address of the first element, and sizeof (disc_req) is the entire length of the array."}, {"owner": {"reputation": 314, "user_id": 11751217, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eWsMd.jpg?s=128&g=1", "display_name": "abonneville", "link": "https://stackoverflow.com/users/11751217/abonneville"}, "reply_to_user": {"reputation": 310, "user_id": 6612018, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a3473d948039560d8d4ca42c9de7b382?s=128&d=identicon&r=PG&f=1", "display_name": "Athul Sukumaran", "link": "https://stackoverflow.com/users/6612018/athul-sukumaran"}, "edited": false, "score": 0, "creation_date": 1565192735, "post_id": 57378212, "comment_id": 101277718, "body": "I edited the answer to include how to receive the packet"}], "tags": [], "owner": {"reputation": 314, "user_id": 11751217, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eWsMd.jpg?s=128&g=1", "display_name": "abonneville", "link": "https://stackoverflow.com/users/11751217/abonneville"}, "is_accepted": true, "score": 1, "last_activity_date": 1565192603, "last_edit_date": 1565192603, "creation_date": 1565101257, "answer_id": 57378212, "question_id": 57375198, "link": "https://stackoverflow.com/questions/57375198/populate-udp-payload-in-socket-programming-with-my-own-structure/57378212#57378212", "title": "Populate UDP payload in socket programming with my own structure?", "body": "<p>The different content you are observing may be due to the sender and receiver having different endianess (host vs network). If so you will want to use <code>hton...()</code> and <code>ntoh...()</code> when working with multi-byte values. </p>\n\n<p>In general, when you send an array or struct over UDP, treat it like a byte array.</p>\n\n<p>Create a UDP socket, not a RAW socket:</p>\n\n<pre><code>sockfd = socket( AF_INET, SOCK_DGRAM, IPPROTO_UDP );\n</code></pre>\n\n<p>Setup your destination address using the method you prefer (i.e. <code>gethostbyname()</code> )</p>\n\n<p>Then send the payload:</p>\n\n<pre><code>sendto( sockfd, ( char* ) &amp;disc_req[0], sizeof( disc_req ), MSG_CONFIRM, (const struct sockaddr *) &amp;servaddr, sizeof(servaddr));\n</code></pre>\n\n<p>To receive the payload:</p>\n\n<pre><code>recvfrom( sockfd, ( char* ) &amp;disc_req[0], sizeof( disc_req ), 0, (const struct sockaddr *) &amp;servaddr, sizeof(servaddr) );\n</code></pre>\n\n<p>The following is a complete example sending an NTP packet using UDP:</p>\n\n<p><a href=\"https://lettier.github.io/posts/2016-04-26-lets-make-a-ntp-client-in-c.html\" rel=\"nofollow noreferrer\">https://lettier.github.io/posts/2016-04-26-lets-make-a-ntp-client-in-c.html</a></p>\n"}], "owner": {"reputation": 310, "user_id": 6612018, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a3473d948039560d8d4ca42c9de7b382?s=128&d=identicon&r=PG&f=1", "display_name": "Athul Sukumaran", "link": "https://stackoverflow.com/users/6612018/athul-sukumaran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 57378212, "answer_count": 1, "score": 1, "last_activity_date": 1565192603, "creation_date": 1565091500, "last_edit_date": 1565092458, "question_id": 57375198, "link": "https://stackoverflow.com/questions/57375198/populate-udp-payload-in-socket-programming-with-my-own-structure", "title": "Populate UDP payload in socket programming with my own structure?", "body": "<p>I want to send a variable of custom struct over udp sockets using sendto(). This struct contains UDP payload. When I googled a bit, I found that it is possible to create raw socket in c using the flag, SOCK_RAW, while creating the socket. But I think, then i will have to populate ip header as well as udp header too. I want to avoid that.</p>\n\n<p>But when I tried sending the custom structure over socket as mentioned above, I receive different data ( not the structure contents) when sniffed with wireshark. Please help.</p>\n\n<p>I tried changing the struct to normal uint32_t variable and used bit shifting operations to populate this variable. I confirmed that this variable has exactly the contents that I intended to add to it. </p>\n\n<p>But again, I am not able to send this too over sockets. Wireshark displays different content. Is it because in sendto(), we provide the address of the buffer and not its value?</p>\n\n<pre><code>uint32_t disc_req[1];\n\n//disc_req is populated with bit shift operations in the following function\ncreate_discovery_req(disc_req);\n\n//now disc_req has exactly the required binary format - I confirmed this  \n\n// But the following sendto() sends different data. Confirmed over wireshark.  \nsendto(sockfd, &amp;disc_req, sizeof(disc_req), \n    MSG_CONFIRM, (const struct sockaddr *) &amp;servaddr, \n        sizeof(servaddr)); \n</code></pre>\n\n<p>Expeced output is value of disc_req sent over socket and the same captured on wireshark. But the actual value of disc_req is something different.</p>\n"}, {"tags": ["c", "memory-management", "memory-leaks", "scope", "c-strings"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1565090680, "post_id": 57374898, "comment_id": 101234348, "body": "&quot;the char* is not being returned from function.&quot; You make this conclusion based on what evidence?"}, {"owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "edited": false, "score": 1, "creation_date": 1565090683, "post_id": 57374898, "comment_id": 101234351, "body": "What do you think <code>result=answer;</code> does in <code>phoneNo</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 11889240, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-E_e0M4JuQHo/AAAAAAAAAAI/AAAAAAAAAA0/gB-PLhCC46Y/photo.jpg?sz=128", "display_name": "vikas damdhare", "link": "https://stackoverflow.com/users/11889240/vikas-damdhare"}, "edited": false, "score": 0, "creation_date": 1565092404, "post_id": 57374954, "comment_id": 101235321, "body": "It would be helpful if you clarify , &#39;Use the allocated dynamically array for processing instead of the local array answer.&#39; or else post the corrected code"}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "reply_to_user": {"reputation": 13, "user_id": 11889240, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-E_e0M4JuQHo/AAAAAAAAAAI/AAAAAAAAAA0/gB-PLhCC46Y/photo.jpg?sz=128", "display_name": "vikas damdhare", "link": "https://stackoverflow.com/users/11889240/vikas-damdhare"}, "edited": false, "score": 0, "creation_date": 1565092480, "post_id": 57374954, "comment_id": 101235370, "body": "@vikasdamdhare Just remove the declarations of str and answer."}], "tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": true, "score": 1, "last_activity_date": 1565092566, "last_edit_date": 1565092566, "creation_date": 1565090725, "answer_id": 57374954, "question_id": 57374898, "link": "https://stackoverflow.com/questions/57374898/is-there-any-problem-while-returning-the-char-pointer-from-function/57374954#57374954", "title": "Is there any problem while returning the &quot;char pointer&quot; from function", "body": "<p>This code snippet</p>\n\n<pre><code>char answer[100];\nchar * result;\nresult = ( char* ) malloc(100*sizeof(char));\nresult=answer;\n</code></pre>\n\n<p>has a memory leak because the address of the allocated memory is lost due to this statement</p>\n\n<pre><code>result=answer;\n</code></pre>\n\n<p>Now the pointer <code>result</code> points to the local array <code>answer</code> and returned from the function that results in undefined behavior because the array will not be alive after exiting the function.</p>\n\n<p>Use the allocated dynamically array for processing instead of the local array <code>answer</code>.</p>\n\n<p>Pay attention to that instead of this compound if statement</p>\n\n<pre><code>if(str[i]=='1'||str[i]=='2'||str[i]=='3'||str[i]=='4'||str[i]=='5'||str[i]=='6'||str[i]=='7'||str[i]=='8'||str[i]=='9'||str[i]=='0')\n</code></pre>\n\n<p>it is much better to write</p>\n\n<pre><code>if ( isdigit( ( unsigned char )str[i] ) )\n</code></pre>\n\n<p>And the function shall be declared like</p>\n\n<pre><code>char* phoneNo(const char *strpass);\n</code></pre>\n\n<p>that is its parameter must have the qualifier <code>const</code>.</p>\n\n<p>I would write the function the following way as it is shown in the demonstrative program.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;ctype.h&gt;\n\nchar * phoneNo( const char *s )\n{\n    const size_t GROUP_SIZE = 3;\n\n    size_t digits_count = 0;\n\n    for ( const char *p = s; *p; ++p )\n    {\n        if ( isdigit( ( unsigned char )*p ) ) ++digits_count;\n    }\n\n    char *result = malloc( digits_count + digits_count / GROUP_SIZE + sizeof( ( char )'\\0' ) );\n\n    size_t i = 0;\n\n    for ( size_t k = 0; *s; ++s )\n    {\n        if ( isdigit( ( unsigned char )*s ) )\n        {\n            if ( k == GROUP_SIZE )\n            {\n                if ( i != 0 )\n                {\n                    result[i++] = '-';\n                }\n                k = 0;\n            }\n\n            result[i++] = *s;\n            ++k;\n        }\n    }\n\n    result[i] = '\\0';\n\n    return result;\n}\n\nint main(void) \n{\n    const char *s = \"123456789\";\n\n    char *result = phoneNo( s );\n\n    puts( result );\n\n    free( result );\n\n    s = \"12\\t34567\\t89\";\n\n    result = phoneNo( s );\n\n    puts( result );\n\n    free( result );\n\n    return 0;\n}\n</code></pre>\n\n<p>The program output is</p>\n\n<pre><code>123-456-789\n123-456-789\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 0, "last_activity_date": 1565090738, "creation_date": 1565090738, "answer_id": 57374958, "question_id": 57374898, "link": "https://stackoverflow.com/questions/57374898/is-there-any-problem-while-returning-the-char-pointer-from-function/57374958#57374958", "title": "Is there any problem while returning the &quot;char pointer&quot; from function", "body": "<p>First you allocate memory for <code>result</code>, then in the next line <code>result=answer;</code> you immediately have it point elsewhere, creating a memory leak while instead pointing at a local variable. This is the bug.</p>\n"}], "owner": {"reputation": 13, "user_id": 11889240, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-E_e0M4JuQHo/AAAAAAAAAAI/AAAAAAAAAA0/gB-PLhCC46Y/photo.jpg?sz=128", "display_name": "vikas damdhare", "link": "https://stackoverflow.com/users/11889240/vikas-damdhare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 57374954, "answer_count": 2, "score": 1, "last_activity_date": 1565092592, "creation_date": 1565090523, "last_edit_date": 1565092592, "question_id": 57374898, "link": "https://stackoverflow.com/questions/57374898/is-there-any-problem-while-returning-the-char-pointer-from-function", "title": "Is there any problem while returning the &quot;char pointer&quot; from function", "body": "<p>The code below is expected to return a string containing only numbers from an user entered string.</p>\n\n<p>Also the returned string should group the numbers in three digits and put a '-' between them.</p>\n\n<p>Everything runs fine, code compiles without any error, but the <code>char*</code> is not being returned from function.</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;string.h&gt;\n#include&lt;stdlib.h&gt;\n\nchar* phoneNo(char*); \n\nvoid main(){\n\n    char str[100];\n    char *strpass = str;\n\n    printf(\"Enter the string: \");\n    fgets(str,100,stdin);\n\n    printf(\"Entered stringis: %s\\n\",str);\n\n    char *result = phoneNo(strpass);\n    printf(\"Returned char* is: %s\\n\",result);\n}\n\nchar* phoneNo(char *strpass){\n\n    char str[100];\n    strcpy(str,strpass);\n    printf(\"Char[] in Function: %s\",str);\n\n    char answer[100];\n    char * result;\n    result = ( char* ) malloc(100*sizeof(char));\n    result=answer;\n    //printf(\"Char* pointed to Char[]: %s\\n\",result);\n\n    int i=0;\n    int j=0;\n    int k=3;\n\n    while(str[i]!='\\0'){\n\n        if(str[i]=='1'||str[i]=='2'||str[i]=='3'||str[i]=='4'||str[i]=='5'||str[i]=='6'||str[i]=='7'||str[i]=='8'||str[i]=='9'||str[i]=='0')\n        {\n\n\n            if(j==0){\n\n                answer[j]=str[i];\n                answer[j+1]='\\0';\n                j++;\n                i++;\n                continue;\n            }\n\n            if(j==k){\n                answer[j]='-';\n                answer[j+1]='\\0';\n                j++;\n                k+=4;\n            }else{\n                answer[j]=str[i];\n                answer[j+1]='\\0';\n                j++;\n                i++;\n            }\n        }\n        else\n            i++;\n    }\n    printf(\"Char* to be returned: %s\\n\",result);\n\n    return (char *)result;\n}\n</code></pre>\n"}, {"tags": ["c", "multithreading", "concurrency", "pthreads", "memory-model"], "comments": [{"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 0, "creation_date": 1565092159, "post_id": 57374847, "comment_id": 101235169, "body": "As one of the answers in the <i>similar</i> question you point out says, thread utilities (such as those provided in <i>Boost</i>.) are wrappers of thread services provided by the operating system.  And, It is not the compiler that orders thread execution. The compiler, at compile time simply creates the machine code.  It is the operating system during run-time that orders thread execution and allocates time-slices for each thread in due time.  There are several links <i><a href=\"https://stackoverflow.com/a/19324717/645128\">included in this post</a></i> that may help to expand your understanding of threads in general."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1565559076, "post_id": 57374847, "comment_id": 101382055, "body": "&quot;<i>I understand that there is no data race because</i> (...)&quot; In my Q <a href=\"https://stackoverflow.com/q/56673990/963864\">What formally guarantees that reads don&#39;t see a write (with race condition) in other threads</a> the consensus was that <b><a href=\"https://stackoverflow.com/questions/56673990/what-formally-guarantees-that-reads-dont-see-a-write-with-race-condition-in-o#comment99915442_56673990\">there is no such guarantee</a></b> (9 upvotes for that claim!)"}], "answers": [{"comments": [{"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 1, "creation_date": 1565128840, "post_id": 57380520, "comment_id": 101253124, "body": "Re, &quot;...the idea that the compiler is capricious...&quot; I&#39;ve been burned by a capricious compiler: A bug, subtle enough to go undetected in testing, appeared in our product when we started using a new version of GCC. Our code used Undefined Behavior: We tested the result of an integer addition to see if it overflowed. Older versions of the compiler optimized the code as if the hardware would do what the hardware actually does in that case. New compiler said, Oh! UB! I can assume that overflow never happens, and that branch of the code therefore is unreachable. It <i>silently</i> threw it away."}, {"owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "reply_to_user": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1565129885, "post_id": 57380520, "comment_id": 101253389, "body": "It is a sad turn.  In the 90s the WATCOM compiler was one of these; I had to work with it doing OS work, and it was just awful.   Mercifully gcc kicked it out to the street a generation ago.   Now, hopefully, clang will be resist the benchmark urg and put gcc out of its misery...."}], "tags": [], "owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "is_accepted": true, "score": 3, "last_activity_date": 1565109453, "creation_date": 1565109453, "answer_id": 57380520, "question_id": 57374847, "link": "https://stackoverflow.com/questions/57374847/concurrent-threads-and-data-race/57380520#57380520", "title": "Concurrent threads and data race", "body": "<p>While it is likely that you misunderstand some thing, your analysis is fine.   The paper referenced overplays its thesis.</p>\n\n<p>The UNIX and Linux kernels (amongst many others) themselves are large multi-threaded programs which operate with only (the equivalent of) library-based thread support.   These large multi-threaded programs have exhibited a shocking performance, reliability and scalability from tiny pdp-based computers to massive supercomputers.</p>\n\n<p>A Java-based OS was produced by Sun Labs to the open ridicule of all who had the opportunity to give it a whirl.   It remains in an unmarked grave.</p>\n\n<p>The secondary line of reasoning, that busy-waiting is more effective than locking primitives had been kicking around for at least a decade before that paper.  Everybody loves lockless because it makes great benchmarks, whereas unbounded non-deterministic race condition scares people who want nice safe systems.   The thing is, sometimes racy compare-and-swap (CAS) is good, sometimes it is bad.   Some clever systems use an optimistic CAS to implement mutexes, leaving to opportunity for somewhat readable code, and good benchmarks.</p>\n\n<p>Again, the bold statement of impossibility is hyperbolic, based on the idea that the compiler is capricious, so will make menacing assumptions and over-write memory at will.   Thankfully, the \u201cfree and good enough\u201d technologies slew these dragons.</p>\n"}], "owner": {"reputation": 522, "user_id": 153612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba347a31bc66bb2654de01850e914021?s=128&d=identicon&r=PG", "display_name": "Ta Thanh Dinh", "link": "https://stackoverflow.com/users/153612/ta-thanh-dinh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 57380520, "answer_count": 1, "score": 1, "last_activity_date": 1565109453, "creation_date": 1565090374, "last_edit_date": 1565090695, "question_id": 57374847, "link": "https://stackoverflow.com/questions/57374847/concurrent-threads-and-data-race", "title": "Concurrent threads and data race", "body": "<p>I'm reading a <a href=\"https://www.hpl.hp.com/techreports/2004/HPL-2004-209.pdf\" rel=\"nofollow noreferrer\">paper</a> of Boehm: \"Threads Cannot be Implemented as a Library\" but struggling with an example about why library-based solution for thread does not help.</p>\n\n<p>The example gives an initialization zero for both <code>x</code> and <code>y</code> then there are two threads</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>// thread 0\nif (x == 1) ++y;\n\n// thread 1\nif (y == 1) ++x;\n</code></pre>\n\n<p>I understand that there is no data race because, under <em>sequential consistency</em>, any thread will always see each other as the comparison (i.e. data load) occurs before the assignment (i.e. data store).</p>\n\n<p>So there is no way, for example, the following situation occurs:</p>\n\n<pre><code>// thread 0 assigns y\n++y;            // that means x is already 1\n\n// thread 1 is checking\nif (y == 1)     // that means x is still 0\n</code></pre>\n\n<p>Consequently, so the outcome <code>x = 0; y = 0</code> is warranted.</p>\n\n<p>However a compiler, which awares single-threaded code only, is free to reorder these threads as</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>// thread 0\n++y; if (x != 1) --y;\n\n// thread 1\n++x; if (y != 1) --x;\n</code></pre>\n\n<p>then there is data race, for example</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>// thread 0 stores y\n--y;\n\n// thread 1 load y\nif (y != 1)\n</code></pre>\n\n<p>But I still do not understand <strong>why a thread library cannot help</strong>, the most trivial implementation that I can think of is simply using a mutex to avoid data race:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>int x, y = 0;\nmtx_t m;\n\nint thread0(void *arg)\n{\n  mtx_lock(&amp;m); if (x == 1) ++y; mtx_unlock(&amp;m);\n  return y;\n}\n\nint thread1(void *arg)\n{\n  mtx_lock(&amp;m); if (y == 1) ++x; mtx_unlock(&amp;m);\n  return x;\n}\n\nint main()\n{\n  thrd_t t0, t1;\n  int r0, r1;\n\n  mtx_init(&amp;m, mtx_plain);\n\n  thrd_create(&amp;t0, thread0, NULL);\n  thrd_create(&amp;t1, thread1, NULL);\n\n  thrd_join(t0, &amp;r0);\n  thrd_join(t1, &amp;r1);\n\n  printf(\"x = %d, y = %d\\n\", r1, r0);\n\n  return 0;\n}\n</code></pre>\n\n<p>There is a <a href=\"https://stackoverflow.com/questions/38666757/implementation-threads-as-library\">similar</a> question, and the answer is about circular definition of data-race in pthreads. But with the implementation above, I don't care about whatever the memory model is, the compiler is free to reorder the code if it wants, but the output <code>x = 0, y = 0</code> is always warranted.</p>\n\n<p>Do I misunderstand anything?</p>\n"}, {"tags": ["c", "sockets", "select", "recv"], "comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 1, "creation_date": 1565090252, "post_id": 57374604, "comment_id": 101234145, "body": "It guarantess that there is at least either one byte or an EOS available to read, or at least one byte of space avallable for writing, or at least one connection available to accept, depending on how you call it. There is no way <code>select()</code> can know how much data you are expecting, so no way it can tell you that much data has arrived."}, {"owner": {"reputation": 56858, "user_id": 131930, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/91536fe27d32713b8a154a0bf42f6748?s=128&d=identicon&r=PG", "display_name": "Jeremy Friesner", "link": "https://stackoverflow.com/users/131930/jeremy-friesner"}, "edited": false, "score": 0, "creation_date": 1565096230, "post_id": 57374604, "comment_id": 101237563, "body": "Note that the <code>recv()</code> call takes an optional <code>MSG_WAITALL</code> flag that tells it to try to not return until it has filled your passed-in buffer -- you can specify that if you want to completely destroy your server in this scenario ;).  Without it, <code>recv()</code> will return as soon as it has at least one byte to give to you (or if the socket is in non-blocking mode, <code>recv()</code> will always return immediately no matter what)."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 10076563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2df8192e1631e063535a18ecf498ab27?s=128&d=identicon&r=PG&f=1", "display_name": "luke", "link": "https://stackoverflow.com/users/10076563/luke"}, "edited": false, "score": 0, "creation_date": 1565092455, "post_id": 57374714, "comment_id": 101235357, "body": "If I use blocking recv() but my program gets to the receive function before the client finishes sending data with the send() function will the recv function just read what is there currently and move on, meaning that I loose the rest that is to come?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "reply_to_user": {"reputation": 21, "user_id": 10076563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2df8192e1631e063535a18ecf498ab27?s=128&d=identicon&r=PG&f=1", "display_name": "luke", "link": "https://stackoverflow.com/users/10076563/luke"}, "edited": false, "score": 0, "creation_date": 1565092583, "post_id": 57374714, "comment_id": 101235432, "body": "@luke If using TCP, and unless someone yanks a cable, you will receive everything that have been sent, in due time. It may take multiple calls to the receive function, but it should all be received."}, {"owner": {"reputation": 21, "user_id": 10076563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2df8192e1631e063535a18ecf498ab27?s=128&d=identicon&r=PG&f=1", "display_name": "luke", "link": "https://stackoverflow.com/users/10076563/luke"}, "edited": false, "score": 0, "creation_date": 1565092954, "post_id": 57374714, "comment_id": 101235646, "body": "So the recv() function has no guarantee on the amount it recieves. It just takes what ever is in the kernel buffer at the time it is called and any data still being send will only be collected upon the next recv call?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "reply_to_user": {"reputation": 21, "user_id": 10076563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2df8192e1631e063535a18ecf498ab27?s=128&d=identicon&r=PG&f=1", "display_name": "luke", "link": "https://stackoverflow.com/users/10076563/luke"}, "edited": false, "score": 0, "creation_date": 1565093172, "post_id": 57374714, "comment_id": 101235782, "body": "@luke Correct. At least for TCP (or other streaming sockets types/protocols)."}], "tags": [], "owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": true, "score": 3, "last_activity_date": 1565089915, "creation_date": 1565089915, "answer_id": 57374714, "question_id": 57374604, "link": "https://stackoverflow.com/questions/57374604/does-select-guarantee-that-all-data-is-available-for-reading-from-a-socket-or/57374714#57374714", "title": "Does select() guarantee that all data is available for reading from a socket or only part of the data", "body": "<p>From <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/pselect.html\" rel=\"nofollow noreferrer\">the POSIX documentation about <code>select</code></a>:</p>\n\n<blockquote>\n  <p>A descriptor shall be considered ready for reading when a call to an input function with <code>O_NONBLOCK</code> clear would not block, whether or not the function would transfer data successfully.</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>A descriptor shall be considered ready for writing when a call to an output function with <code>O_NONBLOCK</code> clear would not block, whether or not the function would transfer data successfully.</p>\n</blockquote>\n\n<p>So all that is guaranteed is that a blocking socket will not block if you attempt to receive (for sockets in the read set) or send (for sockets in the write set).</p>\n\n<p>The amount of bytes that you will receive or is able to send is indeterminate.</p>\n\n<p>This is why receiving and sending often is done using loops and on non-blocking sockets.</p>\n\n<p>Also note that this \"would not block\" and \"whether or not the function would transfer data successfully\" could mean that the receive or send calls could return immediately with errors. Or in the case of receiving, return with the value <code>0</code> which means a connection-based connection is closed by the peer.</p>\n"}, {"tags": [], "owner": {"reputation": 159118, "user_id": 15416, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2b11b9662b5155aada74191fbe7cb9e?s=128&d=identicon&r=PG", "display_name": "MSalters", "link": "https://stackoverflow.com/users/15416/msalters"}, "is_accepted": false, "score": 0, "last_activity_date": 1565090143, "creation_date": 1565090143, "answer_id": 57374791, "question_id": 57374604, "link": "https://stackoverflow.com/questions/57374604/does-select-guarantee-that-all-data-is-available-for-reading-from-a-socket-or/57374791#57374791", "title": "Does select() guarantee that all data is available for reading from a socket or only part of the data", "body": "<p>How would the OS know that it has to wait for 2000 bytes to arrive? TCP is a stream, so the OS can't know after 1999 bytes that there's still a byte pending.</p>\n\n<p>For UDP, the OS knows it's packet-based, and it will have the entire packet available once the last byte arrives. It can't deliver the first byte earlier, because the UDP checksum must be verified ovr the whole packet.</p>\n"}], "owner": {"reputation": 21, "user_id": 10076563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2df8192e1631e063535a18ecf498ab27?s=128&d=identicon&r=PG&f=1", "display_name": "luke", "link": "https://stackoverflow.com/users/10076563/luke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 57374714, "answer_count": 2, "score": 1, "last_activity_date": 1565090143, "creation_date": 1565089550, "question_id": 57374604, "link": "https://stackoverflow.com/questions/57374604/does-select-guarantee-that-all-data-is-available-for-reading-from-a-socket-or", "title": "Does select() guarantee that all data is available for reading from a socket or only part of the data", "body": "<p>I have a single-threaded multi-client program written in c.</p>\n\n<p>If one client has a hideously slow network connection or is being malicious and limits their rate of send() tot he server application to something ridiculous like 1 byte/second, will select() return on the first byte received from the client (as the socket has become active) and then leave the read() call blocking while it waits for the additional 2000 bytes to be written, completely destroying the server and rendering it unreachable for the other clients; or will the select function only return when the malicious client has totally written all the bytes to some OS buffer, allowing the server to handle other clients in the meantime?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 3, "creation_date": 1565089114, "post_id": 57374353, "comment_id": 101233509, "body": "You probably meant <code>%[9-0]</code> (without the <code>s</code>).  Also you need to check <code>scanf</code>&#39;s return value to make sure it matched anything at all -- becauae in the second case, it doesn&#39;t.  (Also <code>%[0-9]</code> is more conventional -- I&#39;m surprised <code>9-0</code> worked.)"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1565089604, "post_id": 57374353, "comment_id": 101233803, "body": "As I said, in the second case I&#39;d expect no match.  Why do you expect it to skip over &quot;thisisnice&quot; and jump to the &quot;12345&quot; part?"}, {"owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "reply_to_user": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1565097320, "post_id": 57374353, "comment_id": 101238288, "body": "@SteveSummit: how very odd! According to C11, using a <code>-</code> in a scanset is implementation-defined behavior!"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "edited": false, "score": 1, "creation_date": 1565098578, "post_id": 57374353, "comment_id": 101239126, "body": "@pmg addressed in my answer. Underspecified in POSIX too"}], "answers": [{"tags": [], "owner": {"reputation": 15221, "user_id": 1023911, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wln26.jpg?s=128&g=1", "display_name": "Werner Henze", "link": "https://stackoverflow.com/users/1023911/werner-henze"}, "is_accepted": false, "score": 2, "last_activity_date": 1565089783, "creation_date": 1565089783, "answer_id": 57374670, "question_id": 57374353, "link": "https://stackoverflow.com/questions/57374353/different-behaviour-of-scanset-in-following-c-code/57374670#57374670", "title": "Different behaviour of scanset in following C code", "body": "<p>Your code has undefined behaviour. You are not initializing <code>str</code> and with your second input <code>scanf</code> is not reading any field (\"thisisnice12345\" does not <strong>start</strong> with a number), so not writing to <code>str</code>. If you are then <code>printf</code>-ing <code>str</code>, you are reading an uninitialized variable which is undefined behaviour.</p>\n\n<p>You need to check the return value of <code>scanf</code>. <code>str</code> will only have been written to if <code>scanf</code> returns 1.</p>\n"}, {"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1565096730, "post_id": 57374731, "comment_id": 101237887, "body": "<code>scanf(&quot;%[0-9]&quot;, str)</code> is akin to <code>gets()</code>, both lacking width limit, suggest <code>scanf(&quot;%127[0-9]&quot;, str)</code>."}], "tags": [], "owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "is_accepted": false, "score": 3, "last_activity_date": 1565089977, "creation_date": 1565089977, "answer_id": 57374731, "question_id": 57374353, "link": "https://stackoverflow.com/questions/57374353/different-behaviour-of-scanset-in-following-c-code/57374731#57374731", "title": "Different behaviour of scanset in following C code", "body": "<p>Here is an improved version of your program:</p>\n\n<pre><code>#include &lt;stdio.h&gt; \n\nint main(void) \n{ \n    char str[128];\n\n    printf(\"Enter a string: \"); \n    if(scanf(\"%[0-9]\", str) == 1)\n         printf(\"You entered: \\\"%s\\\"\\n\", str);\n    else printf(\"You entered nothing.\\n\");\n\n    return 0; \n} \n</code></pre>\n\n<p>The correct scanset is <code>%[0-9]</code>, with the digits in order, and without the trailing <code>s</code>.  (The trailing <code>s</code> was harmless in this case, but would have caused problems in other situations.)  More importantly, if <code>scanf</code> returns 0, this indicates it matched nothing and so stored nothing in <code>str</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1565096960, "post_id": 57374815, "comment_id": 101238043, "body": "Suggest adding width limits."}], "tags": [], "owner": {"reputation": 6899, "user_id": 1212012, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gmBY7.png?s=128&g=1", "display_name": "Mathieu", "link": "https://stackoverflow.com/users/1212012/mathieu"}, "is_accepted": false, "score": 1, "last_activity_date": 1565098741, "last_edit_date": 1565098741, "creation_date": 1565090234, "answer_id": 57374815, "question_id": 57374353, "link": "https://stackoverflow.com/questions/57374353/different-behaviour-of-scanset-in-following-c-code/57374815#57374815", "title": "Different behaviour of scanset in following C code", "body": "<p><code>scanf</code> function family is not able to <a href=\"https://stackoverflow.com/a/14883596/1212012\">perform complex regex</a>. \nBut it has some capability. If you want to read the first number entered by user, you can use:</p>\n\n<ul>\n<li><code>%[0-9]</code> reads only a number (warning its <code>0-9</code>, not <code>9-0</code>)</li>\n<li><code>%[^0-9]</code> reads all but a number</li>\n<li><code>%*[^0-9]</code> reads all but a number and ignore it.</li>\n</ul>\n\n<p>So you can write:</p>\n\n<pre><code>/* A simple scanset example */\n#include &lt;stdio.h&gt; \n\nint main(void) \n{ \n    char str[128]; \n    int ret;\n\n    printf(\"Enter a string: \"); \n\n    /* Try to read a number at input start */\n    ret = scanf(\"%[0-9]\", str);     \n\n    if (1 != ret){\n        /* if reading failed, try to re-read the input, \n           ignoring all that is before the number */\n        ret = scanf(\"%*[^0-9]%[0-9]\", str); \n    }\n\n    if (1 != ret)\n        printf(\"no match\");\n    else\n        printf(\"You entered: %s\\n\", str); \n\n    return 0; \n} \n</code></pre>\n\n<hr>\n\n<p>As pointed in comments, this code can be better if read size is limited:</p>\n\n<ul>\n<li><code>%8[0-9]</code> will limit <code>scanf</code> to read only 8 numeric characters.</li>\n</ul>\n\n<p><br/></p>\n\n<pre><code>#include &lt;stdio.h&gt; \n\nint main(void) \n{ \n    char str[8+1]; \n    int ret;\n\n    printf(\"Enter a string: \"); \n\n    /* Try to read a number at input start */\n    ret = scanf(\"%8[0-9]\", str);     \n\n    if (1 != ret){\n        /* if reading failed, try to re-read the input, \n           ignoring all that is before the number */\n        ret = scanf(\"%*[^0-9]%8[0-9]\", str); \n    }\n\n    if (1 != ret)\n        printf(\"no match\");\n    else\n        printf(\"You entered: %s\\n\", str); \n\n    return 0; \n} \n</code></pre>\n\n<p>But in this code, you will have to handle a new fact: if the user enter a too big number, how to handle it? (<code>strlen</code> can help, or <code>strto[u]l</code>...)</p>\n\n<pre><code>Enter a string: 1234567891011\n\nYou entered: 12345678\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 2, "creation_date": 1565100108, "post_id": 57377320, "comment_id": 101240124, "body": "All good points.  But if there are this many things you have to change, this many things you have to be aware of, it&#39;s a good reminder to maybe just not use <code>scanf</code> at all!  It&#39;s so hard to use correctly, it&#39;s usually more trouble than it&#39;s worth."}], "tags": [], "owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "is_accepted": false, "score": 1, "last_activity_date": 1565101330, "last_edit_date": 1565101330, "creation_date": 1565098510, "answer_id": 57377320, "question_id": 57374353, "link": "https://stackoverflow.com/questions/57374353/different-behaviour-of-scanset-in-following-c-code/57377320#57377320", "title": "Different behaviour of scanset in following C code", "body": "<h1>First of all: the character <code>s</code> does not belong to the scanset specifier. It is <code>%[...]</code>, not <code>%[...]s</code>!</h1>\n\n<hr>\n\n<p>Now the C standard says that</p>\n\n<blockquote>\n  <ul>\n  <li>If a <code>-</code> character is in the scanlist and is not the first, nor the second where the first character is a <code>^</code>, nor the last character, the behavior is implementation-defined. </li>\n  </ul>\n</blockquote>\n\n<p>So the behaviour of </p>\n\n<pre><code>scanf(\"%[9-0]\", str); \n</code></pre>\n\n<p>is implementation-defined. An implementation is allowed to behave like this was <code>%[-09]</code> or in any other implementation-defined manner.</p>\n\n<p>Now, <a href=\"https://www.gnu.org/software/libc/manual/html_node/String-Input-Conversions.html#String-Input-Conversions\" rel=\"nofollow noreferrer\">Glibc</a> for example documents that the hyphen means a character range, but <a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/functions/fscanf.html\" rel=\"nofollow noreferrer\">POSIX</a> leaves it up to the implementation. Even then, the question whether <code>%[9-0]</code> has all characters in the range or not is questionable. All in all it is preferable to <strong>not</strong> write any code like that. And <code>scanf</code> is dangerous if you do not specify the buffer length. Since you were bitten by one compatibility bug, it would be best to just stop guessing the behaviour on different platforms and simply write</p>\n\n<pre><code>int rv = scanf(\"%127[0123456789]\", str);\nif (rv == 1) {\n    ...\n}\n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 10161958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35279b401bcba5bb241b335f1beeec55?s=128&d=identicon&r=PG&f=1", "display_name": "hrishi007", "link": "https://stackoverflow.com/users/10161958/hrishi007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1565101330, "creation_date": 1565088617, "last_edit_date": 1565089211, "question_id": 57374353, "link": "https://stackoverflow.com/questions/57374353/different-behaviour-of-scanset-in-following-c-code", "title": "Different behaviour of scanset in following C code", "body": "<p>for 0-9 range in scanset if string is input 12345thisisnice output is 12345 which is correct but for input thisisnice12345 output is a@ which is wrong I think,Why this is wrong ?</p>\n\n<pre><code>/* A simple scanset example */\n#include &lt;stdio.h&gt; \n\nint main(void) \n{ \n    char str[128]; \n\n    printf(\"Enter a string: \"); \n    scanf(\"%[9-0]s\", str); \n\n    printf(\"You entered: %s\\n\", str); \n\n    return 0; \n} \n</code></pre>\n\n<p>I expect o/p of thisisnice12345 as 12345 but actual o/p is a@</p>\n"}, {"tags": ["c", "assembly", "cmake", "nasm"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1565088910, "post_id": 57374317, "comment_id": 101233426, "body": "You don&#39;t tell CMake what the &quot;main&quot; language of your project is, so it can&#39;t really deduce how to link your executable program. Add a <code>LANGUAGES</code> clause to the <a href=\"https://cmake.org/cmake/help/latest/command/project.html\" rel=\"nofollow noreferrer\"><code>project</code></a> command."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1565089567, "post_id": 57374317, "comment_id": 101233783, "body": "You&#39;re only enabling the <code>ASM_NASM</code> language, not the <code>C</code> language. You need to enable <i>all</i> languages you want to use."}, {"owner": {"reputation": 23069, "user_id": 2786156, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/fWMLm.jpg?s=128&g=1", "display_name": "St.Antario", "link": "https://stackoverflow.com/users/2786156/st-antario"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1565201117, "post_id": 57374317, "comment_id": 101281657, "body": "@Someprogrammerdude After some investigation I think that&#39;s a <code>ASM_NASM</code> bug anyway."}], "answers": [{"tags": [], "owner": {"reputation": 23069, "user_id": 2786156, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/fWMLm.jpg?s=128&g=1", "display_name": "St.Antario", "link": "https://stackoverflow.com/users/2786156/st-antario"}, "is_accepted": false, "score": 0, "last_activity_date": 1565201055, "creation_date": 1565201055, "answer_id": 57400023, "question_id": 57374317, "link": "https://stackoverflow.com/questions/57374317/cmake-how-to-set-nasm-file-extenstions/57400023#57400023", "title": "CMake how to set nasm file extenstions", "body": "<p>I think this is sort of a bug. I use CMake 3.10.2 and I noticed that the variable is not being applied.</p>\n\n<p>After running the <code>CMake</code> tool it produces output files in the build directory like</p>\n\n<pre><code>build_dir/CMakeFiles/3.10.2/\n      |\n      |__CMakeASM_NASMCompiler.cmake\n      |\n      |__CMakeCXXCompiler.cmake\n      |\n      |\n     ...\n</code></pre>\n\n<p>The <code>CMakeASM_NASMCompiler.cmake</code> looks as:</p>\n\n<pre><code>set(CMAKE_ASM_NASM_COMPILER \"/usr/bin/nasm\")\nset(CMAKE_ASM_NASM_COMPILER_ARG1 \"\")\nset(CMAKE_AR \"/usr/bin/ar\")\nset(CMAKE_ASM_NASM_COMPILER_AR \"\")\nset(CMAKE_RANLIB \"/usr/bin/ranlib\")\nset(CMAKE_ASM_NASM_COMPILER_RANLIB \"\")\nset(CMAKE_LINKER \"/usr/bin/ld\")\nset(CMAKE_ASM_NASM_COMPILER_LOADED 1)\nset(CMAKE_ASM_NASM_COMPILER_ID \"NASM\")\nset(CMAKE_ASM_NASM_COMPILER_VERSION \"\")\nset(CMAKE_ASM_NASM_COMPILER_ENV_VAR \"ASM_NASM\")\n\n\nset(CMAKE_ASM_NASM_IGNORE_EXTENSIONS h;H;o;O;obj;OBJ;def;DEF;rc;RC)\nset(CMAKE_ASM_NASM_LINKER_PREFERENCE 0)\n</code></pre>\n\n<p>As can be seen the variable <code>CMAKE_ASM_NASM_SOURCE_FILE_EXTENSIONS</code> is not appeared in the file (even if it is set explicitly in the <code>CMakeLists.txt</code>).</p>\n\n<p>After adding the entry</p>\n\n<pre><code>set(CMAKE_ASM_NASM_SOURCE_FILE_EXTENSIONS \"asm;nasm;S\")\n</code></pre>\n\n<p>into the file and regenerating <code>Makefile</code> the <code>.S</code>-files assembles just fine. </p>\n"}, {"tags": [], "owner": {"reputation": 309, "user_id": 11167950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48bf88ebd9a353df228ccec27a2d0ab0?s=128&d=identicon&r=PG", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/11167950/dmitry"}, "is_accepted": false, "score": 1, "last_activity_date": 1589239811, "creation_date": 1589239811, "answer_id": 61741182, "question_id": 57374317, "link": "https://stackoverflow.com/questions/57374317/cmake-how-to-set-nasm-file-extenstions/61741182#61741182", "title": "CMake how to set nasm file extenstions", "body": "<p>I faced the same issue, with the '.s' extension. This works fine:</p>\n\n<pre><code>set_source_files_properties(min.S PROPERTIES LANGUAGE ASM_NASM)\n</code></pre>\n\n<p>More general:</p>\n\n<pre><code>file(GLOB_RECURSE src_asm \"&lt;path&gt;/*.S\" \"&lt;path&gt;/*.s\")\nforeach(X IN ITEMS ${src_asm})\n    set_source_files_properties(${X} PROPERTIES LANGUAGE ASM_NASM)\nendforeach()\ntarget_sources(target PRIVATE ${src_c} ${src_asm})\n</code></pre>\n"}], "owner": {"reputation": 23069, "user_id": 2786156, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/fWMLm.jpg?s=128&g=1", "display_name": "St.Antario", "link": "https://stackoverflow.com/users/2786156/st-antario"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 747, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1589239811, "creation_date": 1565088467, "question_id": 57374317, "link": "https://stackoverflow.com/questions/57374317/cmake-how-to-set-nasm-file-extenstions", "title": "CMake how to set nasm file extenstions", "body": "<p>I'm trying to compile nasm source files with <code>CMake</code> and have some misunderstanding about suffixes. By default <code>CMAKE_ASM_NASM_SOURCE_FILE_EXTENSIONS</code> has value <code>nasm;asm</code> so I wanted <code>*.S</code> to be recognized as <code>ASM_NASM</code> files by <code>CMake</code>. Setting </p>\n\n<pre><code>set(CMAKE_ASM_NASM_SOURCE_FILE_EXTENSIONS \"${CMAKE_ASM_NASM_SOURCE_FILE_EXTENSIONS};S\")\n</code></pre>\n\n<p>does not seem to work. Here is the full <code>CMakeLists.txt</code>:</p>\n\n<pre><code>cmake_minimum_required(VERSION 3.10)\n\nproject(casm)\nenable_language(ASM_NASM)\nset(CMAKE_ASM_NASM_SOURCE_FILE_EXTENSIONS \"${CMAKE_ASM_NASM_SOURCE_FILE_EXTENSIONS};S\")\nset(CMAKE_ASM_NASM_COMPILE_OPTIONS \"${CMAKE_ASM_NASM_COMPILE_OPTIONS} -f elf64 -g\")\nadd_executable(min main.c min.S)\n</code></pre>\n\n<p>which prints the following error:</p>\n\n<pre><code>CMake Error: CMake can not determine linker language for target: min\nCMake Error: Cannot determine link language for target \"min\".\n</code></pre>\n\n<p>While simply renaming the <code>min.S</code> to <code>min.asm</code> and replacing adding executable with </p>\n\n<pre><code>add_executable(min main.c min.asm)\n</code></pre>\n\n<p>works just fine:</p>\n\n<pre><code>Scanning dependencies of target min\n[ 33%] Building C object CMakeFiles/min.dir/main.c.o\n[ 66%] Building ASM_NASM object CMakeFiles/min.dir/min.asm.o\n[100%] Linking C executable min\n[100%] Built target min\n</code></pre>\n\n<p>I also tried to <code>set(CMAKE_ASM_NASM_SOURCE_FILE_EXTENSIONS \"\")</code> without any effect so is user settings to the property simply ignored?</p>\n"}]