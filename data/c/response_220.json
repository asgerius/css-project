[{"tags": ["c", "c99", "variable-length-array"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1553731202, "post_id": 55388209, "comment_id": 97498269, "body": "You can&#39;t; you specify the dimension before the matrix: <code>void print_matrix(unsigned dim, int (*M)[dim][dim])</code>.  You&#39;re printing a 3D array, of course."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1553731507, "post_id": 55388209, "comment_id": 97498348, "body": "Perhaps you can use a void pointer in the parameter list and assign it to the correct pointer type in the function."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553731682, "post_id": 55388209, "comment_id": 97498396, "body": "I suspect that if you specified <code>-Wpedantic-errors</code>, you&#39;d get compilation errors.  Certainly, K&amp;R compilers did not support VLA notation.  There&#39;s a moderate chance you&#39;re using GCC and it is providing extensions that allow it to work."}, {"owner": {"reputation": 387, "user_id": 161934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94d1aa6c3ac6d9c05b99eab0429fda4f?s=128&d=identicon&r=PG", "display_name": "undercat applauds Monica", "link": "https://stackoverflow.com/users/161934/undercat-applauds-monica"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553732233, "post_id": 55388209, "comment_id": 97498527, "body": "@JonathanLeffler Both Clang(6.0.0) and GCC(7.3.0) issued no complaints about my code, even with <code>-std=c11 -pedantic-errors</code>, but great point about the compatibility, of course. Even if the standard does not explicitly prohibit it (or so it seems), it&#39;s probably going to be poorly tested on the GCC/Clang side and non-idiomatic. I&#39;m just surprised you can do that at all, to be honest."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553732754, "post_id": 55388209, "comment_id": 97498635, "body": "I&#39;m surprised too.  At one level, it makes sense. I don&#39;t spend much time worrying about what compilers can do with extensions over K&amp;R with K&amp;R function definitions.  I aim to work in portable C, and accept that I have to put the size parameters before the arrays that use them in the prototype notation."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1554938132, "post_id": 55388209, "comment_id": 97938013, "body": "@JonathanLeffler: There is nothing non-portable about using a combination of prototypes and old-style declarations."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1606243571, "post_id": 55388209, "comment_id": 114903411, "body": "@supercat \u2014 K&amp;R style function definitions are obsolescent, and have been marked as such in the standard even in C90. They will probably be removed from C2x (see standards documents N2432 and N2478 at <a href=\"http://www.open-std.org/jtc1/sc22/wg14/\" rel=\"nofollow noreferrer\">open-std.org/jtc1/sc22/wg14</a>), whereupon they become non-standard, though compilers will continue to support the then non-standard notation for many years (just as libraries still contain a working <code>gets()</code> function even though it has not been part of the standard since 2011, and was marked deprecated in TC3 for C99)."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1606249728, "post_id": 55388209, "comment_id": 114905913, "body": "@JonathanLeffler: They were obsolescent in C89, but became relevant in C99 because they can properly accommodate functions like the one given which new-style declarations cannot.  Unfortunately, rather than recognize the inability of new-style declarations to handle functions whose arguments follow long-standing conventions as a defect in C99, it seems the Committee would rather brand as defective code which new-style declarations failed to accommodate, for (judging from the Rationale) no reason other than Committee laziness."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1606250227, "post_id": 55388209, "comment_id": 114906129, "body": "@JonathanLeffler: If the Committee were to specify that arrays within an argument list that have non-constant size will be treated as having incomplete type until after the entire list has been processed, and that array sizes will be processed after all of the objects within the argument list are processed, that would allow the long-standing practices to be supported with new-style function declarations, without requiring significant extra work in the compiler (the extra work would be a tiny fraction of what&#39;s needed to support VLAs in general)."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1606250316, "post_id": 55388209, "comment_id": 114906162, "body": "@supercat \u2014 I don&#39;t think your characterizations of the committee are fair, and we&#39;re going to have to agree to disagree.  I regard this matter as closed \u2014 until we&#39;re both on the Standard C committee (which I&#39;m not at the moment, and I have no plans to change that status)."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1606251627, "post_id": 55388209, "comment_id": 114906740, "body": "@JonathanLeffler: The language described in the 1974 C Reference Manual could be on many platforms be practically accommodated by a single-pass compiler that generated machine code as it processed source code, requiring nothing more than address fix-ups that could be accommodated at link time.  Properly handling all the corner cases of new C99 features in such a compiler would be just about impossible, however, even though few non-contrived programs would care about the difficult corner cases.  If a practicality of single-pass compilation has been abandoned, why use it as an excuse..."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1606252328, "post_id": 55388209, "comment_id": 114907005, "body": "@JonathanLeffler: Rereading the Rationale, I guess maybe &quot;laziness&quot; isn&#39;t fair, but I&#39;m not sure how I&#39;d characterize &#39;Such a change to the lexical ordering rules is not considered to be in the \u201cSpirit of C,\u201d however.&#39;  Performing array-size computations between argument-list processing and function-body processing would &quot;complicate&quot; the language far less than other VLA-related changes like making <code>sizeof</code> no longer constant, and decreeing that code which puts size parameters after array pointers is somehow defective flies directly in the face of the first two Spirit of C principles."}], "answers": [{"comments": [{"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1554938076, "post_id": 55388301, "comment_id": 97938006, "body": "Using a combination of a prototype and an old-style declaration will avoid the need to throw long-standing argument-ordering conventions out the window."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1554939226, "post_id": 55388301, "comment_id": 97938272, "body": "@supercat: what do you think the prototype looks like?  The only ones that could work would be <code>void print_matrix(int M[][*], unsigned dim)</code> and <code>void print_matrix(int M[*][*], unsigned dim)</code>.  Interestingly, GCC seems to accept either notation, even with <code>-pedantic</code>; so does <code>clang</code> though with <code>-Weverything</code> it objects to the use of the VLA at all, simply on the grounds that it <i>is</i> a VLA (<code>[-Werror,-Wvla]</code>).   <i>[\u2026continued\u2026]</i>"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1554939440, "post_id": 55388301, "comment_id": 97938331, "body": "<i>[\u2026continuation\u2026]</i> So, if you&#39;re prepared to write the function definition in the obsolescent style, using a feature added to the language after the style was declared obsolescent, then &quot;yes, you can write the function definition K&amp;R style and declare it with a prototype&quot;.  I don&#39;t write functions K&amp;R style any more, and I spend far too much time cleaning up a code base littered with them still (though the amount of litter has decreased dramatically recently \u2014 and bugs have been found).  I won&#39;t ever advise anyone to write K&amp;R style functions unless there is extreme duress applied to me."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1554992068, "post_id": 55388301, "comment_id": 97960480, "body": "The prototypes using <code>[*][*]</code> are perfectly valid, and I&#39;m not quite sure what objection you have to them.  Things sometimes go from being obsolete to being necessary as a result of technological developments, and while there was never any reason other than standard-writer laziness for C99 to have made it necessary to use that syntax.  In C89, the same caller-side semantics could be achieved with <code>void test(double(*twodarr)[], int rows, int cols) {...}</code> which could then cast the argument to a <code>double*</code> and perform pointer arithmetic on it as appropriate."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1554992352, "post_id": 55388301, "comment_id": 97960653, "body": "Being able to have a called function use a 2D array without the extra casting step would be nice, but I don&#39;t see that as any justification for requiring that functions using the new syntax be called differently.  Since compilers have no need to know or care about the array sizes in the parameter list until the entire list had been parsed, all that would be necessary would be to have the compiler buffer up the size arguments and then evaluate them after parsing the declarations, and that&#39;s trivial compared with some of the other gymnastics forced upon compilers by clumsy corner cases in C99."}], "tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": true, "score": 3, "last_activity_date": 1553732055, "last_edit_date": 1553732055, "creation_date": 1553731597, "answer_id": 55388301, "question_id": 55388209, "link": "https://stackoverflow.com/questions/55388209/referencing-a-yet-to-be-mentioned-function-parameter-using-the-new-style-functio/55388301#55388301", "title": "Referencing a yet-to-be-mentioned function parameter using the new-style function declarations", "body": "<p>In portable (standard) C, you can't do what you show.  You have to specify the dimension before the matrix.  The original code in the question was:</p>\n\n<pre><code>void print_matrix(M, dim)\n     unsigned dim;\n     int (*M)[dim][dim];\n{\n</code></pre>\n\n<p>and that can't be directly translated \u2014 it needs a prototype like this, with the dimension before the matrix:</p>\n\n<pre><code>void print_matrix(unsigned dim, int (*M)[dim][dim]);\n</code></pre>\n\n<p>This allows you to call the function with a 3D array.  Or, with the revised notation in the question, you can print a 2D array:</p>\n\n<pre><code>void print_matrix(unsigned dim, int M[dim][dim]);\n</code></pre>\n\n<hr>\n\n<p>GCC provides an <a href=\"https://gcc.gnu.org/onlinedocs/gcc-8.3.0/gcc/Variable-Length.html#Variable-Length\" rel=\"nofollow noreferrer\">extension</a> to assist.  Quoting the manual:</p>\n\n<blockquote>\n  <p>If you want to pass the array first and the length afterward, you can use a forward declaration in the parameter list\u2014another GNU extension.</p>\n\n<pre><code>struct entry\ntester (int len; char data[len][len], int len)\n{\n  /* \u2026 */\n}\n</code></pre>\n  \n  <p>You can write any number of such parameter forward declarations in the parameter list. They can be separated by commas or semicolons, but the last one must end with a semicolon, which is followed by the \u201creal\u201d parameter declarations. Each forward declaration must match a \u201creal\u201d declaration in parameter name and data type. ISO C99 does not support parameter forward declarations.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1588507321, "post_id": 55622525, "comment_id": 108917609, "body": "Unfortunately, I&#39;ve heard that K&amp;R-style declarations will be removed in the next C standard.  Are you aware of any solution proposed for this kind of declaration?"}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1588529877, "post_id": 55622525, "comment_id": 108927239, "body": "@fuz: I&#39;m not.  On the other hand, given that I dislike VLAs anyway, it&#39;s way down on my list of complaints.  A far bigger problem is the Standard&#39;s failure to clearly state its jurisdiction.  Imagine how much time could have been saved if the Standard had, in describing Undefined Behavior, said &quot;In all such cases, the Standard <i>waives jurisdiction over program behavior</i> so as to allow implementations designed for various purposes to process code in whatever manner would best serve those purposes.&quot;  For the vast majority of common questions about whether the Standard defines something..."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1588530004, "post_id": 55622525, "comment_id": 108927293, "body": "...the correct answer would be that it doesn&#39;t, because implementations intended for purposes where that construct would be useful would define it <i>without regard for whether the Standard required them to do so</i>.  Unfortunately, compiler writers who promote myths about the purpose of UB will almost certainly veto any addition to the Standard that would contradict their myths."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1588531220, "post_id": 55622525, "comment_id": 108927801, "body": "Are you related to user flatfinger on reddit?  You certainly sound similar."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1588531299, "post_id": 55622525, "comment_id": 108927835, "body": "@fuz: That&#39;s me."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1588531430, "post_id": 55622525, "comment_id": 108927899, "body": "The world is small I guess.  (You might know me as /u/FUZxxl)"}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1588537375, "post_id": 55622525, "comment_id": 108930107, "body": "@fuz: Yeah.  Sorry if I come across as antagonistic sometimes.  It irks me that the Standard has for decades created needless strife between the viewpoints &quot;all compilers must support X&quot; and &quot;programmers must never do X&quot;, when the real situation has always been &quot;Compilers intended for purposes where X would be useful should support it, and programmers should only do X when targeting compilers intended for such purposes&quot;.  If some tasks could be accomplished most efficiently on an implementation that doesn&#39;t doesn&#39;t support X, but others could be accomplished most effectively by doing X..."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1588537490, "post_id": 55622525, "comment_id": 108930138, "body": "...the Standard should make clear that it makes no attempt to say whether or not any particular implementation should support X."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1588537816, "post_id": 55622525, "comment_id": 108930240, "body": "I don&#39;t view you as antagonistic.  Discussion with you is always interesting, but I would appreciate if you could shorten the the introduction of your point of view (which I&#39;m already familiar with)."}], "tags": [], "owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "is_accepted": false, "score": 2, "last_activity_date": 1554992374, "last_edit_date": 1554992374, "creation_date": 1554937966, "answer_id": 55622525, "question_id": 55388209, "link": "https://stackoverflow.com/questions/55388209/referencing-a-yet-to-be-mentioned-function-parameter-using-the-new-style-functio/55622525#55622525", "title": "Referencing a yet-to-be-mentioned function parameter using the new-style function declarations", "body": "<p>An old-style declaration which is preceded by a prototype is syntactically ugly, but is no more dangerous than a new style declaration.</p>\n\n<pre><code>void print_matrix(int M[*][*], unsigned dim);\nvoid print_matrix(M, dim)\n     unsigned dim;\n     int M[dim][dim];\n{\n  ...\n}\n</code></pre>\n\n<p>The authors of the Standard recognized that the old-style declarations were a valid, useful, and sufficient means of accomplishing the task, and decided that writing rules to allow with new-style declarations would be too much work, so they didn't want to bother.  The combination of a prototype and old-style declaration is thus the only way to achieve the appropriate semantics.</p>\n"}], "owner": {"reputation": 387, "user_id": 161934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94d1aa6c3ac6d9c05b99eab0429fda4f?s=128&d=identicon&r=PG", "display_name": "undercat applauds Monica", "link": "https://stackoverflow.com/users/161934/undercat-applauds-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 1, "accepted_answer_id": 55388301, "answer_count": 2, "score": 3, "last_activity_date": 1554992374, "creation_date": 1553730906, "last_edit_date": 1553731332, "question_id": 55388209, "link": "https://stackoverflow.com/questions/55388209/referencing-a-yet-to-be-mentioned-function-parameter-using-the-new-style-functio", "title": "Referencing a yet-to-be-mentioned function parameter using the new-style function declarations", "body": "<p>Compelled to use the variable length array feature for my auxiliary function that prints square matrices, I defined it as follows:</p>\n\n<pre><code>void print_matrix(M, dim)\n     unsigned dim;\n     int M[dim][dim];\n{\n    /* Print the matrix here. */\n    ...\n</code></pre>\n\n<p>The good news is, the code works and has its parameters in the order I'd like them to be.</p>\n\n<p>The bad news is, I had to use the \"old-style\" function declaration syntax in order to reference the yet-to-be-declared argument <code>dim</code> in the declaration of <code>M</code>, which is apparently considered <a href=\"https://docs.microsoft.com/en-us/cpp/c-language/obsolete-forms-of-function-declarations-and-definitions?view=vs-2017\" rel=\"nofollow noreferrer\">obsolete</a> and <a href=\"https://security.stackexchange.com/questions/43042/in-c-not-using-void-if-a-function-does-not-accept-any-argument-is-a-potential\">dangerous</a>.</p>\n\n<p>Is there a straightforward way to do the same with the \"new-style\" function declarations WITHOUT changing the order of the parameters? (And if not, is it considered acceptable use of the old-style syntax in this particular situation?)</p>\n"}, {"tags": ["c", "linux", "webserver", "cgi", "hosting"], "comments": [{"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1553730123, "post_id": 55388080, "comment_id": 97498002, "body": "Linking libc static can fail easily because it still tries to link other, dynamic components &quot;by foot&quot;. If you want to build a static binary I would recommend to use an alternative libc implementation, as for example <code>uclibc</code>. Usually, a script language, which is available at the webserver environment, is used for CGI however. A shell script for example, or perl, python, whatever."}, {"owner": {"reputation": 97, "user_id": 11159122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f38d7a69118fe407027a44f35bf8acdb?s=128&d=identicon&r=PG&f=1", "display_name": "rn42v1r", "link": "https://stackoverflow.com/users/11159122/rn42v1r"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1553730540, "post_id": 55388080, "comment_id": 97498122, "body": "@Ctx Thank you, I&#39;m gonna give uclibc a shot."}], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 11159122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f38d7a69118fe407027a44f35bf8acdb?s=128&d=identicon&r=PG&f=1", "display_name": "rn42v1r", "link": "https://stackoverflow.com/users/11159122/rn42v1r"}, "edited": false, "score": 1, "creation_date": 1553778204, "post_id": 55388180, "comment_id": 97516797, "body": "Thanks alot, setting up a virtual machine with CentOS 7 (which CloudLinux 7 is based on) and then building a static binary worked!"}], "tags": [], "owner": {"reputation": 768, "user_id": 938740, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZWhew.png?s=128&g=1", "display_name": "torstenvl", "link": "https://stackoverflow.com/users/938740/torstenvl"}, "is_accepted": true, "score": 1, "last_activity_date": 1553730662, "creation_date": 1553730662, "answer_id": 55388180, "question_id": 55388080, "link": "https://stackoverflow.com/questions/55388080/hello-world-c-cgi-script-crashes-on-server/55388180#55388180", "title": "&quot;hello world&quot; c cgi script crashes on server\u201d", "body": "<p>The libraries and linker behavior may vary widely. The two distributions in question aren't even running on the same major kernel version. It sounds like you're compiling against a significantly newer version of glibc than the one that exists on your server.</p>\n\n<p>I recommend you set up cross-compilation or run CloudLinux 7 in a virtual machine and compile in the VM. </p>\n"}], "owner": {"reputation": 97, "user_id": 11159122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f38d7a69118fe407027a44f35bf8acdb?s=128&d=identicon&r=PG&f=1", "display_name": "rn42v1r", "link": "https://stackoverflow.com/users/11159122/rn42v1r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 55388180, "answer_count": 1, "score": 3, "last_activity_date": 1553778456, "creation_date": 1553729711, "last_edit_date": 1553778456, "question_id": 55388080, "link": "https://stackoverflow.com/questions/55388080/hello-world-c-cgi-script-crashes-on-server", "title": "&quot;hello world&quot; c cgi script crashes on server\u201d", "body": "<p>I'm trying to execute a simple c cgi-script on a hosted webserver. I compiled this code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(){\n    printf(\"Content-type: text/plain\\n\\n\");\n    printf(\"&lt;html&gt;\\n\");\n    printf(\"&lt;head&gt;&lt;title&gt;Testing CGI-Scripts&lt;/title&gt;&lt;/head&gt;\\n\");\n    printf(\"&lt;body&gt;\\n\");\n    printf(\"&lt;h1&gt;Hello World&lt;/h1&gt;\\n\");\n    printf(\"&lt;/body&gt;\\n\");\n    printf(\"&lt;/html&gt;\\n\");\n    return 0; \n}\n</code></pre>\n\n<p>with <code>gcc -o index.cgi index.c</code>, uploaded the binary to the cgi-bin directory and changed the permission to 755. Yet when executing the script (url/cgi-bin/index.cgi) it causes a core-dump and I'm getting \"500 Internal Server Error\". Analyzing the core-dump with gdb got me \"Cannot access memory at address 0x3000000000008\" and the same line with \"0x3000000000000\".</p>\n\n<p>I tried:</p>\n\n<ul>\n<li>compiling on Ubuntu 11.10 (because auf kernel 3.0)</li>\n<li>compiling with -static</li>\n</ul>\n\n<p>(Analysis with gdb from the static binary: </p>\n\n<pre><code>Program terminated with signal SIGSEGV, Segmentation fault.\n#0  0x0000000000401e82 in __libc_start_main ()\n</code></pre>\n\n<p>)</p>\n\n<p>My System: Arch Linux, kernel 4.20.12 x86_64</p>\n\n<p>Server: CloudLinux 7, kernel 3.10.0-962.3.2.lve1.5.24.8.el7 x86_64</p>\n\n<p>I do not have shell access, unfortunately.</p>\n\n<hr>\n\n<p>Edit: Solution:</p>\n\n<p>Building a static binary on a virtual machine with CentOS (on which the Servers distro is based on) installed worked!</p>\n"}, {"tags": ["c", "math", "struct"], "comments": [{"owner": {"reputation": 55516, "user_id": 892256, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/15FJW.png?s=128&g=1", "display_name": "Ed Heal", "link": "https://stackoverflow.com/users/892256/ed-heal"}, "edited": false, "score": 0, "creation_date": 1553728901, "post_id": 55387932, "comment_id": 97497695, "body": "Please check the return values from <code>scanf</code> - they are important!"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 2, "creation_date": 1553729119, "post_id": 55387932, "comment_id": 97497761, "body": "<code>rec.i</code> will throw an error. Do you mean just <code>i</code>? What is your input and output?"}, {"owner": {"reputation": 27, "user_id": 11263252, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NT8Dei0HaIk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rftdbCox-BZ6CozgeuAm83b-UDwzQ/mo/photo.jpg?sz=128", "display_name": "marc jose", "link": "https://stackoverflow.com/users/11263252/marc-jose"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1553771080, "post_id": 55387932, "comment_id": 97512216, "body": "@ctx oh sorry about, yep just i"}], "answers": [{"comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553733186, "post_id": 55388057, "comment_id": 97498727, "body": "You can use <code>%4f</code> with <code>scanf()</code> to specify that no more than 4 digits (or 3 digits plus decimal point, or sign and 2 digits and decimal point, etc) are to be converted.  You can&#39;t use <code>%0.2f</code> though, as you say."}, {"owner": {"reputation": 27, "user_id": 11263252, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NT8Dei0HaIk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rftdbCox-BZ6CozgeuAm83b-UDwzQ/mo/photo.jpg?sz=128", "display_name": "marc jose", "link": "https://stackoverflow.com/users/11263252/marc-jose"}, "edited": false, "score": 0, "creation_date": 1553771471, "post_id": 55388057, "comment_id": 97512476, "body": "Thank you very much for responding to my stupid question. :)  i&#39;ve realized too late that scanf has different specifiers. thanks again man"}], "tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": true, "score": 4, "last_activity_date": 1553771592, "last_edit_date": 1553771592, "creation_date": 1553729546, "answer_id": 55388057, "question_id": 55387932, "link": "https://stackoverflow.com/questions/55387932/how-to-use-members-of-a-structure-for-arithmetic-operators-add-sub-mul-div-a-va/55388057#55388057", "title": "How to use members of a structure for arithmetic operators (add,sub,mul,div a variable to a struct member)", "body": "<p>The format specifiers of <code>scanf()</code> differ from those of <code>printf()</code>. Especially the length of the decimals cannot be given there, so the flags <code>0.2</code> to <code>%f</code> are invalid. Just use</p>\n\n<pre><code>scanf(\"%f\",&amp;i);\n\nprintf(\"enter value to struct\\n\");\nscanf(\"%f\",&amp;rec.id);\n</code></pre>\n\n<p>As Jonathan Leffler noted, it is however possible to specify the total length of the number (including dot and decimals), for example with <code>%4f</code> to scan for a four character decimal.</p>\n\n<p>Furthermore, you should enable all compiler warnings and listen to them. You would have observed warnings, which show up this exact problem.</p>\n\n<p>Additionally, you should check the return values of <code>scanf()</code> to see, if the conversions succeeded. Otherwise, the values in your variables remain uninitialized.</p>\n\n<p>Two minor issues:</p>\n\n<ul>\n<li>Use <code>int main (void)</code></li>\n<li>Explicitly return a value from <code>main()</code> or call <code>exit(0)</code> (not strictly needed anymore if you use at least the C99 standard)</li>\n</ul>\n"}], "owner": {"reputation": 27, "user_id": 11263252, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NT8Dei0HaIk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rftdbCox-BZ6CozgeuAm83b-UDwzQ/mo/photo.jpg?sz=128", "display_name": "marc jose", "link": "https://stackoverflow.com/users/11263252/marc-jose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 55388057, "answer_count": 1, "score": 1, "last_activity_date": 1553771592, "creation_date": 1553728720, "last_edit_date": 1553771116, "question_id": 55387932, "link": "https://stackoverflow.com/questions/55387932/how-to-use-members-of-a-structure-for-arithmetic-operators-add-sub-mul-div-a-va", "title": "How to use members of a structure for arithmetic operators (add,sub,mul,div a variable to a struct member)", "body": "<p>Sorry for the noob question. How do i use arith operators to variables within the structure?</p>\n\n<p>I have this struct</p>\n\n<pre><code>struct account {\n    int no;\n    char name[100];\n    int pin;\n    float id;\n}; \n</code></pre>\n\n<p>what I want to do is add a value to float <code>id</code></p>\n\n<pre><code>#include &lt;ctype.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;process.h&gt;\n\nmain() {\n    struct account {\n        int no;\n        char name[100];\n        int pin;\n        float id;\n    }; \n    struct account rec;\n    float i;\n    printf(\"enter var value \\n\");\n    scanf(\"%f\", &amp;i);\n\n    printf(\"enter value to struct\\n\");\n    scanf(\"%f\", &amp;rec.id);\n\n    rec.id = rec.id + i;\n\n    printf(\"sum is %0.2f\", rec.id);\n}\n</code></pre>\n\n<p>the value of <code>rec.id</code> stays the same.</p>\n\n<p>I know I'm missing something. hopefully it wouldn't be too much of a bother</p>\n"}, {"tags": ["macos", "c", "linker", "clang"], "comments": [{"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 2, "creation_date": 1554913042, "post_id": 55418664, "comment_id": 97927555, "body": "Why do you want to do that? Resist the temptation, and use <code>&quot;\u2026&quot;</code> includes for everything but system headers. There\u2019s <i>no advantage</i> to using <code>&lt;\u2026&gt;</code> for your own header files. If the actual question is how to set up your own library as a system library then the answer is: use a build system."}, {"owner": {"reputation": 8570, "user_id": 2293156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/800e791e8e13500e516c9ae77299160a?s=128&d=identicon&r=PG", "display_name": "Amadeus", "link": "https://stackoverflow.com/users/2293156/amadeus"}, "edited": false, "score": 1, "creation_date": 1554926476, "post_id": 55418664, "comment_id": 97933915, "body": "Maybe <a href=\"https://stackoverflow.com/questions/21593/what-is-the-difference-between-include-filename-and-include-filename\">this</a> explains to you the difference between them, but if you really want to use brackets, just do it and pass to your compiler, the directive <code>-I&#47;path&#47;to&#47;your&#47;headerfile</code>"}], "answers": [{"tags": [], "owner": {"reputation": 147, "user_id": 9314483, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/185735ee8db2a425cc9ff72a69fbca49?s=128&d=identicon&r=PG&f=1", "display_name": "l.k", "link": "https://stackoverflow.com/users/9314483/l-k"}, "is_accepted": false, "score": 0, "last_activity_date": 1554888956, "creation_date": 1554888956, "answer_id": 55609326, "question_id": 55418664, "link": "https://stackoverflow.com/questions/55418664/how-to-make-c-library-installable-with-angle-brackets-as-mylib-h-on-mac/55609326#55609326", "title": "How to make C library installable with angle brackets as &lt;mylib.h&gt; on Mac", "body": "<blockquote>\n  <p>I see C projects every now and then, such as this and BareMetalOS (it makes sense for BareMetalOS) where they include there files like #import  instead of #import \"foo.h\".<br>\n  Wondering how I could get my library to be importable like that.  </p>\n</blockquote>\n\n<p>When projects include project-directory headers using angle brackets, normally what's going on is the build system is adding directories to the compiler's include search path in every time it invokes the compiler (mostly like <code>-I some/project/subdir</code>)</p>\n\n<p>If having a personal \"system\" directory that gets automatically searched meets your needs, that's the simplest thing.  To set that up, the command line options you'd be  passing are likely <code>-isystem</code> and your choice of nothing <code>-L</code>, <code>-F</code>, maybe <code>-B</code>, <em>maybe</em> <code>-Wl,-rpath</code> (getting brave now), and ideally <em>not</em> <code>-I</code> (tends to stomp ordering assumptions in build scripts).  Unless you're experimenting, don't resort to  <code>-isysroot</code> or <code>-resource-dir</code> until it's quite clear how that's called for).  </p>\n\n<p>The flags you choose can be an be made implicit adding them to CFLAGS, by invoking clang with a wrapper script (something like <code>eval \"clang -my -options ${@}\"</code>); or by setting additional search dirs in environment variables LIBRARY_PATH, C_INCLUDE_PATH (for c), CPLUS_INCLUDE_PATH (for c++), and/or CPATH (both) (at least for linux systems; I imagine it respects them on Apple but I'm not certain.)</p>\n\n<p>The truly complete solution is rebuild clang with the search path configured as you'd prefer.    </p>\n\n<p>Make sure you're building your dylib with the right link flags, too (doesn't it need <code>--shared</code>?)</p>\n"}, {"tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": true, "score": 5, "last_activity_date": 1554975154, "creation_date": 1554975154, "answer_id": 55629209, "question_id": 55418664, "link": "https://stackoverflow.com/questions/55418664/how-to-make-c-library-installable-with-angle-brackets-as-mylib-h-on-mac/55629209#55629209", "title": "How to make C library installable with angle brackets as &lt;mylib.h&gt; on Mac", "body": "<p>If you insist:</p>\n\n<ul>\n<li><p>Build the shared library (<code>.dylib</code>) and put it in <code>/usr/local/lib</code>.</p></li>\n<li><p>Copy the header to <code>/usr/local/include</code>.</p></li>\n</ul>\n\n<p>You'll then be able to link using:</p>\n\n<pre><code>gcc -o program source.c function.c -lmylib\n</code></pre>\n\n<p>And you'll be able to write <code>#include &lt;mylib.h&gt;</code> in your source code and the header will be found.</p>\n\n<p>On the other hand, it is often regarded as better for project headers to be included using quotes (<code>#include \"mylib.h\"</code>) and you can specify the directories where the headers and libraries are found on the compiler command line (<code>-I/some/where/include</code> for headers; <code>-L/some/where/lib</code> for libraries).</p>\n"}], "migrated_from": {"other_site": {"aliases": ["http://linux.stackexchange.com"], "markdown_extensions": ["Prettify"], "launch_date": 1294871917, "open_beta_date": 1282071600, "closed_beta_date": 1281466800, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/unix/Img/apple-touch-icon@2.png", "favicon_url": "https://cdn.sstatic.net/Sites/unix/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/unix/Img/apple-touch-icon.png", "audience": "users of Linux, FreeBSD and other Un*x-like operating systems", "site_url": "https://unix.stackexchange.com", "api_site_parameter": "unix", "logo_url": "https://cdn.sstatic.net/Sites/unix/Img/logo.png", "name": "Unix &amp; Linux", "site_type": "main_site"}, "on_date": 1553866545, "question_id": 509097}, "owner": {"reputation": 66677, "user_id": 169992, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/OeNfG.png?s=128&g=1", "display_name": "Lance Pollard", "link": "https://stackoverflow.com/users/169992/lance-pollard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 464, "favorite_count": 0, "accepted_answer_id": 55629209, "answer_count": 2, "score": 2, "last_activity_date": 1554975154, "creation_date": 1553728290, "question_id": 55418664, "link": "https://stackoverflow.com/questions/55418664/how-to-make-c-library-installable-with-angle-brackets-as-mylib-h-on-mac", "title": "How to make C library installable with angle brackets as &lt;mylib.h&gt; on Mac", "body": "<p>If I go into <code>/usr/local/lib</code>, I see a bunch of folders and <code>.dylib</code> files, the <em>dynamically linked library</em> files I'm pretty sure. If I go to <code>/usr/local/include</code> it has a bunch of <code>.h</code> files each of which has the plain C source code uncompiled in it.</p>\n\n<p>If I place a <code>.h</code> file at <code>/usr/local/include/mylib.h</code>, And I have another <code>.c</code> or <code>.h</code> file locally at let's say <code>~/Desktop/test/foo.c</code>, then inside <code>foo.c</code> I can include <code>mylib.h</code>:</p>\n\n<p><strong><code>~/Desktop/test/foo.c</code></strong></p>\n\n<pre><code>#include &lt;mylib.h&gt;\n\nint\nmain() {\n  puts(\"Hello World\");\n\n  return 0;\n}\n</code></pre>\n\n<p>If I follow <a href=\"https://langui.sh/2015/07/24/osx-clang-include-lib-search-paths/\" rel=\"nofollow noreferrer\">this</a>, I write this in the terminal:</p>\n\n<pre><code>$ clang -Xlinker -v\n@(#)PROGRAM:ld  PROJECT:ld64-351.8\nconfigured to support archs: armv6 armv7 armv7s arm64 i386 x86_64 x86_64h armv6m armv7k armv7m armv7em (tvOS)\nLibrary search paths:\n  /usr/lib\n  /usr/local/lib\nFramework search paths:\n  /Library/Frameworks/\n  /System/Library/Frameworks/\n</code></pre>\n\n<p>So <code>/usr/local/lib</code> is in there, which is a bunch of <code>.dylib</code> files. I can't modify <code>/usr/lib</code>.</p>\n\n<p>My question is how I can take a local C library such as <code>~/Desktop/test/mylib.{c,h}</code>, and integrate it into the install locations of these other C libraries, similar to what homebrew does probably.</p>\n\n<p>I would like to be able to include the library with &lt; angle brackets> instead of \"quotes\".</p>\n\n<p>So say I have a library <code>mylib.h</code> and <code>mylib.c</code>.</p>\n\n<p><strong>mylib.c</strong></p>\n\n<pre><code>#include \"mylib.h\"\n\nvoid\nprint(char* str) {\n  puts(str);\n}\n</code></pre>\n\n<p><strong>mylib.h</strong></p>\n\n<pre><code>#include \"stdlib.h\"\n#include \"stdio.h\"\n\nextern\nvoid\nprint(char* str);\n</code></pre>\n\n<p>Then I have <code>foo.c</code> which includes it.</p>\n\n<p><strong>foo.c</strong>:</p>\n\n<pre><code>#include &lt;mylib.h&gt;\n\nint\nmain() {\n  print(\"Foo\");\n  return 0;\n}\n</code></pre>\n\n<p>The question is how I compile both <code>mylib</code> and <code>foo.c</code> with Clang such that I can <code>#include &lt;mylib.h&gt;</code> with angle brackets in any project like <code>foo.c</code>.</p>\n\n<p>I have been building them like this:</p>\n\n<pre><code>build:\n  @clang -shared -fpic -O2 \\\n    -install_name mylib.dylib \\\n    -o mylib.dylib \\\n    mylib.c\n  @clang foo.c build.dylib -o foo\n  @./foo\n.PHONY: build\n</code></pre>\n\n<p>It seems to work, but now the question is how to place them programmatically (without XCode) into some appropriate spot to make it work with loading via angle brackets.</p>\n"}, {"tags": ["c", "pointers", "memory-management", "heap-memory"], "comments": [{"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1553728382, "post_id": 55387834, "comment_id": 97497540, "body": "Hm, <code>0x87a3008 - 1 = 0x87a3007</code>. What exactly surprises you? What do you expect and why?"}, {"owner": {"reputation": 1, "user_id": 10438719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d31107543c1ea75aa1af2175fdd38b9?s=128&d=identicon&r=PG&f=1", "display_name": "dannyBands", "link": "https://stackoverflow.com/users/10438719/dannybands"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1553743308, "post_id": 55387834, "comment_id": 97500748, "body": "@Ctx well I want to access the previos 4 bytes in order to add the size and allocation status of the block of memory, I am under the impression that if I did the pointer arithmetic that you highlighted, it would move me back 4 bytes. Is that only when the block of memory is allocated as an array? Or is it because the pointer type is void?"}, {"owner": {"reputation": 351, "user_id": 10443813, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0ee2ae00e0a906599c69e0e698035d0?s=128&d=identicon&r=PG&f=1", "display_name": "KL-Yang", "link": "https://stackoverflow.com/users/10443813/kl-yang"}, "edited": false, "score": 0, "creation_date": 1553756120, "post_id": 55387834, "comment_id": 97504210, "body": "<code>int32_t *p = (int32_t*)startOfMemory-1;</code>, will move forward 4 bytes, <b>the pointer arithmetic is related with pointer type</b>. <code>int64_t *p = (int64_t*)startOfMemory-1;</code> will move forward 8 bytes."}], "answers": [{"tags": [], "owner": {"reputation": 5079, "user_id": 572586, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/4837f7d94d6466b2e4a6d4af3551926a?s=128&d=identicon&r=PG", "display_name": "cprogrammer", "link": "https://stackoverflow.com/users/572586/cprogrammer"}, "is_accepted": false, "score": 0, "last_activity_date": 1553765233, "last_edit_date": 1553765233, "creation_date": 1553729063, "answer_id": 55387998, "question_id": 55387834, "link": "https://stackoverflow.com/questions/55387834/how-to-access-header-for-memory-block-via-pointer-arithmetic/55387998#55387998", "title": "How to access header for memory block via pointer arithmetic?", "body": "<p>placeOfHeader is not somewhere in the allocated region. \nYou probably want to write something like this. </p>\n\n<pre><code>//alloc(realSize)\nvoid *placeOfHeader = malloc(realSize);\n*((size_t*)placeOfHeader) = realSize;\nvoid* startOfMemory = (size_t*)placeOfHeader + 1;\nreturn startOfMemory;\n\n//free(startOfMemory)\nvoid* placeOfHeader = (size_t*)startOfMemory - 1;\nsize_t realSize = *((size_t*)placeOfHeader);\nfree(placeOfHeader)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10438719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d31107543c1ea75aa1af2175fdd38b9?s=128&d=identicon&r=PG&f=1", "display_name": "dannyBands", "link": "https://stackoverflow.com/users/10438719/dannybands"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 224, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553765233, "creation_date": 1553728060, "question_id": 55387834, "link": "https://stackoverflow.com/questions/55387834/how-to-access-header-for-memory-block-via-pointer-arithmetic", "title": "How to access header for memory block via pointer arithmetic?", "body": "<p>I am working on a homework problem which consists of making a c program that a user can use to manage memory. Essentially we are trying to mimic what malloc() and free() do in our own way. The function I am currently working on is an initmemory(int size) function that allocates the overall block that the user will use, and from that block, smaller blocks will be allocated as the program calls myalloc() funciton (basically our version of malloc()). My question is, I am trying to access the header portion of the overall block in order to save the size and allocation status of the block, but when I try to perform pointer arithmetic, I end up just moving one bit. How can I access the header in order to save the size and allocation status of the block with my pointer variable startOfMemory</p>\n\n<pre><code>void initmemory(int size){\n    printf(\"this is the initial size: %d\\n\", size);\n    //realSize = size + initial padding + anchorHeader + sentinelBlock\n    int realSize = size + 12;\n    printf(\"I am the new realSize: %d\\n\", realSize);\n    //checks how many remainders are left\n    int check = realSize % 8;\n    printf(\"this is the value of check: %d\\n\", check);\n    //will only change realSize if check is not zero\n    if(check != 0){\n        //adds enough bytes to satisfy 8-byte alignment \n        realSize = realSize + (8 - check);\n        /*\n         * this is only to make sure realSize is 8-byte aligned, it should not run\n         * unless the above code for some reason does not run\n         */\n\n        check = realSize % 8;\n        while(check != 0){\n            realSize = realSize + (8-check);\n            check = realSize % 8;\n            printf(\"I'm in the while check loop\");\n        }\n    }\n    // initializes the memory to be allocated. \n    void *startOfMemory = malloc(realSize);\n    void *placeOfHeader = startOfMemory - 1;\n\n    printf(\"my memory location is at: %p\\n\", startOfMemory);\n    printf(\"my realSize is: %d\\n\", realSize);\n    printf(\"memory location of placeOfHeader: %p\\n\", placeOfHeader);\n    free(startOfMemory);\n\n}\nint main(){\n    initmemory(5);\n    return 0;\n}\n</code></pre>\n\n<p>the memory location for startOfMemory, which calls the malloc() fuction is at 0x87a3008 (which makes sense because of the 8 byte alignment) </p>\n\n<p>when I do pointer arithmetic, as in the variable place of header, the memory location of placeOfHeader is at 0x87a3007.</p>\n"}, {"tags": ["c", "macos", "time.h"], "comments": [{"owner": {"reputation": 11, "user_id": 3672401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd9d91c65b161347bfba238b5343e5ea?s=128&d=identicon&r=PG&f=1", "display_name": "user3672401", "link": "https://stackoverflow.com/users/3672401/user3672401"}, "edited": false, "score": 0, "creation_date": 1553727044, "post_id": 55387600, "comment_id": 97497110, "body": "I got the example for clock_gettime from <a href=\"https://www.cs.rutgers.edu/~pxk/416/notes/c-tutorials/gettime.html\" rel=\"nofollow noreferrer\">cs.rutgers.edu/~pxk/416/notes/c-tutorials/gettime.html</a>"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553727542, "post_id": 55387600, "comment_id": 97497270, "body": "Don&#39;t you need to worry about when one <code>tv_nsec</code> value is close to 1 billion (just before the second changes) and the second is close to 0 (just after the second changes)?  When you do the differencing\u2026?"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553727715, "post_id": 55387600, "comment_id": 97497335, "body": "I have a function lurking around: <code>void sub_timespec(struct timespec t1, struct timespec t2, struct timespec *td) {     td-&gt;tv_nsec = t2.tv_nsec - t1.tv_nsec;     td-&gt;tv_sec  = t2.tv_sec - t1.tv_sec;     if (td-&gt;tv_sec &gt; 0 &amp;&amp; td-&gt;tv_nsec &lt; 0)     {         td-&gt;tv_nsec += NS_PER_SECOND;         td-&gt;tv_sec--;     }     else if (td-&gt;tv_sec &lt; 0 &amp;&amp; td-&gt;tv_nsec &gt; 0)     {         td-&gt;tv_nsec -= NS_PER_SECOND;         td-&gt;tv_sec++;     } }</code> \u2014 where <code>enum { NS_PER_SECOND = 1000000000 };</code> or equivalent."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553727853, "post_id": 55387600, "comment_id": 97497374, "body": "Note that that produces a <code>struct timespec</code> answer; if you only need a count in microseconds, the arithmetic is slightly different \u2014 what you&#39;ve got might be OK.  But to diagnose further, I suggest printing out the 4 numbers (<code>tv_sec</code> and <code>tv_nsec</code> for two values) and looking at those values when you spot the -1,000,000 discrepancy."}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1553728211, "post_id": 55387600, "comment_id": 97497497, "body": "Don&#39;t you need to multiply by a BILLION and not a MILLION?  Be careful with overflow."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1553733007, "post_id": 55387600, "comment_id": 97498699, "body": "Have you tried<code>CLOCK_MONOTONIC_RAW</code> as a clock type?"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1553734108, "post_id": 55387600, "comment_id": 97498924, "body": "How many nanoseconds are in a second? It&#39;s not a million."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553825644, "post_id": 55387600, "comment_id": 97539292, "body": "By the time the code multiplies by one million, the nanoseconds part has been divided by one thousand, leaving microseconds, and there are only one million microseconds in a second,"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 3672401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd9d91c65b161347bfba238b5343e5ea?s=128&d=identicon&r=PG&f=1", "display_name": "user3672401", "link": "https://stackoverflow.com/users/3672401/user3672401"}, "edited": false, "score": 0, "creation_date": 1553738946, "post_id": 55388202, "comment_id": 97499909, "body": "Looks like the sub_timespec() might solve this riddle... I will have to wake up tomorrow to find out... meanwhile, why does ualarm() still work even if the spec has deprecated it? am I causing future problems by using it?"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 11, "user_id": 3672401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd9d91c65b161347bfba238b5343e5ea?s=128&d=identicon&r=PG&f=1", "display_name": "user3672401", "link": "https://stackoverflow.com/users/3672401/user3672401"}, "edited": false, "score": 0, "creation_date": 1553750172, "post_id": 55388202, "comment_id": 97502271, "body": "Deprecated means &quot;do not use in new code; still works for old code (but it would be a good idea to change the old code to use the replacement function)&quot;.  So, you should not use <code>ualarm()</code> in code you write, and if you come across it in the code base you work on, it would be a good idea to work out a consistent strategy for replacing it."}], "tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": false, "score": 2, "last_activity_date": 1553730869, "creation_date": 1553730869, "answer_id": 55388202, "question_id": 55387600, "link": "https://stackoverflow.com/questions/55387600/clock-gettime-glitch-about-every-second/55388202#55388202", "title": "clock_gettime glitch about every second", "body": "<p>Even though it is bad practice for production code, I added a <code>printf()</code> statement into the signal handler to record the output:</p>\n\n<pre><code>/* SO 5538-7600 */\n\n#include \"time_math.h\"\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdarg.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;time.h&gt;\n\n#define OPT_R_MIN 0\n#define OPT_R_MAX 5000\n#define OPT_R_DEF 100\n#define OPT_U_MIN 100\n#define OPT_U_MAX 2000000000 // 2K seconds\n#define OPT_U_DEF 2000\n#define OPT_O_ELAPSED 0\n#define OPT_O_JITTER 1\n#define OPT_O_SUMJITTER 2\n#define OPT_O_DEVIATION 3\n#define OPT_O_DEVIATION_MAX 256\n#define OPT_C_MIN 100\n#define OPT_C_MAX 2000000000\n#define OPT_C_DEF 1000\n\n#define TIME_OUT_PERIOD 5000000\n#define MILLION 1000000\n#define BILLION 1000000000\n\nint opt_o_min = OPT_O_ELAPSED;\nint opt_o_max = OPT_O_SUMJITTER;\n\nint opt_r = OPT_R_DEF;\nunsigned int opt_u = OPT_U_DEF;\nint opt_o = OPT_O_JITTER;\nint opt_c = OPT_C_DEF;\nint editOutput = 0;\n\nvolatile unsigned int elapsedTime, jitter;\nstruct timespec thisTime, lastTime, timeOutStart, timeOutTest;\nvolatile unsigned int sampleFlag = 0;\nvolatile int eventCounter, sumJitter, firstTime, secondTime;\n\nvoid alarmWakeup(int sig_num);\nvoid startTimer(int r, unsigned int u);\nvoid handler(int sig_num);\n\nchar filename[100];\nstruct tm *timenow;\n\n\nstatic void usage(void)\n{\n    fprintf(stderr,\n        \"Usage: sudo ./timerTest ... [OPTION] ...\\n\"\n        \"   -r value, sets the allowed lag between alarm and callback   default: %d\\n\"\n        \"   -u value, sets microsecond alarm setting   default: %d\\n\"\n        \"         %d &lt; VALID &lt; %d ONLY (under test)\\n\"\n        \"   -o value, sets the output type     default: %d\\n\"\n        \"         %d elapsed time in microseconds\\n\"\n        \"         %d jitter (elapsed time / -u value)\\n\"\n        \"         %d cumulative jitter (jitter + jitter)\\n\"\n        \"   -t value, sets duration of test cycles in event counter    default: %d\\n\"\n        \"         %d &lt; VALID &lt; %d ONLY (under test)\\n\"\n        \"\\n\",\n        OPT_R_DEF, OPT_U_DEF, OPT_U_MIN, OPT_U_MAX, OPT_O_JITTER,\n        OPT_O_ELAPSED, OPT_O_JITTER, OPT_O_SUMJITTER, OPT_O_DEVIATION,\n        OPT_O_DEVIATION_MAX, OPT_C_DEF//, OPT_C_MIN, OPT_C_MAX\n        );\n}\n\nstatic void fatal(int show_usage, char *fmt, ...)\n{\n    char buf[128];\n    va_list ap;\n\n    va_start(ap, fmt);\n    vsnprintf(buf, sizeof(buf), fmt, ap);\n    va_end(ap);\n\n    fprintf(stderr, \"%s\\n\", buf);\n\n    if (show_usage)\n        usage();\n\n    fflush(stderr);\n\n    exit(EXIT_FAILURE);\n}\n\nstatic int initOpts(int argc, char *argv[])\n{\n    int i, opt;\n    unsigned int u;\n\n    while ((opt = getopt(argc, argv, \"r:u:o:t:\")) != -1)\n    {\n        i = -1;\n        switch (opt)\n        {\n        case 'r':\n            i = atoi(optarg);\n            if ((i &gt;= OPT_R_MIN) &amp;&amp; (i &lt;= OPT_R_MAX))\n                opt_r = i;\n            else\n                fatal(1, \"invalid -r option (%d)\", i);\n            break;\n\n        case 'u':\n            u = atol(optarg);\n            if ((u &gt;= OPT_U_MIN) &amp;&amp; (u &lt;= OPT_U_MAX))\n                opt_u = u;\n            else\n                fatal(1, \"invalid -u option (%d)\", u);\n            break;\n\n        case 'o':\n            i = atoi(optarg);\n            opt_o = i;  // probably fatal\n            break;\n\n        case 't':\n            i = atoi(optarg);\n            opt_c = i;  // probably fatal\n            break;\n\n        default: /* '?' */\n            usage();\n        }\n    }\n    return optind;\n}\n\nint main(int argc, char *argv[])\n{\n    int settings = 0;\n    // command line settings\n    settings = initOpts(argc, argv);\n    time_t now = time(NULL);\n    timenow = gmtime(&amp;now);\n\n    // FILE *data;\n    // strftime(filename, sizeof(filename),\n    // \"/home/pi/Documents/_C_/WiringPiAlarm/protoPulse_%Y-%m-%d_%H:%M:%S.dat\", timenow);\n    // data = fopen(filename, \"w+\");\n    // fprintf(data,\"# Sample count: %d option(s)\\n\", opt_c);\n    // fprintf(data,\"# Running with %d latency at %duS sample rate\\n\",opt_r,opt_u);\n    // fprintf(data,\"# Output Type is %d\\n\\n\" , opt_o);\n\n    printf(\"User selects %d option(s)\\n\", settings - 1);\n    printf(\"Running with %d latency at %duS sample rate\\n\", opt_r, opt_u);\n    printf(\"Output Type is %d\\n\", opt_o);\n    printf(\"    Use -o value to select output type\\n\");\n    printf(\"        0: elapsed time between interrutps\\n\");\n    printf(\"        1: jitter (elapsed time / -u)\\n\");\n    printf(\"        2: cumulative jitter (jitter + jitter)\\n\");\n    printf(\"Sample count: %d\\n\", opt_c);\n    printf(\"Starting alarm timer for %dmS...\\n\", opt_u);\n\n\n    eventCounter = 0;\n    firstTime = secondTime = 1;\n    clock_gettime(CLOCK_MONOTONIC, &amp;lastTime);\n    // lastTime = micros();\n    timeOutStart = lastTime;\n    startTimer(opt_r, opt_u);\n\n\n    while (1)\n    {\n        if (sampleFlag)\n        {\n            sampleFlag = 0;\n            timeOutStart = lastTime;\n            // int metaDataOutput;\n            // switch(opt_o){  // ALL OUTPUTS DISCARD THE FIRST CALLBACK\n            //    case OPT_O_JITTER:\n            //        metaDataOutput = jitter;\n            //        break;\n            //    case OPT_O_SUMJITTER:\n            //        metaDataOutput = sumJitter;\n            //        break;\n            //    default:\n            //        metaDataOutput = elapsedTime;\n            //        break;\n            // }\n            printf(\"%d\\t%d\\t%d\\t%d\\n\", eventCounter, elapsedTime, jitter, sumJitter);\n            // fprintf(data,\"%d\\t%d\\n\",eventCounter,metaDataOutput);\n        }\n        clock_gettime(CLOCK_MONOTONIC, &amp;timeOutTest);\n        if ((MILLION * (timeOutTest.tv_sec - timeOutStart.tv_sec) + timeOutTest.tv_nsec - timeOutStart.tv_nsec) / 1000 &gt; TIME_OUT_PERIOD)\n        {\n            fatal(0, \"program timed out\", 0);\n        }\n        if (eventCounter &gt;= opt_c)\n        {\n            fatal(0, \"counted %d events\", eventCounter, 0);\n        }\n    }\n\n    return 0;\n}\n\nvoid startTimer(int r, unsigned int u)\n{\n    int latency = r;\n    unsigned int micros = u;\n\n    signal(SIGALRM, alarmWakeup);\n    ualarm(latency, micros);\n}\n\nvoid alarmWakeup(int sig_num)\n{\n    if (sig_num == SIGALRM)\n    {\n        clock_gettime(CLOCK_MONOTONIC, &amp;thisTime);\n        // thisTime = micros();\n        elapsedTime = (MILLION * (thisTime.tv_sec - lastTime.tv_sec) + thisTime.tv_nsec - lastTime.tv_nsec) / 1000;\n        struct timespec diff;\n        sub_timespec(lastTime, thisTime, &amp;diff);\n        /* Not good practice! */\n        printf(\"%10u : %ld.%.9ld - %ld.%.9ld (%ld.%.9ld)  - \",\n               elapsedTime,\n               thisTime.tv_sec, thisTime.tv_nsec,\n               lastTime.tv_sec, lastTime.tv_nsec,\n               diff.tv_sec, diff.tv_nsec);\n        lastTime = thisTime;\n        if (firstTime)\n        {\n            firstTime = 0;\n            return;\n        }\n        if (secondTime)\n        {\n            secondTime = 0;\n            return;\n        }\n        jitter = elapsedTime - opt_u;\n        sumJitter += jitter;\n        eventCounter++;\n        sampleFlag = 1;\n    }\n}\n</code></pre>\n\n<p>The <code>time_math.h</code> header contains:</p>\n\n<pre><code>#include &lt;time.h&gt;\n\nextern void sub_timespec(struct timespec t1, struct timespec t2, struct timespec *td);\n</code></pre>\n\n<p>And the <code>sub_timespec()</code> code is (as shown in a comment):</p>\n\n<pre><code>enum { NS_PER_SECOND = 1000000000 };\n\nvoid sub_timespec(struct timespec t1, struct timespec t2, struct timespec *td)\n{\n    td-&gt;tv_nsec = t2.tv_nsec - t1.tv_nsec;\n    td-&gt;tv_sec  = t2.tv_sec - t1.tv_sec;\n    if (td-&gt;tv_sec &gt; 0 &amp;&amp; td-&gt;tv_nsec &lt; 0)\n    {\n        td-&gt;tv_nsec += NS_PER_SECOND;\n        td-&gt;tv_sec--;\n    }\n    else if (td-&gt;tv_sec &lt; 0 &amp;&amp; td-&gt;tv_nsec &gt; 0)\n    {\n        td-&gt;tv_nsec -= NS_PER_SECOND;\n        td-&gt;tv_sec++;\n    }\n}\n</code></pre>\n\n<p>At the cusp of the problem, the output was:</p>\n\n<pre><code>      1896 : 169978.995568000 - 169978.993672000 (0.001896000)  - 97    1896    -104    64\n      1978 : 169978.997546000 - 169978.995568000 (0.001978000)  - 98    1978    -22 42\n      2136 : 169978.999682000 - 169978.997546000 (0.002136000)  - 99    2136    136 178\n4293970278 : 169979.001664000 - 169978.999682000 (0.001982000)  - 100   -997018 -999018 -998840\n      2019 : 169979.003683000 - 169979.001664000 (0.002019000)  - 101   2019    19  -998821\n      2041 : 169979.005724000 - 169979.003683000 (0.002041000)  - 102   2041    41  -998780\n</code></pre>\n\n<p>As you can see, the numbers go haywire exactly as the <code>tv_nsec</code> value flips from <code>999418000</code> to <code>001406000</code>.   (On macOS, although <code>clock_gettime()</code> reports nanoseconds, but the last three digits are always zero, so it effectively reports microseconds.) As you may also see, the parenthesized number (the output from <code>sub_timespec()</code>) does not go haywire at that point.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 3672401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd9d91c65b161347bfba238b5343e5ea?s=128&d=identicon&r=PG&f=1", "display_name": "user3672401", "link": "https://stackoverflow.com/users/3672401/user3672401"}, "is_accepted": false, "score": 0, "last_activity_date": 1553814428, "creation_date": 1553814428, "answer_id": 55408179, "question_id": 55387600, "link": "https://stackoverflow.com/questions/55387600/clock-gettime-glitch-about-every-second/55408179#55408179", "title": "clock_gettime glitch about every second", "body": "<p>The time math that Jonathan posted fixed the problem.\nNow I guess I have to replace my use of ualarm()... The alternative is super tedious, as far as I've seen.</p>\n\n<p>Here's the working code. I am not using the time_math library. Just rolled the sub_timespec() function in.\nThanks!</p>\n\n<pre><code>\n\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdarg.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;time.h&gt;\n\n#define OPT_R_MIN 0\n#define OPT_R_MAX 5000\n#define OPT_R_DEF 100\n#define OPT_U_MIN 100\n#define OPT_U_MAX 2000000000 // 2K seconds\n#define OPT_U_DEF 2000\n#define OPT_O_ELAPSED 0\n#define OPT_O_JITTER 1\n#define OPT_O_SUMJITTER 2\n#define OPT_O_DEVIATION 3\n#define OPT_O_DEVIATION_MAX 256\n#define OPT_C_MIN 100\n#define OPT_C_MAX 2000000000\n#define OPT_C_DEF 1000\n\n#define TIME_OUT_PERIOD 5000000\n#define MILLION 1000000\n#define BILLION 1000000000\n\nint opt_o_min = OPT_O_ELAPSED;\nint opt_o_max = OPT_O_SUMJITTER;\n\nint opt_r = OPT_R_DEF;\nunsigned int opt_u = OPT_U_DEF;\nint opt_o = OPT_O_JITTER;\nint opt_c = OPT_C_DEF;\nint editOutput = 0;\n\nvolatile unsigned int elapsedTime, jitter;\nstruct timespec thisTime, lastTime, diff, timeOutStart, timeOutTest;\nvolatile unsigned int sampleFlag = 0;\nvolatile int eventCounter, sumJitter, firstTime, secondTime;\n\nvoid alarmWakeup(int sig_num);\nvoid startTimer(int r, unsigned int u);\nvoid handler(int sig_num);\nvoid sub_timespec(struct timespec t1, struct timespec t2, struct timespec *td);\nchar filename [100];\nstruct tm *timenow;\n\n\nvoid usage()\n{\n   fprintf\n   (stderr,\n      \"\\n\" \\\n      \"Usage: sudo ./timerTest ... [OPTION] ...\\n\" \\\n      \"   -r value, sets the allowed lag between alarm and callback   default: %d\\n\"\n      \"   -u value, sets microsecond alarm setting   default: %d\\n\" \\\n      \"         %d &lt; VALID &lt; %d ONLY (under test)\\n\"\\\n      \"   -o value, sets the output type     default: %d\\n\"\\\n      \"         %d elapsed time in microseconds\\n\"\\\n      \"         %d jitter (elapsed time / -u value)\\n\"\\\n      \"         %d cumulative jitter (jitter + jitter)\\n\"\\\n      \"   -t value, sets duration of test cycles in event counter    default: %d\\n\"\\\n      \"         %d &lt; VALID &lt; %d ONLY (under test)\\n\"\\\n      \"\\n\",\n      OPT_R_DEF,OPT_U_DEF, OPT_U_MIN, OPT_U_MAX, OPT_O_JITTER,\n      OPT_O_ELAPSED, OPT_O_JITTER, OPT_O_SUMJITTER, OPT_O_DEVIATION,\n      OPT_O_DEVIATION_MAX, OPT_C_DEF, OPT_C_MIN, OPT_C_MAX\n   );\n}\n\nvoid fatal(int show_usage, char *fmt, ...)\n{\n   char buf[128];\n   va_list ap;\n\n   va_start(ap, fmt);\n   vsnprintf(buf, sizeof(buf), fmt, ap);\n   va_end(ap);\n\n   fprintf(stderr, \"%s\\n\", buf);\n\n   if (show_usage) usage();\n\n   fflush(stderr);\n\n   exit(EXIT_FAILURE);\n}\n\nstatic int initOpts(int argc, char *argv[])\n{\n   int i, opt;\n   unsigned int u;\n\n   while ((opt = getopt(argc, argv, \"r:u:o:t:\")) != -1)\n   {\n      i = -1;\n      switch (opt)\n      {\n         case 'r':\n            i = atoi(optarg);\n            if ((i &gt;= OPT_R_MIN) &amp;&amp; (i &lt;= OPT_R_MAX))\n               opt_r = i;\n            else fatal(1, \"invalid -r option (%d)\", i);\n            break;\n\n         case 'u':\n            u = atol(optarg);\n            if ((u &gt;= OPT_U_MIN) &amp;&amp; (u &lt;= OPT_U_MAX))\n               opt_u = u;\n            else fatal(1, \"invalid -u option (%d)\", u);\n            break;\n\n         case 'o':\n            i = atoi(optarg);\n            opt_o = i;  // probably fatal\n            break;\n\n        case 't':\n            i = atoi(optarg);\n            opt_c = i;  // probably fatal\n            break;\n\n        default: /* '?' */\n           usage();\n        }\n    }\n   return optind;\n}\n\n\nint main(int argc, char *argv[])\n{\n    int settings = 0;\n    // command line settings\n    settings = initOpts(argc, argv);\n    time_t now = time(NULL);\n    timenow = gmtime(&amp;now);\n\n    // FILE *data;\n    // strftime(filename, sizeof(filename),\n    // \"/home/pi/Documents/_C_/WiringPiAlarm/protoPulse_%Y-%m-%d_%H:%M:%S.dat\", timenow);\n    // data = fopen(filename, \"w+\");\n    // fprintf(data,\"# Sample count: %d option(s)\\n\", opt_c);\n    // fprintf(data,\"# Running with %d latency at %duS sample rate\\n\",opt_r,opt_u);\n    // fprintf(data,\"# Output Type is %d\\n\\n\" , opt_o);\n\n    printf(\"User selects %d option(s)\\n\", settings-1);\n    printf(\"Running with %d latency at %duS sample rate\\n\",opt_r,opt_u);\n    printf(\"Output Type is %d\\n\" , opt_o);\n    printf(\"    Use -o value to select output type\\n\");\n    printf(\"        0: elapsed time between interrutps\\n\");\n    printf(\"        1: jitter (elapsed time / -u)\\n\");\n    printf(\"        2: cumulative jitter (jitter + jitter)\\n\");\n    printf(\"Sample count: %d\\n\", opt_c);\n    printf(\"Starting alarm timer for %dmS...\\n\", opt_u);\n\n\n    eventCounter = 0;\n    firstTime = secondTime = 1;\n        clock_gettime(CLOCK_MONOTONIC, &amp;lastTime);\n    // lastTime = micros();\n    timeOutStart = lastTime;\n    startTimer(opt_r, opt_u);\n\n\n    while(1)\n    {\n        if(sampleFlag){\n            sampleFlag = 0;\n            timeOutStart = lastTime;\n            int metaDataOutput;\n                        printf(\"%d\\t%d\\t%d\\t%d\\n\",eventCounter,elapsedTime,jitter, sumJitter);\n             // fprintf(data,\"%d\\t%d\\n\",eventCounter,metaDataOutput);\n         }\n                 clock_gettime(CLOCK_MONOTONIC, &amp;timeOutTest);\n         if((MILLION * (timeOutTest.tv_sec - timeOutStart.tv_sec) + timeOutTest.tv_nsec - timeOutStart.tv_nsec)/1000&gt;TIME_OUT_PERIOD){\n            fatal(0,\"program timed out\",0);\n         }\n         if(eventCounter &gt;= opt_c){\n            fatal(0,\"counted %d events\", eventCounter, 0);\n         }\n    }\n\n    return 0;\n\n}//int main(int argc, char *argv[])\n\nvoid startTimer(int r, unsigned int u){\n    int latency = r;\n    unsigned int micros = u;\n\n    signal(SIGALRM, alarmWakeup);\n    ualarm(latency, micros);\n\n}\n\nvoid alarmWakeup(int sig_num)\n{\n\n    if(sig_num == SIGALRM)\n    {\n                clock_gettime(CLOCK_MONOTONIC, &amp;thisTime);\n                sub_timespec(lastTime,thisTime,&amp;diff);\n                elapsedTime = diff.tv_nsec / 1000;\n        lastTime = thisTime;\n        if(firstTime){\n            firstTime = 0;\n            return;\n        }\n        if(secondTime){\n            secondTime = 0;\n            return;\n        }\n        jitter = elapsedTime - opt_u;\n        sumJitter += jitter;\n        eventCounter++;\n        sampleFlag = 1;\n\n    }\n\n}\n\n\nvoid sub_timespec(struct timespec t1, struct timespec t2, struct timespec *td)\n{\n    td-&gt;tv_nsec = t2.tv_nsec - t1.tv_nsec;\n    td-&gt;tv_sec  = t2.tv_sec - t1.tv_sec;\n    if (td-&gt;tv_sec &gt; 0 &amp;&amp; td-&gt;tv_nsec &lt; 0)\n    {\n        td-&gt;tv_nsec += BILLION;\n        td-&gt;tv_sec--;\n    }\n    else if (td-&gt;tv_sec &lt; 0 &amp;&amp; td-&gt;tv_nsec &gt; 0)\n    {\n        td-&gt;tv_nsec -= BILLION;\n        td-&gt;tv_sec++;\n    }\n}\n\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 3672401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd9d91c65b161347bfba238b5343e5ea?s=128&d=identicon&r=PG&f=1", "display_name": "user3672401", "link": "https://stackoverflow.com/users/3672401/user3672401"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1553814428, "creation_date": 1553726676, "question_id": 55387600, "link": "https://stackoverflow.com/questions/55387600/clock-gettime-glitch-about-every-second", "title": "clock_gettime glitch about every second", "body": "<p>I'm splashing about with C on my mac doing a benchmark test. The code here compiles and runs, but there is a kind of glitch in the output that happens about 1Hz. The program 'should' get interrupted once every 2mS, and report data on the time it was last interrupted. The default setting is to print the following to the terminal</p>\n\n<pre><code>eventCounter \\t elapsedTime \\t jitter \\t sumJitter\n</code></pre>\n\n<p>eventCounter is obvious, it counts up every time the interrupt happens</p>\n\n<p>elapsedTime is in uS</p>\n\n<p>jitter is elapsedTime minus 2000 (2mS)</p>\n\n<p>sumJitter is jitter + jitter</p>\n\n<p>Just about exactly once per second, the result for elapsedTime crashes to about -1,000,000 which is crazy, because that means I made a time machine... and now I'm in the past.... by about 16 minutes... \nI don't feel that much different.</p>\n\n<p>Here's the code</p>\n\n<pre><code>\n\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdarg.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;time.h&gt;\n\n#define OPT_R_MIN 0\n#define OPT_R_MAX 5000\n#define OPT_R_DEF 100\n#define OPT_U_MIN 100\n#define OPT_U_MAX 2000000000 // 2K seconds\n#define OPT_U_DEF 2000\n#define OPT_O_ELAPSED 0\n#define OPT_O_JITTER 1\n#define OPT_O_SUMJITTER 2\n#define OPT_O_DEVIATION 3\n#define OPT_O_DEVIATION_MAX 256\n#define OPT_C_MIN 100\n#define OPT_C_MAX 2000000000\n#define OPT_C_DEF 1000\n\n#define TIME_OUT_PERIOD 5000000\n#define MILLION 1000000\n#define BILLION 1000000000\n\nint opt_o_min = OPT_O_ELAPSED;\nint opt_o_max = OPT_O_SUMJITTER;\n\nint opt_r = OPT_R_DEF;\nunsigned int opt_u = OPT_U_DEF;\nint opt_o = OPT_O_JITTER;\nint opt_c = OPT_C_DEF;\nint editOutput = 0;\n\nvolatile unsigned int  elapsedTime, jitter;\nstruct timespec thisTime, lastTime, timeOutStart, timeOutTest;\nvolatile unsigned int sampleFlag = 0;\nvolatile int eventCounter, sumJitter, firstTime, secondTime;\n\nvoid alarmWakeup(int sig_num);\nvoid startTimer(int r, unsigned int u);\nvoid handler(int sig_num);\nchar filename [100];\nstruct tm *timenow;\n\n\nvoid usage()\n{\n   fprintf\n   (stderr,\n      \"\\n\" \\\n      \"Usage: sudo ./timerTest ... [OPTION] ...\\n\" \\\n      \"   -r value, sets the allowed lag between alarm and callback   default: %d\\n\"\n      \"   -u value, sets microsecond alarm setting   default: %d\\n\" \\\n      \"         %d &lt; VALID &lt; %d ONLY (under test)\\n\"\\\n      \"   -o value, sets the output type     default: %d\\n\"\\\n      \"         %d elapsed time in microseconds\\n\"\\\n      \"         %d jitter (elapsed time / -u value)\\n\"\\\n      \"         %d cumulative jitter (jitter + jitter)\\n\"\\\n      \"   -t value, sets duration of test cycles in event counter    default: %d\\n\"\\\n      \"         %d &lt; VALID &lt; %d ONLY (under test)\\n\"\\\n      \"\\n\",\n      OPT_R_DEF,OPT_U_DEF, OPT_U_MIN, OPT_U_MAX, OPT_O_JITTER,\n      OPT_O_ELAPSED, OPT_O_JITTER, OPT_O_SUMJITTER, OPT_O_DEVIATION,\n      OPT_O_DEVIATION_MAX, OPT_C_DEF, OPT_C_MIN, OPT_C_MAX\n   );\n}\n\nvoid fatal(int show_usage, char *fmt, ...)\n{\n   char buf[128];\n   va_list ap;\n\n   va_start(ap, fmt);\n   vsnprintf(buf, sizeof(buf), fmt, ap);\n   va_end(ap);\n\n   fprintf(stderr, \"%s\\n\", buf);\n\n   if (show_usage) usage();\n\n   fflush(stderr);\n\n   exit(EXIT_FAILURE);\n}\n\nstatic int initOpts(int argc, char *argv[])\n{\n   int i, opt;\n   unsigned int u;\n\n   while ((opt = getopt(argc, argv, \"r:u:o:t:\")) != -1)\n   {\n      i = -1;\n      switch (opt)\n      {\n         case 'r':\n            i = atoi(optarg);\n            if ((i &gt;= OPT_R_MIN) &amp;&amp; (i &lt;= OPT_R_MAX))\n               opt_r = i;\n            else fatal(1, \"invalid -r option (%d)\", i);\n            break;\n\n         case 'u':\n            u = atol(optarg);\n            if ((u &gt;= OPT_U_MIN) &amp;&amp; (u &lt;= OPT_U_MAX))\n               opt_u = u;\n            else fatal(1, \"invalid -u option (%d)\", u);\n            break;\n\n         case 'o':\n            i = atoi(optarg);\n            opt_o = i;  // probably fatal\n            break;\n\n        case 't':\n            i = atoi(optarg);\n            opt_c = i;  // probably fatal\n            break;\n\n        default: /* '?' */\n           usage();\n        }\n    }\n   return optind;\n}\n\n\nint main(int argc, char *argv[])\n{\n    int settings = 0;\n    // command line settings\n    settings = initOpts(argc, argv);\n    time_t now = time(NULL);\n    timenow = gmtime(&amp;now);\n\n    // FILE *data;\n    // strftime(filename, sizeof(filename),\n    // \"/home/pi/Documents/_C_/WiringPiAlarm/protoPulse_%Y-%m-%d_%H:%M:%S.dat\", timenow);\n    // data = fopen(filename, \"w+\");\n    // fprintf(data,\"# Sample count: %d option(s)\\n\", opt_c);\n    // fprintf(data,\"# Running with %d latency at %duS sample rate\\n\",opt_r,opt_u);\n    // fprintf(data,\"# Output Type is %d\\n\\n\" , opt_o);\n\n    printf(\"User selects %d option(s)\\n\", settings-1);\n    printf(\"Running with %d latency at %duS sample rate\\n\",opt_r,opt_u);\n    printf(\"Output Type is %d\\n\" , opt_o);\n    printf(\"    Use -o value to select output type\\n\");\n    printf(\"        0: elapsed time between interrutps\\n\");\n    printf(\"        1: jitter (elapsed time / -u)\\n\");\n    printf(\"        2: cumulative jitter (jitter + jitter)\\n\");\n    printf(\"Sample count: %d\\n\", opt_c);\n    printf(\"Starting alarm timer for %dmS...\\n\", opt_u);\n\n\n    eventCounter = 0;\n    firstTime = secondTime = 1;\n        clock_gettime(CLOCK_MONOTONIC, &amp;lastTime);\n    // lastTime = micros();\n    timeOutStart = lastTime;\n    startTimer(opt_r, opt_u);\n\n\n    while(1)\n    {\n        if(sampleFlag){\n            sampleFlag = 0;\n            timeOutStart = lastTime;\n            int metaDataOutput;\n            switch(opt_o){  // ALL OUTPUTS DISCARD THE FIRST CALLBACK\n                case OPT_O_JITTER:\n                    metaDataOutput = jitter;\n                    break;\n                case OPT_O_SUMJITTER:\n                    metaDataOutput = sumJitter;\n                    break;\n                default:\n                    metaDataOutput = elapsedTime;\n                    break;\n            }\n             printf(\"%d\\t%d\\t%d\\t%d\\n\",eventCounter,elapsedTime,jitter, sumJitter);\n             // fprintf(data,\"%d\\t%d\\n\",eventCounter,metaDataOutput);\n         }\n                 clock_gettime(CLOCK_MONOTONIC, &amp;timeOutTest);\n         if((MILLION * (timeOutTest.tv_sec - timeOutStart.tv_sec) + timeOutTest.tv_nsec - timeOutStart.tv_nsec)/1000&gt;TIME_OUT_PERIOD){\n            fatal(0,\"program timed out\",0);\n         }\n         if(eventCounter &gt;= opt_c){\n            fatal(0,\"counted %d events\", eventCounter, 0);\n         }\n    }\n\n    return 0;\n\n}//int main(int argc, char *argv[])\n\nvoid startTimer(int r, unsigned int u){\n    int latency = r;\n    unsigned int micros = u;\n\n    signal(SIGALRM, alarmWakeup);\n    ualarm(latency, micros);\n\n}\n\nvoid alarmWakeup(int sig_num)\n{\n\n    if(sig_num == SIGALRM)\n    {\n                clock_gettime(CLOCK_MONOTONIC, &amp;thisTime);\n        // thisTime = micros();\n        elapsedTime = (MILLION * (thisTime.tv_sec - lastTime.tv_sec) + thisTime.tv_nsec - lastTime.tv_nsec)/1000;\n        lastTime = thisTime;\n        if(firstTime){\n            firstTime = 0;\n            return;\n        }\n        if(secondTime){\n            secondTime = 0;\n            return;\n        }\n        jitter = elapsedTime - opt_u;\n        sumJitter += jitter;\n        eventCounter++;\n        sampleFlag = 1;\n\n\n\n    }\n\n}\n\n</code></pre>\n\n<p>Here's a sample of the data that I get</p>\n\n<pre><code>User selects 0 option(s)\nRunning with 100 latency at 2000uS sample rate\nOutput Type is 1\n    Use -o value to select output type\n        0: elapsed time between interrutps\n        1: jitter (elapsed time / -u)\n        2: cumulative jitter (jitter + jitter)\nSample count: 1000\nStarting alarm timer for 2000mS...\n1   1928    -72 -72\n2   2031    31  -41\n3   1989    -11 -52\n4   1975    -25 -77\n5   2032    32  -45\n6   1971    -29 -74\n7   2027    27  -47\n8   2012    12  -35\n9   2051    51  16\n10  1920    -80 -64\n11  1998    -2  -66\n12  1994    -6  -72\n13  2027    27  -45\n14  1998    -2  -47\n15  2000    0   -47\n16  1986    -14 -61\n17  1906    -94 -155\n18  2126    126 -29\n19  1978    -22 -51\n20  2047    47  -4\n21  1924    -76 -80\n22  2038    38  -42\n23  1963    -37 -79\n24  2045    45  -34\n25  1863    -137    -171\n26  2169    169 -2\n27  1921    -79 -81\n28  2040    40  -41\n29  1997    -3  -44\n30  2021    21  -23\n31  1995    -5  -28\n32  1984    -16 -44\n33  1927    -73 -117\n34  2059    59  -58\n35  1990    -10 -68\n36  1963    -37 -105\n37  1836    -164    -269\n38  2250    250 -19\n39  1978    -22 -41\n40  1962    -38 -79\n41  1898    -102    -181\n42  2124    124 -57\n43  1997    -3  -60\n44  2009    9   -51\n45  2019    19  -32\n46  1986    -14 -46\n47  2006    6   -40\n48  1999    -1  -41\n49  1985    -15 -56\n50  2013    13  -43\n51  2001    1   -42\n52  2000    0   -42\n53  2169    169 127\n54  1815    -185    -58\n55  2007    7   -51\n56  1990    -10 -61\n57  1783    -217    -278\n58  2269    269 -9\n59  1964    -36 -45\n60  2020    20  -25\n61  2021    21  -4\n62  1992    -8  -12\n63  1996    -4  -16\n64  1937    -63 -79\n65  2009    9   -70\n66  2061    61  -9\n67  1731    -269    -278\n68  2271    271 -7\n69  1993    -7  -14\n70  1958    -42 -56\n71  1769    -231    -287\n72  2303    303 16\n73  1931    -69 -53\n74  1810    -190    -243\n75  1998    -2  -245\n76  2221    221 -24\n77  1998    -2  -26\n78  1955    -45 -71\n79  2150    150 79\n80  1895    -105    -26\n81  2013    13  -13\n82  1852    -148    -161\n83  2116    116 -45\n84  1979    -21 -66\n85  2004    4   -62\n86  1902    -98 -160\n87  1981    -19 -179\n88  2203    203 24\n89  1955    -45 -21\n90  1970    -30 -51\n91  1832    -168    -219\n92  1939    -61 -280\n93  2326    326 46\n94  1940    -60 -14\n95  2000    0   -14\n96  1988    -12 -26\n97  1979    -21 -47\n98  2020    20  -27\n99  1859    -141    -168\n100 2113    113 -55\n101 2028    28  -27\n102 1958    -42 -69\n103 1922    -78 -147\n104 2134    134 -13\n105 1969    -31 -44\n106 2049    49  5\n107 1846    -154    -149\n108 2127    127 -22\n109 2019    19  -3\n110 1985    -15 -18\n111 1994    -6  -24\n112 2017    17  -7\n113 1975    -25 -32\n114 1957    -43 -75\n115 2057    57  -18\n116 1981    -19 -37\n117 2011    11  -26\n118 1760    -240    -266\n119 2226    226 -40\n120 1969    -31 -71\n121 2011    11  -60\n122 2293    293 233\n123 1719    -281    -48\n124 1980    -20 -68\n125 2053    53  -15\n126 1992    -8  -23\n127 1955    -45 -68\n128 2064    64  -4\n129 1951    -49 -53\n130 2045    45  -8\n131 1931    -69 -77\n132 1861    -139    -216\n133 2220    220 4\n134 1980    -20 -16\n135 1827    -173    -189\n136 2138    138 -51\n137 2010    10  -41\n138 1994    -6  -47\n139 2038    38  -9\n140 1987    -13 -22\n141 2061    61  39\n142 1921    -79 -40\n143 1799    -201    -241\n144 2244    244 3\n145 1971    -29 -26\n146 1749    -251    -277\n147 2239    239 -38\n148 2017    17  -21\n149 1994    -6  -27\n150 1920    -80 -107\n151 2077    77  -30\n152 1944    -56 -86\n153 2085    85  -1\n154 1985    -15 -16\n155 1981    -19 -35\n156 1985    -15 -50\n157 2059    59  9\n158 1929    -71 -62\n159 2005    5   -57\n160 2035    35  -22\n161 1986    -14 -36\n162 1977    -23 -59\n163 2000    0   -59\n164 2036    36  -23\n165 3912    1912    1889\n166 42  -1958   -69\n167 2072    72  3\n168 1754    -246    -243\n169 1957    -43 -286\n170 2284    284 -2\n171 1993    -7  -9\n172 1958    -42 -51\n173 2043    43  -8\n174 1762    -238    -246\n175 2235    235 -11\n176 1965    -35 -46\n177 2049    49  3\n178 1992    -8  -5\n179 1982    -18 -23\n180 2006    6   -17\n181 1968    -32 -49\n182 1790    -210    -259\n183 2019    19  -240\n184 2194    194 -46\n185 1916    -84 -130\n186 2079    79  -51\n187 1849    -151    -202\n188 2213    213 11\n189 1944    -56 -45\n190 2022    22  -23\n191 2001    1   -22\n192 2000    0   -22\n193 2003    3   -19\n194 1930    -70 -89\n195 2081    81  -8\n196 1946    -54 -62\n197 2058    58  -4\n198 1997    -3  -7\n199 1932    -68 -75\n200 2068    68  -7\n201 1929    -71 -78\n202 2034    34  -44\n203 2038    38  -6\n204 1998    -2  -8\n205 1950    -50 -58\n206 1990    -10 -68\n207 1880    -120    -188\n208 2368    368 180\n209 1825    -175    5\n210 1709    -291    -286\n211 2102    102 -184\n212 2110    110 -74\n213 2041    41  -33\n214 2027    27  -6\n215 1963    -37 -43\n216 1841    -159    -202\n217 2215    215 13\n218 1800    -200    -187\n219 2195    195 8\n220 1984    -16 -8\n221 1988    -12 -20\n222 1966    -34 -54\n223 2086    86  32\n224 1858    -142    -110\n225 2161    161 51\n226 1806    -194    -143\n227 2091    91  -52\n228 1990    -10 -62\n229 1995    -5  -67\n230 1995    -5  -72\n231 2039    39  -33\n232 1996    -4  -37\n233 2019    19  -18\n234 1990    -10 -28\n235 1777    -223    -251\n236 2005    5   -246\n237 2308    308 62\n238 1903    -97 -35\n239 1783    -217    -252\n240 2064    64  -188\n241 1943    -57 -245\n242 1963    -37 -282\n243 2216    216 -66\n244 1889    -111    -177\n245 2125    125 -52\n246 1777    -223    -275\n247 2306    306 31\n248 1907    -93 -62\n249 1991    -9  -71\n250 2016    16  -55\n251 1984    -16 -71\n252 2002    2   -69\n253 2029    29  -40\n254 2027    27  -13\n255 1993    -7  -20\n256 2016    16  -4\n257 1814    -186    -190\n258 1953    -47 -237\n259 2063    63  -174\n260 2117    117 -57\n261 1990    -10 -67\n262 1863    -137    -204\n263 2207    207 3\n264 1987    -13 -10\n265 1992    -8  -18\n266 1970    -30 -48\n267 2067    67  19\n268 1976    -24 -5\n269 1987    -13 -18\n270 1963    -37 -55\n271 1992    -8  -63\n272 1996    -4  -67\n273 2059    59  -8\n274 1986    -14 -22\n275 2011    11  -11\n276 1956    -44 -55\n277 1990    -10 -65\n278 2002    2   -63\n279 2051    51  -12\n280 1989    -11 -23\n281 1742    -258    -281\n282 2297    297 16\n283 1960    -40 -24\n284 1902    -98 -122\n285 2053    53  -69\n286 1804    -196    -265\n287 2025    25  -240\n288 2201    201 -39\n289 1992    -8  -47\n290 1996    -4  -51\n291 1981    -19 -70\n292 1997    -3  -73\n293 2005    5   -68\n294 1876    -124    -192\n295 2161    161 -31\n296 1913    -87 -118\n297 2052    52  -66\n298 2027    27  -39\n299 1899    -101    -140\n300 2105    105 -35\n301 1849    -151    -186\n302 1996    -4  -190\n303 2152    152 -38\n304 1945    -55 -93\n305 2087    87  -6\n306 1979    -21 -27\n307 1971    -29 -56\n308 2050    50  -6\n309 1988    -12 -18\n310 1998    -2  -20\n311 2068    68  48\n312 1890    -110    -62\n313 1998    -2  -64\n314 1994    -6  -70\n315 2000    0   -70\n316 2023    23  -47\n317 1987    -13 -60\n318 2055    55  -5\n319 1942    -58 -63\n320 1901    -99 -162\n321 2144    144 -18\n322 2007    7   -11\n323 2010    10  -1\n324 1929    -71 -72\n325 2063    63  -9\n326 1956    -44 -53\n327 1992    -8  -61\n328 2028    28  -33\n329 2026    26  -7\n330 1976    -24 -31\n331 2005    5   -26\n332 1873    -127    -153\n333 2126    126 -27\n334 1955    -45 -72\n335 2153    153 81\n336 1854    -146    -65\n337 1879    -121    -186\n338 2140    140 -46\n339 1898    -102    -148\n340 2132    132 -16\n341 1983    -17 -33\n342 1998    -2  -35\n343 2022    22  -13\n344 1942    -58 -71\n345 1893    -107    -178\n346 2171    171 -7\n347 2067    67  60\n348 1905    -95 -35\n349 1867    -133    -168\n350 1941    -59 -227\n351 2240    240 13\n352 1972    -28 -15\n353 1966    -34 -49\n354 2044    44  -5\n355 1958    -42 -47\n356 1981    -19 -66\n357 -997000 -999000 -999066\n358 1997    -3  -999069\n359 1999    -1  -999070\n360 2011    11  -999059\n361 2057    57  -999002\n362 1987    -13 -999015\n363 1971    -29 -999044\n364 2037    37  -999007\n365 1845    -155    -999162\n366 2173    173 -998989\n367 1986    -14 -999003\n368 1974    -26 -999029\n369 2016    16  -999013\n370 1998    -2  -999015\n371 2009    9   -999006\n372 1822    -178    -999184\n373 1939    -61 -999245\n374 2206    206 -999039\n375 1923    -77 -999116\n376 1917    -83 -999199\n377 2202    202 -998997\n378 1929    -71 -999068\n379 1882    -118    -999186\n380 2191    191 -998995\n381 1918    -82 -999077\n382 2037    37  -999040\n383 2025    25  -999015\n384 1917    -83 -999098\n385 2052    52  -999046\n386 1799    -201    -999247\n387 2202    202 -999045\n388 2013    13  -999032\n389 1964    -36 -999068\n390 2023    23  -999045\n391 2050    50  -998995\n392 1924    -76 -999071\n393 2043    43  -999028\n394 2027    27  -999001\n395 1986    -14 -999015\n396 1983    -17 -999032\n397 1855    -145    -999177\n398 2133    133 -999044\n399 1976    -24 -999068\n400 1781    -219    -999287\n401 2179    179 -999108\n402 1966    -34 -999142\n403 2086    86  -999056\n404 2047    47  -999009\n405 2002    2   -999007\n406 1971    -29 -999036\n407 1995    -5  -999041\n408 2041    41  -999000\n409 1989    -11 -999011\n410 2011    11  -999000\n411 1985    -15 -999015\n412 1949    -51 -999066\n413 2061    61  -999005\n414 1982    -18 -999023\n415 1997    -3  -999026\n416 2012    12  -999014\n417 1979    -21 -999035\n418 2029    29  -999006\n419 1978    -22 -999028\n420 1978    -22 -999050\n421 1993    -7  -999057\n422 1834    -166        -999223\n423 1970    -30 -999253\n424 2146    146 -999107\n425 2100    100 -999007\n426 1962    -38 -999045\n427 1908    -92 -999137\n428 2155    155 -998982\n429 1753    -247    -999229\n430 2198    198 -999031\n431 2025    25  -999006\n432 1827    -173    -999179\n433 2152    152 -999027\n434 2033    33  -998994\n435 1880    -120    -999114\n436 1898    -102    -999216\n437 2225    225 -998991\n438 1985    -15 -999006\n439 1870    -130    -999136\n440 2101    101 -999035\n441 1968    -32 -999067\n442 2040    40  -999027\n443 1956    -44 -999071\n444 2008    8   -999063\n445 2046    46  -999017\n446 1946    -54 -999071\n447 2029    29  -999042\n448 2029    29  -999013\n449 1996    -4  -999017\n450 2002    2   -999015\n451 1976    -24 -999039\n452 1972    -28 -999067\n453 2031    31  -999036\n454 2009    9   -999027\n455 2024    24  -999003\n456 1987    -13 -999016\n457 2000    0   -999016\n458 1851    -149    -999165\n459 2167    167 -998998\n460 1933    -67 -999065\n461 2029    29  -999036\n462 1982    -18 -999054\n463 1989    -11 -999065\n464 2001    1   -999064\n465 1994    -6  -999070\n466 2058    58  -999012\n467 1993    -7  -999019\n468 1945    -55 -999074\n469 2011    11  -999063\n470 2020    20  -999043\n471 2030    30  -999013\n472 2002    2   -999011\n473 1729    -271    -999282\n474 2217    217 -999065\n475 2015    15  -999050\n476 2078    78  -998972\n477 2003    3   -998969\n478 1937    -63 -999032\n479 1963    -37 -999069\n480 2050    50  -999019\n481 2030    30  -998989\n482 1948    -52 -999041\n483 1991    -9  -999050\n484 2195    195 -998855\n485 1790    -210    -999065\n486 1993    -7  -999072\n487 2005    5   -999067\n488 2064    64  -999003\n489 1970    -30 -999033\n490 1921    -79 -999112\n491 2100    100 -999012\n492 1975    -25 -999037\n493 2060    60  -998977\n494 1790    -210    -999187\n495 1985    -15 -999202\n496 2217    217 -998985\n497 1829    -171    -999156\n498 2167    167 -998989\n499 1823    -177    -999166\n500 2151    151 -999015\n501 2032    32  -998983\n502 1991    -9  -998992\n503 1984    -16 -999008\n504 1817    -183    -999191\n505 2156    156 -999035\n506 1963    -37 -999072\n507 2013    13  -999059\n508 1835    -165    -999224\n509 2230    230 -998994\n510 1966    -34 -999028\n511 1949    -51 -999079\n512 2012    12  -999067\n513 2064    64  -999003\n514 1780    -220    -999223\n515 2173    173 -999050\n516 1972    -28 -999078\n517 2048    48  -999030\n518 1991    -9  -999039\n519 2072    72  -998967\n520 1931    -69 -999036\n521 2031    31  -999005\n522 1991    -9  -999014\n523 2005    5   -999009\n524 1995    -5  -999014\n525 1994    -6  -999020\n526 1957    -43 -999063\n527 1833    -167    -999230\n528 2186    186 -999044\n529 1973    -27 -999071\n530 2005    5   -999066\n531 2053    53  -999013\n532 1970    -30 -999043\n533 1891    -109    -999152\n534 2086    86  -999066\n535 2005    5   -999061\n536 2054    54  -999007\n537 1872    -128    -999135\n538 2141    141 -998994\n539 1991    -9  -999003\n540 1729    -271    -999274\n541 2284    284 -998990\n542 1984    -16 -999006\n543 1932    -68 -999074\n544 2060    60  -999014\n545 1819    -181    -999195\n546 2201    201 -998994\n547 1927    -73 -999067\n548 2034    34  -999033\n549 1774    -226    -999259\n550 2219    219 -999040\n551 1973    -27 -999067\n552 1997    -3  -999070\n553 1875    -125    -999195\n554 2167    167 -999028\n555 2013    13  -999015\n556 1997    -3  -999018\n557 1860    -140    -999158\n558 2162    162 -998996\n559 1792    -208    -999204\n560 2004    4   -999200\n561 2015    15  -999185\n562 2194    194 -998991\n563 1971    -29 -999020\n564 1987    -13 -999033\n565 1997    -3  -999036\n566 1998    -2  -999038\n567 2030    30  -999008\n568 1769    -231    -999239\n569 2259    259 -998980\n570 1767    -233    -999213\n571 2000    0   -999213\n572 2168    168 -999045\n573 1978    -22 -999067\n574 1810    -190    -999257\n575 2218    218 -999039\n576 2039    39  -999000\n577 1933    -67 -999067\n578 2027    27  -999040\n579 2022    22  -999018\n580 2011    11  -999007\n581 1997    -3  -999010\n582 1845    -155    -999165\n583 2152    152 -999013\n584 2020    20  -998993\n585 1818    -182    -999175\n586 1980    -20 -999195\n587 2084    84  -999111\n588 1920    -80 -999191\n589 2178    178 -999013\n590 1998    -2  -999015\n591 1930    -70 -999085\n592 2038    38  -999047\n593 1909    -91 -999138\n594 2079    79  -999059\n595 1992    -8  -999067\n596 2006    6   -999061\n597 1996    -4  -999065\n598 2046    46  -999019\n599 2011    11  -999008\n600 1999    -1  -999009\n601 2000    0   -999009\n602 1907    -93 -999102\n603 2103    103 -998999\n604 1984    -16 -999015\n605 1988    -12 -999027\n606 2019    19  -999008\n607 1985    -15 -999023\n608 1952    -48 -999071\n609 2045    45  -999026\n610 1992    -8  -999034\n611 2014    14  -999020\n612 2014    14  -999006\n613 1750    -250    -999256\n614 2271    271 -998985\n615 1959    -41 -999026\n616 1958    -42 -999068\n617 1997    -3  -999071\n618 2011    11  -999060\n619 1974    -26 -999086\n620 2058    58  -999028\n621 1965    -35 -999063\n622 2105    105 -998958\n623 1889    -111    -999069\n624 2071    71  -998998\n625 1989    -11 -999009\n626 1734    -266    -999275\n627 2307    307 -998968\n628 1943    -57 -999025\n629 2156    156 -998869\n630 1872    -128    -998997\n631 1985    -15 -999012\n632 1848    -152    -999164\n633 2167    167 -998997\n634 1960    -40 -999037\n635 2012    12  -999025\n636 1737    -263    -999288\n637 2256    256 -999032\n638 1968    -32 -999064\n639 2047    47  -999017\n640 1983    -17 -999034\n641 1791    -209    -999243\n642 2251    251 -998992\n643 1973    -27 -999019\n644 1954    -46 -999065\n645 1864    -136    -999201\n646 2169    169 -999032\n647 1969    -31 -999063\n648 2023    23  -999040\n649 2031    31  -999009\n650 1988    -12 -999021\n651 2027    27  -998994\n652 1998    -2  -998996\n653 1988    -12 -999008\n654 1954    -46 -999054\n655 2046    46  -999008\n656 1997    -3  -999011\n657 1955    -45 -999056\n658 1880    -120    -999176\n659 2153    153 -999023\n660 2463    463 -998560\n661 1500    -500    -999060\n662 2067    67  -998993\n663 2010    10  -998983\n664 1940    -60 -999043\n665 1778    -222    -999265\n666 2220    220 -999045\n667 1789    -211    -999256\n668 2233    233 -999023\n669 1964    -36 -999059\n670 1899    -101    -999160\n671 2175    175 -998985\n672 1962    -38 -999023\n673 2016    16  -999007\n674 1894    -106    -999113\n675 2118    118 -998995\n676 1984    -16 -999011\n677 2008    8   -999003\n678 1972    -28 -999031\n679 1963    -37 -999068\n680 2001    1   -999067\n681 1869    -131    -999198\n682 2090    90  -999108\n683 2072    72  -999036\n684 1782    -218    -999254\n685 2276    276 -998978\n686 1702    -298    -999276\n687 2302    302 -998974\n688 1936    -64 -999038\n689 2034    34  -999004\n690 1988    -12 -999016\n691 1963    -37 -999053\n692 2048    48  -999005\n693 1973    -27 -999032\n694 2022    22  -999010\n695 1984    -16 -999026\n696 2022    22  -999004\n697 1989    -11 -999015\n698 2134    134 -998881\n699 1820    -180    -999061\n700 1996    -4  -999065\n701 2002    2   -999063\n702 1999    -1  -999064\n703 1830    -170    -999234\n704 2061    61  -999173\n705 2158    158 -999015\n706 1997    -3  -999018\n707 1827    -173    -999191\n708 1938    -62 -999253\n709 2277    277 -998976\n710 1990    -10 -998986\n711 1720    -280    -999266\n712 2293    293 -998973\n713 1960    -40 -999013\n714 2002    2   -999011\n715 1886    -114    -999125\n716 2154    154 -998971\n717 1956    -44 -999015\n718 2010    10  -999005\n719 1841    -159    -999164\n720 2175    175 -998989\n721 1728    -272    -999261\n722 2218    218 -999043\n723 1985    -15 -999058\n724 1867    -133    -999191\n725 1948    -52 -999243\n726 2257    257 -998986\n727 1865    -135    -999121\n728 2065    65  -999056\n729 2049    49  -999007\n730 1955    -45 -999052\n731 2046    46  -999006\n732 2003    3   -999003\n733 1744    -256    -999259\n734 2281    281 -998978\n735 1992    -8  -998986\n736 1922    -78 -999064\n737 2055    55  -999009\n738 1999    -1  -999010\n739 1807    -193    -999203\n740 2158    158 -999045\n741 1901    -99 -999144\n742 1971    -29 -999173\n743 2128    128 -999045\n744 1975    -25 -999070\n745 2015    15  -999055\n746 2041    41  -999014\n747 1986    -14 -999028\n748 1959    -41 -999069\n749 2073    73  -998996\n750 1941    -59 -999055\n751 2080    80  -998975\n752 1907    -93 -999068\n753 2045    45  -999023\n754 1851    -149    -999172\n755 2200    200 -998972\n756 1953    -47 -999019\n757 1840    -160    -999179\n758 2190    190 -998989\n759 1732    -268    -999257\n760 2295    295 -998962\n761 1952    -48 -999010\n762 1998    -2  -999012\n763 1966    -34 -999046\n764 1993    -7  -999053\n765 1992    -8  -999061\n766 1994    -6  -999067\n767 1892    -108    -999175\n768 2180    180 -998995\n769 1718    -282    -999277\n770 2262    262 -999015\n771 2023    23  -998992\n772 1981    -19 -999011\n773 1894    -106    -999117\n774 2122    122 -998995\n775 1965    -35 -999030\n776 2033    33  -998997\n777 1936    -64 -999061\n778 2056    56  -999005\n779 1750    -250    -999255\n780 2274    274 -998981\n781 1959    -41 -999022\n782 2015    15  -999007\n783 1997    -3  -999010\n784 1993    -7  -999017\n785 1810    -190    -999207\n786 2042    42  -999165\n787 1912    -88 -999253\n788 2214    214 -999039\n789 1827    -173    -999212\n790 2096    96  -999116\n791 2127    127 -998989\n792 1919    -81 -999070\n793 2056    56  -999014\n794 1953    -47 -999061\n795 2052    52  -999009\n796 1980    -20 -999029\n797 2026    26  -999003\n798 2003    3   -999000\n799 1725    -275    -999275\n800 2277    277 -998998\n801 1952    -48 -999046\n802 1906    -94 -999140\n803 2141    141 -998999\n804 1984    -16 -999015\n805 2009    9   -999006\n806 2007    7   -998999\n807 1945    -55 -999054\n808 1992    -8  -999062\n809 1997    -3  -999065\n810 1998    -2  -999067\n811 2012    12  -999055\n812 2038    38  -999017\n813 1947    -53 -999070\n814 2060    60  -999010\n815 1999    -1  -999011\n816 1990    -10 -999021\n817 1999    -1  -999022\n818 2035    35  -998987\n819 1951    -49 -999036\n820 1978    -22 -999058\n821 2018    18  -999040\n822 2014    14  -999026\n823 2019    19  -999007\n824 1982    -18 -999025\n825 2017    17  -999008\n826 2029    29  -998979\n827 1980    -20 -998999\n828 1941    -59 -999058\n829 2017    17  -999041\n830 1979    -21 -999062\n831 1894    -106    -999168\n832 1914    -86 -999254\n833 2239    239 -999015\n834 2003    3   -999012\n835 1897    -103    -999115\n836 1935    -65 -999180\n837 2193    193 -998987\n838 1982    -18 -999005\n839 1987    -13 -999018\n840 1946    -54 -999072\n841 2070    70  -999002\n842 1893    -107    -999109\n843 1946    -54 -999163\n844 2176    176 -998987\n845 1973    -27 -999014\n846 2002    2   -999012\n847 1990    -10 -999022\n848 2015    15  -999007\n849 2003    3   -999004\n850 1742    -258    -999262\n851 2412    412 -998850\n852 1782    -218    -999068\n853 2034    34  -999034\n854 1970    -30 -999064\n855 2033    33  -999031\n856 1996    -4  -999035\n857 -996970 -998970 -1998005\n858 1957    -43 -1998048\n859 1871    -129    -1998177\n860 2142    142 -1998035\n861 1796    -204    -1998239\n862 2287    287 -1997952\n863 1924    -76 -1998028\n864 2019    19  -1998009\n865 2063    63  -1997946\n866 1935    -65 -1998011\n867 1999    -1  -1998012\n868 2007    7   -1998005\n869 1996    -4  -1998009\n870 1984    -16 -1998025\n871 1957    -43 -1998068\n872 2037    37  -1998031\n873 1763    -237    -1998268\n874 2242    242 -1998026\n875 1961    -39 -1998065\n876 2020    20  -1998045\n877 1984    -16 -1998061\n878 2062    62  -1997999\n879 1980    -20 -1998019\n880 1754    -246    -1998265\n881 2284    284 -1997981\n882 1836    -164    -1998145\n883 2221    221 -1997924\n884 1936    -64 -1997988\n885 1978    -22 -1998010\n886 1853    -147    -1998157\n887 2146    146 -1998011\n888 2005    5   -1998006\n889 1993    -7  -1998013\n890 1866    -134    -1998147\n891 2164    164 -1997983\n892 1742    -258    -1998241\n893 2147    147 -1998094\n894 2081    81  -1998013\n895 1955    -45 -1998058\n896 1997    -3  -1998061\n897 2054    54  -1998007\n898 1964    -36 -1998043\n899 2032    32  -1998011\n900 1999    -1  -1998012\n901 1996    -4  -1998016\n902 1988    -12 -1998028\n903 1836    -164    -1998192\n904 2212    212 -1997980\n905 2033    33  -1997947\n906 1825    -175    -1998122\n907 2142    142 -1997980\n908 1983    -17 -1997997\n909 1925    -75 -1998072\n910 2075    75  -1997997\n911 1995    -5  -1998002\n912 1759    -241    -1998243\n913 2268    268 -1997975\n914 1828    -172    -1998147\n915 2101    101 -1998046\n916 1894    -106    -1998152\n917 2115    115 -1998037\n918 1993    -7  -1998044\n919 1934    -66 -1998110\n920 2100    100 -1998010\n921 1995    -5  -1998015\n922 1980    -20 -1998035\n923 2110    110 -1997925\n924 1945    -55 -1997980\n925 1731    -269    -1998249\n926 2305    305 -1997944\n927 1870    -130    -1998074\n928 1904    -96 -1998170\n929 2179    179 -1997991\n930 1894    -106    -1998097\n931 2090    90  -1998007\n932 2225    225 -1997782\n933 1791    -209    -1997991\n934 1954    -46 -1998037\n935 2010    10  -1998027\n936 1754    -246    -1998273\n937 2245    245 -1998028\n938 1962    -38 -1998066\n939 2001    1   -1998065\n940 2064    64  -1998001\n941 1969    -31 -1998032\n942 2060    60  -1997972\n943 2042    42  -1997930\n944 1669    -331    -1998261\n945 2292    292 -1997969\n946 1959    -41 -1998010\n947 2012    12  -1997998\n948 1931    -69 -1998067\n949 2057    57  -1998010\n950 2009    9   -1998001\n951 1825    -175    -1998176\n952 2203    203 -1997973\n953 1964    -36 -1998009\n954 2077    77  -1997932\n955 1941    -59 -1997991\n956 1988    -12 -1998003\n957 1970    -30 -1998033\n958 1980    -20 -1998053\n959 1992    -8  -1998061\n960 2001    1   -1998060\n961 2221    221 -1997839\n962 1834    -166    -1998005\n963 1993    -7  -1998012\n964 1987    -13 -1998025\n965 2026    26  -1997999\n966 1987    -13 -1998012\n967 2001    1   -1998011\n968 2004    4   -1998007\n969 1944    -56 -1998063\n970 1885    -115    -1998178\n971 2203    203 -1997975\n972 1965    -35 -1998010\n973 2049    49  -1997961\n974 1967    -33 -1997994\n975 1784    -216    -1998210\n976 2219    219 -1997991\n977 1976    -24 -1998015\n978 1973    -27 -1998042\n979 2025    25  -1998017\n980 1981    -19 -1998036\n981 1981    -19 -1998055\n982 2058    58  -1997997\n983 1969    -31 -1998028\n984 2023    23  -1998005\n985 2006    6   -1997999\n986 1810    -190    -1998189\n987 2206    206 -1997983\n988 1990    -10 -1997993\n989 1952    -48 -1998041\n990 1983    -17 -1998058\n991 2033    33  -1998025\n992 2000    0   -1998025\n993 2011    11  -1998014\n994 1864    -136    -1998150\n995 1893    -107    -1998257\n996 2287    287 -1997970\n997 1957    -43 -1998013\n998 2006    6   -1998007\n999 1957    -43 -1998050\ncounted 1000 events\n\n</code></pre>\n\n<p>Am I using the clock_gettime function wrong?\nShould I use a different timer?\nIt looks like a rollover. If this is baked into the timer read function, does anyone have an idea of how to work around it?</p>\n\n<p>Yes, I know I'm using ualarm()\nThe end target for this code is a raspberry pi. I was just playing around with the benchmark tool I made and thought I would run in on my laptop. I don't get this similar issue  on the RPi... though I have not run it more than ~10 seconds at at time...</p>\n"}, {"tags": ["c", "pointers", "struct"], "comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1553726882, "post_id": 55387517, "comment_id": 97497062, "body": "This question, as it was originally asked, has been answered. Please don&#39;t edit it into an entirely different thing. Instead, post a new question and leave this one alone."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1553728238, "post_id": 55387517, "comment_id": 97497508, "body": "^ or try debugging the program before posting a new question"}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 11220905, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-1yiIREZ1czc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdIKfaZB56Kt40yu7gCmIDoWfG86A/mo/photo.jpg?sz=128", "display_name": "Paul Heinsohn", "link": "https://stackoverflow.com/users/11220905/paul-heinsohn"}, "edited": false, "score": 0, "creation_date": 1553726534, "post_id": 55387546, "comment_id": 97496957, "body": "Yeah! Just noticed that, thank you, cant believe it hahaha. However, I&#39;m still gotting that segmentation error :("}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 0, "last_activity_date": 1553726309, "creation_date": 1553726309, "answer_id": 55387546, "question_id": 55387517, "link": "https://stackoverflow.com/questions/55387517/why-do-i-get-incompatible-pointer-type-when-assigning-pointers-to-a-multidimen/55387546#55387546", "title": "Why do I get &quot;incompatible pointer type&quot; when assigning pointers to a multidimensional array", "body": "<p><code>table[M - 1][N - 1]</code> is a <code>Node*</code>, which after <code>typedef struct node { /* ... */ } Node;</code> is applied, is a <code>struct node*</code>. <code>n -&gt; neighbours[0]</code> is a <code>struct Node*</code>. Since C is case-sensitive, those are really pointers to two completely different structs.</p>\n"}], "owner": {"reputation": 27, "user_id": 11220905, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-1yiIREZ1czc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdIKfaZB56Kt40yu7gCmIDoWfG86A/mo/photo.jpg?sz=128", "display_name": "Paul Heinsohn", "link": "https://stackoverflow.com/users/11220905/paul-heinsohn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 55387546, "answer_count": 1, "score": 1, "last_activity_date": 1553726845, "creation_date": 1553726098, "last_edit_date": 1553726845, "question_id": 55387517, "link": "https://stackoverflow.com/questions/55387517/why-do-i-get-incompatible-pointer-type-when-assigning-pointers-to-a-multidimen", "title": "Why do I get &quot;incompatible pointer type&quot; when assigning pointers to a multidimensional array", "body": "<p>I'm trying to have a matrix of nodes to save an int value that changes through every iteration based on its neighbours, so I decided that I should have a \"Node\" struct that saves its value and the list of Nodes that are near, but when compiling I get the following warning when assigning a Node to the list:</p>\n\n<blockquote>\n  <p>warning: assignment from incompatible pointer type [-Wincompatible-pointer-types] n -> neighbours[0] = table[M - 1][N - 1];</p>\n</blockquote>\n\n<p>That warning causes that my nodes won't initialize causing a segmentation error when I'm trying to access to any variable inside my structure (I think because its NULL).</p>\n\n<p>Here is my code, hope you can help me with this</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>...\ntypedef struct node {\n    int state;\n    struct Node** neighbours;\n} Node;\n\nNode* node_init(int i, int j, int M, int N, Node*** table) {\n    Node* n = malloc(sizeof(Node));\n    n -&gt; state = -1;\n    n -&gt; neighbours = malloc(sizeof(Node*)*8);\n    if (i == 0 &amp;&amp; j == 0) {  // (0, 0)\n        n -&gt; neighbours[0] = table[M - 1][N - 1];  // Here is the problem\n        n -&gt; neighbours[1] = table[M - 1][j];\n        n -&gt; neighbours[2] = table[M - 1][j + 1];\n        n -&gt; neighbours[3] = table[i][N - 1];\n        n -&gt; neighbours[4] = table[i][j + 1];\n        n -&gt; neighbours[5] = table[i + 1][N - 1];\n        n -&gt; neighbours[6] = table[i + 1][j];\n        n -&gt; neighbours[7] = table[i + 1][j + 1];\n    } ...  // for all cases\n    return n;\n\nNode*** table = malloc(sizeof(Node**)*M);          // M is the amount of rows\nfor (int i=0; i &lt; M; i++) {\n    Node** nodes = malloc(sizeof(Node*)*N);        // N is the amount of cols\n    table[i] = nodes;\n    for (int j=0; j &lt; N; j++) {\n        Node* node = node_init(i, j, M, N, table); // wont reach here\n        table[i][j] = node;\n        fscanf(fp, \"%i\", &amp;(node -&gt; state));        // ain't relevant\n\n    }\n}\n...\n</code></pre>\n\n<p>I know that the first time I do </p>\n\n<pre><code>n -&gt; neighbours[0] = table[M - 1][N - 1]\n</code></pre>\n\n<p>I'm assigning a random value that is pointed by that position of table, but I don't think that's a problem, right?</p>\n\n<p>Anyways, hope you can help me</p>\n\n<p>Thank you :)</p>\n"}, {"tags": ["c", "loops", "pointers", "linked-list", "variable-declaration"], "comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 2, "creation_date": 1553725623, "post_id": 55387393, "comment_id": 97496672, "body": "<i>just doesn&#39;t work</i> can you be more clear ? you cannot compile ? the execution fails ? What is the definition of SList ? The tag is C, is really C or C++ ?"}], "answers": [{"tags": [], "owner": {"reputation": 27279, "user_id": 857132, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4fd51ed5980999c7c6ce3729d6cb2184?s=128&d=identicon&r=PG", "display_name": "John3136", "link": "https://stackoverflow.com/users/857132/john3136"}, "is_accepted": true, "score": 2, "last_activity_date": 1553725735, "creation_date": 1553725735, "answer_id": 55387443, "question_id": 55387393, "link": "https://stackoverflow.com/questions/55387393/why-does-my-code-doesnt-work-when-i-declare-a-variable-outside-the-for-loop/55387443#55387443", "title": "Why does my code doesn&#39;t work when i declare a variable outside the for loop?", "body": "<p>In the first version you go through <code>list2</code> for every item in <code>list1</code>.</p>\n\n<p>In the second version you only go through <code>list2</code> for the first item in <code>list1</code>. You need to \"reset\" <code>iter2</code> to the start of <code>list2</code> each time.</p>\n"}], "owner": {"reputation": 1, "user_id": 11269019, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-hvJ86ASnWf4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re8K7XpvSneyaVsfCA-OyZL_gfRrA/mo/photo.jpg?sz=128", "display_name": "Matias Meroi", "link": "https://stackoverflow.com/users/11269019/matias-meroi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 55387443, "answer_count": 1, "score": -1, "last_activity_date": 1553725735, "creation_date": 1553725472, "question_id": 55387393, "link": "https://stackoverflow.com/questions/55387393/why-does-my-code-doesnt-work-when-i-declare-a-variable-outside-the-for-loop", "title": "Why does my code doesn&#39;t work when i declare a variable outside the for loop?", "body": "<p>I want to get the intersection of two linked lists but when i declare the iterators outside the for loop it just doesn't work</p>\n\n<pre><code>// THIS WORKS FINE\n\nfor (SList iter1 = list1 ; !slist_empty(iter1); iter1 = iter1-&gt;next) {\n  for(SList iter2 = list2 ; !slist_empty(iter2); iter2 = iter2-&gt;next) {\n    if(comp(iter1-&gt;data, iter2-&gt;data)) {\n      result = slist_add(result, iter1-&gt;data);\n    }\n  }\n}\n\n// THIS DOESN't\nSList iter1 = list1 ;\nSList iter2 = list2 ;\n\nfor (; !slist_empty(iter1); iter1 = iter1-&gt;next) {\n\n  for(; !slist_empty(iter2); iter2 = iter2-&gt;next) {\n    if(comp(iter1-&gt;data, iter2-&gt;data)) {\n      result = slist_add(result, iter1-&gt;data);\n    }\n  }\n}\n</code></pre>\n\n<p>im compiling with -std=c99</p>\n"}, {"tags": ["c", "arduino", "raspberry-pi", "i2c"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 9849141, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c7191fe1b1de51a33bcfe684ab759f7?s=128&d=identicon&r=PG", "display_name": "NicolasColsoul", "link": "https://stackoverflow.com/users/9849141/nicolascolsoul"}, "edited": false, "score": 0, "creation_date": 1553763404, "post_id": 55393240, "comment_id": 97507498, "body": "Thanks for your answer but it is already done. See the line <code>Wire.begin(SLAVE_ADDRESS);</code>"}, {"owner": {"reputation": 826, "user_id": 7408848, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7e5193305f5b3b3f9bf29df0ead352fb?s=128&d=identicon&r=PG&f=1", "display_name": "Hojo.Timberwolf", "link": "https://stackoverflow.com/users/7408848/hojo-timberwolf"}, "reply_to_user": {"reputation": 31, "user_id": 9849141, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c7191fe1b1de51a33bcfe684ab759f7?s=128&d=identicon&r=PG", "display_name": "NicolasColsoul", "link": "https://stackoverflow.com/users/9849141/nicolascolsoul"}, "edited": false, "score": 0, "creation_date": 1553763579, "post_id": 55393240, "comment_id": 97507602, "body": "Calling <code>SLAVE_ADDRESS</code> without defining though makes it the default. Your question was about what the slave address is correct? By defining it you will know exactly what the slave address is, or is that not the question?"}, {"owner": {"reputation": 31, "user_id": 9849141, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c7191fe1b1de51a33bcfe684ab759f7?s=128&d=identicon&r=PG", "display_name": "NicolasColsoul", "link": "https://stackoverflow.com/users/9849141/nicolascolsoul"}, "edited": false, "score": 0, "creation_date": 1553767186, "post_id": 55393240, "comment_id": 97509791, "body": "It is defined, I remove useless lines to improve visibility. <code>#define SLAVE_ADDRESS 0x04</code>"}], "tags": [], "owner": {"reputation": 826, "user_id": 7408848, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7e5193305f5b3b3f9bf29df0ead352fb?s=128&d=identicon&r=PG&f=1", "display_name": "Hojo.Timberwolf", "link": "https://stackoverflow.com/users/7408848/hojo-timberwolf"}, "is_accepted": false, "score": 0, "last_activity_date": 1553762431, "creation_date": 1553762431, "answer_id": 55393240, "question_id": 55387243, "link": "https://stackoverflow.com/questions/55387243/arduino-as-i2c-slave-talk-to-rpi/55393240#55393240", "title": "Arduino as I2C slave talk to RPi", "body": "<p>Why not define the slave address so you will know exactly what it is. Plus this will allow you to set different address if in the future you use more than 1 arduino.</p>\n\n<p>Run this line of code before Setup on the arduino. You can change the address to anything you want as long as it isn't used by another system on the I2C connection.</p>\n\n<pre><code>#define  SLAVE_ADDRESS           0x29  //slave address,any number from 0x01 to 0x7F\n</code></pre>\n\n<p>Here is a <a href=\"http://dsscircuits.com/articles/arduino-i2c-slave-guide\" rel=\"nofollow noreferrer\">Tutorial</a> discussing using Arduino as a slave</p>\n"}, {"tags": [], "owner": {"reputation": 36, "user_id": 11790854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TuILf.png?s=128&g=1", "display_name": "I A", "link": "https://stackoverflow.com/users/11790854/i-a"}, "is_accepted": false, "score": 0, "last_activity_date": 1563276130, "creation_date": 1563276130, "answer_id": 57056117, "question_id": 55387243, "link": "https://stackoverflow.com/questions/55387243/arduino-as-i2c-slave-talk-to-rpi/57056117#57056117", "title": "Arduino as I2C slave talk to RPi", "body": "<p>You need to know the correct I2C slave address that your Arduino is using. </p>\n\n<p>Luckily, Raspberry Pi has can detect any I2C device connected and show you their address using the following command: </p>\n\n<pre><code>sudo i2cdetect -y 1\n</code></pre>\n\n<p>or</p>\n\n<pre><code>sudo i2cdetect -y 0\n</code></pre>\n\n<p>Note: The first command works for all the latest Raspberry Pi3 and Pi2 (models A, B, B +) and Pi Zero. The second command is only if you are using older models. </p>\n\n<p>For more information you can have a look at <a href=\"https://www.raspberrypi-spy.co.uk/2014/11/enabling-the-i2c-interface-on-the-raspberry-pi/\" rel=\"nofollow noreferrer\">here</a> (Enable I2C) or <a href=\"https://learn.adafruit.com/adafruits-raspberry-pi-lesson-4-gpio-setup/configuring-i2c\" rel=\"nofollow noreferrer\">here</a> (Configuring I2C). Both are similar and you can just skip to the bottom where they explain how to use the above command.</p>\n"}], "owner": {"reputation": 31, "user_id": 9849141, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c7191fe1b1de51a33bcfe684ab759f7?s=128&d=identicon&r=PG", "display_name": "NicolasColsoul", "link": "https://stackoverflow.com/users/9849141/nicolascolsoul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 173, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1563276130, "creation_date": 1553724666, "question_id": 55387243, "link": "https://stackoverflow.com/questions/55387243/arduino-as-i2c-slave-talk-to-rpi", "title": "Arduino as I2C slave talk to RPi", "body": "<p>I use an Arduino as I2C slave to treat some Ultrasonic sensors and send revelant data to a Raspberry. The code running on Arduino :</p>\n\n<pre><code>void setup() {\n  // initialize i2c as slave\n  Serial.begin(9600);\n  Wire.begin(SLAVE_ADDRESS);\n  // define callbacks for i2c communication\n  Wire.onReceive(receiveData);\n  Wire.onRequest(sendData);\n\n  // useless\n}\n\nvoid loop() {\n    // useless\n} \n\n// callback for received data\nvoid receiveData(int byteCount) {\n  int i = 0;\n  while (Wire.available()) {\n    number[i] = (char) Wire.read();\n    i++;\n  }\n  number[i] = '\\0';\n  Serial.println(atoi(number));\n  if(atoi(number) != 0) { caseN = atoi(number); }\n}  \n\nint SonarSensor(int trigPin,int echoPin)\n{\n    // uselesss\n}\n\n// callback for sending data\nvoid sendData() {\n  if(caseN == 1) { Wire.write(distance1);}\n  else if(caseN == 2) { Wire.write(distance2);}\n  else if(caseN == 3) { Wire.write(distance3);}\n  else if(caseN == 4) { Wire.write(distance4);}\n  else if(caseN == 5)\n  {\n    if(state == 0)\n    {\n      state = 1;\n      digitalWrite(ledPin, HIGH);\n    }\n    else\n    {\n      state = 0;\n      digitalWrite(ledPin, LOW);\n    }\n  }\n  else { Wire.write(0); }\n}\n</code></pre>\n\n<p>I do a first version of the bus \"chat\" with Python and it works very well :</p>\n\n<pre><code>import smbus\nimport time\n\nbus = smbus.SMBus(1)\n\n\naddress = 0x04\n\ndef writeNumber(value):\n    bus.write_byte(address, value)\n    return -1\n\ndef readNumber():\n    number = bus.read_byte_data(address, 1)\n    return number\n\nwhile True:\n    data = raw_input(\"Enter the data to be sent : \")\n    data_list = list(data)\n    for i in data_list:\n        writeNumber(int(ord(i)))\n        time.sleep(.1)\n\n    writeNumber(int(0x0A))\n</code></pre>\n\n<p>I am trying to do the same in C but it looks a little bit more difficult :</p>\n\n<pre><code>#include \"i2c-dev.h\"\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;math.h&gt;\n#include &lt;string.h&gt;\n\nint main() {\n    const int adapter_nr = 1;\n    char filename[20];\n    snprintf(filename, 19, \"/dev/i2c-%d\", adapter_nr);\n    const int file = open(filename, O_RDWR);\n    if (file &lt; 0) {\n        printf(\"Unable to connect to Atmega, I2C plugged ? DC ok ?\");\n        exit(EXIT_FAILURE);\n    }\n\n    // Atmega address\n    const int addr = 0x04;\n\n    if(ioctl(file, I2C_SLAVE, addr) &lt; 0) \n    {\n        printf(\"Fail to reach Atmega\");\n        exit(EXIT_FAILURE);\n    }\n\n    const __u8 add = 5; // Ask to \"distance 5\"\n    i2c_smbus_write_byte_data(file, 0x04, add); // What is the adress ?\n\n\n    const __u8 reg = 0x0A;\n    const __s32 result = i2c_smbus_read_byte_data(file, reg);\n    if(result &lt; 0) \n    {\n        printf(\"Fail to reach Atmega reg\");\n        exit(EXIT_FAILURE);\n    } \n    else \n    {\n        printf(\"Distance %d cm \\n\", result);\n    }\n\n    close(file);\n\n    return(EXIT_SUCCESS);\n}\n</code></pre>\n\n<p>As I mentionned in the code, I don't know which register adress my Arduino slave has. I can see in the Arduino COM terminal a lot of 0 and only 0.</p>\n\n<p>I hope you will understand my problem. Thanks.</p>\n"}, {"tags": ["c"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 11265782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/903b77af3fc6baf3f9e3f72cd9ef51a2?s=128&d=identicon&r=PG&f=1", "display_name": "user11265782", "link": "https://stackoverflow.com/users/11265782/user11265782"}, "edited": false, "score": 0, "creation_date": 1553770766, "post_id": 55391466, "comment_id": 97512035, "body": "I need help to write a piece of code which will take values &quot;add, fwcommand, fwaction, fwvalue&quot; from &quot;func2&quot; inorder to reflect the same in &quot;func3&quot;.   In &quot;func3&quot; i&#39;ll be passing those values on UART by using &quot;proto485OnlyWrite(message-&gt;address, message-&gt;command, message-&gt;action, message-&gt;value);&quot; after &quot;driver485Compare()&quot; call."}], "tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": false, "score": 0, "last_activity_date": 1553754852, "creation_date": 1553754852, "answer_id": 55391466, "question_id": 55387197, "link": "https://stackoverflow.com/questions/55387197/how-to-access-values-from-one-function-with-pointer-as-an-argument-in-other-func/55391466#55391466", "title": "How to access values from one function with pointer as an argument in other function with pointer as argument?", "body": "<p>What is not working? All functions in C have <code>extern</code> applied by default, so there is no reason you can't call a function declared in one source from another. You simply have to provide a function prototype, e.g. <code>int fn_in_other_file (params);</code> for the function in the file where you want to use it <strong>before</strong> you actually use it. Just as you do when using a function within the same source file. </p>\n\n<p>The linker will resolve all symbol names when linking the object files together despite the functions being defined in separate source files. There is nothing special you need to do there.</p>\n\n<p>Take a very basic example of 3 files where the function from one file are called in another:</p>\n\n<p><strong>File 1 (<code>a.c</code>)</strong></p>\n\n<pre><code>int funA (void)\n{\n    return 2;\n}\n</code></pre>\n\n<p><strong>File 2 (<code>b.c</code>) calling <code>funA()</code></strong></p>\n\n<pre><code>int funA (void);        /* function prototype for funA() in file where it is used */\n\nint funB (void)\n{\n    return funA() + 3;\n}\n</code></pre>\n\n<p>(<strong>note:</strong> how the prototype for <code>funA()</code> is included at the beginning of <code>b.c</code> before <code>funA()</code> is called. (something normally done with header files) You can write the prototype as <code>extern int funA (void);</code> to be explicit, but there is no need, the <code>extern</code> keyword is implied.)</p>\n\n<p><strong>File 3 (<code>main.c</code>) calling <code>funB()</code></strong></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint funB(void);        /* function prototype for funB() in file where it is used */\n\nint main (void) {\n\n    printf (\"funB() : %d\\n\", funB());\n}\n</code></pre>\n\n<p>Looking at the flow you can deduce that the output from <code>main()</code> should be <code>\"funB() : 5\"</code>, so compile all three and check:</p>\n\n<pre><code>$ gcc -Wall -Wextra -pedantic-std=gnu11 -O2 a.c b.c -o bin/main main.c\n</code></pre>\n\n<p>And the expected output is:</p>\n\n<pre><code>$ ./bin/main\nfunB() : 5\n</code></pre>\n\n<p>This is the very same circumstance that you face in your question and you can apply it to solve your problem. Give it a try and let me know if you have further questions.</p>\n"}], "owner": {"reputation": 3, "user_id": 11265782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/903b77af3fc6baf3f9e3f72cd9ef51a2?s=128&d=identicon&r=PG&f=1", "display_name": "user11265782", "link": "https://stackoverflow.com/users/11265782/user11265782"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553754852, "creation_date": 1553724358, "last_edit_date": 1553749012, "question_id": 55387197, "link": "https://stackoverflow.com/questions/55387197/how-to-access-values-from-one-function-with-pointer-as-an-argument-in-other-func", "title": "How to access values from one function with pointer as an argument in other function with pointer as argument?", "body": "<p>I am developing a code in which I access the values from one function (func1) into another function (func2). Both functions have pointers as argument. I am calling \"func2\" in an other file to pass the values further for writing over UART.</p>\n\n<p>Below is code snippet:</p>\n\n<p>func1: (file one.c)</p>\n\n<pre><code>int16_t driver485Compare(uint8_t * message, uint16_t len)\n{\n  int j = 0;\n  uint8_t FWmsg[9] = {0x09,0x30,0x30,0x32,0x32,0x31,0x31,0x30,0x36};         \n  uint8_t adata[9] = {0x09,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30};  \n\n    printf(\"compare command..........\");    \n    for (j=0; j&lt;9; j++)\n    {\n      adata[j] = message[j] ;\n      printf(\"%d \",adata[j]);\n    }\n\n    if(compareArray(FWmsg,adata,7)==0)\n    {   \n      uint8_t add, fwcommand, fwaction;\n      uint16_t fwvalue;\n      GetABFWversion(&amp;message, &amp;add, &amp;fwcommand, &amp;fwaction, &amp;fwvalue);\n\n      printf(\"elements matched \\n\");\n      // HERE I NEED TO read VALUES OF add, fwcommand, fwaction, fwvalue and pass to \"message\"\n\n    }\n\n  else\n  {\n    printf(\"Arrays have different elements.\\n\");\n  } \n\n  return 0;\n}\n</code></pre>\n\n<p>func2: (file two.c)</p>\n\n<pre><code>int8_t GetABFWversion(uint8_t* add, uint8_t* fwcommand, uint8_t* fwaction, uint16_t* fwvalue)             \n{      \n    char MyCopy[10];  \n    strcpy (MyCopy, FIRMWARE_VERSION);\n    char MyCopy1[10];\n    for (int k=0; k&lt;9; k++)\n    {\n      int l=1;\n      MyCopy1[k] = MyCopy[k+l]; \n    }\n\n    char FWversion_AB[10] = {0};\n    for(int x=6;x&lt;9;x++)\n    {\n      FWversion_AB[z] = MyCopy1[x];\n      z++;\n    }\n\n    uint16_t val = atoi(FWversion_AB);\n    *add = RS485_ADDRESS;                //values read from enum\n    *fwcommand = CMD_GET_VERSION_AB;     //values read from enum\n    *fwaction = CMD_ACTION_AB;           //values read from enum\n    *fwvalue = val;\n\n// NEED TO PASS VALUES OF add, fwcommand, fwaction, fwval to \"driver485Compare()\"\n}\n</code></pre>\n\n<p>func3: (in different file (three.c))</p>\n\n<pre><code>void TaskSlave(void *p_arg) //b - communication Task\n{\n    uint8_t res; \n    rs485_message_t rs485Msg;\n\n    (void)p_arg;\n    while(1)\n    {      \n      res = driver485Read((uint8_t *)&amp;rs485Msg, RS485_MSG_LENGTH);      \n\n      res = driver485Compare((uint8_t *)&amp;rs485Msg, RS485_MSG_LENGTH); \n      //add, fwcommad, fwaction, fwval SHOULD BE REFLECTED HERE WHILE CALLING \"driver485Compare()\" IN ABOVE STATEMENT.\n\n    }      \n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 2, "creation_date": 1553723681, "post_id": 55386996, "comment_id": 97496005, "body": "Using <code>float</code> <i>how</i>?  If you&#39;re asking about the difference in behavior between two programs, then present both programs."}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 0, "creation_date": 1553723731, "post_id": 55386996, "comment_id": 97496030, "body": "What inputs? This code doesn&#39;t even take any inputs."}, {"owner": {"reputation": 432, "user_id": 4249714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe3cdf02d97c4849cdd40b4bfde7f458?s=128&d=identicon&r=PG&f=1", "display_name": "sebastian", "link": "https://stackoverflow.com/users/4249714/sebastian"}, "edited": false, "score": 0, "creation_date": 1553723934, "post_id": 55386996, "comment_id": 97496117, "body": "First you have to take the remainder, then perform the division, so you should swap <code>no&#47;=10;</code> and <code>printf(&quot;%d&quot;, no%10);</code>"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1553724263, "post_id": 55386996, "comment_id": 97496239, "body": "You cannot just give people a list of items, not say what they are, and expect people to understand it. Nobody knows what \u201c1. 2 2. 210 3. 21 4. 213\u201d is. Is it a list of inputs? Of outputs? Of intermediate values as the program goes through a sequence of steps? When you are telling people about programs and their behavior, tell them: I have this program (show the code\u2014**all** of it), I give it this input (show the input), and it gives me this output (show the output), but I expect this output (show the expected output). If you are comparing two programs show both, and the different output."}, {"owner": {"reputation": 669, "user_id": 6675878, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/29885f3542cb5b00a06b1175caa1736e?s=128&d=identicon&r=PG&f=1", "display_name": "STOPIMACODER", "link": "https://stackoverflow.com/users/6675878/stopimacoder"}, "edited": false, "score": 0, "creation_date": 1553729854, "post_id": 55386996, "comment_id": 97497948, "body": "MORE INFORMATION IS NEEDED! its kinda hard to figure out what you need help with if we don&#39;t understand the full problem"}], "answers": [{"tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": false, "score": 0, "last_activity_date": 1555054884, "creation_date": 1555054884, "answer_id": 55646754, "question_id": 55386996, "link": "https://stackoverflow.com/questions/55386996/why-does-using-float-instead-of-int-gives-me-different-results-when-all-of-my-in/55646754#55646754", "title": "Why does using float instead of int gives me different results when all of my inputs are integers?", "body": "<p>If you change <code>int no</code> to <code>float no</code>, you must also change the <code>printf</code> format to <code>%f</code> or the behavior would be undefined. Furthermore the <code>%</code> operator is not defined for <code>float</code> arguments, so what code did you actually try to get your observation?</p>\n\n<p>The reason you get different output is you perform a different computation: division behaves differently for integers and floating point numbers, <strong>except</strong> when the numerator is a multiple of the denominator.</p>\n"}], "owner": {"reputation": 1, "user_id": 9607448, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8uaj5UFQ6cw/AAAAAAAAAAI/AAAAAAAABc8/kl-AiHWFCks/photo.jpg?sz=128", "display_name": "aditya shri", "link": "https://stackoverflow.com/users/9607448/aditya-shri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1555054884, "creation_date": 1553723357, "last_edit_date": 1555054498, "question_id": 55386996, "link": "https://stackoverflow.com/questions/55386996/why-does-using-float-instead-of-int-gives-me-different-results-when-all-of-my-in", "title": "Why does using float instead of int gives me different results when all of my inputs are integers?", "body": "<pre><code>void main( )\n{\n    int no = 123;\n    while(no)\n    { \n        no /= 10;\n        printf(\"%d\", no % 10);\n    }\n}\n</code></pre>\n\n<p>Results:</p>\n\n<ul>\n<li>2</li>\n<li>210</li>\n<li>21</li>\n<li>213</li>\n</ul>\n\n<p>Why does using float instead of int gives me different results when all of my inputs are integers?</p>\n"}, {"tags": ["c", "assembly", "masm", "x86-16", "real-mode"], "comments": [{"owner": {"reputation": 3869, "user_id": 1009546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63ef706ed0517098e827bf5da5d64dfb?s=128&d=identicon&r=PG", "display_name": "battlmonstr", "link": "https://stackoverflow.com/users/1009546/battlmonstr"}, "edited": false, "score": 0, "creation_date": 1553722975, "post_id": 55386623, "comment_id": 97495736, "body": "What did you try so far? Are you able to copy 1 char for example?"}, {"owner": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "edited": false, "score": 0, "creation_date": 1553723213, "post_id": 55386623, "comment_id": 97495827, "body": "Did you compile this code as <code>large</code> model? If not, then it should be <code>...PROC NEAR</code> and instead of <code>LES...</code>,  use <code>MOV BX,[BP+4]</code>, (DS would be the data segment register)."}, {"owner": {"reputation": 635, "user_id": 11268819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bbcf115dac6447c2ca89c9dafdeecd6?s=128&d=identicon&r=PG&f=1", "display_name": "ssoBAekiL", "link": "https://stackoverflow.com/users/11268819/ssobaekil"}, "edited": false, "score": 0, "creation_date": 1553723786, "post_id": 55386623, "comment_id": 97496047, "body": "Yes is compiled as <code>large</code> and is working fine, the problem is with my assembly knowledge... So far I&#39;ve tried many <code>MOV</code> combinations like <code>MOV BARCODE[0], ES:AX</code> but that just copies the value of the pointer into the array"}, {"owner": {"reputation": 635, "user_id": 11268819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bbcf115dac6447c2ca89c9dafdeecd6?s=128&d=identicon&r=PG&f=1", "display_name": "ssoBAekiL", "link": "https://stackoverflow.com/users/11268819/ssobaekil"}, "edited": false, "score": 0, "creation_date": 1553725749, "post_id": 55386623, "comment_id": 97496713, "body": "Yes, I just need to copy the values I recive into the array"}], "answers": [{"tags": [], "owner": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "is_accepted": false, "score": 1, "last_activity_date": 1553731553, "last_edit_date": 1553731553, "creation_date": 1553722955, "answer_id": 55386913, "question_id": 55386623, "link": "https://stackoverflow.com/questions/55386623/how-can-i-copy-memory-data-from-pointer-to-array-assembly-8086/55386913#55386913", "title": "How can I copy memory data from pointer to array ASSEMBLY 8086", "body": "<p>You can use</p>\n\n<pre><code>        mov     al,es:[bx]\n</code></pre>\n\n<p>to read a character from the string, but since this is large model, you'll need to create a far pointer to BARCODE. You might want to consider using ds:si for the input, and es:di for the output, since that would allow the code to lodsb and stosb.</p>\n"}, {"comments": [{"owner": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "edited": false, "score": 1, "creation_date": 1553738544, "post_id": 55388652, "comment_id": 97499834, "body": "As an option, a far pointer to BARCODE could be defined in the local code segment, then a LES DI,... could be used to load that pointer."}, {"owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "reply_to_user": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "edited": false, "score": 0, "creation_date": 1553738827, "post_id": 55388652, "comment_id": 97499893, "body": "@rcgldr : That is very true and also what many of the high level languages emit for memory models with far data as a default. I wasn&#39;t going to make it any more confusing than it already is lol. But you are right."}, {"owner": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "edited": false, "score": 1, "creation_date": 1553741220, "post_id": 55388652, "comment_id": 97500351, "body": "In MASM, there is an optional syntax for pointer parameter:  barcodestr:PTR.  This would default to far pointer for large model. barcodestr:FAR PTR could also be used.  For codeview, declaring the qualifier type (BYTE, WORD, DWORD), such as barcodestr:FAR PTR BYTE would help if using codeview to view data."}], "tags": [], "owner": {"reputation": 41564, "user_id": 3857942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hXLnN.jpg?s=128&g=1", "display_name": "Michael Petch", "link": "https://stackoverflow.com/users/3857942/michael-petch"}, "is_accepted": true, "score": 2, "last_activity_date": 1575221064, "last_edit_date": 1575221064, "creation_date": 1553734669, "answer_id": 55388652, "question_id": 55386623, "link": "https://stackoverflow.com/questions/55386623/how-can-i-copy-memory-data-from-pointer-to-array-assembly-8086/55388652#55388652", "title": "How can I copy memory data from pointer to array ASSEMBLY 8086", "body": "<p>In the large memory model all data and code is FAR and must be referenced through the proper segment. In the code below I load the pointer to the source string <code>barcodestr</code> into <em>DS:SI</em> and <code>BARCODE</code> into <em>ES:DI</em>. I then read the character from the <code>barcodestr</code> array with <a href=\"https://www.felixcloutier.com/x86/lods:lodsb:lodsw:lodsd:lodsq\" rel=\"nofollow noreferrer\">LODSB</a> and save it to <code>BARCODE</code> with <a href=\"https://www.felixcloutier.com/x86/stos:stosb:stosw:stosd:stosq\" rel=\"nofollow noreferrer\"><code>STOSB</code></a>. The copy is finished when the NUL terminator has been reached. </p>\n\n<p>Assuming the Direction Flag (DF) is set to 0 (forward movement):</p>\n\n<ul>\n<li><p><a href=\"https://www.felixcloutier.com/x86/stos:stosb:stosw:stosd:stosq\" rel=\"nofollow noreferrer\"><code>STOSB</code></a> is similar<sup>1</sup> to doing:</p>\n\n<pre><code>mov [ES:DI], al\nlea di, [DI + 1]              ; Increment DI by 1 without altering flags\n</code></pre></li>\n<li><p><a href=\"https://www.felixcloutier.com/x86/lods:lodsb:lodsw:lodsd:lodsq\" rel=\"nofollow noreferrer\"><code>LODSB</code></a> is similar<sup>1</sup> to doing:</p>\n\n<pre><code>mov al, [DS:SI]\nlea si, [SI + 1]              ; Increment SI by 1 without altering flags\n</code></pre></li>\n</ul>\n\n<p>I don't know if you are using MASM or TASM as an assembler so I provide a version for both. Example TASM code that simply copies a NUL terminated string is as follows:</p>\n\n<pre><code>.MODEL LARGE, C\n\nPUBLIC computeControlDigit\n\n_DATA SEGMENT WORD PUBLIC 'DATA'\n    BARCODE DB 13 DUP(?)\n_DATA ENDS\n\n_TEXT SEGMENT WORD PUBLIC 'TEXT'\nASSUME DS:_DATA, CS:_TEXT\n\ncomputeControlDigit PROC C FAR\n    ARG %%barcodestr:DWORD      ; barcodestr is a FAR pointer (DWORD)\n    USES DS, SI, DI             ; Save non-volatile registers\n\n    MOV AX, SEG BARCODE         ; Get segment and offset (FAR PTR) of BARCODE\n    MOV ES, AX                  ; into ES:DI\n    MOV DI, OFFSET BARCODE\n\n    LDS SI, %%barcodestr        ; Load barcodestr FAR pointer into DS:SI\n    JMP %%GETCHAR               ; Get next character\n\n%%NEXTCHAR:\n    STOSB                       ; Store character to ES:DI (BARCODE), DI++\n%%GETCHAR:\n    LODSB                       ; Read character from DS:SI (barcodestr), SI++\n    TEST AL, AL                 ; Is it a NUL terminator?\n    JNZ %%NEXTCHAR              ;     If not go back and get next character\n\n%%ENDLOOP:\n    STOSB                       ; Store NUL terminator at end of BARCODE\n\n    RET\n\ncomputeControlDigit ENDP\n_TEXT ENDS\nEND\n</code></pre>\n\n<p>Of course you do whatever processing you choose. I just did a straight copy of the data as an example.</p>\n\n<p>If using MASM you may have to use a slightly different syntax:</p>\n\n<pre><code>.MODEL LARGE, C\n\nPUBLIC computeControlDigit\n\n_DATA SEGMENT WORD PUBLIC 'DATA'\n    BARCODE DB 13 DUP(?)\n_DATA ENDS\n\n_TEXT SEGMENT WORD PUBLIC 'TEXT'\nASSUME DS:_DATA, CS:_TEXT\n\ncomputeControlDigit PROC FAR C USES DS SI DI barcodestr:DWORD    \n; DS, SI, DI are saved as they are non-volatile registers\n; barcodestr is a FAR pointer (DWORD)\n\n    MOV AX, SEG BARCODE         ; Get segment and offset (FAR PTR) of BARCODE\n    MOV ES, AX                  ; into ES:DI\n    MOV DI, OFFSET BARCODE\n\n    LDS SI, barcodestr          ; Load barcodestr FAR pointer into DS:SI\n    JMP GETCHAR                 ; Get next character\n\nNEXTCHAR:\n    STOSB                       ; Store character to ES:DI (BARCODE), DI++\nGETCHAR:\n    LODSB                       ; Read character from DS:SI (barcodestr), SI++\n    TEST AL, AL                 ; Is it a NUL terminator?\n    JNZ NEXTCHAR                ;     If not go back and get next character\n\n    STOSB                       ; Store NUL terminator at end of BARCODE\n\n    RET\n\ncomputeControlDigit ENDP\n_TEXT ENDS\nEND\n</code></pre>\n\n<p>A raw version without using special assembler directives that may look more natural to you would be:</p>\n\n<pre><code>                PUBLIC  _computeControlDigit\n\n_DATA           SEGMENT WORD PUBLIC USE16 'DATA'\nBARCODE:\n    DB  13 DUP(?)    \n_DATA           ENDS\n\n_TEXT           SEGMENT WORD PUBLIC USE16 'TEXT'\n                ASSUME CS:_TEXT, DS:_DATA\n\n_computeControlDigit:\n        push            bp\n        mov             bp,sp\n        push            ds\n        push            si\n        push            di\n        mov             ax,seg BARCODE\n        mov             es,ax\n        mov             di,offset BARCODE\n        lds             si,dword ptr 6[bp]\n        jmp             GETCHAR\nNEXTCHAR:\n        stosb\nGETCHAR:\n        lodsb\n        test            al,al\n        jne             NEXTCHAR\n        stosb\n        pop             di\n        pop             si\n        pop             ds\n        pop             bp\n        retf\n_TEXT           ENDS\n                END\n</code></pre>\n\n<hr>\n\n<h2>Footnote</h2>\n\n<ul>\n<li><sup>1</sup><code>LODSB</code> and <code>STOSB</code> are <strong>similar</strong> to the equivalent code shown with the exception that <code>LODSB</code> and <code>STOSB</code> are executed in their entirety as one instruction each.</li>\n</ul>\n"}], "owner": {"reputation": 635, "user_id": 11268819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bbcf115dac6447c2ca89c9dafdeecd6?s=128&d=identicon&r=PG&f=1", "display_name": "ssoBAekiL", "link": "https://stackoverflow.com/users/11268819/ssobaekil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 487, "favorite_count": 0, "accepted_answer_id": 55388652, "answer_count": 2, "score": 2, "last_activity_date": 1575221064, "creation_date": 1553721586, "last_edit_date": 1575123093, "question_id": 55386623, "link": "https://stackoverflow.com/questions/55386623/how-can-i-copy-memory-data-from-pointer-to-array-assembly-8086", "title": "How can I copy memory data from pointer to array ASSEMBLY 8086", "body": "<p>I'm working on a C program that calls an assembly function passing an array as argument.\nIn the assembly code (for 8086), I'm able to get the address of the array in memory and to save the address in <code>ES:BX</code> but after that I need to copy the values to the array <code>BARCODE</code> but I can't find any way of achieving that.</p>\n\n<p>My code looks something like this:</p>\n\n<p>Code:</p>\n\n<pre><code>unsigned char computeControlDigit(char* barCodeASCII);\n\nint main( void ){\nchar barCodeStr[14]\nunsigned char controlDigitCheck;\n\ncontrolDigitCheck = computeControlDigit(barCodeStr);\n}\n</code></pre>\n\n<p>Assemby code:</p>\n\n<pre><code>_DATA SEGMENT WORD PUBLIC 'DATA'\n    BARCODE DB 13 DUP(?)\n_DATA ENDS\n\nPUBLIC _computeControlDigit                     \n_computeControlDigit PROC FAR\n    PUSH BP \n    MOV BP, SP\n    PUSH ES\n    LES BX, [BP+6]\n\n    ; code to copy from memory to\n    ; array and code of operations on the array\n\n    POP ES\n    POP BP\n    RET\n_computeControlDigit ENDP                           \n_TEXT ENDS\nEND\n</code></pre>\n\n<p>Any help would be wery welcome.</p>\n"}, {"tags": ["c", "gcc", "linker"], "answers": [{"tags": [], "owner": {"reputation": 62, "user_id": 3980725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2b9c6f3fa1ae19e03b399d49605e85f?s=128&d=identicon&r=PG&f=1", "display_name": "Hezix", "link": "https://stackoverflow.com/users/3980725/hezix"}, "is_accepted": true, "score": 0, "last_activity_date": 1554747585, "creation_date": 1554747585, "answer_id": 55579520, "question_id": 55386402, "link": "https://stackoverflow.com/questions/55386402/is-there-a-way-to-throw-a-link-time-error-if-a-variable-is-initialized-at-declar/55579520#55579520", "title": "Is there a way to throw a link time error if a variable is initialized at declaration and linked to a NOLOAD section?", "body": "<p>After a few different attempts, and a lack of answers here, I've concluded that this cannot be enforced with current GCC.</p>\n\n<p>A solution would be to write a build time script to scan the source and throw the error when a variable declaration for a symbol located in a no init section is initialized.</p>\n"}], "owner": {"reputation": 62, "user_id": 3980725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2b9c6f3fa1ae19e03b399d49605e85f?s=128&d=identicon&r=PG&f=1", "display_name": "Hezix", "link": "https://stackoverflow.com/users/3980725/hezix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25, "favorite_count": 0, "accepted_answer_id": 55579520, "answer_count": 1, "score": 1, "last_activity_date": 1554747585, "creation_date": 1553720548, "last_edit_date": 1553721847, "question_id": 55386402, "link": "https://stackoverflow.com/questions/55386402/is-there-a-way-to-throw-a-link-time-error-if-a-variable-is-initialized-at-declar", "title": "Is there a way to throw a link time error if a variable is initialized at declaration and linked to a NOLOAD section?", "body": "<p>I have a variable initialized when declared that is also marked to be linked into a NOLOAD section, i.e. :</p>\n\n<pre><code>struct mystruct_s mystruct __attribute((section(\".noload_sec\"))) =\n{\n    .something = 100,\n    .something_else = 100,\n};\n</code></pre>\n\n<p>Is there a way for the linker to automatically detect this invalid condition? Meaning can we error if someone tries to initialize a variable at declaration which is located into a section which will not be loaded?</p>\n"}, {"tags": ["c", "for-loop"], "comments": [{"owner": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 4, "creation_date": 1553720205, "post_id": 55386290, "comment_id": 97494495, "body": "<code>for(i = 3; i == 100</code> - the condition is always false"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 3, "creation_date": 1553720222, "post_id": 55386290, "comment_id": 97494504, "body": "I have never seen a prime number generator that uses real numbers. Comparing them is fraught with difficulty \u2014 better to use one of several integer solutions that are around."}, {"owner": {"reputation": 109324, "user_id": 21926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6e61d47f9a6ec0a7a286835e51f3332?s=128&d=identicon&r=PG", "display_name": "Sean Bright", "link": "https://stackoverflow.com/users/21926/sean-bright"}, "edited": false, "score": 0, "creation_date": 1553720268, "post_id": 55386290, "comment_id": 97494529, "body": "Agreed, <code>float</code>s and <code>double</code>s are lossy by definition."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 0, "creation_date": 1553720340, "post_id": 55386290, "comment_id": 97494562, "body": "I wish I could up-check the comment from @UnholySheep several times, same with <code>for(divider = 2; divider == k;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 9760927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/937ef665db7ba5be5aa8dab0d4575ccc?s=128&d=identicon&r=PG&f=1", "display_name": "L.edwards", "link": "https://stackoverflow.com/users/9760927/l-edwards"}, "edited": false, "score": 0, "creation_date": 1553790607, "post_id": 55386436, "comment_id": 97525754, "body": "Thank you, yes that makes sense now and I feel like a total dumbo now"}], "tags": [], "owner": {"reputation": 2928, "user_id": 5927758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QmcMj.png?s=128&g=1", "display_name": "Mitch", "link": "https://stackoverflow.com/users/5927758/mitch"}, "is_accepted": true, "score": 2, "last_activity_date": 1553720681, "creation_date": 1553720681, "answer_id": 55386436, "question_id": 55386290, "link": "https://stackoverflow.com/questions/55386290/my-for-loop-isnt-working-but-not-inciting-an-error-message-what-could-it-be/55386436#55386436", "title": "My For-Loop isn&#39;t working but not inciting an error message - what could it be?", "body": "<p>I think you have mixed up how for loops work </p>\n\n<p>The for loop will run as long as the condition is true until it becomes false. What you believe is the for loop will run as long as the condition is false until it becomes true. </p>\n\n<p>So <code>for(i = 3; i == 100; i++)</code> should be <code>for (i = 3; i &lt; 100; i++)</code> </p>\n\n<p>This now says keep incrimenting <code>i</code> while it is less than 100. Your previoius loop said increment <code>i</code> while it is 100. Which it never is</p>\n"}], "owner": {"reputation": 35, "user_id": 9760927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/937ef665db7ba5be5aa8dab0d4575ccc?s=128&d=identicon&r=PG&f=1", "display_name": "L.edwards", "link": "https://stackoverflow.com/users/9760927/l-edwards"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 55386436, "answer_count": 1, "score": 0, "last_activity_date": 1553720681, "creation_date": 1553720082, "question_id": 55386290, "link": "https://stackoverflow.com/questions/55386290/my-for-loop-isnt-working-but-not-inciting-an-error-message-what-could-it-be", "title": "My For-Loop isn&#39;t working but not inciting an error message - what could it be?", "body": "<p><strong>Hi All,</strong></p>\n\n<p>I'm creating a prime-number checker as a part of a project - I'm using a For-Loop to iterate for each number and another to iterate each number below it to work out if it's prime. However, neither of the loops work. I've checked it against other working For-Loops i've created and with friends and neither have helped at all (sorry friends). Any help given will be appreciated and i'll forever hold you in high praise :)</p>\n\n<p>As just stated, i've checked against other pieces and with my friends. i've also tried running the code within the loops separately and the code does indeed work.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n//int FinalPrimeArray[sizeof(Primes)];\n//int FinalNotPrimesArray[sizeof(NotPrimes)];\n\nint main()\n{\n    //int Pos = 0;\n    int Pos2 = 0;\n    int i = 3;\n    int k;\n    int divider = 2;\n    int productint;\n    float productintasfloat;\n    float productfloat;\n\n    int Primes[100];\n    //int NotPrimes[100];\n\n    //Test Block (start)\n    float i2 = i;\n    float divider2 = divider;\n    productfloat = i2 / divider2;\n    printf(\"float type is: %f \\n\", productfloat);\n    productint = i / divider;\n    productintasfloat = productint;\n    printf(\"integer type is: %d \\n\", productint);\n    if(productintasfloat == productfloat)\n    {\n        printf(\"yes\");\n    }\n    //Test Block (end)\n\n    printf(\"Calculating all prime numbers in 3-100\");\n    for(i = 3; i == 100; i++)\n    {\n        printf(\"1\");\n        k = i - 1;\n        for(divider = 2; divider == k; divider++)\n        {\n            printf(\"2\");\n            float i2 = i;\n            float divider2 = divider;\n            productfloat = i2 / divider2;\n            printf(\"float type is: %f \\n\", productfloat);\n            productint = i / divider;\n            productintasfloat = productint;\n            printf(\"integer type is: %d \\n\", productint);\n            if(productintasfloat == productfloat)\n            {\n                Primes[Pos2] = i;\n                Pos2++;\n            }\n        }\n    }\n\n    return 0;\n}\n\n</code></pre>\n\n<p>I would expect it to iterate 97 times (for the first loop), each main iteration iterating 'i - 1' times in turn. As surely made quite clear by now... this is not the case. When ran I get no error-messages, it prints the two lines of code from the text block and the \"3-100\" message. Then nothing, no error message or further output. However, the code does terminate (Stop symbol, greys out - usually coloured and clickable when code is running) </p>\n\n<p>Any help would be much appreciated and if no one can help... well i guess i'll have to find another way around it. While I would prefer any fixes to remain close to my intended method (I'm not trying to be a ChoosingBeggar) any fix at all would be much appreciated :)</p>\n\n<p>-> Budding Developer</p>\n\n<p>If i've missed any useful information and you want to help - don't be afraid to ask.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 4328, "user_id": 920069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd39f0db1f22e1314746491df063602a?s=128&d=identicon&r=PG", "display_name": "Retired Ninja", "link": "https://stackoverflow.com/users/920069/retired-ninja"}, "edited": false, "score": 0, "creation_date": 1553734030, "post_id": 55386221, "comment_id": 97498905, "body": "After your for loop, what is the value of <code>i</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 5994, "user_id": 5698738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4tnZ9.jpg?s=128&g=1", "display_name": "Aganju", "link": "https://stackoverflow.com/users/5698738/aganju"}, "is_accepted": false, "score": 1, "last_activity_date": 1553720005, "creation_date": 1553720005, "answer_id": 55386268, "question_id": 55386221, "link": "https://stackoverflow.com/questions/55386221/incrementing-variable-changes-my-pointer-to-pointer-array-values/55386268#55386268", "title": "Incrementing variable changes my pointer to pointer array values", "body": "<p><code>i</code> starts with an undefined random value, and therefore the behavior is <em>undefined</em>.</p>\n\n<p>Note that <code>int i, j=0;</code> does <em>not</em> initialize <code>i</code> - it only initializes <code>j</code>.</p>\n\n<p>Aside from that, <code>vtab</code> is declared a pointer to a pointer to an int, but it is never set to point anywhere, so it too points to a random memory address.</p>\n"}], "owner": {"reputation": 1, "user_id": 11268749, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nnujGh4HKkQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdKwHp-y-EdRugEIK-HvfRs30toQg/mo/photo.jpg?sz=128", "display_name": "francisco cunha", "link": "https://stackoverflow.com/users/11268749/francisco-cunha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1553748725, "creation_date": 1553719760, "last_edit_date": 1553748725, "question_id": 55386221, "link": "https://stackoverflow.com/questions/55386221/incrementing-variable-changes-my-pointer-to-pointer-array-values", "title": "Incrementing variable changes my pointer to pointer array values", "body": "<p>Trying to create a table from a document formated as a table, but the value stored in the table changes after i++, why is that ?</p>\n\n<pre><code>int i, c, j=0;\nint **vtab;\n\n// C and L stands for columns ans lines\n\n/* allocate memory for int value table   */\n    vtab = (int **) malloc( L * sizeof( int *));\n    for ( i=0; i&lt;L; i++)\n    {\n        vtab[i]= (int *) malloc( C * sizeof( int ));\n    }\n\n\ndo {\n  c = (fgetc(fp) - 10); /* This function returns the character read as an unsigned char cast to an int or EOF on end of file or error. */\n  if( feof(fp) ) {\n     break ;\n  }\n  printf(\"%c\", c);\n  if (c != 32){\n    if ( j&gt;C ){\n        j=0;\n        i++;\n    }\n    vtab[i][j] = c;\n    ++j;\n  }\n} while(1);\n</code></pre>\n"}, {"tags": ["c", "file", "search", "io"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1553721015, "post_id": 55386203, "comment_id": 97494888, "body": "<code>fseek</code> and <code>rewind</code> make no sense here. The code returns to the beginning of the file (rewind), and then immediately turns around and goes back to the exact same it was a moment ago (fseek). The two calls can be just removed."}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1553721813, "post_id": 55386203, "comment_id": 97495261, "body": "When will <code>fread()</code> return EOF?"}, {"owner": {"reputation": 91, "user_id": 11045534, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WB_KgWspIVo/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOKtwlXXhfl00hDyl9r-WMFLDRhHQ/mo/photo.jpg?sz=128", "display_name": "Deeswoc", "link": "https://stackoverflow.com/users/11045534/deeswoc"}, "edited": false, "score": 0, "creation_date": 1553724964, "post_id": 55386203, "comment_id": 97496470, "body": "Zing, Offset is initialized to zero yes so it would start from the beginning and increment. I&#39;m not sure if the pointer location was going to stay at the same positions between iterations so I offset it manually."}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 11045534, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WB_KgWspIVo/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOKtwlXXhfl00hDyl9r-WMFLDRhHQ/mo/photo.jpg?sz=128", "display_name": "Deeswoc", "link": "https://stackoverflow.com/users/11045534/deeswoc"}, "edited": false, "score": 0, "creation_date": 1553724459, "post_id": 55386743, "comment_id": 97496320, "body": "So if I repeatedly call fread() it will move the pointer through the file like fscanf() would?"}, {"owner": {"reputation": 91, "user_id": 11045534, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WB_KgWspIVo/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOKtwlXXhfl00hDyl9r-WMFLDRhHQ/mo/photo.jpg?sz=128", "display_name": "Deeswoc", "link": "https://stackoverflow.com/users/11045534/deeswoc"}, "edited": false, "score": 0, "creation_date": 1553750984, "post_id": 55386743, "comment_id": 97502509, "body": "Thanks. I now understand this. I should be reading it sequentially and comparing each read with the data inputted. As for what you mentioned with Gaps to ensure that I don&#39;t leave gaps I should assume I can just read sequentially until an empty struct, or &quot;deleted struct&quot; is found and overwrite that. And to actually edit the data I&#39;ll have to offset the pointer negatively by the size of the structs I&#39;m writing. Thank you for the explanation."}, {"owner": {"reputation": 4024, "user_id": 3307686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dd8d815759c23dd52428c7cc0c35324?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Holt", "link": "https://stackoverflow.com/users/3307686/mike-holt"}, "reply_to_user": {"reputation": 91, "user_id": 11045534, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WB_KgWspIVo/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOKtwlXXhfl00hDyl9r-WMFLDRhHQ/mo/photo.jpg?sz=128", "display_name": "Deeswoc", "link": "https://stackoverflow.com/users/11045534/deeswoc"}, "edited": false, "score": 0, "creation_date": 1553752034, "post_id": 55386743, "comment_id": 97502805, "body": "@Deeswoc By &quot;gaps&quot;, I was referring to gaps in the sequence of id values within the file. Not gaps in the data where there is e.g., nothing but zeros or something like that. The point was that if you&#39;re looking up by id, and calculating the offset for that id in the file, then you&#39;re assuming that every id in the sequence up until that point exists in the file. For instance, if you&#39;re looking up id 5, but your file only contains records for ids 1,2, and 5, then how do you calculate the correct offset? Certainly not with <code>(id - 1) * sizeof(User)</code>."}, {"owner": {"reputation": 4024, "user_id": 3307686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dd8d815759c23dd52428c7cc0c35324?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Holt", "link": "https://stackoverflow.com/users/3307686/mike-holt"}, "reply_to_user": {"reputation": 91, "user_id": 11045534, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WB_KgWspIVo/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOKtwlXXhfl00hDyl9r-WMFLDRhHQ/mo/photo.jpg?sz=128", "display_name": "Deeswoc", "link": "https://stackoverflow.com/users/11045534/deeswoc"}, "edited": false, "score": 0, "creation_date": 1553752229, "post_id": 55386743, "comment_id": 97502869, "body": "@Deeswoc And of course this means that repeated ids cannot exist either, e.g., a file with records for ids 1,1,2,3,4,4,5. In that case, <code>(id - 1) * sizeof(User)</code> also gives an incorrect offset, even though there are no gaps."}], "tags": [], "owner": {"reputation": 4024, "user_id": 3307686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dd8d815759c23dd52428c7cc0c35324?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Holt", "link": "https://stackoverflow.com/users/3307686/mike-holt"}, "is_accepted": true, "score": 0, "last_activity_date": 1553722502, "last_edit_date": 1553722502, "creation_date": 1553722194, "answer_id": 55386743, "question_id": 55386203, "link": "https://stackoverflow.com/questions/55386203/trying-to-search-a-random-access-file-using-a-string/55386743#55386743", "title": "Trying to search a random access file using a string", "body": "<p>Your first example is assuming that the file consists of fixed-length <code>User</code> records, arranged by id number, with no gaps. The record for id 1 would be at offset 0, and the record for id <code>N</code> would be at <code>(N - 1) * sizeof(User)</code>. If that's what the file actually contains, this is a reasonable assumption.</p>\n\n<p>The code in the bottom part of your question seems to be suffering from an identity crisis. It can't figure out if records are sequential and ordered by id, or if the file needs to be searched by matching on <code>username</code>. It's an unworkable hybrid of two different lookup methods. You need to pick one method and go with it. </p>\n\n<p>If the file is ordered by id and contains no gaps (and you're searching by id), you don't need to search in a <code>while</code> loop. </p>\n\n<p>On the other hand, if the file is either unordered, or contains gaps, then it is necessary to search. In that case, then the <code>fseek</code> and <code>rewind</code> calls are not needed. Just start from the beginning of the file and read every record sequentially, one at a time, until you find the one matching the requested username.</p>\n\n<p>Also, comparing the return value of <code>fread</code> with <code>EOF</code> is wrong. The <code>fread</code> function returns the number of items actually read. If the returned number is not equal to the number of items you specified in the call, then either there was a read error, or you've hit the end of file. The <code>EOF</code> constant is intended for use with functions like <code>fgetc</code> that return <em>character</em> values.</p>\n"}], "owner": {"reputation": 91, "user_id": 11045534, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WB_KgWspIVo/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOKtwlXXhfl00hDyl9r-WMFLDRhHQ/mo/photo.jpg?sz=128", "display_name": "Deeswoc", "link": "https://stackoverflow.com/users/11045534/deeswoc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 55386743, "answer_count": 1, "score": 0, "last_activity_date": 1553722502, "creation_date": 1553719715, "question_id": 55386203, "link": "https://stackoverflow.com/questions/55386203/trying-to-search-a-random-access-file-using-a-string", "title": "Trying to search a random access file using a string", "body": "<p>I can search a random access file without any issues but the problem is I don't understand how it actually works. </p>\n\n<p>Previously i searched a random access file using the method </p>\n\n<pre><code> FILE fpnt = fopen(FILE_NAME, \"rb+\");\n\n User tempUser = {\"\", \"\", 0, \"\", 0};\n printf(\"Enter the id number of the user to find\\n\");\n scanf(\"%d\", idNum);\n fseek(fpnt, (idNum - )* sizeof(User), SEEK_SET);\n fread(&amp;tempUser, sizeof(User), 1, fpnt) != EOF &amp;&amp; found == 0;\n</code></pre>\n\n<p>I don't understand how this always finds the correct user when ass the offset isn't always necessarily the same as the ID i would assume. But the problem lies with when I'm trying to access files by using data other than integers. </p>\n\n<p>for example, I'm trying to find users by their names which are strings. the method I use is the following:</p>\n\n<pre><code> typedef enum tUserLevel {\n     MANAGER = 1,\n     CLERK = 0,\n     NOTFOUND = 9001\n }level;\n\n\n typedef struct tUser {\n     char userName[20];\n     char password[20];\n     level priviledgeLevel;\n }User;\n\ndo {\n    fseek(fpnt, offSet * sizeof(User), SEEK_SET);\n    if (fread(&amp;tempUser, sizeof(User), 1, fpnt) == EOF)\n        endOfFile = EOF;        \n    rewind(fpnt);\n    offSet++;\n} while (endOfFile!=EOF &amp;&amp; !strcmp(username, tempUser.userName));\n\nif (endOfFile==EOF&amp;&amp; strcmp(username, tempUser.userName)) {\n    printf(\"The User was not found\\n\");\n    return noUser;\n\n    //return noUser;\n}\n</code></pre>\n\n<p>So what is supposed to happen is the file will check each user for the entered username (that's the variable called username) and compare the two and stop if both are correct. I'm not sure how this is actually looping though or if the offset affects the pointer in the file the way I want. What DOES happen is I'm always getting EOF so that portion of the code always run even after one read. I had 4 test users Is there a better way to search for these files by string so I can read them and edit them in the file or is this the best way and I'm messing it up somewhere?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 16513, "user_id": 6770384, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kXCNG.png?s=128&g=1", "display_name": "Socowi", "link": "https://stackoverflow.com/users/6770384/socowi"}, "edited": false, "score": 1, "creation_date": 1553719083, "post_id": 55385984, "comment_id": 97493931, "body": "Where is the least significant digit stored, in the first array entry (index 0) or the last one? It would be helpful to have an example with one input <code>n=...</code> and the expected resulting array."}, {"owner": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "reply_to_user": {"reputation": 16513, "user_id": 6770384, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kXCNG.png?s=128&g=1", "display_name": "Socowi", "link": "https://stackoverflow.com/users/6770384/socowi"}, "edited": false, "score": 0, "creation_date": 1553719229, "post_id": 55385984, "comment_id": 97494012, "body": "@Socowi it doesn&#39;t really matter for me if the number is at the end or at the beginning of the array. I guess it would be easier to make the algorithm at the end. For example for n=9 the array should be 00000...000512"}, {"owner": {"reputation": 16513, "user_id": 6770384, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kXCNG.png?s=128&g=1", "display_name": "Socowi", "link": "https://stackoverflow.com/users/6770384/socowi"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1553719370, "post_id": 55385984, "comment_id": 97494080, "body": "@EugeneSh. I don&#39;t think so. At least a naive (and very slow) solution should be fairly easy to implement: Implement multiplication of two decimal numbers represented as digits of arrays, then use a loop to calculate 2*2*2*...*2. I think I start working on it right now :)"}, {"owner": {"reputation": 360, "user_id": 3492498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b22bd84245bf80211b37cc5ccf73def?s=128&d=identicon&r=PG&f=1", "display_name": "Nish", "link": "https://stackoverflow.com/users/3492498/nish"}, "edited": false, "score": 0, "creation_date": 1553720026, "post_id": 55385984, "comment_id": 97494412, "body": "do you already have proprietary structure to store those numbers? Another method would be do deal only in terms of log to base 2 for all processing and just convert it /print it in the method which you already might have in your code."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1553720480, "post_id": 55385984, "comment_id": 97494634, "body": "@DarkAtom You probably need to apply some trick <a href=\"https://headinside.blogspot.com/2014/10/calculate-powers-of-2-in-your-head.html\" rel=\"nofollow noreferrer\">like this one</a>. &quot;<i>Start by breaking up the given power of 2 into the largest multiple of 10 which is equal to or less than the given power, and multiply it by whatever amount is leftover, which will be a number from 0 to 9.</i>&quot;"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1553720612, "post_id": 55385984, "comment_id": 97494695, "body": "I don&#39;t see any easy solution other than the dumb straight-forward &quot;long&quot; multiplication. Well, it can be optimized by recursively calculating and multiplying <code>2^(n&#47;2)</code>, but still dumb."}, {"owner": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1553720862, "post_id": 55385984, "comment_id": 97494811, "body": "@EugeneSh. If you could be kind enough to share that method, I would be very grateful."}, {"owner": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "edited": false, "score": 0, "creation_date": 1553720933, "post_id": 55385984, "comment_id": 97494846, "body": "@Clifford well I prefer to call it an array of unsigned chars for this purpose, because a string is usually used to store text. For the compiler though, they are the same exact thing."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 2, "creation_date": 1553720947, "post_id": 55385984, "comment_id": 97494854, "body": "The method of multiplication? The one we were taught in the school - multiply digit by digit, move the carry and such"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1553721049, "post_id": 55385984, "comment_id": 97494901, "body": "Step 1: Write a function that multiplies 2 string decimal representation of a value.  Step 2 Use <a href=\"https://en.wikipedia.org/wiki/Exponentiation_by_squaring#Basic_method\" rel=\"nofollow noreferrer\">Exponentiation by squaring</a>"}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1553721229, "post_id": 55385984, "comment_id": 97494978, "body": "Make a &quot;Big ass string table&quot; where each value from 2^0 to 2^100,000 is represented as a string in a lookup.  Runs Constant time and requires no big num library.  Just a ton of RAM :)  Bonus points for generating the big ass table in another language that handles this well."}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1553721435, "post_id": 55385984, "comment_id": 97495074, "body": "100,000 entries isn&#39;t so bad?  It would be a list of pointers to string locations if needed."}, {"owner": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1553721472, "post_id": 55385984, "comment_id": 97495088, "body": "@chux I might sound a little dumb here and I am sure it is easy to do, but can you give me a link for step 1?"}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1553721560, "post_id": 55385984, "comment_id": 97495136, "body": "My answer is a bit troll-y, but it solves the problem simply and requires nearly no C skill to implement.  The hardest part is making the table and that can be done any number of ways - even excel if needed.  You can even add commas if you want."}, {"owner": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "reply_to_user": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1553721618, "post_id": 55385984, "comment_id": 97495161, "body": "@MichaelDorgan ok, but where am I supposed to get the strings with the numbers from? Should I calculate 2^n 100k times on paper and use those results for the string table? Is that really what you are trying to say? EDIT: OK just now I saw your answer that it was troll."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 1, "creation_date": 1553721691, "post_id": 55385984, "comment_id": 97495194, "body": "Useful to know from the outset perhaps is that 2^n requires ceil(n * log10(2)) decimal digits (30103 for n-100000)."}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1553721820, "post_id": 55385984, "comment_id": 97495270, "body": "It&#39;s not a troll, but it feels trolly.  It answers the problem exactly, but it cannot really be expanded upon, so therefore it may not be the best engineering solution.  It all depends on what you are trying to accomplish."}, {"owner": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "reply_to_user": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1553722016, "post_id": 55385984, "comment_id": 97495378, "body": "@MichaelDorgan This is a problem for homework though. If I get a good mark for that, it wouldn&#39;t be because I knew how to solve it, but for the effort put to complete that list of numbers :)))"}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1553722100, "post_id": 55385984, "comment_id": 97495424, "body": "For fun, I made an excel macro to make the numbers and it utterly fails after 2^50 or so :)"}], "answers": [{"comments": [{"owner": {"reputation": 16513, "user_id": 6770384, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kXCNG.png?s=128&g=1", "display_name": "Socowi", "link": "https://stackoverflow.com/users/6770384/socowi"}, "edited": false, "score": 0, "creation_date": 1553720987, "post_id": 55386434, "comment_id": 97494871, "body": "Even better than exponentiation by squaring would be fast fourier transformation."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1553720990, "post_id": 55386434, "comment_id": 97494875, "body": "This does not address the problem presented. There is no straight-forward way of representing the result in decimal form."}, {"owner": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "edited": false, "score": 0, "creation_date": 1553721309, "post_id": 55386434, "comment_id": 97495016, "body": "This would be really nice (especially for the powers of 2 method), but unfortunately the std library of C has no fast function of converting 1 followed by 100k zeroes from base 2 to base 10 and writing one is basically multiplying by 2 over and over again, which is well...doing the problem from the beginning."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1553721525, "post_id": 55386434, "comment_id": 97495116, "body": "Where is this in the answer?"}, {"owner": {"reputation": 1439, "user_id": 5196093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ovj7.png?s=128&g=1", "display_name": "Ray", "link": "https://stackoverflow.com/users/5196093/ray"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1553722649, "post_id": 55386434, "comment_id": 97495630, "body": "@EugeneSh. I&#39;d thought it beyond the scope of the question, but I&#39;ve added a quick explanation of how to do it."}, {"owner": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "edited": false, "score": 0, "creation_date": 1553723458, "post_id": 55386434, "comment_id": 97495907, "body": "Ok, just so that I understand this correctly (about the last part): q is the biggest power of 10 smaller than the huge number and n is the number you get as input (0 &lt;= n &lt;= 100k)?"}, {"owner": {"reputation": 1439, "user_id": 5196093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ovj7.png?s=128&g=1", "display_name": "Ray", "link": "https://stackoverflow.com/users/5196093/ray"}, "reply_to_user": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "edited": false, "score": 0, "creation_date": 1553723835, "post_id": 55386434, "comment_id": 97496077, "body": "@DarkAtom <code>n</code> is the number you have represented in memory.  The full number, not just the exponent.  So let&#39;s say you had <code>2^11</code>: then <code>n = 2048</code>, and <code>q = 1000</code>.  The algorithm will print 2048 / 1000 (2), then subtract 2 * 1000, yielding 48.  Then it prints 48/100 (0), then 48/10 (4), then 8/1 (8)."}, {"owner": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "edited": false, "score": 0, "creation_date": 1553724017, "post_id": 55386434, "comment_id": 97496149, "body": "@Ray but my number in memory is in binary stored in a linked list as you said, not in decimal form in a variable"}, {"owner": {"reputation": 1439, "user_id": 5196093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ovj7.png?s=128&g=1", "display_name": "Ray", "link": "https://stackoverflow.com/users/5196093/ray"}, "reply_to_user": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "edited": false, "score": 0, "creation_date": 1553724387, "post_id": 55386434, "comment_id": 97496295, "body": "@DarkAtom Variables do not store numbers in decimal form. <code>&quot;2048&quot;</code>, <code>&quot;0x800&quot;</code>, and <code>&quot;1000 0000 0000&quot;</code> are just different ways of <i>representing</i> the number <code>2048</code> as a string. When I say 2048, I mean the <i>number</i>, not any particular representation.  In the computer, the binary representation will be used.  In the comments here, I&#39;m using the decimal version."}, {"owner": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "edited": false, "score": 0, "creation_date": 1553724578, "post_id": 55386434, "comment_id": 97496351, "body": "@Ray whatever the base the number is represented in, the variable would still not have the capacity to store the number. Do i need to do this algorithm on every block of the list? And if yes...how would it work? The list has the first block with the bits 1000... and the rest are all filled with 0s."}, {"owner": {"reputation": 1439, "user_id": 5196093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ovj7.png?s=128&g=1", "display_name": "Ray", "link": "https://stackoverflow.com/users/5196093/ray"}, "reply_to_user": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "edited": false, "score": 0, "creation_date": 1553726757, "post_id": 55386434, "comment_id": 97497018, "body": "@DarkAtom Unfortunately, you can&#39;t do it on each block independently, since 10 doesn&#39;t divide evenly into 2. You&#39;ll need to implement a division function that works on the entire number. (And subtraction, but that one&#39;s fairly trivial.) That&#39;s the reason why we try to avoid storing things in decimal; converting between decimal and binary is a colossal pain, and all the operations on the CPU work in binary. Bignum libraries are something you need to build up piecemeal; once you have addition and subtraction, you can do multiplication and division. Once you have those, you can do exponentiation."}, {"owner": {"reputation": 1439, "user_id": 5196093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ovj7.png?s=128&g=1", "display_name": "Ray", "link": "https://stackoverflow.com/users/5196093/ray"}, "reply_to_user": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "edited": false, "score": 0, "creation_date": 1553726767, "post_id": 55386434, "comment_id": 97497026, "body": "@DarkAtom You might be able to avoid writing an efficient general purpose division algorithm if you <i>just</i> need it for binary-to-decimal conversion. Since you know in advance that the value will always be between 0 and 9 inclusive, you can just do division by repeated subtraction without worrying that it&#39;ll take a huge amount of time."}], "tags": [], "owner": {"reputation": 1439, "user_id": 5196093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ovj7.png?s=128&g=1", "display_name": "Ray", "link": "https://stackoverflow.com/users/5196093/ray"}, "is_accepted": false, "score": 2, "last_activity_date": 1553722949, "last_edit_date": 1553722949, "creation_date": 1553720680, "answer_id": 55386434, "question_id": 55385984, "link": "https://stackoverflow.com/questions/55385984/how-can-i-calculate-2n-for-large-n/55386434#55386434", "title": "How can I calculate 2^n for large n?", "body": "<h1>Step 1: Decide how you're going to represent bignums</h1>\n\n<p>There exist libraries out there already for this. The <a href=\"https://en.wikipedia.org/wiki/GNU_Multiple_Precision_Arithmetic_Library\" rel=\"nofollow noreferrer\">GNU Multiple Precision Integer library</a> is a commonly used option. (But according to your edit, that isn't an option. You might still glance at some of them to see how they do things, but it isn't necessary.)</p>\n\n<p>If you want to roll your own, I do <em>not</em> recommend storing the decimal digits. If you do that, you'll need to convert to and from a binary representation every time you want to do arithmetic on the components.  Better to have something like a linked list of <code>uint32_t</code>s, along with a sign bit.  You can convert from/to decimal when you want to read and write, but do your math in binary.</p>\n\n<h1>Step 2: Implement exponentiation</h1>\n\n<p>I'll be assuming the linked list bignum implementation here; you can adapt the algorithms as needed.</p>\n\n<p>If you're just calculating a power of 2, it's easy. It's a 1 followed by N 0s, so if each block stores M bits and you want to represent <code>2^N</code>, then just have <code>floor(N/M)</code> blocks of all 0s, and store <code>1 &lt;&lt; (N % M)</code> in the most significant block.</p>\n\n<p>If you want to be able to do exponentiation with <em>arbitrary</em> bases in an efficient manner, you should use <a href=\"https://en.wikipedia.org/wiki/Exponentiation_by_squaring\" rel=\"nofollow noreferrer\">exponentiation by squaring</a>.  The idea behind this is that if you want to compute 3^20, you don't multiply 3 * 3 * 3 * ... * 3.  Rather, you compute <code>3^2 = 3 * 3</code>.  Then <code>3^4 = 3^2 * 3^2.  3^8 = 3^4 * 3^4. 3^16 = 3^8 * 3^8</code>. And you store each of these intermediate results as you go.  Then once you reach the point where squaring it again would result in a larger number than the one you want, you stop squaring and assemble the final result from the pieces you have. In this case, <code>3^20 = 3^16 * 3^4</code>.</p>\n\n<p>This approach computes the final result in 5 steps instead of 20, and since the time is logarithmic in terms of the exponent, the speed gain gets more pronounced the larger the exponent.  Even computing 3^100000 only takes 21 multiplications.</p>\n\n<p>There isn't a clever approach to the multiplication that I know of; you can probably just do something along the lines of the basic long multiplication algorithm you learned in elementary school, but at the level of blocks: the reason we used <code>uint32_t</code>s earlier instead of uint64_t`s is so we can cast the operands to the larger type and multiply them without risk of losing the carry bits to overflow.</p>\n\n<h1>Convert from binary to decimal for printing</h1>\n\n<p>First, find the largest multiple of 10 less than your number.<br>\nI leave doing this <em>efficiently</em> as an exercise for the reader, but you can probably manage it by doing exponentiation by squaring to find an upper bound, then subtracting various stored intermediate values to get down to the actual value faster than you would by dividing by 10 repeatedly.</p>\n\n<p>Or you can just find the number by repeatedly multiplying by 10; the rest of this is going to be linear no matter how the first part is handled.</p>\n\n<p>But however you get it, you have a <code>q</code> such that <code>q = k * 10, 10 * q &gt; n, q &lt;= n</code>, you can just cycle through one decimal digit at a time:</p>\n\n<pre><code>for (; q; q /= 10) {\n   int digit = n / q; //truncated down to floor(n/q)\n   printf(\"%d\", digit);\n   n -= digit * q;\n}\n</code></pre>\n\n<p>It's possible that there's a more efficient method in the literature somewhere, but I'm not familiar with one offhand.  But it's not a major deal so long as we only need to do the inefficient part when writing output; that's slow no matter the algorithm. By which I mean, it might take a millisecond or two to print all 100,000 digits. That doesn't matter when we're displaying the number for human consumption, but if we had to wait a millisecond as part of a calculation in a loop somewhere, it'd add up and become terribly inefficient.  That's why we <em>never</em> store numbers in a decimal representation: by representing it as binary internally, we do the inefficient parts once on input and once on output, but everything in between is fast.</p>\n"}, {"tags": [], "owner": {"reputation": 16513, "user_id": 6770384, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kXCNG.png?s=128&g=1", "display_name": "Socowi", "link": "https://stackoverflow.com/users/6770384/socowi"}, "is_accepted": false, "score": 1, "last_activity_date": 1553728358, "last_edit_date": 1553728358, "creation_date": 1553723177, "answer_id": 55386960, "question_id": 55385984, "link": "https://stackoverflow.com/questions/55385984/how-can-i-calculate-2n-for-large-n/55386960#55386960", "title": "How can I calculate 2^n for large n?", "body": "<p>This is a rather naive and inefficient solution. As asked for, the numbers are represented in an array of decimal digits. We compute the exponential 2<sup>n</sup> by repeated addition of the number 2 with itself:\nstart with <code>e := 2</code> and repeat <code>e := e + e</code> n times.</p>\n\n<p>To come up with an upper bound for the length of our <code>digits</code> array we use the following approach:</p>\n\n<ul>\n<li>The representation of number x in base b has \u2308log<sub>b</sub>(x)\u2309 digits.</li>\n<li>Comparing the number of digits between the binary and decimal representation of any number x we find that they are only off by a constant factor if we neglect the rounding (\u2308\u2309).<br>\nlog<sub>2</sub>(x) / log<sub>10</sub>(x) = 1 / log<sub>10</sub>(2) = 3.3219... > 3</li>\n<li>2<sup>n</sup> has log<sub>2</sub>(2<sup>n</sup>) = n binary digits.</li>\n<li>Therefore 2<sup>n</sup> has around n / 3 decimal digits. Because of the rounding issues we add +1 to that.</li>\n</ul>\n\n<p><p></p>\n\n<pre><code>void print(int digits[], int length) {\n    for (int i = length - 1; i &gt;= 0; --i)\n        printf(\"%d\", digits[i]);\n    printf(\"\\n\");\n}\nvoid times2(int digits[], int length) {\n    int carry = 0;\n    for (int i = 0; i &lt; length; ++i) {\n        int d = 2 * digits[i] + carry;\n        digits[i] = d % 10;\n        carry = d / 10;\n    }\n}\nint lengthOfPow2(int exponent) {\n    return exponent / 3 + 1;\n}\n// works only for epxonents &gt; 0\nvoid pow2(int digits[], int length, int exponent) {\n    memset(digits, 0, sizeof(int) * length);\n    digits[0] = 2;\n    for (int i = 1; i &lt; exponent; ++i)\n        times2(digits, length);\n}\nint main() {\n    int n = 100000;\n    int length = lengthOfPow2(n);\n    int digits[length];\n    pow2(digits, length, n);\n    print(digits, length);\n    return 0;\n}\n</code></pre>\n\n<p>On unix-like systems you can check correctness for a fixed n using</p>\n\n<pre><code>diff \\\n  &lt;(compiledProgram | sed 's/^0*//' | tr -d '\\n') \\\n  &lt;(bc &lt;&lt;&lt; '2^100000' | tr -d '\\n\\\\')\n</code></pre>\n\n<p>As already pointed out, this solution is not very efficient. Compiled with <code>clang -O2</code> computing 2<sup>100'000</sup> took 8 seconds on an Intel i5-4570 (3,2GHz).</p>\n\n<p>The next step to speed this up would be to repeatedly cube your number instead of repeatedly multiplying by 2. Even with a naive implementation of the cube step this should be faster than the implementation presented in this answer.</p>\n\n<p>If you need to be even more efficient you can implement the cube step using something like Karatsuba's algorithm or even fast fourier transformation (FFT). With the cubing approach and FFT you can compute 2<sup>n</sup> in around O(n\u00b7log(n)) (there may be an additional log(log(n)) factor due to rounding issues in FFT). </p>\n"}, {"comments": [{"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1553723863, "post_id": 55387022, "comment_id": 97496086, "body": "Nice contribution.  Also done complex enough that if the student turns it in without understanding it, they will get a big 0."}, {"owner": {"reputation": 535, "user_id": 11106292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c19c154a73886394fc6a4357e17cb1e7?s=128&d=identicon&r=PG&f=1", "display_name": "Sandeep Polamuri", "link": "https://stackoverflow.com/users/11106292/sandeep-polamuri"}, "reply_to_user": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1553723896, "post_id": 55387022, "comment_id": 97496104, "body": "26 seconds of execution time to calculate 2^100000."}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1553724163, "post_id": 55387022, "comment_id": 97496192, "body": "Yeah, take the results and output into a string table and then use that.  Instant run time :)"}, {"owner": {"reputation": 16513, "user_id": 6770384, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kXCNG.png?s=128&g=1", "display_name": "Socowi", "link": "https://stackoverflow.com/users/6770384/socowi"}, "edited": false, "score": 1, "creation_date": 1553728130, "post_id": 55387022, "comment_id": 97497465, "body": "@SandeepPolamuri Your comment on the the measured time may be a bit misleading. Yes, compiled with just <code>clang -lm</code> I get 30 seconds too, but with <code>clang -O2</code> it&#39;s just 7 seconds. By the way, I compared the result for pow=100&#39;000 automatically and all digits are correct."}, {"owner": {"reputation": 535, "user_id": 11106292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c19c154a73886394fc6a4357e17cb1e7?s=128&d=identicon&r=PG&f=1", "display_name": "Sandeep Polamuri", "link": "https://stackoverflow.com/users/11106292/sandeep-polamuri"}, "edited": false, "score": 0, "creation_date": 1553731370, "post_id": 55387022, "comment_id": 97498304, "body": "Just realized Java BigInteger can do the same operation within 1 second."}, {"owner": {"reputation": 535, "user_id": 11106292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c19c154a73886394fc6a4357e17cb1e7?s=128&d=identicon&r=PG&f=1", "display_name": "Sandeep Polamuri", "link": "https://stackoverflow.com/users/11106292/sandeep-polamuri"}, "edited": false, "score": 0, "creation_date": 1553732479, "post_id": 55387022, "comment_id": 97498583, "body": "With gcc -O2 now my updated code gets executed in 3 seconds. I didn&#39;t know about these compiler parameters until now."}], "tags": [], "owner": {"reputation": 535, "user_id": 11106292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c19c154a73886394fc6a4357e17cb1e7?s=128&d=identicon&r=PG&f=1", "display_name": "Sandeep Polamuri", "link": "https://stackoverflow.com/users/11106292/sandeep-polamuri"}, "is_accepted": false, "score": 1, "last_activity_date": 1553732138, "last_edit_date": 1553732138, "creation_date": 1553723436, "answer_id": 55387022, "question_id": 55385984, "link": "https://stackoverflow.com/questions/55385984/how-can-i-calculate-2n-for-large-n/55387022#55387022", "title": "How can I calculate 2^n for large n?", "body": "<p><s>I wasn't able to find a solution in logarithmic complexity(exponentiation by squaring) but</s> I did manage to code a naive implementation with time complexity O(noOfDigits*pow), noOfDigits in 2^n will be n*log10(2)+1;</p>\n\n<p>I only checked the answer with the first few digits of <a href=\"https://www.mathsisfun.com/calculator-precision.html\" rel=\"nofollow noreferrer\">https://www.mathsisfun.com/calculator-precision.html</a> and it seems to be correct.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n//MAX is no of digits in 2^1000000\n#define MAX 30103\nint a[MAX];\nint n;\nvoid ipow(int base, int exp,int maxdigits)\n{\n    a[0]=1;\n    for (;exp&gt;0;exp--){\n            int b=0;\n            for(int i=0;i&lt;maxdigits;i++){\n                a[i]*=base;\n                a[i]+=b;\n                b=a[i]/10;\n                a[i]%=10;\n            }\n    }\n}\nint main()\n{\n    int base=2;\n    int pow=100000;\n    n=log10(2)*pow+1;\n    printf(\"Digits=%d\\n\",n);\n    ipow(base,pow,n);\n    for(int i=n-1;i&gt;=0;i--){\n        printf(\"%d\",a[i]);\n    }\n    return 0;\n}\n</code></pre>\n\n<p>I also wrote code for exponentiation by squaring but with an unoptimized multiplication function. Which seems to be faster than above implementation.</p>\n\n<pre><code>#define MAX 30103\nint a[MAX];\nint b[MAX];\nint z[MAX];\n//stores product in x[]; mul of large arrays implemented in n^2 complexity\n//n and m are no of digits in x[] and y[]\n//returns no of digits in product\nint mul(int x[],int y[],int n,int m){\n    for(int i=0;i&lt;n+m;i++)\n        z[i]=0;\n    for(int j=0;j&lt;m;j++){\n        int c=0;\n        for(int i=0;i&lt;n+m;i++){\n            z[i+j]+=x[i]*y[j];\n            z[i+j]+=c;\n            c=z[i+j]/10;\n            z[i+j]%=10;\n        }\n    }\n    for(int i=0;i&lt;n+m;i++){\n            x[i]=z[i];\n    }\n    if(x[n+m-1]==0)\n        return n+m-1;\n    return n+m;\n}\n//stores answer in x[]\nint ipow(int base, int exp)\n{\n    int n=1,m=0;\n    for(int i=0;base&gt;0;i++){\n        b[i]=base%10;\n        base/=10;\n        m++;\n    }\n    a[0]=1;\n    for (;;)\n    {\n        if (exp &amp; 1)\n            n=mul(a,b,n,m);\n        exp &gt;&gt;= 1;\n        if (!exp)\n            break;\n        m=mul(b,b,m,m);\n    }\n}\nint main()\n{\n    int base=2;\n    int pow=100000;\n    n=log10(2)*pow+1;\n    printf(\"Digits=%d\\n\",n);\n    ipow(base,pow);\n    printf(\"\\n\");\n    for(int i=n-1;i&gt;=0;i--){\n        printf(\"%d\",a[i]);\n    }\n    return 0;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 0, "creation_date": 1553726622, "post_id": 55387388, "comment_id": 97496986, "body": "Powers of two power of two base. That&#39;s cheating! :D"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1553727045, "post_id": 55387388, "comment_id": 97497111, "body": "O(n) solution, so UV.  Note: 100,000 may exceed <code>*printf()</code>  <i>environmental limit</i>, (c18 &#167; 7.21.6.1 15) which is at least 4095 - thus &quot;breaking&quot; <code>printf()</code>."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1553729287, "post_id": 55387388, "comment_id": 97497794, "body": "@chux: indeed it is a stress test for <code>printf</code>&#39;s quality of implementation. It works as expected on OS/X with Apple BSD based Libc and also on linux with the GNU libc. Other systems might be less sturdy :)"}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": false, "score": 2, "last_activity_date": 1553802976, "last_edit_date": 1553802976, "creation_date": 1553725437, "answer_id": 55387388, "question_id": 55385984, "link": "https://stackoverflow.com/questions/55385984/how-can-i-calculate-2n-for-large-n/55387388#55387388", "title": "How can I calculate 2^n for large n?", "body": "<p>Since the original problem statement does not specify the output base, here is a joke implementation:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nvoid print_2_pow_n(int n) {\n    printf(\"2^%d = 0x%d%.*d\\n\", n, 1 &lt;&lt; (n % 4), n / 4, 0);\n}\n\nint main() {\n    int i;\n    for (i = 0; i &lt; 16; i++)\n        print_2_pow_n(i);\n    print_2_pow_n(100);\n    print_2_pow_n(100000);\n    return 0;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2^0 = 0x1\n2^1 = 0x2\n2^2 = 0x4\n2^3 = 0x8\n2^4 = 0x10\n2^5 = 0x20\n2^6 = 0x40\n2^7 = 0x80\n2^8 = 0x100\n2^9 = 0x200\n2^10 = 0x400\n2^11 = 0x800\n2^12 = 0x1000\n2^13 = 0x2000\n2^14 = 0x4000\n2^15 = 0x8000\n2^100 = 0x10000000000000000000000000\n2^100000 = 0x10...&lt;0 repeated 24998 times&gt;...0\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 16513, "user_id": 6770384, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kXCNG.png?s=128&g=1", "display_name": "Socowi", "link": "https://stackoverflow.com/users/6770384/socowi"}, "edited": false, "score": 1, "creation_date": 1553727707, "post_id": 55387408, "comment_id": 97497333, "body": "This works great for exp &lt; 80&#39;000, but for  exp &gt;= 80&#39;000 there is no output. Any idea why?"}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 16513, "user_id": 6770384, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kXCNG.png?s=128&g=1", "display_name": "Socowi", "link": "https://stackoverflow.com/users/6770384/socowi"}, "edited": false, "score": 0, "creation_date": 1553727992, "post_id": 55387408, "comment_id": 97497420, "body": "@Socowi Probably stack overflow due to recursion in the printing routine."}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 16513, "user_id": 6770384, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kXCNG.png?s=128&g=1", "display_name": "Socowi", "link": "https://stackoverflow.com/users/6770384/socowi"}, "edited": false, "score": 0, "creation_date": 1553775850, "post_id": 55387408, "comment_id": 97515168, "body": "@Socowi I had an off by one error there. It should be working now."}], "tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": false, "score": 3, "last_activity_date": 1553775932, "last_edit_date": 1553775932, "creation_date": 1553725553, "answer_id": 55387408, "question_id": 55385984, "link": "https://stackoverflow.com/questions/55385984/how-can-i-calculate-2n-for-large-n/55387408#55387408", "title": "How can I calculate 2^n for large n?", "body": "<p>Simply make a bit array and set the nth-bit. Then divide by 10 as if the bit array were a little-endian \nnumber and print the remainders in reverse to get the base-10 representation of your nth-power of two.</p>\n\n<p>This quick program below does it and it's giving me the same results as <code>bc</code>, so I guess it works.\nThe printing routine could use some tuning.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nuint_least32_t div32(size_t N, uint_least32_t Z[/*N*/], uint_least32_t X[/*N*/], uint_least32_t Y)\n{\n    uint_least64_t carry; size_t i;\n    for(carry=0, i = N-1; i!=-1; i--)\n        carry = (carry &lt;&lt; 32) + X[i], Z[i] = carry/Y, carry %= Y;\n    return carry;\n}\n\nvoid pr10(uint_least32_t *X, size_t N)\n{\n    /*very quick and dirty; based on recursion*/\n    uint_least32_t rem=0;\n    if(!X[N?N-1:0]) return;\n    rem = div32(N,X,X,10);\n    while(N &amp;&amp; !X[N-1]) N--;\n    pr10(X,N);\n    putchar(rem+'0');\n}\nint main(int C, char **V)\n{\n    uint_least32_t exp = atoi(V[1]);\n    size_t nrcells = exp/32+1;\n    uint_least32_t *pow  = calloc(sizeof(uint_least32_t),nrcells);\n    if(!pow) return perror(0),1;\n    else pow[exp/32] = UINT32_C(1)&lt;&lt;(exp%32);\n    pr10(pow,nrcells);\n\n}\n</code></pre>\n\n<p>Example run:</p>\n\n<pre><code>$ ./a.out 100\n1267650600228229401496703205376\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3794, "user_id": 3080723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99752acfe2e3ef55a82b497faa783847?s=128&d=identicon&r=PG&f=1", "display_name": "Stef", "link": "https://stackoverflow.com/users/3080723/stef"}, "edited": false, "score": 2, "creation_date": 1601807600, "post_id": 55405842, "comment_id": 113514982, "body": "I like <a href=\"https://stackoverflow.com/questions/1642028/what-is-the-operator-in-c\">your <code>while (j --&gt; 0)</code> loop</a>"}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 3794, "user_id": 3080723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99752acfe2e3ef55a82b497faa783847?s=128&d=identicon&r=PG&f=1", "display_name": "Stef", "link": "https://stackoverflow.com/users/3080723/stef"}, "edited": false, "score": 0, "creation_date": 1601809446, "post_id": 55405842, "comment_id": 113515393, "body": "@stef: the famous <i>dowto</i> operator is the best solution to iterate over the array with decreasing index values and it also works with unsigned types :)"}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 3794, "user_id": 3080723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99752acfe2e3ef55a82b497faa783847?s=128&d=identicon&r=PG&f=1", "display_name": "Stef", "link": "https://stackoverflow.com/users/3080723/stef"}, "edited": false, "score": 0, "creation_date": 1601810016, "post_id": 55405842, "comment_id": 113515525, "body": "@stef: I love this question, especially the picturesque <a href=\"https://stackoverflow.com/a/8909176/4593267\">x slides to 0</a>"}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": true, "score": 7, "last_activity_date": 1583011961, "last_edit_date": 1583011961, "creation_date": 1553802740, "answer_id": 55405842, "question_id": 55385984, "link": "https://stackoverflow.com/questions/55385984/how-can-i-calculate-2n-for-large-n/55405842#55405842", "title": "How can I calculate 2^n for large n?", "body": "<p>The problem is not to compute 2 to a high power, but to convert this number to a decimal representation:</p>\n\n<ul>\n<li>Let's represent large numbers with arrays of unsigned 32-bit integers.</li>\n<li>Computing 2<sup>n</sup> is as easy as setting a single bit.</li>\n<li>Converting to binary can be performed by repeatedly dividing this number by 1000000000, producing 9 digits at a time.</li>\n</ul>\n\n<p>Here is a simple but fast implementation:</p>\n\n<pre><code>#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n\nvoid print_2_pow_n(int n) {\n    int i, j, blen = n / 32 + 1, dlen = n / 29 + 1;\n    uint32_t bin[blen], dec[dlen];\n    uint64_t num;\n\n    for (i = 0; i &lt; blen; i++)\n        bin[i] = 0;\n    bin[n / 32] = (uint32_t)1 &lt;&lt; (n % 32);\n\n    for (j = 0; blen &gt; 0; ) {\n        for (num = 0, i = blen; i-- &gt; 0;) {\n            num = (num &lt;&lt; 32) | bin[i];\n            bin[i] = num / 1000000000;\n            num = num % 1000000000;\n        }\n        dec[j++] = (uint32_t)num;\n        while (blen &gt; 0 &amp;&amp; bin[blen - 1] == 0)\n            blen--;\n    }\n    printf(\"2^%d = %u\", n, dec[--j]);\n    while (j-- &gt; 0)\n        printf(\"%09u\", dec[j]);\n    printf(\"\\n\");\n}\n\nint main() {\n    int i;\n    for (i = 0; i &lt;= 100; i += 5)\n        print_2_pow_n(i);\n    print_2_pow_n(1000);\n    print_2_pow_n(10000);\n    print_2_pow_n(100000);\n    return 0;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2^0 = 1\n2^5 = 32\n2^10 = 1024\n2^15 = 32768\n2^20 = 1048576\n2^25 = 33554432\n2^30 = 1073741824\n2^35 = 34359738368\n2^40 = 1099511627776\n2^45 = 35184372088832\n2^50 = 1125899906842624\n2^55 = 36028797018963968\n2^60 = 1152921504606846976\n2^65 = 36893488147419103232\n2^70 = 1180591620717411303424\n2^75 = 37778931862957161709568\n2^80 = 1208925819614629174706176\n2^85 = 38685626227668133590597632\n2^90 = 1237940039285380274899124224\n2^95 = 39614081257132168796771975168\n2^100 = 1267650600228229401496703205376\n2^1000 = 10715086071862673209484250490600018105614048117055336074437503883703510511249361224931983788156958581275946729175531468251871452856923140435984577574698574803934567774824230985421074605062371141877954182153046474983581941267398767559165543946077062914571196477686542167660429831652624386837205668069376\n2^10000 = 1995063116880758384883742&lt;...&gt;91511681774304792596709376\n2^100000 = 9990020930143845079440327&lt;...&gt;97025155304734389883109376\n\n</code></pre>\n\n<p>2<sup>100000</sup> has 30103 digits, which is exactly <code>floor(100000 * log10(2))</code>. It executes in 33 milliseconds on my old laptop.</p>\n"}], "owner": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4853, "favorite_count": 4, "accepted_answer_id": 55405842, "answer_count": 6, "score": 7, "last_activity_date": 1583011961, "creation_date": 1553718844, "last_edit_date": 1553722024, "question_id": 55385984, "link": "https://stackoverflow.com/questions/55385984/how-can-i-calculate-2n-for-large-n", "title": "How can I calculate 2^n for large n?", "body": "<p>I am trying to write a program that takes a number, <code>n</code>, as input, and outputs the result of 2 to the power of <code>n</code>. The problem is, <code>n</code> can be very large (up to 100,000). Essentially, I am trying to calculate <code>pow(2, n);</code> for very large numbers.</p>\n\n<p>I think the way to do this is to store the digits in an array, since there is no built-in numeric type that can hold values that are this large.</p>\n\n<p>The digits are in decimal format (base 10).</p>\n\n<p>I am using C, not C++, so I cannot use STL vectors and other C++ containers. I also cannot use external libraries, like <a href=\"https://gmplib.org/\" rel=\"noreferrer\">GMP</a>. I need to implement the algorithm manually in pure C.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1553718899, "post_id": 55385945, "comment_id": 97493847, "body": "<code>while ((c = fgetc(f1)) != EOF)</code> --&gt; <code>fgetc</code> returns <code>int</code>.  <code>c</code> needs to be <code>int</code> not <code>char</code>"}, {"owner": {"reputation": 7, "user_id": 11266628, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-smKePPgUccE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdmvN9glV5rSfuQ93u_0OqfCaghmw/mo/photo.jpg?sz=128", "display_name": "topo lino", "link": "https://stackoverflow.com/users/11266628/topo-lino"}, "reply_to_user": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1553719046, "post_id": 55385945, "comment_id": 97493910, "body": "thanks! but that does not solve my problem. Any further help please?"}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1553719081, "post_id": 55385945, "comment_id": 97493928, "body": "&quot;I get my problem in filling up and then in printing my array&quot; what&#39;s our exact problem? and BTW having the variable names &amp; text in italian penalizes the clarity of the question."}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1553719131, "post_id": 55385945, "comment_id": 97493958, "body": "Yeah.  I know.  But what problem are you running into?  I don&#39;t see anything necessarily wrong with what you have.  Except you might want: <code>fgets(r-&gt;firma, 333, f1);</code> instead of <code>fgets(r-&gt;firma, 33, f1);</code>  Or better: <code>fgets(r-&gt;firma, sizeof(r-&gt;firmat), f1);</code>"}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1553719247, "post_id": 55385945, "comment_id": 97494024, "body": "How is your input formatted?   Do you need to read in an entire line with <code>fgets</code> and then tokenize on spaces with <code>strtok</code> ?"}, {"owner": {"reputation": 7, "user_id": 11266628, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-smKePPgUccE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdmvN9glV5rSfuQ93u_0OqfCaghmw/mo/photo.jpg?sz=128", "display_name": "topo lino", "link": "https://stackoverflow.com/users/11266628/topo-lino"}, "edited": false, "score": 0, "creation_date": 1553719861, "post_id": 55385945, "comment_id": 97494315, "body": "the input I am using is like this:  1d41d8cd98f00b204e9800998ecf8427 f:\\tmptest\\test1.txt 2d41d8cd98f00b204e9800998ecf8427 f:\\tmptest\\test2.txt 3d41d8cd98f00b204e9800998ecf8427 f:\\tmptest\\test3.txt  the output I get is instead like this:  1d413d41d8cd98f00b204e9800998ecf8427 f:\\tmptest\\test3.txt     2d41d8cd98f00b204e9800998ecf8427 f:\\tmptest\\test2.txt 3d41d8cd98f00b204e9800998ecf8427 f:\\tmptest\\test3.txt   d8cd98f00b204e9800998ecf8427 f:\\tmptest\\test2.txt d8cd98f00b204e9800998ecf8427 f:\\tmptest\\test3.txt       98f00b204e9800998ecf8427 f:\\tmptest\\test2.txt"}, {"owner": {"reputation": 7, "user_id": 11266628, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-smKePPgUccE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdmvN9glV5rSfuQ93u_0OqfCaghmw/mo/photo.jpg?sz=128", "display_name": "topo lino", "link": "https://stackoverflow.com/users/11266628/topo-lino"}, "edited": false, "score": 0, "creation_date": 1553719929, "post_id": 55385945, "comment_id": 97494348, "body": "I actually need to store each word read on the input in a single field of my struct (so a whole struct will be a full line of my input txt"}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1553721699, "post_id": 55385945, "comment_id": 97495197, "body": "Don&#39;t put information in comments.  Edit the question."}], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 11266628, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-smKePPgUccE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdmvN9glV5rSfuQ93u_0OqfCaghmw/mo/photo.jpg?sz=128", "display_name": "topo lino", "link": "https://stackoverflow.com/users/11266628/topo-lino"}, "edited": false, "score": 0, "creation_date": 1553721104, "post_id": 55386299, "comment_id": 97494931, "body": "couldn&#39;t I simply use fscanf(f1, &quot;%s %s&quot;, r-&gt;firma, r-&gt;path)? what is the negative side in using it? %s automatically stops when meeting a space, doesn&#39;t it?"}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "reply_to_user": {"reputation": 7, "user_id": 11266628, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-smKePPgUccE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdmvN9glV5rSfuQ93u_0OqfCaghmw/mo/photo.jpg?sz=128", "display_name": "topo lino", "link": "https://stackoverflow.com/users/11266628/topo-lino"}, "edited": false, "score": 0, "creation_date": 1553726641, "post_id": 55386299, "comment_id": 97496990, "body": "<code>fgets</code> reads up to the newline.  if you want to use the <i>scanf</i> variety of functions, i&#39;d suggest <code>fgets</code> plus <code>sscanf</code>.  be sure to specify a max number of characters in your %s format string."}], "tags": [], "owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "is_accepted": false, "score": 0, "last_activity_date": 1553720106, "creation_date": 1553720106, "answer_id": 55386299, "question_id": 55385945, "link": "https://stackoverflow.com/questions/55385945/filling-up-an-array-of-struct-from-file/55386299#55386299", "title": "Filling up an array of struct from file", "body": "<p>It seems your input is in lines of <code>sign path</code> where \"sign\" and \"path\" are separated by a space.  You can read an entire line with <code>fgets</code> and then call <code>strtok</code> to get the two tokens.  This code is untested.</p>\n\n<pre><code>void riempi_riga(riga* r, FILE* f1) \n{\n    char *tok;\n    char buf[sizeof(r-&gt;firma)+sizeof(r-&gt;path)];\n    if (fgets(buf, sizeof(buf), f1) != NULL)\n    {\n        if ((tok = strtok(buf)) != NULL)\n        {\n            strncpy(r-&gt;firma, tok, sizeof(r-&gt;firma));\n            r-&gt;firma[sizeof(r-&gt;firma)-1]=0;\n            if ((tok = strtok(NULL)) != NULL)\n            {\n                strncpy(r-&gt;path, tok, sizeof(r-&gt;path));\n                r-&gt;path[sizeof(r-&gt;path)-1]=0;\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 7, "user_id": 11266628, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-smKePPgUccE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdmvN9glV5rSfuQ93u_0OqfCaghmw/mo/photo.jpg?sz=128", "display_name": "topo lino", "link": "https://stackoverflow.com/users/11266628/topo-lino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1553725071, "creation_date": 1553718666, "last_edit_date": 1553725071, "question_id": 55385945, "link": "https://stackoverflow.com/questions/55385945/filling-up-an-array-of-struct-from-file", "title": "Filling up an array of struct from file", "body": "<p>Apparently it is a very simple task, but I have been struggling with it for some time so far.</p>\n\n<p>I am inizializating an array of structs. Each struct is made by two arrays.</p>\n\n<p>I am then trying to read from a file and to fill my array of structs up.\nThe file, composed by strings, is something like:</p>\n\n<pre><code>sign1 path1\nsign2 path2\nsign3 path3\n</code></pre>\n\n<p>I get my problem in filling up and then in printing my array.\nAny help is strongly appreciated.\nThanks!</p>\n\n<pre><code>typedef struct { \n    char firma[333];\n    char path[100];\n}riga;\n\nvoid riempi_riga(riga* r, FILE* f1) {\n    //fscanf(f1, \"%s %s\\n\", r-&gt;firma, r-&gt;path);\n    fgets(r-&gt;firma, 33, f1);\n    fgets(r-&gt;path, 100, f1);\n    return;\n}\n\nvoid stampa_riga(riga* r) {\n    printf(\"%s %s\\n\", r-&gt;firma, r-&gt;path);\n    return;\n}\n\nint num_lines(FILE *f1) {\n    char c;\n    int lines = 0;\n    while ((c = fgetc(f1)) != EOF)\n        if (c == '\\n')\n            lines++;\n\n    if (c != '\\n')\n        lines++;\n    rewind(f1);\n    return lines;\n}\n\nint main() {\n    riga* file_firme[1000];\n    int i = 0;\n    int j = 0;\n    FILE* f1;\n\n    f1 = fopen(\"C:\\\\Users\\\\blabla\\\\Desktop\\\\firmaMD5.txt\", \"r\");\n    if (f1 == NULL) {\n        printf(\"non sono riuscito ad aprire il file!\\n\");\n        return 0;\n    }\n\n    int num_righe = num_lines(f1);\n    for (i; i &lt; num_righe; i++)\n        riempi_riga(&amp;file_firme[i], f1);\n\n    //riempi_riga(r1, f1);\n    //stampa_riga(r1);\n    //fflush(f1);\n\n    for (j; j &lt; num_righe; j++) {\n            stampa_riga(&amp;file_firme[j]);\n    }\n\n    if (fclose(f1) != 0)\n        printf(\"non sono riuscito a chiudere il file\\n\");\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "malloc", "fgets"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1553718849, "post_id": 55385915, "comment_id": 97493829, "body": "What happens to <code>current_parent</code> behind the scenes? It might start with the same pointer value as <code>string</code>, from <code>current_parent = trim(strtok(string, &quot;,&quot;));</code>, but if it gets <code>free</code>d then <code>string</code> is no longer any use. What does <code>trim()</code> do?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11268507"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1553719616, "post_id": 55385915, "comment_id": 97494191, "body": "@WeatherVane it isn&#39;t freed anywhere behind the scenes and it isn&#39;t manipulated at all aside from that line"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1553719679, "post_id": 55385915, "comment_id": 97494219, "body": "Suspect damage somewhere else in the program, perhaps use a memory usage tool. How does it work if you remove all the tree operations and just print the strings extracted?"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1553732743, "post_id": 55385915, "comment_id": 97498633, "body": "My crystal ball tells me that you are not putting the strings into the tree, only pointers to the string, which you then overwrite with the next line."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1553732901, "post_id": 55385915, "comment_id": 97498672, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/44790786/previously-stored-strings-are-overwritten-by-fgets\">Previously stored strings are overwritten by fgets</a>"}], "owner": {"user_type": "does_not_exist", "display_name": "user11268507"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 28, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1553718740, "creation_date": 1553718517, "last_edit_date": 1553718740, "question_id": 55385915, "link": "https://stackoverflow.com/questions/55385915/fgets-loop-only-works-properly-if-string-is-mallocd-again-at-the-end-of-the-loo", "title": "fgets loop only works properly if string is malloc&#39;d again at the end of the loop", "body": "<p>I have to read in comma separated lines from a file, break down the args between that commas, and handle them accordingly. I have the following code set up to do exactly what I need:</p>\n\n<pre><code>char *string = malloc(MAX_INPUT);\nchar * current_parent;\nchar * current_child;\n// while there are still lines to read from the file\nwhile(fgets(string, BUFF_SIZE, file) != NULL){\n          // get the parent of a line and its first child\n          current_parent = trim(strtok(string, \",\"));\n\n          if(strcmp(current_parent, \"\") != 0){\n\n                 current_child = trim(strtok(NULL, \",\"));\n\n                 if(current_child == NULL || strcmp(current_child, \"\") == 0){\n                           tree = add_child(tree, current_parent, \"\");\n                 }\n                 else{\n                           while(current_child != NULL){\n                                  tree = add_child(tree, current_parent, current_child);\n                                  current_child = trim(strtok(NULL, \",\"));\n                           }\n                 }\n                 current_parent = 0;\n                 current_child = 0;\n\n         }\n         string = (char *)malloc(MAX_INPUT);\n}\n// close the file\nfree(string);\nfclose(file);\n\n</code></pre>\n\n<p>Example of a file:</p>\n\n<pre><code>john 1, sam 2\nsam 2, ben 4, frances, sam 3\nben 4, sam 4, ben 5, nancy 2, holly\nben 5, john 2, sam 5\n</code></pre>\n\n<p>Whatever is before the first comma is the parent's name, and all other strings after that are its children's names.</p>\n\n<p>My problem is that for whatever reason it only reads in the data properly if I malloc the string all over again at the end of the loop. In addition to this, if I try to free the memory before malloc'ing again, it doesn't work - resulting in memory leaks. I've even tried setting up the loop to just use a fixed sized string, but it still then reads in this jumbled data at the end. I've also tried manually emptying string at the end of each loop. I have a feeling that I may be overlooking something really simple but this has been driving me crazy. Let me know if I can provide anything else that would be of help. Thanks.</p>\n\n<p>Edit: Not sure if this is important for anything but MAX_INPUT and BUFF_SIZE are both 1024</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 360, "user_id": 3492498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b22bd84245bf80211b37cc5ccf73def?s=128&d=identicon&r=PG&f=1", "display_name": "Nish", "link": "https://stackoverflow.com/users/3492498/nish"}, "edited": false, "score": 2, "creation_date": 1553718071, "post_id": 55385771, "comment_id": 97493516, "body": "declare success out of the for loop."}, {"owner": {"reputation": 28330, "user_id": 298054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7dffcc86140441472cfb6119375a9d7?s=128&d=identicon&r=PG", "display_name": "jweyrich", "link": "https://stackoverflow.com/users/298054/jweyrich"}, "edited": false, "score": 0, "creation_date": 1553718189, "post_id": 55385771, "comment_id": 97493567, "body": "s/declare/define/."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553792492, "post_id": 55385771, "comment_id": 97526832, "body": "in general, do not post code snippets,  rather post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> so we can reproduce the problem and help you debug it."}], "answers": [{"comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1553794182, "post_id": 55403488, "comment_id": 97527821, "body": "you could <code>break;</code> after <code>validKey = 0</code>. No need to go through the rest of argv[1] characters."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1553796742, "post_id": 55403488, "comment_id": 97529119, "body": "The code &#39;could&#39; have that break, especially if execution time were a key factor"}], "tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": true, "score": 1, "last_activity_date": 1553793530, "creation_date": 1553793530, "answer_id": 55403488, "question_id": 55385771, "link": "https://stackoverflow.com/questions/55385771/checking-the-elements-in-an-array-using-a-for-loop-to-ensure-they-are-the-right/55403488#55403488", "title": "Checking the elements in an array using a for loop to ensure they are the right datatype, but answer is printing too many times", "body": "<p>the following proposed code:</p>\n\n<ol>\n<li>cleanly compiles</li>\n<li>performs the desired functionality</li>\n<li>contains a good method to show a 'USAGE' error message</li>\n</ol>\n\n<p>and now, the proposed code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;  // fprintf(), printf()\n#include &lt;stdlib.h&gt; // exit(), EXIT_FAILURE\n#include &lt;ctype.h&gt;  // isdigit()\n\nint main( int argc, char *argv[] )\n{\n    if(argc != 2)\n    {\n        fprintf( stderr, \"USAGE: %s &lt;saesar key&gt;\\n\", argv[0] );\n        exit( EXIT_FAILURE );\n    }\n\n    int validKey = 1;  // indicate valid key\n\n    for(int i = 0; argv[1][i]; i++)\n    {\n        //check each character at the command line is a decimal digit\n        if ( !isdigit( argv[1][i] ) )\n        {\n            validKey = 0;   // indicate invalid key\n        }\n    }\n\n    if( validKey )\n    {\n        printf(\"success\\n\");\n        printf(\"%i\\n\", atoi(argv[1]) );\n    }\n\n    else\n    { // invalid key\n        printf( \"key: %s is invalid\\n\", argv[1] );\n    } \n}\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 11215561, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Ovhb_P603nU/AAAAAAAAAAI/AAAAAAAAdus/xr5quxqL7ls/photo.jpg?sz=128", "display_name": "Alexander Norrington", "link": "https://stackoverflow.com/users/11215561/alexander-norrington"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 55403488, "answer_count": 1, "score": 0, "last_activity_date": 1553793530, "creation_date": 1553717905, "last_edit_date": 1553723327, "question_id": 55385771, "link": "https://stackoverflow.com/questions/55385771/checking-the-elements-in-an-array-using-a-for-loop-to-ensure-they-are-the-right", "title": "Checking the elements in an array using a for loop to ensure they are the right datatype, but answer is printing too many times", "body": "<p>I'm currently trying to iterate over an argv array in order to check the individual elements. The loop is working correctly however the <code>printf</code> function is printing too many times(proportional to the number of elements the user provides at the command line). I was wondering if anyone could help me to iterate over the individual array elements whilst only printing the answer once. </p>\n\n<pre><code>if(argc == 2)\n{\n    //when the ith position of the first index of argv does not equal null move across to the next ith value \n\n    int key = atoi(argv[1]);       \n    for(int i = 0; argv[1][i] != '\\0'; i++)\n    {\n        //check each character at the command line is a decimal digit\n\n       int currentchar = argv[1][i];\n       if (isdigit(currentchar))\n       {\n           printf(\"success\\n\");\n           printf(\"%i\\n\", key);\n       }\n       else\n       {\n           printf(\"Usage: ./caesar key\\n\");\n           return 1;    \n       }\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 303, "user_id": 9750048, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f21cfd026d734661c84cbd0ab78bf0e0?s=128&d=identicon&r=PG&f=1", "display_name": "7hsk", "link": "https://stackoverflow.com/users/9750048/7hsk"}, "edited": false, "score": 0, "creation_date": 1553718647, "post_id": 55385767, "comment_id": 97493752, "body": "I do not see the error in my code"}, {"owner": {"reputation": 5867, "user_id": 2252087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/020cbe41b02f03d59f3adae022c0ce7d?s=128&d=identicon&r=PG", "display_name": "ensc", "link": "https://stackoverflow.com/users/2252087/ensc"}, "edited": false, "score": 0, "creation_date": 1553718655, "post_id": 55385767, "comment_id": 97493755, "body": "<code>buffer</code> is not large enough (needs space for trainling <code>\\0</code>) and its content is undefined (-&gt; <code>strcat()</code> problem)"}], "owner": {"reputation": 303, "user_id": 9750048, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f21cfd026d734661c84cbd0ab78bf0e0?s=128&d=identicon&r=PG&f=1", "display_name": "7hsk", "link": "https://stackoverflow.com/users/9750048/7hsk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 27, "favorite_count": 0, "closed_date": 1553718544, "answer_count": 0, "score": 0, "last_activity_date": 1553717878, "creation_date": 1553717878, "question_id": 55385767, "link": "https://stackoverflow.com/questions/55385767/32536-bus-error-program-due-to-my-use-recv", "closed_reason": "Duplicate", "title": "32536 bus error ./program, due to my use recv?", "body": "<p>I have a \"bus error\" in the way I program. I am learning how to make a client /server with chained list. The error bus comes only when I return <code>parse_message (...) = NULL</code>.. </p>\n\n<p>The listen_client function is in a thread, I do not know if it affects the error. If you want more details / other piece of code ask me.</p>\n\n<p>Thank you and good evening.</p>\n\n<pre><code>static t_message    *parse_message(char *buffer)\n{\n    int     id;\n\n    id = atoi(buffer);\n    printf(\"ID: %d\\n\", id);\n    return (NULL); // for sample\n}\nstatic char     *read_message(char *data)\n{\n    static char     *buffer = NULL;\n    char            *message = NULL;\n    char            *ptr;\n    size_t          size;\n\n    size = strlen(data);\n    if (buffer)\n        size += strlen(buffer);\n    if (!(buffer = realloc(buffer, size)))\n        return (NULL);\n    strcat(buffer, data);\n    if ((ptr = strstr(buffer, \"\\r\\n\")))\n    {\n        size = (ptr - buffer);\n        if (!(message = (char*)malloc(sizeof(char) * (size + 1))))\n            return (NULL);\n        strncpy(message, buffer, size);\n        ptr += 2;\n        if (!(*ptr))\n            buffer = NULL;\n        else if (!(buffer = strdup(ptr)))\n            return (NULL);\n    }\n    return (message);\n}\n\nvoid            listen_client(t_args *args)\n{\n    ssize_t     count;\n    char        buffer[BUFF_SIZE + 1] = { 0 };\n    char        *msg_str;\n    t_message   *msg;\n\n    while ((count = recv(args-&gt;client-&gt;s, buffer, BUFF_SIZE, 0)))\n    {\n        printf(\"===&gt; %s\\n\", buffer);\n        if (!(msg_str = read_message(buffer)))\n        {\n            continue ;\n        }\n        if (!(msg = parse_message(msg_str)))\n        {   \n            // bus error after continue ;\n            continue ;\n        }\n        handle_message();\n    }\n</code></pre>\n"}, {"tags": ["c", "ncurses", "curses", "srt"], "comments": [{"owner": {"reputation": 109324, "user_id": 21926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6e61d47f9a6ec0a7a286835e51f3332?s=128&d=identicon&r=PG", "display_name": "Sean Bright", "link": "https://stackoverflow.com/users/21926/sean-bright"}, "edited": false, "score": 0, "creation_date": 1553719661, "post_id": 55385736, "comment_id": 97494212, "body": "It&#39;s not really clear what problem you are having. This question also presupposes knowledge of what an <code>.srt</code> file format looks like."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7555262"}, "reply_to_user": {"reputation": 109324, "user_id": 21926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6e61d47f9a6ec0a7a286835e51f3332?s=128&d=identicon&r=PG", "display_name": "Sean Bright", "link": "https://stackoverflow.com/users/21926/sean-bright"}, "edited": false, "score": 0, "creation_date": 1553719740, "post_id": 55385736, "comment_id": 97494255, "body": "Thanks for suggestion. Gonna add the file I was trying."}, {"owner": {"reputation": 49387, "user_id": 1428679, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/d3eba7f8f9195a30d49bdbbdd594b1e4?s=128&d=identicon&r=PG", "display_name": "LSerni", "link": "https://stackoverflow.com/users/1428679/lserni"}, "edited": false, "score": 0, "creation_date": 1553719970, "post_id": 55385736, "comment_id": 97494373, "body": "You read two characters - say &quot;2&quot; and &quot;5&quot;, i.e. 0x32 (50d) and 0x35 (53d) - and sum them, so you have 103. And divide them by 49 by 2? This looks wrong to me.  If you&#39;re trying to implement Horner&#39;s algorithm, you should have <code>while((ch=getch()) != &#39;:&#39;) { min_count *= 60; min_count += (ch - &#39;0&#39;); }</code> or something like that. Better yet read a full line with <code>fgets()</code> and parse it with <code>strtok()</code> and <code>atoi()</code>, or maybe <code>sscanf()</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7555262"}, "edited": false, "score": 0, "creation_date": 1553720358, "post_id": 55385736, "comment_id": 97494571, "body": "I am reading the return values from <code>getc</code> and as that&#39;s the corresponding <code>ASCII</code> value for those numbers, I had to make em integers so, it&#39;s kind of a hack but it wasn&#39;t supposed to be what it is. I missed a subtraction. Lemme edit it"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7555262"}, "reply_to_user": {"reputation": 49387, "user_id": 1428679, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/d3eba7f8f9195a30d49bdbbdd594b1e4?s=128&d=identicon&r=PG", "display_name": "LSerni", "link": "https://stackoverflow.com/users/1428679/lserni"}, "edited": false, "score": 0, "creation_date": 1553720828, "post_id": 55385736, "comment_id": 97494795, "body": "@LSerni, it&#39;s fine now."}, {"owner": {"reputation": 109324, "user_id": 21926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6e61d47f9a6ec0a7a286835e51f3332?s=128&d=identicon&r=PG", "display_name": "Sean Bright", "link": "https://stackoverflow.com/users/21926/sean-bright"}, "edited": false, "score": 0, "creation_date": 1553721050, "post_id": 55385736, "comment_id": 97494903, "body": "An an aside, why use the decimal ASCII values instead of just <code>&#39;:&#39;</code> and <code>&#39;,&#39;</code>, etc. in your comparisons? The latter would be more readable."}, {"owner": {"reputation": 49387, "user_id": 1428679, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/d3eba7f8f9195a30d49bdbbdd594b1e4?s=128&d=identicon&r=PG", "display_name": "LSerni", "link": "https://stackoverflow.com/users/1428679/lserni"}, "edited": false, "score": 0, "creation_date": 1553723443, "post_id": 55385736, "comment_id": 97495900, "body": "@Gaurav are you sure? The code looks identical to me. More to the point, I have tested it with all sixty numbers from &quot;00&quot; to &quot;59&quot; - the correct result is never returned. For example when minutes are &quot;00&quot;, you add 48 and 48, obtaining 96. Then you subtract &quot;minute_end/(49*count)&quot; with a count of 2, so you divide minute_end, which is 96, by 49*2 which is 98. Being integers, 96/98 is zero; thus you obtain a minute value of 96.  I would suggest writing a function that read digit bytes up to a non-digit, and returned their decimal values."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user7555262"}, "edited": false, "score": 0, "creation_date": 1553766226, "post_id": 55387155, "comment_id": 97509185, "body": "It helps a little bit, i.e it starts execution but now when I use you function to get input, it just reaches to the EOF directly and I con&#39;t figure out that issue."}], "tags": [], "owner": {"reputation": 49387, "user_id": 1428679, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/d3eba7f8f9195a30d49bdbbdd594b1e4?s=128&d=identicon&r=PG", "display_name": "LSerni", "link": "https://stackoverflow.com/users/1428679/lserni"}, "is_accepted": false, "score": 0, "last_activity_date": 1553724177, "creation_date": 1553724177, "answer_id": 55387155, "question_id": 55385736, "link": "https://stackoverflow.com/questions/55385736/what-am-i-doing-wrong-here-trying-to-program-a-srt-parser-in-c/55387155#55387155", "title": "What am I doing wrong here (trying to program a *.srt parser in C)?", "body": "<p>One of your problems, possibly the one your are experiencing now, is that <code>getc()</code> does not return the ASCII value of the character read. It may also return EOF if there's nothing more to read.</p>\n\n<p>And since your cycles end when a certain character is found (e.g. \":\"), and EOF is most definitely <em>not</em> that character, your program will, in those cases, <strong>loop forever</strong>.</p>\n\n<p>I would suggest encapsulating that logic into a digit-reading function:</p>\n\n<pre><code>/**\n * Reads a positive number (hopefully less than INT_MAX) from a stream\n * Returns -1 if the stream is at end-of-file\n * \n * @param FILE *fp\n * @return int            the number read, or -1 if EOF\n */\n\nint readDigits(FILE *fp) {\n    int value = 0, c;\n    if (feof(fp)) {\n        return -1;\n    }\n    for (;;) {\n        c = fgetc(fp);\n        // EOF is not a digit so we catch it in the digit check\n        // if (EOF == c) {\n        //    break;\n        // }\n        if ((c &lt; '0') || (c &gt; '9')) {\n            break;\n        }\n        value *= 10;\n        value += (c - '0');\n    }\n    return value;\n}\n\nint seconds(int h, int m, int s) {\n    return (h*60 + m) * 60 + s;\n}\n</code></pre>\n\n<p>Now you can do:</p>\n\n<pre><code>hour_start = readDigits(fp);\nif (hour_start &lt; 0) {\n    // Error, do something\n}\nmin_start = readDigits(fp);\n// check if -1\nsec_start = readDigits(fp);\n// check if -1\n\nsec_start = seconds(hour_start, min_start, sec_start);\n\n...\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user7555262"}, "is_accepted": true, "score": 0, "last_activity_date": 1554289259, "last_edit_date": 1554289259, "creation_date": 1553865884, "answer_id": 55418436, "question_id": 55385736, "link": "https://stackoverflow.com/questions/55385736/what-am-i-doing-wrong-here-trying-to-program-a-srt-parser-in-c/55418436#55418436", "title": "What am I doing wrong here (trying to program a *.srt parser in C)?", "body": "<p>I solved it : </p>\n\n<p>I rewrote it from scratch with a shitload of comments</p>\n\n<pre><code>/* Third attempt to create a subtitle parser\n * 29 March, 2019\n * 12:55\n */\n\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;ncurses.h&gt;\n\n/* to convert strings of format hh:mm:ss,m_s to seconds (ignoring milliseconds for now) */\nint strToTime(char start[13], char end[13]);\n\nint main(int argc, char **args){\n\n    short count, shouldExit = 0;\n    int duration, timeBwDialogues;\n    char ch, startTimeStr[13], endTimeStr[13], prevTimeStr[13];\n    FILE *fp;\n\n    endTimeStr[0] = 0;\n\n    /* Check if argument is present */\n    if(args[1] == NULL){\n        printf(\"No file specified!\\n\");\n        exit(1);\n    }\n\n    /* Opening file for reading */\n    printf(\"Trying to open file \\\"%s\\\"\\n\", args[1]);\n    fp = fopen(args[1], \"r\");\n    /* Checking if file was opened properly */\n    if(fp == NULL){\n        printf(\"Failed to open file \\\"%s\\\"!\\n\", args[1]);\n        exit(2);\n    }\n\n    /* Checking if file has contents or not */\n    if((ch = getc(fp)) == EOF){\n        printf(\"File has no contents!\\n\");\n        exit(3);\n    }\n    ungetc(ch, fp); /* putting ch back as file isn't empty */\n\n    /* Section for setting up dialogue-number details\n     * If I ever want to do that\n     */\n\n    /* initialising screen for nCurses */\n    initscr();\n\n    /* Here comes the actual stuff */\n    while(1){\n        /* As we aren't considering dialogue number, let's just skip that*/\n        while((getc(fp)) != '\\n');\n\n        /* Reading dialogue's starting time :\n         * It says keep reading until you find a character other that 0-9, ','\n         * or ':' and store it to startTimeStr[]. Finally pass startTimeStr[]\n         * to strToTime() to convert it to seconds(for now)\n         */\n        count = 0; /* Setting-up counter for the loop */\n        while(1){\n            ch = getc(fp);\n            if(ch == ' ' || ch == '-')\n                break;\n\n            startTimeStr[count] = ch;\n            count++;\n        }\n        startTimeStr[count] = '\\0'; /* to terminate the string */\n\n        /* Making a copy of endTimeStr[] in prevTimeStr[] to get timeBwDialogues */\n        if(endTimeStr[0]){\n            strcpy(prevTimeStr, endTimeStr);\n\n            /* Calculating timeBwDialogues */\n            timeBwDialogues = strToTime(prevTimeStr, startTimeStr);\n        } else\n            timeBwDialogues = strToTime(\"00:00:00,000\", startTimeStr);\n\n        /* For better readability */\n        clear();\n        refresh();\n        /* Sleeping when there's no voice for synchronisation */\n        sleep(timeBwDialogues);\n\n        /* Placing the pointer to right position for reading ending time.\n         * Using do-while to make sure at least one character is read before checking the condition\n         */\n        while((getc(fp)) != '&gt;');\n        if((ch = getc(fp)) == ' ');\n        else\n            ungetc(ch, fp);\n\n        /* Just similar to what was done above, reading ending time */\n        count = 0; /* Setting-up counter for the loop */\n        while(1){\n            ch = getc(fp);\n            if(ch == '\\n' || ch == ' ')\n                break;\n\n            endTimeStr[count] = ch;\n            count++;\n        }\n        endTimeStr[count] = '\\0'; /* to terminate the string */\n\n        /* Calculating duration for individual dialogues */\n        duration = strToTime(startTimeStr, endTimeStr); /* passing startTimeStr[] to strToTime */\n\n        /* displaying the dialogue */\n        while(1){\n            ch = getc(fp);\n\n            /* If ch is newline, the next character maybe EOF. So let's check */\n            if(ch == EOF){\n                shouldExit = 1;\n                break;\n            } else if(ch == '&lt;'){\n                while((ch = getc(fp)) != '&gt;');\n                continue;\n            } else if(ch == '\\n'){\n                if((ch = getc(fp)) == EOF){\n                    shouldExit  = 1;\n                    break;\n                } else if(ch == '\\n') /* if the next character is newline, it's the end of the dialogue */\n                    break;\n                else{\n                    ungetc(ch, fp);\n                    addch('\\n');\n                    continue;\n                }\n            }\n\n            /* As the next character to ch is not EOF, dialogue still exists(a dialogue might take multiple lines)\n             * and it should be put on the screen\n             */\n            addch(ch);\n        }\n        refresh();\n        sleep(duration);\n        if(shouldExit)\n            break;\n    }\n    /* Closing nCurses' window */\n    endwin();\n\n    /* Closing the file */\n    fclose(fp);\n\n    return 0;\n}\n\n/* Defining the function */\nint strToTime(char start[13], char end[13]){\n    int hour_start, hour_end, minute_start, minute_end, second_start, second_end;\n\n    /* Separating hh, mm and ss for starting time. As I said above, I'll ignore milliseconds */\n\n    /* getting hour_start */\n    hour_start = ((start[0] - '0')*10)+(start[1] - '0');\n    /* getting minute_start */\n    minute_start = ((start[3] - '0')*10)+(start[4] - '0');\n    /* getting second_start */\n    second_start = ((start[6] - '0')*10)+(start[7] - '0');\n\n    /* Separating hh, mm and ss for ending time. As I said above, I'll ignore milliseconds */\n\n    /* getting hour_end */\n    hour_end = ((end[0] - '0')*10)+(end[1] - '0');\n    /* getting minute_end */\n    minute_end = ((end[3] - '0')*10)+(end[4] - '0');\n    /* getting second_end */\n    second_end = ((end[6] - '0')*10)+(end[7] - '0');\n\n    return ( ( ( ( (hour_end - hour_start) * 60) + (minute_end - minute_start) ) * 60) + (second_end - second_start) );\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7555262"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 55418436, "answer_count": 2, "score": 0, "last_activity_date": 1554289259, "creation_date": 1553717713, "last_edit_date": 1553720800, "question_id": 55385736, "link": "https://stackoverflow.com/questions/55385736/what-am-i-doing-wrong-here-trying-to-program-a-srt-parser-in-c", "title": "What am I doing wrong here (trying to program a *.srt parser in C)?", "body": "<p>I just found a <code>*.srt</code> file that <code>mpv</code> fails to load. So, I thought let's make my own subtitle parser that takes subtitle's path as command-line argument. Here's what I tried :</p>\n\n<pre><code>/* Intended to be a program for parsing *.srt subtitles as an alternative to video players' */\n\n#include &lt;ncurses.h&gt;\n#include &lt;unistd.h&gt;\n\n#define SEC_IN_MIN 60\n#define MIN_IN_HR 60\n\nlong get_duration(FILE *fp); // to get the duration of a dialogue in seconds\nlong turn_to_sec(int hours, int minutes, int seconds); // returns sum of hours and minutes, all in seconds\n\nint main(int argc, char **argv)\n{\n    FILE *fp;\n    long sec;\n    char ch;\n\n    if(argv[1] == NULL)\n    {\n        printf(\"Please enter a filename!\\n\");\n        return 1;\n    }\n    printf(\"Trying to open specified file %s\\n\",argv[1]);\n\n    fp = fopen(argv[1],\"r\");\n    if(fp == NULL)\n    {\n        printf(\"Error while opening file %s\\n\",argv[1]);\n        return 1;\n    }\n\n    initscr(); // initialise nCurses window\n\n    ch = getc(fp);\n    while(ch != EOF)\n    {\n        clear();\n        sec = get_duration(fp);\n        while(1)\n        {\n            if((ch = getc(fp)) == '\\n')\n            {\n                if((ch = getc(fp)) == '\\n' || ch == EOF)\n                    break;\n                else\n                    addch(ch);\n            }\n            addch(ch);\n        }\n        refresh();\n        sleep(sec);\n    }\n\n    endwin(); // close nCurses\n    fclose(fp); // close the file\n    return 0;\n}\n\nlong get_duration(FILE *fp)\n{\n    long duration = 0;\n    char ch;\n    short hour_start = 0, hour_end = 0, minute_start = 0, minute_end = 0, second_start = 0, second_end = 0;\n    short count=0;\n\n    /* just to get to the point where time-specs of the dialogue start */\n    while((ch = getc(fp)) != '\\n');\n\n    /* extract characters until ':' to get hour_start */\n    while((ch = getc(fp)) != 58)\n    {\n        hour_start += ch;\n        count++;\n    }\n    hour_start -= (hour_start/(49*count));\n\n    /* extract characters until ':' to get minute_start */\n    count = 0;\n    while((ch = getc(fp)) != 58)\n    {\n        minute_start += ch;\n        count++;\n    }\n    minute_start -= (minute_start/(49*count));\n\n    /* extract characters until ',' to get second_start */\n    count = 0;\n    while((ch = getc(fp)) != 44)\n    {\n        second_start += ch;\n        count++;\n    }\n    second_start -= (second_start/(49*count));\n\n    /* now, see if you can find a '&gt;' */\n    while((ch = getc(fp)) != 62);\n    ch = getc(fp); // to get rid of that space after \"--&gt;\"\n\n    /* extract characters until ':' to get hour_end */\n    while((ch = getc(fp)) != 58)\n    {\n        hour_end += ch;\n        count++;\n    }\n    hour_end -= (hour_end/(49*count));\n\n    /* extract characters until ':' to get minute_end */\n    count = 0;\n    while((ch = getc(fp)) != 58)\n    {\n        minute_end += ch;\n        count++;\n    }\n    minute_end -= (minute_end/(49*count));\n\n    /* extract characters until ',' to get second_end */;\n    count = 0;\n    while((ch = getc(fp)) != 44)\n    {\n        second_end += ch;\n        count++;\n    }\n    second_end -= (second_end/(49*count));\n\n    /* finally, gonna get those values */\n    second_end -= second_start;\n    minute_end -= minute_start;\n    hour_end -= hour_start;\n\n    duration += (turn_to_sec(hour_end, minute_end, second_end));\n\n    /* positioning the fp to the right position just to keep the 'main()' :) */\n    while((ch = getc(fp)) != '\\n' || ch != EOF);\n\n    return duration;\n}\n\nlong turn_to_sec(int hours, int minutes, int seconds)\n{\n    long temp;\n\n    /* manipulating hours */\n    temp = hours;\n    temp *= MIN_IN_HR;\n    temp *= SEC_IN_MIN;\n\n    seconds += temp;\n\n    /* manipulating minutes */\n    temp = minutes;\n    temp *= SEC_IN_MIN;\n\n    seconds += temp;\n\n    return seconds;\n}\n</code></pre>\n\n<p>On first attempt, I was using just the <strong>dialogue's start time</strong> as <strong>dialogue's duration</strong>, i.e <em>end_time - start_time</em> and that's why, this part was missing :</p>\n\n<pre><code>/* extract characters until ':' to get hour_end */\n    while((ch = getc(fp)) != 58)\n    {\n        hour_end += ch;\n        count++;\n    }\n    hour_end = (hour_end/(49*count));\n\n    /* extract characters until ':' to get minute_end */\n    count = 0;\n    while((ch = getc(fp)) != 58)\n    {\n        minute_end += ch;\n        count++;\n    }\n    minute_end = (minute_end/(49*count));\n\n    /* extract characters until ',' to get second_end */\n    count = 0;\n    while((ch = getc(fp)) != 44)\n    {\n        second_end += ch;\n        count++;\n    }\n    second_end = (second_end/(49*count));\n</code></pre>\n\n<p>and variables' names were a bit different and then I realised I was wrong but this is all irrelevant . I am just saying this because till then, code was working just fine (results were unexpected though there was some garbage) but now it just stucks and does nothing. Why is that? Much thanks for your time!</p>\n\n<p>Here's the file I am trying : <a href=\"https://gist.github.com/gaurav712/6646ad7dfd3c487536dce9b0712471e7\" rel=\"nofollow noreferrer\">https://gist.github.com/gaurav712/6646ad7dfd3c487536dce9b0712471e7</a></p>\n"}, {"tags": ["c", "c99"], "comments": [{"owner": {"reputation": 56328, "user_id": 4265352, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lzAUc5pYb24/AAAAAAAAAAI/AAAAAAAAAGQ/q3h7bZUnqrs/photo.jpg?sz=128", "display_name": "axiac", "link": "https://stackoverflow.com/users/4265352/axiac"}, "edited": false, "score": 2, "creation_date": 1553717437, "post_id": 55385607, "comment_id": 97493218, "body": "The error message tells you that the function <code>pipe2</code> has not been declared. You have to find out the standard header that declares it and include it."}, {"owner": {"reputation": 1149, "user_id": 2472827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t5rYY.jpg?s=128&g=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/2472827/neil"}, "edited": false, "score": 0, "creation_date": 1553717443, "post_id": 55385607, "comment_id": 97493220, "body": "You are probably compiling in C90, where implicit declarations were allowed. You should probably find a header file with it in it?"}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 1, "creation_date": 1553718345, "post_id": 55385607, "comment_id": 97493636, "body": "Or you&#39;re compiling in strict (<code>-std=c99</code>) instead of gnu (<code>-std=gnu99</code>) mode, which disables a bunch of feature test macros."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7555262"}, "edited": false, "score": 0, "creation_date": 1553719125, "post_id": 55385607, "comment_id": 97493953, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/8440816/warning-implicit-declaration-of-function\">warning: implicit declaration of function</a>"}], "answers": [{"comments": [{"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 1, "creation_date": 1553717669, "post_id": 55385662, "comment_id": 97493319, "body": "Looks like a bug on <code>libevent</code>, or may be the version is too old."}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 2, "last_activity_date": 1553717434, "creation_date": 1553717434, "answer_id": 55385662, "question_id": 55385607, "link": "https://stackoverflow.com/questions/55385607/how-to-fix-implicit-declaration-of-function-pipe2-is-invalid-in-c99/55385662#55385662", "title": "How to fix &#39;implicit declaration of function &#39;pipe2&#39; is invalid in C99&#39;", "body": "<p>This isn't a C99 issue. You need to include the header for <code>pipe2</code>. <a href=\"http://man7.org/linux/man-pages/man2/pipe.2.html\" rel=\"nofollow noreferrer\">According to the pipe2 manual</a> that is <code>unistd.h</code>.</p>\n\n<p>Why libevent isn't doing this itself is a valid question.</p>\n"}, {"tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": false, "score": 0, "last_activity_date": 1553717512, "creation_date": 1553717512, "answer_id": 55385679, "question_id": 55385607, "link": "https://stackoverflow.com/questions/55385607/how-to-fix-implicit-declaration-of-function-pipe2-is-invalid-in-c99/55385679#55385679", "title": "How to fix &#39;implicit declaration of function &#39;pipe2&#39; is invalid in C99&#39;", "body": "<p>At the top of the <a href=\"https://linux.die.net/man/2/pipe\" rel=\"nofollow noreferrer\">manpage</a> is</p>\n\n<pre><code>#define _GNU_SOURCE             /* See feature_test_macros(7) */\n#include &lt;fcntl.h&gt;              /* Obtain O_* constant definitions */\n#include &lt;unistd.h&gt;\n</code></pre>\n\n<p>You need those headers and the feature test macro.</p>\n\n<p>Then the identifier should become available, at least on Linux/glibc.</p>\n\n<p>Example:</p>\n\n<pre><code>#define _GNU_SOURCE             /* See feature_test_macros(7) */\n#include &lt;fcntl.h&gt;              /* Obtain O_* constant definitions */\n#include &lt;unistd.h&gt;\n\nint main()\n{\n    (void)&amp;pipe;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "is_accepted": false, "score": 2, "last_activity_date": 1553717522, "creation_date": 1553717522, "answer_id": 55385681, "question_id": 55385607, "link": "https://stackoverflow.com/questions/55385607/how-to-fix-implicit-declaration-of-function-pipe2-is-invalid-in-c99/55385681#55385681", "title": "How to fix &#39;implicit declaration of function &#39;pipe2&#39; is invalid in C99&#39;", "body": "<p>You need to include headers which declare functions you are using. In order to figure out which headers you need, you need to consult function documentation. On Posix functions, the best source is <code>man</code>.</p>\n\n<p><code>man pipe2</code> will give you following:</p>\n\n<pre><code>PIPE(2)                    Linux Programmer\u2019s Manual                   PIPE(2)\n\nNAME\n       pipe, pipe2 - create pipe\n\nSYNOPSIS\n       #include &lt;unistd.h&gt;\n\n       int pipe(int pipefd[2]);\n\n       #define _GNU_SOURCE\n       #include &lt;unistd.h&gt;\n\n       int pipe2(int pipefd[2], int flags);\n</code></pre>\n\n<p>Right there, in the Synopsis, you will see required header files.</p>\n"}, {"tags": [], "owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "is_accepted": false, "score": 0, "last_activity_date": 1553719825, "creation_date": 1553719825, "answer_id": 55386230, "question_id": 55385607, "link": "https://stackoverflow.com/questions/55385607/how-to-fix-implicit-declaration-of-function-pipe2-is-invalid-in-c99/55386230#55386230", "title": "How to fix &#39;implicit declaration of function &#39;pipe2&#39; is invalid in C99&#39;", "body": "<p>Upgrading to C11 is not the answer; rather downgrading to C90 where implicit declarations are allowed (but will generate a warning), or at least compiling with more permissive compiler options - perhaps <code>-std=gnu99</code> or <code>-std=c90</code> in combination with <code>-Wno-implicit</code> to suppress the warning.</p>\n\n<p>A better alternative is to include the appropriate header <code>&lt;unistd.h&gt;</code> in evutil.c, however you may prefer not to modify the library code, in which case you can compile it with a forced include with the compiler option <code>-include unistd.h</code>.  This pre-processor option will process the source file file as if #include \"file\" appeared as the first line.</p>\n"}], "owner": {"reputation": 439, "user_id": 5874710, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-yGBPEa4a4QY/AAAAAAAAAAI/AAAAAAAAXC4/aQH6J4oTlks/photo.jpg?sz=128", "display_name": "Carla Camargo", "link": "https://stackoverflow.com/users/5874710/carla-camargo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2699, "favorite_count": 0, "accepted_answer_id": 55385662, "answer_count": 4, "score": 5, "last_activity_date": 1553719825, "creation_date": 1553717157, "question_id": 55385607, "link": "https://stackoverflow.com/questions/55385607/how-to-fix-implicit-declaration-of-function-pipe2-is-invalid-in-c99", "title": "How to fix &#39;implicit declaration of function &#39;pipe2&#39; is invalid in C99&#39;", "body": "<p>I'm trying to build my library but a file called evutil.c fom libevent is giving me a hard time. </p>\n\n<p><code>libevent/evutil.c: error: implicit declaration of function 'pipe2' is invalid in C99</code></p>\n\n<p>The code involved is:</p>\n\n<pre><code>    if (pipe2(fd, O_NONBLOCK|O_CLOEXEC) == 0)\n        return 0;\n</code></pre>\n\n<p>I can't update my code to c11 right now. \nHow should I change the code to not get this error anymore?</p>\n"}, {"tags": ["c", "floating-point"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 3, "creation_date": 1553717033, "post_id": 55385561, "comment_id": 97493033, "body": "This usually happens when you divide by zero. The only division I see is by <code>ossz&#47;100</code>. So I guess it is zero (which is very likely as it is an <i>integer</i> division)."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 3, "creation_date": 1553717105, "post_id": 55385561, "comment_id": 97493063, "body": "Rewrite the last printf argument to kasua[max]*100/ossz"}, {"owner": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "edited": false, "score": 0, "creation_date": 1553717287, "post_id": 55385561, "comment_id": 97493160, "body": "Side note: Avoid long statements like the one containing <code>printf()</code>. Try to simplify it so that it doesn&#39;t confuse you or anyone else later on."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 3, "creation_date": 1553718928, "post_id": 55385561, "comment_id": 97493858, "body": "Unless <code>ossz</code> reaches at least 100, your division by <code>(ossz &#47; 100)</code> is equivalent to &#39;(integer) divide by zero&#39; \u2014 which is just about the only reason you get a &#39;floating point exception&#39; these days.  Floating point operations, even divisions by zero, don&#39;t usually generate a floating point exception but rather an infinity."}, {"owner": {"reputation": 27437, "user_id": 95954, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iD0qO.png?s=128&g=1", "display_name": "Rudy Velthuis", "link": "https://stackoverflow.com/users/95954/rudy-velthuis"}, "edited": false, "score": 0, "creation_date": 1553770755, "post_id": 55385561, "comment_id": 97512031, "body": "It would help if you could indicate on which line the error happens. If your error message doesn&#39;t say, then use a debugger to find out."}, {"owner": {"reputation": 27437, "user_id": 95954, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iD0qO.png?s=128&g=1", "display_name": "Rudy Velthuis", "link": "https://stackoverflow.com/users/95954/rudy-velthuis"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553770936, "post_id": 55385561, "comment_id": 97512138, "body": "@JonathanLeffler: unless something sets or resets certain flags, like e.g. some DLLs do in Windows, and perhaps other code on other platforms too."}], "answers": [{"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 0, "last_activity_date": 1554244771, "creation_date": 1554244771, "answer_id": 55484509, "question_id": 55385561, "link": "https://stackoverflow.com/questions/55385561/floating-point-exception-c-why/55484509#55484509", "title": "Floating point exception C. Why?", "body": "<p>Code incurs division by zero due to <code>kassza[max] / (ossz / 100)</code> and <code>ossz &lt; 100</code>.  </p>\n\n<p>In that case, <code>ossz/100</code> --> 0 due to integer division and then <code>kassza[max] / 0</code> is division by zero.</p>\n\n<p>Integer division by 0 is often (mis-)reported as a <em>Floating point exception</em>.</p>\n"}], "owner": {"reputation": 27, "user_id": 11268514, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01d52f85f59be85e24e6948e4847c3b6?s=128&d=identicon&r=PG&f=1", "display_name": "marcellnemeth", "link": "https://stackoverflow.com/users/11268514/marcellnemeth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554244771, "creation_date": 1553716931, "last_edit_date": 1553717824, "question_id": 55385561, "link": "https://stackoverflow.com/questions/55385561/floating-point-exception-c-why", "title": "Floating point exception C. Why?", "body": "<p>I wrote a simple code in C about the traffic of cash register, but I always get \"Floating point exception\". I know, it's happen at overflow and dividing by zero, but I think at this case contain none of these. Here's the code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(void) \n{\n    int kassza[32] = {0};\n    int a;\n    int ossz = 0;\n\n    scanf(\"%d\", &amp;a);\n    printf(\"meg ok\");\n\n    while (a != 0) \n    {\n        kassza[a - 1]++;\n        ossz++;\n        scanf(\"%d\", &amp;a);\n    }\n\n    int max = 0;\n    for (int a = 1; a &lt; 32; a++)\n    {\n        if (kassza[a] &gt; kassza[max]) \n        {\n            max = a;\n        }\n    }\n    printf(\"%d. kassza: %d %%-a az osszes vevonek\\n\", max + 1, kassza[max], kassza[max] / (ossz / 100));\n    return 0;\n}\n</code></pre>\n\n<p>so idk why this,pls help me!</p>\n"}, {"tags": ["c++", "c", "interop"], "comments": [{"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1553716671, "post_id": 55385467, "comment_id": 97492859, "body": "May be you&#39;d better not compile with code with C++ compiler? This looks like one of the not so many examples when C++ compiler should not be used to compile C headers. I believe your problem does not have a solution in C++. No matter what you do, a nested type in C++ will be a nested type, and will never become global."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1553716782, "post_id": 55385467, "comment_id": 97492901, "body": "By the way, I wonder why this question was downvoted. It is a valid question, even if it doesn&#39;t seem to have a solution."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1553717903, "post_id": 55385467, "comment_id": 97493432, "body": "The only way to fix it sanely is to make the nested declaration in C non-nested.  The local rules for your C code headers that have to be usable from C++ says &quot;though shalt not define a structure or union (or enumeration) type within another structure or union type definition&quot; \u2014 I don&#39;t think you can nest type definitions within an enumeration, so that problem doesn&#39;t arise."}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1553718128, "post_id": 55385467, "comment_id": 97493536, "body": "Don&#39;t use global variables."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 10330832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5dfee0d2329a877bd0d9d0e1689bf90?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Yan", "link": "https://stackoverflow.com/users/10330832/michael-yan"}, "is_accepted": false, "score": 1, "last_activity_date": 1553735815, "creation_date": 1553735815, "answer_id": 55388797, "question_id": 55385467, "link": "https://stackoverflow.com/questions/55385467/c-and-c-header-define-global-struct-inside-of-another-struct/55388797#55388797", "title": "C and C++ header: Define global struct inside of another struct", "body": "<p>I recommend this</p>\n\n<pre><code>struct my_library_a_t {\n    struct my_library_b_t {\n        int data;\n        struct my_library_c_t {\n            int data;\n        } c;\n    } b;\n    int data;\n};\n#ifdef __cplusplus\n    typedef struct my_library_a_t::my_library_b_t my_library_b_t;\n    typedef struct my_library_b_t::my_library_c_t my_library_c_t;\n#else\n    typedef struct my_library_a_t my_library_a_t;\n    typedef struct my_library_b_t my_library_b_t;\n    typedef struct my_library_c_t my_library_c_t;\n#endif\n</code></pre>\n\n<p>Notice that after alias my_library_b_t, you don't need to use my_library_a_t::my_library_b_t::my_library_c_t</p>\n"}], "owner": {"reputation": 15724, "user_id": 5754656, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/7jfX3.png?s=128&g=1", "display_name": "Artyer", "link": "https://stackoverflow.com/users/5754656/artyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1553735815, "creation_date": 1553716473, "question_id": 55385467, "link": "https://stackoverflow.com/questions/55385467/c-and-c-header-define-global-struct-inside-of-another-struct", "title": "C and C++ header: Define global struct inside of another struct", "body": "<p>I have some C code that has some structs that looks like this:</p>\n\n\n\n<pre class=\"lang-cpp prettyprint-override\"><code>typedef struct my_library_a_t my_library_a_t;\ntypedef struct my_library_b_t my_library_b_t;\ntypedef struct my_library_c_t my_library_c_t;\n\nstruct my_library_a_t {\n    struct my_library_b_t {\n        int data;\n        struct my_library_c_t {\n            int data;\n        } c;\n    } b;\n    int data;\n};\n</code></pre>\n\n<p>This doesn't work in C++, because in C <code>struct my_library_b_t</code> defines a global <code>struct my_library_b_t</code>, whereas in C++ it defines <code>::my_library_a_t::my_library_b_t</code>.</p>\n\n<p>How can I get the inner struct definition to define a global struct in C++? Or even just not have to change too much code for it to work (I don't mind having a <code>#ifdef __cplusplus</code> block, but I don't want to pull the structs out because the reason they are nested in the first place is that they are used only one time each, and it's really hard to read when the inner class definitions are above the outer class definitions)</p>\n\n<p>I tried <code>struct ::my_library_b_t</code> in the definition, but this doesn't work.</p>\n\n<p>For context, I'm parsing a string that has a definition that would look like this:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>a     = b \",\" data\nb     = data \",\" c\nc     = data\ndata  = %x31-39 *DIGIT  ; 1-9 followed by *(0-9)\n      / \"0\"\n</code></pre>\n\n<p>And the intermediate parts have meaning, so it's useful to be able to have functions that take <code>my_library_b_t*</code> or <code>my_library_c_t*</code>.</p>\n\n<p>I would prefer to have a solution that looks like this:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#ifdef __cplusplus\n#define GLOBAL_STRUCT(name) ???  (I tried `:: name`)\nextern \"C\" {\n#else\n#define GLOBAL_STRUCT(name) name\n#endif\n\nstruct my_library_a_t {\n    struct GLOBAL_STRUCT(my_library_b_t) {\n// ...\n</code></pre>\n"}, {"tags": ["sql", "c", "sqlite", "char"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1553715119, "post_id": 55385093, "comment_id": 97492093, "body": "<code>char *sql = (...);</code> I think you forgot <code>*printf</code> function associated with the parentheses here.  You&#39;ll also want to allocate some space to <code>sql</code> if you&#39;re planning on writing something into it."}, {"owner": {"reputation": 8570, "user_id": 2293156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/800e791e8e13500e516c9ae77299160a?s=128&d=identicon&r=PG", "display_name": "Amadeus", "link": "https://stackoverflow.com/users/2293156/amadeus"}, "edited": false, "score": 3, "creation_date": 1553715198, "post_id": 55385093, "comment_id": 97492136, "body": "There are so many errors that I dont know where to start. Maybe you can start at the manuals (<a href=\"https://www.sqlite.org/c3ref/exec.html\" rel=\"nofollow noreferrer\">sqlite.org/c3ref/exec.html</a>), taking a careful thought about this: <i>The application must ensure that the 1st parameter to sqlite3_exec() is a valid and open database connection.</i>"}], "answers": [{"tags": [], "owner": {"reputation": 52186, "user_id": 1553090, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Wj4s1.png?s=128&g=1", "display_name": "paddy", "link": "https://stackoverflow.com/users/1553090/paddy"}, "is_accepted": true, "score": 1, "last_activity_date": 1553716077, "last_edit_date": 1553716077, "creation_date": 1553715629, "answer_id": 55385258, "question_id": 55385093, "link": "https://stackoverflow.com/questions/55385093/error-incompatible-types-when-initializing-type-char-using-type-double/55385258#55385258", "title": "error: incompatible types when initializing type &#39;char *&#39; using type &#39;double&#39;", "body": "<p>It looks like you are trying to build a string.  For that you can use <a href=\"https://en.cppreference.com/w/c/io/fprintf\" rel=\"nofollow noreferrer\"><code>snprintf</code></a>.</p>\n\n<pre><code>char sql[64];\nint size = snprintf(sql, 64, \"SELECT %lf/(%lf * %lf);\", peso, altura, altura);\n</code></pre>\n\n<p>Note that I kept the return value.  This is to handle any future error where you modify a statement in a way that might result in buffer overflow or other error.  You can probably just deal with this by using a debug assertion, as this pre-sized string should be large enough to hold the intended SQL.</p>\n\n<pre><code>if (size &lt; 0 || size &gt;= 64) {\n    assert(0);\n    return 0;\n}\n</code></pre>\n\n<p>However, since you are using sqlite library, you should instead use the proper methods to prepare a statement and <em>bind</em> values to it, rather than inserting the values into the string yourself.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10821857"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 55385258, "answer_count": 1, "score": -5, "last_activity_date": 1553716077, "creation_date": 1553714907, "last_edit_date": 1553715860, "question_id": 55385093, "link": "https://stackoverflow.com/questions/55385093/error-incompatible-types-when-initializing-type-char-using-type-double", "title": "error: incompatible types when initializing type &#39;char *&#39; using type &#39;double&#39;", "body": "<p>Good afternoon, \nI've got this code below:</p>\n\n<pre><code>double bd_sacar_imc(double altura, double peso) {\nsqlite3 *db;\nchar *zErrMsg = 0;\nint rc;\n\nchar *sql = (\"SELECT %lf/(%lf * %lf);\", peso, altura, altura);\n\nrc = sqlite3_exec(db, sql, callback, 0, &amp;zErrMsg);\n\nif (rc != SQLITE_OK) {\n    fprintf(stderr, \"SQL error: %s\\n\", zErrMsg);\n    sqlite3_free(zErrMsg);\n    return 0;\n} else {\n    fprintf(stdout, \"Consulta creada con exito\\n\");\n    return peso / (altura * altura);\n}};\n</code></pre>\n\n<p>However, I get this error:</p>\n\n<pre><code>..\\BD\\bd.c:170:14: error: incompatible types when initializing type 'char *' using type 'double' char *sql = (\"SELECT %lf /( %lf * %lf);\", peso, altura, altura);\n</code></pre>\n\n<p>What might be happening?</p>\n"}, {"tags": ["c", "string", "strtok"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1553715067, "post_id": 55384990, "comment_id": 97492075, "body": "Why not <code>sscanf</code> ?"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1553715131, "post_id": 55384990, "comment_id": 97492102, "body": "The question confuses me for giving the impression that you are unaware of arrays. Please explain why you use numbered variables (struct members) instead of an array."}, {"owner": {"reputation": 3885, "user_id": 652528, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a580420b66f89e76e1fb9a368f785b3f?s=128&d=identicon&r=PG", "display_name": "geckos", "link": "https://stackoverflow.com/users/652528/geckos"}, "edited": false, "score": 0, "creation_date": 1553715391, "post_id": 55384990, "comment_id": 97492233, "body": "I just tested on macos and strtok will not segfauls, it just keep returning null. What would happen is that you strcpy is segfaulting"}, {"owner": {"reputation": 3885, "user_id": 652528, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a580420b66f89e76e1fb9a368f785b3f?s=128&d=identicon&r=PG", "display_name": "geckos", "link": "https://stackoverflow.com/users/652528/geckos"}, "edited": false, "score": 0, "creation_date": 1553715439, "post_id": 55384990, "comment_id": 97492256, "body": "test this on your platform: <a href=\"https://pastebin.com/xjW2bYtK\" rel=\"nofollow noreferrer\">pastebin.com/xjW2bYtK</a>"}, {"owner": {"reputation": 3885, "user_id": 652528, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a580420b66f89e76e1fb9a368f785b3f?s=128&d=identicon&r=PG", "display_name": "geckos", "link": "https://stackoverflow.com/users/652528/geckos"}, "edited": false, "score": 0, "creation_date": 1553715563, "post_id": 55384990, "comment_id": 97492333, "body": "<a href=\"https://onlinegdb.com/ryIPWLt_N\" rel=\"nofollow noreferrer\">onlinegdb.com/ryIPWLt_N</a> here it segfaults,"}], "answers": [{"tags": [], "owner": {"reputation": 367, "user_id": 10930163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a82a32b93373e472ee666e96b00d1b5?s=128&d=identicon&r=PG&f=1", "display_name": "anonmess", "link": "https://stackoverflow.com/users/10930163/anonmess"}, "is_accepted": false, "score": 1, "last_activity_date": 1553715423, "creation_date": 1553715423, "answer_id": 55385210, "question_id": 55384990, "link": "https://stackoverflow.com/questions/55384990/how-do-i-use-strtok-to-cut-a-string-that-varies-in-size/55385210#55385210", "title": "How do I use strtok to cut a string that varies in size?", "body": "<p>Typically, strtok is used in a loop. For example:</p>\n\n<pre><code>char *token = strtok(input_string, \".\");\nwhile(token != NULL) {\n    //do code\n    token = strtok(NULL, \".\");\n}\n</code></pre>\n\n<p>This way, the loop ends when the first failed parse happens. strtok should continue to return NULL after the end of the input string anytime you use it, so that shouldn't be causing the issue, but it might be. </p>\n\n<p>The most likely issue in my opinion is with the way you use strtok in strcpy. The strcpy is probably failing because the source string is NULL. What I would do if you don't want to use the loop is</p>\n\n<pre><code>token = strtok(NULL, \":\");\nstrcpy(a.name2, token);\n</code></pre>\n\n<p>This way, you ensure that it isn't a NULL pointer before trying to copy. strcpy works on an empty string (\"\"), but it doesn't work on a NULL pointer.</p>\n\n<p>The other thing you may want to check is that the destination strings (a.name2, etc) are allocated enough space. If not, this would also cause a seg fault.</p>\n"}, {"tags": [], "owner": {"reputation": 138, "user_id": 10911242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56d36edcc94a17d299b872b1e38afecd?s=128&d=identicon&r=PG&f=1", "display_name": "risbo", "link": "https://stackoverflow.com/users/10911242/risbo"}, "is_accepted": false, "score": 1, "last_activity_date": 1553715805, "creation_date": 1553715805, "answer_id": 55385307, "question_id": 55384990, "link": "https://stackoverflow.com/questions/55384990/how-do-i-use-strtok-to-cut-a-string-that-varies-in-size/55385307#55385307", "title": "How do I use strtok to cut a string that varies in size?", "body": "<p>strotok() returns NULL if there is no more tokens. So you should check return value, for example:</p>\n\n<pre><code>if( (token = strtok(c,\":\")) != NULL ) \n    strcpy(a.name1,token);\nelse\n   // token is NULL, there is no more tokens, end of string reached\n   // you can return or do something else\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 10590473, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-377he5ma73E/AAAAAAAAAAI/AAAAAAAAAHE/lzUoD_BG9SE/photo.jpg?sz=128", "display_name": "alvarosaldanha", "link": "https://stackoverflow.com/users/10590473/alvarosaldanha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1553715805, "creation_date": 1553714498, "question_id": 55384990, "link": "https://stackoverflow.com/questions/55384990/how-do-i-use-strtok-to-cut-a-string-that-varies-in-size", "title": "How do I use strtok to cut a string that varies in size?", "body": "<p>So, i'm fairly new to C, and i get as input a string like this <code>a:name:number:number:number:number:name:name</code> and i'm using strtok to get all the names and numbers without the <code>\":\"</code>. The thing is, the size the string can vary and it can have up to more 2 names(always at the end) like: <code>a:name:number:number:number:number:name:name:name</code> or <code>a:name:number:number:number:number:name:name:name:name</code>.</p>\n\n<p>Now, i'm using a struct and strcpy to get each name in the struct but because of the quantity of names changes in the end, i get Segmentation Faults when there are less than 4 names at the end, which is the maximum number of names(minimum is 1) and I think it's because i continue to do strtok after the end of the string.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>char *token;\nstructname a;\ntoken = strtok(c,\":\"); //c is the input string\nstrcpy(a.name1,strtok(NULL,\":\"));\na.number1 = atoi(strtok(NULL,\":\"));\na.number2 = atoi(strtok(NULL,\":\"));\na.number3 = atoi(strtok(NULL,\":\"));\na.number4 = atoi(strtok(NULL,\":\"));\nstrcpy(a.name2,strtok(NULL,\":\"));\nstrcpy(a.name3,strtok(NULL,\":\"));\nstrcpy(a.name4,strtok(NULL,\":\"));\nstrcpy(a.name5,strtok(NULL,\":\"));\n</code></pre>\n\n<p>So, i'm guessing that the error occurs because it continues to do strtok even after the string is over in the cases where there are no 4 middle names? \nI want to know how i can, for example, in a case where there are 2 names at the end, just get <code>a.name4</code> and <code>a.name5</code> to <code>\"\\0\"</code> or just dont get anything in those strings.\nThanks for time and help!</p>\n"}, {"tags": ["c", "windows", "sockets"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1553713461, "post_id": 55384591, "comment_id": 97491360, "body": "How do you use this function? What behavior did you expect? If you only call <code>recv</code> after this function returns <code>true</code>, then of course your program will (in a way) behave like the socket was non-blocking, you don&#39;t call the <code>recv</code> function which does the blocking."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1553713472, "post_id": 55384591, "comment_id": 97491369, "body": "Also, don&#39;t forget to check for errors from <code>select</code>."}, {"owner": {"reputation": 93, "user_id": 4445584, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bCOuv.jpg?s=128&g=1", "display_name": "Massimo Manca", "link": "https://stackoverflow.com/users/4445584/massimo-manca"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1553715437, "post_id": 55384591, "comment_id": 97492254, "body": "Well... I would expect select returns a positive value if there are available data to read calling recv(). If selects returns a negative value may be a select error or the socket is closed. So, I started as simple as possible to see it working or not just in case of no data available."}, {"owner": {"reputation": 93, "user_id": 4445584, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bCOuv.jpg?s=128&g=1", "display_name": "Massimo Manca", "link": "https://stackoverflow.com/users/4445584/massimo-manca"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1553715470, "post_id": 55384591, "comment_id": 97492274, "body": "Yes, sure, I can check better select errors at least now to understand how to implement my function."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 1, "creation_date": 1553717481, "post_id": 55384591, "comment_id": 97493240, "body": "<code>select()</code> will return <code>&gt; 0</code> if the socket is readable, 0 on timeout, and -1 on error. So, since you are only checking 1 socket, you can do this instead: <code>return select(...) &gt; 0;</code>"}], "owner": {"reputation": 93, "user_id": 4445584, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bCOuv.jpg?s=128&g=1", "display_name": "Massimo Manca", "link": "https://stackoverflow.com/users/4445584/massimo-manca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 424, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1553715786, "creation_date": 1553712873, "question_id": 55384591, "link": "https://stackoverflow.com/questions/55384591/how-to-check-if-there-are-available-data-to-read-before-to-call-recv-in-a-blocki", "title": "How to check if there are available data to read before to call recv in a blocking socket context on Windows PCs", "body": "<p>I wrote a short TCP client application to test a SW broker  using blocking sockets. It works well and I am happy with it. Now I need to modify it and I have a problem reading not solecited messages (messages coming from the server not initiated by the client) because recv() blocks the program flow until there is no data to read.\nGood solution for me may be to find a way to check if there are available data to read before calling recv() or that recv() may exit if there are no data to read within a certain period.\nSo I tried with this function:</p>\n\n<pre><code>static bool isDataAvailable(int socket)\n{\n   fd_set sready;\n   struct timeval nowait;\n\n   FD_ZERO(&amp;sready);\n   FD_SET((unsigned int) socket, &amp;sready);\n   memset((char *) &amp;nowait, 0, sizeof(nowait));\n\n   bool res = select(socket + 1, &amp;sready, NULL, NULL, &amp;nowait);\n   if(FD_ISSET(socket, &amp;sready))\n      res = true;\n   else\n      res = false;\n   return res;\n}\n//------------------------------------------------------------------------\n</code></pre>\n\n<p>but the result is that after the call all my application works as I selected to work using non blocking sockets. I normally use it on Linux and it works. I found some info around the web about select() and seems to me it would work also under Windows. But... something is going wrong.</p>\n\n<p>Any help and suggestion will be appreciated.\nThanks,\nMassimo</p>\n"}, {"tags": ["c", "struct", "unions", "bit-fields"], "comments": [{"owner": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 3, "creation_date": 1553712517, "post_id": 55384481, "comment_id": 97490886, "body": "They all occupy the exact same place in memory - that&#39;s what the <code>union</code> definition means. It doesn&#39;t matter how many different types there are in it"}], "answers": [{"comments": [{"owner": {"reputation": 543, "user_id": 11167518, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Pgw08oaXiaA/AAAAAAAAAAI/AAAAAAAABj0/Esy9fxNslfU/photo.jpg?sz=128", "display_name": "jcf", "link": "https://stackoverflow.com/users/11167518/jcf"}, "edited": false, "score": 0, "creation_date": 1553713848, "post_id": 55384749, "comment_id": 97491534, "body": "So the variable word, the byte array, and both structs will have always the same values? So if one is modified, the other three will also be modified accordingly?"}], "tags": [], "owner": {"reputation": 9554, "user_id": 3306465, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MAduK.png?s=128&g=1", "display_name": "Igal S.", "link": "https://stackoverflow.com/users/3306465/igal-s"}, "is_accepted": true, "score": 1, "last_activity_date": 1553713478, "creation_date": 1553713478, "answer_id": 55384749, "question_id": 55384481, "link": "https://stackoverflow.com/questions/55384481/i-dont-understand-the-behavior-of-this-c-code-union-with-2-bit-field-structs/55384749#55384749", "title": "I don&#39;t understand the behavior of this C code (union with 2 bit-field structs, a word and a byte array)", "body": "<p>You have 4 types in the same union. All of them are using the same memory.</p>\n\n<p>It doesn't matter which one of them you change - it will affect the others.</p>\n\n<p>The size of your type is 32 bytes - which in your case is also the size of every type inside it. Otherwise - it will be the size of the largest type inside.</p>\n"}], "owner": {"reputation": 543, "user_id": 11167518, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Pgw08oaXiaA/AAAAAAAAAAI/AAAAAAAABj0/Esy9fxNslfU/photo.jpg?sz=128", "display_name": "jcf", "link": "https://stackoverflow.com/users/11167518/jcf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 55384749, "answer_count": 1, "score": 0, "last_activity_date": 1553713478, "creation_date": 1553712387, "question_id": 55384481, "link": "https://stackoverflow.com/questions/55384481/i-dont-understand-the-behavior-of-this-c-code-union-with-2-bit-field-structs", "title": "I don&#39;t understand the behavior of this C code (union with 2 bit-field structs, a word and a byte array)", "body": "<p>I have the following piece of code in C:</p>\n\n<pre><code>typedef union _REG_CiFIFOCON {\n    struct {\n        uint32_t RxNotEmptyIE : 1;\n        uint32_t RxHalfFullIE : 1;\n        uint32_t RxFullIE : 1;\n        uint32_t RxOverFlowIE : 1;\n        uint32_t unimplemented1 : 1;\n        uint32_t RxTimeStampEnable : 1;\n        uint32_t unimplemented2 : 1;\n        uint32_t TxEnable : 1;\n        uint32_t UINC : 1;\n        uint32_t unimplemented3 : 1;\n        uint32_t FRESET : 1;\n        uint32_t unimplemented4 : 13;\n        uint32_t FifoSize : 5;\n        uint32_t PayLoadSize : 3;\n    } rxBF;\n\n    struct {\n        uint32_t TxNotFullIE : 1;\n        uint32_t TxHalfFullIE : 1;\n        uint32_t TxEmptyIE : 1;\n        uint32_t unimplemented1 : 1;\n        uint32_t TxAttemptIE : 1;\n        uint32_t unimplemented2 : 1;\n        uint32_t RTREnable : 1;\n        uint32_t TxEnable : 1;\n        uint32_t UINC : 1;\n        uint32_t TxRequest : 1;\n        uint32_t FRESET : 1;\n        uint32_t unimplemented3 : 5;\n        uint32_t TxPriority : 5;\n        uint32_t TxAttempts : 2;\n        uint32_t unimplemented4 : 1;\n        uint32_t FifoSize : 5;\n        uint32_t PayLoadSize : 3;\n    } txBF;\n    uint32_t word;\n    uint8_t byte[4];\n} REG_CiFIFOCON;\n</code></pre>\n\n<p>Both structs are 32 bit, so it is the word variable and the byte array (as this is composed of 4 bytes. 4x8 = 32 bits). </p>\n\n<p>My problem is: I don't understand the behavior of this union. I know how to access the bits in each struct and both the word and the array, but how are they related? I know that if there was only 1 struct and the word, setting the word to some value would modify accordingly the bit fields (and viceversa), but I don't know what happens in this case.</p>\n\n<p>Thank you and have a nice day!</p>\n"}, {"tags": ["macos", "c", "segmentation-fault"], "answers": [{"comments": [{"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 1, "creation_date": 1553713138, "post_id": 55384505, "comment_id": 97491197, "body": "To further your explanation, there is no link time warnnig because <code>collection</code> is defined both in the executable and in a dynamically linked library... definitely 2 separate objects"}, {"owner": {"reputation": 22751, "user_id": 2399879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UxMS5.jpg?s=128&g=1", "display_name": "Crowman", "link": "https://stackoverflow.com/users/2399879/crowman"}, "reply_to_user": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1553713404, "post_id": 55384505, "comment_id": 97491329, "body": "@chqrlie: Good addition, added to answer."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553713615, "post_id": 55384505, "comment_id": 97491447, "body": "I did a try on MacOS X, I had the same segmentation fault. Having only the declaration of <i>collection</i> in the header file and declaring it in <i>exemple.c</i>  the execution is ok. Up vote of course ^^"}], "tags": [], "owner": {"reputation": 22751, "user_id": 2399879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UxMS5.jpg?s=128&g=1", "display_name": "Crowman", "link": "https://stackoverflow.com/users/2399879/crowman"}, "is_accepted": true, "score": 5, "last_activity_date": 1553713986, "last_edit_date": 1553713986, "creation_date": 1553712510, "answer_id": 55384505, "question_id": 55384295, "link": "https://stackoverflow.com/questions/55384295/weird-c-library-linkage-issues-on-mac-segmentation-fault/55384505#55384505", "title": "Weird C library linkage issues on Mac - Segmentation Fault", "body": "<p>Your problem is this, in <code>example.h</code>:</p>\n\n<pre><code>MYARRAY *collection;\n</code></pre>\n\n<p>Since both <code>main.c</code> and <code>example.c</code> include this file, you end up defining <code>collection</code> twice, which results in undefined behavior. You need to make sure you define each object only once. The details are relatively unimportant since anything can happen with undefined behavior, but what's probably happening is that <code>main.c</code> is allocating memory for one object, but the one <code>example.c</code> is using is still <code>NULL</code>. As mentioned in the comments, since you define <code>collection</code> in <code>main.c</code> your linker is able to build the executable without needing to look for that symbol in the dynamic library, so you don't get a link time warning about it being defined there too, and obviously there'd be no cause for a warning at the time you compile the library.</p>\n\n<p>It works for you when you put everything in one file because obviously then you're not defining anything twice, anymore. The error itself is nothing to do with the fact you're using a dynamic library, although that may have made it harder to detect.</p>\n\n<p>It would be better to define this in <code>example.c</code> and provide a constructor function, there's no need for <code>main()</code> to be able to access it directly. But if you must do this, then define it in <code>example.c</code> and just declare an <code>extern</code> identifier in the header file to tell <code>main.c</code> that the object is defined somewhere else.</p>\n"}], "migrated_from": {"other_site": {"markdown_extensions": ["Prettify"], "launch_date": 1250553600, "open_beta_date": 1247529600, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon@2.png", "twitter_account": "super_user", "favicon_url": "https://cdn.sstatic.net/Sites/superuser/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon.png", "audience": "computer enthusiasts and power users", "site_url": "https://superuser.com", "api_site_parameter": "superuser", "logo_url": "https://cdn.sstatic.net/Sites/superuser/Img/logo.png", "name": "Super User", "site_type": "main_site"}, "on_date": 1553711597, "question_id": 1418326}, "owner": {"reputation": 66677, "user_id": 169992, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/OeNfG.png?s=128&g=1", "display_name": "Lance Pollard", "link": "https://stackoverflow.com/users/169992/lance-pollard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 55384505, "answer_count": 1, "score": 3, "last_activity_date": 1553713986, "creation_date": 1553711358, "question_id": 55384295, "link": "https://stackoverflow.com/questions/55384295/weird-c-library-linkage-issues-on-mac-segmentation-fault", "title": "Weird C library linkage issues on Mac - Segmentation Fault", "body": "<p>I have a strange segmentation fault that doesn't exist when everything is in 1 .c file, but does exist when I put part of the code in a <em>dynamically linked library</em> and link it to a test file. The complete code for the working 1 .c file code is at the bottom, the complete code for the error system with 2 .c and 1 .h file come first.</p>\n\n<p>Here is the error system:</p>\n\n<p><strong>example.h</strong>:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\ntypedef struct MYARRAY {\n  int len;\n  void* items[];\n} MYARRAY;\n\nMYARRAY *collection;\n\nvoid\nmypush(void* p);\n</code></pre>\n\n<p><strong>example.c</strong>:</p>\n\n<pre><code>#include \"example.h\"\n\nvoid\nmypush(void* p) {\n  printf(\"Here %lu\\n\", sizeof collection);\n  puts(\"FOO\");\n  int len = collection-&gt;len++;\n  puts(\"BAR\");\n  collection-&gt;items[len] = p;\n}\n</code></pre>\n\n<p><strong>example2.c</strong>:</p>\n\n<p>This is essentially a test file:</p>\n\n<pre><code>#include \"example.h\"\n\nvoid\ntest_print() {\n  puts(\"Here1\");\n  mypush(\"foo\");\n  puts(\"Here2\");\n}\n\nint\nmain() {\n  collection = malloc(sizeof *collection + (sizeof collection-&gt;items[0] * 1000));\n  collection-&gt;len = 0;\n  puts(\"Start\");\n  test_print();\n  puts(\"Done\");\n  return 0;\n}\n</code></pre>\n\n<p><strong>Makefile</strong>:</p>\n\n<p>I link <code>example</code> to <code>example2</code> here, and run:</p>\n\n<pre><code>example:\n  @clang -I . -dynamiclib \\\n    -undefined dynamic_lookup \\\n    -o example.dylib example.c\n  @clang example2.c example.dylib -o example2.o\n  @./example2.o\n.PHONY: example\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>$ make example\nStart\nHere1\nHere 8\nFOO\nmake: *** [example] Segmentation fault: 11\n</code></pre>\n\n<p>But it should show the full output of:</p>\n\n<pre><code>$ make example\nStart\nHere1\nHere 8\nFOO\nBAR\nHere2\nDone\n</code></pre>\n\n<p>The weird thing is everything works if it is this system:</p>\n\n<p><strong>example.c</strong>:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\ntypedef struct MYARRAY {\n  int len;\n  void* items[];\n} MYARRAY;\n\nMYARRAY *collection;\n\nvoid\nmypush(void* p) {\n  printf(\"Here %lu\\n\", sizeof collection);\n  puts(\"FOO\");\n  int len = collection-&gt;len++;\n  puts(\"BAR\");\n  collection-&gt;items[len] = p;\n}\n\nvoid\ntest_print() {\n  puts(\"Here1\");\n  mypush(\"foo\");\n\n  puts(\"Here\");\n}\n\nint\nmain() {\n  collection = malloc(sizeof *collection + (sizeof collection-&gt;items[0] * 1000));\n  collection-&gt;len = 0;\n  puts(\"ASF\");\n\n  test_print();\n\n  return 0;\n}\n</code></pre>\n\n<p><strong>Makefile</strong>:</p>\n\n<pre><code>example:\n  @clang -o example example.c\n  @./example\n.PHONY: example\n</code></pre>\n\n<p>Wondering why it's creating a segmentation fault when it is linked like this, and what I am doing wrong.</p>\n\n<p>I have checked <code>otool</code> and with <code>DYLD_PRINT_LIBRARIES=YES</code> and it shows it is importing the dynamically linked libraries, but for some reason it's segmentation faulting when linked but works fine when it isn't linked.</p>\n"}, {"tags": ["c", "double", "fwrite"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1553709957, "post_id": 55383849, "comment_id": 97489573, "body": "Open the file in binary mode."}, {"owner": {"reputation": 32686, "user_id": 10396, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ddbfebb47432f6599da361df6a135c7c?s=128&d=identicon&r=PG", "display_name": "AShelly", "link": "https://stackoverflow.com/users/10396/ashelly"}, "edited": false, "score": 0, "creation_date": 1553710169, "post_id": 55383849, "comment_id": 97489688, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/229924/difference-between-files-written-in-binary-and-text-mode\">Difference between files written in binary and text mode</a>"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1553710611, "post_id": 55383849, "comment_id": 97489941, "body": "@Harry the <a href=\"https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/fopen-wfopen?view=vs-2017\" rel=\"nofollow noreferrer\">man page</a> is preferable to googling."}, {"owner": {"reputation": 760, "user_id": 4220282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c09e8200d67a54a5f41136c42b6238f?s=128&d=identicon&r=PG&f=1", "display_name": "Harry", "link": "https://stackoverflow.com/users/4220282/harry"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1553710907, "post_id": 55383849, "comment_id": 97490112, "body": "@WeatherVane To be honest, even on that man page, the access mode modifiers are pretty well hidden! But you&#39;re right, at least they&#39;re there."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1553711123, "post_id": 55383849, "comment_id": 97490220, "body": "@Harry there are four paragraphs about the mode, including &quot;If <b>t</b> or <b>b</b> is not given in <i>mode</i>, the default translation mode is defined by the global variable <code>_fmode</code>.&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 760, "user_id": 4220282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c09e8200d67a54a5f41136c42b6238f?s=128&d=identicon&r=PG&f=1", "display_name": "Harry", "link": "https://stackoverflow.com/users/4220282/harry"}, "edited": false, "score": 0, "creation_date": 1553710324, "post_id": 55383862, "comment_id": 97489775, "body": "Thank you. The first result in google only listed &quot;r&quot;, &quot;w&quot;, &quot;a&quot;, &quot;r+&quot;, &quot;w+&quot; and &quot;a+&quot;. Ahhh, that explains why it was only happening for some specific values! I&#39;m surprised that &quot;text mode&quot; is the default."}], "tags": [], "owner": {"reputation": 32686, "user_id": 10396, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ddbfebb47432f6599da361df6a135c7c?s=128&d=identicon&r=PG", "display_name": "AShelly", "link": "https://stackoverflow.com/users/10396/ashelly"}, "is_accepted": true, "score": 4, "last_activity_date": 1553710383, "last_edit_date": 1553710383, "creation_date": 1553709957, "answer_id": 55383862, "question_id": 55383849, "link": "https://stackoverflow.com/questions/55383849/why-does-fwrite-write-9-bytes-for-some-doubles/55383862#55383862", "title": "Why does fwrite write 9 bytes for some doubles?", "body": "<p>You opened the file in text mode, and are writing binary data to it.  Windows changes <kbd>LF</kbd> <code>0x0a</code> to <kbd>CR</kbd><kbd>LF</kbd> <code>0x0d 0x0a</code>.  You need to use \"wb\" as the 2nd argument when opening the file.</p>\n"}], "owner": {"reputation": 760, "user_id": 4220282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c09e8200d67a54a5f41136c42b6238f?s=128&d=identicon&r=PG&f=1", "display_name": "Harry", "link": "https://stackoverflow.com/users/4220282/harry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 0, "accepted_answer_id": 55383862, "answer_count": 1, "score": 1, "last_activity_date": 1553710383, "creation_date": 1553709903, "last_edit_date": 1553709972, "question_id": 55383849, "link": "https://stackoverflow.com/questions/55383849/why-does-fwrite-write-9-bytes-for-some-doubles", "title": "Why does fwrite write 9 bytes for some doubles?", "body": "<p>I need to write some C code that writes doubles out to file.</p>\n\n<p>For some values, fwrite writes the correct 8-byte binary to file. For other values, it seems to prepend an extra 9th byte. For example, this code writes 9 bytes comprising x0d, followed by the correct 8 bytes:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n#include &lt;float.h&gt;\n\n#define PI 3.14159265358979323846\n\nint main()\n{\n    // Generate a number\n    double x = -3.0 * cos(PI * 5.0 / 8.0);\n    printf(\"%.*e\\n\", DECIMAL_DIG, x);\n\n    // Uncomment this to get an 8-byte file instead of 9\n    // x = (float) x;\n\n    // Write number to file\n    FILE* fw = fopen(\"out.bin\", \"w\");\n    if (fw != NULL)\n    {\n        size_t Nw = fwrite(&amp;x, sizeof(double), 1, fw);\n        printf(\"Wrote %i values to file.\\n\", Nw);\n\n        if (fclose(fw) != 0)\n            return (EXIT_FAILURE);\n    }\n    else\n        return (EXIT_FAILURE);\n\n    return (EXIT_SUCCESS);\n}\n</code></pre>\n\n<p>However, if I change the value, for example to <code>double x = -3.0 * cos(PI * 3.0 / 8.0);</code>, or even if I just cast the number to float and back again (see \"Uncomment this...\" in the above code), then the correct 8 bytes are written.</p>\n\n<p>I am compiling with MinGW GCC-6.3.0-1. What am I doing wrong?</p>\n"}, {"tags": ["c", "excel"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 2, "creation_date": 1553709445, "post_id": 55383679, "comment_id": 97489302, "body": "<code>7&#47;4</code> is an integer calculation where the result will be <code>1</code> rather than <code>1.75</code>.  You have some other calculations of this nature.  You probably want to operate on <code>double</code>s, so you would instead do something like <code>7.0&#47;4.0</code>"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1553709479, "post_id": 55383679, "comment_id": 97489330, "body": "And <code>h &#47; 24</code> will be 0; use <code>h &#47; 24.0</code>, for example."}], "answers": [{"tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 1, "last_activity_date": 1553711193, "last_edit_date": 1553711193, "creation_date": 1553710728, "answer_id": 55384070, "question_id": 55383679, "link": "https://stackoverflow.com/questions/55383679/cant-get-same-answer-in-c-and-excel-with-same-function/55384070#55384070", "title": "Can&#39;t get same answer in c and excel with same function", "body": "<p>to replace all constant <em>int</em> by <em>double</em> is enough :</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n\nint main()\n{\n  int Y=2018,M=3,D=9,h=9; /* can be double of course */\n  int ans = ceil(1721013.5+367.0*Y-floor((7.0/4.0)*(Y+floor((M+9.0)/12.0)))+\n    D+h/24.0+floor(275.0*M/9.0));\n\n  printf(\"%d\\n\", ans);\n}\n</code></pre>\n\n<p>I needed to use <em>ceil</em> to print 2458187 else I get 2458186</p>\n\n<p>Compilation and execution :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ gcc -pedantic -Wall -Wextra f.c -lm\npi@raspberrypi:/tmp $ ./a.out\n2458187\n</code></pre>\n\n<hr>\n\n<p>Additional remark, out of the initial problem, because the expression can be reduced by a constant (nothing is variable) the computation can be done at compile time rather than at execution time :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ gcc -O3 f.c\npi@raspberrypi:/tmp $ cat f.s \n    .arch armv6\n    ...\nmain:\n    @ args = 0, pretend = 0, frame = 0\n    @ frame_needed = 0, uses_anonymous_args = 0\n    push    {r4, lr}\n    ldr r1, .L3\n    ldr r0, .L3+4\n    bl  printf\n    mov r0, #0\n    pop {r4, pc}\n.L4:\n    .align  2\n.L3:\n    .word   2458187\n    ...\n</code></pre>\n\n<p>here the value was computed at compile time : <code>.word    2458187</code></p>\n"}], "owner": {"reputation": 3, "user_id": 9834817, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-r1Hstv6rT7c/AAAAAAAAAAI/AAAAAAAAAG4/sZXtL9fvLk8/photo.jpg?sz=128", "display_name": "HelenHuang", "link": "https://stackoverflow.com/users/9834817/helenhuang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 55384070, "answer_count": 1, "score": -2, "last_activity_date": 1553711193, "creation_date": 1553709238, "last_edit_date": 1553709289, "question_id": 55383679, "link": "https://stackoverflow.com/questions/55383679/cant-get-same-answer-in-c-and-excel-with-same-function", "title": "Can&#39;t get same answer in c and excel with same function", "body": "<p>I use c to calculate the following function,but can't get correct answer(in excel using function \"INT\" it is correct answer,when in c,I use\"floor\" to replace.).</p>\n\n<p>function:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Qww60.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Qww60.png\" alt=\"enter image description here\"></a></p>\n\n<p>my code in c:</p>\n\n<pre><code>int ans;\nans = 1721013.5+367*Y-floor((7/4)*(Y+floor((M+9)/12)))+\n        D+h/24+floor(275*M/9);\n</code></pre>\n\n<p>and I get wrong answer 2459700 when Y=2018,M=3,D=9,h=9 </p>\n\n<p>Correct answer:2458187</p>\n"}, {"tags": ["c", "linux", "fork"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 4, "creation_date": 1553708571, "post_id": 55383409, "comment_id": 97488838, "body": "End your printing statements with a newline; it maximizes the chance that the printed information will appear.  Consider using <code>fflush(stdout)</code> liberally.  But newlines are key: <code>printf(&quot;Test 5\\n&quot;):</code> etc.  (When debugging such code, consider printing the PID of each process in each output: <code>printf(&quot;%d: Test 5\\n&quot;, (int)getpid());</code>.) . Also think about whether <code>break;</code> is appropriate or whether <code>exit(EXIT_SUCCESS);</code> would be better."}, {"owner": {"reputation": 191202, "user_id": 147356, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b9506717d24256a090524dd5505d3207?s=128&d=identicon&r=PG", "display_name": "larsks", "link": "https://stackoverflow.com/users/147356/larsks"}, "edited": false, "score": 0, "creation_date": 1553708734, "post_id": 55383409, "comment_id": 97488928, "body": "I am unable to reproduce your problem.  Your code runs for me and prints <code>Test 5</code> the correct number of times."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1553710270, "post_id": 55383409, "comment_id": 97489744, "body": "We need enough code to replicate the problem. Your code only shows the child buffering some output. If later code doesn&#39;t actually flush it, then of course it won&#39;t show up."}], "answers": [{"tags": [], "owner": {"reputation": 7262, "user_id": 4955498, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DQswbNCOBTs/AAAAAAAAAAI/AAAAAAAAADE/avTd-sX467I/photo.jpg?sz=128", "display_name": "Michael Veksler", "link": "https://stackoverflow.com/users/4955498/michael-veksler"}, "is_accepted": true, "score": 1, "last_activity_date": 1553716884, "last_edit_date": 1553716884, "creation_date": 1553715843, "answer_id": 55385320, "question_id": 55383409, "link": "https://stackoverflow.com/questions/55383409/why-does-my-fork-doesnt-fork-a-child-and-output-the-print-statements/55385320#55385320", "title": "Why does my fork() doesn&#39;t fork a child and output the print statements?", "body": "<p>The child process continues to execute the code of the caller. The caller is most likely not expecting to execute the parent and all the children. You should exit the child before that happens:</p>\n\n<pre><code>for (i = 0; i &lt; proc; ++i){\n    printf(\"In for %d\",i);\n    fflush(stdout); // &lt;--- here\n    // TODO\n    int fork_result = fork();\n    if (fork_result == 0){ // Create child process\n        child_pids[i] = getpid();\n        printf(\"Test 5\");\n        printf(\"In if %d\",i);\n        exit(0);  // &lt;---- must have this\n        break;\n    }\n    else if(fork_result &lt; 0){\n      printf(\"Fork failed\");\n    }\n    else if (fork_result &gt; 0){\n      printf(\"Parent\");\n    }\n}\n// without the exit above the child will execute this code:\nSome code\n</code></pre>\n\n<p>You must flush stdout, otherwise the children and the parent share the same prefix text in buffer, and both wil print  the same prefix, when it finally flushes it. Eventually this sharing will confuse anybody trying to analyze the output.</p>\n\n<p>Note: once there is an <code>exit</code> call, stdout will be flushed correctly.</p>\n\n<p>Also, note that the different printouts might be interleaved. Putting them on different lines, with a distinguishing prefix (like <code>i</code> and/or pid) can help debugging.</p>\n\n<p>Look at <a href=\"https://wandbox.org/permlink/SHvVpz5OEuXVOdhl\" rel=\"nofollow noreferrer\">this run example</a></p>\n"}], "owner": {"reputation": 111, "user_id": 6868817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44c5b8c99d2b570c89887d751004ee11?s=128&d=identicon&r=PG&f=1", "display_name": "Programmer", "link": "https://stackoverflow.com/users/6868817/programmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 55385320, "answer_count": 1, "score": 0, "last_activity_date": 1553716884, "creation_date": 1553708248, "last_edit_date": 1553708841, "question_id": 55383409, "link": "https://stackoverflow.com/questions/55383409/why-does-my-fork-doesnt-fork-a-child-and-output-the-print-statements", "title": "Why does my fork() doesn&#39;t fork a child and output the print statements?", "body": "<p>I am writing a c program in Ubuntu, and in the code I am using fork() to generate 5 different children. But, when i compile and run my program, no children are created, and the printf(\"Test\") that I put inside the three if statements (for case fork() == 0, > 0, &lt; 0), only in > 0, there in the output of the printf statements. </p>\n\n<p>Actually a while ago, the fork() runs just fine, but after I continue my work on the program, it suddenly does not work.</p>\n\n<p>Why is this happening and how should I fix it?</p>\n\n<pre><code>for (i = 0; i &lt; proc; ++i){\n    printf(\"In for %d\",i);\n    // TODO\n    int fork_result = fork();\n    if (fork_result == 0){ // Create child process\n        child_pids[i] = getpid();\n        printf(\"Test 5\");\n        printf(\"In if %d\",i);\n        break;\n    }\n    else if(fork_result &lt; 0){\n      printf(\"Fork failed\");\n    }\n    else if (fork_result &gt; 0){\n      printf(\"Parent\");\n    }\n}\n</code></pre>\n\n<p>Well, the expected outcome is that it would contain \"Test 5\" or \"In if\"</p>\n\n<p>Actual output:</p>\n\n<pre><code>In for 0In for 1In for 2In for 3In for 4\n</code></pre>\n\n<p>Which the actual output does not contain any \"Test 5\"</p>\n"}, {"tags": ["c", "overflow", "dma", "stm32f4discovery", "adc"], "comments": [{"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1553707885, "post_id": 55383177, "comment_id": 97488430, "body": "I don&#39;t understand what is the code that &quot;works&quot; and what is the code that &quot;doesn&#39;t work&quot;. And I don&#39;t understand what exactly is the difference in output between the working code and the non-working code."}, {"owner": {"reputation": 33, "user_id": 5222532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67ac9b83b933eaf1c7f411c180031324?s=128&d=identicon&r=PG&f=1", "display_name": "xardas_the_mage", "link": "https://stackoverflow.com/users/5222532/xardas-the-mage"}, "reply_to_user": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1553708251, "post_id": 55383177, "comment_id": 97488652, "body": "This is the example code that works:  while(1) { ADC3ConvertedVoltage = ADC3ConvertedValue *3300/0xFFF; }  In the working code, the values are like they should be. 12 bit, and they represent the ADC input. Adding those few lines is messing the values up :)"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1553708323, "post_id": 55383177, "comment_id": 97488691, "body": "Aren&#39;t you expected to mask off 4 bits to obtain the 12-bit value? What difference does DMA make?"}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 1, "creation_date": 1553708516, "post_id": 55383177, "comment_id": 97488810, "body": "<i>This is the example code that works: while(1) { ADC3ConvertedVoltage = ADC3ConvertedValue *3300/0xFFF; }</i> --&gt; Are you sure that&#39;s a division <code>&#47;</code> and not a bitwise or <code>|</code>"}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1553708662, "post_id": 55383177, "comment_id": 97488893, "body": "One piece of code writes to <code>ADC3ConvertedVoltage</code> and the other doesn&#39;t touch it. I&#39;m really confused what you are doing."}, {"owner": {"reputation": 33, "user_id": 5222532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67ac9b83b933eaf1c7f411c180031324?s=128&d=identicon&r=PG&f=1", "display_name": "xardas_the_mage", "link": "https://stackoverflow.com/users/5222532/xardas-the-mage"}, "edited": false, "score": 0, "creation_date": 1553708991, "post_id": 55383177, "comment_id": 97489062, "body": "<a href=\"https://pastebin.com/WJhPSMAv\" rel=\"nofollow noreferrer\">link</a> No it&#39;s a division.. and this code works like a charm. So there is no obvious mistake in my additional code?"}, {"owner": {"reputation": 33, "user_id": 5222532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67ac9b83b933eaf1c7f411c180031324?s=128&d=identicon&r=PG&f=1", "display_name": "xardas_the_mage", "link": "https://stackoverflow.com/users/5222532/xardas-the-mage"}, "reply_to_user": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1553709083, "post_id": 55383177, "comment_id": 97489116, "body": "@MFisherKDX Ok sry for the confusion, the commented line remains from the example code."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1553709553, "post_id": 55383177, "comment_id": 97489364, "body": "Is there a reason why you have <code>__IO uint16_t ADC3ConvertedVoltage</code> but in the linked example is is <b><code>uint32_t</code></b>?"}, {"owner": {"reputation": 33, "user_id": 5222532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67ac9b83b933eaf1c7f411c180031324?s=128&d=identicon&r=PG&f=1", "display_name": "xardas_the_mage", "link": "https://stackoverflow.com/users/5222532/xardas-the-mage"}, "edited": false, "score": 0, "creation_date": 1553709831, "post_id": 55383177, "comment_id": 97489515, "body": "I tried everything I could and thought, maybe the example code has a small mistake in it. But as you can see, I am not using ADC3ConvertedVoltage, instead I saved it to a float variable. (voltage signal) The problem lies in the address the DMA accesses -&gt; ADC3ConvertedValue. Looking at the live watch now, it says 65002"}, {"owner": {"reputation": 33, "user_id": 5222532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67ac9b83b933eaf1c7f411c180031324?s=128&d=identicon&r=PG&f=1", "display_name": "xardas_the_mage", "link": "https://stackoverflow.com/users/5222532/xardas-the-mage"}, "edited": false, "score": 0, "creation_date": 1553711032, "post_id": 55383177, "comment_id": 97490192, "body": "Okay, I just figured out how this problem occurs: If I remove my own volatile (__IO) variable, it works. It looks like somehow when my third volatile variable is in the code, it stops working."}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1553714228, "post_id": 55383177, "comment_id": 97491706, "body": "I am sorry.  I don&#39;t see any <code>volatile</code> variables defined.  I can&#39;t make heads or tails out of this question.  Maybe someone else can understand."}, {"owner": {"reputation": 33, "user_id": 5222532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67ac9b83b933eaf1c7f411c180031324?s=128&d=identicon&r=PG&f=1", "display_name": "xardas_the_mage", "link": "https://stackoverflow.com/users/5222532/xardas-the-mage"}, "edited": false, "score": 0, "creation_date": 1553714382, "post_id": 55383177, "comment_id": 97491777, "body": "__IO is a typedef of volatile No problem, thank you for trying! :)"}], "owner": {"reputation": 33, "user_id": 5222532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67ac9b83b933eaf1c7f411c180031324?s=128&d=identicon&r=PG&f=1", "display_name": "xardas_the_mage", "link": "https://stackoverflow.com/users/5222532/xardas-the-mage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1553709503, "creation_date": 1553707431, "last_edit_date": 1553709503, "question_id": 55383177, "link": "https://stackoverflow.com/questions/55383177/how-come-the-dma-delivers-a-16bit-value-when-the-adc-is-12bit", "title": "How come the DMA delivers a 16bit value when the ADC is 12bit?", "body": "<p>Using the StdPeriph Library for my STM32F4 Discovery board, I encountered a strange problem with the Debugger/Code. ( using the IAR Workbench )</p>\n\n<p>The variable ADC3ConvertedValue shows 16bit values, whereas the ADC is only 12bit. In fact, they do correlate with the input voltage of the ADC, but I expected a value 2^12 - 1 max.</p>\n\n<p>The problem has to be somewhere in my short code. I am using DMA in circular Mode from the Library-Example (I just changed the main() function) </p>\n\n<p>Trying only a while loop from the example Code works fine, but as soon as I add my few lines, the value is corrupt.</p>\n\n<pre><code>__IO uint16_t ADC3ConvertedValue = 0;\n__IO uint16_t ADC3ConvertedVoltage = 0;\nuint32_t sum = 0;\nuint16_t count = 0;\nuint16_t average = 0;\nfloat voltageSignal = 0;\n\nvoid ADC3_CH12_DMA_Config(void);\n\n\nint main(void)\n{ \n  ADC3_CH12_DMA_Config();\n\n  ADC_SoftwareStartConv(ADC3);\n\n  // ADC3ConvertedVoltage = ADC3ConvertedValue *3300/0xFFF;\n\n  for(count = 0; count &lt; 5000; count++)\n  {\n    sum += ADC3ConvertedValue;\n  }\n\n  average = sum / count;\n\n  while(1)\n  {\n    voltageSignal = ((ADC3ConvertedValue - average) * VOLT_PER_BIT);\n  }\n}\n</code></pre>\n\n<p>For clarification, this is the example Code that works ( I just changed the main function) :</p>\n\n<pre><code>/* Includes ------------------------------------------------------------------*/\n#include \"stm32f4_discovery.h\"\n#include &lt;stdio.h&gt;\n\n/** @addtogroup STM32F4_Discovery_Peripheral_Examples\n  * @{\n  */\n\n/** @addtogroup ADC_ADC3_DMA\n  * @{\n  */ \n\n/* Private typedef -----------------------------------------------------------*/\n/* Private define ------------------------------------------------------------*/\n#define ADC3_DR_ADDRESS     ((uint32_t)0x4001224C)\n\n/* Private macro -------------------------------------------------------------*/\n/* Private variables ---------------------------------------------------------*/\n/* You can monitor the converted value by adding the variable \"ADC3ConvertedValue\" \n   to the debugger watch window */\n__IO uint16_t ADC3ConvertedValue = 0;\n__IO uint32_t ADC3ConvertedVoltage = 0;\n\n/* Private function prototypes -----------------------------------------------*/\n/* Private functions ---------------------------------------------------------*/\nvoid ADC3_CH12_DMA_Config(void);\n\n/**\n  * @brief  Main program\n  * @param  None\n  * @retval None\n  */\nint main(void)\n{\n  /*!&lt; At this stage the microcontroller clock setting is already configured, \n       this is done through SystemInit() function which is called from startup\n       file (startup_stm32f4xx.s) before to branch to application main.\n       To reconfigure the default setting of SystemInit() function, refer to\n       system_stm32f4xx.c file\n     */\n  /* ADC3 configuration *******************************************************/\n  /*  - Enable peripheral clocks                                              */\n  /*  - DMA2_Stream0 channel2 configuration                                   */\n  /*  - Configure ADC Channel12 pin as analog input                           */\n  /*  - Configure ADC3 Channel12                                              */\n  ADC3_CH12_DMA_Config();\n\n  /* Start ADC3 Software Conversion */ \n  ADC_SoftwareStartConv(ADC3);\n\n  while (1)\n  {\n  /* convert the ADC value (from 0 to 0xFFF) to a voltage value (from 0V to 3.3V)*/\n    ADC3ConvertedVoltage = ADC3ConvertedValue *3300/0xFFF;\n  }\n}\n\n\n/**\n  * @brief  ADC3 channel12 with DMA configuration\n  * @param  None\n  * @retval None\n  */\nvoid ADC3_CH12_DMA_Config(void)\n{\n  ADC_InitTypeDef       ADC_InitStructure;\n  ADC_CommonInitTypeDef ADC_CommonInitStructure;\n  DMA_InitTypeDef       DMA_InitStructure;\n  GPIO_InitTypeDef      GPIO_InitStructure;\n\n  /* Enable ADC3, DMA2 and GPIO clocks ****************************************/\n  RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_DMA2 | RCC_AHB1Periph_GPIOC, ENABLE);\n  RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC3, ENABLE);\n\n  /* DMA2 Stream0 channel0 configuration **************************************/\n  DMA_InitStructure.DMA_Channel = DMA_Channel_2;  \n  DMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)ADC3_DR_ADDRESS;\n  DMA_InitStructure.DMA_Memory0BaseAddr = (uint32_t)&amp;ADC3ConvertedValue;\n  DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralToMemory;\n  DMA_InitStructure.DMA_BufferSize = 1;\n  DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;\n  DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Disable;\n  DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_HalfWord;\n  DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_HalfWord;\n  DMA_InitStructure.DMA_Mode = DMA_Mode_Circular;\n  DMA_InitStructure.DMA_Priority = DMA_Priority_High;\n  DMA_InitStructure.DMA_FIFOMode = DMA_FIFOMode_Disable;         \n  DMA_InitStructure.DMA_FIFOThreshold = DMA_FIFOThreshold_HalfFull;\n  DMA_InitStructure.DMA_MemoryBurst = DMA_MemoryBurst_Single;\n  DMA_InitStructure.DMA_PeripheralBurst = DMA_PeripheralBurst_Single;\n  DMA_Init(DMA2_Stream0, &amp;DMA_InitStructure);\n  DMA_Cmd(DMA2_Stream0, ENABLE);\n\n  /* Configure ADC3 Channel12 pin as analog input ******************************/\n  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;\n  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AN;\n  GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL ;\n  GPIO_Init(GPIOC, &amp;GPIO_InitStructure);\n\n  /* ADC Common Init **********************************************************/\n  ADC_CommonInitStructure.ADC_Mode = ADC_Mode_Independent;\n  ADC_CommonInitStructure.ADC_Prescaler = ADC_Prescaler_Div2;\n  ADC_CommonInitStructure.ADC_DMAAccessMode = ADC_DMAAccessMode_Disabled;\n  ADC_CommonInitStructure.ADC_TwoSamplingDelay = ADC_TwoSamplingDelay_5Cycles;\n  ADC_CommonInit(&amp;ADC_CommonInitStructure);\n\n  /* ADC3 Init ****************************************************************/\n  ADC_InitStructure.ADC_Resolution = ADC_Resolution_12b;\n  ADC_InitStructure.ADC_ScanConvMode = DISABLE;\n  ADC_InitStructure.ADC_ContinuousConvMode = ENABLE;\n  ADC_InitStructure.ADC_ExternalTrigConvEdge = ADC_ExternalTrigConvEdge_None;\n  ADC_InitStructure.ADC_DataAlign = ADC_DataAlign_Right;\n  ADC_InitStructure.ADC_NbrOfConversion = 1;\n  ADC_Init(ADC3, &amp;ADC_InitStructure);\n\n  /* ADC3 regular channel12 configuration *************************************/\n  ADC_RegularChannelConfig(ADC3, ADC_Channel_12, 1, ADC_SampleTime_3Cycles);\n\n /* Enable DMA request after last transfer (Single-ADC mode) */\n  ADC_DMARequestAfterLastTransferCmd(ADC3, ENABLE);\n\n  /* Enable ADC3 DMA */\n  ADC_DMACmd(ADC3, ENABLE);\n\n  /* Enable ADC3 */\n  ADC_Cmd(ADC3, ENABLE);\n}\n\n#ifdef  USE_FULL_ASSERT\n\n/**\n  * @brief  Reports the name of the source file and the source line number\n  *         where the assert_param error has occurred.\n  * @param  file: pointer to the source file name\n  * @param  line: assert_param error line source number\n  * @retval None\n  */\nvoid assert_failed(uint8_t* file, uint32_t line)\n{ \n  /* User can add his own implementation to report the file name and line number,\n     ex: printf(\"Wrong parameters value: file %s on line %d\\r\\n\", file, line) */\n\n  /* Infinite loop */\n  while (1)\n  {\n  }\n}\n#endif\n\n/**\n  * @}\n  */ \n\n/**\n  * @}\n  */ \n\n/******************* (C) COPYRIGHT 2011 STMicroelectronics *****END OF FILE****/\n</code></pre>\n"}, {"tags": ["c", "algorithm", "graph"], "comments": [{"owner": {"reputation": 2387, "user_id": 4059145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P9q8e.png?s=128&g=1", "display_name": "Photon", "link": "https://stackoverflow.com/users/4059145/photon"}, "edited": false, "score": 2, "creation_date": 1553706743, "post_id": 55382869, "comment_id": 97487862, "body": "Text explanation: <a href=\"https://www.geeksforgeeks.org/articulation-points-or-cut-vertices-in-a-graph/\" rel=\"nofollow noreferrer\">geeksforgeeks.org/&hellip;</a> Visualization: <a href=\"https://visualgo.net/en/dfsbfs\" rel=\"nofollow noreferrer\">visualgo.net/en/dfsbfs</a>"}, {"owner": {"reputation": 45, "user_id": 11256427, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nmXay-bdhPk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcjeUIPzAO9kcdr6iwoOfhSVx4W8Q/mo/photo.jpg?sz=128", "display_name": "vinodkumar wagh", "link": "https://stackoverflow.com/users/11256427/vinodkumar-wagh"}, "reply_to_user": {"reputation": 2387, "user_id": 4059145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P9q8e.png?s=128&g=1", "display_name": "Photon", "link": "https://stackoverflow.com/users/4059145/photon"}, "edited": false, "score": 0, "creation_date": 1553707276, "post_id": 55382869, "comment_id": 97488121, "body": "@Photon That Visualization website is amazing, thank you for that, it&#39;s most appreciated."}], "owner": {"reputation": 45, "user_id": 11256427, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nmXay-bdhPk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcjeUIPzAO9kcdr6iwoOfhSVx4W8Q/mo/photo.jpg?sz=128", "display_name": "vinodkumar wagh", "link": "https://stackoverflow.com/users/11256427/vinodkumar-wagh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1553706386, "creation_date": 1553706386, "question_id": 55382869, "link": "https://stackoverflow.com/questions/55382869/cut-vertex-or-articulation-point", "title": "Cut Vertex (or) Articulation Point", "body": "<p>can anybody please provide me a detailed pictorial explanation of what is happening inside this code?</p>\n\n<pre><code>int adjMatrix[256][256];\nint dfsnum[256], num = 0, low[256];\nvoid cutVertices(int u) {\n    low[u] = dfsnum[u] = num++;\n    for(int v = 0; v&lt;256; ++v) {\n        if(adjMatrix[u][v] &amp;&amp; dfsnum[v] == -1) {\n            if(low[v] &gt; dfsnum[u]) \n                printf(\"CutVertex:%d\",u);\n            low[u] = min(low[u], low[v]);\n       }\n       else {\n           low[u] = min(low[u], dfsnum[v]);\n   }\n   }\n</code></pre>\n\n<p>This is actually a Method of finding a cutvertices using DFS search resultant tree.</p>\n\n<p>the method says that the root vertex is a cut vertex if and only if it has at least two children. A non-root vertex u is a cut vertex if and only if there is a son v of u such that low(v) >= dfsnum(u).\nwhere low(v) = lowest numbered vertex that reachable from v by taking zero or more tree edges and tehn possibly one back edge(in that order).</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 2, "creation_date": 1553706532, "post_id": 55382865, "comment_id": 97487740, "body": "<i>&quot;I am pretty new to programming in C&quot;</i> - And whatever resource you are learning from covered <code>goto</code> before any loop statements? That&#39;s a red flag."}, {"owner": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 1, "creation_date": 1553706564, "post_id": 55382865, "comment_id": 97487758, "body": "How do you repeatedly ask for a valid bet? Maybe you could re-use ideas from that part of the code?"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "reply_to_user": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1553706574, "post_id": 55382865, "comment_id": 97487766, "body": "@StoryTeller To be fair, there is a <code>do-while loop</code> in the code."}, {"owner": {"reputation": 65820, "user_id": 1741542, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QdVqh.jpg?s=128&g=1", "display_name": "Olaf Dietsche", "link": "https://stackoverflow.com/users/1741542/olaf-dietsche"}, "edited": false, "score": 0, "creation_date": 1553706655, "post_id": 55382865, "comment_id": 97487815, "body": "Wrap everything in an endless loop, <code>for (;;) { ... }</code>"}, {"owner": {"reputation": 23, "user_id": 7309021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa3edcd27cfd0f392ae25f306bcd8628?s=128&d=identicon&r=PG&f=1", "display_name": "William H", "link": "https://stackoverflow.com/users/7309021/william-h"}, "reply_to_user": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1553706677, "post_id": 55382865, "comment_id": 97487822, "body": "@StoryTeller Well I am actully taking a class in C programming and the teacher just briefly covered gotos, but I already know how for,while, do-while etc. work I am just confused on how to use them here"}, {"owner": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 4, "creation_date": 1553706692, "post_id": 55382865, "comment_id": 97487835, "body": "What is more worrying, is that none of the variables used are declared any where in the code"}, {"owner": {"reputation": 23, "user_id": 7309021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa3edcd27cfd0f392ae25f306bcd8628?s=128&d=identicon&r=PG&f=1", "display_name": "William H", "link": "https://stackoverflow.com/users/7309021/william-h"}, "reply_to_user": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 0, "creation_date": 1553706812, "post_id": 55382865, "comment_id": 97487895, "body": "@ChrisTurner I didn&#39;t include that in this section of my code, they are declared in the full code"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 1, "creation_date": 1553707196, "post_id": 55382865, "comment_id": 97488084, "body": "@Kelas3 your case is very simple, only one case where you reloop and all other you return/exit, so few modifications to do, see my answer. I encourage you to not make a version with label/goto to remove them after but directly use a version without, just do like if <i>goto</i> does not exist  ;-)"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553792031, "post_id": 55382865, "comment_id": 97526562, "body": "The function: <code>getch()</code> is not portable.  Suggest using <code>getchar()</code> instead"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553792177, "post_id": 55382865, "comment_id": 97526647, "body": "When posting code, it is highly preferred to post code that cleanly compiles (unless the question is about the compiling)  The posted code does not compile!  it is missing the needed <code>#include</code> statements for the needed header files.  Please don&#39;t make us guess as to which header files your code actually includes"}], "answers": [{"comments": [{"owner": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "edited": false, "score": 1, "creation_date": 1553707367, "post_id": 55382964, "comment_id": 97488169, "body": "I personally prefer while(1) over for(;;), but it is a matter of taste."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "edited": false, "score": 1, "creation_date": 1553707407, "post_id": 55382964, "comment_id": 97488187, "body": "@machine_1 at that level this is very <i>taste and color</i> ^^"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553709299, "post_id": 55382964, "comment_id": 97489219, "body": "Most of the printing statements would benefit from a newline at the end (the exception is the &#39;play again&#39; prompt, which would benefit from a space at the end).  Why <code>return 0;</code> instead of <code>exit(0);</code> in the added lines \u2014 or why <code>exit(0)</code> instead of <code>return 0;</code> where it is used?"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553709456, "post_id": 55382964, "comment_id": 97489313, "body": "@JonathanLeffler I used <code>return 0;</code> to do exactly like the original code, that return being implicit"}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 3, "last_activity_date": 1553707374, "last_edit_date": 1553707374, "creation_date": 1553706710, "answer_id": 55382964, "question_id": 55382865, "link": "https://stackoverflow.com/questions/55382865/how-would-i-avoid-using-a-goto-statement-here/55382964#55382964", "title": "How would I avoid using a goto statement here?", "body": "<p>just put all in a <code>for(;;)</code> loop; the <em>goto</em> will be the case where you reloop, in the other cases add a <code>return 0;</code>(or <code>exit(0);</code> as you prefer and already use in some cases)</p>\n\n<pre><code>int main()\n{\n\n  for (;;) { /* ADDED  */\n    if (FirstRun == 0)\n    {\n        printf(\"Your starting balance is $%.2f\", Balance);\n    }\n    if (FirstRun &gt; 0)\n    {\n        printf(\"Your new balance is $%.2f\", Balance);\n    }\n    if (Balance &lt;= 0)\n    {\n        printf(\"Sorry you are out of money!\");\n        exit(0);\n    }\n\n    do\n    {\n        ValidBet = 0;\n        printf(\"\\nPlease enter your bet:\");\n        scanf(\"%lf\", &amp;Bet);\n\n        if ((Bet &gt; Balance) || (Bet &lt; 0))\n        {\n            printf(\"Your bet is invalid, try again.\");\n        }\n        else \n        {\n            ValidBet = 1;\n        }\n    } while (ValidBet == 0);\n\n    ThrowDicePair();\n    printf(\"DICE #1 WAS %d\", SumOfThrows);\n\n    if (SumOfThrows == 7 || SumOfThrows == 11)\n    {\n        Balance += Bet;\n        printf(\"You win! Would you like to play again? [y/n]\");\n        C = getch();\n        if (C == 'y')\n        {\n            FirstRun++;\n            /* goto START; removed */\n        }\n        else if (C == 'n')\n        {\n            printf(\"Thanks for playing\");\n            exit(0);\n        }\n        else /* ADDED */\n          return 0; /* ADDED */\n    }\n    else /* ADDED */\n      return 0; /* ADDED */\n  } /* ADDED  */\n}\n</code></pre>\n\n<p>In more complicated/nested cases you can use a <em>continue</em> to reloop, but here this is useless</p>\n"}, {"tags": [], "owner": {"reputation": 134, "user_id": 11209337, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LQgOlyFPQrA/AAAAAAAAAAI/AAAAAAAAAAk/5mSg0xIU2Ek/photo.jpg?sz=128", "display_name": "CodeoftheWarrior", "link": "https://stackoverflow.com/users/11209337/codeofthewarrior"}, "is_accepted": false, "score": 2, "last_activity_date": 1553706864, "creation_date": 1553706864, "answer_id": 55383005, "question_id": 55382865, "link": "https://stackoverflow.com/questions/55382865/how-would-i-avoid-using-a-goto-statement-here/55383005#55383005", "title": "How would I avoid using a goto statement here?", "body": "<p>Assuming you want to ensure the person plays the game at least one time before electing to quit, a do...while loop would work just fine. Just start the loop where you want to iterate back to, i.e. your START label and then take the input into C at the end of your loop conditioning on whether or not your input is equal to 'n' or 'N'. </p>\n"}, {"tags": [], "owner": {"reputation": 343, "user_id": 9401943, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oVPqk.png?s=128&g=1", "display_name": "birneee", "link": "https://stackoverflow.com/users/9401943/birneee"}, "is_accepted": false, "score": 0, "last_activity_date": 1553709000, "creation_date": 1553709000, "answer_id": 55383615, "question_id": 55382865, "link": "https://stackoverflow.com/questions/55382865/how-would-i-avoid-using-a-goto-statement-here/55383615#55383615", "title": "How would I avoid using a goto statement here?", "body": "<pre><code>int main() {\n    while (1) { /* ADDED  */\n        if (FirstRun == 0) {\n            printf(\"Your starting balance is $%.2f\", Balance);\n        }\n        if (FirstRun &gt; 0) {\n            printf(\"Your new balance is $%.2f\", Balance);\n        }\n        if (Balance &lt;= 0) {\n            printf(\"Sorry you are out of money!\");\n            exit(0);\n        }\n\n        do {\n            ValidBet = 0;\n            printf(\"\\nPlease enter your bet:\");\n            scanf(\"%lf\", &amp;Bet);\n\n            if ((Bet &gt; Balance) || (Bet &lt; 0)) {\n                printf(\"Your bet is invalid, try again.\");\n            } else {\n                ValidBet = 1;\n            }\n        } while (ValidBet == 0);\n\n        ThrowDicePair();\n        printf(\"DICE #1 WAS %d\", SumOfThrows);\n\n        if (SumOfThrows == 7 || SumOfThrows == 11) {\n            Balance += Bet;\n            printf(\"You win! Would you like to play again? [y/n]\");\n            C = getch();\n            if (C == 'y') {\n                FirstRun++;\n                continue; /* ADDED  */\n            } else if (C == 'n') {\n                printf(\"Thanks for playing\");\n                exit(0);\n            }\n        }\n        break; /* ADDED  */\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 7309021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa3edcd27cfd0f392ae25f306bcd8628?s=128&d=identicon&r=PG&f=1", "display_name": "William H", "link": "https://stackoverflow.com/users/7309021/william-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 55382964, "answer_count": 3, "score": 2, "last_activity_date": 1553709000, "creation_date": 1553706374, "question_id": 55382865, "link": "https://stackoverflow.com/questions/55382865/how-would-i-avoid-using-a-goto-statement-here", "title": "How would I avoid using a goto statement here?", "body": "<p>I am pretty new to programming in C and I am making a simple dice based game. I have all the other logic working but I am having trouble seeing how to avoid a goto statement. Basically the player starts with 50 dollars as their balance and the program asks for a bet, then dice are rolled and depending on what the result of the roll is different things happen. The main issue is when the result happens the user is asked if they want to play again, if they say no then I just exit but if they say yes I need to go back to the start and ask for a bet again.</p>\n\n<pre><code>\nint main()\n{\n\n        START:\n\n    if (FirstRun == 0)\n    {\n        printf(\"Your starting balance is $%.2f\", Balance);\n    }\n    if (FirstRun &gt; 0)\n    {\n        printf(\"Your new balance is $%.2f\", Balance);\n    }\n    if (Balance &lt;= 0)\n    {\n        printf(\"Sorry you are out of money!\");\n        exit(0);\n    }\n\n    do\n    {\n        ValidBet = 0;\n        printf(\"\\nPlease enter your bet:\");\n        scanf(\"%lf\", &amp;Bet);\n\n        if ((Bet &gt; Balance) || (Bet &lt; 0))\n        {\n            printf(\"Your bet is invalid, try again.\");\n        }\n        else \n        {\n            ValidBet = 1;\n        }\n    } while (ValidBet == 0);\n\n    ThrowDicePair();\n    printf(\"DICE #1 WAS %d\", SumOfThrows);\n\n    if (SumOfThrows == 7 || SumOfThrows == 11)\n    {\n        Balance += Bet;\n        printf(\"You win! Would you like to play again? [y/n]\");\n        C = getch();\n        if (C == 'y')\n        {\n            FirstRun++;\n            goto START;\n        }\n        else if (C == 'n')\n        {\n            printf(\"Thanks for playing\");\n            exit(0);\n        }\n\n}\n\n</code></pre>\n"}, {"tags": ["c++", "c", "x86", "profiling", "intel-pin"], "answers": [{"comments": [{"owner": {"reputation": 1660, "user_id": 5501407, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cz29B.jpg?s=128&g=1", "display_name": "R4444", "link": "https://stackoverflow.com/users/5501407/r4444"}, "edited": false, "score": 0, "creation_date": 1553709266, "post_id": 55383529, "comment_id": 97489199, "body": "Thanks @Hadi. But, is there any way to detect the rsp instruction in the analysis routine. What would you suggest? is this okay if I add a condition in the instrumentation routine instead, to detect such an instruction? or shall I detect <code>ah</code> instead in the analysis routine. What is more reliable?"}, {"owner": {"reputation": 18599, "user_id": 4230618, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KRWgI.jpg?s=128&g=1", "display_name": "Hadi Brais", "link": "https://stackoverflow.com/users/4230618/hadi-brais"}, "reply_to_user": {"reputation": 1660, "user_id": 5501407, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cz29B.jpg?s=128&g=1", "display_name": "R4444", "link": "https://stackoverflow.com/users/5501407/r4444"}, "edited": false, "score": 2, "creation_date": 1553709444, "post_id": 55383529, "comment_id": 97489298, "body": "@Ruturaj Yes, but it depends on what you want to do. If the analysis routine only cares about instructions whose first operand is <code>RSP</code>, then perform the check in the instrumentation routine (where <code>INS</code> is valid). Otherwise, you have to either copy the bytes of the instruction or pass the address of the instruction so it can be inspected in the analysis routine."}], "tags": [], "owner": {"reputation": 18599, "user_id": 4230618, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KRWgI.jpg?s=128&g=1", "display_name": "Hadi Brais", "link": "https://stackoverflow.com/users/4230618/hadi-brais"}, "is_accepted": true, "score": 3, "last_activity_date": 1553708646, "creation_date": 1553708646, "answer_id": 55383529, "question_id": 55382659, "link": "https://stackoverflow.com/questions/55382659/intel-pin-analysis-routine-detects-ah-register-instead-of-rsp-reg-stack-ptr/55383529#55383529", "title": "intel Pin: analysis routine detects ah register instead of rsp (REG_STACK_PTR)", "body": "<p>The <code>INS</code> objects are only valid inside instrumentation routines, such as your <code>Instruction</code> routine. The <code>INS</code> type is nothing but a 32-bit integer that identifies an instruction. The Pin runtime internally maintains a table that maps these 32-bit integers to specific static instructions. It creates such a table whenever it's about to call an instrumentation routine. When the instrumentation routine returns, there is no guarantee that any of these identifiers map to the same static instructions and they may not even be valid. So when you save a copy of an <code>INS</code> object in the following line of code:</p>\n\n<pre><code>insstack.insert(std::make_pair(INS_Address(ins), new Insr(string(INS_Disassemble(ins)),\n    ins)));\n</code></pre>\n\n<p>that copy is only useful in the same instance of the <code>Instruction</code> routine. The next time the <code>Instruction</code> routine is called (or any other instrumentation routine), an instruction identifier might be reused for other instructions.</p>\n\n<p>If you really want to pass an instruction to an analysis routine, you have two options:</p>\n\n<ul>\n<li>Copy the actual bytes of the instruction to a buffer and pass the address of the buffer and later decode it using the XED API.</li>\n<li>Pass the address of the instruction and later decode it using the XED API. This works if the instruction is guaranteed to be available at the same location later.</li>\n</ul>\n"}], "owner": {"reputation": 1660, "user_id": 5501407, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cz29B.jpg?s=128&g=1", "display_name": "R4444", "link": "https://stackoverflow.com/users/5501407/r4444"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 55383529, "answer_count": 1, "score": 2, "last_activity_date": 1596536963, "creation_date": 1553705749, "last_edit_date": 1596536963, "question_id": 55382659, "link": "https://stackoverflow.com/questions/55382659/intel-pin-analysis-routine-detects-ah-register-instead-of-rsp-reg-stack-ptr", "title": "intel Pin: analysis routine detects ah register instead of rsp (REG_STACK_PTR)", "body": "<p>I asked <a href=\"https://stackoverflow.com/questions/55264577/stack-allocation-size-using-intel-pin-tool\">this</a> question few days ago.</p>\n<p>I wanted to get the stack allocation size (after the function creation). The answer suggests to do:</p>\n<blockquote>\n<pre><code>if((INS_Opcode(ins) == XED_ICLASS_ADD || INS_Opcode(ins) == XED_ICLASS_SUB) &amp;&amp; \n   REG(INS_OperandReg(ins, 0)) == REG_STACK_PTR &amp;&amp; INS_OperandIsImmediate(ins, 1)\n</code></pre>\n</blockquote>\n<p>Which in theory is correct and does make sense. But, it doesn't work in practice (correct me if I'm wrong here). It works perfectly fine if I remove <code>REG(INS_OperandReg(ins, 0)) == REG_STACK_PTR</code> check. Why? Because pin doesn't detect the <code>REG_STACK_PTR</code> register when <code>REG(INS_OperandReg(ins, 0))</code> is used to detect it. rather, it detects <code>ah</code> (which I believe is RAX), when I do check against <code>add rsp, 0xffffffffffffff80</code> instruction (so, every time it gives: <code>register: ah</code>), as can be seen in my output below:</p>\n<pre><code>in\nregister: rbp\n40051e  push rbp\nregister: *invalid*\nvalue: -128\n40051f  mov rbp, rsp\nregister: ah\n400522  add rsp, 0xffffffffffffff80\nregister: *invalid*\n400526  mov dword ptr [rbp-0x28], 0x7\nregister: *invalid*\n40052d  mov dword ptr [rbp-0x64], 0x9\nregister: eax\n400534  mov eax, 0x0\nregister: *invalid*\n400539  call 0x4004e6\nregister: rbp\n4004e6  push rbp\nregister: *invalid*\nvalue: 64\n4004e7  mov rbp, rsp\nregister: ah\n4004ea  sub rsp, 0x40\nregister: *invalid*\n4004ee  mov dword ptr [rbp-0xc], 0x4\nregister: rax\n4004f5  lea rax, ptr [rbp-0xc]\nregister: *invalid*\n4004f9  mov qword ptr [rbp-0x8], rax\nregister: rax\n4004fd  mov rax, qword ptr [rbp-0x8]\nregister: eax\n400501  mov eax, dword ptr [rax]\nregister: *invalid*\n400503  mov esi, eax\nregister: edi\n400505  mov edi, 0x4005d0\nregister: eax\n40050a  mov eax, 0x0\nregister: rdi\n40050f  call 0x4003f0\nregister: rdi\n4003f0  jmp qword ptr [rip+0x200c22]\nregister: *invalid*\n4003f6  push 0x0\nregister: *invalid*\n4003fb  jmp 0x4003e0\nregister: *invalid*\n4003e0  push qword ptr [rip+0x200c22]\nregister: rdi\n4003e6  jmp qword ptr [rip+0x200c24]\n4\nregister: *invalid*\n400514  mov dword ptr [rbp-0x3c], 0x3\n40051b  nop\nregister: *invalid*\n40051c  leave \nregister: *invalid*\n40051d  ret \nregister: eax\n40053e  mov eax, 0x0\nregister: *invalid*\n400543  leave \nout\n</code></pre>\n<p>Well, interestingly it does this for every occurrences of <code>rsp</code> (i.e. it detects <code>ah</code> instead of <code>rsp</code>). Also, it always prints the instruction <code>400522 add rsp, 0xffffffffffffff80</code>, including <code>rsp</code> (So, why it doesn't print <code>ah</code> here?)</p>\n<p>If <code>ah</code> represents <code>rsp</code> in some way, then I can always detect <code>ah</code> using: <code>REG(INS_OperandReg(ins, 0)) == REG_AH</code>. But, I want to understand what is going on here.</p>\n<p>My code:</p>\n<pre><code>#include &lt;iostream&gt;\n#include &lt;fstream&gt;\n#include &quot;pin.H&quot;\n#include &lt;unordered_map&gt;\n\n// key to open the main Routine\nstatic uint32_t key = 0;\n\n// Ins object mapping\nclass Insr\n{\nprivate:\n  // Disassembled instruction\n    string insDis;\n  INS ins;\n\npublic:\n    Insr(string insDis, INS ins) { this-&gt;insDis = insDis; this-&gt;ins = ins;}\n    string get_insDis() { return insDis;}\n  INS get_ins() { return ins;}\n};\n\n// Stack for the Insr structure\nstatic std::unordered_map&lt;ADDRINT, Insr*&gt; insstack;\n\n// This function is called before every instruction is executed\nVOID protect(uint64_t addr)\n{\n  if (addr &gt; 0x700000000000)\n        return;\n    if (!key)\n        return;\n  // Initialize the diassembled instruction\n  string insdis = insstack[addr]-&gt;get_insDis();\n  INS ins = insstack[addr]-&gt;get_ins();\n    if (INS_OperandCount(ins) &gt; 0)\n    {\n        if (REG(INS_OperandReg(ins, 0)) == REG_AH)\n            std::cout &lt;&lt; &quot;register: &quot; &lt;&lt; REG_StringShort(REG(INS_OperandReg(ins, 0))) &lt;&lt; '\\n';\n    }\n\n  if((INS_Opcode(ins) == XED_ICLASS_ADD || INS_Opcode(ins) == XED_ICLASS_SUB) &amp;&amp;\n   INS_OperandIsImmediate(ins, 1))\n    {\n      int value = INS_OperandImmediate(ins, 1);\n        std::cout &lt;&lt; &quot;value: &quot; &lt;&lt; dec&lt;&lt;value &lt;&lt; '\\n';\n    }\n  std::cout &lt;&lt; hex &lt;&lt;addr &lt;&lt; &quot;\\t&quot; &lt;&lt; insdis &lt;&lt; std::endl;\n}\n\n// Pin calls this function every time a new instruction is encountered\nVOID Instruction(INS ins, VOID *v)\n{\n        if (INS_Address(ins) &gt; 0x700000000000)\n        return;\n\n    insstack.insert(std::make_pair(INS_Address(ins), new Insr(string(INS_Disassemble(ins)),\n    ins)));\n    // if (REG_valid_for_iarg_reg_value(INS_MemoryIndexReg(ins)))\n    //   std::cout &lt;&lt; &quot;true&quot; &lt;&lt; '\\n';\n    // Insert a call to docount before every instruction, no arguments are passed\n    INS_InsertCall(ins, IPOINT_BEFORE, (AFUNPTR)protect, IARG_ADDRINT, INS_Address(ins),\n  IARG_END);\n}\n\n// Lock Routine\nvoid mutex_lock()\n{\nkey = 0;\nstd::cout&lt;&lt;&quot;out\\n&quot;;\n}\nvoid mutex_unlock()\n{\n    key = 1;\n    std::cout&lt;&lt;&quot;in\\n&quot;;\n}\n\nvoid Routine(RTN rtn, VOID *V)\n{\n    if (RTN_Name(rtn) == &quot;main&quot;)\n    {\n        RTN_Open(rtn);\n        RTN_InsertCall(rtn, IPOINT_BEFORE, (AFUNPTR)mutex_unlock, IARG_END);\n        RTN_InsertCall(rtn, IPOINT_AFTER, (AFUNPTR)mutex_lock, IARG_END);\n        RTN_Close(rtn);\n    }\n}\n\nINT32 Usage()\n{\n    cerr &lt;&lt; &quot;This tool counts the number of dynamic instructions executed&quot; &lt;&lt; endl;\n    cerr &lt;&lt; endl &lt;&lt; KNOB_BASE::StringKnobSummary() &lt;&lt; endl;\n    return -1;\n}\n\nint main(int argc, char * argv[])\n{\n    // Initialize the symbol table\n    PIN_InitSymbols();\n\n    // Initialize pin\n    if (PIN_Init(argc, argv)) return Usage();\n\n    PIN_SetSyntaxIntel();\n\n    // Routine instrumentation\n    RTN_AddInstrumentFunction(Routine, 0);\n\n    // Register Instruction to be called to instrument instructions\n    INS_AddInstrumentFunction(Instruction, 0);\n\n    // Start the program, never returns\n    PIN_StartProgram();\n\n    return 0;\n}\n</code></pre>\n<p>I have few questions regarding that.</p>\n<p>How can I understand such a behavior? And how can I detect rsp if I want to? Lastly, how does the instruction prints <code>rsp</code>, but <code>REG(INS_OperandReg(ins, 0)) == REG_STACK_PTR</code> can not detect it?</p>\n"}, {"tags": ["c", "language-lawyer"], "comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1553704147, "post_id": 55382078, "comment_id": 97486399, "body": "All the various type groups spewed over 6.2 are mildly helpful, you don&#39;t really <i>need</i> to know the names of most groups. Why would you ever need to write code to ensure that a variable belongs to an artificial type group?"}, {"owner": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1553704251, "post_id": 55382078, "comment_id": 97486466, "body": "@Lundin When assigning a value to a variable of arithmetic type. As specified the right should have arithmetic type."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1553704288, "post_id": 55382078, "comment_id": 97486480, "body": "<a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.2.5p18\" rel=\"nofollow noreferrer\">port70.net/~nsz/c/c11/n1570.html#6.2.5p18</a> - <i>Integer and floating types are collectively called arithmetic types</i>. So, qualified or not qualified."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1553704362, "post_id": 55382078, "comment_id": 97486526, "body": "@EugeneSh. I was about to quote the same. That sums it up."}, {"owner": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1553704389, "post_id": 55382078, "comment_id": 97486546, "body": "@EugeneSh. I looked at the definition of integer/floating types and found only list of types. They did not mention that qualified version of any of these types is also arithmetic."}, {"owner": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1553704544, "post_id": 55382078, "comment_id": 97486635, "body": "@EugeneSh. From 6.2.5(p4): <i>There  are  five standard  signed  integer  types,  designated  assigned <code>char</code>,<code>short int</code>,<code>int</code>, <code>long  int</code>,  and <code>long  long  int</code>.</i> Unsigned is derived with <code>unsigned</code> keyword 6.2.6(p6). 6.2.5(p7): <i>The  standard  signed  integer  types  and  standard  unsigned  integer  types  are  collectively called  the standard  integer  types</i>. 6.2.5(p17): <i>The  type char,  the  signed  and  unsigned  integer  types,  and  the  enumerated  types  are collectively called integer types.</i> So how do you claim that qualified is also arithemtic?"}, {"owner": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1553705046, "post_id": 55382078, "comment_id": 97486948, "body": "@Lundin The qualification is not mentioned in the definition of the integer/floating types. The types are simply listed starting with <i>standard signed integer types</i> as <code>char</code>, <code>short int</code>, <code>int</code>, <code>long int</code>, and <code>long long int</code>. As the Standard specifies the rest of integer types are derived from the types <i>without qualifiers</i>."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1553705209, "post_id": 55382078, "comment_id": 97487038, "body": "The very same wording is appearing about &quot;scalar&quot; types and &quot;aggregate&quot; types. I guess assuming that a qualified <code>struct</code> is not aggregate would be a bit silly. So yeah, the Standard might have missed some point (or we missed it when reading it) which is otherwise pretty obvious."}], "answers": [{"tags": [], "owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "is_accepted": true, "score": 5, "last_activity_date": 1553707898, "creation_date": 1553707898, "answer_id": 55383322, "question_id": 55382078, "link": "https://stackoverflow.com/questions/55382078/qualified-version-of-arithmetic-types/55383322#55383322", "title": "Qualified version of arithmetic types", "body": "<p>When I read the n1570 draft for C11 or the n1256 draft for C99, the full paragraph from where you have extracted your first quotation is (emphasize mine):</p>\n\n<blockquote>\n  <p>\u00a726 Any type so far mentioned is an unqualified type. <strong>Each unqualified type has several\n  qualified versions of its type</strong>, corresponding to the combinations of one, two, or all\n  three of the const, volatile, and restrict qualifiers. The qualified or unqualified\n  versions of a type are distinct types that belong to the same type category and have the\n  same representation and alignment requirements. A derived type is not qualified by the\n  qualifiers (if any) of the type from which it is derived.</p>\n</blockquote>\n\n<p>My understanding of the full paragraph is that despite being different types, the qualified versions of an unqualified type share all other properties. So <code>const int</code> is an arithmetic type, and an integer type.</p>\n\n<p>In addition, 6.7.3 Semantics \u00a73 say:</p>\n\n<blockquote>\n  <p>The properties associated with qualified types are meaningful only for expressions that\n  are lvalues.</p>\n</blockquote>\n\n<p>That means that an operation on two qualified <code>const int</code> yields a result that is an unqualified <code>int</code> because it is a rvalue.</p>\n\n<p>The <em>qualifiers</em> only <em>modify</em> an unqualified type for properties related to a lvalue access. The are different types because they have different access properties and the details on those qualified properties are given in 6.7.3 Type qualifiers. They have to be different types, because pointers to qualified types, which are derived type must be different types. But this has nothing to do with qualified versions of arithmetics types not being arithmetic types.</p>\n"}], "owner": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 55383322, "answer_count": 1, "score": 1, "last_activity_date": 1553911336, "creation_date": 1553703903, "last_edit_date": 1553911336, "question_id": 55382078, "link": "https://stackoverflow.com/questions/55382078/qualified-version-of-arithmetic-types", "title": "Qualified version of arithmetic types", "body": "<p>This seems obvious, but I could not understand if we can treat qualified  version of arithmetic type as an arithmetic type. <code>int</code> - is an arithmetic type. Is <code>volatile const int</code> arithmetic? <code>6.2.5(p26)</code>:</p>\n\n<blockquote>\n  <p>The qualified or unqualified versions of a type are distinct types\n  that belong to the same type category and have the same representation\n  and alignment requirements.</p>\n</blockquote>\n\n<p>The definition of type category <code>6.2.5(p25)</code>:</p>\n\n<blockquote>\n  <p>A type is characterized by its type category, which is either the\n  outermost derivation of a derived type (as noted above in the\n  construction of derived types), or the type itself if the type\n  consists of no derived types</p>\n</blockquote>\n\n<p>So the type category is about if the type is a pointer/array/function and has nothing to do with \"arithmeticness\" of a type.</p>\n\n<p>The definition of arithmetic types given earlier in <code>6.2.5(p18)</code>. So applying the only rules I cited and the definition given in <code>6.2.5(p18)</code> it is not possible to claim that <code>const volatile int</code> is also arithmetic.</p>\n\n<p>The same representation and alignment requirements as arithmetic type does not make the type arithmetic.</p>\n\n<p>The question arose when I tried to understand conforming usage of assignment operator <code>6.5.16.1(p1)</code>:</p>\n\n<blockquote>\n  <p>the left operand has atomic, qualified, or unqualified arithmetic\n  type, and the right has arithmetic type</p>\n</blockquote>\n\n<pre><code>const int a = 10;\n//Do I really need this cast to make it arithmetic?\n//Looks crazy\nconst int b = (int) a;  \n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 3, "creation_date": 1553702821, "post_id": 55381682, "comment_id": 97485591, "body": "So.. where <code>(l -&gt; prox)</code> is pointing to (I am referring to the third line of <code>main</code>..)?"}, {"owner": {"reputation": 13228, "user_id": 8398549, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8tzrl.jpg?s=128&g=1", "display_name": "Cid", "link": "https://stackoverflow.com/users/8398549/cid"}, "edited": false, "score": 0, "creation_date": 1553702890, "post_id": 55381682, "comment_id": 97485639, "body": "You want to allocate memory to <code>l-&gt;prox</code>"}, {"owner": {"reputation": 15, "user_id": 11262860, "user_type": "registered", "profile_image": "https://graph.facebook.com/2193231977436979/picture?type=large", "display_name": "Leonardo Maia", "link": "https://stackoverflow.com/users/11262860/leonardo-maia"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1553702919, "post_id": 55381682, "comment_id": 97485650, "body": "@EugeneSh. it is pointed to the next struct lligada"}, {"owner": {"reputation": 15, "user_id": 11262860, "user_type": "registered", "profile_image": "https://graph.facebook.com/2193231977436979/picture?type=large", "display_name": "Leonardo Maia", "link": "https://stackoverflow.com/users/11262860/leonardo-maia"}, "reply_to_user": {"reputation": 13228, "user_id": 8398549, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8tzrl.jpg?s=128&g=1", "display_name": "Cid", "link": "https://stackoverflow.com/users/8398549/cid"}, "edited": false, "score": 0, "creation_date": 1553702948, "post_id": 55381682, "comment_id": 97485665, "body": "@Cid by allocating memory to l, I&#39;m alocating memory to l-&gt;prox."}, {"owner": {"reputation": 13228, "user_id": 8398549, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8tzrl.jpg?s=128&g=1", "display_name": "Cid", "link": "https://stackoverflow.com/users/8398549/cid"}, "edited": false, "score": 0, "creation_date": 1553703014, "post_id": 55381682, "comment_id": 97485709, "body": "Where in your code?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1553703014, "post_id": 55381682, "comment_id": 97485710, "body": "What next struct if you haven&#39;t allocated any except <code>l</code>?  Also you have never assigned anything to it."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1553703051, "post_id": 55381682, "comment_id": 97485733, "body": "@LeonardoMaia right after your <code>malloc</code>, <code>l-&gt;prox</code> points nowhere."}, {"owner": {"reputation": 15, "user_id": 11262860, "user_type": "registered", "profile_image": "https://graph.facebook.com/2193231977436979/picture?type=large", "display_name": "Leonardo Maia", "link": "https://stackoverflow.com/users/11262860/leonardo-maia"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1553703075, "post_id": 55381682, "comment_id": 97485751, "body": "@EugeneSh. So how do i do it to create a struct lligada ?"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1553703112, "post_id": 55381682, "comment_id": 97485776, "body": "<code>malloc</code> does not initialize memory, so <code>l-&gt;prox</code> will have an invalid pointer value until you change the pointer to point somewhere meaningful, probably to another <code>malloc</code>ed <code>struct lliigada</code>."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1553703246, "post_id": 55381682, "comment_id": 97485851, "body": "You&#39;ve already <code>malloc</code>ed storage for one <code>struct lligada</code> so it shouldn&#39;t be hard to work out how to <code>malloc</code> storage for another one. To save us all from banging our heads against the wall in frustration, I&#39;ll show you how to do it explicitly: <code>l-&gt;prox = malloc(sizeof(struct lligada));</code>."}, {"owner": {"reputation": 15, "user_id": 11262860, "user_type": "registered", "profile_image": "https://graph.facebook.com/2193231977436979/picture?type=large", "display_name": "Leonardo Maia", "link": "https://stackoverflow.com/users/11262860/leonardo-maia"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1553703288, "post_id": 55381682, "comment_id": 97485878, "body": "@Jabberwocky thank you, i got it guys."}], "answers": [{"comments": [{"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1553704687, "post_id": 55381912, "comment_id": 97486715, "body": "@LeonardoMaia compare your version with mine.It shouldn&#39;t be too hard to figure out."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "reply_to_user": {"reputation": 15, "user_id": 11262860, "user_type": "registered", "profile_image": "https://graph.facebook.com/2193231977436979/picture?type=large", "display_name": "Leonardo Maia", "link": "https://stackoverflow.com/users/11262860/leonardo-maia"}, "edited": false, "score": 0, "creation_date": 1553704799, "post_id": 55381912, "comment_id": 97486785, "body": "@LeonardoMaia your version displays and frees only the first element of the list."}], "tags": [], "owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "is_accepted": true, "score": 0, "last_activity_date": 1553703351, "creation_date": 1553703351, "answer_id": 55381912, "question_id": 55381682, "link": "https://stackoverflow.com/questions/55381682/segmentation-fault-on-linked-list/55381912#55381912", "title": "Segmentation fault on linked list", "body": "<p>You probably want this:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\ntypedef struct lligada {    \n  int valor;\n  struct lligada *prox;    \n} *LInt;\n\nvoid imprimeL(LInt l) {    \n  LInt aux;\n\n  while (l != NULL) {\n    printf(\"%d\\n\", l-&gt;valor);\n    aux = l-&gt;prox;\n    free(l);\n    l = aux;\n  }    \n}\n\nint main() {    \n  LInt l = malloc(sizeof(struct lligada));\n  l-&gt;valor = 1;\n\n  LInt l1 = malloc(sizeof(struct lligada));\n  l-&gt;prox = l1;\n\n  l1-&gt;valor = 2;\n  l1-&gt;prox = NULL;\n\n  imprimeL(l);\n\n  printf(\"Ola\\n\");\n  return 0;\n}\n</code></pre>\n\n<p>There is also a bug in your <code>imprimeL</code> function.</p>\n\n<p>The next step for you is to create the linked list dynamically with a loop.</p>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 10923585, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mC-lnV93b1I/AAAAAAAAAAI/AAAAAAAAABw/5Wzdg8OxfD8/photo.jpg?sz=128", "display_name": "Niloo Garavi", "link": "https://stackoverflow.com/users/10923585/niloo-garavi"}, "is_accepted": false, "score": 1, "last_activity_date": 1553706822, "creation_date": 1553706822, "answer_id": 55382997, "question_id": 55381682, "link": "https://stackoverflow.com/questions/55381682/segmentation-fault-on-linked-list/55382997#55382997", "title": "Segmentation fault on linked list", "body": "<p>A segmentation fault happens when you access a memory address that you do not have access to. In your case when you allocate memory for l, your lligada data structure is below:</p>\n\n<pre><code>int valor                -&gt; some garbage value\nstruct lligada *prox;    -&gt; NULL pointer\n</code></pre>\n\n<p>So then when you access l->prox ->prox you are trying to access a null pointer which causes a seg fault.</p>\n\n<p>To avoid that, you can allocate memory for prox before accessing its elements.</p>\n"}], "owner": {"reputation": 15, "user_id": 11262860, "user_type": "registered", "profile_image": "https://graph.facebook.com/2193231977436979/picture?type=large", "display_name": "Leonardo Maia", "link": "https://stackoverflow.com/users/11262860/leonardo-maia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 55381912, "answer_count": 2, "score": -1, "last_activity_date": 1553706822, "creation_date": 1553702629, "last_edit_date": 1553702775, "question_id": 55381682, "link": "https://stackoverflow.com/questions/55381682/segmentation-fault-on-linked-list", "title": "Segmentation fault on linked list", "body": "<p>So, i have this funtions in my imprimeL.c file that prints every intenger of l(*LInt), it shows seg fault on</p>\n\n<pre><code>(l -&gt; prox) -&gt; valor = 2 \n(l -&gt; prox) -&gt; prox = NULL;\n</code></pre>\n\n<p>My imprimeL funtion is well defined and my struct lligada is:</p>\n\n<pre><code>typedef struct lligada {\n\n    int valor;\n    struct lligada *prox;\n\n} *LInt;\n\nvoid imprimeL(LInt l){\n\n    LInt aux;\n\n    while(l != NULL){\n\n        printf(\"%d\\n\", l-&gt; valor);\n        aux = l-&gt; prox;\n        free(l);\n        aux = NULL;\n        l = aux;\n    }\n\n}\n\nint main(){\n\n    LInt l = malloc(sizeof(struct lligada));\n    l -&gt; valor = 1;\n    (l -&gt; prox) -&gt; valor = 2;\n    (l -&gt; prox) -&gt; prox = NULL;\n\n    imprimeL(l);\n\n    printf(\"Ola\\n\");\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1553702513, "post_id": 55381594, "comment_id": 97485379, "body": "Please post some code and the type declarations used."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 3, "creation_date": 1553702516, "post_id": 55381594, "comment_id": 97485380, "body": "Divide the problem. First count and store the results into array of <code>10</code>. Then find the maximum. After you are done, you can try and combine these two into something more concise."}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1553708883, "post_id": 55381594, "comment_id": 97489013, "body": "You should start with sowing us an example. Without <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> no one can help you."}], "answers": [{"tags": [], "owner": {"reputation": 669, "user_id": 6675878, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/29885f3542cb5b00a06b1175caa1736e?s=128&d=identicon&r=PG&f=1", "display_name": "STOPIMACODER", "link": "https://stackoverflow.com/users/6675878/stopimacoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1553731464, "creation_date": 1553731464, "answer_id": 55388287, "question_id": 55381594, "link": "https://stackoverflow.com/questions/55381594/how-to-find-a-max-value-of-letters-in-the-rows-of-a-2d-array/55388287#55388287", "title": "How to find a max value of letters in the rows of a 2D array", "body": "<p>In the future please be more specific about your problem and it would help us to show some code so we can have more of an understanding of your problem. I have an example but it was written on ipad so might not be fully working but it'll help you to get an idea of what to do.</p>\n\n<p>I just created an int array where 1=true, 0 = false. it will go through columns first and then compare values of neg vs pos and store whichever is greater in a max variable. Again, this is a very basic probably buggy code but will give a headstart!</p>\n\n<p>Cheers!</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main()\n{\n  int pos = 0;\n  int neg = 0;\n  int max = 0;\n  int array[3][10];\n  for(int i = 0; i &lt; 3; i++){\n    for (int j = 0; j &lt; 10; j++){\n      if (array[i][j] == 1){\n        pos++;\n      }else if ( array[i][j] == 0){\n        neg++;\n      }\n    }\n    if (pos &gt; neg){\n      max = pos;\n    }else{max = neg;}\n  }\n  return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11267397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1356162fb91933c9a352826babcc433c?s=128&d=identicon&r=PG&f=1", "display_name": "Dundhunter", "link": "https://stackoverflow.com/users/11267397/dundhunter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1553731464, "creation_date": 1553702395, "question_id": 55381594, "link": "https://stackoverflow.com/questions/55381594/how-to-find-a-max-value-of-letters-in-the-rows-of-a-2d-array", "title": "How to find a max value of letters in the rows of a 2D array", "body": "<p>I have a 3 row, 10 column array. Each column is designated to a person, each of the 3 spaces in every column is a yes or no response ('y', or 'n').</p>\n\n<p>I'm trying to find the highest number of 'n' values in a column and setting it as a max value to compare it to the other columns. </p>\n\n<p>How would I got about using if statements to find the number of 'n' elements in a column and overwriting a variable when a column with a larger amount of 'n' elements is reached?</p>\n\n<p>I've been trying to test only the first set of indices of the 2D array, so rather than testing every box, I only test the 10 columns</p>\n\n<p>If a certain column has 3 'n' values (all the boxes in that column are 'n') then the max value should be 3.\nhowever, if the highest number of 'n' elements in any column is only 2 then the max value should be 2.</p>\n"}, {"tags": ["c", "outlook", "microsoft-graph-api", "mapi", "smime"], "comments": [{"owner": {"reputation": 5810, "user_id": 232467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X1ppg.jpg?s=128&g=1", "display_name": "Slava Ivanov", "link": "https://stackoverflow.com/users/232467/slava-ivanov"}, "edited": false, "score": 0, "creation_date": 1553781566, "post_id": 55381420, "comment_id": 97519250, "body": "Are you expecting someone provide you with a complex solution? SO is simple QandA resource for specific issues with the code. What you are asking is too broad. Other than &quot;yes, everything is possible, but it takes time, resources, etc.&quot;, nobody would give you better answer. Please refer to <a href=\"https://stackoverflow.com/help/how-to-ask\">How do I ask a good question?</a>"}, {"owner": {"reputation": 53, "user_id": 5126704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c82fcffd2c7ae89f9ae8bee3c39a4c70?s=128&d=identicon&r=PG&f=1", "display_name": "Tim de Haas", "link": "https://stackoverflow.com/users/5126704/tim-de-haas"}, "reply_to_user": {"reputation": 5810, "user_id": 232467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X1ppg.jpg?s=128&g=1", "display_name": "Slava Ivanov", "link": "https://stackoverflow.com/users/232467/slava-ivanov"}, "edited": false, "score": 0, "creation_date": 1554122480, "post_id": 55381420, "comment_id": 97624036, "body": "@SlavaIvanov Thank you! I&#39;ve removed a lot of the extra info and rewrote the question to focus on what I really want to know."}], "answers": [{"tags": [], "owner": {"reputation": 53, "user_id": 5126704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c82fcffd2c7ae89f9ae8bee3c39a4c70?s=128&d=identicon&r=PG&f=1", "display_name": "Tim de Haas", "link": "https://stackoverflow.com/users/5126704/tim-de-haas"}, "is_accepted": true, "score": 1, "last_activity_date": 1563348881, "last_edit_date": 1563348881, "creation_date": 1563347336, "answer_id": 57070337, "question_id": 55381420, "link": "https://stackoverflow.com/questions/55381420/how-to-apply-s-mime-certificate-to-outlook-programatically-windows-c-c/57070337#57070337", "title": "How to apply S/MIME certificate to Outlook programatically (Windows, C/C++)", "body": "<p>For anyone trying to do the same, the following script is great (or a great place to start) for setting an S/MIME certificate to Outlook including the required settings. </p>\n\n<p><a href=\"https://github.com/glueckkanja-pki/PKI-Configuration-Tools/blob/master/ActivateSignatures.ps1\" rel=\"nofollow noreferrer\">https://github.com/glueckkanja-pki/PKI-Configuration-Tools/blob/master/ActivateSignatures.ps1</a></p>\n\n<p>The scripts edits the registry entry which contains the Outlook security settings. You can run the Powershell script using 'system(\"start [...]\")' or 'CreateProcess' for example.</p>\n\n<p>To answer the subquestions: I have not found a way to do this through either Outlook MAPI nor Graph API. The registry entry is: HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\\"version, 16.0 for me\"\\Outlook\\Profiles\\\"Profile Name\"\\c02ebc5353d9cd11975200aa004ae40e</p>\n"}], "owner": {"reputation": 53, "user_id": 5126704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c82fcffd2c7ae89f9ae8bee3c39a4c70?s=128&d=identicon&r=PG&f=1", "display_name": "Tim de Haas", "link": "https://stackoverflow.com/users/5126704/tim-de-haas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 734, "favorite_count": 1, "accepted_answer_id": 57070337, "answer_count": 1, "score": 0, "last_activity_date": 1563348881, "creation_date": 1553701904, "last_edit_date": 1554122263, "question_id": 55381420, "link": "https://stackoverflow.com/questions/55381420/how-to-apply-s-mime-certificate-to-outlook-programatically-windows-c-c", "title": "How to apply S/MIME certificate to Outlook programatically (Windows, C/C++)", "body": "<p>We wish to automate the process of applying a S/MIME certificate to Outlook so that it can be used for Signing and Encrypting of email. We want to be able to programmatically set security setting preferences for: the signing &amp; encryption certificate and their corresponding algorithms.</p>\n\n<p>Can we make use of Outlook MAPI or the Graph API for this purpose? Which call / field (group) should we use? Our preference is to use a C/C++ API.</p>\n"}, {"tags": ["c", "ubuntu", "rtos", "qnx"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1553701820, "post_id": 55381378, "comment_id": 97484901, "body": "Who are you trying to prove it to?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1553702093, "post_id": 55381378, "comment_id": 97485075, "body": "Anyway, a generic code won&#39;t do of course, as one has to use the RTOS <i>special</i> capabilities to see the difference, such as time-critical tasks. And of course, a general-purpose OS is not guaranteed <i>not</i> to behave as an RTOS."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 7, "creation_date": 1553702433, "post_id": 55381378, "comment_id": 97485317, "body": "Real-time means guaranteed deadlines, not speed. So what you can do is for example to have a thread toggle an I/O pin once per 1ms then measure the square wave with a scope. Look for irregularities, there should be none."}, {"owner": {"reputation": 2796, "user_id": 6121044, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d36000b5ea58961acf50354041457af9?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas", "link": "https://stackoverflow.com/users/6121044/andreas"}, "edited": false, "score": 0, "creation_date": 1553714793, "post_id": 55381378, "comment_id": 97491952, "body": "An alternative to runtime testing is asking the makers of QNX... I&#39;m sure they have way better testing of their system than any reverse engineering you can come up with..."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1553732383, "post_id": 55381378, "comment_id": 97498560, "body": "You see no difference perhaps because there is none, but how are you measuring the time? There is no timing code in your example."}], "answers": [{"tags": [], "owner": {"reputation": 25733, "user_id": 559737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5de249db6565b87a2699e131974268a?s=128&d=identicon&r=PG", "display_name": "Brendan", "link": "https://stackoverflow.com/users/559737/brendan"}, "is_accepted": false, "score": 0, "last_activity_date": 1553710801, "last_edit_date": 1553710801, "creation_date": 1553710127, "answer_id": 55383906, "question_id": 55381378, "link": "https://stackoverflow.com/questions/55381378/how-to-differentiate-between-an-rtos-and-linux/55383906#55383906", "title": "How to differentiate between an RTOS and Linux?", "body": "<p>First, understand that \"real time\" means the goal is to minimize the worst case time. Typically this involves sacrificing the average case time, which means that often \"real time\" means \"slower on average\".</p>\n\n<p>This also means that to compare the \"real-time-ness\" of operating systems you want to measure the worst case time (not the average time).</p>\n\n<p>For a random example, imagine if you did the same operation (e.g. allocate some pages of RAM) 50 million times; and found that on one OS the worst case time was 5000 nanoseconds (but it always took 5000 nanoseconds, so the average case time is also 5000 nanoseconds); and found that on the other OS the worst case time is 7000 nanoseconds but it almost always takes 100 nanoseconds (and the average case time is 123 nanoseconds). By comparing the worst case times (5000 vs 70000) you know that the first OS is a better real-time OS. By comparing the average case times (5000 vs. 123) you know that the second OS is a better \"not real-time\" OS.</p>\n\n<p>Note that most modern CPUs (e.g. 80x86) aren't designed for real-time. To measure the actual worst case you need multiple \"unlikely\" things to happen at the same time (e.g. CPU getting hot and being forced into \"go slow to avoid melting\" mode at the same time that chipset interrupts the OS with system management stuff, at the same time that other CPUs and/or devices happen to be pounding memory or buses/links; while you're trying to measure worst case time). In other words, it's going to take a significant amount of effort (and many attempts) just to arrange conditions to be \"just right\" to hit the worst case.</p>\n"}, {"tags": [], "owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "is_accepted": false, "score": 2, "last_activity_date": 1553732176, "creation_date": 1553732176, "answer_id": 55388367, "question_id": 55381378, "link": "https://stackoverflow.com/questions/55381378/how-to-differentiate-between-an-rtos-and-linux/55388367#55388367", "title": "How to differentiate between an RTOS and Linux?", "body": "<p>An RTOS does not magically turn your code into \"real-time\"; rather it <em>supports</em> real time by being entirely deterministic. </p>\n\n<p>A general-purpose OS (GPOS) such as Linux normally uses a round-robin equal priority time-sharing scheduler, scharing time \"fairly\" amongst a number of processes.  As such the more processed running and the busier they are (using more of their available time slice), the less responsive it becomes. </p>\n\n<p>An RTOS on the other hand typically has a pre-emptive priority based scheduler, such that the highest priority ready task gets to run immediately, regardless, and will continue to run until it suspends itself or a higher priority task becomes ready.  In such a system you have to assign priorities appropriately to guarantee all tasks run on time every time.  Generally the tasks with the shortest and most deterministic run-time should have the highest priority.  Critically while an RTOS supports real-time deterministic behaviour a great deal of responsibility is placed on the developer to design tasks and priorities appropriately.</p>\n\n<p>As such you cannot simply run some arbitrary third-party code and expect to demonstrate real-time performance.  You need to code a specific test.  At its simplest you might have a process that blocks on a short period periodic timer, and in that task get the real time passed and analyse how much timing jitter you observe. The real-time system should have minimal jitter (depending on its priority and higher level tasks or interrupts that run), and will not be affected by lower priority tasks, while the GPOS will exhibit much greater variability, especially when running other tasks.</p>\n\n<p>There is a real-time scheduler option for a Linux build, but it is far from perfect.  If you find yourself in ICU on life support, be a bit worried if the respirator is running Linux!</p>\n"}], "owner": {"reputation": 695, "user_id": 8875269, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3esbPx-pmgw/AAAAAAAAAAI/AAAAAAAAAEY/-R09F0HMIyI/photo.jpg?sz=128", "display_name": "Abhay Nayak", "link": "https://stackoverflow.com/users/8875269/abhay-nayak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 817, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1553732176, "creation_date": 1553701781, "last_edit_date": 1553701979, "question_id": 55381378, "link": "https://stackoverflow.com/questions/55381378/how-to-differentiate-between-an-rtos-and-linux", "title": "How to differentiate between an RTOS and Linux?", "body": "<p>I've a QNX RTOS and Ubuntu 17.10 running. Problem is, other than the fact that QNX is an RTOS, I don't have any proof that it behaves like a RT system. What kind of application should I run on each OS which can give me a clear differentiation between the RT response of an RTOS and Ubuntu?</p>\n\n<p>I ran a signal handler(interrupt handler) program on both to see which one would catch the interrupt first.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;pthread.h&gt;\n\nvoid sig_hand(int sig) {\n    printf(\"signal received\\n\");\n    exit(0);\n}\n\nvoid *sigfun(void *arg) {\n    signal(SIGINT, sig_hand);\n    while(printf(\"Thread running\\n\"));\n    return NULL;\n}\n\n\nint main(void) {\n    pthread_t th;\n\n    pthread_create(&amp;th,NULL,sigfun,NULL);\n    pthread_join(th,NULL);\n\n    return 0;\n}\n</code></pre>\n\n<p>I expect that while a thread keeps printing <code>Thread Running</code>, QNX will fetch the interrupt and stop the thread faster compared to Ubuntu. However, I see no difference and probably this is not the right application to find out the faster RT response.\nCan anyone suggest me a better way to clearly differentiate between an RTOS and Ubuntu?</p>\n"}, {"tags": ["mysql", "c", "ubuntu", "gcc", "mariadb"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 2, "creation_date": 1553699582, "post_id": 55380512, "comment_id": 97483372, "body": "Ensure that the development package providing libssl is installed.  I would have expected that to be already done if you installed the mariadb development components from a package, but for whatever reason, they do not appear to be present.  See <a href=\"https://serverfault.com/questions/249340/install-openssl-dev-on-ubuntu-server\">Install openssl-dev on Ubuntu server</a>."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1553699841, "post_id": 55380512, "comment_id": 97483573, "body": "What is the actual output from <code>mysql_config --cflags --libs</code>?"}, {"owner": {"reputation": 21, "user_id": 11160442, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5AA1Q.jpg?s=128&g=1", "display_name": "Giacomo Intini", "link": "https://stackoverflow.com/users/11160442/giacomo-intini"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1553700176, "post_id": 55380512, "comment_id": 97483808, "body": "@AndrewHenle this is the outpu:    -I/usr/include/mariadb -I/usr/include/mariadb/mysql -L/usr/lib/x86_64-linux-gnu/ -lmariadb -lz -ldl -lm -lpthread -lssl -lcrypto"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1553700559, "post_id": 55380512, "comment_id": 97484079, "body": "From the looks of it, the system doesn&#39;t have OpenSSL installed - at least not in the normal place, and the <code>-lssl -lcrypto</code> options try to link in the OpenSSL libraries.  What do you get if you enter the <code>openssl</code> command on the system?  If that works (you get an <code>OpenSSL&gt;</code> prompt that you have to enter <code>exit</code> to quit), what the full path of the <code>openssl</code> executable and what&#39;s the output from <code>ldd &#47;full&#47;path&#47;to&#47;openssl</code>?  Because the <code>openssl</code> binary itself should depend on the same libraries.  And if MariaDB is installed, OpenSSL should be installed too."}, {"owner": {"reputation": 21, "user_id": 11160442, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5AA1Q.jpg?s=128&g=1", "display_name": "Giacomo Intini", "link": "https://stackoverflow.com/users/11160442/giacomo-intini"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1553701132, "post_id": 55380512, "comment_id": 97484451, "body": "@AndrewHenle OpenSSL works. The full path is <code>&#47;usr&#47;bin&#47;openssl </code>. The output for the <code>ldd</code> command is <code>linux-vdso.so.1 (0x00007fffd0b70000) \tlibssl.so.1.1 =&gt; &#47;usr&#47;lib&#47;x86_64-linux-gnu&#47;libssl.so.1.1 (0x00007fac6c4be000) \tlibcrypto.so.1.1 =&gt; &#47;usr&#47;lib&#47;x86_64-linux-gnu&#47;libcrypto.so.1.1 (0x00007fac6c046000) \tlibpthread.so.0 =&gt; &#47;lib&#47;x86_64-linux-gnu&#47;libpthread.so.0 (0x00007fac6be27000) \tlibc.so.6 =&gt; &#47;lib&#47;x86_64-linux-gnu&#47;libc.so.6 (0x00007fac6ba36000) \tlibdl.so.2 =&gt; &#47;lib&#47;x86_64-linux-gnu&#47;libdl.so.2 (0x00007fac6b832000) \t&#47;lib64&#47;ld-linux-x86-64.so.2 (0x00007fac6c9c9000) </code>"}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1553701658, "post_id": 55380512, "comment_id": 97484785, "body": "@GiacomoIntini Did you installed <code>libmariadbclient-dev</code> and then <code>libmariadb-dev-compat</code>? If yes, then do again: <code>sudo apt-get install libmariadbclient-dev libssl-dev</code> and see if are still there."}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1553702737, "post_id": 55380512, "comment_id": 97485532, "body": "@GiacomoIntini Also, what says <code>LDD</code> here: <code>ld -lssl --verbose | grep &quot;attempt&quot;</code> ?"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1553706590, "post_id": 55380512, "comment_id": 97487779, "body": "Which repository was mariadb installed from? Please show the output of <code>apt-cache policy libmariadbclient-dev</code>."}, {"owner": {"reputation": 21, "user_id": 11160442, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5AA1Q.jpg?s=128&g=1", "display_name": "Giacomo Intini", "link": "https://stackoverflow.com/users/11160442/giacomo-intini"}, "reply_to_user": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1553713265, "post_id": 55380512, "comment_id": 97491274, "body": "@Michi thanks for helping, the output of <code>sudo apt-get install libmariadbclient-dev libssl-dev</code> is <code>The following packages have unmet dependencies:  libmariadbclient-dev : Depends: libmariadbclient18 (= 1:10.1.38-0ubuntu0.18.04.1) but 1:10.3.13+maria~bionic is to be installed E: Unable to correct problems, you have held broken packages.</code>"}, {"owner": {"reputation": 21, "user_id": 11160442, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5AA1Q.jpg?s=128&g=1", "display_name": "Giacomo Intini", "link": "https://stackoverflow.com/users/11160442/giacomo-intini"}, "reply_to_user": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1553713335, "post_id": 55380512, "comment_id": 97491298, "body": "@Michi instead about the second command you adviced me the output is : <code>ld: cannot find -lssl</code> and failed attempt to open"}, {"owner": {"reputation": 21, "user_id": 11160442, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5AA1Q.jpg?s=128&g=1", "display_name": "Giacomo Intini", "link": "https://stackoverflow.com/users/11160442/giacomo-intini"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1553713385, "post_id": 55380512, "comment_id": 97491322, "body": "@IanAbbott thank for helping, the output is: <code>libmariadbclient-dev:   Installed: (none)   Candidate: 1:10.1.38-0ubuntu0.18.04.1   Version table:      1:10.1.38-0ubuntu0.18.04.1 500         500 http:&#47;&#47;it.archive.ubuntu.com&#47;ubuntu bionic-updates&#47;universe amd64 Packages         500 http:&#47;&#47;security.ubuntu.com&#47;ubuntu bionic-security&#47;universe amd64 Packages      1:10.1.29-6 500         500 http:&#47;&#47;it.archive.ubuntu.com&#47;ubuntu bionic&#47;universe amd64 Packages      10.1.38+maria-1~xenial 500         500 http:&#47;&#47;nyc2.mirrors.digitalocean.com&#47;mariadb&#47;repo&#47;10.1&#47;ubunt&zwnj;&#8203;u xenial&#47;main amd64 Packages </code>"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1553769418, "post_id": 55380512, "comment_id": 97511174, "body": "@GiacomoIntini I think we can deduce from the output that you have installed MariaDB from (a mirror of) MariaDB&#39;s own package repositories, rather than from Ubuntu&#39;s repositories. That explains why I was unable to reproduce your problem."}, {"owner": {"reputation": 21, "user_id": 11160442, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5AA1Q.jpg?s=128&g=1", "display_name": "Giacomo Intini", "link": "https://stackoverflow.com/users/11160442/giacomo-intini"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1553773259, "post_id": 55380512, "comment_id": 97513654, "body": "@IanAbbott so do you have any solution for my problem?"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1553778143, "post_id": 55380512, "comment_id": 97516755, "body": "I think the problem is you have some mariadb packages installed from the Ubuntu main repository and some installed from the 3rd party MariaDB repository, so the package dependencies have got into a bit of a mess."}, {"owner": {"reputation": 21, "user_id": 11160442, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5AA1Q.jpg?s=128&g=1", "display_name": "Giacomo Intini", "link": "https://stackoverflow.com/users/11160442/giacomo-intini"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1553857969, "post_id": 55380512, "comment_id": 97551226, "body": "@IanAbbott the problem was that I could&#39;t install MariaDB with the simple command, <code>sudo apt-get install ibmariadbclient-dev libssl-dev</code>. And now I don&#39;t know how to solve the problem"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1553873323, "post_id": 55380512, "comment_id": 97560657, "body": "You&#39;ll need to undo the mess somehow, perhaps by attempting to fix the broken packages with <code>apt-get install -f</code>. It that doesn&#39;t work, you&#39;ll need to use a terminal GUI-based package management tool such as &quot;aptitude&quot;, or a desktop GUI-based tool such as &quot;Synaptic Package Manager&quot; to try and clean things up."}], "owner": {"reputation": 21, "user_id": 11160442, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5AA1Q.jpg?s=128&g=1", "display_name": "Giacomo Intini", "link": "https://stackoverflow.com/users/11160442/giacomo-intini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 344, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1563218863, "creation_date": 1553699323, "question_id": 55380512, "link": "https://stackoverflow.com/questions/55380512/how-to-fix-error-after-compiling-with-gcc-on-ubuntu-usr-bin-ld-cannot-find", "title": "How to fix error after compiling with GCC on ubuntu? /usr/bin/ ld: cannot find &lt;lib&gt;", "body": "<p>I'm practicing with the MySQL C API, because I need to do a project for the university. I have a problem after compiling with gcc on ubuntu.</p>\n\n<p>I'm working with MariaDB on simple example like this:</p>\n\n<pre><code>#include &lt;my_global.h&gt;\n#include &lt;mysql.h&gt;\n\nint main(int argc, char **argv)\n{\n   printf(\"MySQL client version: %s\\n\", mysql_get_client_info());\n   exit(0);\n}\n</code></pre>\n\n<p>When I compile with GCC with this command:</p>\n\n<pre><code>$ gcc version.c -o version  `mysql_config --cflags --libs`\n</code></pre>\n\n<p>I receive this error that i can't resolve:</p>\n\n<pre><code>/usr/bin/ld: cannot find -lssl\n/usr/bin/ld: cannot find -lssl\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>Can someone help me?</p>\n"}, {"tags": ["c", "linked-list", "nodes", "traversal"], "comments": [{"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1553699474, "post_id": 55380505, "comment_id": 97483299, "body": "<code>printf(&quot;List is empty.\\n&quot;);</code> ==&gt; <code>printf(&quot;List is empty.\\n&quot;); return NULL;</code>"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 2, "creation_date": 1553699524, "post_id": 55380505, "comment_id": 97483330, "body": "<code>val &gt;&gt; temp-&gt;frequency</code> Sure you want <code>&gt;&gt;</code>?"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1553699576, "post_id": 55380505, "comment_id": 97483366, "body": "You don&#39;t move <code>prev</code> inside the <code>while</code>loop. You need to do that - just like you move <code>temp</code>. Something like: <code>temp = temp-&gt;next;</code>==&gt; <code>prev = temp; temp = temp-&gt;next;</code>"}, {"owner": {"reputation": 37, "user_id": 10585679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72eb79f5d89f4bb53bf3ad1c44c8a8ad?s=128&d=identicon&r=PG&f=1", "display_name": "Ollie Parsons", "link": "https://stackoverflow.com/users/10585679/ollie-parsons"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1553699915, "post_id": 55380505, "comment_id": 97483622, "body": "@4386427 but I want prev to stay as the node just before the one with the lowest frequency. So as it keeps traversing until the end won&#39;t prev keep being moved further down as well?"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1553700111, "post_id": 55380505, "comment_id": 97483765, "body": "It will... so when you find a new lowest value you have to save the value of <code>prev</code>.  Like <code>prev_low = prev;</code> and at the end you do <code>prev_low-&gt;next = low-&gt; next;</code> BTW: You don&#39;t want <code>prev-&gt;next = temp1;</code>"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1553700392, "post_id": 55380505, "comment_id": 97483954, "body": "This <code>lowest-&gt;letter_frequency_pair = low;</code> looks very strange... but since you haven&#39;t posted the definition for <code>struct LetterFrequencyPair</code> I can&#39;t know. But it seems you save a pointer and the <code>free</code> it later on. Probably a bug"}, {"owner": {"reputation": 37, "user_id": 10585679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72eb79f5d89f4bb53bf3ad1c44c8a8ad?s=128&d=identicon&r=PG&f=1", "display_name": "Ollie Parsons", "link": "https://stackoverflow.com/users/10585679/ollie-parsons"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1553700664, "post_id": 55380505, "comment_id": 97484150, "body": "@4386427 I&#39;ll edit the question to include the structure definitions"}], "answers": [{"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 0, "last_activity_date": 1553704922, "creation_date": 1553704922, "answer_id": 55382414, "question_id": 55380505, "link": "https://stackoverflow.com/questions/55380505/freeing-the-previous-node-in-a-linked-list/55382414#55382414", "title": "Freeing the previous node in a linked-list", "body": "<blockquote>\n  <p>When I run the code, I get an error saying: \"prev is a null pointer\". However, if i remove the '= NULL' part from the node declaration, I get a compilation error that says: \"prev is uninitialized\".</p>\n</blockquote>\n\n<p>Well, yes.  Although in a couple of places you attempt to assign to <code>prev-&gt;next</code>, nowhere do you assign to <code>prev</code> itself, unless you want to count its initializer.  When that variable is <code>NULL</code>, or when it has no defined value at all, it does not point to any object.  Under those circumstances, <em>there is no <code>prev-&gt;next</code></em>.</p>\n\n<p>It looks like you want to use <code>prev</code> to track the node preceding the current minimum. That presents a bit of a problem when the head node of your list is the current minimum.  That can be worked around by setting <code>prev</code> to <code>NULL</code> in that case and writing extra code for that special case, but it's easier and cleaner to sidestep the problem by introducing an artificial predecessor:</p>\n\n<pre><code>struct LetterFrequencyPair head = { .next = root };\nstruct LetterFrequencyPair *prev = &amp;head;\n</code></pre>\n\n<p>Note that there is no need to allocate the head node dynamically.  For that matter, you should not need <em>any</em> dynamic allocations.  Presently, your code leaks the memory it allocates for <code>low</code> initially to point to, and the allocation for <code>lowest</code> and freeing of the original lowest node is wasteful.</p>\n\n<p>It is possible that the node you end up removing turns our to be the first one.  You do not need special handling for that at the point of the deletion; it should fall out naturally in that case that <code>head.next</code> is set (via <code>prev</code>) to point to the new first node.  At the end, however, you'll want to copy it back out:</p>\n\n<pre><code>root = head.next;\n</code></pre>\n\n<p>If the first node is not the one that was removed, then that assignment has no net effect.</p>\n\n<p>You have a lot of other issues with your code, well beyond the scope of the question, but that should get you started.</p>\n"}], "owner": {"reputation": 37, "user_id": 10585679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72eb79f5d89f4bb53bf3ad1c44c8a8ad?s=128&d=identicon&r=PG&f=1", "display_name": "Ollie Parsons", "link": "https://stackoverflow.com/users/10585679/ollie-parsons"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 205, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553704922, "creation_date": 1553699306, "last_edit_date": 1553700779, "question_id": 55380505, "link": "https://stackoverflow.com/questions/55380505/freeing-the-previous-node-in-a-linked-list", "title": "Freeing the previous node in a linked-list", "body": "<p>I wrote a function to traverse a linked-list, find the node with the smallest value for 'int frequency' and remove that node, once it had traversed the entire list. My error is coming from the node: 'prev'. When I run the code, I get an error saying: \"prev is a null pointer\". However, if i remove the '= NULL' part from the node declaration, I get a compilation error that says: \"prev is uninitialized\". </p>\n\n<p>Is this because I need to assign/point prev to one of the existing nodes in the list? If so how would I point it the the node prior to the one I want to delete? (I thought that was done the way it is in my code but obviously not.)</p>\n\n<p>Structure definitions:</p>\n\n<pre><code>struct LetterFrequencyPair\n{\n    char character;\n    int frequency;\n    //Creating a pointer to point to the next child in the list\n    struct BinaryTreeNode* next;\n};\n\nstruct BinaryTreeNode\n{\n    //create a pointer to point to the LetterFrequencyPair\n    struct LetterFrequencyPair* letter_frequency_pair;\n    //create pointers to the children of the node\n    struct BinaryTreeNode* leftChild;\n    struct BinaryTreeNode* rightChild;\n};\n</code></pre>\n\n<hr>\n\n<pre><code>struct BinaryTreeNode* ret_lowestF()\n{\n    int val = 1000;\n    struct LetterFrequencyPair* temp;\n    struct LetterFrequencyPair* temp1 = NULL;\n    struct LetterFrequencyPair* prev = NULL;\n    struct LetterFrequencyPair* low = malloc(sizeof(struct \n    LetterFrequencyPair));\n\n    struct BinaryTreeNode* lowest = malloc(sizeof(struct BinaryTreeNode));\n    temp = root;\n    if (temp == NULL)\n    {\n        printf(\"List is empty.\\n\");\n    }\n    else\n    {\n        while (temp != NULL)\n        {\n            printf(\"%c\\t%d\\n\", temp-&gt;character, temp-&gt;frequency);\n\n            if (val &gt;&gt; temp-&gt;frequency)\n            {\n                low = temp;\n                lowest-&gt;letter_frequency_pair = low;\n                val = low-&gt;frequency;\n                temp1 = temp;\n                prev-&gt;next = temp1;\n            }\n\n            temp = temp-&gt;next;\n        }\n    }\n    prev-&gt;next = temp1-&gt;next;\n    temp1-&gt;next = NULL;\n    free(temp1);\n\n    printf(\"lowest frequency node is: %c\\t%d\\n\", low-&gt;character, low- \n            &gt;frequency);\n\n    return lowest;\n}\n</code></pre>\n"}, {"tags": ["c"], "answers": [{"tags": [], "owner": {"reputation": 8027, "user_id": 3282436, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e17caa3e07899b69539433130de1d420?s=128&d=identicon&r=PG&f=1", "display_name": "0x5453", "link": "https://stackoverflow.com/users/3282436/0x5453"}, "is_accepted": true, "score": 4, "last_activity_date": 1553700284, "last_edit_date": 1553700284, "creation_date": 1553698157, "answer_id": 55380142, "question_id": 55380080, "link": "https://stackoverflow.com/questions/55380080/what-does-mean-before-a-macro/55380142#55380142", "title": "What does &quot;#&quot; mean before a macro?", "body": "<p>This is called <a href=\"https://gcc.gnu.org/onlinedocs/cpp/Stringizing.html\" rel=\"nofollow noreferrer\">\"stringizing\"</a>; When you add <code>#</code>, the macro will treat the argument like a string (e.g. getting the name of the thing passed in, instead of the value.)</p>\n\n<p>So for example, if you write:</p>\n\n<pre><code>const char* someString = \"abc\";\nTRACE_PRINT5(something, someString); // let's assume this is on line 10 for __LINE__\n</code></pre>\n\n<p>That should expand to:</p>\n\n<pre><code>const char* someString = \"abc\";\nfprintf(stderr, \"%s\" \"10\" \":(\" \"someString\" \"): \", \"abc\");\n</code></pre>\n\n<p>(Assuming the <code>STRGY</code> macro just converts its argument to a string.)</p>\n"}, {"tags": [], "owner": {"reputation": 2213, "user_id": 7757891, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/472798cf3c4d45c418314f837590985c?s=128&d=identicon&r=PG&f=1", "display_name": "Petar Velev", "link": "https://stackoverflow.com/users/7757891/petar-velev"}, "is_accepted": false, "score": 2, "last_activity_date": 1553698301, "creation_date": 1553698301, "answer_id": 55380192, "question_id": 55380080, "link": "https://stackoverflow.com/questions/55380080/what-does-mean-before-a-macro/55380192#55380192", "title": "What does &quot;#&quot; mean before a macro?", "body": "<p>When you put <code>#</code> before something in a macro it gets the value as string literal.</p>\n\n<p>In your case takes <code>X</code> as a string literal.\nThis means that if you pass the variable <code>age</code> with type <code>int</code> it will pass put \"age\" on the place of <code>#X</code></p>\n"}], "owner": {"reputation": 47, "user_id": 9648367, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a529837218d9397b7140e3e1b0751952?s=128&d=identicon&r=PG&f=1", "display_name": "Itra", "link": "https://stackoverflow.com/users/9648367/itra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "closed_date": 1553698393, "accepted_answer_id": 55380142, "answer_count": 2, "score": 2, "last_activity_date": 1616423019, "creation_date": 1553698036, "last_edit_date": 1616423019, "question_id": 55380080, "link": "https://stackoverflow.com/questions/55380080/what-does-mean-before-a-macro", "closed_reason": "Duplicate", "title": "What does &quot;#&quot; mean before a macro?", "body": "<p>I need some explanation on this code</p>\n\n<pre><code>#define TRACE_PRINT5 (F, X)   fprintf(stderr, \"%s\" STRGY(__LINE__) \":(\" #X \"): \", X);\n</code></pre>\n\n<p>I know what does # on beginning, but I don't understand what does on <code>\":(\" #X\"): \"</code></p>\n"}, {"tags": ["c", "linux", "mmap"], "comments": [{"owner": {"reputation": 12687, "user_id": 2809095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/705cfb2d48f12159ebae7d0275355a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Iwillnotexist Idonotexist", "link": "https://stackoverflow.com/users/2809095/iwillnotexist-idonotexist"}, "edited": false, "score": 1, "creation_date": 1553706082, "post_id": 55380054, "comment_id": 97487489, "body": "Basically, yes. See <a href=\"https://linux.die.net/man/8/vmtouch\" rel=\"nofollow noreferrer\"><code>vmtouch</code></a> for a command that does this intentionally."}, {"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "reply_to_user": {"reputation": 12687, "user_id": 2809095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/705cfb2d48f12159ebae7d0275355a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Iwillnotexist Idonotexist", "link": "https://stackoverflow.com/users/2809095/iwillnotexist-idonotexist"}, "edited": false, "score": 0, "creation_date": 1553706363, "post_id": 55380054, "comment_id": 97487648, "body": "@IwillnotexistIdonotexist Are you trying to say that other processes call <code>mmap</code> <i>unintentionally</i>?"}, {"owner": {"reputation": 12687, "user_id": 2809095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/705cfb2d48f12159ebae7d0275355a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Iwillnotexist Idonotexist", "link": "https://stackoverflow.com/users/2809095/iwillnotexist-idonotexist"}, "reply_to_user": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "edited": false, "score": 0, "creation_date": 1553706702, "post_id": 55380054, "comment_id": 97487840, "body": "@MaximEgorushkin No, I am saying that <code>vmtouch -l</code> intentionally 1) <code>open()</code>&#39;s, 2) <code>mmap()</code>s, 3) <code>mlock()</code>s and 4) &quot;goes into an infinite loop&quot;/waits indefinitely, precisely as OP described, for precisely one of the effects OP was wondering about: Allowing other processes to use this memory knowing it has been prefaulted in."}, {"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "reply_to_user": {"reputation": 12687, "user_id": 2809095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/705cfb2d48f12159ebae7d0275355a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Iwillnotexist Idonotexist", "link": "https://stackoverflow.com/users/2809095/iwillnotexist-idonotexist"}, "edited": false, "score": 0, "creation_date": 1553707073, "post_id": 55380054, "comment_id": 97488033, "body": "@IwillnotexistIdonotexist It makes sense to me now, thanks."}], "answers": [{"tags": [], "owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "is_accepted": true, "score": 2, "last_activity_date": 1553707777, "last_edit_date": 1553707777, "creation_date": 1553705583, "answer_id": 55382603, "question_id": 55380054, "link": "https://stackoverflow.com/questions/55380054/mmap-same-file-same-physical-memory/55382603#55382603", "title": "mmap same file, same physical memory?", "body": "<p>When you map a file the pages come from the kernel page cache which maintains the kernel view of the file. There is only ever one view of the same file in the kernel. When you map the file more than once (regardless from which process), the mapped pages are the very same physical pages from the kernel page cache.</p>\n\n<p>Otherwise, it would be prohibitively expensive to maintain different pages of memory in sync when one process modifies its <code>MAP_SHARED</code> file mapping.</p>\n\n<p>In other words, processes <code>A</code> and <code>B</code> together share the same <code>N</code> bytes of physical memory used to map the same file.</p>\n"}, {"tags": [], "owner": {"reputation": 5079, "user_id": 572586, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/4837f7d94d6466b2e4a6d4af3551926a?s=128&d=identicon&r=PG", "display_name": "cprogrammer", "link": "https://stackoverflow.com/users/572586/cprogrammer"}, "is_accepted": false, "score": 0, "last_activity_date": 1553706840, "creation_date": 1553706840, "answer_id": 55383002, "question_id": 55380054, "link": "https://stackoverflow.com/questions/55380054/mmap-same-file-same-physical-memory/55383002#55383002", "title": "mmap same file, same physical memory?", "body": "<p>In modern operating systems, when 2 programs map the same file, each process has its own page table for its memory, that may point to pages of physical memory shared with other user and kernel processes.</p>\n\n<p>With <code>MAP_SHARED</code>, this mapping is shared: updates to the mapping are visible to other processes that map this file, and are carried through to the underlying file. The file may not actually be updated until <code>msync</code> or <code>munmap()</code> is called.</p>\n"}], "owner": {"reputation": 58653, "user_id": 1131467, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6115f0a575cf85c444663504d5f1b3c3?s=128&d=identicon&r=PG", "display_name": "Andrew Tomazos", "link": "https://stackoverflow.com/users/1131467/andrew-tomazos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 1, "accepted_answer_id": 55382603, "answer_count": 2, "score": 1, "last_activity_date": 1553707777, "creation_date": 1553697942, "question_id": 55380054, "link": "https://stackoverflow.com/questions/55380054/mmap-same-file-same-physical-memory", "title": "mmap same file, same physical memory?", "body": "<p>Suppose I:</p>\n\n<ol>\n<li><code>open</code> a read-only file <code>F</code> of <code>N</code> byte length from a process <code>A</code></li>\n<li><code>mmap</code> its <code>fd</code> read-only (<code>PROT_READ</code>) and <code>MAP_SHARED</code></li>\n<li><code>mlock</code> the returned memory range.</li>\n<li>go into an infinite loop.</li>\n</ol>\n\n<p>My understanding is the data from the file is now resident and backed by <code>N</code> bytes of physical memory pages, due to the <code>mlock</code>.  The read performance of the memory range should be the same as normal memory allocated with, say, <code>malloc</code>.</p>\n\n<p>Now, if I create a second process <code>B</code> while the process <code>A</code> is still running and do exactly the same steps from process <code>B</code>, will the <code>N</code> bytes of physical memory pages that back the mmaped file be the same physical pages from process <code>A</code>?</p>\n\n<p>That is, will <code>A</code> and <code>B</code> together use <code>N</code> bytes of physical memory?  Or will they use <code>2*N</code> bytes of physical memory?</p>\n"}, {"tags": ["c", "gcc", "gdb", "buffer-overflow"], "answers": [{"tags": [], "owner": {"reputation": 839, "user_id": 1135979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59464968f70aff62c07a7da3a0f6ba80?s=128&d=identicon&r=PG", "display_name": "yachoor", "link": "https://stackoverflow.com/users/1135979/yachoor"}, "is_accepted": true, "score": 0, "last_activity_date": 1553700458, "last_edit_date": 1553700458, "creation_date": 1553700015, "answer_id": 55380760, "question_id": 55380031, "link": "https://stackoverflow.com/questions/55380031/certain-parts-of-injected-string-are-missing-on-stack-frame/55380760#55380760", "title": "certain parts of injected string are missing on stack frame", "body": "<p>It seems you're trying to run the program passing the payload as argument, but it contains character \\x0a which causes the payload to be split into two separate arguments.</p>\n\n<p>Adding double quotes around the command should allow you to pass it as single argument:</p>\n\n<pre><code>(gdb) run \"$(python -c 'print \"\\x41\"*252 + \"\\x60\\x0a\\x05\\x08\" + \"\\x30\\xfd\\x04\\x08\" + \"\\x64\\x79\\x09\\x08\"')\"\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 6459464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5738ca6f1aeab74b22a3e301d0c18dd1?s=128&d=identicon&r=PG&f=1", "display_name": "bibichachooo", "link": "https://stackoverflow.com/users/6459464/bibichachooo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 55380760, "answer_count": 1, "score": 0, "last_activity_date": 1553700458, "creation_date": 1553697889, "question_id": 55380031, "link": "https://stackoverflow.com/questions/55380031/certain-parts-of-injected-string-are-missing-on-stack-frame", "title": "certain parts of injected string are missing on stack frame", "body": "<p>I'm trying return-to-libc exploit on simple program. I've managed to locate\nstack address where input string is stored, and locations of libc functions and build my payload base on it.</p>\n\n<p>[padding(252-byte)] + [system(4-byte)] + [exit(4-byte)] + [argument(4-byte)]</p>\n\n<p>I opened the vulnerable program with gdb and injected payload. When I check stack frame I can see 252 byte padding loaded on correct location but the last 12-byte part of the payload seem to be missing or, somehow replace with some duds.</p>\n\n<p>So out of curiosity I changed my payload a bit, particularly the padding part.</p>\n\n<p>[padding(96)]+[system(4)]+[padding(152)]+[system(4)]+[exit(4)]+[argument(4)]</p>\n\n<p>Then the stack holds only the first 96-byte part and the rest is not there.</p>\n\n<p>I injected the payload with python on 64 bit kali-linux. The vulnerable program is compiled with <code>gcc</code> with <code>-m32</code> <code>-fno-stack-protector</code> option.</p>\n\n<p><code>(gdb) run $(python -c 'print \"\\x41\"*252 + \"\\x60\\x0a\\x05\\x08\" + \"\\x30\\xfd\\x04\\x08\" + \"\\x64\\x79\\x09\\x08\"')</code></p>\n\n<p><code>(gdb) x/256xw $ebp-0xfc\n0xffffd010: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd020: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd030: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd040: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd050: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd060: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd070: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd080: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd090: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd0a0: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd0b0: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd0c0: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd0d0: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd0e0: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd0f0: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd100: 0x41414141  0x41414141  0x41414141  0x00000060\n0xffffd110: 0xffffd130  0x080dc000  0x00000000  0x0804a25b\n0xffffd120: 0x080dc000  0x080dc000  0x080dc000  0x0804a25b\n0xffffd130: 0x00000003  0xffffd1e4  0xffffd1f4  0xffffd184\n0xffffd140: 0x00000000  0x00000000  0x00000000  0x080dc000\n...</code></p>\n\n<p><code>(gdb) run $(python -c 'print \"\\x41\"*96 +\"\\x60\\x0a\\x05\\x08\"+ \"\\x41\"*152 + \"\\x60\\x0a\\x05\\x08\" + \"\\x30\\xfd\\x04\\x08\" + \"\\x64\\x79\\x09\\x08\"')</code></p>\n\n<p><code>(gdb) x/256wx $ebp-0xfc\n0xffffd010: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd020: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd030: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd040: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd050: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd060: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffd070: 0x00000060  0x00000000  0x0000bfc0  0xa9173800\n0xffffd080: 0x080b12ef  0x00002933  0x00000000  0x080dc000\n0xffffd090: 0x00000001  0x080dc000  0x080dd900  0x080495fa\n0xffffd0a0: 0x00000004  0x080ddf74  0x0804fa99  0x00008000\n0xffffd0b0: 0x080b0fa5  0x00040000  0x00000000  0x080abc6a\n...</code></p>\n\n<p>It seems the address <code>\\x60\\x0a\\x05\\x08</code> is somehow replaced with <code>\\x60\\x00\\x00\\x00</code>. Is there something I'm missing? Or is this has to do with the compiler?</p>\n"}, {"tags": ["c", "boolean", "boolean-logic", "boolean-operations"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1553696943, "post_id": 55379634, "comment_id": 97481445, "body": "<code>(i &amp; x)</code> expressions are getting <i>non-zero</i> values while the respective <i>bits</i> in <code>i</code> are non-zero. Since these are assigned to <code>bool</code> variables, they can only have a non zero value of <code>1</code> or <code>true</code>."}], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 4178756, "user_type": "registered", "profile_image": "https://graph.facebook.com/61016443/picture?type=large", "display_name": "Dave", "link": "https://stackoverflow.com/users/4178756/dave"}, "edited": false, "score": 0, "creation_date": 1553708633, "post_id": 55380435, "comment_id": 97488878, "body": "Thank you for this, but could you perhaps expand on what is happening with the masks in relation to i value for selecting whether the LED is set to 1 or 0? Is it just looking at that single bit value for the 1, 2, or 4 within the 3 LSB, when performing the AND operation? Or is it taking all 3 LSBs into accounts? If instead of 1, 2 or 4 we replace the number with 3, so the binary is 011, and the mask now contains 2 ON values, what is happening within the code to determine whether the state is ON or OFF?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 157, "user_id": 4178756, "user_type": "registered", "profile_image": "https://graph.facebook.com/61016443/picture?type=large", "display_name": "Dave", "link": "https://stackoverflow.com/users/4178756/dave"}, "edited": false, "score": 0, "creation_date": 1553765354, "post_id": 55380435, "comment_id": 97508620, "body": "@Dave <code>(i &amp; 1)</code> means bit 0, <code>(i &amp; 2)</code> means bit 1 and <code>(i &amp; 4)</code> means bit 2. That&#39;s the whole point of bit masking. The operand <code>i</code> is of course &quot;the whole of i&quot; but the mask is just a single bit in each case. It&#39;s more common to write bit masks as hex, but it doesn&#39;t change anything in this case (0x01, 0x2, 0x04). Masking with 3 doesn&#39;t make any sense, since the purpose here is to create a binary counter."}, {"owner": {"reputation": 157, "user_id": 4178756, "user_type": "registered", "profile_image": "https://graph.facebook.com/61016443/picture?type=large", "display_name": "Dave", "link": "https://stackoverflow.com/users/4178756/dave"}, "edited": false, "score": 0, "creation_date": 1553806041, "post_id": 55380435, "comment_id": 97533744, "body": "thank you, I am aware that masking with 3 makes no sense in this case of the binary counter, but the point of my question is not the binary counter itself. The focus of my question and what I want to understand is what is happening in the (i &amp; x) part of the code, to make it either 0 or 1, this is why I ask about the case of (i &amp; 3) as this would I hope clarify it for me. What happens within the operation if two bits are 1, does the mask require both 1s to match for the &amp; to make it true or just one? If I used (i &amp; 7) would it output 1 for each 1-7 value and 0 for 0?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 157, "user_id": 4178756, "user_type": "registered", "profile_image": "https://graph.facebook.com/61016443/picture?type=large", "display_name": "Dave", "link": "https://stackoverflow.com/users/4178756/dave"}, "edited": false, "score": 0, "creation_date": 1553844421, "post_id": 55380435, "comment_id": 97544166, "body": "@Dave The whole point with this code is to mask with just 1 bit. Any non-zero result will become <code>true</code>. Study bitwise AND."}, {"owner": {"reputation": 157, "user_id": 4178756, "user_type": "registered", "profile_image": "https://graph.facebook.com/61016443/picture?type=large", "display_name": "Dave", "link": "https://stackoverflow.com/users/4178756/dave"}, "edited": false, "score": 0, "creation_date": 1553861978, "post_id": 55380435, "comment_id": 97553490, "body": "I asked the question because I was having trouble understanding the bitwise AND within this bool operation and was hoping for some clarification. Again while the point of the code is the mask, my question is not about the whole code, just this one operation within it, I had hoped this point would have be clear to readers of my question, trying to illustrate that with the (i &amp; 3), perhaps I included too much code. However from your &quot;any non-zero result will become true&quot; comment, has helped everything click into place for me, so thank you. If anything is non-zero the result is TRUE."}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": true, "score": 2, "last_activity_date": 1553699377, "last_edit_date": 1553699377, "creation_date": 1553699074, "answer_id": 55380435, "question_id": 55379634, "link": "https://stackoverflow.com/questions/55379634/bit-comparison-code-would-like-help-understanding-it/55380435#55380435", "title": "Bit comparison code, would like help understanding it", "body": "<p>Any non-zero integer assigned to a <code>bool</code> gets implicitly converted to <code>1</code>/<code>true</code>, otherwise <code>0</code>/<code>false</code>. The masks 1, 2 and 4 respectively simply refers to the 3 least significant bits of the value, binary <code>001</code>, <code>010</code>, <code>100</code>. If the masked bit is set, each expression will evaluate to <code>true</code>.</p>\n\n<p>This means that this code generates a truth table according to this:</p>\n\n<pre><code>i     LED1 LED2 LED3\n0      0    0    0\n1      1    0    0\n2      0    1    0\n3      1    1    0\n4      0    0    1\n...\n</code></pre>\n\n<p>That is, the code is simply doing a binary count-up and spreading it across 3 bool variables.</p>\n\n<p>A more conventional approach, as done in real-world embedded systems, is to route all 3 LEDs to the same port using pin 0,1,2, then simply do this:</p>\n\n<pre><code>for (int i = 0; i &lt; 8; i++)\n{\n  PORT = i;\n}\n</code></pre>\n"}], "owner": {"reputation": 157, "user_id": 4178756, "user_type": "registered", "profile_image": "https://graph.facebook.com/61016443/picture?type=large", "display_name": "Dave", "link": "https://stackoverflow.com/users/4178756/dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 55380435, "answer_count": 1, "score": 0, "last_activity_date": 1553699377, "creation_date": 1553696713, "question_id": 55379634, "link": "https://stackoverflow.com/questions/55379634/bit-comparison-code-would-like-help-understanding-it", "title": "Bit comparison code, would like help understanding it", "body": "<p>I have been looking at an example piece of code for a binary counter, I am having difficulty fully understanding what is taking place within the for loop switching each of the ledOnOffState using the bitwise operation. </p>\n\n<p>It is the (i &amp; 1), (i &amp; 2), and (i &amp; 4) that I'm having a little trouble with at the moment, for each of the i numbers counting from 0 - 7.</p>\n\n<p>I think what is happening is for each of the i decimals within the loop their binary values are being used for the operation against the binary values for the 1, 2, and 4 in the () for the ledOnOffState. But I not quite sure exactly what these parts are doing. For instance when i = 3, 011, what is happening for each of  the (3 &amp; 1), (3 &amp; 2) and (3 &amp; 4), to produce 1, 1, and 0 respectively for binary value of 011?</p>\n\n<pre><code>bool led1OnOffState; // true = 1 = ON (HIGH), false = 0 = OFF (LOW)\nbool led2OnOffState;\nbool led3OnOffState;\n\nint iterations = 2;\n\nfor (int iteration = 0; iteration &lt; iterations; iteration++)\n{\n     // a for loop that counts from 0 to 7\n    for (int i = 0; i &lt; 8; i++)\n    {\n        // check to see if the 1, 2, and 4 bits are set for the current counter number\n        led1OnOffState = (i &amp; 1); // check for binary bit value 1 = true (1) or false (0)\n        led2OnOffState = (i &amp; 2); // check for binary bit value 2\n        led3OnOffState = (i &amp; 4); // check for binary bit value 4\n\n        printf(\"The decimal %d is %d%d%d in binary\\n\", i, led3OnOffState, led2OnOffState, led1OnOffState);\n</code></pre>\n\n<p>If it is only comparing one bit for instance the 2^0 bits for the (3 &amp; 1) and the 2^1 bits for the (3 &amp; 2) and the 2^2 bits for the (3 &amp; 4) in these cases it would makes sense to me, as it results in 1, 1, 0 respectively. </p>\n\n<p>But I suspect that is not quite the case, my other thought is that perhaps it is performing 3 bitwise AND operations on each of the bits and if any of them are true it changes the ledOnOffState value to TRUE if none are true it is changed to FALSE. </p>\n\n<p>I tried the code using a ledOnOffState = (i &amp; 3) and the results led me to think the latter case may be true, as only the 0 and 4 decimal values were 0 but all other came up as 1s.</p>\n"}, {"tags": ["c", "compiler-construction", "flex-lexer", "preprocessor"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 2, "creation_date": 1553698688, "post_id": 55379559, "comment_id": 97482744, "body": "Are you sure you need to handle function-like macros, and not just object-like ones?  Supporting function-like macros <i>greatly</i> complicates the problem."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1553698938, "post_id": 55379559, "comment_id": 97482916, "body": "More generally, how much of C preprocessor semantics do you actually need to implement?  For example, the standard preprocessor performs rescanning after it makes a substitution, so as to expand macros that appear in the substituted text, yet it excludes macro identifiers from which that text has directly or indirectly been expanded, so as to not enter infinite loops.  And then there&#39;s token pasting and stringification if indeed you do support function-like macros."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 2, "creation_date": 1553699000, "post_id": 55379559, "comment_id": 97482954, "body": "Also, of course, macro names can contain at least underscores and decimal digits in addition to letters, and macro replacement text can contain much more."}, {"owner": {"reputation": 331, "user_id": 8349044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d16f2d5ee00d6d61d6087d33c6ee2e25?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky", "link": "https://stackoverflow.com/users/8349044/ricky"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1553701558, "post_id": 55379559, "comment_id": 97484717, "body": "@JohnBollinger how will I handle just object kind of macros?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1553702615, "post_id": 55379559, "comment_id": 97485436, "body": "If you do not need to perform rescanning, then an approach along the lines you&#39;re currently attempting can work, but it would probably be more efficient to use a hash table rather than a flat array to store macro names and their definitions.  Then when you are not in macro-definition-scanning mode, you&#39;ll need to check each token against your table, whatever form that takes, to determine whether to output the token itself or some corresponding (and possibly empty) macro replacement text."}, {"owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "edited": false, "score": 4, "creation_date": 1553703348, "post_id": 55379559, "comment_id": 97485915, "body": "Phew.., if you are on the way to build a macro parser with lex, please refrain. Lex is really a nice <i>lexer</i> or <i>tokenizer</i>, but it is intended to be used with its companion syntactic parser which is <code>yacc</code> or <code>bison</code>. Read again tutorials on parsing with <b>both</b> lex and yacc. Here lex should only identify <code>#define</code> on start of line, <code>square</code> and <code>x</code> as identifiers, and parens and operators as what they are. Then the grammar should be handled by yacc or bison. There are 2 tools for the lexical and syntactic part for a reason."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 1, "creation_date": 1553709905, "post_id": 55379559, "comment_id": 97489550, "body": "If your intent is to write a C preprocessor (that is, a preprocessor which works as specified by the C language), you should take a look at <a href=\"https://gcc.gnu.org/onlinedocs/cppinternals/Macro-Expansion.html\" rel=\"nofollow noreferrer\">these GCC implementation notes</a>. But take account of the second paragraph! If you don&#39;t understand in detail how it is supposed to work, you are unlikely to write a correct implementation."}], "owner": {"reputation": 331, "user_id": 8349044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d16f2d5ee00d6d61d6087d33c6ee2e25?s=128&d=identicon&r=PG&f=1", "display_name": "Ricky", "link": "https://stackoverflow.com/users/8349044/ricky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 523, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1553702544, "creation_date": 1553696537, "last_edit_date": 1553702544, "question_id": 55379559, "link": "https://stackoverflow.com/questions/55379559/building-a-macro-preprocessor-using-flex", "title": "Building a macro preprocessor using flex", "body": "<p>I am just trying to write a flex code which will read a C file and write it another file after expanding the macros. My idea is to store the macro definitions declared at the beginning of the program in an array of (key,value) pair. So the regular expression for detecting the macro definitions can be (as of now, only consider #define statements):</p>\n\n<pre><code>%x DEFINE\n%x DEFINE2\n\"#define\" {BEGIN DEFINE};\n&lt;DEFINE&gt;[a-zA-Z]+ {/* key = yytext*/}\n&lt;DEFINE&gt;[ ] { BEGIN DEFINE2;/* begin the second state when a whitespace is encountered, it means the second part of the definition*/}\n&lt;DEFINE2&gt;[a-zA-Z]+ { /* arr[key] = yytext; (storing the key value pair) */}\n&lt;DEFINE2&gt; [ \\t\\n]+ {BEGIN INITIAL;}\n</code></pre>\n\n<p>The expressions are self explanatory. The main challenge that I am facing while expanding macros is detecting the occurrence of a macro key that we stored in these statements. How to handle macro statements of this kind?:</p>\n\n<pre><code>#define square(x) ((x)*(x))\n...\nint a,b = 4;\na = square(b);\n</code></pre>\n\n<p>The best way could be, adding new regular expression to the flex specification whenever a <code>#define</code> statement is encountered. But I don't think that is possible.\n<strong>So, is there any solution for expanding macros efficiently? How is it done in practice?</strong></p>\n"}, {"tags": ["c", "file", "printf", "fopen"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 3, "creation_date": 1553696228, "post_id": 55379407, "comment_id": 97480973, "body": "One really, really bad side effect of stuffing way too much code into one line is not being able to debug it when it doesn&#39;t work...."}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 4, "creation_date": 1553696236, "post_id": 55379407, "comment_id": 97480981, "body": "That&#39;s because the second parameter is a <code>size_t</code> and not a string. Check the documentation of the function here <a href=\"http://www.cplusplus.com/reference/cstdio/snprintf/\" rel=\"nofollow noreferrer\">cplusplus.com/reference/cstdio/snprintf</a> and fix your function call accordingly."}, {"owner": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "reply_to_user": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 5, "creation_date": 1553696438, "post_id": 55379407, "comment_id": 97481128, "body": "@Blaze ...and because <code>snprintf</code> returns <code>int</code>, while <code>fopen</code> accepts <code>const char *</code> as its first argument."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1553696931, "post_id": 55379407, "comment_id": 97481438, "body": "What filenames do you want to create? You have a filename including extension and add <code>&quot;: .txt&quot;</code> to it"}, {"owner": {"reputation": 111, "user_id": 10101999, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pl3qk8GrXWE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qlnwZBhFZgnLt-IVbl-NOzKF6YtQ/mo/photo.jpg?sz=128", "display_name": "Joseph Smith", "link": "https://stackoverflow.com/users/10101999/joseph-smith"}, "reply_to_user": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1553697183, "post_id": 55379407, "comment_id": 97481599, "body": "@Gerhardh just a .txt file but removing the original file extension is a problem for another time haha."}, {"owner": {"reputation": 111, "user_id": 10101999, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pl3qk8GrXWE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qlnwZBhFZgnLt-IVbl-NOzKF6YtQ/mo/photo.jpg?sz=128", "display_name": "Joseph Smith", "link": "https://stackoverflow.com/users/10101999/joseph-smith"}, "reply_to_user": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 0, "creation_date": 1553697299, "post_id": 55379407, "comment_id": 97481689, "body": "@Blaze &amp; StaceyGirl much appreciated, thank you"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1553697318, "post_id": 55379407, "comment_id": 97481704, "body": "OK. But what file names do you want to create? Is <code>&quot;&#47;home&#47;user&#47;Documents&#47;_Hash: picture1.jpg: .txt</code>&quot; what you want?"}, {"owner": {"reputation": 111, "user_id": 10101999, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pl3qk8GrXWE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qlnwZBhFZgnLt-IVbl-NOzKF6YtQ/mo/photo.jpg?sz=128", "display_name": "Joseph Smith", "link": "https://stackoverflow.com/users/10101999/joseph-smith"}, "reply_to_user": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1553698387, "post_id": 55379407, "comment_id": 97482497, "body": "@Gerhardh oh sorry. The file name I would like is (for example in the case of picture1.jpg) picture1.txt (I wish all to have the .txt extension). The file names will change due to event-name changing, therefore not all will be called the same thing of course."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1553698480, "post_id": 55379407, "comment_id": 97482579, "body": "Then the colons and spaces and the prefix path are not intented? You should use <code>snprintf</code> in a separate line first and check what filename you actually create before you try to open it."}], "answers": [{"tags": [], "owner": {"reputation": 109324, "user_id": 21926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6e61d47f9a6ec0a7a286835e51f3332?s=128&d=identicon&r=PG", "display_name": "Sean Bright", "link": "https://stackoverflow.com/users/21926/sean-bright"}, "is_accepted": true, "score": 1, "last_activity_date": 1553704386, "last_edit_date": 1553704386, "creation_date": 1553703756, "answer_id": 55382037, "question_id": 55379407, "link": "https://stackoverflow.com/questions/55379407/fopen-through-snprintf/55382037#55382037", "title": "fopen through snprintf", "body": "<p>So there are a few problems with your code as evidenced by all of the comments.</p>\n\n<p>For now we'll skip the <a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/functions/fopen.html\" rel=\"nofollow noreferrer\"><code>fopen</code></a> and focus on the <a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/functions/snprintf.html\" rel=\"nofollow noreferrer\"><code>snprintf</code></a>. <code>snprintf</code> is just like <code>printf</code> except there are two additional arguments that you need to pass first, a <code>char *</code> indicating where to store the rendered character data, and a <code>size_t</code> that indicates how much space is available at the <code>char *</code>. The idiomatic way to do this (assuming a <code>char[]</code> is the destination) is to use <code>sizeof()</code> like this:</p>\n\n<pre><code>int res = snprintf(fileDir, sizeof(fileDir), /* Other arguments omitted */);\n</code></pre>\n\n<p><code>snprintf</code> returns the number of characters that were printed (as an <code>int</code>). If that number is greater than or equal to <code>sizeof(fileDir)</code> then whatever is in <code>fileDir</code> will be truncated (but will always be <code>NULL</code> terminated).</p>\n\n<pre><code>if (res &gt;= sizeof(fileDir)) {\n    /* fileDir contains an incomplete path, handle this as an error */\n}\n</code></pre>\n\n<p>Finally, because the return value of <code>snprintf</code> is an <code>int</code>, you can't pass that as the first argument to <code>fopen</code> because that expects the first argument to be a <code>const char *</code>. So these need to be separate steps.</p>\n\n<p>Having said all of this, the way that you are building the path appears to be incorrect as well. In the full example below, I have fixed it:</p>\n\n<pre><code>FILE *ftest2;\n\nint res = snprintf(fileDir, sizeof(fileDir), \"%s/%s.txt\", hashDirectory, event-&gt;name);\nif (res &gt;= sizeof(fileDir)) {\n    fprintf(stderr, \"The pathname was truncated. Cannot proceed.\\n\");\n    return -1;\n}\n\nftest2 = fopen(fileDir, \"wt\");\nif (!ftest2) {\n    fprintf(stderr, \"Failed to open `%s': %s\\n\", fileDir, strerror(errno));\n    return -1;\n}\n\n/* Rest of your code */\n</code></pre>\n\n<p>An important note, if the first argument to <code>snprintf</code> was a a pointer to dynamically allocated memory (i.e. from <code>malloc</code>), you wouldn't be able to use <code>sizeof()</code> and instead would need to pass the size of the dynamically allocated region explicitly. <code>sizeof()</code> is evaulated at compile time (ignoring <a href=\"https://en.wikipedia.org/wiki/Variable-length_array\" rel=\"nofollow noreferrer\">VLAs</a>), not at runtime.</p>\n\n<p><em>(You'll need to <code>#include</code> <code>string.h</code> and <code>errno.h</code> for the <code>strerror()</code> call to work if you want to use that part)</em></p>\n"}], "owner": {"reputation": 111, "user_id": 10101999, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pl3qk8GrXWE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qlnwZBhFZgnLt-IVbl-NOzKF6YtQ/mo/photo.jpg?sz=128", "display_name": "Joseph Smith", "link": "https://stackoverflow.com/users/10101999/joseph-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 55382037, "answer_count": 1, "score": 0, "last_activity_date": 1553704386, "creation_date": 1553696089, "last_edit_date": 1553696539, "question_id": 55379407, "link": "https://stackoverflow.com/questions/55379407/fopen-through-snprintf", "title": "fopen through snprintf", "body": "<p>I'm having issues compiling my program that otherwise works fine, however, whilst trying to condense <code>strcpy</code> &amp; <code>strcat</code> into <code>snprintf</code> (to remove unnecessary lines of code), upon compiling the warning</p>\n\n<blockquote>\n  <p>passing argument 2 of \u2018snprintf\u2019 makes integer from pointer without a cast</p>\n</blockquote>\n\n<p>presents itself. I've tried searching around for others with this problem, however once adapted their solutions appear to not work with my code </p>\n\n<p><code>fileDir</code> is defined at start of program as: <code>char fileDir[1000];</code></p>\n\n<p><code>event-&gt;name</code> is the name of a file (and its extension), e.g. picture1.jpg.</p>\n\n<p><code>hashDirectory</code> is <code>\"/home/user/Documents/_Hash\"</code>.</p>\n\n<pre><code>FILE *ftest2=fopen(snprintf(fileDir, \"%s: %s: %s\", hashDirectory, event-&gt;name, \".txt\"), \"wt\");\n</code></pre>\n\n<p>I can open the file however that is only when I use <code>strcpy</code> and <code>strcat</code> - which is what I'm trying to get rid of.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 1, "creation_date": 1553695260, "post_id": 55378963, "comment_id": 97480316, "body": "There is probably padding in the struct that you are not accounting for."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1553698076, "post_id": 55378963, "comment_id": 97482265, "body": "as @JohnnyMopp says you do not compute well the offset because of the padding (<i>holes</i> between fields in the struct), the answers give you several ways to correct that"}], "answers": [{"comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1553695593, "post_id": 55379119, "comment_id": 97480549, "body": "Well spotted bug!"}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1553695646, "post_id": 55379119, "comment_id": 97480582, "body": "Now formally you should also do error checking on the fseeks and fwrite."}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": false, "score": 4, "last_activity_date": 1553698493, "last_edit_date": 1553698493, "creation_date": 1553695309, "answer_id": 55379119, "question_id": 55378963, "link": "https://stackoverflow.com/questions/55378963/why-is-it-wrong-to-use-the-c-to-modify-the-double-of-a-binary-file/55379119#55379119", "title": "Why is it wrong to use the C to modify the double of a binary file?", "body": "<p>You read a full <em>logData</em> you can modify the read element then write all of it, probably you have padding problem so the computed offset is wrong</p>\n\n<pre><code>bool update(FILE* fp, int n){\n    struct logData thisLogData;\n\n    if ((fseek(fp,(n-1)*size, SEEK_SET) == -1) ||\n        (fread(&amp;thisLogData,size,1,fp) == 1)) {\n      ??? indicate error ???\n      fclose(fp);\n      return false;\n    }\n    if (scanf(\"%lf\", &amp;thisLogData.charge) != 1) {\n      ??? indicate error ???\n      fclose(fp);\n      return false;\n    }\n    fseek(fp,(n-1)*size, SEEK_SET);\n\n    return ((fwrite(&amp;thisLogData,size,1,fp) != -1)\n            &amp; (fclose(fp) != -1); /* not &amp;&amp; because have to close in all cases */\n}\n</code></pre>\n\n<p>else use <em>offsetof</em> to only write the new value of <em>charge</em> without reading the element :</p>\n\n<pre><code>bool update(FILE* fp, int n){\n    double d;\n\n    if (scanf(\"%lf\", &amp;d) != 1) {\n      ??? indicate error ???\n      fclose(fp);\n      return false;\n    }\n\n    if (fseek(fp,(n-1)*size + offsetof(struct logData, charge), SEEK_SET) == -1) {\n      ??? indicate wrong n / file ???\n      fclose(fp);\n      return false;\n    }\n\n    return ((fwrite(&amp;d,sizeof(double),1,fp) != -1) \n            &amp; (fclose(fp) != -1)); /* not &amp;&amp; because have to close in all cases */\n}\n</code></pre>\n\n<hr>\n\n<p>Note : it is strange the function has to close the file but do not open it, it is more logical to not do the close here</p>\n"}, {"tags": [], "owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "is_accepted": true, "score": 4, "last_activity_date": 1553695377, "creation_date": 1553695377, "answer_id": 55379146, "question_id": 55378963, "link": "https://stackoverflow.com/questions/55378963/why-is-it-wrong-to-use-the-c-to-modify-the-double-of-a-binary-file/55379146#55379146", "title": "Why is it wrong to use the C to modify the double of a binary file?", "body": "<pre><code>long offset = sizeof(thisLogData.logId)+sizeof(thisLogData.logNote)+ sizeof(thisLogData.logDate);\n</code></pre>\n\n<p>This is not the offset of the member. Structure members have padding. Use <code>offsetof</code>.</p>\n\n<pre><code>size_t offset = offsetof(struct logData, charge);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12501, "user_id": 2038768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8a5649dd767843ed7a69851ea5cbaf6?s=128&d=identicon&r=PG", "display_name": "Mikhail Vladimirov", "link": "https://stackoverflow.com/users/2038768/mikhail-vladimirov"}, "is_accepted": false, "score": 1, "last_activity_date": 1553697335, "last_edit_date": 1553697335, "creation_date": 1553695643, "answer_id": 55379249, "question_id": 55378963, "link": "https://stackoverflow.com/questions/55378963/why-is-it-wrong-to-use-the-c-to-modify-the-double-of-a-binary-file/55379249#55379249", "title": "Why is it wrong to use the C to modify the double of a binary file?", "body": "<p>You should use <code>offsetof</code> to find out offset of a field within structure:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include&lt;stddef.h&gt;\n\nlong offset = offsetof(struct logData, charge);    \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 1, "last_activity_date": 1553695768, "creation_date": 1553695768, "answer_id": 55379299, "question_id": 55378963, "link": "https://stackoverflow.com/questions/55378963/why-is-it-wrong-to-use-the-c-to-modify-the-double-of-a-binary-file/55379299#55379299", "title": "Why is it wrong to use the C to modify the double of a binary file?", "body": "<blockquote>\n  <p>I wrote a function that reads the double value in the struct in the binary file, and computes the value, and then writes the computed double value into the binary file.</p>\n</blockquote>\n\n<p>Note that binary files are inherently non-portable.  If you're manipulating a file that was created on the same machine, by another C program built by the same C implementation, then you should be OK, but otherwise both writer and reader need to pay a great deal of attention to binary compatibility concerns.</p>\n\n<p>Even in that case, however, your code is making unsafe assumptions.  The offset of a structure member (other than the first) is not guaranteed to be the same as the sum of the sizes of the preceding members.  Structures may, and often do, contain padding between members and after the last member, and that will throw your computation off.</p>\n\n<p>Although it is possible to compute the offset of a structure member, including in old C versions that do not have <code>offsetof()</code>, in this case I would recommend sidestepping the issue altogether by writing the whole structure back to the file, instead of just a single member:</p>\n\n<pre><code>    fseek(fp, -size, SEEK_CUR);\n    fwrite(&amp;thisLogData, size, 1, fp);\n</code></pre>\n"}], "owner": {"reputation": 340, "user_id": 8244229, "user_type": "registered", "profile_image": "https://graph.facebook.com/1999300453632717/picture?type=large", "display_name": "lyzMaster", "link": "https://stackoverflow.com/users/8244229/lyzmaster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 55379146, "answer_count": 4, "score": 0, "last_activity_date": 1553698493, "creation_date": 1553694883, "question_id": 55378963, "link": "https://stackoverflow.com/questions/55378963/why-is-it-wrong-to-use-the-c-to-modify-the-double-of-a-binary-file", "title": "Why is it wrong to use the C to modify the double of a binary file?", "body": "<p>I wrote a function that reads the double value in the struct in the binary file, and computes the value, and then writes the computed double value into the binary file. </p>\n\n<p>the struct is:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>struct logData{\n    long logId; \n    char logDate[11]; \n    char logNote[20];  \n    double charge;   \n    double total;    \n};\n</code></pre>\n\n<p>The function to read and modify the data <code>charge</code> is\uff1a</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>long size = sizeof(struct logData);\n\nvoid update(FILE* fp, int n){\n    fseek(fp,(n-1)*size, SEEK_SET);\n    struct logData thisLogData;\n    fread(&amp;thisLogData,size,1,fp);\n\n    long offset = sizeof(thisLogData.logId)+sizeof(thisLogData.logNote)+ sizeof(thisLogData.logDate);\n    double oldCharge = thisLogData.charge;\n    scanf(\"%lf\", &amp;thisLogData.charge);\n    fseek(fp, -size+offset, SEEK_CUR);\n    fwrite(&amp;thisLogData.charge, sizeof(thisLogData.charge), 1, fp);\n    fclose(fp);\n}\n</code></pre>\n\n<p>Lots of the struct:<code>logData</code> are stored in the binary file. The parameter:<code>n</code> represents the position of <code>logData</code>.</p>\n\n<p>I successfully read out the previous value of <code>charge</code>(<code>oldCharge</code> in function <code>update()</code>). The initial value of charge is 20, I enter 40 in the <code>update</code> function. After successfully writing, I read the value of the <code>charge</code> and found that it is neither 20 nor 40 but a strange 32.55 (I kept two decimals).</p>\n\n<p>I tried to modify <code>logDate</code> and <code>logNote</code> can be successfully modified (of course <code>offset</code> is different). Only the double value <code>charge</code> and <code>total</code> will have strange results.</p>\n\n<p>What is the reason?</p>\n"}, {"tags": ["c", "avl-tree"], "comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1553694369, "post_id": 55378687, "comment_id": 97479644, "body": "<code>node = newNode;</code> will not work. You need a double pointer, <code>struct AVLTreeNode **node</code>"}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1553694435, "post_id": 55378687, "comment_id": 97479694, "body": "<code>insert_in_tree</code> is recursive but on <i>every</i> call you <code>malloc</code> a new node. That is a big memory leak!"}], "answers": [{"comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1553694473, "post_id": 55378791, "comment_id": 97479730, "body": "Note the memory leak as in my comment."}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1553694611, "post_id": 55378791, "comment_id": 97479838, "body": "...so simply do <code>*node = newAVLTreeNode(key, value);</code>"}, {"owner": {"reputation": 61, "user_id": 4925987, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wSAESVBSoJQ/AAAAAAAAAAI/AAAAAAAABQc/udfCkTp02oc/photo.jpg?sz=128", "display_name": "Akhil Jain", "link": "https://stackoverflow.com/users/4925987/akhil-jain"}, "edited": false, "score": 0, "creation_date": 1553694772, "post_id": 55378791, "comment_id": 97479955, "body": "Updated the code but my Xcode editor gives an error on both the else if conditions as: &quot;Member reference base type &#39;struct AVLTreeNode *&#39; is not a structure or union&quot;."}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1553694809, "post_id": 55378791, "comment_id": 97479981, "body": "Yeah, you need to <code>if(key&gt;(*node)-&gt;key)...</code>"}, {"owner": {"reputation": 61, "user_id": 4925987, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wSAESVBSoJQ/AAAAAAAAAAI/AAAAAAAABQc/udfCkTp02oc/photo.jpg?sz=128", "display_name": "Akhil Jain", "link": "https://stackoverflow.com/users/4925987/akhil-jain"}, "edited": false, "score": 0, "creation_date": 1553695200, "post_id": 55378791, "comment_id": 97480264, "body": "I will handle the balancing in the tree to make it avl once it is created."}, {"owner": {"reputation": 61, "user_id": 4925987, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wSAESVBSoJQ/AAAAAAAAAAI/AAAAAAAABQc/udfCkTp02oc/photo.jpg?sz=128", "display_name": "Akhil Jain", "link": "https://stackoverflow.com/users/4925987/akhil-jain"}, "edited": false, "score": 0, "creation_date": 1553695266, "post_id": 55378791, "comment_id": 97480320, "body": "the build failed on the base case with the changes suggested."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 61, "user_id": 4925987, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wSAESVBSoJQ/AAAAAAAAAAI/AAAAAAAABQc/udfCkTp02oc/photo.jpg?sz=128", "display_name": "Akhil Jain", "link": "https://stackoverflow.com/users/4925987/akhil-jain"}, "edited": false, "score": 0, "creation_date": 1553697790, "post_id": 55378791, "comment_id": 97482054, "body": "@AkhilJain of course you need to change the calls of <code>insert_in_tree</code> to give the address so <code>insert_in_tree(k, v, head);</code> must be <code>insert_in_tree(k, v, &amp;head);</code>, did you ?"}, {"owner": {"reputation": 61, "user_id": 4925987, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wSAESVBSoJQ/AAAAAAAAAAI/AAAAAAAABQc/udfCkTp02oc/photo.jpg?sz=128", "display_name": "Akhil Jain", "link": "https://stackoverflow.com/users/4925987/akhil-jain"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553698541, "post_id": 55378791, "comment_id": 97482625, "body": "@bruno Yes, i did, but the tree is still null. Although while debugging, all the nodes are being properly formed. I think the problem is that the root of the tree is not pointing to the head. What do you think ? Added the screenshot for reference."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 61, "user_id": 4925987, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wSAESVBSoJQ/AAAAAAAAAAI/AAAAAAAABQc/udfCkTp02oc/photo.jpg?sz=128", "display_name": "Akhil Jain", "link": "https://stackoverflow.com/users/4925987/akhil-jain"}, "edited": false, "score": 0, "creation_date": 1553705257, "post_id": 55378791, "comment_id": 97487059, "body": "@AkhilJain you still have a simple error, I added an answer to solve"}], "tags": [], "owner": {"reputation": 12501, "user_id": 2038768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8a5649dd767843ed7a69851ea5cbaf6?s=128&d=identicon&r=PG", "display_name": "Mikhail Vladimirov", "link": "https://stackoverflow.com/users/2038768/mikhail-vladimirov"}, "is_accepted": false, "score": 1, "last_activity_date": 1553694839, "last_edit_date": 1553694839, "creation_date": 1553694435, "answer_id": 55378791, "question_id": 55378687, "link": "https://stackoverflow.com/questions/55378687/while-inserting-key-value-in-a-tree-the-node-doesnt-form-a-tree-structure/55378791#55378791", "title": "While inserting (key, value) in a tree, the node doesnt form a tree structure", "body": "<p>In function <code>insert_in_tree</code> you are trying to modify parameter that was passed by value.  You need to pass is by reference like this:</p>\n\n<pre><code>void insert_in_tree(int key, int value, struct AVLTreeNode **node){\n    // if the tree is empty\n    if(*node == NULL){\n        *node = newAVLTreeNode(key, value);\n    }\n    // insert on left if the data in the key is less than the data in the node.\n    else if (key&lt;(*node)-&gt;key){\n        insert_in_tree(key,value,&amp;(*node)-&gt;left);\n    }\n    // insert on right if the data in the key is greater than the data in the node.\n    else if(key&gt;(*node)-&gt;key)\n    {\n        insert_in_tree(key,value,&amp;(*node)-&gt;right);\n    }\n}\n</code></pre>\n\n<p>Also, in case <code>node != NULL</code> this function leads to a memory leak, because it allocates new node but does not save pointer to it anywhere.</p>\n\n<p>BTW, what you are trying to create is not AVL tree, but rather <a href=\"https://en.wikipedia.org/wiki/Binary_search_tree\" rel=\"nofollow noreferrer\">binary search tree</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "is_accepted": false, "score": 2, "last_activity_date": 1553694936, "creation_date": 1553694936, "answer_id": 55378980, "question_id": 55378687, "link": "https://stackoverflow.com/questions/55378687/while-inserting-key-value-in-a-tree-the-node-doesnt-form-a-tree-structure/55378980#55378980", "title": "While inserting (key, value) in a tree, the node doesnt form a tree structure", "body": "<p>Mikhail was nearly there but didn't spot the memory leak. I correct that below:</p>\n\n<pre><code>void insert_in_tree(int key, int value, struct AVLTreeNode **node){\n    // if the tree is empty\n    if(*node == NULL){\n        *node = newAVLTreeNode(key, value);\n    }\n    // insert on left if the data in the key is less than the data in the node.\n    else if (key&lt;(*node)-&gt;key){\n        insert_in_tree(key,value,&amp;(*node)-&gt;left);\n    }\n    // insert on right if the data in the key is greater than the data in the node.\n    else if(key&gt;(*node)-&gt;key)\n    {\n        insert_in_tree(key,value,&amp;(*node)-&gt;right);\n    }\n}\n</code></pre>\n\n<p>As a summary of fixes:</p>\n\n<ul>\n<li><p>you needed to pass a pointer to the place where to put the newly allocated node because C passes by value. That is called a \"double pointer\".</p></li>\n<li><p>you allocated memory on every recursive call but you only needed to that once you know where to insert.</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 0, "last_activity_date": 1553707679, "last_edit_date": 1553707679, "creation_date": 1553704468, "answer_id": 55382258, "question_id": 55378687, "link": "https://stackoverflow.com/questions/55378687/while-inserting-key-value-in-a-tree-the-node-doesnt-form-a-tree-structure/55382258#55382258", "title": "While inserting (key, value) in a tree, the node doesnt form a tree structure", "body": "<p>more the correction already described in the answers :</p>\n\n<pre><code>void insert_in_tree(int key, int value, struct AVLTreeNode **node){\n    // if the tree is empty\n    if(*node == NULL){\n        *node = newAVLTreeNode(key, value);\n    }\n    // insert on left if the data in the key is less than the data in the node.\n    else if (key&lt;(*node)-&gt;key){\n        insert_in_tree(key,value,&amp;(*node)-&gt;left);\n    }\n    // insert on right if the data in the key is greater than the data in the node.\n    else if(key&gt;(*node)-&gt;key)\n    {\n        insert_in_tree(key,value,&amp;(*node)-&gt;right);\n    }\n}\n</code></pre>\n\n<p>in <em>CreateAVLTree</em> you (now) set the tree of <em>node</em> into <em>head</em> but you missed to update <code>tree-&gt;root</code>, an easy way is to not use the temporary var <em>head</em> but to use <code>tree-&gt;root</code> directly :</p>\n\n<pre><code>AVLTree *CreateAVLTree(const char *filename)\n{\n    //Inititalising a new tree\n    AVLTree *tree = newAVLTree();\n    // initialising the head to root of tree i.e. null\n    int key, value;\n    FILE* file = fopen(filename, \"r\"); // open a file\n    if(file == NULL) {\n        return NULL;                                   // error checking\n    }\n    while (fscanf (file, \" (%d,%d)\", &amp;key, &amp;value) == 2)  // check for number of conversions\n    //  space added  here ^\n    {\n        insert_in_tree(key, value, &amp;tree-&gt;root);\n        //printf(\"%d,%d\\n\", key, value);\n    }\n\n    fclose(file);\n\n    return tree;\n}\n</code></pre>\n\n<p>I also replaced the invalid <code>return 1;</code> by <code>return NULL;</code> when the file cannot be open.</p>\n\n<p>Note the field <em>size</em> is not set, perhaps it must contains the size of the node list, in that case just add <code>tree-&gt;size += 1;</code> near the call of <code>insert_in_tree</code></p>\n\n<p>If I add definitions to print the result :</p>\n\n<pre><code>void PrintNodes(struct AVLTreeNode * l)\n{\n  if (l == NULL)\n    printf(\"()\");\n  else {\n    putchar('(');\n    PrintNodes(l-&gt;left);\n    printf(\" %d %d %d \", l-&gt;key, l-&gt;value, l-&gt;height);\n    PrintNodes(l-&gt;right);\n    putchar(')');\n  }\n}\n\nvoid PrintAVLTree(AVLTree * tree)\n{\n  printf(\"%d elements : \", tree-&gt;size);\n  PrintNodes(tree-&gt;root);\n  putchar('\\n');\n}\n</code></pre>\n\n<p>and put <code>PrintAVLTree(tree1);</code> out of comment in <em>main</em>, compilation and execution :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ gcc -g -pedantic -Wextra -Wall t.c\npi@raspberrypi:/tmp $ cat File1.txt \n(2, 50) (4, 30) (9, 30) (10, 400) (-5, -40)\n(7, 20) (19, 200) (20, 50) (-18, -200) (-2, 29)\n(2, 67) (4, 35) (9, 45) (-18, 100)\npi@raspberrypi:/tmp $ ./a.out\n14 elements : (((() -18 -200 0 ()) -5 -40 0 (() -2 29 0 ())) 2 50 0 (() 4 30 0 ((() 7 20 0 ()) 9 30 0 (() 10 400 0 (() 19 200 0 (() 20 50 0 ()))))))\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 4925987, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wSAESVBSoJQ/AAAAAAAAAAI/AAAAAAAABQc/udfCkTp02oc/photo.jpg?sz=128", "display_name": "Akhil Jain", "link": "https://stackoverflow.com/users/4925987/akhil-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 55382258, "answer_count": 3, "score": 0, "last_activity_date": 1553707679, "creation_date": 1553694107, "last_edit_date": 1553699127, "question_id": 55378687, "link": "https://stackoverflow.com/questions/55378687/while-inserting-key-value-in-a-tree-the-node-doesnt-form-a-tree-structure", "title": "While inserting (key, value) in a tree, the node doesnt form a tree structure", "body": "<p>I am trying to create avl tree which reads (key, value) pair one by one from the file and forms the tree based on the data of the key.</p>\n\n<p>First, to read the tuples into key and value and passed them to the create function where I have initialized a tree with the structure</p>\n\n<pre><code>typedef struct AVLTree{\n    int  size;      // count of items in avl tree\n    AVLTreeNode *root; // root\n} AVLTree;\n\nAVLTree *newAVLTree()\n{\n    AVLTree *T;\n    T = malloc(sizeof (AVLTree));\n    assert (T != NULL);\n    T-&gt;size = 0;\n    T-&gt;root = NULL;\n    return T;\n}\n</code></pre>\n\n<p>then i assign the value of the root of the tree which is NULL,initially, to the AVLTreeNode whose structure looks like this:</p>\n\n<pre><code>typedef struct AVLTreeNode {\n    int key; //key of this item\n    int  value;  //value (int) of this item\n    int height; //height of the subtree rooted at this node\n    struct AVLTreeNode *parent; //pointer to parent\n    struct AVLTreeNode *left; //pointer to left child\n    struct AVLTreeNode *right; //pointer to right child\n} AVLTreeNode;\n\n//data type for AVL trees\ntypedef struct AVLTree{\n    int  size;      // count of items in avl tree\n    AVLTreeNode *root; // root\n} AVLTree;\n\n// create a new AVLTreeNode\nAVLTreeNode *newAVLTreeNode(int k, int v )\n{\n    AVLTreeNode *new;\n    new = malloc(sizeof(AVLTreeNode));\n    assert(new != NULL);\n    new-&gt;key = k;\n    new-&gt;value = v;\n    new-&gt;height = 0; // height of this new node is set to 0\n    new-&gt;left = NULL; // this node has no child\n    new-&gt;right = NULL;\n    new-&gt;parent = NULL; // no parent\n    return new;\n}\n</code></pre>\n\n<p>Now, for every key, value pair that i read from the file, i pass it into the create function and check 3 conditions as following:</p>\n\n<pre><code>void insert_in_tree(int key, int value, struct AVLTreeNode **node){\n\n\n    // if the tree is empty\n    if(*node == NULL){\n        node = newNode;\n    }\n    // insert on left if the data in the key is less than the data in the node.\n    else if (key&lt;(*node)-&gt;key){\n        insert_in_tree(key,value,&amp;(*node)-&gt;left);\n    }\n    // insert on right if the data in the key is greater than the data in the node.\n    else if(key&gt;(*node)-&gt;key)\n    {\n        insert_in_tree(key,value,&amp;(*node)-&gt;right);\n    }\n\n}\n</code></pre>\n\n<p>PS: Dont worry about the 'value' part in the newAVLTreeNode as i'll be handling duplicates later using that.</p>\n\n<p>With the above code, i expected the tree to be formed but that didnt happen. Upon further investigation and debuggin, i found that \nwhile insert_in_tree is passed with new key and value, the node is also new instead of the one already created.</p>\n\n<pre><code>AVLTree *CreateAVLTree(const char *filename)\n{\n    //Inititalising a new tree\n    AVLTree *tree = newAVLTree();\n// initialising the head to root of tree i.e. null\n    AVLTreeNode *head = tree-&gt;root;\n    int key, value;\n    FILE* file = fopen(filename, \"r\"); // open a file\n    if(file == NULL) {\n        return 1;                                   // error checking\n    }\n    while (fscanf (file, \" (%d,%d)\", &amp;key, &amp;value) == 2)  // check for number of conversions\n    //  space added  here ^\n    {\n        insert_in_tree(key, value, &amp;head);\n        //printf(\"%d,%d\\n\", key, value);\n    }\n    fclose(file);\n\n    return tree;\n}\n</code></pre>\n\n<pre><code>int main() //sample main for testing\n{\n    AVLTree *tree1;\n    tree1=CreateAVLTree(\"File1.txt\");\n    //PrintAVLTree(tree1);\n    return 0;\n}\n</code></pre>\n\n<p>I tried to be as elaborate as possible but feel free to ask me questions if you dont understand. Happy to answer.\nKindly help.\n<a href=\"https://i.stack.imgur.com/cj9eU.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/cj9eU.png\" alt=\"Nodes are formed, but the tree is still NULL\"></a></p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1553694136, "post_id": 55378658, "comment_id": 97479470, "body": "<code>char c;  while ((c = fgetc(f1)) != EOF)</code>  Extremely common FAQ."}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1553694202, "post_id": 55378658, "comment_id": 97479509, "body": "As Lundin says, <code>EOF</code> does no fit in a <code>char</code> variable and needs an <code>int</code> variable."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1553694240, "post_id": 55378658, "comment_id": 97479537, "body": "<code>riga** file_firme = (riga**)malloc(num_righe * sizeof(riga));</code> This is not how you allocate look-up tables in C. You either need to allocate a 2D array or an array of pointers - this is neither. See <a href=\"https://stackoverflow.com/questions/42094465/correctly-allocating-multi-dimensional-arrays\">Correctly allocating multi-dimensional arrays</a>."}], "owner": {"reputation": 7, "user_id": 11266628, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-smKePPgUccE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdmvN9glV5rSfuQ93u_0OqfCaghmw/mo/photo.jpg?sz=128", "display_name": "topo lino", "link": "https://stackoverflow.com/users/11266628/topo-lino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 26, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1553694005, "creation_date": 1553694005, "question_id": 55378658, "link": "https://stackoverflow.com/questions/55378658/access-violation-during-writing-path-array-of-structures", "title": "access violation during writing path [array of structures]", "body": "<p>I am trying to malloc an array of struct pointers (each struct is made by two string) and to fill up the array reading from a txt file which is made like this:</p>\n\n<p>firma1 path1\nfirma2 path2\nfirma3 path3\n.\n.\n.</p>\n\n<p>I get the exception after calling riempi_riga(file_firme[i], f1);\nI am supposed to pass a single element of my array to the function, but apparently something is not working.</p>\n\n<p>Thanks for help, regards</p>\n\n<pre><code>typedef struct {\n    char firma[50];\n    char path[100];\n}riga;\n\n\n\nvoid riempi_riga(riga*r, FILE* f1) {\n    fscanf(f1, \"%s \", r-&gt;firma);\n    fscanf(f1, \"%s\\n\", r-&gt;path);\n    return;\n}\nvoid stampa_riga(riga* r) {\n    printf(\"%s, %s\\n\", r-&gt;firma, r-&gt;path);\n    return;\n}\n\nint num_lines(FILE *f1) {\n    char c;\n    int lines = 0;\n    while ((c = fgetc(f1)) != EOF)\n        if (c == '\\n')\n            lines++;\n\n    if (c != '\\n')\n        lines++;\n    rewind(f1);\n    return lines;\n}\n\n\nint main() {\n\n    //riga* r1 =(riga*)malloc(sizeof(riga));\n    //printf(\"%d\", sizeof(riga));\n    int i = 0;\n    FILE* f1;\n    f1 = fopen(\"C:\\\\Users\\\\d.foti\\\\Desktop\\\\firmaMD5.txt\", \"r\");\n        if (f1 == NULL) {\n            printf(\"non sono riuscito ad aprire il file!\\n\");\n            return 0;\n            }\n        int num_righe = num_lines(f1);\n        riga** file_firme = (riga**)malloc(num_righe * sizeof(riga));\n\n        for (i; i &lt; num_lines; i++)\n            riempi_riga(file_firme[i], f1);\n\n    //riempi_riga(r1, f1);\n    //stampa_riga(r1);\n    //fflush(f1);\n    if (fclose(f1) != 0)\n        printf(\"non sono riuscito a chiudere il file\\n\");\n    return 0;\n}\n\n</code></pre>\n"}, {"tags": ["c", "gcc", "objdump", "object-files", "nm"], "comments": [{"owner": {"reputation": 24802, "user_id": 232918, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b5897762377de1c8ffb9a98673262e91?s=128&d=identicon&r=PG", "display_name": "doron", "link": "https://stackoverflow.com/users/232918/doron"}, "edited": false, "score": 0, "creation_date": 1553694134, "post_id": 55378492, "comment_id": 97479468, "body": "could dwarfdump help you?"}, {"owner": {"reputation": 38, "user_id": 4069539, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hHLcvzaEDU4/AAAAAAAAAAI/AAAAAAAAGB0/glbbbtHlQew/photo.jpg?sz=128", "display_name": "ChiefGokhlayeh", "link": "https://stackoverflow.com/users/4069539/chiefgokhlayeh"}, "reply_to_user": {"reputation": 24802, "user_id": 232918, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b5897762377de1c8ffb9a98673262e91?s=128&d=identicon&r=PG", "display_name": "doron", "link": "https://stackoverflow.com/users/232918/doron"}, "edited": false, "score": 0, "creation_date": 1553696037, "post_id": 55378492, "comment_id": 97480852, "body": "I quickly looked into it, indeed <code>dwarfdump</code> might be usable for what I need. Only downside is that it requires the object file to be built with debug information (<code>gcc -g ...</code>), which isn&#39;t that big of a deal tbh. What I&#39;m more worried about is availability on MinGW. I didn&#39;t mention it in the original post, but I would like to have it working on native Linux <i>and</i> MinGW."}], "answers": [{"tags": [], "owner": {"reputation": 38, "user_id": 4069539, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hHLcvzaEDU4/AAAAAAAAAAI/AAAAAAAAGB0/glbbbtHlQew/photo.jpg?sz=128", "display_name": "ChiefGokhlayeh", "link": "https://stackoverflow.com/users/4069539/chiefgokhlayeh"}, "is_accepted": true, "score": 0, "last_activity_date": 1553799875, "last_edit_date": 1553799875, "creation_date": 1553693990, "answer_id": 55378650, "question_id": 55378492, "link": "https://stackoverflow.com/questions/55378492/how-to-dump-path-to-source-from-object-file/55378650#55378650", "title": "How to dump path to source from object-file", "body": "<p>To answer my own question minutes after posting it (duh!):</p>\n\n<p><code>readelf -s app.o</code> prints a symbol table including the name of the source file (<code>app.c</code>). With that I am able to run <code>gcc -M app.c</code> and then parse through all header files to gather the symbol declarations.</p>\n"}], "owner": {"reputation": 38, "user_id": 4069539, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hHLcvzaEDU4/AAAAAAAAAAI/AAAAAAAAGB0/glbbbtHlQew/photo.jpg?sz=128", "display_name": "ChiefGokhlayeh", "link": "https://stackoverflow.com/users/4069539/chiefgokhlayeh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1079, "favorite_count": 0, "accepted_answer_id": 55378650, "answer_count": 1, "score": 0, "last_activity_date": 1553799875, "creation_date": 1553693576, "question_id": 55378492, "link": "https://stackoverflow.com/questions/55378492/how-to-dump-path-to-source-from-object-file", "title": "How to dump path to source from object-file", "body": "<p>Assume I have a C object-file <code>app.o</code> compiled with gcc. How can I dump the file path to the original <code>app.c</code> from which <code>app.o</code> was compiled. My goal is to create a listing of all symbols + respective source file path using the binutils and gcc toolsuite.\nBy no means am I expecting an all-in-one solution. So I tried playing with multiple tools to gather the information I need.</p>\n\n<p>Inspecting the object-file with a text-editor reveals that (appart from a lot of unreadable binary gibberish) the file <em>does</em> contain a reference to <code>app.c</code> as a string embedded into the object-file format. However I did not find a way to extract that string using <code>objdump</code> or <code>nm</code>.</p>\n\n<p>I was hoping <code>objdump</code> would have some flag that could extract this source file string, but after trying virtually all options documented in the <code>man</code> page I still couldn't find it.</p>\n\n<p>With the path of the source file I was hoping I could run <code>gcc -M &lt;path-to-source&gt;</code>. This would allow me to look through all the headers included by <code>app.c</code> and find the in-source declarations.</p>\n\n<p>Suppose a simple <code>app.c</code> like this:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>void foo(void) {\n}\n</code></pre>\n\n<p>Compile it via <code>gcc -c app.c -o app.o</code>.</p>\n\n<p>Running <code>objdump -t app.o</code> dumps the symbol table, but does not refer anywhere to the original <code>app.c</code>.\nRunning <code>cat app.o</code> does show that the object-file contains the file path to <code>app.c</code> (relative to pwd at compile-time). But I wasn't exactly planning on writing my own object-file parser just to get to that string.</p>\n"}, {"tags": ["c", "linux", "process", "operating-system", "pipe"], "comments": [{"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 1, "creation_date": 1553692201, "post_id": 55377897, "comment_id": 97478138, "body": "You should <a href=\"https://stackoverflow.com/posts/55377897/edit\">edit</a> your question to show the code that writes to the pipes and the code that creates the pipes and forks the children. Does it close the writing end? Do you close the writing end of the pipes in the child processes? There is no guarantee that you will read exactly the amount of data that was written to the other end. You may get less or you may get the combined data from 2 or more <code>write</code> calls."}, {"owner": {"reputation": 3, "user_id": 11266108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b81117be0e63c5845df81b500176ad51?s=128&d=identicon&r=PG&f=1", "display_name": "J Cho", "link": "https://stackoverflow.com/users/11266108/j-cho"}, "reply_to_user": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 0, "creation_date": 1553699085, "post_id": 55377897, "comment_id": 97483015, "body": "@Bodo Thank you for the prompt feedback! I wanted to make the question brief so that people won&#39;t be thrown off by a long question :&#39;( I updated it and hopefully you can quickly find some rookie mistakes I&#39;m making."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 11266108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b81117be0e63c5845df81b500176ad51?s=128&d=identicon&r=PG&f=1", "display_name": "J Cho", "link": "https://stackoverflow.com/users/11266108/j-cho"}, "edited": false, "score": 0, "creation_date": 1553702201, "post_id": 55381371, "comment_id": 97485155, "body": "First of all, thank you so much for the details! I&#39;m not sure why but the first issue you raised was not a problem for my particular environment and compiled fine but I went ahead and fixed the rest except 6. Indeed, the infinite while loop was due to my mistake in not properly closing the pipes. However, I&#39;m still having issues with the <code>read</code> function in <code>child_work</code> not reading the right amount of data each time, which I believe is an issue tied with the 6th problem you raised. How can this be addressed? Sorry for following up with another question."}, {"owner": {"reputation": 3, "user_id": 11266108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b81117be0e63c5845df81b500176ad51?s=128&d=identicon&r=PG&f=1", "display_name": "J Cho", "link": "https://stackoverflow.com/users/11266108/j-cho"}, "edited": false, "score": 0, "creation_date": 1553702295, "post_id": 55381371, "comment_id": 97485230, "body": "I realized this is the main issue remaining given that I&#39;ve replaced <code>read(pipes[procid][READ], expression, MAIN_BUF_LEN)</code> with <code>read(pipes[procid][READ], expression, 22)</code> and it led to correct outputs for lines that had 22 characters but messed up for those that had 23."}, {"owner": {"reputation": 3, "user_id": 11266108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b81117be0e63c5845df81b500176ad51?s=128&d=identicon&r=PG&f=1", "display_name": "J Cho", "link": "https://stackoverflow.com/users/11266108/j-cho"}, "edited": false, "score": 0, "creation_date": 1553702562, "post_id": 55381371, "comment_id": 97485409, "body": "I actually ended up changing the <code>write</code>&#39;s third argument to MAIN_BUF_LEN as well and this solved the problem! I guess it&#39;s not very elegant in that it doesn&#39;t dynamically read and write the minimal amount of bytes that are necessary, but it would work under circumstances where all the lines are less than 1024 characters. Is there a way to be more elegant or would you do this this way as well?"}], "tags": [], "owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "is_accepted": true, "score": 0, "last_activity_date": 1553704665, "last_edit_date": 1553704665, "creation_date": 1553701762, "answer_id": 55381371, "question_id": 55377897, "link": "https://stackoverflow.com/questions/55377897/unable-to-exit-while-loop-after-reading-information-written-to-pipe/55381371#55381371", "title": "Unable to exit while loop after reading information written to pipe", "body": "<p>There are several problems in the code.</p>\n\n<p>Unfortunately I cannot compile it and fix the errors because it is incomplete.</p>\n\n<ol>\n<li><p>You cannot define arrays with a size that is not constant like this.</p>\n\n<pre><code>int pipes[proc][2]; // Pipes to be created\n</code></pre>\n\n<p>I would expect the compiler to show a warning at this line.<br>\nYou should either use dynamic allocation (<code>malloc</code>) or statically allocate the arrays with a maximum size and check that <code>proc</code> is not greater than the maximum.</p></li>\n<li><p>You have to close the write end of all pipes in all children. The <code>read</code> will detect EOF only if no process has the write end still open.</p></li>\n<li><p>Instead of </p>\n\n<pre><code>while(1)\n{\n    if ( (r_val = read(pipes[procid][0], expression, MAIN_BUF_LEN)) &gt; 0)\n    {\n        /*...*/\n    }\n    else\n    {\n        break;\n    }\n}\n</code></pre>\n\n<p>I suggest</p>\n\n<pre><code>while((r_val = read(pipes[procid][0], expression, MAIN_BUF_LEN)) &gt; 0)\n{\n        /*...*/\n}\n</code></pre></li>\n<li><p>Instead of</p>\n\n<pre><code>    pid = fork();\n    if (pid != 0)\n        printf(\"created child with child pid %d\\n\", pid);\n</code></pre>\n\n<p>it should be</p>\n\n<pre><code>    pid = fork();\n    if (pid &gt; 0)\n        printf(\"created child with child pid %d\\n\", pid);\n</code></pre>\n\n<p>because <code>pid &lt; 0</code> is an error.</p></li>\n<li><p>Instead of</p>\n\n<pre><code>if (pid == 0) // in child process\n{\n    child_work(pipes, proc, i, out_ptr);\n    break;\n}\n</code></pre>\n\n<p>use</p>\n\n<pre><code>if (pid == 0) // in child process\n{\n    child_work(pipes, proc, i, out_ptr);\n    return 0;\n}\n</code></pre>\n\n<p>With <code>break;</code> the child would continue with the code after the <code>for</code> loop that would read the file and write to the pipes when <code>child_work</code> returns.</p></li>\n<li><p>It is not guaranteed that every child will get its turn to <code>read</code> from the pipe before the parent <code>write</code>s the next data, so it may get two or more messages in a single <code>read</code>. In real applications you should also be prepared to handle incomplete <code>read</code> or <code>write</code> calls and to continue writing/reading the remaining data with additional <code>read</code> or <code>write</code> calls.</p>\n\n<p>I think the easiest way to handle partial <code>read</code> or <code>write</code> would be to use buffered IO. You can use <code>fdopen</code> with the wrtite file descriptor or the read file descriptor of the pipe and write/read the data as a line of text terminated with a newline using e.g. <code>fprintf</code> or <code>fgets</code> respectively.</p></li>\n</ol>\n"}], "owner": {"reputation": 3, "user_id": 11266108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b81117be0e63c5845df81b500176ad51?s=128&d=identicon&r=PG&f=1", "display_name": "J Cho", "link": "https://stackoverflow.com/users/11266108/j-cho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 1, "accepted_answer_id": 55381371, "answer_count": 1, "score": 0, "last_activity_date": 1553704665, "creation_date": 1553691767, "last_edit_date": 1553702753, "question_id": 55377897, "link": "https://stackoverflow.com/questions/55377897/unable-to-exit-while-loop-after-reading-information-written-to-pipe", "title": "Unable to exit while loop after reading information written to pipe", "body": "<p>TLDR: You have to close the write end of all pipes in all children. The read will detect EOF only if no process has the write end still open.\nCredits to @Bodo </p>\n\n<p>As part of an assignment for an operating systems course, I'm trying to read lines from a file which is in the format of <code>x operand y</code> and distribute the lines to different child processes so that each one can take those lines as input and conduct calculations and write it to one output file. </p>\n\n<p>I feel like I'm almost there by getting the right results, but my code seems to lead to an endless while loop after reading all of the written lines to the read end of a pipe. </p>\n\n<p>Here's the relevant code snippet </p>\n\n<pre><code>int child_work(int pipes[][2], int proc, int procid, FILE * out)\n{\n    int i;\n    pid_t mypid;\n    Expression exp;\n    float result;\n    int procidx = procid;\n    char expression[MAIN_BUF_LEN];\n    int r_val;\n    printf(\"entered while loop for child process %d\\n\", mypid);\n    while(1)\n    {\n        if ( (r_val = read(pipes[procid][0], expression, MAIN_BUF_LEN)) &gt; 0)\n        {\n            printf(\"return values of read: %d\\n\", r_val);\n            exp_readln(&amp;exp, expression);\n            result = exp_cal(&amp;exp);\n            printf(\"[#%d]: %d %0.3f\\n\", procidx, mypid, result);\n            fprintf(out, \"#%d: %d %0.3f\\n\", procidx, mypid, result);\n            fflush(out);\n            procidx += proc;\n        }\n        else\n        {\n            break;\n        }\n    }\n    printf(\"exited while loop and reached end of child process %d\\n\", mypid);\n    return 0;\n\nint main(int argc, char **argv)\n{\n    if (argc != 4)\n    {\n        printf(\"not enough arguments\");\n        return 0;\n    }\n\n    const char *infile;  // Name of infile\n    const char *outfile; // Name of outfile\n    int proc;            // Number of child process to fork\n\n    // Save arguments to variables\n    infile = argv[1];\n    outfile = argv[2];\n    sscanf(argv[3], \"%u\", &amp;proc);\n\n    int pipes[proc][2]; // Pipes to be created\n    pid_t child_pids[proc]; // store all the pids of children created\n\n    int i; // Loop counter\n\n    char buf[MAIN_BUF_LEN];\n    Expression exp;\n\n    FILE * in_ptr, *out_ptr;\n    // Open infile with read-only, outfile with write and append.\n    if ((in_ptr = fopen(infile, \"r\")) == NULL)\n    {\n        printf(\"Error in opening file. Ending program. \\n\");\n        return 1;\n    }\n    out_ptr = fopen(outfile, \"a+\");\n\n    // Get parent pid and print to outfile\n    int ppid = getpid();\n    fprintf(out_ptr, \"%d\\n\", ppid);\n    fflush(out_ptr);\n\n    // $proc pipes should be created and saved to pipes[proc][2]\n    for (i = 0; i &lt; proc; ++i)\n    {\n        // TODO\n        if (pipe(pipes[i]) == -1 )\n        {\n            printf(\"Pipe failed for pipe %d\\n\", i);\n            return 1;\n        }\n    }\n\n    // $proc child processes should be created.\n    // Call child_work() immediately for each child.\n    for (i = 0; i &lt; proc; ++i)\n    {\n        int pid;\n        // create child only if in parent process\n        if (getpid() == ppid)\n        {\n            pid = fork();\n            if (pid != 0)\n                printf(\"created child with child pid %d\\n\", pid);\n                child_pids[i] = pid;\n        }\n\n        if (pid == 0) // in child process\n        {\n            child_work(pipes, proc, i, out_ptr);\n            break;\n        }\n        else if (pid &lt; 0) // error in forking\n        {\n            printf(\"Fork failed.\\n\");\n        }\n    }\n\n    // Close reading end of pipes for parent\n    for (i = 0; i &lt; proc; ++i)\n    {\n        // TODO\n        if (getpid() == ppid)\n            close(pipes[i][0]);\n    }\n\n    // Read lines and distribute the calculations to children in round-robin\n    // style.\n    // Stop when a empty line is read.\n\n    char* line = NULL;\n    size_t len = 0;\n    ssize_t read = 0;\n    int j = 0;\n    while ((read = getline(&amp;line, &amp;len, in_ptr)) != -1) {\n        //printf(\"Retrieved line of length %zu:\\n\", read);\n        //printf(\"%s\", line);\n        j = j % proc;\n        write(pipes[j++][1], line, strlen(line)+1);\n    }\n\n    // Close all the pipes when the task ends\n    for (i = 0; i &lt; proc; ++i)\n    {\n    //   close(pipes[i][READ]);\n       close(pipes[i][WRITE]);\n    }\n    printf(\"Task 6 complete!\");\n\n    for (i = 0; i &lt; proc; ++i)\n    {\n        waitpid(child_pids[i], NULL, 0);\n    }\n\n    fprintf(out_ptr, \"\\n\");\n    fflush(out_ptr);\n\n    return 0;\n}\n</code></pre>\n\n<p>This is the output that I am getting, which seemingly gets stuck in an infinite while loop as the process won't terminate. Also, the value of <code>return values of read:</code> should either be 22 or 23 based on the particular input file that I am using, but I don't know why it is incrementing for particular subsequent child processes. None of the child processes seem to be able to exit the while loop as this <code>printf(\"exited while loop and reached end of child process %d\\n\", mypid);</code> doesn't seem to be executed. My understanding is that if a pipe has been read, the return value will be the byte size of the line read, and if it reaches EOF or an error, the return value is 0 or -1, respectively. </p>\n\n<pre><code>entered while loop for child process 16016\nentered while loop for child process 16017\nentered while loop for child process 16018\nentered while loop for child process 16020\nreturn values of read: 22\nentered while loop for child process 16019\n[#0]: 16016 1.783\nreturn values of read: 22\nreturn values of read: 22\n[#2]: 16018 0.061\n[#1]: 16017 0.195\nreturn values of read: 22\nreturn values of read: 22\n[#5]: 16016 0.269\nreturn values of read: 46\n[#10]: 16016 1.231\nreturn values of read: 22\nreturn values of read: 22\n[#6]: 16017 0.333\nreturn values of read: 22\nreturn values of read: 46\n[#11]: 16017 1.684\n[#7]: 16018 -0.734\nreturn values of read: 46\n[#12]: 16018 0.134\n[#3]: 16019 0.778\nreturn values of read: 68\n[#4]: 16020 -0.362\nreturn values of read: 68\n[#9]: 16020 0.506\n[#8]: 16019 -0.450\n</code></pre>\n\n<p>I would appreciate any insight for a silly mistake I might be making. Thanks!</p>\n"}, {"tags": ["c", "scanf", "sha1", "buffer-overflow"], "comments": [{"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1553691842, "post_id": 55377806, "comment_id": 97477875, "body": "Have you seen <code>memcmp</code>?"}, {"owner": {"reputation": 17, "user_id": 8791579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/637124ef9debfdad2d0d7ca83c9768fe?s=128&d=identicon&r=PG&f=1", "display_name": "Aegean", "link": "https://stackoverflow.com/users/8791579/aegean"}, "reply_to_user": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1553692736, "post_id": 55377806, "comment_id": 97478535, "body": "Yes but what it is useful for in this case? It still compares the 20 bytes from password and correct_hash."}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 1, "creation_date": 1553692816, "post_id": 55377806, "comment_id": 97478595, "body": "It compares from wherever you tell it to start, for whatever length you give it."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1553692924, "post_id": 55377806, "comment_id": 97478678, "body": "So it&#39;s intentional, then, that <code>password</code> is only 20 chars long, but the <code>scanf</code> format with which it is being read <i>explicitly</i> accepts up to 37 bytes (plus a terminator)?  You are deliberately engineering a flawed program, I guess to explore how it can be attacked?"}, {"owner": {"reputation": 17, "user_id": 8791579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/637124ef9debfdad2d0d7ca83c9768fe?s=128&d=identicon&r=PG&f=1", "display_name": "Aegean", "link": "https://stackoverflow.com/users/8791579/aegean"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1553693860, "post_id": 55377806, "comment_id": 97479286, "body": "@JohnBollinger well it is a CTF assignment. So the purpose it to get the flag. I just do not understand how does the null terminator represented as and in hash."}, {"owner": {"reputation": 17, "user_id": 8791579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/637124ef9debfdad2d0d7ca83c9768fe?s=128&d=identicon&r=PG&f=1", "display_name": "Aegean", "link": "https://stackoverflow.com/users/8791579/aegean"}, "reply_to_user": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1553693940, "post_id": 55377806, "comment_id": 97479336, "body": "@stark you mean by &quot;wherever&quot; as parameters (password, correct_hash) or index?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1553694380, "post_id": 55377806, "comment_id": 97479654, "body": "@Aegean, you have a misunderstanding.  A byte with value <code>0</code> does not have inherent significance as a string terminator.  That is a <i>role</i> it plays in situations where an array in which it resides is being treated as a string.  In any other situation, it&#39;s just a byte with value 0, much like an <code>int</code> with value 0.  That&#39;s why <code>scanf</code> happily reads it (external input is not an array being treated as a string) and why it has no special significance to <code>memcmp()</code> (which does not interpret the data it compares as strings)."}, {"owner": {"reputation": 17, "user_id": 8791579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/637124ef9debfdad2d0d7ca83c9768fe?s=128&d=identicon&r=PG&f=1", "display_name": "Aegean", "link": "https://stackoverflow.com/users/8791579/aegean"}, "edited": false, "score": 0, "creation_date": 1553696715, "post_id": 55377806, "comment_id": 97481300, "body": "So its gonna be skipped over in memcmp? Then if i overwrite correct hash and the last 3 bytes will be \\x00\\xa4\\x50. So \\x00 does not have any significance there? So during memcmp will it be skipped over to xa4?"}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1553696804, "post_id": 55377806, "comment_id": 97481360, "body": "0 is a value, a4 is a value.  Nothing is skipped.  Use memcmp and memcpy for binary data. Use strcmp and strcpy for strings, where 00 has meaning."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1553702684, "post_id": 55377806, "comment_id": 97485486, "body": "The question is unclear. BTW: the python script does <b>not</b> find a usable password (you need longer permutations). And: you should use a generator instead of an in-memory list(), which would get too large."}, {"owner": {"reputation": 17, "user_id": 8791579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/637124ef9debfdad2d0d7ca83c9768fe?s=128&d=identicon&r=PG&f=1", "display_name": "Aegean", "link": "https://stackoverflow.com/users/8791579/aegean"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1553719927, "post_id": 55377806, "comment_id": 97494345, "body": "@wildplasser The question is I can&#39;t get the string which should give the last 3 byte 0x00 0xa4 0x50 and how can I get it? I am not really good with brute force scripting."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1553720777, "post_id": 55377806, "comment_id": 97494784, "body": "You dont need to put them there, they are already there. Just put your (5char) password there + (40-2-5) NULs, and you are there."}, {"owner": {"reputation": 17, "user_id": 8791579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/637124ef9debfdad2d0d7ca83c9768fe?s=128&d=identicon&r=PG&f=1", "display_name": "Aegean", "link": "https://stackoverflow.com/users/8791579/aegean"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1553722798, "post_id": 55377806, "comment_id": 97495680, "body": "@wildplasser did I understand what you mean wrong? I used this but it failed. echo -ne &quot;\\x01\\x02\\x03\\x04\\x05\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x0&zwnj;&#8203;0\\x00\\x00\\x00\\x00\\x0&zwnj;&#8203;0\\x00\\x00\\x00\\x00\\x0&zwnj;&#8203;0\\x00\\x00\\x00\\x00\\x0&zwnj;&#8203;0\\x00\\x00\\x00\\x00\\x0&zwnj;&#8203;0\\x00\\x00\\x00\\x00\\x0&zwnj;&#8203;0\\x00&quot; | ./overshade"}], "owner": {"reputation": 17, "user_id": 8791579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/637124ef9debfdad2d0d7ca83c9768fe?s=128&d=identicon&r=PG&f=1", "display_name": "Aegean", "link": "https://stackoverflow.com/users/8791579/aegean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 389, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1553691516, "creation_date": 1553691516, "question_id": 55377806, "link": "https://stackoverflow.com/questions/55377806/how-to-approach-a-buffer-overflow-problem-with-a-limited-string-scanf-and-hashin", "title": "How to approach a Buffer Overflow problem with a limited string scanf and hashing?", "body": "<p>PRE: There is only one similar question to this here with a different hashing algorithm and changed array sizes but that did not answer some questions in my head and post is from 2016. The problem is to perform a Buffer Overflow attack on a program which gets input as password, hashes it (SHA1) and compares the correct hash to it. (Scanf is limited)</p>\n\n<p>Things I know already: </p>\n\n<p>-NUL Byte (\\x00) is accepted by scanf. </p>\n\n<p>-If I feed 20 characters to input, the null terminator overwrites first correct hash value.</p>\n\n<p>-If I feed with 37 characters input(scanf limit), then we overwrite the first 17 bytes in correct hash with our own and 18th with the null terminator.</p>\n\n<p>I tried to write a python brute force script to find such a hash that it matches the last 3 bytes, but what I don't understand is, 18th byte from 20 bytes is null terminator in our correct hash. How to compare it? I tried doing like this but didn't work = \"00a450\" as the last 3 byte representation in string. Below is the code for C program and my python script.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;openssl/sha.h&gt;\n\nint\nmain(void) {\n    FILE *file;\n    unsigned char flag[128];\n    unsigned char correct_hash[20] = {\n        0x4a, 0xc9, 0xb0, 0x57, 0xf8, 0x02, 0x12, 0x60, 0x6c, 0xea,\n        0xab, 0xf3, 0xc6, 0x50, 0x5d, 0xaf, 0xed, 0x40, 0xa4, 0x50\n    };\n    unsigned char password[20];\n\n    printf(\"Insert your password: \");\n    scanf(\"%37s\", password);\n    SHA1(password, strlen((char *)password), password);\n    if(memcmp(password, correct_hash, 20) == 0) {\n        printf(\"CORRECT PASSWORD!\\n\");\n        file = fopen(\"/flag\", \"r\");\n        if(file != NULL) {\n            fscanf(file, \"%s\", flag);\n            fclose(file);\n            printf(\"Flag: %s\\n\", flag);\n        } else {\n            printf(\"Error while opening the flag file\\n\");\n        }\n    } else {\n        printf(\"WRONG PASSWORD!\\n\");\n    }\n    fflush(stdout);\n\n    return 0;\n}\n</code></pre>\n\n<pre class=\"lang-py prettyprint-override\"><code>import hashlib\nfrom itertools import *\n\nst = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\"\nhash_ending = \"00a450\"\nfound = False\nfor i in range(2,3):\n    perms = list(map(\"\".join, permutations(st,i)))\n    for permutation in perms:\n       full_hash =  hashlib.sha1(permutation.encode()).hexdigest()\n       print(\"Testing = \" + full_hash)\n       if(full_hash[-6:] == hash_ending):\n           found = True\n           print(\"Full Hash = \" + full_hash )\n           print(\"Password = \" + permutation)\n           break\n    if(found == True):\n        break\n\n</code></pre>\n\n<p>I have hard time understanding the NUL Byte and the overridden byte as string terminator in correct hash and its value when comparing.</p>\n"}, {"tags": ["c", "struct", "union", "ternary"], "comments": [{"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 6, "creation_date": 1553691094, "post_id": 55377646, "comment_id": 97477335, "body": "How about <code>uart1.oerr = U1ERRIRbits.RXFOIF? 1:0;</code> instead?"}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 1, "creation_date": 1553691190, "post_id": 55377646, "comment_id": 97477403, "body": "Try instead <code>U1ERRIRbits.RXFOIF ? uart1.oerr = 1 : (uart1.oerr = 0)</code>. Condition binds stronger than assignment. <a href=\"https://en.cppreference.com/w/c/language/operator_precedence\" rel=\"nofollow noreferrer\">C Operator Precedence</a>."}, {"owner": {"reputation": 65, "user_id": 11056312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6102fb11770c6eef397573a1d248861?s=128&d=identicon&r=PG&f=1", "display_name": "Arda30", "link": "https://stackoverflow.com/users/11056312/arda30"}, "reply_to_user": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 0, "creation_date": 1553691358, "post_id": 55377646, "comment_id": 97477522, "body": "@Blaze thank you! It looks way better @ Scheff thank you for the answer! :)"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1553692058, "post_id": 55377646, "comment_id": 97478032, "body": "What does this mean? &quot;Same thing does not give error when I use&quot; This is not the same thing at all! A ternary operator is (as any operator) used as part of an expression. Expressions do not create lvalues. In your alternate version you have separate statements where you assign a value to an lvalue."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1553692126, "post_id": 55377646, "comment_id": 97478083, "body": "General rule: A ternary operator is not the same as an <code>if</code> clause"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1553695609, "post_id": 55377646, "comment_id": 97480565, "body": "Another general rule: avoid using <code>?:</code> until it is actually needed. Which isn&#39;t very often at all."}], "answers": [{"tags": [], "owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "is_accepted": false, "score": 3, "last_activity_date": 1553691486, "creation_date": 1553691486, "answer_id": 55377793, "question_id": 55377646, "link": "https://stackoverflow.com/questions/55377646/error-expression-is-not-assignable-ternary-operator/55377793#55377793", "title": "error: expression is not assignable ternary operator", "body": "<pre><code>U1ERRIRbits.RXFOIF ? uart1.oerr = 1 : uart1.oerr = 0;\n</code></pre>\n\n<p>is interpreted as:</p>\n\n<pre><code>(U1ERRIRbits.RXFOIF ? uart1.oerr = 1 : uart1.oerr) = 0;\n</code></pre>\n\n<p>Which tries to assign <code>0</code> to ...? If you want to use such construct, you need braces:</p>\n\n<pre><code>U1ERRIRbits.RXFOIF ? uart1.oerr = 1 : (uart1.oerr = 0);\n</code></pre>\n\n<p>Or better:</p>\n\n<pre><code>uart1.oerr = U1ERRIRbits.RXFOIF ? 1 : 0;\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>uart1.oerr = !!U1ERRIRbits.RXFOIF;\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>uart1.oerr = (bool)U1ERRIRbits.RXFOIF;\n</code></pre>\n\n<p>or really just:</p>\n\n<pre><code>uart1.oerr = U1ERRIRbits.RXFOIF;\n</code></pre>\n\n<p>as <code>typeof(uart1.oerr) == bool</code>, the value will be implicitly converted to <code>1</code> for nonzero values or <code>0</code> for zero.</p>\n"}, {"tags": [], "owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "is_accepted": false, "score": 1, "last_activity_date": 1553691500, "creation_date": 1553691500, "answer_id": 55377800, "question_id": 55377646, "link": "https://stackoverflow.com/questions/55377646/error-expression-is-not-assignable-ternary-operator/55377800#55377800", "title": "error: expression is not assignable ternary operator", "body": "<p>The answer is simple that, due to <a href=\"https://en.cppreference.com/w/c/language/operator_precedence\" rel=\"nofollow noreferrer\">C operator precedence</a>,</p>\n\n<pre><code>U1ERRIRbits.RXFOIF ? uart1.oerr = 1 : uart1.oerr = 0;\n</code></pre>\n\n<p>is compiled as</p>\n\n<pre><code>(U1ERRIRbits.RXFOIF ? uart1.oerr = 1 : uart1.oerr) = 0;\n</code></pre>\n\n<p>In C, a condition doesn't provide an LValue. Hence, this is a compiler error.</p>\n\n<p>One solution would be to use parentheses:</p>\n\n<pre><code>U1ERRIRbits.RXFOIF ? uart1.oerr = 1 : (uart1.oerr = 0);\n</code></pre>\n\n<p>Please note, that <code>uart1.oerr = 1</code> doesn't need parentheses as <code>?</code> and <code>:</code> act like parentheses (a specialty of the ternary operator).</p>\n\n<p>The even simpler solutions are already mentioned in <a href=\"https://stackoverflow.com/a/55377793/7478597\">Kamils answer</a>...</p>\n"}], "owner": {"reputation": 65, "user_id": 11056312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6102fb11770c6eef397573a1d248861?s=128&d=identicon&r=PG&f=1", "display_name": "Arda30", "link": "https://stackoverflow.com/users/11056312/arda30"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1553691500, "creation_date": 1553691039, "last_edit_date": 1553691201, "question_id": 55377646, "link": "https://stackoverflow.com/questions/55377646/error-expression-is-not-assignable-ternary-operator", "title": "error: expression is not assignable ternary operator", "body": "<p>I have the following code and MPLABX XC8 compiler gives this error:</p>\n\n<blockquote>\n  <p>error: expression is not assignable</p>\n\n<pre><code>U1ERRIRbits.RXFOIF ? uart1.oerr = 1 : uart1.oerr = 0;\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ^\n</code></pre>\n</blockquote>\n\n<p>Here is the relevant code section: </p>\n\n<pre><code>typedef union {\n    struct {\n        bool ferr  : 1;  // FERIF Framing Error\n        bool aerr  : 1;  // ABDOVF Error\n        bool oerr  : 1;  // RXFOIF Error\n        bool ready : 1;  // Data Ready to be read\n        uint8_t reserved : 4;\n    };\n    uint8_t status;\n}uart1_status_t;\n\nstatic volatile uart1_status_t uart1;\n</code></pre>\n\n<blockquote>\n  <p><code>U1ERRIRbits.RXFOIF ? uart1.oerr = 1 : uart1.oerr = 0;</code></p>\n</blockquote>\n\n<p>Same thing does not give error when I use </p>\n\n<pre><code>if (U1ERRIRbits.RXFOIF) \n    uart1.oerr = 1;\nelse \n    uart1.oerr = 0;\n</code></pre>\n\n<p>Do not understand why?</p>\n"}, {"tags": ["c", "sockets", "udp"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1553691404, "post_id": 55377619, "comment_id": 97477554, "body": "How do you send data to this program you show?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1553691484, "post_id": 55377619, "comment_id": 97477613, "body": "Also note that you have an off-by-one error in your code. If <code>recvfrom</code> fills the whole buffer and returns a value equal to <code>BUFSIZE</code>, then <code>buf[recvlen] = 0</code> will write out of bounds of your array. You should also handle errors returned by <code>recvfrom</code>."}, {"owner": {"reputation": 147, "user_id": 6180869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acadef5bcec74c11f44af5a79ccda4f6?s=128&d=identicon&r=PG&f=1", "display_name": "HacHac", "link": "https://stackoverflow.com/users/6180869/hachac"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1553691596, "post_id": 55377619, "comment_id": 97477694, "body": "@Someprogrammerdude You&#39;re right for the recvfrom error. Will do it. I don&#39;t send data, i just want to receive datas from the outside equipment for now. I have no control over the outside equipment. Do not hesitate if i&#39;m not clear ..."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1553691911, "post_id": 55377619, "comment_id": 97477926, "body": "Sockets are created <i>blocking</i> by default. That means attempting to receive data (with e.g. <code>recvfrom</code>) will <i>block</i> and not return until there actually is data that have been received. If you don&#39;t send any data to your socket, then <code>recvfrom</code> will wait indefinitely."}, {"owner": {"reputation": 147, "user_id": 6180869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acadef5bcec74c11f44af5a79ccda4f6?s=128&d=identicon&r=PG&f=1", "display_name": "HacHac", "link": "https://stackoverflow.com/users/6180869/hachac"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1553694280, "post_id": 55377619, "comment_id": 97479575, "body": "@Someprogrammerdude agree, which means the problem comes from the outside equipment that does not send any data and not my program ?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1553695717, "post_id": 55377619, "comment_id": 97480625, "body": "This program should work fine, the problem is external (sending program, routers, bad networks dropping packets, firewalls, etc.)."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1553717819, "post_id": 55377619, "comment_id": 97493396, "body": "@Someprogrammerdude &quot;<i>then <code>recvfrom</code> will wait indefinitely</i>&quot; - or unless you use <code>select()</code> or <code>SO_RCVTIMEO</code> to specify a timeout before reading"}, {"owner": {"reputation": 147, "user_id": 6180869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acadef5bcec74c11f44af5a79ccda4f6?s=128&d=identicon&r=PG&f=1", "display_name": "HacHac", "link": "https://stackoverflow.com/users/6180869/hachac"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1554125115, "post_id": 55377619, "comment_id": 97625622, "body": "@Someprogrammerdude  Using wireshark I have more information about the UDP packet from the outside equipment : Source 192.168.0.40 Destination 192.168.0.20 Source port 4230 Dest port 2430 Maybe i need to precise the dest port on the code ? But i don&#39;t know where and how to do this ..."}], "answers": [{"tags": [], "owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": false, "score": 0, "last_activity_date": 1554126992, "creation_date": 1554126992, "answer_id": 55456897, "question_id": 55377619, "link": "https://stackoverflow.com/questions/55377619/socket-no-data-on-recv/55456897#55456897", "title": "Socket : no data on recv()", "body": "<p>The packet is destined for port <code>2430</code>, but your program is waiting for input on port <code>4230</code> (set with the <code>PORT</code> macro in your code).</p>\n\n<p>The port should be the port you want input to be received on, not the source port on the other end of the communication.</p>\n\n<p>So change the <code>PORT</code> macro to be <code>2430</code>.</p>\n"}], "owner": {"reputation": 147, "user_id": 6180869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acadef5bcec74c11f44af5a79ccda4f6?s=128&d=identicon&r=PG&f=1", "display_name": "HacHac", "link": "https://stackoverflow.com/users/6180869/hachac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554126992, "creation_date": 1553690950, "last_edit_date": 1554125071, "question_id": 55377619, "link": "https://stackoverflow.com/questions/55377619/socket-no-data-on-recv", "title": "Socket : no data on recv()", "body": "<p>I have an outside equipment that is suppose to send datas every second to my program computer (under linux). The documentation of this equipment says :\n<em>Ethernet interface with a fixed IP address of 192.168.0.40\nThe UDP ports used for the Ethernet interface is 4230\nDestination : 192.168.0.20</em></p>\n\n<p>So i tried to write the simpliest possible program to read these datas. My linux machine IP is set to 192.168.0.20 :</p>\n\n<pre><code>#define PORT 4230   \n#define BUFSIZE 72 \nstruct sockaddr_in myaddr; /* our address */ \nstruct sockaddr_in remaddr; /* remote address */ \nsocklen_t addrlen = sizeof(remaddr); /* length of addresses */ \nint recvlen; /* # bytes received */ \nint fd; /* our socket */ \nunsigned char buf[BUFSIZE]; /* receive buffer */\n\n/* create a UDP socket */ \nif ((fd = socket(AF_INET, SOCK_DGRAM, 0)) &lt; 0) \n{ perror(\"cannot create socket\\n\"); return 0; } /* bind the socket to any valid IP address and a specific port */ \n\n memset((char *)&amp;myaddr, 0, sizeof(myaddr)); \n myaddr.sin_family = AF_INET; \n myaddr.sin_addr.s_addr = htonl(INADDR_ANY); \n myaddr.sin_port = htons(PORT);\n\n if (bind(fd, (struct sockaddr *)&amp;myaddr, sizeof(myaddr)) &lt; 0) \n { perror(\"bind failed\"); return 0; } \n\n /* now loop, receiving data and printing what we received */ \n for (;;) \n{ \n    printf(\"waiting on port %d\\n\", PORT); \n    recvlen = recvfrom(fd, buf, BUFSIZE, 0, (struct sockaddr *)&amp;remaddr, &amp;addrlen); \n    printf(\"received %d bytes\\n\", recvlen); \n    if (recvlen &gt; 0) \n    {\n    buf[recvlen] = 0; \n    printf(\"received message: \\\"%s\\\"\\n\", buf); \n    } \n}\n</code></pre>\n\n<p>But i'm blocked at recvfrom(), never receiving datas ... What i'm doing wrong ? I tried to change INADDR_ANY to the right IP but still the same ...</p>\n\n<p>Thank you.</p>\n\n<p><strong>EDIT/UPDATE :</strong> Using wireshark I have more information about the UDP packet from the outside equipment :\nSource 192.168.0.40    Destination 192.168.0.20\nSource port 4230       Dest port 2430\nMaybe i need to precise the dest port on the code ? But i don't know where and how to do this ...</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 15289, "user_id": 583833, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/791a00235c66b6c32effd4291101087f?s=128&d=identicon&r=PG", "display_name": "Borgleader", "link": "https://stackoverflow.com/users/583833/borgleader"}, "edited": false, "score": 2, "creation_date": 1553690468, "post_id": 55377363, "comment_id": 97476910, "body": "Please fix your indentation/whitespace. This code is needlessly difficult to read."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 2, "creation_date": 1553690695, "post_id": 55377363, "comment_id": 97477064, "body": "I&#39;ve written a token answer to this exact question, but you&#39;re really asking the wrong question. Instead of focusing on trying to break how computers work, focus on explaining what the actual problem is - expand on <i>&quot;I am unable to receive values in main function&quot;</i> in a way that we can actually help you solve it (ideally with a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>). Since all your real data is stored in <code>main</code>, I have no idea how stack frame destruction comes into this."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1553690809, "post_id": 55377363, "comment_id": 97477131, "body": "This code is incredibly convoluted for such a simple task. I&#39;d throw this code away and start over from scratch rethinking everything. The whole program should be no longer than 15 lines."}, {"owner": {"reputation": 3, "user_id": 11165380, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ps00PihEnv0/AAAAAAAAAAI/AAAAAAAAAEE/ki16JXwTEas/photo.jpg?sz=128", "display_name": "ARUN KUMAR", "link": "https://stackoverflow.com/users/11165380/arun-kumar"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1553690994, "post_id": 55377363, "comment_id": 97477264, "body": "@LightnessRacesinOrbit My query is i am storing values in function and i am returning address to the main function and i am getting no errors but i am getting segmentation fault in run time."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1553691713, "post_id": 55377363, "comment_id": 97477780, "body": "@ARUNKUMAR You are going to need to provide some detail and evidence. The address you return is that of a thing that exists <i>in</i> <code>main</code> and therefore already exists. Did you write out of bounds and corrupt memory? You need to methodically debug this."}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 1, "creation_date": 1553692637, "post_id": 55377363, "comment_id": 97478464, "body": "Your problem has nothing to do with a corrupted stack.  You just have a bug.  You should try stepping through your code with a debugger and / or add lots of <code>printf</code> calls to find out where."}, {"owner": {"reputation": 348, "user_id": 11019146, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uN1b_TeM4-s/AAAAAAAAAAI/AAAAAAAAACE/el4YYLCuRvY/photo.jpg?sz=128", "display_name": "Patrick", "link": "https://stackoverflow.com/users/11019146/patrick"}, "edited": false, "score": 1, "creation_date": 1553693674, "post_id": 55377363, "comment_id": 97479155, "body": "Why do you need to return an int * and assign it to a new pointer if you will always be returning the address of arr from that function. Wouldn&#39;t it be better to make fib a void function and just change the values of arr using the pointer given?"}], "answers": [{"comments": [{"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1553692194, "post_id": 55377472, "comment_id": 97478128, "body": "In spite of the phrasing in the question, the array being returned <code>arr</code>, is not defined inside the function <code>fib</code>. It is defined in <code>main</code> and passed to <code>fib</code> via pointer. Whatever problem this code has, it is not one of attempting to return a pointer to an object local to the function."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1553692524, "post_id": 55377472, "comment_id": 97478371, "body": "@EricPostpischil Correct. See my comments under the question. I have answered the question posed, but the question is indeed &quot;wrong&quot; and the OP will have to ask a new one to address their actual problem."}], "tags": [], "owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "is_accepted": false, "score": 4, "last_activity_date": 1553690514, "creation_date": 1553690514, "answer_id": 55377472, "question_id": 55377363, "link": "https://stackoverflow.com/questions/55377363/how-can-i-achieve-a-stackframe-from-not-getting-destroyed-after-returning-from-t/55377472#55377472", "title": "How can I achieve a stackframe from not getting destroyed after returning from the function?", "body": "<p>You can't.</p>\n\n<p>You are trying to fight against the very definition of what a stack frame is, and you are losing.</p>\n\n<p>And you will always lose!</p>\n\n<p>Instead, properly structure your program to pass data around in the way you need, in accordance with the rules and specifications of the language.</p>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 11165380, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ps00PihEnv0/AAAAAAAAAAI/AAAAAAAAAEE/ki16JXwTEas/photo.jpg?sz=128", "display_name": "ARUN KUMAR", "link": "https://stackoverflow.com/users/11165380/arun-kumar"}, "edited": false, "score": 0, "creation_date": 1553693089, "post_id": 55377997, "comment_id": 97478788, "body": "I have no issues with logic I know logic for Fibonacci but my condition is i wanted to use recursion and wanted finally the output to be printed from main function"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "reply_to_user": {"reputation": 3, "user_id": 11165380, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ps00PihEnv0/AAAAAAAAAAI/AAAAAAAAAEE/ki16JXwTEas/photo.jpg?sz=128", "display_name": "ARUN KUMAR", "link": "https://stackoverflow.com/users/11165380/arun-kumar"}, "edited": false, "score": 0, "creation_date": 1553693463, "post_id": 55377997, "comment_id": 97479034, "body": "@ARUNKUMAR well then you need to debug your totally bloated pointless code."}, {"owner": {"reputation": 348, "user_id": 11019146, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uN1b_TeM4-s/AAAAAAAAAAI/AAAAAAAAACE/el4YYLCuRvY/photo.jpg?sz=128", "display_name": "Patrick", "link": "https://stackoverflow.com/users/11019146/patrick"}, "edited": false, "score": 0, "creation_date": 1553694988, "post_id": 55377997, "comment_id": 97480116, "body": "arr[ i + 2 ] in your fib function will continue to assign values past the bounds of the array since it goes all the way to num. I think it should be arr[i] = arr[ i - 2] + arr[i - 1] with i initialized to 2."}, {"owner": {"reputation": 348, "user_id": 11019146, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uN1b_TeM4-s/AAAAAAAAAAI/AAAAAAAAACE/el4YYLCuRvY/photo.jpg?sz=128", "display_name": "Patrick", "link": "https://stackoverflow.com/users/11019146/patrick"}, "edited": false, "score": 0, "creation_date": 1553696002, "post_id": 55377997, "comment_id": 97480834, "body": "I made an answer that builds off of your example to show how it&#39;s done recursively if you don&#39;t mind, although there is still no reason not to use iteration in this case."}], "tags": [], "owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "is_accepted": false, "score": 0, "last_activity_date": 1553692597, "last_edit_date": 1553692597, "creation_date": 1553692067, "answer_id": 55377997, "question_id": 55377363, "link": "https://stackoverflow.com/questions/55377363/how-can-i-achieve-a-stackframe-from-not-getting-destroyed-after-returning-from-t/55377997#55377997", "title": "How can I achieve a stackframe from not getting destroyed after returning from the function?", "body": "<p>Somewhat off topic, but you probably simply want this:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nvoid fib(int num, int *arr);\n\nint main()\n{\n  int num;\n  printf(\"Enter any number : \\n\");\n  scanf(\"%d\", &amp;num);\n\n  int arr[num] = { 0, 1 } ;\n  fib(num, arr);\n\n  for (int i = 0; i &lt; num; i++)\n    printf(\"%d \", arr[i]);\n}\n\nvoid fib(int num, int *arr)\n{\n  for (int i = 0; i &lt; num; i++)\n  {\n    arr[i + 2] = arr[i] + arr[i + 1];\n  }  \n}\n</code></pre>\n\n<p>Using recursion is pretty pointless here.\nThis is untested code, there may be bugs.</p>\n"}, {"tags": [], "owner": {"reputation": 348, "user_id": 11019146, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uN1b_TeM4-s/AAAAAAAAAAI/AAAAAAAAACE/el4YYLCuRvY/photo.jpg?sz=128", "display_name": "Patrick", "link": "https://stackoverflow.com/users/11019146/patrick"}, "is_accepted": false, "score": 1, "last_activity_date": 1553696331, "creation_date": 1553696331, "answer_id": 55379478, "question_id": 55377363, "link": "https://stackoverflow.com/questions/55377363/how-can-i-achieve-a-stackframe-from-not-getting-destroyed-after-returning-from-t/55379478#55379478", "title": "How can I achieve a stackframe from not getting destroyed after returning from the function?", "body": "<p>You can definitely achieve what you're wanting do without protecting the information on the function stackframes, as I don't believe your error has anything to do with that. With that said, recursion with Fibonacci numbers is kind of pointless compared to the iterative approach, it just ends up spamming extra stackframes when none are needed.</p>\n\n<p>I took inspiration from Jabberwocky's answer and made an example with \"recursion\", though it ends up just being a fancy for loop.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nvoid fib(int num, int *arr, int pos);\n\nint main()\n{\n  int num;\n  printf(\"Enter any number : \\n\");\n  scanf(\"%d\", &amp;num);\n\n  int arr[num];\n  if (num &gt; 1) {\n    arr[0] = 0 ;\n    arr[1] = 1 ;\n  }\n  int pos = 2;\n  fib(num, arr, pos);\n\n  for (int i = 0; i &lt; num; i++)\n    printf(\"%d \", arr[i]);\n}\n\nvoid fib(int num, int *arr, int pos)\n{\n  if (pos &lt; num &amp;&amp; pos &gt; 1)\n  {\n    arr[pos] = arr[pos - 2] + arr[pos - 1];\n    fib(num, arr, pos + 1);\n  }  \n  else {\n      return;\n  }\n}\n</code></pre>\n\n<p>This stores all values into arr which is allocated in main, so deletion of stackframes has no effect. The fib function even when recursive does not need to return anything because it has the array pointer and can directly change the values of the array. Of course more error checking is needed but I think this is sufficient to get the idea across.</p>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 11165380, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ps00PihEnv0/AAAAAAAAAAI/AAAAAAAAAEE/ki16JXwTEas/photo.jpg?sz=128", "display_name": "ARUN KUMAR", "link": "https://stackoverflow.com/users/11165380/arun-kumar"}, "edited": false, "score": 0, "creation_date": 1554183109, "post_id": 55467523, "comment_id": 97646213, "body": "i am using recursion and also printing from main function . thanks for help."}], "tags": [], "owner": {"reputation": 3, "user_id": 11165380, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ps00PihEnv0/AAAAAAAAAAI/AAAAAAAAAEE/ki16JXwTEas/photo.jpg?sz=128", "display_name": "ARUN KUMAR", "link": "https://stackoverflow.com/users/11165380/arun-kumar"}, "is_accepted": false, "score": 0, "last_activity_date": 1554183001, "creation_date": 1554183001, "answer_id": 55467523, "question_id": 55377363, "link": "https://stackoverflow.com/questions/55377363/how-can-i-achieve-a-stackframe-from-not-getting-destroyed-after-returning-from-t/55467523#55467523", "title": "How can I achieve a stackframe from not getting destroyed after returning from the function?", "body": "<pre><code> #include &lt;stdio.h&gt;       \n\n\n\n int fib ( int *num , int *first , int *second , int count , int *arr ) ;      \n\n\n int main() \n\n {\n\n char ch;\n\n do\n\n {\n    int num = 0;\n\n    printf(\"Enter any number : \\n\");\n\n    scanf(\"%d\", &amp;num);\n\n    int first = 0, second = 1, count = 0,size = num;           \n\nif(num &lt; 0)\n    {\n        size = -(num);                                 \n    }\n    int arr[size];                                          \n    count = fib(&amp;num, &amp;first, &amp;second, count, arr);        \n    for (int j = 0; j &lt; count; j++)\n    {\n        printf(\"%d \", *(arr + j));                      \n    }\n    printf(\"\\n\");\n    printf(\"Do you want to repeat ? Y / N\\n\");              \n    scanf(\"\\n\\n%c\", &amp;ch);\n  } while (ch == 'y' || ch == 'Y');                             \n}                                                                 \n\nint fib(int *num, int *first, int *second, int count, int *arr)   \n{\n\n int temp;\n if (*first == 0)\n {\n    printf(\"%d \", *first);                                  \n }\n if (*num &lt; 0)                                               \n {\n    if (*second == 1)                                       \n    {\n        printf(\"%d \", *second);\n    }\n    temp = *first - *second;                                \n    *first = *second;\n    *second = temp;\n    if (*second &gt;= *num &amp;&amp; *second &lt;= -*num)\n    {\n        *(arr + count) = *second;                      \n        return fib(num, first, second, count+1, arr);  \n    }\n }\n  else if(*num &gt; 0)                                        \n {\n    temp = *first + *second;\n    *first = *second;                                    \n    *second = temp;\n    if (*second == 1)\n    {\n        printf(\"%d \", *second);                        \n    }\n    if (*second &lt;= *num)\n    {\n        *(arr + count) = *second;                      \n        return fib(num, first, second, count+1, arr);  \n    }\n  }\n  return count;                                           \n }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4441, "user_id": 3025856, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/68e9ff807fadeaa41ece5dcf761a03c1?s=128&d=identicon&r=PG", "display_name": "Jeremy Caney", "link": "https://stackoverflow.com/users/3025856/jeremy-caney"}, "edited": false, "score": 0, "creation_date": 1589589142, "post_id": 61825776, "comment_id": 109363230, "body": "In addition to ensuring this compiles, it\u2019d be useful to provide additional explanation of your code so developers can understand your reasoning. This is especially valuable for new developers who may not be familiar with the syntax. Further, it can help reduce the need for follow-up questions. Would you mind updating your comment with additional details?"}], "tags": [], "owner": {"reputation": 1, "user_id": 13550767, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AOh14GhouPVzEhK0VAwpjwbuZ8Vwh--fgsjO3LoNsS437w=k-s128", "display_name": "hgjhttt", "link": "https://stackoverflow.com/users/13550767/hgjhttt"}, "is_accepted": false, "score": 0, "last_activity_date": 1589566351, "creation_date": 1589566351, "answer_id": 61825776, "question_id": 55377363, "link": "https://stackoverflow.com/questions/55377363/how-can-i-achieve-a-stackframe-from-not-getting-destroyed-after-returning-from-t/61825776#61825776", "title": "How can I achieve a stackframe from not getting destroyed after returning from the function?", "body": "<pre><code>int *fib(int *num, int *first, int *second, int i, int *arr)\n{\n  int temp;\n  if (*first == 0)\n    printf(\"%d \", *first);\n  if (*num &lt; 0)\n  {\n    if (*second == 1)\n      printf(\"%d \", *second);\n    temp = *first - *second;\n    *first = *second;\n    *second = temp;\n    if (*second &gt; *num &amp;&amp; *second &lt; -*num)\n    {\n      *(arr + i) = *second;\n      return fib(num, first, second, i++, arr);\n    }\n    else\n      return arr;\n  }\n  else\n  {\n    temp = *first + *second;\n    *first = *second;\n    *second = temp;\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 11165380, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ps00PihEnv0/AAAAAAAAAAI/AAAAAAAAAEE/ki16JXwTEas/photo.jpg?sz=128", "display_name": "ARUN KUMAR", "link": "https://stackoverflow.com/users/11165380/arun-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 5, "score": 0, "last_activity_date": 1589566351, "creation_date": 1553690193, "last_edit_date": 1553690684, "question_id": 55377363, "link": "https://stackoverflow.com/questions/55377363/how-can-i-achieve-a-stackframe-from-not-getting-destroyed-after-returning-from-t", "title": "How can I achieve a stackframe from not getting destroyed after returning from the function?", "body": "<p>I am trying to store elements for Fibonacci series in the array which is inside the function and after returning from function by \"return arr \" my stack frame is getting destroyed and I am unable to receive values in main function. I wanted to use recursion only and printing from main function these are my conditions.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint *fib(int *num, int *first, int *second, int i, int *arr);\n\nint main()\n{\n  int num;\n  printf(\"Enter any number : \\n\");\n  scanf(\"%d\", &amp;num);\n  int first = 0, second = 1, i = 0;\n  int arr[num];\n  int *result = fib(&amp;num, &amp;first, &amp;second, i, arr);\n  for (int i = 0; i &lt; num; i++)\n    printf(\"%d \", result[i]);\n}\n\nint *fib(int *num, int *first, int *second, int i, int *arr)\n{\n  int temp;\n  if (*first == 0)\n    printf(\"%d \", *first);\n  if (*num &lt; 0)\n  {\n    if (*second == 1)\n      printf(\"%d \", *second);\n    temp = *first - *second;\n    *first = *second;\n    *second = temp;\n    if (*second &gt; *num &amp;&amp; *second &lt; -*num)\n    {\n      *(arr + i) = *second;\n      return fib(num, first, second, i++, arr);\n    }\n    else\n      return arr;\n  }\n  else\n  {\n    temp = *first + *second;\n    *first = *second;\n    *second = temp;\n\n    if (*second &gt;= *num + 3)\n      return arr;\n    else\n    {\n      *(arr + i) = *second;\n      return fib(num, first, second, i++, arr);\n    }\n  }\n\n  printf(\"\\n\");\n}\n</code></pre>\n"}, {"tags": ["c", "pointers", "memory", "segmentation-fault", "strcpy"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1553689406, "post_id": 55377092, "comment_id": 97476228, "body": "Undefined behavior is undefined.  That&#39;s why."}, {"owner": {"reputation": 12333, "user_id": 1460057, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/T8zcA.jpg?s=128&g=1", "display_name": "Brionius", "link": "https://stackoverflow.com/users/1460057/brionius"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1553689554, "post_id": 55377092, "comment_id": 97476326, "body": "So if I understand you correctly, writing outside allocated memory causes undefined behavior, which means sometimes it will cause a segmentation fault, but other weird stuff can happen too, like strcpy unexpectedly &quot;succeeding&quot;?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1553689883, "post_id": 55377092, "comment_id": 97476536, "body": "You might like to read <a href=\"https://stackoverflow.com/questions/2397984/undefined-unspecified-and-implementation-defined-behavior\">Undefined, unspecified and implementation-defined behavior</a>. Suppose you park your car and leave the parking brake off: the car might roll away, it might not. There are no promises from the Careless Parking Police. Suppose you sit in a reserved seat in a playhouse: its owner might demand it , might not show up, or may already be sitting in the seat, again no promises."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1553691099, "post_id": 55377092, "comment_id": 97477336, "body": "@WeatherVane I doubt that the owner will be sitting in his reserved seat if you are already sitting in it ;-)"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1553691474, "post_id": 55377092, "comment_id": 97477608, "body": "@Jabberwocky my point is there will be trouble (: but not in all cases. The owner may already be in it."}, {"owner": {"reputation": 12333, "user_id": 1460057, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/T8zcA.jpg?s=128&g=1", "display_name": "Brionius", "link": "https://stackoverflow.com/users/1460057/brionius"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1553710707, "post_id": 55377092, "comment_id": 97490004, "body": "Thanks @WeatherVane!"}], "owner": {"reputation": 12333, "user_id": 1460057, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/T8zcA.jpg?s=128&g=1", "display_name": "Brionius", "link": "https://stackoverflow.com/users/1460057/brionius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "closed_date": 1553689385, "answer_count": 0, "score": 0, "last_activity_date": 1553689286, "creation_date": 1553689286, "question_id": 55377092, "link": "https://stackoverflow.com/questions/55377092/why-doesnt-strcpy-cause-a-segmentation-fault-when-writing-to-a-shorter-array", "closed_reason": "Duplicate", "title": "Why DOESN&#39;T strcpy cause a segmentation fault when writing to a shorter array?", "body": "<p>I'm trying to understand c strings and pointers better. I was playing with <code>strcpy</code>, and I expected the code below to cause a segmentation fault, but to my surprise, it did not. </p>\n\n<pre><code>char a [] = \"hello there\";\nchar b [] = \"yay\";\nstrcpy(b, a);\nputs(a);\nputs(b);\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>hello there\nhello there\n</code></pre>\n\n<p>When <code>strcpy</code> gets to the second \"l\" in \"hello\", shouldn't the string pointed to by <code>b</code> be out of memory slots? I would have thought that after the third byte, <code>strcpy</code> would run out of allocated memory in the <code>b</code> array, start writing to unallocated memory, or memory allocated to another pointer, and cause a segmentation fault.</p>\n\n<p>I'd appreciate help understanding this better. Thanks!</p>\n"}, {"tags": ["c", "c-preprocessor"], "comments": [{"owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "edited": false, "score": 0, "creation_date": 1553697178, "post_id": 55376922, "comment_id": 97481597, "body": "Related to <a href=\"https://stackoverflow.com/questions/20913103/is-it-possible-to-pass-a-brace-enclosed-initializer-as-a-macro-parameter\" title=\"is it possible to pass a brace enclosed initializer as a macro parameter\">stackoverflow.com/questions/20913103/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "is_accepted": true, "score": 9, "last_activity_date": 1553688762, "creation_date": 1553688762, "answer_id": 55376923, "question_id": 55376922, "link": "https://stackoverflow.com/questions/55376922/why-does-a-c-macro-invocation-eat-up-curly-braces/55376923#55376923", "title": "Why does a C macro invocation eat up curly braces?", "body": "<p>The reason is that the invocation is split by comma to find the arguments, ignoring any characters such as { and } (see below for quote from the standard). Only regular parens are treated specially.</p>\n\n<p>So <code>TEST({1, 2})</code> is interpreted as being passed two arguments, <code>{1</code> and <code>2}</code>.\nIndeed:</p>\n\n<pre><code>#define TEST(x, y) | x | y |\nint arr[2] = TEST({1, 2});\n</code></pre>\n\n<p>Is preprocessed into:</p>\n\n<pre><code>int arr[2] = | {1 | 2} |;\n</code></pre>\n\n<p>Section 6.10.3.11:</p>\n\n<blockquote>\n  <p>The sequence of preprocessing tokens bounded by the outside-most matching parentheses\n  forms the list of arguments for the function-like macro. The individual arguments within\n  the list are separated by comma preprocessing tokens, but comma preprocessing tokens\n  between matching inner parentheses do not separate arguments. If there are sequences of\n  preprocessing tokens within the list of arguments that would otherwise act as\n  preprocessing directives, 172) the behavior is undefined.</p>\n</blockquote>\n"}], "owner": {"reputation": 15004, "user_id": 562906, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7a15f15ed0023f4177a518b6c15ca4b6?s=128&d=identicon&r=PG", "display_name": "sinelaw", "link": "https://stackoverflow.com/users/562906/sinelaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 1, "accepted_answer_id": 55376923, "answer_count": 1, "score": 8, "last_activity_date": 1553688762, "creation_date": 1553688762, "question_id": 55376922, "link": "https://stackoverflow.com/questions/55376922/why-does-a-c-macro-invocation-eat-up-curly-braces", "title": "Why does a C macro invocation eat up curly braces?", "body": "<p>Consider:</p>\n\n<pre><code>#define TEST(x) x\nint arr[2] = TEST({1, 2});\n</code></pre>\n\n<p>I would expect it to be preprocessed into <code>int arr[2] = {1, 2};</code></p>\n\n<p>Instead, both gcc and clang complain. gcc 7.3.0:</p>\n\n<pre><code>./test.c:2:25: error: macro \"TEST\" passed 2 arguments, but takes just 1\n int arr[2] = TEST({1, 2});\n</code></pre>\n\n<p>clang 3.8.1:</p>\n\n<pre><code>./test.c:2:23: error: too many arguments provided to function-like macro invocation\nint arr[2] = TEST({1, 2});\n</code></pre>\n\n<p>I couldn't find any mention of curly braces being treated specially in the C language standard section on macros (6.10).</p>\n\n<p>Why does this happen?</p>\n"}, {"tags": ["c", "multithreading", "thread-safety", "c11", "c17"], "answers": [{"tags": [], "owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "is_accepted": true, "score": 6, "last_activity_date": 1553689456, "creation_date": 1553689456, "answer_id": 55377140, "question_id": 55376898, "link": "https://stackoverflow.com/questions/55376898/is-there-something-that-resembles-stdlock-guard-in-native-c/55377140#55377140", "title": "Is there something that resembles std::lock_guard in native C?", "body": "<p><code>std::lock_guard</code> is an example of a general C++ concept known as RAII. C++ programmers <em>need</em> this because a C++ function may be exited in ways the programmer didn't write themselves, via an exception being thrown.</p>\n\n<p>C does not have exceptions, so a concept like RAII, despite its merits and utility, isn't really needed. To accomplish this sort of paired action in C you'll need to call the two functions yourself. How you do it exactly is entirely up to you. For instance, you can defer the locking to a wrapper function that accepts a callback:</p>\n\n<pre><code>static inline void do_locked( void (*cb)(void) ) {\n   mtx_lock(&amp;m); \n   cb();\n   mtx_unlock(&amp;m);\n}\n\nstatic inline void do2_impl(void) {\n   x = x / 3;\n}\n\nstatic void do2()  {\n    do_locked(do2_impl);\n}\n</code></pre>\n\n<p>Discipline to keep your code well structured is all it takes really, even if you don't have the same toolbox C++ gives you.</p>\n"}], "owner": {"reputation": 352, "user_id": 1454770, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/55b745b283e8f1a78cd942c72b6021f4?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1454770/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 55377140, "answer_count": 1, "score": 4, "last_activity_date": 1553689456, "creation_date": 1553688708, "question_id": 55376898, "link": "https://stackoverflow.com/questions/55376898/is-there-something-that-resembles-stdlock-guard-in-native-c", "title": "Is there something that resembles std::lock_guard in native C?", "body": "<p>In C++ it's recommended to use lock_guard as it ensures when the object is destroyed it unlocks the mutex.</p>\n\n<p>Is there a way to implement the same thing in C? Or do we have to just implement it manually:</p>\n\n<p>lock mutex</p>\n\n<p>Do something on a global variable</p>\n\n<p>unlock mutex</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;threads.h&gt;\n\nlong long x = 0;\nmtx_t m;\nstatic void do1()  {\n   mtx_lock(&amp;m); \n   for(int i = 0; i &lt; 100; i++){\n       x = x +1;\n   }\n   mtx_unlock(&amp;m);\n}\n\nstatic void do2()  {\n   mtx_lock(&amp;m); \n   x = x / 3;\n   mtx_unlock(&amp;m);\n}\n\nint main(int argc, char *argv[])\n{ \n   mtx_init(&amp;m, mtx_plain);\n   thrd_t thr1; \n   thrd_t thr2;\n   thrd_create(&amp;thr1, do1, 0);\n   thrd_create(&amp;thr2, do2, 0);\n   thrd_join(&amp;thr2, 0);\n   thrd_join(&amp;thr1, 0);\n   return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "file-io"], "comments": [{"owner": {"reputation": 1975, "user_id": 6070341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YHHZU.png?s=128&g=1", "display_name": "Costantino Grana", "link": "https://stackoverflow.com/users/6070341/costantino-grana"}, "edited": false, "score": 0, "creation_date": 1553688150, "post_id": 55376692, "comment_id": 97475470, "body": "What is input? Provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 195333, "user_id": 253056, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1977cbe0ac5ffec4f6ee5ee24363988a?s=128&d=identicon&r=PG", "display_name": "Paul R", "link": "https://stackoverflow.com/users/253056/paul-r"}, "edited": false, "score": 2, "creation_date": 1553688244, "post_id": 55376692, "comment_id": 97475528, "body": "Change <code>int i=0;</code> to <code>int i=1;</code>. Also change <code>char tmp</code> to <code>int tmp</code>."}, {"owner": {"reputation": 26941, "user_id": 2979617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/whfql.png?s=128&g=1", "display_name": "M Oehm", "link": "https://stackoverflow.com/users/2979617/m-oehm"}, "edited": false, "score": 0, "creation_date": 1553688344, "post_id": 55376692, "comment_id": 97475592, "body": "Read a char first. Then test whether to end the loop. In the loop, store the read char and as the last thing in the loop, read the next char, so that the loop condition uses the fresh input."}, {"owner": {"reputation": 1, "user_id": 11265995, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RHAQhTsC77U/AAAAAAAAAAI/AAAAAAAAAA4/Jyc9riUGPvc/photo.jpg?sz=128", "display_name": "Eslam Elsayed", "link": "https://stackoverflow.com/users/11265995/eslam-elsayed"}, "edited": false, "score": 0, "creation_date": 1553688414, "post_id": 55376692, "comment_id": 97475628, "body": "input is a character array: char input[5];"}, {"owner": {"reputation": 1975, "user_id": 6070341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YHHZU.png?s=128&g=1", "display_name": "Costantino Grana", "link": "https://stackoverflow.com/users/6070341/costantino-grana"}, "edited": false, "score": 1, "creation_date": 1553688695, "post_id": 55376692, "comment_id": 97475804, "body": "Still no MCVE. Edit your question!"}, {"owner": {"reputation": 1, "user_id": 11265995, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RHAQhTsC77U/AAAAAAAAAAI/AAAAAAAAAA4/Jyc9riUGPvc/photo.jpg?sz=128", "display_name": "Eslam Elsayed", "link": "https://stackoverflow.com/users/11265995/eslam-elsayed"}, "edited": false, "score": 0, "creation_date": 1553688716, "post_id": 55376692, "comment_id": 97475820, "body": "whenever i try to &quot;store&quot; the current character it stores the next one instead, so it reads and stores in one step"}, {"owner": {"reputation": 26941, "user_id": 2979617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/whfql.png?s=128&g=1", "display_name": "M Oehm", "link": "https://stackoverflow.com/users/2979617/m-oehm"}, "edited": false, "score": 0, "creation_date": 1553688787, "post_id": 55376692, "comment_id": 97475859, "body": "That&#39;s because you have the order of your operations mixed up. it&#39;s take a char, test it, process it, take the next char, but you take a char, test it, take the next char, process that, and so on ... (You can find out about such errors by stepping through your code, either in a debugger or with paper and pencil.)"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1553688938, "post_id": 55376692, "comment_id": 97475925, "body": "Double check the size of the buffer. 5 is not enough to take the desired output of &quot;ADD $02&quot;."}, {"owner": {"reputation": 1, "user_id": 11265995, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RHAQhTsC77U/AAAAAAAAAAI/AAAAAAAAAA4/Jyc9riUGPvc/photo.jpg?sz=128", "display_name": "Eslam Elsayed", "link": "https://stackoverflow.com/users/11265995/eslam-elsayed"}, "reply_to_user": {"reputation": 26941, "user_id": 2979617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/whfql.png?s=128&g=1", "display_name": "M Oehm", "link": "https://stackoverflow.com/users/2979617/m-oehm"}, "edited": false, "score": 0, "creation_date": 1553690084, "post_id": 55376692, "comment_id": 97476670, "body": "@MOehm can you please give an example code?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11265995, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RHAQhTsC77U/AAAAAAAAAAI/AAAAAAAAAA4/Jyc9riUGPvc/photo.jpg?sz=128", "display_name": "Eslam Elsayed", "link": "https://stackoverflow.com/users/11265995/eslam-elsayed"}, "edited": false, "score": 0, "creation_date": 1553695565, "post_id": 55377811, "comment_id": 97480521, "body": "whenever i try to set bit 0 of input it goes crazy. Am i ever allowed to do that? like do input[0] = tmp;?"}, {"owner": {"reputation": 26941, "user_id": 2979617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/whfql.png?s=128&g=1", "display_name": "M Oehm", "link": "https://stackoverflow.com/users/2979617/m-oehm"}, "reply_to_user": {"reputation": 1, "user_id": 11265995, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RHAQhTsC77U/AAAAAAAAAAI/AAAAAAAAAA4/Jyc9riUGPvc/photo.jpg?sz=128", "display_name": "Eslam Elsayed", "link": "https://stackoverflow.com/users/11265995/eslam-elsayed"}, "edited": false, "score": 0, "creation_date": 1553698771, "post_id": 55377811, "comment_id": 97482796, "body": "You mean byte? Sure, if you have <code>char input[5];</code> then 0 is a valid index for <code>input</code>."}], "tags": [], "owner": {"reputation": 26941, "user_id": 2979617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/whfql.png?s=128&g=1", "display_name": "M Oehm", "link": "https://stackoverflow.com/users/2979617/m-oehm"}, "is_accepted": false, "score": 0, "last_activity_date": 1553691527, "creation_date": 1553691527, "answer_id": 55377811, "question_id": 55376692, "link": "https://stackoverflow.com/questions/55376692/how-to-stop-my-program-from-skipping-characters-before-saving-them/55377811#55377811", "title": "how to stop my program from skipping characters before saving them", "body": "<p>You are doing things in the wrong order in your code: The way your code is structures, reading and storing the first char is moved out of the loop. In the loop, that char is then overwritten. In that case start with <code>i = 1</code>.</p>\n\n<p>Perhaps you want to read the first character anyway, but I guess you want to read everything up to the first space, which might be the first character. Then do this:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void)\n{\n    char input[80];\n    int i = 0;\n    int c = getchar();\n\n    while (c != ' ' &amp;&amp; c != '\\n' &amp;&amp; c != EOF) {\n        if (i + 1 &lt; sizeof(input)) {         // store char if the is room\n            input[i++] = c;\n        }\n\n        c = getchar();\n    }\n\n    input[i] = '\\0';                         // null-terminate input\n\n    puts(input);\n\n    return 0;\n}\n</code></pre>\n\n<p>Things to note:</p>\n\n<ul>\n<li><p>The first character is read before the loop. the loop condition and the code that stores the char then use that char. Just before the end of the loop body, the next char is read, which will then be processed in the next iteration.</p></li>\n<li><p>You don't enforce that the char buffer <code>input</code> cannot be overwritten. This is dangerous, especially since your buffer is tiny.</p></li>\n<li><p>When you construct strings char by char, you should null-terminate it by placing an explicit <code>'\\0'</code> at the end. You have to make sure that there is space for that terminator. Nearly all system functions like <code>puts</code> or <code>printf(\"%s\", ...)</code> expect the string to be null-terminated.</p></li>\n<li><p>Make the result of <code>getchar</code> an <code>int</code>, so that you can distinguish between all valid character codes and the special value <code>EOF</code>.</p></li>\n</ul>\n\n<p>The code above is useful if the first and subsequent calls to get the next item are different, for example when tokenizing a string with <code>strtok</code>. Here, you can also choose another approach:</p>\n\n<pre><code>    while (1) {                          // \"infinite loop\" \n        int c = getchar();               // read a char first thing in a loop\n\n        if (c == ' ' || c == '\\n' || c == EOF) break;\n                                         // explicit break when done\n\n        if (i + 1 &lt; sizeof(input)) {\n            input[i++] = c;\n        }\n    }\n</code></pre>\n\n<p>This approach has the logic of processing the chars in the loop body only, but you must wrap it in an infinite loop and then use the explicit <code>break</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 11265995, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RHAQhTsC77U/AAAAAAAAAAI/AAAAAAAAAA4/Jyc9riUGPvc/photo.jpg?sz=128", "display_name": "Eslam Elsayed", "link": "https://stackoverflow.com/users/11265995/eslam-elsayed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1553691527, "creation_date": 1553688002, "last_edit_date": 1553688747, "question_id": 55376692, "link": "https://stackoverflow.com/questions/55376692/how-to-stop-my-program-from-skipping-characters-before-saving-them", "title": "how to stop my program from skipping characters before saving them", "body": "<p>I am making a simple program to read from a file character by character, puts them into tmp and then puts tmp in input[i]. However, the program saves a character in tmp and then saves the next character in input[i]. How do I make it not skip that first character?</p>\n\n<p>I've tried to read into input[i] right away but then I wasn't able to check for EOF flag.</p>\n\n<pre><code>FILE * file = fopen(\"input.txt\", \"r\");\nchar tmp;\nchar input[5];\ntmp= getc(file);\ninput[0]= tmp;\nint i=0;\nwhile((tmp != ' ') &amp;&amp; (tmp != '\\n') &amp;&amp; (tmp != EOF)){\n    tmp= getc(file);\n    input[i]=tmp;\n    length++;\n    i++;\n}\nprintf(\"%s\",input);\n</code></pre>\n\n<p>It's supposed to print \"ADD $02\", but instead it prints \"DD 02\".</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1553687188, "post_id": 55376389, "comment_id": 97474877, "body": "You can always debug. Have you tried giving the program a ton of different input yourself and seeing what fails?"}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 0, "creation_date": 1553687404, "post_id": 55376389, "comment_id": 97475019, "body": "<i>&quot;I cant debug too because I cant see certain pattern which can be fixed.&quot;</i> - That&#39;s definitely not something that makes it impossible to debug."}, {"owner": {"reputation": 26941, "user_id": 2979617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/whfql.png?s=128&g=1", "display_name": "M Oehm", "link": "https://stackoverflow.com/users/2979617/m-oehm"}, "edited": false, "score": 0, "creation_date": 1553687920, "post_id": 55376389, "comment_id": 97475321, "body": "When there is no star after a slash, you don&#39;t count the slash as character. Also, the speciication says that the input <code>&quot;abc\\n&quot;</code> is considered two lines, not only one."}], "owner": {"reputation": 11, "user_id": 11265892, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-V-T8hTtdXDU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reRAOEqgW3qK37EMeu6ej6MDra7Qg/mo/photo.jpg?sz=128", "display_name": "Shatlyk Bashimov", "link": "https://stackoverflow.com/users/11265892/shatlyk-bashimov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1553687071, "creation_date": 1553687071, "question_id": 55376389, "link": "https://stackoverflow.com/questions/55376389/word-counting-program-in-c-it-should-exclude-comments", "title": "Word counting program in c (it should exclude comments)", "body": "<p>I currently got assignment to make word counting program in c. Task is your program should count characters, lines and words. Lines should be counted even if it is inside comment. Comments should be represented as an \" \" space character.</p>\n\n<p>I tried to use switch function to implement cases inside and outside word. But I am having trouble with comment. In first if statement I tried to check if we are in comment or not and if so skip it. </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;ctype.h&gt;\n#define word 1\n#define nword 0\n\n    int main(void)\n    {\n\n        int c,d,nmb = 0 , state = nword , ch = 0, ln = 0;\n        while((c=getchar())!=EOF)\n        {\n            if( c == '/' )\n            {\n                 if((d=getchar())=='*')\n                {       \n\n                     int f;\n                     c = getchar();\n                     d = getchar();\n\n                     while(c!='*' || d !='/')\n                     {\n                        c = d;\n                        d = getchar();\n                        if(d == '\\n')\n                        { ln++ ; ch++; }\n                        if(d == EOF)\n                        { f=1 ; break; }\n\n                    }\n                    if(f==1)\n                    printf(\"problem in line: %d\\n\", ln);\n                    state=word;\n                    nmb++;\n                }\n            }\n            switch(state)\n            {\n                case nword:\n\n                    if(isspace(c))\n                     {\n                        state=word;\n                        nmb++;  \n                    }\n                    break;\n                case word:\n\n                    if(!isspace(c))\n                        state=nword;\n                    break;\n            } \n            if (c == '\\n')\n            ln++;\n            ch++;\n        }\n        printf(\"words: %d\\n\", nmb);\n        printf(\"chars: %d\\n\", ch);\n        printf(\"lines: %d\\n\", ln);\n        return 0;\n    }\n</code></pre>\n\n<p>I cant get right answers to test cases. I cant debug too because I cant see certain pattern which can be fixed. Some test cases matches right but others dont.(Test cases in <a href=\"https://ee209-2019-spring.github.io/assignment/wc209/\" rel=\"nofollow noreferrer\">https://ee209-2019-spring.github.io/assignment/wc209/</a> )</p>\n"}, {"tags": ["c", "performance", "parallel-processing", "openmp", "pragma"], "comments": [{"owner": {"reputation": 1381, "user_id": 4381807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/i4GHo.gif?s=128&g=1", "display_name": "Anty", "link": "https://stackoverflow.com/users/4381807/anty"}, "edited": false, "score": 1, "creation_date": 1553686876, "post_id": 55375951, "comment_id": 97474669, "body": "5000 multiplications is not worth doing parallel calculations. Cost of thread spawn (or taking thread from pool) and thread join is much higher than actual calculation. You can do an exercise and check yourself what is minimum size of dot product for parallel to be profitable."}, {"owner": {"reputation": 23, "user_id": 10761095, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-LUdH_AV_6nM/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gs8VAURa0anM6kTJSNEPrkhh3NVg/mo/photo.jpg?sz=128", "display_name": "no-one", "link": "https://stackoverflow.com/users/10761095/no-one"}, "reply_to_user": {"reputation": 1381, "user_id": 4381807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/i4GHo.gif?s=128&g=1", "display_name": "Anty", "link": "https://stackoverflow.com/users/4381807/anty"}, "edited": false, "score": 0, "creation_date": 1553687782, "post_id": 55375951, "comment_id": 97475224, "body": "Thank you but I tested for 5000000 and full-parallel is the fastest and half-parallel is the slowest! Why half-parallel is not better than sequential?!"}, {"owner": {"reputation": 1381, "user_id": 4381807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/i4GHo.gif?s=128&g=1", "display_name": "Anty", "link": "https://stackoverflow.com/users/4381807/anty"}, "edited": false, "score": 0, "creation_date": 1553689254, "post_id": 55375951, "comment_id": 97476135, "body": "For loops for seq and parallel are different than half parallel - they do produce different assembly code. Half parallel generates twice the amount of code and you still pay for spawning threads. Increase size of operation to something more realistic like 50 million or so and check again."}, {"owner": {"reputation": 530, "user_id": 2394541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f9b9b9399b329591f7be92da1c5e442?s=128&d=identicon&r=PG", "display_name": "tim18", "link": "https://stackoverflow.com/users/2394541/tim18"}, "edited": false, "score": 0, "creation_date": 1553691824, "post_id": 55375951, "comment_id": 97477863, "body": "When you split the loops, for your largest case you will have cache evictions and double the number of cache misses in your &quot;half parallel&quot; case. A NUMA platform could exaggerate the problem.   In your smaller case, vectorization with omp simd reduction should be more effective than tthreading.  Depending on your compiler and option settings, you may have achieved this optimization already.  In typical implementations, omp_wtime will not be accurate for such short time intervals."}], "owner": {"reputation": 23, "user_id": 10761095, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-LUdH_AV_6nM/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gs8VAURa0anM6kTJSNEPrkhh3NVg/mo/photo.jpg?sz=128", "display_name": "no-one", "link": "https://stackoverflow.com/users/10761095/no-one"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1553686530, "creation_date": 1553685603, "last_edit_date": 1553686530, "question_id": 55375951, "link": "https://stackoverflow.com/questions/55375951/code-execution-slower-in-half-parallel-openmp", "title": "code execution slower in half-parallel OpenMP", "body": "<p>good day.\nI want to implement inner product in 3 method:\n1 - sequential\n2 - half-parallel\n3 - full-parallel</p>\n\n<p>half parallel means multiplication in parallel and summation in sequential.</p>\n\n<p>here is my code:</p>\n\n<pre><code>int main(int argc, char *argv[]) {\n    int *x, *y, *z, *w, xy_p, xy_s, xy_ss, i, N=5000;\n    double s, e;\n    x = (int *) malloc(sizeof(int)*N);\n    y = (int *) malloc(sizeof(int)*N);\n    z = (int *) malloc(sizeof(int)*N);\n    w = (int *) malloc(sizeof(int)*N);\n\n    for(i=0; i &lt; N; i++) {\n        x[i] = rand();\n        y[i] = rand();\n        z[i] = 0;\n    }\n\n    s = omp_get_wtime();\n\n    xy_ss = 0;\n\n    for(i=0; i &lt; N; i++)\n    {\n        xy_ss += x[i] * y[i];\n    }\n\n    e = omp_get_wtime() - s;\n    printf ( \"[**] Sequential execution time is:\\n%15.10f and &lt;A,B&gt; is %d\\n\", e, xy_ss );\n\n\n    s = omp_get_wtime();\n\n    xy_s = 0;\n\n    #pragma omp parallel for shared ( N, x, y, z ) private ( i )\n    for(i = 0; i &lt; N; i++)\n    {\n        z[i] = x[i] * y[i];\n    }\n    for(i=0; i &lt; N; i++)\n    {\n        xy_s += z[i];\n    }\n\n    e = omp_get_wtime() - s;\n    printf ( \"[**] Half-Parallel execution time is:\\n%15.10f and &lt;A,B&gt; is %d\\n\", e, xy_s );\n\n\n    s = omp_get_wtime();\n\n    xy_p = 0;\n\n    # pragma omp parallel shared (N, x, y) private(i)\n    # pragma omp for reduction ( + : xy_p )\n    for(i = 0; i &lt; N; i++)\n    {\n        xy_p += x[i] * y[i];\n    }\n    e = omp_get_wtime() - s;\n    printf ( \"[**] Full-Parallel execution time is:\\n%15.10f and &lt;A,B&gt; is %d\\n\", e, xy_p );\n}\n</code></pre>\n\n<p>so I have some question:\nfirst I want to know: does my code correct?!!!!\nsecond: why half-parallel is faster than sequential?!\nthird: is 5000 a good size for parallelism?\nand finally why sequential is the fastest? because of 5000?!\nan sample output:</p>\n\n<blockquote>\n  <p>Sequential execution time is:\n      0.0000196100 and dot is -1081001655</p>\n  \n  <p>Half-Parallel execution time is:\n     0.0090819710 and dot is -1081001655</p>\n  \n  <p>Full-Parallel execution time is:\n     0.0080959420 and dot is -1081001655</p>\n</blockquote>\n\n<p>and for N=5000000</p>\n\n<blockquote>\n  <p>Sequential execution time is:\n    0.0150297650 and  is -1629514371</p>\n  \n  <p>Half-Parallel execution time is:\n    0.0292110600 and  is -1629514371</p>\n  \n  <p>Full-Parallel execution time is:\n    0.0072323760 and  is -1629514371</p>\n</blockquote>\n\n<p>anyway, why half-parallel is the slowest?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1553685275, "post_id": 55375822, "comment_id": 97473682, "body": "In your <code>Compare</code> function you go out of bounds of the <code>adata</code> array."}, {"owner": {"reputation": 432, "user_id": 4249714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe3cdf02d97c4849cdd40b4bfde7f458?s=128&d=identicon&r=PG&f=1", "display_name": "sebastian", "link": "https://stackoverflow.com/users/4249714/sebastian"}, "edited": false, "score": 1, "creation_date": 1553685456, "post_id": 55375822, "comment_id": 97473808, "body": "you never <code>return</code> a value from <code>Read</code>"}, {"owner": {"reputation": 3, "user_id": 11265782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/903b77af3fc6baf3f9e3f72cd9ef51a2?s=128&d=identicon&r=PG&f=1", "display_name": "user11265782", "link": "https://stackoverflow.com/users/11265782/user11265782"}, "reply_to_user": {"reputation": 432, "user_id": 4249714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe3cdf02d97c4849cdd40b4bfde7f458?s=128&d=identicon&r=PG&f=1", "display_name": "sebastian", "link": "https://stackoverflow.com/users/4249714/sebastian"}, "edited": false, "score": 0, "creation_date": 1553685886, "post_id": 55375822, "comment_id": 97474068, "body": "@sebastian Thank you for reply, What value should I return in &quot;Read()&quot; function, I have tried to return &quot;adata&quot; but it is giving me an error &quot;Error[Pe120]: return value type (&quot;int16_t *&quot;) does not match the function type (&quot;int16_t&quot;)&quot; even after trying to return &quot;buffer&quot;"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553686525, "post_id": 55375822, "comment_id": 97474460, "body": "you never return a value in <i>Compare</i>, you just set a <i>local</i> array never used after, and never do something near of a compare, why the name &#39;Compare&#39; ? <i>Compare</i> do not use its parameters. In <i>Read</i> you set also the <i>local</i> array <i>adata</i> for nothing"}, {"owner": {"reputation": 3, "user_id": 11265782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/903b77af3fc6baf3f9e3f72cd9ef51a2?s=128&d=identicon&r=PG&f=1", "display_name": "user11265782", "link": "https://stackoverflow.com/users/11265782/user11265782"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553687226, "post_id": 55375822, "comment_id": 97474904, "body": "@bruno I have made changes based on your comments, but unable to get the values of &quot;buffer&quot; in &quot;Compare()&quot; function. it is showing garbage values........."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553687269, "post_id": 55375822, "comment_id": 97474937, "body": "@user11265782 you missed a lot of things, sorry. You also have a lot of variables just declared or set for nothing (format, head ...), counter useless because always valuing totalBytes ... And it is not really possible to understand what you want to give you a better proposal. what are FWmsg and arduinodata you added ?"}, {"owner": {"reputation": 3, "user_id": 11265782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/903b77af3fc6baf3f9e3f72cd9ef51a2?s=128&d=identicon&r=PG&f=1", "display_name": "user11265782", "link": "https://stackoverflow.com/users/11265782/user11265782"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553687790, "post_id": 55375822, "comment_id": 97475230, "body": "@bruno removed as suggested, actually I have kept that as was using in other part of code....... Can you guide me where I am going wrong with the above problem? Thank you"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553688069, "post_id": 55375822, "comment_id": 97475415, "body": "ok I will put in an answer all the strange things I see in your current version of the question"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1553688378, "post_id": 55375822, "comment_id": 97475613, "body": "You should enable all warnings in your compiler. For GCC you could use options <code>-Wall -Wextra</code> and then read all warnings and take care of them. The compiler should tell you if you don&#39;t return anything."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553691759, "post_id": 55375822, "comment_id": 97477820, "body": "@user11265782 I put my &#39;answer&#39;, you can read it"}], "answers": [{"tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 0, "last_activity_date": 1553691694, "last_edit_date": 1553691694, "creation_date": 1553689716, "answer_id": 55377229, "question_id": 55375822, "link": "https://stackoverflow.com/questions/55375822/need-to-read-value-of-array-elements-from-one-function-inside-another-function-u/55377229#55377229", "title": "Need to read value of array elements from one function inside another function using pointer", "body": "<p>Note : this is not <em>stricto sensu</em> an 'answer' but more a list of remarks</p>\n\n<hr>\n\n<p><strong>About <em>Read</em></strong></p>\n\n<p>the signature is</p>\n\n<blockquote>\n<pre><code>int16_t *Read (uint8_t *buffer, const uint16_t length)\n</code></pre>\n</blockquote>\n\n<p>but the function never return a value, probably you want to return the number of read bytes, in that case </p>\n\n<pre><code>int16_t Read (uint8_t *buffer, const uint16_t length)\n</code></pre>\n\n<hr>\n\n<p>The static variable <em>respNo</em> is only incremented and never used, these two lines can be removed :</p>\n\n<blockquote>\n<pre><code>static uint32_t respNo = 0;\nrespNo++;\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>There is no reason to have <em>totalBytes</em> static because you reset its value to 0 before to print the buffer, so there is no historic from a call to the next. It must be <em>local</em>.</p>\n\n<p><em>counter</em> is useless because it always value <em>totalBytes</em></p>\n\n<hr>\n\n<p><em>UartReceive</em> always success and never returns a value indicating an error ?</p>\n\n<ul>\n<li>if yes it is useless <em>Read</em> returns a value because it will always be <em>length</em></li>\n<li>if no you have to take into account the error and probably <em>Read</em> have to return <em>totalBytes</em> valuing the number of read bytes</li>\n</ul>\n\n<hr>\n\n<p>In</p>\n\n<blockquote>\n<pre><code> printf(\"\\n\");\n printf(\"Byte received........\");\n int16_t adata[9] = {0x09,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30}; \n\n for (i=0; i&lt;9;i++)\n {\n  printf(\"%d  \",buffer[i]);\n  adata[i] = buffer[i];\n } \n  printf(\"\\n\");\n</code></pre>\n</blockquote>\n\n<ul>\n<li>you loop from 1 to 9 rather than from 0 to 8 so you at least go out of <em>adata</em> and you do not print the value of the first byte in <em>buffer</em></li>\n<li>you only set <em>adata</em> and you never use it, it can be removed.</li>\n<li>the format must be <em>%u</em> rather than <em>%d</em> </li>\n</ul>\n\n<p>Probably the loop must be from 0 to <code>totalBytes - 1</code> to be compatible with the code above :</p>\n\n<blockquote>\n<pre><code> printf(\"\\nByte received : \");\n\n for (i=0; i&lt;totalBytes;i++)\n {\n  printf(\"%u \",buffer[i]);\n } \n putchar('\\n');\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p><strong>About <em>Compare</em></strong></p>\n\n<p>In</p>\n\n<blockquote>\n<pre><code> rs485_message_t rs485Msg;\n int StP15Vmsg[9] = {0x09,0x31,0x33,0x30,0x30,0x30,0x30,0x30,0x34};    \n int adata[9] = {0x09,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30};  \n uint8_t buffer[9];\n const uint8_t length;\n for (int j=0; j&lt;=9; j++)\n {\n  adata[j] = *Read(buffer, j);\n }\n</code></pre>\n</blockquote>\n\n<p><em>rs485Msg</em> and <em>StP15Vmsg</em> are useless, remove them</p>\n\n<p>I do not understand why you call <em>Read</em> several times in the loop with a length incremented each time, so you will rewrite several times on the <em>buffer</em>. I do not understand too while you save the return value of <em>Read</em> (who do return a value currently) </p>\n\n<p>Probably you want just that :</p>\n\n<pre><code>uint8_t buffer[9];\nuint8_t length = Read(buffer, 9);\n</code></pre>\n\n<p>In</p>\n\n<blockquote>\n<pre><code>if(compareArray(FWmsg,arduinodata,7)==0)\n {     \n  char res;  \n  uint8_t add, fwcommand, fwaction;\n  uint16_t fwvalue;\n  rs485_message_t rs485Msg; \n  proto485ComposeMsg(&amp;rs485Msg, &amp;add, &amp;fwcommand, &amp;fwaction, &amp;fwvalue);\n  res = GetABFWversion(&amp;add, &amp;fwcommand, &amp;fwaction, &amp;fwvalue); \n }\n</code></pre>\n</blockquote>\n\n<p>I do not a link with the code above, and <em>res</em> is set but never used</p>\n\n<hr>\n\n<p><em>Compare</em> never does a comparison, why it is named <em>Compare</em> ?\nIt never returns a value, what value is it supposed to return ?</p>\n"}], "owner": {"reputation": 3, "user_id": 11265782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/903b77af3fc6baf3f9e3f72cd9ef51a2?s=128&d=identicon&r=PG&f=1", "display_name": "user11265782", "link": "https://stackoverflow.com/users/11265782/user11265782"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 55377229, "answer_count": 1, "score": 0, "last_activity_date": 1553691694, "creation_date": 1553685128, "last_edit_date": 1553687672, "question_id": 55375822, "link": "https://stackoverflow.com/questions/55375822/need-to-read-value-of-array-elements-from-one-function-inside-another-function-u", "title": "Need to read value of array elements from one function inside another function using pointer", "body": "<p>I am developing a code in which I need to read value from one function (\"Read()\") into another function (\"compare\") using pointer. Need to access values of \"buffer\" present in function \"Read()\". I have tried below approach, I am new with pointers implementation so not able to try much. \"buffer\" will have 9 elements which I have copied in \"adata\" in \"Read()\" function, need to have that data in \"Compare\" function.\nBelow is my code snippet:</p>\n\n<pre><code>    int16_t *Read (uint8_t *buffer, const uint16_t length)\n    {\n      static uint32_t totalBytes = 0;\n      static uint32_t respNo = 0;\n      int i;\n\n      GPIO_ClearValue(PMAP_GPIO_PORT_DIR_RS485, PMAP_GPIO_PIN_DIR_RS485);             \n\n      UartRxFlush(UARW_UART_INDEX_RS485); //this function needs to be executed after the GPIO_ClearValue in order to remove the \"zero\" value from the buffer\n      respNo++;\n\n      int counter = 0; // counts n. valid bytes put in slave response buffer[]\n      do \n      {\n        OSTimeDly(2);\n\n        int8_t newBytesRcv = UartReceive(UARW_UART_INDEX_RS485,\n                                         (uint8_t*)&amp;(buffer[counter]), length-counter);\n        totalBytes += newBytesRcv;\n        counter = totalBytes;\n      }\n      while (counter &lt; length);\n\n      totalBytes = 0;\n      printf(\"\\n\");\n      printf(\"Byte received........\");\n      int16_t adata[9] = {0x09,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30};  \n\n      for (i=0; i&lt;9;i++)\n      {\n       printf(\"%d  \",buffer[i]);\n       adata[i] = buffer[i];\n      } \n       printf(\"\\n\");\n\n    }\n\n    int16_t Compare(uint8_t * message, uint16_t len)\n    {\n      rs485_message_t rs485Msg;\n      int StP15Vmsg[9] = {0x09,0x31,0x33,0x30,0x30,0x30,0x30,0x30,0x34};    \n      int adata[9] = {0x09,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30};  \n      uint8_t buffer[9];\n      const uint8_t length;\n      for (int j=0; j&lt;=9; j++)\n      {\n       adata[j] = *Read(buffer, j);\n      }\nif(compareArray(FWmsg,arduinodata,7)==0)\n  {  \n\n   char res;  \n   uint8_t add, fwcommand, fwaction;\n   uint16_t fwvalue;\n   rs485_message_t rs485Msg; \n   proto485ComposeMsg(&amp;rs485Msg, &amp;add, &amp;fwcommand, &amp;fwaction, &amp;fwvalue);\n   res = GetABFWversion(&amp;add, &amp;fwcommand, &amp;fwaction, &amp;fwvalue); \n  }\n     }\n</code></pre>\n\n<p>Please guide....</p>\n\n<p>Thank you</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1553684001, "post_id": 55375391, "comment_id": 97472869, "body": "200x200 is consistent with <code>a&#47;4</code> with <code>a=200</code>. Just guessing, I would change the <code>a</code> and <code>b</code> passed to the function with a smaller value."}, {"owner": {"reputation": 1, "user_id": 11265669, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Af_KUJRiZaI/AAAAAAAAAAI/AAAAAAAAACY/6badguZx55Q/photo.jpg?sz=128", "display_name": "Johnnyfahey", "link": "https://stackoverflow.com/users/11265669/johnnyfahey"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1553684409, "post_id": 55375391, "comment_id": 97473122, "body": "First of all, thankyou for your help, i REALLY want to solve this, second of all, changing the value being passed to the function changed the size of the blocks of pixels, but didn&#39;t increase &quot;resolution&quot;"}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1553684556, "post_id": 55375391, "comment_id": 97473215, "body": "Note that in <code>double Ex=(x&#47;(a&#47;4));</code> the calculations are in ints and only the result is converted to double. Use <code>double Ex=(x&#47;((double)a&#47;4));</code>"}, {"owner": {"reputation": 1, "user_id": 11265669, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Af_KUJRiZaI/AAAAAAAAAAI/AAAAAAAAACY/6badguZx55Q/photo.jpg?sz=128", "display_name": "Johnnyfahey", "link": "https://stackoverflow.com/users/11265669/johnnyfahey"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1553684791, "post_id": 55375391, "comment_id": 97473375, "body": "Oh my god I love you! I KNEW it would be something like that. you have my eternal gratitude Paul :D"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1553686345, "post_id": 55375391, "comment_id": 97474345, "body": "Using <code>4.0</code> would also force the real arithmetic."}], "owner": {"reputation": 1, "user_id": 11265669, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Af_KUJRiZaI/AAAAAAAAAAI/AAAAAAAAACY/6badguZx55Q/photo.jpg?sz=128", "display_name": "Johnnyfahey", "link": "https://stackoverflow.com/users/11265669/johnnyfahey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1553683755, "creation_date": 1553683755, "question_id": 55375391, "link": "https://stackoverflow.com/questions/55375391/how-to-get-more-detail-in-a-mandelbrot-ppm-image", "title": "How to get more detail in a mandelbrot ppm image", "body": "<p>When i generate a PPM in C, that aims to represent the Mandelbrot fractal, I only get 4 pixels with colouration indicating they fall within the set. This makes sense, however when I scale it up, and have my 800X800 image with each pixel representing a number between -2->2 I get no extra detail within the fractal, it is just \"4\" pixels as in the first image, however each one has a size of 200x200.</p>\n\n<p>I have tried: \n-using a constant in place of (a/4) and (b/4) in my second function.\n-Changing dimensions of image.\n-using constants within my FOR loop.\n-evaluating each pixel within the main() function instead of a separate function.\n-changing the value of my iterations variable when testing for inclusion within the set. </p>\n\n<pre><code>#include &lt;math.h&gt;\n\nint inMandelbrot(int x, int y, int a, int b);\nint main(){\n    const int dimx = 800, dimy = 800;\n    int x,y;\n    FILE *mandelbrot;\n    mandelbrot = fopen(\"mandelbrot.ppm\",\"w\");\n    fprintf(mandelbrot, \"P3\\n%d %d\\n255\\n\", dimx, dimy);\n        for (y=-dimy/2; y&lt; dimy/2 ;++y){\n            for(x=-dimx/2;x&lt;dimx/2;++x){\n                if (inMandelbrot(x,y,dimx,dimy)==1){\n                    fprintf(mandelbrot, \"0 255 0\\n\");\n                }\n                else if (inMandelbrot(x,y,dimx,dimy)==0){\n                    fprintf(mandelbrot, \"0 0 255\\n\");\n                }\n                else if (inMandelbrot(x,y,dimx,dimy)==2){\n                    fprintf(mandelbrot, \"225 225 225\\n\");\n                }\n            }\n        }\n       (void) fclose(mandelbrot);\n        return 1;\n}\n\nint inMandelbrot(int x, int y, int a, int b){\n    double xnew,xold,ynew,yold;\n    double Ex=(x/(a/4));\n    double Ey=(y/(b/4));\n    int iterations=0;\n        xnew=0;\n        ynew=0;\n        yold=0;\n        xold=0;\n        while((xnew*xnew+ynew*ynew&lt;4)&amp;&amp;(iterations&lt;10000)){\n                xnew=(xold*xold-yold*yold)+Ex;\n                ynew=(2*xold*yold)+Ey;\n                iterations++;\n                xold=xnew;\n                yold=ynew;\n        }\n        if (xnew*xnew+ynew*ynew&gt;=4){\n                iterations--;\n                return 1;\n        }\n        else if (iterations&gt;=10000){\n            return 0;\n            }\n        return 2;\n    }\n</code></pre>\n\n<p>I expect the output to look like the mandelbrot fractal with some degree of precision, however it only has 16 200x200 \"pixels\" instead of 64000 pixel sized ones.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 368, "user_id": 6182303, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8k0go.jpg?s=128&g=1", "display_name": "Farshan", "link": "https://stackoverflow.com/users/6182303/farshan"}, "edited": false, "score": 9, "creation_date": 1553681861, "post_id": 55374669, "comment_id": 97471576, "body": "you should use <code>==</code> instead of <code>=</code> in the else if condition"}, {"owner": {"reputation": 6023, "user_id": 2417459, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/QcuXb.png?s=128&g=1", "display_name": "i486", "link": "https://stackoverflow.com/users/2417459/i486"}, "edited": false, "score": 0, "creation_date": 1553684164, "post_id": 55374669, "comment_id": 97472969, "body": "Are you coming from Pascal/Delphi world? <code>if ((input[indexCheck] != &#39;0&#39;) &amp;&amp; (input[indexCheck] != &#39;1&#39;)) </code> is <code>if ( input[indexCheck] != &#39;0&#39; &amp;&amp; input[indexCheck] != &#39;1&#39; )</code>, no need from parenthesis (in addition to <code>=</code> -&gt; <code>==</code> error)."}], "answers": [{"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1553683636, "post_id": 55374777, "comment_id": 97472641, "body": "Keeping it simple and readable is always the best idea indeed."}], "tags": [], "owner": {"reputation": 7825, "user_id": 3684343, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bee557e309dc42d91a706c70c8c0c9f?s=128&d=identicon&r=PG&f=1", "display_name": "mch", "link": "https://stackoverflow.com/users/3684343/mch"}, "is_accepted": true, "score": 9, "last_activity_date": 1553681892, "creation_date": 1553681892, "answer_id": 55374777, "question_id": 55374669, "link": "https://stackoverflow.com/questions/55374669/how-do-i-check-if-a-string-only-contains-one-and-zero/55374777#55374777", "title": "How do I check if a string only contains one and zero?", "body": "<p>I would make a function for this:</p>\n\n<pre><code>int isBinary(const char *input)\n{\n    for (int i = 0; input[i]; ++i)\n        if (input[i] != '0' &amp;&amp; input[i] != '1')\n            return 0;\n    return 1;\n}\n</code></pre>\n\n<p>Then you can call the function:</p>\n\n<pre><code>if (isBinary(\"0001110110101\"))\n    printf(\"is binary\\n\");\nelse\n    printf(\"is not binary\\n\");\n</code></pre>\n\n<p><a href=\"https://ideone.com/tKBCbf\" rel=\"noreferrer\">https://ideone.com/tKBCbf</a></p>\n"}, {"tags": [], "owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "is_accepted": false, "score": 1, "last_activity_date": 1553683112, "last_edit_date": 1553683112, "creation_date": 1553681899, "answer_id": 55374781, "question_id": 55374669, "link": "https://stackoverflow.com/questions/55374669/how-do-i-check-if-a-string-only-contains-one-and-zero/55374781#55374781", "title": "How do I check if a string only contains one and zero?", "body": "<p>You can do:</p>\n\n<pre><code>while (indexCheck &lt; 32) \n{\n    if ((input[indexCheck] != '0') &amp;&amp; (input[indexCheck] != '1'))\n    {\n        break;\n    }\n    else\n    {\n        indexCheck++;\n    } \n}\nif (indexCheck == 32)\n    printf(\"is binary \");\nelse\n    printf(\"is not binary \");\n</code></pre>\n\n<p>Only when it has processed all elements and did not encounter a non 1-or-0 ends the loop with <code>indexCheck == 32</code> so you can use that to determine what to print.</p>\n\n<p>Note also that your <code>else</code> condition is not needed.</p>\n"}, {"comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 4, "creation_date": 1553683654, "post_id": 55374882, "comment_id": 97472649, "body": "A good and clever answer, but it doesn&#39;t help the OP in learning processing of characters manually."}], "tags": [], "owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "is_accepted": false, "score": 12, "last_activity_date": 1553682218, "creation_date": 1553682218, "answer_id": 55374882, "question_id": 55374669, "link": "https://stackoverflow.com/questions/55374669/how-do-i-check-if-a-string-only-contains-one-and-zero/55374882#55374882", "title": "How do I check if a string only contains one and zero?", "body": "<p>Instead of looping manually through the string, you can see if it only contains certain characters by checking to see if <a href=\"https://en.cppreference.com/w/c/string/byte/strspn\" rel=\"noreferrer\">strspn()</a> returns the length of the string (By seeing if the index of the value it returns is the 0 terminator at the end of the string):</p>\n\n<pre><code>_Bool is_binary(const char *s) {\n  if (!s || !*s) {\n    return 0;\n  }\n  return s[strspn(s, \"01\")] == '\\0';\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 829, "user_id": 5569396, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q5Prh.jpg?s=128&g=1", "display_name": "Gor Asatryan", "link": "https://stackoverflow.com/users/5569396/gor-asatryan"}, "is_accepted": false, "score": 1, "last_activity_date": 1554325266, "last_edit_date": 1554325266, "creation_date": 1553683145, "answer_id": 55375201, "question_id": 55374669, "link": "https://stackoverflow.com/questions/55374669/how-do-i-check-if-a-string-only-contains-one-and-zero/55375201#55375201", "title": "How do I check if a string only contains one and zero?", "body": "<pre><code>    int isBinary = 1;\n    while (input[indexCheck] != '\\0')\n    {\n        if (input[indexCheck] != '1' &amp;&amp; input[indexCheck] != '0')\n        {\n            isBinary = 0;\n            break;\n        }\n        ++indexCheck;\n    }\n    if (isBinary)\n    {\n        printf(\"binary\");\n    }\n    else\n    {\n        printf(\"not binary\");\n    }\n</code></pre>\n\n<p>Check each element in string <code>input</code>. If <code>input[index]</code> is not <code>0</code> or <code>1</code> the flag <code>isBinary</code> becomes <code>0</code> and breaks <code>while</code>. And you do not need length of string.</p>\n"}, {"tags": [], "owner": {"reputation": 29, "user_id": 10679021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34fc5a89a4c8415c0be31881fd4e4645?s=128&d=identicon&r=PG&f=1", "display_name": "vilidigonzales", "link": "https://stackoverflow.com/users/10679021/vilidigonzales"}, "is_accepted": false, "score": 1, "last_activity_date": 1553685676, "creation_date": 1553685676, "answer_id": 55375978, "question_id": 55374669, "link": "https://stackoverflow.com/questions/55374669/how-do-i-check-if-a-string-only-contains-one-and-zero/55375978#55375978", "title": "How do I check if a string only contains one and zero?", "body": "<p>there is a block of code for you with comments.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define STRING_SIZE 32 // Better to use #define for reusability\n\n// Function prototype\nint isBinary(char * testInput);\n\n// Main program\nint main(void)\n{\n    // Test inputs\n    char testInputBinary[33] = \"01010101010101010101010101010101\";\n    char testInputNotBinary[33] = \"010101010101010101010101010101ab\";\n\n    // Test &amp; collect results\n    if (isBinary(testInputBinary))\n    {\n        printf(\"Binary ! \\n\");\n    }\n    else\n    {\n        printf(\"Not binary ! \\n\");\n    }\n\n\n    if (isBinary(testInputNotBinary))\n    {\n        printf(\"Binary ! \\n\");\n    }\n    else\n    {\n        printf(\"Not binary ! \\n\");\n    }\n\n    return EXIT_SUCCESS;\n}\n\nint isBinary(char * testInput)\n{\n    int loopIdx = 0; // Loop index\n    int returnVal = 0; // 0: False, 1: True\n\n    // iterate over string\n    for (loopIdx = 0; loopIdx &lt; STRING_SIZE; loopIdx++)\n    {\n        if(testInput[loopIdx] != '0' &amp;&amp; testInput[loopIdx] != '1')\n        {\n            break;\n        }\n    }\n\n    // If the loop is not broken, it means all characters are in binary form\n    if (loopIdx == STRING_SIZE)\n    {\n        returnVal = 1;\n    } // No need to writing else clause since returnVal = 0 at the beginning\n\n    return returnVal;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 161, "user_id": 5148033, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yb9AK.jpg?s=128&g=1", "display_name": "anfauglit", "link": "https://stackoverflow.com/users/5148033/anfauglit"}, "is_accepted": false, "score": 2, "last_activity_date": 1553696990, "creation_date": 1553696990, "answer_id": 55379713, "question_id": 55374669, "link": "https://stackoverflow.com/questions/55374669/how-do-i-check-if-a-string-only-contains-one-and-zero/55379713#55379713", "title": "How do I check if a string only contains one and zero?", "body": "<p>You can stop looping through the string the moment you find a character which is neither '0' nor '1'. After the loop is terminated, you check whether or not you've reached the end of the string, i.e. the current character is a null character <code>'\\0'</code></p>\n\n<pre><code>while (*s == '0' || *s == '1') ++s;\n\nif (*s)\n    puts(\"not binary\");\nelse\n    puts(\"binary\");\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 10982416, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-okTV88ph-So/AAAAAAAAAAI/AAAAAAAAARQ/0034dnvDpR4/photo.jpg?sz=128", "display_name": "Hass", "link": "https://stackoverflow.com/users/10982416/hass"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1660, "favorite_count": 0, "accepted_answer_id": 55374777, "answer_count": 6, "score": 1, "last_activity_date": 1554325266, "creation_date": 1553681529, "question_id": 55374669, "link": "https://stackoverflow.com/questions/55374669/how-do-i-check-if-a-string-only-contains-one-and-zero", "title": "How do I check if a string only contains one and zero?", "body": "<p>I am trying to detect whether a string contains only the characters '0' and '1'. This is what I have so far:</p>\n\n<pre><code>    while (indexCheck &lt; 32) {\n\n        if ((input[indexCheck] != '0') &amp;&amp; (input[indexCheck] != '1')) {\n\n            printf(\"not binary \");\n            indexCheck++;\n\n        }  else if ((input[indexCheck] = '0') &amp;&amp; (input[indexCheck] = '1')) {\n            indexCheck++;\n            printf(\"is binary \");\n\n        } \n\n    }\n</code></pre>\n\n<p>I know why it returns \"is binary\" or \"not binary\" for every single character in the array, but I don't know how to fix this. I want it to return \"is binary\" once if the string is only made of '1' and '0', and the opposite if this is false. I'm new to C so all help is appreciated.</p>\n"}, {"tags": ["c", "cmake", "linker"], "comments": [{"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 1, "creation_date": 1553680617, "post_id": 55374218, "comment_id": 97470805, "body": "Can you show the commands you are using to build the libraries and the executable in both cases, when it works and when not?"}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1553680633, "post_id": 55374218, "comment_id": 97470815, "body": "What do you mean with &quot;relocatrable&quot;? Your makefile should have the paths to find the libraries and you must give that to the link command. The requried objects of the libraries are extracted and combined into the executable."}, {"owner": {"reputation": 217, "user_id": 1029462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/290e269c9535090ea7a9fae42578f358?s=128&d=identicon&r=PG", "display_name": "Darkiwi", "link": "https://stackoverflow.com/users/1029462/darkiwi"}, "reply_to_user": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 0, "creation_date": 1553680953, "post_id": 55374218, "comment_id": 97471013, "body": "@Bodo I use cmake to generate cygwin makefiles and simply use the make command to build and make install to export to my repository"}, {"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 1, "creation_date": 1553681208, "post_id": 55374218, "comment_id": 97471183, "body": "@Darkiwi You should <a href=\"https://stackoverflow.com/posts/55374218/edit\">edit</a> your question to add clarification. It might be good to show the CMakeLists.txt file(s) and show how your workspace looks like."}, {"owner": {"reputation": 217, "user_id": 1029462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/290e269c9535090ea7a9fae42578f358?s=128&d=identicon&r=PG", "display_name": "Darkiwi", "link": "https://stackoverflow.com/users/1029462/darkiwi"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1553681231, "post_id": 55374218, "comment_id": 97471197, "body": "@PaulOgilvie In A, B and C, I set the target properties and avoid setting anything with an absolute path, then I export the target. this exports the binaries, the cmake files (Config and Targets) and the includes. When importing, i use find_package that locates the Config file and imports all cmake variables. I link all dynamically so the dlls should be path independent, right?"}, {"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 1, "creation_date": 1553681373, "post_id": 55374218, "comment_id": 97471293, "body": "@Darkiwi Don&#39;t answer in comments, <a href=\"https://stackoverflow.com/posts/55374218/edit\">edit</a> your question to add more information."}, {"owner": {"reputation": 217, "user_id": 1029462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/290e269c9535090ea7a9fae42578f358?s=128&d=identicon&r=PG", "display_name": "Darkiwi", "link": "https://stackoverflow.com/users/1029462/darkiwi"}, "reply_to_user": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 0, "creation_date": 1553681774, "post_id": 55374218, "comment_id": 97471522, "body": "@Bodo Good point, done ;-)"}], "answers": [{"tags": [], "owner": {"reputation": 217, "user_id": 1029462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/290e269c9535090ea7a9fae42578f358?s=128&d=identicon&r=PG", "display_name": "Darkiwi", "link": "https://stackoverflow.com/users/1029462/darkiwi"}, "is_accepted": true, "score": 0, "last_activity_date": 1554381452, "creation_date": 1554381452, "answer_id": 55516167, "question_id": 55374218, "link": "https://stackoverflow.com/questions/55374218/cmake-link-issue-with-relocated-libraries/55516167#55516167", "title": "CMake link issue with relocated libraries", "body": "<p>The Cygwin issue came from access rights: copying the files in Windows was setting \"default\" very restricted access rights in cygwin, which caused the runtime issue described.</p>\n\n<p>I used a chmod in cygwin after the copy / before the build and link and it solved the issue.</p>\n"}], "owner": {"reputation": 217, "user_id": 1029462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/290e269c9535090ea7a9fae42578f358?s=128&d=identicon&r=PG", "display_name": "Darkiwi", "link": "https://stackoverflow.com/users/1029462/darkiwi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 55516167, "answer_count": 1, "score": 0, "last_activity_date": 1554381452, "creation_date": 1553680238, "last_edit_date": 1553681489, "question_id": 55374218, "link": "https://stackoverflow.com/questions/55374218/cmake-link-issue-with-relocated-libraries", "title": "CMake link issue with relocated libraries", "body": "<p>I have a cascade of libraries  A, B, C with B depending on A and C depending on A and B.</p>\n\n<p>I have a final library D and an executable using it. D depends on A, B and C.</p>\n\n<p>When building and exporting each library at a time to a local repository, everything is fine: D builds, links and the executable works fine.\nWhen manually copying the repository containing A, B, C to another location (and importing to D from that other location), the results are variable:</p>\n\n<ul>\n<li><p>Everything works fine on Windows (Visual Studio),</p></li>\n<li><p>There's a runtime issue on Cygwin.</p></li>\n</ul>\n\n<p>The issue is as follows:</p>\n\n<ul>\n<li><p>D builds and links,</p></li>\n<li><p>When running the executable, it crashes immediately,</p></li>\n<li><p>When inspecting D with the \"ldd\" command, it shows strange things</p></li>\n</ul>\n\n<p>:</p>\n\n<pre><code>??? =&gt; ??? (0x53a570000)\n\n??? =&gt; ??? (0x180040000)\n</code></pre>\n\n<p>I have tried to make my libraries relocatable but it seems I have missed something...\nIn the exported target file, there is no absolute path though.</p>\n\n<p>I have seen something about SO_NAME on google so I tried this in D after importing A, B and C:</p>\n\n<pre><code>set_property(TARGET A PROPERTY IMPORTED_NO_SONAME 1)\n</code></pre>\n\n<p>but it did not solve the issue.</p>\n\n<p>I'm lost, can somebody please help me ?</p>\n\n<p>EDIT:</p>\n\n<p>The exporting code for A:</p>\n\n<pre><code># Library\nadd_library(mylibA SHARED\n    ${SOURCE_FILES}\n    ${PUBLIC_HEADERS}\n)\nset_target_properties(mylibA PROPERTIES\n    PUBLIC_HEADER \"${PUBLIC_HEADERS}\"\n    INTERFACE_LINK_LIBRARIES mylibA\n)\ntarget_include_directories(mylibA\n    PUBLIC\n        $&lt;BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/includes&gt;\n        $&lt;INSTALL_INTERFACE:include&gt;\n)\ntarget_link_libraries(mylibA)\n\n# Packaging\nif(ENABLE_MYLIBA_PACKAGING)\n    # Install target to export\n    install(TARGETS mylibA\n        EXPORT mylibA-export\n        LIBRARY DESTINATION \"bin\"\n        ARCHIVE DESTINATION \"bin\"\n        RUNTIME DESTINATION \"bin\"\n        PUBLIC_HEADER DESTINATION \"include/mylibA\"\n    )\n    # Install export\n    install(EXPORT mylibA-export\n        FILE mylibATargets.cmake\n        CONFIGURATIONS Debug|Release\n        DESTINATION \"cmake\"\n    )\n    # Install config file\n    install(FILES mylibAConfig.cmake\n        CONFIGURATIONS Debug|Release\n        DESTINATION \"cmake\"\n    )\n    export(PACKAGE mylibA)\nendif()\n</code></pre>\n\n<p>Import code in D's cmake:</p>\n\n<pre><code># Import\nfind_package(mylibA PATHS ${REPO_PATH})\nfind_package(mylibB PATHS ${REPO_PATH})\nfind_package(mylibC PATHS ${REPO_PATH})\n\n# Library\nadd_library(mylibD SHARED\n  ${SOURCE_FILES}\n  ${CONFIG_HEADERS}\n  ${PUBLIC_HEADERS}\n)\nset_target_properties(mylibD PROPERTIES\n    PUBLIC_HEADER \"${PUBLIC_HEADERS}\"\n)\ntarget_include_directories(mylibD\n    PUBLIC\n        $&lt;BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/../inc&gt;\n        $&lt;BUILD_INTERFACE:${mylibA_INCLUDE_DIR}&gt;\n)\ntarget_link_libraries(mylibD\n    PUBLIC mylibA\n    PUBLIC mylibB\n    PUBLIC mylibC\n)\n</code></pre>\n"}, {"tags": ["c", "if-statement", "do-while", "logical-operators", "getchar"], "comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 2, "creation_date": 1553679310, "post_id": 55373857, "comment_id": 97470011, "body": "<code>if (getchar()==&#39;x&#39;|| getchar()==&#39;X&#39;)</code> This gets <b>two</b> characters. You want: <code>if ((c=getchar())==&#39;x&#39;|| c==&#39;X&#39;)</code>"}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1553679406, "post_id": 55373857, "comment_id": 97470076, "body": "Note also that after the user entered the letter and pressed enter, the input contains two characters: the letter and a <code>\\n</code>."}, {"owner": {"reputation": 3, "user_id": 11265227, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157075077948077/picture?type=large", "display_name": "Bajro Slatina", "link": "https://stackoverflow.com/users/11265227/bajro-slatina"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1553682378, "post_id": 55373857, "comment_id": 97471875, "body": "Thank you very much for quick reply Paul!"}], "answers": [{"comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553680364, "post_id": 55374194, "comment_id": 97470640, "body": "why the <code>while (input!=&#39;x&#39; || input!=&#39;X&#39;);</code> ? you already know it is false because of the return when x or X is enter. why the second <i>getchar</i> and how can you suppose the user enter a newline just after the first char ?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553680580, "post_id": 55374194, "comment_id": 97470776, "body": "@bruno Because the OP is obviously a beginner trying to figure out how loops work. I didn&#39;t change their code much not to confuse them. It should be &amp;&amp; though, it&#39;s a bug inherited from the original code."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553681569, "post_id": 55374194, "comment_id": 97471409, "body": "so you consider to repeat the tests is a good way to help the OP to learn ? sorry but I strongly disagree ;-)"}, {"owner": {"reputation": 3, "user_id": 11265227, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157075077948077/picture?type=large", "display_name": "Bajro Slatina", "link": "https://stackoverflow.com/users/11265227/bajro-slatina"}, "edited": false, "score": 0, "creation_date": 1553689947, "post_id": 55374194, "comment_id": 97476578, "body": "@Lundin and if I may ask, how do I make it execute agan without do-while if the input is incorrect. Thanks for your previous answers, much appreciated!"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 3, "user_id": 11265227, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157075077948077/picture?type=large", "display_name": "Bajro Slatina", "link": "https://stackoverflow.com/users/11265227/bajro-slatina"}, "edited": false, "score": 0, "creation_date": 1553690733, "post_id": 55374194, "comment_id": 97477090, "body": "@BajroSlatina The only sensible way to achieve that is to use a loop. <code>while</code>,  <code>do while</code> or <code>for</code>."}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 0, "last_activity_date": 1553680707, "last_edit_date": 1553680707, "creation_date": 1553680177, "answer_id": 55374194, "question_id": 55373857, "link": "https://stackoverflow.com/questions/55373857/how-to-fix-unexpected-output-using-getchar-and-do-while/55374194#55374194", "title": "How to fix - unexpected output using getchar() and do-while", "body": "<p>You need to store the input in a variable, otherwise you keep asking for input several times in a row, for each <code>getchar</code> call.</p>\n\n<p>For weird historic reasons, <code>getchar</code> actually returns an <code>int</code>, since the value <code>EOF</code> that can be returned from it is an <code>int</code>. So the variable must be <code>int</code>.</p>\n\n<p>And finally, each time the user hits enter, a invisible line feed character <code>\\n</code> is appended to the input stream. This character does you no good, so you should discard it with an extra read.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main (void)\n{\n  int input;\n\n  do\n  {\n    printf(\"Enter x\\n\");\n    input = getchar();\n    getchar(); // extra getchar to chew up line feed from stdin\n\n    if (input=='x'|| input=='X')\n    {\n      printf(\"Entered char is X\\n\");\n    }\n    else\n    {\n      printf(\"Input incorrect! Please try again!!!\\n\");\n    }\n  } while (input!='x' &amp;&amp; input!='X'); \n\n  return 0;\n}\n</code></pre>\n\n<p>Please note that the opposite of <code>input=='x'|| input=='X'</code> is <code>input!='x' &amp;&amp; input!='X'</code> (De Morgan's laws). \"If input is not 'x' and input is not 'X' then loop\".</p>\n"}, {"comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553680467, "post_id": 55374239, "comment_id": 97470698, "body": "please explain the necessity of the do-while ? in case <i>return</i> doesn&#39;t works ? ^^"}, {"owner": {"reputation": 70, "user_id": 6252067, "user_type": "registered", "profile_image": "https://graph.facebook.com/888884047863380/picture?type=large", "display_name": "Prakhar Gajbhiye", "link": "https://stackoverflow.com/users/6252067/prakhar-gajbhiye"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553680760, "post_id": 55374239, "comment_id": 97470900, "body": "@bruno There is in fact no necessity of the do-while condition checking. I wanted the code to be as close as possible to the OP code. Although leaving the condition doesn&#39;t make the code wrong. while(true) should work just fine."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553682173, "post_id": 55374239, "comment_id": 97471765, "body": "warning you cannot detect the EOF using a <i>char</i> for <i>inp</i>, and you <i>hope</i> the second char is a newline ;-)"}, {"owner": {"reputation": 70, "user_id": 6252067, "user_type": "registered", "profile_image": "https://graph.facebook.com/888884047863380/picture?type=large", "display_name": "Prakhar Gajbhiye", "link": "https://stackoverflow.com/users/6252067/prakhar-gajbhiye"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553682751, "post_id": 55374239, "comment_id": 97472112, "body": "@bruno EOF character is generally Ctrl+Z on windows and Ctrl+D in unix like system. By the looks of OP&#39;s code, I believe ENTER (&#39;\\n&#39;) is the key he is pressing after every input. Your warning is duly noted but I believe that he will not be reaching an EOF character at all. He is a beginner as he mentioned, I will not try to complicate things for him."}, {"owner": {"reputation": 70, "user_id": 6252067, "user_type": "registered", "profile_image": "https://graph.facebook.com/888884047863380/picture?type=large", "display_name": "Prakhar Gajbhiye", "link": "https://stackoverflow.com/users/6252067/prakhar-gajbhiye"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553682933, "post_id": 55374239, "comment_id": 97472220, "body": "@bruno Usually you will get an EOF character returning from getchar() when your standard input is other than console (i.e., a file). He is reading from a console, so no need for a EOF check."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553685334, "post_id": 55374239, "comment_id": 97473730, "body": "<i>stdin</i> can be redirect to read in a file, a on a <i>pipe</i> etc, if this is the case without detecting the EOF you will loop without ending"}], "tags": [], "owner": {"reputation": 70, "user_id": 6252067, "user_type": "registered", "profile_image": "https://graph.facebook.com/888884047863380/picture?type=large", "display_name": "Prakhar Gajbhiye", "link": "https://stackoverflow.com/users/6252067/prakhar-gajbhiye"}, "is_accepted": true, "score": -1, "last_activity_date": 1553680891, "last_edit_date": 1553680891, "creation_date": 1553680304, "answer_id": 55374239, "question_id": 55373857, "link": "https://stackoverflow.com/questions/55373857/how-to-fix-unexpected-output-using-getchar-and-do-while/55374239#55374239", "title": "How to fix - unexpected output using getchar() and do-while", "body": "<p>When you hit the <code>ENTER</code> key the newline character <code>\\n</code> is placed in input buffer. You need to consume that newline character in order to read the next character.<br>\nAlso you are reading two time, which is unnecessary in this case. So your code should be like this</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint main()\n{\n         char inp;\n         do\n         {\n            printf(\"Enter x\\n\");\n            inp = getchar();\n            getchar(); // reading the newline character '\\n'\n            if (inp == 'x'|| inp =='X')\n            {\n               printf(\"Entered char is X\\n\");\n               return 0;\n            }\n            else\n            {\n               printf(\"Input incorrect! Please try again!!!\\n\");\n            }\n         }\n         while (inp !='x' || inp !='X');\n     return 0;\n }\n</code></pre>\n\n<blockquote>\n  <p>p.s There is no need to put condition checking in while loop, since you are returning in if condition. <code>while(true)</code> would work fine. Thanks @bruno for pointing that out.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 7807435, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2vKElsbsY3A/AAAAAAAAAAI/AAAAAAAACIg/sUTqQ8iZ5HA/photo.jpg?sz=128", "display_name": "Nitin Solanki", "link": "https://stackoverflow.com/users/7807435/nitin-solanki"}, "edited": false, "score": 0, "creation_date": 1553681339, "post_id": 55374582, "comment_id": 97471275, "body": "for the second part, if your goal is print the message on a new line, then just simply change your printf to:             printf(&quot;\\nInput incorrect! Please try again!!!\\n&quot;);"}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1553681576, "post_id": 55374582, "comment_id": 97471417, "body": "Change <code>char c</code> for <code>int c</code> so <code>EOF</code> can be detected."}, {"owner": {"reputation": 1, "user_id": 7807435, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2vKElsbsY3A/AAAAAAAAAAI/AAAAAAAACIg/sUTqQ8iZ5HA/photo.jpg?sz=128", "display_name": "Nitin Solanki", "link": "https://stackoverflow.com/users/7807435/nitin-solanki"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1553686791, "post_id": 55374582, "comment_id": 97474615, "body": "It should be done if you want to read from file. Not needed for user input."}], "tags": [], "owner": {"reputation": 1, "user_id": 7807435, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2vKElsbsY3A/AAAAAAAAAAI/AAAAAAAACIg/sUTqQ8iZ5HA/photo.jpg?sz=128", "display_name": "Nitin Solanki", "link": "https://stackoverflow.com/users/7807435/nitin-solanki"}, "is_accepted": false, "score": -2, "last_activity_date": 1553681240, "creation_date": 1553681240, "answer_id": 55374582, "question_id": 55373857, "link": "https://stackoverflow.com/questions/55373857/how-to-fix-unexpected-output-using-getchar-and-do-while/55374582#55374582", "title": "How to fix - unexpected output using getchar() and do-while", "body": "<p>In your code:</p>\n\n<pre><code>if (getchar()=='x'|| getchar()=='X')\n</code></pre>\n\n<p>getchar() is called twice.</p>\n\n<p>Instead, you should write it this way:</p>\n\n<pre><code>char c = getchar();\nif (c=='x'|| c=='X')\n</code></pre>\n\n<p>for the second part, if your goal is print the message on a new line, then just simply change your printf to:</p>\n\n<pre><code>printf(\"\\nInput incorrect! Please try again!!!\\n\");\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 11265227, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157075077948077/picture?type=large", "display_name": "Bajro Slatina", "link": "https://stackoverflow.com/users/11265227/bajro-slatina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 55374239, "answer_count": 3, "score": 0, "last_activity_date": 1560765943, "creation_date": 1553679232, "last_edit_date": 1560765943, "question_id": 55373857, "link": "https://stackoverflow.com/questions/55373857/how-to-fix-unexpected-output-using-getchar-and-do-while", "title": "How to fix - unexpected output using getchar() and do-while", "body": "<p>I am trying to make a simple code that will read a char from input and execute \"Correct\" or \"Incorrect input\" and run the code again until the correct input is entered. First of all it does not work for capital X. The other issue that I want to fix is that after the incorrect input I have to press enter to get the \"Enter x\" message, instead of getting in immediately after the incorrect input message.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint main()\n{\n         do\n         {\n            printf(\"Enter x\\n\");\n            if (getchar()=='x'|| getchar()=='X')\n            {\n            printf(\"Entered char is X\\n\");\n            return 0;\n            }\n            else\n            {\n            printf(\"Input incorrect! Please try again!!!\\n\");\n            }\n         }\n         while (getchar()!='x' || getchar()!='X');\n     return 0;\n }\n</code></pre>\n"}, {"tags": ["c", "linux", "exec"], "comments": [{"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 3, "creation_date": 1553679119, "post_id": 55373723, "comment_id": 97469884, "body": "It is not clear what you want to do. <code>getpid()</code> will give you the PID of the current process, <code>fork()</code> returns the PID of the child process to the parent. <code>execlp()</code> is used to execute a different program, i.e. to replace the current process with the new program. Your program tries to execute the directory <code>&#47;usr&#47;include</code> which is expected to fail, passes the same string as argument 0 and tries to interpret the PID of the current process as a <code>char*</code> which is undefined behavior. Please read the man page of the functions you use."}, {"owner": {"reputation": 31, "user_id": 11265149, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_BIXnGN3bBY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdMX22LEmNjVBHApn4DOsyJXrv3cg/mo/photo.jpg?sz=128", "display_name": "Fatimah Ali", "link": "https://stackoverflow.com/users/11265149/fatimah-ali"}, "reply_to_user": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 0, "creation_date": 1553679594, "post_id": 55373723, "comment_id": 97470198, "body": "I did that. My aim is basically to find the pid using execlp() command but I don&#39;t know how so I need help."}, {"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 1, "creation_date": 1553680208, "post_id": 55373723, "comment_id": 97470549, "body": "Please <a href=\"https://stackoverflow.com/posts/55373723/edit\">edit</a> your question to add clarification. It is not clear what you mean with &quot;find the pid&quot;. Your comment does not tell more than what you already wrote in the question. You already have the PID when you call <code>getpid()</code>. <code>execlp()</code> is a function for a different purpose. (It is as if you were asking how to use a hammer to drill a hole.)"}], "answers": [{"comments": [{"owner": {"reputation": 5428, "user_id": 29061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2OmsL.png?s=128&g=1", "display_name": "Jackson", "link": "https://stackoverflow.com/users/29061/jackson"}, "edited": false, "score": 0, "creation_date": 1553682232, "post_id": 55374776, "comment_id": 97471799, "body": "@Fatimah Ali  The question has been edited while I was typing in my answer so it doesn&#39;t exactly match what you have now; however I think it&#39;s close enough for you to work out what you need to do."}, {"owner": {"reputation": 31, "user_id": 11265149, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_BIXnGN3bBY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdMX22LEmNjVBHApn4DOsyJXrv3cg/mo/photo.jpg?sz=128", "display_name": "Fatimah Ali", "link": "https://stackoverflow.com/users/11265149/fatimah-ali"}, "edited": false, "score": 0, "creation_date": 1553683169, "post_id": 55374776, "comment_id": 97472383, "body": "Thanks @Jackson. But can&#39;t I solve this using one program and not 2 programs? Is there a way for one program or it will work this way?"}, {"owner": {"reputation": 5428, "user_id": 29061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2OmsL.png?s=128&g=1", "display_name": "Jackson", "link": "https://stackoverflow.com/users/29061/jackson"}, "reply_to_user": {"reputation": 31, "user_id": 11265149, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_BIXnGN3bBY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdMX22LEmNjVBHApn4DOsyJXrv3cg/mo/photo.jpg?sz=128", "display_name": "Fatimah Ali", "link": "https://stackoverflow.com/users/11265149/fatimah-ali"}, "edited": false, "score": 0, "creation_date": 1553683365, "post_id": 55374776, "comment_id": 97472494, "body": "Not using execlp, the exec family of functions replace the current process image with a new process image.  When you call execlp() you have to give it a process image (program) to run."}, {"owner": {"reputation": 19667, "user_id": 1312382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FL8Fg.jpg?s=128&g=1", "display_name": "Aconcagua", "link": "https://stackoverflow.com/users/1312382/aconcagua"}, "reply_to_user": {"reputation": 31, "user_id": 11265149, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_BIXnGN3bBY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdMX22LEmNjVBHApn4DOsyJXrv3cg/mo/photo.jpg?sz=128", "display_name": "Fatimah Ali", "link": "https://stackoverflow.com/users/11265149/fatimah-ali"}, "edited": false, "score": 0, "creation_date": 1553764017, "post_id": 55374776, "comment_id": 97507830, "body": "@FatimahAli You could let the programme restart itself, though. But you need to make sure you have some means available to distinguish parent from child process then \u2013 you could evaluate some parameter being passed for this purpose, similarly as original answer did (e. g. no parameter -&gt; parent, parameter given -&gt; child). Suppose, though, this answer illustrates quite well that you are on the wrong way... See Bodo&#39;s &#39;hammer to drill a hole&#39; comment."}], "tags": [], "owner": {"reputation": 5428, "user_id": 29061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2OmsL.png?s=128&g=1", "display_name": "Jackson", "link": "https://stackoverflow.com/users/29061/jackson"}, "is_accepted": true, "score": 0, "last_activity_date": 1553682324, "last_edit_date": 1553682324, "creation_date": 1553681891, "answer_id": 55374776, "question_id": 55373723, "link": "https://stackoverflow.com/questions/55373723/how-to-find-pid-using-execlp/55374776#55374776", "title": "How to find pid using execlp()?", "body": "<p>I think your missing a step in your design.  You are trying to use <code>execlp()</code> to call a library function <code>getpid()</code> and this just won't work.  If you need to get the PID of the process through a call to <code>execlp()</code> then you need a program to call.</p>\n\n<p>So start by creating a simple program that prints out its PID:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\nint main(int argc, char *argv[])\n{\n   printf( \"%s %d\\n\", argv[1], getpid()) ;\n}\n</code></pre>\n\n<p>Call this printpid.c and compile it to an executable called printpid.  Then you can have a program that does this:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/types.h&gt;\nint main()\n{\n   pid_t pid = fork() ;\n   if ( pid == 0 )\n   {\n      execlp(\"./printpid\", \"printpid\", \"child\", (char *)0) ;\n   } else {\n      execlp(\"./printpid\", \"printpid\", \"parent\", (char *)0) ;\n   }\n\n   return 0 ;\n}\n</code></pre>\n\n<p>Compile this to be an executable called forkprocess say and make sure that it and the printpid program are in the same directory.  When you run forkprocess it runs printpid twice and printpid displays the PID of the process.  To make it clear what is going on I'm passing a parameter to printpid to show if it's being called from the parent process or the child process created by the call to <code>fork()</code>.</p>\n"}], "owner": {"reputation": 31, "user_id": 11265149, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_BIXnGN3bBY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdMX22LEmNjVBHApn4DOsyJXrv3cg/mo/photo.jpg?sz=128", "display_name": "Fatimah Ali", "link": "https://stackoverflow.com/users/11265149/fatimah-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 0, "accepted_answer_id": 55374776, "answer_count": 1, "score": 0, "last_activity_date": 1553682324, "creation_date": 1553678808, "last_edit_date": 1553682285, "question_id": 55373723, "link": "https://stackoverflow.com/questions/55373723/how-to-find-pid-using-execlp", "title": "How to find pid using execlp()?", "body": "<p>The getpid() gives me PID of a process. But now I want to find the PID using the execlp() command and also print the PID. But I am unable to solve it. Help.</p>\n\n<pre><code>#include &lt;stdio.h&gt;     //my code so far\n#include &lt;unistd.h&gt;\n#include &lt;sys/types.h&gt;\nint main()\n{\n   execlp(\"/usr/include\",\"/usr/include\",getpid(),(char *)0);\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 4, "creation_date": 1553677618, "post_id": 55373307, "comment_id": 97468983, "body": "On which compiler, using which compile options on which architecture? One compile may generate assembly instruction needed to initialize the array, while the other compiler may not. For example, one can see that on gcc 8.3 with no options on x64 platform the <code>arr</code> is initialized only if <code>i</code> is nonzero, see <a href=\"https://godbolt.org/z/fIbkrd\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 0, "creation_date": 1553677763, "post_id": 55373307, "comment_id": 97469060, "body": "According to this <a href=\"https://godbolt.org/z/SCj1g3\" rel=\"nofollow noreferrer\">godbolt.org/z/SCj1g3</a> the initialization isn&#39;t done when <code>i</code> is <code>0</code>, in that case it just jumps over the initialization. Of course it&#39;s going to depend on the compiler, though."}, {"owner": {"reputation": 1077, "user_id": 7545157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZqbEb.jpg?s=128&g=1", "display_name": "Sven Kr&#252;ger", "link": "https://stackoverflow.com/users/7545157/sven-kr%c3%bcger"}, "edited": false, "score": 0, "creation_date": 1553678049, "post_id": 55373307, "comment_id": 97469261, "body": "In C89 this code would lead to an error message, stating that all variables should be declared in the beginning of a function or at least scope - depending on the compiler."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 1077, "user_id": 7545157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZqbEb.jpg?s=128&g=1", "display_name": "Sven Kr&#252;ger", "link": "https://stackoverflow.com/users/7545157/sven-kr%c3%bcger"}, "edited": false, "score": 2, "creation_date": 1553678251, "post_id": 55373307, "comment_id": 97469400, "body": "@SvenKr&#252;ger this code will not lead an error in C89 because of <i>arr</i> ... but because of the &#39;//&#39;"}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 1077, "user_id": 7545157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZqbEb.jpg?s=128&g=1", "display_name": "Sven Kr&#252;ger", "link": "https://stackoverflow.com/users/7545157/sven-kr%c3%bcger"}, "edited": false, "score": 1, "creation_date": 1553678256, "post_id": 55373307, "comment_id": 97469401, "body": "@SvenKr&#252;ge <code>int arr[2048] = {0};</code> in the above code doesn&#39;t violate that rule."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "reply_to_user": {"reputation": 1077, "user_id": 7545157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZqbEb.jpg?s=128&g=1", "display_name": "Sven Kr&#252;ger", "link": "https://stackoverflow.com/users/7545157/sven-kr%c3%bcger"}, "edited": false, "score": 0, "creation_date": 1553686899, "post_id": 55373307, "comment_id": 97474691, "body": "@SvenKr&#252;ger <code>arr</code> is defined at the begin of the scope. Where do you see a problem? Defining new variables at the begin of an inner set of <code>{ ... }</code> was allowed also in C89. It should not depend on the compiler"}], "answers": [{"comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 3, "creation_date": 1553678954, "post_id": 55373388, "comment_id": 97469781, "body": "That may not be the case. One compiler may collect all variables once and allocate (and initialize) them once. Another compiler may reuse the stack space. In all, whether the array &quot;exists&quot; is not a language issue but a compiler isue."}, {"owner": {"reputation": 1805, "user_id": 6284997, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/1376431542382698/picture?type=large", "display_name": "MayurK", "link": "https://stackoverflow.com/users/6284997/mayurk"}, "edited": false, "score": 1, "creation_date": 1553679671, "post_id": 55373388, "comment_id": 97470239, "body": "Similarly I think a compiler may optimize code and not declare array even when i=0. It depends on how the array is used."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1553681922, "post_id": 55373388, "comment_id": 97471620, "body": "Regardlessly how the allocation of <code>arr</code> is implemented, any sane compiler would not call the initialisation if <code>i</code> is false."}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": false, "score": 6, "last_activity_date": 1553677751, "creation_date": 1553677751, "answer_id": 55373388, "question_id": 55373307, "link": "https://stackoverflow.com/questions/55373307/when-are-local-variables-initialized-in-c/55373388#55373388", "title": "When are local variables initialized in C?", "body": "<blockquote>\n  <p>if i == 0, will this array be initialized at all?</p>\n</blockquote>\n\n<p>because your code is</p>\n\n<blockquote>\n<pre><code>if(i) {\n  int arr[2048] = {0};\n  //Doing something related to arr;\n} else {\n  //Doing something\n}\n</code></pre>\n</blockquote>\n\n<p>the array does not exist if <code>i==0</code> so it cannot be initialized, the array only exists in the branch of the <em>if</em> where <code>i != 0</code></p>\n"}, {"tags": [], "owner": {"reputation": 4522, "user_id": 5157478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bBcym.png?s=128&g=1", "display_name": "Frankie_C", "link": "https://stackoverflow.com/users/5157478/frankie-c"}, "is_accepted": false, "score": 3, "last_activity_date": 1553681397, "last_edit_date": 1553681397, "creation_date": 1553680429, "answer_id": 55374291, "question_id": 55373307, "link": "https://stackoverflow.com/questions/55373307/when-are-local-variables-initialized-in-c/55374291#55374291", "title": "When are local variables initialized in C?", "body": "<p>To understand the compiler behavior you should consider that in the C language each variable has a <strong>storage class</strong> (<strong>ISO/IEC 9899:201x \u00a76.2.4 Storage durations of objects</strong>) which characterize it behavior and its '<strong>life</strong>', that means the existence of such an object (a variable is an object), and the legal access conditions to it.\nThe storage classes are 4: static, thread, automatic, and allocated. The latter use dynamic memory allocation.</p>\n\n<p>In your case the array <code>arr[2048]</code> is an <strong>automatic</strong> object, which lifetime is defined (in the same paragraph of the standard @ point 6) as:</p>\n\n<blockquote>\n  <p>For such an object that does not have a variable length array type,\n  its lifetime extends from entry into the block with which it is\n  associated until execution of that block ends in any way. (Entering an\n  enclosed block or calling a function suspends, but does not end,\n  execution of the current block.)</p>\n  \n  <p>If the block is entered recursively, a new instance of the object is\n  created each time.</p>\n  \n  <p><strong>The initial value of the object is indeterminate</strong>.</p>\n  \n  <p><strong>If an initialization is specified for the object, it is performed each\n  time the declaration or compound literal is reached in the execution\n  of the block</strong>; otherwise, the value becomes indeterminate each time the\n  declaration is reached.</p>\n</blockquote>\n\n<p>This explain that:</p>\n\n<ol>\n<li>The life of the object begins with the beginning of the block where it is defined.</li>\n<li>The initial value (array contents in our case) is indefinite: the compiler doesn't initialize the memory area. And when an initialization is specified it is done when the execution <strong>reach the block</strong>.</li>\n</ol>\n\n<p>The first point is clear, and is already the answer to your question. The code you reference is:</p>\n\n<pre><code>{    //Block init\n  int arr[2048] = {0};\n  //Doing something related to arr;\n}    // block end\n</code></pre>\n\n<p>If you don't enter the block the <strong>life</strong> of your object, the array, doesn't begin: the array doesn't exist. Of course under this condition no operations can be performed on the object, even initialization.</p>\n\n<p>Now the <strong>point 2</strong> helps to clarify better. The expression:</p>\n\n<pre><code>int arr[2048] = {0};\n</code></pre>\n\n<p><strong>Isn't functionally interpreted by the compiler as a declaration with object initialization</strong>, because of the storage class of the array object. It is, substantially, treated moreover as <strong>a declaration plus an assignment</strong>.</p>\n\n<p>What's the difference?</p>\n\n<p>A declaration of an initialized variable having storage class different from automatic is implemented with a mechanism transparent to the user code, statically assigning values in the BSS section or with code belonging to the compiler prologues and epilogues, that <strong>could happen even if the object is not accessed</strong>.</p>\n\n<p>In the other case the initialization code, the assignment, <strong>is part of the user code</strong>, and for this reason <strong>executed following the execution flow logic</strong>.</p>\n\n<p>This is the <strong>official</strong> behavior. Inspecting under the hood you can see that in some cases the space for automatic variables happen to be allocated in advance from the object life beginning, but these behavior are strictly depending on the CPU architecture, and basically when happen don't create functional divergence between the code the language standard (which is the basic <strong>property of a compliant compiler</strong>).</p>\n"}, {"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": true, "score": 1, "last_activity_date": 1553682196, "creation_date": 1553682196, "answer_id": 55374873, "question_id": 55373307, "link": "https://stackoverflow.com/questions/55373307/when-are-local-variables-initialized-in-c/55374873#55374873", "title": "When are local variables initialized in C?", "body": "<p>In practice, a variable will be initialized <em>before use</em>, regardless if it is placed in an inner scope or not. This code:</p>\n\n<pre><code>void func1 (int i){\n  if(i) {\n    int arr[2048] = {0};\n    printf(\"%d\", arr[666]);\n  } else {\n    //Doing something\n  }\n}\n</code></pre>\n\n<p>gives exactly the same machine code as this code:</p>\n\n<pre><code>void func2 (int i){\n  int arr[2048] = {0};\n  if(i) {\n    printf(\"%d\", arr[666]);\n  } else {\n    //Doing something\n  }\n}\n</code></pre>\n\n<p>gcc -O3 on x86 gives:</p>\n\n<pre><code>.LC0:\n        .string \"%d\"\nfunc1:\n        test    edi, edi\n        jne     .L4\n        ret\n.L4:\n        xor     esi, esi\n        mov     edi, OFFSET FLAT:.LC0\n        xor     eax, eax\n        jmp     printf\n</code></pre>\n\n<p>and</p>\n\n<pre><code>.LC0:\n        .string \"%d\"\nfunc2:\n        test    edi, edi\n        jne     .L7\n        ret\n.L7:\n        xor     esi, esi\n        mov     edi, OFFSET FLAT:.LC0\n        xor     eax, eax\n        jmp     printf\n</code></pre>\n\n<p>As you can see they are identical. </p>\n\n<p>It is good design practice to limit the scope of variables as much as possible though, but that has nothing to do with performance.</p>\n"}], "owner": {"reputation": 764, "user_id": 9856838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/499a4de5cffdab8aa1ad6511eb312cc4?s=128&d=identicon&r=PG&f=1", "display_name": "Mr Pang", "link": "https://stackoverflow.com/users/9856838/mr-pang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1279, "favorite_count": 0, "accepted_answer_id": 55374873, "answer_count": 3, "score": 2, "last_activity_date": 1553682196, "creation_date": 1553677466, "last_edit_date": 1553677784, "question_id": 55373307, "link": "https://stackoverflow.com/questions/55373307/when-are-local-variables-initialized-in-c", "title": "When are local variables initialized in C?", "body": "<p>Consider below example</p>\n\n<pre><code>void func(int i){\n  if(i) {\n    int arr[2048] = {0};\n    //Doing something related to arr;\n  } else {\n    //Doing something\n  }\n}\n</code></pre>\n\n<p>I have a large array declaration in the <code>if</code> block.  The initialization of this array should cost some time. My question is: if <code>i == 0</code>, will this array be initialized at all?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 188064, "user_id": 635608, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oIJia.png?s=128&g=1", "display_name": "Mat", "link": "https://stackoverflow.com/users/635608/mat"}, "edited": false, "score": 0, "creation_date": 1553677371, "post_id": 55373268, "comment_id": 97468828, "body": "<a href=\"https://stackoverflow.com/questions/5431941/why-is-while-feoffile-always-wrong\" title=\"why is while feoffile always wrong\">stackoverflow.com/questions/5431941/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 4925987, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wSAESVBSoJQ/AAAAAAAAAAI/AAAAAAAABQc/udfCkTp02oc/photo.jpg?sz=128", "display_name": "Akhil Jain", "link": "https://stackoverflow.com/users/4925987/akhil-jain"}, "edited": false, "score": 0, "creation_date": 1553685147, "post_id": 55373554, "comment_id": 97473589, "body": "Isnt there a way to ignore the spaces inside the parentheses ?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 61, "user_id": 4925987, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wSAESVBSoJQ/AAAAAAAAAAI/AAAAAAAABQc/udfCkTp02oc/photo.jpg?sz=128", "display_name": "Akhil Jain", "link": "https://stackoverflow.com/users/4925987/akhil-jain"}, "edited": false, "score": 1, "creation_date": 1553685846, "post_id": 55373554, "comment_id": 97474043, "body": "@AkhilJain yes, see the Edit added to the answer."}], "tags": [], "owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "is_accepted": true, "score": 3, "last_activity_date": 1553685822, "last_edit_date": 1553685822, "creation_date": 1553678266, "answer_id": 55373554, "question_id": 55373268, "link": "https://stackoverflow.com/questions/55373268/is-there-a-way-to-read-2-integers-separated-by-comma-inside-parentheses-in-c-ig/55373554#55373554", "title": "Is there a way to read 2 integers separated by comma inside parentheses in C, ignoring spaces", "body": "<p>Faults I see: first is the misuse of <code>feof</code>, the second is that the input is stuck at the second <code>'('</code>, where there is actually a space in the input data. You can filter out the (white) space by adding a space to the format specifer. Also you should always check if a file opened.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    int m,n;\n    FILE* file = fopen(\"File1.txt\", \"r\");\n    if(file == NULL) {\n        return 1;                                   // error checking\n    }\n    while (fscanf (file, \" (%d,%d)\", &amp;m, &amp;n) == 2)  // check for number of conversions\n    //   space added here ^    ^ the space here was unnecessary\n    {\n        printf(\"m=%d, n=%d\\n\", m, n);\n    }\n    fclose(file);\n    return 0;\n}\n</code></pre>\n\n<p>Program output:\n<PRE>\nm=2, n=50\nm=4, n=30\nm=9, n=30\nm=10, n=400\nm=-5, n=-40\nm=7, n=20\nm=19, n=200\nm=20, n=50\nm=-18, n=-200\nm=-2, n=29\nm=2, n=67\nm=4, n=35\nm=9, n=45\nm=-18, n=100\n</PRE></p>\n\n<p>Because <code>feof</code> detects if there was a previous attempt to read beyond the end of the file, which you don't do, the end condition was never met.</p>\n\n<p><HR>\n<strong>Edit</strong>: answering the comment below, the format string can be made to tolerate additional whitespace anywhere in the input, by adding a space before every specifier that does not automatically filter whitespace. Like this:</p>\n\n<pre><code>fscanf (file, \" (%d ,%d )\", &amp;m, &amp;n)\n</code></pre>\n\n<p>There is now a space, in the format string, in front of each parenthesis and the comma. There doesn't need to be a space before each <code>%d</code> because that format spec automatically  filters out leading whitespace. This will work correctly for randomly spaced input such as </p>\n\n<pre><code>\"   (    4  ,  30  )  \"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 61, "user_id": 4925987, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wSAESVBSoJQ/AAAAAAAAAAI/AAAAAAAABQc/udfCkTp02oc/photo.jpg?sz=128", "display_name": "Akhil Jain", "link": "https://stackoverflow.com/users/4925987/akhil-jain"}, "edited": false, "score": 0, "creation_date": 1553683174, "post_id": 55373798, "comment_id": 97472389, "body": "Isnt there a way to ignore the spaces inside the parentheses ?"}, {"owner": {"reputation": 597, "user_id": 851312, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/minkg.jpg?s=128&g=1", "display_name": "DTdev", "link": "https://stackoverflow.com/users/851312/dtdev"}, "reply_to_user": {"reputation": 61, "user_id": 4925987, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wSAESVBSoJQ/AAAAAAAAAAI/AAAAAAAABQc/udfCkTp02oc/photo.jpg?sz=128", "display_name": "Akhil Jain", "link": "https://stackoverflow.com/users/4925987/akhil-jain"}, "edited": false, "score": 1, "creation_date": 1553693867, "post_id": 55373798, "comment_id": 97479293, "body": "@AkhilJain updated the answer. Hope it helps."}], "tags": [], "owner": {"reputation": 597, "user_id": 851312, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/minkg.jpg?s=128&g=1", "display_name": "DTdev", "link": "https://stackoverflow.com/users/851312/dtdev"}, "is_accepted": false, "score": 0, "last_activity_date": 1553694756, "last_edit_date": 1553694756, "creation_date": 1553679007, "answer_id": 55373798, "question_id": 55373268, "link": "https://stackoverflow.com/questions/55373268/is-there-a-way-to-read-2-integers-separated-by-comma-inside-parentheses-in-c-ig/55373798#55373798", "title": "Is there a way to read 2 integers separated by comma inside parentheses in C, ignoring spaces", "body": "<p>Add space also in loop</p>\n\n<pre><code>int m,n;\nFILE* file = fopen(\"file1.txt\", \"r\"); // open a file\nwhile(fscanf (file, \"(%d, %d)\", &amp;m, &amp;n)==2 || fscanf (file, \"(%d, %d) \", &amp;m, &amp;n)==2 ||fscanf (file, \" (%d, %d)\", &amp;m, &amp;n)==2)\n{\n    printf(\"m is %d:\\n\", m);\n    printf(\"n is %d:\\n\", n);\n}\n//close the file after opening\nfclose (file);\n</code></pre>\n\n<p>Alternatively </p>\n\n<pre><code>int m,n;\nchar ch;\nFILE* file = fopen(\"file1.txt\", \"r\"); // open a file\nwhile (!feof (file))\n{\n     fscanf (file, \"(%d, %d)\", &amp;m, &amp;n);\n     printf(\"m is %d:\\n\", m);\n     printf(\"n is %d:\\n\\n\", n);\n     while((ch = fgetc(file)) != EOF)\n         if(ch == ' ')\n             break;\n}\n//close the file after opening\nfclose (file);\n</code></pre>\n\n<p><strong>EDIT:</strong> To answer the comment. </p>\n\n<p><strong>EDIT2:</strong> Modified the regular expression to avoid space and line end </p>\n\n<blockquote>\n  <p><strong>%*c</strong> \n  this escape sequence can be added to avoid multiple characters. This is similar to using <strong>regular expression</strong> during scanf. </p>\n</blockquote>\n\n<pre><code>while(fscanf (file, \"(%d%*c%d%*[) \\n]\", &amp;m, &amp;n)==2)\n{\n    printf(\"m is %d:\\n\", m);\n    printf(\"n is %d:\\n\", n);\n}\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 4925987, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wSAESVBSoJQ/AAAAAAAAAAI/AAAAAAAABQc/udfCkTp02oc/photo.jpg?sz=128", "display_name": "Akhil Jain", "link": "https://stackoverflow.com/users/4925987/akhil-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 0, "closed_date": 1553689660, "accepted_answer_id": 55373554, "answer_count": 2, "score": 2, "last_activity_date": 1553694756, "creation_date": 1553677288, "question_id": 55373268, "link": "https://stackoverflow.com/questions/55373268/is-there-a-way-to-read-2-integers-separated-by-comma-inside-parentheses-in-c-ig", "closed_reason": "Duplicate", "title": "Is there a way to read 2 integers separated by comma inside parentheses in C, ignoring spaces", "body": "<p>I am reading the key and value for every pair in the list, ignoring the whitespaces and trying to print it. My file consists of data like:</p>\n\n<pre><code>(2, 50) (4, 30) (9, 30) (10, 400) (-5, -40)\n(7, 20) (19, 200) (20, 50) (-18, -200) (-2, 29)\n(2, 67) (4, 35) (9, 45) (-18, 100) \n</code></pre>\n\n<p>I am trying to get the integers inside the parenetheses one by one. For eg.</p>\n\n<pre><code>m=2\nn=50\nm=4\nn=30\n</code></pre>\n\n<p>I've tried to read data from the file till the file ends. Scan and print the m and n values.</p>\n\n<pre><code>    int m,n;\n    FILE* file = fopen(\"File1.txt\", \"r\"); // open a file\n    while (!feof (file))\n    {\n        fscanf (file, \"(%d, %d)\", &amp;m, &amp;n);\n        printf(\"m is %d:\", m);\n        printf(\"n is %d:\", n);\n    }\n    //close the file after opening\n    fclose (file);\n</code></pre>\n\n<p>The build is successful while running the code whereas </p>\n\n<pre><code>m is 2:n is 50:m is 2:n is 50:m is 2:n is 50:m is 2:n is 50:m is 2:n is 50:m is 2:n is 50:m is 2:\n</code></pre>\n\n<p>is printing endlessly instead of reading the integers from the file.</p>\n\n<p>Kindly help.</p>\n"}, {"tags": ["c++", "c", "casting"], "comments": [{"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 1, "creation_date": 1553676224, "post_id": 55372804, "comment_id": 97468107, "body": "That&#39;s very critical. You pass a 64 bit <code>int</code> by address to a function which interpretes it as 32 bit <code>int</code> trusting it&#39;s declaration. This works as the linker cannot recognize the distinct type of equal named symbols and may link this without any warning but it&#39;s still wrong."}, {"owner": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "edited": false, "score": 0, "creation_date": 1553676768, "post_id": 55372804, "comment_id": 97468445, "body": "That sounds dangerous, indeed. Is there any reason to have 32bit on one side and 64bit on the other? If so, I suggest writing a small wrapper for every function, which just does type conversion (and perhaps checks for overflows)."}, {"owner": {"reputation": 101, "user_id": 11253386, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YCsrzlLGz_I/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcZsvEQL8S8YfL7E3dYF1vb4mx2Kw/mo/photo.jpg?sz=128", "display_name": "Saba Kauser", "link": "https://stackoverflow.com/users/11253386/saba-kauser"}, "edited": false, "score": 0, "creation_date": 1553676857, "post_id": 55372804, "comment_id": 97468503, "body": "So would I provide 2 different versions of  my library. Once for 8 byte usage and one for 4 byte usage from applications that they can link against."}, {"owner": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "edited": false, "score": 0, "creation_date": 1553677001, "post_id": 55372804, "comment_id": 97468597, "body": "It is not clear to me why you need different int-sizes at all. Do you compile for x86-32 and x86-64, or does the 32bit version save significant amount of memory?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 2, "creation_date": 1553677120, "post_id": 55372804, "comment_id": 97468675, "body": "This would be why we should use to stdint.h types and not some local garage standard..."}], "answers": [{"comments": [{"owner": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "edited": false, "score": 1, "creation_date": 1553676847, "post_id": 55372937, "comment_id": 97468494, "body": "This does not sign-extend, though. To do that, you could assign <code>count = int(count);</code> after calling the library function."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1553678998, "post_id": 55372937, "comment_id": 97469807, "body": "First, that doesn&#39;t address the problem of addressing a 64-bit <code>int</code> value as a 32-bit <code>int</code> value.  That&#39;s wrong no matter how the variable is initialized.  Second, the OP is providing a library.  How could that library possibly initialize a variable <i>that&#39;s in the customer-written code that calls the library</i>?"}], "tags": [], "owner": {"reputation": 3223, "user_id": 1338132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f1831eadc92d0cbcfff8443888b01f3?s=128&d=identicon&r=PG", "display_name": "Axel Podehl", "link": "https://stackoverflow.com/users/1338132/axel-podehl"}, "is_accepted": false, "score": 0, "last_activity_date": 1553676188, "creation_date": 1553676188, "answer_id": 55372937, "question_id": 55372804, "link": "https://stackoverflow.com/questions/55372804/how-to-convert-a-32-bit-signed-integer-value-to-64-bit-signed-integer-equivalent/55372937#55372937", "title": "How to convert a 32 bit signed integer value to 64 bit signed integer equivalent in C", "body": "<p>Your library can't access the upper 4 bytes, but you can before you call it. So try to initialize it with 0's first:</p>\n\n<pre><code>SLEN count = 0; // initialize with 0's\nmylibraryfunction(&amp;count);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 101, "user_id": 11253386, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YCsrzlLGz_I/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcZsvEQL8S8YfL7E3dYF1vb4mx2Kw/mo/photo.jpg?sz=128", "display_name": "Saba Kauser", "link": "https://stackoverflow.com/users/11253386/saba-kauser"}, "edited": false, "score": 0, "creation_date": 1553680114, "post_id": 55373244, "comment_id": 97470497, "body": "This is sort of my thinking. While I can&#39;t have users use different obj linkage, I need a way to use them both the 32 bit and 64 variants depending on their application. What I have provided is the simplest form of illustration, but the actual use case requires users to link to library and it should be able to interpret the type correctly."}, {"owner": {"reputation": 101, "user_id": 11253386, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YCsrzlLGz_I/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcZsvEQL8S8YfL7E3dYF1vb4mx2Kw/mo/photo.jpg?sz=128", "display_name": "Saba Kauser", "link": "https://stackoverflow.com/users/11253386/saba-kauser"}, "edited": false, "score": 0, "creation_date": 1553680557, "post_id": 55373244, "comment_id": 97470761, "body": "I don&#39;t think single library can handle interpretation to same name of different storage. Hence the reason  I thought 2 libs is the solution."}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "reply_to_user": {"reputation": 101, "user_id": 11253386, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YCsrzlLGz_I/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcZsvEQL8S8YfL7E3dYF1vb4mx2Kw/mo/photo.jpg?sz=128", "display_name": "Saba Kauser", "link": "https://stackoverflow.com/users/11253386/saba-kauser"}, "edited": false, "score": 0, "creation_date": 1553681659, "post_id": 55373244, "comment_id": 97471457, "body": "@SabaKauser IMHO, Lundin said it clearly in his comment: For an API, the usage of stdint.h types seems to be more reliable. Btw. even on most 64 bit platforms, an <code>int</code> is 32 bit. Additionally, libraries should always have same platform. Thus, the declaration is the one which should be clean enough to prevent such issues."}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "reply_to_user": {"reputation": 101, "user_id": 11253386, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YCsrzlLGz_I/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcZsvEQL8S8YfL7E3dYF1vb4mx2Kw/mo/photo.jpg?sz=128", "display_name": "Saba Kauser", "link": "https://stackoverflow.com/users/11253386/saba-kauser"}, "edited": false, "score": 0, "creation_date": 1553681859, "post_id": 55373244, "comment_id": 97471574, "body": "@SabaKauser If you need upto 64 bit ints, why not <code>int64_t</code>? This is supported on 32 bit platforms as well. If it cannot be used on 32 bit platforms with more than 32 bits a runtime check could detect accidentally wrong usage."}, {"owner": {"reputation": 101, "user_id": 11253386, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YCsrzlLGz_I/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcZsvEQL8S8YfL7E3dYF1vb4mx2Kw/mo/photo.jpg?sz=128", "display_name": "Saba Kauser", "link": "https://stackoverflow.com/users/11253386/saba-kauser"}, "edited": false, "score": 0, "creation_date": 1553828342, "post_id": 55373244, "comment_id": 97539875, "body": "Thanks. The requirement is that certain driver managers treat the type in question as 32-bit and certain as 64 bit. So the facility should be to let them link to the correct versions of my lib as this decision would need to be made by developer depending on what driver manager they are using."}], "tags": [], "owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "is_accepted": false, "score": 1, "last_activity_date": 1553677548, "last_edit_date": 1553677548, "creation_date": 1553677214, "answer_id": 55373244, "question_id": 55372804, "link": "https://stackoverflow.com/questions/55372804/how-to-convert-a-32-bit-signed-integer-value-to-64-bit-signed-integer-equivalent/55373244#55373244", "title": "How to convert a 32 bit signed integer value to 64 bit signed integer equivalent in C", "body": "<p>I made a MCVE where I resembled what happens in OPs case.</p>\n\n<p>I even didn't need an extra library for this, just two translation units (resulting in two object files).</p>\n\n<p>First <code>lib.cc</code>:</p>\n\n<pre><code>#include &lt;cstdint&gt;\n\nextern \"C\" void func(int32_t *pValue);\n\nvoid func(std::int32_t *pValue)\n{\n  *pValue = 0;\n}\n</code></pre>\n\n<p>Second <code>prog.cc</code>:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;iomanip&gt;\n\n// how prog.cc \"knows\" func():\nextern \"C\" void func(int64_t *pValue);\n\nint main()\n{\n  int64_t value = 0x0123456789ABCDEFull;\n  std::cout &lt;&lt; \"value before: \" &lt;&lt; std::hex &lt;&lt; value &lt;&lt; '\\n';\n  func(&amp;value);\n  std::cout &lt;&lt; \"value after : \" &lt;&lt; std::hex &lt;&lt; value &lt;&lt; '\\n';\n  return 0;\n}\n</code></pre>\n\n<p>Compiler errors? No. Each translation unit uses prototype of <code>func()</code> conformant.</p>\n\n<p>Linker errors? No. The symbols match, anything else is beyond view of linker.</p>\n\n<p>I must admit I had to use <code>extern \"C\"</code> to achieve this. Otherwise, at least, the C++ name mangling had prevented the proper linking. (When I became aware of this, I made code in C.)</p>\n\n<p>Output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>value before: 123456789abcdef\nvalue after : 123456700000000\n</code></pre>\n\n<p><kbd><a href=\"https://wandbox.org/permlink/H5BPuDJRHXVgRku8\" rel=\"nofollow noreferrer\"><strong>Live Demo on wandbox</strong></a></kbd></p>\n\n<p><strong>This is very dangerous!</strong> Any use of any extern symbol should use a 100 % compatible declaration. (And yes, C and C++ provide various ways to shoot into your own foot.)</p>\n\n<hr>\n\n<p>Imagine what would happen if the lib.cc function <code>func()</code> would write <code>int64_t</code> where the prog.cc would pass a pointer to <code>int32_t</code>: Out of bound access with possible more disastrous consequences.</p>\n"}], "owner": {"reputation": 101, "user_id": 11253386, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YCsrzlLGz_I/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcZsvEQL8S8YfL7E3dYF1vb4mx2Kw/mo/photo.jpg?sz=128", "display_name": "Saba Kauser", "link": "https://stackoverflow.com/users/11253386/saba-kauser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 459, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1553677548, "creation_date": 1553675703, "question_id": 55372804, "link": "https://stackoverflow.com/questions/55372804/how-to-convert-a-32-bit-signed-integer-value-to-64-bit-signed-integer-equivalent", "title": "How to convert a 32 bit signed integer value to 64 bit signed integer equivalent in C", "body": "<p>I have a library that is compiled to use 32 bit signed integer. When other applications compile theirs with a flag e.g: -DODBC64 it promotes the same type I have used in my library to a 64 bit signed integer.\ne.g:</p>\n\n<pre><code> #ifdef ODBC64\n       typedef sint64 SLEN;\n #else\n       #define SLEN int\n #endif\n</code></pre>\n\n<p>When the application passes reference to my library as :</p>\n\n<pre><code>SLEN count;\nmylibraryfunction(&amp;count);\n</code></pre>\n\n<p>the values returned to application looks like these:</p>\n\n<pre><code>sizeof(SLEN) = 8\nsizeof(SLEN) in my library = 4\nm_AffectedRows BEFORE = 0x3030303030303030\nm_AffectedRows AFTER = 0x3030303000000000        0\n</code></pre>\n\n<p>You can see that the assignment from my lib is copying 4 bytes (value 0).\nI need to know a way to reset the upper 4 bytes to 0.\ne.g:</p>\n\n<pre><code>0x0000000000000000\n</code></pre>\n\n<p>I have tried both static_cast and reinterpret_cast, but none are helpful.</p>\n"}, {"tags": ["c++", "c", "cmake"], "comments": [{"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 2, "creation_date": 1553676125, "post_id": 55372669, "comment_id": 97468056, "body": "In the project <code>B</code> you have <code>find_package(A REQUIRED)</code> but never uses results of this call. It should be <code>target_link_libraries(B A)</code> for link the <code>B</code> library with <code>A</code> and &quot;consume&quot; its include directories."}, {"owner": {"reputation": 75, "user_id": 11264642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4113b472043c22ac7042512645ad1dab?s=128&d=identicon&r=PG&f=1", "display_name": "Paxi1337", "link": "https://stackoverflow.com/users/11264642/paxi1337"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1553680206, "post_id": 55372669, "comment_id": 97470548, "body": "Thanks! I was misunderstanding target_link_libraries. That fixed the issue. However, now I get an error about a missing include library A uses (not part of the public header) in library B. More specific it is JNI which is not a project I have the source/cmake for. I tried adding <code>find_package(JNI REQUIRED) add_library(JNI SHARED IMPORTED) set_property(TARGET JNI PROPERTY INTERFACE_INCLUDE_DIRECTORIES ${JNI_INCLUDE_DIRS}) set_property(TARGET JNI PROPERTY IMPORTED_LOCATION ${JNI_LIBRARIES})</code> (similar to the sample) in library A, but this did not solve the issue unfortunately."}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1553681061, "post_id": 55372669, "comment_id": 97471090, "body": "Check content of <code>${JNI_INCLUDE_DIRS}</code>, and check that given directory <b>actually</b> contains required headers."}, {"owner": {"reputation": 75, "user_id": 11264642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4113b472043c22ac7042512645ad1dab?s=128&d=identicon&r=PG&f=1", "display_name": "Paxi1337", "link": "https://stackoverflow.com/users/11264642/paxi1337"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1553682179, "post_id": 55372669, "comment_id": 97471769, "body": "I made sure and using the hardcoded path again. The path is used in lib A for building and working fine there so I can exclude the path for being incorrect. I updated the CMakeLists.txt for Library A. Library B is unchanged. Library B now complains about <code>#include &lt;jni.h&gt;</code>, which is the first line in headerFromA.hpp (which was unknown before).  Thanks for your time, would be really glad if we can work this out."}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1553684637, "post_id": 55372669, "comment_id": 97473276, "body": "I am not sure, but construction <code>$&lt;BUILD_INTERFACE:XXX&gt;</code> should be <b>repeated</b> for every include directory; you cannot use single construction for several include directories."}, {"owner": {"reputation": 75, "user_id": 11264642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4113b472043c22ac7042512645ad1dab?s=128&d=identicon&r=PG&f=1", "display_name": "Paxi1337", "link": "https://stackoverflow.com/users/11264642/paxi1337"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1553685187, "post_id": 55372669, "comment_id": 97473630, "body": "I will look this up! But is the build_interface even relevant for library B? I assumed only the install interface is taken into account, which seems to work fine now (considering library B knows about the header from library A). Is there anything more to take care of when I want the dependcies from library A (JNI in this case) also to be taken into account in library B? I am still googling in the meanwhile but could not find any concrete example expect boost, which differs a bit from mine."}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1553685473, "post_id": 55372669, "comment_id": 97473820, "body": "Oh, yes, <code>BUILD_INTERFACE</code> is used only for build A project. BTW, <code>B</code> project sees only <code>INSTALL_INTERFACE</code>, into which you include only <code>include&#47;</code> subdirectory (under installation prefix). Do you have JNI files copied into this directory? Please, provide <b>exact code</b> which you use, <b>exact error message</b> which  you got, and show which files do you have under install directory. Otherwise it is a <i>guessing game</i>."}, {"owner": {"reputation": 75, "user_id": 11264642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4113b472043c22ac7042512645ad1dab?s=128&d=identicon&r=PG&f=1", "display_name": "Paxi1337", "link": "https://stackoverflow.com/users/11264642/paxi1337"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1553686626, "post_id": 55372669, "comment_id": 97474521, "body": "I added an EDIT part in the main post where I discribed the things I did already and the exact error. Thanks again for your effort! JNI files are not located in this include directory I have in my install_interface. See description above"}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1553688201, "post_id": 55372669, "comment_id": 97475495, "body": "1. You have <code>JNI</code> target with many properties set.. but you <b>never use</b> it (back to the my first comment). 2. CMake error &quot;... prefixed in the source directory.&quot; is for purpose, do not try to <i>overcome</i> it - <i>fix</i> it instead. Main intention of the <b>installed</b> project is to work <b>without</b> <i>sources</i> (e.g. after removing them). You may install JNI library <i>separately</i> from your project, so JNI include directory will point outside of your project. Or install JNI headers of that library along with your project, so include directory will refer to installation one."}, {"owner": {"reputation": 75, "user_id": 11264642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4113b472043c22ac7042512645ad1dab?s=128&d=identicon&r=PG&f=1", "display_name": "Paxi1337", "link": "https://stackoverflow.com/users/11264642/paxi1337"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1553689933, "post_id": 55372669, "comment_id": 97476569, "body": "I guess I will end up with the second approach to have a &quot;fix&quot; instead of a &quot;workaround&quot;. But where am I supposed to use <code>JNI</code> target? Isn&#39;t <code>add_library(JNI SHARED IMPORTED)</code> with the properties already enough or does this only affect libcobjava and not the consuming library? Putting <code>target_link_libraries(${PROJECT_NAME} JNI)</code> in addition fails because JNI evaluates to <code>&#47;usr&#47;lib&#47;jvm&#47;java-1.8.0-openjdk-amd64&#47;jre&#47;lib&#47;amd64&#47;libjawt.&zwnj;&#8203;so;&#47;usr&#47;lib&#47;jvm&#47;java&zwnj;&#8203;-1.8.0-openjdk-amd64&zwnj;&#8203;&#47;jre&#47;lib&#47;amd64&#47;serve&zwnj;&#8203;r&#47;libjvm.so</code> and hence gcc complains about &#39;No such file or directory&#39; when compiling libcobjava"}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1553690429, "post_id": 55372669, "comment_id": 97476888, "body": "<code>target_link_libraries(${PROJECT_NAME} JNI)</code> is a proper way for use JNI. You show the list of <code>.so</code> files, which are part of JNI libraries. They all should exist on your PC. BTW, linking with IMPORTED library is propagated to the config file <i>directly</i>. CMake expects from you to add appropriate code into the config file, which creates that imported target again (with all required properties)."}, {"owner": {"reputation": 75, "user_id": 11264642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4113b472043c22ac7042512645ad1dab?s=128&d=identicon&r=PG&f=1", "display_name": "Paxi1337", "link": "https://stackoverflow.com/users/11264642/paxi1337"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1553691295, "post_id": 55372669, "comment_id": 97477472, "body": "The libraries exist on the filesystem, but I assume the <code>;</code> is the issue. libcobjava compiles when I seperate the <code>target_link_libraries</code> like: <code>target_link_libraries(${PROJECT_NAME} &#47;usr&#47;lib&#47;jvm&#47;java-1.8.0-openjdk-amd64&#47;jre&#47;lib&#47;amd64&#47;server&#47;l&zwnj;&#8203;ibjvm.so) target_link_libraries(${PROJECT_NAME} &#47;usr&#47;lib&#47;jvm&#47;java-1.8.0-openjdk-amd64&#47;jre&#47;lib&#47;amd64&#47;libjawt.&zwnj;&#8203;so)</code> But library B still fails to find the jni include. You mean IMPORTED library is NOT propagated? What do I need to add in the config file? I did not write the config file on my own. It is created via the install rules in my CMakeLists.txt"}, {"owner": {"reputation": 75, "user_id": 11264642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4113b472043c22ac7042512645ad1dab?s=128&d=identicon&r=PG&f=1", "display_name": "Paxi1337", "link": "https://stackoverflow.com/users/11264642/paxi1337"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1553691432, "post_id": 55372669, "comment_id": 97477576, "body": "Do I need to create seperate JNI config file like  <code>install(EXPORT JNIConfig DESTINATION ${CMAKE_INSTALL_PREFIX}&#47;cmake)</code> for the JNI target? I need to leave the office now but try it latest by tomorrow if this is what you meant."}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1553693042, "post_id": 55372669, "comment_id": 97478755, "body": "Oh, just notice that - you are attempting to make <code>IMPORTED_LOCATION</code> property to be a <b>list</b> of libraries. This doesn&#39;t work. That property should contain only <b>one</b> library. You may link your IMPORTED library with other libraries. &quot;I did not write the config file on my own. It is created via the install rules in my CMakeLists.txt&quot; - You are actually expected to write the <code>XXXConfig.cmake</code> file by hands; CMake only helps you in that purpose. See that my answer for details: <a href=\"https://stackoverflow.com/questions/51290927/cmake-how-do-i-add-a-function-to-an-installed-config/51293903#51293903\" title=\"cmake how do i add a function to an installed config\">stackoverflow.com/questions/51290927/&hellip;</a>"}], "owner": {"reputation": 75, "user_id": 11264642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4113b472043c22ac7042512645ad1dab?s=128&d=identicon&r=PG&f=1", "display_name": "Paxi1337", "link": "https://stackoverflow.com/users/11264642/paxi1337"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 663, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1553686922, "creation_date": 1553675205, "last_edit_date": 1592644375, "question_id": 55372669, "link": "https://stackoverflow.com/questions/55372669/cmake-include-dependencies-using-find-package-from-installed-target", "title": "cmake include dependencies using find_package from installed target", "body": "<p>I am currently migrating a couple of CodeBlock projects to use CMake and Visual Studio Code. I am facing an issue related to the include directory not being known by the consuming target.</p>\n<p>I followed a guide so far as I was not aware of the &quot;modern CMake way&quot; using targets at all until yet. Mainly referring to here: <a href=\"https://rix0r.nl/blog/2015/08/13/cmake-guide/\" rel=\"nofollow noreferrer\">https://rix0r.nl/blog/2015/08/13/cmake-guide/</a> and the official CMake docs.\nThere are two libraries (.so). One of them needs to other one to be there (build) when it get's loaded by the application later on.\nI am not sure if everything is even intended to work like I assume it to work so I will just continue with the code and the expected result.</p>\n<p>Library A (which is needed by Library B) has following CMakeLists</p>\n<pre><code>cmake_minimum_required(VERSION 3.0.0)\nproject(A)\n\nset(SOURCE somesource.c)\n\ninclude(GNUInstallDirs)\n\nfind_package(JNI REQUIRED)\nadd_library(JNI SHARED IMPORTED)\nset_property(TARGET JNI PROPERTY INTERFACE_INCLUDE_DIRECTORIES $ENV{JAVA_HOME}/include $ENV{JAVA_HOME}/include/linux)\nset_property(TARGET JNI PROPERTY IMPORTED_LOCATION ${JNI_LIBRARIES})\n\nadd_library(${PROJECT_NAME} SHARED ${SOURCE})\n\ntarget_include_directories(${PROJECT_NAME} \n    PUBLIC \n        $&lt;BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include $ENV{JAVA_HOME}/include $ENV{JAVA_HOME}/include/linux&gt;\n        $&lt;INSTALL_INTERFACE:include&gt;\n)\n\ninstall(DIRECTORY include/ DESTINATION ${CMAKE_INSTALL_INCLUDEDIR})\n\ninstall(TARGETS ${PROJECT_NAME} EXPORT ${PROJECT_NAME}Config\n    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR})\n\ninstall(EXPORT ${PROJECT_NAME}Config DESTINATION ${CMAKE_INSTALL_PREFIX}/cmake)\n</code></pre>\n<p>Notice I only have one include file which is public and located in &quot;include&quot;, so its used by the library itself but should also be part of the install interface\nused by the &quot;consuming&quot; target.</p>\n<p>Library B (which uses Library A and its header)</p>\n<pre><code>cmake_minimum_required(VERSION 3.0)\nproject(B)\n\nset(SOURCE somesource.c)\n\nadd_library(${PROJECT_NAME} SHARED ${SOURCE})\n\nfind_package(A REQUIRED)\n\ntarget_include_directories(${PROJECT_NAME}\n    PRIVATE ${PROJECT_SOURCE_DIR}\n)\n</code></pre>\n<p>So in Library B I assume that I do not need to add the include_directories from Library A again. This is why I actually did the target approach so there is no need to keep track of linker/include dependencies. &quot;find_package&quot; should handle these on it's own right? I do not link neither because it is a shared object, not a static library.\nBoth libraries use the same CMAKE_INSTALL_PREFIX ofc and library A has been installed (make install). I double-checked on this. In case of using a different prefix or not doing the install, CMake already complains about not finding it.</p>\n<p>So considering the issue now:\nWithin a source file from library B, I am using</p>\n<pre><code>#include &lt;libcobjava.h&gt;\n</code></pre>\n<p>resulting in an error when building as the compiler complains about &quot;No such file or directory&quot; Am I missing something? The file is definitely located at\nCMAKE_INSTALL_PREFIX/include.</p>\n<p>Apart from that as I am still new to CMake: Is this even the way you would do things if you own all the source?</p>\n<h1>Edit: Some more details on the follow-up issue as discussed in comments. Library A is libcobjava.</h1>\n<p>First I had the target_include_directories part as following (including the path where jni.h is located in <code>$&lt;INSTALL_INTERFACE:</code>)</p>\n<pre><code>target_include_directories(${PROJECT_NAME} \n    PUBLIC \n        $&lt;BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include $ENV{JAVA_HOME}/include $ENV{JAVA_HOME}/include/linux&gt; \n        $&lt;INSTALL_INTERFACE:include $ENV{JAVA_HOME}/include $ENV{JAVA_HOME}/include/linux&gt;        \n)\n</code></pre>\n<p>results in following error:</p>\n<pre><code>[cmake] Configuring done\n[cmake] CMake Error in CMakeLists.txt:\n[cmake]   Target &quot;libcobjava&quot; INTERFACE_INCLUDE_DIRECTORIES property contains path:\n[cmake] \n[cmake]     &quot;/media/rbs42/data/Gebos/RBS42/tools/libcobjava/${_IMPORT_PREFIX}/include&quot;\n[cmake] \n[cmake]   which is prefixed in the source directory.\n[cmake] \n[cmake] \n[cmake] Generating done\n[cms-driver] Error during CMake configure: [cmake-server] Failed to compute build system.\n</code></pre>\n<p>This is why I removed <code>$ENV{JAVA_HOME}/include $ENV{JAVA_HOME}/include/linux&gt;</code> from <code>$&lt;INSTALL_INTERFACE</code> again.</p>\n<p>The actual error I am getting in library B now is during compiling:</p>\n<pre><code>[build] /media/rbs42/data/rbs42/usr/include/libcobjava.h:1:10: fatal error: jni.h: No such file or directory\n[build]  #include &lt;jni.h&gt;\n</code></pre>\n<p>because library B does not have the include directories from library A that are not included in the <code>$&lt;INSTALL_INTERFACE</code>. This is what one would expect. And thats the reason I added the following code before in library A.</p>\n<pre><code>set_property(TARGET JNI PROPERTY INTERFACE_INCLUDE_DIRECTORIES $ENV{JAVA_HOME}/include $ENV{JAVA_HOME}/include/linux)\n</code></pre>\n<p>which I assumed is taking care of propagating the include dependencies from library A to the &quot;consuming&quot; library B, although they are not part of the <code>$&lt;INSTALL_INTERFACE</code>.</p>\n"}, {"tags": ["c", "assembly", "x86", "nasm", "bootloader"], "comments": [{"owner": {"reputation": 1220, "user_id": 5878272, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/14e96159153b67fab5222b7c5fa18c71?s=128&d=identicon&r=PG&f=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/5878272/fredrik"}, "edited": false, "score": 0, "creation_date": 1553674311, "post_id": 55372368, "comment_id": 97467193, "body": "You don\u2019t actually need a bootloader, but if you want one, do what you want in it then jump to the start address of the kernel. The start of the kernel should be placed at a specific memory address so you can jump to it, check the documentation for your linker and how to place the kernel at a specific memory address. What MCU are you using?"}, {"owner": {"reputation": 1220, "user_id": 5878272, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/14e96159153b67fab5222b7c5fa18c71?s=128&d=identicon&r=PG&f=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/5878272/fredrik"}, "edited": false, "score": 0, "creation_date": 1553674719, "post_id": 55372368, "comment_id": 97467386, "body": "The proccess of actually calling the kernel is easiest done via asm through a jump or just setting the PC to the start address of the kernel."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1553675039, "post_id": 55372368, "comment_id": 97467549, "body": "Freestanding systems don&#39;t use <code>int main (void)</code>, who are you gonna return to? Also one never uses <code>char</code> for raw binary manipulations since it might be signed, use <code>uint8_t</code> instead. And to access physical addresses you need to use <code>volatile uint8_t*</code>. These are very basic things..."}, {"owner": {"reputation": 381, "user_id": 10789312, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cz2OJ.jpg?s=128&g=1", "display_name": "liaquore", "link": "https://stackoverflow.com/users/10789312/liaquore"}, "edited": false, "score": 0, "creation_date": 1553675465, "post_id": 55372368, "comment_id": 97467748, "body": "I would assume I&#39;d be returning to where the line of execution came from, the assembly script."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 1220, "user_id": 5878272, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/14e96159153b67fab5222b7c5fa18c71?s=128&d=identicon&r=PG&f=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/5878272/fredrik"}, "edited": false, "score": 0, "creation_date": 1553676606, "post_id": 55372368, "comment_id": 97468342, "body": "@Fredrik: jumps <i>are</i> how you set PC (specifically IP/EIP/RIP on x86).  IDK why you said &quot;or&quot;.  Maybe you&#39;re thinking of 32-bit ARM where PC is one of the 16 architectural registers, so you can jump with a <code>mov</code> to PC?  Notice that this question is tagged <a href=\"https://stackoverflow.com/questions/tagged/x86\">x86</a>, and from context we can infer that it&#39;s a PC-compatible system booting in legacy BIOS mode.  (512-byte boot sector ending with <code>0xaa55</code>, containing machine code that will run in 16-bit real mode.)"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1553676844, "post_id": 55372368, "comment_id": 97468493, "body": "But anyway, <code>call kmain</code> is not pseudocode, that&#39;s a literal x86 <code>call</code> instruction.  (Except it won&#39;t work unless you link the bootloader and the kernel together into one binary, and that&#39;s not recommended.)"}, {"owner": {"reputation": 381, "user_id": 10789312, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cz2OJ.jpg?s=128&g=1", "display_name": "liaquore", "link": "https://stackoverflow.com/users/10789312/liaquore"}, "edited": false, "score": 0, "creation_date": 1553678700, "post_id": 55372368, "comment_id": 97469654, "body": "I&#39;ve seen somewhere saying you don&#39;t have to link everything into a single file. Can I not call a function from a different file in the same location?"}, {"owner": {"reputation": 14469, "user_id": 2191105, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/tPiCW.png?s=128&g=1", "display_name": "David Hoelzer", "link": "https://stackoverflow.com/users/2191105/david-hoelzer"}, "edited": false, "score": 2, "creation_date": 1553683770, "post_id": 55372368, "comment_id": 97472714, "body": "You need to spend some time at <a href=\"https://wiki.osdev.org/Main_Page\" rel=\"nofollow noreferrer\">wiki.osdev.org/Main_Page</a> - There are tutorials covering everything you are asking about."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1553687951, "post_id": 55372368, "comment_id": 97475338, "body": "@liaquore: Don&#39;t think of it as a function call into the kernel, think of it as the bootloader <i>jumping</i> to the kernel (and the kernel only cares about itself, not the bootloader&#39;s memory).  So the bootloader loads some sectors into memory at an address it chooses, then jumps <i>to that address</i> (or to a point within that region).  You use a linker script to make sure the entry for your kernel is at the first byte.  (A fancier kernel like Linux would have some hand-written asm for the actual entry point from the bootloader, doing some decompression and stuff before calling a C function.)"}], "owner": {"reputation": 381, "user_id": 10789312, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cz2OJ.jpg?s=128&g=1", "display_name": "liaquore", "link": "https://stackoverflow.com/users/10789312/liaquore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1553676701, "creation_date": 1553673934, "last_edit_date": 1553676701, "question_id": 55372368, "link": "https://stackoverflow.com/questions/55372368/have-i-correctly-set-out-what-would-happen-in-my-boot-sector-loader", "title": "Have I correctly set out what would happen in my boot sector/loader?", "body": "<p>I'm trying to make a simple boot loader to setup for my kernel in C to take over, and I'm not sure how to do that. I've laid out using comments what I think I need to do to prepare for this.</p>\n\n<p>test.asm:</p>\n\n<pre><code>;test.asm\n\n;initialization type stuff\n[bits 16]\n[org 0x7c00]\n\n;initialize anything I need to\n\n;maybe move to 64-bit protected mode\n;load kernel\n;call kmain\n\n;padding &amp; magic number (end)\ntimes 510-($-$$) db 0\ndw 0xaa55\n</code></pre>\n\n<p>kernel.c:</p>\n\n<pre><code>//kernel.c\n\n//main entry point for kernel\nint kmain(void)\n{\n    //video memory\n    char *vidptr = (char*)0xb8000;\n    vidptr[0] = 'X';\n    while(1) {}\n    return 0; //might create an error because it is unreachable\n}\n</code></pre>\n\n<p>I'd appreciate help in correcting the process I'm trying to do. Help with actually getting my boot loader to call the kernel would be great as well.</p>\n"}, {"tags": ["c++", "c", "types", "calling-convention", "cross-language"], "comments": [{"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 9, "creation_date": 1553673729, "post_id": 55372217, "comment_id": 97466907, "body": "If your enum is in a class, you can&#39;t access it from C."}, {"owner": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 1, "creation_date": 1553673760, "post_id": 55372217, "comment_id": 97466926, "body": "don&#39;t think there is much you can do other than move/copy your enum into the global namespace"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 1, "creation_date": 1553674024, "post_id": 55372217, "comment_id": 97467044, "body": "Why that <code>typedef enum ...</code> in C++ ?"}, {"owner": {"reputation": 54044, "user_id": 3723423, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a2c916310a1261b53773de75fc83e5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/3723423/christophe"}, "edited": false, "score": 0, "creation_date": 1553674623, "post_id": 55372217, "comment_id": 97467336, "body": "your .h is not your real .h, since at least <code>class</code> or <code>struct</code>  and <code>;</code> are missing. Are there other things that you&#39;ve left out ?"}, {"owner": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "reply_to_user": {"reputation": 54044, "user_id": 3723423, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a2c916310a1261b53773de75fc83e5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/3723423/christophe"}, "edited": false, "score": 0, "creation_date": 1553689955, "post_id": 55372217, "comment_id": 97476584, "body": "@Christophe Fixed. What do you mean by &#39;other things&#39; ?"}, {"owner": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1553690117, "post_id": 55372217, "comment_id": 97476696, "body": "@bruno The type defined in the class is used as a type of class method argument. These methods are not shown in my example."}, {"owner": {"reputation": 54044, "user_id": 3723423, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a2c916310a1261b53773de75fc83e5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/3723423/christophe"}, "edited": false, "score": 1, "creation_date": 1553705049, "post_id": 55372217, "comment_id": 97486952, "body": "The duplicate provided to close this answer is IMHO not an appropriate one, since it doesn\u2019t address the issue with types."}, {"owner": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "reply_to_user": {"reputation": 54044, "user_id": 3723423, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a2c916310a1261b53773de75fc83e5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/3723423/christophe"}, "edited": false, "score": 0, "creation_date": 1553706978, "post_id": 55372217, "comment_id": 97487983, "body": "@Christophe Is there anything I should do to get my question not tagged as duplicated ?"}, {"owner": {"reputation": 54044, "user_id": 3723423, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a2c916310a1261b53773de75fc83e5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/3723423/christophe"}, "edited": false, "score": 0, "creation_date": 1553714981, "post_id": 55372217, "comment_id": 97492045, "body": "@4nti7rust I&#39;ve aded two more duplicate, one about your template error message and one about enums.  Together they should finally cover all your topics."}, {"owner": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "reply_to_user": {"reputation": 54044, "user_id": 3723423, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a2c916310a1261b53773de75fc83e5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/3723423/christophe"}, "edited": false, "score": 0, "creation_date": 1553771978, "post_id": 55372217, "comment_id": 97512806, "body": "@Christophe Thx, both questions have very interesting answers, but they still doesn&#39;t answer all my questions. I wanted to know if it was possible (and those two related question provide an answer), and if not, if there is a workaround (I don&#39;t have an answer to that in related questions). I see now that I should have asked only this second question."}], "answers": [{"comments": [{"owner": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "edited": false, "score": 0, "creation_date": 1553693587, "post_id": 55374069, "comment_id": 97479106, "body": "That is a good proposal, but sadly I have linking errors when doing that (<code>Undefined reference</code> and <code>multiple definition</code>). Do you know what could create that (<code>big_hugly_include.h</code> is really full of ****) ? I have added try 3 in my question."}, {"owner": {"reputation": 1493, "user_id": 4377932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/f9nFx.jpg?s=128&g=1", "display_name": "artcorpse", "link": "https://stackoverflow.com/users/4377932/artcorpse"}, "reply_to_user": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "edited": false, "score": 0, "creation_date": 1553701493, "post_id": 55374069, "comment_id": 97484670, "body": "Unfortunately I don&#39;t think I can give too much insight without learning about this big_hugly_include.h. It sounds like a C++ header file, so it&#39;s most probably important for it to be outside the extern &quot;C&quot; block. The two types of errors you&#39;re mentioning sound like linking errors, so some of your other cpp files must be mismatched. Are you getting any errors related to &quot;_foo&quot;?"}, {"owner": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "edited": false, "score": 0, "creation_date": 1553701609, "post_id": 55374069, "comment_id": 97484749, "body": "No error related to _foo, but I suspect this include to have mixed c and cpp header files."}], "tags": [], "owner": {"reputation": 1493, "user_id": 4377932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/f9nFx.jpg?s=128&g=1", "display_name": "artcorpse", "link": "https://stackoverflow.com/users/4377932/artcorpse"}, "is_accepted": false, "score": 1, "last_activity_date": 1553680202, "last_edit_date": 1553680202, "creation_date": 1553679851, "answer_id": 55374069, "question_id": 55372217, "link": "https://stackoverflow.com/questions/55372217/how-to-use-internal-c-class-types-from-c/55374069#55374069", "title": "How to use internal c++ class types from C?", "body": "<p>Your Try2 is pretty close to a solution. Try to move the include outside extern \"C\". \nI usually just mark each function individually:</p>\n\n<pre><code>extern \"C\" void foo() \n{\n...\n}\n</code></pre>\n\n<p>This has the benefit of just exporting the one symbol as a C symbol, instead of trying to convert everything.</p>\n"}, {"comments": [{"owner": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "edited": false, "score": 0, "creation_date": 1553693863, "post_id": 55374409, "comment_id": 97479291, "body": "I will probably end up doing that, but I have only one C file using this class, everything else is C++ and I wanted to keep everything inside class namespace to avoid all my enum definition to be global (I really have a lot of them and it will quickly be very messy)."}, {"owner": {"reputation": 22818, "user_id": 1387438, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad806758c356c915ea08a4bfd79131e3?s=128&d=identicon&r=PG", "display_name": "Marek R", "link": "https://stackoverflow.com/users/1387438/marek-r"}, "reply_to_user": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "edited": false, "score": 0, "creation_date": 1553694049, "post_id": 55374409, "comment_id": 97479409, "body": "There are no namespaces in C or neither classes, so you can&#39;t use them if you need access API form C."}, {"owner": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "edited": false, "score": 0, "creation_date": 1553694244, "post_id": 55374409, "comment_id": 97479540, "body": "I understand that, but is there a way to define a C type that is a copy of the one inside my class ?"}, {"owner": {"reputation": 22818, "user_id": 1387438, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad806758c356c915ea08a4bfd79131e3?s=128&d=identicon&r=PG", "display_name": "Marek R", "link": "https://stackoverflow.com/users/1387438/marek-r"}, "reply_to_user": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "edited": false, "score": 0, "creation_date": 1553694879, "post_id": 55374409, "comment_id": 97480024, "body": "only some script which will parse original file and generate respective C header."}, {"owner": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "edited": false, "score": 0, "creation_date": 1553695340, "post_id": 55374409, "comment_id": 97480363, "body": "Ugly. Ok, I think I will just do it manually, hopefully when the code will evolve to more C++ we will get rid of it. I will wait a few more hours to see if someone else comes with another workaround, else I think your answer is the one that makes more sense. If you could rewrite your answer with the same namings as my example, and show how to include this type declaration back to the class, that would make it perfect !"}, {"owner": {"reputation": 22818, "user_id": 1387438, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad806758c356c915ea08a4bfd79131e3?s=128&d=identicon&r=PG", "display_name": "Marek R", "link": "https://stackoverflow.com/users/1387438/marek-r"}, "reply_to_user": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "edited": false, "score": 0, "creation_date": 1553696676, "post_id": 55374409, "comment_id": 97481272, "body": "You can try invent some nasty macros, to handle that. But it could as painful as writing a script."}], "tags": [], "owner": {"reputation": 22818, "user_id": 1387438, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad806758c356c915ea08a4bfd79131e3?s=128&d=identicon&r=PG", "display_name": "Marek R", "link": "https://stackoverflow.com/users/1387438/marek-r"}, "is_accepted": false, "score": 3, "last_activity_date": 1553681176, "last_edit_date": 1553681176, "creation_date": 1553680777, "answer_id": 55374409, "question_id": 55372217, "link": "https://stackoverflow.com/questions/55372217/how-to-use-internal-c-class-types-from-c/55374409#55374409", "title": "How to use internal c++ class types from C?", "body": "<blockquote>\n  <p>I want to use that enum in a C file. How can I do that?</p>\n</blockquote>\n\n<p>Enum concept in C++ originates from C, so only thing you have to do is to isolate definition this enum from pure cpp API which is not known to C (remember about name mangling, see below).</p>\n\n<p>Since C do not know in class/struct enums you can't use them. You have to define global scope enumeration or create such enumeration which will map C++ specific enumeration.</p>\n\n<p>So create separate header file where shared API should be located. Do something like this:</p>\n\n<pre><code>// shared C, C++ header\n#ifdef __cplusplus\nextern \"C\" \n{\n#endif\n\nenum YourMagicEnum {\n    YourMagicEnumAValue,\n    YourMagicEnumBValue,\n    YourMagicEnumCValue,\n};\n\nvoid someFunction(YourMagicEnum x);\n\n#ifdef __cplusplus\n} // extern \"C\"\n#endif\n</code></pre>\n\n<p>Now this <code>extern \"C\"</code> is needed only for functions to disable name mangling (in C++ you can do function overloads, so compiler generates names which contain arguments type information).</p>\n\n<p>When defining such function it should also have the <code>extern \"C\"</code> in front of that definition.</p>\n\n<p>And remember in that header only C specific features and functions can be placed.</p>\n\n<p>Also remember that VLA (Variable-length array) is in C standard, but not in C++ standard (most compiler support VLA for C++).</p>\n\n<p>For more information <a href=\"https://isocpp.org/wiki/faq/mixing-c-and-cpp\" rel=\"nofollow noreferrer\">see this page</a>.</p>\n"}], "owner": {"reputation": 96, "user_id": 1649728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c815f1bbfb5c246c44a1e8467f1a5c0?s=128&d=identicon&r=PG", "display_name": "4nti7rust", "link": "https://stackoverflow.com/users/1649728/4nti7rust"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 447, "favorite_count": 0, "closed_date": 1553700623, "answer_count": 2, "score": 3, "last_activity_date": 1553714797, "creation_date": 1553673185, "last_edit_date": 1553713173, "question_id": 55372217, "link": "https://stackoverflow.com/questions/55372217/how-to-use-internal-c-class-types-from-c", "closed_reason": "Duplicate", "title": "How to use internal c++ class types from C?", "body": "<p>I have a C++ class <code>MyClass</code> that declare a public enum type <code>MyEnum</code>, and I want to use that enum in a C file. How can I do that ?</p>\n\n<p>I tried to declare my functions in a C++ file and then put everything as <code>extern \"C\"</code>, but sadly I am using some functions defined in <code>big_hugly_include.h</code> and this header does not like being included as <code>external \"C\"</code> (it gives me a <code>template with C linkage</code> error).</p>\n\n<p>I cannot (don't want to) change this include, and I need it because it defines <code>my_function_from_big_include</code>. Am I stuck ?</p>\n\n<hr>\n\n<p><em><code>my_class_definition.h</code></em> :</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>class MyClass\n{\npublic:\n   // I would like to keep it that way as it is mainly used in C++ files\n   typedef enum\n   {\n      MY_ENUM_0,\n      MY_ENUM_1,\n      MY_ENUM_2\n   } MyEnum;\n};\n</code></pre>\n\n<hr>\n\n<p><em>Try 1 : <code>my_c_function_definition.c</code></em> :</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include \"my_class_definition.h\"\n\n// I cannot remove this header\n#include \"big_hugly_include.h\"\n\n// foo is called in other C files\nvoid foo()\n{\n   // I need to call this function with the enum from the C++ class\n   // This doesn't work (class name scope does not exist in C)\n   my_function_from_big_include(MyClass::MyEnum::MY_ENUM_0);\n}\n</code></pre>\n\n<hr>\n\n<p><em>Try 2 : <code>my_c_function_definition.cpp</code></em> :</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include \"my_class_definition.h\"\n\nextern \"C\"\n{\n\n// Error template with C linkage\n#include \"big_hugly_include.h\"\n\n// foo is called in other C files\nvoid foo()\n{\n   // That would be ideal\n   my_function_from_big_include(MyClass::MyEnum::MY_ENUM_0);\n}\n\n// end of extern \"C\"\n}\n</code></pre>\n\n<hr>\n\n<p><em>Edited in response to @artcorpse</em></p>\n\n<p><em>Try 3 : <code>my_c_function_definition.cpp</code></em> :</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include \"my_class_definition.h\"\n\n// Error multiple definition of [...]\n// Error undefined reference to [...]\n#include \"big_hugly_include.h\"\n\nextern \"C\"\n{\n// foo is called in other C files\nvoid foo()\n{\n   // That would be ideal\n   my_function_from_big_include(MyClass::MyEnum::MY_ENUM_0);\n}\n\n// end of extern \"C\"\n}\n</code></pre>\n"}, {"tags": ["c", "pointers", "language-lawyer"], "comments": [{"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 4, "creation_date": 1553671350, "post_id": 55371760, "comment_id": 97465827, "body": "Your example has nothing to do with what kind of pointers they are. They point to different places so they are not equal. Even if you change the <code>void*</code> to also be <code>char*</code> the result will stay the same. Likewise if you change it so both point to the same place (for instance <code>i</code>) then the result is <code>1</code> no matter whether they&#39;re <code>char*</code> or <code>void*</code>."}, {"owner": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 2, "creation_date": 1553671443, "post_id": 55371760, "comment_id": 97465861, "body": "The standard is talking about the object representation of <b>the pointer</b>, not the object representation of the <b>object pointed to</b>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 6, "creation_date": 1553671637, "post_id": 55371760, "comment_id": 97465934, "body": "I&#39;m pretty sure it&#39;s saying that if <code>int i; char *pc = (char *)&amp;i; void *pv = &amp;i;</code>, then <code>memcmp(&amp;pc, &amp;pv, sizeof pc) == 0</code>."}, {"owner": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1553671841, "post_id": 55371760, "comment_id": 97466031, "body": "@melpomene So a pointer to <code>char *</code> converted to a pointer to <code>void *</code> (explicitly or implicitly) will have the same object representation. The Standard did not specify that explicitly, probably this is obvious since as @Blaze mentioned they are pointing to different objects and cannot compare equal."}, {"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1553672484, "post_id": 55371760, "comment_id": 97466319, "body": "I think here&#39;s a confusion on how terms are used in standard: <i>representation requirement of the type</i> and <i>object representation of the value</i>, which are slightly different things."}, {"owner": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "reply_to_user": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1553672770, "post_id": 55371760, "comment_id": 97466444, "body": "@user694733 Searching for the <i>representation requirement</i> term in the Standard did not give any result. Can you give a reference to its definition?"}, {"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1553673063, "post_id": 55371760, "comment_id": 97466600, "body": "There&#39;s probably no actual definition anywhere. I think it&#39;s more of what is implied by the difference in wording in chapters &#167; 6.2.5 and 6.2.6."}, {"owner": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "reply_to_user": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1553673121, "post_id": 55371760, "comment_id": 97466628, "body": "@user694733 Probably that means that the size of <code>unsigned char[n]</code> should be the same... I guess..."}], "answers": [{"comments": [{"owner": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "edited": false, "score": 0, "creation_date": 1553678482, "post_id": 55372878, "comment_id": 97469512, "body": "<code>char * test1 = &amp;i;</code> I think this causes undefined behavior. Since the rules of assignment operator <code>6.5.16.1(p1)</code> <i>both operands  are pointers to qualified or unqualified versions of compatible types</i>. So we need to cast explicitly as <code>char * test1 = (char *) &amp;i;</code>."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "edited": false, "score": 0, "creation_date": 1553718830, "post_id": 55372878, "comment_id": 97493821, "body": "@SomeName That would be &quot;ill formed&quot; rather than UB"}, {"owner": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1553753828, "post_id": 55372878, "comment_id": 97503360, "body": "@curiousguy In C++ maybe, but as far as I can tell the C Standard does not define the term &quot;ill-formed program&quot; or similar. At least searching for the word &quot;ill&quot; did not yield any usefull result."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "edited": false, "score": 1, "creation_date": 1553782153, "post_id": 55372878, "comment_id": 97519673, "body": "@SomeName You are probably right here... I might have confused C++ and C terminology. My bad."}], "tags": [], "owner": {"reputation": 13124, "user_id": 1419272, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dcbff46aa5cd0a98d13d76595b3375f0?s=128&d=identicon&r=PG", "display_name": "alinsoar", "link": "https://stackoverflow.com/users/1419272/alinsoar"}, "is_accepted": false, "score": 2, "last_activity_date": 1553679541, "last_edit_date": 1553679541, "creation_date": 1553675973, "answer_id": 55372878, "question_id": 55371760, "link": "https://stackoverflow.com/questions/55371760/object-representation-of-char-and-void/55372878#55372878", "title": "Object representation of char * and void *", "body": "<pre><code>printf(\"%d\\n\", test2 == test1);\n</code></pre>\n\n<p>The pointer test2 is different than test1 because you compare their values, that represent the locations of i and j.  I and J are different variables with different location for the object representing them. </p>\n\n<p>So it is correct to be 0 the output.</p>\n\n<p>In case that you do so:</p>\n\n<pre><code>int i = 10;\nchar * test1 = (char *) &amp;i;\nvoid * test2 = &amp;i;\nprintf(\"%d\\n\", test2 == test1);\n</code></pre>\n\n<p>the output will be 1.</p>\n"}, {"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1553764705, "post_id": 55372948, "comment_id": 97508238, "body": "@melpomene Yeah there&#39;s always some experimental, historic architectures. But beyond the area of computer archaeology, important systems were the mainstream MS DOS and countless microcontroller systems, where external addressing beyond 16 bits were needed. They all solved this by inventing <code>far</code> qualifiers, to avoid subtle bugs during pointer conversions. The C language simply failed to meet the real world requirements in sensible ways."}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": true, "score": 2, "last_activity_date": 1553676250, "creation_date": 1553676250, "answer_id": 55372948, "question_id": 55371760, "link": "https://stackoverflow.com/questions/55371760/object-representation-of-char-and-void/55372948#55372948", "title": "Object representation of char * and void *", "body": "<p>\"Representation\" roughly means how things are stored in memory. The cited part 6.2.5 \u00a728 dictates that certain pointer types must be stored in identical ways. The same paragraph makes a few more requirements to various other pointer types.</p>\n\n<p>Apart from those pointer types listed, C gives some freedom to the implementation to store pointers in exotic and not necessarily compatible ways. But in practice this is misguided, since I don't think any real-world implementations ever did that. Instead systems with need of different pointer representations always seem to invent non-standard keywords for pointer qualifiers: <code>far</code> and <code>near</code>.</p>\n\n<hr>\n\n<blockquote>\n  <p>The code above prints 0 implying that the object representation of test2 and test1 is not the same, 6.2.6(p4)</p>\n</blockquote>\n\n<p>They point at different variables so of course it won't be the same - the pointers contain different values regardless of representation. To check if their <em>object representation</em> is the same, you must do this:</p>\n\n<pre><code>int i = 10;\nchar * test1 = (char *) &amp;i;\nvoid * test2 = &amp;i;\nprintf(\"%d\\n\", test2 == test1); // prints 1\n</code></pre>\n\n<p>Or better: <code>printf(\"%d\\n\", memcmp(test1, test2, sizeof test1));</code>. Which prints 0 (equal).</p>\n\n<hr>\n\n<blockquote>\n  <p>QUESTION: Does the clause assume that a pointer to void converted from a pointer to a character type shall have the same representation and alignment requirements as a pointer to a character type from which it was converted?</p>\n</blockquote>\n\n<p>Yes because that is is required by 6.2.5 \u00a728. We also have a requirement from the pointer conversions chapter 6.3.2.3 \u00a77:</p>\n\n<blockquote>\n  <p>A pointer to an object type may be converted to a pointer to a different object type. If the resulting pointer is not correctly aligned for the referenced type, the behavior is undefined. Otherwise, when converted back again, the result shall compare equal to the\n  original pointer.</p>\n</blockquote>\n\n<p>This too means that in practice all object pointers must have the same format internally, or otherwise the above wouldn't be possible.</p>\n"}], "owner": {"reputation": 6828, "user_id": 8990329, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f073ad236ccf499ebfbe504bc79a2096?s=128&d=identicon&r=PG&f=1", "display_name": "Some Name", "link": "https://stackoverflow.com/users/8990329/some-name"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 55372948, "answer_count": 2, "score": 1, "last_activity_date": 1553679541, "creation_date": 1553671183, "question_id": 55371760, "link": "https://stackoverflow.com/questions/55371760/object-representation-of-char-and-void", "title": "Object representation of char * and void *", "body": "<p>There is a claim in the Standard at <code>6.2.5(p28)</code>:</p>\n\n<blockquote>\n  <p>A pointer to <code>void</code> shall have the same representation and alignment \n  requirements as a pointer to a character type.</p>\n</blockquote>\n\n<p>I don't really understand that. The object representation is defined as a content of <code>unsigned char[sizeof(the_type)]</code> obtained by <code>memcpy</code>. </p>\n\n<p>So taking two arbitrary <code>char *</code> and <code>void *</code> like say:</p>\n\n<pre><code>int i = 10;\nchar * test1 = (char *) &amp;i;\n\nint j = 20;\nvoid * test2 = &amp;j;\nprintf(\"%d\\n\", test2 == test1); // prints 0\n</code></pre>\n\n<p>The code above prints <code>0</code> implying that the object representation of <code>test2</code> and <code>test1</code> is not the same, <code>6.2.6(p4)</code> </p>\n\n<blockquote>\n  <p>Two values  (otherthan  <code>NaN</code>s)  with  the  same  object  representation\n  compare  equal.</p>\n</blockquote>\n\n<p><strong><em>QUESTION:</em></strong> Does the clause assume that a pointer to void <strong>converted from a pointer to a character type</strong> shall have the same representation and alignment requirements as a pointer to a character type <strong>from which it was converted</strong>?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 545, "user_id": 9266860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef5206d6fd79c294c934bf07fd5e2ed4?s=128&d=identicon&r=PG&f=1", "display_name": "Gunther Schulz", "link": "https://stackoverflow.com/users/9266860/gunther-schulz"}, "edited": false, "score": 0, "creation_date": 1553671011, "post_id": 55371619, "comment_id": 97465675, "body": "Your last comment speaks of file &quot;dirent.h&quot;, while the whole rest of the question as well as the debug output speak of &quot;file_utils.c&quot; and &quot;file_utils.h&quot;. Are the perhaps conflicting definitions of what a <code>struct dirent</code> is in these 3 files?"}, {"owner": {"reputation": 31, "user_id": 6544049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9346473d353885e2921de1ff7e0fd7e?s=128&d=identicon&r=PG&f=1", "display_name": "Abhiram", "link": "https://stackoverflow.com/users/6544049/abhiram"}, "reply_to_user": {"reputation": 545, "user_id": 9266860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef5206d6fd79c294c934bf07fd5e2ed4?s=128&d=identicon&r=PG&f=1", "display_name": "Gunther Schulz", "link": "https://stackoverflow.com/users/9266860/gunther-schulz"}, "edited": false, "score": 0, "creation_date": 1553671398, "post_id": 55371619, "comment_id": 97465848, "body": "@GuntherSchulz I have included all the directives about dirent the code contains there is no other struct defined by me as such."}, {"owner": {"reputation": 545, "user_id": 9266860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef5206d6fd79c294c934bf07fd5e2ed4?s=128&d=identicon&r=PG&f=1", "display_name": "Gunther Schulz", "link": "https://stackoverflow.com/users/9266860/gunther-schulz"}, "edited": false, "score": 0, "creation_date": 1553672302, "post_id": 55371619, "comment_id": 97466226, "body": "@Abhiram check my full answer below"}], "answers": [{"comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 2, "creation_date": 1553671941, "post_id": 55371865, "comment_id": 97466075, "body": "But you can have as many repeated same declarations as you want. You have a missing <code>#endif</code>."}, {"owner": {"reputation": 545, "user_id": 9266860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef5206d6fd79c294c934bf07fd5e2ed4?s=128&d=identicon&r=PG&f=1", "display_name": "Gunther Schulz", "link": "https://stackoverflow.com/users/9266860/gunther-schulz"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1553672481, "post_id": 55371865, "comment_id": 97466314, "body": "@KamilCuk is correct in that repeated declarations are allowed. This is NOT the issue. See my full answer above"}, {"owner": {"reputation": 2583, "user_id": 3202696, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/QmN8u.png?s=128&g=1", "display_name": "TobiSH", "link": "https://stackoverflow.com/users/3202696/tobish"}, "edited": false, "score": 0, "creation_date": 1553672928, "post_id": 55371865, "comment_id": 97466535, "body": "Got your point. I missed this one. Sounds like a bad idea to have the  `    #include &lt;dirent.h&gt;` at the c file right?"}, {"owner": {"reputation": 31, "user_id": 6544049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9346473d353885e2921de1ff7e0fd7e?s=128&d=identicon&r=PG&f=1", "display_name": "Abhiram", "link": "https://stackoverflow.com/users/6544049/abhiram"}, "edited": false, "score": 0, "creation_date": 1553673244, "post_id": 55371865, "comment_id": 97466671, "body": "I tried moving the declaration as you suggested it still gives the same error of conflicting type"}], "tags": [], "owner": {"reputation": 2583, "user_id": 3202696, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/QmN8u.png?s=128&g=1", "display_name": "TobiSH", "link": "https://stackoverflow.com/users/3202696/tobish"}, "is_accepted": false, "score": 0, "last_activity_date": 1553671739, "creation_date": 1553671739, "answer_id": 55371865, "question_id": 55371619, "link": "https://stackoverflow.com/questions/55371619/facing-error-conflicting-data-type-but-cannot-find-any-conflict/55371865#55371865", "title": "Facing error Conflicting data type but cannot find any conflict", "body": "<p>It looks like the declaration of <code>bool is_relative_path(struct dirent *ent);</code> is AFTER the <code>#endif</code> preprocessor declaration (include guards). That mean including this header file in two different files will cause two declarations. Have a look at this: <a href=\"https://en.wikipedia.org/wiki/Include_guard\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Include_guard</a> to get some more details</p>\n\n<p>This should fix it:</p>\n\n<pre><code>#ifndef FILE_UTILS_H\n#define FILE_UTILS_H\n\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdbool.h&gt;\n#include &lt;sys/types.h&gt;\n\n#ifdef HAVE_DIRENT_H\n#include &lt;dirent.h&gt;\n#define NAMLEN(dirent) strlen((dirent)-&gt;d_name)\n\n#else\n\n#define dirent direct\n#define NAMLEN(dirent) ((dirent)-&gt;d_namlen)\n#ifdef HAVE_SYS_NDIR_H\n#include &lt;sys/ndir.h&gt;\n#endif\n\n#ifdef HAVE_SYS_DIR_H\n#include &lt;sys/dir.h&gt;\n#endif\n\n#ifdef HAVE_NDIR_H\n#include &lt;ndir.h&gt;\n#endif\n\n// moved the declaration between the #ifndef #endif block\nbool is_relative_path(struct dirent *ent);\n\n#endif\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 6544049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9346473d353885e2921de1ff7e0fd7e?s=128&d=identicon&r=PG&f=1", "display_name": "Abhiram", "link": "https://stackoverflow.com/users/6544049/abhiram"}, "edited": false, "score": 0, "creation_date": 1553673508, "post_id": 55371964, "comment_id": 97466814, "body": "adding the <code>HAVE_DIRENT_H</code> in the file_utils.c didn&#39;t work it throws the same error and <code>#include&lt;dirent.h&gt;</code> before <code>&quot;file_utils.h&quot;</code> throws previous error and also gives a error <code>file_utils.c: In function \u2018is_relative_path\u2019: file_utils.c:70:20: error: dereferencing pointer to incomplete type   return (strcmp(ent-&gt;d_name, &quot;.&quot;) == 0 || strcmp(ent-&gt;d_name, &quot;..&quot;) == 0);                     ^ file_utils.c:70:53: error: dereferencing pointer to incomplete type   return (strcmp(ent-&gt;d_name, &quot;.&quot;) == 0 || strcmp(ent-&gt;d_name, &quot;..&quot;) == 0);                                                      ^ </code>"}, {"owner": {"reputation": 545, "user_id": 9266860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef5206d6fd79c294c934bf07fd5e2ed4?s=128&d=identicon&r=PG&f=1", "display_name": "Gunther Schulz", "link": "https://stackoverflow.com/users/9266860/gunther-schulz"}, "reply_to_user": {"reputation": 31, "user_id": 6544049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9346473d353885e2921de1ff7e0fd7e?s=128&d=identicon&r=PG&f=1", "display_name": "Abhiram", "link": "https://stackoverflow.com/users/6544049/abhiram"}, "edited": false, "score": 0, "creation_date": 1553674224, "post_id": 55371964, "comment_id": 97467157, "body": "@Abhiram, &quot;dereferencing pointer to incomplete type&quot; typically happens when you misspell the destination type of a pointer, and then try and dereference the pointer to that misspelled type. <b>Check carefully</b> for typos on <code>struct dirent</code> usage"}], "tags": [], "owner": {"reputation": 545, "user_id": 9266860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef5206d6fd79c294c934bf07fd5e2ed4?s=128&d=identicon&r=PG&f=1", "display_name": "Gunther Schulz", "link": "https://stackoverflow.com/users/9266860/gunther-schulz"}, "is_accepted": false, "score": 1, "last_activity_date": 1553672625, "last_edit_date": 1553672625, "creation_date": 1553672134, "answer_id": 55371964, "question_id": 55371619, "link": "https://stackoverflow.com/questions/55371619/facing-error-conflicting-data-type-but-cannot-find-any-conflict/55371964#55371964", "title": "Facing error Conflicting data type but cannot find any conflict", "body": "<p>Your problem seems to be file inclusion order if <code>\"File_utils.c\"</code> and / or a missing definition of <code>HAVE_DIRENT_H</code>.</p>\n\n<p>In the given inclusion order, <code>\"file_utils.h\"</code> has no idea what a <code>struct dirent</code> is, since (presumably <code>HAVE_DIRENT_H</code>) is defined within <code>&lt;dirent.h&gt;</code>. If this is NOT the case, simply ensure that <code>HAVE_DIRENT_H</code> IS defined before including <code>\"file_utils.h\"</code></p>\n\n<p>The net effect as-is in the code is that in <code>\"file_utils.h\"</code>, <code>bool is_relative_path(struct dirent *ent)</code> is actually seen as <code>bool is_relative_path(some_pointer_to_an_unknown_struct_type ent)</code>, while the <code>\"file_utils.c\"</code> sees the function signature as as <code>bool is_relative_path(a_pointer_to_a_struct_type_i_definately_know_about ent)</code>. </p>\n\n<p>Thus the two files do NOT agree on the function signature.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>@n.m. is correct in that <code>\"file_utils.h\"</code> essentially sees a distinct definition of <code>struct dirent</code>, and that one cannot declare a type inside a function parameter list.</p>\n\n<p><strong>TLDR</strong></p>\n\n<p>Edit File_utils.c to define <code>HAVE_DIRENT_H</code> and / or <code>#include &lt;dirent.h&gt;</code> <strong>before</strong> <code>#include \"file_utils.h\"</code> so that both <code>\"file_utils.h\"</code> and <code>\"file_utils.c\"</code> see a common function signature for <code>bool is_relative_path(struct dirent *ent)</code></p>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 0, "last_activity_date": 1553680107, "last_edit_date": 1553680107, "creation_date": 1553672213, "answer_id": 55371985, "question_id": 55371619, "link": "https://stackoverflow.com/questions/55371619/facing-error-conflicting-data-type-but-cannot-find-any-conflict/55371985#55371985", "title": "Facing error Conflicting data type but cannot find any conflict", "body": "<p>You cannot declare a type inside a function parameter list. This is what happens when in File_utils.h you have a declaration of  <code>is_relative_path</code> with no prior declaration of <code>stuct dirent</code>.</p>\n\n<p>Either <code>#include &lt;dirent.h&gt;</code> in File_utils.h (recommended), or add a declaration</p>\n\n<pre><code>struct dirent;\n</code></pre>\n\n<p>somewhere in it above <code>is_relative_path</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "is_accepted": false, "score": 2, "last_activity_date": 1553672942, "creation_date": 1553672942, "answer_id": 55372153, "question_id": 55371619, "link": "https://stackoverflow.com/questions/55371619/facing-error-conflicting-data-type-but-cannot-find-any-conflict/55372153#55372153", "title": "Facing error Conflicting data type but cannot find any conflict", "body": "<ol>\n<li>Resolve all compiler warnings.</li>\n<li>Compile with all compiler warnings enabled <code>-Wall -Wextra</code>.</li>\n<li>Resolve all compiler warnings.</li>\n<li>The code you posted has a missing <code>#endif</code>, maybe probably from <code>#ifdef HAVE_DIRENT_H</code>, but I am guessing the last line of the <code>file_utils.h</code> should be a closing <code>#endif</code>.</li>\n<li>The warning I get from gcc is this:</li>\n</ol>\n\n<blockquote>\n  <p>warning: \u2018struct direct\u2019 declared inside parameter list<br>\n  warning: its scope is only this definition or declaration, which is probably not what you want</p>\n</blockquote>\n\n<p>This is the the most important warning. </p>\n\n<p>Structure definition is only valid inside function parameter list. Ex:</p>\n\n<pre><code>void other_f(\n   struct B a // this will forward declare struct B\n   // scope of this variable is _only_ inside function parameter list\n); // here struct B get's out of scope!\nstruct B b; // will error, there is no struct B here\n// struct B was declared inside function parameter list\n// you can't use it anywhere else\n</code></pre>\n\n<p>The MCVE to your problem would be this example:</p>\n\n<pre><code>void f(struct A);\nstruct A;\nvoid f(struct A); // error conflicting types for 'f'\n</code></pre>\n\n<p>The <code>struct A</code> will be declared (I call it \"auto-declared\") inside the function parameter list <code>void f( &lt;here&gt; )</code> on the first use. The structure declaration will be visible only inside the parameter list. So it's similar to a pseudocode:</p>\n\n<pre><code>{\n   struct A; // type only valid inside `{` `}` braces\n   void f(struct A a); // imagine this symbol is visible outside `{` `}`\n}\n</code></pre>\n\n<p>ie. the <code>struct A</code> is not visible outside the <code>{</code> <code>}</code>.</p>\n\n<p>Then you declare another <code>struct A</code>:</p>\n\n<pre><code>struct A;\nvoid f(struct A a);\n</code></pre>\n\n<p>But this <code>struct A</code> is different type as the other <code>struct A</code>. As it's different <code>struct A</code>, the function <code>f</code> is different, the compiler issues an error.</p>\n\n<p>No consider your header:</p>\n\n<pre><code>#define dirent direct\n...\nbool is_relative_path(struct dirent *ent);\n</code></pre>\n\n<p>I don't know if <code>direct</code> is a typo or not. But you need to forward declare the <code>struct direct</code>, so that the forward declaration of struct direct is visible outside the function parameter list of <code>is_relative_path</code> function.</p>\n\n<pre><code>struct direct;\n#define dirent direct\n...\n// or here:\nstruct dirent;\nbool is_relative_path(struct dirent *ent);\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 6544049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9346473d353885e2921de1ff7e0fd7e?s=128&d=identicon&r=PG&f=1", "display_name": "Abhiram", "link": "https://stackoverflow.com/users/6544049/abhiram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "answer_count": 4, "score": 2, "last_activity_date": 1553680107, "creation_date": 1553670640, "last_edit_date": 1553671570, "question_id": 55371619, "link": "https://stackoverflow.com/questions/55371619/facing-error-conflicting-data-type-but-cannot-find-any-conflict", "title": "Facing error Conflicting data type but cannot find any conflict", "body": "<p>I have declared a function in file_utils.h and defined it in file_utils.c At compile time it is gives a conflicting type error.</p>\n\n<p>File_utils.h</p>\n\n<pre><code>    #ifndef FILE_UTILS_H\n    #define FILE_UTILS_H\n\n    #include &lt;stdio.h&gt;\n    #include &lt;stdlib.h&gt;\n    #include &lt;stdint.h&gt;\n    #include &lt;string.h&gt;\n    #include &lt;stdbool.h&gt;\n    #include &lt;sys/types.h&gt;\n\n    #ifdef HAVE_DIRENT_H\n    #include &lt;dirent.h&gt;\n    #define NAMLEN(dirent) strlen((dirent)-&gt;d_name)\n\n    #else\n\n    #define dirent direct\n    #define NAMLEN(dirent) ((dirent)-&gt;d_namlen)\n    #ifdef HAVE_SYS_NDIR_H\n    #include &lt;sys/ndir.h&gt;\n    #endif\n\n    #ifdef HAVE_SYS_DIR_H\n    #include &lt;sys/dir.h&gt;\n    #endif\n\n    #ifdef HAVE_NDIR_H\n    #include &lt;ndir.h&gt;\n    #endif\n\n    #endif\n\n\n    bool is_relative_path(struct dirent *ent);\n</code></pre>\n\n<p>File_utils.c</p>\n\n<pre><code>    #include \"file_utils.h\"\n    #include &lt;stdbool.h&gt;\n    #include &lt;dirent.h&gt;\n\n    bool is_relative_path(struct dirent *ent){\n        return (strcmp(ent-&gt;d_name, \".\") == 0 || strcmp(ent-&gt;d_name, \"..\") == 0);\n     }\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>abhiram@abhiram-Lenovo-G50-70:~/libpostal-master/src$ gcc -DLIBPOSTAL_DATA_DIR='\"$//home/abhiram/libpostal-master/data\"' -o main main.c libpostal.c file_utils.c json_encode.c string_utils.c -std=c99 -w     \nfile_utils.c:45:6: error: conflicting types for \u2018is_relative_path\u2019\nbool is_relative_path(struct dirent *ent){\n     ^\nIn file included from file_utils.c:1:0:\nfile_utils.h:59:6: note: previous declaration of \u2018is_relative_path\u2019 was here\nbool is_relative_path(struct dirent *ent);\n     ^\n</code></pre>\n\n<p>I have included both dirent.h and stdbool.h libraries.</p>\n"}, {"tags": ["c", "storage-class-specifier"], "comments": [{"owner": {"reputation": 1809, "user_id": 7339171, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e618ef1f932f57ce1008799082f8db29?s=128&d=identicon&r=PG&f=1", "display_name": "CoffeeTableEspresso", "link": "https://stackoverflow.com/users/7339171/coffeetableespresso"}, "edited": false, "score": 0, "creation_date": 1553666026, "post_id": 55370448, "comment_id": 97463818, "body": "can you give an example of an auto variable that you&#39;d like to access outside the function it was defined in?"}, {"owner": {"reputation": 1809, "user_id": 7339171, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e618ef1f932f57ce1008799082f8db29?s=128&d=identicon&r=PG&f=1", "display_name": "CoffeeTableEspresso", "link": "https://stackoverflow.com/users/7339171/coffeetableespresso"}, "edited": false, "score": 0, "creation_date": 1553666056, "post_id": 55370448, "comment_id": 97463828, "body": "And what do you need this for? There might be a better way to achieve whatever you are trying to do"}, {"owner": {"reputation": 42446, "user_id": 902497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff13ece6277497484bfa2911c6183a30?s=128&d=identicon&r=PG", "display_name": "Raymond Chen", "link": "https://stackoverflow.com/users/902497/raymond-chen"}, "edited": false, "score": 8, "creation_date": 1553666186, "post_id": 55370448, "comment_id": 97463868, "body": "Scope and lifetime are different things. You can use pointers to access objects outside their scope, but not outside their lifetime."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1553670598, "post_id": 55370448, "comment_id": 97465519, "body": "I just was made aware that I assumed that you are not interested in the case of variables being accessed from functions which are called from within scope and during life-time. Can you clarify?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1553672918, "post_id": 55370448, "comment_id": 97466529, "body": "@Akib: You accepted a bad answer that does not discuss how the address of an object may be passed to other functions during its lifetime. <a href=\"https://stackoverflow.com/a/55371625/298225\">rici\u2019s answer</a> is better."}], "answers": [{"comments": [{"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 1, "creation_date": 1553670331, "post_id": 55370748, "comment_id": 97465411, "body": "It doesn&#39;t require multithreading; there is a much simpler case. You only need to pass the address of a local variable to a called function. It could be any function which takes a C-string (or an array for that matter). Or a function which returns extra values through call-by-reference."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1553670505, "post_id": 55370748, "comment_id": 97465472, "body": "@rici I would consider code being called from within scope to be within scope, at least for the idea of this quesiton. At least I think that the question is meant like that. Good input though. I will try to have my assumption clarified."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 3, "creation_date": 1553670705, "post_id": 55370748, "comment_id": 97465557, "body": "That is not what scope means. Scope is not the same as lifetime."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1553672784, "post_id": 55370748, "comment_id": 97466452, "body": "@rici Yes I know and it is exactly what I elaborate in this answer."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1553691144, "post_id": 55370748, "comment_id": 97477366, "body": "Re \u201cThe existence of auto variables is not only exist to &quot;within&quot; their scope\u201d: This is incorrect; the existence of objects with automatic storage duration is not limited to within their scope. Consider an object O, its identifier I, and code C in which I is not in scope. It is possible for O to exist and be accessed by C. This is demonstrated in <a href=\"https://stackoverflow.com/a/55371625/298225\">rici\u2019s answer</a>."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1553691186, "post_id": 55370748, "comment_id": 97477399, "body": "Re \u201cThis requires multithreading/multitasking/multiwhatevering\u201d: This is false, again as demonstrated in <a href=\"https://stackoverflow.com/a/55371625/298225\">rici\u2019s answer</a>, in which such an object is used without any multithreading/multitasking/multiwhatevering."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1553691261, "post_id": 55370748, "comment_id": 97477445, "body": "Re \u201cSo in certain environments it would be possible, but completley pointless (global variables are still involved), expensive, hard to understand and next to impossible to port\u201d: This is false, again as previously demonstrated. It is useful, inexpensive, easy to understand, and trivial to port. Furthermore, it is common; many C standard library routines have parameters that are pointers, and they may be passed pointers to objects with automatic storage duration."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1553729627, "post_id": 55370748, "comment_id": 97497881, "body": "@EricPostpischil Thanks for your input. I pointed out my assumption, which sadly was not confirmed or rejected by OP. Yes, you are right, without that assumption the statements are confusing to the point of incorrectness. I simply felt that the simple case is so simple that it cannot be at the core of OPs question."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1553729721, "post_id": 55370748, "comment_id": 97497906, "body": "@rici Thank you for your input, yes, describing the lifetime as &quot;during&quot; the scope, without mentioning the correct term reduced the clarity of my answer. Also see above comment on the simpler case of calling a function. I incorporated both into my answer."}], "tags": [], "owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "is_accepted": false, "score": 0, "last_activity_date": 1553729475, "last_edit_date": 1553729475, "creation_date": 1553666611, "answer_id": 55370748, "question_id": 55370448, "link": "https://stackoverflow.com/questions/55370448/how-we-can-access-auto-and-static-variables-outside-their-scope-in-c/55370748#55370748", "title": "How we can access auto and static variables outside their scope in C?", "body": "<p>Note, as comments rightly point out, I am making an assumption here, the assumption that the simplest case of calling another function is not what the question is about. This assumption was not (yet) confirmend or rejected by OP. This case is discussed e.g. in the answer by rici.</p>\n\n<p>The existence of auto variables is not only exist to \"within\" their scope (simplified: only code between the same enclosing <code>{}</code> can use their identifier), they are also restricted to \"during\" their \"chronological scope\" i.e. their lifetime (simplified after starting the execution of the code in the function and finishing its execution). It is possible to access the memory location of a variable via a pointer, which was set to their address (which is only possible within their scope, because accessing via their identifier is necessary) as long as it is done during their lifetime, yes.  </p>\n\n<p>But how would that pointer be found from anywhere else?<br>\nMaybe by being written (from inside their scope and during their lifetime) to a global variable.</p>\n\n<p>But which \"other\" code should then use that value? (remember I am putting the call of functions at the side here)<br>\nThis requires multithreading/multitasking/multiwhatevering. Lets say there is an interrupt service routine doing it. It would have to see the same address space as the variables scope, i.e. no memory management units getting in the way with some virtual memory magic. This is not true for many multiwhatevering implementations, but admittedly for a few of them, so lets continue.</p>\n\n<p>This imagined ISR would have to ensure that it only accesses the auto variable while it actually exists (i.e. during its lifetime), otherwise it would pretty much access what is effectively a meaningless random memory location. And this assumes that the ISR is actually allowed/able to access that memory. Even without MMUs, there are implementations which can/will have execeptions.<br>\nThis introduces the need for synchronisation mechanisms, e.g. semaphores.</p>\n\n<p>So in certain environments it would be possible, but completley pointless (global variables are still involved), expensive, hard to understand and next to impossible to port. (remember I am putting call of a function aside here)</p>\n\n<p>Similar for static variables.  </p>\n\n<p>In the case of function local static variables, they would at least reliably exist, but accessing them would still need the pointer value to be somehow transported out of their scope. For static variables that could actually be done via the return value of the function as demonstrated in the answer by yashC.</p>\n\n<p>In the case of \"static\" variables understood as file scope restricted variables, the pointer still would have to be transported out of the file scope.<br>\nThis would merely defeat what is probably the point of a file scope restricted variable. But I could imagine some kind of access privilege scheme, as in \"Here is the key to the vault. Handle with care.\"</p>\n\n<p>As mentioned at the start of this answer, I am putting the call of other functions aside. Yes, the easiest way to leave the scope of a function is to call another one. If that other function has a pointer parameter, it can use it to read-access and write-access the auto variable of the calling function. That is the normal case of call-by-reference parameters as supported by C.<br>\nCalling a function also provides another, even simpler way of read-accessing the value of an auto variable of the calling function, though not write-accessing and not actually accessing the autovariable itself, only using its value. That way is the trivial mechanism of a call-by-value parameter, it does not even require a pointer. Both ways (call-by-reference parameter and call-by-value parameter) conveniently guarantee that the value does not change during the execution of the called function. (this time I am putting the multi-threaded case aside, because that is discussed in the main part of this answer).</p>\n"}, {"comments": [{"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 2, "creation_date": 1553668091, "post_id": 55370842, "comment_id": 97464530, "body": "About the segfault thing: you wish! On pretty much any implementation the memory for the stack is actually always allocated as a single big chunk (barring automatic expansion through guard pages), and stack allocation/deallocation is just moving the top-of-the-stack pointer. For this reason, even if you read/write above the currently top of the stack, no access violation is triggered - you&#39;ve simply written in a <i>logically</i> non allocated, but &quot;physically&quot; valid location, so either you are overwriting some unrelated local variable, or you are just writing on unused data."}, {"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 2, "creation_date": 1553668260, "post_id": 55370842, "comment_id": 97464586, "body": "Then again, if your implementation writes canary values on unused portions of the stack or is performing extra checks at each memory access (think AddressSanitizer builds) it may detect the problem; but in an optimized build, generally use-outside-of-scope is either silent or results in silent corruption."}, {"owner": {"reputation": 583, "user_id": 4912037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc8ad5a96e60d4a5086e0c5b3cfb19ce?s=128&d=identicon&r=PG&f=1", "display_name": "yashC", "link": "https://stackoverflow.com/users/4912037/yashc"}, "reply_to_user": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 0, "creation_date": 1553668629, "post_id": 55370842, "comment_id": 97464722, "body": "@MatteoItalia Yes you are right in pointing out that memory does exist just it is logically out of scope of access. but for the sake of simplicity here we can call it a non-existent memory location ?"}, {"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 0, "creation_date": 1553670129, "post_id": 55370842, "comment_id": 97465336, "body": "My point was not much of terms, but of factual inaccuracy. You talk about getting a segmentation fault when writing to a pointer that referred to a now logically unallocated stack location; that&#39;s not what generally happens, because segfaults are a product of hardware based memory protection, while here as far as the hardware is concerned the pointer still points to valid memory."}, {"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 0, "creation_date": 1553670253, "post_id": 55370842, "comment_id": 97465383, "body": "That being said, I wouldn&#39;t talk about non-existent memory locations, but just about deallocated memory, which is an entirely logical construct, that does not imply anything particular about the actual state of such memory."}, {"owner": {"reputation": 583, "user_id": 4912037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc8ad5a96e60d4a5086e0c5b3cfb19ce?s=128&d=identicon&r=PG&f=1", "display_name": "yashC", "link": "https://stackoverflow.com/users/4912037/yashc"}, "reply_to_user": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 0, "creation_date": 1553670463, "post_id": 55370842, "comment_id": 97465456, "body": "@MatteoItalia well, when I ran the program, I did get a seg fault. This is the output  <code>a in func = 1 Segmentation fault (core dumped)</code>"}, {"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 3, "creation_date": 1553670887, "post_id": 55370842, "comment_id": 97465625, "body": "If you run it under gdb you&#39;ll see it&#39;s dereferencing a NULL pointer. That&#39;s just a favor gcc does to you - it detects the problem <i>at compile time</i> (indeed, it prints a warning about it), and essentially transforms it to a <code>return NULL</code> to aid debugging (it&#39;s allowed to change whatever because you are dereferencing an invalid pointer, which is undefined behavior, so anything is allowed). Try to pass the address of the local out of the function through more convoluted means (e.g. a global <code>volatile</code> value) and you&#39;ll see that it all appears to work flawlessly."}, {"owner": {"reputation": 583, "user_id": 4912037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc8ad5a96e60d4a5086e0c5b3cfb19ce?s=128&d=identicon&r=PG&f=1", "display_name": "yashC", "link": "https://stackoverflow.com/users/4912037/yashc"}, "reply_to_user": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 1, "creation_date": 1553671125, "post_id": 55370842, "comment_id": 97465726, "body": "@MatteoItalia +1 TIL"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1553675142, "post_id": 55370842, "comment_id": 97467593, "body": "The question does not ask about accessing an object after its lifetime ends. It asks about accessing an object from code in which the object\u2019s identifier is not in scope. This is proper and happens commonly, whenever an object\u2019s address is passed to another routine."}, {"owner": {"reputation": 583, "user_id": 4912037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc8ad5a96e60d4a5086e0c5b3cfb19ce?s=128&d=identicon&r=PG&f=1", "display_name": "yashC", "link": "https://stackoverflow.com/users/4912037/yashc"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1553675922, "post_id": 55370842, "comment_id": 97467955, "body": "@EricPostpischil Example program address the method of accessing variables out of the scope. As lifetime and scope are mentioned in the question along with how to access them, wont it be better to bring some clarity on that point also ?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1553683719, "post_id": 55370842, "comment_id": 97472681, "body": "@yashC: The question does not ask about accessing an object after its lifetime ends. In this answer, it is shown that an object with automatic storage duration should not be accessed, as by the example program, after its lifetime. <b>But that is not what the question asks about.</b> Instead of showing an example about a situation that was not asked about for a behavior that one cannot properly use, the answer should show an example that was asked about that one can properly use. The fact is that it is perfectly proper to access an automatically allocated object by address during its lifetime\u2026"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1553683763, "post_id": 55370842, "comment_id": 97472706, "body": "\u2026 and so the answer ought to show that. The example program ought to be one that takes the address of an object with automatic storage duration and passes that address to a subroutine, which accesses that object during its lifetime but while its identifier is not in scope. As written, this answer portrays an inability to access an automatically allocated object through a pointer, but that is because it set up the example for failure by trying after the lifetime ended <b>which is not what the question asked.</b> It ought to set up a situation which works <b>that is what the question asked.</b>"}], "tags": [], "owner": {"reputation": 583, "user_id": 4912037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc8ad5a96e60d4a5086e0c5b3cfb19ce?s=128&d=identicon&r=PG&f=1", "display_name": "yashC", "link": "https://stackoverflow.com/users/4912037/yashc"}, "is_accepted": true, "score": 2, "last_activity_date": 1553667096, "creation_date": 1553667096, "answer_id": 55370842, "question_id": 55370448, "link": "https://stackoverflow.com/questions/55370448/how-we-can-access-auto-and-static-variables-outside-their-scope-in-c/55370842#55370842", "title": "How we can access auto and static variables outside their scope in C?", "body": "<p>As you said, static variables exist through out the life cycle of the program i.e memory allocated to them is not destroyed as long as the program is running. So, to access such a variable out side its scope, we can pass around the pointer to that memory location via pointer. A small example to show the same</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint* func()\n{\n        static int a = 0;\n        a++;\n        printf(\"a in func = %d\\n\", a);\n        return &amp;a;\n}\n\nint main()\n{\n        int *p;\n        p = func();\n        printf(\"a in main from ptr : %d\\n\", *p);\n        *p++;\n        p = func();\n        return 0;\n}\n</code></pre>\n\n<p>As you can see in the example, <code>func()</code> returns the pointer to the static variable it  has declared, and any one who wishes to access the variable <code>a</code>, can use that pointer. NOTE: we can only do this because static variable's life is through out the program. Now irrespective of  the static variable being in a different function or a different file, as long as you can some how get hold of the pointer to that static variable, you can use it.</p>\n\n<p>Now coming to the case of auto variable.</p>\n\n<p>What happens if you run the above program changing <code>a</code> from <code>static</code> to <code>auto</code>?\nyou will see that while compiling a warning <code>warning: function returns address of local variable [-Wreturn-local-addr]</code> is  thrown and when executing, we get a <code>segmentation fault</code>.\nWhat causes this is that the auto variable exists only in its scope, i.e as long as the function <code>func()</code> is being executed, the variable <code>a</code> has memory allocated for itself. As soon as the function exits, the memory allocated for variable <code>a</code> is freed and so the value pointed to by pointer <code>p</code> is at some unallocated memory location (resulting in segmentation fault).</p>\n"}, {"tags": [], "owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "is_accepted": false, "score": 3, "last_activity_date": 1553671094, "last_edit_date": 1553671094, "creation_date": 1553670658, "answer_id": 55371625, "question_id": 55370448, "link": "https://stackoverflow.com/questions/55370448/how-we-can-access-auto-and-static-variables-outside-their-scope-in-c/55371625#55371625", "title": "How we can access auto and static variables outside their scope in C?", "body": "<p>Here's a very simple example:</p>\n\n<pre><code>void print_msg(const char* msg) {\n  printf(\"The message is: %s\\n\", msg);\n}\n\nint main(void) {\n  char m[] = \"Hello, world!\";\n  print_msg(m);\n}\n</code></pre>\n\n<p>Here, <code>m</code> is an automatic variable, which is not in scope in <code>print_msg</code>. But <code>print_msg</code> clearly has access to its value.</p>\n\n<p>Don't confuse \"scope\" with \"lifetime\". The scope of a variable is that part of the program where the variable's name is visible (and thus can be used). The lifetime of a value is the period during program execution in which a value exists. Scope is about program text; it relates to compilation. Lifetime is about program execution.</p>\n"}], "owner": {"reputation": 51, "user_id": 9118122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/315f22a3bd146ef65b6311e4a9461956?s=128&d=identicon&r=PG&f=1", "display_name": "Akib", "link": "https://stackoverflow.com/users/9118122/akib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 787, "favorite_count": 0, "accepted_answer_id": 55370842, "answer_count": 3, "score": 1, "last_activity_date": 1553729475, "creation_date": 1553665053, "question_id": 55370448, "link": "https://stackoverflow.com/questions/55370448/how-we-can-access-auto-and-static-variables-outside-their-scope-in-c", "title": "How we can access auto and static variables outside their scope in C?", "body": "<p>Auto and static variable have scope limited to the block in which they are defined. Since Auto variables are defined in the stack, if the function exits, stack is destroyed and memory for the auto variable is released. But I read somewhere \"However, they can be accessed outside their scope as well using the concept of pointers given here by pointing to the very exact memory location where the variables reside.\" Is this correct?</p>\n\n<p>Also, static variables are defined in the data section so it retains its existence till end of program. The scope is within the block in which it is defined. Is there any way through which we can access static variable from any other function? Also, Is there any way we can access static variable from any other file?</p>\n"}, {"tags": ["c", "memory"], "comments": [{"owner": {"reputation": 251699, "user_id": 895245, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/jhDFt.png?s=128&g=1", "display_name": "Ciro Santilli\u65b0\u7586\u68c9\u82b1TRUMP BAN BAD", "link": "https://stackoverflow.com/users/895245/ciro-santilli%e6%96%b0%e7%96%86%e6%a3%89%e8%8a%b1trump-ban-bad"}, "edited": false, "score": 1, "creation_date": 1553770347, "post_id": 55370165, "comment_id": 97511745, "body": "Try <a href=\"https://unix.stackexchange.com/a/462710/32558\"><code>ltrace</code></a>, read glibc source, read GCC source, step debug the assembly, and pray that it does not go too deep :-)"}, {"owner": {"reputation": 1778, "user_id": 5698740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faee64fe3fa6b806a89f84492ba6c431?s=128&d=identicon&r=PG&f=1", "display_name": "clmno", "link": "https://stackoverflow.com/users/5698740/clmno"}, "reply_to_user": {"reputation": 251699, "user_id": 895245, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/jhDFt.png?s=128&g=1", "display_name": "Ciro Santilli\u65b0\u7586\u68c9\u82b1TRUMP BAN BAD", "link": "https://stackoverflow.com/users/895245/ciro-santilli%e6%96%b0%e7%96%86%e6%a3%89%e8%8a%b1trump-ban-bad"}, "edited": false, "score": 1, "creation_date": 1553773549, "post_id": 55370165, "comment_id": 97513796, "body": "@CiroSantilli\u65b0\u7586\u6539\u9020\u4e2d\u5fc3\u516d\u56db\u4e8b\u4ef6\u6cd5\u8f6e\u529f This was for an embedded application (and.. that&#39;s why I was too concerned about the memory), but will try out <code>ltrace</code> for sure."}], "answers": [{"comments": [{"owner": {"reputation": 1778, "user_id": 5698740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faee64fe3fa6b806a89f84492ba6c431?s=128&d=identicon&r=PG&f=1", "display_name": "clmno", "link": "https://stackoverflow.com/users/5698740/clmno"}, "edited": false, "score": 1, "creation_date": 1553664037, "post_id": 55370178, "comment_id": 97463234, "body": "Thank you. Found <a href=\"https://stackoverflow.com/questions/13339582/why-is-linux-memmove-implemented-the-way-it-is\">this</a> other question which points to a few implementations. Also, cheers on Ripple!"}], "tags": [], "owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "is_accepted": true, "score": 6, "last_activity_date": 1553663382, "creation_date": 1553663382, "answer_id": 55370178, "question_id": 55370165, "link": "https://stackoverflow.com/questions/55370165/does-memmove-use-dynamic-memory-for-its-temporary-array/55370178#55370178", "title": "Does memmove use dynamic memory for its temporary array", "body": "<p>I think you missed the \"as if\" in that sentence. That means the effects will be the same as if it did that, not that it will actually do that. I've never seen an implementation of <code>memmove</code> that actually uses a temporary array.</p>\n"}, {"tags": [], "owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "is_accepted": false, "score": 1, "last_activity_date": 1553670829, "last_edit_date": 1553670829, "creation_date": 1553670366, "answer_id": 55371553, "question_id": 55370165, "link": "https://stackoverflow.com/questions/55370165/does-memmove-use-dynamic-memory-for-its-temporary-array/55371553#55371553", "title": "Does memmove use dynamic memory for its temporary array", "body": "<p>The <code>memmove</code> is not a single implementation in modern compilers; it is considered an intrinsic instead. It is easiest to show with an example how the <em>\"as if\"</em> works:</p>\n\n<pre><code>#include &lt;string.h&gt;\n\nvoid test_memmove(void * restrict dst, const void * restrict src, size_t n) {\n    memmove(dst, src, n);\n}\n</code></pre>\n\n<p>the <code>restrict</code> in parameters tell that the memory accessed through the pointers do not overlap. So GCC <a href=\"https://godbolt.org/z/qzfX67\" rel=\"nofollow noreferrer\">knows to compile this to</a></p>\n\n<pre><code>test_memmove:\n        jmp     memcpy\n</code></pre>\n\n<p>Because the compiler was able to take the <code>restrict</code> into account and \"prove\" that the memory areas pointed to by these 2 do not overlap, the call to <code>memmove</code> was immediately changed to a (tail) call to <code>memcpy</code>!</p>\n"}], "owner": {"reputation": 1778, "user_id": 5698740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faee64fe3fa6b806a89f84492ba6c431?s=128&d=identicon&r=PG&f=1", "display_name": "clmno", "link": "https://stackoverflow.com/users/5698740/clmno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "accepted_answer_id": 55370178, "answer_count": 2, "score": 2, "last_activity_date": 1553670829, "creation_date": 1553663285, "last_edit_date": 1553670453, "question_id": 55370165, "link": "https://stackoverflow.com/questions/55370165/does-memmove-use-dynamic-memory-for-its-temporary-array", "title": "Does memmove use dynamic memory for its temporary array", "body": "<p>According to <a href=\"http://www.open-std.org/JTC1/SC22/WG14/www/docs/n1570.pdf\" rel=\"nofollow noreferrer\">C11 N1570 standard draft</a>:</p>\n\n<p>7.24.2.2 \"The <code>memmove</code> function\":</p>\n\n<blockquote>\n  <p>The <code>memmove</code> function copies <code>n</code> characters from the object pointed to by <code>s2</code> into the object pointed to by <code>s1</code>. <strong>Copying takes place as if the <code>n</code> characters from the object pointed to by <code>s2</code> are first copied into a temporary array of <code>n</code> characters</strong> that does not overlap the objects pointed to by <code>s1</code> and <code>s2</code>, and then the <code>n</code> characters from the temporary array are copied into the object pointed to by <code>s1</code> </p>\n</blockquote>\n\n<p>So if I choose to move a buffer of size 32K using (file_size = 32K)</p>\n\n<pre><code>memmove(io_Buffer, io_Buffer+17, file_size);\n</code></pre>\n\n<p>won't the temp buffer be of size 32K? </p>\n\n<p><strong>Question</strong></p>\n\n<p>Can the program allocate dynamic memory on its own? Does it allocate and free the memory in that one line?</p>\n"}, {"tags": ["c++", "c", "winapi", "libcurl"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1553664494, "post_id": 55370084, "comment_id": 97463357, "body": "Welcome to SO. Your question should provide an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. Without one, it is incomplete, and will eventually get closed. Please <a href=\"https://stackoverflow.com/posts/55370084/edit\">edit</a> your question to improve it"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1553664639, "post_id": 55370084, "comment_id": 97463394, "body": "Read also <a href=\"https://ericlippert.com/2014/03/05/how-to-debug-small-programs/\" rel=\"nofollow noreferrer\"><i>How to debug small programs</i></a> and read much more about the <a href=\"https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol\" rel=\"nofollow noreferrer\">HTTP</a> protocol. You may want to recompile <code>libcurl</code> with debugging options (e.g. with <code>gcc -g</code>)"}, {"owner": {"reputation": 729, "user_id": 11060870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a74dd465c0373f529ebe6f9ee7592add?s=128&d=identicon&r=PG", "display_name": "ccxxshow", "link": "https://stackoverflow.com/users/11060870/ccxxshow"}, "edited": false, "score": 1, "creation_date": 1553669345, "post_id": 55370084, "comment_id": 97465028, "body": "please print pError to look what is the reason, it is your set timeout 3s expired? curl_easy_setopt(curl,CURLOPT_TIMEOUT,3L); Is it normal after removal?"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 8652950, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qwgmo.png?s=128&g=1", "display_name": "T.Woung", "link": "https://stackoverflow.com/users/8652950/t-woung"}, "edited": false, "score": 0, "creation_date": 1553754135, "post_id": 55372852, "comment_id": 97503474, "body": "Thanks Rita Han and @ccxxshowand for answering, I detected too the timeout &quot;3s&quot; is set too soon to download a normal-large size file. And that&#39;s the main problem to prevent the program from working well."}, {"owner": {"reputation": 8787, "user_id": 6601582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd0a2f69702729da5aaa628bc58811a7?s=128&d=identicon&r=PG&f=1", "display_name": "Rita Han", "link": "https://stackoverflow.com/users/6601582/rita-han"}, "reply_to_user": {"reputation": 3, "user_id": 8652950, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qwgmo.png?s=128&g=1", "display_name": "T.Woung", "link": "https://stackoverflow.com/users/8652950/t-woung"}, "edited": false, "score": 0, "creation_date": 1553755856, "post_id": 55372852, "comment_id": 97504111, "body": "@S.Woung If the answer help you solved the issue you can <a href=\"https://stackoverflow.com/help/someone-answers\">accept it</a>. It will help more people searching on this topic."}, {"owner": {"reputation": 3, "user_id": 8652950, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qwgmo.png?s=128&g=1", "display_name": "T.Woung", "link": "https://stackoverflow.com/users/8652950/t-woung"}, "edited": false, "score": 0, "creation_date": 1553756148, "post_id": 55372852, "comment_id": 97504216, "body": "Sure. Sweet guide."}], "tags": [], "owner": {"reputation": 8787, "user_id": 6601582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd0a2f69702729da5aaa628bc58811a7?s=128&d=identicon&r=PG&f=1", "display_name": "Rita Han", "link": "https://stackoverflow.com/users/6601582/rita-han"}, "is_accepted": true, "score": 1, "last_activity_date": 1553675879, "creation_date": 1553675879, "answer_id": 55372852, "question_id": 55370084, "link": "https://stackoverflow.com/questions/55370084/download-function-with-libcurl-but-it-works-incomplete/55372852#55372852", "title": "download function with libcurl, but it works incomplete", "body": "<p>@ccxxshow seems right. Set the timeout option gives me CURLE_OPERATION_TIMEDOUT error.</p>\n\n<p>After remove this line I can download about 9MB PDF file successfully.</p>\n\n<pre><code>curl_easy_setopt(curl, CURLOPT_TIMEOUT, 3L);\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/0z43E.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0z43E.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/S4W8L.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/S4W8L.png\" alt=\"enter image description here\"></a></p>\n\n<p>My complete code:</p>\n\n<pre><code>#include &lt;curl/curl.h&gt;\n\nstatic FILE * fp;\n\nstatic size_t write_callback(char *ptr, size_t size, size_t nmemb, void *userdata)\n\n{\n\n    size_t nWrite = fwrite(ptr, size, nmemb, fp);\n\n    return nWrite;\n\n}\n\nstatic int progress_callback(void *clientp, curl_off_t dltotal, curl_off_t dlnow, curl_off_t ultotal, curl_off_t ulnow)\n\n{\n\n    (void)ultotal;\n    (void)ulnow;\n    int totaldotz = 40;\n\n    double fractiondownloaded = (double)dlnow / (double)dltotal;\n    int dotz = (int)(fractiondownloaded * totaldotz);\n\n    printf(\"%3.0f%% [\", fractiondownloaded * 100);   //print the number percentage of the progress\n\n    int i = 0;\n    for (; i &lt; dotz; i++) {     //print \"=\" to show progress\n        printf(\"=\");\n    }\n\n    for (; i &lt; totaldotz; i++) {      //print space to occupy the rest\n        printf(\" \");\n    }\n    printf(\"]\\r\");\n    fflush(stdout);\n\n    return 0;\n}\n\nint download_function(CURL *curl, const char * url, const char * path)\n{\n\n    curl = curl_easy_init();\n    curl_easy_setopt(curl, CURLOPT_URL, url);\n    curl_easy_setopt(curl, CURLOPT_XFERINFOFUNCTION, progress_callback);\n    curl_easy_setopt(curl, CURLOPT_NOPROGRESS, 0L);\n    fopen_s(&amp;fp, path, \"ab+\");\n    curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_callback);\n    curl_easy_setopt(curl, CURLOPT_MAXREDIRS, 5L);\n    curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1L);\n    curl_easy_setopt(curl, CURLOPT_SSL_VERIFYPEER, false);\n    curl_easy_setopt(curl, CURLOPT_SSL_VERIFYHOST, false);\n    curl_easy_setopt(curl, CURLOPT_CONNECTTIMEOUT, 3L);\n    //curl_easy_setopt(curl, CURLOPT_TIMEOUT, 3L);\n    char * error = NULL;\n    curl_easy_setopt(curl, CURLOPT_ERRORBUFFER, error);\n    CURLcode retcCode = curl_easy_perform(curl);\n    fclose(fp);\n    const char* pError = curl_easy_strerror(retcCode);\n    if (curl) {\n        curl_easy_cleanup(curl);\n    }\n    return 0;\n\n}\n\nint main()\n{\n    CURL *testCurl = NULL;\n    const char *fileAddr = \"https://gotocon.com/dl/goto-cph-2015/slides/AndersLybecker_and_SebastianBrandes_DevelopingIoTSolutionsWithWindows10AndAzure.pdf\";\n    download_function(testCurl, fileAddr, \"my-9MB.pdf\");\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 8652950, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qwgmo.png?s=128&g=1", "display_name": "T.Woung", "link": "https://stackoverflow.com/users/8652950/t-woung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 0, "closed_date": 1553699263, "accepted_answer_id": 55372852, "answer_count": 1, "score": 0, "last_activity_date": 1553756327, "creation_date": 1553662758, "last_edit_date": 1553756327, "question_id": 55370084, "link": "https://stackoverflow.com/questions/55370084/download-function-with-libcurl-but-it-works-incomplete", "closed_reason": "Not suitable for this site", "title": "download function with libcurl, but it works incomplete", "body": "<p>Greetings everyone read this topic, my platform is win32. And I'm using libcurl with a problem.</p>\n\n<p>My goal is to coding with libcurl for a download program, which it includes requesting a url to download a file, saving the file locally(fwrite), showing the progress bar while downloading. </p>\n\n<p>The Problem is it can download the very small file well but when requesting a larger file like 30MB, it stops before it's done.</p>\n\n<p>How can I debug this program to work well with any size of files?</p>\n\n<p>I'm not familiar with libcurl, any simple detail could help. Can I have either answer of how curl_easy series works to call multiple callback functions, improper coding of either of the two callback functions, or some missing rules from libcurl?\nFeel free to answer me anything. </p>\n\n<p>Things I've tried:</p>\n\n<p>1.I've tried re-compiling versions of libcurl. Now I'm using libcurl-7.64 compiled with \"WITH_SSL=static\".</p>\n\n<p>2.I've tried many sites, finding the clue: the sites for very small(like 80kb) file will be downloaded completely with the progress bar. But larger file(like 30Mb) will be incomplete. One of my guess is it stopped from some transfer problem since the file is larger.</p>\n\n<p>codes:</p>\n\n<pre><code>static FILE * fp;\n\nstatic size_t write_callback(char *ptr, size_t size, size_t nmemb, void *userdata)\n\n{\n\n    size_t nWrite = fwrite(ptr, size, nmemb, fp);\n\n    return nWrite;\n\n}\n\nstatic int progress_callback(void *clientp, curl_off_t dltotal, curl_off_t dlnow, curl_off_t ultotal, curl_off_t ulnow) \n\n{\n\n    (void)ultotal;\n    (void)ulnow;\n    int totaldotz = 40;\n\n    double fractiondownloaded = (double)dlnow / (double)dltotal;\n    int dotz = (int)(fractiondownloaded * totaldotz);\n\n    printf(\"%3.0f%% [\", fractiondownloaded * 100);   //print the number percentage of the progress\n\n    int i = 0;\n    for (; i &lt; dotz; i++) {     //print \"=\" to show progress\n        printf(\"=\");\n    }\n\n    for (; i &lt; totaldotz; i++) {      //print space to occupy the rest\n        printf(\" \");\n    }\n    printf(\"]\\r\");\n    fflush(stdout);\n\n    return 0;\n}\n\nint download_function(CURL *curl,const char * url, const char * path)\n\n{\n\n    curl = curl_easy_init();\n    curl_easy_setopt(curl, CURLOPT_URL, url);\n    curl_easy_setopt(curl, CURLOPT_XFERINFOFUNCTION, progress_callback);\n    curl_easy_setopt(curl, CURLOPT_NOPROGRESS, 0L);\n    fopen_s(&amp;fp, path, \"ab+\");\n    curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_callback);\n    curl_easy_setopt(curl, CURLOPT_MAXREDIRS, 5L);\n    curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1L);\n    curl_easy_setopt(curl, CURLOPT_SSL_VERIFYPEER, false);\n    curl_easy_setopt(curl, CURLOPT_SSL_VERIFYHOST, false);\n    curl_easy_setopt(curl, CURLOPT_CONNECTTIMEOUT, 3L);\n    curl_easy_setopt(curl, CURLOPT_TIMEOUT, 3L);\n    char * error = NULL;\n    curl_easy_setopt(curl, CURLOPT_ERRORBUFFER, error);\n    CURLcode retcCode = curl_easy_perform(curl);\n    fclose(fp);\n    const char* pError = curl_easy_strerror(retcCode);\n    if (curl) {\n        curl_easy_cleanup(curl);\n    }\n    return 0;\n\n}\n</code></pre>\n"}, {"tags": ["c++", "c", "encryption", "openssl", "aes"], "answers": [{"comments": [{"owner": {"reputation": 270, "user_id": 8938788, "user_type": "registered", "profile_image": "https://graph.facebook.com/2410929455797966/picture?type=large", "display_name": "Dhanasekaran Don", "link": "https://stackoverflow.com/users/8938788/dhanasekaran-don"}, "edited": false, "score": 0, "creation_date": 1553658713, "post_id": 55369470, "comment_id": 97462019, "body": "then how can i assign string in unsigned char??"}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "reply_to_user": {"reputation": 270, "user_id": 8938788, "user_type": "registered", "profile_image": "https://graph.facebook.com/2410929455797966/picture?type=large", "display_name": "Dhanasekaran Don", "link": "https://stackoverflow.com/users/8938788/dhanasekaran-don"}, "edited": false, "score": 0, "creation_date": 1553658963, "post_id": 55369470, "comment_id": 97462072, "body": "You have the key in hexadecimal as an ASCII string. The <code>AES_set_encrypt</code> function wants the raw binary key in a 128-bit buffer. Look more closely at the documentation for <code>AES_set_encrypt</code>."}], "tags": [], "owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "is_accepted": false, "score": 0, "last_activity_date": 1553658318, "creation_date": 1553658318, "answer_id": 55369470, "question_id": 55369400, "link": "https://stackoverflow.com/questions/55369400/aes-cbc-128-bit-encryption-openssl/55369470#55369470", "title": "AES CBC 128 bit encryption -OpenSSL", "body": "<pre><code>string in = \"abcdefgh\";\nunsigned char input[in.length()];\nstrcpy((char*) input, in.c_str());\n</code></pre>\n\n<p>The <code>strcpy</code> function is for C-style strings. That means you need to make <code>input</code> large eonugh to hold <code>\"abcefgh\"</code> as a C-style string. However, you made it one byte too small because a C-style string has a nul terminator at the end.</p>\n\n<pre><code>string key =\"123456781234456678\";\nunsigned char key_aes[key.length()];\nstrcpy((char*) key_aes, key.c_str());\n</code></pre>\n\n<p>Same thing again. Why are you constructing C++ string's from C-style strings only to convert them back to C-style strings?!</p>\n\n<p>Then, you pass the C-style string to <code>AES_set_encrypt</code>. But the <code>AES_set_encrypt</code> function doesn't take a C-style string as input. So why are you creating these C-style strings?</p>\n"}], "owner": {"reputation": 270, "user_id": 8938788, "user_type": "registered", "profile_image": "https://graph.facebook.com/2410929455797966/picture?type=large", "display_name": "Dhanasekaran Don", "link": "https://stackoverflow.com/users/8938788/dhanasekaran-don"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 173, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1553658318, "creation_date": 1553657737, "question_id": 55369400, "link": "https://stackoverflow.com/questions/55369400/aes-cbc-128-bit-encryption-openssl", "title": "AES CBC 128 bit encryption -OpenSSL", "body": "<p>I am need to encrypt a string in AES CBC 128 bit mode through code only.I am done this with openssl library but i could not get correct output.</p>\n\n<p>So far i have completed.</p>\n\n<pre><code>#include &lt;cstring&gt;\n#include &lt;iostream&gt;\n#include &lt;openssl/evp.h&gt;\n#include &lt;openssl/aes.h&gt;\n\nusing namespace std;\n\nint main(){\n    string in = \"abcdefgh\";\n    unsigned char input[in.length()];\n    strcpy((char*) input, in.c_str());\n    string key =\"123456781234456678\";\n    unsigned char key_aes[key.length()];\n    strcpy((char*) key_aes, key.c_str());\n    cout&lt;&lt;input&lt;&lt;endl;\n    cout&lt;&lt;key_aes&lt;&lt;endl;\n    unsigned char iv[key.length()];\n    strcpy((char*) iv, key.c_str());\n    cout&lt;&lt;iv&lt;&lt;endl;\n    const size_t encslength = ((in.length()/AES_BLOCK_SIZE)) * AES_BLOCK_SIZE;\n    unsigned char out[encslength];\n    memset(out, 0, sizeof(out));\n    AES_KEY enc_key;\n    AES_set_encrypt_key(key_aes,128, &amp;enc_key);\n    AES_cbc_encrypt(input,out,in.length(),&amp;enc_key,iv,1);\n\n    for(int i=0;out[i]!='\\0';i++){\n\n    printf(\"%X \",out[i]);\n\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>And my hex output is : <code>B0 15 75 1B 50 80 D4 FF 81 68 14 6B B7 1B 95 99 37 38</code></p>\n\n<p>But the correct output is : <code>73 5C 04 F9 57 18 43 7C EE 68 27 59 2B 41 A8 DA</code> \n( verified with online <a href=\"https://www.devglan.com/online-tools/aes-encryption-decryption\" rel=\"nofollow noreferrer\">site</a> and through c# code).</p>\n\n<p>Help me..\nThis question is already answered <a href=\"https://stackoverflow.com/questions/18152913/aes-aes-cbc-128-aes-cbc-192-aes-cbc-256-encryption-decryption-with-openssl-c\">here</a> but it is also not work for me.\nThanks in advances.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 1990, "user_id": 5775341, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/67f9c208584c05ef9918d544e0d4b95f?s=128&d=identicon&r=PG&f=1", "display_name": "quicklikerabbit", "link": "https://stackoverflow.com/users/5775341/quicklikerabbit"}, "edited": false, "score": 0, "creation_date": 1553655783, "post_id": 55369099, "comment_id": 97461438, "body": "What&#39;s your question?"}, {"owner": {"reputation": 1, "user_id": 11263714, "user_type": "registered", "profile_image": "https://graph.facebook.com/1978699005759899/picture?type=large", "display_name": "Sri Ram", "link": "https://stackoverflow.com/users/11263714/sri-ram"}, "reply_to_user": {"reputation": 1990, "user_id": 5775341, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/67f9c208584c05ef9918d544e0d4b95f?s=128&d=identicon&r=PG&f=1", "display_name": "quicklikerabbit", "link": "https://stackoverflow.com/users/5775341/quicklikerabbit"}, "edited": false, "score": 0, "creation_date": 1553655835, "post_id": 55369099, "comment_id": 97461450, "body": "I am not able to find error in my code can you help me out"}, {"owner": {"reputation": 1074, "user_id": 7381492, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t3vPN.png?s=128&g=1", "display_name": "Mike Wodarczyk", "link": "https://stackoverflow.com/users/7381492/mike-wodarczyk"}, "edited": false, "score": 1, "creation_date": 1553656754, "post_id": 55369099, "comment_id": 97461656, "body": "The number zero and \\0 are the same thing and will stop your recursion.  You want to check if X==b and return 0."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1553657404, "post_id": 55369099, "comment_id": 97461779, "body": "What is the true input?"}, {"owner": {"reputation": 164, "user_id": 3293508, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61178dde90b08af3b22073884f54db84?s=128&d=identicon&r=PG", "display_name": "Nguyen Cong", "link": "https://stackoverflow.com/users/3293508/nguyen-cong"}, "edited": false, "score": 0, "creation_date": 1553657482, "post_id": 55369099, "comment_id": 97461794, "body": "I ran your code with b is 10, and the array is from 1 to 10. I get 55 in the output instead of 102 as you said. Is there any mistake here?"}, {"owner": {"reputation": 145, "user_id": 8272292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X9JD4.png?s=128&g=1", "display_name": "virmis_007", "link": "https://stackoverflow.com/users/8272292/virmis-007"}, "reply_to_user": {"reputation": 164, "user_id": 3293508, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61178dde90b08af3b22073884f54db84?s=128&d=identicon&r=PG", "display_name": "Nguyen Cong", "link": "https://stackoverflow.com/users/3293508/nguyen-cong"}, "edited": false, "score": 0, "creation_date": 1553659072, "post_id": 55369099, "comment_id": 97462089, "body": "@NguyenCong are you sure of that because that&#39;s not the case at <a href=\"https://ideone.com/0082hI\" rel=\"nofollow noreferrer\">my end</a>."}, {"owner": {"reputation": 2955, "user_id": 3819007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6hvpZ.png?s=128&g=1", "display_name": "visibleman", "link": "https://stackoverflow.com/users/3819007/visibleman"}, "edited": false, "score": 2, "creation_date": 1553660231, "post_id": 55369099, "comment_id": 97462306, "body": "Not related to your problem, but just noting that max is a really poor choice of name for that function. Good and descriptive names will help you and others read and reason about your code as your codebase grows more complex."}], "answers": [{"tags": [], "owner": {"reputation": 45, "user_id": 11256427, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nmXay-bdhPk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcjeUIPzAO9kcdr6iwoOfhSVx4W8Q/mo/photo.jpg?sz=128", "display_name": "vinodkumar wagh", "link": "https://stackoverflow.com/users/11256427/vinodkumar-wagh"}, "is_accepted": false, "score": 0, "last_activity_date": 1553658277, "creation_date": 1553658277, "answer_id": 55369463, "question_id": 55369099, "link": "https://stackoverflow.com/questions/55369099/finding-sum-of-array-elements-using-recursion/55369463#55369463", "title": "finding sum of array elements using recursion", "body": "<p>You can try this implementation  </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint sumation(int array[],int i) {\nstatic int k = 0;\nif(k == 10) {\n    return 0;\n}\n\nelse {\n    ++k;\n    return array[i] + sumation(array, i+1);\n}\n}\nint main() {\n\nint array[10], size, sum;\nscanf(\"%d\",&amp;size);\nfor(int i = 0; i&lt;size; i++) {\n    array[i] = i+1;\n}\n\nsum = sumation(array, 0);\nprintf(\"Sum:: %d \", sum);\nreturn 0;\n}\n</code></pre>\n\n<p>You can change the value of k eighter by giving the value of size variable to it, or just directly giving the value of the size constant in a base recursive case if block.</p>\n"}, {"tags": [], "owner": {"reputation": 145, "user_id": 8272292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X9JD4.png?s=128&g=1", "display_name": "virmis_007", "link": "https://stackoverflow.com/users/8272292/virmis-007"}, "is_accepted": false, "score": 1, "last_activity_date": 1553659504, "last_edit_date": 1553659504, "creation_date": 1553658716, "answer_id": 55369526, "question_id": 55369099, "link": "https://stackoverflow.com/questions/55369099/finding-sum-of-array-elements-using-recursion/55369526#55369526", "title": "finding sum of array elements using recursion", "body": "<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n/* run this program using the console pauser or add your own getch, \n  system(\"pause\") or input loop */\nint max(int a[],int b,int x)\n{\n    if(x &gt;= b)\n        return 0;\n    else {\n        return a[x]+max(a,b,x+1);\n    }\n}\n\nint main()\n{\n    int a[30],b,x,c;\n    scanf(\"%d\",&amp;b);\n    for(x=0;x&lt;b;x++){\n        scanf(\"%d\",&amp;a[x]);\n    }\n    x=0;\n    c=max(a,b,0);\n    printf(\"%d\",c);\n}\n</code></pre>\n\n<p><br>\nYou just missed the recursion termination condition in the <code>max()</code> function.</p>\n"}], "owner": {"reputation": 1, "user_id": 11263714, "user_type": "registered", "profile_image": "https://graph.facebook.com/1978699005759899/picture?type=large", "display_name": "Sri Ram", "link": "https://stackoverflow.com/users/11263714/sri-ram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 404, "favorite_count": 0, "closed_date": 1553711874, "answer_count": 2, "score": -1, "last_activity_date": 1553767396, "creation_date": 1553655342, "last_edit_date": 1553767396, "question_id": 55369099, "link": "https://stackoverflow.com/questions/55369099/finding-sum-of-array-elements-using-recursion", "closed_reason": "Not suitable for this site", "title": "finding sum of array elements using recursion", "body": "<p>Finding sum of elements in an array using recursion</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n/* run this program using the console pauser or add your own getch, \n  system(\"pause\") or input loop */\nint max(int a[],int b,int x)\n{\n    if(a[x]!='\\0'){\n        return a[x]+max(a,b,x+1);\n    }\n}\n\nint main()\n{\n    int a[30],b,x,c;\n    scanf(\"%d\",&amp;b);\n    for(x=0;x&lt;b;x++){\n        scanf(\"%d\",&amp;a[x]);\n    }\n    x=0;\n    c=max(a,b,0);\n    printf(\"%d\",c);\n}\n</code></pre>\n\n<p>Input :10\n       1 2 3 4 5 6 7 8 9 10<br>\nexpected output : 55<br>\nactual output : 102</p>\n"}, {"tags": ["c", "cs50"], "comments": [{"owner": {"reputation": 22422, "user_id": 634919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f4a87fe094961af20263d8e7ff445b2?s=128&d=identicon&r=PG", "display_name": "Nate Eldredge", "link": "https://stackoverflow.com/users/634919/nate-eldredge"}, "edited": false, "score": 0, "creation_date": 1553655670, "post_id": 55368971, "comment_id": 97461415, "body": "As a general principle, in the vast majority of C programs, you really want to use <code>double</code> instead of <code>float</code>.  But that isn&#39;t relevant to your error."}], "answers": [{"comments": [{"owner": {"reputation": 22422, "user_id": 634919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f4a87fe094961af20263d8e7ff445b2?s=128&d=identicon&r=PG", "display_name": "Nate Eldredge", "link": "https://stackoverflow.com/users/634919/nate-eldredge"}, "edited": false, "score": 0, "creation_date": 1553655600, "post_id": 55368997, "comment_id": 97461400, "body": "In context, the program doesn&#39;t want to convert a string to a number at all, so none of these functions are relevant.  It wants to convert a <code>float</code> to an <code>int</code> so a simple assignment or cast suffices."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 22422, "user_id": 634919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f4a87fe094961af20263d8e7ff445b2?s=128&d=identicon&r=PG", "display_name": "Nate Eldredge", "link": "https://stackoverflow.com/users/634919/nate-eldredge"}, "edited": false, "score": 0, "creation_date": 1553655733, "post_id": 55368997, "comment_id": 97461426, "body": "@NateEldredge an assignment + check if the value can be represented by <code>int</code> perhaps"}], "tags": [], "owner": {"reputation": 1463, "user_id": 2299087, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KWtlB.jpg?s=128&g=1", "display_name": "James McPherson", "link": "https://stackoverflow.com/users/2299087/james-mcpherson"}, "is_accepted": false, "score": 0, "last_activity_date": 1553654517, "creation_date": 1553654517, "answer_id": 55368997, "question_id": 55368971, "link": "https://stackoverflow.com/questions/55368971/error-passing-float-to-parameter-of-incompatible-type-const-char/55368997#55368997", "title": "error: passing &#39;float&#39; to parameter of incompatible type &#39;const char *&#39;", "body": "<p><code>atoi()</code> converts ascii to integer, and a <code>float</code> isn't an <code>int</code>. Check the function definition in the header file. I suggest using <code>atof()</code> instead, or perhaps <code>strtod()</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1553655843, "post_id": 55369095, "comment_id": 97461452, "body": "This answer may really need an extra note that this potentially may be an UB if <code>coins</code> value does not fit <code>int</code>."}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 2, "last_activity_date": 1553656027, "last_edit_date": 1553656027, "creation_date": 1553655302, "answer_id": 55369095, "question_id": 55368971, "link": "https://stackoverflow.com/questions/55368971/error-passing-float-to-parameter-of-incompatible-type-const-char/55369095#55369095", "title": "error: passing &#39;float&#39; to parameter of incompatible type &#39;const char *&#39;", "body": "<p>The <code>atoi</code> function is used to convert a string into an integer.  It expects a <code>char *</code> as an argument which points to a string.</p>\n\n<p>You don't need a conversion function here.  You can assign a <code>float</code> value directly to an <code>int</code>, and any fractional part will be truncated.</p>\n\n<pre><code>int x = coins;\n</code></pre>\n\n<p>Note however that this can invoke <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behavior</a> if the truncated value of <code>coins</code> is outside the range of an <code>int</code>.</p>\n"}], "owner": {"reputation": 29, "user_id": 9623431, "user_type": "registered", "profile_image": "https://graph.facebook.com/1002562406563329/picture?type=large", "display_name": "Hemendra  Khatik", "link": "https://stackoverflow.com/users/9623431/hemendra-khatik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1725, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1553656027, "creation_date": 1553654339, "last_edit_date": 1553654781, "question_id": 55368971, "link": "https://stackoverflow.com/questions/55368971/error-passing-float-to-parameter-of-incompatible-type-const-char", "title": "error: passing &#39;float&#39; to parameter of incompatible type &#39;const char *&#39;", "body": "<p>I'm working on a greedy algorithm where I am getting an error while converting float to int </p>\n\n<pre><code>#include &lt;cs50.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main()\n{\n    float n;\n    //checking if given input is valid or not\n    do\n    {\n        n = get_float();\n    }\n    while(n&lt;0);\n    //converting dollar into cents\n    float coins = n * 100;\n\n     int x = atoi(coins) //getting error here???\n\n....\n}\n</code></pre>\n"}, {"tags": ["c", "gtk", "gtk3", "gdk"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 11048350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b0ff1888e8033e65afc9decd58947f4?s=128&d=identicon&r=PG&f=1", "display_name": "newothegreat", "link": "https://stackoverflow.com/users/11048350/newothegreat"}, "edited": false, "score": 0, "creation_date": 1553689124, "post_id": 55370896, "comment_id": 97476052, "body": "Thanks. This is getting me closer, but I can&#39;t get the gtk_widget_add_events() to work.  When I add the line &quot;gtk_widget_add_events(mouse, GDK_POINTER_MOTION_MASK);&quot;, it won&#39;t compile because &quot;mouse&quot; is not a GtkWidget.  It&#39;s a GdkDevice.  When I to cast it as a GtkWidget with the code &quot;gtk_widget_add_events(GTK_WIDGET(mouse), GDK_POINTER_MOTION_MASK);&quot;, it complies, but throws an invalid cast error when I run it.  Is there another function for adding events to GdkDevices as opposed to GtkWidgets?"}, {"owner": {"reputation": 698, "user_id": 1981374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1afd547bb1f448490439e0093eba3a70?s=128&d=identicon&r=PG", "display_name": "pan-mroku", "link": "https://stackoverflow.com/users/1981374/pan-mroku"}, "edited": false, "score": 1, "creation_date": 1553690244, "post_id": 55370896, "comment_id": 97476775, "body": "You need to add events to the <code>gtk_window</code> not mouse: <code>gtk_widget_add_events(gtk_window, GDK_POINTER_MOTION_MASK);</code>"}, {"owner": {"reputation": 3, "user_id": 11048350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b0ff1888e8033e65afc9decd58947f4?s=128&d=identicon&r=PG&f=1", "display_name": "newothegreat", "link": "https://stackoverflow.com/users/11048350/newothegreat"}, "edited": false, "score": 0, "creation_date": 1553739563, "post_id": 55370896, "comment_id": 97500015, "body": "Ok.  So how do I pass the pointer object to the callback function?  Do I pass it as the &quot;gpointer data&quot; argument?  When I pass the mouse object <code>g_signal_connect (gtk_window, &quot;motion-notify-event&quot;, G_CALLBACK (print_mouse), mouse)</code>, I can sucessfully pass it to the callback function, but I get a segmentation fault when I try to read the position <code>GdkDevice *mouse = data; \tgdk_device_get_position(mouse, NULL, &amp;x, &amp;y);</code>"}, {"owner": {"reputation": 260, "user_id": 8322623, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XtjmiGIeM-U/AAAAAAAAAAI/AAAAAAAAABw/RVDz5MYOGsk/photo.jpg?sz=128", "display_name": "Paul Childs", "link": "https://stackoverflow.com/users/8322623/paul-childs"}, "edited": false, "score": 0, "creation_date": 1553749580, "post_id": 55370896, "comment_id": 97502084, "body": "You won&#39;t need the mouse object. In fact I don&#39;t believe you would ever have reason to use it at the UI layer. There&#39;s also no guarantee you have a mouse device given gtk&#39;s accessibility constructs."}, {"owner": {"reputation": 260, "user_id": 8322623, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XtjmiGIeM-U/AAAAAAAAAAI/AAAAAAAAABw/RVDz5MYOGsk/photo.jpg?sz=128", "display_name": "Paul Childs", "link": "https://stackoverflow.com/users/8322623/paul-childs"}, "edited": false, "score": 0, "creation_date": 1553749618, "post_id": 55370896, "comment_id": 97502095, "body": "Use the GdkEventMotion to get the location."}, {"owner": {"reputation": 260, "user_id": 8322623, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XtjmiGIeM-U/AAAAAAAAAAI/AAAAAAAAABw/RVDz5MYOGsk/photo.jpg?sz=128", "display_name": "Paul Childs", "link": "https://stackoverflow.com/users/8322623/paul-childs"}, "edited": false, "score": 0, "creation_date": 1553749782, "post_id": 55370896, "comment_id": 97502147, "body": "Also you may want to use gtype&#39;s type casting eg GTK_WIDGET(window) to get run time checking to aid debugging and unit tests rather than doing implicit casts (like with GdkDevice*)"}, {"owner": {"reputation": 260, "user_id": 8322623, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XtjmiGIeM-U/AAAAAAAAAAI/AAAAAAAAABw/RVDz5MYOGsk/photo.jpg?sz=128", "display_name": "Paul Childs", "link": "https://stackoverflow.com/users/8322623/paul-childs"}, "edited": false, "score": 0, "creation_date": 1553750060, "post_id": 55370896, "comment_id": 97502239, "body": "The callback function has GdkEvent as its second parameter"}, {"owner": {"reputation": 3, "user_id": 11048350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b0ff1888e8033e65afc9decd58947f4?s=128&d=identicon&r=PG&f=1", "display_name": "newothegreat", "link": "https://stackoverflow.com/users/11048350/newothegreat"}, "edited": false, "score": 0, "creation_date": 1553771020, "post_id": 55370896, "comment_id": 97512179, "body": "Thanks.  How do I use the GdkEventMotion structure to get the location.  I see that it contains x and y variable, but how do I access the structure?  Is it passes to the callback function as a GdkEvent?  Could you provide some sample code showing how to read the GdkEventMotion in the callback function?"}, {"owner": {"reputation": 260, "user_id": 8322623, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XtjmiGIeM-U/AAAAAAAAAAI/AAAAAAAAABw/RVDz5MYOGsk/photo.jpg?sz=128", "display_name": "Paul Childs", "link": "https://stackoverflow.com/users/8322623/paul-childs"}, "edited": false, "score": 0, "creation_date": 1553806514, "post_id": 55370896, "comment_id": 97533962, "body": "We are now at the point where reading the documentation should answer all questions re: the finer details. In this case the pointer is actually a GdkEventMotion under the hood so all you need to do is to cast the pointer, but GdkEvent should be sufficient for your needs here. It has members x and y."}], "tags": [], "owner": {"reputation": 260, "user_id": 8322623, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XtjmiGIeM-U/AAAAAAAAAAI/AAAAAAAAABw/RVDz5MYOGsk/photo.jpg?sz=128", "display_name": "Paul Childs", "link": "https://stackoverflow.com/users/8322623/paul-childs"}, "is_accepted": false, "score": 0, "last_activity_date": 1553667351, "creation_date": 1553667351, "answer_id": 55370896, "question_id": 55368909, "link": "https://stackoverflow.com/questions/55368909/how-to-connect-a-cursor-motion-signal-to-a-function-gtk/55370896#55370896", "title": "How to connect a cursor motion signal to a function (GTK)", "body": "<p>your something is \"motion-notify-event\" which gives data as a GdkEventMotion event: <a href=\"https://developer.gnome.org/gtk2/stable/GtkWidget.html#GtkWidget-motion-notify-event\" rel=\"nofollow noreferrer\">https://developer.gnome.org/gtk2/stable/GtkWidget.html#GtkWidget-motion-notify-event</a></p>\n\n<p>I think you will also need to ensure to gtk_widget_add_events(widget, GDK_POINTER_MOTION_MASK); when constructing the widget. For performance reasons you may want to set this up to only run code at a certain refresh rate so as not too overburden the cpu.</p>\n"}], "owner": {"reputation": 3, "user_id": 11048350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b0ff1888e8033e65afc9decd58947f4?s=128&d=identicon&r=PG&f=1", "display_name": "newothegreat", "link": "https://stackoverflow.com/users/11048350/newothegreat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 333, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553667351, "creation_date": 1553653945, "question_id": 55368909, "link": "https://stackoverflow.com/questions/55368909/how-to-connect-a-cursor-motion-signal-to-a-function-gtk", "title": "How to connect a cursor motion signal to a function (GTK)", "body": "<p>I'm writing a C program using the GTK libraries that reads the position of the cursor and writes it out to another function.  I've written code that's able to accurately read the cursor position data, but I can't figure out how to connect a cursor motion event to a function.</p>\n\n<p>Here is the code I have so far:</p>\n\n<pre><code>int main(int argc, char **argv){\n    GdkWindow *window;\n    GtkWidget *gtk_window;\n    GdkDevice *mouse;\n    gint x = 0;\n    gint y = 0;\n\n    gdk_init(&amp;argc, &amp;argv);\n    gtk_init(&amp;argc, &amp;argv);\n\n\n    gtk_window=gtk_window_new(GTK_WINDOW_TOPLEVEL);\n    gtk_widget_show(gtk_window);    \n    window = gtk_widget_get_window(GTK_WIDGET(gtk_window));\n\n    gdk_window_maximize(window);\n    gdk_window_set_title(window, \"write-mouse\");\n\n    GdkSeat *seat = gdk_display_get_default_seat (gdk_display_get_default ());\n    mouse = gdk_seat_get_pointer (seat);\n\n    gdk_window_get_device_position (window, mouse, &amp;x, &amp;y, NULL);\n\n    //read cursor position at startup to test code\n    g_print(\"X = %d\\n\", x);\n    g_print(\"Y = %d\\n\", y);\n\n    //g_signal_connect (mouse, \"something?\", G_CALLBACK (print_mouse), NULL);\n\n    gtk_main();\n}\n\nstatic void print_mouse(GdkDevice *mouse, gpointer data){\n    gint x = 0;\n    gint y = 0;\n    //do I need to pass the window object to \"print_mouse\" function too?\n    //can I point to it using some gtk function?\n    gdk_window_get_device_position (window, mouse, &amp;x, &amp;y, NULL);\n\n    g_print(\"X = %d\\n\", x);\n    g_print(\"Y = %d\\n\", y);\n}\n</code></pre>\n\n<p>I assume I need to use \"g_signal_connect()\" to connect the cursor motion event to the \"print_mouse\" function, but I can't figure out what to put as the arguments to make it work.</p>\n\n<p>What should I put in the \"detailed_signal\" field of \"g_signal_connect()?</p>\n\n<p>Is there a better way to do this entirely?</p>\n"}, {"tags": ["c", "memory-leaks"], "answers": [{"tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": false, "score": 3, "last_activity_date": 1553653279, "creation_date": 1553653279, "answer_id": 55368830, "question_id": 55368756, "link": "https://stackoverflow.com/questions/55368756/linked-list-in-c-error-free-invalid-pointer-error-or-segmentation-fault/55368830#55368830", "title": "Linked-list in c error - free(): invalid pointer error OR segmentation fault", "body": "<p>The free statement is indeed not useful.</p>\n\n<p>In this statement:</p>\n\n<pre><code>q-&gt;tail = q-&gt;tail-&gt;next = newNode;\n</code></pre>\n\n<p>you assign the pointer <code>newnode</code> to two pointer variables. But in the next statement</p>\n\n<pre><code>free(newNode);\n</code></pre>\n\n<p>you render this pointer invalid, so dereferencing (or freeing) the pointers stored in <code>q-&gt;tail</code> and the next pointer of the second-last element of your list results in undefined behaviour.</p>\n\n<p>Solution is to <em>not</em> free the pointer while a valid reference to it exists in the process.</p>\n"}], "owner": {"reputation": 1, "user_id": 11249255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01407ec42595352260a019958d6acbfe?s=128&d=identicon&r=PG&f=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/11249255/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553653404, "creation_date": 1553652669, "question_id": 55368756, "link": "https://stackoverflow.com/questions/55368756/linked-list-in-c-error-free-invalid-pointer-error-or-segmentation-fault", "title": "Linked-list in c error - free(): invalid pointer error OR segmentation fault", "body": "<p>I'm creating a linked-list in c and cannot add another node after the 4th.  When I use free(node), I get the error:\n    free(): invalid pointer\n    Aborted (core dumped)\nIf I remove the free(node) declaration, however, I get a segmentation fault.  I'm assuming this is some sort of memory issue, but I can't locate the source of the problem.</p>\n\n<p>Structures used:</p>\n\n<pre><code>struct node\n{\n    int id;\n    struct process * p;\n    struct node * next;\n};\n\nstruct queue\n{\n    struct node * head;\n    struct node * tail;\n};\n</code></pre>\n\n<p>Enqueue function that is supposed to add a node to the list:</p>\n\n<pre><code>void enqueue(struct queue * q, struct node * newNode)\n{\n    if(q-&gt;tail == NULL)\n    {\n        q-&gt;head = q-&gt;tail = newNode;\n        return;\n    }\n\n    q-&gt;tail = q-&gt;tail-&gt;next = newNode;\n\n    // free statement useful?\n    free(newNode);\n}\n</code></pre>\n"}, {"tags": ["c", "for-loop", "primes"], "comments": [{"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 2, "creation_date": 1553650233, "post_id": 55368408, "comment_id": 97460391, "body": "your pairs assignment loop assigns to slots <code>4..N</code>. that it only actually uses at-most <i>half</i> of them is irrelevant. you&#39;re still overreaching the declared boundaries of the <code>N&#47;2 + 4</code> number of slots you have declared, and as such you&#39;re invoking undefined behavior (and <i>probably</i> stomping all over other local variables in the same activation frame). The final for-loop is just as offensive as the prior in invoking undefined behavior."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1553650396, "post_id": 55368408, "comment_id": 97460429, "body": "Suggested alternative to <code>primes[j] &lt;= sqrt(i)</code> --&gt; <code>primes[j]  &lt;= i&#47;primes[j]</code> and avoid floating point concerns/imprecision."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1553670582, "post_id": 55368408, "comment_id": 97465510, "body": "<i>60:26: runtime error: index 34 out of bounds for type &#39;pair [</i>]&#39;<code>* with GCC </code>-fsanitize=undefined`"}], "answers": [{"tags": [], "owner": {"reputation": 32921, "user_id": 5771269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be6a5b618f5bd197150a6186318beba7?s=128&d=identicon&r=PG&f=1", "display_name": "cdlane", "link": "https://stackoverflow.com/users/5771269/cdlane"}, "is_accepted": false, "score": 0, "last_activity_date": 1553670128, "creation_date": 1553670128, "answer_id": 55371494, "question_id": 55368408, "link": "https://stackoverflow.com/questions/55368408/for-loop-unexpectedly-jumping-down-in-value/55371494#55371494", "title": "for loop unexpectedly jumping down in value", "body": "<p>You attempt to be space efficient by compressing the <code>pairs</code> array to just hold every other (even) number and start from 4 instead of zero.  However, you miscalculate its size and then when you go to use it, you treat it like it hasn't been compressed and that there's a slot for every natural number.</p>\n\n<p>The code suffers from having the prime array calculation in <code>main()</code> along with the other code, this is best separated out.  And when it looks for pairs, it doesn't quit when it finds one, nor when it starts getting sums greater than the target.  My rework below attempts to address all of these issues:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;math.h&gt;\n#include &lt;stdbool.h&gt;\n\n#define INITIAL_SLOTS (100)\n\nstruct pair {\n    int a;\n    int b;\n} pair_t;\n\nint compute_primes(int limit, unsigned **primes, int size) {\n    int numPrimes = 0;\n\n    (*primes)[numPrimes++] = 2;\n\n    for (int i = 3; i &lt;= limit; i += 2) { \n        bool isPrime = true;\n\n        for (int j = 0; (*primes)[j] &lt;= i / (*primes)[j]; j++) {\n            if (i % (*primes)[j] == 0) {\n                isPrime = false;\n                break;\n            }\n        }\n\n        if (isPrime) {\n            (*primes)[numPrimes++] = i;\n        }\n\n        if (numPrimes == size) {\n            size *= 2;\n            *primes = realloc(*primes, size * sizeof(unsigned));\n        }\n    }\n\n    return numPrimes;\n}\n\nint main() {\n    int N;\n    printf(\"Please enter the largest even number you want to find the Goldbach pair for: \\n\");\n    scanf(\"%d\", &amp;N);\n\n    unsigned *primes = calloc(INITIAL_SLOTS, sizeof(unsigned));\n    int numPrimes = compute_primes(N, &amp;primes, INITIAL_SLOTS);\n\n    printf(\"The largest prime I found was %d\\n\", primes[numPrimes - 1]);\n\n    struct pair pairs[(N - 4) / 2 + 1]; // compressed data structure\n\n    for (int i = 4; i &lt;= N; i += 2) {\n\n        int offset = (i - 4) / 2; // compressed index\n        bool found = false;\n\n        for (int j = 0; ! found &amp;&amp; j &lt; numPrimes; j++) {\n            for (int k = 0; ! found &amp;&amp; k &lt; numPrimes; k++) {\n                int sum = primes[j] + primes[k];\n\n                if (sum == i) {\n                    pairs[offset].a = primes[j];\n                    pairs[offset].b = primes[k];\n                    found = true;\n                } else if (sum &gt; i) {\n                    break;\n                }\n            }\n        }\n    }\n\n    for (int i = 4; i &lt;= N; i += 2) {\n        int offset = (i - 4) / 2; // compressed index\n        printf(\"%d is the sum of %d and %d\\n\", i, pairs[offset].a, pairs[offset].b);\n    }\n\n    free(primes);\n\n    return 0;\n}\n</code></pre>\n\n<p><strong>OUTPUT</strong></p>\n\n<pre><code>&gt; ./a.out\nPlease enter the largest even number you want to find the Goldbach pair for: \n10000\nThe largest prime I found was 9973\n4 is the sum of 2 and 2\n6 is the sum of 3 and 3\n8 is the sum of 3 and 5\n10 is the sum of 3 and 7\n12 is the sum of 5 and 7\n14 is the sum of 3 and 11\n...\n9990 is the sum of 17 and 9973\n9992 is the sum of 19 and 9973\n9994 is the sum of 53 and 9941\n9996 is the sum of 23 and 9973\n9998 is the sum of 31 and 9967\n10000 is the sum of 59 and 9941\n&gt; \n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 11115589, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PRC-DaWn1VM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfsBxOBWWxhm6MwEBjMneop3Gzc3A/mo/photo.jpg?sz=128", "display_name": "Dylan Hecht", "link": "https://stackoverflow.com/users/11115589/dylan-hecht"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553670201, "creation_date": 1553649437, "last_edit_date": 1553670201, "question_id": 55368408, "link": "https://stackoverflow.com/questions/55368408/for-loop-unexpectedly-jumping-down-in-value", "title": "for loop unexpectedly jumping down in value", "body": "<p>Goldbach's conjecture states that every even integer over 4 is the sum of two primes, I am writing a program in C to find these pairs. To do this it first finds all the primes less than a user given number. I have a for loop to iterate from 4 to the user given number and find the pairs within the loop body. When that loop gets to about around 40, suddenly jumps back down by about 30 and then continues to iterate up (with user input 50 it jumped from 38 to 9, with input 60 it jumped from 42 to 7). I can't figure out why this is happening. Here is my code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;math.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n\nstruct pair{\n    int a;\n    int b;\n}pair_t;\n\n\nint main(){\n    int N;\n    int numPrimes = 1;\n    int *primes = malloc(100*sizeof(int));\n    int isPrime = 1;\n    primes[0] = 2;\n    int timesRealloc = 0;\n    int availableSlots = 100;\n\n    printf(\"Please enter the largest even number you want to find the Goldbach pair for: \\n\");\n    scanf(\"%d\", &amp;N);\n\n    struct pair pairs[N/2 + 4];\n\n    int j = 0;\n    int i;\n    for (i = 3; i &lt;= N; i+=2){ \n        j = 0;\n        isPrime = 1;\n        while (primes[j] &lt;= sqrt(i)) {\n            if (i%primes[j] == 0) {\n                isPrime = 0;\n                break;\n            }\n            j++;\n        }\n        if (isPrime == 1){\n            primes[numPrimes] = i;\n            numPrimes++;\n        }\n        if (availableSlots == numPrimes){\n            timesRealloc++;\n            availableSlots += 100;\n            primes = realloc(primes, availableSlots*sizeof(int));\n        }\n    }\n\n    printf(\"The largest prime I found was %d\\n\", primes[(numPrimes-1)]);\n\n    int k;\n    for (i=4; i&lt;=N; i+=2){\n        printf(\"i is %d, N is %d\\n\", i, N);\n        if (i &gt; N){ break; }\n        for (j=0; j&lt;numPrimes; j++){\n            for (k=0; k&lt;numPrimes; k++){\n                int sum = primes[j] + primes[k];\n                if(sum == i){\n                    pairs[i].a = primes[j];\n                    pairs[i].b = primes[k];\n                }\n            }\n        }\n    }\n\n    for (i=4; i&lt;=N; i+=2){\n        printf(\"%d is the sum of %d and %d\\n\", i, pairs[i].a, pairs[i].b);\n    }\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "goto"], "comments": [{"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553647363, "post_id": 55368125, "comment_id": 97459821, "body": "regarding: <code>int err2;         if (err2 = another_thing())</code>  1) the if() is actually an assignment, and 2) err2 is not initialized (if code used &#39;==&#39; rather than &#39;=&#39;)  Similar considerations exist for the statement: <code>if (err = baz())</code>"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1553647637, "post_id": 55368125, "comment_id": 97459879, "body": "<code>popped from the stack</code> is highly platform dependent action. I would expect the compiler for a platform that allocates the memory for stack variables by some hardware &quot;pop&quot; and &quot;push&quot; actions would generate proper instructions before <code>goto fatal;</code> so that no &quot;stack corruption&quot; (another platform dependent behavior) will not happen."}, {"owner": {"reputation": 323, "user_id": 1664241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4d16d553953a2acf35f500aaf40d9b1?s=128&d=identicon&r=PG&f=1", "display_name": "rambo", "link": "https://stackoverflow.com/users/1664241/rambo"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553648060, "post_id": 55368125, "comment_id": 97459975, "body": "Thanks @user3629249, regarding 1) <code>if</code> is actually a statement, <code>err = baz()</code> is an expression that happens to assign the return value of <code>baz()</code> to <code>err</code>. The statement <code>if</code> will evaluate the return value of the assignment, which in this case is the value of <code>err2</code> 2) there is no semantic difference between the code as written and <code>int err = baz(); if (err) {....</code>"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1553648669, "post_id": 55368125, "comment_id": 97460079, "body": "&quot;I&#39;d hypothesize that err2 isn&#39;t ...  and that stack corruption would result.&quot; --&gt; No, this code is well defined."}, {"owner": {"reputation": 323, "user_id": 1664241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4d16d553953a2acf35f500aaf40d9b1?s=128&d=identicon&r=PG&f=1", "display_name": "rambo", "link": "https://stackoverflow.com/users/1664241/rambo"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1553648747, "post_id": 55368125, "comment_id": 97460097, "body": "Thanks @chux - I&#39;m curious to know <i>why</i> the code is well defined, as my (incorrect) hypothesis was that it wasn&#39;t well defined."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1553649141, "post_id": 55368125, "comment_id": 97460166, "body": "The issue isn&#39;t whether <code>err2</code> is popped from the stack after <code>goto</code> jumps to the label, the issue is whether you attempt to access <code>err2</code> after exiting the scope. Since you do not, the code is well defined. If however you attempted <code>printf(&quot;there was a fatal error: %d&quot;, err2);</code> - Undefined Behavior would result but since no modification of <code>err2</code> was attempted it is unlikely there would be any corruption."}, {"owner": {"reputation": 323, "user_id": 1664241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4d16d553953a2acf35f500aaf40d9b1?s=128&d=identicon&r=PG&f=1", "display_name": "rambo", "link": "https://stackoverflow.com/users/1664241/rambo"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1553649237, "post_id": 55368125, "comment_id": 97460184, "body": "Thanks @DavidC.Rankin, I see your point, but if <code>err2</code> isn&#39;t popped from the stack, how is there not stack corruption? This is arch dependent, but if <code>foo()</code> pops the stack into some registers upon exit, if <code>err2</code> was pushed to the stack but not popped before the function exited, incorrect values could be stored in those registers"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1553649278, "post_id": 55368125, "comment_id": 97460189, "body": "NO, <code>err2</code> is declared local to the function, the function stack-frame is released for reuse when <code>foo()</code> returns. <code>err2</code> has <i>Automatic Storage Duration</i> See: <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.2.4\" rel=\"nofollow noreferrer\">C11 Standard - 6.2.4 Storage durations of objects</a>"}, {"owner": {"reputation": 323, "user_id": 1664241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4d16d553953a2acf35f500aaf40d9b1?s=128&d=identicon&r=PG&f=1", "display_name": "rambo", "link": "https://stackoverflow.com/users/1664241/rambo"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1553649386, "post_id": 55368125, "comment_id": 97460216, "body": "@DavidC.Rankin do all compilers behave this way?"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1553649456, "post_id": 55368125, "comment_id": 97460232, "body": "Yes, all conforming compilers do, see the link I added to the comment above."}, {"owner": {"reputation": 323, "user_id": 1664241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4d16d553953a2acf35f500aaf40d9b1?s=128&d=identicon&r=PG&f=1", "display_name": "rambo", "link": "https://stackoverflow.com/users/1664241/rambo"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1553649631, "post_id": 55368125, "comment_id": 97460271, "body": "Great, thanks @DavidC.Rankin, that&#39;s exactly what I was looking for."}], "answers": [{"comments": [{"owner": {"reputation": 323, "user_id": 1664241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4d16d553953a2acf35f500aaf40d9b1?s=128&d=identicon&r=PG&f=1", "display_name": "rambo", "link": "https://stackoverflow.com/users/1664241/rambo"}, "edited": false, "score": 0, "creation_date": 1553648685, "post_id": 55368227, "comment_id": 97460082, "body": "Thanks for the response. Yeah, not accessing a pointer to something that&#39;s out of scope definitely makes sense. In terms of stack corruption, I was thinking more along the lines of <code>foo()</code> being called repeatedly, and the stack growing ever so slowly larger indefinitely. Memory leak is a better term to describe what I was thinking about."}, {"owner": {"reputation": 323, "user_id": 1664241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4d16d553953a2acf35f500aaf40d9b1?s=128&d=identicon&r=PG&f=1", "display_name": "rambo", "link": "https://stackoverflow.com/users/1664241/rambo"}, "edited": false, "score": 0, "creation_date": 1553649151, "post_id": 55368227, "comment_id": 97460169, "body": "And as a follow-up, if it&#39;s not possible to answer for certain (compiler-dependent), for portable could would you recommend not using this pattern?"}, {"owner": {"reputation": 323, "user_id": 1664241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4d16d553953a2acf35f500aaf40d9b1?s=128&d=identicon&r=PG&f=1", "display_name": "rambo", "link": "https://stackoverflow.com/users/1664241/rambo"}, "edited": false, "score": 1, "creation_date": 1553649749, "post_id": 55368227, "comment_id": 97460293, "body": "Thanks, copying DavidC.Rankin&#39;s comment on the original question here for anyone running across this as the accepted answer down the line and skimming over only the accepted answer and its comments.  &quot;err2 has Automatic Storage Duration See: <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.2.4\" rel=\"nofollow noreferrer\">port70.net/~nsz/c/c11/n1570.html#6.2.4</a>&quot;"}], "tags": [], "owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "is_accepted": true, "score": 4, "last_activity_date": 1553649405, "last_edit_date": 1553649405, "creation_date": 1553647933, "answer_id": 55368227, "question_id": 55368125, "link": "https://stackoverflow.com/questions/55368125/using-goto-after-a-variable-declaration-at-block-scope-in-c/55368227#55368227", "title": "Using goto after a variable declaration at block scope in C", "body": "<p>Not possible to answer for certain; however most compilers allocate all the memory for the function at once.</p>\n\n<p>As a practical matter, if it's gone out of scope, accessing a pointer to it is a bad idea and otherwise you don't care. Even at <code>-O0</code>, the memory for an out-of-scope variable might be reused.</p>\n\n<p>In no case will the local variables leak. The stack will not become imbalanced. There is nothing dangerous in the code in the question.</p>\n"}, {"comments": [{"owner": {"reputation": 323, "user_id": 1664241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4d16d553953a2acf35f500aaf40d9b1?s=128&d=identicon&r=PG&f=1", "display_name": "rambo", "link": "https://stackoverflow.com/users/1664241/rambo"}, "edited": false, "score": 0, "creation_date": 1553648531, "post_id": 55368255, "comment_id": 97460049, "body": "Thanks for the response - one follow-up clarification. In your example, is the guarantee of stack space for all locals being reserved upon function entry fulfilled by the processor, the compiler, or both? Given you&#39;re suggesting the behavior is different per processor/compiler, I&#39;m guessing this isn&#39;t something that&#39;s specified in the C standard?"}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 2, "creation_date": 1553649573, "post_id": 55368255, "comment_id": 97460252, "body": "Actually in C++ jumping around constructors will reliably yield compiler errors. If we had a C++ tag on the question I&#39;d downvote so you lucked out."}, {"owner": {"reputation": 48983, "user_id": 314028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/408552a8101c1b9d466dcc5f104b1619?s=128&d=identicon&r=PG", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/314028/chris-taylor"}, "reply_to_user": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1553651273, "post_id": 55368255, "comment_id": 97460566, "body": "@Joshua, thanks updated the post. Years ago the compilers did not do this checking and I was not aware that they do now, though it is probably obvious given the flow control analysis they do. To share more, I now learned that gcc&#39;s -fpermissive flag will allow the old behavior with a warning rather than an error. I learn something new everyday."}, {"owner": {"reputation": 48983, "user_id": 314028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/408552a8101c1b9d466dcc5f104b1619?s=128&d=identicon&r=PG", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/314028/chris-taylor"}, "reply_to_user": {"reputation": 323, "user_id": 1664241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4d16d553953a2acf35f500aaf40d9b1?s=128&d=identicon&r=PG&f=1", "display_name": "rambo", "link": "https://stackoverflow.com/users/1664241/rambo"}, "edited": false, "score": 0, "creation_date": 1553651436, "post_id": 55368255, "comment_id": 97460598, "body": "@rambo, it is the compiler and the code that it generates that will dictate this. The details of how this is achieved might be processor dependent, but I am not aware of a compiler that does not do this though."}], "tags": [], "owner": {"reputation": 48983, "user_id": 314028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/408552a8101c1b9d466dcc5f104b1619?s=128&d=identicon&r=PG", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/314028/chris-taylor"}, "is_accepted": false, "score": 1, "last_activity_date": 1553650597, "last_edit_date": 1553650597, "creation_date": 1553648136, "answer_id": 55368255, "question_id": 55368125, "link": "https://stackoverflow.com/questions/55368125/using-goto-after-a-variable-declaration-at-block-scope-in-c/55368255#55368255", "title": "Using goto after a variable declaration at block scope in C", "body": "<p>In the case of a stack based processor like x86 using GCC or MSVC, the stack space for all the locals, regardless of scope will be reserved on entry to the function <code>foo</code>. The the stack frame will be unrolled on exit reclaiming the stack space as expected regardless of how the exit was reached.</p>\n\n<p>For C++ however the situation is different. Not quite your example, but if you jump over a constructor then the constructor will not have run however the compiler will still run the destructor which would cause a mess. Fortunately as pointed out by Joshua in the comments, the modern compilers detect this situation and will generate a compile time error to avoid this situation.  </p>\n"}], "owner": {"reputation": 323, "user_id": 1664241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4d16d553953a2acf35f500aaf40d9b1?s=128&d=identicon&r=PG&f=1", "display_name": "rambo", "link": "https://stackoverflow.com/users/1664241/rambo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 55368227, "answer_count": 2, "score": 2, "last_activity_date": 1553650597, "creation_date": 1553646825, "question_id": 55368125, "link": "https://stackoverflow.com/questions/55368125/using-goto-after-a-variable-declaration-at-block-scope-in-c", "title": "Using goto after a variable declaration at block scope in C", "body": "<p>I'm trying to better understand block scope in C and whether the standard provides any guarantees regarding popping stack elements upon exiting block scope that may have been pushed to the stack upon entering that scope. As an example, does jumping to a label outside of a block (which is just, well, jumping to a label in C, nothing special there) after having declared a variable within that block result in a corrupted stack? </p>\n\n<p>Here's a contrived example, and if it helps to further define the question, assume <code>-O0</code>. My confusion is around whether <code>err2</code> is popped from the stack when the execution path that jumps to the <code>fatal</code> label is hit. Because labels are nothing special in C, I'd hypothesize that <code>err2</code> isn't popped from the stack, and that stack corruption would result.</p>\n\n<pre><code>void foo() \n{\n\n    int err;\n    if (err = baz()) {\n\n        printf(\"error %i\", err);\n        int err2;\n        if (err2 = another_thing())\n            goto fatal;\n\n    } \n\n    printf(\"done\");\n    return;\n\nfatal:\n\n    printf(\"there was a fatal error\");\n\n}\n</code></pre>\n"}, {"tags": ["c", "binaryfiles", "file-handling"], "comments": [{"owner": {"reputation": 53754, "user_id": 198536, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9edaf4c1c1b89b5d39c40528d0017509?s=128&d=identicon&r=PG", "display_name": "wallyk", "link": "https://stackoverflow.com/users/198536/wallyk"}, "edited": false, "score": 0, "creation_date": 1553646100, "post_id": 55367958, "comment_id": 97459575, "body": "I don&#39;t see a declaration for <code>account</code>.  Is that something omitted?  <code>struct account</code> doesn&#39;t declare such a variable, only a structure."}, {"owner": {"reputation": 4328, "user_id": 920069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd39f0db1f22e1314746491df063602a?s=128&d=identicon&r=PG", "display_name": "Retired Ninja", "link": "https://stackoverflow.com/users/920069/retired-ninja"}, "edited": false, "score": 0, "creation_date": 1553646259, "post_id": 55367958, "comment_id": 97459616, "body": "You might read through this. It isn&#39;t your main problem, but you are using the return value from <code>fread</code> incorrectly. <a href=\"https://stackoverflow.com/questions/28398255/fread-return-value-in-c\" title=\"fread return value in c\">stackoverflow.com/questions/28398255/fread-return-value-in-c</a>"}, {"owner": {"reputation": 27, "user_id": 11263252, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NT8Dei0HaIk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rftdbCox-BZ6CozgeuAm83b-UDwzQ/mo/photo.jpg?sz=128", "display_name": "marc jose", "link": "https://stackoverflow.com/users/11263252/marc-jose"}, "edited": false, "score": 0, "creation_date": 1553682585, "post_id": 55367958, "comment_id": 97472009, "body": "i&#39;ve omitted my declaration for account, sorry if i haven&#39;t made that clear. thank you for the response"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1553684012, "post_id": 55367958, "comment_id": 97472878, "body": "Please don&#39;t post images."}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 11263252, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NT8Dei0HaIk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rftdbCox-BZ6CozgeuAm83b-UDwzQ/mo/photo.jpg?sz=128", "display_name": "marc jose", "link": "https://stackoverflow.com/users/11263252/marc-jose"}, "edited": false, "score": 0, "creation_date": 1553685379, "post_id": 55368036, "comment_id": 97473767, "body": "thank you for the reply, but my problem still persists. thank you for the tips though."}], "tags": [], "owner": {"reputation": 4523, "user_id": 2998877, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/be042cb19c34a4685d70997d44827b1a?s=128&d=identicon&r=PG&f=1", "display_name": "Spark.Bao", "link": "https://stackoverflow.com/users/2998877/spark-bao"}, "is_accepted": false, "score": 3, "last_activity_date": 1553646309, "last_edit_date": 1553646309, "creation_date": 1553646101, "answer_id": 55368036, "question_id": 55367958, "link": "https://stackoverflow.com/questions/55367958/using-data-inside-a-binary-file-in-a-conditional-statement/55368036#55368036", "title": "Using data inside a binary file in a conditional statement", "body": "<p>try to change the <code>exit(1)</code> to <code>continue;</code>, the <code>exit(1)</code> will make your program quit the while loop and exit the program immediately whenever <code>accno != accrec.no</code>.</p>\n\n<p>in fact, you don't need the <code>else</code> statement inside the <code>while</code> loop, you should put it outside the <code>while</code> loop. for example:</p>\n\n<pre><code>scanf(\"%d\",&amp;accno);\nboolean found = false;\nwhile (fread(&amp;accrec,sizeof(account),1,fptr)!=NULL)\n{\n    if (accno == accrec.no)\n    {\n        found = true;\n        scanf(\"%d\",&amp;acpin);*/\n        printf(\"\\tWelcome to Banking System\\n\");\n        printf(\"1.Balance Inquiry\\n\");\n        printf(\"2.Deposit\\n\");\n        printf(\"3.Withdrawal\\n\");\n        printf(\"4.quit\\n\");\n\n        scanf(\"%d\",&amp;choice);\n    }\n}\nif (!found) {\n    printf(\"account doesn't exist\\n\");\n}\n\nfclose(fptr);\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 11263252, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NT8Dei0HaIk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rftdbCox-BZ6CozgeuAm83b-UDwzQ/mo/photo.jpg?sz=128", "display_name": "marc jose", "link": "https://stackoverflow.com/users/11263252/marc-jose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553685711, "creation_date": 1553645552, "last_edit_date": 1553685711, "question_id": 55367958, "link": "https://stackoverflow.com/questions/55367958/using-data-inside-a-binary-file-in-a-conditional-statement", "title": "Using data inside a binary file in a conditional statement", "body": "<p>It's my first time asking here, so I'm sorry in advance if my post is a bit messy. I'm a freshman and my finals is to make an atm program.</p>\n\n<p>My program uses switch statements for the options: the first one asks the user for their info, (account number, account name, PIN, initial deposit), while the second one is for the actual transactions: Balance check, Deposit and Withdrawal.  Before you could do any one of those options, of course I'll have to check if the info (in this case the account number and PIN) matches the ones in my file.</p>\n\n<p>The file is in binary. My problem is that my code for reading the file works fine if i want to display the contents of my file (all the data entries that I populated the file with are shown), but when i want to use the contents of the file (searching inside the file for a match of the user inputted account number) it only reads the first line of the file, thus only the first data entry works, while the one's after that are not read. </p>\n\n<p>My question is, what am i doing wrong in my code? its confusing because if I change my code to display the contents it shows everything, meaning it reads the whole file. but when i want to search the file using a conditional statement, only the first data entry gets read. Thank you very much for your time </p>\n\n<p>tldr: can't use data in file for conditionals (verify the data inside the file, cuz my code doesn't read it whole apparently, except for the first entry)\nbut if i print the contents it reads it fully  </p>\n\n<p>my outputs\n1.My data entries \n<a href=\"https://i.stack.imgur.com/Eox37.png\" rel=\"nofollow noreferrer\">data entries</a>\n2.Entering the Account no. of the 1st one (desired output)\n<a href=\"https://i.stack.imgur.com/Fi76R.png\" rel=\"nofollow noreferrer\">desired output</a>\n3.Entering The account no. of the 2nd one (Problem part)\n<a href=\"https://i.stack.imgur.com/pjirf.png\" rel=\"nofollow noreferrer\">problem</a></p>\n\n<p>my main code</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;conio.h&gt;\n#include&lt;ctype.h&gt;\n#include&lt;stdlib.h&gt;\n#include&lt;string.h&gt;\n#include&lt;process.h&gt;\n\nstruct account\n{\n    int no;\n    char name[100];\n    int pin;\n    float id;\n}; \n\nmain()\n{    \n    FILE *fptr;\n    fptr = fopen(\"accrec.dat\",\"ab\");\n    if (fptr == NULL)\n    {\n        printf(\"File does not exists \\n\");\n        return 0;\n    }\n    system(\"cls\");\n    struct account accrec;\n    int i,tpin[4];\n    char step1,ch;\n\n    printf(\"\\t\\tWelcome to Banking System\\n\\t\");\n    printf(\"\\nA.Open an Account\\n\");\n    printf(\"\\nB.Bank Transaction\\n\");\n    printf(\"\\nC.exit\\n\");\n\n    scanf(\"%c\",&amp;step1);\n    switch (step1)\n    {\n\n        case 'A':\n            printf(\"Open a New Account\\n\");\n            printf(\"\\nEnter the following information\\n\");\n\n            printf(\" \\n5-digit  Account number:\");\n            scanf(\"%d\",&amp;accrec.no);\n\n            getchar();\n            printf(\"\\nAccount Name:\");\n            scanf(\"%[^\\n]s\",&amp;accrec.name);\n\n            printf(\"\\n4-digit Account PIN:\");\n                /*for(i=0;i&lt;4;i++)\n                {\n                ch = getch();\n                tpin[4] = ch;\n                ch = '*' ;\n                printf(\"%c\",ch);\n                }mask works but does not allow PIN saving     */\n            scanf(\"%d\",&amp;accrec.pin);\n\n\n            printf(\"\\nInitial deposit:\");\n            scanf(\"%f\",&amp;accrec.id);\n\n            fwrite(&amp;accrec,sizeof(struct account),1,fptr);\n\n            fclose(fptr);\n\n            break;\n\n        case 'B':\n            {\n            fptr = fopen(\"accrec.dat\",\"rb\");\n            int choice;\n            int accno = 0;\n            printf(\"Enter Your Account no.\");\n            scanf(\"%d\",&amp;accno);\n            while (fread(&amp;accrec,sizeof(account),1,fptr)!=NULL)\n            {\n            if(accno == accrec.no)\n            {\n            printf(\"\\tWelcome to PUPQC Banking System\\n\");\n            printf(\"1.Balance Inquiry\\n\");\n            printf(\"2.Deposit\\n\");\n            printf(\"3.Withdrawal\\n\");\n            printf(\"4.quit\\n\");\n            scanf(\"%d\",&amp;choice);\n            }\n            else \n            {\n                printf(\"account doesn't exist\\n\");\n                exit(1);\n            }   \n\n\n            fclose(fptr);\n\n            switch (choice)\n            {\n                case 1:\n\n                    printf(\"BALANCE INQUIRY\\n\");\n                    printf(\"Current Balance:\");\n                    fptr = fopen(\"accrec.dat\",\"rb\");\n                    if (fptr == NULL)\n                    {\n                    printf(\"File Cant be read\");\n                    exit(1);\n                    }\n\n                    printf(\"Account No: %d\\n\",accrec.no);\n\n                    while(fread(&amp;accrec,sizeof(struct account),1,fptr)!=NULL);\n                    {\n                    printf(\"Initial Deposit is %0.2f\\n\",accrec.id);\n                    }       \n                    printf(\"%d\\n\",&amp;accrec.id);\n\n                    break;\n\n                case 2:\n                    float dv;\n                    printf(\"DEPOSIT\\n\");\n                    printf(\"Current Balance:\");\n                    fptr = fopen(\"accrec.dat\",\"rb\");\n                    if (fptr == NULL)\n                    {\n                    printf(\"File Cant be read\");\n                    exit(1);\n                    }\n                    while(fread(&amp;accrec,sizeof(struct account),1,fptr)!=NULL);\n                    {\n                    printf(\"%0.2f\\n\",accrec.id);\n                    }\n                    printf(\"Enter amount to deposit:\\n\");\n                    printf(\"Deposit Value:\");\n                    scanf(\"%0.2f\",&amp;dv);\n                    accrec.id = accrec.id + dv; \n                    fwrite(&amp;accrec,sizeof(struct account),1,fptr);  \n                    fclose(fptr);\n                    break;\n\n                case 3:\n                    float wv;\n                    printf(\"WITHDRAWAL\\n\");\n                    printf(\"Current Balance:\");\n                    fptr = fopen(\"accrec.dat\",\"rb+\");\n                    if (fptr == NULL)\n                    {\n                    printf(\"File Cant be read\");\n                    exit(1);\n                    }\n                    while(fread(&amp;accrec,sizeof(struct account),1,fptr)!=NULL);\n                    {\n                    printf(\"%0.2f\\n\",accrec.id);\n                    }\n                    printf(\"Enter amount to withdraw:\\n\");\n                    printf(\"Withdrawal Value:\");\n                    scanf(\"%0.2f\",wv);\n                    accrec.id = accrec.id - wv; \n                    fwrite(&amp;accrec,sizeof(struct account),1,fptr);  \n                    fclose(fptr);\n\n                    break;\n\n                case 4:\n                    printf(\"thank you for your patronage \\n\");\n                    return 0;\n                    break;\n\n                default:\n                    printf(\"error 404\");\n                    break;\n                }\n            }\n        }\n        break;\n\n        case 'C':\n            printf(\"Thank you! Have a good day\");\n            return 0;\n            break;\n\n        case 'D':\n            fptr = fopen(\"accrec.dat\",\"rb\");\n            if (fptr == NULL)\n            {\n                printf(\"File Cant be read\");\n                exit(1);\n            }\n\n            printf(\"Data From file\\n\");\n\n            while(fread(&amp;accrec,sizeof(struct account),1,fptr)!=NULL)\n            printf(\"\\n acc.no is %d\\n acc.name is %s\\n PIN %d\\n Initial Deposit is %0.2f\\n \",accrec.no,accrec.name,accrec.pin,accrec.id);\n            fclose(fptr);\n            getch();\n\n            break;\n\n        default:\n            printf(\"invalid input! please select form the options given\\n\");\n\n    }\n\n} \n</code></pre>\n\n<p>my structure</p>\n\n<pre><code>    struct account\n    {\n        int no;\n        char name[100];\n        int pin;\n        float id;\n    }; \n</code></pre>\n\n<p>code for finding a match of account number in my file\n(the part i'm having trouble with)</p>\n\n<pre><code>    fptr = fopen(\"accrec.dat\",\"rb\");\n    int choice;\n    int accno = 0;\n    printf(\"Enter Your Account no.\");\n    scanf(\"%d\",&amp;accno);\n    while (fread(&amp;accrec,sizeof(account),1,fptr)!=NULL)\n    {\n        if (accno == accrec.no)\n        {\n            printf(\"\\tWelcome to Banking System\\n\");\n            printf(\"1.Balance Inquiry\\n\");\n            printf(\"2.Deposit\\n\");\n            printf(\"3.Withdrawal\\n\");\n            printf(\"4.quit\\n\");\n\n            scanf(\"%d\",&amp;choice);\n        }\n        else \n        {\n            printf(\"account doesn't exist\\n\");\n            exit(1);\n        }   \n    }\n\n    fclose(fptr);\n</code></pre>\n\n<p>The expected output is that my conditional statement works properly and reads my whole file for matches.</p>\n"}, {"tags": ["c", "login", "environment-variables", "execl"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1553664179, "post_id": 55367915, "comment_id": 97463268, "body": "Maybe <code>&#47;bin&#47;login</code> sets a fixed known set of environment variables and leaves it up to the shell to set others.  If you want a login shell, with Bash use <code>bash -l</code> (split up when working with <code>execle()</code>, of course); with most shells, if the last component of the path of <code>argv0</code> starts with a dash, that means &#39;login shell&#39;: <code>execle(&quot;&#47;bin&#47;sh&quot;, &quot;&#47;bin&#47;-sh&quot;, (char *)0, env);</code>."}], "answers": [{"tags": [], "owner": {"reputation": 5119, "user_id": 4276647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6a929f6537e73d7cc1ec7b533032350?s=128&d=identicon&r=PG&f=1", "display_name": "Kurtis Rader", "link": "https://stackoverflow.com/users/4276647/kurtis-rader"}, "is_accepted": false, "score": 1, "last_activity_date": 1553651664, "creation_date": 1553651664, "answer_id": 55368647, "question_id": 55367915, "link": "https://stackoverflow.com/questions/55367915/how-to-pass-environment-variables-using-execle-for-bin-login/55368647#55368647", "title": "How to pass environment variables using execle() for /bin/login?", "body": "<p>Works for me. Are you sure your <code>execle()</code> is succeeding? For example, on BSD systems (including macOS) the correct path is <em>/usr/bin/login</em>. You should add a <code>fprintf(stderr, \"execle() failed with errno %d\\n\", errno);</code> after the <code>execle()</code> call.</p>\n\n<p>Are you sure the BusyBox <code>login</code> command on your system supports those options? </p>\n\n<p>Also, please use <code>NULL</code> rather than <code>(char *)0</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 59, "user_id": 3998658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/916cea4dc5f50ed00f2406999adc67c3?s=128&d=identicon&r=PG&f=1", "display_name": "Klemen", "link": "https://stackoverflow.com/users/3998658/klemen"}, "is_accepted": false, "score": 0, "last_activity_date": 1553721821, "creation_date": 1553721821, "answer_id": 55386664, "question_id": 55367915, "link": "https://stackoverflow.com/questions/55367915/how-to-pass-environment-variables-using-execle-for-bin-login/55386664#55386664", "title": "How to pass environment variables using execle() for /bin/login?", "body": "<p>Jonathan and Kurtis, thank you very much for your help and comments.</p>\n\n<p>I have found out that there is no problem with env when using \"-p\" and when\nuser shell is /bin/sh.\nBut when I tried using \"-p\" and user shell was klish (CLI utility) there were\nsome errors in sourcing some .sh files.</p>\n\n<p>So, I looked into BusyBox sources and in su.c it executes clearenv() if \"-p\"\nis not used.</p>\n\n<p>I have fixed that by passing it around and manually adding it into the env.\nSince this is not the best way to do it, I will have to do some more research\nabout my klish sourcing.</p>\n\n<p>Cheers.</p>\n\n<p>Thanks again.</p>\n"}], "owner": {"reputation": 59, "user_id": 3998658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/916cea4dc5f50ed00f2406999adc67c3?s=128&d=identicon&r=PG&f=1", "display_name": "Klemen", "link": "https://stackoverflow.com/users/3998658/klemen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1553721821, "creation_date": 1553645186, "question_id": 55367915, "link": "https://stackoverflow.com/questions/55367915/how-to-pass-environment-variables-using-execle-for-bin-login", "title": "How to pass environment variables using execle() for /bin/login?", "body": "<p>This is similar to <a href=\"https://stackoverflow.com/questions/43243305/how-to-set-environment-variable-when-execle-executes-bash/55367790?noredirect=1#comment97459162_55367790\">how to set environment variable when execle executes bash?</a></p>\n\n<p>I am trying to use execle() in C to perform /bin/login and pass the environment variable to target shell.\nAnd can not make it work.</p>\n\n<p>I have tried by passing environment as described in the man page, as a NULL terminated array of VAR=VAL strings.\nAlso I tried with putenv() before the call.</p>\n\n<p>For example:</p>\n\n<pre><code>const char *env[] = { \"MYVAR=myval\", (char *)0 };\nputenv(\"MYVAR=myval\");\nexecle(\"/bin/login\", \"login\", \"-p\", \"-f\", user, (char *)0, env);\n</code></pre>\n\n<p>After successful login I was expecting to see the MYVAR as an environment variable, but only have variables, like USER, HOME, SHELL, PATH etc.</p>\n\n<p>I have tried with BusyBox login and with tinylogin ... same result.</p>\n\n<p>Any help is highly appreciated.</p>\n"}, {"tags": ["c", "malloc", "legacy", "sbrk", "brk"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 1, "creation_date": 1553644906, "post_id": 55367809, "comment_id": 97459326, "body": "There is explenation right there in the text <code>For an application to use them correctly, it must depend on the malloc subsystem never being used, but this is impossible to guarantee since malloc may be used internally by libc functions without documenting this to the application.</code>. If your app calls sbrk and your app calls malloc and malloc calls sbrk and sbrk function uses global context, the result will be a mess. They want to eliminate the sbrk function, to make users not use it, not because it is a bad design per se."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1553648852, "post_id": 55367809, "comment_id": 97460116, "body": "What does &quot;global context&quot; mean? A quick Google search doesn&#39;t reveal anything."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1553669303, "post_id": 55367809, "comment_id": 97465013, "body": "<code>sbrk</code> usually operates on a single global variable, ex <code>__curbrk</code> in <a href=\"https://github.com/lattera/glibc/blob/master/misc/sbrk.c\" rel=\"nofollow noreferrer\">glibc</a> or <code>static char *heap_end;</code> in <a href=\"https://github.com/eblot/newlib/blob/master/libgloss/epiphany/sbrk.c\" rel=\"nofollow noreferrer\">newlib</a>. That means that all &quot;contexts&quot; (threads, functions, malloc, printf and user app) share the same (&quot;global&quot; to the process) data segment."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1553690357, "post_id": 55367809, "comment_id": 97476843, "body": "That&#39;s odd, my implementation just uses the return code from <code>syscall(SYS_brk, 0)</code>."}, {"owner": {"reputation": 22422, "user_id": 634919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f4a87fe094961af20263d8e7ff445b2?s=128&d=identicon&r=PG", "display_name": "Nate Eldredge", "link": "https://stackoverflow.com/users/634919/nate-eldredge"}, "edited": false, "score": 2, "creation_date": 1553694812, "post_id": 55367809, "comment_id": 97479983, "body": "My guess is that certain <code>malloc</code> implementations are written to assume that nobody else is calling <code>sbrk</code> behind their back.  For instance, suppose you call <code>p = malloc(N)</code> where N is some large number (maybe a multiple of page size).  malloc does <code>sbrk(N)</code> to get memory from the OS and returns this pointer to you.  Later (without any intervening calls to malloc) you do <code>free(p)</code>.  Now malloc &quot;knows&quot; that it can do <code>sbrk(-N)</code> to return the memory to the OS.  If you have called <code>sbrk</code> in between, then you have a problem."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1553695956, "post_id": 55367809, "comment_id": 97480799, "body": "Of an alternative which would be a lot safer is to <code>sbrk</code> a multiple of <code>N</code> and then implement a <code>free(...)</code> which only marks the memory as available for other uses. You really have a lot of control when you write a standard C library from scratch :)."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1553696302, "post_id": 55367809, "comment_id": 97481031, "body": "That would alleviate the possibility of an <code>sbrk</code> screwing anything up, because <code>malloc</code>&#39;s memory has already been allocated."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1553696711, "post_id": 55367809, "comment_id": 97481297, "body": "Then, of course, at the end of program execution all <code>free</code>d memory could be cleaned up and deallocated."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1553699515, "post_id": 55367809, "comment_id": 97483322, "body": "<a href=\"https://github.com/zyfjeff/C-HOW-TO/blob/master/c-malloc/Malloc_tutorial.pdf\" rel=\"nofollow noreferrer\">awkwardly written, but good basic malloc introduction</a> for writing your own memory manager with <code>brk&#47;sbrk</code> (intro level only)"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1553700931, "post_id": 55367809, "comment_id": 97484322, "body": "Thanks, I&#39;ll look into it."}], "answers": [{"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1553699863, "post_id": 55380448, "comment_id": 97483582, "body": "That&#39;s about as good an explanation I&#39;ve seen. Don&#39;t mix <code>malloc</code> with your owns calls to <code>brk&#47;sbrk</code>. I think you are right. If <code>malloc</code> can&#39;t find the break where it left it, then it likely won&#39;t release any of the memory it originally allocated. I haven&#39;t looked at the <code>malloc</code> source, but that makes sense."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1553701219, "post_id": 55380448, "comment_id": 97484507, "body": "This is definitely a better explanation than I&#39;ve seen so far. However, it begs the question: If I can make <code>malloc()</code> and <code>free()</code> check for program break changes, is it possible to safely use <code>sbrk()</code> and <code>brk()</code> with my C library? I&#39;ll also give you a +1 for mentioning threads. I haven&#39;t implemented them yet, so I hadn&#39;t thought about it. Thanks!"}], "tags": [], "owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "is_accepted": true, "score": 5, "last_activity_date": 1553704221, "last_edit_date": 1553704221, "creation_date": 1553699129, "answer_id": 55380448, "question_id": 55367809, "link": "https://stackoverflow.com/questions/55367809/whats-unsafe-legacy-about-brk-sbrk/55380448#55380448", "title": "What&#39;s unsafe/legacy about brk/sbrk?", "body": "<p>The reality highly depends on the implementation but here are some elements:</p>\n\n<h3>unsafe</h3>\n\n<p><code>brk</code>/<code>sbrk</code> were invented to allow a process to request more memory from the system, and release it in a single contiguous segment. As such, they were used by many <code>malloc</code> and <code>free</code> implementations. The problem was that, as it returned a unique segment, things would go wrong as multiple modules (of the same process) use it directly. It became even worse in a multi-threaded process because of race conditions. Suppose 2 threads want to add new memory. They will look at the current top address with <code>sbrk(0)</code>, see the same address, request new memory with either <code>brk</code> or <code>sbrk</code>, and because of the race condition, will both use the same memory.</p>\n\n<p>Even in a single threaded process, some <code>malloc</code> and <code>free</code> implementations assume that they only are allowed to use the low level <code>s/brk</code> interface, and that any other code should use them. In that case things will go wrong if the image of the break segment that they internally maintain is no longer the assumed value. They should have to guess that some parts of the segment are \"reserved\" for other uses, possibly breaking the ability to release any memory.</p>\n\n<p>For that reason, user code should never directly use <code>brk</code>/<code>sbrk</code> and only rely on <code>malloc</code>/<code>free</code>. If, and only if, you are writing an implementation of the standard library including <code>malloc</code>/<code>realloc</code>/<code>calloc</code>/<code>free</code>, you can safely use <code>brk</code>/<code>sbrk</code></p>\n\n<h3>legacy</h3>\n\n<p>On modern system, <code>mmap</code> can make a much nicer usage of virtual memory management. You can use as many dynamic memory segments as you need with no interaction between them. So, on a modern system, unless you have a specific need for memory allocation using <code>brk</code>/<code>sbrk</code>, you should use <code>mmap</code>.</p>\n\n<h3>portability</h3>\n\n<p>The FreeBSD reference for <code>brk</code> and <code>sbrk</code> states this:</p>\n\n<blockquote>\n  <p>The brk() and sbrk() functions are legacy interfaces from before the\n    advent of modern virtual memory management.</p>\n</blockquote>\n\n<p>and later:</p>\n\n<blockquote>\n  <p>BUGS:\n    Mixing brk() or sbrk() with malloc(3), free(3), or similar functions will\n    result in non-portable program behavior.</p>\n</blockquote>\n"}], "owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 708, "favorite_count": 1, "accepted_answer_id": 55380448, "answer_count": 1, "score": 9, "last_activity_date": 1553704221, "creation_date": 1553644242, "last_edit_date": 1553690524, "question_id": 55367809, "link": "https://stackoverflow.com/questions/55367809/whats-unsafe-legacy-about-brk-sbrk", "title": "What&#39;s unsafe/legacy about brk/sbrk?", "body": "<p>I've heard in a lot of places (musl mailing list, macOS forums, etc.) that <code>brk()</code> and <code>sbrk()</code> are unsafe. Many of these places either don't give explanations at all, or give very vague explanations. For example, <a href=\"https://www.openwall.com/lists/musl/2013/12/21/1\" rel=\"nofollow noreferrer\">this</a> link states that \"these functions are fundamentally broken\", and goes on to say that the <code>malloc</code> and <code>sbrk</code> subsystems are utterly broken, that they ruin the heap, et al.</p>\n\n<p>My question is: Why is this so? If <code>malloc</code> is used in such a way that it allocates a block of memory with <code>sbrk</code> large enough to quell or substantially decrease the need for further allocations, then shouldn't <code>sbrk</code> and <code>brk</code> be perfectly safe to use?</p>\n\n<p>Here are my implementations of <code>sbrk</code> and <code>brk</code>:</p>\n\n<p><code>sbrk</code>:</p>\n\n<pre><code>#include &lt;unistd.h&gt;\n#include &lt;stddef.h&gt;\n\nvoid *sbrk(intptr_t inc)\n{\n        intptr_t curbrk = syscall(SYS_brk, NULL);\n\n        if( inc == 0 ) goto ret;\n\n        if( curbrk &lt; 0 ) return (void *)-1;\n\n        curbrk((void *)(curbrk+inc));\nret:\n        return (void *)curbrk;\n}\n</code></pre>\n\n<p><code>brk</code>:</p>\n\n<pre><code>#include &lt;unistd.h&gt;\n\nintptr_t brk(void *ptr)\n{\n        if( (void *)syscall(SYS_brk, ptr) != ptr )\n                return -1;\n        else\n                return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "pthreads"], "comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1553644379, "post_id": 55367792, "comment_id": 97459192, "body": "Have you ever heard of race conditions? Google it."}, {"owner": {"reputation": 864, "user_id": 9609025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a028356e4549baeabab70bc969af80a8?s=128&d=identicon&r=PG&f=1", "display_name": "mackycheese21", "link": "https://stackoverflow.com/users/9609025/mackycheese21"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1553644440, "post_id": 55367792, "comment_id": 97459217, "body": "I don&#39;t care about order of thread execution, and there are no side-effects other than printing to the console."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1553644827, "post_id": 55367792, "comment_id": 97459308, "body": "Yes, but <code>pthread.threadNum</code> is being changed every time the program executes. Try commenting out <code>pthread_exit</code> and try again. Sadly, I&#39;m not very experienced in threads either."}], "answers": [{"comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1553645636, "post_id": 55367936, "comment_id": 97459479, "body": "Your implementation is still a race condition, now between <code>free</code> and <code>thread_func</code>. Move <code>free</code> to <code>thread_func</code>. The usage of <code>volatile</code> is unjustified here. Why would you choose to not optimize the accesses to <code>thread_args</code>?"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553663797, "post_id": 55367936, "comment_id": 97463168, "body": "Now you&#39;re leaking like a sieve.  Create an array <code>thread_args args[20];</code> (outside the loop) and initialize each thread argument and pass it.  You also don&#39;t keep track of the threads and join with them \u2014 though that&#39;s also a problem with the code in the question."}, {"owner": {"reputation": 798, "user_id": 4807393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EXDvV.png?s=128&g=1", "display_name": "NoOneIsHere", "link": "https://stackoverflow.com/users/4807393/nooneishere"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553705938, "post_id": 55367936, "comment_id": 97487422, "body": "@JonathanLeffler true. I just thought that freeing the data when it wasn&#39;t needed would work, but it seems it still leaks."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553706565, "post_id": 55367936, "comment_id": 97487759, "body": "I admit I missed the <code>free()</code> in the thread function; I normally expect the code that allocates to manage the freeing too (so I wasn&#39;t looking for it).  You comment about &quot;I though it would work, but it seems it still leaks&quot;.  That&#39;s a little surprising.  However, this might be because you use <code>pthread_exit()</code> in the <code>main()</code> function instead of <code>pthread_join()</code> \u2014 I&#39;d need to study what&#39;s supposed to happen.  The <code>(void *)</code> cast in the call to <code>pthread_create()</code> isn&#39;t needed \u2014 the compiler will convert any pointer to a void pointer to match a function prototype without further prompting."}, {"owner": {"reputation": 798, "user_id": 4807393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EXDvV.png?s=128&g=1", "display_name": "NoOneIsHere", "link": "https://stackoverflow.com/users/4807393/nooneishere"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1553707038, "post_id": 55367936, "comment_id": 97488012, "body": "@JonathanLeffler I tried to change the original as little as possible, so the leak can&#39;t really be managed. I&#39;ll add more details."}, {"owner": {"reputation": 4747, "user_id": 611560, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/25ee461bdf2849f6db82054c73192ea1?s=128&d=identicon&r=PG", "display_name": "Yann Droneaud", "link": "https://stackoverflow.com/users/611560/yann-droneaud"}, "edited": false, "score": 0, "creation_date": 1553708078, "post_id": 55367936, "comment_id": 97488553, "body": "threads must be joined for resources such as stack to be released."}, {"owner": {"reputation": 798, "user_id": 4807393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EXDvV.png?s=128&g=1", "display_name": "NoOneIsHere", "link": "https://stackoverflow.com/users/4807393/nooneishere"}, "reply_to_user": {"reputation": 4747, "user_id": 611560, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/25ee461bdf2849f6db82054c73192ea1?s=128&d=identicon&r=PG", "display_name": "Yann Droneaud", "link": "https://stackoverflow.com/users/611560/yann-droneaud"}, "edited": false, "score": 0, "creation_date": 1553708692, "post_id": 55367936, "comment_id": 97488908, "body": "@YannDroneaud I&#39;m aware, but the original code doesn&#39;t join the threads either."}, {"owner": {"reputation": 4747, "user_id": 611560, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/25ee461bdf2849f6db82054c73192ea1?s=128&d=identicon&r=PG", "display_name": "Yann Droneaud", "link": "https://stackoverflow.com/users/611560/yann-droneaud"}, "edited": false, "score": 0, "creation_date": 1553708888, "post_id": 55367936, "comment_id": 97489018, "body": "But it&#39;s needed to remove the leak you&#39;re complaining about: &quot;but it seems it still leaks.&quot;"}, {"owner": {"reputation": 798, "user_id": 4807393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EXDvV.png?s=128&g=1", "display_name": "NoOneIsHere", "link": "https://stackoverflow.com/users/4807393/nooneishere"}, "reply_to_user": {"reputation": 4747, "user_id": 611560, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/25ee461bdf2849f6db82054c73192ea1?s=128&d=identicon&r=PG", "display_name": "Yann Droneaud", "link": "https://stackoverflow.com/users/611560/yann-droneaud"}, "edited": false, "score": 0, "creation_date": 1553713258, "post_id": 55367936, "comment_id": 97491265, "body": "@YannDroneaud I know that. I just don&#39;t want to change things unnecessary to the original problem."}], "tags": [], "owner": {"reputation": 798, "user_id": 4807393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EXDvV.png?s=128&g=1", "display_name": "NoOneIsHere", "link": "https://stackoverflow.com/users/4807393/nooneishere"}, "is_accepted": true, "score": 1, "last_activity_date": 1553707069, "last_edit_date": 1553707069, "creation_date": 1553645351, "answer_id": 55367936, "question_id": 55367792, "link": "https://stackoverflow.com/questions/55367792/c-pthread-h-pass-local-variables-to-thread-is-broken/55367936#55367936", "title": "C &lt;pthread.h&gt; pass local variables to thread is broken", "body": "<p>This is, in fact, a race condition. You pass a <code>void</code> <em>pointer</em> to the argument struct, but (likely) the same memory address is reused for each argument struct. Therefore, when you later access it, you are likely to read modified memory. Try this:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;stdlib.h&gt;\ntypedef struct {\n    int threadNum;\n}thread_args;\n\nvoid thread_func(void* vargp){\n    thread_args* id = (thread_args*)vargp;\n    printf(\"%i\\n\", id-&gt;threadNum);\n\n    free(vargp);\n}\n\nint main() {\n    for(int i=0;i&lt;20;i++) {\n        pthread_t id;\n        thread_args* args = malloc(sizeof(thread_args));\n        args-&gt;threadNum = i;\n        pthread_create(&amp;id, NULL, thread_func, (void*)args);\n    }\n    pthread_exit(NULL);\n    return 0;\n}\n</code></pre>\n\n<p>Thanks to <a href=\"https://stackoverflow.com/users/9072753/kamil-cuk\">Kamil Cuk</a> for pointing out another race condition.</p>\n\n<p>Note that this snippet might still leak because the code never joins the threads, so the <code>free()</code> might never be called.</p>\n"}, {"comments": [{"owner": {"reputation": 798, "user_id": 4807393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EXDvV.png?s=128&g=1", "display_name": "NoOneIsHere", "link": "https://stackoverflow.com/users/4807393/nooneishere"}, "edited": false, "score": 1, "creation_date": 1553645668, "post_id": 55367962, "comment_id": 97459486, "body": "<code>malloc</code> + <code>free</code> avoids storing all the args all the time."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 798, "user_id": 4807393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EXDvV.png?s=128&g=1", "display_name": "NoOneIsHere", "link": "https://stackoverflow.com/users/4807393/nooneishere"}, "edited": false, "score": 0, "creation_date": 1553664001, "post_id": 55367962, "comment_id": 97463225, "body": "@NoOneIsHere \u2014 using <code>malloc()</code> + <code>free()</code> gives problems unless you keep a track of all the allocated pointers and only free them after you know that the thread using it has ended \u2014 which is worse than using an array of <code>thread_args</code>.  Using <code>malloc()</code> without <code>free()</code> leaks, but that&#39;s moderately safe in the context of a tiny program like this, but hardly for long-running production threaded code."}, {"owner": {"reputation": 864, "user_id": 9609025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a028356e4549baeabab70bc969af80a8?s=128&d=identicon&r=PG&f=1", "display_name": "mackycheese21", "link": "https://stackoverflow.com/users/9609025/mackycheese21"}, "edited": false, "score": 0, "creation_date": 1553699968, "post_id": 55367962, "comment_id": 97483653, "body": "What&#39;s a UB?  I haven&#39;t seen that acronym before."}, {"owner": {"reputation": 8570, "user_id": 2293156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/800e791e8e13500e516c9ae77299160a?s=128&d=identicon&r=PG", "display_name": "Amadeus", "link": "https://stackoverflow.com/users/2293156/amadeus"}, "reply_to_user": {"reputation": 864, "user_id": 9609025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a028356e4549baeabab70bc969af80a8?s=128&d=identicon&r=PG&f=1", "display_name": "mackycheese21", "link": "https://stackoverflow.com/users/9609025/mackycheese21"}, "edited": false, "score": 0, "creation_date": 1553703620, "post_id": 55367962, "comment_id": 97486081, "body": "@mackycheese21 sorry, I guess this a terminlogy for C++ (<a href=\"https://stackoverflow.com/questions/2766731/what-exactly-do-ib-and-ub-mean\" title=\"what exactly do ib and ub mean\">stackoverflow.com/questions/2766731/&hellip;</a>), it means undefined behaviour, I guess the correct name here would be data race"}, {"owner": {"reputation": 4747, "user_id": 611560, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/25ee461bdf2849f6db82054c73192ea1?s=128&d=identicon&r=PG", "display_name": "Yann Droneaud", "link": "https://stackoverflow.com/users/611560/yann-droneaud"}, "edited": false, "score": 0, "creation_date": 1553707956, "post_id": 55367962, "comment_id": 97488473, "body": "This answer is still incorrect: as &quot;main&quot; thread exit, one should assume its stack disappear with it, hence <code>args[]</code> became undefined. To address this issue, other threads must be joined from &quot;main&quot; thread with <code>pthread_join()</code> before leaving."}, {"owner": {"reputation": 8570, "user_id": 2293156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/800e791e8e13500e516c9ae77299160a?s=128&d=identicon&r=PG", "display_name": "Amadeus", "link": "https://stackoverflow.com/users/2293156/amadeus"}, "reply_to_user": {"reputation": 4747, "user_id": 611560, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/25ee461bdf2849f6db82054c73192ea1?s=128&d=identicon&r=PG", "display_name": "Yann Droneaud", "link": "https://stackoverflow.com/users/611560/yann-droneaud"}, "edited": false, "score": 1, "creation_date": 1553709353, "post_id": 55367962, "comment_id": 97489251, "body": "@YannDroneaud I had put the original answer to solve the immediate problem that was the one of deallocating a block of memory that was in use, without looking for the rest of the program, but you are right, to be correct it is necessary to wait for the other threads to finish before finishing the main thread. I&#39;ve changed it for take account of this. Thanks for the comment"}], "tags": [], "owner": {"reputation": 8570, "user_id": 2293156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/800e791e8e13500e516c9ae77299160a?s=128&d=identicon&r=PG", "display_name": "Amadeus", "link": "https://stackoverflow.com/users/2293156/amadeus"}, "is_accepted": false, "score": 4, "last_activity_date": 1553709233, "last_edit_date": 1553709233, "creation_date": 1553645583, "answer_id": 55367962, "question_id": 55367792, "link": "https://stackoverflow.com/questions/55367792/c-pthread-h-pass-local-variables-to-thread-is-broken/55367962#55367962", "title": "C &lt;pthread.h&gt; pass local variables to thread is broken", "body": "<p>You are having an UB at your for loop. You are creating an variable called <code>args</code>, where you assign a value to it, pass as reference to your thread, for later execution, and destroy it at the end of your for loop. Then you do it again, possibling overwritting this region.</p>\n\n<p>To solve that problem, I suggest this modification:</p>\n\n<pre><code>int main() {\n    thread_args args[20] = {0};\n    pthread_t id[20] = {0};\n\n    for(int i=0;i&lt;20;i++) {\n        args[i].threadNum=i;\n        pthread_create(&amp;id[i],NULL,thread_func,(void*)&amp;args[i]);\n    }\n\n    for(int i = 0; i &lt; 20; i++)\n        pthread_join(id[i], NULL);\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 864, "user_id": 9609025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a028356e4549baeabab70bc969af80a8?s=128&d=identicon&r=PG&f=1", "display_name": "mackycheese21", "link": "https://stackoverflow.com/users/9609025/mackycheese21"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 55367936, "answer_count": 2, "score": 1, "last_activity_date": 1553709233, "creation_date": 1553644166, "question_id": 55367792, "link": "https://stackoverflow.com/questions/55367792/c-pthread-h-pass-local-variables-to-thread-is-broken", "title": "C &lt;pthread.h&gt; pass local variables to thread is broken", "body": "<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\n\ntypedef struct {\n    int threadNum;\n}thread_args;\n\nvoid thread_func(void*vargp){\n    thread_args*id=(thread_args*)vargp;\n    printf(\"%i\\n\",id-&gt;threadNum);\n}\n\nint main() {\n    for(int i=0;i&lt;20;i++) {\n        pthread_t id;\n        thread_args args;\n        args.threadNum=i;\n        pthread_create(&amp;id,NULL,thread_func,(void*)&amp;args);\n    }\n    pthread_exit(NULL);\n    return 0;\n}\n</code></pre>\n\n<p>Adapted from <a href=\"https://www.geeksforgeeks.org/multithreading-c-2/\" rel=\"nofollow noreferrer\">https://www.geeksforgeeks.org/multithreading-c-2/</a>.</p>\n\n<p>So this is expected to output:</p>\n\n<pre><code>0\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n</code></pre>\n\n<p>But shuffled in a random order to account for the concurrency of the threads.</p>\n\n<p>The issue here is that it <em>actually</em> prints out this:</p>\n\n<pre><code>4\n9\n10\n5\n11\n12\n13\n8\n4\n4\n17\n6\n18\n7\n15\n19\n6\n14\n19\n16\n</code></pre>\n\n<p>As you can see, there are duplicate numbers and 0-3 are just plain skipped.</p>\n\n<p>I have done concurrency before in other frameworks before, and I have seen similar issues:  what is happening here is that the <code>i</code> is being passed as a reference (I think!) and so when the <code>for</code> loop increments <code>i</code>, it is incremented in all thread argument variables.</p>\n\n<p>How can I avoid this?</p>\n\n<p>NOTE: Everything is linking 100% properly and I'm on macOS.</p>\n\n<p>PS: Sorry if this is a duplicate, I'm not very experienced with this.</p>\n"}, {"tags": ["c", "pointers", "memory-management"], "comments": [{"owner": {"reputation": 27279, "user_id": 857132, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4fd51ed5980999c7c6ce3729d6cb2184?s=128&d=identicon&r=PG", "display_name": "John3136", "link": "https://stackoverflow.com/users/857132/john3136"}, "edited": false, "score": 2, "creation_date": 1553641589, "post_id": 55367423, "comment_id": 97458491, "body": "The compiler is always right. The compiler gave you a warning. You ignored it and look what happened. The warning is actually pretty obvious and something most C programmer will recognise..."}, {"owner": {"reputation": 67098, "user_id": 1235698, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90fd9ad4efef8eb93209f42183c48f3e?s=128&d=identicon&r=PG", "display_name": "Marcin Orlowski", "link": "https://stackoverflow.com/users/1235698/marcin-orlowski"}, "edited": false, "score": 1, "creation_date": 1553641634, "post_id": 55367423, "comment_id": 97458501, "body": "I strongly suggest you go thru any basic c tutorial about pointers and references."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 2, "creation_date": 1553641647, "post_id": 55367423, "comment_id": 97458506, "body": "<code>50</code> is probably not a good (hard coded) pointer value. Please try <code>int a = 50; int *b = &amp;a; ...</code>"}, {"owner": {"reputation": 1, "user_id": 11260946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7344331a406c30233001a93d4b17d71?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/11260946/john-doe"}, "edited": false, "score": 0, "creation_date": 1553642033, "post_id": 55367423, "comment_id": 97458604, "body": "I think I get some value from memory, something like leak."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 2, "creation_date": 1553642146, "post_id": 55367423, "comment_id": 97458639, "body": "You have tried to read memory address <code>50</code> which probably does not belong to you, hence the segfault. The compiler objected because <code>50</code> is an integer value, not a pointer value, hence the warning."}, {"owner": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "edited": false, "score": 0, "creation_date": 1553642193, "post_id": 55367423, "comment_id": 97458655, "body": "Listen to Weather Vane - that will fix your issue.   You cannot assign 50 to b as you have written it.  b is expecting the address of another integer not an integer value itself."}], "answers": [{"tags": [], "owner": {"reputation": 25937, "user_id": 338904, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/dea29233fa03ea84f8a853102deb0344?s=128&d=identicon&r=PG", "display_name": "e2-e4", "link": "https://stackoverflow.com/users/338904/e2-e4"}, "is_accepted": false, "score": 1, "last_activity_date": 1553644881, "last_edit_date": 1553644881, "creation_date": 1553643824, "answer_id": 55367747, "question_id": 55367423, "link": "https://stackoverflow.com/questions/55367423/gcc-error-bad-code-or-gcc-is-good-compiler/55367747#55367747", "title": "GCC error, bad code or gcc is good compiler", "body": "<p>Assuming you are running the program on a recent OS like Linux, Mac or Windows, 50 will no be the bytes located at the address 50 in your physical memory ; that's an address in a virtual space. </p>\n\n<p>Then your process (program) has only access to a very limited range in that virtual space, which 50 is unlikely to be from ; in that case the OS protects the illegal access and stops your process (segfault) ; anyway you could even get a result that may or may not be the correct one, this is called <em>undefined behavior</em>, and you better not rely in this case on a apparently working executable.</p>\n\n<p>To access directly the physical memory, you either need to build a kernel module, or boot from a DOS-like OS, for instance.</p>\n\n<blockquote>\n  <p>main.c:6:7: warning: assignment makes pointer from integer without a cast [-Wint-conversion]</p>\n</blockquote>\n\n<p>This being said, you need to cast <code>50</code> as a <code>int *</code> to clear the warning.</p>\n\n<pre><code>b = (int *)50;\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11260946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7344331a406c30233001a93d4b17d71?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/11260946/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1553644881, "creation_date": 1553641411, "question_id": 55367423, "link": "https://stackoverflow.com/questions/55367423/gcc-error-bad-code-or-gcc-is-good-compiler", "title": "GCC error, bad code or gcc is good compiler", "body": "<p>I have this code:</p>\n\n<pre><code>int *b;\nb = 50;\nprintf(\"Pointer point to address: %p and also point to this value: %d\", b, *b);\nreturn 0\n</code></pre>\n\n<p>I got this error:\nmain.c:6:7: warning: assignment makes pointer from integer without a cast [-Wint-conversion]\n<br>\ntimeout: the monitored command dumped core\n<br>\nsh: line 1: 47524 Segmentation fault      timeout 10s main</p>\n\n<p>I wanna print value from fifty byte of memory.</p>\n\n<p><strong>Is my code right or will compiler do it work.</strong></p>\n"}, {"tags": ["c", "arrays", "console-application", "doubly-linked-list"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1553641949, "post_id": 55367328, "comment_id": 97458578, "body": "The user enters an alphabetical char for <code>%d</code>? You haven&#39;t checked the return value from any of the <code>scanf</code>s? It will remain in the buffer until you remove it. It is easier to get an input string with <code>fgets</code> and apply <code>sscanf</code> and then if the input tests fail (including the absent but essential &quot;number of items scanned&quot; check), just input another string."}, {"owner": {"reputation": 139, "user_id": 6831912, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/ibv29.jpg?s=128&g=1", "display_name": "ESuth", "link": "https://stackoverflow.com/users/6831912/esuth"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1553643286, "post_id": 55367328, "comment_id": 97458928, "body": "I&#39;ve managed to get it to stop looping by using fgets. But after I have decided not to undo a move made by entering a key that isnt the one it asks for. When I get to the next part that asks me to enter the place number i want to play again, it comes up with the error about it not being a number one time then allows me to continue. So it works but gives me one small error for some reason as if it is accepting the enter key on the turn selection"}], "answers": [{"tags": [], "owner": {"reputation": 47115, "user_id": 235354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/097d761861529df52a6800744f1074d2?s=128&d=identicon&r=PG", "display_name": "jspcal", "link": "https://stackoverflow.com/users/235354/jspcal"}, "is_accepted": false, "score": 1, "last_activity_date": 1553641936, "creation_date": 1553641936, "answer_id": 55367505, "question_id": 55367328, "link": "https://stackoverflow.com/questions/55367328/tic-tac-toe-user-input-looping-endlessly-when-alphabetical-character-entered/55367505#55367505", "title": "Tic-Tac-Toe user input looping endlessly when alphabetical character entered", "body": "<p>Input that doesn't match your format doesn't get consumed by <code>scanf</code>. It remains in the input stream. So when you type a letter it fails to match the number you wanted <code>%d</code> and stays in the input stream.</p>\n\n<pre><code>scanf(\"%d%c\", &amp;userInput, &amp;term);\n</code></pre>\n\n<p>Instead of <code>scanf</code>, it would be simpler to use <code>getline</code> to consume the entire line of input. And then parse the result with <code>sscanf</code> (the string-based version of the function) or another method.</p>\n\n<pre><code>char *line = NULL;\nsize_t len = 0;\n\nwhile ((read = getline(&amp;line, &amp;len, stdin)) != -1) {\n    // Do something with line\n\n    int scanned = sscanf(line, \"%d%c\", &amp;userInput);\n\n    if (scanned == EOF || scanned != 2) {\n        printf(\"Line failed to match\\n\");\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1856, "user_id": 6607497, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/f0a0b03f5bbd44186399f4b0aea38049?s=128&d=identicon&r=PG&f=1", "display_name": "U. Windl", "link": "https://stackoverflow.com/users/6607497/u-windl"}, "is_accepted": false, "score": 1, "last_activity_date": 1553641965, "creation_date": 1553641965, "answer_id": 55367511, "question_id": 55367328, "link": "https://stackoverflow.com/questions/55367328/tic-tac-toe-user-input-looping-endlessly-when-alphabetical-character-entered/55367511#55367511", "title": "Tic-Tac-Toe user input looping endlessly when alphabetical character entered", "body": "<p>Just read the manual page:</p>\n\n<pre><code>   The  format  string consists of a sequence of directives which describe\n   how to process the sequence of input characters.  If  processing  of  a\n   directive  fails,  no  further  input  is read, and scanf() returns.  A\n   \"failure\" can be either of the following: input failure,  meaning  that\n   input  characters  were  unavailable, or matching failure, meaning that\n   the input was inappropriate (see below).\n</code></pre>\n\n<p>You do not check the return value of <code>scanf()</code>. So you try to scan the same non-digit as digit all the time.</p>\n"}], "owner": {"reputation": 139, "user_id": 6831912, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/ibv29.jpg?s=128&g=1", "display_name": "ESuth", "link": "https://stackoverflow.com/users/6831912/esuth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1554152217, "creation_date": 1553640758, "last_edit_date": 1554152217, "question_id": 55367328, "link": "https://stackoverflow.com/questions/55367328/tic-tac-toe-user-input-looping-endlessly-when-alphabetical-character-entered", "title": "Tic-Tac-Toe user input looping endlessly when alphabetical character entered", "body": "<p>So I am making a tic tac toe game in C and I am having a problem where I am asking the user to undo their move by pressing 2. Each time it is their turn, they can either undo a move or continue to select there next turn by selecting another key.</p>\n\n<p>It works how it should but I have a problem where if the user enters an alphabetical character, the program just repeatedly loops through saying that this is not a number when it checks my <code>GetHumanMove</code> function. Does anyone know how to make it stop doing this and just say this is not a number once without it looping the program?</p>\n\n<p>Here's my code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;conio.h&gt;\n#include &lt;windows.h&gt;\n\n//Tic-Tac-Toe game in C\n//20/03/2019\n//5x5 Board with 4 in a row to win. Also has playable AI that randomly blocks human moves. \n//Also has replay function using a doubly linked list\n\n/*\nint board[49] = {\n    ;,;, ;, ;, ;, ;, ;,\n    ;,1, 2, 3, 4, 5 ,;,\n    ;,6, 7, 8, 9, 10,;,\n    ;,11,12,13,14,15,;,\n    ;,16,17,18,19,20,;,\n    ;,21,22,23,24,25,;,\n    ;,;, ;, ;, ;, ;, ;,\n}\n*/\n\nstruct node\n{\n    int side;\n    int move;\n    int place;\n    struct node * prev;\n    struct node * next;\n};\n\nvoid append(struct node **, int, int, int);\nvoid display(struct node *);\nvoid delete(struct node **, int);\n\n//Constants of pieces, border and empty places\nenum { NOUGHTS, CROSSES, BORDER, EMPTY };\n//Constants for human/computer win or draw\nenum { HUMANWIN, COMPWIN, DRAW };\n\nconst int directions[4] = { 1, 7, 6, 8 };\n\nint moveCount = 0;\n\n//Values of original places to play\nconst int ConvertTo49[25] = {\n    8, 9, 10,11,12,\n    15,16,17,18,19,\n    22,23,24,25,26,\n    29,30,31,32,33,\n    36,37,38,39,40\n};\n\nvoid append(struct node ** list, int side, int move, int place)\n{\n    struct node *temp , *current = *list;\n\n    if(*list == NULL)\n    {\n        *list = (struct node *) malloc(sizeof(struct node));\n        (*list) -&gt; prev = NULL;\n        (*list) -&gt; side = side;\n        (*list) -&gt; move = move;\n        (*list) -&gt; place = place;\n        (*list) -&gt; next = NULL;\n    }\n    else\n    {\n        while(current -&gt; next != NULL)\n            current = current -&gt; next;\n\n        temp = (struct node *) malloc(sizeof(struct node));\n        temp -&gt; side = side;\n        temp -&gt; move = move;\n        temp -&gt; place = place;\n        temp -&gt; next = NULL;\n        temp -&gt; prev = current;\n        current -&gt; next = temp;\n    }\n}\n\nvoid delete(struct node ** list, int num)\n{\n    struct node *temp = *list;\n\n    while(temp != NULL)\n    {\n        if(temp -&gt; move == num)\n        {\n            if(temp == *list)\n            {\n                *list = (*list) -&gt; next;\n                (*list) -&gt; prev = NULL;\n            }\n            else\n            {\n                if(temp -&gt; next == NULL)\n                    temp -&gt; prev -&gt; next = NULL;\n                else\n                {\n                    temp -&gt; prev -&gt; next = temp -&gt; next;\n                    temp -&gt; next -&gt; prev = temp -&gt; prev;\n                }\n                free(temp);\n            }\n            return ;\n        }\n        temp = temp -&gt; next;\n    }\n    printf(\"Element %d not found in the supplied list \\n\\n\", num);\n}\n\n//Loop through a direction until a border square is hit\nint GetNumForDir(int startSq, const int dir, const int *board, const int us)\n{\n    int found = 0;\n\n    while(board[startSq] != BORDER)\n    {\n        if(board[startSq] != us)\n        {\n            break;\n        }\n        found++;\n        startSq += dir;\n    }\n    return found;\n}\n\n//Loop through directions and find four in a row\nint FindFourInARow(const int *board, const int ourIndex, const int us)\n{\n    int dirIndex = 0;\n    int dir = 0;\n    int countFour = 1;\n\n    for(dirIndex = 0; dirIndex &lt; 4; ++dirIndex)\n    {\n        dir = directions[dirIndex];\n        countFour += GetNumForDir(ourIndex + dir, dir, board, us);\n        countFour += GetNumForDir(ourIndex + dir * -1, dir * -1, board, us);\n        if(countFour == 4)\n        {\n            break;\n        }\n        countFour = 1;\n    }\n    return countFour;\n}\n\n//Set up board structure\nvoid InitialiseBoard(int *board)\n{\n    //index variable\n    int index;\n\n    //set whole board to border squares initially\n    for(index = 0; index &lt; 49; ++index)\n    {\n        board[index] = BORDER;\n    }\n\n    //Set up empty squares for placing pieces\n    for(index = 0; index &lt; 25; ++index)\n    {\n        board[ConvertTo49[index]] = EMPTY;\n    }\n}\n\n//Print the board\nvoid PrintBoard(const int *board)\n{\n    //index variable\n    int index;\n\n    //Set pieces and places\n    char pceChars[] = \"OX| \";\n\n    printf(\"\\n\\n\\n\");\n\n    //Loop through and only draw the actual playable squares, leaving out the border squares\n    for(index = 0; index &lt; 25; ++index)\n    {\n        //Put lines inbetween places\n        if(index==1 || index==2 || index==3 || index==4 ||\n           index==6 || index==7 || index==8 || index==9 ||\n           index==11 || index==12 || index==13 || index==14 ||\n           index==16 || index==17 || index==18 || index==19 ||\n           index==21 || index==22 || index==23 || index==24)\n        {\n            printf(\" |\");\n        }\n\n        //Put space at start to space out board from edge of screen\n        if(index==0)\n        {\n            printf(\"        \");\n        }\n\n        //Print new line every 5 places\n        if(index!= 0 &amp;&amp; index==5 || index==10 || index==15 || index==20)\n        {\n            printf(\"\\n\");\n            printf(\"        -------------------\");\n            printf(\"\\n\");\n            printf(\"        \");\n        }\n\n        //Print each playable piece\n        printf(\" %c\", pceChars[board[ConvertTo49[index]]]);     \n    }\n    printf(\"\\n\\n\");\n}\n\n//Check if board has empty spaces\nint HasEmpty(const int *board)\n{\n    int index;\n\n    for(index = 0; index &lt; 25; ++index)\n    {\n        if(board[ConvertTo49[index]] == EMPTY) return 1;\n    }\n\n    return 0;\n}\n\n//Function for making move of current player\nvoid MakeMove(int *board, const int sq, const side)\n{   \n    //set board place that either player decides\n    board[sq] = side;   \n}\n\nvoid UndoMove(int *board, int sq, int side)\n{   \n    //set board place that either player decides\n    board[sq] = side;   \n}\n\n\n//Help the computer find a winning move\nint GetWinningMove(int *board, const int side)\n{\n    int ourMove = -1;\n    int winFound = 0;\n    int index = 0;\n\n    for(index = 0; index &lt; 25; ++index)\n    {\n        if(board[ConvertTo49[index]] == EMPTY)\n        {\n            ourMove = ConvertTo49[index];\n            board[ourMove] = side;\n\n            if(FindFourInARow(board, ourMove, side) == 4)\n            {\n                winFound = 1;\n            }\n            board[ourMove] = EMPTY;\n            if(winFound == 1)\n            {\n                return ourMove;\n            }\n            ourMove = -1;\n        };\n    }\n    return ourMove;\n}\n\n//Get computer player move\nint GetComputerMove(int *board, const int side)\n{\n    int index;\n    int numFree = 0;\n    int availableMoves[25];\n    int randMove = 0;\n\n    //Set random number to randomly run a function\n    int randFunction = 0;\n    randFunction = (rand() % 2);\n\n    //Go for the winning move\n    randMove = GetWinningMove(board, side);\n    if(randMove != -1)\n    {\n        return randMove;\n    }\n\n    //If random function is 1, stop any winning move from the human\n    if(randFunction == 1)\n    {\n        randMove = GetWinningMove(board, side ^ 1);\n        if(randMove != -1)\n        {\n            return randMove;\n        }\n    }\n\n    randMove = 0;\n    //Loop through all squares and put piece in random place\n    for(index = 0; index &lt; 25; ++index)\n    {\n        if(board[ConvertTo49[index]] == EMPTY)\n        {\n            availableMoves[numFree++] = ConvertTo49[index];\n        };\n    }\n\n    randMove = (rand() % numFree);\n    return availableMoves[randMove];\n}\n\n\n//Get human player move\nint GetHumanMove(const int *board)\n{\n    //Array for user input\n    int userInput;\n    char term;\n    //Start moveOK at 0\n    int moveOK = 0;\n    int move = -1;\n\n    //Loop through until move being made is valid\n    while(moveOK == 0)\n    {\n\n        printf(\"\\n\");\n\n        //Ask user for input of 1-9\n        printf(\"Please enter a place on the board to make your move, from 1 to 25: \");\n        //Make sure that user doesnt enter long string with number on the end that eventaully passes tests in the while loop\n        scanf(\"%d%c\", &amp;userInput, &amp;term);\n\n        if(term != '\\n')\n        {\n            move = -1;\n            printf(\"This is not a number\\n\");\n            continue;\n          }\n\n        //Check if input is in proper range\n        if(userInput &lt; 1 || userInput &gt; 25)\n        {\n            move = -1;\n            printf(\"Invalid Range\\n\");\n            continue;\n        }\n\n        //decrement move to get the array location of the playable places\n        userInput--;\n\n        //Check if place selected is already taken\n        if(board[ConvertTo49[userInput]] != EMPTY)\n        {\n            move = -1;\n            printf(\"Square not available\\n\");\n            continue;\n        }\n\n        //Set move ok to 1 after passing all the tests\n        moveOK = 1;\n    }\n\n    //Print move being made and return it\n    printf(\"\\nHuman making Move at square: %d\\n\",(userInput+1));\n    return ConvertTo49[userInput];\n}\n\n//Run Game function\nvoid RunGame()\n{\n    struct node *list;\n    list = NULL;\n\n        //Display\n    printf(\"\\n\\n     Noughts And Crosses Game:\");\n    printf(\"\\n     =========================\");\n\n    //game over variable\n    int gameOver = 0;   \n    //Start on noughts side\n    int side = NOUGHTS; \n    //Record last move\n    int lastMoveMade = 0;   \n    //Create new board\n    int board[49];\n    //Count of first move\n    int initialMove = 0;\n\n    //Initialise the Board\n    InitialiseBoard(&amp;board[0]);\n\n    //Print the board to screen\n    PrintBoard(&amp;board[0]);\n\n    //While game isn't over\n    while(!gameOver)\n    {\n        initialMove++;\n        //Human\n        if(side==NOUGHTS)\n        {\n            //Ask to undo move after first move played\n            if(initialMove &gt; 1)\n            {\n                while(list -&gt; prev != NULL)\n                        list = list -&gt; prev;\n                int undo;\n                printf(\"\\n\\nWould you like to undo your move? \\nEnter 2 to undo or any other key/s to continue: \");\n                scanf(\"%d\", &amp;undo);\n                if( undo == 2)\n                {\n                    while(list -&gt; next != NULL)\n                        list = list -&gt; next;\n\n                    char pceChars[] = \"OX| \";\n                    //printf(\" %c\", pceChars[board[ConvertTo49[index]]]);\n\n                    int count = 2;\n                    while(count != 0)\n                    {                       \n                        UndoMove(&amp;board[0], list -&gt; place, EMPTY);                      \n                        list = list -&gt; prev;\n                        delete(&amp;list, list -&gt; next -&gt; move);\n                        moveCount--;\n                        count--;\n                    }\n                    PrintBoard(&amp;board[0]);\n                }\n            }\n                //Make new move for human\n                lastMoveMade = GetHumanMove(&amp;board[0]);\n                MakeMove(&amp;board[0], lastMoveMade, side);\n                moveCount++;\n                int humanMove;\n                //Find the position the computer is making on the 5x5 board\n                for(humanMove = 0; humanMove &lt; 25; ++humanMove)\n                {\n                    if(ConvertTo49[humanMove] == lastMoveMade)\n                    {\n                        break;\n                    }\n                }               \n                append(&amp;list, 0, moveCount, lastMoveMade);\n                side = CROSSES;\n\n        }\n        //Computer\n        else\n        {\n            //Make move for computer\n            lastMoveMade = GetComputerMove(&amp;board[0], side);            \n            MakeMove(&amp;board[0], lastMoveMade, side);\n            int compMove;\n            //Find the position the computer is making on the 5x5 board\n            for(compMove = 0; compMove &lt; 25; ++compMove)\n            {\n                if(ConvertTo49[compMove] == lastMoveMade)\n                {\n                    break;\n                }\n            }\n            printf(\"\\nComputer making move at square: %d\", compMove+1);\n            moveCount++;\n            append(&amp;list, 1, moveCount, lastMoveMade);          \n            side = NOUGHTS;\n            PrintBoard(&amp;board[0]);\n        }\n\n        //If three in a row exists, game over\n        if(FindFourInARow(board, lastMoveMade, side ^ 1) == 4)\n        {                       \n            gameOver = 1;\n            if(side == NOUGHTS)\n            {\n                printf(\"\\nGame Over!\\n\");\n                printf(\"Computer Wins! :(\\n\");\n            }\n            else\n            {               \n                PrintBoard(&amp;board[0]);\n                printf(\"\\nGame Over!\\n\");\n                printf(\"Human Wins! :D\\n\");\n            }\n        }\n\n        //If no more moves, game is a draw      \n        if(!HasEmpty(board))\n        {\n            PrintBoard(&amp;board[0]);\n            printf(\"\\n\\nGame Over!\\n\");\n            gameOver = 1;\n            printf(\"It's a draw! :/\\n\");\n        }\n    }\n\n    /*\n    *\n    *    Match Replay\n    *   \n    */\n    int answer; \n    printf(\"\\n\\nWould you like to replay the match? \\nEnter 1 to replay or any other key/s to quit: \");\n    scanf(\"%d\", &amp;answer);\n\n    if(answer == 1)\n    {\n        InitialiseBoard(&amp;board[0]);\n        while ( list != NULL )\n        {\n\n            MakeMove(&amp;board[0], list -&gt; place, list -&gt; side);   \n            PrintBoard(&amp;board[0]);\n            char who[7];\n            if(list -&gt; side == 0)\n            {\n                strcpy(who, \"NOUGHTS\");\n                //who = \"NOUGHTS\";\n            }\n            else\n            {\n                strcpy(who, \"CROSSES\");\n                //who = \"CROSSES\";\n            }\n            int moveMade;\n            //Find the position the computer is making on the 5x5 board\n            for(moveMade = 0; moveMade &lt; 25; ++moveMade)\n            {\n                if(ConvertTo49[moveMade] == list -&gt; place)\n                {\n                    break;\n                }\n            }\n            printf (\"\\nMove:%2d    Side:%8s    Place: %d\\n\", list -&gt; move, who, moveMade+1);\n            Sleep(2000);\n            list = list -&gt; next ;\n        }\n    }\n    else\n    {\n        printf(\"\\nGood Game! See ya!\\n\");\n        getch();\n    }   \n}\n\n\n\nint main()\n{\n    //Create random number\n    srand(time(NULL));\n\n    //Call Run Game to play\n    RunGame();\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1553641221, "post_id": 55367280, "comment_id": 97458378, "body": "<code>int i, c = 0; int s[i];</code> Since <code>i</code> has no particular value, <code>int s[i];</code> tries to declare an array with no particular size. Ouch."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10643054"}, "reply_to_user": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1553642135, "post_id": 55367280, "comment_id": 97458636, "body": "OOF. <i>cough</i> Thanks, David-San. Alright, but I&#39;m curious. Why does this trick work in Java but not in C? The chaining of assignments? I&#39;m learning C through the C programming Language book 2nd edition, so some things are a little lost on me here."}, {"owner": {"reputation": 1404, "user_id": 10496710, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5cb3d11da053d8e1e94ef99a27ca6af?s=128&d=identicon&r=PG&f=1", "display_name": "B. Go", "link": "https://stackoverflow.com/users/10496710/b-go"}, "edited": false, "score": 0, "creation_date": 1553646102, "post_id": 55367280, "comment_id": 97459576, "body": "Where is the chain in &quot;i,c = 0&quot; ? It&#39;s not &quot;i = c = 0&quot; as in <a href=\"https://stackoverflow.com/questions/13116833/assigning-a-value-to-a-variable-in-a-chain-in-java\" title=\"assigning a value to a variable in a chain in java\">stackoverflow.com/questions/13116833/&hellip;</a> ... Only the &quot;int&quot; is kept with the , it doesn&#39;t try to assign to a tuple!"}, {"owner": {"reputation": 1404, "user_id": 10496710, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5cb3d11da053d8e1e94ef99a27ca6af?s=128&d=identicon&r=PG&f=1", "display_name": "B. Go", "link": "https://stackoverflow.com/users/10496710/b-go"}, "edited": false, "score": 0, "creation_date": 1553646355, "post_id": 55367280, "comment_id": 97459646, "body": "So you need to set a max size to s, check it in the for loop (or risk a buffer overflow), and your current code won&#39;t work correctly for a second value input after one of your 3 separators. Actually as your string never ends with a \\0, I&#39;m not sure it will work even for the first value!"}, {"owner": {"reputation": 1404, "user_id": 10496710, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5cb3d11da053d8e1e94ef99a27ca6af?s=128&d=identicon&r=PG&f=1", "display_name": "B. Go", "link": "https://stackoverflow.com/users/10496710/b-go"}, "edited": false, "score": 0, "creation_date": 1553646530, "post_id": 55367280, "comment_id": 97459684, "body": "Or any other valid stopping condition, as you&#39;re not using a string... Right now you parse uninitialized memory, it could contain anything after your value&#39;s chars"}, {"owner": {"user_type": "does_not_exist", "display_name": "user10643054"}, "edited": false, "score": 0, "creation_date": 1553646645, "post_id": 55367280, "comment_id": 97459711, "body": "Well hang on B. Go, according to the book, the terminating character in every char array is &#39;\\0&#39; the escape. (Which might explain why I should use a char array instead of an int. . . .)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user10643054"}, "edited": false, "score": 0, "creation_date": 1553646688, "post_id": 55367280, "comment_id": 97459718, "body": "It doesn&#39;t try to assign to a tuple, in C understood. Is that the same with C++? I&#39;m studying that right after C."}], "answers": [{"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1553640911, "post_id": 55367317, "comment_id": 97458282, "body": "He may want to look at <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.3.2.1p3\" rel=\"nofollow noreferrer\">C11 Standard - 6.3.2.1 Other Operands - Lvalues, arrays, and function designators(p3)</a> to figure out where the pointer you are talking about comes from."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10643054"}, "edited": false, "score": 0, "creation_date": 1553642179, "post_id": 55367317, "comment_id": 97458647, "body": "I understand. Since I&#39;m bringing up an array with an iterator, it works just like an array with a pointer, and therefore it doesn&#39;t work as I had intended."}], "tags": [], "owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "is_accepted": false, "score": 1, "last_activity_date": 1553641489, "last_edit_date": 1553641489, "creation_date": 1553640721, "answer_id": 55367317, "question_id": 55367280, "link": "https://stackoverflow.com/questions/55367280/why-does-the-compiler-yield-an-error-when-i-declared-the-parameter-a-char-and-us/55367317#55367317", "title": "Why does the compiler yield an error when I declared the parameter a char and used a char argument in htoi?", "body": "<pre><code>htoi(s[]);\n</code></pre>\n\n<p>is invalid, it doesn't mean anything. Just pass the pointer to the array.</p>\n\n<pre><code>htoi(s);\n</code></pre>\n\n<p>The </p>\n\n<pre><code>int htoi(int s[]);\n</code></pre>\n\n<p>The array declaration <code>int s[]</code> inside a function parameter list <code>int htoi( &lt;here&gt; )</code> is interpreted exactly as if it is a pointer to the type <code>int *s</code></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10643054"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1553641489, "creation_date": 1553640504, "question_id": 55367280, "link": "https://stackoverflow.com/questions/55367280/why-does-the-compiler-yield-an-error-when-i-declared-the-parameter-a-char-and-us", "title": "Why does the compiler yield an error when I declared the parameter a char and used a char argument in htoi?", "body": "<p>I'm writing a program that <strong><em>converts hexadecimal values to the number digit value</em></strong>, to that end I've made it so the integer function htoi(char s[i]) accepts char arrays. </p>\n\n<p>I plug in a char array using getchar() to allow the user to input characters which then get assigned to an array in my code, and said array is then used as the argument of htoi, however <strong><em>the compiler complains that htoi is using an argument with a pointer without a cast and wants char.</em></strong></p>\n\n<p>I've tried changing the arrays like char s[] to int s[i], because a char is just a smaller int, right? <strong><em>So, when I change it to int, the compiler then complains that htoi{s[i]) (s[] being an int now) makes a pointer from integer without a cast.</em></strong> </p>\n\n<p>So, I realize that an iterator within an array is nothing but a pointer to an element within the array, okay. Great, so I remove I and. . . <strong><em>It expects an expression before ']' token.</em></strong> </p>\n\n<p>I've exhausted my toolkit. </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#define YES 1 \n#define NO 0 \n#define EXIT '~'\n\nint htoi(int s[]); \n\nint main(){\nint i, c = 0;\nint s[i];\nfor (i = 0; (c = getchar()!= EXIT); i++){\n   s[i] = c;\n   if(c == '\\t' || c == '\\n' || c == ' '){\n      htoi(s[]);\n   }else{\n      putchar(c);\n   }\n  }\n}\n\nint htoi(int s[]){\nint isHexidecimal;\nint hexdigit; \nint n; \nint i = 0;\n\n\nif(s[i] == '0'){\n   i++; \n   if(s[i] == 'x' || s[i] == 'X')\n      i++; \n}\n\nisHexidecimal = YES;\n\nwhile(isHexidecimal == YES){\n\nif(s[i] &gt;= '0' &amp;&amp; s[i] &lt;= 9){\n   hexdigit += s[i] - '0';\n   i++; \n\n}else if(s[i] &gt;= 'a' &amp;&amp; s[i] &lt;= 'f'){\n   hexdigit += s[i] - 'a' + 10; \n   i++; \n\n}else if(s[i] &gt;= 'A' &amp;&amp; s[i] &lt;= 'F'){\n   hexdigit += s[i] - 'A' + 10;\n   i++;\n\n}else{\n\n   isHexidecimal = NO;\n\n}if(isHexidecimal == YES) {\n\n   n = n * 16 + hexdigit;\n      }else {\n       n += 0;\n     }\n   } \n      return n;\n}\n\n\n</code></pre>\n\n<p>I expect the main method to run the getchar() function which is assigned to variable c, and then assign variable c to the array, then pass said array onto htoi. </p>\n\n<p>htoi would return the hexadecimal to integer value, or '0' if I have not entered a valid hexadecimal value, or returns the hexadecimal value and terminates as a result of the loop not having a valid hexadecimal value entered.</p>\n"}, {"tags": ["python", "c", "python-3.x", "memory"], "comments": [{"owner": {"reputation": 1856, "user_id": 6607497, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/f0a0b03f5bbd44186399f4b0aea38049?s=128&d=identicon&r=PG&f=1", "display_name": "U. Windl", "link": "https://stackoverflow.com/users/6607497/u-windl"}, "edited": false, "score": 4, "creation_date": 1553640210, "post_id": 55367167, "comment_id": 97458065, "body": "First C uses assembly language to execute your program while Python uses an interpreter to execute some intermediate code. Second arrays in C are just memory areas while in Python they are (actually I&#39;m nor sure) complex data structures. Third they may be dead dynamic objects not garbage-collected. Typically OO_languages with a rich type hierarchy and garbage collection use much more memory than C does."}, {"owner": {"reputation": 11221, "user_id": 3929826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56f08b81def599c554c7ab93e8593600?s=128&d=identicon&r=PG", "display_name": "Klaus D.", "link": "https://stackoverflow.com/users/3929826/klaus-d"}, "edited": false, "score": 5, "creation_date": 1553640287, "post_id": 55367167, "comment_id": 97458082, "body": "Python does not have arrays, so it can not be &quot;the same array&quot;. Also the int types in C and Python are very different."}, {"owner": {"reputation": 63648, "user_id": 5014455, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JTknr.png?s=128&g=1", "display_name": "juanpa.arrivillaga", "link": "https://stackoverflow.com/users/5014455/juanpa-arrivillaga"}, "reply_to_user": {"reputation": 1856, "user_id": 6607497, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/f0a0b03f5bbd44186399f4b0aea38049?s=128&d=identicon&r=PG&f=1", "display_name": "U. Windl", "link": "https://stackoverflow.com/users/6607497/u-windl"}, "edited": false, "score": 1, "creation_date": 1553642771, "post_id": 55367167, "comment_id": 97458800, "body": "@U.Windl yes, everything in CPython is a full-fledged object. List objects do use a primitive array of PyObject pointers underneath the hood, but there&#39;s a  lot more going on than a C primitive array."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1553646794, "post_id": 55367167, "comment_id": 97459735, "body": "Excellent research BTW!"}], "answers": [{"comments": [{"owner": {"reputation": 9142, "user_id": 1442918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7490251da02084a2e2720e20029d2bff?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/1442918/max"}, "edited": false, "score": 2, "creation_date": 1553640433, "post_id": 55367246, "comment_id": 97458135, "body": "OP could use <a href=\"https://docs.python.org/3.7/library/array.html\" rel=\"nofollow noreferrer\">array module</a> to reduce the memory use, trading for speed as the values are translated back and forth as accessed."}], "tags": [], "owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "is_accepted": false, "score": 6, "last_activity_date": 1553646583, "last_edit_date": 1553646583, "creation_date": 1553640325, "answer_id": 55367246, "question_id": 55367167, "link": "https://stackoverflow.com/questions/55367167/why-does-python-implementation-use-9-times-more-memory-than-c/55367246#55367246", "title": "Why does python implementation use 9 times more memory than C?", "body": "<pre><code>&gt;&gt;&gt; import sys\n&gt;&gt;&gt; sys.getsizeof(123456)\n28\n</code></pre>\n\n<p>That's <em>7</em> times the size of C <code>int</code>. In Python 3 integers are instances of <code>struct _longobject</code> a.k.a <code>PyLong</code>:</p>\n\n<pre><code>struct _longobject {\n    PyVarObject ob_base;\n    digit ob_digit[1];\n};\n</code></pre>\n\n<p>where <code>PyVarObject</code> is </p>\n\n<pre><code>typedef struct {\n    PyObject ob_base;\n    Py_ssize_t ob_size;\n} PyVarObject;\n</code></pre>\n\n<p>and <code>PyObject</code> is</p>\n\n<pre><code>typedef struct _object {\n    Py_ssize_t ob_refcnt;\n    struct _typeobject *ob_type;\n} PyObject;\n</code></pre>\n\n<p>From that we get the following memory usage for that object 123456 in 64-bit Python build:</p>\n\n<ul>\n<li>8 bytes for reference counter (<code>Py_ssize_t</code>)</li>\n<li>8 bytes for pointer to the type object <code>&amp;PyLong_Type</code> (of type <code>PyTypeObject *</code></li>\n<li>8 bytes for counting the number of bytes in the variable-length part of the object;  (of type <code>Py_ssize_t</code>)</li>\n<li>4 bytes for each 30 bits of digits in the integer.</li>\n</ul>\n\n<p>Since 123456 fits in the first 30 bits, this sums up to 28, or <code>7 * sizeof (int)</code></p>\n\n<p>That in addition to the fact that each element in a Python <code>list</code> is a <code>PyObject *</code> which points the actual object; each of these pointers are 64 bits on 64-bit Python builds; which means that each list element reference alone consumes twice as much memory as a C <code>int</code>.</p>\n\n<p>Add together 7 and 2 and you get <strong>9</strong>.</p>\n\n<hr>\n\n<p>For more storage-efficient code you can use <a href=\"https://docs.python.org/3.4/library/array.html\" rel=\"nofollow noreferrer\">arrays</a>; with type code <code>'i'</code> the memory consumption should be quite close to the C version. <code>array</code>s have the <a href=\"https://docs.python.org/3/library/array.html#array.array.append\" rel=\"nofollow noreferrer\"><code>append</code></a> method thanks to which growing an array should be even easier than in C / with <code>realloc</code>.</p>\n"}], "owner": {"reputation": 81, "user_id": 11115589, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PRC-DaWn1VM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfsBxOBWWxhm6MwEBjMneop3Gzc3A/mo/photo.jpg?sz=128", "display_name": "Dylan Hecht", "link": "https://stackoverflow.com/users/11115589/dylan-hecht"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1618042184, "creation_date": 1553639821, "last_edit_date": 1618042184, "question_id": 55367167, "link": "https://stackoverflow.com/questions/55367167/why-does-python-implementation-use-9-times-more-memory-than-c", "title": "Why does python implementation use 9 times more memory than C?", "body": "<p>I wrote a program to make a list of primes from 2 to a user given number in both python and C. I ran both the programs looking for primes up to the same number and looked at their respective processes in activity monitor. I found that the python implementation used exactly 9 times as much memory as the C implementation. Why does python require so much more memory and why that specific multiple to store the same array of integers? Here are both implementations of the program:</p>\n\n<p>Python version:</p>\n\n<pre><code>import math\nimport sys\n\ntop = int(input('Please enter the highest number you would like to have checked: '))\nnum = 3\nprime_list = [2]\nwhile num &lt;= top:\n    n = 0\n    prime = True\n    while int(prime_list[n]) &lt;= math.sqrt(num):\n        if num % prime_list[n] == 0:\n            prime = False\n            n = 0\n            break\n        n = n + 1\n    if prime == True:\n        prime_list.append(num)\n        prime = False\n    num = num + 1\nprint(\"I found \", len(prime_list), \" primes\")\nprint(\"The largest prime I found was \", prime_list[-1])\n</code></pre>\n\n<p>C version:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;math.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n\nint main(){\n    int N;\n    int arraySize = 1;\n    int *primes = malloc(100*sizeof(int));\n    int isPrime = 1;\n    primes[0] = 2;\n    int timesRealloc = 0;\n    int availableSlots = 100;\n\n    printf(\"Please enter the largest number you want checked: \\n\");\n    scanf(\"%d\", &amp;N);\n\n    int j = 0;\n    int i;\n    for (i = 3; i &lt;= N; i+=2){\n        j = 0;\n        isPrime = 1;\n        while (primes[j] &lt;= sqrt(i)) {\n            if (i%primes[j] == 0) {\n                isPrime = 0;\n                break;\n            }\n            j++;\n        }\n        if (isPrime == 1){\n            primes[arraySize] = i;\n            arraySize++;\n        }\n        if (availableSlots == arraySize){\n            timesRealloc++;\n            availableSlots += 100;\n            primes = realloc(primes, availableSlots*sizeof(int));\n        }\n    }\n\n    printf(\"I found %d primes\\n\", arraySize);\n    printf(\"Memory was reallocated %d times\\n\", timesRealloc);\n    printf(\"The largest prime I found was %d\\n\", primes[(arraySize-1)]);\n\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "random", "simulation"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1553639058, "post_id": 55366874, "comment_id": 97457689, "body": "Please make a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 2, "creation_date": 1553639178, "post_id": 55366874, "comment_id": 97457722, "body": "Please explain your intention for and your understanding of this line <code>temp = (rand() + 0.1) &#47; (RAND_MAX + 1.0);</code>. Especially elaborate the range of possible results. Also please explain why you create a double random which you then use as an int."}, {"owner": {"reputation": 55, "user_id": 8834882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1faa7fb1354c2869f25ad5f6b96ecfab?s=128&d=identicon&r=PG&f=1", "display_name": "OpticalFlow", "link": "https://stackoverflow.com/users/8834882/opticalflow"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1553639357, "post_id": 55366874, "comment_id": 97457780, "body": "Normally rand() returns an integer between 0 and RAND_MAX. That line of code converts that number to a double with a value between 0 and 1."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1553639689, "post_id": 55366874, "comment_id": 97457895, "body": "Test if <code>ind</code> is in range before <code>if (network[ind] == 0) {</code>"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 3, "creation_date": 1553639786, "post_id": 55366874, "comment_id": 97457935, "body": "What is <code>RAND_MAX</code> on your system?  If it is a 15-bit or 16-bit value, you probably aren&#39;t getting good enough quantization when converted to <code>double</code>.  If it is a 31-bit or bigger number, that (probably) won&#39;t be the issue.  You need to investigate what values are generated by just the <code>rand01()</code> function with different seeds, plus the multiplication and cast to integer \u2014 simply print the results and <code>sort -n | uniq -c</code> to see how uniform the results are.  (100,000 / 30,000 is about a factor of 3)."}, {"owner": {"reputation": 4024, "user_id": 3307686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dd8d815759c23dd52428c7cc0c35324?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Holt", "link": "https://stackoverflow.com/users/3307686/mike-holt"}, "edited": false, "score": 0, "creation_date": 1553639862, "post_id": 55366874, "comment_id": 97457957, "body": "@OpticalFlow I ran your code as-is and it completed almost immediately, with all 1000 hosts (e.g, 0, 1, 2, ... 1000, 1001, 1002, ... 99000, 99001, 99002, ...) infected. Edit: I think Jonathan Leffler may be on to something re: <code>RANDMAX</code>."}, {"owner": {"reputation": 55, "user_id": 8834882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1faa7fb1354c2869f25ad5f6b96ecfab?s=128&d=identicon&r=PG&f=1", "display_name": "OpticalFlow", "link": "https://stackoverflow.com/users/8834882/opticalflow"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1553640151, "post_id": 55366874, "comment_id": 97458045, "body": "@JonathanLeffler On my system RAND_MAX is only 32767. Do you think that might be why my results might not be granular enough? Now that you&#39;ve made me think about it, there would only be 32,767 possible values and my network array is 100,000 possible values. Which corresponds about about the 1/3 results I am getting."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1553640213, "post_id": 55366874, "comment_id": 97458066, "body": "Yes, I think that is very probably the problem.  You want 100,000 different values, but your random number generator can only generate about 33,000 different values, which is awfully close to your 1:3 metric.  You could try <code>((rand() &lt;&lt; 15) + rand()) &#47; ((RAND_MAX + 1.0) * (RAND_MAX + 1.0))</code>."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553641567, "post_id": 55366874, "comment_id": 97458485, "body": "when <code>rand()</code> is called, then to obtain different results in different runs of the code, at the top of <code>main()</code> needs to be the statement: <code>srand( (unsigned)time( void ) );</code>"}], "answers": [{"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1553649007, "post_id": 55367282, "comment_id": 97460140, "body": "<code>((1u*rand()) &lt;&lt; 15) ^ rand()</code> would work well enough too even if <code>RAND_MAX != 32767</code>"}], "tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": true, "score": 3, "last_activity_date": 1553641356, "last_edit_date": 1553641356, "creation_date": 1553640518, "answer_id": 55367282, "question_id": 55366874, "link": "https://stackoverflow.com/questions/55366874/why-is-my-c-code-only-generating-every-third-random-number/55367282#55367282", "title": "Why is my C code only generating every third random number?", "body": "<p><sup><em>Converting comments into an answer.</em></sup></p>\n\n<p>What is RAND_MAX on your system? If it is a 15-bit or 16-bit value, you probably aren't getting good enough quantization when converted to double. If it is a 31-bit or bigger number, that (probably) won't be the issue. You need to investigate what values are generated by just the <code>rand01()</code> function with different seeds, plus the multiplication and cast to integer \u2014 simply print the results and <code>sort -n | uniq -c</code> to see how uniform the results are.</p>\n\n<blockquote>\n  <p>On my system RAND_MAX is only 32767. Do you think that might be why my results might not be granular enough? Now that you've made me think about it, there would only be 32,767 possible values and my network array is 100,000 possible values. Which corresponds about about the 1/3 results I am getting.</p>\n</blockquote>\n\n<p>Yes, I think that is very probably the problem. You want 100,000 different values, but your random number generator can only generate about 33,000 different values, which is awfully close to your 1:3 metric.  It also explains immediately why you got good results when you reduced the multiplier from 100,000 to 10,000.</p>\n\n<p>You could try:</p>\n\n<pre><code>double rand01(void)\n{\n    assert(RAND_MAX == 32767);\n    return ((rand() &lt;&lt; 15) + rand()) / ((RAND_MAX + 1.0) * (RAND_MAX + 1.0));\n}\n</code></pre>\n\n<p>Or you could use an alternative random number generator \u2014 for example, POSIX defines both the <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/drand48.html\" rel=\"nofollow noreferrer\"><code>drand48()</code></a> family of functions and\n<a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/random.html\" rel=\"nofollow noreferrer\"><code>random()</code></a>, with corresponding seed-setting functions where needed.</p>\n"}, {"tags": [], "owner": {"reputation": 55, "user_id": 8834882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1faa7fb1354c2869f25ad5f6b96ecfab?s=128&d=identicon&r=PG&f=1", "display_name": "OpticalFlow", "link": "https://stackoverflow.com/users/8834882/opticalflow"}, "is_accepted": false, "score": 0, "last_activity_date": 1553640599, "creation_date": 1553640599, "answer_id": 55367297, "question_id": 55366874, "link": "https://stackoverflow.com/questions/55366874/why-is-my-c-code-only-generating-every-third-random-number/55367297#55367297", "title": "Why is my C code only generating every third random number?", "body": "<p>Yeah, the problem I am having is that the RAND_MAX value on my system is only 32767 and I am trying to effectively spread that out over 100,000 values which results in about only every third number ever showing up.</p>\n\n<p>In my defense, the person who suggested the rand01() function has a PhD in Computer Science, but I think he ran this code on our school's main computer which probably has a much bigger RAND_MAX value.</p>\n\n<p>@JonathanLeffler deserves credit for this solution.</p>\n"}], "owner": {"reputation": 55, "user_id": 8834882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1faa7fb1354c2869f25ad5f6b96ecfab?s=128&d=identicon&r=PG&f=1", "display_name": "OpticalFlow", "link": "https://stackoverflow.com/users/8834882/opticalflow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 55367282, "answer_count": 2, "score": 3, "last_activity_date": 1553641356, "creation_date": 1553637983, "last_edit_date": 1553640709, "question_id": 55366874, "link": "https://stackoverflow.com/questions/55366874/why-is-my-c-code-only-generating-every-third-random-number", "title": "Why is my C code only generating every third random number?", "body": "<p>I am trying to simulate the propagation of a worm across a network made of 100,000 computers. The simulation itself is very simple and I don't need any help except that for some reason, I am only getting every third random number. </p>\n\n<p>Only the computers whose index modulo 1000 is less than 10 can be infected so when 1000 computers are infected, the program should be done. For some reason, my program only gets 329. When I lower the goal number and check the contents of the array, only every third computer has been changed and it is a consistent pattern. For example at the end of the array, only computers 98001, 98004, 98007, 99002, 99005, 99008 are changed even though the computers in between (98002, 98003, etc.) should be changed as well. The pattern holds all the way to the beginning of the array. When I try to get all 1000 changed, the program goes into an infinite loop and is stuck at 329.</p>\n\n<p>Edit: I just discovered that if I lower the NETSIZE to 10,000 and the goal in the while loop to 100, it doesn't skip anything. Does that mean the problem has something to do with a rounding error? Someone who knows more about C than me must know the answer.</p>\n\n<p>Thanks.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define NETSIZE 100000\n\ndouble rand01();\nvoid initNetwork();\n\nunsigned char network[NETSIZE];\nint scanrate = 3;\nint infectedCount;\nint scans;\nint ind;\nint time;\n\n\n\nint main(void) {\n    initNetwork();\n    time = 0;\n    infectedCount = 1;\n    while (infectedCount &lt; 1000) { //changing 1000 to 329 stops the infinite loop\n        scans = infectedCount * scanrate;\n        for (int j = 0; j &lt; scans; j++) {\n            ind = (int) (rand01() * NETSIZE);\n            if (network[ind] == 0) {\n                network[ind] = 1;\n                infectedCount++;\n            }\n        }\n        time++;\n    }\n    for (int k = 0; k &lt; NETSIZE; k++) {\n        if (network[k] == 1) printf(\"%d at %d\\n\", network[k], k);\n    }\n}\ndouble rand01() {\n    double temp;\n    temp = (rand() + 0.1) / (RAND_MAX + 1.0);\n    return temp;\n}\n\nvoid initNetwork() {\n    for (int i = 0; i &lt; NETSIZE; i++) {\n        if (i % 1000 &lt; 10) {\n            network[i] = 0;\n        } else  {\n            network[i] = 2;\n        }\n    }\n    network[1000] = 1;\n}\n\n</code></pre>\n\n<p>In the above code, I expect the code to run until the 1000 vulnerable indexes are changed from 0 to 1.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 1, "creation_date": 1553637612, "post_id": 55366773, "comment_id": 97457215, "body": "We can&#39;t tell what <code>words</code> is or what <code>j</code> or <code>k</code>&#39;s initial value is because your code is not complete."}, {"owner": {"reputation": 21, "user_id": 11042730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6a7dd00949b1139f01dd2e5f4642a3d?s=128&d=identicon&r=PG&f=1", "display_name": "jnimrod", "link": "https://stackoverflow.com/users/11042730/jnimrod"}, "reply_to_user": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1553637740, "post_id": 55366773, "comment_id": 97457269, "body": "Updated question with full code. Hope it helps."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 1, "creation_date": 1553637778, "post_id": 55366773, "comment_id": 97457286, "body": "Can you tell us what input you&#39;re providing? Also, why do you set to <code>k</code> and <code>j</code> to zero only once when they need to be zero each time you try to process a line?"}, {"owner": {"reputation": 21, "user_id": 11042730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6a7dd00949b1139f01dd2e5f4642a3d?s=128&d=identicon&r=PG&f=1", "display_name": "jnimrod", "link": "https://stackoverflow.com/users/11042730/jnimrod"}, "reply_to_user": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1553638084, "post_id": 55366773, "comment_id": 97457389, "body": "The input is a file with a sentence on each line with no punctuation. I&#39;m not sure how to show you."}, {"owner": {"reputation": 21, "user_id": 11042730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6a7dd00949b1139f01dd2e5f4642a3d?s=128&d=identicon&r=PG&f=1", "display_name": "jnimrod", "link": "https://stackoverflow.com/users/11042730/jnimrod"}, "reply_to_user": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1553639246, "post_id": 55366773, "comment_id": 97457741, "body": "At the end of the loop i reset k and j to 0 which cleaned up the output and got rid of the runtime error, thanks for the suggestion. Now my only problem is that it prints a newline after the first word. The first line in inputtext.txt is &quot;birds and bees&quot;, so the output should be &quot;bees and birds&quot;. The output I am getting is &quot;bees\\n and birds&quot;."}, {"owner": {"reputation": 515, "user_id": 2816849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6da0566b755d59605cbc3f7cd8edcc91?s=128&d=identicon&r=PG&f=1", "display_name": "LeBlue", "link": "https://stackoverflow.com/users/2816849/leblue"}, "edited": false, "score": 1, "creation_date": 1553639517, "post_id": 55366773, "comment_id": 97457833, "body": "Your <code>string</code> array might overflow (length 200), if your <code>fgets</code> reads a line longer than 199 characters (null byte), as your tell it to read up to 1000 chars. If that happens, your stack gets corrupted"}, {"owner": {"reputation": 158, "user_id": 8095033, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x9cGT.jpg?s=128&g=1", "display_name": "koleygr", "link": "https://stackoverflow.com/users/8095033/koleygr"}, "edited": false, "score": 0, "creation_date": 1553641261, "post_id": 55366773, "comment_id": 97458398, "body": "<code>for (i = 0; string[i] != &#39;\\0&#39; &amp;&amp; string[i] != &#39;\\n&#39;; i++)</code>. It reads and prints a <code>\\n</code> at the end of your sentence. So, this could solve it."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553643351, "post_id": 55366773, "comment_id": 97458947, "body": "the posted code does not cleanly compile!  Amongst other problems, it is missing the <code>#include</code> statements for the needed header files"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553643525, "post_id": 55366773, "comment_id": 97458997, "body": "regarding: <code>while (!feof(inp)) {</code>  please read: <a href=\"https://stackoverflow.com/questions/5431941/why-is-while-feoffile-always-wrong\">why while(!feof() ) is never correct</a>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553643777, "post_id": 55366773, "comment_id": 97459049, "body": "OT: regarding: <code>if (inp == NULL)      {         printf(&quot;File not found.\\n&quot;);     }</code>  1) error messages should be output to <code>stderr</code>, not <code>stdout</code>.  2) when the error is from a C library function should also output (to <code>stderr</code>) the text reason the system thinks the error occurred.  The function <code>perror( &quot;fopen for reading inputtext.txt failed&quot;);</code> performs the above functionality and that probably should be followed by: <code>exit( EXIT_FAILURE );</code>  Note <code>exit()</code> and <code>EXIT_FAILURE</code> are from the header file: <code>stdlib.h</code>  (cont)"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553643945, "post_id": 55366773, "comment_id": 97459087, "body": "(cont) 3) don&#39;t place other statements between the call to <code>fopen()</code> and <code>if ... == NULL )</code> code block, so that <code>errno</code> still contains the correct value. 4) the same testing needs to be done for the call to <code>fopen()</code> for writing <code>output.txt</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553644184, "post_id": 55366773, "comment_id": 97459150, "body": "regarding: <code>while (!feof(inp)) {              fgets(string, 1000, inp);</code>  Suggest replacing with: <code>while ( fgets(string, 200, inp) ) {</code>  Note: using 200 rather than 1000 because the length of the array: <code>string[]</code> is only 200"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553645117, "post_id": 55366773, "comment_id": 97459382, "body": "after calling <code>fgets()</code> need to remove the trailing newline .  This can easily be performed via: <code>string[ strspn( string, &quot;\\n&quot; ) ] = &#39;\\0&#39;;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": false, "score": 0, "last_activity_date": 1553646435, "creation_date": 1553646435, "answer_id": 55368085, "question_id": 55366773, "link": "https://stackoverflow.com/questions/55366773/problem-with-reversing-order-of-words-in-a-sentence/55368085#55368085", "title": "Problem with reversing order of words in a sentence", "body": "<p>the following proposed code:</p>\n\n<ol>\n<li>cleanly compiles</li>\n<li>properly checks for errors</li>\n<li>properly outputs error messages to <code>stderr</code></li>\n<li>performs the desired functionality</li>\n<li>properly limits the max length of an input</li>\n<li>assumes no line in the input file is over 199 characters</li>\n<li>minimizes the number of times the function: <code>strlen()</code> is called</li>\n<li>actually writes the reversed sentences to the output file</li>\n</ol>\n\n<p>And now, the proposed code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\n\nint main() \n{\n    FILE *inp,*outp;        //file input and output\n    int wordcount;                    //define counter variables\n    int k = 0;\n    int j = 0;\n    char string[200];       //define string to scan sentence into\n    char words[20][20];     //2D string for each word in the sentence\n\n    inp = fopen(\"inputtext.txt\", \"r\");\n    if( !inp )\n    {\n        perror( \"fopen to read: inputtext.txt failed\" );\n        exit( EXIT_FAILURE );\n    }\n\n    outp = fopen(\"output.txt\", \"w\");\n    if( !outp )\n    {\n        perror( \"fopen to write: output.txt failed\" );\n        // cleanup\n        fclose( inp );\n        exit( EXIT_FAILURE );\n    }\n\n\n    size_t strLength = strlen( string );\n\n    for (size_t i = 0; i &lt; strLength; i++)\n    {\n        // remove any trailing newline\n        string[ strspn( string, \"\\n\" ) ] = '\\0';\n\n        printf(\"GOT SENTENCE\\n\");\n\n        for (size_t i = 0; i &lt; strlen(string); i++) \n        {\n            if (string[i] == ' ') \n            {\n                words[k][j] = '\\0';\n                k++;\n                j = 0;\n            }\n\n            else\n            {\n                words[k][j] = string[i];\n                j++;\n            }\n        }\n\n        words[k][j] = '\\0';\n        wordcount = k;\n\n        for ( int i = wordcount; i &gt;= 0; i--) \n        {\n            printf(\"%s \", words[i]);\n            fprintf( outp, \"%s \", words[i] );\n        }\n        printf(\"\\n\\n\");\n        fprintf( outp, \"\\n\" );\n    }\n\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 11042730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6a7dd00949b1139f01dd2e5f4642a3d?s=128&d=identicon&r=PG&f=1", "display_name": "jnimrod", "link": "https://stackoverflow.com/users/11042730/jnimrod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1553646435, "creation_date": 1553637436, "last_edit_date": 1553637708, "question_id": 55366773, "link": "https://stackoverflow.com/questions/55366773/problem-with-reversing-order-of-words-in-a-sentence", "title": "Problem with reversing order of words in a sentence", "body": "<p>I want to read inputtext.txt line by line and reverse the order of words in each line and print them out (input: hello world,output: world hello). With this code my output is all messed up and I get a runtime error #2 saying the stack around my array \"string\" is corrupted. I tried resetting the strings to null after each while loop iteration but I still get the same error. Does anybody have any suggestions to get rid of the runtime error or help the code run more smoothly?</p>\n\n<pre><code>int main() {\n    FILE *inp,*outp;        //file input and output\n    int i,wordcount;                    //define counter variables\n    int k = 0,j=0;\n    char string[200];       //define string to scan sentence into\n    char words[20][20];     //2D string for each word in the sentence\n    inp = fopen(\"inputtext.txt\", \"r\");\n    outp = fopen(\"output.txt\", \"w\");\n    if (inp == NULL) {\n        printf(\"File not found.\\n\");\n    }\n    else {\n        while (!feof(inp)) {\n\n            fgets(string, 1000, inp);\n            printf(\"GOT SENTENCE\\n\");\n            for (i = 0; string[i] != '\\0'; i++) {\n\n\n                if (string[i] == ' ') {\n                    words[k][j] = '\\0';\n                    k++;\n                    j = 0;\n                }\n                else\n                {\n                    words[k][j] = string[i];\n                    j++;\n                }\n\n            }\n\n            words[k][j] = '\\0';\n            wordcount = k;\n            for (i = wordcount; i &gt;= 0; i--) {\n                printf(\"%s \", words[i]);\n            }\n            printf(\"\\n\\n\");\n\n        }\n    }\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "multidimensional-array", "memcpy"], "comments": [{"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553637821, "post_id": 55366696, "comment_id": 97457305, "body": "Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, including the needed <code>#include</code> statements"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553638383, "post_id": 55366696, "comment_id": 97457466, "body": "what output are you expecting?"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553639010, "post_id": 55366696, "comment_id": 97457673, "body": "please clean up the code so it cleanly compiles.  When compiling, always enable the warnings, then fix those warnings. (for <code>gcc</code>, at a minimum use: <code>-Wall -Wextra -Wconversion -pedantic -std=gnu11</code> )  Note: other compilers use different options to perform the same thing"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553639289, "post_id": 55366696, "comment_id": 97457756, "body": "for ease of readability and understanding: 1) please follow the axiom: <i>only one statement per line and (at most) one variable declaration per statement.</i>  2) please consistently indent the code.  Note 2 space indentation levels can/will be lost when using variable width fonts.  Suggest each indent level be 4 spaces.  3) Please separate code blocks: <code>for</code> <code>if</code> <code>else</code> <code>while</code> <code>do...while</code> <code>switch</code> <code>case</code> <code>default</code> via a single blank line 4) insert appropriate space(s) inside parens, inside brackets, inside braces, after semicolons, after commas , around C operators"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553639389, "post_id": 55366696, "comment_id": 97457794, "body": "it is good programming practice to limit the scope of variables.  For instance regarding: <code>for( c = 0; c &lt; 255; c++ )</code>  write it as: <code>for(size_t c = 0; c &lt; 255; c++)</code>  Similar considerations exist for the other loops"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1553639986, "post_id": 55366696, "comment_id": 97457993, "body": "the posted code contains some &#39;magic&#39; numbers.  &#39;magic&#39; numbers are numbers with no basis.  I.E.  10, 10, 255, 256.  &#39;magic&#39; numbers make the code much more difficult to understand, debug, etc.  Suggest using an <code>enum</code> statement or <code>#define</code> statements to give those &#39;magic&#39; numbers meaningful names, then use those meaningful names throughout the code"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 11066471, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6P1BDJRdXV8/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMqBNciFyiRPvP4P0cYrYUht04fGg/mo/photo.jpg?sz=128", "display_name": "Daniel Zemljic", "link": "https://stackoverflow.com/users/11066471/daniel-zemljic"}, "edited": false, "score": 0, "creation_date": 1553759307, "post_id": 55367166, "comment_id": 97505593, "body": "Thank you very much for your good programming hints and answer! :)"}], "tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": true, "score": 2, "last_activity_date": 1553639817, "creation_date": 1553639817, "answer_id": 55367166, "question_id": 55366696, "link": "https://stackoverflow.com/questions/55366696/memcpy-overwrites-area-in-3-dimensional-array/55367166#55367166", "title": "Memcpy overwrites area in 3 dimensional array", "body": "<p>in C, the index to an array is 0...(number of elements in array-1). So regarding: indexes into </p>\n\n<pre><code>char arg_list[10][10][255];\n</code></pre>\n\n<p>the first index has range of 0...9 </p>\n\n<p>the second index has range 0...9 </p>\n\n<p>the third index has range 0...254. </p>\n\n<p>Those areas in the posted code that are indexing outside the allowed ranges is an error and results in undefined behavior</p>\n"}], "owner": {"reputation": 3, "user_id": 11066471, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6P1BDJRdXV8/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMqBNciFyiRPvP4P0cYrYUht04fGg/mo/photo.jpg?sz=128", "display_name": "Daniel Zemljic", "link": "https://stackoverflow.com/users/11066471/daniel-zemljic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 55367166, "answer_count": 1, "score": 0, "last_activity_date": 1553639817, "creation_date": 1553636944, "question_id": 55366696, "link": "https://stackoverflow.com/questions/55366696/memcpy-overwrites-area-in-3-dimensional-array", "title": "Memcpy overwrites area in 3 dimensional array", "body": "<p>I am trying to make a little bash and parse the strings to a 3 dimensional array. The first indices is the cmd, the second the argument and the third the characters. </p>\n\n<p>No my problem is, that when I memcpy the last argument, it writes it to the next command. </p>\n\n<pre><code>int main()\n{\n  char buffer[256] = {\"c1 a1 a2 a3 a4 a5 a6 a7 a8 a9 a10 \\n\"}; \n  char arg_list[10][10][255];\n//  fgets(buffer, 255, stdin);\n\n  int c = 0;\n  int index_cmd = 0;\n  int index = 0;\n  int index_arg = 1;\n  int lastIndex = 0;\n  int nxt_cmd = 0;\n\n  for(c = 0; c &lt; 255; c++)\n  {\n    if (buffer[c] == '\\r' || buffer[c] == '\\n' || buffer[c] == ' ')\n    {\n      if(index_cmd == 0 || nxt_cmd)\n      {\n        memcpy(arg_list[index_cmd][0], buffer + lastIndex, c - lastIndex);\n        arg_list[index_cmd][0][c-lastIndex] = 0;\n        index_cmd++;\n        index_arg = 1;\n        nxt_cmd = 0;\n      }\n      else if(buffer[c-1] == '&amp;' || buffer[c-1] == '|')\n      {\n        memcpy(arg_list[index_cmd][0], buffer + lastIndex, c - lastIndex);\n        arg_list[index_cmd][0][c-lastIndex] = 0;\n        nxt_cmd = 1;\n        index_cmd++;\n        index_arg = 1;\n      }\n      else if(buffer[c-1] != ' ' &amp;&amp; buffer[c+1] != ' ')\n      {\n        memcpy(arg_list[index_cmd-1][index_arg] , buffer + lastIndex, c - lastIndex);\n        arg_list[index_cmd-1][index_arg][c-lastIndex] = 0;\n        index_arg++;\n      }\n      lastIndex = c +1;\n    }\n\n  }\n\n  int i,j,k = 0;\n  for(i = 0; i &lt; 4; i++)\n  {\n    for(j =1; j &lt; 11; j++)\n    {\n        printf(\"command %d %s\\n\",i,arg_list[i][0]);\n        printf(\"arg %d %s\\n\",j, arg_list[i][j]);\n    }\n  }\n}\n</code></pre>\n\n<p>The code example gives me the following output: </p>\n\n<pre><code>command 0 c1 \narg 1 a1\ncommand 0 c1\narg 2 a2\ncommand 0 c1\narg 3 a3\ncommand 0 c1\narg 4 a4\ncommand 0 c1\narg 5 a5\ncommand 0 c1\narg 6 a6\ncommand 0 c1\narg 7 a7\ncommand 0 c1\narg 8 a8\ncommand 0 c1\narg 9 a9\ncommand 0 c1\narg 10 a10\ncommand 1 a10\narg 1 \ncommand 1 a10\narg 2 \ncommand 1 a10\narg 3 \ncommand 1 a10\narg 4 \ncommand 1 a10\narg 5 \ncommand 1 a10\narg 6 \ncommand 1 a10\narg 7 \ncommand 1 a10\narg 8 \ncommand 1 a10\narg 9 \ncommand 1 a10\n</code></pre>\n\n<p>So it writes argument10 to the place in the array where if provided the next command should be. </p>\n\n<p>I really dont know whats the problem, but I think it has something to do with <code>memcpy</code>. </p>\n\n<p>I appreciate any help :)</p>\n"}]