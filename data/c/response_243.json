[{"tags": ["c"], "comments": [{"owner": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "edited": false, "score": 3, "creation_date": 1567641554, "post_id": 57796816, "comment_id": 102026674, "body": "Also enable warnings, e.g. <code>-Wall -Wextra</code> command line parameter for <code>gcc</code> or <code>clang</code> as compiler. The warnings are going to tell you where and what the problem is here."}, {"owner": {"reputation": 59, "user_id": 1737973, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/EmWsq.png?s=128&g=1", "display_name": "1737973", "link": "https://stackoverflow.com/users/1737973/1737973"}, "edited": false, "score": 1, "creation_date": 1567642665, "post_id": 57796816, "comment_id": 102026869, "body": "What&#39;s <code>p</code> for? It is unused."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 2, "creation_date": 1567642691, "post_id": 57796816, "comment_id": 102026873, "body": "<code>scanf(&quot;%d&quot;, amount);</code> should be <code>scanf(&quot;%d&quot;, &amp;amount);</code> That&#39;s the reason for the error."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1567642734, "post_id": 57796816, "comment_id": 102026879, "body": "<code>*p = amount;</code> is using an uninitialized variable."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11559764"}, "edited": false, "score": 0, "creation_date": 1567642759, "post_id": 57796816, "comment_id": 102026885, "body": "pointer. i tried using it for allocating memory for <code>amount</code>"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1567642800, "post_id": 57796816, "comment_id": 102026890, "body": "Just declaring <code>int amount</code> allocates memory for <code>amount</code>."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1567642839, "post_id": 57796816, "comment_id": 102026902, "body": "Note that if you fix the <code>scanf()</code> call and type <code>1</code> as the number of times, your loop will print the data twice.  (Change <code>&lt;=</code> to <code>&lt;</code> \u2014 this is the standard C idiom.)  Also note that the data will be printed multiple times on a single line \u2014 you probably want a newline <code>\\n</code> in the format: <code>printf(&quot;%s\\n&quot;, str);</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11559764"}, "edited": false, "score": 0, "creation_date": 1567642848, "post_id": 57796816, "comment_id": 102026903, "body": "Thank you! adding &amp; before <code>amount</code> fixed it."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1567642875, "post_id": 57796816, "comment_id": 102026912, "body": "Any tutorial on using <code>scanf()</code> should show the correct way to use it."}, {"owner": {"reputation": 1669, "user_id": 7508077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b4193888717f50e77805498af1435b9?s=128&d=identicon&r=PG&f=1", "display_name": "EsmaeelE", "link": "https://stackoverflow.com/users/7508077/esmaeele"}, "edited": false, "score": 0, "creation_date": 1567644752, "post_id": 57796816, "comment_id": 102027248, "body": "<code>int *p = malloc(sizeof(int) * 10);</code> and following <code>*p = amount;</code> are redundant and both of them can be removed."}, {"owner": {"reputation": 1669, "user_id": 7508077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b4193888717f50e77805498af1435b9?s=128&d=identicon&r=PG&f=1", "display_name": "EsmaeelE", "link": "https://stackoverflow.com/users/7508077/esmaeele"}, "edited": false, "score": 0, "creation_date": 1567644873, "post_id": 57796816, "comment_id": 102027270, "body": "<code>printf(&quot;%s&quot;, str);</code> --&gt; <code>printf(&quot;%s&quot;, *str);</code>"}], "answers": [{"tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": false, "score": 3, "last_activity_date": 1567665169, "creation_date": 1567665169, "answer_id": 57799612, "question_id": 57796816, "link": "https://stackoverflow.com/questions/57796816/how-can-i-fix-address-boundary-error-in-c/57799612#57799612", "title": "How can I fix Address boundary error in C?", "body": "<p>It's remarkable how many issues there are in such a short chunk of code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(void)\n{\n    char str[100];\n    int amount;\n\n    printf(\"\\nType any word!\\n\");\n    if (scanf(\"%99s\", str) != 1)\n    {\n        fprintf(stderr, \"Failed to read a string\\n\");\n        return(EXIT_FAILURE);\n    }\n    printf(\"\\nHow many times?\\n\");\n    if (scanf(\"%d\", &amp;amount) != 1)\n    {\n        fprintf(stderr, \"Failed to read an integer\\n\");\n        return(EXIT_FAILURE);\n    }\n    for (int i = 0; i &lt; amount; i++)\n    {\n         printf(\"%s\\n\", str);\n    }\n    return 0;\n}\n</code></pre>\n\n<ul>\n<li>The signature of <code>main()</code> is a full prototype.</li>\n<li>The type of <code>str</code> is corrected (or, at least, changed and made usable).</li>\n<li>The code related to <code>p</code> and <code>malloc()</code> is not needed.</li>\n<li>The variable <code>i</code> is moved into the <code>for</code> loop (assumes a C99 or later compiler; if not available, what you had was OK).</li>\n<li>Change \"anything\" to \"any word\" because <code>%s</code> skips white space and then reads non-spaces up to the next white space.</li>\n<li>Limit the amount of input to prevent overflows.</li>\n<li>Report if there's a problem reading the string and exit.</li>\n<li><strong><em>Fix the <code>scanf()</code> to pass <code>&amp;amount</code></em></strong> (key change).</li>\n<li>Check for success reading <code>amount</code> and report failure and exit.</li>\n<li>Define <code>i</code> in the loop control (C99).</li>\n<li>If the user requests one copy, only print one copy (change <code>&lt;=</code> to <code>&lt;</code> \u2014 that's an idiomatic C loop now).</li>\n<li>Output newline after each word.  There are other ways to present the data, including the one chosen originally, but you should at least end the output with a newline.</li>\n</ul>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11559764"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 1, "closed_date": 1567688214, "answer_count": 1, "score": 0, "last_activity_date": 1567665169, "creation_date": 1567640908, "last_edit_date": 1567642368, "question_id": 57796816, "link": "https://stackoverflow.com/questions/57796816/how-can-i-fix-address-boundary-error-in-c", "closed_reason": "Not suitable for this site", "title": "How can I fix Address boundary error in C?", "body": "<p>I'm new to C,and want to write a simple program that takes a user input and prints it out a specific amount of times back to them.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main() {\n\n    char* str[100];\n    int *p = malloc(sizeof(int) * 10);\n    int amount;\n    *p = amount;\n    int i;\n\n    printf(\"\\nType anything!\\n\");\n    scanf(\"%s\", str);\n    printf(\"\\nHow many times?\\n\");\n    scanf(\"%d\", amount);\n    for (i=0; i&lt;=amount; i++) {\n         printf(\"%s\", str);\n    }\n   return 0;\n}\n\n</code></pre>\n\n<p>It works fine,until after pressing entering the amount of times,when the program crashes with the Fish shell saying \"fish: \u201c./a.out\u201d terminated by signal SIGSEGV (Address boundary error)\".</p>\n\n<p>Address boundary error tells me that maybe I haven't allocated memory for something,but how would I go about doing that? I've tried using malloc with a pointer pointed at <code>amount</code> but it doesnt seemed to have solved anything.</p>\n"}, {"tags": ["c", "dos", "x86-16", "compiler-flags", "watcom"], "comments": [{"owner": {"reputation": 6093, "user_id": 2189500, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/109f747845a9ce762a1fff72eb8cf6f3?s=128&d=identicon&r=PG", "display_name": "David Wohlferd", "link": "https://stackoverflow.com/users/2189500/david-wohlferd"}, "edited": false, "score": 0, "creation_date": 1567649445, "post_id": 57796575, "comment_id": 102027963, "body": "Can you show us your complete compile/linker commands?  Later switches can override earlier switches, so <code>-d2 -hw -O2</code> might not work as intended."}, {"owner": {"reputation": 1, "user_id": 12022246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/526eb0d8eba17bb8c7175c158345058f?s=128&d=identicon&r=PG&f=1", "display_name": "BadFatRat", "link": "https://stackoverflow.com/users/12022246/badfatrat"}, "reply_to_user": {"reputation": 6093, "user_id": 2189500, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/109f747845a9ce762a1fff72eb8cf6f3?s=128&d=identicon&r=PG", "display_name": "David Wohlferd", "link": "https://stackoverflow.com/users/2189500/david-wohlferd"}, "edited": false, "score": 0, "creation_date": 1567651707, "post_id": 57796575, "comment_id": 102028320, "body": "Sure. Take a look :) <a href=\"https://pastebin.com/3zUsVjeV\" rel=\"nofollow noreferrer\">link</a>"}, {"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1567797916, "post_id": 57796575, "comment_id": 102085268, "body": "@badfatrat: Please keep everything in one place, put your switches in the question"}], "owner": {"reputation": 1, "user_id": 12022246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/526eb0d8eba17bb8c7175c158345058f?s=128&d=identicon&r=PG&f=1", "display_name": "BadFatRat", "link": "https://stackoverflow.com/users/12022246/badfatrat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567800162, "creation_date": 1567638597, "last_edit_date": 1567800162, "question_id": 57796575, "link": "https://stackoverflow.com/questions/57796575/lack-of-debugging-information-in-well-debugger", "title": "Lack of debugging information in, well, debugger", "body": "<p>Currently I am using Clion IDE plus latest version of Open Watcom v2 windows 32 bit compiler to develop some 16 bit MS-DOS application. The problem I have is I don't see all required debugging information when using watcom windows debugger (wdw.exe).\nBeing specific, I see global variables, global and any other types of functions, even those imported from asm files. But well, local variables list is empty all the time. But more importantly - the only c-code I can see is little test.c file which contains only main() function and nothing else except for includes.\nWhat do I need to do to finally get c-level debugging for whole project? What am I missing?\nI would be grateful for any help.</p>\n\n<p>All source files is located in one directory, so, they all should be visible to debugger. But it sees only main c file.\nOf course I am compiling with -d2 switch, as well as -hw. DEBUG WATCOM ALL is also presented in linker config file before any FILE directives. Reading manuals to compiler and linker... Well, it's nice that I've found many interesting things in manuals, but nothing helped with exactly that issue so far :)</p>\n\n<p>List of compiler switches I currently using:</p>\n\n<pre><code>WCC.EXE:\nCALL WCC.EXE -dTEST -bt=dos -0 -za99 -wx -we -mc -zp2 -hw -d2 \n%SRC_FULL_NAME%\nWLINK:\nCALL WLINK.EXE @..\\CC.LK\n\nCC.LK:\nSYSTEM DOS\nDEBUG WATCOM ALL\nFILE TEST.OBJ\nFILE LUTILS.OBJ\nFILE LGL.OBJ\nNAME TEST.EXE\nOPTION ELIMINATE\n...\n</code></pre>\n"}, {"tags": ["c", "registry", "mingw-w64"], "comments": [{"owner": {"reputation": 4328, "user_id": 920069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd39f0db1f22e1314746491df063602a?s=128&d=identicon&r=PG", "display_name": "Retired Ninja", "link": "https://stackoverflow.com/users/920069/retired-ninja"}, "edited": false, "score": 2, "creation_date": 1567637915, "post_id": 57796431, "comment_id": 102026040, "body": "The documentation says <code>Note  This function is provided only for compatibility with 16-bit versions of Windows. Applications should use the RegEnumKeyEx function.</code> You may wish to consider that advice."}, {"owner": {"reputation": 4328, "user_id": 920069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd39f0db1f22e1314746491df063602a?s=128&d=identicon&r=PG", "display_name": "Retired Ninja", "link": "https://stackoverflow.com/users/920069/retired-ninja"}, "edited": false, "score": 1, "creation_date": 1567639035, "post_id": 57796431, "comment_id": 102026235, "body": "Your code works as written if the size of the keyName array is reduced to 256. I arrived at that size by reading this: <a href=\"https://docs.microsoft.com/en-us/windows/win32/sysinfo/registry-element-size-limits\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/windows/win32/sysinfo/&hellip;</a>."}, {"owner": {"reputation": 105, "user_id": 2695220, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9aaad077125e5d1424f2632bd774f341?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Hern&#225;ndez", "link": "https://stackoverflow.com/users/2695220/javier-hern%c3%a1ndez"}, "reply_to_user": {"reputation": 4328, "user_id": 920069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd39f0db1f22e1314746491df063602a?s=128&d=identicon&r=PG", "display_name": "Retired Ninja", "link": "https://stackoverflow.com/users/920069/retired-ninja"}, "edited": false, "score": 0, "creation_date": 1567639460, "post_id": 57796431, "comment_id": 102026313, "body": "Thank you, it solves the problem."}], "owner": {"reputation": 105, "user_id": 2695220, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9aaad077125e5d1424f2632bd774f341?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Hern&#225;ndez", "link": "https://stackoverflow.com/users/2695220/javier-hern%c3%a1ndez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567637254, "creation_date": 1567637254, "question_id": 57796431, "link": "https://stackoverflow.com/questions/57796431/regenumkey-always-returns-error-error-more-data", "title": "RegEnumKey always returns error ERROR_MORE_DATA", "body": "<p>The code below always returns error 234 (ERROR_MORE_DATA). I completely stuck on it. Cant even imagine where is the mistake.</p>\n\n<p>I have tried to extend keyName to size 327680 chars, this does not effect on the behavior of the code.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n\nvoid main()\n{\n  HKEY  list;\n  char  keyName[32768];\n  long  keyNameSize = sizeof(keyName) - 1;\n  char* path = \"Software\\\\Microsoft\";\n\n  if (RegOpenKey(HKEY_LOCAL_MACHINE, path, &amp;list))\n  {\n    if (GetLastError() == ERROR_ACCESS_DENIED)\n    {\n      printf(\"access denied\\n\");\n    }\n\n    else\n    {\n      printf(\"failed to open key\\n\");\n    }\n\n    return;\n  }\n\n  printf(\"regopenkey success\\n\");\n\n  long result = RegEnumKey(list, 0, keyName, keyNameSize);\n\n  printf(\"reg enum key (result code: %d) (keyName: %s) (keyNameSize: %d)\\n\",\n    result, keyName, keyNameSize);\n\n  if (result)\n  {\n    if (GetLastError() == ERROR_ACCESS_DENIED)\n    {\n      printf(\"access denied\\n\");\n    }\n\n    else\n    {\n      printf(\"failed to enumerate key\\n\");\n    }\n\n    return;\n  }\n\n  printf(\"regenumkey success\\n\");\n}\n</code></pre>\n\n<p>The expected output result is:</p>\n\n<pre><code>regopenkey success\nreg enum key (result code: 0) (keyName: Something) (keyNameSize: 32767)\nregenumkey success\n</code></pre>\n\n<p>The actual output result is:</p>\n\n<pre><code>regopenkey success\nreg enum key (result code: 234) (keyName: ) (keyNameSize: 32767)\nfailed to enumerate key\n</code></pre>\n"}, {"tags": ["c", "embedded", "freertos"], "comments": [{"owner": {"reputation": 2610, "user_id": 1883304, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/xYoZ7.png?s=128&g=1", "display_name": "Micrified", "link": "https://stackoverflow.com/users/1883304/micrified"}, "edited": false, "score": 0, "creation_date": 1567631857, "post_id": 57795556, "comment_id": 102024618, "body": "I solved it. There&#39;s not enough memory being allocated to the tasks. If I increase it to 8096 words, then it behaves as expected. The reported error is incoherent however."}], "answers": [{"comments": [{"owner": {"reputation": 2610, "user_id": 1883304, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/xYoZ7.png?s=128&g=1", "display_name": "Micrified", "link": "https://stackoverflow.com/users/1883304/micrified"}, "edited": false, "score": 1, "creation_date": 1567632871, "post_id": 57795837, "comment_id": 102024943, "body": "I already have a kickoff to avoid the deadlock in my sample code. For some reason without calling the scheduler my example works (see my comment on the post). I&#39;m not sure how"}], "tags": [], "owner": {"reputation": 2383, "user_id": 2705382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6648343abb3b27a12cafef7ee1ede72?s=128&d=identicon&r=PG&f=1", "display_name": "andrew", "link": "https://stackoverflow.com/users/2705382/andrew"}, "is_accepted": false, "score": 1, "last_activity_date": 1567632505, "creation_date": 1567632505, "answer_id": 57795837, "question_id": 57795556, "link": "https://stackoverflow.com/questions/57795556/freertos-xtasknotifywait-causes-some-internal-mutex-assertion-to-fail/57795837#57795837", "title": "FreeRTOS xTaskNotifyWait causes some internal mutex assertion to fail", "body": "<p>There are actually 2 errors here, and the error message doesn't tell much about either one.</p>\n\n<p><strong>Problem 1: Scheduler</strong></p>\n\n<p>In app_main() you create the tasks but never start the scheduler. If the scheduler isn't running, it never starts the tasks. You need something like</p>\n\n<pre><code>    //ERROR: you cant call this before the scheduler starts\n    // Kick off by notifying task A\n    //xTaskNotify(handle_task_a, A_BIT, eSetBits);\n\n    // Start the real time scheduler.\n    vTaskStartScheduler();\n\n    // Will not get here unless there is insufficient RAM.\n}\n</code></pre>\n\n<p><a href=\"https://www.freertos.org/a00132.html\" rel=\"nofollow noreferrer\">https://www.freertos.org/a00132.html</a></p>\n\n<p>That is only part of the problem, even with that your code will not run. There is another error: you can't call xTaskNotify before you start the scheduler which leads us to the next point...</p>\n\n<p><strong>Problem 2: Deadlock</strong></p>\n\n<p>Since we couldn't call xTaskNotify before running the scheduler, nothing will ever happen. The way your tasks are written will create a deadlock.</p>\n\n<ul>\n<li>Task A waits for notification from B</li>\n<li>Task B waits for notification from A</li>\n</ul>\n\n<p>So the question is where to put the xTaskNotify to prevent deadlock?</p>\n\n<p>There are a few solutions, you can use a button, or a timer interrupt to trigger the first xTaskNotify (if you do this from an ISR make sure to use xTaskNotifyFromISR) and get the whole system running. The easier way is to add it to the startup code of one of your tasks.</p>\n\n<pre><code>void b_task (void *pvParameters) {\n    BaseType_t xResult;\n    uint32_t value;\n\n    //First we wait a little for the scheduler to settle\n    vTaskDelay(1000 / portTICK_PERIOD_MS);\n\n    // Kick off by notifying task A\n    xTaskNotify(handle_task_a, A_BIT, eSetBits);\n\n    while (1) {\n</code></pre>\n\n<p>At this point your code should run as expected.</p>\n"}], "owner": {"reputation": 2610, "user_id": 1883304, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/xYoZ7.png?s=128&g=1", "display_name": "Micrified", "link": "https://stackoverflow.com/users/1883304/micrified"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 893, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567632505, "creation_date": 1567630669, "question_id": 57795556, "link": "https://stackoverflow.com/questions/57795556/freertos-xtasknotifywait-causes-some-internal-mutex-assertion-to-fail", "title": "FreeRTOS xTaskNotifyWait causes some internal mutex assertion to fail", "body": "<h3>Context</h3>\n\n<p>I'm using the FreeRTOS Task Notifications as a lightweight event-group, as described in the FreeRTOS documentation <a href=\"https://www.freertos.org/RTOS_Task_Notification_As_Event_Group.html\" rel=\"nofollow noreferrer\">here</a>. The idea is to make two simple tasks print <code>Ping</code> and <code>Pong</code> in an alternating sequence, each notifying each other when they have finished printing. </p>\n\n<h3>Problem</h3>\n\n<p>The program compiles successfully, but crashes moments after startup with the following stack trace: </p>\n\n<pre><code>assertion \"coreID == mux-&gt;owner\" failed: file \"/home/micrified/Documents/Somnox/esp-idf/components/freertos/portmux_impl.inc.h\", line 157, function: vPortCPUReleaseMutexIntsDisabledInternal\nabort() was called at PC 0x400d58cf on core 1\n0x400d58cf: __assert_func at /builds/idf/crosstool-NG/.build/xtensa-esp32-elf/src/newlib/newlib/libc/stdlib/assert.c:62 (discriminator 8)\n\n\nELF file SHA256: bd56229aae2c8bfb3479e7a47ebb97d9be7e36483cea95737781c99e1daa0200\n\nBacktrace: 0x400849cd:0x3ffb69a0 0x40084d41:0x3ffb69c0 0x400d58cf:0x3ffb69e0 0x400883ab:0x3ffb6a10 0x40087a3a:0x3ffb6a30 0x40087af9:0x3ffb6a70 0x40082755:0x3ffb6a90 0x40082841:0x3ffb6ac0 0x400d3697:0x3ffb6ae0 0x400d2609:0x3ffb6b00 0x4000bd83:0x3ffb6b20 |&lt;-CORRUPTED\n0x400849cd: invoke_abort at /home/micrified/Documents/Somnox/esp-idf/components/esp32/panic.c:155\n\n0x40084d41: abort at /home/micrified/Documents/Somnox/esp-idf/components/esp32/panic.c:172\n\n0x400d58cf: __assert_func at /builds/idf/crosstool-NG/.build/xtensa-esp32-elf/src/newlib/newlib/libc/stdlib/assert.c:62 (discriminator 8)\n\n0x400883ab: vPortCPUReleaseMutexIntsDisabledInternal at /home/micrified/Documents/Somnox/esp-idf/components/freertos/portmux_impl.inc.h:157\n (inlined by) vPortCPUReleaseMutexIntsDisabled at /home/micrified/Documents/Somnox/esp-idf/components/freertos/portmux_impl.h:110\n (inlined by) vTaskExitCritical at /home/micrified/Documents/Somnox/esp-idf/components/freertos/tasks.c:4261\n\n0x40087a3a: xQueueGenericReceive at /home/micrified/Documents/Somnox/esp-idf/components/freertos/queue.c:1542\n\n0x40087af9: xQueueTakeMutexRecursive at /home/micrified/Documents/Somnox/esp-idf/components/freertos/queue.c:635\n\n0x40082755: lock_acquire_generic at /home/micrified/Documents/Somnox/esp-idf/components/newlib/locks.c:157\n\n0x40082841: _lock_acquire_recursive at /home/micrified/Documents/Somnox/esp-idf/components/newlib/locks.c:171\n\n0x400d3697: uart_write at /home/micrified/Documents/Somnox/esp-idf/components/vfs/vfs_uart.c:194\n\n0x400d2609: esp_vfs_write at /home/micrified/Documents/Somnox/esp-idf/components/vfs/vfs.c:420 (discriminator 4)\n\n</code></pre>\n\n<p>I'm not directly interfacing with any FreeRTOS semaphores or mutex types myself, so I'm unsure what the cause of this error is. </p>\n\n<h3>Reproducible Example</h3>\n\n<p>My program code is fairly simple. I'm running it on an ESP-32 development board and building with the ESP-IDF tool-suite. </p>\n\n<hr>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include \"freertos/FreeRTOS.h\"\n#include \"freertos/task.h\"\n#include \"esp_system.h\"\n#include \"esp_spi_flash.h\"\n\n\n#define A_BIT   0x1\n#define B_BIT   0x2\n\nTaskHandle_t handle_task_a;\nTaskHandle_t handle_task_b;\n\nvoid a_task (void *pvParameters) {\n    BaseType_t xResult;\n    uint32_t value;\n\n    while (1) {\n\n        // Block waiting for notification\n        xResult = xTaskNotifyWait(pdFALSE, // Don't clear bits on entry\n                                 A_BIT, // Clear own bit on exit\n                                 &amp;value, // Save value \n                                 portMAX_DELAY); // Block indefinitely\n\n        if (xResult != pdPASS) {\n            fprintf(stderr, \"Err: Task A bad notify!\\n\");\n            return;\n        }\n\n        // Ignore if bit not set\n        if ((value &amp; A_BIT) == 0) {\n            continue;\n        }\n\n        // Otherwise wait a second\n        vTaskDelay(1000 / portTICK_PERIOD_MS);\n\n        // Show message\n        printf(\"Task A: Ping!\\n\");\n\n        // Dispatch notification to task B\n        xTaskNotify(handle_task_b, B_BIT, eSetBits);\n    }\n}\n\nvoid b_task (void *pvParameters) {\n    BaseType_t xResult;\n    uint32_t value;\n\n    while (1) {\n\n        // Block waiting for notification\n        xResult = xTaskNotifyWait(pdFALSE, // Don't clear bits on entry\n                                 B_BIT, // Clear own bit on exit\n                                 &amp;value, // Save value \n                                 portMAX_DELAY); // Block indefinitely\n\n        if (xResult != pdPASS) {\n            fprintf(stderr, \"Err: Task B bad notify!\\n\");\n            return;\n        }\n\n        // Ignore if bit not set\n        if ((value &amp; B_BIT) == 0) {\n            continue;\n        }\n\n        // Otherwise wait a second\n        vTaskDelay(1000 / portTICK_PERIOD_MS);\n\n        // Show message\n        printf(\"Task B: Pong!\\n\");\n\n        // Dispatch notification to task A\n        xTaskNotify(handle_task_a, A_BIT, eSetBits);\n    }\n}\n\n\nvoid app_main(void)\n{\n\n    /* Print chip information */\n    esp_chip_info_t chip_info;\n    esp_chip_info(&amp;chip_info);\n    printf(\"This is ESP32 chip with %d CPU cores, WiFi%s%s, \",\n            chip_info.cores,\n            (chip_info.features &amp; CHIP_FEATURE_BT) ? \"/BT\" : \"\",\n            (chip_info.features &amp; CHIP_FEATURE_BLE) ? \"/BLE\" : \"\");\n\n    printf(\"silicon revision %d, \", chip_info.revision);\n\n    printf(\"%dMB %s flash\\n\", spi_flash_get_chip_size() / (1024 * 1024),\n            (chip_info.features &amp; CHIP_FEATURE_EMB_FLASH) ? \"embedded\" : \"external\");\n\n    // Create task A \n    if(xTaskCreate(a_task, \"Task A\", 512, NULL, tskIDLE_PRIORITY, &amp;handle_task_a) != pdPASS) {\n        fprintf(stderr, \"Error creating task A!\\n\");\n        return;\n    }\n\n    // Create task B\n    if (xTaskCreate(b_task, \"Task B\", 512, NULL, tskIDLE_PRIORITY, &amp;handle_task_b) != pdPASS) {\n        fprintf(stderr, \"Error creating task B!\\n\");\n        return;\n    }\n\n    // Kick off by notifying task A\n    xTaskNotify(handle_task_a, A_BIT, eSetBits);\n\n}\n</code></pre>\n"}, {"tags": ["c", "logical-operators", "post-increment", "pre-increment"], "comments": [{"owner": {"reputation": 67968, "user_id": 584192, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YBSIc.png?s=128&g=1", "display_name": "Samuel Liew", "link": "https://stackoverflow.com/users/584192/samuel-liew"}, "edited": false, "score": 0, "creation_date": 1567641273, "post_id": 57795317, "comment_id": 102026626, "body": "Comments are not for extended discussion; this conversation has been <a href=\"https://chat.stackoverflow.com/rooms/198974/discussion-on-question-by-abhay-not-getting-expected-output-from-this-code-using\">moved to chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 10160166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af8fe9419b769d0c196053aa7c8cdf88?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay", "link": "https://stackoverflow.com/users/10160166/abhay"}, "edited": false, "score": 0, "creation_date": 1567630048, "post_id": 57795424, "comment_id": 102023989, "body": "Thanks a lot for clearing that. I had a feeling that this is what was happening here but had to post here to be sure. Thanks a lot"}, {"owner": {"reputation": 647, "user_id": 11923286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6998eee0e8f86bdd85902f148333df9?s=128&d=identicon&r=PG&f=1", "display_name": "ignacio", "link": "https://stackoverflow.com/users/11923286/ignacio"}, "reply_to_user": {"reputation": 161, "user_id": 10160166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af8fe9419b769d0c196053aa7c8cdf88?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay", "link": "https://stackoverflow.com/users/10160166/abhay"}, "edited": false, "score": 0, "creation_date": 1567630208, "post_id": 57795424, "comment_id": 102024054, "body": "I would recommend the &quot;fail fast&quot; approach. Try creating a simple file and printing their values for smaller if statements."}], "tags": [], "owner": {"reputation": 647, "user_id": 11923286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6998eee0e8f86bdd85902f148333df9?s=128&d=identicon&r=PG&f=1", "display_name": "ignacio", "link": "https://stackoverflow.com/users/11923286/ignacio"}, "is_accepted": false, "score": 1, "last_activity_date": 1567629960, "creation_date": 1567629960, "answer_id": 57795424, "question_id": 57795317, "link": "https://stackoverflow.com/questions/57795317/not-getting-expected-output-from-this-code-using-logical-operators-and-pre-post/57795424#57795424", "title": "Not getting expected output from this code using logical operators and pre/post increment", "body": "<p>you may be missing that if statements ends once they are satisfied, so <code>(!i||--j&amp;&amp;k++)</code> is only going to compute <code>i</code> and the other operations are going to be disregarded. By that I mean <code>j</code> is going to be -2 by the end of the first statement.</p>\n"}, {"tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": true, "score": 5, "last_activity_date": 1567630197, "creation_date": 1567630197, "answer_id": 57795471, "question_id": 57795317, "link": "https://stackoverflow.com/questions/57795317/not-getting-expected-output-from-this-code-using-logical-operators-and-pre-post/57795471#57795471", "title": "Not getting expected output from this code using logical operators and pre/post increment", "body": "<p>Let\u2019s spread this out a little to make reading it easier:</p>\n\n<pre><code>int i = 0, j = -2, k=0, m;\n\n(!i || --j &amp;&amp; k++) &amp;&amp; (i++ || j++ &amp;&amp; !k++)\n</code></pre>\n\n<p>As you note <code>!i</code> is true (value 1), so the <code>||</code> is true. The <code>||</code> operator is defined not to evaluate its right operand if the left operand is true, so <code>--j &amp;&amp; k++</code> is not evaluated and has no effect. (The right operand is <code>--j &amp;&amp; k++</code> because <code>&amp;&amp;</code> has higher precedence than <code>||</code>, so <code>A || B &amp;&amp; C</code> is structured as <code>A || (B &amp;&amp; C)</code>.)</p>\n\n<p>That settles the left operand of the central <code>&amp;&amp;</code>. In the right operand, <code>i++</code> increments <code>i</code> to 1 but evaluates to the current value of <code>i</code>, 0, so it is false for the purposes of the <code>||</code> operator. So the right operand of that <code>||</code> is evaluated.</p>\n\n<p>That operand is <code>j++ &amp;&amp; !k++</code>. Since <code>j</code> is \u22122, <code>j++</code> changes <code>j</code> to \u22121 and evaluates to \u22122, which is a value of true for the purposes of <code>&amp;&amp;</code>. Then <code>k++</code> increments <code>k</code> to 1 but evaluates to 0, and <code>!k++</code> changes this to 1, yielding true for the <code>&amp;&amp;</code> and therefore true for the previous <code>||</code> and the central <code>&amp;&amp;</code>.</p>\n\n<p>At this point <code>i</code> is 1, <code>j</code> is \u22121, and <code>k</code> is 1, which is the result you got.</p>\n"}, {"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 6, "last_activity_date": 1567630218, "creation_date": 1567630218, "answer_id": 57795476, "question_id": 57795317, "link": "https://stackoverflow.com/questions/57795317/not-getting-expected-output-from-this-code-using-logical-operators-and-pre-post/57795476#57795476", "title": "Not getting expected output from this code using logical operators and pre/post increment", "body": "<p>The logical AND operator <code>&amp;&amp;</code> and the logical OR operator <code>||</code> are short circuit operators, meaning that the right side won't be evaluated if the result of the expression can be determined from the left side.</p>\n\n<p>So when this subexpression runs:</p>\n\n<pre><code>(!i||--j&amp;&amp;k++) \n</code></pre>\n\n<p>Which is parsed as:</p>\n\n<pre><code>(!i||(--j&amp;&amp;k++)) \n</code></pre>\n\n<p>The left side of the <code>||</code> evaluates to true, so <code>--j&amp;&amp;k++</code> is not evaluated, meaning the value of <code>j</code> remains -2 and the value of <code>k</code> remains 0.</p>\n\n<p>So the left side of the outermost <code>&amp;&amp;</code> is true, so now we evaluate the right side:</p>\n\n<pre><code>(i++||j++&amp;&amp;!k++)\n</code></pre>\n\n<p>Which is parsed as:</p>\n\n<pre><code>(i++||(j++&amp;&amp;!k++))\n</code></pre>\n\n<p><code>i</code> is incremented to 1, then the old value is used in <code>||</code>.  The old value of 0 evaluates to false so the right side is evaluated.  <code>j</code> is incremented to -1 and the old value of -2 evaluates to true, so the right side of <code>&amp;&amp;</code> is evaluated.  <code>k</code> is incremented to 1 and the old value of 0 is applied to the <code>!</code> operator which evaluates to true.  This makes the entire expression true and the statement is printed, at which time <code>i</code> is 1, <code>j</code> is -1, and <code>k</code> is 1.</p>\n"}], "owner": {"reputation": 161, "user_id": 10160166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af8fe9419b769d0c196053aa7c8cdf88?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay", "link": "https://stackoverflow.com/users/10160166/abhay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 57795471, "answer_count": 3, "score": -1, "last_activity_date": 1567653450, "creation_date": 1567629248, "last_edit_date": 1567653450, "question_id": 57795317, "link": "https://stackoverflow.com/questions/57795317/not-getting-expected-output-from-this-code-using-logical-operators-and-pre-post", "title": "Not getting expected output from this code using logical operators and pre/post increment", "body": "<p>I am not getting expected output in the following C code</p>\n\n<pre><code>main(){\n    int i=0,j=-2,k=0,m;\n\n    if((!i||--j&amp;&amp;k++)&amp;&amp;(i++||j++&amp;&amp;!k++))\n    {\n        printf(\"i=%d j=%d k=%d\",i,j,k);\n\n    }\n    return 0;\n}\n</code></pre>\n\n<p>I got the output in compiler as : </p>\n\n<pre><code>i=1 j=-1 k=1\n</code></pre>\n\n<p>But I don't understand what exactly is going on here.</p>\n\n<p>I think the if statement should not run since its argument is false</p>\n\n<p>Note the first bracket     <code>(!i||--j&amp;&amp;k++)</code> </p>\n\n<p>here as <code>!i=1</code> hence this bracket is true since anything with 1 under OR operator will be true.</p>\n\n<p>out values become:    <code>i=0, j=-3, k=1</code></p>\n\n<p>Now notice the second bracket:    <code>(i++||j++&amp;&amp;!k++)</code></p>\n\n<p>Here we have <code>( 0 || -3 &amp;&amp; !1) = 0, false</code></p>\n\n<p>as the brackets are separated by <code>&amp;&amp;</code>, the whole argument of if statement becomes <code>false</code>.</p>\n\n<p>Please explain me where my argument is wrong. I am a new to C</p>\n"}, {"tags": ["c", "linux", "usb", "raspbian", "usbserial"], "comments": [{"owner": {"reputation": 100758, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 1, "creation_date": 1567626326, "post_id": 57794862, "comment_id": 102022926, "body": "Why don&#39;t you have a look at what MiniCom&amp;co does using <code>strace</code>"}, {"owner": {"reputation": 9, "user_id": 11845965, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R5iCs.png?s=128&g=1", "display_name": "cone1018", "link": "https://stackoverflow.com/users/11845965/cone1018"}, "reply_to_user": {"reputation": 100758, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1567684406, "post_id": 57794862, "comment_id": 102041468, "body": "Thanks for the suggestion, I added it to the question."}], "answers": [{"tags": [], "owner": {"reputation": 78, "user_id": 11517312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2128e933421d3a5ba6a72f6f9208dc73?s=128&d=identicon&r=PG&f=1", "display_name": "lorenz", "link": "https://stackoverflow.com/users/11517312/lorenz"}, "is_accepted": false, "score": 0, "last_activity_date": 1567695925, "creation_date": 1567695925, "answer_id": 57808305, "question_id": 57794862, "link": "https://stackoverflow.com/questions/57794862/why-does-read-not-terminate-for-my-usb-device/57808305#57808305", "title": "Why does read not terminate for my USB device?", "body": "<p>Seems like the device has never taken the request, so its never processing and getting blocked. so, something prob in the way the request is written. Did you try setting the speed of the port/interface? </p>\n"}, {"tags": [], "owner": {"reputation": 9, "user_id": 11845965, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R5iCs.png?s=128&g=1", "display_name": "cone1018", "link": "https://stackoverflow.com/users/11845965/cone1018"}, "is_accepted": false, "score": 0, "last_activity_date": 1567763311, "creation_date": 1567763311, "answer_id": 57819623, "question_id": 57794862, "link": "https://stackoverflow.com/questions/57794862/why-does-read-not-terminate-for-my-usb-device/57819623#57819623", "title": "Why does read not terminate for my USB device?", "body": "<p>I found the Answer myself: the ICANON bit in the termios struct, c_lflag field musst be cleared and the VMIN field in the c_cc array should be set to 1.</p>\n\n<p>Further explanations are found here:</p>\n\n<p><a href=\"https://www.gnu.org/software/libc/manual/html_node/Local-Modes.html#Local-Modes\" rel=\"nofollow noreferrer\">https://www.gnu.org/software/libc/manual/html_node/Local-Modes.html#Local-Modes</a>\n<a href=\"https://www.gnu.org/software/libc/manual/html_node/Mode-Data-Types.html\" rel=\"nofollow noreferrer\">https://www.gnu.org/software/libc/manual/html_node/Mode-Data-Types.html</a></p>\n\n<p>(be carefull, some parts of this documentary are a little bit outdated, for example the CCTS_OFLOW Flag does not exist on Raspbian-Buster)</p>\n"}], "owner": {"reputation": 9, "user_id": 11845965, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R5iCs.png?s=128&g=1", "display_name": "cone1018", "link": "https://stackoverflow.com/users/11845965/cone1018"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1567763311, "creation_date": 1567625874, "last_edit_date": 1567684382, "question_id": 57794862, "link": "https://stackoverflow.com/questions/57794862/why-does-read-not-terminate-for-my-usb-device", "title": "Why does read not terminate for my USB device?", "body": "<p>I have an USB-device connected with my RaspberryPi 3 B+ (Raspbian Buster Lite 2019-07-10). I also write an small program to read data from the USB Device. The device has an custom, CDC conform firmware, so the device is detected correctly by the OS and and tty is attached.</p>\n\n<p>But when I call 'read' for the device, the syscall never terminates. The odd thing is, when I access the device with MiniCom, CuteCom or even H-Term, it works correct. </p>\n\n<p>I already tried the answers from the following questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/18108932/reading-and-writing-to-serial-port-in-c-on-linux\">Reading and writing to serial port in C on Linux</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/6947413/how-to-open-read-and-write-from-serial-port-in-c\">How to open, read, and write from serial port in C?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/19024663/c-program-to-read-data-from-usb-device-connected-to-the-system\">C program to read data from USB device connected to the system</a></p>\n\n<p>None of them worked.</p>\n\n<p>I also tried to flush the tty with tcflush and tcdrain.</p>\n\n<pre><code>int dev = open(\"/dev/ttyACM0\", O_RWDR | O_NOCTTY);\n\n// I tried to adapt the device parameters with termios, see above\n\nuint8_t req[] = {0x21, 0x42, 0x00, 0x12}; // the actual request\nwrite(dev, req, 4);\n\nuint8_t resp[12];\nread(dev, resp, 8); // does not terminate\n</code></pre>\n\n<p>I expect a result, 12 bytes long, but read just blocks. If I try the O_NONBLOCK/O_NDELAY option, read terminates with the EAGAIN error.</p>\n\n<p>Of course I checked the result values from every syscall and library function, they all returned/terminated as expected. And as I mentioned above, when connected with a terminal program the device works how it should, so it can't be the firmware.</p>\n\n<p>Also I traced with strace what minicom and cutecom did, but they also did nothing more than open, write and read and of course I tried everything with sudo, so the rights are not the problem.</p>\n"}, {"tags": ["c", "string", "substring", "longest-substring"], "comments": [{"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 2, "creation_date": 1567624865, "post_id": 57794594, "comment_id": 102022381, "body": "This feels like a homework question. We aren&#39;t here to do your work for you. Please show us what you&#39;ve come up with so far."}, {"owner": {"reputation": 11, "user_id": 12021646, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBw25iIfoYSO8YunT-CA-tnMaiKQPf4Vo16uglvabY=k-s128", "display_name": "Milica Simic", "link": "https://stackoverflow.com/users/12021646/milica-simic"}, "edited": false, "score": 0, "creation_date": 1567624991, "post_id": 57794594, "comment_id": 102022428, "body": "Sorry, I&#39;m new here, and I don&#39;t know how to share my code with you. This is not homework, I am beginner in C programming and now I practice."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1567625132, "post_id": 57794594, "comment_id": 102022476, "body": "If you are new take the <a href=\"https://stackoverflow.com/tour\">tour</a>."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1567625307, "post_id": 57794594, "comment_id": 102022548, "body": "&quot;I know to count and find length&quot;, good, please show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> of how you do that. That way you could probably get out of the &quot;on hold&quot; status for being too broad."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1567625542, "post_id": 57794594, "comment_id": 102022624, "body": "To share your code, <a href=\"https://stackoverflow.com/posts/57794594/edit\">edit</a> your question and paste it here. You can  try to format it, but that would probably even be done by a helpfully-minded user for you."}, {"owner": {"reputation": 11, "user_id": 12021646, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBw25iIfoYSO8YunT-CA-tnMaiKQPf4Vo16uglvabY=k-s128", "display_name": "Milica Simic", "link": "https://stackoverflow.com/users/12021646/milica-simic"}, "edited": false, "score": 0, "creation_date": 1567625599, "post_id": 57794594, "comment_id": 102022646, "body": "Now i will try to share my code with you, i am just looking for a way to do this."}, {"owner": {"reputation": 11, "user_id": 12021646, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBw25iIfoYSO8YunT-CA-tnMaiKQPf4Vo16uglvabY=k-s128", "display_name": "Milica Simic", "link": "https://stackoverflow.com/users/12021646/milica-simic"}, "edited": false, "score": 0, "creation_date": 1567625629, "post_id": 57794594, "comment_id": 102022659, "body": "Yunnosch Thank for help!"}, {"owner": {"reputation": 11, "user_id": 12021646, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBw25iIfoYSO8YunT-CA-tnMaiKQPf4Vo16uglvabY=k-s128", "display_name": "Milica Simic", "link": "https://stackoverflow.com/users/12021646/milica-simic"}, "edited": false, "score": 0, "creation_date": 1567626219, "post_id": 57794594, "comment_id": 102022896, "body": "I think I share code now"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11080906, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FnLAy.jpg?s=128&g=1", "display_name": "mrK", "link": "https://stackoverflow.com/users/11080906/mrk"}, "is_accepted": false, "score": 0, "last_activity_date": 1567690198, "last_edit_date": 1567690198, "creation_date": 1567678847, "answer_id": 57803329, "question_id": 57794594, "link": "https://stackoverflow.com/questions/57794594/how-to-print-the-longest-substring-of-vowels/57803329#57803329", "title": "How to print the longest substring of vowels", "body": "<p><strong>It is very similar to the counting of the longest vowel substring.</strong></p>\n\n<p><strong><em>First</em></strong>, you will need two more arrays(for storing current sequence of vowels and longest overall string) and an int value(for being able to go trough arrays independently of the \"for loop\").</p>\n\n<pre><code>char maxString[100] = \"\", currentString[100];\nint count = 0, maxCount = 0;\nint k = 0;\n</code></pre>\n\n<p><strong><em>Second</em></strong>, you dont need two nested for loops for this, one is enough.Just check if the current char is vowel.If it is increase the \"count\" int variable by one and store it inside the \"currentString\", if it is not check if the \"count\" value is bigger than \"maxCount\" value and if it is set the \"maxString\" equal to \"currentString\" and than set the \"count\" value back to 0, so next sequence can be checked in next loop when first next vowel is found.</p>\n\n<p>inside of \"i\" for loop,\nif it is a vowel:</p>\n\n<pre><code>        count++;\n        currentString[k++] = s[i];\n</code></pre>\n\n<p>else if it is not a vowel:</p>\n\n<pre><code>if (count &gt; maxCount) {\n            strcpy(maxString, currentString);\n            maxCount = count;\n        }\n        count = 0;\n        k = 0;\n        strcpy(currentString, \"\");\n    }\n</code></pre>\n\n<p>This should probably help a bit, i didnt give you whole solution so you can try to do it by yourself.</p>\n\n<p>Also your \"printf\" function is outside of the for loop and wont print the max value.If the \"count\" is greater than the \"maxCount\" should be checked at the end of the for loop.And an advice would be to think about not using the for loop for checking if the char is a vowel, there is a more efficient way using ascii.</p>\n"}], "owner": {"reputation": 11, "user_id": 12021646, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBw25iIfoYSO8YunT-CA-tnMaiKQPf4Vo16uglvabY=k-s128", "display_name": "Milica Simic", "link": "https://stackoverflow.com/users/12021646/milica-simic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 972, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1567690198, "creation_date": 1567624630, "last_edit_date": 1567626446, "question_id": 57794594, "link": "https://stackoverflow.com/questions/57794594/how-to-print-the-longest-substring-of-vowels", "title": "How to print the longest substring of vowels", "body": "<p>I don't know how to PRINT the longest substring of vowels. I know to count and find length of the longest substring, but I don't know how to print. \nThis is example:\n<strong>Input</strong>: 12 fg aaa bvcf ssd ae\n<strong>Output</strong>: aaa</p>\n\n<pre><code>    ```\n    int isVowel(char c) {\n    char vowels[] = { \"aeiouAEIOU\" };\n    int length = strlen(vowels);\n    int i;\n    for (i = 0; i &lt; length; i++) {\n    if (c == vowels[i]) return 1;\n    }\n    return 0;\n    }\n\n    void theLongestSubstring(char s[]) {\n    int length = strlen(s);\n    int i, j;\n    char newString[100];\n    int br = 0;\n    int count;\n    int maxCount = 0;\n    for (i = 0; i &lt; (length - 1); i++) {\n    count = 1;\n    if (isVowel(s[i]) == 1) {\n        for (j = i + 1; j &lt; length; j++) {\n            if (isVowel(s[j]) == 1) {\n                count++;\n            }\n            else {\n                break;\n            }\n         }\n       }\n     }\n    if (count &gt; maxCount) {\n    maxCount = count;\n     }\n    //newString[br] = '\\0';\n    printf(\"Length of the longest substring of vowels is:\\n*** %d ***\\n\", \n    maxCount);\n    }\n    ```\n</code></pre>\n"}, {"tags": ["c", "sockets", "tcp", "udp"], "comments": [{"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 2, "creation_date": 1567625248, "post_id": 57794550, "comment_id": 102022525, "body": "There&#39;s already a standard protocol for this: <a href=\"https://tools.ietf.org/html/rfc1350\" rel=\"nofollow noreferrer\">TFTP</a>"}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1567629795, "post_id": 57794550, "comment_id": 102023897, "body": "&quot;<i>for now im using UDP socket</i>&quot; - why did you choose UDP and not TCP?"}, {"owner": {"reputation": 56858, "user_id": 131930, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/91536fe27d32713b8a154a0bf42f6748?s=128&d=identicon&r=PG", "display_name": "Jeremy Friesner", "link": "https://stackoverflow.com/users/131930/jeremy-friesner"}, "edited": false, "score": 0, "creation_date": 1567642755, "post_id": 57794550, "comment_id": 102026883, "body": "If your goal is simply to transfer files (and not e.g. to learn about how to transfer files using UDP) then using TCP will be much less work than using UDP."}], "answers": [{"tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": false, "score": 0, "last_activity_date": 1567629747, "creation_date": 1567629747, "answer_id": 57795388, "question_id": 57794550, "link": "https://stackoverflow.com/questions/57794550/sending-large-files-over-udp/57795388#57795388", "title": "Sending large files over UDP", "body": "<blockquote>\n  <p>I've read that UDP can only handle about 64kB packet, is it true?</p>\n</blockquote>\n\n<p>Yes. So you will have to break up larger files into smaller packets and send them individually. And know that UDP is unreliable - packet delivery is not guaranteed at all, and packets are not guaranteed to arrive in the same order in which they are sent - so you have to add reliability into your transfer protocol - send back ACKs for received packets, use sequence numbers in each packet, etc, so the receiver knows which packets go in which order, and the sender can know which packets the receiver is missing so they can be resent.</p>\n\n<blockquote>\n  <p>Will switching to TCP solve my problem?</p>\n</blockquote>\n\n<p>Yes, as it has delivery and integrity guarantees built in.  Though, UDP <em>can</em> work, too (protocols like <a href=\"https://tools.ietf.org/html/rfc1350\" rel=\"nofollow noreferrer\">Trivial FTP</a> are proof of that).</p>\n"}, {"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 1, "last_activity_date": 1567630903, "creation_date": 1567630903, "answer_id": 57795598, "question_id": 57794550, "link": "https://stackoverflow.com/questions/57794550/sending-large-files-over-udp/57795598#57795598", "title": "Sending large files over UDP", "body": "<p>UDP is an unreliable protocol.  If a packet gets lost you need a way for the receiver to inform the sender so it can retransmit the packet.  The receiver also needs to allow for packets to be received out of order.</p>\n\n<p>Using TCP will solve this for you, since it has reliability built in and data is guaranteed to arrive in order.</p>\n\n<p>Adding this reliability to UDP is not trivial but it can be done.  Shameless plug: <a href=\"http://uftp-multicast.sourceforge.net/\" rel=\"nofollow noreferrer\">UFTP</a> does this and supports multicast.</p>\n"}], "owner": {"reputation": 29, "user_id": 7211314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/325ac495e2175169b8b2f7fa2f605357?s=128&d=identicon&r=PG&f=1", "display_name": "ylwester", "link": "https://stackoverflow.com/users/7211314/ylwester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2429, "favorite_count": 1, "answer_count": 2, "score": -1, "last_activity_date": 1567630903, "creation_date": 1567624377, "question_id": 57794550, "link": "https://stackoverflow.com/questions/57794550/sending-large-files-over-udp", "title": "Sending large files over UDP", "body": "<p>Im trying to create app that will allow for client to upload file to server and for now im using UDP socket.</p>\n\n<p>Im sending data over UDP and it works for small size file, and when i try to send like 1 MB it doesn't send full data.</p>\n\n<p>I've read that UDP can only handle about 64kB packet, is it true? Can i somehow handle it and fix my problem?</p>\n\n<p>My code for sending files:</p>\n\n<pre><code>        sendto(fdsocket, sizeBuff, sizeof(sizeBuff), 0, (struct sockaddr*)&amp;serverAddress, addrlen); // send file size\n            while(1) {\n                //Read file in chunks of 1024 bytes\n                int nread = fread(buff, 1, BUFF_SIZE, filefp);\n\n                printf(\"Bytes read %d \\n\", nread);\n\n\n                // If read was success, send data\n\n                if(nread &gt; 0){\n                    printf(\"Sending file ...\\n\");\n\n                    int n = sendto(fdsocket, buff, strlen(buff), 0, (struct sockaddr *) &amp;serverAddress, addrlen);\n</code></pre>\n\n<p>and my code for receiving files:</p>\n\n<pre><code>        recvfrom(fdsocket, sizeBuff, sizeof(sizeBuff), 0, (struct sockaddr *)&amp;serverAddress, &amp;addrlen); // recv file size\n        filesize = sizeBuff[0];\n        printf(\"Filesize: %lu\", filesize);\n\n        //recvfrom(fdsocket, buff, BUFF_SIZE, 0, (struct sockaddr *)&amp;serverAddress, &amp;addrlen);\n\n        if(sizeBuff[0] &gt; 0){\n            while(sumBytes&lt;filesize){\n                /* Receive data in chunks of 1024 bytes */\n                bytesReceived = recvfrom(fdsocket, buff, sizeof(buff), 0, (struct sockaddr*)&amp;serverAddress, &amp;addrlen);\n                if(bytesReceived &lt; 0) {\n                    printf(\"Recvfrom: Error in receiving the file\\n\");\n                    exit(1);\n                } else {\n                    sumBytes = sumBytes + bytesReceived;\n                    printf(\"Bytes received: %d\\n\", sumBytes);\n                }\n                if(fwrite(buff, 1, bytesReceived, fp)&lt;0){\n                    printf(\"ERROR writing file\");\n                    exit(1);\n                }\n</code></pre>\n\n<p>I want it to work with big files, like 100MB, and also allow me to send jpg, xls and other.</p>\n\n<p>How can i do that? Will switching to TCP solve my problem?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567625377, "post_id": 57794233, "comment_id": 102022574, "body": "Don&#39;t use <code>assert</code> like this; only for expressions that don&#39;t have side effects."}], "answers": [{"comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567625554, "post_id": 57794313, "comment_id": 102022628, "body": "I think there&#39;s a reason that the function was declared <code>static</code>. Perhaps suggest to use <code>static char s[64];</code>? Also, you may want to discourage from using <code>assert</code> on an expression that has side-effects."}, {"owner": {"reputation": 1750, "user_id": 3864685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcd0d8ab040f481989e93b910c38c957?s=128&d=identicon&r=PG&f=1", "display_name": "Ashwani", "link": "https://stackoverflow.com/users/3864685/ashwani"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567634603, "post_id": 57794313, "comment_id": 102025349, "body": "@JL2210 making a function <code>static</code> just restricts its access to the same compilation unit, it is very different from storage class <code>static</code>. And <code>assert</code> is there to show the context of code changed, it was already there in OP&#39;s code."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567635357, "post_id": 57794313, "comment_id": 102025509, "body": "Ah right. Forgot about how <code>static</code> applies to functions. However, you may add a note about <code>assert</code>; this code wouldn&#39;t work with <code>NDEBUG</code> defined."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567635570, "post_id": 57794313, "comment_id": 102025551, "body": "Note that <code>sizeof(char)</code> is 1 by definition and <code>int</code> is not the proper type for sizes; use <code>size_t</code> instead."}], "tags": [], "owner": {"reputation": 1750, "user_id": 3864685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcd0d8ab040f481989e93b910c38c957?s=128&d=identicon&r=PG&f=1", "display_name": "Ashwani", "link": "https://stackoverflow.com/users/3864685/ashwani"}, "is_accepted": true, "score": 0, "last_activity_date": 1567623198, "creation_date": 1567623198, "answer_id": 57794313, "question_id": 57794233, "link": "https://stackoverflow.com/questions/57794233/how-do-i-get-a-string-from-a-function-and-assign-to-it/57794313#57794313", "title": "How do I get a string from a function and assign to it?", "body": "<p><code>char s[64]</code> is stack allocated array and you are returning a pointer to this, which is undefined behaviour. Allocate <code>s</code> on heap instead.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>int sz = 64 * sizeof(char);\nchar *s = malloc(sz);\nassert(strftime(s, sz, \"%c\", tm));\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 9765541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6700dc1dc9c3ee73eff0d07ecbfffe31?s=128&d=identicon&r=PG&f=1", "display_name": "Rata", "link": "https://stackoverflow.com/users/9765541/rata"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 1, "closed_date": 1567623525, "accepted_answer_id": 57794313, "answer_count": 1, "score": -2, "last_activity_date": 1567625667, "creation_date": 1567622843, "last_edit_date": 1567625667, "question_id": 57794233, "link": "https://stackoverflow.com/questions/57794233/how-do-i-get-a-string-from-a-function-and-assign-to-it", "closed_reason": "Duplicate", "title": "How do I get a string from a function and assign to it?", "body": "<p>I have my function <code>print_date_time</code> which I want to return the date as a string. I then want to assign that time to a new variable and print it in <code>main</code>. After that, I want to use it in another function.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdbool.h&gt;\n#include &lt;windows.h&gt;\n#include &lt;time.h&gt;\n#include &lt;assert.h&gt;\nstatic char* print_date_time()\n{\n\n    time_t t = time(NULL);\n    struct tm* tm = localtime(&amp;t);\n    char s[64];\n    assert(strftime(s, sizeof(s), \"%c\", tm));\n    //printf(\"TIME TIME: %s\\n\", s); \n    return s;\n}\n\n/****************************************\n*\n* MAIN FUNCTION\n*\n****************************************/\nint main(int argc, char** argv)\n{\n    char *date;\n\n\n    date = print_date_time();\n    printf(\"time is: %s\\n\",date);\n\n\n    //assert(strftime(tab, sizeof(tab), \"%c\", print_date_time()));\n    //print_date_time();\n\n    return 0;\n}\n\n</code></pre>\n\n<p>I expect the current time.</p>\n\n<p>How do I get a string from a function and assign to it?</p>\n"}, {"tags": ["c", "linux", "assembly", "x86", "abi"], "comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 5, "creation_date": 1567626042, "post_id": 57794171, "comment_id": 102022837, "body": "You can&#39;t <code>pop</code> a <code>char</code>. You can pop a word."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1615266666, "post_id": 57794171, "comment_id": 117631473, "body": "Possible duplicate (for stack-args conventions at least): <a href=\"https://stackoverflow.com/q/30679702\">Why function parameter occupy at least 4 bytes stack on x86?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 11847388, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IganZ5uZwEw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdODecJU5dbNY90HrsnfVzXfBhhBQ/photo.jpg?sz=128", "display_name": "Yevhen Grushko", "link": "https://stackoverflow.com/users/11847388/yevhen-grushko"}, "edited": false, "score": 0, "creation_date": 1567625057, "post_id": 57794223, "comment_id": 102022452, "body": "Im bad at assembly but i dont understand why it will be costly. If you passed word size arguments you are getting them like this &quot;mov -8(%ebp) %ecx mov -12(%ebp) %edx etc.&quot;. In my example it will be like this  &quot;movb -8(%ebp) %ecx movb -9(%ebp) %edx etc.&quot;. Maybe i dont understand something."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 91, "user_id": 11847388, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IganZ5uZwEw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdODecJU5dbNY90HrsnfVzXfBhhBQ/photo.jpg?sz=128", "display_name": "Yevhen Grushko", "link": "https://stackoverflow.com/users/11847388/yevhen-grushko"}, "edited": false, "score": 6, "creation_date": 1567630384, "post_id": 57794223, "comment_id": 102024125, "body": "@yevhen: Most arguments are passed in registers."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1567633752, "post_id": 57794223, "comment_id": 102025164, "body": "@Note that the calling convention actually packs 4 chars into a single register, if they are members of an argument of structure type."}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "reply_to_user": {"reputation": 91, "user_id": 11847388, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IganZ5uZwEw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdODecJU5dbNY90HrsnfVzXfBhhBQ/photo.jpg?sz=128", "display_name": "Yevhen Grushko", "link": "https://stackoverflow.com/users/11847388/yevhen-grushko"}, "edited": false, "score": 0, "creation_date": 1567641448, "post_id": 57794223, "comment_id": 102026656, "body": "@YevhenGrushko AFAIK <code>movb</code> requires a byte-sized destination, i.e. those instructions don&#39;t exist."}, {"owner": {"reputation": 91, "user_id": 11847388, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IganZ5uZwEw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdODecJU5dbNY90HrsnfVzXfBhhBQ/photo.jpg?sz=128", "display_name": "Yevhen Grushko", "link": "https://stackoverflow.com/users/11847388/yevhen-grushko"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1567659934, "post_id": 57794223, "comment_id": 102030002, "body": "@rici In my example i wrote about i386"}, {"owner": {"reputation": 91, "user_id": 11847388, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IganZ5uZwEw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdODecJU5dbNY90HrsnfVzXfBhhBQ/photo.jpg?sz=128", "display_name": "Yevhen Grushko", "link": "https://stackoverflow.com/users/11847388/yevhen-grushko"}, "edited": false, "score": 0, "creation_date": 1567672999, "post_id": 57794223, "comment_id": 102035205, "body": "Ive made mistake in my first comment. To get arguments in the current calling convention you should do &quot;mov 0x8(%ebp) %ecx mov 0xc(%ebp) %ebx mov 0x10(%ebp) %edx mov 0x14(%ebp) %eax &quot;, but in my example it will be &quot;movsbl 0x8(%ebp) %ecx movsbl 0x9(%ebp) %ebx movsbl 0xa(%ebp) %edx movsbl 0xb(%ebp) %eax&quot;"}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "reply_to_user": {"reputation": 91, "user_id": 11847388, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IganZ5uZwEw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdODecJU5dbNY90HrsnfVzXfBhhBQ/photo.jpg?sz=128", "display_name": "Yevhen Grushko", "link": "https://stackoverflow.com/users/11847388/yevhen-grushko"}, "edited": false, "score": 1, "creation_date": 1567699000, "post_id": 57794223, "comment_id": 102049907, "body": "@YevhenGrushko Yeah, that would work, but note that it is still a non-aligned access, so it is likely reading 4-bytes nevertheless and doing some massaging under the hood. I don&#39;t know about the exact performance, feel free to measure in a recent CPU!"}], "tags": [], "owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "is_accepted": false, "score": 2, "last_activity_date": 1567622823, "creation_date": 1567622823, "answer_id": 57794223, "question_id": 57794171, "link": "https://stackoverflow.com/questions/57794171/why-arguments-size-of-function-is-increased-to-word-size/57794223#57794223", "title": "Why argument&#39;s size of function is increased to word size?", "body": "<p>Putting the 4 <code>char</code>s in a single register (or stack location) would require creating and afterwards extracting the individual parameters, which is costly in terms of instructions. Note that even if you are talking about the stack, the memory access should be very quick given it will be most likely in the cache.</p>\n\n<p>If you really want to save that much space, you can still do it yourself using a single 4-byte argument.</p>\n"}, {"tags": [], "owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "is_accepted": false, "score": 0, "last_activity_date": 1567636376, "creation_date": 1567636376, "answer_id": 57796350, "question_id": 57794171, "link": "https://stackoverflow.com/questions/57794171/why-arguments-size-of-function-is-increased-to-word-size/57796350#57796350", "title": "Why argument&#39;s size of function is increased to word size?", "body": "<p>I think the original C authors had their eye on portability and maintainability more than squeezing every byte and cycle.   Not that C is careless with resources, but appropriate trade-offs were made.</p>\n\n<p>Promoting each parameter to the stack granule size made sense, and really still does.   If you are desperate to squeeze it in, you could always replace:</p>\n\n<pre><code>int f(int a, int b, int c, int d) { ... }\n</code></pre>\n\n<p>with</p>\n\n<pre><code>struct fparm { char a,b,c,d; }; int f(struct fparm a) { ... }\n</code></pre>\n\n<p>Modern C compilers are not so user friendly; or rather their only friend is a luser named benchmark....</p>\n"}, {"comments": [{"owner": {"reputation": 91, "user_id": 11847388, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IganZ5uZwEw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdODecJU5dbNY90HrsnfVzXfBhhBQ/photo.jpg?sz=128", "display_name": "Yevhen Grushko", "link": "https://stackoverflow.com/users/11847388/yevhen-grushko"}, "edited": false, "score": 0, "creation_date": 1567673115, "post_id": 57799146, "comment_id": 102035269, "body": "To get arguments in the current calling convention you should do &quot;mov 0x8(%ebp) %ecx mov 0xc(%ebp) %ebx mov 0x10(%ebp) %edx mov 0x14(%ebp) %eax &quot;, but in my example it will be &quot;movsbl 0x8(%ebp) %ecx movsbl 0x9(%ebp) %ebx movsbl 0xa(%ebp) %edx movsbl 0xb(%ebp) %eax&quot; Is it slower?"}, {"owner": {"reputation": 14659, "user_id": 2705055, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b1d5dfaf239229501a184c8858fbc954?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Rosenau", "link": "https://stackoverflow.com/users/2705055/martin-rosenau"}, "reply_to_user": {"reputation": 91, "user_id": 11847388, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IganZ5uZwEw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdODecJU5dbNY90HrsnfVzXfBhhBQ/photo.jpg?sz=128", "display_name": "Yevhen Grushko", "link": "https://stackoverflow.com/users/11847388/yevhen-grushko"}, "edited": false, "score": 1, "creation_date": 1567799006, "post_id": 57799146, "comment_id": 102085621, "body": "@YevhenGrushko Reading the parameters: No. The problem is writing the parameters. In the 1980s or 1990s, when the System V calling convention was developed, most compilers used the <code>push</code> instruction to put the arguments on the stack. And you cannot <code>push</code> 8-bit values."}], "tags": [], "owner": {"reputation": 14659, "user_id": 2705055, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b1d5dfaf239229501a184c8858fbc954?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Rosenau", "link": "https://stackoverflow.com/users/2705055/martin-rosenau"}, "is_accepted": false, "score": 2, "last_activity_date": 1567662716, "creation_date": 1567662716, "answer_id": 57799146, "question_id": 57794171, "link": "https://stackoverflow.com/questions/57794171/why-arguments-size-of-function-is-increased-to-word-size/57799146#57799146", "title": "Why argument&#39;s size of function is increased to word size?", "body": "<blockquote>\n  <p>Isn't it more efficient to ...</p>\n</blockquote>\n\n<p>You always have to say what you want to optimize:</p>\n\n<ul>\n<li>Fast execution speed</li>\n<li>Small program size</li>\n<li>Less stack usage</li>\n<li>Simpler compilers</li>\n<li>...</li>\n</ul>\n\n<p>If you want to optimize for less stack usage, passing bytes to the function really would be more efficient.</p>\n\n<p>However, normally you want to optimize for fast execution speed or small program size.</p>\n\n<p>Unlike modern compilers (that <code>mov</code> the arguments to the stack) most compilers written in the 1990s I know <code>push</code> the arguments to the stack. If a compiler uses <code>push</code> operations, putting bytes to the stack would be rather complex - it would make the program slow and long.</p>\n\n<p>(Note that I have never seen that a <code>pop</code> operation is done on a parameter.)</p>\n"}], "owner": {"reputation": 91, "user_id": 11847388, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IganZ5uZwEw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdODecJU5dbNY90HrsnfVzXfBhhBQ/photo.jpg?sz=128", "display_name": "Yevhen Grushko", "link": "https://stackoverflow.com/users/11847388/yevhen-grushko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1567662716, "creation_date": 1567622642, "question_id": 57794171, "link": "https://stackoverflow.com/questions/57794171/why-arguments-size-of-function-is-increased-to-word-size", "title": "Why argument&#39;s size of function is increased to word size?", "body": "<p>I read System V ABI for i386 and AMD64. They are telling that arguments must be rounded to multiple of word size. And i dont understand why.</p>\n\n<p>Here is situation. If you pass 4 char arguments to a function on i386 architecture it will take 16 bytes (4 bytes for each char argument). Isn't it more efficient to allocate only 4 bytes for all 4 arguments like it should be with local variables? </p>\n\n<p>Alignment is not the answer. Because it could take 4-12 bytes padding for 16 byte stack alignment in both situiation.</p>\n"}, {"tags": ["c", "sqlite", "dtrace"], "comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567901649, "post_id": 57794128, "comment_id": 102104728, "body": "What do you mean by &quot;trace the address of the second pointer&quot;?"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567903043, "post_id": 57794128, "comment_id": 102104873, "body": "What is <code>copyin</code>? What is it declared as? What happens if you remove the cast?"}, {"owner": {"reputation": 762, "user_id": 4949386, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/a4f78608dae9e9cf14a732e366ea016a?s=128&d=identicon&r=PG&f=1", "display_name": "zino", "link": "https://stackoverflow.com/users/4949386/zino"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567947384, "post_id": 57794128, "comment_id": 102111725, "body": "I mean I just want to print the address of the second pointer in hex. The first pointer is provided as <code>arg1</code> in the <code>entry</code> probe. <code>copyin</code> is a DTrace global function for moving data from a user process to the kernel where the DTrace process runs  (as I understand it). <a href=\"http://dtrace.org/guide/dtrace-ebook.pdf#page=117\" rel=\"nofollow noreferrer\">dtrace.org/guide/dtrace-ebook.pdf#page=117</a>"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567948176, "post_id": 57794128, "comment_id": 102111897, "body": "No need to include your tags in the question title. I already understand this is a DTrace question."}, {"owner": {"reputation": 762, "user_id": 4949386, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/a4f78608dae9e9cf14a732e366ea016a?s=128&d=identicon&r=PG&f=1", "display_name": "zino", "link": "https://stackoverflow.com/users/4949386/zino"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 2, "creation_date": 1568317981, "post_id": 57794128, "comment_id": 102246312, "body": "Why the down votes?"}, {"owner": {"reputation": 130, "user_id": 7001565, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lCfV7.png?s=128&g=1", "display_name": "Antonio Nikishaev", "link": "https://stackoverflow.com/users/7001565/antonio-nikishaev"}, "edited": false, "score": 0, "creation_date": 1577043206, "post_id": 57794128, "comment_id": 105077458, "body": "@zino Have you figured out it?  But the answer is: yes, it is SIP."}], "answers": [{"comments": [{"owner": {"reputation": 762, "user_id": 4949386, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/a4f78608dae9e9cf14a732e366ea016a?s=128&d=identicon&r=PG&f=1", "display_name": "zino", "link": "https://stackoverflow.com/users/4949386/zino"}, "edited": false, "score": 0, "creation_date": 1567947700, "post_id": 57840390, "comment_id": 102111804, "body": "The <code>sqlite3_open</code> call in my code is working as intended. What I am trying to do is get the hex address of that second pointer in my DTrace script (not my program)."}, {"owner": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "reply_to_user": {"reputation": 762, "user_id": 4949386, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/a4f78608dae9e9cf14a732e366ea016a?s=128&d=identicon&r=PG&f=1", "display_name": "zino", "link": "https://stackoverflow.com/users/4949386/zino"}, "edited": false, "score": 0, "creation_date": 1567983795, "post_id": 57840390, "comment_id": 102119886, "body": "@zino , I don&#39;t know if my edit helped. I hope it did... I wish your question included an example I could fiddle with."}, {"owner": {"reputation": 39687, "user_id": 79566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edad7f3ab41c3bdfdf851759dce5c33b?s=128&d=identicon&r=PG", "display_name": "bta", "link": "https://stackoverflow.com/users/79566/bta"}, "edited": false, "score": 0, "creation_date": 1568162592, "post_id": 57840390, "comment_id": 102183864, "body": "This usage is common with <i>opaque pointers</i>, where the implementation of a struct is hidden from the end user (like <code>FILE</code> in the standard library).  Sometimes it can be easier to mentally trace these things if you bundle up that lowest level of pointers with something like <code>typedef sqlite3* pdb</code>."}], "tags": [], "owner": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "is_accepted": false, "score": 6, "last_activity_date": 1568318633, "last_edit_date": 1568318633, "creation_date": 1567932212, "answer_id": 57840390, "question_id": 57794128, "link": "https://stackoverflow.com/questions/57794128/following-a-pointer-to-a-pointer/57840390#57840390", "title": "Following a pointer to a pointer", "body": "<p>I may be misunderstanding your question, but what I suspect is that you've misunderstood how <code>sqlite3_open</code> works.</p>\n\n<p>To call <code>sqlite3_open</code> you should have a code that looks like this:</p>\n\n<pre><code>sqlite3 * pDB = NULL;\n/* ... */\nint result = sqlite3_open(\"file:database.db\", &amp;pDB);\n</code></pre>\n\n<p>As you see, there's no \"pointer to pointer\" <strong>variable</strong> in my code. Instead, <code>sqlite3_ope</code> takes the address of of a pointer variable I allocated on the stack.</p>\n\n<p>To copy that pointer is as simple as:</p>\n\n<pre><code> sqlite3 * pDB2 = pDB\n</code></pre>\n\n<h3>The reason for this is simple:</h3>\n\n<p>The <code>sqlite3_open</code> function wants to return two variable, which is impossible in C.</p>\n\n<p>Instead of returning two variables, <code>sqlite3_open</code> returns only one variable directly and returns the second variable indirectly.</p>\n\n<p>In order to return the second, it takes a pointer to a variable of the same type it wants to return. Then, by dereferencing the address and filling in the value, it provides you with the second variable's value.</p>\n\n<p>However, the second variable <code>sqlite3_open</code> returns is a pointer. This is why, in order to return a pointer as a second variable, <code>sqlite3_open</code> requires a pointer to a pointer variable. </p>\n\n<h3>Reading the address</h3>\n\n<p>In the example above, the <code>pDB</code> variable holds the address for the sqlite3 object (the one allocated by <code>sqlite3_open</code>).</p>\n\n<p>The address, as you know, is simply a number representing a location in the memory. To read the pointer value as a number, simply cast the pointer to a <code>uintptr_t</code>. i.e.:</p>\n\n<pre><code> uintptr_t db_mem_addr_value = (uintptr_t)pDB;\n</code></pre>\n\n<p>Of course, numbers (and memory addresses) can't be printed as hex strings directly, they need a function that will convert them into hex notation.</p>\n\n<p>Consider that in C you would print the memory address in Hex notation by using <code>printf</code> i.e.,</p>\n\n<pre><code> fprintf(stderr, \"%p\\n\", (void *)pDB);\n</code></pre>\n\n<p>Using dtrace would be the same. You might want to convert the pointer address to a number, for example, using the <code>lltostr</code> dtrace function:</p>\n\n<pre><code> lltostr((uintptr_t)*(void**)arg1, 16)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 16402, "user_id": 4025095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blJ4L.jpg?s=128&g=1", "display_name": "Myst", "link": "https://stackoverflow.com/users/4025095/myst"}, "edited": false, "score": 1, "creation_date": 1568203621, "post_id": 57879807, "comment_id": 102199220, "body": "Specifically on MacOS (assuming an Apple computer, and not some hackintosh), pointer lengths are all equal to 8 bytes. Function pointer lengths, <code>void *</code> pointer lengths, etc&#39; are all equal length (64 bit memory addresses). <code>uintptr_t</code> is also 8 bytes longs."}, {"owner": {"reputation": 762, "user_id": 4949386, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/a4f78608dae9e9cf14a732e366ea016a?s=128&d=identicon&r=PG&f=1", "display_name": "zino", "link": "https://stackoverflow.com/users/4949386/zino"}, "edited": false, "score": 0, "creation_date": 1568318070, "post_id": 57879807, "comment_id": 102246336, "body": "<code>csrutil enable --without dtrace</code> fixed the <code>invalid kernel access in action</code> error I was seeing."}], "tags": [], "owner": {"reputation": 39687, "user_id": 79566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edad7f3ab41c3bdfdf851759dce5c33b?s=128&d=identicon&r=PG", "display_name": "bta", "link": "https://stackoverflow.com/users/79566/bta"}, "is_accepted": false, "score": 0, "last_activity_date": 1568163875, "creation_date": 1568163875, "answer_id": 57879807, "question_id": 57794128, "link": "https://stackoverflow.com/questions/57794128/following-a-pointer-to-a-pointer/57879807#57879807", "title": "Following a pointer to a pointer", "body": "<p>Not a dtrace pro, but here are some observations.</p>\n\n<p><code>uintptr_t</code> is defined to be large enough to hold any pointer converted to an integer.  Note that this does not imply that <code>sizeof(uintptr_t)</code> == <code>sizeof(void*)</code>.  It is perfectly valid (and on some platforms, <em>necessary</em>) for <code>uintptr_t</code> to be strictly <em>larger</em> than a pointer.  That means your <code>copyin</code> call might be copying more bytes than are actually there.  Try using a size of <code>sizeof(sqlite**)</code> instead.</p>\n\n<p>Also, it's possible that some of OSX's internal protection mechanisms are causing you problems.  See the answer on <a href=\"https://unix.stackexchange.com/questions/275175/error-on-enabled-probe-syscallopen-nocancelentry-invalid-user-access-in-ac\">this related question</a> for a good explanation.</p>\n"}], "owner": {"reputation": 762, "user_id": 4949386, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/a4f78608dae9e9cf14a732e366ea016a?s=128&d=identicon&r=PG&f=1", "display_name": "zino", "link": "https://stackoverflow.com/users/4949386/zino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 394, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1568318633, "creation_date": 1567622403, "last_edit_date": 1567948147, "question_id": 57794128, "link": "https://stackoverflow.com/questions/57794128/following-a-pointer-to-a-pointer", "title": "Following a pointer to a pointer", "body": "<p><code>sqlite3_open</code> takes a pointer to a pointer. Id like to trace the address of the second pointer.</p>\n\n<p>E.g: <code>p1(p2(obj))</code></p>\n\n<p><a href=\"https://www.sqlite.org/c3ref/open.html\" rel=\"nofollow noreferrer\">https://www.sqlite.org/c3ref/open.html</a></p>\n\n<pre><code>int sqlite3_open(\n  const char *filename,   /* Database filename (UTF-8) */\n  sqlite3 **ppDb          /* OUT: SQLite db handle */\n);\n</code></pre>\n\n<p>What is the syntax to get the address of that pointer in DTrace?</p>\n\n<p>Im using the <code>pid$target::sqlite3_open:return</code> probe to read from the <code>arg1</code> that was set from the <code>entry</code> probe.</p>\n\n<p>Im currently using:</p>\n\n<pre><code>// Copy pointer bytes from arg1 to kernel, cast to pointer. \n(uintptr_t *)copyin(arg1, sizeof(uintptr_t))\n</code></pre>\n\n<p>Which results in: <code>invalid kernel access in action</code>.</p>\n\n<p>Im on MacOS with SIP enabled, is this the issue?</p>\n"}, {"tags": ["c", "gcc"], "comments": [{"owner": {"reputation": 53155, "user_id": 427309, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/JYj7w.png?s=128&g=1", "display_name": "Richard J. Ross III", "link": "https://stackoverflow.com/users/427309/richard-j-ross-iii"}, "edited": false, "score": 1, "creation_date": 1567622899, "post_id": 57794096, "comment_id": 102021611, "body": "A &#39;constant expression&#39;, according to the C standard is different from a &#39;constant value&#39;. <code>__builtin_constant_p</code> checks for a constant expression.  There&#39;s simply no way to do what you want here, without turning <code>a</code> into a macro. A variable will never be a &#39;constant expression&#39;."}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "reply_to_user": {"reputation": 53155, "user_id": 427309, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/JYj7w.png?s=128&g=1", "display_name": "Richard J. Ross III", "link": "https://stackoverflow.com/users/427309/richard-j-ross-iii"}, "edited": false, "score": 0, "creation_date": 1567624639, "post_id": 57794096, "comment_id": 102022275, "body": "@RichardJ.RossIII: <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Other-Builtins.html\" rel=\"nofollow noreferrer\">As documented</a>, <code>__builtin_constant_p</code> does not determine if the operand is a constant expression but &quot;if a value is known to be constant at compile time and hence that GCC can perform constant-folding on expressions involving that value&quot;. OP is probably omitting <code>-O</code>..."}], "answers": [{"tags": [], "owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "is_accepted": false, "score": 2, "last_activity_date": 1567624950, "creation_date": 1567624950, "answer_id": 57794653, "question_id": 57794096, "link": "https://stackoverflow.com/questions/57794096/gcc-builtin-constant-p-always-returning-0/57794653#57794653", "title": "GCC __builtin_constant_p always returning 0", "body": "<p>A <code>const</code>-qualified variable is <strong>not</strong> a constant expression in C, but GCC does not document <code>__builtin_constant_p</code> as determining if the argument is a constant expression anyway. Rather, it's <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Other-Builtins.html\" rel=\"nofollow noreferrer\">documented</a> to \"determine if a value is known to be constant at compile time and hence that GCC can perform constant-folding on expressions involving that value\". So it should be usable for what you want.</p>\n\n<p>The problem is almost certainly just that you compiled with <code>-O0</code> (no optimization, the default), in which case no constant-folding can take place because you have it turned off. Turn on optimization (at least <code>-O1</code>, but normally you want <code>-O2</code> or <code>-Os</code>) and it should do what you want.</p>\n"}, {"tags": [], "owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "is_accepted": false, "score": 0, "last_activity_date": 1567626193, "creation_date": 1567626193, "answer_id": 57794917, "question_id": 57794096, "link": "https://stackoverflow.com/questions/57794096/gcc-builtin-constant-p-always-returning-0/57794917#57794917", "title": "GCC __builtin_constant_p always returning 0", "body": "<p>A variable is never a constant (unless constant folding is used, but you have to have optimization enabled for that), even if it is <code>const</code>-qualified.</p>\n\n<p><code>__builtin_constant_p</code> will return true for a constant only. For example:</p>\n\n<pre><code>int b = __builtin_constant_p(10);\nprintf(\"%d\\n\", b);\n</code></pre>\n\n<p>will print <code>1</code>.</p>\n\n<p>Note that your code will print <code>1</code> also if you compile with optimization enabled (<code>-O</code> at minimum, but any other legal <code>-O</code> flag will work except for <code>-O0</code>).</p>\n"}], "owner": {"reputation": 31, "user_id": 11949744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3adfa331dafe9eb8a1f795c08ead255b?s=128&d=identicon&r=PG&f=1", "display_name": "h4grid", "link": "https://stackoverflow.com/users/11949744/h4grid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1567626193, "creation_date": 1567622228, "last_edit_date": 1567622480, "question_id": 57794096, "link": "https://stackoverflow.com/questions/57794096/gcc-builtin-constant-p-always-returning-0", "title": "GCC __builtin_constant_p always returning 0", "body": "<p>I have the following code:</p>\n\n<pre><code>const int a = 10;\nint b = __builtin_constant_p(a);\nprintf(\"%d\\n\", b);\n</code></pre>\n\n<p>output is 0.\nI read the man, the value of 0 doesn't mean that a <em>is not a compile time constant</em>, just that gcc can't prove that it is. Anyway I can get this output to be 1?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1567621268, "post_id": 57793720, "comment_id": 102020940, "body": "You read and compare non-initialised variables. E.g. here <code>while(a!=0 &amp;&amp; b!=0)</code>."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1567621299, "post_id": 57793720, "comment_id": 102020949, "body": "You ignore the return value of <code>scanf()</code>."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1567621404, "post_id": 57793720, "comment_id": 102020979, "body": "Please explain in detail what your program is supposed to do. Give input examples with desired output and current output."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1567621559, "post_id": 57793720, "comment_id": 102021044, "body": "All comments still stand. Especially the first one."}, {"owner": {"reputation": 33, "user_id": 10845644, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-kErUdJI_PAk/AAAAAAAAAAI/AAAAAAAAAGU/63DOpcKsrUU/photo.jpg?sz=128", "display_name": "Sunjaree Ibn Zulfiker", "link": "https://stackoverflow.com/users/10845644/sunjaree-ibn-zulfiker"}, "edited": false, "score": 0, "creation_date": 1567622024, "post_id": 57793720, "comment_id": 102021264, "body": "let,a=922243926 b=1449529480 my output for this is:- 1 found 2 found not found not found not found 3 found not found 4 found not found ----------------------- 4 But it should be:-          1 found 2 found 3  found not found not found 4 found not found 5 found not found ----------------------- 5"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 1, "creation_date": 1567622726, "post_id": 57793720, "comment_id": 102021549, "body": "@SunjareeIbnZulfiker for clarifications please <a href=\"https://stackoverflow.com/posts/57793720/edit\">edit</a> the question. Also read this: <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a> and take the <a href=\"https://stackoverflow.com/tour\">tour</a>."}, {"owner": {"reputation": 33, "user_id": 10845644, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-kErUdJI_PAk/AAAAAAAAAAI/AAAAAAAAAGU/63DOpcKsrUU/photo.jpg?sz=128", "display_name": "Sunjaree Ibn Zulfiker", "link": "https://stackoverflow.com/users/10845644/sunjaree-ibn-zulfiker"}, "edited": false, "score": 0, "creation_date": 1567622814, "post_id": 57793720, "comment_id": 102021583, "body": "thanks a lot dude!!!!!!"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1567622826, "post_id": 57793720, "comment_id": 102021591, "body": "&quot;But it should be&quot;. Why?"}, {"owner": {"reputation": 33, "user_id": 10845644, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-kErUdJI_PAk/AAAAAAAAAAI/AAAAAAAAAGU/63DOpcKsrUU/photo.jpg?sz=128", "display_name": "Sunjaree Ibn Zulfiker", "link": "https://stackoverflow.com/users/10845644/sunjaree-ibn-zulfiker"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1567622981, "post_id": 57793720, "comment_id": 102021644, "body": "okay I will try my best from next @Jabberwocky"}, {"owner": {"reputation": 33, "user_id": 10845644, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-kErUdJI_PAk/AAAAAAAAAAI/AAAAAAAAAGU/63DOpcKsrUU/photo.jpg?sz=128", "display_name": "Sunjaree Ibn Zulfiker", "link": "https://stackoverflow.com/users/10845644/sunjaree-ibn-zulfiker"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1567623532, "post_id": 57793720, "comment_id": 102021831, "body": "this code is finding carry operation from right to left,whenever it finds a carry operation it returns ( found),,,In my following example  there are 5 carries in  second,third fourth, seventh and ninth position,,,therefore,the output should be:-1 found,, 2 found 3 found,, not found ,,not found,, 4 found,, not found,, 5 found ,,not found @Yunnosch"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1567623701, "post_id": 57793720, "comment_id": 102021899, "body": "Did you notice the comment by Jabberwocky? Please <a href=\"https://stackoverflow.com/posts/57793720/edit\">edit</a> your question to add information, instead of hiding them in comments."}], "answers": [{"tags": [], "owner": {"reputation": 6975, "user_id": 3121023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f52448806175b9aa66c86d40cf0829f1?s=128&d=identicon&r=PG&f=1", "display_name": "user3121023", "link": "https://stackoverflow.com/users/3121023/user3121023"}, "is_accepted": true, "score": 1, "last_activity_date": 1567625299, "creation_date": 1567625299, "answer_id": 57794733, "question_id": 57793720, "link": "https://stackoverflow.com/questions/57793720/i-want-to-find-the-number-of-carry-operation-in-multi-digit-number-problem/57794733#57794733", "title": "I want to find the number of carry operation in multi digit number problem", "body": "<p>With inputs of a=362175600 b=1479992559, the statement <code>max=(max/10)+1;</code> causes 14799 to become 14800 and produces bad result.<br>\nUsing a separate <code>carry</code> variable will correct the problem.</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n\nint main ( void) {\n    int a = 1,b = 1,count,max,min,j,rem_max,rem_min;\n    int carry = 0;\n\n    while ( a != 0 &amp;&amp; b != 0) {\n        scanf ( \"%d%d\", &amp;a, &amp;b);\n        max = b;\n        min = a;\n        if ( a &gt; b) {\n            max = a;\n            min = b;\n        }\n\n        count = 0;\n        j = 0;\n\n        while ( max != 0) {\n            rem_max = max % 10;\n            rem_min = min % 10;\n            max /= 10;\n            min /= 10;\n\n            if ( ( rem_max + rem_min + carry) &gt; 9) {//also add carry\n                count++;\n                carry = 1;//set carry\n                printf(\"%d found\\n\",j);\n                j++;\n            }\n            else {\n                carry = 0;//un set carry\n                printf ( \"not found\\n\");\n            }\n        }\n        printf ( \"-----------------------\\n\");\n        printf ( \"%d\\n\", count);\n    }\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 10845644, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-kErUdJI_PAk/AAAAAAAAAAI/AAAAAAAAAGU/63DOpcKsrUU/photo.jpg?sz=128", "display_name": "Sunjaree Ibn Zulfiker", "link": "https://stackoverflow.com/users/10845644/sunjaree-ibn-zulfiker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "closed_date": 1567688221, "accepted_answer_id": 57794733, "answer_count": 1, "score": 0, "last_activity_date": 1567625299, "creation_date": 1567620332, "last_edit_date": 1567624597, "question_id": 57793720, "link": "https://stackoverflow.com/questions/57793720/i-want-to-find-the-number-of-carry-operation-in-multi-digit-number-problem", "closed_reason": "Needs details or clarity", "title": "I want to find the number of carry operation in multi digit number problem", "body": "<p>I'm not getting the correct number of carry operation through my code</p>\n\n<p>this code is finding carry operation from right to left,whenever it finds a carry operation it returns ( found),,,let two integers a=362175600 b=1479992559  there are 5 carries in second,third fourth, seventh and ninth position,,,therefore,the output should be:-1 found,, 2 found 3 found,, not found ,,not found,, 4 found,, not found,, 5 found ,,not found </p>\n\n<pre><code>#include&lt;stdio.h&gt;\nint main(){\n        int a,b,count,max,min,j,rem_max,rem_min;\n\n        while((scanf(\"%d%d\",&amp;a,&amp;b))==2){\n\n            if(a==0 &amp;&amp; b==0){\n                break;\n            }\n            else{\n                if(a &gt; b){\n                    max=a;\n                    min=b;\n                }\n                else if(b &gt; a){\n                    min=a;\n                    max=b;\n                }\n                else{\n                    max=a;\n                    min=b;\n                }\n\n\n                count=0;\n                j=1;\n\n                while(max!=0){\n                    rem_max=max%10;\n                    rem_min=min%10;\n\n                    if((rem_max+rem_min)&gt;9){\n                        count++;\n\n                        printf(\"%d found\\n\",j);\n                        max=(max/10)+1;\n                        min=min/10;\n                        j++;\n                    }\n                    else if((rem_max+rem_min)&lt;9){\n\n                        max=max/10;\n                        min=min/10;\n\n                        printf(\"not found\\n\");\n                    }\n                    else{\n                        max=max/10;\n                        min=min/10;\n\n                    }\n\n                }\n                printf(\"-----------------------\\n\");\n                printf(\"%d\\n\",count);\n\n            }\n        }\n        return 0;\n    }\n</code></pre>\n\n<p>In the following example the output should be  5 but  I've got 3 through my code,\nMy output from this code is:- <code>1 found,, 2 found,, not found,, not found,, not found,, 3 found,, not found,, 4 found,, not found,so,it shows the number of carry operation is  4. But it should be:- 1 found,,2 found,, 3 found,, not found,, not found,,4 found,, not found,, 5 found,, not found,so the actual number of carry operation is  5</code></p>\n"}, {"tags": ["c", "linux", "pipe", "named-pipes"], "answers": [{"tags": [], "owner": {"reputation": 305833, "user_id": 68587, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7d9fd158e03cbde94f7e0b33b78222af?s=128&d=identicon&r=PG", "display_name": "John Kugelman", "link": "https://stackoverflow.com/users/68587/john-kugelman"}, "is_accepted": true, "score": 2, "last_activity_date": 1567623081, "last_edit_date": 1567623081, "creation_date": 1567620494, "answer_id": 57793746, "question_id": 57793676, "link": "https://stackoverflow.com/questions/57793676/why-does-opening-a-named-pipe-non-blockingly-return-an-invalid-file-descriptor/57793746#57793746", "title": "Why does opening a named pipe non-blockingly return an invalid file descriptor?", "body": "<p><a href=\"https://linux.die.net/man/3/mkfifo\" rel=\"nofollow noreferrer\">mkfifo(3)</a> - Linux man page:</p>\n\n<blockquote>\n  <p>See <em>fifo(7)</em> for nonblocking handling of FIFO special files. </p>\n</blockquote>\n\n<p><a href=\"https://linux.die.net/man/7/fifo\" rel=\"nofollow noreferrer\">fifo(7)</a> - Linux man page:</p>\n\n<blockquote>\n  <p>A process can open a FIFO in nonblocking mode. In this case, opening for read only will succeed even if no-one has opened on the write side yet, <strong>opening for write only will fail with <code>ENXIO</code> (no such device or address) unless the other end has already been opened.</strong></p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "is_accepted": false, "score": 2, "last_activity_date": 1567620926, "creation_date": 1567620926, "answer_id": 57793824, "question_id": 57793676, "link": "https://stackoverflow.com/questions/57793676/why-does-opening-a-named-pipe-non-blockingly-return-an-invalid-file-descriptor/57793824#57793824", "title": "Why does opening a named pipe non-blockingly return an invalid file descriptor?", "body": "<p>John's answer is correct, but to address your specific question, it's not \"returning an invalid file descriptor\". <code>open</code> returns -1 to indicate an error. In that case you can check <code>errno</code> (like you're doing for <code>write</code>) to see the cause of the error.</p>\n"}], "owner": {"reputation": 3787, "user_id": 5437543, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/ad76496c936d384dac2888bae0126dde?s=128&d=identicon&r=PG&f=1", "display_name": "StoneThrow", "link": "https://stackoverflow.com/users/5437543/stonethrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 57793746, "answer_count": 2, "score": 2, "last_activity_date": 1567623081, "creation_date": 1567620125, "question_id": 57793676, "link": "https://stackoverflow.com/questions/57793676/why-does-opening-a-named-pipe-non-blockingly-return-an-invalid-file-descriptor", "title": "Why does opening a named pipe non-blockingly return an invalid file descriptor?", "body": "<p>I'm trying to solidify my understanding of who blocks when and why wrt opening, writing to, and reading from named pipes.</p>\n\n<p>The following code implies that it's invalid to open a named pipe with <code>O_WRONLY | O_NONBLOCK</code>, but I'm not sure whether there's just some bug in my code I don't understand, or if this is generally true.</p>\n\n<pre><code>// main.c\n\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;errno.h&gt;\n\nint main( int argc, char* argv[] )\n{\n  int wfd = open( \"/tmp/foo\", O_WRONLY | O_NONBLOCK );\n  printf( \"wfd[%d]\\n\", wfd );\n  if ( wfd &gt;= 0 )\n  {\n    int res = write( wfd, \"0\", 1 );\n    printf( \"write: [%d], errno[%d(%s)]\\n\", res, errno, strerror( errno ) );\n    sleep(3);\n    printf( \"writer ending!\\n\" );\n  }\n  return 0;\n}\n</code></pre>\n\n<pre><code>&gt; ls -l /tmp/foo \nprwxrwxrwx. 1 user user 0 Sep  4 10:35 /tmp/foo\n&gt; \n&gt; gcc -g main.c &amp;&amp; ./a.out \nwfd[-1]\n</code></pre>\n\n<p><strong>Question</strong>: Why does opening the named pipe with <code>O_WRONLY | O_NONBLOCK</code> return an invalid file descriptor?</p>\n\n<p>I have a suspicion that this has to do with pipes requiring both read and write ends to be open simultaneously, and my hackneyed way of getting around this (by opening one end non-blockingly) fails for this reason. But I haven't been able to find any specific documentation that either backs up that hypothesis or otherwise explains this observation.</p>\n"}, {"tags": ["c", "gcc", "compilation", "linux-kernel"], "comments": [{"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1567620584, "post_id": 57793628, "comment_id": 102020658, "body": "<code>-mcmodel=kernel</code> is not the only compiler parameter which differ compiling for the Linux kernel from a user program. There are <b>much more</b> compiler options and definitions required by the kernel object. And you cannot use any library when build the kernel. See e.g. this question: <a href=\"https://stackoverflow.com/questions/22818842/where-is-the-standard-kernel-libraries-to-let-kernel-module-link-to\" title=\"where is the standard kernel libraries to let kernel module link to\">stackoverflow.com/questions/22818842/&hellip;</a>."}, {"owner": {"reputation": 141, "user_id": 6446146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/222226293323165b15c4721961265f4b?s=128&d=identicon&r=PG&f=1", "display_name": "yeger", "link": "https://stackoverflow.com/users/6446146/yeger"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1567621048, "post_id": 57793628, "comment_id": 102020838, "body": "Thanks for the comment, I didn&#39;t see this link before. I wrote a small library that doesn&#39;t use any functionality from libc. Can you please elaborate about the &quot;much more compiler options&quot;? Thanks!"}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1567621582, "post_id": 57793628, "comment_id": 102021060, "body": "Just use standard process for build kernel modules using KBuild (Kernel Build) system. And with command <code>make</code> use <code>V=1</code> option. It will show exact command line used for compile the source files, so you can see all compiler options used."}, {"owner": {"reputation": 141, "user_id": 6446146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/222226293323165b15c4721961265f4b?s=128&d=identicon&r=PG&f=1", "display_name": "yeger", "link": "https://stackoverflow.com/users/6446146/yeger"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1567621719, "post_id": 57793628, "comment_id": 102021137, "body": "Actually, this was my starting point. I used V=1 to receive all the flags, and start to remove them, and now I&#39;m focusing on this one. Do you about any flag that is required (and not just optional)?"}, {"owner": {"reputation": 3561, "user_id": 2511795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30c869f55cbcf82a7bc4536d563daa0a?s=128&d=identicon&r=PG", "display_name": "0andriy", "link": "https://stackoverflow.com/users/2511795/0andriy"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1567627030, "post_id": 57793628, "comment_id": 102023184, "body": "@Tsyvarev, it&#39;s not true. Till some moment this or last year U-Boot, for example, used to be linked with <i>libgcc.a</i>. So, it all depends to the category of library."}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "reply_to_user": {"reputation": 3561, "user_id": 2511795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30c869f55cbcf82a7bc4536d563daa0a?s=128&d=identicon&r=PG", "display_name": "0andriy", "link": "https://stackoverflow.com/users/2511795/0andriy"}, "edited": false, "score": 0, "creation_date": 1567631069, "post_id": 57793628, "comment_id": 102024348, "body": "@0andriy: It could be argued whether U-boot is treated as a part of the kernel: it is more a &quot;loader&quot; than an &quot;OS kernel&quot;. As far as I understand, U-boot is <i>linked</i> neither with the Linux kernel core nor with any Linux kernel module."}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1567631713, "post_id": 57793628, "comment_id": 102024573, "body": "@yeger: You definitely may <i>manually</i> (using <code>gcc</code> without Kbuild) compile any Linux kernel component. It could be required to use all compiler options used by Kbuild, or only part of them... but this would be <i>manual</i> compiling in any case: Kbuild doesn&#39;t support libraries. So, what do you want from us? Do you want us to list <b>all needed compiler options</b>? As I said, there are many of them. They depends on the kernel version, target architecture, configuration - it could be quite a long answer which describes the all the options."}, {"owner": {"reputation": 141, "user_id": 6446146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/222226293323165b15c4721961265f4b?s=128&d=identicon&r=PG&f=1", "display_name": "yeger", "link": "https://stackoverflow.com/users/6446146/yeger"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1567632051, "post_id": 57793628, "comment_id": 102024673, "body": "@Tsyvarev I want to manually compile my lib, without any kernel source, and without  the <code>-mcmodel=kernel</code> flag. Then, I want to take this lib, and compile and link it into a kernel module that uses it. For example, I&#39;ll compile the <code>a.c</code> &quot;library&quot; with <code>gcc a.c -o a.o</code> then copy it into the kernel module that uses it <code>mv a.o path&#47;to&#47;a.o_shipped</code>, and then compile the kernel module. Please let me know if it is explain it better, and I&#39;ll edit the original post. Thanks!"}], "owner": {"reputation": 141, "user_id": 6446146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/222226293323165b15c4721961265f4b?s=128&d=identicon&r=PG&f=1", "display_name": "yeger", "link": "https://stackoverflow.com/users/6446146/yeger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567622024, "creation_date": 1567619883, "last_edit_date": 1567622024, "question_id": 57793628, "link": "https://stackoverflow.com/questions/57793628/is-it-possible-to-compile-a-lib-that-will-link-into-a-kernel-module-without-mcm", "title": "Is it possible to compile a lib that will link into a kernel module without -mcmodel=kernel?", "body": "<p>Out of curiosity I tried to compile a standalone lib (without any include from libc) I wrote and then link it into a kernel module without the \"-mcmodel=kernel\" flag.\nI saw this <a href=\"https://stackoverflow.com/questions/49381147/use-of-mcmodel-kernel-flag-in-x86-platform\">thread</a> , so I tried with -fpic but then I receive \"undefined reference to _global_offset_table_\". I also saw this <a href=\"https://stackoverflow.com/questions/21680391/how-to-make-kernel-module-binary-blob\">thread</a> but it has no answers.</p>\n\n<p>I would like to know if it is possible to compile it, and how?</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["c", "linux", "wifi", "netlink"], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 12021231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6b44346825b6d94f4f5c4cd22ebbfba?s=128&d=identicon&r=PG&f=1", "display_name": "kwroot", "link": "https://stackoverflow.com/users/12021231/kwroot"}, "edited": false, "score": 0, "creation_date": 1567673227, "post_id": 57801152, "comment_id": 102035329, "body": "thank you! Unfortunately, the command &quot;iw scan&quot; works, but &quot;iw wlan0 connect&quot; not! i use connman for set up the connection, now i&#39;m trying to set the wlan0 interface on connman blacklist, but it seems that it doesn&#39;t works as well!"}], "tags": [], "owner": {"reputation": 61, "user_id": 5907914, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206012533415236/picture?type=large", "display_name": "Neo Jou", "link": "https://stackoverflow.com/users/5907914/neo-jou"}, "is_accepted": true, "score": 0, "last_activity_date": 1567671215, "creation_date": 1567671215, "answer_id": 57801152, "question_id": 57793581, "link": "https://stackoverflow.com/questions/57793581/how-to-use-libnl-and-netlink-socket-for-connect-devices-to-ap-programatically/57801152#57801152", "title": "How to use libnl and netlink socket for connect devices to AP programatically?", "body": "<p>Thanks for the code. </p>\n\n<p>Based on your code, I modified and did the test here; it works. \nThe source code is at: \n<a href=\"https://github.com/neojou/nl80211/blob/master/test_connect/src/test_connect_nl80211.c\" rel=\"nofollow noreferrer\">https://github.com/neojou/nl80211/blob/master/test_connect/src/test_connect_nl80211.c</a></p>\n\n<p>Some suggestions for this: </p>\n\n<ol>\n<li><p>Make sure the test environment is correct</p>\n\n<p>Before test the code, maybe you can try to use iw to do the test. \niw is the open source tool, which uses netlink also. \nyou can type \"sudo iw wlan0 connect Validator_Test\"\nand then use iwconfig to see if it is connected or not first.\n( Suppose there is no security setting at the AP as you said )</p></li>\n<li><p>there are two differences between your source code and mine </p>\n\n<p>(1) don't need to set NL80211_ATTR_MAC</p>\n\n<p>(2) ret = nl_recvmsgs_default(socket);</p>\n\n<p>not sure if there is any judgement of the return value of your ap_conn(), \n   but it seems better to return 0 in ap_conn(), when nl_recvmsgs_default() returns 0. </p></li>\n</ol>\n"}], "owner": {"reputation": 37, "user_id": 12021231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6b44346825b6d94f4f5c4cd22ebbfba?s=128&d=identicon&r=PG&f=1", "display_name": "kwroot", "link": "https://stackoverflow.com/users/12021231/kwroot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 747, "favorite_count": 0, "accepted_answer_id": 57801152, "answer_count": 1, "score": 0, "last_activity_date": 1567671215, "creation_date": 1567619646, "question_id": 57793581, "link": "https://stackoverflow.com/questions/57793581/how-to-use-libnl-and-netlink-socket-for-connect-devices-to-ap-programatically", "title": "How to use libnl and netlink socket for connect devices to AP programatically?", "body": "<p>I'm creating a C library that manages a lot of peripherical of my embedded device. The S.O. used, is a Linux distro compiled with yocto. I'm trying to make some functions to connect my device to wifi (well-know) router, with netlink (using the libnl commands). With the help of <a href=\"https://stackoverflow.com/questions/18062268/using-nl80211-h-to-scan-access-points\">this</a> community, I've developed a function able to scan the routers in the area. Some of you know how to use the libnl command to connecting my device to router wifi?\nI've developed the following code, that tries to connect to an AP called \"Validator_Test\" (that have no authentication password). The software return no error, but my device still remain disconnected from the AP. Some of you know what is wrong in my code? Unfortunately, i've not found any example or documentation for this operation.</p>\n\n<pre><code>static int ap_conn() {\n\nstruct nl_msg *msg = nlmsg_alloc();\n\nint if_index = if_nametoindex(\"wlan0\"); // Use this wireless interface for scanning.\n\n// Open socket to kernel.\nstruct nl_sock *socket = nl_socket_alloc();  // Allocate new netlink socket in memory.\ngenl_connect(socket);  // Create file descriptor and bind socket.\nint driver_id = genl_ctrl_resolve(socket, \"nl80211\");  // Find the nl80211 driver ID.\n\ngenlmsg_put(msg, 0, 0, driver_id, 0, (NLM_F_REQUEST | NLM_F_ACK), NL80211_CMD_CONNECT, 0); \n\nnla_put_u32(msg, NL80211_ATTR_IFINDEX, if_index);  // Add message attribute, which interface to use.\n\nnla_put(msg, NL80211_ATTR_SSID, strlen(\"Validator_Test\"), \"Validator_Test\"); \n\nnla_put(msg, NL80211_ATTR_MAC, strlen(\"00:1e:42:21:e4:e9\"), \"00:1e:42:21:e4:e9\");  \n\nint ret = nl_send_auto_complete(socket, msg);  // Send the message.\nprintf(\"NL80211_CMD_CONNECT sent %d bytes to the kernel.\\n\", ret);\nret = nl_recvmsgs_default(socket);  // Retrieve the kernel's answer. callback_dump() prints SSIDs to stdout.\nnlmsg_free(msg);\n\nif (ret &lt; 0) {\n    printf(\"ERROR: nl_recvmsgs_default() returned %d (%s).\\n\", ret, nl_geterror(-ret));\n    return ret;\n}\n\nnla_put_failure:\nreturn -ENOSPC;\n</code></pre>\n\n<p>}</p>\n\n<p>Thanks to all of you!</p>\n"}, {"tags": ["c", "algorithm"], "comments": [{"owner": {"reputation": 52185, "user_id": 1782792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7e8dde1ee800b9687983617bbea3cb9b?s=128&d=identicon&r=PG&f=1", "display_name": "jdehesa", "link": "https://stackoverflow.com/users/1782792/jdehesa"}, "edited": false, "score": 0, "creation_date": 1567620040, "post_id": 57793543, "comment_id": 102020423, "body": "I suppose delay variabilities are always referred to the previous pulse, right? So, if I have a bit 0, I would get first a value between 400 and 600 and then a value between 800 and 1200."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1567621449, "post_id": 57793543, "comment_id": 102020997, "body": "Are the <i>average</i> sums of doublets guaranteed to be 1500 and 2500? (does the error accumulate?) Is the number of 1-bits equal to the number of 0-bits? (via the addition of check-bits)"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1567623131, "post_id": 57793543, "comment_id": 102021686, "body": "The example data consists of 100 garbage samples followed by two sequences of 36 bits. But only a few of the bits in the two sequences actually meet the specified tolerances. So it&#39;s back to the drawing board. Either you need to widen the tolerances, or you need to tighten hardware timing."}, {"owner": {"reputation": 157, "user_id": 2466564, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/b602cc2f1471c7cb6fb14a2d31fed1b5?s=128&d=identicon&r=PG", "display_name": "vpaladino778", "link": "https://stackoverflow.com/users/2466564/vpaladino778"}, "edited": false, "score": 1, "creation_date": 1567624695, "post_id": 57793543, "comment_id": 102022292, "body": "Can you provide an example of what you would want your function to return, if passing in the example data you provided. I&#39;m having some trouble grasping the problem."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "reply_to_user": {"reputation": 157, "user_id": 2466564, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/b602cc2f1471c7cb6fb14a2d31fed1b5?s=128&d=identicon&r=PG", "display_name": "vpaladino778", "link": "https://stackoverflow.com/users/2466564/vpaladino778"}, "edited": false, "score": 2, "creation_date": 1567625447, "post_id": 57793543, "comment_id": 102022599, "body": "@vpaladino778 The input numbers represent a sequence of bits, with two numbers per bit. A 500 followed by a 3000 represents a start bit. A 500 followed by a 2000 represents a <code>1</code> bit. A 500 followed by a 1000 represents a <code>0</code> bit. A message consists of a start bit followed by 36 zeros and ones. The input is supposed to be 12 copies of the same message. However, the example data only has some garbage followed by 2 copies of a message. The output from the algorithm should be the message, or a failure indication. The output for the example is  <code>0111 1010 1000 0000 1110 1000 1111 0010 1011</code>"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1567627284, "post_id": 57793543, "comment_id": 102023254, "body": "So for example <code>615 3791</code> is a start bit? followed by <code>607 844</code> that is a 0 and <code>604 1836</code> is a 1?"}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 1, "creation_date": 1567628971, "post_id": 57793543, "comment_id": 102023599, "body": "<a href=\"https://en.wikipedia.org/wiki/Convolutional_code#Trellis_diagram\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Convolutional_code#Trellis_diagram</a> comes close (or: Viterbi) (I would start by reconstructing the signal , oversampling at eg 100 tics)"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1567630014, "post_id": 57793543, "comment_id": 102023977, "body": "@KamilCuk That&#39;s my interpretation, although you&#39;ll notice that none of those values are within the &#177;100 tolerances given in the question."}, {"owner": {"reputation": 616, "user_id": 632046, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/10a8bbb79635e9e760d01b81ba7e321b?s=128&d=identicon&r=PG", "display_name": "brainwash", "link": "https://stackoverflow.com/users/632046/brainwash"}, "reply_to_user": {"reputation": 157, "user_id": 2466564, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/b602cc2f1471c7cb6fb14a2d31fed1b5?s=128&d=identicon&r=PG", "display_name": "vpaladino778", "link": "https://stackoverflow.com/users/2466564/vpaladino778"}, "edited": false, "score": 0, "creation_date": 1567640820, "post_id": 57793543, "comment_id": 102026541, "body": "@vpaladino778: user3386109 is right with his example, the tolerances might be wider/narrower, depending on the signal. Since the timings are so far apart, a tolerance of 250 should be ok. I will edit the question to reflect this."}, {"owner": {"reputation": 616, "user_id": 632046, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/10a8bbb79635e9e760d01b81ba7e321b?s=128&d=identicon&r=PG", "display_name": "brainwash", "link": "https://stackoverflow.com/users/632046/brainwash"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1567640870, "post_id": 57793543, "comment_id": 102026548, "body": "@user3386109 I will widen the tolerances in the question, but your example is spot on."}, {"owner": {"reputation": 616, "user_id": 632046, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/10a8bbb79635e9e760d01b81ba7e321b?s=128&d=identicon&r=PG", "display_name": "brainwash", "link": "https://stackoverflow.com/users/632046/brainwash"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1567640904, "post_id": 57793543, "comment_id": 102026552, "body": "@Kamil Cuk that&#39;s correct."}, {"owner": {"reputation": 616, "user_id": 632046, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/10a8bbb79635e9e760d01b81ba7e321b?s=128&d=identicon&r=PG", "display_name": "brainwash", "link": "https://stackoverflow.com/users/632046/brainwash"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1567640977, "post_id": 57793543, "comment_id": 102026562, "body": "@wildplasser thank you the the suggestion. Oversampling is not really an option since the signal repeats every ~80 seconds, possibly with different data. Only one burst contains the same data."}, {"owner": {"reputation": 3854, "user_id": 2235885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09d0d6a08639ef79ef960a52bd013e02?s=128&d=identicon&r=PG", "display_name": "joop", "link": "https://stackoverflow.com/users/2235885/joop"}, "edited": false, "score": 2, "creation_date": 1567689794, "post_id": 57793543, "comment_id": 102044625, "body": "Why do you think you need an O(N*N) algoritm? You only need to classify pulse lengths , while keeping synchonised on the long pulses. Once a valid set of 72 semi-bits is received, you can decide to use it in your result (or not)."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 1, "creation_date": 1567697408, "post_id": 57793543, "comment_id": 102049063, "body": "If you verify bits 25-28 without storing them, the message fits into a <code>uint32_t</code>, which makes it easy to compare with other copies of the message."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 1, "creation_date": 1567725166, "post_id": 57793543, "comment_id": 102059039, "body": "btw:I just solved your <i>problem</i>. Do you have a solution yet?"}, {"owner": {"reputation": 616, "user_id": 632046, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/10a8bbb79635e9e760d01b81ba7e321b?s=128&d=identicon&r=PG", "display_name": "brainwash", "link": "https://stackoverflow.com/users/632046/brainwash"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1567842359, "post_id": 57793543, "comment_id": 102092752, "body": "@user3386109 that&#39;s really cool, never thought of that"}, {"owner": {"reputation": 616, "user_id": 632046, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/10a8bbb79635e9e760d01b81ba7e321b?s=128&d=identicon&r=PG", "display_name": "brainwash", "link": "https://stackoverflow.com/users/632046/brainwash"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1567842402, "post_id": 57793543, "comment_id": 102092761, "body": "@wildplasser not yet, I&#39;m just collecting solutions until I tackle it :)"}], "owner": {"reputation": 616, "user_id": 632046, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/10a8bbb79635e9e760d01b81ba7e321b?s=128&d=identicon&r=PG", "display_name": "brainwash", "link": "https://stackoverflow.com/users/632046/brainwash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1567642764, "creation_date": 1567619482, "last_edit_date": 1567642764, "question_id": 57793543, "link": "https://stackoverflow.com/questions/57793543/find-repeating-sensor-pattern-of-fixed-length", "title": "Find repeating sensor pattern of fixed length", "body": "<p>I'm trying to decode an RF sensor output which consists of 72 pulses repeated 12 times.</p>\n\n<p>Due to medium unreliability, some bits might be corrupted, the sentence might start mid-way, the end might be missing. But a successful decoding would happen if 3 sequences are repeated.</p>\n\n<p>The input of the program is an array of delays between edge changes. Bit 0 has 2 pulses: 500(\u00b1249) followed by 1000(\u00b1249). Bit 1 has 2 pulses, 500(\u00b1249) followed by 2000(\u00b1249). The tolerance can be set to anything that still makes sense.</p>\n\n<p>The start of a sequence is triggered by a long pulse (>3000) but this might be missing.</p>\n\n<p>In a sequence there are 36 bits (72 pulses), bit 10 is a zero, bits 25-28 are all ones. Again, a reliable decoding can occur after 3 correct patterns are detected.</p>\n\n<p>Example data (newlines are added for clarity):</p>\n\n<pre><code>642 73 369 88 304 136 297 106 308 119 278 111 287 119 293 116 287 129 129 2054 1897 588 1830 614 588 645 382 98 97 619 337 634 463 106 285 1000 449 798 1647 1008 468 793 609 857 180 \n863 593 796 663 833 649 775 671 748 722 714 749 724 750 693 1757 639 1805 701 1741 660 799 685 1755 688 778 673 798 670 796 652 1792 645 1804 611 1828 632 1816 623 823 648 824 629 1816 644 813 643 1808 629 833 625 1826 601 1835 \n\n615 3791 607 844 604 1836 618 1823 613 1821 638 1811 610 855 586 1859 602 853 618 1835 \n604 859 611 844 619 856 595 863 604 867 591 882 590 868 537 1947 510 1928 516 1882 610 865 596 1853 587 858 609 868 587 869 603 1842 596 1844 601 1839 601 1841 598 876 582 875 596 1844 597 875 576 1866 569 911 572 1845 608 1836 \n\n595 3800 587 875 596 1856 589 1842 592 1855 588 1849 601 870 584 1860 577 879 597 1845 593 881 572 884 589 883 576 881 576 902 553 899 584 886 573 1871 584 1863 574 1852 588 884 561 1882 565 891 581 896 558 905 567 1869 577 1863 577 1865 584 1858 583 886 566 938 488 1950 497 977 497 1921 549 887 583 1865 582 1851 \n</code></pre>\n\n<p>Decoding the above:</p>\n\n<pre><code>642 73 369 88 304 136 297 ...\n^ garbage pulses              ^\n615 3791 607 844 604 1836 618 1823 613 1821 638 1811 610 855 586 1859 602 853 618 1835\n     ^start  0       1        1        1        1        0       1        0       1\n</code></pre>\n\n<p>There is a suggested solution at <a href=\"https://www.geeksforgeeks.org/longest-repeating-and-non-overlapping-substring/\" rel=\"nofollow noreferrer\">https://www.geeksforgeeks.org/longest-repeating-and-non-overlapping-substring/</a> which can be adapted to work.</p>\n\n<p>The integer array should probably be first converted to a binary array, taking the longest sequence between valid pulses (either a one or a zero).</p>\n\n<p>The brute-force approach of O(n2+n) of finding the the repeating pattern plus another search for valid pattern (bits 10, 25-28) works, but I'm looking to optimize the solution.</p>\n\n<p>The data is sent each ~80 seconds, likely with different content each time:</p>\n\n<pre><code>[noise] [long pulse] [sequence 1] [sequence 2] ... [sequence 12] [noise or no signal for ~80 seconds] [long pulse] ...\n</code></pre>\n\n<p>The detector might wake up in the middle of a sequence train:</p>\n\n<pre><code>[sequence 3 end] [sequence 4] [corrupted sequence 5] [sequence 6] [sequence 7] [incomplete sequence 8]\n</code></pre>\n\n<p>Sequences 1 through 12 represent identical data of 36 bits.\nValid binary sequence format:</p>\n\n<pre><code>xxxxxxxxx0xxxxxxxxxxxxxx1111xxxxxxxx\n</code></pre>\n\n<p>Where x represents the bits to be decoded, the other ones are fixed.</p>\n\n<p><strong>As a sidenote</strong>, the purpose is to decode a weather sensor using EspPiLight, running on a microcontroller. The senders have a random delay between messages, to avoid collision and due to manufacturing tolerances. The tolerance is also mostly due to manufacturing tolerances and temperature-dependent oscillators. The decoding is non-critical, false positives and negatives are acceptable. Since several decoder algorithms run in real-time, on a microcontroller, performance is prioritized, e.g. by exiting early if garbage data is detected.</p>\n"}, {"tags": ["c", "performance"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1567619260, "post_id": 57793471, "comment_id": 102020122, "body": "There is only one and single true way to find out. Compare the generated assembly code. And keep in mind that you are really comparing a specific variation of code+compiler+compiler options."}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1567619321, "post_id": 57793471, "comment_id": 102020144, "body": "If you can <i>actually</i> measure any performance difference with an optimized build, I&#39;ll be surprised."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1567619566, "post_id": 57793471, "comment_id": 102020231, "body": "But why <i>would</i> you use the first example, which passes all the array elements individually? It&#39;s unlikely to be faster anyway."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1567619647, "post_id": 57793471, "comment_id": 102020259, "body": "@WeatherVane as I argue in my answer, at least in theory first case should be faster."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1567619678, "post_id": 57793471, "comment_id": 102020275, "body": "I also disagree with VTCs. The question is neither opinion based, nor is it too broad."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1567619734, "post_id": 57793471, "comment_id": 102020301, "body": "@SergeyA I see, but that depends on having a specific hardware. Leave it to the compiler to sort it out."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1567619824, "post_id": 57793471, "comment_id": 102020330, "body": "@WeatherVane specific hardware means x64. (Quite possible other platforms as well, I am just not familiar). I would call it as generic as it gets. Also, compiler will not optimize it out for you."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1567619894, "post_id": 57793471, "comment_id": 102020359, "body": "@KamilCuk: No, that is not a way to find out. It would only tell you what the difference is in a very specific situation\u2014for one program compiled with one compiler run on one processor with one set of input. Even if you timed many different runs, it would not answer the question in general. Nor is it generally easy to predict program execution time from assembly code. Different processors in the same architecture execute the same instruction sequence differently. Even in one processor, the execution time may be dependent on prior activity."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1567619916, "post_id": 57793471, "comment_id": 102020368, "body": "@SergeyA AFAIK most processors in commercial use are not 64-bit platforms. And at what length of array do you make the decision? Let the compiler tailor the code for the processor."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1567620292, "post_id": 57793471, "comment_id": 102020528, "body": "@WeatherVane I am not sure what the statistics is. From what I see day-to-day, x64 and ARM trump everything else. While I do not know anything about ARM ABI, I would be super-surprised if ARM doesn&#39;t support a fast parameter passing through register, register stacks or similar mechanism. If you have some data to back up your assumptions, I&#39;d be very eager to see it."}, {"owner": {"reputation": 45685, "user_id": 69809, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/yCVF0.jpg?s=128&g=1", "display_name": "Groo", "link": "https://stackoverflow.com/users/69809/groo"}, "edited": false, "score": 0, "creation_date": 1567620486, "post_id": 57793471, "comment_id": 102020605, "body": "If these functions are called from a function inside this same compilation unit, they will likely be inlined and produce <a href=\"https://godbolt.org/z/sRoHi0\" rel=\"nofollow noreferrer\">exactly the same output</a>. With extern linkage, i.e. called from a different module, the one with explicit parameters could use 4 registers depending on the architecture. Making it <code>static inline</code> and moving to a header file will basically be the safest bet, performance wise, but possibly unnecessary - the only sure way to know the difference is to benchmark it in the actual application which presumably calls it lots of times."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1567620692, "post_id": 57793471, "comment_id": 102020706, "body": "@SergeyA isn&#39;t the main point to use the best practice to write code? C is processor-agnostic. Who unrolls an array? If it is approrpiate, why use an array in the first place?"}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1567620954, "post_id": 57793471, "comment_id": 102020805, "body": "@WeatherVane it is never a point to use <b>best practices</b>. It is always a point to write correct code which gives optimal balance of performance vs code maintainability, readability and human effort. It is a true fact that <code>do_sum1</code> generates different (and more performant!) assembly than <code>do_sum2</code> on x64 ABI.  If your goal is to shave away every nanosecond possible (which is the case in some environments) you should know that <code>do_sum1</code> is preferred."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1567621079, "post_id": 57793471, "comment_id": 102020858, "body": "@SergeyA if that were my goal I would be using assembler."}, {"owner": {"reputation": 1149, "user_id": 2472827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t5rYY.jpg?s=128&g=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/2472827/neil"}, "edited": false, "score": 0, "creation_date": 1567636086, "post_id": 57793471, "comment_id": 102025670, "body": "As an aside, first I&#39;d check if you are not going to be using it outside the compilation unit; <code>static</code> functions are trivially optimised."}], "answers": [{"comments": [{"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1567622020, "post_id": 57793568, "comment_id": 102021262, "body": "May the venerable downvoter explain their downvote?"}], "tags": [], "owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "is_accepted": false, "score": 5, "last_activity_date": 1567620324, "last_edit_date": 1567620324, "creation_date": 1567619620, "answer_id": 57793568, "question_id": 57793471, "link": "https://stackoverflow.com/questions/57793471/how-does-function-parameters-and-local-variables-affect-on-the-performance-of-a/57793568#57793568", "title": "How does function parameters and local variables affect on the performance of a C program", "body": "<p>The question is trickier than it seems.</p>\n\n<p>First of, let's assume the function is not inlined (as otherwise they are more than likely to be compiled to the same code) and let's analyze the effect.</p>\n\n<p>From one hand, the number of parameters to function affects the performance. <strong>All other things being equal</strong>, the more parameters are passed, the worse the performance  - since copying parameters to the place function expects to find them (be it a stack, a register or any other storage) takes non-0 time.</p>\n\n<p>From the other hand, semantic matters, and in this particular case, things are not equal! In your first case, you are passing 4 integer parameters. Assuming AMD64 ABI, they will be passed in CPU registers - which are super-fast to be accessed for both reading and writing.</p>\n\n<p>However, in the second case you are effectively passing a pointer to a memory location. Which means, accessing values through this pointer means indirection, and at best the values would be found in L1 CPU cache (most likely), but at worst will be read from main memory (super slow!). While L1 cache is fast, it is still much slower when compared to register access.</p>\n\n<p>Bottom line:</p>\n\n<p>I expect the second case to be slower, than the first one.</p>\n"}, {"tags": [], "owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "is_accepted": false, "score": 2, "last_activity_date": 1567624975, "creation_date": 1567624975, "answer_id": 57794658, "question_id": 57793471, "link": "https://stackoverflow.com/questions/57793471/how-does-function-parameters-and-local-variables-affect-on-the-performance-of-a/57794658#57794658", "title": "How does function parameters and local variables affect on the performance of a C program", "body": "<blockquote>\n  <p>is it worth to reduce the number of function parameters and local variables to enhance the performance of a C program?</p>\n</blockquote>\n\n<p>The first question to ask is, <em>will</em> it enhance the performance of your program?  Will it make a measurable difference at all?  Don't blindly assume that it will.</p>\n\n<p>The second question to ask is, what are the tradeoffs of doing so?  How will it affect your ability to debug and maintain your code?  Yes, you could make everything global to eliminate passing parameters and using locals, but the effect of that will be to make your code <em>much</em> harder to understand and maintain.</p>\n\n<p>When thinking about improving performance, you should start from the highest level and work your way down:</p>\n\n<ol>\n<li><p>Are you using the right data structures and/or algorithms for the problem at hand?  For example, an unoptimized quicksort will still beat the pants off an aggressively tuned bubble sort (in the average case), binary searches are usually faster than linear searches, etc.  </p></li>\n<li><p>Are you using the appropriate tools or libraries, or are you hand-hacking everything yourself?  It's possible there's already a solution out there that's been tested and tuned, such that you don't have to write from scratch.</p></li>\n<li><p>Have you implemented your design well?  For example, do you have any invariants in your loop bodies?</p></li>\n</ol>\n\n<p>If the answer to all of those question is \"yes\", then the next step is to let the compiler do some optimizing (such as using the <code>-O2</code> flag with gcc).  C compilers have gotten very good at optimizing code, and depending on the program you can see some significant speedup.  </p>\n\n<p>If at this point you still feel your code is too slow, then you need to do some analysis.  Run the code through a profiler to find where the bottlenecks are.  <em>At this point</em>, you can start to look at micro-optimizations like reducing the number of parameters being passed to a function.  Just be aware that it may not make enough of a difference to be worth the effort.  </p>\n"}], "owner": {"reputation": 755, "user_id": 11699772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd368b24a3051afd4ebf0196148b6e11?s=128&d=identicon&r=PG&f=1", "display_name": "XBlueCode", "link": "https://stackoverflow.com/users/11699772/xbluecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 2, "closed_date": 1567688256, "answer_count": 2, "score": 4, "last_activity_date": 1567935745, "creation_date": 1567619168, "last_edit_date": 1567935745, "question_id": 57793471, "link": "https://stackoverflow.com/questions/57793471/how-does-function-parameters-and-local-variables-affect-on-the-performance-of-a", "closed_reason": "Needs details or clarity", "title": "How does function parameters and local variables affect on the performance of a C program", "body": "<p>is it worth to reduce the number of function parameters and local variables to enhance the performance of a C program?</p>\n\n<p>in the provided code below, maybe the example doesn't make a difference if the function is called few times during the execution but maybe it make sense if it's called <strong>n times</strong>, so is there any performance benefits in this case?</p>\n\n<pre><code>int n[4];\n// read numbers ...\n\ndo_sum1(n[0], n[1], n[2], n[4]);\ndo_sum2(n);\n\n// Functions definition\n// --------------------\nvoid do_sum1(int a, int b, int c, int d)\n{\n  printf(\"%d\\n\", a + b + c + d);\n}\n\nvoid do_sum2(int n[4])\n{\n  printf(\"%d\\n\", n[0] + n[1] + n[2] + n[3]);\n}\n</code></pre>\n"}, {"tags": ["c", "typedef", "c11"], "answers": [{"comments": [{"owner": {"reputation": 96743, "user_id": 2455888, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/MQu4W.png?s=128&g=1", "display_name": "haccks", "link": "https://stackoverflow.com/users/2455888/haccks"}, "edited": false, "score": 0, "creation_date": 1567621281, "post_id": 57793519, "comment_id": 102020945, "body": "I always encourage to put all the typedefs before declarations."}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 96743, "user_id": 2455888, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/MQu4W.png?s=128&g=1", "display_name": "haccks", "link": "https://stackoverflow.com/users/2455888/haccks"}, "edited": false, "score": 1, "creation_date": 1567623555, "post_id": 57793519, "comment_id": 102021840, "body": "@haccks I always encourage not editing other people&#39;s code to a point where it can no longer compile. :D"}, {"owner": {"reputation": 96743, "user_id": 2455888, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/MQu4W.png?s=128&g=1", "display_name": "haccks", "link": "https://stackoverflow.com/users/2455888/haccks"}, "edited": false, "score": 0, "creation_date": 1567623635, "post_id": 57793519, "comment_id": 102021871, "body": "Sorry for that. I misunderstood it completely. Apologies."}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 96743, "user_id": 2455888, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/MQu4W.png?s=128&g=1", "display_name": "haccks", "link": "https://stackoverflow.com/users/2455888/haccks"}, "edited": false, "score": 0, "creation_date": 1567623733, "post_id": 57793519, "comment_id": 102021910, "body": "@haccks No problem :)."}], "tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": true, "score": 10, "last_activity_date": 1567752256, "last_edit_date": 1567752256, "creation_date": 1567619406, "answer_id": 57793519, "question_id": 57793450, "link": "https://stackoverflow.com/questions/57793450/use-of-comma-in-a-typedef-declaration/57793519#57793519", "title": "Use of comma in a typedef declaration?", "body": "<p>Yes, it is standard compliant. <code>typedef</code> declarations are like normal declarations except the identifiers declared by them become type aliases for the type of object the identifier would be if the declaration had no <code>typedef</code> in it.</p>\n\n<p>So while</p>\n\n<pre><code>int integer, *pointer_to_integer;\n</code></pre>\n\n<p>declare an <code>int</code> object named <code>integer</code> and an <code>int *</code> object named <code>pointer_to_integer</code></p>\n\n<pre><code>typedef int integer, *pointer_to_integer;\n</code></pre>\n\n<p>would declare an <code>int</code>-typed type alias named <code>integer</code> and an <code>int *</code>-typed type alias named <code>pointer_to_integer</code>.</p>\n\n<p>From a syntactical perspective, though not functionally, <code>typedef</code> is just a (fake) storage classifier (like <code>extern</code>, <code>auto</code>, <code>static</code>, <code>register</code> or <code>_Thread_local</code>).</p>\n\n<p>Your declaration</p>\n\n<pre><code>typedef struct element {\n    char *data; \n    struct element* next;\n} element, *list, elements[5];\n</code></pre>\n\n<p>is slightly more complicated because it also <em>defines</em> the <code>struct element</code> data type but it's equivalent to:</p>\n\n<pre><code>struct element {\n    char *data; \n    struct element* next;\n}; \n// &lt;= definition of the `struct element` data type\n// also OK if it comes after the typedefs\n// (the `struct element` part of the typedef would then\n// sort of forward-declare the struct )\n\n/*the type aliases: */\ntypedef struct element \n      element, *list, elements[5];\n</code></pre>\n\n<p>-- it declares <code>element</code> as a type alias to <code>struct element</code>, <code>list</code> as a type alias to <code>struct element *</code> and <code>elements</code> as a type alias to <code>struct element [5]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": false, "score": 1, "last_activity_date": 1567619618, "creation_date": 1567619618, "answer_id": 57793567, "question_id": 57793450, "link": "https://stackoverflow.com/questions/57793450/use-of-comma-in-a-typedef-declaration/57793567#57793567", "title": "Use of comma in a typedef declaration?", "body": "<p>In the C grammar, the <code>typedef</code> keyword acts like a storage-class specifier (like <code>extern</code>, <code>static</code>), per C 2018 6.7.1, and a type definition is simply a declaration. Like other declarations, it may have a list of <em>declarators</em> separated by commas (6.7 1).</p>\n\n<p>The <code>typedef</code> in the question defines <code>element</code> to be an alias for the <code>struct element</code> type, <code>list</code> to be an alias for a type that is a pointer to a <code>struct element</code>, and <code>elements</code> to be an alias for a type that is an array of 5 <code>struct element</code>.</p>\n"}], "owner": {"reputation": 18883, "user_id": 2612235, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/dpsjq.jpg?s=128&g=1", "display_name": "nowox", "link": "https://stackoverflow.com/users/2612235/nowox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 522, "favorite_count": 1, "accepted_answer_id": 57793519, "answer_count": 2, "score": 4, "last_activity_date": 1567752256, "creation_date": 1567619077, "question_id": 57793450, "link": "https://stackoverflow.com/questions/57793450/use-of-comma-in-a-typedef-declaration", "title": "Use of comma in a typedef declaration?", "body": "<p>Is this declaration C99/C11 compliant ?</p>\n\n<pre><code>typedef struct element {\n    char *data; \n    struct element* next;\n} element, *list, elements[5];\n</code></pre>\n\n<p>I could not find why it works in the standard.</p>\n"}, {"tags": ["c", "pointers", "character", "c-strings", "strcmp"], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 11906119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e04c4acad90da3ca440945cdd37c1cf?s=128&d=identicon&r=PG&f=1", "display_name": "MandaloreUltimate", "link": "https://stackoverflow.com/users/11906119/mandaloreultimate"}, "edited": false, "score": 0, "creation_date": 1567620597, "post_id": 57793466, "comment_id": 102020664, "body": "You mean it should be while (*str1 || *str2) ?"}, {"owner": {"reputation": 37, "user_id": 11906119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e04c4acad90da3ca440945cdd37c1cf?s=128&d=identicon&r=PG&f=1", "display_name": "MandaloreUltimate", "link": "https://stackoverflow.com/users/11906119/mandaloreultimate"}, "edited": false, "score": 0, "creation_date": 1567620771, "post_id": 57793466, "comment_id": 102020735, "body": "Well it solved this particular problem, though it still doesn&#39;t get all the tests. Anyways, thanks for the help, will continue on fixing some new problems..."}], "tags": [], "owner": {"reputation": 44000, "user_id": 535275, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Ft2Mw.jpg?s=128&g=1", "display_name": "Scott Hunter", "link": "https://stackoverflow.com/users/535275/scott-hunter"}, "is_accepted": false, "score": 0, "last_activity_date": 1567619133, "creation_date": 1567619133, "answer_id": 57793466, "question_id": 57793388, "link": "https://stackoverflow.com/questions/57793388/weird-bug-in-custom-strcmp-c/57793466#57793466", "title": "Weird bug in custom strcmp (C)", "body": "<p>The outer loop continues while <em>both</em> pointers are not at the end; this is not satisfied by exactly one being at the end (meaning it stops as soon as <em>either</em> pointer is at the end).</p>\n"}, {"tags": [], "owner": {"reputation": 328, "user_id": 11979706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81f60d5f1bab317984fe56dae07757bf?s=128&d=identicon&r=PG&f=1", "display_name": "AugustinLopez", "link": "https://stackoverflow.com/users/11979706/augustinlopez"}, "is_accepted": true, "score": 0, "last_activity_date": 1567664253, "last_edit_date": 1567664253, "creation_date": 1567624961, "answer_id": 57794655, "question_id": 57793388, "link": "https://stackoverflow.com/questions/57793388/weird-bug-in-custom-strcmp-c/57794655#57794655", "title": "Weird bug in custom strcmp (C)", "body": "<p>Your loop stops whenever a '\\0' is found in one of your string. But the other string might still contains space. When you compare \"ab\"<br>\nand \"ab        \", the second string will never be fully iterated other. You need to make sure that both your strings do not end up on a space. Try this fix:</p>\n\n<pre><code>while (*str1 != '\\0' &amp;&amp; *str2 != '\\0') {\n    while ((*str1) == ' ') {\n        str1++;\n    }\n    while ((*str2) == ' ') {\n        str2++;\n    }\n    if (*str1 != *str2 || *str1 == 0 || *str2 == 0)\n         break ;\n    str1++;\n    str2++;\n}\nwhile (*str1 == ' ')\n    str1++;\nwhile (*str2 == ' ')\n    str2++;\nreturn (unsigned char) *str1 - (unsigned char) *str2;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62, "user_id": 11957671, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZgSqbWfKr9k/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rclGdVbPIk7pw3rz9y8e1BFx82VwQ/photo.jpg?sz=128", "display_name": "biplav karna", "link": "https://stackoverflow.com/users/11957671/biplav-karna"}, "is_accepted": false, "score": 0, "last_activity_date": 1567630907, "creation_date": 1567630907, "answer_id": 57795599, "question_id": 57793388, "link": "https://stackoverflow.com/questions/57793388/weird-bug-in-custom-strcmp-c/57795599#57795599", "title": "Weird bug in custom strcmp (C)", "body": "<p>The problem with the shared code is that, the outer while loop breaks when any string reaches '\\0'. Try below code, it ensures both the strings are looped till end to check the match.</p>\n\n<pre><code>int mystrcmp(const char *str1, const char *str2)\n{\n    while (1) {\n        while ((*str1) == ' ') {\n            str1++;\n        }\n        while ((*str2) == ' ') {\n            str2++;\n        }\n        if (*str1 != *str2 ) {\n            return (unsigned char) *str1 - (unsigned char) *str2;\n        }\n        if ((*str1) != '\\0') str1++;\n        if ((*str2) != '\\0') str2++;\n\n        if ((*str1) == '\\0' &amp;&amp; (*str2) == '\\0')\n        {\n            return 0;\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 11906119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e04c4acad90da3ca440945cdd37c1cf?s=128&d=identicon&r=PG&f=1", "display_name": "MandaloreUltimate", "link": "https://stackoverflow.com/users/11906119/mandaloreultimate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 57794655, "answer_count": 3, "score": 0, "last_activity_date": 1567664253, "creation_date": 1567618839, "last_edit_date": 1567619274, "question_id": 57793388, "link": "https://stackoverflow.com/questions/57793388/weird-bug-in-custom-strcmp-c", "title": "Weird bug in custom strcmp (C)", "body": "<p>I had a task of writing custom strcmp that will compare two strings kinda ignoring the spaces in them (meaning, <code>\" a b  c\"</code> is <code>\"abc\"</code>) and return some positive number if <code>str1&gt;str2</code>, negative if <code>str2&gt;str1</code> and 0 if <code>str1=str2</code>. Here is the code</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>int mystrcmp(const char *str1, const char *str2)\n{\n    while (*str1 != '\\0' &amp;&amp; *str2 != '\\0') {\n        while ((*str1) == ' ') {\n            str1++;\n        }\n        while ((*str2) == ' ') {\n            str2++;\n        }\n        if (*str1 != *str2 || *str1 == 0 || *str2 == 0) {\n            return (unsigned char) *str1 - (unsigned char) *str2;\n        }\n        str1++;\n        str2++;\n    }\n    return (unsigned char) *str1 - (unsigned char) *str2;\n}\n</code></pre>\n\n<p>The problem is that it doesn't work properly with <code>\"ab \"</code> and <code>\"ab\"</code>, which are considered equal. Those whiles should get both <code>str1</code> and <code>str2</code> pointers to <code>'\\0'</code>, then subtract them and return 0. Instead, it returns 32, meaning it doesn't get <code>str1</code> to <code>'\\0'</code>. What am I missing?</p>\n"}, {"tags": ["c", "function", "char", "definition", "c-strings"], "comments": [{"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 5, "creation_date": 1567617329, "post_id": 57793042, "comment_id": 102019383, "body": "Does your compiler complain about a multi-character constant? (it should)"}, {"owner": {"reputation": 76876, "user_id": 287586, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/tB5AG.png?s=128&g=1", "display_name": "dan04", "link": "https://stackoverflow.com/users/287586/dan04"}, "edited": false, "score": 1, "creation_date": 1567617642, "post_id": 57793042, "comment_id": 102019500, "body": "<code>&#39;&#47;0&#39;</code> should be <code>&#39;\\0&#39;</code>.  That&#39;s not your main problem, though."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1567617742, "post_id": 57793042, "comment_id": 102019536, "body": "If you want letters and spaces, shouldn&#39;t you use <code>isalpha()</code> and <code>isspace()</code> (or perhaps <code>isblank()</code>)?  There are other non-letters than just the digits!"}], "answers": [{"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1567653083, "post_id": 57793337, "comment_id": 102028537, "body": "Unclear why code has <code>!*q ||</code> as the <i>null character</i> is not an alpha nor a blank."}], "tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 2, "last_activity_date": 1567620221, "last_edit_date": 1567620221, "creation_date": 1567618597, "answer_id": 57793337, "question_id": 57793042, "link": "https://stackoverflow.com/questions/57793042/function-that-returns-only-whitespaces-and-letters/57793337#57793337", "title": "Function that returns only whitespaces and letters", "body": "<p>For starters the function is declared incorrectly. It should be declared like</p>\n\n<pre><code>char * zastap( char *napis );\n               ^^^^^^^^^^^^ \n</code></pre>\n\n<p>Otherwise the declaration confuses users of the function. They will think that the function creates a copy of the original string.</p>\n\n<p>Instead of the check with the function <code>isdigit</code> you should use a check with functions <code>isalpha</code> and <code>isblank</code> and if a character satisfies these functions then write it in the result string.</p>\n\n<p>Within the function this loop statement</p>\n\n<pre><code>while (*jeden)\n</code></pre>\n\n<p>has an invalid condition.</p>\n\n<p>It seems you mean</p>\n\n<pre><code>while (*dwa)\n</code></pre>\n\n<p>The terminating zero character is <code>'\\0'</code> not <code>'/0'</code>.</p>\n\n<p>Here is a demonstrative program</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;ctype.h&gt;\n\nchar * zastap( char *napis ) \n{\n    char *p = napis, *q = napis;\n\n    do\n    {\n        if ( !*q || isalpha( ( unsigned char )*q ) || isblank( ( unsigned char )*q ) )\n        {\n            *p++ = *q;\n        }\n    } while ( *q++ );\n\n    return napis;\n}\n\nint main(void) \n{\n    char napis[] = \"2019Alek Lucek Kami\u0144ski2019\";\n\n    puts( napis );\n    puts( zastap( napis ) );\n\n    return 0;\n}\n</code></pre>\n\n<p>Its output is</p>\n\n<pre><code>2019Alek Lucek Kami\u0144ski2019\nAlek Lucek Kamiski\n</code></pre>\n\n<p>You may substitute this statement in the if statement inside the loop</p>\n\n<pre><code>*p++ = *q;\n</code></pre>\n\n<p>for these statements</p>\n\n<pre><code>if ( p != q ) *p = *q;\n++p; \n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 11932663, "user_type": "registered", "profile_image": "https://graph.facebook.com/2625038854207081/picture?type=large", "display_name": "Alek Lucek Kami\u0144ski", "link": "https://stackoverflow.com/users/11932663/alek-lucek-kami%c5%84ski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "closed_date": 1567688264, "answer_count": 1, "score": 0, "last_activity_date": 1567620221, "creation_date": 1567617144, "last_edit_date": 1567620112, "question_id": 57793042, "link": "https://stackoverflow.com/questions/57793042/function-that-returns-only-whitespaces-and-letters", "closed_reason": "Not suitable for this site", "title": "Function that returns only whitespaces and letters", "body": "<p>I'm trying to write an function that with given char string, returns the same string but w/o nothing except letters and whitespaces.</p>\n\n<p>I nearly nailed it, but I'm stuck with removing symbols like \".\", \"/\" and so on. </p>\n\n<p>Here is already running code but with issue I just describe.</p>\n\n<pre><code>char* zastap(const char *napis) {\n    char* jeden = napis;\n    char* dwa = napis;\n    while (*jeden) {\n        if(isdigit(*dwa)) {\n            dwa++;\n            continue; }\n        *jeden++ = *dwa++;\n    }\n    *jeden = '/0';\n    return napis;\n}\n</code></pre>\n\n<p>Oh btw, it have to be made in this form - I mean \"char* zastap(const char *napis) \"</p>\n\n<p>I would love if someone could show me the correct way to solve this. It's very basic conditional in a loop I guess, but I can't figure it out.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 172529, "user_id": 140750, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c7af12cad08c95bc206a9636d164224?s=128&d=identicon&r=PG", "display_name": "William Pursell", "link": "https://stackoverflow.com/users/140750/william-pursell"}, "edited": false, "score": 1, "creation_date": 1567618097, "post_id": 57793022, "comment_id": 102019680, "body": "What does the word &quot;connection&quot; mean in the context of udp?"}, {"owner": {"reputation": 157, "user_id": 7200139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ab71a47ac7bc3fc13e3943318577e46?s=128&d=identicon&r=PG&f=1", "display_name": "Dimfred", "link": "https://stackoverflow.com/users/7200139/dimfred"}, "reply_to_user": {"reputation": 172529, "user_id": 140750, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c7af12cad08c95bc206a9636d164224?s=128&d=identicon&r=PG", "display_name": "William Pursell", "link": "https://stackoverflow.com/users/140750/william-pursell"}, "edited": false, "score": 0, "creation_date": 1567618213, "post_id": 57793022, "comment_id": 102019722, "body": "<a href=\"https://www.geeksforgeeks.org/udp-client-server-using-connect-c-implementation/\" rel=\"nofollow noreferrer\">geeksforgeeks.org/&hellip;</a>   In this example they are connecting the udp client socket, but to a specific client not to the broadcast addr"}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 0, "creation_date": 1567619230, "post_id": 57793022, "comment_id": 102020112, "body": "Try binding the socket to a specific network interface."}, {"owner": {"reputation": 157, "user_id": 7200139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ab71a47ac7bc3fc13e3943318577e46?s=128&d=identicon&r=PG&f=1", "display_name": "Dimfred", "link": "https://stackoverflow.com/users/7200139/dimfred"}, "edited": false, "score": 0, "creation_date": 1567680409, "post_id": 57793022, "comment_id": 102039195, "body": "Thats a bit tricky, but I will try to find out how I get the interface name on my esp32"}], "answers": [{"comments": [{"owner": {"reputation": 24802, "user_id": 232918, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b5897762377de1c8ffb9a98673262e91?s=128&d=identicon&r=PG", "display_name": "doron", "link": "https://stackoverflow.com/users/232918/doron"}, "edited": false, "score": 1, "creation_date": 1567688690, "post_id": 57805731, "comment_id": 102043889, "body": "The maximum packet size on most systems is 1472 for udp. This fits I to a standard ethernet frame of 1500. Larger datagrams may be split and reassembled but if one part is lost the other parts are discarded. So datagram sizes below 1472 bytes"}, {"owner": {"reputation": 157, "user_id": 7200139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ab71a47ac7bc3fc13e3943318577e46?s=128&d=identicon&r=PG&f=1", "display_name": "Dimfred", "link": "https://stackoverflow.com/users/7200139/dimfred"}, "reply_to_user": {"reputation": 24802, "user_id": 232918, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b5897762377de1c8ffb9a98673262e91?s=128&d=identicon&r=PG", "display_name": "doron", "link": "https://stackoverflow.com/users/232918/doron"}, "edited": false, "score": 0, "creation_date": 1567695935, "post_id": 57805731, "comment_id": 102048238, "body": "Thank you, now this makes more sense."}], "tags": [], "owner": {"reputation": 157, "user_id": 7200139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ab71a47ac7bc3fc13e3943318577e46?s=128&d=identicon&r=PG&f=1", "display_name": "Dimfred", "link": "https://stackoverflow.com/users/7200139/dimfred"}, "is_accepted": false, "score": 0, "last_activity_date": 1567687240, "creation_date": 1567687240, "answer_id": 57805731, "question_id": 57793022, "link": "https://stackoverflow.com/questions/57793022/proper-way-to-connect-clients-servers-for-udp-broadcast/57805731#57805731", "title": "Proper way to connect clients/servers for UDP broadcast", "body": "<p>So I found the error. It was not related to my code.</p>\n\n<p>It seems like my esp32 (wroom) is not capable of sending packages with a size > 4096. </p>\n\n<p>Reducing the package size gives me correct results.</p>\n\n<p>Have to dig further maybe there is some config which can be set for this problem.</p>\n\n<p>Thank you for your help.</p>\n"}], "owner": {"reputation": 157, "user_id": 7200139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ab71a47ac7bc3fc13e3943318577e46?s=128&d=identicon&r=PG&f=1", "display_name": "Dimfred", "link": "https://stackoverflow.com/users/7200139/dimfred"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567687240, "creation_date": 1567617050, "last_edit_date": 1567617789, "question_id": 57793022, "link": "https://stackoverflow.com/questions/57793022/proper-way-to-connect-clients-servers-for-udp-broadcast", "title": "Proper way to connect clients/servers for UDP broadcast", "body": "<p>So I try to achieve that <code>1</code> ESP can send a UDP package to <code>N</code> ESP's.</p>\n\n<p>What I have done:</p>\n\n<ul>\n<li>Created a client who connects to the <code>255.255.255.255</code> and sends packages</li>\n<li>Created N servers which bind to <code>0.0.0.0</code> and are listening</li>\n</ul>\n\n<p>I know my servers works, when I send packages over the terminal it receives.</p>\n\n<p>I think something is wrong in the cliencode:</p>\n\n<pre><code>struct sockaddr_in send_addr;\nsend_addr.sin_family = AF_INET;\n//send_addr.sin_addr.s_addr = inet_addr( \"255.255.255.255\" );\ninet_aton( \"255.255.255.255\", &amp;send_addr.sin_addr );\nsend_addr.sin_len = sizeof(send_addr);\nsend_addr.sin_port = htonl(6001);\n\nint sock = ::socket( AF_INET, SOCK_DGRAM, IPPROTO_UDP );\n\nint flag = 1;\nsetsockopt( sock, SOL_SOCKET, SO_BROADCAST, &amp;flag, sizeof(flag) );\n\n// fails when I try to bound it to 255.255.255.255\nconnect( sock, (const struct sockaddr*)&amp;send_addr, sizeof(sock) ); \n\nint send_buf[32]; // filled with data\n\nwhile(1)\n{\n  sendto( sock, send_buf, 32, 0,\n     (const struct sockaddr*)&amp;send_addr, sizeof(send_addr) );\n}\n\n// EDIT1 \non the other side the servers are listening\n</code></pre>\n\n<p>Any help appreciated.\nI compile with C++ dunno whether this makes a difference.</p>\n\n<p>EDIT1:\nI also tried without the connect I don't get a connection error then, and no send error (correct size is written to the socket), but no msg at server(s) side.</p>\n\n<p>I send my terminal package with </p>\n\n<p><code>echo -e \"msg\" | socat - UDP_DATAGRAM:255.255.255.255:6001,broadcast</code></p>\n\n<p>Don't know what it does in the background, but this would help a lot if I knew.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1567616452, "post_id": 57792850, "comment_id": 102019011, "body": "You can ask the user to type something, and then generate a seed based on how long it took them to type it. Using the microsecond part of the timing should have reasonable entropy."}, {"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1567616500, "post_id": 57792850, "comment_id": 102019031, "body": "What device is this for? Are there any hardware ports that might generate random &quot;noise&quot;?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1567616565, "post_id": 57792850, "comment_id": 102019049, "body": "If you have some non-volatile RAM seed it with the last random number from the previous run, which you store at that location."}, {"owner": {"reputation": 31, "user_id": 9453633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f05c0d56230d50443936aa98ffbb97?s=128&d=identicon&r=PG&f=1", "display_name": "the freethinker", "link": "https://stackoverflow.com/users/9453633/the-freethinker"}, "edited": false, "score": 0, "creation_date": 1567616583, "post_id": 57792850, "comment_id": 102019061, "body": "unfortunately no. this is a test for verifying an soc that houses an arm processor."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 2, "creation_date": 1567617184, "post_id": 57792850, "comment_id": 102019313, "body": "If the soc has an A/D converter, that can be used."}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1567619478, "post_id": 57792850, "comment_id": 102020191, "body": "Add a hardware RNG. <a href=\"https://en.wikipedia.org/wiki/Hardware_random_number_generator\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Hardware_random_number_generator</a>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 1, "creation_date": 1567642292, "post_id": 57792850, "comment_id": 102026800, "body": "if your SOC contains a real time clock, then you should be able to read that clock value to obtain the needed seed value"}, {"owner": {"reputation": 455, "user_id": 4899025, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGgvb.jpg?s=128&g=1", "display_name": "Ajith C Narayanan", "link": "https://stackoverflow.com/users/4899025/ajith-c-narayanan"}, "edited": false, "score": 0, "creation_date": 1568210471, "post_id": 57792850, "comment_id": 102203218, "body": "I am not clear about ur exact requirement. Why you need a seed value other than time? Try - declare a variable , use it&#39;s address to seed"}, {"owner": {"reputation": 31, "user_id": 9453633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f05c0d56230d50443936aa98ffbb97?s=128&d=identicon&r=PG&f=1", "display_name": "the freethinker", "link": "https://stackoverflow.com/users/9453633/the-freethinker"}, "reply_to_user": {"reputation": 455, "user_id": 4899025, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGgvb.jpg?s=128&g=1", "display_name": "Ajith C Narayanan", "link": "https://stackoverflow.com/users/4899025/ajith-c-narayanan"}, "edited": false, "score": 0, "creation_date": 1568300599, "post_id": 57792850, "comment_id": 102238937, "body": "@AjithCNarayanan Thanks that worked. I cant use time as I dont run the app on an OS. Its bare metal."}], "owner": {"reputation": 31, "user_id": 9453633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21f05c0d56230d50443936aa98ffbb97?s=128&d=identicon&r=PG&f=1", "display_name": "the freethinker", "link": "https://stackoverflow.com/users/9453633/the-freethinker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567616203, "creation_date": 1567616203, "question_id": 57792850, "link": "https://stackoverflow.com/questions/57792850/seed-for-srand-other-than-time-and-getpid", "title": "Seed for srand() other than time() and getpid()", "body": "<p>I am doing bare metal programming. I want to generate different random numbers across different executions, for which I have to seed the srand() function. but time(), gettimeofday() or getpid() is not an option. what else can I use as seed for srand() to get the desired result. \nAny help/advice would be greatly appreciated. Thanks</p>\n\n<p>PS: Any other ways to get different random numbers across different runs other than rand/srand combinations are also welcome.</p>\n"}, {"tags": ["c++", "c", "sockets", "tcp", "send"], "comments": [{"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 1, "creation_date": 1567615947, "post_id": 57792687, "comment_id": 102018800, "body": "Are you using TCP or UDP?"}, {"owner": {"reputation": 1265, "user_id": 613996, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/p4yhq.jpg?s=128&g=1", "display_name": "ARH", "link": "https://stackoverflow.com/users/613996/arh"}, "reply_to_user": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1567616287, "post_id": 57792687, "comment_id": 102018942, "body": "@JesperJuhl This is all TCP sockets"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 3, "creation_date": 1567616506, "post_id": 57792687, "comment_id": 102019032, "body": "<i>&quot;I have no idea how can I tell which portion of the message is not sent&quot;</i> - sendmsg returns the total size it has send. It sends the buffers in the order you&#39;ve given. It sends each buffer from the beginning. Since you know the size of the buffers you can compute where it stopped sending and thus where you need to continue. Of course, this might be inside one of the buffers. <i>&quot;Does it send the iovs sequentially ?&quot;</i> - sure it does, what would you expect it to do otherwise. TCP is a byte stream and not a message protocol, so there is no real choice apart from sending all in the given order"}, {"owner": {"reputation": 7744, "user_id": 9666018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2959ed405ad18cbca6aa3efe01bc7d?s=128&d=identicon&r=PG&f=1", "display_name": "Armin Montigny", "link": "https://stackoverflow.com/users/9666018/armin-montigny"}, "edited": false, "score": 1, "creation_date": 1567616878, "post_id": 57792687, "comment_id": 102019181, "body": "If you do non-blocking io then you may think about using one of the select, poll, epoll functions. This is the standard approach. You can also implement a Proactor. You may find some related stuff here: <a href=\"https://github.com/Armin-Montigny/SmlParser\" rel=\"nofollow noreferrer\">github.com/Armin-Montigny/SmlParser</a>"}, {"owner": {"reputation": 1265, "user_id": 613996, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/p4yhq.jpg?s=128&g=1", "display_name": "ARH", "link": "https://stackoverflow.com/users/613996/arh"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1567617539, "post_id": 57792687, "comment_id": 102019461, "body": "@SteffenUllrich I accept your answer. I wish if you provide a reference for the fact that iovs are sent sequentially and there is no way that they can sent out of order in the current kernel and would not be the case in the future kernel releases as well."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1567623908, "post_id": 57792687, "comment_id": 102021983, "body": "@ARH: It is not clearly defined in POSIX since I guess nobody even had the idea that data to an ordered byte stream could be written differently then in the most logical order in <code>iov</code>, i.e. from the start of the array to the end of the array. Similar it is not explicitly written down that the buffer in <code>send</code> gets written from start to end, since everything else would just be strange."}, {"owner": {"reputation": 2385, "user_id": 10306503, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c5d6c9b08dd045f4876591d703bda6?s=128&d=identicon&r=PG", "display_name": "mosvy", "link": "https://stackoverflow.com/users/10306503/mosvy"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1567633011, "post_id": 57792687, "comment_id": 102024992, "body": "@SteffenUllrich isn&#39;t this from <a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/functions/sendmsg.html\" rel=\"nofollow noreferrer\">here</a> enough?: &quot;The data from each storage area indicated by msg_iov is sent in turn&quot;"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 2385, "user_id": 10306503, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c5d6c9b08dd045f4876591d703bda6?s=128&d=identicon&r=PG", "display_name": "mosvy", "link": "https://stackoverflow.com/users/10306503/mosvy"}, "edited": false, "score": 0, "creation_date": 1567656642, "post_id": 57792687, "comment_id": 102029203, "body": "@mosvy: I&#39;m not fully familiar with the fine details of English language. But for me &quot;in turn&quot; just means that they are sent in a specific and fixed order and not what this specific order actually is. This is more clearly defined in the Linux man page for <a href=\"https://linux.die.net/man/2/writev\" rel=\"nofollow noreferrer\">writev</a> which has a similar interface: <i>&quot;Buffers are processed in <b>array order</b>. This means ...  <b>iov[0] before ... iov[1]</b>, and so on. ...  writev() <b>writes out the entire contents of iov[0] before proceeding to iov[1]</b>, and so on.&quot;</i>"}, {"owner": {"reputation": 7725, "user_id": 681479, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/20bba354e7258f5e647102f63904a7a9?s=128&d=identicon&r=PG", "display_name": "Brian White", "link": "https://stackoverflow.com/users/681479/brian-white"}, "edited": false, "score": 0, "creation_date": 1567686987, "post_id": 57792687, "comment_id": 102042913, "body": "See also: <a href=\"https://stackoverflow.com/questions/14241235/what-happens-when-i-write-data-to-a-blocking-socket-faster-than-the-other-side/14244450#14244450\" title=\"what happens when i write data to a blocking socket faster than the other side\">stackoverflow.com/questions/14241235/&hellip;</a> which describes the TCP operation and how buffering works.  Though that was written in the context of a <i>blocking</i> send, the behavior is identical except that a <i>non-blacking</i> <code>sendmsg()</code> returns immediately telling you how many bytes from the beginning of the buffer were added to the local send window."}], "owner": {"reputation": 1265, "user_id": 613996, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/p4yhq.jpg?s=128&g=1", "display_name": "ARH", "link": "https://stackoverflow.com/users/613996/arh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 400, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567616688, "creation_date": 1567615445, "last_edit_date": 1567616688, "question_id": 57792687, "link": "https://stackoverflow.com/questions/57792687/how-to-deal-with-sendmsg2-when-it-send-a-message-partially-in-linux", "title": "How to deal with sendmsg(2) when it send a message partially in Linux?", "body": "<p>I have a performance sensitive client and server application with stream POSIX TCP sockets. All communications on the socket are done with  non-blocking flag. I am using <code>sendmsg(2)</code> system call to send a message with multiple buffer and use <code>recv(2)</code> to pick the buffers individually on the other side of the wire. </p>\n\n<p><code>sendmsg(2)</code> can send the message partially and I have no idea how can I tell which portion of the message is not sent so I can send it again. I don't want to send entire message again. </p>\n\n<p>I did a little research and found for example Linux CIFS in this case terminates the connection session and send the entire message again. <a href=\"https://github.com/torvalds/linux/blob/master/fs/cifs/transport.c#L430\" rel=\"nofollow noreferrer\">Reference</a>. That is not really what I want. </p>\n\n<p>For example:</p>\n\n<pre><code>void sys_sendmsg(int fd, struct iovec *iov, size_t length, int flags) \n{\n    struct msghdr msg = (struct msghdr) {\n        .msg_iov    = iov,\n        .msg_iovlen = length,\n    };  \n\n    ssize_t iov_byte_len;\n    for (i = 0; i &lt; msg.msg_iovlen; ++i) {\n        iov_byte_len += msg.msg_iov[i].iov_len;\n    }\n\n    ssize_t sent_len;\n    sent_len = sendmsg(fd, &amp;msg, flags);\n\n    if( sent_len &gt; 0 &amp;&amp; sent_len &lt; iov_byte_len){\n        // What should I do here ?\n        // I don't want to send entire message again\n        // Which portion of this message is sent ?\n        // Does it send the iovs sequentially ? \n    }\n\n}\n</code></pre>\n"}, {"tags": ["c", "language-lawyer", "strict-aliasing"], "answers": [{"comments": [{"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 0, "creation_date": 1567783778, "post_id": 57824682, "comment_id": 102079825, "body": "A pointer to a struct can be safely converted to a pointer to its first member as per 6.7.2.1p15, so <code>*(uint32_t *)obj</code> or <code>((uint32_t *)obj)[0]</code> is valid but  <code>((uint32_t *)obj)[1]</code> is not."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "reply_to_user": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 0, "creation_date": 1567784150, "post_id": 57824682, "comment_id": 102079995, "body": "@dbush Thanks, I totally forgot about 6.7.2.1p15.  Answer edited."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 0, "creation_date": 1567884167, "post_id": 57824682, "comment_id": 102101967, "body": "@dbush: Where does the Standard say that an aggregate can have its storage accessed using an lvalue of member type?  N1570 6.5p7 provides that an aggregate&#39;s member can be accessed using an lvalue of containing aggregate type, but requiring that compilers support the reverse <i>in all corner cases</i> would needlessly impair optimizations.  Instead, the Standard relies upon compilers to support lvalue accesses in cases relevant to their intended purposes, regardless of whether the Standard requires them to or not."}, {"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "edited": false, "score": 0, "creation_date": 1568032881, "post_id": 57824682, "comment_id": 102134706, "body": "Can you share a reference to <code>An implementation is also allowed to do arbitrarily aggressive inlining and interprocedural analysis, during translation phase 8 (&quot;link-time optimization&quot;)</code> ? I didn&#39;t find any occurrence in the standard"}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "reply_to_user": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "edited": false, "score": 0, "creation_date": 1568034551, "post_id": 57824682, "comment_id": 102135615, "body": "@user2162550 That&#39;s hard; it&#39;s allowed because nothing says it <i>isn&#39;t</i> allowed.  The best you&#39;re going to get within the text of the standard is <a href=\"http://port70.net/~nsz/c/c11/n1570.html#5.1.2.3\" rel=\"nofollow noreferrer\">section 5.1.2.3</a>, I think, but you have to read very carefully, paying attention to both what is said and what isn&#39;t said, and think about the implications of what is and isn&#39;t considered to be &quot;observable behavior.&quot;"}], "tags": [], "owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "is_accepted": true, "score": 3, "last_activity_date": 1567784134, "last_edit_date": 1567784134, "creation_date": 1567783062, "answer_id": 57824682, "question_id": 57792531, "link": "https://stackoverflow.com/questions/57792531/does-strict-aliasing-occur-when-using-void-pointer-intervening/57824682#57824682", "title": "Does strict aliasing occur when using void pointer intervening", "body": "<p>This is mostly a duplicate question, but I am going to write out an answer to it anyway, because I can't find an earlier answer that discusses the specific issues of casting through <code>void *</code> and separate compilation.</p>\n\n<p>First off, let us imagine a simpler version of your code:</p>\n\n<pre><code>#include &lt;stddef.h&gt;\n#include &lt;stdint.h&gt;\n\nextern void func_takes_word(uint32_t word);\n\nstruct __attribute__((packed, aligned(_Alignof(uint32_t)))) some_struct\n{\n    uint32_t num_0;\n    uint32_t num_1;\n    uint32_t num_2;\n};\n\nvoid some_func(void)\n{\n    struct some_struct stc = {0, 1, 59};\n\n    for (size_t i = 0; i &lt; sizeof(struct some_struct) / sizeof(uint32_t); i++)\n        func_takes_word(*(((uint32_t *)&amp;stc) + i));\n}\n</code></pre>\n\n<p>(The GCC <code>__attribute__((packed, aligned(...)))</code> annotation is present only to exclude the possibility of any problems due to padding or misalignment.  Everything I say below would still be true if you took it out.)</p>\n\n<p>According to the most straightforward interpretation of C2011 as written, this code <em>does</em> violate the \"strict aliasing\" rules (N1570: <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.2.7\" rel=\"nofollow noreferrer\">6.2.7</a> and <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.5p6\" rel=\"nofollow noreferrer\">6.5p6,7</a>).  The type <code>struct some_struct</code> is not compatible with the type <code>uint32_t</code>.  Therefore, taking the address of an object with declared type <code>struct some_struct</code>, casting the resultant pointer to type <code>uint32_t *</code>, adding a nonzero offset, and dereferencing the cast pointer, has undefined behavior.  It really is that simple.  (<strong>EDIT:</strong> If the pointer is not offset, the dereference has well-defined behavior, because of a special case rule hiding in <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.7.2.1p15\" rel=\"nofollow noreferrer\">section 6.7.2p15</a> which I totally forgot about.  Thanks to dbush for pointing this out.)</p>\n\n<p>Many people angrily resist this interpretation of the standard and insist that the committee must have meant something else, because there are millions, if not billions, of lines of \"legacy\" C code out there that do exactly the above and expect it to work. Not to mention that it's unclear how you could do anything useful whatsoever with <code>offsetof</code> under this interpretation.  But the text really does say this, there's no other plausible interpretation, and the wording of the relevant sections of the standard has been mostly unchanged since the original 1989 ANSI C.  I think we have to assume that the committee's lack of interest in changing the text, for thirty years now, despite several formal requests for clarification or correction, means it says what they wanted it to say.</p>\n\n<hr>\n\n<p>Now, regarding casting through <code>void *</code> and/or splitting up the operations so that the original \"effective type\" of the object is not visible to the code that performs the dereference: <strong><em>These make no difference.</em></strong>  Your original pair of translation units still has undefined behavior.</p>\n\n<p>Casts through <code>void *</code> make no difference because the rules in section 6.5.p6 say nothing about intermediate casts.  They only talk about the \"effective type\" of the actual object in memory, and the type of the lvalue expression used to access the object.  So, it doesn't matter what types the pointer may have had in between the time when the object's address was taken, and the time when the pointer was dereferenced (as long as none of the casts destroy information, which is guaranteed not to happen for casts from object types to <code>void *</code> and back).</p>\n\n<p>Splitting the operations up, so that the original \"effective type\" of the object is not visible (statically) to the code that performs the dereference, makes no difference because the C standard places no limits whatsoever on the sophistication of the analysis the compiler is allowed to perform before deciding whether an access is allowed.  In particular, an implementation that tags every byte of memory with its \"effective type\", and performs <em>runtime</em> checks on every dereference, has been explicitly endorsed by the committee (not in the text of the standard, but in DR responses, I don't remember how long ago this was and WG14's website is not very searchable).  An implementation is also allowed to do arbitrarily aggressive inlining and interprocedural analysis, during translation phase 8 (\"link-time optimization\") as well as phase 7.  Collapsing your original program into my \"simpler version\" is well within the capabilities of current-generation whole-program optimizing compilers.</p>\n\n<hr>\n\n<p>As pointed out in the comments on the question, you may be able to rely on knowledge of how sophisticated a specific implementation's optimizer is, or on an implementation's overt extensions (e.g. <code>__attribute__((noinline))</code>) to control whether or not you get machine code that behaves as intended <em>despite</em> the undefined behavior.  The C standard even explicitly licenses you to do this, by defining a distinction between a \"conforming program\" and a \"strictly conforming program\" (N1570: <a href=\"http://port70.net/~nsz/c/c11/n1570.html#4\" rel=\"nofollow noreferrer\">section 4</a>).  A program that relies on one particular implementation's treatment of undefined behavior can still be <em>conforming</em> but is not <em>strictly conforming</em>, and its authors have to be aware that it might break when ported to a different implementation (including, perhaps, a newer version of the same compiler).</p>\n"}, {"tags": [], "owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "is_accepted": false, "score": -2, "last_activity_date": 1567888306, "creation_date": 1567888306, "answer_id": 57837258, "question_id": 57792531, "link": "https://stackoverflow.com/questions/57792531/does-strict-aliasing-occur-when-using-void-pointer-intervening/57837258#57837258", "title": "Does strict aliasing occur when using void pointer intervening", "body": "<p>The rules given in N1570 6.5p7 partition accesses into two categories:</p>\n\n<ol>\n<li><p>Those which all conforming implementations would be required to process, in all cases, in a manner consistent with the definition and descriptions of \"object\" and \"stored\".</p></li>\n<li><p>Those which conforming implementations may or may not process in such fashion, at their leisure, presumably taking into account upon the needs of their customers.</p></li>\n</ol>\n\n<p>The authors only expected this partition to be relevant in situations where an implementation's customers might not expect to need a certain construct, but where they might want to use code which does need it.  There are many constructs which pretty much everyone would agree compilers should support, but which actually fall into the second category above.  Contrary to what the authors of clang and gcc seem to believe, the failure of the Standard to mandate support for a construct cannot reasonably be viewed as passing any judgment as to whether most (if not all) compilers should support it anyway.</p>\n\n<p>The way the Standard is written, even something like:</p>\n\n<pre><code>struct S { int x[1]; } s;\nint test1(void)\n{\n  s.x[0] = 1;\n}\n</code></pre>\n\n<p>which is downright tame compared to your example falls in the second category above.  Further, relatively little code would rely upon a compiler given something something close to your example such as:</p>\n\n<pre><code>struct S { int x[1], y[1], z[1]; } s;\nint test2(int index)\n{\n  s.y[0] = 1;\n  s.x[index] = 2;\n  return s.y[0];\n}\n</code></pre>\n\n<p>to allow for the possibility that the access to <code>s.x[index]</code> might affect <code>s.y[0]</code>.  Code which needs to access memory in \"interesting\" ways generally does so with constructs that could be easily recognized by any compiler that cared to look for them, e.g. given something closer to your example:</p>\n\n<pre><code>struct S { int x[1], y[1], z[1]; } s;\nint test3(int index)\n{\n  s.y[0] = 1;\n  ((int*)&amp;s)[index] = 2;\n  return s.y[0];\n}\n</code></pre>\n\n<p>it would seem unlikely that programmers would cast a <code>struct S*</code> to an <code>int*</code> absent an intention to access it in \"unusual\" fashion, and thus a compiler that treats such a cast as an indication that it should allow for such things would be unlikely to block useful optimizations.</p>\n\n<p>The Standard makes no distinction between <code>test2</code> and <code>test3</code>, and I'm not aware of anything in the clang nor gcc documentation that would do so either.  Although current versions of gcc seems to make such a distinction, and although current clang misses the optimization for both functions, I would not rely upon either compiler to support <code>test3</code> or other functions requiring similar semantics meaningfully unless or until they explicitly document such support.</p>\n"}], "owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 57824682, "answer_count": 2, "score": 2, "last_activity_date": 1567888306, "creation_date": 1567614699, "last_edit_date": 1567617390, "question_id": 57792531, "link": "https://stackoverflow.com/questions/57792531/does-strict-aliasing-occur-when-using-void-pointer-intervening", "title": "Does strict aliasing occur when using void pointer intervening", "body": "<p>Does the following example violates strict aliasing rule?</p>\n\n<p>In file <em>a.c</em></p>\n\n<pre><code>extern func_takes_word(uint32_t word);\n\nvoid func(void *obj, size_t size_in_words)\n{\n    for (int i = 0; i &lt; size_in_words; i++)\n        func_takes_word(*(((uint32_t *)obj)+i)); // &lt;--- Here\n}\n</code></pre>\n\n<p>in file <em>b.c</em></p>\n\n<pre><code>struct some_struct\n{\n    uint32_t num_0;\n    uint32_t num_1;\n    uint32_t num_2;\n};\n\nextern void func(void *obj, size_t size_in_words);\n\nvoid some_func(void)\n{\n    struct some_struct stc = {0, 1, 59}; // assume no padding\n    func((void *)&amp;stc, sizeof(struct some_struct)/sizeof(uint32_t));\n}\n</code></pre>\n\n<p>One can say that there is a violation because I send a <code>struct some_struct</code> pointer to  <code>func</code> which cast it to an <code>uint32_t</code> pointer than access the value.</p>\n\n<p>But, since <code>func</code> takes a <code>void</code> pointer, and since <code>func</code> is in a different compilation unit than the caller, the compiler cannot \"see\" such a violation.</p>\n\n<hr>\n\n<p>And what about the following example, according to my understanding there is no violation and it's completely strict aliasing compliant:</p>\n\n<pre><code>extern func_takes_word(uint32_t word);\n\nvoid func(void *obj, size_t size_in_words)\n{\n    uint32_t word;\n\n    for (int i = 0; i &lt; size_in_words; i++)\n    {\n        // instead of calling memcpy, (or using union type punning) \n        // for learning purpose\n        *(char *)&amp;word = *((char *)obj+ (sizeof(uint32_t) * i)); \n        *(((char *)&amp;word) + 1) = *((char *)obj+ (sizeof(uint32_t) * i)+1);\n        *(((char *)&amp;word) + 2) = *((char *)obj+ (sizeof(uint32_t) * i)+2);\n        *(((char *)&amp;word) + 3) = *((char *)obj+ (sizeof(uint32_t) * i)+3);\n        func_takes_word(word);\n    }\n}\n</code></pre>\n\n<p>Am I correct?</p>\n"}, {"tags": ["c", "linux", "pipe", "posix", "ipc"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1567614359, "post_id": 57792350, "comment_id": 102018140, "body": "You&#39;re passing a null pointer to a function (system call) <code>pipe()</code> that doesn&#39;t accept null pointers.  Don&#39;t do that."}, {"owner": {"reputation": 172529, "user_id": 140750, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c7af12cad08c95bc206a9636d164224?s=128&d=identicon&r=PG", "display_name": "William Pursell", "link": "https://stackoverflow.com/users/140750/william-pursell"}, "edited": false, "score": 0, "creation_date": 1567614423, "post_id": 57792350, "comment_id": 102018172, "body": "ctx is a pointer.  Its value is zero.  Referencing <code>ctx-&gt;pipefd</code> is bad."}, {"owner": {"reputation": 172529, "user_id": 140750, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c7af12cad08c95bc206a9636d164224?s=128&d=identicon&r=PG", "display_name": "William Pursell", "link": "https://stackoverflow.com/users/140750/william-pursell"}, "edited": false, "score": 0, "creation_date": 1567614486, "post_id": 57792350, "comment_id": 102018198, "body": "You probably meant <code>ctx_t ctx[] = {0}</code> instead of <code>ctx_t *ctx ...</code>"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 172529, "user_id": 140750, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c7af12cad08c95bc206a9636d164224?s=128&d=identicon&r=PG", "display_name": "William Pursell", "link": "https://stackoverflow.com/users/140750/william-pursell"}, "edited": false, "score": 0, "creation_date": 1567614674, "post_id": 57792350, "comment_id": 102018274, "body": "@WilliamPursell \u2014 you&#39;d probably get warnings from the compiler about insufficient braces in the initializer \u2014 you&#39;d need something like <code>ctx_t ctx[] = { { { 0, 0 } } };</code> to be fully braced (outer braces for array, middle ones for the structure, inner ones for the array within the structure)."}, {"owner": {"reputation": 172529, "user_id": 140750, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c7af12cad08c95bc206a9636d164224?s=128&d=identicon&r=PG", "display_name": "William Pursell", "link": "https://stackoverflow.com/users/140750/william-pursell"}, "edited": false, "score": 0, "creation_date": 1567615077, "post_id": 57792350, "comment_id": 102018436, "body": "I know that <code>gcc</code> will take <code>{0}</code> and initialize the declared object to be all zero, but am not sure if that is a standard feature."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1567615167, "post_id": 57792350, "comment_id": 102018478, "body": "It is standard \u2014 fully-braced is not mandatory, but the explanation of how initializers work is rather complex (C11 <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.7.9\" rel=\"nofollow noreferrer\">&#167;6.7.9 Initialization, &#182;13 onwards</a>)."}], "answers": [{"tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": true, "score": 4, "last_activity_date": 1567614540, "creation_date": 1567614540, "answer_id": 57792496, "question_id": 57792350, "link": "https://stackoverflow.com/questions/57792350/pipe-bad-address-on-pipe-open/57792496#57792496", "title": "Pipe &quot;bad address&quot; on pipe open", "body": "<p>You're passing a null pointer to a function (system call) <code>pipe()</code> that doesn't accept null pointers.  Don't do that!</p>\n\n<pre><code>ctx_t *ctx = {0};\n</code></pre>\n\n<p>That sets <code>ctx</code> to a null pointer, albeit somewhat verbosely (the braces are not necessary, though they're not harmful).  You need to allocate the <code>ctx_t</code> structure somewhere before trying to use it.</p>\n\n<p>Use:</p>\n\n<pre><code>cts_t ctx = { { 0, 0 } };\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>if (pipe(ctx.pipefd) != 0)\n    \u2026report error etc\u2026\n</code></pre>\n\n<p>Using <code>== -1</code> is also OK.</p>\n"}], "owner": {"reputation": 155, "user_id": 4620644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa69caba453f7284e3e123406d337058?s=128&d=identicon&r=PG&f=1", "display_name": "rockstiff", "link": "https://stackoverflow.com/users/4620644/rockstiff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 0, "accepted_answer_id": 57792496, "answer_count": 1, "score": 2, "last_activity_date": 1567614540, "creation_date": 1567613840, "question_id": 57792350, "link": "https://stackoverflow.com/questions/57792350/pipe-bad-address-on-pipe-open", "title": "Pipe &quot;bad address&quot; on pipe open", "body": "<p>So, im trying to start a webserver that uses pipes to comunicate between process. </p>\n\n<p>I was thinking to make a struct named <code>ctx</code> to send other info also.</p>\n\n<p>My code looks like this:</p>\n\n<p><strong>webserver.h</strong></p>\n\n<pre><code>typedef struct\n{\n    int pipefd[2];\n} ctx_t;\n</code></pre>\n\n<p><strong>webserver.c</strong></p>\n\n<pre><code>int main(int argc, char *argv[]){\n    ctx_t *ctx = {0};\n    if(pipe(ctx-&gt;pipefd) == -1){\n        perror(\"ctx pipe error\");\n        exit(EXIT_FAILURE);\n    }\n    ...\n    ...\n}\n</code></pre>\n\n<p><strong>Output:</strong> \"ctx pipe error: Bad address\"</p>\n\n<p>if instead i declare my program like this, i have no error and the programs continue</p>\n\n<p><strong>webserver.h</strong></p>\n\n<pre><code>int pipefd[2];\n</code></pre>\n\n<p><strong>webserver.c</strong></p>\n\n<pre><code>int main(int argc, char *argv[]){\n    if(pipe(pipefd) == -1){\n        perror(\"ctx pipe error\");\n        exit(EXIT_FAILURE);\n    }\n    ...\n    ...\n}\n</code></pre>\n\n<p>Any ideas why i cant open the pipe inside a struct? I still havn't made any forks in the main program. </p>\n\n<p>Thanks. </p>\n"}, {"tags": ["c", "closures", "function-pointers"], "comments": [{"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 2, "creation_date": 1567611488, "post_id": 57791597, "comment_id": 102016671, "body": "It&#39;s not possible in C because C has no way of creating new functions at run time.  It would be straightforward in C++, though (especially with Boost)."}, {"owner": {"reputation": 16851, "user_id": 5460719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0f2a855c86ad12fc2988d3948b69ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Karzes", "link": "https://stackoverflow.com/users/5460719/tom-karzes"}, "edited": false, "score": 1, "creation_date": 1567611647, "post_id": 57791597, "comment_id": 102016752, "body": "This is an example of a closure in Python.  You can do something similar in C by storing the argument(s) in a structure and then passing the structure address to a wrapper function.  That would get you down to one argument, but you can&#39;t eliminate the arguments completely.  Doing so would require dynamic function creation (or at least argument binding), which C doesn&#39;t support."}, {"owner": {"reputation": 25733, "user_id": 559737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5de249db6565b87a2699e131974268a?s=128&d=identicon&r=PG", "display_name": "Brendan", "link": "https://stackoverflow.com/users/559737/brendan"}, "edited": false, "score": 0, "creation_date": 1567611959, "post_id": 57791597, "comment_id": 102016938, "body": "<code>The argument ... will be implicitly used each time a call to the returned function is made</code>, and the returned function <code>is called without an argument</code>? How is the argument used if it&#39;s not used?"}, {"owner": {"reputation": 25733, "user_id": 559737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5de249db6565b87a2699e131974268a?s=128&d=identicon&r=PG", "display_name": "Brendan", "link": "https://stackoverflow.com/users/559737/brendan"}, "reply_to_user": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1567612249, "post_id": 57791597, "comment_id": 102017091, "body": "@SteveSummit: I&quot;m thinking the first function returns a structure containing a function pointer and the argument; so other code can call the function (via. the function pointer) and also do whatever is supposed to happen with the argument."}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "reply_to_user": {"reputation": 25733, "user_id": 559737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5de249db6565b87a2699e131974268a?s=128&d=identicon&r=PG", "display_name": "Brendan", "link": "https://stackoverflow.com/users/559737/brendan"}, "edited": false, "score": 0, "creation_date": 1567612462, "post_id": 57791597, "comment_id": 102017213, "body": "@Brendan wouldn&#39;t the function call still need 1 argument, i.e. a pointer to the struct containing the &quot;real&quot; arguments?"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 16851, "user_id": 5460719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0f2a855c86ad12fc2988d3948b69ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Karzes", "link": "https://stackoverflow.com/users/5460719/tom-karzes"}, "edited": false, "score": 0, "creation_date": 1567612787, "post_id": 57791597, "comment_id": 102017367, "body": "@TomKarzes \u2014 what about the Foreign Function Interface library <a href=\"https://github.com/libffi/libffi\" rel=\"nofollow noreferrer\"><code>libffi</code></a>? However, you still can&#39;t create functions at runtime in C. You can load shared objects (dynamic link libraries) and call functions from those \u2014 as long as you know the correct calling sequence \u2014 and you <i>could</i> also run the compiler to create a shared object that&#39;s loaded dynamically, but that&#39;s pretty contorted. But <code>libffi</code> can help. It still isn&#39;t trivial.  So, this isn&#39;t wholly disagreeing with you, Tom. If this feature is important to the OP, use a language that supports closures."}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "reply_to_user": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1567613630, "post_id": 57791597, "comment_id": 102017821, "body": "@SteveSummit C++ does not have that ability either."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "reply_to_user": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1567613932, "post_id": 57791597, "comment_id": 102017950, "body": "@Acorn Well,  <a href=\"https://stackoverflow.com/questions/356950/what-are-c-functors-and-their-uses\">functors</a> come pretty close, and I think they&#39;d let the OP do what he&#39;s trying to do."}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "reply_to_user": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1567614046, "post_id": 57791597, "comment_id": 102017996, "body": "@SteveSummit Yeah, but that is not creating functions at runtime. The answer below from Eric is the same thing as a functor, in C."}, {"owner": {"reputation": 16851, "user_id": 5460719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0f2a855c86ad12fc2988d3948b69ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Karzes", "link": "https://stackoverflow.com/users/5460719/tom-karzes"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1567614072, "post_id": 57791597, "comment_id": 102018008, "body": "@JonathanLeffler I&#39;m not familiar with libffi.  Does it support dynamic argument binding?  If so, I assume the user has to explicitly free the memory associated with the binding when done with it (or explicitly provide the memory to libffi when creating the binding)."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1567614234, "post_id": 57791597, "comment_id": 102018090, "body": "I&#39;ve not used <code>libffi</code> either, Tom, but I understand that it can be used to dynamic argument binding pretty thoroughly.  Using its interface is portable; it&#39;s implementation is potentially different on each platform."}], "answers": [{"comments": [{"owner": {"reputation": 90101, "user_id": 2509, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/79ed928ca8b1ab9a637720bf0fb20732?s=128&d=identicon&r=PG&f=1", "display_name": "dmckee --- ex-moderator kitten", "link": "https://stackoverflow.com/users/2509/dmckee-ex-moderator-kitten"}, "edited": false, "score": 0, "creation_date": 1567614451, "post_id": 57792173, "comment_id": 102018183, "body": "It is always worth noting that when you bodge up high-level language constructs in c like this you are simply exposing a possible way that the same features could be implemented &quot;under the hood&quot; of more expressive languages. They just do the bookkeeping for you."}], "tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": true, "score": 5, "last_activity_date": 1567613086, "creation_date": 1567613086, "answer_id": 57792173, "question_id": 57791597, "link": "https://stackoverflow.com/questions/57791597/how-to-create-a-function-that-returns-another-function-encompassing-a-given-arg/57792173#57792173", "title": "How to create a function that returns another function, encompassing a given argument implicitly in C?", "body": "<p>About all you can do in C is create a record (a <code>struct</code>) containing both the function pointer and the argument to pass and then use that record as the \u201cthing\u201d that is called, with the assistance of a wrapper function that does the actual calling.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n\ntypedef int SomeType;   //  Sample type for demonstration.\n\n\n//  Define a record to hold a function pointer and the argument we want to pass.\ntypedef struct\n{\n    void (*Function)(SomeType); //  Function to call.\n    SomeType Argument;  //  Argument to pass.\n} Closure;\n\n\n//  Define some sample functions.\nstatic void A(SomeType x) { printf(\"Called %s(%d).\\n\", __func__, x); }\nstatic void B(SomeType x) { printf(\"Called %s(%d).\\n\", __func__, x); }\n\n\n//  Define a function that returns a closure.\nstatic Closure foo(int Which, SomeType x)\n{\n    return (Closure) { .Function = Which &amp; 1 ? B : A, .Argument = x };\n}\n\n\n//  Define a function to call a closure.\nstatic void Call(Closure C) { C.Function(C.Argument); }\n\n\nint main(void)\n{\n    Closure a = foo(0, 34);\n    Closure b = foo(1, 79);\n    Call(a);\n    Call(b);\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre>\nCalled A(34).\nCalled B(79).\n</pre>\n"}], "owner": {"reputation": 115, "user_id": 9312824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc248b46cdf28b7ebbbc461db736df85?s=128&d=identicon&r=PG&f=1", "display_name": "Flabou", "link": "https://stackoverflow.com/users/9312824/flabou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 57792173, "answer_count": 1, "score": 2, "last_activity_date": 1567613086, "creation_date": 1567611017, "last_edit_date": 1567612098, "question_id": 57791597, "link": "https://stackoverflow.com/questions/57791597/how-to-create-a-function-that-returns-another-function-encompassing-a-given-arg", "title": "How to create a function that returns another function, encompassing a given argument implicitly in C?", "body": "<p>I want to have a function that returns a function that is called <strong>without</strong> an argument, even though the original function must be called <strong>with</strong> an argument. The argument is passed to the first function and will be implicitly used each time a call to the returned function is made.</p>\n\n<p>I am aware of function pointers in C but I don't know if they can be used in such a way. I know how to do this in python as shown in the following sample code : </p>\n\n<pre class=\"lang-py prettyprint-override\"><code>def foo(some_argument):\n    print(some_argument)\n\ndef register_callback(function, argument):\n    def new_function():\n        function(argument)\n\n    return new_function\n\nbar = register_callback(foo,\"bar\")\n\nbar()\n</code></pre>\n\n<p>From what I read, this way is not possible in C because we can't nest function definitions. Is this possible and if so what would be the proper way to do it?</p>\n"}, {"tags": ["c++", "c", "libgit2"], "comments": [{"owner": {"reputation": 23130, "user_id": 8586227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BRnwg.png?s=128&g=1", "display_name": "Davis Herring", "link": "https://stackoverflow.com/users/8586227/davis-herring"}, "edited": false, "score": 1, "creation_date": 1567611947, "post_id": 57791388, "comment_id": 102016927, "body": "What do you mean by \u201catomic\u201d (perhaps \u201clow-level\u201d)?"}, {"owner": {"reputation": 3561, "user_id": 2511795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30c869f55cbcf82a7bc4536d563daa0a?s=128&d=identicon&r=PG", "display_name": "0andriy", "link": "https://stackoverflow.com/users/2511795/0andriy"}, "edited": false, "score": 0, "creation_date": 1567628452, "post_id": 57791388, "comment_id": 102023414, "body": "You can&#39;t achieve this without strong understanding how Git database (hash tree) works under hood."}, {"owner": {"reputation": 3693, "user_id": 11455384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e87a1e837a79a0248716b61a930f67fa?s=128&d=identicon&r=PG&f=1", "display_name": "Fareanor", "link": "https://stackoverflow.com/users/11455384/fareanor"}, "reply_to_user": {"reputation": 23130, "user_id": 8586227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BRnwg.png?s=128&g=1", "display_name": "Davis Herring", "link": "https://stackoverflow.com/users/8586227/davis-herring"}, "edited": false, "score": 0, "creation_date": 1567664808, "post_id": 57791388, "comment_id": 102031460, "body": "@DavisHerring By atomic I mean that we need much more than one line to write the equivalent of a git command (I already have written a <i>&quot;git clone url</i>&quot;, <i>&quot;git add .&quot;</i>, <i>&quot;git commit -m message&quot;</i>, <i>&quot;git push&quot;</i> and <i>&quot;git fetch&quot;</i>). This being said, whether you understand or not what I mean by atomic is not the point of the question anyway ;)"}], "answers": [{"comments": [{"owner": {"reputation": 3693, "user_id": 11455384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e87a1e837a79a0248716b61a930f67fa?s=128&d=identicon&r=PG&f=1", "display_name": "Fareanor", "link": "https://stackoverflow.com/users/11455384/fareanor"}, "edited": false, "score": 0, "creation_date": 1567682109, "post_id": 57803423, "comment_id": 102040083, "body": "Thanks for your answer. Finally I found a way. I used <code>git_reference_name_to_id()</code> with <i>&quot;HEAD&quot;</i> and <i>&quot;FETCH_HEAD&quot;</i> to get the head_id and fetch_head_id and I compared them with <code>git_oid_equal()</code>. I also replaced <code>git_annotated_commit_from_fetchhead()</code> by <code>git_annotated_commit_lookup()</code> and I gave the fetch_head_id that I previously got."}, {"owner": {"reputation": 3693, "user_id": 11455384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e87a1e837a79a0248716b61a930f67fa?s=128&d=identicon&r=PG&f=1", "display_name": "Fareanor", "link": "https://stackoverflow.com/users/11455384/fareanor"}, "edited": false, "score": 0, "creation_date": 1567682615, "post_id": 57803423, "comment_id": 102040400, "body": "In fact, I cannot use <code>git_repository_fetchhead_foreach</code> because I don&#39;t know what it is supposed to do nor how to fill the required callback (without any concrete example, I&#39;m afraid I&#39;ll never understand this black magic). But as I only work on origin/master (only one remote and only one branch), my method (as I mentioned in the first comment) works well."}, {"owner": {"reputation": 63488, "user_id": 729881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fdfaf0aad74fef442e2ffc9999ef9c1?s=128&d=identicon&r=PG", "display_name": "Edward Thomson", "link": "https://stackoverflow.com/users/729881/edward-thomson"}, "reply_to_user": {"reputation": 3693, "user_id": 11455384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e87a1e837a79a0248716b61a930f67fa?s=128&d=identicon&r=PG&f=1", "display_name": "Fareanor", "link": "https://stackoverflow.com/users/11455384/fareanor"}, "edited": false, "score": 0, "creation_date": 1567694266, "post_id": 57803423, "comment_id": 102047314, "body": "Seems reasonable, regardless, I added an example."}, {"owner": {"reputation": 3693, "user_id": 11455384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e87a1e837a79a0248716b61a930f67fa?s=128&d=identicon&r=PG&f=1", "display_name": "Fareanor", "link": "https://stackoverflow.com/users/11455384/fareanor"}, "edited": false, "score": 0, "creation_date": 1567755387, "post_id": 57803423, "comment_id": 102065936, "body": "Thanks for the example. Actually I have no issue to provide a callback into a function parameter :) but I rather don&#39;t know how to fill the callback function body (<code>fetchhead_cb</code> in this case). With your example, I now know how to write it to get the IDs. I&#39;m not sure if it is sufficient for a git pull."}], "tags": [], "owner": {"reputation": 63488, "user_id": 729881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fdfaf0aad74fef442e2ffc9999ef9c1?s=128&d=identicon&r=PG", "display_name": "Edward Thomson", "link": "https://stackoverflow.com/users/729881/edward-thomson"}, "is_accepted": false, "score": 0, "last_activity_date": 1567694246, "last_edit_date": 1567694246, "creation_date": 1567679215, "answer_id": 57803423, "question_id": 57791388, "link": "https://stackoverflow.com/questions/57791388/how-to-write-a-proper-git-pull-with-libgit2/57803423#57803423", "title": "How to write a proper git pull with libgit2", "body": "<blockquote>\n  <p>How to check if the fetched HEAD is equal or different to the local HEAD ?</p>\n</blockquote>\n\n<p>You can call <a href=\"https://libgit2.org/libgit2/#HEAD/group/merge/git_merge_analysis\" rel=\"nofollow noreferrer\"><code>git_merge_analysis</code></a>, which will tell you if you would need to do a merge.  In this case, <code>GIT_MERGE_ANALYSIS_UP_TO_DATE</code> indicates that there is no need to merge (<code>git merge</code> on the command line would respond with \"Already up to date\").</p>\n\n<blockquote>\n  <p>How or where to get the git_oid * id required by git_annotated_commit_from_fetchhead()?</p>\n</blockquote>\n\n<p>You can iterate the <code>FETCH_HEAD</code> file with <a href=\"https://libgit2.org/libgit2/#HEAD/group/repository/git_repository_fetchhead_foreach\" rel=\"nofollow noreferrer\"><code>git_repository_fetchhead_foreach</code></a>.  It will provide you all the information necessary to generate an annotated commit from whichever remote branch you want to merge.</p>\n\n<p>For example:</p>\n\n<pre><code>int fetchhead_cb(const char *ref_name, const char *remote_url, const git_oid *oid, unsigned int is_merge, void *payload)\n{\n    if (is_merge)\n    {\n        printf(\"reference: '%s' is the reference we should merge\\n\");\n        git_oid_cpy((git_oid *)payload, oid);\n    }\n}\n\nvoid pull(void)\n{\n    /* here's the id we want to merge */\n    git_oid id_to_merge;\n\n    /* Do the fetch */\n\n    /* Populate id with the for_merge branch from FETCH_HEAD */\n    git_repository_fetchhead_foreach(repo, fetchhead_cb, &amp;id_to_merge);\n}\n</code></pre>\n\n<p>(Note that you'd probably want to actually capture all the details of the <code>FETCH_HEAD</code> information - not just the id - so that you could create an annotated commit from the data, but this is an example of how the <code>git_repository_fetchhead_foreach</code> function works with callbacks.)</p>\n"}], "owner": {"reputation": 3693, "user_id": 11455384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e87a1e837a79a0248716b61a930f67fa?s=128&d=identicon&r=PG&f=1", "display_name": "Fareanor", "link": "https://stackoverflow.com/users/11455384/fareanor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 236, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1567694246, "creation_date": 1567610214, "question_id": 57791388, "link": "https://stackoverflow.com/questions/57791388/how-to-write-a-proper-git-pull-with-libgit2", "title": "How to write a proper git pull with libgit2", "body": "<p>I want to write a <em>C++</em> <em>libgit2</em> wrapper to perform some basic git operations because <em>libgit2</em> is too much atomic to be used as is (in my opinion).<br/>\nAs <em>libgit2</em> is written in <em>C</em>, it does not matter if I get a <em>C</em> or <em>C++</em> oriented solution, I will adapt it by myself.</p>\n\n<p>I encounter difficulties with the <code>gitPull()</code> function that is supposed to be the <em>\"git pull\"</em> equivalent.</p>\n\n<p>I planned to implement it as follows:</p>\n\n<ul>\n<li><a href=\"https://libgit2.org/libgit2/#HEAD/group/remote/git_remote_fetch\" rel=\"nofollow noreferrer\"><code>git_remote_fetch()</code></a></li>\n<li><a href=\"https://libgit2.org/libgit2/#HEAD/group/annotated/git_annotated_commit_from_fetchhead\" rel=\"nofollow noreferrer\"><code>git_annotated_commit_from_fetchhead()</code></a></li>\n<li><a href=\"https://libgit2.org/libgit2/#HEAD/group/merge/git_merge\" rel=\"nofollow noreferrer\"><code>git_merge()</code></a> (with the previously got <code>git_annotated_commit</code>)</li>\n<li><a href=\"https://libgit2.org/libgit2/#HEAD/group/commit/git_commit_create\" rel=\"nofollow noreferrer\"><code>git_commit_create()</code></a></li>\n</ul>\n\n<p>Considering that it is the proper way to do it (tell me if it is not), I struggle with two issues:</p>\n\n<ul>\n<li><strong>How to check if the fetched HEAD is equal or different to the local HEAD ?</strong> (in order to know if the merge + commit are needed or not, in other words, if there is something to merge or if we already are up-to-date).</li>\n<li><strong>How or where to get the <code>git_oid * id</code> required by <code>git_annotated_commit_from_fetchhead()</code> ?</strong> (the last parameter).</li>\n</ul>\n\n<p>I know these questions may look quite basic but I could not find any exploitable information or example neither on the <a href=\"https://libgit2.org/libgit2/#HEAD\" rel=\"nofollow noreferrer\"><em>libgit2</em> API reference documentation</a> nor in the <a href=\"https://libgit2.org/docs/guides/101-samples/\" rel=\"nofollow noreferrer\"><em>libgit2</em> samples</a>.</p>\n\n<p>I already have checked the already existing stackoverflow threads about this topic but none of them provide any exploitable code sample.</p>\n\n<p>I will be very grateful if someone could give me some helpful information about how to achieve it or explain what I have misunderstood.</p>\n"}, {"tags": ["c", "header-files", "multiple-inclusions"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1567613950, "post_id": 57791244, "comment_id": 102017959, "body": "See also <a href=\"https://stackoverflow.com/questions/1804486/should-i-use-include-in-headers/\">Should I use <code>#include</code> in headers?</a> and (much more recent) <a href=\"https://stackoverflow.com/questions/57729743\">Understanding different styles of <code>#define</code> in C</a> and <a href=\"https://stackoverflow.com/questions/31911681\">Why doesn&#39;t the compiler automatically add or generate an include guard?</a> and <a href=\"https://stackoverflow.com/questions/25627\">What is a good reference documenting patterns of use of <code>.h</code> files in C?</a> (which now might not be an acceptable question), and a myriad other questions. Search <code>[c] include guard</code>."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1567615428, "post_id": 57791244, "comment_id": 102018575, "body": "For those curious, C++ is attempting to solve this problem (and more) with <a href=\"https://www.modernescpp.com/index.php/c-20-modules\" rel=\"nofollow noreferrer\">modules</a>. If something like that will ever come to C is an open question."}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1567610344, "post_id": 57791308, "comment_id": 102016055, "body": "I still don&#39;t see a reason why <code>#pragma once</code> would be faster."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1567610374, "post_id": 57791308, "comment_id": 102016070, "body": "@melpomene I wrote &quot;possibly&quot;"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1567610398, "post_id": 57791308, "comment_id": 102016087, "body": "Yeah, but why? Why not write &quot;possibly slower&quot;? You have no justification either way."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1567610588, "post_id": 57791308, "comment_id": 102016222, "body": "@melpomene just found <a href=\"https://stackoverflow.com/a/39583019/898348\">this interesting answer</a>"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1567613400, "post_id": 57791308, "comment_id": 102017703, "body": "One could quibble that your interesting answer is for C++, @Jabberwocky, but that&#39;s not entirely fair.  They&#39;re near enough the same in C."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1567614124, "post_id": 57791308, "comment_id": 102018038, "body": "The reason why <code>#pragma once</code> might be faster is that one encountering a second <code>#include &quot;header.h&quot;</code> (that contained <code>#pragma once</code>), the preprocessor doesn&#39;t have to reopen the file and read to the <code>#ifndef HEADER_H_INCLUDED</code> line and then skip to the matching <code>#endif</code> and check whether there&#39;s anything else in the file, etc.  However, GCC practically optimizes the classic include guards so that there&#39;s very little difference in cost between <code>#pragma once</code>."}, {"owner": {"reputation": 4313, "user_id": 2706707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoAxS.gif?s=128&g=1", "display_name": "D&#250;thomhas", "link": "https://stackoverflow.com/users/2706707/d%c3%bathomhas"}, "edited": false, "score": 0, "creation_date": 1567618132, "post_id": 57791308, "comment_id": 102019692, "body": "Pragma once may fail, and all modern compilers essentially do it anyway, without the need for the directive. Include guards cannot fail. (Though ODR violations may still exist.) Always use include guards."}, {"owner": {"reputation": 5, "user_id": 12020574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ROwH9.jpg?s=128&g=1", "display_name": "Nilesh Pal", "link": "https://stackoverflow.com/users/12020574/nilesh-pal"}, "edited": false, "score": 0, "creation_date": 1567684899, "post_id": 57791308, "comment_id": 102041757, "body": "can you tell me in which case &quot;#pragma once&quot; can fail"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "reply_to_user": {"reputation": 5, "user_id": 12020574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ROwH9.jpg?s=128&g=1", "display_name": "Nilesh Pal", "link": "https://stackoverflow.com/users/12020574/nilesh-pal"}, "edited": false, "score": 0, "creation_date": 1567685303, "post_id": 57791308, "comment_id": 102041989, "body": "@NileshPal read <a href=\"https://stackoverflow.com/a/34884735/898348\">this answer</a> (from the links at the end of my answer)"}, {"owner": {"reputation": 5, "user_id": 12020574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ROwH9.jpg?s=128&g=1", "display_name": "Nilesh Pal", "link": "https://stackoverflow.com/users/12020574/nilesh-pal"}, "edited": false, "score": 0, "creation_date": 1567686725, "post_id": 57791308, "comment_id": 102042755, "body": "can you please tell me that how name collisions can happen?"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "reply_to_user": {"reputation": 5, "user_id": 12020574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ROwH9.jpg?s=128&g=1", "display_name": "Nilesh Pal", "link": "https://stackoverflow.com/users/12020574/nilesh-pal"}, "edited": false, "score": 0, "creation_date": 1567686869, "post_id": 57791308, "comment_id": 102042850, "body": "@NileshPal they can&#39;t happen with <code>#pragma once</code>. But they can happen with header guards if you have two different header files using buth the same preprocessor symbol, for example: file1.h contains <code>#ifndef api_H_</code>, file2.h contains also <code>#ifndef api_H_</code> and you include both file1.h and file2.h into the same .c file. Then file2.h will basically be skipped."}, {"owner": {"reputation": 5, "user_id": 12020574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ROwH9.jpg?s=128&g=1", "display_name": "Nilesh Pal", "link": "https://stackoverflow.com/users/12020574/nilesh-pal"}, "edited": false, "score": 0, "creation_date": 1567695320, "post_id": 57791308, "comment_id": 102047896, "body": "But why would I check the inclusion of my header file in other header file cant i check it in file itself like cant i do like this in api.h i have first check <b><code>#ifndef api_H_</code></b>"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "reply_to_user": {"reputation": 5, "user_id": 12020574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ROwH9.jpg?s=128&g=1", "display_name": "Nilesh Pal", "link": "https://stackoverflow.com/users/12020574/nilesh-pal"}, "edited": false, "score": 0, "creation_date": 1567695985, "post_id": 57791308, "comment_id": 102048266, "body": "@NileshPal Well you <i>should</i> not, but you <i>could</i> do it my mistake, especially when using careless copy/pasting. If it&#39;s still not clear, then post another specific question."}, {"owner": {"reputation": 4313, "user_id": 2706707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoAxS.gif?s=128&g=1", "display_name": "D&#250;thomhas", "link": "https://stackoverflow.com/users/2706707/d%c3%bathomhas"}, "edited": false, "score": 0, "creation_date": 1567794548, "post_id": 57791308, "comment_id": 102084170, "body": "It is both possible for a file system to have distinct paths to the same file, as is the (more likely and sadly common in large projects) possibility that a file is exists in multiple locations in the project tree. #pragma once will fail bothering of these."}, {"owner": {"reputation": 4313, "user_id": 2706707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoAxS.gif?s=128&g=1", "display_name": "D&#250;thomhas", "link": "https://stackoverflow.com/users/2706707/d%c3%bathomhas"}, "edited": false, "score": 1, "creation_date": 1567794707, "post_id": 57791308, "comment_id": 102084232, "body": "Anyone naming include guards highly-collisionable names (like <i>api_H</i>) deserve to get chewed out in a code review, especially for completely misunderstanding the purpose of an include guard."}], "tags": [], "owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "is_accepted": false, "score": 0, "last_activity_date": 1567613519, "last_edit_date": 1567613519, "creation_date": 1567609936, "answer_id": 57791308, "question_id": 57791244, "link": "https://stackoverflow.com/questions/57791244/best-way-to-check-multiple-inclusions/57791308#57791308", "title": "Best way to check multiple inclusions", "body": "<p>With most (if not all) modern compilers you can use <code>#pragma once</code> which does the same job, but which is possibly faster.</p>\n\n<p>You also eliminate the risk of name collisions, which can happen if two different header files contain the same preprocessor symbol (<code>api_H_</code>).</p>\n\n<p>Basically instead of:</p>\n\n<pre><code>#ifndef api_H_\n#define api_H_\n\n... header content\n\n#endif\n</code></pre>\n\n<p>you write:</p>\n\n<pre><code>#pragma once\n\n... header content\n</code></pre>\n\n<p>Also read <a href=\"https://stackoverflow.com/q/1143936/898348\"><code>#pragma once</code> vs include guards?</a> and <a href=\"https://stackoverflow.com/questions/787533/is-pragma-once-a-safe-include-guard\">Is <code>#pragma once</code> a safe include guard?</a></p>\n"}], "owner": {"reputation": 5, "user_id": 12020574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ROwH9.jpg?s=128&g=1", "display_name": "Nilesh Pal", "link": "https://stackoverflow.com/users/12020574/nilesh-pal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567613519, "creation_date": 1567609706, "last_edit_date": 1567609886, "question_id": 57791244, "link": "https://stackoverflow.com/questions/57791244/best-way-to-check-multiple-inclusions", "title": "Best way to check multiple inclusions", "body": "<pre><code>#ifndef api_H_\n#define api_H_\n...\n#endif\n</code></pre>\n\n<p>In above code it's checking that if file is already included or not to avoid multiple inclusions.</p>\n\n<p><strong>Question:</strong></p>\n\n<p>I want to know that if there is any better way to do so and what are the alternatives of it and if this is the better way of doing it then why it is so?</p>\n"}, {"tags": ["c", "file", "struct"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7416606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/062b4facaabc3b341a0ee68a6871337f?s=128&d=identicon&r=PG&f=1", "display_name": "mani", "link": "https://stackoverflow.com/users/7416606/mani"}, "edited": false, "score": 0, "creation_date": 1567611027, "post_id": 57791295, "comment_id": 102016433, "body": "How can i fixed the code using char* ? i don&#39;t know the exact size of strings it could be very long o very short. This is just an example there is no problem for leak memory."}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "reply_to_user": {"reputation": 3, "user_id": 7416606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/062b4facaabc3b341a0ee68a6871337f?s=128&d=identicon&r=PG&f=1", "display_name": "mani", "link": "https://stackoverflow.com/users/7416606/mani"}, "edited": false, "score": 0, "creation_date": 1567631589, "post_id": 57791295, "comment_id": 102024542, "body": "If you want to write and read fixed-sized records, you must make the fields the longest you want to accept and truncate any longer inputs."}], "tags": [], "owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "is_accepted": false, "score": 1, "last_activity_date": 1567609907, "creation_date": 1567609907, "answer_id": 57791295, "question_id": 57791192, "link": "https://stackoverflow.com/questions/57791192/appending-struct-to-file/57791295#57791295", "title": "Appending Struct to File", "body": "<pre><code>   struct index {\n      char* conflict;\n      char* resolution;\n   };\n</code></pre>\n\n<p>These are pointers to characters. If you write them, that is fine, but if you read them, then there is no memory allocated for them, causing the segmentation fault.</p>\n\n<p>A better way is to make them fixed sized strings so they can be written and read back, for example:</p>\n\n<pre><code>   struct index {\n      char conflict[50];\n      char resolution[50];\n   };\n</code></pre>\n\n<p>(Note also that you don't write the strings, but just the pointer value. And when reading back, you allocate the object again and again without storing it somewhere, so you leak memory.)</p>\n"}, {"tags": [], "owner": {"reputation": 62, "user_id": 11957671, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZgSqbWfKr9k/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rclGdVbPIk7pw3rz9y8e1BFx82VwQ/photo.jpg?sz=128", "display_name": "biplav karna", "link": "https://stackoverflow.com/users/11957671/biplav-karna"}, "is_accepted": false, "score": 0, "last_activity_date": 1567615999, "creation_date": 1567615999, "answer_id": 57792809, "question_id": 57791192, "link": "https://stackoverflow.com/questions/57791192/appending-struct-to-file/57792809#57792809", "title": "Appending Struct to File", "body": "<p>As already mentioned by Paul the pointer has to changed to array. i.e.</p>\n\n<pre><code>   struct index {\n      char* conflict;\n      char* resolution;\n   };\n\n</code></pre>\n\n<p>To</p>\n\n<pre><code>   struct index {\n      char conflict[100];\n      char resolution[100];\n   };\n\n</code></pre>\n\n<p>The array size can be given after analysing the maximum character the array should hold.</p>\n\n<p><strong>In addition, I want to point out the code for fwrite and fread used is not correct.</strong></p>\n\n<pre><code>size_t fwrite ( const void * ptr, size_t size, size_t count, FILE * stream );\nsize_t fread ( void * ptr, size_t size, size_t count, FILE * stream );\n</code></pre>\n\n<p><strong>fwrite and fread function require pointer, but the passed argument is pointer to the pointer.</strong> In the code fwrite and fread are</p>\n\n<pre><code>fwrite(&amp;new_conflict, sizeof(struct index), 1, conflict_index);\nfread(&amp;object2, sizeof(struct index), 1, conflict_index)\n\n</code></pre>\n\n<p><strong>new_conflict and object2 is already a pointer to struct index</strong>. So the code should be like below</p>\n\n<pre><code>fwrite(new_conflict, sizeof(struct index), 1, conflict_index);\nfread(object2, sizeof(struct index), 1, conflict_index)\n\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 7416606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/062b4facaabc3b341a0ee68a6871337f?s=128&d=identicon&r=PG&f=1", "display_name": "mani", "link": "https://stackoverflow.com/users/7416606/mani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 416, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1567615999, "creation_date": 1567609467, "last_edit_date": 1567610757, "question_id": 57791192, "link": "https://stackoverflow.com/questions/57791192/appending-struct-to-file", "title": "Appending Struct to File", "body": "<p>I am working on a project where I need to save structure in binary file. I want to append the structure to the file without overwriting it. It works for one record but when I add the second record and try to read the file I get segmentation fault error.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nint main() {\n   struct index {\n      char* conflict;\n      char* resolution;\n   };\n\n   struct index *new_conflict = malloc(sizeof(struct index));\n   new_conflict-&gt;conflict = \"conflict\";\n   new_conflict-&gt;resolution = \"resolution\";\n\n   FILE *conflict_index = fopen(\"conflict_index\", \"ab+\");\n\n   if (conflict_index) {\n      fwrite(&amp;new_conflict, sizeof(struct index), 1, conflict_index);\n      fwrite(&amp;new_conflict, sizeof(struct index), 1, conflict_index);\n      fclose(conflict_index);\n   }\n\n   conflict_index = fopen(\"conflict_index\", \"rb\");\n   if (conflict_index) {\n     while(1) {\n        struct index *object2 = malloc(sizeof(struct index));\n        if (!fread(&amp;object2, sizeof(struct index), 1, conflict_index))\n            break;\n        printf(\"write_conflict_index: CONFLICT %s\", object2-&gt;conflict);\n        printf(\"write_conflict_index: RESOLUTION %s\", object2-&gt;resolution);\n     }\n     fclose(conflict_index);\n   }\n   return 0;\n}        \n</code></pre>\n\n<p>Can anybody help please.\nThanks</p>\n"}, {"tags": ["c", "environment-variables"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1567615376, "post_id": 57790909, "comment_id": 102018550, "body": "Note that having your decrypted password in your environment is a major security risk.  Avoid it!  And you should usually avoid using backticks as shown: use <code>export MY_PASSWORD=$(java -jar decryptpassword &quot;$ENCRYPTED_PASS&quot;)</code> instead."}], "answers": [{"tags": [], "owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "is_accepted": true, "score": 1, "last_activity_date": 1567610320, "creation_date": 1567610320, "answer_id": 57791419, "question_id": 57790909, "link": "https://stackoverflow.com/questions/57790909/setting-environmental-variable-in-c-via-assignment/57791419#57791419", "title": "Setting Environmental Variable in C via assignment", "body": "<p>One way to do this would be:</p>\n\n<ol>\n<li>Use <code>popen</code> to run the command and capture its output.</li>\n<li>Read a string from that output (perhaps using <code>fgets</code>).</li>\n<li>Put that new string in the environment using <code>setenv</code>.</li>\n</ol>\n\n<p>P.S. If you use <code>fgets</code> in step 2, you may have to add a step 2a to strip the trailing <code>\\n</code>.</p>\n"}], "owner": {"reputation": 839, "user_id": 7513280, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8a42e9fc20a0cf2c49751ccba922ef6a?s=128&d=identicon&r=PG&f=1", "display_name": "pOrinG", "link": "https://stackoverflow.com/users/7513280/poring"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 57791419, "answer_count": 1, "score": 0, "last_activity_date": 1567615294, "creation_date": 1567608454, "last_edit_date": 1567615294, "question_id": 57790909, "link": "https://stackoverflow.com/questions/57790909/setting-environmental-variable-in-c-via-assignment", "title": "Setting Environmental Variable in C via assignment", "body": "<p>In my C program I can set environmental variable via.. <code>setenv</code></p>\n\n<p>However setenv only allows me to setup an environmental variable via a string.</p>\n\n<p>Currently in my environment I have the below setup in my bash profile...</p>\n\n<pre><code>export MY_PASSWORD=`java -jar decrpytpassword $ENCRYPTED_PASS`\n</code></pre>\n\n<p>where decryptpassword is a Java executable jar file which accepts encrypted password and prints out decrypted password.</p>\n\n<p>I want to do something similar in my C program where I will pass the encrypted password via a string and decrypt it.</p>\n"}, {"tags": ["c", "linux", "beagleboneblack", "can-bus", "socketcan"], "comments": [{"owner": {"reputation": 48, "user_id": 11579707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/251deac0d938d0d3deb300539991a969?s=128&d=identicon&r=PG&f=1", "display_name": "ARD", "link": "https://stackoverflow.com/users/11579707/ard"}, "edited": false, "score": 0, "creation_date": 1567624609, "post_id": 57790381, "comment_id": 102022259, "body": "how about doing the following? step 1: setsockopt(s, SOL_CAN_RAW, CAN_RAW_FILTER, &amp;rfilter_1, sizeof(rfilter_1)); where rfilter_1 is any config of filters. Then let&#39;s say you want to remove some filters from this config + add new filters to it, then create a new rfilter_2 with that config, and do step 2: setsockopt(s, SOL_CAN_RAW, CAN_RAW_FILTER, NULL, 0); followed by setsockopt(s, SOL_CAN_RAW, CAN_RAW_FILTER, &amp;rfilter_2, sizeof(rfilter_2));"}, {"owner": {"reputation": 440, "user_id": 4288959, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0TCNu.png?s=128&g=1", "display_name": "Greenberet", "link": "https://stackoverflow.com/users/4288959/greenberet"}, "reply_to_user": {"reputation": 48, "user_id": 11579707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/251deac0d938d0d3deb300539991a969?s=128&d=identicon&r=PG&f=1", "display_name": "ARD", "link": "https://stackoverflow.com/users/11579707/ard"}, "edited": false, "score": 0, "creation_date": 1567626150, "post_id": 57790381, "comment_id": 102022868, "body": "@ARD That is what I&#39;m afraid will be the solution. Or something like that. If i&#39;m correct, after having a look at function <code>raw_setsockopt()</code> at ./kernel/2.6/net/can/raw.c:471 this funcion always replaces all the old filter(s) with the given new one(s) so I wouldn&#39;t even need to care about clearing the existing filters. The sad thing about this is that I will have to keep track of all the current filters myself in order to be able to recreate the new filter config <code>rfilter</code>."}], "owner": {"reputation": 440, "user_id": 4288959, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0TCNu.png?s=128&g=1", "display_name": "Greenberet", "link": "https://stackoverflow.com/users/4288959/greenberet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 340, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1573073964, "creation_date": 1567606565, "last_edit_date": 1573073964, "question_id": 57790381, "link": "https://stackoverflow.com/questions/57790381/how-to-remove-a-can-message-filter-from-a-can-raw-socket", "title": "How to remove a CAN message filter from a CAN_RAW socket?", "body": "<p>SocketCAN's <a href=\"https://www.kernel.org/doc/html/latest/networking/can.html#raw-protocol-sockets-with-can-filters-sock-raw\" rel=\"nofollow noreferrer\">description</a> says about adding some filters to a socket:</p>\n\n<pre><code>struct can_filter rfilter[2];\n\nrfilter[0].can_id   = 0x123;\nrfilter[0].can_mask = CAN_SFF_MASK;\nrfilter[1].can_id   = 0x200;\nrfilter[1].can_mask = 0x700;\n\nsetsockopt(s, SOL_CAN_RAW, CAN_RAW_FILTER, &amp;rfilter, sizeof(rfilter));\n</code></pre>\n\n<p>But it doesn't say anything abou how to <strong>remove</strong> a specific filter if I have multiple ones on the same socket. Could someone please guess/explain this for me?</p>\n\n<p>(Is this thing written down somewhere or I should gain a lot of general experience with linux sockets first before even touching SocketCAN?)</p>\n"}, {"tags": ["c", "pointers"], "comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "reply_to_user": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "edited": false, "score": 0, "creation_date": 1567605587, "post_id": 57790021, "comment_id": 102013292, "body": "@uneven_mark: In such an instance feel free to make an edit."}, {"owner": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "reply_to_user": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1567605707, "post_id": 57790021, "comment_id": 102013354, "body": "@Bathsheba ok, will do next time"}, {"owner": {"reputation": 8154, "user_id": 2470782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921783e0584f9ace7e05d303e4d48869?s=128&d=identicon&r=PG", "display_name": "Ingo Leonhardt", "link": "https://stackoverflow.com/users/2470782/ingo-leonhardt"}, "edited": false, "score": 2, "creation_date": 1567605889, "post_id": 57790021, "comment_id": 102013457, "body": "just to clearify your last sentence: while the two snippets you&#39;ve posted do exactly the same as @bathseba has posted in his answer, having <code>*p = &amp;i</code> as a seperate assignment would be something very different"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1567606736, "post_id": 57790021, "comment_id": 102013899, "body": "There&#39;s some subtle crap though, in case the variables are declared at file scope. Then they have static storage duration and the two forms are no longer equivalent."}, {"owner": {"reputation": 16851, "user_id": 5460719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0f2a855c86ad12fc2988d3948b69ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Karzes", "link": "https://stackoverflow.com/users/5460719/tom-karzes"}, "edited": false, "score": 1, "creation_date": 1567607192, "post_id": 57790021, "comment_id": 102014186, "body": "The distinction is very similar to <code>int i = 5;</code> vs. <code>int i; i = 5;</code>  Note that the first form, which uses an initializer, can be used outside of a function, while the latter cannot."}], "answers": [{"comments": [{"owner": {"reputation": 16851, "user_id": 5460719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0f2a855c86ad12fc2988d3948b69ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Karzes", "link": "https://stackoverflow.com/users/5460719/tom-karzes"}, "edited": false, "score": 1, "creation_date": 1567607054, "post_id": 57790081, "comment_id": 102014093, "body": "The first form can also be used outside of a function."}], "tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": false, "score": 2, "last_activity_date": 1567606519, "last_edit_date": 1567606519, "creation_date": 1567605563, "answer_id": 57790081, "question_id": 57790021, "link": "https://stackoverflow.com/questions/57790021/difference-between-different-ways-of-initializing-pointers-in-c/57790081#57790081", "title": "Difference between different ways of initializing pointers in c", "body": "<p>There's no difference at all, aside from the fact that in the first case, <code>p</code> is never in an uninitialised state and therefore, in my opinion at least, is a better way of writing it.</p>\n\n<p>(Uninitialised variables can be a big source of trouble in c especially with aggressively optimising compilers).</p>\n"}, {"comments": [{"owner": {"reputation": 521, "user_id": 10101235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96714df3ca1f8348c03ac3665d303d9e?s=128&d=identicon&r=PG&f=1", "display_name": "skrrrt", "link": "https://stackoverflow.com/users/10101235/skrrrt"}, "edited": false, "score": 0, "creation_date": 1567606008, "post_id": 57790197, "comment_id": 102013510, "body": "Yes I&#39;ve fixed that now"}], "tags": [], "owner": {"reputation": 27, "user_id": 9276160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88531f1fda13ce8e9eede1fa266387a3?s=128&d=identicon&r=PG&f=1", "display_name": "Padmanava", "link": "https://stackoverflow.com/users/9276160/padmanava"}, "is_accepted": false, "score": 0, "last_activity_date": 1567606149, "last_edit_date": 1567606149, "creation_date": 1567605901, "answer_id": 57790197, "question_id": 57790021, "link": "https://stackoverflow.com/questions/57790021/difference-between-different-ways-of-initializing-pointers-in-c/57790197#57790197", "title": "Difference between different ways of initializing pointers in c", "body": "<p>Yes, both do the exactly same thing</p>\n\n<pre><code>int *p = &amp;i;\n</code></pre>\n\n<p>Here the initialization and declaration is being done on the same line</p>\n\n<pre><code>int *p\np = &amp;i;\n</code></pre>\n\n<p>In this case the initialization and declaration is being done on different line.</p>\n\n<p>Both codes do the same thing and hence produce the same output.</p>\n\n<p>Happy coding :-)</p>\n"}, {"comments": [{"owner": {"reputation": 8154, "user_id": 2470782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921783e0584f9ace7e05d303e4d48869?s=128&d=identicon&r=PG", "display_name": "Ingo Leonhardt", "link": "https://stackoverflow.com/users/2470782/ingo-leonhardt"}, "edited": false, "score": 0, "creation_date": 1567606405, "post_id": 57790331, "comment_id": 102013732, "body": "make the last line <code>p = &amp;i;</code> :-)"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1567608901, "post_id": 57790331, "comment_id": 102015264, "body": "The question does not ask about an assignment <code>*p = &amp;i;</code>. (It does refer to the source text <code>*p = &amp;i</code> in the final sentence, but this is taken from the context of the declaration shown, not a separate statement.) This is not an answer to the question that was asked."}], "tags": [], "owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "is_accepted": false, "score": 2, "last_activity_date": 1567608114, "last_edit_date": 1567608114, "creation_date": 1567606357, "answer_id": 57790331, "question_id": 57790021, "link": "https://stackoverflow.com/questions/57790021/difference-between-different-ways-of-initializing-pointers-in-c/57790331#57790331", "title": "Difference between different ways of initializing pointers in c", "body": "<p>You have come across a curiosity of C's declaration syntax.</p>\n\n<p>When you write</p>\n\n<pre><code>int *p = &amp;i;\n</code></pre>\n\n<p>you are declaring a variable <code>p</code> of type <code>int *</code>, and you are initializing it to point to <code>i</code>.</p>\n\n<p>But the initialization is <em>not</em> equivalent to the standalone assignment</p>\n\n<pre><code>*p = &amp;i;    /* WRONG */\n</code></pre>\n\n<p>Rather, it is equivalent to</p>\n\n<pre><code>p = &amp;i;     /* right */\n</code></pre>\n\n<p>What's actually happening is that there are two slightly different uses of the <code>*</code> character here.  When you say</p>\n\n<pre><code>int *p = &amp;i;\n</code></pre>\n\n<p>the <code>*</code> means that <code>p</code> is being declared as a pointer.  (But since this very much determines <code>p</code>'s type, some programmers prefer to write it as <code>int* p</code> instead.)</p>\n\n<p>Later, in an actual expression statement, when you use <code>*</code> with a pointer, it means \"access the contents of that pointer\".  If we say</p>\n\n<pre><code>printf(\"%d\\n\", *p);\n</code></pre>\n\n<p>we will fetch the value that <code>p</code> points to (which will actually be <code>i</code>'s value).  If we say</p>\n\n<pre><code>*p = 5;\n</code></pre>\n\n<p>we will set the value pointed to by <code>p</code> to 5 (which will actually set <code>i</code> to 5).</p>\n\n<p>Bottom line: When you split up a pointer initialization like</p>\n\n<pre><code>int *p = &amp;i;\n</code></pre>\n\n<p>into a declaration and separate assignment</p>\n\n<pre><code>int *p;\np = &amp;i;\n</code></pre>\n\n<p>then yes, it looks like there's something fishy going on.  It looks like a <code>*</code> has gotten lost, or something, but actually, when you stop and think about it, it's perfectly correct as-is.</p>\n"}, {"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": true, "score": 4, "last_activity_date": 1567606374, "creation_date": 1567606374, "answer_id": 57790333, "question_id": 57790021, "link": "https://stackoverflow.com/questions/57790021/difference-between-different-ways-of-initializing-pointers-in-c/57790333#57790333", "title": "Difference between different ways of initializing pointers in c", "body": "<p>Formally, the former is <em>initialization</em> and the latter is <em>assignment</em>. Nothing of this is unique to pointers - all variables follow the same rules.</p>\n\n<p>In C, there isn't really much of a practical difference. Initialization is required to be carried out as per the rules of assignment. Though when initializing you have more options, like providing an initializer list for arrays or structs.</p>\n\n<p>(In C++, these two forms are very different, as the former will call the default constructor but the latter will call the (potentially overloaded) assignment operator.)</p>\n\n<p>There is one important difference though. Whenever you declare objects with <em>static storage duration</em> (globals or variables declared with <code>static</code>), the code that performs the initialization is not executed at the line where you placed it, but rather much earlier on, before main() is called.</p>\n\n<p>So if we write <code>static int x=1;</code>, that code behaves very differently compared to <code>static int x; x=1;</code></p>\n"}, {"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 0, "last_activity_date": 1567606458, "creation_date": 1567606458, "answer_id": 57790360, "question_id": 57790021, "link": "https://stackoverflow.com/questions/57790021/difference-between-different-ways-of-initializing-pointers-in-c/57790360#57790360", "title": "Difference between different ways of initializing pointers in c", "body": "<p>Some important distinctions here:</p>\n\n<p>This:</p>\n\n<pre><code>int *p = &amp;i;\n</code></pre>\n\n<p>Is an <em>initialization</em> of the pointer <code>p</code>, while this:</p>\n\n<pre><code>int *p;\np = &amp;i; \n</code></pre>\n\n<p>Is an *assignment.  These two are functionally equivalent.</p>\n\n<p>However, this is <strong>not</strong> the same:</p>\n\n<pre><code>int *p;\n*p = &amp;i; \n</code></pre>\n\n<p>This assigns the address of <code>i</code> to the location where <code>p</code> <strong>points to</strong>, performing an implementation defined pointer-to-integer conversion.  In this case since <code>p</code> was never assigned a value attempting to dereference it invokes <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behavior</a>. </p>\n"}, {"tags": [], "owner": {"reputation": 939, "user_id": 1556829, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/NKY9p.png?s=128&g=1", "display_name": "Igor S.K.", "link": "https://stackoverflow.com/users/1556829/igor-s-k"}, "is_accepted": false, "score": 0, "last_activity_date": 1567608225, "creation_date": 1567608225, "answer_id": 57790843, "question_id": 57790021, "link": "https://stackoverflow.com/questions/57790021/difference-between-different-ways-of-initializing-pointers-in-c/57790843#57790843", "title": "Difference between different ways of initializing pointers in c", "body": "<blockquote>\n  <p>Is there any difference between these two?</p>\n</blockquote>\n\n<p>Just as you put it here -- no, in practice (language lawyers might argue though) there is no difference. The end result is the same.</p>\n\n<p>You have a variable by the name of <code>p</code>.</p>\n\n<p>The type of the variable is a <code>pointer to int</code>. No matter how you write your declaration -- <code>int* p;</code>, <code>int * p;</code>, <code>int *p</code> -- it is still a pointer.\nImagine something like this <code>TYPE var;</code> In your case <code>TYPE</code> equals <code>int *</code>.</p>\n\n<p>So you can declare-and-define your pointer with</p>\n\n<pre><code>int i;\nint *p = &amp;i; /* Remember 'TYPE' is 'int *' */\n</code></pre>\n\n<p>or you declare-and-assign-later with</p>\n\n<pre><code>int i;\nint *p; /* Remember 'TYPE' is 'int *' */\np = &amp;i;\n</code></pre>\n\n<blockquote>\n  <p>If there isn't any difference then doing *p = &amp;i is equivalent to p = &amp;i ?</p>\n</blockquote>\n\n<p>Feels like a broken question to me. You see, this expression <code>*p = &amp;i</code> alone is a pointer dereference. So <code>*p = &amp;i</code> and <code>p = &amp;i</code> are not equivalent at all. I'd even expect a compiler warning at least. But <code>int *p = &amp;i</code> and <code>p = &amp;i</code> are equivalent in your code snippets.</p>\n"}, {"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 2, "last_activity_date": 1567608379, "creation_date": 1567608379, "answer_id": 57790886, "question_id": 57790021, "link": "https://stackoverflow.com/questions/57790021/difference-between-different-ways-of-initializing-pointers-in-c/57790886#57790886", "title": "Difference between different ways of initializing pointers in c", "body": "<p>This</p>\n\n<pre><code>int *p = &amp;i;\n</code></pre>\n\n<p>is a declaration.</p>\n\n<p>But this</p>\n\n<pre><code>p = &amp;i; \n</code></pre>\n\n<p>is an expression statement.</p>\n\n<p>In C declarations are not statements.</p>\n\n<p>For example you may not place a label before a declaration that is this code</p>\n\n<pre><code>L: int *p = &amp;i;\n</code></pre>\n\n<p>is invalid (though valid in C++ because in C++ declarations are statements).</p>\n\n<p>You have to write</p>\n\n<pre><code>L:; int *p = &amp;i;\n ^^^\n</code></pre>\n\n<p>However you may write</p>\n\n<pre><code>int *p;\nL: p = &amp;x;\n</code></pre>\n\n<p>One more difference that this declaration with an initializer</p>\n\n<pre><code>int *p = &amp;i;\n</code></pre>\n\n<p>you may place in the global name space (that is the variable will have the file scope). For example</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint x  = 10;\nint *p = &amp;x;\n\nint main(void) \n{\n    printf( \"%u\\n\", *p );\n\n    return 0;\n}\n</code></pre>\n\n<p>but you may not write</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint x  = 10;\nint *p;\np = &amp;x;\n\nint main(void) \n{\n    printf( \"%u\\n\", *p );\n\n    return 0;\n}\n</code></pre>\n\n<p>Also if the pointer is a constant pointer it shall be initialized when it is declared. For example</p>\n\n<pre><code>int * const p = &amp;i;\n</code></pre>\n\n<p>You may not write</p>\n\n<pre><code>int * const p;\np = &amp;i;\n</code></pre>\n"}], "owner": {"reputation": 521, "user_id": 10101235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96714df3ca1f8348c03ac3665d303d9e?s=128&d=identicon&r=PG&f=1", "display_name": "skrrrt", "link": "https://stackoverflow.com/users/10101235/skrrrt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 1, "accepted_answer_id": 57790333, "answer_count": 7, "score": 1, "last_activity_date": 1567608379, "creation_date": 1567605376, "last_edit_date": 1567605562, "question_id": 57790021, "link": "https://stackoverflow.com/questions/57790021/difference-between-different-ways-of-initializing-pointers-in-c", "title": "Difference between different ways of initializing pointers in c", "body": "<p>I'm confused with these two ways of initializing pointers</p>\n\n<pre><code>int i=5;\nint *p = &amp;i;\n</code></pre>\n\n<p>and</p>\n\n<pre><code>int i=5;\nint *p;\np = &amp;i; \n</code></pre>\n\n<p>Is there any difference between these two?\nThese different ways give exactly the same output. \nIf there isn't any difference then doing <code>*p = &amp;i</code> is equivalent to <code>p = &amp;i</code> ?</p>\n"}, {"tags": ["c", "scanf"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 4315299, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kJ3Ov.jpg?s=128&g=1", "display_name": "DudeNukem", "link": "https://stackoverflow.com/users/4315299/dudenukem"}, "edited": false, "score": 0, "creation_date": 1567607790, "post_id": 57790158, "comment_id": 102014574, "body": "Yes, that  was the obvious problem - the extra &quot;s&quot; specifier after the set expression."}], "tags": [], "owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "is_accepted": true, "score": 2, "last_activity_date": 1567605785, "creation_date": 1567605785, "answer_id": 57790158, "question_id": 57789999, "link": "https://stackoverflow.com/questions/57789999/getting-the-offset-from-sscanf-while-reading-a-string-in-a-loop-in-c/57790158#57790158", "title": "Getting the offset from sscanf while reading a string in a loop in C", "body": "<p>You have a misplaced literal <code>'s'</code> in the middle of your <code>sscanf</code> conversion specification string, which likely does not match and causes <code>sscanf</code> to fail before even reaching the <code>%n</code>. Remove it.</p>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 4315299, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kJ3Ov.jpg?s=128&g=1", "display_name": "DudeNukem", "link": "https://stackoverflow.com/users/4315299/dudenukem"}, "edited": false, "score": 0, "creation_date": 1567607972, "post_id": 57790196, "comment_id": 102014706, "body": "yes as @R.. already mentioned I was wrong in adding the s after the set specifier as I was storing the results from sscanf() into a string ... Obviously I have a bad C reference sources."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 35, "user_id": 4315299, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kJ3Ov.jpg?s=128&g=1", "display_name": "DudeNukem", "link": "https://stackoverflow.com/users/4315299/dudenukem"}, "edited": false, "score": 1, "creation_date": 1567608202, "post_id": 57790196, "comment_id": 102014857, "body": "It&#39;s a common mistake to assume that the scan set notation is a modifier for <code>%s</code>; there are numerous questions on SO where that&#39;s the problem.  I originally thought it was going to be a simple question of &quot;this is a duplicate of &#39;How to use <code>sscanf()</code> in loops&#39;&quot; but I realized the <code>s</code> was causing the trouble.  If your sources conflate <code>%[\u2026]</code> with <code>%s</code>, then you should look askance at the other information those sources provide \u2014 there are likely to be other problems."}], "tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": false, "score": 3, "last_activity_date": 1567606367, "last_edit_date": 1567606367, "creation_date": 1567605901, "answer_id": 57790196, "question_id": 57789999, "link": "https://stackoverflow.com/questions/57789999/getting-the-offset-from-sscanf-while-reading-a-string-in-a-loop-in-c/57790196#57790196", "title": "Getting the offset from sscanf while reading a string in a loop in C", "body": "<p>The problem is that a 'scan set' <code>%[\u2026]</code> in <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/sscanf.html\" rel=\"nofollow noreferrer\"><code>sscanf()</code></a> et al is a complete conversion specification, not a modifier for <code>%s</code>.  Your data has no <code>s</code> characters in it, so the <code>sscanf()</code> fails on matching the literal <code>s</code> in your format string, and hence fails to set <code>offset</code> because the matching failed.</p>\n\n<p>Use more white space and fewer <code>s</code>'s:</p>\n\n<pre><code>char line[35] = \" -123    1  -25-1245  -12\";\nchar *data = line;\nchar buf[6];\nint offset;\nint n, i;\n\nfor (i = 0; i &lt; 5; i++)\n{\n    if (sscanf(data, \"%5[^\\n\\t]%n\", buf, &amp;offset) == 1)\n    {\n        n = atoi(buf);\n        data += offset;\n        printf(\"n = %5d; offset = %d\\n\", n, offset);\n    }\n}\n</code></pre>\n\n<p>Your question already shows that you know most of what's discussed in <a href=\"https://stackoverflow.com/questions/3975236/how-to-use-sscanf-in-loops\">How to use <code>sscanf()</code> in loops?</a></p>\n"}], "owner": {"reputation": 35, "user_id": 4315299, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kJ3Ov.jpg?s=128&g=1", "display_name": "DudeNukem", "link": "https://stackoverflow.com/users/4315299/dudenukem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 57790158, "answer_count": 2, "score": 1, "last_activity_date": 1567606367, "creation_date": 1567605304, "last_edit_date": 1567606013, "question_id": 57789999, "link": "https://stackoverflow.com/questions/57789999/getting-the-offset-from-sscanf-while-reading-a-string-in-a-loop-in-c", "title": "Getting the offset from sscanf while reading a string in a loop in C", "body": "<p>I'm trying to read a string using <code>sscanf()</code> in a loop but the offset is zero. What is the correct way and is it possible at all to have track of the offset?</p>\n\n<p>In the example here the <code>offset</code> should be 5 but the actual value is 0 and I had to set it manually to 5.</p>\n\n<pre><code>char line[35]=\" -123    1  -25-1245  -12\";\nchar *data=line;\nchar buf[6];\nint offset;\nint n,i;\n\nfor(i=0;i&lt;5;i++){\n  if(sscanf(data,\"%5[^\\n\\t]s%n\",buf,&amp;offset)==1){\n    n=atoi(buf);\n    data+=5;//offset;\n  printf(\"n= %5d  offset= %d\\n\",n, offset);\n  }\n }\n</code></pre>\n\n<p>The result is:</p>\n\n<pre><code>n=  -123  offset= 0\nn=     1  offset= 0\nn=   -25  offset= 0\nn= -1245  offset= 0\nn=   -12  offset= 0\n</code></pre>\n"}, {"tags": ["c", "mariadb", "database-connection", "mysql-connector", "mariadb-connector-c"], "comments": [{"owner": {"reputation": 2510, "user_id": 6930501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5637ccd51605f78822946e32fecb50c1?s=128&d=identicon&r=PG&f=1", "display_name": "Georg Richter", "link": "https://stackoverflow.com/users/6930501/georg-richter"}, "edited": false, "score": 0, "creation_date": 1567623209, "post_id": 57789935, "comment_id": 102021713, "body": "Why don&#39;t you check the return code of mysql_ping()? If you set reconnect via mysql_options() api function, mysql_ping() will reconnect automatically."}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1567631380, "post_id": 57789935, "comment_id": 102024460, "body": "What is the value of <code>autocommit</code>?  Are there &quot;transactions&quot;?"}, {"owner": {"reputation": 11, "user_id": 3853774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/082a73eb71f9568cd7fc784f7b027f9d?s=128&d=identicon&r=PG&f=1", "display_name": "user3853774", "link": "https://stackoverflow.com/users/3853774/user3853774"}, "reply_to_user": {"reputation": 2510, "user_id": 6930501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5637ccd51605f78822946e32fecb50c1?s=128&d=identicon&r=PG&f=1", "display_name": "Georg Richter", "link": "https://stackoverflow.com/users/6930501/georg-richter"}, "edited": false, "score": 0, "creation_date": 1567770432, "post_id": 57789935, "comment_id": 102072873, "body": "@GeorgRichter my initial connection method sets up MYSQL_OPT_RECONNECT with the value of 1, so I think mysql_ping() should try to reconnect. I&#39;m logging now the return code of it."}, {"owner": {"reputation": 11, "user_id": 3853774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/082a73eb71f9568cd7fc784f7b027f9d?s=128&d=identicon&r=PG&f=1", "display_name": "user3853774", "link": "https://stackoverflow.com/users/3853774/user3853774"}, "reply_to_user": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1567771135, "post_id": 57789935, "comment_id": 102073183, "body": "@RickJames Autocommit is on. My application is uses SELECT, INSERT, UPDATE statements, nothing fancy."}, {"owner": {"reputation": 2510, "user_id": 6930501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5637ccd51605f78822946e32fecb50c1?s=128&d=identicon&r=PG&f=1", "display_name": "Georg Richter", "link": "https://stackoverflow.com/users/6930501/georg-richter"}, "edited": false, "score": 0, "creation_date": 1567842263, "post_id": 57789935, "comment_id": 102092733, "body": "Do you use MySQL or MariaDB Connector/C? There is a difference, since MySQL Connector/C only tries to reconnect if error code was CR_SERVER_LOST, while MariaDB Connector/C always tries to reconnect in case of an connection error (e.g. if error code was CR_SERVER_GONE_ERROR)."}, {"owner": {"reputation": 11, "user_id": 3853774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/082a73eb71f9568cd7fc784f7b027f9d?s=128&d=identicon&r=PG&f=1", "display_name": "user3853774", "link": "https://stackoverflow.com/users/3853774/user3853774"}, "edited": false, "score": 0, "creation_date": 1567849800, "post_id": 57789935, "comment_id": 102094193, "body": "I use MariaDB Connector/C. Now I have logs from mysql_ping: <code>msg: &#39;Commands out of sync; you can&#39;t run this command now&#39; error:(-1)</code>"}], "owner": {"reputation": 11, "user_id": 3853774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/082a73eb71f9568cd7fc784f7b027f9d?s=128&d=identicon&r=PG&f=1", "display_name": "user3853774", "link": "https://stackoverflow.com/users/3853774/user3853774"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 192, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1567606102, "creation_date": 1567605130, "last_edit_date": 1567606102, "question_id": 57789935, "link": "https://stackoverflow.com/questions/57789935/why-lost-connection-to-mysql-server-during-query-errors-occur-time-to-time-ti", "title": "Why &#39;Lost connection to MySQL server during query&#39; errors occur time-to-time (timeouts raised, pinging before query)", "body": "<p>I'm creating an experiment, in which the server side is a libuv based C/C++ application that runs queries on a mysql server (it's on localhost).</p>\n\n<p>In most cases it just works, but sometimes I get 'Lost connection to MySQL server during query' in various places in the process.</p>\n\n<p>I have tried raising all timeouts. But I think this is unrelated, if the server gets bombarded with requests (like every second) the same error gets thrown.</p>\n\n<pre><code>+-------------------------------------+----------+\n| Variable_name                       | Value    |\n+-------------------------------------+----------+\n| connect_timeout                     | 31536000 |\n| deadlock_timeout_long               | 50000000 |\n| deadlock_timeout_short              | 10000    |\n| delayed_insert_timeout              | 300      |\n| innodb_flush_log_at_timeout         | 1        |\n| innodb_lock_wait_timeout            | 50       |\n| innodb_print_lock_wait_timeout_info | OFF      |\n| innodb_rollback_on_timeout          | OFF      |\n| interactive_timeout                 | 31536000 |\n| lock_wait_timeout                   | 31536000 |\n| net_read_timeout                    | 31536000 |\n| net_write_timeout                   | 31536000 |\n| slave_net_timeout                   | 31536000 |\n| thread_pool_idle_timeout            | 60       |\n| wait_timeout                        | 31536000 |\n+-------------------------------------+----------+\n</code></pre>\n\n<p>I'm pinging the server before doing queries.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>    // this-&gt;con was set up somewhere before, just like down below in the retry section\n\n    char query[] = \"SELECT * FROM data WHERE id = 12;\";\n\n    mysql_ping(this-&gt;con);\n    if(!mysql_query(this-&gt;con, query)) {\n        // OK\n        return 0;\n    } else {\n        // reconnect usually helps\n        // here I get the error message\n        mysql_close(this-&gt;con);\n        this-&gt;con = mysql_init(NULL);\n        if(mysql_real_connect(this-&gt;con, this-&gt;host.c_str(), this-&gt;user.c_str(), this-&gt;password.c_str(), this-&gt;db.c_str(), 0, NULL, 0) == NULL) {\n            // no DB, goodbye\n            exit(6);\n        }\n        // retry\n        if(!mysql_query(this-&gt;con, query)) {\n            return 0;\n        } else {\n            // DB fail\n            return 1;\n        }\n    }\n</code></pre>\n\n<p>I have tried the reconnect option, the problem is the same.</p>\n\n<p>In my understanding this flow should be possible with single-threaded libuv and mysql:</p>\n\n<pre><code>1. set up db connection\n2. run event loop\n    -&gt; make queries based on IO events, get results\n3. event loop ends\n4. db close\n</code></pre>\n\n<p>What do I miss?</p>\n"}, {"tags": ["c", "unix", "assembly", "pdp-11"], "comments": [{"owner": {"reputation": 33092, "user_id": 5801661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D8ENZ.jpg?s=128&g=1", "display_name": "Margaret Bloom", "link": "https://stackoverflow.com/users/5801661/margaret-bloom"}, "edited": false, "score": 5, "creation_date": 1567605181, "post_id": 57789693, "comment_id": 102013029, "body": "See line 1923 of <a href=\"https://pages.lip6.fr/Pierre.Sens/srcv6/slp.c.html\" rel=\"nofollow noreferrer\">slp.c</a>"}], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 5700645, "user_type": "registered", "profile_image": "https://graph.facebook.com/1520892258208638/picture?type=large", "display_name": "Shkodzer", "link": "https://stackoverflow.com/users/5700645/shkodzer"}, "is_accepted": true, "score": 0, "last_activity_date": 1568031482, "creation_date": 1568031482, "answer_id": 57853935, "question_id": 57789693, "link": "https://stackoverflow.com/questions/57789693/unix-v6-processes-swap-time/57853935#57853935", "title": "UNIX V6 processes swap time", "body": "<p>Comment of Margaret Bloom above gave me a clue but I do not see the check mark otherwise I would accept it as an answer. (Apparently because it is just a comment)\nMore unfolded version could be the next: </p>\n\n<p>1)  line 1923 of slp.c says : <em>\"Although it is not remarkably evident, the basic synchronization here is on the runin flag, which is slept on and is set once per second by the clock routine. Core shuffling therefore takes place once per second\"</em>.  </p>\n\n<p>2) Lion's commentary in chapter 11 Clock Interrupts says: <em>\"Which ever clock is used, interrupts are generated at line frequency (i.e. with a 50 Hz power supply, every 20 milliseconds)\"</em>.  </p>\n\n<p>3) line 0147 of the source code: <em>#define HZ 60 /</em> Ticks/second of the clock <em>/</em>. </p>\n\n<p>4) Chapter 14 Program swapping (par. 14.2): <em>Process #0 executes \u201csched\u201d</em>. Etc. about <strong>runin</strong> and <strong>runout</strong>.</p>\n\n<p>So <strong>clock()</strong> is an interrupt service routine (IRS). Function <strong>sched()</strong> is the process number 0. </p>\n"}], "owner": {"reputation": 61, "user_id": 5700645, "user_type": "registered", "profile_image": "https://graph.facebook.com/1520892258208638/picture?type=large", "display_name": "Shkodzer", "link": "https://stackoverflow.com/users/5700645/shkodzer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 57853935, "answer_count": 1, "score": 4, "last_activity_date": 1568031482, "creation_date": 1567604384, "last_edit_date": 1568029502, "question_id": 57789693, "link": "https://stackoverflow.com/questions/57789693/unix-v6-processes-swap-time", "title": "UNIX V6 processes swap time", "body": "<p>Trying to get how famous UNIX level six kernel works. The question is about where in the source code <a href=\"https://pages.lip6.fr/Pierre.Sens/srcv6/\" rel=\"nofollow noreferrer\">https://pages.lip6.fr/Pierre.Sens/srcv6/</a> process switching is triggered?</p>\n\n<p>In the Lions commentary on UNIX source code I meet clock() function in the line 3725. Does it trigger processes swap or does not? </p>\n\n<p>Though enough information on this source code I am stuck due to different style of 197x and 201x programming texts and terminology.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 2, "creation_date": 1567603940, "post_id": 57789507, "comment_id": 102012267, "body": "<code>(int)(float)(char) i</code> that does nothing. <code>sizeof(double)</code> is apparently 8 on your machine, which isn&#39;t surprising."}, {"owner": {"reputation": 8374, "user_id": 3691891, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dcCUM.jpg?s=128&g=1", "display_name": "Arkadiusz Drabczyk", "link": "https://stackoverflow.com/users/3691891/arkadiusz-drabczyk"}, "edited": false, "score": 2, "creation_date": 1567603969, "post_id": 57789507, "comment_id": 102012285, "body": "You don&#39;t want to use <code>%d</code> with <code>size_t</code>."}, {"owner": {"reputation": 6004, "user_id": 6471538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "Robert Columbia", "link": "https://stackoverflow.com/users/6471538/robert-columbia"}, "edited": false, "score": 0, "creation_date": 1567603971, "post_id": 57789507, "comment_id": 102012287, "body": "Why do you think 4 could be an answer?"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1567603981, "post_id": 57789507, "comment_id": 102012294, "body": "4 bytes (32-bits) is too small for a <code>double</code> which is usually 64 bits. IIRC, needs at least 39 bits.  <a href=\"https://stackoverflow.com/q/1738568/2410359\">Any guaranteed minimum sizes for types in C?</a>"}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 0, "creation_date": 1567604464, "post_id": 57789507, "comment_id": 102012585, "body": "Where did you find this code?"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1567604534, "post_id": 57789507, "comment_id": 102012634, "body": "<a href=\"https://stackoverflow.com/questions/2524611/how-can-one-print-a-size-t-variable-portably-using-the-printf-family\">The proper format specifier for <code>size_t</code> is <code>%zu</code></a>.  <code>z</code> is the length modifier for <code>size_t</code>, and <code>u</code> as <code>size_t</code> is an unsigned value.  You could also use <code>%zx</code> for hex output or <code>%zo</code> for octal output."}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 0, "creation_date": 1567604667, "post_id": 57789507, "comment_id": 102012718, "body": "Please link the question"}, {"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1567604940, "post_id": 57789507, "comment_id": 102012883, "body": "You made a change. The answer specifically says that the size of <i>a double cast to an int</i> is 4 in that environment. You didn&#39;t get the size of a double cast to an int (and you may not be using the same environment)"}, {"owner": {"reputation": 19, "user_id": 8763383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d15cbcc8ce54df6bbbd636f6e59a17?s=128&d=identicon&r=PG", "display_name": "Kannan Mrithunjai", "link": "https://stackoverflow.com/users/8763383/kannan-mrithunjai"}, "edited": false, "score": 0, "creation_date": 1567605141, "post_id": 57789507, "comment_id": 102013006, "body": "Got that...thank you for your response.."}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 8763383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d15cbcc8ce54df6bbbd636f6e59a17?s=128&d=identicon&r=PG", "display_name": "Kannan Mrithunjai", "link": "https://stackoverflow.com/users/8763383/kannan-mrithunjai"}, "edited": false, "score": 0, "creation_date": 1567609537, "post_id": 57790742, "comment_id": 102015624, "body": "printf(&quot;sizeof i is %d\\n&quot;, (int)sizeof i);                                                                 Can you explain what does    (int)sizeof i   does in this statement.                    It is showing the Output value as  8                                                                And what is the difference between    (int)sizeof i   and  sizeof((int) i)"}, {"owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "reply_to_user": {"reputation": 19, "user_id": 8763383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d15cbcc8ce54df6bbbd636f6e59a17?s=128&d=identicon&r=PG", "display_name": "Kannan Mrithunjai", "link": "https://stackoverflow.com/users/8763383/kannan-mrithunjai"}, "edited": false, "score": 0, "creation_date": 1567615025, "post_id": 57790742, "comment_id": 102018418, "body": "<code>sizeof i</code> yelds the size of the type of <code>i</code>; <code>(int)sizeof i</code> converts the size of type of <code>i</code> (type <code>size_t</code>) to integer so that it can be printed safely with <code>&quot;%d&quot;</code> in <code>printf()</code>. <code>sizeof(int)</code> (or <code>sizeof((int)i)</code>) yields the size of int."}, {"owner": {"reputation": 19, "user_id": 8763383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d15cbcc8ce54df6bbbd636f6e59a17?s=128&d=identicon&r=PG", "display_name": "Kannan Mrithunjai", "link": "https://stackoverflow.com/users/8763383/kannan-mrithunjai"}, "edited": false, "score": 0, "creation_date": 1567618686, "post_id": 57790742, "comment_id": 102019901, "body": "Got that thanks for your response.."}], "tags": [], "owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "is_accepted": true, "score": 1, "last_activity_date": 1567607839, "creation_date": 1567607839, "answer_id": 57790742, "question_id": 57789507, "link": "https://stackoverflow.com/questions/57789507/what-will-be-output-of-the-below-c-code-in-32-bit-machine/57790742#57790742", "title": "What will be output of the below C code in 32-bit machine..?", "body": "<p><code>(int)(float)(char) i;</code> is <strong>not</strong> a definition of <code>i</code>. It merely is using the value for nothing.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\ndouble i;\nint main(void) {\n    i; // use i for nothing\n    (int)i; // convert the value of i to integer, than use that value for nothing\n    (int)(float)i; // convert to float, then to int, then use for nothing\n    (int)(float)(char)i; // convert char, then to float, then to int, then use for nothing\n    printf(\"sizeof i is %d\\n\", (int)sizeof i);\n    char i; // define a new i (and hide the previous one) of type char\n    printf(\"sizeof i is %d\\n\", (int)sizeof i);\n}\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 8763383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d15cbcc8ce54df6bbbd636f6e59a17?s=128&d=identicon&r=PG", "display_name": "Kannan Mrithunjai", "link": "https://stackoverflow.com/users/8763383/kannan-mrithunjai"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 482, "favorite_count": 0, "closed_date": 1567637460, "accepted_answer_id": 57790742, "answer_count": 1, "score": -8, "last_activity_date": 1567607839, "creation_date": 1567603843, "last_edit_date": 1567606092, "question_id": 57789507, "link": "https://stackoverflow.com/questions/57789507/what-will-be-output-of-the-below-c-code-in-32-bit-machine", "closed_reason": "Needs more focus", "title": "What will be output of the below C code in 32-bit machine..?", "body": "<pre><code> #include&lt;stdio.h&gt;\n    double i;\n    int main()\n    {\n    (int)(float)(char) i;\n    printf(\"%d\",sizeof(i));\n    return 0;\n    }\n</code></pre>\n\n<p>Its showing output as 8.  Can anyone please explain me why it is showing as 8.? \nDoes the Typecasting have any effect on the Variable i..so that the output can possibly be 4??</p>\n"}, {"tags": ["c"], "answers": [{"tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": true, "score": 4, "last_activity_date": 1567602253, "last_edit_date": 1567602253, "creation_date": 1567601762, "answer_id": 57788893, "question_id": 57788856, "link": "https://stackoverflow.com/questions/57788856/conflicting-types-with-a-declared-int-func/57788893#57788893", "title": "Conflicting types with a declared int func", "body": "<p><code>getline</code> is already declared (in error actually) in <code>&lt;stdio.h&gt;</code> and its signature differs from yours.</p>\n\n<p>The simplest thing to do is to rename your version to something different.</p>\n"}, {"comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1567602303, "post_id": 57789028, "comment_id": 102011264, "body": "I always love reading your answers - they are enough to make compiler vendors tremble. +1, of course"}, {"owner": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "edited": false, "score": 0, "creation_date": 1567602305, "post_id": 57789028, "comment_id": 102011266, "body": "This is going to give OP an error on <code>main()</code>. He is not using the most up-to-date ressource to learn. (Maybe mention that in your answer?)"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "edited": false, "score": 0, "creation_date": 1567602425, "post_id": 57789028, "comment_id": 102011336, "body": "@uneven_mark Which is a good thing... the problem is that K&amp;R is outdated and not a good source for learning modern C."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1567602444, "post_id": 57789028, "comment_id": 102011351, "body": "@Lundin: Shall we do this again?"}, {"owner": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "edited": false, "score": 0, "creation_date": 1567602545, "post_id": 57789028, "comment_id": 102011419, "body": "@Lundin Sure, but OP doesn&#39;t seem to know that and will not understand the new error message. GCC is not very helpful in indicating what needs to be fixed."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 1, "creation_date": 1567602668, "post_id": 57789028, "comment_id": 102011488, "body": "@Bathsheba Regarding compiler vendors, they are stuck between a rock and a hard place... namely the C standard and the POSIX standard. Which aren&#39;t compatible and POSIX is to blame, not the compilers."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "edited": false, "score": 1, "creation_date": 1567602967, "post_id": 57789028, "comment_id": 102011708, "body": "@uneven_mark Be that as it may, the best advice I would give to beginners (and veterans all alike) is to compile with strict settings and all warnings enabled. If they don&#39;t understand a compiler message, just ask Google or SO."}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 2, "last_activity_date": 1567602190, "creation_date": 1567602190, "answer_id": 57789028, "question_id": 57788856, "link": "https://stackoverflow.com/questions/57788856/conflicting-types-with-a-declared-int-func/57789028#57789028", "title": "Conflicting types with a declared int func", "body": "<p>You need to block the compiler from spewing non-standard crap into standard headers. You are using some compiler which has defined a non-standard <code>getline</code> function inside the standard library header <code>stdio.h</code>, which is non-conforming.</p>\n\n<p>With gcc you should compile as for example <code>gcc -std=c17 -pedantic-errors</code> to prevent this from happening.</p>\n"}], "owner": {"reputation": 3, "user_id": 12019792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38b9727119806bcd1aedf1b9c44d01fd?s=128&d=identicon&r=PG&f=1", "display_name": "elandr", "link": "https://stackoverflow.com/users/12019792/elandr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 1, "accepted_answer_id": 57788893, "answer_count": 2, "score": 0, "last_activity_date": 1567602253, "creation_date": 1567601646, "last_edit_date": 1567601865, "question_id": 57788856, "link": "https://stackoverflow.com/questions/57788856/conflicting-types-with-a-declared-int-func", "title": "Conflicting types with a declared int func", "body": "<p>Reading Kernigan, and the given code doesn't seem to work because of 'conflicting types' error for the user function.</p>\n\n<p>The compiler I'm using is cc 7.4.0. I've declared the function in the beginning and have been checking and re-checking the types seemingly forever. Guess I'm missing something.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#define MAXLINE 1000\n\nint getline(char line[], int maxline);\n\nmain()\n{\n    int len;\n    char line[MAXLINE];\n\n    while((len = getline(line, MAXLINE)) &gt; 0)\n        ;\n    return 0;\n}\n\nint getline(char s[], int lim)\n{\n    int i, c;\n\n    for (i = 0; i &lt; (lim-1) &amp;&amp; (c = getchar())!=EOF &amp;&amp; c != '\\n'; ++i)\n        s[i] = c;\n    if (c == '\\n') {\n        s[i] = c;\n        ++i;\n    }\n    s[i] = '\\0';\n    return i;\n}\n</code></pre>\n\n<p>The error I'm getting is</p>\n\n<pre><code>func.c:4:5: error: conflicting types for \u2018getline\u2019\n int getline(char line[], int maxline);\n     ^~~~~~~\nIn file included from func.c:1:0:\n/usr/include/stdio.h:616:20: note: previous declaration of \u2018getline\u2019 was here\n extern _IO_ssize_t getline (char **__restrict __lineptr,\n                    ^~~~~~~\n ^~~~\nfunc.c:25:5: error: conflicting types for \u2018getline\u2019\n int getline(char s[], int lim)\n     ^~~~~~~\nIn file included from func.c:1:0:\n/usr/include/stdio.h:616:20: note: previous declaration of \u2018getline\u2019 was here\n extern _IO_ssize_t getline (char **__restrict __lineptr,\n</code></pre>\n"}, {"tags": ["c", "thread-safety", "mutex"], "comments": [{"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 1, "creation_date": 1567601973, "post_id": 57788746, "comment_id": 102011104, "body": "It&#39;s common practice to store mutexes in the objects they protect.  (In your code, I&#39;d worry more about Object* createObject();, which should be Object *createObject(void); and the lack of (any indications that you at least intend to do) any error checking.)"}, {"owner": {"reputation": 1894, "user_id": 8473031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4878bfc9d6a80397a8446111fffa4dd?s=128&d=identicon&r=PG&f=1", "display_name": "RoQuOTriX", "link": "https://stackoverflow.com/users/8473031/roquotrix"}, "reply_to_user": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 0, "creation_date": 1567602010, "post_id": 57788746, "comment_id": 102011119, "body": "@PSkocik why should it matter if you define void or not, it is redundant?"}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 2, "creation_date": 1567602266, "post_id": 57788746, "comment_id": 102011245, "body": "It&#39;s not redundant in C (only in C++). <code>int foo();</code> means <code>foo</code> takes an unspecified number of promoted args. It&#39;s a prototypeless, deprecated function declaration style. <code>int foo(void);</code> means foo takes no args. The two are differently typechecked (the first very weakly, which is why it&#39;s dangerous) and a call to the first (unrecommended) <code>foo();</code> might (will on x86_64 SysV ABI, by 1 extra instruction) generate bloatier calls in assembly."}, {"owner": {"reputation": 1300, "user_id": 5696269, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-fM9nY4BDuE8/AAAAAAAAAAI/AAAAAAAAAAA/ykOQFUkc6Zg/photo.jpg?sz=128", "display_name": "KaiJ", "link": "https://stackoverflow.com/users/5696269/kaij"}, "reply_to_user": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 1, "creation_date": 1567602324, "post_id": 57788746, "comment_id": 102011278, "body": "@PSkocik Thanks, I didn&#39;t know that, I&#39;ll use void in my empty function calls from now on. This is not real code, its just a demonstration, and that&#39;s why there isn&#39;t any error checking."}], "answers": [{"comments": [{"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 0, "creation_date": 1567603093, "post_id": 57788926, "comment_id": 102011782, "body": "Yeah...the way round that is to provide lock() and unlock() functions that can be used to extend the lock span, if required.  It helps if you have a reentrant mutex with a lock count:)"}], "tags": [], "owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "is_accepted": true, "score": 4, "last_activity_date": 1567601880, "creation_date": 1567601880, "answer_id": 57788926, "question_id": 57788746, "link": "https://stackoverflow.com/questions/57788746/should-mutexes-be-stored-in-main-or-in-the-object/57788926#57788926", "title": "Should mutexes be stored in main or in the object?", "body": "<p>It depends on what you want to achieve. Sometimes you want interior thread safety, sometimes exterior.</p>\n\n<p>Typically, the decision will depend on whether an external user needs to compose operations or not. Say, they want both <code>f()</code> and <code>g()</code> to happen atomically. If you hide the mutex inside <code>Object</code>, there is no way they can achieve that without managing another mutex themselves (and then you have to deal with several locks being used, which can lead to deadlocks, etc.).</p>\n"}, {"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 5, "last_activity_date": 1567601899, "creation_date": 1567601899, "answer_id": 57788933, "question_id": 57788746, "link": "https://stackoverflow.com/questions/57788746/should-mutexes-be-stored-in-main-or-in-the-object/57788933#57788933", "title": "Should mutexes be stored in main or in the object?", "body": "<p>No matter if there is one object or several, it is a good idea to store the mutex together with the opaque object. First of all, the mutex and the data it protects belong together. But also, thread-safety needs to be dealt with by your \"ADT\" and not by the caller. Access to objects should only occur through setters/getters, which will handle thread-safety internally. In this case <code>incrementObject</code>.</p>\n\n<p>That way you may declare that your whole library is thread-safe, it takes care of itself rather than dumping the responsibility on someone else. Your 1st example has a much cleaner API, while the 2nd one requires the caller to drag around a mutex into their user-defined callback, which isn't a clean solution.</p>\n"}], "owner": {"reputation": 1300, "user_id": 5696269, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-fM9nY4BDuE8/AAAAAAAAAAI/AAAAAAAAAAA/ykOQFUkc6Zg/photo.jpg?sz=128", "display_name": "KaiJ", "link": "https://stackoverflow.com/users/5696269/kaij"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 57788926, "answer_count": 2, "score": 2, "last_activity_date": 1567601900, "creation_date": 1567601272, "question_id": 57788746, "link": "https://stackoverflow.com/questions/57788746/should-mutexes-be-stored-in-main-or-in-the-object", "title": "Should mutexes be stored in main or in the object?", "body": "<p>Take this example of an object in C:</p>\n\n<pre><code>/* object.h */\n\ntypedef struct Object Object;\n\nObject* createObject();\nvoid freeObject(Object* object);\n\nint getObjectNumber(Object* object);\nvoid incrementObjectNumber(Object* object);\n</code></pre>\n\n<p>It is a very simple opaque type that stores a number and can increment it.</p>\n\n<p>In order to make my code thread safe, I have two options. The first is to store a mutex within Object:</p>\n\n<pre><code>void\nfunc(Object* object)\n{\n    incrementObject(object);\n}\n\nint\nmain()\n{\n    Object* object = createObject();\n\n    Thread thread1 = startThread(func, object);\n    Thread thread2 = startThread(func, object);\n\n    waitThread(thread1);\n    waitThread(thread2);\n\n    freeObject(object);\n}\n</code></pre>\n\n<p>The second is to store a mutex in main:</p>\n\n<pre><code>void\nfunc(Object* object, Mutex mutex)\n{\n    lockMutex(mutex);\n    incrementObject(object);\n    unlockMutex(mutex);\n}\n\nint\nmain()\n{\n    Object* object = createObject();\n\n    Mutex mutex;\n\n    Thread thread1 = startThread(func, object, mutex);\n    Thread thread2 = startThread(func, object, mutex);\n\n    waitThread(thread1);\n    waitThread(thread2);\n\n    freeObject(object);\n}\n</code></pre>\n\n<p>Which one is better practice, if there will only ever be one Object?</p>\n"}, {"tags": ["c", "curl", "libcurl"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9636837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50af432cc8ec194952efc0ee21a6667?s=128&d=identicon&r=PG&f=1", "display_name": "Preenu P", "link": "https://stackoverflow.com/users/9636837/preenu-p"}, "edited": false, "score": 0, "creation_date": 1567602768, "post_id": 57788774, "comment_id": 102011561, "body": "can i access file &quot;stream.txt&quot; while data is being written to it? I am not able to do that. The file itself is not getting created. Does the file &quot;stream.txt&quot; get created only after data is fully copied into it ?"}, {"owner": {"reputation": 43751, "user_id": 93747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbf187b5b45c400649ed7f946e8f00d6?s=128&d=identicon&r=PG", "display_name": "Daniel Stenberg", "link": "https://stackoverflow.com/users/93747/daniel-stenberg"}, "reply_to_user": {"reputation": 21, "user_id": 9636837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50af432cc8ec194952efc0ee21a6667?s=128&d=identicon&r=PG&f=1", "display_name": "Preenu P", "link": "https://stackoverflow.com/users/9636837/preenu-p"}, "edited": false, "score": 1, "creation_date": 1567603670, "post_id": 57788774, "comment_id": 102012109, "body": "Your code does the fopen() call so the file should be created there, yes. But note that you do that <i>after</i> curl is done with its first transfer."}, {"owner": {"reputation": 21, "user_id": 9636837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50af432cc8ec194952efc0ee21a6667?s=128&d=identicon&r=PG&f=1", "display_name": "Preenu P", "link": "https://stackoverflow.com/users/9636837/preenu-p"}, "edited": false, "score": 0, "creation_date": 1567742948, "post_id": 57788774, "comment_id": 102062125, "body": "File is getting created but data is not getting transferred to it."}], "tags": [], "owner": {"reputation": 43751, "user_id": 93747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbf187b5b45c400649ed7f946e8f00d6?s=128&d=identicon&r=PG", "display_name": "Daniel Stenberg", "link": "https://stackoverflow.com/users/93747/daniel-stenberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1567603650, "last_edit_date": 1567603650, "creation_date": 1567601366, "answer_id": 57788774, "question_id": 57788635, "link": "https://stackoverflow.com/questions/57788635/copy-data-from-url-into-a-file-using-curl-and-access-the-file-at-the-same-time/57788774#57788774", "title": "Copy data from URL into a file using curl and access the file at the same time", "body": "<p>When you set <code>CURLOPT_WRITEFUNCTION</code>, you will make libcurl deliver all received data to that given callback <em>instead</em> of the default function (which is <code>fwrite()</code>).</p>\n\n<p>So in order to both \"use\" the data and store it in a file, just make your callback function do that!</p>\n\n<p>Alternatively, you don't set <code>CURLOPT_WRITEFUNCTION</code> and just set a <code>FILE *</code> with <code>CURLOPT_WRITEDATA</code> (however, this method does not work if you're on Windows and use libcurl as a DLL).</p>\n"}], "owner": {"reputation": 21, "user_id": 9636837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50af432cc8ec194952efc0ee21a6667?s=128&d=identicon&r=PG&f=1", "display_name": "Preenu P", "link": "https://stackoverflow.com/users/9636837/preenu-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567603650, "creation_date": 1567600908, "question_id": 57788635, "link": "https://stackoverflow.com/questions/57788635/copy-data-from-url-into-a-file-using-curl-and-access-the-file-at-the-same-time", "title": "Copy data from URL into a file using curl and access the file at the same time", "body": "<p>I am copying data from URL into a file using curl library. I want to access the file at the same time as it is being written. But the file is not getting created.</p>\n\n<pre><code>    CURL *curl;\nCURLcode res;\nstatic const char *filename = \"stream.txt\";\nFILE *fileptr;\n\n/* URL of the radio-station  */\nchar * webaddr =  \"http://mp3channels.webradio.antenne.de:80/rockantenne-deutschland.aac\";\ncurl = curl_easy_init();\n\nif (curl)\n{\n\n    curl_easy_setopt(curl, CURLOPT_URL, webaddr);\n            curl_easy_setopt(curl, CURLOPT_HTTPHEADER, headers);\n    curl_easy_setopt(curl, CURLOPT_VERBOSE, 1L);\n    curl_easy_setopt(curl, CURLOPT_NOPROGRESS, 1L);\n    curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_data);\n    res = curl_easy_perform(curl);\n    fileptr  = fopen(filename, \"wb\");\n    if (fileptr)\n    {\n        curl_easy_setopt(curl, CURLOPT_WRITEDATA, fileptr);\n        curl_easy_perform(curl);\n        fclose(fileptr);\n    }\n    if (res != CURLE_OK)\n        fprintf(stderr,\n                \"curl_easy_perform() failed: %s\\n\",\n                curl_easy_strerror(res));\n    curl_slist_free_all(headers);\n    curl_easy_cleanup(curl);\n}\n</code></pre>\n"}, {"tags": ["c", "linux-kernel", "embedded-linux", "beagleboneblack"], "comments": [{"owner": {"reputation": 1145, "user_id": 11783812, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LFwV3.jpg?s=128&g=1", "display_name": "cocool97", "link": "https://stackoverflow.com/users/11783812/cocool97"}, "edited": false, "score": 0, "creation_date": 1567600810, "post_id": 57788547, "comment_id": 102010473, "body": "Can you show us your makefile ?"}, {"owner": {"reputation": 27, "user_id": 12014094, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-EevLkVFnd-Y/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcTxLQT0vfuMG-sEG59bqo_anu3Bw/photo.jpg?sz=128", "display_name": "Mahima Gupta", "link": "https://stackoverflow.com/users/12014094/mahima-gupta"}, "reply_to_user": {"reputation": 1145, "user_id": 11783812, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LFwV3.jpg?s=128&g=1", "display_name": "cocool97", "link": "https://stackoverflow.com/users/11783812/cocool97"}, "edited": false, "score": 0, "creation_date": 1567601342, "post_id": 57788547, "comment_id": 102010749, "body": "@cocool97, I have added a makefile that is generated when I compiled my code. How can I make changes to this makefile?"}], "answers": [{"comments": [{"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1567602801, "post_id": 57788981, "comment_id": 102011582, "body": "The default target for <code>make</code> is not <code>all</code>, it is the first regular target (that does not start with <code>.</code>) in the Makefile, which happens to be <code>all</code> in this case (and in many other Makefiles). Maybe Eclipse uses a different convention, adding to potential confusion."}, {"owner": {"reputation": 1651, "user_id": 635822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fd51a3c79639c315af5864adc731298?s=128&d=identicon&r=PG", "display_name": "Jason", "link": "https://stackoverflow.com/users/635822/jason"}, "reply_to_user": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 1, "creation_date": 1567605458, "post_id": 57788981, "comment_id": 102013196, "body": "@chqrlie TIL.  I&#39;ve been using Makefiles for years and didn&#39;t know that.  Then, I suppose the root of the issue may actually be the Makefile generation.  Either way, my answer should work."}], "tags": [], "owner": {"reputation": 1651, "user_id": 635822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fd51a3c79639c315af5864adc731298?s=128&d=identicon&r=PG", "display_name": "Jason", "link": "https://stackoverflow.com/users/635822/jason"}, "is_accepted": false, "score": 1, "last_activity_date": 1567605574, "last_edit_date": 1567605574, "creation_date": 1567602025, "answer_id": 57788981, "question_id": 57788547, "link": "https://stackoverflow.com/questions/57788547/make-no-rule-to-make-target-all-stop-c-c-problem/57788981#57788981", "title": "make: *** No rule to make target &#39;all&#39;. Stop. C/C++ Problem", "body": "<p>In your Makefile, where you see labels like this:</p>\n\n<pre><code>VLC_Driver: $(OBJS) $(USER_OBJS)\n</code></pre>\n\n<p>VLC_Driver here is a target.  The default target in <s>a standard make command</s> this make command is <code>all</code>.  For whatever reason, Eclipse is targeting <code>x86_64all</code> which you do not have.  To edit the build target in eclipse go to the Make Target view:</p>\n\n<p>Window > Show View > Make Target</p>\n\n<p>You are going to want to set it to <code>all</code>.</p>\n\n<p>More information <a href=\"https://brlcad.org/wiki/Compiling/Eclipse/Manually\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 27, "user_id": 12014094, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-EevLkVFnd-Y/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcTxLQT0vfuMG-sEG59bqo_anu3Bw/photo.jpg?sz=128", "display_name": "Mahima Gupta", "link": "https://stackoverflow.com/users/12014094/mahima-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2117, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567607033, "creation_date": 1567600606, "last_edit_date": 1567601162, "question_id": 57788547, "link": "https://stackoverflow.com/questions/57788547/make-no-rule-to-make-target-all-stop-c-c-problem", "title": "make: *** No rule to make target &#39;all&#39;. Stop. C/C++ Problem", "body": "<p>I am trying to compile a code that I downloaded from GitHub <a href=\"https://github.com/severinson/VLC-driver\" rel=\"nofollow noreferrer\">https://github.com/severinson/VLC-driver</a> on Eclipse CDT 3.8.1  and getting this error:<br>\n<code>\"make: *** No rule to make target 'x86_64all'\"</code>.<br>\nI have included all linux-headers (linux-headers 4.15.0-58 generic) and I have searched a lot for this error and everyone is saying to make changes to the makefile. I am unable to find the makefile and how can I make changes to a makefile?</p>\n\n<pre><code>    ################################################################################\n# Automatically-generated file. Do not edit!\n################################################################################\n\n-include ../makefile.init\n\nRM := rm -rf\n\n# All of the sources participating in the build are defined here\n-include sources.mk\n-include src/subdir.mk\n-include subdir.mk\n-include objects.mk\n\nifneq ($(MAKECMDGOALS),clean)\nifneq ($(strip $(C_DEPS)),)\n-include $(C_DEPS)\nendif\nendif\n\n-include ../makefile.defs\n\n# Add inputs and outputs from these tool invocations to the build variables \n\n# All Target\nall: VLC_Driver\n\n# Tool invocations\nVLC_Driver: $(OBJS) $(USER_OBJS)\n    @echo 'Building target: $@'\n    @echo 'Invoking: GCC C Linker'\n    gcc  -o \"VLC_Driver\" $(OBJS) $(USER_OBJS) $(LIBS)\n    @echo 'Finished building target: $@'\n    @echo ' '\n\n# Other Targets\nclean:\n    -$(RM) $(EXECUTABLES)$(OBJS)$(C_DEPS) VLC_Driver\n    -@echo ' '\n\n.PHONY: all clean dependents\n.SECONDARY:\n\n-include ../makefile.targets\n</code></pre>\n"}, {"tags": ["c", "linux"], "comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567598837, "post_id": 57788012, "comment_id": 102009406, "body": "Use a pointer? Try writing and reading from it and see if the contents of the stack change."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1567598922, "post_id": 57788012, "comment_id": 102009458, "body": "When you say &quot;hobby operating system&quot;, do you mean an operating system built on top of the Linux kernel? Or do you make your own kernel? If you want a reference implementation to read and understand you really should go back to the <i>very</i> early Linux kernels (from the first couple of years) as the modern are <i>very</i> advanced. Or better yet get a couple of good books and some kernels <i>designed</i> to be used for tutoring. I also recommend <a href=\"http://wiki.osdev.org/Main_Page\" rel=\"nofollow noreferrer\">the OSDev wiki</a> as a resource to find information."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567598934, "post_id": 57788012, "comment_id": 102009463, "body": "Did you ensure that there is some useful information on the stack? If you only define a variable and don&#39;t do anything with it, the compiler might remove it from the program. You will never find that value on your stack then. Even if you print the variable the compiler might optiimize and keep in a register"}, {"owner": {"reputation": 586, "user_id": 9710307, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UrjLyigrrMc/AAAAAAAAAAI/AAAAAAAAAyY/0vOE9abFfrg/photo.jpg?sz=128", "display_name": "Narasimha Prasanna HN", "link": "https://stackoverflow.com/users/9710307/narasimha-prasanna-hn"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1567599123, "post_id": 57788012, "comment_id": 102009571, "body": "@Someprogrammerdude, The OS is being built from scratch, till now I have built basic I/O , heap and a display driver. I am now starting with user-space , so wanted to dig in some practices used by Linux."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 1, "creation_date": 1567599149, "post_id": 57788012, "comment_id": 102009588, "body": "@Gerhardh A way to force it into the stack is to take its address."}, {"owner": {"reputation": 586, "user_id": 9710307, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UrjLyigrrMc/AAAAAAAAAAI/AAAAAAAAAyY/0vOE9abFfrg/photo.jpg?sz=128", "display_name": "Narasimha Prasanna HN", "link": "https://stackoverflow.com/users/9710307/narasimha-prasanna-hn"}, "reply_to_user": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567599250, "post_id": 57788012, "comment_id": 102009662, "body": "@Gerhardh , Yes, now I displayed the base address of the array, and compared it with what <code>pmap</code> showed, from that I am sure that the array is in stack segment as its base address is in the range of stack segment starting address."}, {"owner": {"reputation": 455, "user_id": 4899025, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGgvb.jpg?s=128&g=1", "display_name": "Ajith C Narayanan", "link": "https://stackoverflow.com/users/4899025/ajith-c-narayanan"}, "edited": false, "score": 1, "creation_date": 1567599253, "post_id": 57788012, "comment_id": 102009667, "body": "I am assuming you have stack segment starting address. You should also need to know the stack frame structure in-order to read the auto variable (unsigned char) content."}, {"owner": {"reputation": 586, "user_id": 9710307, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UrjLyigrrMc/AAAAAAAAAAI/AAAAAAAAAyY/0vOE9abFfrg/photo.jpg?sz=128", "display_name": "Narasimha Prasanna HN", "link": "https://stackoverflow.com/users/9710307/narasimha-prasanna-hn"}, "reply_to_user": {"reputation": 455, "user_id": 4899025, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGgvb.jpg?s=128&g=1", "display_name": "Ajith C Narayanan", "link": "https://stackoverflow.com/users/4899025/ajith-c-narayanan"}, "edited": false, "score": 0, "creation_date": 1567599363, "post_id": 57788012, "comment_id": 102009729, "body": "@AjithCNarayanan , Yes, I do have starting address"}, {"owner": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "edited": false, "score": 3, "creation_date": 1567599611, "post_id": 57788012, "comment_id": 102009847, "body": "@NarasimhaPrasannaHN You might want to declare your char array as volatile. If not, it may get optimized out because the compiler detects that you don&#39;t do anything with the data inside your array."}, {"owner": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "edited": false, "score": 1, "creation_date": 1567600344, "post_id": 57788012, "comment_id": 102010259, "body": "@NarasimhaPrasannaHN It is unclear what you are trying to achieve. The OS only &#39;allocates&#39; the stack for your program. Decisions like where in the stack the individual variables are placed or how the stack itself is organized is upto the program itself. These decisions are made, in your case, by your compiler. The OS just allocates a chunk of memory for you and lets your program run."}], "answers": [{"comments": [{"owner": {"reputation": 100407, "user_id": 16406, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/fadf252892475e9b177d5cd5e8b24145?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Dodd", "link": "https://stackoverflow.com/users/16406/chris-dodd"}, "edited": false, "score": 1, "creation_date": 1567607480, "post_id": 57790192, "comment_id": 102014369, "body": "why use syscall instead of calling <code>process_vm_readv</code> directly?"}, {"owner": {"reputation": 455, "user_id": 4899025, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGgvb.jpg?s=128&g=1", "display_name": "Ajith C Narayanan", "link": "https://stackoverflow.com/users/4899025/ajith-c-narayanan"}, "reply_to_user": {"reputation": 100407, "user_id": 16406, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/fadf252892475e9b177d5cd5e8b24145?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Dodd", "link": "https://stackoverflow.com/users/16406/chris-dodd"}, "edited": false, "score": 0, "creation_date": 1567661552, "post_id": 57790192, "comment_id": 102030417, "body": "some Linux distributions doesn&#39;t expose <code>process_vm_readv()</code> system call @ChrisDodd"}], "tags": [], "owner": {"reputation": 455, "user_id": 4899025, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGgvb.jpg?s=128&g=1", "display_name": "Ajith C Narayanan", "link": "https://stackoverflow.com/users/4899025/ajith-c-narayanan"}, "is_accepted": true, "score": 2, "last_activity_date": 1567606219, "last_edit_date": 1567606219, "creation_date": 1567605894, "answer_id": 57790192, "question_id": 57788012, "link": "https://stackoverflow.com/questions/57788012/how-to-read-the-stack-segment-of-a-c-program/57790192#57790192", "title": "How to read the stack segment of a C program?", "body": "<p>Here I am adding a demonstration for accessing address space of a remote process, There are two programs local.c which will read and write a variable in another program named remote.c (These program assumes <code>sizeof(int)==4</code> )</p>\n\n<p>local.c</p>\n\n<pre><code>#define _GNU_SOURCE\n#include &lt;sys/uio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;sys/syscall.h&gt;\n\nint main()\n{\n    char buf[4];\n    struct iovec local[1];\n    struct iovec remote[1];\n    int pid;\n    void *addr;\n\n    printf(\"Enter remote pid\\n\");\n    scanf(\"%d\",&amp;pid);\n\n    printf(\"Enter remote address\\n\");\n    scanf(\"%p\", &amp;addr);\n\n    local[0].iov_base = buf;\n    local[0].iov_len = 4;\n\n    remote[0].iov_base = addr;\n    remote[0].iov_len = 4;\n\n\n\n    if(syscall(SYS_process_vm_readv,pid,local,1,remote,1,0) == -1) {\n    perror(\"\");\n        return -1;\n    }\n    printf(\"read : %d\\n\",*(int*)buf);\n\n    *(int*)buf = 4321;\n\n    if(syscall(SYS_process_vm_writev,pid,local,1,remote,1,0) == -1) {\n    perror(\"\");\n        return -1;\n    }\n    return 0;\n}\n</code></pre>\n\n<p>remote.c</p>\n\n<pre><code>#define _GNU_SOURCE\n#include &lt;sys/uio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;sys/syscall.h&gt;\n\nint main()\n{\n\n    int a = 1234;\n\n    printf(\"%d  %p\\n\",getpid(),&amp;a);\n    while(a == 1234);\n\n    printf (\"'a' changed to %d\\n\",a);\n    return 0;\n}\n</code></pre>\n\n<p>And if you run this on a Linux machine,</p>\n\n<pre><code>[ajith@localhost Desktop]$ gcc remote.c -o remote -Wall\n[ajith@localhost Desktop]$ ./remote\n4574  0x7fffc4f4eb6c\n'a' changed to 4321\n[ajith@localhost Desktop]$\n\n\n[ajith@localhost Desktop]$ gcc local.c -o local -Wall\n[ajith@localhost Desktop]$ ./local\nEnter remote pid\n4574\nEnter remote address\n0x7fffc4f4eb6c\nread : 1234\n[ajith@localhost Desktop]$\n</code></pre>\n\n<p>Using the similar way you can read stack frame to the io-vectors, But you need to know the stack frame structure format to parse the values of local variables from stack frame. stack frame contains function parameters, return address, local variables, etc</p>\n"}], "owner": {"reputation": 586, "user_id": 9710307, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UrjLyigrrMc/AAAAAAAAAAI/AAAAAAAAAyY/0vOE9abFfrg/photo.jpg?sz=128", "display_name": "Narasimha Prasanna HN", "link": "https://stackoverflow.com/users/9710307/narasimha-prasanna-hn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 525, "favorite_count": 0, "accepted_answer_id": 57790192, "answer_count": 1, "score": 2, "last_activity_date": 1567606219, "creation_date": 1567598610, "last_edit_date": 1567598659, "question_id": 57788012, "link": "https://stackoverflow.com/questions/57788012/how-to-read-the-stack-segment-of-a-c-program", "title": "How to read the stack segment of a C program?", "body": "<p>I am developing a Hobby operating system, for that I want to know the mechanism of memory allocation in Linux, to understand that, I created a simple C program that defines a <code>unsigned char</code> of some hex numbers and then runs in a empty infinite loop, I did this to keep the process alive. Then I used <code>pmap</code> to get page-mapping information. Now I know the location of stack segment, also I have created a program that uses  <code>process_vm_readv</code> syscall to read the contents of that address, all I see a stream of <code>00</code> when I read the contents of stack segment and some random numbers at last, How can I be able to figure out how the array is stored in the stack segment? </p>\n\n<p>If that is possible, how can I analyze the hex stream to extract meaningful information ?</p>\n"}, {"tags": ["c", "arrays", "struct", "memcpy"], "comments": [{"owner": {"reputation": 22777, "user_id": 133203, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/Fp3hB.jpg?s=128&g=1", "display_name": "Federico klez Culloca", "link": "https://stackoverflow.com/users/133203/federico-klez-culloca"}, "edited": false, "score": 0, "creation_date": 1567598332, "post_id": 57787885, "comment_id": 102009126, "body": "Doesn&#39;t answer your question, but see the suggestion <a href=\"https://stackoverflow.com/a/2963928/133203\">here</a>."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1567598399, "post_id": 57787885, "comment_id": 102009171, "body": "While it&#39;s highly unlikely that there&#39;s padding in the structure, it&#39;s not guaranteed. That means you really shouldn&#39;t use <code>memcpy</code> to copy between the two arrays. But in the (likely) event that <code>sizeof(ComplexStruct) == sizeof(ComplexArr)</code> then it will work with <code>memcpy</code>."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1567598634, "post_id": 57787885, "comment_id": 102009296, "body": "And if you want to still be safe, and use an explicit loop, then consider <i>loop unrolling</i> as one way to quicken it up. Or way to do the copying in parallel. But whatever optimization you do, first make sure that it&#39;s truly a major bottle-neck in your program (measured with a compiler optimized build) and that you document your own optimizations thoroughly."}], "answers": [{"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1567600838, "post_id": 57788145, "comment_id": 102010489, "body": "Pedantically, you should <code>restrict</code> qualify both pointers. Probably won&#39;t matter in this specific case."}, {"owner": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1567651363, "post_id": 57788145, "comment_id": 102028249, "body": "@Lundin: You can <code>restrict</code> both pointers if you want but it doesn&#39;t change anything vs using it on one as I did.  Here are some details on that: <a href=\"https://stackoverflow.com/a/43671121/4323\">stackoverflow.com/a/43671121/4323</a> .  A layman&#39;s explanation (not directed at you): If there are two people in a room and one of them has a name which is unique, is there anyone in the room whose name is not unique?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1567666271, "post_id": 57788145, "comment_id": 102032051, "body": "But in case there are other pointers present in the function, doing global variable access, things turn intricate. Because then the compiler cannot assume that the parameter you left without <code>restrict</code> doesn&#39;t alias with the globals."}], "tags": [], "owner": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "is_accepted": true, "score": 3, "last_activity_date": 1567599093, "creation_date": 1567599093, "answer_id": 57788145, "question_id": 57787885, "link": "https://stackoverflow.com/questions/57787885/using-memcpy-for-copying-array-to-struct-and-vice-versa-in-c/57788145#57788145", "title": "Using memcpy for copying array to struct and vice versa in C", "body": "<p>The optimizer in your compiler should do a great job with that code, you don't need to change much to make it optimal.  However, if you are passing ComplexStructVec and ComplexArrVec into a function, you should mark them as <code>restrict</code> so the compiler knows there is no aliasing going on.  Like this:</p>\n\n<pre><code>void copy(ComplexStruct* restrict ComplexStructVec, const ComplexArr* ComplexArrVec)\n{\n    unsigned NumEl = 1000;\n    for (unsigned i = 0 ; i &lt; NumEl; i++)\n    {\n        ComplexStructVec[i].re = ComplexArrVec[i][0];\n        ComplexStructVec[i].im = ComplexArrVec[i][1];\n    }\n}\n</code></pre>\n\n<p>By doing that you eliminate a whole bunch of generated code because it doesn't need to handle the possibility that the two arguments overlap.</p>\n\n<p>Demo: <a href=\"https://godbolt.org/z/F3DUaq\" rel=\"nofollow noreferrer\">https://godbolt.org/z/F3DUaq</a> (just delete \"restrict\" there to see the difference).  If NumEl is less than 18 it will unroll the whole thing into one load and one store per iteration.</p>\n"}, {"comments": [{"owner": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "edited": false, "score": 0, "creation_date": 1567651613, "post_id": 57788821, "comment_id": 102028297, "body": "OP&#39;s loop with <code>restrict</code> added as in my answer results in the same generated code as <code>memcpy</code> in many cases.  There&#39;s no speedup from using <code>memcpy</code> if you compile with optimization enabled."}, {"owner": {"reputation": 150, "user_id": 6724071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e153cb6ddbc1f7142eea547d6ae2dff?s=128&d=identicon&r=PG&f=1", "display_name": "JonBelanger", "link": "https://stackoverflow.com/users/6724071/jonbelanger"}, "reply_to_user": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "edited": false, "score": 1, "creation_date": 1568456087, "post_id": 57788821, "comment_id": 102285321, "body": "Not entirely true.  In this particular case, I&#39;d agree.  But, if you have an irregular structure, where there is embedded padding, then the optimizer needs to honor these things.  That is why I believe it is important to organize your structures to minimize this padding."}], "tags": [], "owner": {"reputation": 150, "user_id": 6724071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e153cb6ddbc1f7142eea547d6ae2dff?s=128&d=identicon&r=PG&f=1", "display_name": "JonBelanger", "link": "https://stackoverflow.com/users/6724071/jonbelanger"}, "is_accepted": false, "score": 2, "last_activity_date": 1567612548, "last_edit_date": 1567612548, "creation_date": 1567601546, "answer_id": 57788821, "question_id": 57787885, "link": "https://stackoverflow.com/questions/57787885/using-memcpy-for-copying-array-to-struct-and-vice-versa-in-c/57788821#57788821", "title": "Using memcpy for copying array to struct and vice versa in C", "body": "<p>Yes, you can use memcpy, with a few caveats:</p>\n\n<ol>\n<li>The layout of the array and structure are identical, meaning that the compiler does not align either the items in the array or entries in the structure.</li>\n<li>The memory associated with the struct and array are identical in size.</li>\n<li>You are not concerned with portability to other architectures (which may change the answers to #1 and/or #2).</li>\n<li>This is not an ideal programming technique as it has some potential pitfalls, as noted above).</li>\n</ol>\n\n<p>If after the above you still want to do this, the following code should do the trick:</p>\n\n<pre><code>/* NOTE: sizeof(ComplexStructVec) === sizeof(ComplexArrVec) */\nmemcpy((void *) ComplexStructVec,\n       (void *) ComplexArrVec,\n       sizeof(ComplexStructVec)*NumEl);\n</code></pre>\n\n<p>What this does is, since you are using vectors (arrays) in both cases, you have the address of them by using just their names.  <code>memcpy</code> defines the destination and source addresses as <code>void *</code>, so I cast the arguments.  The number of bytes to copy is the size, in bytes, of the structure or array (see NOTE) times the number of entries in the vector.  The <code>(void *)</code> cast may not be required.  It depends upon the compiler, the language standard level, and other compile time qualifiers.</p>\n\n<p>Also note, I intentionally did not have a place for the return value, which is a pointer to the destination.  If you want this information, be careful, as saving it to <code>ComplexStructVec</code> may cause either compiler (or worse case run-time) issues, depending on how it was allocated (by the compiler or during run-time).</p>\n\n<p>A more complete example:</p>\n\n<pre><code>void copy(ComplexStruct* ComplexStructVec, ComplexArr* ComplexArrVec)\n{\n    unsigned NumEl = 1000;\n    memcpy(ComplexStructVec, ComplexArrVec, sizeof(ComplexStruct)*NumEl);\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 1, "last_activity_date": 1567607954, "creation_date": 1567607954, "answer_id": 57790779, "question_id": 57787885, "link": "https://stackoverflow.com/questions/57787885/using-memcpy-for-copying-array-to-struct-and-vice-versa-in-c/57790779#57790779", "title": "Using memcpy for copying array to struct and vice versa in C", "body": "<p>The most portable way is the loops as in your example. This is sometimes referred to as serializing/de-serializing of the struct.</p>\n\n<p>The problem with structs is that they aren't guaranteed to have a consistent memory layout, like arrays are. To dodge alignment problems, the compiler is free to add padding bytes anywhere. In case of a struct consisting of nothing but 8 byte <code>double</code>, padding is highly unlikely. But still, formally it isn't portable.</p>\n\n<p>You can however fairly safely do the following:</p>\n\n<pre><code>_Static_assert(sizeof(ComplexStruct) == sizeof(double[2]), \n                 \"Weird systems not supported\");\n\nComplexStruct cs;\ndouble arr[2];\nmemcpy(&amp;cs, arr, sizeof arr);\nmemcpy(arr, &amp;cs, sizeof arr);\n</code></pre>\n\n<p>This is \"reasonably portable\" to all real-world systems.</p>\n\n<p>Another option is to give the struct two different variable representations by adding a <code>union</code>, like this:</p>\n\n<pre><code>typedef union {\n  struct // C11 anonymous struct\n  {\n    double re;\n    double im;\n  };\n  double arr[2];\n}ComplexStruct;\n</code></pre>\n\n<p>The inner struct may still have padding, so you should add a formal static assert still. But this allows you the flexibility to use the data contents either as individual members or as an array.</p>\n\n<p>And finally, C actually has language support for complex numbers. <code>double _Complex</code> is standard C, and <code>complex.h</code> is a standardized complex library. See <a href=\"https://stackoverflow.com/questions/6418807/how-to-work-with-complex-numbers-in-c\">How to work with complex numbers in C?</a></p>\n"}], "owner": {"reputation": 1661, "user_id": 1877002, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8a1c3de36e3fb239c77f4439d1866894?s=128&d=identicon&r=PG", "display_name": "Benny K", "link": "https://stackoverflow.com/users/1877002/benny-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1483, "favorite_count": 1, "accepted_answer_id": 57788145, "answer_count": 3, "score": 4, "last_activity_date": 1567612548, "creation_date": 1567598115, "last_edit_date": 1567599852, "question_id": 57787885, "link": "https://stackoverflow.com/questions/57787885/using-memcpy-for-copying-array-to-struct-and-vice-versa-in-c", "title": "Using memcpy for copying array to struct and vice versa in C", "body": "<p>Suppose I have structure:</p>\n\n<pre><code>typedef struct {\ndouble re;\ndouble im;\n}ComplexStruct;\n</code></pre>\n\n<p>and array:</p>\n\n<p><code>typedef double ComplexArr[2];// [0] -&gt; real, [1] -&gt; imag</code></p>\n\n<p>today I am copying from  <code>ComplexStruct</code> to <code>ComplexArr</code> and vice versa using simple <code>for</code> loop:</p>\n\n<pre><code>//ComplexArr to  ComplexStruct\nfor (i = 0 ; i &lt; NumEl; i++)\n{\n     ComplexStructVec[i].re = ComplexArrVec[i][0];\n     ComplexStructVec[i].im = ComplexArrVec[i][1];\n}\n\n//ComplexStruct to ComplexArr\nfor (i = 0 ; i &lt; NumEl; i++)\n{\n     ComplexArrVec[i][0] = ComplexStructVec[i].re;\n     ComplexArrVec[i][1] = ComplexStructVec[i].im;\n}\n</code></pre>\n\n<p>Is there a way to this safely using <code>memcpy</code> for at least one of the directions? Is there another way which will by faster than <code>for</code> loop?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1567597949, "post_id": 57787785, "comment_id": 102008901, "body": "Welcome to Stack Overflow. Please read <a href=\"http://stackoverflow.com/help\">the help pages</a>, take <a href=\"http://stackoverflow.com/tour\">the SO tour</a>, read about <a href=\"http://stackoverflow.com/help/how-to-ask\">how to ask good questions</a>, as well as <a href=\"https://codeblog.jonskeet.uk/2012/11/24/stack-overflow-question-checklist/\" rel=\"nofollow noreferrer\">this question checklist</a>."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 5, "creation_date": 1567597976, "post_id": 57787785, "comment_id": 102008918, "body": "And please tell us what&#39;s wrong with the program. Do you get build errors? Crashes when running? Wrong results? If you get build errors, please copy-paste them into the question. For wrong results, please tell us the input you give, together with the actual and expected output."}], "answers": [{"comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1567601813, "post_id": 57788060, "comment_id": 102011011, "body": "@Dovnvoter, if I&#39;ve slipped something then do please let me know."}, {"owner": {"reputation": 23, "user_id": 12019536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bed5bba00009fc975db60a373f94e2e?s=128&d=identicon&r=PG&f=1", "display_name": "\uac15\ubbfc\uaddc", "link": "https://stackoverflow.com/users/12019536/%ea%b0%95%eb%af%bc%ea%b7%9c"}, "edited": false, "score": 0, "creation_date": 1567654894, "post_id": 57788060, "comment_id": 102028878, "body": "I don&#39;t understand yet, but I appreciate your advice."}], "tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": true, "score": 1, "last_activity_date": 1567599573, "last_edit_date": 1567599573, "creation_date": 1567598806, "answer_id": 57788060, "question_id": 57787785, "link": "https://stackoverflow.com/questions/57787785/how-do-i-make-my-code-sort-input-in-ascending-order/57788060#57788060", "title": "How do I make my code sort input in ascending order?", "body": "<p>The code is illogical and tangled up. The simplest way of sorting 3 numbers is to use <code>swap</code> three times:</p>\n\n<pre><code>if (a &gt; c) swap(&amp;a, &amp;c);\nif (a &gt; b) swap(&amp;a, &amp;b);\nif (b &gt; c) swap(&amp;b, &amp;c);\n</code></pre>\n\n<p>Introducing new variables is not necessary, and I'm not convinced they are all set on every control path so that could produce undefined results. To build <code>swap</code>, see <a href=\"https://stackoverflow.com/questions/2637856/is-there-a-built-in-way-to-swap-two-variables-in-c\">Is there a built-in way to swap two variables in C</a>, or use this one:</p>\n\n<pre><code>void swap(int* a, int* b)\n{\n   int t = *b;\n   *b = *a;\n   *a = t;\n}\n</code></pre>\n\n<p>Finally, don't forget to check the return value of <code>scanf</code>; it should be 3 in your case.</p>\n"}], "owner": {"reputation": 23, "user_id": 12019536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bed5bba00009fc975db60a373f94e2e?s=128&d=identicon&r=PG&f=1", "display_name": "\uac15\ubbfc\uaddc", "link": "https://stackoverflow.com/users/12019536/%ea%b0%95%eb%af%bc%ea%b7%9c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "closed_date": 1567599246, "accepted_answer_id": 57788060, "answer_count": 1, "score": 0, "last_activity_date": 1567599573, "creation_date": 1567597792, "last_edit_date": 1567598917, "question_id": 57787785, "link": "https://stackoverflow.com/questions/57787785/how-do-i-make-my-code-sort-input-in-ascending-order", "closed_reason": "Needs details or clarity", "title": "How do I make my code sort input in ascending order?", "body": "<p>i want input randomly 3 number and then Ascending order output.<br>\nbig one->small one<br>\nyou know what i mean?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint main(void) {\n\n    int a, b, c;\n    int min, mid, max;\n\n\n    scanf(\"%d %d %d\", &amp;a, &amp;b, &amp;c);\n\n    if (a &gt; b) {\n        max = a;\n        min = b;\n    }\n\n    else {\n        max = b;\n        min = a;\n    }\n\n    mid = c;\n\n    if (c &gt; max) {\n        max = c;\n        mid = a &gt; b ? a : b;\n        min = a &lt; b ? a : b;\n    }\n\n    else if (c &lt; min) {\n\n        min = c;\n        mid = a &lt; b ? : a : b;\n            max = a &gt; b ? : a : b;\n\n    }\n\n    printf(\"1:%d 2:%d 3:%d\", max, mid, min);\n\n\n\n    return 0;\n\n}\n</code></pre>\n"}, {"tags": ["c", "static-libraries", "unix-ar"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1567597291, "post_id": 57787586, "comment_id": 102008529, "body": "<a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/utilities/strip.html\" rel=\"nofollow noreferrer\">Strip</a> all debugging information from the library? Note that then it will be very hard to debug the library."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1567618213, "post_id": 57787586, "comment_id": 102019721, "body": "The archive itself normally only stores the plain object file names, without a path prefix, even if you provide one as you add the object file to the library.  The information comes from the compilation of the object files.  Why do you want to remove the debug information?"}, {"owner": {"reputation": 583, "user_id": 4912037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc8ad5a96e60d4a5086e0c5b3cfb19ce?s=128&d=identicon&r=PG&f=1", "display_name": "yashC", "link": "https://stackoverflow.com/users/4912037/yashc"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1567619481, "post_id": 57787586, "comment_id": 102020193, "body": "@JonathanLeffler yes that is what I want to achieve. ."}], "answers": [{"tags": [], "owner": {"reputation": 1780, "user_id": 10988580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9885afb3fe782ac4c8e89a3b5904b8f6?s=128&d=identicon&r=PG&f=1", "display_name": "virolino", "link": "https://stackoverflow.com/users/10988580/virolino"}, "is_accepted": false, "score": 1, "last_activity_date": 1567598127, "creation_date": 1567598127, "answer_id": 57787892, "question_id": 57787586, "link": "https://stackoverflow.com/questions/57787586/how-to-remove-path-to-c-files-and-other-meta-data-from-static-library/57787892#57787892", "title": "How to remove path to C files and other meta data from static library", "body": "<p>You need to do it in 2 steps.</p>\n\n<ol>\n<li><p>Create a <strong>debug</strong> version of the library. Always compile this version with debug information available.</p></li>\n<li><p>Create a <strong>release</strong> version of the library. Always compile this version stripping away <strong>all</strong> debug information.</p></li>\n</ol>\n\n<p>The debug information is, obviously, what helps you debug your software (library). Some of this information is the paths of all relevant files - exactly as you noticed.</p>\n\n<p>When you implemented / fixed everything, you can build the release version, which will not contain any sensitive information.</p>\n\n<hr>\n\n<p>For the specifics of how to include / exclude the debug information, you need to study the documentation of your compiler. If it has a graphical interface, it might help you in your endeavor.</p>\n"}, {"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 1, "last_activity_date": 1567599118, "creation_date": 1567599118, "answer_id": 57788154, "question_id": 57787586, "link": "https://stackoverflow.com/questions/57787586/how-to-remove-path-to-c-files-and-other-meta-data-from-static-library/57788154#57788154", "title": "How to remove path to C files and other meta data from static library", "body": "<blockquote>\n  <p>When I run strings on the finally created static library I find that the names of the C files used to create the objects and their relative path also present in the output.</p>\n</blockquote>\n\n<p>There are at least two sources for such information:</p>\n\n<ol>\n<li><p>The primary one is <strong>debug information</strong> embedded in your object files by the compiler.  That does include file names and paths to each original source file, among other things.  Avoid this by compiling without debug information and / or by <code>strip</code>ping the debug information from the objects.  Note that stripping debug information will make debugging more difficult, as various debugging tools will have less information to work with.</p></li>\n<li><p>But you also mention that you are using <strong>thin archives</strong>.  A thin archive absolutely will contain names and paths to object files, for this is what allows it to be thin. \"The paths to the elements of the archive are stored relative to the archive itself\" (<a href=\"https://linux.die.net/man/1/ar\" rel=\"nofollow noreferrer\">GNU <code>ar</code> man page</a>).  Note that the whole idea of thin archives really isn't suitable for any scenario where you would care about the presence of the paths.  They provide a minor build-time convenience, but are not very suitable for distribution or system-wide installation.</p></li>\n</ol>\n"}], "owner": {"reputation": 583, "user_id": 4912037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc8ad5a96e60d4a5086e0c5b3cfb19ce?s=128&d=identicon&r=PG&f=1", "display_name": "yashC", "link": "https://stackoverflow.com/users/4912037/yashc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1567599118, "creation_date": 1567597092, "question_id": 57787586, "link": "https://stackoverflow.com/questions/57787586/how-to-remove-path-to-c-files-and-other-meta-data-from-static-library", "title": "How to remove path to C files and other meta data from static library", "body": "<p>I am making a static library from bunch multiple objects placed across directories.\nWhen I run strings on the finally created static library I find that the names of the C files used to create the objects and their relative path also present in the output.</p>\n\n<p>I don't want to expose such information.\nWhat am I missing here ?\nThe command I am using is :</p>\n\n<p><code>ar rcs myLib.a myobj1.o myobj2.o etc</code></p>\n\n<p>I find it worth mentioning that I combine this library with other prebuilt library I have using thin archive method adding below</p>\n\n<p><code>$(AR) cqT final_thin.a lib1.a lib2.a</code></p>\n\n<p><code>echo -e 'create final.a\\n addlib final_thin.a \\nsave\\nend' | $(AR) -M</code></p>\n\n<p>Help would be appreciate </p>\n"}, {"tags": ["c", "stm32", "stm32f7"], "comments": [{"owner": {"reputation": 6873, "user_id": 5131711, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z5oP7.png?s=128&g=1", "display_name": "followed Monica to Codidact", "link": "https://stackoverflow.com/users/5131711/followed-monica-to-codidact"}, "edited": false, "score": 0, "creation_date": 1567596336, "post_id": 57786560, "comment_id": 102008036, "body": "<b>Examine each flash register before and after each flash operation, check their values using the reference manual.</b> If you can find any bits that are different from what the reference manual says, you can expand your question with their full values, noting what is different from the expected, and at which point in the program or the library has it occured. Then reveal the source of the <code>ensure()</code> and <code>flash_unlock_write()</code> functions. If you do both, that would make an answerable question."}, {"owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 0, "creation_date": 1567616009, "post_id": 57786560, "comment_id": 102018828, "body": "This is the same question as <a href=\"https://electronics.stackexchange.com/questions/456100/write-protection-error-on-stm32f779ii-earsing-flash\">on Electrical Engineering</a>."}], "owner": {"reputation": 1932, "user_id": 375666, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d33159b0c328adefa8e7cd2d6d814337?s=128&d=identicon&r=PG&f=1", "display_name": "Ahmed Saleh", "link": "https://stackoverflow.com/users/375666/ahmed-saleh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567593090, "creation_date": 1567593090, "question_id": 57786560, "link": "https://stackoverflow.com/questions/57786560/write-protection-on-stm32f779ii", "title": "Write protection on STM32F779ii", "body": "<p>I'm trying to erase flash for STM32F779II.</p>\n\n<p>The start up file starts with that section:</p>\n\n<pre><code>{\n  FLASH (rx)      : ORIGIN = 0x08000000, LENGTH = 1664K\n  DTCMRAM (xrw)   : ORIGIN = 0x20000000, LENGTH = 128K\n  SRAM1 (xrw)     : ORIGIN = 0x20020000, LENGTH = 368K\n  SRAM2 (xrw)     : ORIGIN = 0x2007C000, LENGTH = 16K\n  MEMORY_B1 (rx)  : ORIGIN = 0x60000000, LENGTH = 0K\n}\n</code></pre>\n\n<p>So I'm leaving that three sections. </p>\n\n<p>I'm trying to clear sector number 22. but I get Write Protection Error.</p>\n\n<p>Here is how I'm earsing it.</p>\n\n<p>Sectors is an array with one element, which is <code>22</code> sector number which has address\n<strong>0x081C0000</strong> </p>\n\n<pre><code>secbool flash_erase_sectors(const uint8_t *sectors, int len,\n                            void (*progress)(int pos, int len)) {\n  ensure(flash_unlock_write(), NULL);\n  HAL_FLASH_OB_Unlock();\n\n\n  FLASH_EraseInitTypeDef EraseInitStruct;\n  EraseInitStruct.TypeErase = FLASH_TYPEERASE_SECTORS;\n  EraseInitStruct.VoltageRange = FLASH_VOLTAGE_RANGE_3;\n  EraseInitStruct.NbSectors = 1;\n  if (progress) {\n    progress(0, len);\n  }\n  for (int i = 0; i &lt; len; i++) {\n    EraseInitStruct.Sector = sectors[i];\n    uint32_t SectorError;\n    if (HAL_FLASHEx_Erase(&amp;EraseInitStruct, &amp;SectorError) != HAL_OK) {\n      ensure(flash_lock_write(), NULL);\n      return secfalse;\n    }\n    // check whether the sector was really deleted (contains only 0xFF)\n    const uint32_t addr_start = FLASH_SECTOR_TABLE[sectors[i]],\n                   addr_end = FLASH_SECTOR_TABLE[sectors[i] + 1];\n    for (uint32_t addr = addr_start; addr &lt; addr_end; addr += 4) {\n      if (*((const uint32_t *)addr) != 0xFFFFFFFF) {\n        ensure(flash_lock_write(), NULL);\n        return secfalse;\n      }\n    }\n    if (progress) {\n      progress(i + 1, len);\n    }\n  }\n  ensure(flash_lock_write(), NULL);\n  return sectrue;\n}\n</code></pre>\n"}, {"tags": ["android", "c", "unix", "android-source"], "comments": [{"owner": {"reputation": 8154, "user_id": 2470782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921783e0584f9ace7e05d303e4d48869?s=128&d=identicon&r=PG", "display_name": "Ingo Leonhardt", "link": "https://stackoverflow.com/users/2470782/ingo-leonhardt"}, "edited": false, "score": 0, "creation_date": 1567595390, "post_id": 57786335, "comment_id": 102007602, "body": "Is <code>sprintf(script_command, ....);</code> vs. <code>system(full_script_command);</code> just a typo in your question or may that be the problem?"}, {"owner": {"reputation": 47, "user_id": 10664551, "user_type": "registered", "profile_image": "https://graph.facebook.com/2200921149920352/picture?type=large", "display_name": "Gil Akrish", "link": "https://stackoverflow.com/users/10664551/gil-akrish"}, "reply_to_user": {"reputation": 8154, "user_id": 2470782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921783e0584f9ace7e05d303e4d48869?s=128&d=identicon&r=PG", "display_name": "Ingo Leonhardt", "link": "https://stackoverflow.com/users/2470782/ingo-leonhardt"}, "edited": false, "score": 0, "creation_date": 1567595601, "post_id": 57786335, "comment_id": 102007693, "body": "yes its just a typo. i am sorry for that. the actual command is system(script_command);"}, {"owner": {"reputation": 1513, "user_id": 7401546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad2d37c16adb4f0949e663487e9dcf5f?s=128&d=identicon&r=PG&f=1", "display_name": "Simpl", "link": "https://stackoverflow.com/users/7401546/simpl"}, "edited": false, "score": 0, "creation_date": 1567596127, "post_id": 57786335, "comment_id": 102007946, "body": "Is there any related logcat output?"}, {"owner": {"reputation": 47, "user_id": 10664551, "user_type": "registered", "profile_image": "https://graph.facebook.com/2200921149920352/picture?type=large", "display_name": "Gil Akrish", "link": "https://stackoverflow.com/users/10664551/gil-akrish"}, "edited": false, "score": 0, "creation_date": 1567596616, "post_id": 57786335, "comment_id": 102008191, "body": "nothing from logcat. however dmesg shows that sig17 was sent to raise_interface.sh"}, {"owner": {"reputation": 1513, "user_id": 7401546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad2d37c16adb4f0949e663487e9dcf5f?s=128&d=identicon&r=PG&f=1", "display_name": "Simpl", "link": "https://stackoverflow.com/users/7401546/simpl"}, "edited": false, "score": 0, "creation_date": 1567606735, "post_id": 57786335, "comment_id": 102013898, "body": "Anything in logcat from <code>avc</code>?"}], "owner": {"reputation": 47, "user_id": 10664551, "user_type": "registered", "profile_image": "https://graph.facebook.com/2200921149920352/picture?type=large", "display_name": "Gil Akrish", "link": "https://stackoverflow.com/users/10664551/gil-akrish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 127, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567592226, "creation_date": 1567592226, "question_id": 57786335, "link": "https://stackoverflow.com/questions/57786335/running-android-script-from-c-program", "title": "running android script from C program", "body": "<p>i am editing atcom ril program so that it will work on my custom device.\nafter receiving the needed IP i want to raise the interface using these two shell commands in the android terminal:</p>\n\n<pre><code>ifconfig ccmni0 &lt;ip&gt; netmask 255.0.0.0 up\nip route add default via &lt;ip&gt;\n</code></pre>\n\n<p>i have created a script called raise_interface.sh which contains the following:</p>\n\n<pre><code>#!/system/bin/sh\nifconfig ccmni0 $1 netmask 255.0.0.0 up\nip route add default via $1\necho '$1= ' $1\n</code></pre>\n\n<p>when i exec this script from the android shell ,and entering the IP as a parameter it works very well. however when i try to do the same thing from my C program it doesn't do it.\nhere is a snippet of the part where i try to do it:</p>\n\n<pre><code>sprintf(script_command, \"%s %s\", \"/system/bin/raise_interface.sh\",response_str_ip);\nATCOM_LOG(\"script command is : %s \\n\",script_command);\nint result = system(full_script_command);\n</code></pre>\n\n<p>when running the program i get from the above log </p>\n\n<pre><code>script command is : /system/bin/raise_interface.sh \"100.96.12.54\" \n</code></pre>\n\n<p>running the exact script from the shell works however the System() call always return -1.</p>\n\n<p>can someone help me ? </p>\n\n<p>thank you,</p>\n"}, {"tags": ["c", "cassandra", "cassandra-driver"], "comments": [{"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567589732, "post_id": 57785354, "comment_id": 102004608, "body": "To sort out problems you should separate each step. Did you try with a string literal holding the time? Did you verify result of <code>strftime</code>? Check your parameters"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567589776, "post_id": 57785354, "comment_id": 102004632, "body": "What is <code>localTime</code> used to determine size of your buffer? Is it a typo and you use <code>localtime</code> instead? This is wrong. Please show us real code, not something retyped and only slightly related to your code."}, {"owner": {"reputation": 343, "user_id": 4819195, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dc9dcbaf07c17b96c6c0598d668ab7d0?s=128&d=identicon&r=PG&f=1", "display_name": "A Beginner", "link": "https://stackoverflow.com/users/4819195/a-beginner"}, "reply_to_user": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567591186, "post_id": 57785354, "comment_id": 102005475, "body": "@Gerhardh There was indeed a typo in my code. I have edited it now. I have tried to insert from C program using string literal. It works if I write <code>const char* query = &quot;INSERT INTO time_table(id,time) VALUES(now(),&#39;2019-09-04 10:59:22&#39;);&quot;</code>. But it doesn&#39;t work if I write <code>strcpy(lt,&quot;2019-09-04 10:59:22&quot;);</code>"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567592161, "post_id": 57785354, "comment_id": 102005975, "body": "I have not much clue about cassandra. In examples I found they used it like this: <code>cass_statement_bind_string(statement, 0, cass_string_init(&quot;abc&quot;));</code> Did you try to use <code>cass_string_init()</code>?"}, {"owner": {"reputation": 343, "user_id": 4819195, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dc9dcbaf07c17b96c6c0598d668ab7d0?s=128&d=identicon&r=PG&f=1", "display_name": "A Beginner", "link": "https://stackoverflow.com/users/4819195/a-beginner"}, "reply_to_user": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567621477, "post_id": 57785354, "comment_id": 102021006, "body": "@Gerhardh I tried with that, but it seems the newer version doesn&#39;t support cass_string_init() function."}], "owner": {"reputation": 343, "user_id": 4819195, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dc9dcbaf07c17b96c6c0598d668ab7d0?s=128&d=identicon&r=PG&f=1", "display_name": "A Beginner", "link": "https://stackoverflow.com/users/4819195/a-beginner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567621425, "creation_date": 1567588994, "last_edit_date": 1567621425, "question_id": 57785354, "link": "https://stackoverflow.com/questions/57785354/not-able-to-insert-timestamp-data-in-cassandra-from-c-program", "title": "Not able to insert timestamp data in Cassandra from C program", "body": "<p>I have a simple code written in C for inserting local date and time into Cassandra's timestamp column as follows:</p>\n\n<pre><code>time_t rt= time(NULL);\nstruct tm * timeinfo;\ntimeinfo = localtime ( &amp;rt );\nchar lt[20];\nstrftime(lt, sizeof(lt), \"%Y-%m-%d %T\", timeinfo);\n\n const char* query = \"INSERT INTO time_table(id,time) VALUES(now(),?);\";\n\n          CassStatement* statement = cass_statement_new(query, 1);\n          cass_statement_bind_string(statement,0,lt);\n\n\n          CassFuture* result_future = cass_session_execute(session, statement);\n</code></pre>\n\n<p>But this code is not able to insert anything inside <code>time_table</code>. If I try to insert the same thing using cqlsh using the query <code>insert into time_table(id,time) values(now(),'2019-09-04 10:59:22');</code>, then the values are getting inserted without any problem. I am using Cassandra driver for C version 2.13.</p>\n\n<p>Can anyone please point out the mistake in the code?</p>\n"}, {"tags": ["c", "sockets", "networking"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1567586929, "post_id": 57784632, "comment_id": 102003025, "body": "I suspect, with <code>memcpy(&amp;addr, &amp;addr_in, sizeof(struct sockaddr)</code>."}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 2, "creation_date": 1567587466, "post_id": 57784632, "comment_id": 102003326, "body": "Use <code>getaddrinfo()</code> for populating socket address structures in a protocol-independent way."}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1567588440, "post_id": 57784632, "comment_id": 102003874, "body": "&quot;<i>connect API</i>&quot; what do you plan to pass to this API?"}, {"owner": {"reputation": 7413, "user_id": 304974, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c0bad048f40991e627962d8341092b1d?s=128&d=identicon&r=PG", "display_name": "Programmer", "link": "https://stackoverflow.com/users/304974/programmer"}, "edited": false, "score": 0, "creation_date": 1567588453, "post_id": 57784632, "comment_id": 102003889, "body": "Thanks how can getaddrinfo() API be used to populate structures in a protocol-independent way?"}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 1, "creation_date": 1567588531, "post_id": 57784632, "comment_id": 102003932, "body": "&quot;<i>how can ....</i>&quot; : you might like to have look <a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/functions/freeaddrinfo.html\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 7413, "user_id": 304974, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c0bad048f40991e627962d8341092b1d?s=128&d=identicon&r=PG", "display_name": "Programmer", "link": "https://stackoverflow.com/users/304974/programmer"}, "reply_to_user": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1567588885, "post_id": 57784632, "comment_id": 102004133, "body": "@alk Though the user defined connect function will take input as ( .. ,struct sockaddr * , ..) but how do we populate sockaddr_in6 and sockaddr_in to sockaddr"}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1567589055, "post_id": 57784632, "comment_id": 102004229, "body": "&quot;<i>how do we populate ...</i>&quot;:  I recommend to have look at the definitions of the various <code>struct sockaddrXYZ</code>."}], "answers": [{"comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1567638337, "post_id": 57785740, "comment_id": 102026113, "body": "Well which is it? It isn&#39;t guaranteed or it is?"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1567676396, "post_id": 57785740, "comment_id": 102037069, "body": "@user207421 I wasn&#39;t aware that &quot;shall define the <code>sockaddr_storage</code> structure, which shall be [l]arge enough to accommodate all supported protocol-specific address structures&quot; is unclear."}], "tags": [], "owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "is_accepted": false, "score": -1, "last_activity_date": 1567590321, "creation_date": 1567590321, "answer_id": 57785740, "question_id": 57784632, "link": "https://stackoverflow.com/questions/57784632/how-to-create-sockaddr-from-sockaddr-in-sockaddr-in6-structure/57785740#57785740", "title": "How to create sockaddr from sockaddr_in / sockaddr_in6 structure", "body": "<blockquote>\n  <p>programtically how can we convert the <code>sockaddr_in</code> and <code>sockaddr_in6</code> to <code>sockaddr</code></p>\n</blockquote>\n\n<p>You can't, as neither <code>sockaddr_in</code> nor <code>sockaddr_in6</code> are guaranteed to fit into a <code>sockaddr</code> structure.</p>\n\n<p><a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/sys_socket.h.html\" rel=\"nofollow noreferrer\">A POSIX-compliant system will provide a <code>sockaddr_storage</code> type that <strong>is</strong> guaranteed to be large enough to hold any type of <code>sockaddr</code> structure</a>:</p>\n\n<blockquote>\n  <p>The <code>&lt;sys/socket.h&gt;</code> header shall define the <code>sockaddr_storage</code>\n  structure, which shall be:</p>\n  \n  <ul>\n  <li><p>Large enough to accommodate all supported protocol-specific address structures</p></li>\n  <li><p>Aligned at an appropriate boundary so that pointers to it can be cast as pointers to protocol-specific address structures and used to\n  access the fields of those structures without alignment problems</p></li>\n  </ul>\n  \n  <p>The sockaddr_storage structure shall include at least the following\n  members:</p>\n\n<pre><code>sa_family_t   ss_family\n</code></pre>\n  \n  <p>When a pointer to a <code>sockaddr_storage</code> structure is cast as a pointer\n  to a <code>sockaddr</code> structure, the <code>ss_family</code> field of the\n  <code>sockaddr_storage</code> structure shall map onto the <code>sa_family</code> field of\n  the <code>sockaddr</code> structure. When a pointer to a <code>sockaddr_storage</code>\n  structure is cast as a pointer to a protocol-specific address\n  structure, the <code>ss_family</code> field shall map onto a field of that\n  structure that is of type <code>sa_family_t</code> and that identifies the\n  protocol's address family.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "is_accepted": true, "score": 1, "last_activity_date": 1567635831, "last_edit_date": 1567635831, "creation_date": 1567632791, "answer_id": 57795869, "question_id": 57784632, "link": "https://stackoverflow.com/questions/57784632/how-to-create-sockaddr-from-sockaddr-in-sockaddr-in6-structure/57795869#57795869", "title": "How to create sockaddr from sockaddr_in / sockaddr_in6 structure", "body": "<blockquote>\n  <p>programtically how can we convert the <code>sockaddr_in</code> and <code>sockaddr_in6</code> to <code>sockaddr</code> structure (populate its member variables) and then call connect with sockaddr structure?</p>\n</blockquote>\n\n<p>A <strong>typecast</strong> is not a <strong>conversion</strong>.  You are not converting anything.  Just as the examples you provided show, you create a <code>sockaddr_in</code> or <code>sockaddr_in6</code> instance as needed and then pass it as-is to <code>connect()</code>.  You are merely typecasting the <em>pointer</em> that points at the struct instance.  Internally, <code>connect()</code> will look at its input <code>addr</code>'s <code>sa_family</code> field and typecast the <code>addr</code> back to either <code>sockaddr_in</code> or <code>sockaddr_in6</code> accordingly to access the data fields as needed.</p>\n\n<blockquote>\n  <p>My aim is to write a user defined connect API for both IPv6 and IPv4 addresses.</p>\n</blockquote>\n\n<p>If you want to write protocol-agnostic code, you could do something like this:</p>\n\n<pre><code>int doConnect(int family, const char *ip, u_short port)\n{\n    struct sockaddr_storage ss = {};\n    socklen_t addrlen;\n\n    switch (family)\n    {\n        case AF_INET:\n        {\n            struct sockaddr_in *addr = (struct sockaddr_in *) &amp;ss;\n            addr-&gt;sin_family = AF_INET;\n            addr-&gt;sin_port = htons(port);\n            inet_pton(AF_INET, ip, &amp;addr-&gt;sin_addr);\n            addrlen = sizeof(struct sockaddr_in);\n            break;\n        }\n\n        case AF_INET6:\n        {\n            struct sockaddr_in6 *addr = (struct sockaddr_in6 *) &amp;ss;\n            addr-&gt;sin6_family = AF_INET6;\n            addr-&gt;sin6_port = htons(port);\n            inet_pton(AF_INET6, ip, &amp;addr-&gt;sin6_addr);\n            addrlen = sizeof(struct sockaddr_in6);\n            break;\n        }\n\n        default:\n            return -1;\n    }\n\n    int s = socket(family, SOCK_STREAM_IPPROTO_TCP);\n    if (s != -1)\n    {\n        if (connect(s, (struct sockaddr *) &amp;ss, addrlen) &lt; 0)\n        {\n            close(s);\n            s = -1;\n        }\n    }\n\n    return s;\n}\n</code></pre>\n\n<pre><code>int s = doConnect(AF_INET, \"127.0.0.1\", 5000);\n</code></pre>\n\n<pre><code>int s = doConnect(AF_INET6, \"::1\", 5000);\n</code></pre>\n\n<p>However, a better solution is to use <code>getaddrinfo()</code> instead and let it allocate the correct <code>sockaddr</code> data for you based on the input values it actually parses, eg:</p>\n\n<pre><code>int doConnect(const char *ip, u_short port)\n{\n    struct addrinfo hints = {};\n    hints.ai_flags = AI_NUMERICHOST;\n    hints.ai_family = AF_UNSPEC;\n    hints.ai_socktype = SOCK_STREAM;\n    hints.ai_protocol = IPPROTO_TCP;\n\n    struct addrinfo *addr;\n\n    char szPort[6];\n    sprintf(szPort, \"%hu\", port);\n\n    int s = -1;\n\n    int ret = getaddrinfo(ip, szPort, &amp;hints, &amp;addr);\n    if (ret == 0)\n    {\n        s = socket(addr-&gt;ai_family, addr-&gt;ai_socktype, addr-&gt;ai_protocol);\n        if (s != -1)\n        {\n            if (connect(s, addr-&gt;ai_addr, addr-&gt;ai_addrlen) == -1)\n            {\n                close(s);\n                s = -1;\n            }\n        }\n\n        freeaddrinfo(addr);\n    }\n\n    return s;\n}\n</code></pre>\n\n<pre><code>int s = doConnect(\"127.0.0.1\", 5000);\n</code></pre>\n\n<pre><code>int s = doConnect(\"::1\", 5000);\n</code></pre>\n\n<p>The nice thing about <code>getaddrinfo()</code> is that you can also use it for servers, too.  Simply use the <code>AI_PASSIVE</code> flag in the <code>hints.ai_flags</code> field, and then use the resulting <code>addrinfo</code> item(s) to call <code>socket()</code> and <code>bind()</code>.</p>\n"}], "owner": {"reputation": 7413, "user_id": 304974, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c0bad048f40991e627962d8341092b1d?s=128&d=identicon&r=PG", "display_name": "Programmer", "link": "https://stackoverflow.com/users/304974/programmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1022, "favorite_count": 0, "accepted_answer_id": 57795869, "answer_count": 2, "score": 0, "last_activity_date": 1567635831, "creation_date": 1567586393, "last_edit_date": 1567589229, "question_id": 57784632, "link": "https://stackoverflow.com/questions/57784632/how-to-create-sockaddr-from-sockaddr-in-sockaddr-in6-structure", "title": "How to create sockaddr from sockaddr_in / sockaddr_in6 structure", "body": "<p>Below is an extract of example code for IPv6 and IPv4 clinet code:</p>\n\n<p><strong>IPv6</strong></p>\n\n<pre><code>int s;\nstruct sockaddr_in6 addr;\n\ns = socket(AF_INET6, SOCK_STREAM, 0);\naddr.sin6_family = AF_INET6;\naddr.sin6_port = htons(5000);\ninet_pton(AF_INET6, \"::1\", &amp;addr.sin6_addr);\nconnect(s, (struct sockaddr *)&amp;addr, sizeof(addr));\n</code></pre>\n\n<p><strong>IPv4</strong></p>\n\n<pre><code>int s;\nstruct sockaddr_in addr;\n\ns = socket(AF_INET, SOCK_STREAM, 0);\naddr.sin_family = AF_INET;\naddr.sin_port = htons(5000);\nservaddr.sin_addr.s_addr = INADDR_ANY; \nconnect(s, (struct sockaddr *)&amp;addr, sizeof(addr));\n</code></pre>\n\n<p>My aim is to write a user defined connect API for both IPv6 and IPv4 addresses. Since both of them convert structures to <em>struct sockaddr</em> structure - programtically how can we convert the <strong>sockaddr_in</strong> and <strong>sockaddr_in6</strong> to <strong>sockaddr</strong> structure (populate its member variables) and then call connect with sockaddr sturcure?</p>\n"}, {"tags": ["c", "pointers", "malloc", "realloc"], "comments": [{"owner": {"reputation": 17331, "user_id": 8950365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c6ba3b19f86f1bea8cf76e691db4349?s=128&d=identicon&r=PG&f=1", "display_name": "rafix07", "link": "https://stackoverflow.com/users/8950365/rafix07"}, "edited": false, "score": 3, "creation_date": 1567582606, "post_id": 57783557, "comment_id": 102000872, "body": "Google <i>Updating pointers in a function in C</i> - you need to pass vector by <code>**</code>."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 4, "creation_date": 1567582676, "post_id": 57783557, "comment_id": 102000908, "body": "Remember that in C all arguments are passed <i>by value</i>. That means their values are <i>copied</i> into the functions local argument variables. Modifying a copy (like assigning to it) will not modify the original. Please do some research about <i>emulating pass by reference in C</i>."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 3, "creation_date": 1567582750, "post_id": 57783557, "comment_id": 102000940, "body": "Also note that you should never assign back to the pointer you pass to <a href=\"https://en.cppreference.com/w/c/memory/realloc\" rel=\"nofollow noreferrer\"><code>realloc</code></a>. If <code>realloc</code> fails and return a null pointer, then you lose the original pointer and have a memory leak."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 3, "creation_date": 1567582960, "post_id": 57783557, "comment_id": 102001035, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/29658614/updating-pointers-in-a-function\">Updating pointers in a function</a>"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1567583050, "post_id": 57783557, "comment_id": 102001077, "body": "What is <code>start</code>? Is it supposed to be <code>elem_ptr </code>?"}, {"owner": {"reputation": 967, "user_id": 4555765, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/607e0c47616dba32d110b693c84d4fc8?s=128&d=identicon&r=PG&f=1", "display_name": "Lin", "link": "https://stackoverflow.com/users/4555765/lin"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1567583365, "post_id": 57783557, "comment_id": 102001218, "body": "@WeatherVane indeed. fixed."}, {"owner": {"reputation": 967, "user_id": 4555765, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/607e0c47616dba32d110b693c84d4fc8?s=128&d=identicon&r=PG&f=1", "display_name": "Lin", "link": "https://stackoverflow.com/users/4555765/lin"}, "reply_to_user": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567583818, "post_id": 57783557, "comment_id": 102001406, "body": "@Gerhardh, I don&#39;t think is exactly equal, since the <code>realloc</code> here is absent in the duplicate candidate."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567583885, "post_id": 57783557, "comment_id": 102001445, "body": "It does not matter if the pointer is modified via <code>++</code> or via a call to <code>realloc</code>. It is exactly the same mechanism."}, {"owner": {"reputation": 967, "user_id": 4555765, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/607e0c47616dba32d110b693c84d4fc8?s=128&d=identicon&r=PG&f=1", "display_name": "Lin", "link": "https://stackoverflow.com/users/4555765/lin"}, "reply_to_user": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567584659, "post_id": 57783557, "comment_id": 102001872, "body": "@Gerhardh can you please point me some document to learn more about the internal <code>realloc</code> mechanism?"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567585059, "post_id": 57783557, "comment_id": 102002089, "body": "Which internal <code>realloc</code> mechanism? It is about modifying a variable in a function. It does not matter if you do this with <code>malloc</code>, <code>realloc</code>, <code>++</code>, <code>=&amp;other_variable</code> or any other machanism changing the value of a variable. It is only about adding another level of indirection to the variable. If you do not have the address of the variable outside your function you cannot change it. You can only change a copy of the value which will be thrown away after you return."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1567669629, "post_id": 57783557, "comment_id": 102033559, "body": "regarding: <code>vector = realloc(vector, n * n * sizeof *vector);</code> and <code>int read_matrix_file(const char *fname, double *vector)</code>  The call to <code>realloc()</code> can/will change where the callers&#39; <code>vector</code> is pointing.  To successfully do that, must pass the address of <code>vector</code> so the signature should be: <code>int read_matrix_file(const char *fname, double **vector)</code>  Then, all references to <code>vector</code> need to be modified  (except the call to <code>realloc()</code> ) to properly de-reference that parameter"}], "answers": [{"comments": [{"owner": {"reputation": 967, "user_id": 4555765, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/607e0c47616dba32d110b693c84d4fc8?s=128&d=identicon&r=PG&f=1", "display_name": "Lin", "link": "https://stackoverflow.com/users/4555765/lin"}, "edited": false, "score": 0, "creation_date": 1567583687, "post_id": 57783830, "comment_id": 102001345, "body": "passing a <code>**</code> how can I handle the realloc? The problem is, I don&#39;t know how large my matrix will be  before read the file. Any other better strategies?"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "reply_to_user": {"reputation": 967, "user_id": 4555765, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/607e0c47616dba32d110b693c84d4fc8?s=128&d=identicon&r=PG&f=1", "display_name": "Lin", "link": "https://stackoverflow.com/users/4555765/lin"}, "edited": false, "score": 1, "creation_date": 1567584079, "post_id": 57783830, "comment_id": 102001573, "body": "@Lin You handle the size in the same way as before. Instead of <code>vector</code> you need to use <code>*vector</code>"}, {"owner": {"reputation": 967, "user_id": 4555765, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/607e0c47616dba32d110b693c84d4fc8?s=128&d=identicon&r=PG&f=1", "display_name": "Lin", "link": "https://stackoverflow.com/users/4555765/lin"}, "edited": false, "score": 0, "creation_date": 1567584365, "post_id": 57783830, "comment_id": 102001735, "body": "I think you missed <code>*p_vector</code> in <code>realloc</code> first parameter"}, {"owner": {"reputation": 104, "user_id": 4831400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f3eafee7d44e2b6b705846691307309?s=128&d=identicon&r=PG&f=1", "display_name": "alrevuelta", "link": "https://stackoverflow.com/users/4831400/alrevuelta"}, "edited": false, "score": 0, "creation_date": 1567616273, "post_id": 57783830, "comment_id": 102018937, "body": "Just curious, why are you allocating memory with <code>malloc</code> in the main function and then <code>realloc</code> inside the function? Why not just <code>malloc</code> inside <code>read_matrix_file</code>?"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1567669997, "post_id": 57783830, "comment_id": 102033737, "body": "Why not just use &#39;malloc()&#39; in the called function?   Because the (already set values in<code>vector</code>) need to be kept and <code>realloc()</code> will keep those values"}, {"owner": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1567670812, "post_id": 57783830, "comment_id": 102034107, "body": "@user3629249 In this specific case, the OP doesn&#39;t seem to care about any of the data that was in the buffer before the <code>realloc</code>. I mean he doesn&#39;t even initialize it after the <code>malloc</code>."}, {"owner": {"reputation": 967, "user_id": 4555765, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/607e0c47616dba32d110b693c84d4fc8?s=128&d=identicon&r=PG&f=1", "display_name": "Lin", "link": "https://stackoverflow.com/users/4555765/lin"}, "edited": false, "score": 0, "creation_date": 1567748157, "post_id": 57783830, "comment_id": 102063240, "body": "indeed. I don&#39;t care (and I don&#39;t know) anything about the data structure before I open the file and read the first line (that I do inside the <code>read_matrix_file</code>), I just <code>malloc</code> beforehand to keep the pointer address in call block. Any other ways to accomplish that?"}, {"owner": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "reply_to_user": {"reputation": 967, "user_id": 4555765, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/607e0c47616dba32d110b693c84d4fc8?s=128&d=identicon&r=PG&f=1", "display_name": "Lin", "link": "https://stackoverflow.com/users/4555765/lin"}, "edited": false, "score": 0, "creation_date": 1567756090, "post_id": 57783830, "comment_id": 102066218, "body": "@Lin In that case, you could simply pass in a (pointer-to-) NULL pointer and do a <code>malloc()</code> within <code>read_matrix_file</code> instead of <code>realloc()</code>, as suggested by @alrevuelta"}], "tags": [], "owner": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "is_accepted": true, "score": 3, "last_activity_date": 1567586780, "last_edit_date": 1567586780, "creation_date": 1567583597, "answer_id": 57783830, "question_id": 57783557, "link": "https://stackoverflow.com/questions/57783557/array-elements-are-lost-outside-the-function/57783830#57783830", "title": "Array elements are &quot;lost&quot; outside the function", "body": "<p>You are reallocating memory inside <code>read_matrix_file()</code> and storing the elements of the matrix in that memory region. But when you come out of the function, since the pointer <code>vector</code>is a local variable, its new value is lost when you leave the function.</p>\n\n<p>When you come back inside <code>main()</code> vector still points to the (now likely invalid) memory region that you had previously allocated with <code>malloc()</code>.</p>\n\n<p>You should either allocate large enough memory before calling <code>read_matrix_file</code> or pass a double pointer (**) if you want to modify the pointer and see the change reflected back in <code>main()</code></p>\n\n<p>What I meant is something like this:</p>\n\n<pre><code>#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n\nint read_matrix_file(const char *fname, double **p_vector)\n{\n    /* Try to open file */\n    FILE *fd = fopen(fname, \"r\");\n    char line[BUFSIZ];\n    fgets(line, sizeof line, fd);\n\n    int n;\n    sscanf(line, \"%d\", &amp;n);\n\n    *p_vector = realloc(*p_vector, n * n * sizeof **p_vector);\n    double *vector = *p_vector;\n\n    memset(vector, 0, n * n * sizeof *vector);\n\n    /* Reads the elements */\n    int b;\n    for(int i=0; i &lt; n; i++) {\n        // Read the i-th line into line\n        if (fgets(line, sizeof line, fd) == NULL) {\n            perror(\"fgets\");\n            return(-1);\n        }\n\n        /* Reads th j-th element of i-th line into the vector */\n        char *elem_ptr = line;\n        for (int j=0; j &lt; n; j++) {\n            if(sscanf(elem_ptr, \"%lf%n\", &amp;vector[n*i+j] , &amp;b) != 1) {\n                perror(\"sscanf\");\n                return(1);\n            }\n            elem_ptr += b;\n        }\n    }\n    fclose(fd);\n\n    /* HERE PRINTS OK */\n    for(int i=0; i&lt;n*n; i++)\n        printf(\"%i %f\\n\",i, vector[i]);\n\n    return n;\n}\n</code></pre>\n\n<p>In main, call it with:</p>\n\n<pre><code>int n = read_matrix_file(fname, &amp;vector);\n</code></pre>\n\n<p>EDIT: Please note that this code does not handle the failure of <code>realloc()</code> properly.</p>\n"}], "owner": {"reputation": 967, "user_id": 4555765, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/607e0c47616dba32d110b693c84d4fc8?s=128&d=identicon&r=PG&f=1", "display_name": "Lin", "link": "https://stackoverflow.com/users/4555765/lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 57783830, "answer_count": 1, "score": 0, "last_activity_date": 1567586780, "creation_date": 1567582513, "last_edit_date": 1567583350, "question_id": 57783557, "link": "https://stackoverflow.com/questions/57783557/array-elements-are-lost-outside-the-function", "title": "Array elements are &quot;lost&quot; outside the function", "body": "<p>I have a matrix in a file like:</p>\n\n<pre><code>3\n1 2 3\n4 5 6\n7 8 -9\n</code></pre>\n\n<p>where the first line indicates the square matrix order. I'm using the following code to read the file and store it into a vector (I have removed all <code>if</code> checks for sake of simplicity):</p>\n\n<pre><code>#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n\nint read_matrix_file(const char *fname, double *vector)\n{\n    /* Try to open file */\n    FILE *fd = fopen(fname, \"r\");\n    char line[BUFSIZ];\n    fgets(line, sizeof line, fd);\n\n    int n;\n    sscanf(line, \"%d\", &amp;n)\n\n    vector = realloc(vector, n * n * sizeof *vector);\n    memset(vector, 0, n * n * sizeof *vector);\n\n    /* Reads the elements */\n    int b;\n    for(int i=0; i &lt; n; i++) {\n        // Read the i-th line into line\n        if (fgets(line, sizeof line, fd) == NULL) {\n            perror(\"fgets\");\n            return(-1);\n        }\n\n        /* Reads th j-th element of i-th line into the vector */\n        char *elem_ptr = line;\n        for (int j=0; j &lt; n; j++) {\n            if(sscanf(elem_ptr, \"%lf%n\", &amp;vector[n*i+j] , &amp;b) != 1) {\n                perror(\"sscanf\");\n                return(1);\n            }\n            elem_ptr += b;\n        }\n    }\n    fclose(fd);\n\n    /* HERE PRINTS OK */\n    for(int i=0; i&lt;n*n; i++)\n        printf(\"%i %f\\n\",i, vector[i]);\n\n    return n;\n}\n</code></pre>\n\n<p>The <code>read_matrix_file</code> receives a filename and an <code>array</code> of <code>doubles</code> and fill the array, returning the matrix order. The expected usage can be seen in this code block.</p>\n\n<pre><code>int main(void)\n{\n\n    const char *fname = \"matrix.txt\";\n    double *vector = malloc(sizeof * vector);\n\n    int n = read_matrix_file(fname, vector);\n\n    /* Here prints junk */\n    for(int i=0; i&lt;n*n; i++)\n        printf(\"%i %f\\n\",i, vector[i]);\n\n    free(vector);\n}\n</code></pre>\n\n<p>The issue is, the <code>printf</code> works fine inside the <code>read_matrix_file</code> but seems invalid in <code>main</code>.</p>\n\n<p>I'm allocating the array outside the function and passing it by \"reference\", but I'm very suspecious of <code>realloc</code>, unfortunatelly I don't know how to fix or a better approach.</p>\n"}, {"tags": ["c++", "c", "ssl", "openssl", "aes"], "comments": [{"owner": {"reputation": 6899, "user_id": 1212012, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gmBY7.png?s=128&g=1", "display_name": "Mathieu", "link": "https://stackoverflow.com/users/1212012/mathieu"}, "edited": false, "score": 0, "creation_date": 1567586009, "post_id": 57783497, "comment_id": 102002538, "body": "If that was a linking problem, you program wouldn&#39;t even run. How do you set the cipher on first computer? Can you compare <code>openssl.cnf</code> of both computer?"}, {"owner": {"reputation": 3107, "user_id": 4131673, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/100000565112046/picture?type=large", "display_name": "jaskmar", "link": "https://stackoverflow.com/users/4131673/jaskmar"}, "reply_to_user": {"reputation": 6899, "user_id": 1212012, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gmBY7.png?s=128&g=1", "display_name": "Mathieu", "link": "https://stackoverflow.com/users/1212012/mathieu"}, "edited": false, "score": 0, "creation_date": 1567588543, "post_id": 57783497, "comment_id": 102003935, "body": "@Mathieu I meant shared object could be different in each computers. With static linking that problem should not exists."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1567591882, "post_id": 57783497, "comment_id": 102005851, "body": "This is a perfect example of why cramming four function calls into one line such as <code>if (EVP_DecryptInit(ctx.get(), EVP_aes_256_cbc_hmac_sha256(), _key.impl.data(),                         nullptr) != 1)</code> is a really bad idea.  Of those four function calls, you simply can not tell which one went bad.  How do you know it&#39;s not <code>ctx.get()</code> or even <code>_key.impl.data()</code> that&#39;s failing on some systems and causing cascading failures?  You <b>can&#39;t</b> tell.  But if you made each call separately, checking <b>every</b> call for success and logging failures, you&#39;d know. 10 LOC for an unsolvable problem? Bad."}, {"owner": {"reputation": 5562, "user_id": 1946679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed74e2cdc59d058b76a76c90dd3c3bdc?s=128&d=identicon&r=PG", "display_name": "Matt Caswell", "link": "https://stackoverflow.com/users/1946679/matt-caswell"}, "edited": false, "score": 0, "creation_date": 1567593049, "post_id": 57783497, "comment_id": 102006434, "body": "Are you getting exactly the same error with &quot;EVP_aes_256_cbc()&quot;?, i.e. the &quot;no cipher set&quot; error? The <i>only</i> reason that is ever returned from EVP_DecryptInit is if your input cipher is NULL, i.e. &quot;EVP_aes_256_cbc()&quot; returns NULL (you could add some debugging to confirm if that is the case or not). If that is happening then something has gone badly wrong somewhere..."}, {"owner": {"reputation": 3107, "user_id": 4131673, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/100000565112046/picture?type=large", "display_name": "jaskmar", "link": "https://stackoverflow.com/users/4131673/jaskmar"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1567593930, "post_id": 57783497, "comment_id": 102006850, "body": "@AndrewHenle <code>EVP_aes_256_cbc_hmac_sha256()</code> returns nullptr, which is what error message says."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1567594389, "post_id": 57783497, "comment_id": 102007066, "body": "And you can&#39;t tell why."}], "answers": [{"tags": [], "owner": {"reputation": 5562, "user_id": 1946679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed74e2cdc59d058b76a76c90dd3c3bdc?s=128&d=identicon&r=PG", "display_name": "Matt Caswell", "link": "https://stackoverflow.com/users/1946679/matt-caswell"}, "is_accepted": false, "score": 0, "last_activity_date": 1567587372, "creation_date": 1567587372, "answer_id": 57784907, "question_id": 57783497, "link": "https://stackoverflow.com/questions/57783497/openssl-aes-works-only-on-certain-machine-even-with-static-linking/57784907#57784907", "title": "OpenSSL AES works only on certain machine, even with static linking", "body": "<p>Do not use <code>EVP_aes_256_cbc_hmac_sha256()</code>. This is a highly specialised cipher that is not intended for general use. It is intended to only be used by libssl. The documentation for it is on this page:</p>\n\n<p><a href=\"https://www.openssl.org/docs/man1.1.1/man3/EVP_aes_256_cbc_hmac_sha256.html\" rel=\"nofollow noreferrer\">https://www.openssl.org/docs/man1.1.1/man3/EVP_aes_256_cbc_hmac_sha256.html</a></p>\n\n<p>The most relevant section on that page says this about the cipher:</p>\n\n<blockquote>\n  <p>Authenticated encryption with AES in CBC mode using SHA256 (SHA-2, 256-bits) as HMAC, with keys of 128 and 256 bits length respectively. The authentication tag is 256 bits long.</p>\n  \n  <p>WARNING: this is not intended for usage outside of TLS and requires calling of some undocumented ctrl functions. These ciphers do not conform to the EVP AEAD interface.</p>\n</blockquote>\n\n<p>In other words if you do not understand the details of the undocumented aspects of this cipher then do not touch it. One of those undocumented aspects is that it is not supported on all platforms. On some platforms <code>EVP_aes_256_cbc_hmac_sha256()</code> just returns NULL, e.g. see:</p>\n\n<p><a href=\"https://github.com/openssl/openssl/blob/1bf29d497e66efef0fbc9b1864d8a5db64bf898e/crypto/evp/e_aes_cbc_hmac_sha256.c#L934-L950\" rel=\"nofollow noreferrer\">https://github.com/openssl/openssl/blob/1bf29d497e66efef0fbc9b1864d8a5db64bf898e/crypto/evp/e_aes_cbc_hmac_sha256.c#L934-L950</a></p>\n\n<p>This is the most likely reason why it works for you on some machines, but not on others.</p>\n"}], "owner": {"reputation": 3107, "user_id": 4131673, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/100000565112046/picture?type=large", "display_name": "jaskmar", "link": "https://stackoverflow.com/users/4131673/jaskmar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 131, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567593877, "creation_date": 1567582215, "last_edit_date": 1567593877, "question_id": 57783497, "link": "https://stackoverflow.com/questions/57783497/openssl-aes-works-only-on-certain-machine-even-with-static-linking", "title": "OpenSSL AES works only on certain machine, even with static linking", "body": "<p>I use OpenSSL 1.1.1 for AES decryption on Linux. It works on my machine, but doesn't work on another, so I used static linking. It didn't help. Here's a code:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>    if (EVP_DecryptInit(ctx.get(), EVP_aes_256_cbc_hmac_sha256(), _key.impl.data(),\n                        nullptr) != 1)\n    {\n        const char* errorString = ERR_error_string(ERR_get_error(), nullptr);\n        return out;\n    }\n</code></pre>\n\n<p>on the machine where it doesn't work, the errorString is following:</p>\n\n<pre><code>error:0607B083:digital envelope routines:EVP_CipherInit_ex:no cipher set\n</code></pre>\n\n<p>ldd on my <code>*.so</code> file confirms it is linked statically:</p>\n\n<pre><code>ldd mylib.so\n    linux-vdso.so.1 (0x00007ffe971a9000)\n    libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fa3a3b64000)\n    librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007fa3a395c000)\n    libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007fa3a373d000)\n    libstdc++.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007fa3a33b4000)\n    libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007fa3a3016000)\n    libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007fa3a2dfe000)\n    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fa3a2a0d000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007fa3a445b000)\n</code></pre>\n\n<p>What am I doing wrong?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I have just discovered that <code>EVP_aes_256_cbc</code> returns the same result as <code>EVP_aes_256_cbc_hmac_sha256</code> and several others. What is the difference between those then? </p>\n\n<p>My goal is to replace WinAPI <code>CryptAcquireContextW(&amp;cryptProv_, NULL, MS_ENH_RSA_AES_PROV_W,PROV_RSA_AES, CRYPT_VERIFYCONTEXT)</code></p>\n\n<p><code>EVP_aes_256_cbc_hmac_sha256()</code> returns nullptr, <code>EVP_aes_256_cbc()</code> returns correct object and works on both machines.</p>\n"}, {"tags": ["c", "function"], "comments": [{"owner": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "edited": false, "score": 0, "creation_date": 1567581918, "post_id": 57783401, "comment_id": 102000546, "body": "Typo: Missing braces in last <code>else</code> block."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1567582008, "post_id": 57783401, "comment_id": 102000596, "body": "300 is greater than 91.  You wrote || but meant &amp;&amp;."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1567582020, "post_id": 57783401, "comment_id": 102000601, "body": "<code>char name</code> makes <code>name</code> a single character. Strings in C needs more than that to be able to store the null-terminator."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1567582023, "post_id": 57783401, "comment_id": 102000602, "body": "Notes 1) <code>char name;</code> is incorrect and 2) there are gaps between the speed ranges, i.e. misses 90 and 91 etc.."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1567582113, "post_id": 57783401, "comment_id": 102000645, "body": "And why are you defining the <code>distance</code> and <code>time</code> variables in the <code>main</code> function and passing them as arguments to the <code>speed</code> function? Why not define the variables locally inside the <code>speed</code> function? Any why do your <code>message</code> function use a <code>float</code> argument, when all you pass it are <code>int</code> values? And what is the <code>speed</code> variable for in the <code>main</code> function? Etc. etc. All in all it seems you might need to take a few steps back and start over with a beginners book."}, {"owner": {"reputation": 145, "user_id": 9088108, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/540ece36b5c9fd67855b0b530d095ed8?s=128&d=identicon&r=PG&f=1", "display_name": "samini", "link": "https://stackoverflow.com/users/9088108/samini"}, "edited": false, "score": 0, "creation_date": 1567582198, "post_id": 57783401, "comment_id": 102000687, "body": "and parentheses for last else are missed"}], "answers": [{"tags": [], "owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "is_accepted": true, "score": 1, "last_activity_date": 1567582572, "creation_date": 1567582572, "answer_id": 57783572, "question_id": 57783401, "link": "https://stackoverflow.com/questions/57783401/trying-to-print-out-some-information-of-the-input-of-the-user-but-didnt-work/57783572#57783572", "title": "trying to print out some information of the input of the user,but didn&#39;t work", "body": "<p>This here </p>\n\n<pre><code>else if (speed &lt; 120 || speed &gt;91)\n</code></pre>\n\n<p>Should be</p>\n\n<pre><code>else if (speed &lt; 120 &amp;&amp; speed &gt;91)\n</code></pre>\n\n<p>Otherwise it's always going to be true. But what's causing your message to be printed incorrectly is the missing braces here:</p>\n\n<pre><code>else\n        printf(\"Speed: %.2f\\n\", speed);\n        printf(\"\\nDanger alert!\");\n</code></pre>\n\n<p>This way the <code>printf(\"\\nDanger alert!\");</code> will always print because it got nothing to do with the <code>if</code> block. Put <code>{}</code> around the two <code>printf</code> calls like you do with the <code>if</code> blocks above. Also, <code>name</code> needs to be an array of <code>char</code>, not just one <code>char</code>:</p>\n\n<pre><code>char name[20];\n</code></pre>\n\n<p>And then you can change the <code>scanf</code> call to ensure that you're not corrupting your memory if the user enters too much:</p>\n\n<pre><code>scanf(\"%19s\", &amp;name);\n</code></pre>\n\n<p>Furthermore, <code>int speed(int distance, int time)</code> doesn't need those parameters. They're uninitialized when you pass them anyway and you initialize them inside. Instead, they can be local variables in the function:</p>\n\n<pre><code>int speed()\n{\n    int distance;\n    int time;\n    ...\n}\n</code></pre>\n\n<p>And then you can remove the <code>distance</code>, <code>speed</code> and also <code>name</code> from <code>main</code> in order to get rid of various compiler warnings about unused/uninitialized variables.</p>\n"}], "owner": {"reputation": 23, "user_id": 11798915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22fb41e1a6a0ba7dc768ff1bf8624020?s=128&d=identicon&r=PG&f=1", "display_name": "Hamoud", "link": "https://stackoverflow.com/users/11798915/hamoud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 1, "accepted_answer_id": 57783572, "answer_count": 1, "score": 0, "last_activity_date": 1567582572, "creation_date": 1567581802, "last_edit_date": 1567582452, "question_id": 57783401, "link": "https://stackoverflow.com/questions/57783401/trying-to-print-out-some-information-of-the-input-of-the-user-but-didnt-work", "title": "trying to print out some information of the input of the user,but didn&#39;t work", "body": "<p>getting the input from the user and want to print out the information that he were putting. </p>\n\n<p>I tried to out put of the car type but the black box did not work,Therefore, the speed gave me two result.. any idea ?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint speed(int distance, int time);\nvoid message(float speed);\n\nint main ()\n{\n    char answer,name;\n    int distance , time ,speed1;\n    do {\n\n\n    speed1=speed(distance , time);\n    message(speed1);\n    int speed;\n    printf(\"\\nContinue calculating speed? [Y/N] : \");\n    scanf(\" %c\",&amp;answer);\n    }while(answer=='y' || answer =='Y');\n\n}\n\nint speed(int distance, int time)\n{\n    int speed;\n    char name;\n    printf(\"Enter car type :\");\n    scanf(\"%s\",&amp;name);\n    printf(\"Enter distance in kilometers : \");\n    scanf(\" %d\",&amp;distance);\n    printf(\"Enter time in hour: \");\n    scanf(\" %d\",&amp;time);\n    speed = distance / time;\n    return speed;\n}\nvoid message(float speed)\n{\n    if (speed &lt; 60 &amp;&amp; speed &gt;0)\n    {\n        printf(\"Speed: %.2f\\n\",speed);\n        printf(\"Too slow!\");\n    }\n    else if (speed &lt;90 &amp;&amp; speed &gt;61)\n    {\n        printf(\"Speed: %.2f\\n\",speed);\n        printf(\"Just cruising...\");\n    }\n    else if ( speed &lt;120 || speed &gt;91)\n    {\n        printf(\"Speed: %.2f\\n\",speed);\n        printf(\"Good speed.\");\n    }\n    else\n        printf(\"Speed: %.2f\\n\",speed);\n        printf(\"\\nDanger alert!\");\n}\n</code></pre>\n\n<p>Expecting the out put will be : </p>\n\n<pre><code>Enter car type: Alfa\nEnter distance in kilometers: 300\nEnter time in hours: 3 \n\nCar type: Alfa\nSpeed : 300.00\nGood speed \n</code></pre>\n\n<p>But it gave me </p>\n\n<pre><code>Enter car type: Alfa\nEnter distance in kilometers: 300\nEnter time in hours: 3 \n\nCar type: Alfa\nSpeed : 300.00\nGood speed \nDanger alert!\n</code></pre>\n"}, {"tags": ["c", "arrays", "string", "for-loop"], "comments": [{"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 3, "creation_date": 1567581299, "post_id": 57783246, "comment_id": 102000241, "body": "<code>char stringarr2[] = &quot;&quot;;</code> this makes an array of size 1, and <code>stringarr2[0]</code> is the null terminator. You can&#39;t do string manipulation this way. Give it a proper size."}, {"owner": {"reputation": 4398, "user_id": 3697264, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5adc5afbd7a1145fdd762d872b4b43bb?s=128&d=identicon&r=PG", "display_name": "SPlatten", "link": "https://stackoverflow.com/users/3697264/splatten"}, "edited": false, "score": 0, "creation_date": 1567581305, "post_id": 57783246, "comment_id": 102000243, "body": "What makes come to your conclusion?"}, {"owner": {"reputation": 481, "user_id": 6713871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6d0cf46b08a63241386786e74ae4b1f?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Rollins", "link": "https://stackoverflow.com/users/6713871/chris-rollins"}, "edited": false, "score": 2, "creation_date": 1567581316, "post_id": 57783246, "comment_id": 102000251, "body": "before i even look at anything else, do not use strlen in the conditional of the for loop. it counts the string length every loop iteration. store the length in a variable before the loop."}, {"owner": {"reputation": 4398, "user_id": 3697264, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5adc5afbd7a1145fdd762d872b4b43bb?s=128&d=identicon&r=PG", "display_name": "SPlatten", "link": "https://stackoverflow.com/users/3697264/splatten"}, "edited": false, "score": 0, "creation_date": 1567581516, "post_id": 57783246, "comment_id": 102000362, "body": "When you loop iterates, i = 0, stringarr2[0] = &#39;a&#39;, when i = 1, it will do nothing, stringarr2 has a length of 1, when i = 2, stringarr2 will contain ab, when i = 3, stringarr2 will contain abc.  No obvious error.  Doh!  As already posted by Blaze, stringarr2 has no size.  Correct with char stringarr2[sizeof(stringarr1)]"}, {"owner": {"reputation": 481, "user_id": 6713871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6d0cf46b08a63241386786e74ae4b1f?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Rollins", "link": "https://stackoverflow.com/users/6713871/chris-rollins"}, "edited": false, "score": 0, "creation_date": 1567582514, "post_id": 57783246, "comment_id": 102000817, "body": "this code seems to have deeper problems. You are only taking characters other than <code>&#39;!&#39;</code> so do you want to leave gaps where the <code>&#39;!&#39;</code> is or do you want to append the other characters and not leave a gap? Leaving a gap means you need to choose a specific character to put in the gap. Appending means you need to keep a separate iterator in your loop for the 2nd string. Either way like everyone else said you need to allocate the 2nd string to a large enough size."}, {"owner": {"reputation": 16624, "user_id": 237934, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Hshoa.png?s=128&g=1", "display_name": "kame", "link": "https://stackoverflow.com/users/237934/kame"}, "edited": false, "score": 0, "creation_date": 1567583188, "post_id": 57783246, "comment_id": 102001139, "body": "I want to remove all &#39;!&#39; !"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "reply_to_user": {"reputation": 481, "user_id": 6713871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6d0cf46b08a63241386786e74ae4b1f?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Rollins", "link": "https://stackoverflow.com/users/6713871/chris-rollins"}, "edited": false, "score": 1, "creation_date": 1567583249, "post_id": 57783246, "comment_id": 102001171, "body": "@ChrisRollins There are no gaps as the character is copied to the end of the string. Wherever this might be...."}, {"owner": {"reputation": 16624, "user_id": 237934, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Hshoa.png?s=128&g=1", "display_name": "kame", "link": "https://stackoverflow.com/users/237934/kame"}, "edited": false, "score": 0, "creation_date": 1567583321, "post_id": 57783246, "comment_id": 102001205, "body": "I can not understand the close vote. Can somebody explain this? I mean it is specific right?"}, {"owner": {"reputation": 362958, "user_id": 28169, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ec9385dc533f1a6a93769077f852503e?s=128&d=identicon&r=PG", "display_name": "unwind", "link": "https://stackoverflow.com/users/28169/unwind"}, "edited": false, "score": 1, "creation_date": 1567586994, "post_id": 57783246, "comment_id": 102003069, "body": "As a side note, printing the return value of <code>strlen()</code>, which is of type <code>size_t</code>, using <code>printf()</code> with <code>%d</code> (which expects <code>int</code>) leads to undefined behavior. Use <code>%zu</code>."}], "answers": [{"tags": [], "owner": {"reputation": 435637, "user_id": 367273, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/f1ed2b0c87f602ef30229f5c4b04eff6?s=128&d=identicon&r=PG", "display_name": "NPE", "link": "https://stackoverflow.com/users/367273/npe"}, "is_accepted": false, "score": 0, "last_activity_date": 1567581291, "creation_date": 1567581291, "answer_id": 57783271, "question_id": 57783246, "link": "https://stackoverflow.com/questions/57783246/for-loop-is-running-too-often/57783271#57783271", "title": "For loop is running too often", "body": "<p>The problem is that you're writing past the end of <code>stringarr2</code>.  This triggers <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behaviour</a>.</p>\n\n<p>To fix this, you need to allocate sufficient memory for <code>stringarr2</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "is_accepted": false, "score": 1, "last_activity_date": 1567582814, "creation_date": 1567582814, "answer_id": 57783633, "question_id": 57783246, "link": "https://stackoverflow.com/questions/57783246/for-loop-is-running-too-often/57783633#57783633", "title": "For loop is running too often", "body": "<p>Your code can run any number of times. You write beyond the end of <code>stringarr2</code> so you may be smashing the stack and overwriting local variables. What you meant to do is probably something like this:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n#include &lt;string.h&gt;\n\nint main(){\n\n  char stringarr1[] = \"a!bc\";\n  char stringarr2[10];\n  int len = strlen(stringarr1);\n\n  printf(\"%d\\n\", len);  // lenght --&gt; 4\n\n  for (size_t i = 0; i &lt; len; i++)  \n  {\n      printf(\"i: %d\\n\", i);\n      if (stringarr1[i] != '!') {\n        stringarr2[len] = stringarr1[i];\n        printf(\"info: != '!'\\n\");\n      }          \n  }\n}\n</code></pre>\n\n<p>Like others said, it is not really clear what you are trying to accomplish here. But in C, a declaration like <code>char s[] = \"string\"</code> only allocates enough memory to store whatever is on the right hand side of the assignment. If that is an empty string like in your case, only a single byte is allocated, to store the end of string 'null' character. You need to either explicitly specify, like I did, the number of bytes to allocate as the array size, or use dynamic memory allocation.</p>\n"}, {"tags": [], "owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "is_accepted": true, "score": 1, "last_activity_date": 1567586942, "last_edit_date": 1567586942, "creation_date": 1567582880, "answer_id": 57783646, "question_id": 57783246, "link": "https://stackoverflow.com/questions/57783246/for-loop-is-running-too-often/57783646#57783646", "title": "For loop is running too often", "body": "<p>You are overrunning the buffer for <code>stringarr2</code> (length 1), which is <em>in this case</em> corrupting the memory-adjacent <code>stringarr1</code>, causing the string length to change by overwriting its nul terminator.</p>\n\n<p>Then because you are reevaluating the string length on each iteration, the loop will run for a non-deterministic number of iterations - in your case just 6, but it could be worse; the behaviour you have observed is just one of several possibilities - it is <em>undefined</em>.</p>\n\n<p>Apart from correcting the buffer length for <code>stringarr2</code>, it is best practice to evaluate loop-invariants once (although in this case the string length is not invariant due to a bug).  So the following:</p>\n\n<pre><code>  const size_t length = strlen( stringarr1 ) ;\n  for( size_t i = 0; i &lt; length; i++ )\n  {\n      ...\n</code></pre>\n\n<p>will run for 4 iterations regardless of the buffer overrun bug because the length is not reevaluated following the corruption. Re-evaluating loop-invariants can lead to very slow code execution.</p>\n"}, {"tags": [], "owner": {"reputation": 481, "user_id": 6713871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6d0cf46b08a63241386786e74ae4b1f?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Rollins", "link": "https://stackoverflow.com/users/6713871/chris-rollins"}, "is_accepted": false, "score": 0, "last_activity_date": 1567583978, "creation_date": 1567583978, "answer_id": 57783942, "question_id": 57783246, "link": "https://stackoverflow.com/questions/57783246/for-loop-is-running-too-often/57783942#57783942", "title": "For loop is running too often", "body": "<p>First, we must allocate the string to be long enough.</p>\n\n<pre><code>char stringarr1[] = \"a!bc\";\n\n//save this in a variable beforehand because strlen loops over the string every time it is called\nsize_t len = strlen(stringarr1);  \n\nchar stringarr2[1024] = { 0 };\n</code></pre>\n\n<p>{ 0 } initializes all characters in the string to 0, which means the last one will always be a null terminator after we add characters. This tells C string functions where the string ends.</p>\n\n<p>Now we can put stuff in there. It seems like you're trying to append, so keep a separate iterator for the 2nd string. This is more efficient than calling strlen every loop.</p>\n\n<pre><code>for(size_t i = 0, j = 0; i &lt; len; i++){\n  printf(\"i: %d\\n\", i);\n  if (stringarr1[i] != '!') {\n    stringarr2[j++] = stringarr1[i];\n    printf(\"info: != '!'\\n\");\n  } \n}\n</code></pre>\n"}], "owner": {"reputation": 16624, "user_id": 237934, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Hshoa.png?s=128&g=1", "display_name": "kame", "link": "https://stackoverflow.com/users/237934/kame"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 57783646, "answer_count": 4, "score": 0, "last_activity_date": 1567586942, "creation_date": 1567581170, "last_edit_date": 1567583393, "question_id": 57783246, "link": "https://stackoverflow.com/questions/57783246/for-loop-is-running-too-often", "title": "For loop is running too often", "body": "<p>I have a for loop which should run 4 times but is running 6 times.\nCould you please explain the behaviour?\nThis is strange because stringarr1 is not changed.</p>\n\n<p>Edit: I want to remove all '!' from my first string and want to save the letters in a second string.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n#include &lt;string.h&gt;\n\nint main(){\n\n  char stringarr1[] = \"a!bc\";\n  char stringarr2[] = \"\";\n\n  printf(\"%d\\n\", strlen(stringarr1));  // lenght --&gt; 4\n\n  for (size_t i = 0; i &lt; strlen(stringarr1); i++)  \n  {\n      printf(\"i: %d\\n\", i);\n      if (stringarr1[i] != '!') {\n        stringarr2[strlen(stringarr2)] = stringarr1[i];\n        printf(\"info: != '!'\\n\");\n      }          \n  }\n}\n</code></pre>\n"}, {"tags": ["c", "signals", "posix"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1567581562, "post_id": 57783184, "comment_id": 102000388, "body": "Ctrl-C messes up terminal output. The program writes all it should write but the terminal driver cuts the line after Ctrl-C. Redirect to a file and you will see the full output."}, {"owner": {"reputation": 3381, "user_id": 3964654, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ITt1C.jpg?s=128&g=1", "display_name": "wingerse", "link": "https://stackoverflow.com/users/3964654/wingerse"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1567581945, "post_id": 57783184, "comment_id": 102000561, "body": "@n.m. Thanks that works! Where can I read more about this behavior?  And can you make it an answer so I can accept it?"}], "answers": [{"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": true, "score": 2, "last_activity_date": 1567583095, "creation_date": 1567583095, "answer_id": 57783693, "question_id": 57783184, "link": "https://stackoverflow.com/questions/57783184/partial-write-due-to-sigint/57783693#57783693", "title": "Partial write due to SIGINT", "body": "<p>Ctrl-C messes up terminal output. The program writes all it should write, but by default the terminal driver cuts the line after Ctrl-C. This is not under control of your program. The cut happens if the driver sees Ctrl-C in the middle of copying of the <em>complete</em> line buffer to the physical device. Input line buffer is also discarded. This pertains to other signal-generating characters as well.</p>\n\n<p>This is described rather briefly in the <code>stty(1)</code> and <code>termios(3)</code> manual pages.</p>\n\n<p>This behaviour can be disabled with <code>stty noflsh</code> command.</p>\n\n<p>You can also redirect to a file to see the complete output.</p>\n"}], "owner": {"reputation": 3381, "user_id": 3964654, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ITt1C.jpg?s=128&g=1", "display_name": "wingerse", "link": "https://stackoverflow.com/users/3964654/wingerse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 57783693, "answer_count": 1, "score": 1, "last_activity_date": 1567583095, "creation_date": 1567580869, "question_id": 57783184, "link": "https://stackoverflow.com/questions/57783184/partial-write-due-to-sigint", "title": "Partial write due to SIGINT", "body": "<p>I have a <code>write_full</code> which should write the buffer fully to standard output even if it was interrupted by a signal.<br>\nI have a loop which keep <code>write_full</code> a string until <code>quit</code> is changed by a signal handler. Here's the code:  </p>\n\n<pre><code>#include &lt;signal.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;errno.h&gt;\n\nvolatile sig_atomic_t quit = 0;\n\nvoid sigint_handler(int s)\n{\n    quit = 1;\n}\n\nint write_full(char *buf, size_t len)\n{\n    while (len &gt; 0) {\n        ssize_t written = write(STDOUT_FILENO, buf, len);\n        if (written == -1) {\n            if (errno == EINTR) { \n                continue; \n            }\n            return -1;\n        }\n        buf += written;\n        len -= (size_t)written;\n    }\n    return 0;\n}\n\nint main(void)\n{\n    struct sigaction act = {\n        .sa_handler = sigint_handler\n    };\n    sigaction(SIGINT, &amp;act, NULL);\n\n    while (!quit) {\n        write_full(\"loop\\n\", 5);\n    }\n\n    write_full(\"cleanup\", 7);\n\n    return 0;\n}\n</code></pre>\n\n<p>I expect the program to write the \"loop\" fully before printing \"cleanup\", but I see an output like this:</p>\n\n<blockquote>\n  <p>loop<br>\n    loop<br>\n    loop<br>\n    l^C<br>\n    cleanup  </p>\n</blockquote>\n\n<p>Why is this happening? I expect it to be something like this:</p>\n\n<blockquote>\n  <p>loop<br>\n    loop<br>\n    loop<br>\n    l^Coop<br>\n    cleanup  </p>\n</blockquote>\n\n<p>because the write_full should continue writing the \"oop\\n\" part even after the first write was a short write due to interrupt. I put a breakpoint at the signal handler and stepped and it seems like <code>write</code> is reporting that it has written 4 characters even when it only wrote \"l\" to the stdout. So instead of writing \"oop\\n\" next, it only writes \"\\n\".  </p>\n\n<pre><code>l^C\nProgram received signal SIGINT, Interrupt.\n\nBreakpoint 1, sigint_handler (s=2) at src/main.c:9\n9           quit = 1;\n(gdb) next\n10      }\n(gdb) next\nwrite_full (buf=0x4020a0 \"loop\\n\", len=5) at src/main.c:16\n16              if (written == -1) {\n(gdb) print written\n$1 = 4\n</code></pre>\n\n<p>Why is this happening? And how can I fix this? </p>\n"}, {"tags": ["c", "gcc", "struct", "initialization"], "comments": [{"owner": {"reputation": 12858, "user_id": 6752050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d5c4caa7ff50e6e492c3957ca20ef6c?s=128&d=identicon&r=PG&f=1", "display_name": "S.M.", "link": "https://stackoverflow.com/users/6752050/s-m"}, "edited": false, "score": 4, "creation_date": 1567580896, "post_id": 57783111, "comment_id": 102000038, "body": "<code>FILE* filePTR1;</code> and others. <code>_dfLOAD_DEFAULT_FILE01</code> requires a parameter, according to #define."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 12858, "user_id": 6752050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d5c4caa7ff50e6e492c3957ca20ef6c?s=128&d=identicon&r=PG&f=1", "display_name": "S.M.", "link": "https://stackoverflow.com/users/6752050/s-m"}, "edited": false, "score": 0, "creation_date": 1567581222, "post_id": 57783111, "comment_id": 102000200, "body": "@S.M. No, the macro does not need a parameter."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1567581573, "post_id": 57783111, "comment_id": 102000393, "body": "OP, please don&#39;t edit your code in a way that removes the whole problem you&#39;re asking about."}, {"owner": {"reputation": 75, "user_id": 10092523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4465a1cb8ee81de87c218066e3e958e0?s=128&d=identicon&r=PG&f=1", "display_name": "Aatif Shaikh", "link": "https://stackoverflow.com/users/10092523/aatif-shaikh"}, "edited": false, "score": 0, "creation_date": 1567581654, "post_id": 57783111, "comment_id": 102000432, "body": "thanks, my problem is resolved with this"}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 2, "last_activity_date": 1567581354, "creation_date": 1567581354, "answer_id": 57783284, "question_id": 57783111, "link": "https://stackoverflow.com/questions/57783111/warning-missing-braces-around-initializer-wmissing-braces-in-macro/57783284#57783284", "title": "warning: missing braces around initializer [-Wmissing-braces] (IN MACRO)", "body": "<p>The real problem is this part:</p>\n\n<pre><code>.filePTR1=-1\n</code></pre>\n\n<p><code>filePTR1</code> is declared as</p>\n\n<pre><code>FILE filePTR1;\n</code></pre>\n\n<p>and <code>FILE</code> is a struct type, so this is trying to initialize a struct without <code>{ }</code>. That's what the warning is about.</p>\n\n<p>You probably meant to use</p>\n\n<pre><code>FILE *filePTR1;\n</code></pre>\n\n<p>instead, making <code>filePTR1</code> a pointer.</p>\n\n<p>But note that <code>-1</code> is not a valid pointer value either.</p>\n"}], "owner": {"reputation": 75, "user_id": 10092523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4465a1cb8ee81de87c218066e3e958e0?s=128&d=identicon&r=PG&f=1", "display_name": "Aatif Shaikh", "link": "https://stackoverflow.com/users/10092523/aatif-shaikh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 411, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567581540, "creation_date": 1567580590, "last_edit_date": 1567581540, "question_id": 57783111, "link": "https://stackoverflow.com/questions/57783111/warning-missing-braces-around-initializer-wmissing-braces-in-macro", "title": "warning: missing braces around initializer [-Wmissing-braces] (IN MACRO)", "body": "<p>I'm trying to initialise the structure element with the default values using a macro. Unfortunately, I'm continuously getting a warning whose resolution I'm unable to find yet, can anyone help me to understand what exactly I'm doing wrong here?</p>\n\n<p>Note:</p>\n\n<ol>\n<li>I'm getting Warning at the time of initialisation.</li>\n<li>I've tried both macros but still not able to resolve </li>\n<li>compiling code with GCC compiler on Linux based operating system. </li>\n</ol>\n\n\n\n<pre><code>/******MACROS DEFINITION******/ /*headers.h*/\n\n#define  _dfLOAD_DEFAULT_FILE01 (stProcessFile_ALL){ .filePTR1=-1 , .fileBuff1=\"\\0\" , .fileName1 = \"temp1.txt\"}\n\n//#define  _dfLOAD_DEFAULT_FILE01 (stProcessFile_ALL){ .filePTR1=-1 , .fileBuff1={\"\\0\"} , .fileName1 = {\"temp1.txt\"}}\n\n\n/******STRUCTURE DEFINITION******/ /*headers.h*/\ntypedef struct\n  {\n\n    FILE filePTR1;\n    FILE filePTR2;\n    FILE filePTR3;\n\n    char fileBuff1[500];\n    char fileBuff2[500];\n    char fileBuff3[500];                                    \n\n    char *fileName1;\n    char *fileName2;\n    char *fileName3;                \n\n  }stProcessFile_ALL;\n\n\n/******STRUCTURE INIT******/\n\nvoid FnLaodDeFaultValue (uint8_t ucStrSelec)\n{\n\nstProcessFile_ALL stVarProcessFile_ALL;\nstVarProcessFile_ALL = _dfLOAD_DEFAULT_FILE01 ;\n\n}\n</code></pre>\n\n<p>COMPILER:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>gcc -Wall -o \"Main\" \"Main.c\" \"process.c\" \"-lwiringPi\" \"-pthread\"  (in directory: /home/pi/Desktop/CombinerCARD)\n\nIn file included from process.c:16:\n\nprocess.c: In function \u2018FnLaodDeFaultValue\u2019:\n\nheaders.h:65:34: warning: missing braces around initializer [-Wmissing-braces]\n\n#define  _dfLOAD_DEFAULT_FILE01 (stProcessFile_ALL){ .filePTR1=-1 , .fileBuff1=\"\\0\" , .fileName1 = \"temp1.txt\"}\n\nprocess.c:184:26: note: in expansion of macro \u2018_dfLOAD_DEFAULT_FILE01\u2019\n   stVarProcessFile_ALL = _dfLOAD_DEFAULT_FILE01 ;\n</code></pre>\n"}, {"tags": ["c", "linux-kernel", "scheduling"], "comments": [{"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 2, "creation_date": 1567591119, "post_id": 57782350, "comment_id": 102005425, "body": "&quot;It seems that it would be reasonable to execute the <code>prepare_to_wait</code> function only when the <code>condition</code> is satisfied.&quot; - No one prevents you from checking the <code>condition</code> before the function&#39;s call. But you still need to check the condition after the call, otherwise (due to race) you risk to put the process on a sleep with condition being true. (Usually <code>condition</code> is treated as the condition <b>for which we wait</b>, so <code>schedule()</code> is called only when the condition is false)."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1567594459, "post_id": 57782350, "comment_id": 102007103, "body": "Indeed, the <code>wait_event</code> family check the condition first and only put the task on the wait queue if the condition is false."}], "owner": {"reputation": 1077, "user_id": 4460514, "user_type": "registered", "accept_rate": 35, "profile_image": "https://i.stack.imgur.com/aE5kE.jpg?s=128&g=1", "display_name": "ruach", "link": "https://stackoverflow.com/users/4460514/ruach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 161, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567587469, "creation_date": 1567577064, "last_edit_date": 1567587469, "question_id": 57782350, "link": "https://stackoverflow.com/questions/57782350/what-is-the-design-choice-behind-prepare-to-wait-and-finish-wait", "title": "What is the design choice behind prepare_to_wait and finish_wait", "body": "<p>As far as I know, In Linux, a kernel process should invoke prepare_to_wait like functions before calling the schedule() function to yield processor to others, which add itself to the waiting queue. And later, when a scheduler picks the process, it can continue its execution and invoke finish_wait function to remove itself from the waiting queue. </p>\n\n<p>These two functions are usually utilized as below</p>\n\n<pre><code>prepare_to_wait(&amp;wq, &amp;__wait, TASK_INTERRUPTIBLE);\nif (condition) \n    schedule();\nfinish_wait(&amp;wq, &amp;__wait);\n</code></pre>\n\n<p>However, when the condition is not satisfied, it turns out that the process wastes its priceless CPU resource for putting itself to the waiting list and set the status, which of course involves costly spinlock. It seems that it would be reasonable to execute the prepare_to_wait function only when the condition is satisfied.</p>\n\n<p>Or another alternative would be making the scheduler push the process into the waiting list and removing it when it invokes schedule function and return from the schedule function respectively. Why the kernel programmer has determined this way to make the programmer should invoke the combination of prepare_to_wait and finish_wait functions?</p>\n"}, {"tags": ["c", "raspberry-pi", "arm", "gdb", "qemu"], "comments": [{"owner": {"reputation": 3587, "user_id": 4915707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ubv91.jpg?s=128&g=1", "display_name": "Alexander Ushakov", "link": "https://stackoverflow.com/users/4915707/alexander-ushakov"}, "edited": false, "score": 0, "creation_date": 1567577262, "post_id": 57782096, "comment_id": 101998592, "body": "As I understand __end already contains address of the end of the section as integer and it isn\u2019t a variable at this address. Why do you try to get address of this address? Try to convert it directly to pointer: <code>arena = (int32_t*)__end;</code>"}, {"owner": {"reputation": 856, "user_id": 4250150, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-KLzePzmbqTs/AAAAAAAAAAI/AAAAAAAAAD8/henWhVuLqE4/photo.jpg?sz=128", "display_name": "sudo rm -rf slash", "link": "https://stackoverflow.com/users/4250150/sudo-rm-rf-slash"}, "reply_to_user": {"reputation": 3587, "user_id": 4915707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ubv91.jpg?s=128&g=1", "display_name": "Alexander Ushakov", "link": "https://stackoverflow.com/users/4915707/alexander-ushakov"}, "edited": false, "score": 0, "creation_date": 1567577952, "post_id": 57782096, "comment_id": 101998866, "body": "@AlexanderUshakov I gave that a shot despite the tutorial&#39;s using <code>&amp;__end</code>.  The <code>0!=</code> assert succeeds, but the next assert fails.  In GDB, I see that the value assigned to arena is very large and crucially not the same as <code>p &amp;__end</code> ... the smaller value seems right to me as it is close to the 0x8000 where the program begins"}, {"owner": {"reputation": 1701, "user_id": 5836577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/931236857b09c3b0aea0f29fb5a23cbc?s=128&d=identicon&r=PG&f=1", "display_name": "Guillaume Petitjean", "link": "https://stackoverflow.com/users/5836577/guillaume-petitjean"}, "reply_to_user": {"reputation": 3587, "user_id": 4915707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ubv91.jpg?s=128&g=1", "display_name": "Alexander Ushakov", "link": "https://stackoverflow.com/users/4915707/alexander-ushakov"}, "edited": false, "score": 1, "creation_date": 1567579929, "post_id": 57782096, "comment_id": 101999648, "body": "@AlexanderUshakov <code>__end</code>is a special symbol generated by the linker script. Only its address has a meaning. So the OP is correct to access the end address it needs through <code>&amp;__end</code>"}, {"owner": {"reputation": 1701, "user_id": 5836577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/931236857b09c3b0aea0f29fb5a23cbc?s=128&d=identicon&r=PG&f=1", "display_name": "Guillaume Petitjean", "link": "https://stackoverflow.com/users/5836577/guillaume-petitjean"}, "edited": false, "score": 0, "creation_date": 1567580089, "post_id": 57782096, "comment_id": 101999716, "body": "&quot;I suppose this could be a compiler bug? &quot; It&#39;s really the last hypothesis to consider :) Compiler bugs are not impossible but they are really rare."}, {"owner": {"reputation": 1701, "user_id": 5836577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/931236857b09c3b0aea0f29fb5a23cbc?s=128&d=identicon&r=PG&f=1", "display_name": "Guillaume Petitjean", "link": "https://stackoverflow.com/users/5836577/guillaume-petitjean"}, "edited": false, "score": 0, "creation_date": 1567580140, "post_id": 57782096, "comment_id": 101999730, "body": "Did you try a local variable <code>void *arena = (void *)&amp;__end;</code>  This is how I am doing in my code and it works."}, {"owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 0, "creation_date": 1567588344, "post_id": 57782096, "comment_id": 102003815, "body": "What do you mean by &quot;I am not able to assign &amp;__end to a local variable&quot;? How did you try this and what compiler errors or results do you get?"}, {"owner": {"reputation": 5487, "user_id": 4499941, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Wb0uIu6LiPk/AAAAAAAAAAI/AAAAAAAAABI/HOVGfYywvPE/photo.jpg?sz=128", "display_name": "Peter Maydell", "link": "https://stackoverflow.com/users/4499941/peter-maydell"}, "edited": false, "score": 1, "creation_date": 1567596822, "post_id": 57782096, "comment_id": 102008306, "body": "The assembler docs answer your side question about .align: for arm, the .align argument is the number of low-order zero bits which must be 0, so &quot;.align 2&quot; means &quot;align to multiple of 4 bytes&quot;  -- <a href=\"https://sourceware.org/binutils/docs/as/Align.html#Align\" rel=\"nofollow noreferrer\">sourceware.org/binutils/docs/as/Align.html#Align</a>"}, {"owner": {"reputation": 856, "user_id": 4250150, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-KLzePzmbqTs/AAAAAAAAAAI/AAAAAAAAAD8/henWhVuLqE4/photo.jpg?sz=128", "display_name": "sudo rm -rf slash", "link": "https://stackoverflow.com/users/4250150/sudo-rm-rf-slash"}, "reply_to_user": {"reputation": 1701, "user_id": 5836577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/931236857b09c3b0aea0f29fb5a23cbc?s=128&d=identicon&r=PG&f=1", "display_name": "Guillaume Petitjean", "link": "https://stackoverflow.com/users/5836577/guillaume-petitjean"}, "edited": false, "score": 0, "creation_date": 1567608475, "post_id": 57782096, "comment_id": 102015014, "body": "@GuillaumePetitjean @thebusybee I updated the question to expand on using a local variable. TLDR the assignment happens, but it assigns 0... even though <code>&amp;__end</code> has a non-zero address."}, {"owner": {"reputation": 1701, "user_id": 5836577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/931236857b09c3b0aea0f29fb5a23cbc?s=128&d=identicon&r=PG&f=1", "display_name": "Guillaume Petitjean", "link": "https://stackoverflow.com/users/5836577/guillaume-petitjean"}, "edited": false, "score": 0, "creation_date": 1567609510, "post_id": 57782096, "comment_id": 102015609, "body": "Could you have a look to the stack pointer when entering init function ?"}, {"owner": {"reputation": 856, "user_id": 4250150, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-KLzePzmbqTs/AAAAAAAAAAI/AAAAAAAAAD8/henWhVuLqE4/photo.jpg?sz=128", "display_name": "sudo rm -rf slash", "link": "https://stackoverflow.com/users/4250150/sudo-rm-rf-slash"}, "reply_to_user": {"reputation": 1701, "user_id": 5836577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/931236857b09c3b0aea0f29fb5a23cbc?s=128&d=identicon&r=PG&f=1", "display_name": "Guillaume Petitjean", "link": "https://stackoverflow.com/users/5836577/guillaume-petitjean"}, "edited": false, "score": 0, "creation_date": 1567610494, "post_id": 57782096, "comment_id": 102016156, "body": "@GuillaumePetitjean <code>info registers</code> says that <code>sp</code> is <code>0x7fd8</code> ... seems reasonable... growing down from the kernel?"}, {"owner": {"reputation": 18888, "user_id": 1880339, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/0PkGx.png?s=128&g=1", "display_name": "artless noise", "link": "https://stackoverflow.com/users/1880339/artless-noise"}, "edited": false, "score": 0, "creation_date": 1567612940, "post_id": 57782096, "comment_id": 102017471, "body": "In the gnu ld manual they usually use <code>extern char</code>.  Some CPUs have issue loading non-aligned addresses.  You have no alignment constraints in your linker file so it is possible that a linker decided that <code>arena = &amp;__end;</code> with &#39;ints&#39; doesn&#39;t work but <code>void*</code> would.  Also, you can add an <code>ALIGN</code> to your output section specifiers and then it will probably work properly.  Your aligns don&#39;t have to be a page size.  Just ALIGN(4) will probably be enough.  It is a good idea to do this anyways if you have a cache like the RPi."}], "answers": [{"comments": [{"owner": {"reputation": 856, "user_id": 4250150, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-KLzePzmbqTs/AAAAAAAAAAI/AAAAAAAAAD8/henWhVuLqE4/photo.jpg?sz=128", "display_name": "sudo rm -rf slash", "link": "https://stackoverflow.com/users/4250150/sudo-rm-rf-slash"}, "edited": false, "score": 0, "creation_date": 1567614574, "post_id": 57792361, "comment_id": 102018240, "body": "thank you especially for including the tools and thought process in chasing down the bug"}, {"owner": {"reputation": 1701, "user_id": 5836577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/931236857b09c3b0aea0f29fb5a23cbc?s=128&d=identicon&r=PG&f=1", "display_name": "Guillaume Petitjean", "link": "https://stackoverflow.com/users/5836577/guillaume-petitjean"}, "edited": false, "score": 0, "creation_date": 1567667542, "post_id": 57792361, "comment_id": 102032582, "body": "&quot;Oh, and the reason GDB was printing the right value for __end when your code wasn&#39;t was that GDB could just look directly in the debug/symbol info in the ELF file for the answer&quot; Kinda tricky ! Thank you"}], "tags": [], "owner": {"reputation": 5487, "user_id": 4499941, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Wb0uIu6LiPk/AAAAAAAAAAI/AAAAAAAAABI/HOVGfYywvPE/photo.jpg?sz=128", "display_name": "Peter Maydell", "link": "https://stackoverflow.com/users/4499941/peter-maydell"}, "is_accepted": true, "score": 2, "last_activity_date": 1567616315, "last_edit_date": 1567616315, "creation_date": 1567613928, "answer_id": 57792361, "question_id": 57782096, "link": "https://stackoverflow.com/questions/57782096/cannot-assign-address-of-variable-defined-in-linker-script/57792361#57792361", "title": "Cannot assign address of variable defined in linker script", "body": "<p>The problem you're having here is because the \"clear the BSS\" loop in boot.S is also clearing some of the compiler-generated data in the ELF file that the C code is using at runtime. Notably, it is accidentally zeroing out the GOT (global offset table) which is in the .got ELF section and which is where the actual address of the __end label has been placed by the linker. So the linker correctly fills in the address in the ELF file, but then the boot.S code zeroes it, and when you try to read it from C then you get zero rather than what you were expecting.</p>\n\n<p>Adding all that alignment in the linker script is probably working around this by coincidentally causing the GOT to not be in the area that gets zeroed.</p>\n\n<p>You can see where the linker has put things by using 'objdump -x myos.elf'. In my test case based on the tutorial you link I see a SYMBOL TABLE which includes among other entries:</p>\n\n<pre><code>000080d4 l       .bss   00000004 arena\n00000000 l    df *ABS*  00000000 \n000080c8 l     O .got.plt       00000000 _GLOBAL_OFFSET_TABLE_\n000080d8 g       .bss   00000000 __bss_end\n0000800c g     F .text  00000060 kernel_main\n00008000 g       .text  00000000 __start\n0000806c g       .text.boot     00000000 _start\n000080d8 g       .bss   00000000 __end\n00008000 g     F .text  0000000c panic\n000080c4 g       .text.boot     00000000 __bss_start\n</code></pre>\n\n<p>So you can see that the linker script has set __bss_start to 0x80c4 and __bss_end to 0x80d8, which is a pity because the GOT is at 0x80c4/0x80c8. I think what has happened here is that because you didn't specify explicitly in your linker script where to put the .got and .got.plt sections, the linker has decided to put them after the __bss_start assignment and before the .bss section, so they get covered by the zeroing code.</p>\n\n<p>You can see what the ELF file contents of the .got are with 'objdump --disassemble-all myos.elf', which among other things includes:</p>\n\n<pre><code>Disassembly of section .got:\n\n000080c4 &lt;.got&gt;:\n    80c4:       000080d8        ldrdeq  r8, [r0], -r8   ; &lt;UNPREDICTABLE&gt;\n</code></pre>\n\n<p>so you can see we have one GOT table entry, whose contents are the address 0x80d8 which is the __end value we want. When the boot.S code zeroes this out your C code reads a 0 rather than the constant it was expecting.</p>\n\n<p>You should probably ensure that the bss start/end are at least 16-aligned, because the boot.S code works via a loop that clears 16 bytes at a time, but I think that if you fix your linker script to explicitly put the .got and .got.plt sections somewhere then you'll find you don't need the 4K alignments everywhere.</p>\n\n<p>FWIW, I diagnosed this using: (1) the QEMU \"-d in_asm,cpu,exec,int,unimp,guest_errors -singlestep\" options to get a dump of register state and instruction execution and (2) objdump of the ELF file to figure out what the compiler's generated code was actually doing. I had a suspicion this was going to turn out to be either \"accidentally zeroed data we shouldn't have\" or \"failed to include in the image or otherwise initialize data we should have\" kind of bug, and so it turned out.</p>\n\n<p>Oh, and the reason GDB was printing the right value for __end when your code wasn't was that GDB could just look directly in the debug/symbol info in the ELF file for the answer; it wasn't doing it by going via the in-memory GOT.</p>\n"}], "owner": {"reputation": 856, "user_id": 4250150, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-KLzePzmbqTs/AAAAAAAAAAI/AAAAAAAAAD8/henWhVuLqE4/photo.jpg?sz=128", "display_name": "sudo rm -rf slash", "link": "https://stackoverflow.com/users/4250150/sudo-rm-rf-slash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 57792361, "answer_count": 1, "score": 2, "last_activity_date": 1567616315, "creation_date": 1567575598, "last_edit_date": 1567611225, "question_id": 57782096, "link": "https://stackoverflow.com/questions/57782096/cannot-assign-address-of-variable-defined-in-linker-script", "title": "Cannot assign address of variable defined in linker script", "body": "<p>I found a solution, although I don't understand what went wrong.  Here is the original question.  The solution is at the end.</p>\n\n<hr>\n\n<p>I am following this <a href=\"https://jsandler18.github.io\" rel=\"nofollow noreferrer\">Raspberry PI OS tutorial</a> with a few tweaks.  As the title says, one assignment appears to fail.</p>\n\n<p>Here is my C code:</p>\n\n<pre><code>extern int32_t __end;\nstatic int32_t *arena;\n\nvoid init() {\n    arena = &amp;__end;\n    assert(0 != arena); // fails\n    ...\n</code></pre>\n\n<p>The assert triggers!  Surely the address shouldn't be 0.  <code>__end</code> is declared in my linker script:</p>\n\n<pre><code>ENTRY(_start)\n\nSECTIONS\n{\n    /* Starts at LOADER_ADDR. 0x8000 is a convention. */\n    . = 0x8000;\n    __start = .;\n    .text : {\n        *(.text)\n    }\n    .rodata : { *(.rodata) }\n    .data : { *(.data) }\n    /* Define __bss_start and __bss_end for boot.s to set to 0 */\n    __bss_start=.;\n    .bss : { *(.bss) }\n    __bss_end=.;\n    /* First usable address for the allocator */\n    . = ALIGN(4);\n    __end = .;\n}\n</code></pre>\n\n<p>Investigating in GDB (running it in QEMU):</p>\n\n<pre><code>Thread 1 hit Breakpoint 1, init () at os.c:75\n75      arena = &amp;__end;\n(gdb) p &amp;__end\n$1 = (int32_t *) 0x9440\n(gdb) p arena\n$2 = (int32_t *) 0x0\n(gdb) n\n76      assert(0 != arena);\n(gdb) p arena\n$3 = (int32_t *) 0x0\n</code></pre>\n\n<p>GDB can find <code>__end</code> but my program cannot?</p>\n\n<p>Here are a few other things I tried:</p>\n\n<ul>\n<li>the tutorial's code works without an issue (implying that QEMU and the ARM compiler are working)</li>\n<li>the assertion still fails when running without GDB (implying GDB is not the issue)</li>\n<li>I am able to assign <code>0xccc</code> to <code>arena</code> (implying arena is not the issue)</li>\n<li>I am not able to assign <code>&amp;__end</code> to a local variable (implying <code>&amp;__end</code> is the issue).</li>\n</ul>\n\n<p>As requested in the comments, this is how I tried to assign to a local variable:</p>\n\n<pre><code>void* arena2 = (void*)&amp;__end;\nassert(0 != arena2);\n</code></pre>\n\n<p>The assertion fails.  In GDB:</p>\n\n<pre><code>Thread 1 hit Breakpoint 1, mem_init () at mem.c:77\n77      void* arena2 = (void*)&amp;__end;\n(gdb) p arena2\n$1 = (void *) 0x13\n(gdb) p &amp;__end\n$2 = (int32_t *) 0x94a4\n(gdb) n\n78      assert(0 != arena2);\n(gdb) p arena2\n$3 = (void *) 0x0\n(gdb) p &amp;__end\n$4 = (int32_t *) 0x94a4\n</code></pre>\n\n<ul>\n<li><code>assert(0 != &amp;__end);</code> succeeds (implying <code>&amp;__end</code> is not the issue?)</li>\n</ul>\n\n<p>N.B. This version of <code>assert</code> is not the same as the one in <code>assert.h</code>, but I don't think it causes the problem. It just checks a condition, prints the condition, and goes to a breakpoint.  I can reproduce the issue in GDB with the assert commented out.</p>\n\n<p>N.B.2. I previously included the ARM assembly of the C code in case there was a compiler bug</p>\n\n<hr>\n\n<p>My solution is to edit the linker script to:</p>\n\n<pre><code>ENTRY(_start)\n\nSECTIONS\n{\n    /* Starts at LOADER_ADDR. 0x8000 is a convention. */\n    . = 0x8000;\n    __start = .;\n    .text : {\n        *(.text)\n    }\n    . = ALIGN(4096);\n    .rodata : { *(.rodata) }\n    . = ALIGN(4096);\n    .data : { *(.data) }\n    . = ALIGN(4096);\n    /* Define __bss_start and __bss_end for boot.s to set to 0 */\n    __bss_start = .;\n    .bss : { *(.bss) }\n    . = ALIGN(4096);\n    __bss_end = .;\n    /* First usable address for the allocator */\n    . = ALIGN(4096);\n    __end = .;\n}\n</code></pre>\n\n<p>I don't understand why the additional <code>ALIGN</code>s are important.</p>\n"}, {"tags": ["c", "arrays", "multidimensional-array", "return"], "comments": [{"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1567575884, "post_id": 57781843, "comment_id": 101998148, "body": "There is no &quot;new&quot; variable <code>average</code>. In the outer for loop you just reuse the same variable <code>average</code>."}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 12017379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2328b5415c446ac83fbe1efafa74a002?s=128&d=identicon&r=PG&f=1", "display_name": "lcmting17", "link": "https://stackoverflow.com/users/12017379/lcmting17"}, "edited": false, "score": 0, "creation_date": 1567574984, "post_id": 57781900, "comment_id": 101997906, "body": "It might be that I&#39;m mixing things up and I&#39;m reading &quot;average = 0&quot; as declaring a variable named average instead of setting a starting point for average to begin within the loops (...right?), like you said. I&#39;m not very familiar with C, but I&#39;ve used it in the past so I might just be complicating things since it&#39;s been a while.  I also understand that average is then being edited in place, but how is it/where is it that the new value of average is being &#39;saved&#39; to then act as the new starting value for the following iteration?"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 2, "creation_date": 1567575973, "post_id": 57781900, "comment_id": 101998175, "body": "<code>average = 0</code> does not declare the variable. It just puts <code>0</code> into the variable which has been declared here: <code>float average;</code>"}, {"owner": {"reputation": 1101, "user_id": 3936601, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3b55dba01070e7c3a4ee30b401d084d8?s=128&d=identicon&r=PG", "display_name": "Evan Benn", "link": "https://stackoverflow.com/users/3936601/evan-benn"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 1, "creation_date": 1567576923, "post_id": 57781900, "comment_id": 101998472, "body": "@Jabberwocky has it correct, in C, declarations start with a type: <code>float average;</code>. The other mentions of <code>average</code> in your example all refer to this same variable."}], "tags": [], "owner": {"reputation": 1101, "user_id": 3936601, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3b55dba01070e7c3a4ee30b401d084d8?s=128&d=identicon&r=PG", "display_name": "Evan Benn", "link": "https://stackoverflow.com/users/3936601/evan-benn"}, "is_accepted": true, "score": 4, "last_activity_date": 1567577006, "last_edit_date": 1567577006, "creation_date": 1567574307, "answer_id": 57781900, "question_id": 57781843, "link": "https://stackoverflow.com/questions/57781843/why-do-i-not-have-to-return-average-each-time-before-proceeding-to-run-through/57781900#57781900", "title": "Why do I not have to return &quot;average&quot; each time before proceeding to run through the loop again?", "body": "<p>I believe you may be getting your loops mixed up. See that the first loop, (for i) first sets average = 0, and then executes the second loop.</p>\n\n<p>The second loop (for j) adds several values to average, not caring what the starting value is; average is being edited IN PLACE. (<code>average +=</code> means go find where average lives and change it).  </p>\n\n<pre><code>for (i = 0; i &lt; 2; i++) {\n|        average = 0;\n|\n|        for (j = 0; j &lt; 5; j++) {\n|        |    average += grades[i][j];\n|        |  }\n|\n|        average /= 5.0;\n|        printf(\"The average marks obtained in subject %d is: %.2f\\n\", i, average);\n|    }\n</code></pre>\n\n<p>The second loop doesn't care what average was before, and doesn't care that it is inside the first loop. It may help you to follow the code stepping in a debugger.</p>\n\n<p>Maybe it would also help to note that 'average' is DECLARED way up at the start of main. In other languages <code>average = 0</code> can declare a variable average, but not in C. We need the 'float' or other type to declare a new variable. All mentions of average in your code are referring to the same object - the average declared at the start of main.</p>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 12017379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2328b5415c446ac83fbe1efafa74a002?s=128&d=identicon&r=PG&f=1", "display_name": "lcmting17", "link": "https://stackoverflow.com/users/12017379/lcmting17"}, "edited": false, "score": 0, "creation_date": 1567600780, "post_id": 57783310, "comment_id": 102010460, "body": "thank you for the help everyone, I understand it now. I&#39;m definitely reading too far into certain things only to complicate them but it makes sense now."}, {"owner": {"reputation": 123, "user_id": 1578569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dx4sp.png?s=128&g=1", "display_name": "HaeschenaufGras", "link": "https://stackoverflow.com/users/1578569/haeschenaufgras"}, "reply_to_user": {"reputation": 45, "user_id": 12017379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2328b5415c446ac83fbe1efafa74a002?s=128&d=identicon&r=PG&f=1", "display_name": "lcmting17", "link": "https://stackoverflow.com/users/12017379/lcmting17"}, "edited": false, "score": 0, "creation_date": 1567660335, "post_id": 57783310, "comment_id": 102030087, "body": "Cool, please remember to mark the question as answered so other users can also profit :-)"}, {"owner": {"reputation": 45, "user_id": 12017379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2328b5415c446ac83fbe1efafa74a002?s=128&d=identicon&r=PG&f=1", "display_name": "lcmting17", "link": "https://stackoverflow.com/users/12017379/lcmting17"}, "edited": false, "score": 0, "creation_date": 1567776278, "post_id": 57783310, "comment_id": 102075898, "body": "Hey sorry about that! I tried to mark it as answered on my computer but it wouldn\u2019t change the check mark to green so I didn\u2019t know if it had gone through or not. I just did it on my phone, though, so hopefully it worked properly :)"}], "tags": [], "owner": {"reputation": 123, "user_id": 1578569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dx4sp.png?s=128&g=1", "display_name": "HaeschenaufGras", "link": "https://stackoverflow.com/users/1578569/haeschenaufgras"}, "is_accepted": false, "score": 1, "last_activity_date": 1567581477, "creation_date": 1567581477, "answer_id": 57783310, "question_id": 57781843, "link": "https://stackoverflow.com/questions/57781843/why-do-i-not-have-to-return-average-each-time-before-proceeding-to-run-through/57783310#57783310", "title": "Why do I not have to return &quot;average&quot; each time before proceeding to run through the loop again?", "body": "<p>Additionally the outer <code>for</code> sets the average value in each iteration to 0 again but the internal <code>for</code> iterates over one \"line\" of your array until it jumps out to the outer loop again.\nAs suggested by <a href=\"https://stackoverflow.com/users/3936601/evan-benn\">Evan Benn</a> you should check the execution step-wise.</p>\n\n<p>You will more or less see these values getting stored in <code>average</code></p>\n\n<pre><code>//startup skipped\nentering outer for i=0\n    average = 0\n        entering inner for j=0\n              average = 0 + 80\n        j = 1\n              average = 80 + 70\n        ... j = 2,3,4\n              average = 150 + 85 + 89 + 90\n        exiting inner loop, average is now\n        average = 414\nnow code enters the outer for loop with i = 1\n      average = 0 &lt;-- here the outer for loop is resetting the value to 0 again\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 12017379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2328b5415c446ac83fbe1efafa74a002?s=128&d=identicon&r=PG&f=1", "display_name": "lcmting17", "link": "https://stackoverflow.com/users/12017379/lcmting17"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 57781900, "answer_count": 2, "score": 0, "last_activity_date": 1567581477, "creation_date": 1567573881, "last_edit_date": 1567575770, "question_id": 57781843, "link": "https://stackoverflow.com/questions/57781843/why-do-i-not-have-to-return-average-each-time-before-proceeding-to-run-through", "title": "Why do I not have to return &quot;average&quot; each time before proceeding to run through the loop again?", "body": "<p>I am learning C and currently looking at multidimensional arrays, and I do not understand why I don't need to return the value of \"average\" before proceeding through the loop again with the <em>new</em> average that is made through each iteration. </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    int grades[2][5];\n    float average;\n    int i;\n    int j;\n\n    grades[0][0] = 80;\n    grades[0][1] = 70;\n    grades[0][2] = 65;\n    grades[0][3] = 89;\n    grades[0][4] = 90;\n\n    grades[1][0] = 85;\n    grades[1][1] = 80;\n    grades[1][2] = 80;\n    grades[1][3] = 82;\n    grades[1][4] = 87;\n\n    for (i = 0; i &lt; 2; i++) {\n        average = 0;\n\n        for (j = 0; j &lt; 5; j++) {\n            average += grades[i][j];\n        }\n\n        average /= 5.0;\n        printf(\"The average marks obtained in subject %d is: %.2f\\n\", i, average);\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>In the second for loop, it starts by using <code>average = 0</code> which I understand, but as it goes through the iterations and <code>average</code> starts to increase (0+80, 80 + 70, 150 + 65, etc...), why do I not need to return this new average value and how does the program know to use this <em>new</em> value of average the next time it goes through the loop? </p>\n\n<p>Why does it not just keep using <code>average = 0</code> for each iteration?</p>\n"}, {"tags": ["c", "security", "exploit", "format-string"], "comments": [{"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 2, "creation_date": 1567572232, "post_id": 57781548, "comment_id": 101997289, "body": "<a href=\"https://en.wikipedia.org/wiki/Call_stack#FRAME-POINTER\" rel=\"nofollow noreferrer\">Frame pointer</a>."}, {"owner": {"reputation": 4703, "user_id": 5375464, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3292ca87ff6c766b75dbe4b2ea0831da?s=128&d=identicon&r=PG&f=1", "display_name": "J...S", "link": "https://stackoverflow.com/users/5375464/j-s"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1567576834, "post_id": 57781548, "comment_id": 101998439, "body": "@user3386109 Can we somehow relate the old to new architectures? If that&#39;s what is different?"}], "answers": [{"comments": [{"owner": {"reputation": 4703, "user_id": 5375464, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3292ca87ff6c766b75dbe4b2ea0831da?s=128&d=identicon&r=PG&f=1", "display_name": "J...S", "link": "https://stackoverflow.com/users/5375464/j-s"}, "edited": false, "score": 0, "creation_date": 1567662245, "post_id": 57783374, "comment_id": 102030620, "body": "I&#39;m a novice at architecture concepts. How were you able to figure out that I was using a 64-bit architecture machine from the addresses printed with <code>%p</code>?"}, {"owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 1, "creation_date": 1567662327, "post_id": 57783374, "comment_id": 102030653, "body": "I find it a bit strange that the arguments to <code>snprintf()</code> are push right-to-left. If more arguments would have been given they would appear between &quot;Format&quot; and &quot;Variable x&quot; by that behaviour. But why does <code>snprintf()</code> read &quot;Buffer&quot; and following? That does not match. I suspect here an error by the author."}, {"owner": {"reputation": 215710, "user_id": 134633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6be45ddcfd038ba5e1e5fca319c7fa?s=128&d=identicon&r=PG", "display_name": "caf", "link": "https://stackoverflow.com/users/134633/caf"}, "reply_to_user": {"reputation": 4703, "user_id": 5375464, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3292ca87ff6c766b75dbe4b2ea0831da?s=128&d=identicon&r=PG&f=1", "display_name": "J...S", "link": "https://stackoverflow.com/users/5375464/j-s"}, "edited": false, "score": 1, "creation_date": 1567662441, "post_id": 57783374, "comment_id": 102030689, "body": "@J...S: Because the pointer value printed has more than 32 bits (and I also recognise it as being in the typical range of stack addresses on Linux x86-64)."}, {"owner": {"reputation": 215710, "user_id": 134633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6be45ddcfd038ba5e1e5fca319c7fa?s=128&d=identicon&r=PG", "display_name": "caf", "link": "https://stackoverflow.com/users/134633/caf"}, "reply_to_user": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 1, "creation_date": 1567662676, "post_id": 57783374, "comment_id": 102030762, "body": "@thebusybee: Pushing arguments right-to-left is very common.  This means you can access all the arguments in a varargs function without having to know how many of them there are (because the first argument is always at a known offset from the stack pointer on function entry, just after the return address)."}, {"owner": {"reputation": 215710, "user_id": 134633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6be45ddcfd038ba5e1e5fca319c7fa?s=128&d=identicon&r=PG", "display_name": "caf", "link": "https://stackoverflow.com/users/134633/caf"}, "reply_to_user": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 1, "creation_date": 1567663061, "post_id": 57783374, "comment_id": 102030872, "body": "@thebusybee: <a href=\"https://godbolt.org/z/So964V\" rel=\"nofollow noreferrer\">This example</a> demonstrates pretty clearly right-to-left pushing of arguments."}, {"owner": {"reputation": 4703, "user_id": 5375464, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3292ca87ff6c766b75dbe4b2ea0831da?s=128&d=identicon&r=PG&f=1", "display_name": "J...S", "link": "https://stackoverflow.com/users/5375464/j-s"}, "reply_to_user": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 0, "creation_date": 1567664304, "post_id": 57783374, "comment_id": 102031295, "body": "@thebusybee Why did you delete your answer? The two answers complemented each other. And I didn&#39;t even get to see the reply to my comment."}, {"owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 0, "creation_date": 1567664959, "post_id": 57783374, "comment_id": 102031521, "body": "Again you&#39;re right! I should have thought a moment longer before commenting, and answering. ;-)"}, {"owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "reply_to_user": {"reputation": 4703, "user_id": 5375464, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3292ca87ff6c766b75dbe4b2ea0831da?s=128&d=identicon&r=PG&f=1", "display_name": "J...S", "link": "https://stackoverflow.com/users/5375464/j-s"}, "edited": false, "score": 0, "creation_date": 1567665525, "post_id": 57783374, "comment_id": 102031722, "body": "@J...S The longer I looked at it the worse it seemed. In contrary this answer has all the bits right. As caf notes the example depends on <i>undefined behaviour</i> and so you don&#39;t see the value of <code>x</code> printed in the buffer when arguments are passed in registers. I just tried a lot without good results; but my system here at work (to which I have to return right now) is Win10 with MinGW64. If you&#39;re curious about the inner workings I&#39;d recommend to go to the URL caf wrote in a comment, look at the assembly code, and experiment. You can do this on your machine, too, by passing <code>-S</code> to GCC."}, {"owner": {"reputation": 4703, "user_id": 5375464, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3292ca87ff6c766b75dbe4b2ea0831da?s=128&d=identicon&r=PG&f=1", "display_name": "J...S", "link": "https://stackoverflow.com/users/5375464/j-s"}, "reply_to_user": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 0, "creation_date": 1567677015, "post_id": 57783374, "comment_id": 102037396, "body": "@thebusybee Yeah, I now used gcc with <code>-S</code> (and <code>-m32</code>). Thanks."}, {"owner": {"reputation": 4703, "user_id": 5375464, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3292ca87ff6c766b75dbe4b2ea0831da?s=128&d=identicon&r=PG&f=1", "display_name": "J...S", "link": "https://stackoverflow.com/users/5375464/j-s"}, "edited": false, "score": 0, "creation_date": 1567677278, "post_id": 57783374, "comment_id": 102037542, "body": "@caf Thanks for the assembly code. In it, a value is subtracted from <code>esp</code> before pushing the arguments of <code>foo()</code>. At first I figured it was to modify the stack pointer after pushing return address or something but the value that is added (back?) to <code>esp</code> after <code>call foo</code> is different. Any idea why it is so?"}, {"owner": {"reputation": 215710, "user_id": 134633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6be45ddcfd038ba5e1e5fca319c7fa?s=128&d=identicon&r=PG", "display_name": "caf", "link": "https://stackoverflow.com/users/134633/caf"}, "reply_to_user": {"reputation": 4703, "user_id": 5375464, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3292ca87ff6c766b75dbe4b2ea0831da?s=128&d=identicon&r=PG&f=1", "display_name": "J...S", "link": "https://stackoverflow.com/users/5375464/j-s"}, "edited": false, "score": 0, "creation_date": 1567680516, "post_id": 57783374, "comment_id": 102039254, "body": "@J...S: It&#39;s just allocating some stack space that it doesn&#39;t end up using - it&#39;s not elided because it&#39;s not a fully optimised build.  The value added back in the function epilogue is the 24 subtracted in the prologue plus the 5*4 = 20 used by the 5 pushes."}], "tags": [], "owner": {"reputation": 215710, "user_id": 134633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6be45ddcfd038ba5e1e5fca319c7fa?s=128&d=identicon&r=PG", "display_name": "caf", "link": "https://stackoverflow.com/users/134633/caf"}, "is_accepted": false, "score": 2, "last_activity_date": 1567582176, "last_edit_date": 1567582176, "creation_date": 1567581686, "answer_id": 57783374, "question_id": 57781548, "link": "https://stackoverflow.com/questions/57781548/tim-newsham-format-string-exploit/57783374#57783374", "title": "Tim Newsham format string exploit", "body": "<ul>\n<li><p><code>fp</code> stands for \"frame pointer\".</p></li>\n<li><p>The arguments start at <code>fp+8</code>because <code>fp+4</code> is the return address and <code>fp+0</code> is the saved frame pointer.</p></li>\n<li><p>In a conventional grows-down stack as x86 uses, higher addresses are deeper in the stack (items that were pushed earlier).</p></li>\n</ul>\n\n<p>The <code>Contents</code> is a little bit unclear - it's trying to describe what's in that stack slot but some of them don't have names.  This might be clearer:</p>\n\n<pre><code>Address  Contents                  Description\nfp+8     First snprintf argument   pointer 4-byte address\nfp+12    Second snprintf argument  length 4-byte integer\nfp+16    Third snprintf argument   string 4-byte address\nfp+20    Variable x in main        4-byte integer\nfp+24    Variable buf in main      100 characters\n</code></pre>\n\n<p>You don't see the same result because these kinds of things - formally <em>undefined behaviour</em> - are highly sensitive to the architecture, compiler and compiler version you're using.  It appears from the pointer value printed with <code>%p</code> that you're using a 64 bit architecture - if you're using x86-64, then then first 6 integral arguments to a function are passed in registers, not on the stack, so that's where your bogus <code>%x</code> formats are going to start looking.  You could try compiling for x86 with the <code>-m32</code> compiler option, but there's no guarantees.</p>\n"}], "owner": {"reputation": 4703, "user_id": 5375464, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3292ca87ff6c766b75dbe4b2ea0831da?s=128&d=identicon&r=PG&f=1", "display_name": "J...S", "link": "https://stackoverflow.com/users/5375464/j-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567663532, "creation_date": 1567571703, "question_id": 57781548, "link": "https://stackoverflow.com/questions/57781548/tim-newsham-format-string-exploit", "title": "Tim Newsham format string exploit", "body": "<p>I was reading <a href=\"https://seclists.org/bugtraq/2000/Sep/214\" rel=\"nofollow noreferrer\">Tim Newsham's white paper</a> on format string exploits and found some parts in the beginning difficult to understand.</p>\n\n<p>The following program was being discussed.</p>\n\n<pre><code>/*\n * fmtme.c\n *       Format a value into a fixed-size buffer\n */\n\n#include &lt;stdio.h&gt;\n\nint\nmain(int argc, char **argv)\n{\n    char buf[100];\n    int x;\n    if(argc != 2)\n        exit(1);\n    x = 1;\n    snprintf(buf, sizeof buf, argv[1]);\n    buf[sizeof buf - 1] = 0;\n    printf(\"buffer (%d): %s\\n\", strlen(buf), buf);\n    printf(\"x is %d/%#x (@ %p)\\n\", x, x, &amp;x);\n    return 0;\n}\n</code></pre>\n\n<p>Author says \"All examples in this document were actually performed on an x86 BSD/OS 4.1\", a little-endian machine.</p>\n\n<p>The program is executed like</p>\n\n<pre><code>% ./fmtme \"%x %x %x %x\"\nbuffer (15): 1 f31 1031 3133\nx is 1/0x1 (@ 0x804745c)\n</code></pre>\n\n<p>The paper says:</p>\n\n<pre><code>\"A quick analysis of the program will reveal that the stack layout of the\nprogram when the snprintf function is called is:\n\n    Address  Contents       Description\n    fp+8     Buffer         pointer 4-byte address\n    fp+12    Buffer         length 4-byte integer\n    fp+16    Format         string 4-byte address\n    fp+20    Variable x     4-byte integer\n    fp+24    Variable buf   100 characters\n\nThe four values output in the previous test were the next four arguments on\nthe stack after the format string: the variable x, then three 4-byte\nintegers\ntaken from the uninitialized buf variable.\"\n</code></pre>\n\n<p>What is <code>fp</code> here? File pointer?</p>\n\n<p>And why does it start from fp+8 and not fp+4 when the increments are by 4 everwhere else (4-byte address)?</p>\n\n<p>Here, does larger address mean the value is higher up or lower down the stack?</p>\n\n<p>What does the names given under 'Contents' mean?</p>\n\n<hr>\n\n<p>And when I run the above program, the value of <code>x</code>, ie, <code>1</code>, is not being printed. Maybe because of different architecture?</p>\n\n<p>I get like this</p>\n\n<pre><code>./fmtme \"%x %x %x %x\"\nbuffer (34): cd512860 b3356d80 b3356d80 8247ee8\nx is 1/0x1 (@ 0x7ffc08247d8c)\n</code></pre>\n\n<p>Can anyone help?</p>\n"}, {"tags": ["c++", "c", "unicode", "wchar"], "comments": [{"owner": {"reputation": 30170, "user_id": 5231607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QzGsq.jpg?s=128&g=1", "display_name": "1201ProgramAlarm", "link": "https://stackoverflow.com/users/5231607/1201programalarm"}, "edited": false, "score": 1, "creation_date": 1567571323, "post_id": 57781447, "comment_id": 101997094, "body": "Does the font used in the console support that character?"}, {"owner": {"reputation": 5450, "user_id": 2758823, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9Nxaq.jpg?s=128&g=1", "display_name": "Giacomo Catenazzi", "link": "https://stackoverflow.com/users/2758823/giacomo-catenazzi"}, "edited": false, "score": 0, "creation_date": 1567587675, "post_id": 57781447, "comment_id": 102003452, "body": "Did you have the locale <code>en_US.UTF-8</code> installed? Locale names changes between OS and versions of the same OS. Note: UTF-8 is different encoding of O_U16TEXT. So you are using incompatible encodings. Is your console UTF-8 console? It is set to use UTF-8 characters? What about the font? Note: this question is marked duplicate, but if you are not using Windows, you may edit your question and ask to reopen it."}, {"owner": {"reputation": 1, "user_id": 11849842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6aa412ae32b46b427737f70b7a3822b?s=128&d=identicon&r=PG&f=1", "display_name": "Hakura", "link": "https://stackoverflow.com/users/11849842/hakura"}, "reply_to_user": {"reputation": 5450, "user_id": 2758823, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9Nxaq.jpg?s=128&g=1", "display_name": "Giacomo Catenazzi", "link": "https://stackoverflow.com/users/2758823/giacomo-catenazzi"}, "edited": false, "score": 0, "creation_date": 1567590365, "post_id": 57781447, "comment_id": 102004956, "body": "@GiacomoCatenazzi: Thank you for taking the time and helping me out. This question was marked correctly as a duplicate. I&#39;m still trying to figure out how to change my font to one who supports the flat symbol. I didn&#39;t install the local &#39;en_US.UTF-8&#39;, if that is something, you have to install manually."}], "owner": {"reputation": 1, "user_id": 11849842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6aa412ae32b46b427737f70b7a3822b?s=128&d=identicon&r=PG&f=1", "display_name": "Hakura", "link": "https://stackoverflow.com/users/11849842/hakura"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "closed_date": 1567585833, "answer_count": 0, "score": 0, "last_activity_date": 1567577695, "creation_date": 1567571006, "last_edit_date": 1567577695, "question_id": 57781447, "link": "https://stackoverflow.com/questions/57781447/trouble-printing-out-character-u266d-on-console-using-wprintf", "closed_reason": "Duplicate", "title": "Trouble printing out character (\u266d U+266D) on console using wprintf", "body": "<p>I want to print the musical flat symbol: <code>\u266d</code> (U+266D) on a console. I use <code>wchar_t</code> and <code>wprintf()</code> to do that, but it always prints out <code>?</code> instead of <code>\u266d</code>. I tried <code>setmode()</code> and <code>setlocale()</code> as well, as you can see down in the code, but neither of them was successful.  </p>\n\n<pre><code>int main(){\n    _setmode(_fileno(stdout), _O_U16TEXT);\n    //setlocale(LC_ALL, \"en_US.UTF-8\");\n\n    wprintf(L\"\\u226d\");\n}\n</code></pre>\n"}, {"tags": ["c", "bitwise-operators"], "comments": [{"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 1, "creation_date": 1567570526, "post_id": 57781307, "comment_id": 101996951, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/17019187/calculating-maximum-int-value-in-c-program-1-31-1\">Calculating maximum int value in C program (1 &lt;&lt; 31) - 1</a>"}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 0, "creation_date": 1567570659, "post_id": 57781307, "comment_id": 101996978, "body": "<a href=\"https://stackoverflow.com/q/31744305/995714\">bit shifting with unsigned long type produces wrong results</a>, <a href=\"https://stackoverflow.com/q/39206842/995714\">How does 1 left shift by 31 (1 &lt;&lt; 31) work to get maximum int value?</a>, <a href=\"https://stackoverflow.com/q/35119136/995714\">Is unsigned long int correct for this operation?</a>, <a href=\"https://stackoverflow.com/q/40951434/995714\">C++ bitwise left shift by 32</a>"}], "answers": [{"tags": [], "owner": {"reputation": 30170, "user_id": 5231607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QzGsq.jpg?s=128&g=1", "display_name": "1201ProgramAlarm", "link": "https://stackoverflow.com/users/5231607/1201programalarm"}, "is_accepted": false, "score": 3, "last_activity_date": 1567570111, "creation_date": 1567570111, "answer_id": 57781347, "question_id": 57781307, "link": "https://stackoverflow.com/questions/57781307/manually-adding-a-bitmask-vs-adding-a-bitwise-shift/57781347#57781347", "title": "Manually adding a bitmask vs adding a bitwise shift", "body": "<p>Since the type of the result of your shift is <code>unsigned long</code>, you should start with an unsigned long constant:</p>\n\n<pre><code>unsigned long bitmask2 = (1UL &lt;&lt; 31) - 1;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 35158, "user_id": 395202, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c422b640dd62b019c125836b1059e231?s=128&d=identicon&r=PG", "display_name": "Adrian Shum", "link": "https://stackoverflow.com/users/395202/adrian-shum"}, "is_accepted": false, "score": 1, "last_activity_date": 1567585004, "last_edit_date": 1567585004, "creation_date": 1567570152, "answer_id": 57781353, "question_id": 57781307, "link": "https://stackoverflow.com/questions/57781307/manually-adding-a-bitmask-vs-adding-a-bitwise-shift/57781353#57781353", "title": "Manually adding a bitmask vs adding a bitwise shift", "body": "<p>Change </p>\n\n<pre><code>unsigned long bitmask2 = (1 &lt;&lt; 31)-1;\n</code></pre>\n\n<p>to something like</p>\n\n<pre><code>unsigned long bitmask2 = (1UL &lt;&lt; 31);\n</code></pre>\n\n<p>instead</p>\n\n<p>The overflow was caused by you are bitwise shifting 31 places for <code>1</code> which exceed the boundary of a signed int.  Please note that <code>1</code> is a signed int literal. </p>\n"}, {"comments": [{"owner": {"reputation": 35158, "user_id": 395202, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c422b640dd62b019c125836b1059e231?s=128&d=identicon&r=PG", "display_name": "Adrian Shum", "link": "https://stackoverflow.com/users/395202/adrian-shum"}, "edited": false, "score": 0, "creation_date": 1567665794, "post_id": 57783163, "comment_id": 102031844, "body": "There seems to be quite some incorrect information: 1. in C/C++ <code>int</code> is not necessary to be 32-bit  2. as the variable is <code>unsigned long</code>, it is a better idea to make sure the result type of the shift operation is also <code>unsigned long</code>.  That&#39;s why in other answers, we are suggesting <code>1UL</code> instead of <code>1U</code>. 3. I believe the resulting type is determined by the <code>left operand</code>.  For binary operators, it should be determined by type promotion, for which will promote to <code>unsigned long</code> if either side is <code>unsigned long</code>. Which means, it will also work to write <code>1 &lt;&lt; 31UL</code> (though looks funny)"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 35158, "user_id": 395202, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c422b640dd62b019c125836b1059e231?s=128&d=identicon&r=PG", "display_name": "Adrian Shum", "link": "https://stackoverflow.com/users/395202/adrian-shum"}, "edited": false, "score": 0, "creation_date": 1567666613, "post_id": 57783163, "comment_id": 102032208, "body": "@AdrianShum In case <code>int</code> isn&#39;t 32 bits, then the OP&#39;s question doesn&#39;t make any sense, now does it? <code>unsigned long</code> is irrelevant, because it is either 32 or 64 bits and in either case it doesn&#39;t affect the shift operation the slightest. Using <code>ul</code> instead of <code>u</code> doesn&#39;t add anything except fussiness."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 35158, "user_id": 395202, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c422b640dd62b019c125836b1059e231?s=128&d=identicon&r=PG", "display_name": "Adrian Shum", "link": "https://stackoverflow.com/users/395202/adrian-shum"}, "edited": false, "score": 0, "creation_date": 1567666645, "post_id": 57783163, "comment_id": 102032222, "body": "@AdrianShum Your understanding of type promotion for the <code>&lt;&lt;</code> operator is incorrect and <code>1 &lt;&lt; 31UL</code> will <i>not</i> work but invoke undefined behavior. As mentioned in the answer, the shift operators are a special case and the usual arithmetic conversions do not apply. Instead, both operands are integer promoted and the result is the type of the promoted left operand, always. I would appreciate if you don&#39;t downvote my answer because <i>you</i> don&#39;t understand how type promotion works."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 35158, "user_id": 395202, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c422b640dd62b019c125836b1059e231?s=128&d=identicon&r=PG", "display_name": "Adrian Shum", "link": "https://stackoverflow.com/users/395202/adrian-shum"}, "edited": false, "score": 0, "creation_date": 1567666728, "post_id": 57783163, "comment_id": 102032245, "body": "@AdrianShum To spell it out to you, C17 6.5.7 Bitwise shift operators <b>&quot;The integer promotions are performed on each of the operands. The type of the result is that of the promoted left operand.&quot;</b>"}, {"owner": {"reputation": 35158, "user_id": 395202, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c422b640dd62b019c125836b1059e231?s=128&d=identicon&r=PG", "display_name": "Adrian Shum", "link": "https://stackoverflow.com/users/395202/adrian-shum"}, "edited": false, "score": 0, "creation_date": 1567668017, "post_id": 57783163, "comment_id": 102032822, "body": "1. you are right that on OP&#39;s platform, <code>int</code> is 32 bit, there is no doubt.  What I meant inaccurate is the statement <code>An int is signed and therefore has 31 data bits and 1 sign bit.</code>.  imho it is overly simplified to say <code>int</code> has certain width.  It could be better to say &quot;on your platform&quot;.  2. it is totally possible to <code>unsigned int</code> with 16 bit (though not on OP&#39;s platform).  Only <code>long</code> is guaranteed to be 32 bit or wider."}, {"owner": {"reputation": 35158, "user_id": 395202, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c422b640dd62b019c125836b1059e231?s=128&d=identicon&r=PG", "display_name": "Adrian Shum", "link": "https://stackoverflow.com/users/395202/adrian-shum"}, "edited": false, "score": 0, "creation_date": 1567669424, "post_id": 57783163, "comment_id": 102033451, "body": "3. You are right, I misunderstood the standard here :) I mistakenly though it is doing type promotion, but turned out it is just integer promotion.  Thanks for pointing out"}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": true, "score": 0, "last_activity_date": 1567580770, "creation_date": 1567580770, "answer_id": 57783163, "question_id": 57781307, "link": "https://stackoverflow.com/questions/57781307/manually-adding-a-bitmask-vs-adding-a-bitwise-shift/57783163#57783163", "title": "Manually adding a bitmask vs adding a bitwise shift", "body": "<p>All integer constants like <code>1</code> have a type, in this case <code>int</code>. An <code>int</code> is signed and therefore has 31 data bits and 1 sign bit. You cannot left shift data into this sign bit - <code>1&lt;&lt;31</code> is a severe undefined behavior bug.</p>\n\n<p>As a rule of thumb, never mix signed operands with bitwise operators. You can fix the bug by adding a 'u' suffix to the integer constant: <code>1u &lt;&lt; 31</code>. Now the type is <code>unsigned int</code> instead, 32 data bits.</p>\n\n<p>Please note that the resulting type of a shift operation is that of the <em>left</em> operand. So there is no need to write for example <code>1u &lt;&lt; 31u</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11954200"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 0, "accepted_answer_id": 57783163, "answer_count": 3, "score": 2, "last_activity_date": 1567629141, "creation_date": 1567569750, "last_edit_date": 1567629141, "question_id": 57781307, "link": "https://stackoverflow.com/questions/57781307/manually-adding-a-bitmask-vs-adding-a-bitwise-shift", "title": "Manually adding a bitmask vs adding a bitwise shift", "body": "<p>I am trying to add in a left-wise operator to replace the following: </p>\n\n<pre><code>unsigned long bitmask = 0b10000000000000000000000000000000;\nprintf(\"%lu\\n\", bitmask);\n\nunsigned long bitmask2 = (1 &lt;&lt; 31)-1;\nprintf(\"%lu\\n\", bitmask2);\n</code></pre>\n\n<p>However, the closest I'm able to get is <code>-1</code>. If I try doing (1 &lt;&lt; 31), it looks like I get an overflow or something. What would be the proper way to do this?</p>\n\n<pre><code># in the python shell\n&gt;&gt;&gt; 0b10000000000000000000000000000000\n2147483648\n\n&gt;&gt;&gt; 1&lt;&lt;31\n2147483648\n\n&gt;&gt;&gt; 0b10000000000000000000000000000000 == 1&lt;&lt;31\nTrue\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1567568944, "post_id": 57781205, "comment_id": 101996694, "body": "You could package that code up as a <code>print_byte_in_binary()</code> function, then call it repeatedly for each byte of a larger data structure.  You could step a byte pointer over the bytes of that larger data structure, something like <code>unsigned char *cp; for cp = (unsigned char *)&amp;x; cp &lt; (unsigned char *)&amp;x + sizeof(x); cp++) print_byte_in_binary(*cp);</code>"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1567569115, "post_id": 57781205, "comment_id": 101996718, "body": "&quot;How could I ... print the binary of any data type/structure?&quot;:  <a href=\"https://stackoverflow.com/a/35367414/2410359\">convert any variable/object to a string that encodes the binary</a> may be of interest."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 1, "creation_date": 1567569840, "post_id": 57781205, "comment_id": 101996844, "body": "That binary constant <code>0b10000000</code> is a nonstandard extension of your compiler, I think.  More portable would be <code>unsigned char bitmask = 0x80;</code>."}], "answers": [{"tags": [], "owner": {"reputation": 8430, "user_id": 3555525, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/3ba5dbe6c89022c8af714c8d841f9547?s=128&d=identicon&r=PG&f=1", "display_name": "Rishikesh Raje", "link": "https://stackoverflow.com/users/3555525/rishikesh-raje"}, "is_accepted": false, "score": 0, "last_activity_date": 1567572076, "creation_date": 1567572076, "answer_id": 57781608, "question_id": 57781205, "link": "https://stackoverflow.com/questions/57781205/print-binary-of-an-ascii-character/57781608#57781608", "title": "Print binary of an ascii character", "body": "<p>You could create a function which takes a void pointer and the size of the structure as input.</p>\n\n<pre><code>void printdata(void *data, size_t len)\n{\n    char my_char; \n    for (size_t m = 0; m &lt; len; m++)\n    {    \n        my_char = *(((char*) data) + m);\n        for (size_t i=0; i&lt;8; i++) \n        {\n            if (i==4) printf(\" \"); // separate every four characters\n            printf(\"%d\", (my_char &amp; bitmask) != 0);\n            bitmask = bitmask &gt;&gt; 1;\n        }\n        printf(\"\\n\");\n    }\n} \n</code></pre>\n\n<p>Then you can call this function for each element of your struct.</p>\n\n<p>e.g. </p>\n\n<pre><code>typedef struct\n{\n    int a;\n    char b;\n    int c[20];\n}my_struct_t;\n\nmy_struct_t mystruct;\n\n..\nprintdata(mystruct.a,sizeof(int));\nprintdata(mystruct.b,sizeof(char));\nprintdata(mystruct.c, 20*sizeof(int));  \n</code></pre>\n\n<p>You can also pass the entire struct to the above function, but it will also print the padding bytes which is not what is needed. </p>\n"}, {"tags": [], "owner": {"reputation": 354, "user_id": 11727918, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bTaZpiC4KJ8/AAAAAAAAAAI/AAAAAAAAABQ/ycG-qmsyeCA/photo.jpg?sz=128", "display_name": "J CHEN", "link": "https://stackoverflow.com/users/11727918/j-chen"}, "is_accepted": false, "score": 0, "last_activity_date": 1567579002, "creation_date": 1567579002, "answer_id": 57782762, "question_id": 57781205, "link": "https://stackoverflow.com/questions/57781205/print-binary-of-an-ascii-character/57782762#57782762", "title": "Print binary of an ascii character", "body": "<p>This fit types what you want</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#define bitmask 0b1\nvoid F1(void *a,int Len){\n    int i,j;\n    unsigned char*b=(unsigned char*)a;\n    b+=Len-1;\n    for(i=0;i&lt;Len;i++,b--){\n        for(j=7;j&gt;-1;j--){\n            printf(\"%d\",((*b)&amp;bitmask&lt;&lt;j)&gt;&gt;j);\n        }\n    }\n    printf(\"\\n\");\n}\nint main(){ \n\n    unsigned int Q=10;\n    F1(&amp;Q,sizeof(unsigned int));\n\n    unsigned short QQ=10;\n    F1(&amp;QQ,sizeof(unsigned short));\n\n    unsigned char QQQ=10;\n    F1(&amp;QQQ,sizeof(unsigned char));\n    return 0;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11954200"}, "edited": false, "score": 0, "creation_date": 1567629201, "post_id": 57782844, "comment_id": 102023679, "body": "this is such a great example and answer. Thanks for providing all the comments and the output, this is really helpful for my understand (and hopefully other beginners trying to understand something similar)."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1567634923, "post_id": 57782844, "comment_id": 102025409, "body": "I&#39;m glad it helped. I find the more I comment each line in the code, the easier it makes it for me to recall my original thought process in writing it to begin with (especially a couple of years later) <i>and</i> the easier it makes it to find errors in my logic."}], "tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": true, "score": 1, "last_activity_date": 1567579405, "creation_date": 1567579405, "answer_id": 57782844, "question_id": 57781205, "link": "https://stackoverflow.com/questions/57781205/print-binary-of-an-ascii-character/57782844#57782844", "title": "Print binary of an ascii character", "body": "<p>There are numerous ways to do this. The following outputs a nice chart of printable characters giving the value for each character in ASCII, decimal, hex and binary, e.g.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;limits.h&gt;\n\n/* CHAR_BIT */\n#ifndef CHAR_BIT\n#define CHAR_BIT  8\n#endif\n\nint main (void) {\n\n    char c = 0;     /* character */\n    int i = 0;      /* int loop counter */\n\n    printf (\"\\nchar |  int  |  hex   |  binary\\n\");\n    printf (\"-----+-------+--------+---------\\n\");\n    for (c = 32; c &lt;= 126; c++) {   /* for each char in printable range  */\n        /* output the character, decimal, hex and binary */\n        printf (\"  %c  |  %3d  |  0x%02x  | \", c, c, c);\n\n        for (i = sizeof (c) * CHAR_BIT - 1; i &gt;= 0; i--)    /* for each bit */\n            printf (\"%d\", ((c &gt;&gt; i) &amp; 0x1) ? 1 : 0);        /* output 0/1 */\n        putchar ('\\n');                                     /* output \\n */\n    }\n\n    putchar ('\\n');\n}\n</code></pre>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/bin_ascii\n\nchar |  int  |  hex   |  binary\n-----+-------+--------+---------\n     |   32  |  0x20  | 00100000\n  !  |   33  |  0x21  | 00100001\n  \"  |   34  |  0x22  | 00100010\n  #  |   35  |  0x23  | 00100011\n  $  |   36  |  0x24  | 00100100\n  %  |   37  |  0x25  | 00100101\n  &amp;  |   38  |  0x26  | 00100110\n  '  |   39  |  0x27  | 00100111\n  (  |   40  |  0x28  | 00101000\n  )  |   41  |  0x29  | 00101001\n  *  |   42  |  0x2a  | 00101010\n  +  |   43  |  0x2b  | 00101011\n  ,  |   44  |  0x2c  | 00101100\n  -  |   45  |  0x2d  | 00101101\n  .  |   46  |  0x2e  | 00101110\n  /  |   47  |  0x2f  | 00101111\n  0  |   48  |  0x30  | 00110000\n  1  |   49  |  0x31  | 00110001\n  2  |   50  |  0x32  | 00110010\n  3  |   51  |  0x33  | 00110011\n  4  |   52  |  0x34  | 00110100\n  5  |   53  |  0x35  | 00110101\n  6  |   54  |  0x36  | 00110110\n  7  |   55  |  0x37  | 00110111\n  8  |   56  |  0x38  | 00111000\n  9  |   57  |  0x39  | 00111001\n&lt;snip&gt;\n  p  |  112  |  0x70  | 01110000\n  q  |  113  |  0x71  | 01110001\n  r  |  114  |  0x72  | 01110010\n  s  |  115  |  0x73  | 01110011\n  t  |  116  |  0x74  | 01110100\n  u  |  117  |  0x75  | 01110101\n  v  |  118  |  0x76  | 01110110\n  w  |  119  |  0x77  | 01110111\n  x  |  120  |  0x78  | 01111000\n  y  |  121  |  0x79  | 01111001\n  z  |  122  |  0x7a  | 01111010\n  {  |  123  |  0x7b  | 01111011\n  |  |  124  |  0x7c  | 01111100\n  }  |  125  |  0x7d  | 01111101\n  ~  |  126  |  0x7e  | 01111110\n</code></pre>\n\n<p>Let me know if you have any questions about the logic.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11954200"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 0, "accepted_answer_id": 57782844, "answer_count": 3, "score": 0, "last_activity_date": 1567579405, "creation_date": 1567568572, "question_id": 57781205, "link": "https://stackoverflow.com/questions/57781205/print-binary-of-an-ascii-character", "title": "Print binary of an ascii character", "body": "<p>I am using the following approach to print the binary of an ascii character:</p>\n\n<pre><code>unsigned char bitmask = 0b10000000;\nchar _my_char = 'a';\nfor (int i=0; i&lt;8; i++) {\n    if (i==4) putchar(' '); // separate every four characters\n    printf(\"%d\", (_my_char &amp; bitmask) != 0);\n    bitmask = bitmask &gt;&gt; 1;\n}\nputchar('\\n');\nreturn 0;\n</code></pre>\n\n<p>How could I generalize this so that, for example, I could print the binary of any data type/structure? One byte per row?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1567566780, "post_id": 57780491, "comment_id": 101996329, "body": "<code>^ 0x20</code> curiously looks like code is toggling the <i>case</i>.  Could use <code>^ (&#39;A&#39; ^ &#39;a&#39;)</code> instead.  Works for <a href=\"https://en.wikipedia.org/wiki/EBCDIC\" rel=\"nofollow noreferrer\">EBCDIC</a> letters too."}], "answers": [{"tags": [], "owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "is_accepted": false, "score": 0, "last_activity_date": 1567561810, "creation_date": 1567561810, "answer_id": 57780526, "question_id": 57780491, "link": "https://stackoverflow.com/questions/57780491/toggle-a-character-using-a-pointer/57780526#57780526", "title": "Toggle a character using a pointer", "body": "<p>With something like</p>\n\n<pre><code>void toggle_char(char *my_char) {\n    *my_char ^= 0x20;\n}\n</code></pre>\n\n<p>and passing the function the address of the variable in question.</p>\n"}, {"tags": [], "owner": {"reputation": 788, "user_id": 9312233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1269dfa2b52b76d5462954279b393787?s=128&d=identicon&r=PG&f=1", "display_name": "code it up", "link": "https://stackoverflow.com/users/9312233/code-it-up"}, "is_accepted": true, "score": 1, "last_activity_date": 1567562134, "creation_date": 1567562134, "answer_id": 57780549, "question_id": 57780491, "link": "https://stackoverflow.com/questions/57780491/toggle-a-character-using-a-pointer/57780549#57780549", "title": "Toggle a character using a pointer", "body": "<p>Making changes in-place means that you are working on the same address location, and not using some other temporary addressed variable.</p>\n\n<p>So here you need to pass the address of your variable to the function and function signature must be taking a pointer to the variable as the parameter.</p>\n\n<p>Your function will be something like</p>\n\n<pre><code>void toggle_char(char *my_char) {\n    *my_char ^= 0x20;\n}\n</code></pre>\n\n<p>And you need to call it as </p>\n\n<p><code>toggle_char(&amp;my_char);</code></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11954200"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 57780549, "answer_count": 2, "score": 1, "last_activity_date": 1567564051, "creation_date": 1567561538, "last_edit_date": 1567564051, "question_id": 57780491, "link": "https://stackoverflow.com/questions/57780491/toggle-a-character-using-a-pointer", "title": "Toggle a character using a pointer", "body": "<p>To toggle a character with a return value, I can do something like the following:</p>\n\n<pre><code>char toggle_char(char my_char) {\n    return my_char ^ 0x20;\n}\n\nint main(void) {\n\n    char my_char = 'a';\n    my_char = toggle_char(my_char);\n    printf(\"My Char: %c\\n\", my_char);\n    my_char = toggle_char(my_char);\n    printf(\"My Char: %c\\n\", my_char);\n\n    return 0;\n}\n</code></pre>\n\n<p>How would I do the same using an in-place pointer? For example, I could do this:</p>\n\n<pre><code>int main(void) {\n    char my_char = 'a';\n    printf(\"My Char: %c\\n\", my_char);\n    toggle_char(my_char);\n    printf(\"My Char: %c\\n\", my_char);\n}\n</code></pre>\n"}, {"tags": ["c", "linux", "sockets"], "comments": [{"owner": {"reputation": 40086, "user_id": 499581, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1ba2cebc4582467916f2ddd6128447f4?s=128&d=identicon&r=PG", "display_name": "l&#39;L&#39;l", "link": "https://stackoverflow.com/users/499581/lll"}, "edited": false, "score": 1, "creation_date": 1567561256, "post_id": 57780387, "comment_id": 101995501, "body": "Your code looks incomplete; you haven&#39;t got a <code>PORT</code> defined."}, {"owner": {"reputation": 2065, "user_id": 85696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9d5b650b104a98538d5aab145ea192d?s=128&d=identicon&r=PG", "display_name": "danadam", "link": "https://stackoverflow.com/users/85696/danadam"}, "edited": false, "score": 1, "creation_date": 1567561554, "post_id": 57780387, "comment_id": 101995543, "body": "You use <code>%s</code> in <code>printf()</code> format string but neither <code>s_addr</code> nor <code>sin_port</code> is a string. Your program probably crashes."}, {"owner": {"reputation": 98, "user_id": 7971556, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TKBOI.png?s=128&g=1", "display_name": "SJMcMullan", "link": "https://stackoverflow.com/users/7971556/sjmcmullan"}, "reply_to_user": {"reputation": 2065, "user_id": 85696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9d5b650b104a98538d5aab145ea192d?s=128&d=identicon&r=PG", "display_name": "danadam", "link": "https://stackoverflow.com/users/85696/danadam"}, "edited": false, "score": 0, "creation_date": 1567561982, "post_id": 57780387, "comment_id": 101995602, "body": "@danadam I have my code to format those values properly and that fixed it. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 98, "user_id": 7971556, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TKBOI.png?s=128&g=1", "display_name": "SJMcMullan", "link": "https://stackoverflow.com/users/7971556/sjmcmullan"}, "edited": false, "score": 0, "creation_date": 1567562399, "post_id": 57780484, "comment_id": 101995671, "body": "This is the answer, thank you very much! I changed the last line to <code>printf(&quot;Socket bound to %s:%d.\\n&quot;, inet_ntoa(serverAddress.sin_addr, ntohs(serverAddress.sin_port));</code> and it worked. I was not converting those values properly"}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 1, "last_activity_date": 1567561511, "creation_date": 1567561511, "answer_id": 57780484, "question_id": 57780387, "link": "https://stackoverflow.com/questions/57780387/bind-function-is-not-executing-at-all-no-output-when-testing-it/57780484#57780484", "title": "bind() function is not executing at all, no output when testing it", "body": "<p>A server socket won't show up in a netstat listing unless you call <code>listen</code> after binding the socket.</p>\n\n<p>Also, you're using the <code>%s</code> format specifier in your <code>printf</code> after the <code>bind</code> call on <code>serverAddress.sin_addr.s_addr</code> and <code>serverAddress.sin_port</code>.  These are not strings but integers.  Using the wrong format specifier invokes <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behavior</a> and is likely causing your program to crash.  Using the correct format specifier such as <code>%d</code> or <code>%x</code> will fix this.</p>\n\n<pre><code>if (bind(socketDescriptor, (struct sockaddr*)&amp;serverAddress, sizeof(struct sockaddr_in)) &lt; 0) {\n    perror(\"ERROR BINDNING\");\n    exit(1);\n}\nelse\n    // use %x to print instead\n    printf(\"Socket bound to %x:%x.\\n\", serverAddress.sin_addr.s_addr, serverAddress.sin_port);\n\nif (listen(socketDescriptor, 3) &lt; 0) {\n    perror(\"listen failed\");\n} else {\n    printf(\"socket is listening\\n\");\n}\n</code></pre>\n"}], "owner": {"reputation": 98, "user_id": 7971556, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TKBOI.png?s=128&g=1", "display_name": "SJMcMullan", "link": "https://stackoverflow.com/users/7971556/sjmcmullan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 57780484, "answer_count": 1, "score": 0, "last_activity_date": 1567561511, "creation_date": 1567560487, "question_id": 57780387, "link": "https://stackoverflow.com/questions/57780387/bind-function-is-not-executing-at-all-no-output-when-testing-it", "title": "bind() function is not executing at all, no output when testing it", "body": "<p>I'm learning socket programming in C. I have gotten my server to create a socket that was successful, but when I try to bind my socket to a port nothing happens. No error occurs and it is not successful. It's as if the <code>bind()</code> function is not even executing at all. </p>\n\n<p>I've checked out the documentation on the <code>bind()</code> function <a href=\"http://man7.org/linux/man-pages/man2/bind.2.html\" rel=\"nofollow noreferrer\">here</a> but there's no mention of why it won't execute at all. I've also tried searching through this site with no avail. \nI also tried following <a href=\"https://www.youtube.com/watch?v=BIJGSQEipEE\" rel=\"nofollow noreferrer\">this</a> tutorial from start to finish but the error (or lack thereof) still occurs.</p>\n\n<p>Here is my full code leading up to the problem: </p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;arpa/inet.h&gt;\n#include \"include.h\" \n\nint main() {\n\n    // Descriptors. Used to check the status of functions such as socket, listen, bind etc.\n    // If a descriptor is equal to 0, then everything is okay. Else, if they are equal to -1, something went wrong.\n    int socketDescriptor, newSocketDescriptor = 1;\n\n    // The process ID of a child process (the client) when a new one is spawned (the client connects).\n    pid_t childPID;\n\n    // A string to hold the commands being sent a received.\n    char* commandBuffer = calloc(BUFFER_SIZE, sizeof(char));\n\n    // A structure to hold information on the server address.\n    struct sockaddr_in serverAddress;\n    memset(&amp;serverAddress, '\\0', sizeof(serverAddress));\n\n    // Fill in the server address information.\n    // Set the address family to AF_INET, which specifies we will be using IPv4.\n    // htons() takes the given int and converts it to the appropriate format. Used for port numbers.\n    // inet_addr() takes the given string and converts it to the appropriate format. Used for IP addresses.\n    serverAddress.sin_family = AF_INET;\n    serverAddress.sin_port = htons(PORT);\n    serverAddress.sin_addr.s_addr = inet_addr(\"127.0.0.1\");\n\n    // A structure to hold information a client when a new one connects to this server.\n    struct sockaddr_in clientAddress;\n    memset(&amp;clientAddress, '\\0', sizeof(clientAddress));\n\n    // socklen_t defines the length of a socket structure. Need this for the accept() function.\n    socklen_t addressSize;\n\n    // Creating the socket.\n    // AF_NET specifies that we will be using IPv4 addressing.\n    // SOCK_STREAM specifies that we will be using TCP to communicate.\n    socketDescriptor = socket(AF_INET, SOCK_STREAM, 0);\n\n    if (socketDescriptor &lt; 0) {\n        perror(\"ERROR CREATING SOCKET\");\n        exit(1);\n    }\n    else\n        printf(\"Socket created successfully.\\n\");\n\n    // Binding to the specified port. 0 if everything is fine, -1 if there was an error.\n    if (bind(socketDescriptor, (struct sockaddr*) &amp; serverAddress, sizeof(struct sockaddr_in)) &lt; 0) {\n        perror(\"ERROR BINDNING\");\n        exit(1);\n    }\n    else\n        printf(\"Socket bound to %s:%s.\\n\", serverAddress.sin_addr.s_addr, serverAddress.sin_port);\n</code></pre>\n\n<p>The last <code>if</code> statement at the bottom is where the code fails. It should either print and error or print \"Socket bound to 127.0.0.1:80\" but neither happens. See an example <a href=\"https://i.imgur.com/7uPjnzo.png\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>I'm lost for what to do.</p>\n"}, {"tags": ["c", "gcc"], "comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1567560459, "post_id": 57780368, "comment_id": 101995381, "body": "Have you tried <code>(tm-&gt;tm_mon + 1)%100u, (tm-&gt;tm_year + 1900)%10000u</code>?"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1567560638, "post_id": 57780368, "comment_id": 101995415, "body": "@chux: That does seem to shut it up \u2014 thanks!  It always helps to have someone else think with you (for you) when you hit a brick wall on your own.  Convert that into an answer and you&#39;ll get my tokens of gratitude."}, {"owner": {"reputation": 40086, "user_id": 499581, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1ba2cebc4582467916f2ddd6128447f4?s=128&d=identicon&r=PG", "display_name": "l&#39;L&#39;l", "link": "https://stackoverflow.com/users/499581/lll"}, "edited": false, "score": 0, "creation_date": 1567560778, "post_id": 57780368, "comment_id": 101995441, "body": "@JonathanLeffler: Does this behavior only happen on <code>GCC 9.2.0</code>?"}, {"owner": {"reputation": 100407, "user_id": 16406, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/fadf252892475e9b177d5cd5e8b24145?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Dodd", "link": "https://stackoverflow.com/users/16406/chris-dodd"}, "edited": false, "score": 0, "creation_date": 1567560804, "post_id": 57780368, "comment_id": 101995446, "body": "Does explicitly ignoring the return value of snprintf with a <code>(void)</code> cast stop the warning?"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 100407, "user_id": 16406, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/fadf252892475e9b177d5cd5e8b24145?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Dodd", "link": "https://stackoverflow.com/users/16406/chris-dodd"}, "edited": false, "score": 0, "creation_date": 1567560994, "post_id": 57780368, "comment_id": 101995467, "body": "@ChrisDodd \u2014 it happens with 9.1.0, 8.2.0, 8.1.0 too, but not with 7.3.0 or 7.2.0.  Those are all the versions I&#39;ve got on this machine; my other one has some older versions, but 8.x upwards seems to report the problem and 7.x downwards does not.  This testing was on my Mac.  The cast to <code>(void)</code> does not suppress the error."}, {"owner": {"reputation": 1339, "user_id": 2141064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c56d69ec8f5e469a8c6ca22d60271e9b?s=128&d=identicon&r=PG", "display_name": "Lorinczy Zsigmond", "link": "https://stackoverflow.com/users/2141064/lorinczy-zsigmond"}, "edited": false, "score": 0, "creation_date": 1567580995, "post_id": 57780368, "comment_id": 102000079, "body": "It&#39;s almost equal to <code>strftime(&quot;%m-%Y&quot;)</code>"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 1339, "user_id": 2141064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c56d69ec8f5e469a8c6ca22d60271e9b?s=128&d=identicon&r=PG", "display_name": "Lorinczy Zsigmond", "link": "https://stackoverflow.com/users/2141064/lorinczy-zsigmond"}, "edited": false, "score": 0, "creation_date": 1567581581, "post_id": 57780368, "comment_id": 102000395, "body": "@LorinczyZsigmond \u2014 almost; the difference is a leading zero for nine months of the year, IIRC. Interesting thought, though."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 1339, "user_id": 2141064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c56d69ec8f5e469a8c6ca22d60271e9b?s=128&d=identicon&r=PG", "display_name": "Lorinczy Zsigmond", "link": "https://stackoverflow.com/users/2141064/lorinczy-zsigmond"}, "edited": false, "score": 0, "creation_date": 1568477057, "post_id": 57780368, "comment_id": 102290113, "body": "@LorinczyZsigmond: &#39;tis interesting \u2014 POSIX <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/strftime.html\" rel=\"nofollow noreferrer\"><code>strftime()</code></a> does not provide a way to get the month number for Jan-Sep as a single digit number, AFAICS.  And it provides more options than standard C <a href=\"http://port70.net/~nsz/c/c11/n1570.html#7.27.3.5\" rel=\"nofollow noreferrer\"><code>strftime()</code></a> does."}], "answers": [{"comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1567561354, "post_id": 57780456, "comment_id": 101995513, "body": "Thank you.  This does stop the complaint, and also ensures that the values are within the expected range, and there&#39;s no reason to think other compilers will reject it, so it meets my criteria.  (It&#39;s possible that another compiler set fussy won&#39;t accept that this makes it safe \u2014 I&#39;ll cross that bridge if I get to it.  I might need to deal with complaints about mixing signed and unsigned arithmetic, but that too can be dealt with later, if necessary.)"}], "tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": true, "score": 3, "last_activity_date": 1610098981, "last_edit_date": 1610098981, "creation_date": 1567561207, "answer_id": 57780456, "question_id": 57780368, "link": "https://stackoverflow.com/questions/57780368/how-to-stop-gcc-complaining-about-directive-output-may-be-truncated-in-snprint/57780456#57780456", "title": "How to stop GCC complaining about &quot;directive output may be truncated&quot; in snprintf() call?", "body": "<p>With compilers that  check the range of possible values, use <code>%</code> to quickly limit the range.</p>\n<p><code>% some_unsigned_N</code> insures the output is in  <code>[0... N-1]</code>.</p>\n<p>Note that <code>% some_pos_int_N</code> output is in the <code>(-N ...N)</code> range so recommend  <em>unsigned</em> math to avoid the <code>'-'</code> sign.</p>\n<pre><code>snprintf(ex-&gt;mm_yyyy, sizeof(ex-&gt;mm_yyyy), &quot;%d-%d&quot;, \n    //  tm-&gt;tm_mon + 1, tm-&gt;tm_year + 1900);\n    (tm-&gt;tm_mon + 1)%100u, (tm-&gt;tm_year + 1900)%10000u);\n</code></pre>\n<p>May also want to use <code>&quot;%u&quot;</code> should <code>some_unsigned_N</code> near <code>INT_MAX</code>.</p>\n"}], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1436, "favorite_count": 0, "accepted_answer_id": 57780456, "answer_count": 1, "score": 3, "last_activity_date": 1610098981, "creation_date": 1567560309, "question_id": 57780368, "link": "https://stackoverflow.com/questions/57780368/how-to-stop-gcc-complaining-about-directive-output-may-be-truncated-in-snprint", "title": "How to stop GCC complaining about &quot;directive output may be truncated&quot; in snprintf() call?", "body": "<p>I'm using GCC 9.2.0 on both an ancient Linux (RedHat 5.2) and modern macOS 10.14.6 Mojave, and I get the same complaint on both.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;time.h&gt;\n\nstruct Example\n{\n    /* ... */\n    char mm_yyyy[8];    /* Can't be changed */\n    /* ... */\n};\n\nextern void function(struct tm *tm, struct Example *ex);\n\nvoid function(struct tm *tm, struct Example *ex)\n{\n    snprintf(ex-&gt;mm_yyyy, sizeof(ex-&gt;mm_yyyy), \"%d-%d\",\n             tm-&gt;tm_mon + 1, tm-&gt;tm_year + 1900);\n}\n</code></pre>\n\n<p>When compiled with <code>-Wall</code> and any optimization (so not with <code>-O0</code> and not with no optimization option at all), the compiler says:</p>\n\n<pre><code>$ gcc -O -Wall -c so-code.c \nso-code.c: In function \u2018function\u2019:\nso-code.c:15:49: warning: \u2018%d\u2019 directive output may be truncated writing between 1 and 11 bytes into a region of size 8 [-Wformat-truncation=]\n   15 |     snprintf(ex-&gt;mm_yyyy, sizeof(ex-&gt;mm_yyyy), \"%d-%d\",\n      |                                                 ^~\nso-code.c:15:48: note: directive argument in the range [-2147483647, 2147483647]\n   15 |     snprintf(ex-&gt;mm_yyyy, sizeof(ex-&gt;mm_yyyy), \"%d-%d\",\n      |                                                ^~~~~~~\nso-code.c:15:48: note: directive argument in the range [-2147481748, 2147483647]\nso-code.c:15:5: note: \u2018snprintf\u2019 output between 4 and 24 bytes into a destination of size 8\n   15 |     snprintf(ex-&gt;mm_yyyy, sizeof(ex-&gt;mm_yyyy), \"%d-%d\",\n      |     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n   16 |              tm-&gt;tm_mon + 1, tm-&gt;tm_year + 1900);\n      |              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n$\n</code></pre>\n\n<p>At one level, fair enough; if <code>tm-&gt;tm_mon</code> contained a value outside the range 0 to 99 (or -1 to -9), then more than two bytes would be written to the output buffer, or if <code>tm-&gt;tm_year + 1900</code> required more than 4 digits, then there would be truncation/overflow.  However, the time values are known to be valid (month <code>0</code> to <code>11</code>; year + 1900 in the range <code>1970</code> to <code>2100</code>, for sake of concreteness; the range of years is actually smaller \u2014 2019 .. 2025 or thereabouts), so the concern is not actually warranted.</p>\n\n<p>Is there a way to suppress the warning without resorting to code such as:</p>\n\n<pre><code>#ifdef __GNUC__\n#pragma GCC diagnostic push\n#pragma GCC diagnostic ignore \"-Wformat-overflow\" /* Or \"-Wformat-truncation\" */\n#endif\n\n    snprintf(ex-&gt;mm_yyyy, sizeof(ex-&gt;mm_yyyy), \"%d-%d\",\n             tm-&gt;tm_mon + 1, tm-&gt;tm_year + 1900);\n\n#ifdef __GNUC__\n#pragma GCC diagnostic pop\n#endif\n</code></pre>\n\n<p>The <code>#ifdef</code> lines are necessary because the code has to be compiled by other compilers (notably XLC 13.x on AIX) which complain about unknown pragmas, even though they're not really supposed to.  (More formally, they're not required to complain and should accept the code ignoring the unknown pragma, but they pass comments about not recognizing the pragma, which defeats the goal of clean compilation.)</p>\n\n<p>Just for kicks; if you change the function from returning <code>void</code> to returning <code>int</code>, and if you then <code>return snprintf(\u2026);</code>, the error is not generated.  (This surprises me \u2014 I'm not sure I understand why this is not a problem too.  I guess it has to do with 'the return value from <code>snprintf()</code> is returned so it could be checked and the overflow spotted, therefore, but it is a bit surprising.)</p>\n\n<p>Unfortunately, this is an MCVE (<a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, Verifiable Example</a>; the code it is extracted from is much bigger, and changing the data structure is not an option \u2014 and this is just one step among many in the function where it appears.</p>\n\n<p>I suppose I could write a microscopic function to call <code>snprintf()</code> and return the value (which would be ignored), but:</p>\n\n<ul>\n<li>Is there any other viable alternative that works?</li>\n<li>Is there a way to tell GCC that the range of the variables passed to <code>snprintf()</code> et al is safer than the worst case scenario?</li>\n</ul>\n"}, {"tags": ["c++", "c", "tensorflow"], "comments": [{"owner": {"reputation": 410, "user_id": 4241727, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/976ad3d15dc36e461d3696f51cec4bf1?s=128&d=identicon&r=PG&f=1", "display_name": "Vahid Noormofidi", "link": "https://stackoverflow.com/users/4241727/vahid-noormofidi"}, "reply_to_user": {"reputation": 9602, "user_id": 7151494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a_FzvY-b2O0/AAAAAAAAAAI/AAAAAAAAAEw/kNwilSAvQTI/photo.jpg?sz=128", "display_name": "Fureeish", "link": "https://stackoverflow.com/users/7151494/fureeish"}, "edited": false, "score": 0, "creation_date": 1567558403, "post_id": 57780183, "comment_id": 101995033, "body": "@Fureeish since TF is written is C++, I thought maybe there is still a workaround in C++ for not using bazel for this issue!"}], "answers": [{"tags": [], "owner": {"reputation": 440, "user_id": 11160943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1165d73361bd3ff2b3e04a2c486f5d8?s=128&d=identicon&r=PG&f=1", "display_name": "Fisa", "link": "https://stackoverflow.com/users/11160943/fisa"}, "is_accepted": false, "score": 0, "last_activity_date": 1598454131, "creation_date": 1598454131, "answer_id": 63600441, "question_id": 57780183, "link": "https://stackoverflow.com/questions/57780183/custom-op-in-tensorflow-c/63600441#63600441", "title": "Custom Op in Tensorflow C", "body": "<p>Answer to your second question: This task is possible in TensorFlow C++ API, but to build TensorFlow C++ API you do need bazel.</p>\n"}], "owner": {"reputation": 410, "user_id": 4241727, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/976ad3d15dc36e461d3696f51cec4bf1?s=128&d=identicon&r=PG&f=1", "display_name": "Vahid Noormofidi", "link": "https://stackoverflow.com/users/4241727/vahid-noormofidi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1598454131, "creation_date": 1567558143, "last_edit_date": 1567634040, "question_id": 57780183, "link": "https://stackoverflow.com/questions/57780183/custom-op-in-tensorflow-c", "title": "Custom Op in Tensorflow C", "body": "<p>I'm trying to create a TF custom op using Tensorflow C API. I've already read the <a href=\"https://www.tensorflow.org/guide/extend/op\" rel=\"nofollow noreferrer\">Adding a New Op</a> and <a href=\"https://www.tensorflow.org/install/lang_c\" rel=\"nofollow noreferrer\">Install TensorFlow for C</a> but there is almost no tutorial for creating a custom op using Tensorflow C. So, I was wondering if somebody can show me a small example code for it?</p>\n\n<p>I cannot use the bazel build system in my environment, so I assume I cannot use Tensorflow C++ API, since I only have to use a static or shared library for the custom op code. Please let me know if this task is still possible in Tensorflow C++ API.</p>\n"}, {"tags": ["c", "sockets", "http", "tcp"], "comments": [{"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 4, "creation_date": 1567556160, "post_id": 57779995, "comment_id": 101994675, "body": "This is the COMPLETELY wrong way to implement an HTTP client.  YOU MUST PARSE THE RESPONSE CORRECTLY in order to know what format it is in, which will then dictate HOW you call <code>recv()</code> and WHEN to stop calling it.  A simple <code>recv()</code> loop like this will not suffice."}, {"owner": {"reputation": 129, "user_id": 9822933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbf07952826b03c3fe3e31371a97ce70?s=128&d=identicon&r=PG&f=1", "display_name": "jpc", "link": "https://stackoverflow.com/users/9822933/jpc"}, "reply_to_user": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1567556257, "post_id": 57779995, "comment_id": 101994692, "body": "@RemyLebeau How does one correctly parse the response, and what about the recv() call can change?"}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 1, "creation_date": 1567556488, "post_id": 57779995, "comment_id": 101994746, "body": "@jpc see the duplicate answers I just linked this question to."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "reply_to_user": {"reputation": 2323, "user_id": 8350647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zJNHD.png?s=128&g=1", "display_name": "Nina", "link": "https://stackoverflow.com/users/8350647/nina"}, "edited": false, "score": 3, "creation_date": 1567556527, "post_id": 57779995, "comment_id": 101994748, "body": "@Nina there is no <code>Content-Length</code> header if a non-identity <code>Transfer-Encoding</code> header is used instead. You have to analyze the HTTP headers to know what the actual transfer format of the body is, and then read it accordingly. Some formats are self-terminating in the data itself (chunking, MIME) and some are not (Content-Length, EOF by disconnect)."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1567574222, "post_id": 57779995, "comment_id": 101997691, "body": "@jpc You have to actually implement the HTTP protocol to make any sense of the data you receive. This is a very non-trivial problem and you should probably start by looking at an HTTP client someone else made and understanding it or reading the HTTP specification. The protocol specification tells you when you have the entire response, and it&#39;s not simple and varies with the encoding used. Perhaps start with something simpler than HTTP 1.1 such as HTTP 0.9 or 1.0 since they&#39;re much simpler."}], "owner": {"reputation": 129, "user_id": 9822933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbf07952826b03c3fe3e31371a97ce70?s=128&d=identicon&r=PG&f=1", "display_name": "jpc", "link": "https://stackoverflow.com/users/9822933/jpc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "closed_date": 1567556421, "answer_count": 0, "score": 0, "last_activity_date": 1567556452, "creation_date": 1567555897, "question_id": 57779995, "link": "https://stackoverflow.com/questions/57779995/how-to-tell-stop-recv-from-idling-when-there-is-no-more-data-to-read", "closed_reason": "Duplicate", "title": "How to tell stop recv() from idling when there is no more data to read?", "body": "<p>Essentially I am sending a GET request to some URL, and receiving the result using <code>recv()</code>. I have a while loop that gets chunks of the file from <code>recv()</code> in a buffer.</p>\n\n<pre><code>void send_GET(int client, char *url) {\n    char buf[BUF_SIZE] = {0};\n    sprintf(buf, \"GET / HTTP/1.1\\r\\nHost: %s\\r\\n\\r\\n\", url);\n    send(client, buf, strlen(buf), 0);\n}\n\nint main() {\n    //sock is a socket()\n    send_GET(sock, url);\n\n    while ((numbytes = recv(sock, buf, BUF_SIZE - 1, 0)) &gt; 0) {\n        buf[BUF_SIZE] = '\\0';\n        printf(\"%s\", buf);\n    }\n\n    printf(\"\\n\");\n    close(sock);\n    return 0;\n}\n</code></pre>\n\n<p>Once I get the entire HTML from the page I requested, the <code>recv()</code> process just idles. I know <code>close(sock)</code> will end it, but I don't know how to figure out how to tell when the file has ended. I don't know how to get the while loop to exit because numbytes never equals 0 or less than 0. Once it gets the last chunk, it just sits and idles. </p>\n\n<p>How can I tell when the end of the file I requested has been received?</p>\n"}, {"tags": ["c", "sockets", "struct"], "comments": [{"owner": {"reputation": 38064, "user_id": 683080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69ad2af1f028b1b7e76c14f83bdf26cb?s=128&d=identicon&r=PG", "display_name": "John Szakmeister", "link": "https://stackoverflow.com/users/683080/john-szakmeister"}, "edited": false, "score": 5, "creation_date": 1567553836, "post_id": 57779761, "comment_id": 101994313, "body": "Um... it only has to be <code>AF_INET</code> for TCP and UDP connections.  It could be something else, such as <code>AF_UNIX</code> (or <code>AF_LOCAL</code>) for Unix Domain sockets.  It depends on the kind of underlying network connection you want."}, {"owner": {"reputation": 23625, "user_id": 2868801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ec5567811049b7ce8192be0bc0246d1?s=128&d=identicon&r=PG&f=1", "display_name": "dave_thompson_085", "link": "https://stackoverflow.com/users/2868801/dave-thompson-085"}, "edited": false, "score": 0, "creation_date": 1567554126, "post_id": 57779761, "comment_id": 101994355, "body": "<a href=\"https://en.wikipedia.org/wiki/Berkeley_sockets#Protocol_and_address_families\" rel=\"nofollow noreferrer\">Berkeley sockets: Protocol and address families</a>"}, {"owner": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "edited": false, "score": 0, "creation_date": 1567554130, "post_id": 57779761, "comment_id": 101994357, "body": "But if you are using af_unix wouldn&#39;t you use struct sockaddr_un?"}, {"owner": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "reply_to_user": {"reputation": 38064, "user_id": 683080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69ad2af1f028b1b7e76c14f83bdf26cb?s=128&d=identicon&r=PG", "display_name": "John Szakmeister", "link": "https://stackoverflow.com/users/683080/john-szakmeister"}, "edited": false, "score": 0, "creation_date": 1567554239, "post_id": 57779761, "comment_id": 101994377, "body": "@JohnSzakmeister struct sockaddr_in is used for ipv4, so the address family can never be anything else other than AF_INET"}, {"owner": {"reputation": 23625, "user_id": 2868801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ec5567811049b7ce8192be0bc0246d1?s=128&d=identicon&r=PG&f=1", "display_name": "dave_thompson_085", "link": "https://stackoverflow.com/users/2868801/dave-thompson-085"}, "edited": false, "score": 2, "creation_date": 1567554302, "post_id": 57779761, "comment_id": 101994390, "body": "All of the different sockaddr_xxx structures have an xxx_family field at the beginning and that field specifies which format is used for the rest of the structure. It&#39;s kind of like a C <code>union</code> but without the need for every compilation to include hundreds or thousands of header files covering all of the possibilities that can occur in the union."}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "reply_to_user": {"reputation": 23625, "user_id": 2868801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ec5567811049b7ce8192be0bc0246d1?s=128&d=identicon&r=PG&f=1", "display_name": "dave_thompson_085", "link": "https://stackoverflow.com/users/2868801/dave-thompson-085"}, "edited": false, "score": 0, "creation_date": 1567554750, "post_id": 57779761, "comment_id": 101994459, "body": "@dave_thompson_085: It&#39;s also poorly designed such that, if you try to use it as such, you invoke undefined behavior. :-( Using <code>sa_family</code> safely (and in general, using <code>sockaddr</code> family structs safely at all) is very difficult, and generally should be avoided. Use <code>getnameinfo</code> and <code>getaddrinfo</code> instead and you don&#39;t have to."}, {"owner": {"reputation": 38064, "user_id": 683080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69ad2af1f028b1b7e76c14f83bdf26cb?s=128&d=identicon&r=PG", "display_name": "John Szakmeister", "link": "https://stackoverflow.com/users/683080/john-szakmeister"}, "edited": false, "score": 0, "creation_date": 1567556737, "post_id": 57779761, "comment_id": 101994781, "body": "What dave_thompson_085 said.  You should view the sockaddr_xxx variants as a giant union.  If you look at functions like <code>bind()</code>, they don&#39;t take a <code>struct sockaddr_in *</code> but a <code>struct sockaddr *</code>, which you get by casting a your specific type (<code>sockaddr_in</code>) to the generic <code>sockaddr</code> type.  As R said, it is fraught with issues."}, {"owner": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "reply_to_user": {"reputation": 38064, "user_id": 683080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69ad2af1f028b1b7e76c14f83bdf26cb?s=128&d=identicon&r=PG", "display_name": "John Szakmeister", "link": "https://stackoverflow.com/users/683080/john-szakmeister"}, "edited": false, "score": 0, "creation_date": 1567556973, "post_id": 57779761, "comment_id": 101994817, "body": "@JohnSzakmeister Would it be correct to say that because sockaddr_in is cast to sockaddr, the sa-family property must exist, so that the sockaddr struct is aware of the family of addresses to use?"}, {"owner": {"reputation": 38064, "user_id": 683080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69ad2af1f028b1b7e76c14f83bdf26cb?s=128&d=identicon&r=PG", "display_name": "John Szakmeister", "link": "https://stackoverflow.com/users/683080/john-szakmeister"}, "edited": false, "score": 0, "creation_date": 1567585134, "post_id": 57779761, "comment_id": 102002120, "body": "Yes, exactly. :-)"}], "answers": [{"tags": [], "owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "is_accepted": false, "score": 3, "last_activity_date": 1567554292, "creation_date": 1567554292, "answer_id": 57779862, "question_id": 57779761, "link": "https://stackoverflow.com/questions/57779761/why-does-the-sin-family-member-exist/57779862#57779862", "title": "Why does the sin_family member exist?", "body": "<p>See the <code>getsockname</code> and <code>getpeername</code> functions. These may operate on sockets you <em>inherited</em> via exec, e.g. from inetd, where since you did no create them you have no a priori knowledge of the address family involved. Having the family be part of the address allows you to determine how to interpret the address.</p>\n\n<p>It also makes it possible to use <code>getaddrinfo</code> and <code>getnameinfo</code> to write address-family-agnostic code (no hard-coding of IPv4 or v6). With these APIs, <code>struct sockaddr</code> and its variants should be treated as entirely opaque types, which carry their own specific type identifier only for use by the interfaces you pass them to. (This is analogous to certain uses of inheritance in C++.)</p>\n"}, {"tags": [], "owner": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "is_accepted": true, "score": 4, "last_activity_date": 1567557131, "creation_date": 1567557131, "answer_id": 57780111, "question_id": 57779761, "link": "https://stackoverflow.com/questions/57779761/why-does-the-sin-family-member-exist/57780111#57780111", "title": "Why does the sin_family member exist?", "body": "<p>It's true the <code>sin_family</code> member of <code>struct sockaddr_in</code> must always be <code>AF_INET</code>. The reason for this is so that it's possible to tell the actual type of a generalized socket descriptor.</p>\n\n<p><code>struct sockaddr_in</code> is one of several types of socket address descriptors, with different members depending on the network protocol:</p>\n\n<pre><code>struct sockaddr_in {\n    sa_family_t    sin_family; /* always AF_INET */\n    in_port_t      sin_port;\n    struct in_addr sin_addr;\n};\n\nstruct sockaddr_in6 {\n    sa_family_t     sin6_family; /* always AF_INET6 */\n    in_port_t       sin6_port;\n    uint32_t        sin6_flowinfo;\n    struct in6_addr sin6_addr;\n    uint32_t        sin6_scope_id;\n};\n\nstruct sockaddr_un {\n    sa_family_t  sun_family; /* always AF_UNIX */\n    char         sun_path[108];\n};\n\n/* and more ... */\n</code></pre>\n\n<p>Some POSIX functions like <code>bind</code> and <code>accept</code> take a pointer to <code>struct sockaddr</code>, a dummy type that just has the initial <code>sa_family_t sa_family;</code> member.  So they, or other code, can deal with any one of those structs cast to a [<code>const</code>] <code>struct sockaddr*</code> pointer by checking the protocol family, and then casting back to the actual type based on that value.</p>\n\n<p>For example, a logging wrapper around <code>bind</code> might do:</p>\n\n<pre><code>int loggable_bind(int sockfd, const struct sockaddr* addr, socklen_t addrlen)\n{\n    bool do_log = logging_enabled();\n    if (do_log) {\n        switch (addr-&gt;sa_family) {\n        case AF_INET: {\n            const struct sockaddr_in* addr_in = (const struct sockaddr_in*) addr;\n            printf(\"bind: fd=%d family=AF_INET addr=%s port=%u\",\n                   sockfd,\n                   inet_ntoa(addr_in-&gt;sin_addr),\n                   (unsigned) addr_in-&gt;sin_port);\n            break;\n        }\n        case AF_INET6: {\n            const struct sockaddr_in6* addr_in6 = (const struct sockaddr_in6*) addr;\n            printf(\"bind: fd=%d family=AF_INET6 addr=%.*s port=%u\",\n                   sockfd,\n                   sizeof(addr_in6-&gt;sin6_addr.s6_addr),\n                   (const char*) addr_in6-&gt;sin6_addr.s6_addr,\n                   (unsigned) addr6_in-&gt;sin6_port);\n            break;\n        }\n        case AF_UNIX: {\n            const struct sockaddr_un* addr_un = (const struct sockaddr_un*) addr;\n            if (addrlen == sizeof(sa_family_t)) {\n                printf(\"bind: fd=%d family=AF_UNIX Unnamed\");\n            } else if (addr_un-&gt;sun_path[0] == '\\0') {\n                printf(\"bind: fd=%d family=AF_UNIX Abstract, path='\");\n                for (size_t i=1; i&lt;(addrlen-offsetof(struct sockaddr_un, sun_path)); ++i) {\n                    int c = (unsigned char) addr_un-&gt;sun_path[i];\n                    if (isprint(c))\n                        putchar(c);\n                    else\n                        printf(\"\\\\x%02x\", (unsigned) c);\n                }\n                putchar('\\'');\n            } else {\n                printf(\"bind: fd=%d family=AF_UNIX Named, path=%s\",\n                       fd, addr_un-&gt;sun_path);\n            }\n            break;\n        }\n        default:\n            printf(\"bind: fd=%d family=%u\", fd, (unsigned) addr-&gt;sa_family);\n            break;\n        }\n    }\n    int result = bind(fd, addr, addrlen);\n    if (do_log) {\n        int local_err = errno;\n        printf(\" -&gt; %d\\n\", result);\n        if (result &lt; 0)\n            printf(\"  errno=%d: %s\\n\", local_err, strerror(local_err));\n    }\n    return result;\n}\n</code></pre>\n"}], "owner": {"reputation": 319, "user_id": 11923251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dca75f80755c3c08edba8a539cd399d?s=128&d=identicon&r=PG&f=1", "display_name": "duper21", "link": "https://stackoverflow.com/users/11923251/duper21"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1813, "favorite_count": 0, "accepted_answer_id": 57780111, "answer_count": 2, "score": 3, "last_activity_date": 1567557131, "creation_date": 1567553293, "question_id": 57779761, "link": "https://stackoverflow.com/questions/57779761/why-does-the-sin-family-member-exist", "title": "Why does the sin_family member exist?", "body": "<p>If I am using the struct sockaddr_in, the address family is already specified in any sockets I create. </p>\n\n<p>Furthermore,it seems redundant to use the sin_family member if it must always be AF_INET. </p>\n\n<p>So why does the sin_family member exist?  </p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 358, "user_id": 11365663, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2msqx.png?s=128&g=1", "display_name": "Ammar Askar", "link": "https://stackoverflow.com/users/11365663/ammar-askar"}, "edited": false, "score": 1, "creation_date": 1567553142, "post_id": 57779741, "comment_id": 101994223, "body": "hint: what kind of values are integers?"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 2, "creation_date": 1567553240, "post_id": 57779741, "comment_id": 101994238, "body": "<code>int</code> and <code>&quot;%d&quot;</code> are for integers. If you want floating point values, try <code>double</code> and <code>&quot;%lf&quot;</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1567641836, "post_id": 57779741, "comment_id": 102026733, "body": "OT: when calling any of the <code>scanf()</code> family of functions, always check the returned value (not the parameter values) to assure the operation was successful.  Note: those functions return the number of successful &#39;input format conversion specifiers&#39; ( the <code>%d</code> is a &#39;input format conversion specifier`)"}], "answers": [{"tags": [], "owner": {"reputation": 40086, "user_id": 499581, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1ba2cebc4582467916f2ddd6128447f4?s=128&d=identicon&r=PG", "display_name": "l&#39;L&#39;l", "link": "https://stackoverflow.com/users/499581/lll"}, "is_accepted": true, "score": 3, "last_activity_date": 1567553645, "creation_date": 1567553645, "answer_id": 57779805, "question_id": 57779741, "link": "https://stackoverflow.com/questions/57779741/program-not-outputting-correctly/57779805#57779805", "title": "Program not outputting correctly", "body": "<p>As mentioned in the comments, you are using <code>int</code> instead of <code>float</code> or <code>double</code>, therefore you won't get the precision that you require. Also your conversion for miles to km is incorrect; there are <code>1.60934</code> kilometers for every <code>1</code> mile.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void) {\n\ndouble kilometers;\ndouble miles;\n\nprintf(\"\\nPlease enter the distance in miles: \");\nscanf(\"%lf\", &amp;miles);\nprintf(\"\\n\");\n\nkilometers = 1.60934 * miles;\n\nprintf(\"%.2lf miles is equal to \", miles);\nprintf(\"%.2lf kilometers\\n\\n\", kilometers);\n\nreturn 0;\n\n}\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 11038750, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-sj4dNWUYzVo/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOuVucboObVTrEQV_Uen5iaAdAubA/mo/photo.jpg?sz=128", "display_name": "Truong", "link": "https://stackoverflow.com/users/11038750/truong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 57779805, "answer_count": 1, "score": 0, "last_activity_date": 1567553645, "creation_date": 1567552991, "question_id": 57779741, "link": "https://stackoverflow.com/questions/57779741/program-not-outputting-correctly", "title": "Program not outputting correctly", "body": "<p>My program doesn't output correctly when I enter 1 mile</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void)\n{\nint kilometers;\n\nint miles;\n\nprintf(\"\\n\");\nprintf(\"Please enter the distance in miles: \");\nscanf(\"%d\", &amp;miles);\nprintf(\"\\n\");\n\nkilometers = 1.52 * miles;\n\nprintf(\"%d miles is equal to \", miles);\n\nprintf(\"%d kilometers\", kilometers);\nprintf(\"\\n\\n\");\n\nreturn 0;\n\n}\n</code></pre>\n\n<p>When I put 1 in for miles it should output to 1.52 kilometers but gives me 1 kilometer</p>\n"}, {"tags": ["c", "linux", "object", "archive"], "answers": [{"tags": [], "owner": {"reputation": 5773, "user_id": 3525545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Rge03.jpg?s=128&g=1", "display_name": "Mahonri Moriancumer", "link": "https://stackoverflow.com/users/3525545/mahonri-moriancumer"}, "is_accepted": false, "score": 1, "last_activity_date": 1567556518, "creation_date": 1567556518, "answer_id": 57780059, "question_id": 57779708, "link": "https://stackoverflow.com/questions/57779708/how-to-find-dependency-between-objects-files/57780059#57780059", "title": "How to find dependency between objects files?", "body": "<p>1) How can I find out if is there any dependency between objects files?</p>\n\n<p>Object files don't specify specific dependencies on other specific object files.  Rather the object file linker notes what each object file exports, and what it requires to be resolved.  The resulting (executable) file that is output from the linker has no unresolved references.</p>\n\n<p>Use the 'nm' utility. See man nm for detail.</p>\n\n<p>Example:</p>\n\n<pre><code>$ nm somefile.o\n</code></pre>\n\n<p>It will list all text (code segment) symbols, and their offsets (with the letter \"T\").  It will list all undefined references (with the letter \"U\") that have to be resolved at link time.</p>\n"}], "owner": {"reputation": 155, "user_id": 11472054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e187041679a0b6f232b2dfa940b634f?s=128&d=identicon&r=PG", "display_name": "Keystone", "link": "https://stackoverflow.com/users/11472054/keystone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 329, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567556518, "creation_date": 1567552642, "question_id": 57779708, "link": "https://stackoverflow.com/questions/57779708/how-to-find-dependency-between-objects-files", "title": "How to find dependency between objects files?", "body": "<p>I have archive file that contains some objects files.</p>\n\n<p>1) How can I find out if is there any dependency between objects files?</p>\n\n<p>For example in <a href=\"https://www.thegeekstuff.com/2010/08/ar-command-examples/\" rel=\"nofollow noreferrer\">this article</a> I have <code>multiplication.o subtraction.o</code> in <code>libarith.a</code>. So if I want use only in function from 1 object file I want to remove the rest of objects files (ignore from the compiler) from archive file.</p>\n\n<p>So how can I check if multiplication.o depending with subtraction.o</p>\n\n<p>2)How can I view all exported functions from archive/objects files?</p>\n"}, {"tags": ["c", "arrays", "pointers", "struct"], "comments": [{"owner": {"reputation": 2385, "user_id": 1009270, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/33fcdc9c0604cf69abb15e17840d2a3c?s=128&d=identicon&r=PG", "display_name": "john elemans", "link": "https://stackoverflow.com/users/1009270/john-elemans"}, "edited": false, "score": 0, "creation_date": 1567552489, "post_id": 57779644, "comment_id": 101994138, "body": "you don&#39;t need &amp;p[I]. p is not an array, it&#39;s a pointer to a struct. advance p each time you want to address a different struct. But this is still not what you want. you should have an array of pointers to structs."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1567557274, "post_id": 57779644, "comment_id": 101994871, "body": "Change the return type for <code>cadastroProdutos</code> to something meaningful that can indicate <b><i>success/failure</i></b> since you are taking <i>User-Input</i> within the function. (<code>int 1&#47;0</code> is fine). Otherwise you have no way to respond to an input failure (which at present you are not even checking for -- always check the <b>return</b> of every input function used -- especially User-Input -- they don&#39;t always get it right...) A <code>void</code> return type is only appropriate where the function can have no side effects, like a function that simply prints information."}], "answers": [{"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1567557499, "post_id": 57779793, "comment_id": 101994904, "body": "It is always helpful to explain that the postfix <code>[...]</code> operates as a <i>dereference</i> to the pointer just as the unary <code>&#39;*&#39;</code> operator does. (it kind of helps it sink in)"}], "tags": [], "owner": {"reputation": 19619, "user_id": 4151599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dpkLj.jpg?s=128&g=1", "display_name": "Miles Budnek", "link": "https://stackoverflow.com/users/4151599/miles-budnek"}, "is_accepted": false, "score": 0, "last_activity_date": 1567553996, "last_edit_date": 1567553996, "creation_date": 1567553507, "answer_id": 57779793, "question_id": 57779644, "link": "https://stackoverflow.com/questions/57779644/how-to-dynamically-allocate-an-struct-pointer/57779793#57779793", "title": "How to dynamically allocate an struct + pointer", "body": "<p><code>p[i]</code> is a <code>struct produtos</code>, not a <code>struct productos*</code>.  That means, to access its members you use the <code>.</code> operator, not <code>-&gt;</code>.  i.e.</p>\n\n<pre><code>printf(\"Insira o ID: \");\nscanf(\"%d\", &amp;p[i].id);\nprintf(\"Insira o nome: \");\nscanf(\"%s\",  p[i].nm);\nprintf(\"Insira o valor: \");\nscanf(\"%f\", &amp;p[i].vlrs);\nprintf(\"Insira a quantidade: \");\nscanf(\"%d\", &amp;p[i].quant);\n</code></pre>\n\n<p>This is no different than it would be had you defined <code>p</code> as an array in <code>main</code>.  When you pass an array to a function it decays to a pointer to its first element.  For example:</p>\n\n<pre><code>// This passes a pointer to the first element of an\n// array of produtos to cadastroProdutos\nstruct produtos p1[5];\ncadastroProdutos(p1, 5);\n// This also passes a pointer to the first element\n// of an array of produtos to cadastroProdutos\nstruct produtos* p2 = malloc(5 * sizeof(struct produtos));\ncadastroProdutos(p2, 5);\n</code></pre>\n\n<p>From the perspective of the <code>cadastroProdutos</code> function, those two calls are exactly the same.  In both cases, it just receives a pointer to the first element of an array and the size of the array.</p>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 9679297, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tO9_op2Wi_c/AAAAAAAAAAI/AAAAAAAAnNg/8I2Mo9Uq1qo/photo.jpg?sz=128", "display_name": "Lelre Ferreira", "link": "https://stackoverflow.com/users/9679297/lelre-ferreira"}, "edited": false, "score": 0, "creation_date": 1567636635, "post_id": 57781939, "comment_id": 102025786, "body": "Thank you Sir. I wish my professor were you. I really appreciate your help. There&#39;re some stuff in your code that I have never seen before, it&#39;s because you&#39;re in a higher level of coding than I am, although you&#39;ve used some stuff in C that I have never seen before, I&#39;m going to study your code and google some stuff.  For example the way you receive date from user, using stdin, stdout, fputs and so son... Thank you again Sir."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 13, "user_id": 9679297, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tO9_op2Wi_c/AAAAAAAAAAI/AAAAAAAAnNg/8I2Mo9Uq1qo/photo.jpg?sz=128", "display_name": "Lelre Ferreira", "link": "https://stackoverflow.com/users/9679297/lelre-ferreira"}, "edited": false, "score": 0, "creation_date": 1567640442, "post_id": 57781939, "comment_id": 102026482, "body": "@LelreFerreira if you run into problems and need clarification, just drop a comment and I&#39;m happy to help further. C is a fantastic language, and learning C is a journey -- not a race. So don&#39;t worry about it feeling daunting, you learn C the same way you eat a whale -- one byte at a time..."}], "tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": true, "score": 0, "last_activity_date": 1567574597, "creation_date": 1567574597, "answer_id": 57781939, "question_id": 57779644, "link": "https://stackoverflow.com/questions/57779644/how-to-dynamically-allocate-an-struct-pointer/57781939#57781939", "title": "How to dynamically allocate an struct + pointer", "body": "<p>You missed understanding that the <code>[..]</code> operator applied to your pointer <code>p</code> (e.g. <code>p[0]</code>) acts as a dereference making the type <code>struct produtos</code> and the <code>'.'</code> operator proper (instead of <code>struct produtos*</code> as noted in <a href=\"https://stackoverflow.com/users/4151599/miles-budnek\">@MilesBudnek's</a> answer.</p>\n\n<p>Aside from your <code>'.'</code> or <code>'-&gt;'</code> operator problem, you seem to be missing the point on dynamically allocating. While it is fine to start with <code>#define size 5</code> allocated structs, the point of dynamically allocating memory is being able to handle your 6th struct seamlessly by reallocating additional memory on as as-needed basis to handle all your input (or until your run out of available memory).</p>\n\n<p>The way you currently have your function <code>cadastroProdutos</code> written, doesn't really make a clean dynamic allocation possible (in addition to the fact it returns <code>void</code> and there is no validation of any input within it). Rather than looping <code>size</code> times within your function, you simply want to get 1-struct worth of data each time <code>cadastroProdutos</code> is called. That way you can call it as many times as needed until all your data is entered. There is no need to loop within your function, and your use of <code>scanf</code> is horribly fragile as you have no way to handle characters left in <code>stdin</code> due to a <em>matching failure</em> or simply stray characters accidentally typed, (e.g. <code>'a'</code> typed for <code>id</code>, or a name longer than <code>49</code> characters, etc.)</p>\n\n<p>To resolve a majority of the problems, don't use <code>scanf</code> for User-Input, instead read all User-Input into a temporary buffer of reasonable size (e.g. <code>1024</code> characters or so) and then parse the needed information from the buffer using <code>sscanf</code>. This has the double-benefit of allowing separate validation of both the read and parse; and by using a reasonable sized buffer you eliminate the extraneous character problem (such as a cat stepping on the keyboard) by consuming a complete line of input every time.</p>\n\n<p>Your <code>cadastroProdutos</code> which takes input, provides no meaningful return to indicate success/failure of the input leaving your function susceptible to <em>Undefined Behavior</em> if any one input fails. So validate EVERY user input by checking the return of the function(s) used. Of any input failure, returning <code>0</code> for <em>failure</em>, and non-zero on <em>success</em> allows you to handle any input failure back in the calling function.</p>\n\n<p>(<strong>note:</strong> counting types should use <code>size_t</code> instead of <code>int</code>)</p>\n\n<p>Putting those changes together for your <code>cadastroProdutos</code>, you could do something similar to:</p>\n\n<pre><code>size_t cadastroProdutos (produtos *p, size_t *tamanho)\n{\n    produtos tmp;       /* temporary struct */\n    char buf[MAXC];     /* temporary buffer */\n\n    /* prompt, read-line, validate parse */\n    fputs (\"\\nInsira o ID: \", stdout);\n    if (!fgets (buf, MAXC, stdin) || sscanf (buf, \"%d\", &amp;tmp.id) != 1)\n        return 0;   /* (failure) */\n\n    fputs (\"Insira o nome: \", stdout);\n    if (!fgets (buf, MAXC, stdin) || sscanf (buf, \"%49[^\\n]\", tmp.nm) != 1)\n        return 0;\n\n    fputs (\"Insira o valor: \", stdout);\n    if (!fgets (buf, MAXC, stdin) || sscanf (buf, \"%f\", &amp;tmp.vlrs) != 1)\n        return 0;\n\n    fputs (\"Insira a quantidade: \", stdout);\n    if (!fgets (buf, MAXC, stdin) || sscanf (buf, \"%d\", &amp;tmp.quant) != 1)\n        return 0;\n\n    p[(*tamanho)++] = tmp;  /* assign tmp to p[*tamanho], increment */\n\n    return *tamanho;    /* return tamanho (success) */\n}\n</code></pre>\n\n<p>(<strong>note:</strong> <code>tamanho</code> is passed as a pointer so its number can be updated within the function, and <code>0</code> is returned on failure, while the updated <code>tamanho</code> is returned on success allowing you a meaningful return of type <code>size_t</code>)</p>\n\n<p>Avoid using <em>magic-numbers</em> in your code. You did a good job defining a constant for <code>size</code>, now just fining defining the constants you need so there are no more <em>magic-numbers</em> like <code>char nm[50];</code> with it. Doing that you could use a couple more <code>#define</code>, e.g.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define PROD 2      /* initial no. of struct to allocate */\n#define NMSZ 50     /* max name size */\n#define MAXC 1024   /* reasonable no. of chars for temporary buffer */\n\ntypedef struct {    /* a typedef used for convenience */\n    int id;\n    int quant;\n    float vlrs;\n    char nm[NMSZ];\n} produtos;\n</code></pre>\n\n<p>Now all you need to do in <code>main()</code> is to declare a temporary buffer to hold the line, and <code>size_t</code> values, the total number of struct currently allocated (<code>allocated</code>) and the number filled (<code>tomanho</code>) which leads to a simple check at the start of each loop <code>if (tomanho == allocated)</code>, you know you need to <code>realloc</code> additional struct before attempting to fill any more. Your <code>main()</code> function can essentially be:</p>\n\n<pre><code>int main (void) {\n\n    size_t  allocated = PROD,   /* initial number of struct to allocate */\n            tomanho = 0;        /* number of allocated structs used */\n    produtos *p = malloc (allocated * sizeof *p);   /* allocate */\n\n    if (!p) {   /* validate EVERY allocation */\n        perror (\"malloc-p\");\n        return 1;\n    }\n\n    while (cadastroProdutos (p, &amp;tomanho)) {    /* loop validating return */\n        char buf[MAXC];                         /* buffer for input (y/n) */\n        if (tomanho == allocated) { /* is a realloc needed to add struct? */\n            /* always realloc with a temporary pointer */\n            void *tmp = realloc (p, 2 * allocated * sizeof *p);\n            if (!tmp) {     /* validate the reallocation */\n                perror (\"realloc-p\");\n                break;      /* realloc failed, original p still good, break */\n            }\n            p = tmp;        /* assign new block of mem to p */\n            allocated *= 2; /* update no. of structs allocated */\n        }\n\n        fputs (\"\\n  add another (y/n)? \", stdout);  /* add more produtos? */\n        if (!fgets (buf, MAXC, stdin) || !(*buf == 'y' || *buf == 'Y')) {\n            putchar ('\\n');\n            break;\n        }\n    }\n</code></pre>\n\n<p>At this point all your struct are filled and stored in <code>p</code> and all you need to do is whatever you need to do with your data (simply output below) and then <code>free()</code> the memory your have allocated, e.g.</p>\n\n<pre><code>    for (size_t i = 0; i &lt; tomanho; i++)    /* loop showing stored data */\n        printf (\"p[%2zu] %4d  %-20s  %6.2f  %4d\\n\",\n                i, p[i].id, p[i].nm, p[i].vlrs, p[i].quant);\n\n    free (p);   /* don't forget to free memory you allocate */\n}\n</code></pre>\n\n<p>Putting it altogether in a short example, you could do:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define PROD 2      /* initial no. of struct to allocate */\n#define NMSZ 50     /* max name size */\n#define MAXC 1024   /* reasonable no. of chars for temporary buffer */\n\ntypedef struct {    /* a typedef used for convenience */\n    int id;\n    int quant;\n    float vlrs;\n    char nm[NMSZ];\n} produtos;\n\nsize_t cadastroProdutos (produtos *p, size_t *tamanho)\n{\n    produtos tmp;       /* temporary struct */\n    char buf[MAXC];     /* temporary buffer */\n\n    /* prompt, read-line, validate parse */\n    fputs (\"\\nInsira o ID: \", stdout);\n    if (!fgets (buf, MAXC, stdin) || sscanf (buf, \"%d\", &amp;tmp.id) != 1)\n        return 0;   /* (failure) */\n\n    fputs (\"Insira o nome: \", stdout);\n    if (!fgets (buf, MAXC, stdin) || sscanf (buf, \"%49[^\\n]\", tmp.nm) != 1)\n        return 0;\n\n    fputs (\"Insira o valor: \", stdout);\n    if (!fgets (buf, MAXC, stdin) || sscanf (buf, \"%f\", &amp;tmp.vlrs) != 1)\n        return 0;\n\n    fputs (\"Insira a quantidade: \", stdout);\n    if (!fgets (buf, MAXC, stdin) || sscanf (buf, \"%d\", &amp;tmp.quant) != 1)\n        return 0;\n\n    p[(*tamanho)++] = tmp;  /* assign tmp to p[*tamanho], increment */\n\n    return *tamanho;    /* return tamanho (success) */\n}\n\nint main (void) {\n\n    size_t  allocated = PROD,   /* initial number of struct to allocate */\n            tomanho = 0;        /* number of allocated structs used */\n    produtos *p = malloc (allocated * sizeof *p);   /* allocate */\n\n    if (!p) {   /* validate EVERY allocation */\n        perror (\"malloc-p\");\n        return 1;\n    }\n\n    while (cadastroProdutos (p, &amp;tomanho)) {    /* loop validating return */\n        char buf[MAXC];                         /* buffer for input (y/n) */\n        if (tomanho == allocated) { /* is a realloc needed to add struct? */\n            /* always realloc with a temporary pointer */\n            void *tmp = realloc (p, 2 * allocated * sizeof *p);\n            if (!tmp) {     /* validate the reallocation */\n                perror (\"realloc-p\");\n                break;      /* realloc failed, original p still good, break */\n            }\n            p = tmp;        /* assign new block of mem to p */\n            allocated *= 2; /* update no. of structs allocated */\n        }\n\n        fputs (\"\\n  add another (y/n)? \", stdout);  /* add more produtos? */\n        if (!fgets (buf, MAXC, stdin) || !(*buf == 'y' || *buf == 'Y')) {\n            putchar ('\\n');\n            break;\n        }\n    }\n\n    for (size_t i = 0; i &lt; tomanho; i++)    /* loop showing stored data */\n        printf (\"p[%2zu] %4d  %-20s  %6.2f  %4d\\n\",\n                i, p[i].id, p[i].nm, p[i].vlrs, p[i].quant);\n\n    free (p);   /* don't forget to free memory you allocate */\n}\n</code></pre>\n\n<p>(<strong>note:</strong> a simple <code>add another (y/n)?</code> prompt is added to determine if the user wants to add more data)</p>\n\n<p><strong>Example Use/Output</strong></p>\n\n<p>Above we start with 2-allocated struct, and then proceed to enter 6 struct, forcing a reallocation to take place. An example could be:</p>\n\n<pre><code>$ ./bin/produtos\n\nInsira o ID: 1\nInsira o nome: John Brown\nInsira o valor: 12.34\nInsira a quantidade: 415\n\n  add another (y/n)? y\n\nInsira o ID: 2\nInsira o nome: Mary Brown\nInsira o valor: 23.45\nInsira a quantidade: 416\n\n  add another (y/n)? y\n\nInsira o ID: 3\nInsira o nome: Mickey Mouse\nInsira o valor: 34.56\nInsira a quantidade: 417\n\n  add another (y/n)? y\n\nInsira o ID: 4\nInsira o nome: Minnie Mouse\nInsira o valor: 45.67\nInsira a quantidade: 418\n\n  add another (y/n)? y\n\nInsira o ID: 5\nInsira o nome: Sam Clemens\nInsira o valor: 56.78\nInsira a quantidade: 419\n\n  add another (y/n)? y\n\nInsira o ID: 6\nInsira o nome: Mark Twain\nInsira o valor: 67.89\nInsira a quantidade: 420\n\n  add another (y/n)? n\n\np[ 0]    1  John Brown             12.34   415\np[ 1]    2  Mary Brown             23.45   416\np[ 2]    3  Mickey Mouse           34.56   417\np[ 3]    4  Minnie Mouse           45.67   418\np[ 4]    5  Sam Clemens            56.78   419\np[ 5]    6  Mark Twain             67.89   420\n</code></pre>\n\n<p>All data is properly stored, and you could have added 1000 more entries if you desired. You should also run any program that uses dynamic memory through a memory error checking program (like <code>valgrind</code> on Linux) that can tell if you have made improper use of a pointer of block of memory you don't own.</p>\n\n<p>A short test redirecting the inputs from a file rather than retyping can confirm whether any memory problems exists, and using the memory checker is simple, just run your program though it, e.g.</p>\n\n<pre><code>$ valgrind ./bin/produtos &lt; dat/produtos.txt\n==12885== Memcheck, a memory error detector\n==12885== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.\n==12885== Using Valgrind-3.12.0 and LibVEX; rerun with -h for copyright info\n==12885== Command: ./bin/produtos\n==12885==\n\nInsira o ID: Insira o nome: Insira o valor: Insira a quantidade:\n  add another (y/n)?\nInsira o ID: Insira o nome: Insira o valor: Insira a quantidade:\n  add another (y/n)?\nInsira o ID: Insira o nome: Insira o valor: Insira a quantidade:\n  add another (y/n)?\nInsira o ID: Insira o nome: Insira o valor: Insira a quantidade:\n  add another (y/n)?\nInsira o ID: Insira o nome: Insira o valor: Insira a quantidade:\n  add another (y/n)?\nInsira o ID: Insira o nome: Insira o valor: Insira a quantidade:\n  add another (y/n)? \np[ 0]    1  John Brown             12.34   415\np[ 1]    2  Mary Brown             23.45   416\np[ 2]    3  Mickey Mouse           34.56   417\np[ 3]    4  Minnie Mouse           45.67   418\np[ 4]    5  Sam Clemens            56.78   419\np[ 5]    6  Mark Twain             67.89   420\n==12885==\n==12885== HEAP SUMMARY:\n==12885==     in use at exit: 0 bytes in 0 blocks\n==12885==   total heap usage: 3 allocs, 3 frees, 896 bytes allocated\n==12885==\n==12885== All heap blocks were freed -- no leaks are possible\n==12885==\n==12885== For counts of detected and suppressed errors, rerun with: -v\n==12885== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)\n</code></pre>\n\n<p>Always confirm <code>\"All heap blocks were freed -- no leaks are possible\"</code> and that there are no errors.</p>\n\n<p>Look things over and let me know if you have further questions.</p>\n"}, {"tags": [], "owner": {"reputation": 354, "user_id": 11727918, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bTaZpiC4KJ8/AAAAAAAAAAI/AAAAAAAAABQ/ycG-qmsyeCA/photo.jpg?sz=128", "display_name": "J CHEN", "link": "https://stackoverflow.com/users/11727918/j-chen"}, "is_accepted": false, "score": 0, "last_activity_date": 1567580800, "creation_date": 1567580800, "answer_id": 57783167, "question_id": 57779644, "link": "https://stackoverflow.com/questions/57779644/how-to-dynamically-allocate-an-struct-pointer/57783167#57783167", "title": "How to dynamically allocate an struct + pointer", "body": "<p>Run this,See the code you will understand</p>\n\n<pre><code>//\n//  7.c\n//  IFTM Exercises\n//\n//  Created by Lelre Ferreira on 8/29/19. Fix by Mr. J CHEN\n//  Copyright \u00a9 2019 Lelre Ferreira. All rights reserved.\n//\n\n#define size 5\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nstruct produtos {\n\n    int id;\n    int quant;\n    float vlrs;\n    char nm[50];\n\n};\n\nvoid cadastroProdutos (struct produtos **p, int tamanho);\nvoid maiorValorProdutos (struct produtos **p, int tamanho);\nvoid maiorEstoqueProdutos (struct produtos **p, int tamanho);\n\nint main (int argc, const char * argv[]){\n\n    struct produtos **p;\n    int tamanho    = 0,i;\n\n    printf(\"Insira quantidade de produtos/itens a serem cadastrados: \");\n    scanf(\"%d\", &amp;tamanho);\n    p = (struct produtos **) malloc(tamanho   * sizeof(struct produtos*));\n    for(i=0;i&lt;tamanho;i++){\n        p[i]=(struct produtos *) malloc(tamanho   * sizeof(struct produtos));\n    }\n    cadastroProdutos(p, tamanho);\n    maiorValorProdutos(p, tamanho);\n    maiorEstoqueProdutos(p, tamanho);\n    for(i=0;i&lt;tamanho;i++){\n        free(p[i]);\n    }\n    free(p);\n    return 0;\n}\n\nvoid cadastroProdutos(struct produtos **p, int tamanho){\n\n    int i = 0;\n    for (i = 0; i &lt; tamanho; i++) {\n\n        printf(\"Insira o ID: \");\n        scanf(\"%d\", &amp;(p[i]-&gt;id));\n        printf(\"Insira o nome: \");\n        scanf(\"%s\",  p[i]-&gt;nm);\n        printf(\"Insira o valor: \");\n        scanf(\"%f\", &amp;(p[i]-&gt;vlrs));\n        printf(\"Insira a quantidade: \");\n        scanf(\"%d\", &amp;(p[i]-&gt;quant));\n\n    }\n}\n\nvoid maiorValorProdutos(struct produtos **p, int tamanho){\n\n\n\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 9679297, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tO9_op2Wi_c/AAAAAAAAAAI/AAAAAAAAnNg/8I2Mo9Uq1qo/photo.jpg?sz=128", "display_name": "Lelre Ferreira", "link": "https://stackoverflow.com/users/9679297/lelre-ferreira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 57781939, "answer_count": 3, "score": 0, "last_activity_date": 1567580800, "creation_date": 1567552028, "question_id": 57779644, "link": "https://stackoverflow.com/questions/57779644/how-to-dynamically-allocate-an-struct-pointer", "title": "How to dynamically allocate an struct + pointer", "body": "<p>I've been trying to find out how to store information from the user in an array of struct, but so far... Not working.</p>\n\n<p>I created the struct, and inside the main I created the pointer to that struct, then I dynamically allocated that struct. But I don't really know how I'm going to get the info from the user, I mean. I know it but it's not working as expected. If I was using only an array of struct, it would be something like this... </p>\n\n<p>&amp;p[i].id //Normal</p>\n\n<p>I tried to use this method but not working, idk why... The code is not completed yet...</p>\n\n<pre><code>//\n//  7.c\n//  IFTM Exercises\n//\n//  Created by Lelre Ferreira on 8/29/19.\n//  Copyright \u00a9 2019 Lelre Ferreira. All rights reserved.\n//\n\n#define size 5\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nstruct produtos {\n\n    int id;\n    int quant;\n    float vlrs;\n    char nm[50];\n\n};\n\nvoid cadastroProdutos (struct produtos *p, int tamanho);\nvoid maiorValorProdutos (struct produtos *p, int tamanho);\nvoid maiorEstoqueProdutos (struct produtos *p, int tamanho);\n\nint main (int argc, const char * argv[]){\n\n    struct produtos *p;\n    int tamanho    = 0;\n\n    printf(\"Insira quantidade de produtos/itens a serem cadastrados: \");\n    scanf(\"%d\", &amp;tamanho);\n    p = (struct produtos *) malloc(tamanho   * sizeof(struct produtos));\n\n    cadastroProdutos(p, tamanho);\n    maiorValorProdutos(p, tamanho);\n    maiorEstoqueProdutos(p, tamanho);\n\n    return 0;\n}\n\nvoid cadastroProdutos(struct produtos *p, int tamanho){\n\n    int i = 0;\n    for (i = 0; i &lt; tamanho; i++) {\n\n        printf(\"Insira o ID: \");\n        scanf(\"%d\", &amp;p[i] -&gt; id);\n        printf(\"Insira o nome: \");\n        scanf(\"%s\",  p[i] -&gt; nm);\n        printf(\"Insira o valor: \");\n        scanf(\"%f\", &amp;p[i] -&gt; vlrs);\n        printf(\"Insira a quantidade: \");\n        scanf(\"%d\", &amp;p[i] -&gt; quant);\n\n    }\n}\n\nvoid maiorValorProdutos(struct produtos *p, int tamanho){\n\n\n\n}\n\nvoid maiorEstoqueProdutos(struct produtos *p, int tamanho){\n\n\n\n}\n</code></pre>\n\n<p>The IDE is giving this error: Cannot take the address of an rvalue of type 'int'...</p>\n"}, {"tags": ["c", "eclipse-cdt"], "comments": [{"owner": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "edited": false, "score": 3, "creation_date": 1567551422, "post_id": 57779577, "comment_id": 101993954, "body": "Is it only eclipse telling you that, or does the error also appear during proper compilation?"}, {"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 1, "creation_date": 1567551486, "post_id": 57779577, "comment_id": 101993968, "body": "Are you on OS X? If you are, then be careful with the double qoutes, because OS X replaces them with quotes that are prettier but are invalid characters for a c program."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567551973, "post_id": 57779577, "comment_id": 101994063, "body": "Nope. Your code is fine (although you might add another <code>\\n</code> after your name)."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1567552361, "post_id": 57779577, "comment_id": 101994115, "body": "Looks fine to me."}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1567552415, "post_id": 57779577, "comment_id": 101994126, "body": "@ChristianGibbons I think the specific tag here that&#39;s causing this issue is <a href=\"https://stackoverflow.com/questions/tagged/eclipse\">eclipse</a>."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 2, "creation_date": 1567554533, "post_id": 57779577, "comment_id": 101994429, "body": "@JL2210 It could be an eclipse-specific issue, but I haven&#39;t seen anything yet to confirm that hypothesis.  I&#39;ve found that new members frequently tag the IDE they are working with whether or not it is actually related to the issue.  Were I to wager on the issue at hand, I&#39;d place much higher odds on the issue being a failure to save before compiling than I would on an issue with the IDE."}, {"owner": {"reputation": 1856, "user_id": 6607497, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/f0a0b03f5bbd44186399f4b0aea38049?s=128&d=identicon&r=PG&f=1", "display_name": "U. Windl", "link": "https://stackoverflow.com/users/6607497/u-windl"}, "edited": false, "score": 0, "creation_date": 1567554742, "post_id": 57779577, "comment_id": 101994458, "body": "Maybe Eclipse wants you to return a value from main. Is it the only error flagged, and does Eclipse recognize you are programming in C? Did you try the classic &quot;Hello, world&quot; program in your Eclipse, too?"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1567568116, "post_id": 57779577, "comment_id": 101996552, "body": "There are no missing semicolons in the code you posted.  The code you posted compiles perfectly for me.  The error you&#39;re seeing must have to do with some discrepancy between what you&#39;ve posted and what you&#39;re compiling; some factor that we can&#39;t see."}], "owner": {"reputation": 31, "user_id": 5565920, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/496f2de86c1e1784b5055de58b0bbb3e?s=128&d=identicon&r=PG&f=1", "display_name": "SProos", "link": "https://stackoverflow.com/users/5565920/sproos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 1, "closed_date": 1567584515, "answer_count": 0, "score": 3, "last_activity_date": 1567572072, "creation_date": 1567551336, "last_edit_date": 1567572072, "question_id": 57779577, "link": "https://stackoverflow.com/questions/57779577/my-code-keeps-giving-me-an-error-for-a-missing-even-though-i-have-one", "closed_reason": "Not suitable for this site", "title": "My code keeps giving me an error for a missing ; even though I have one", "body": "<p>Eclipse keeps telling me that I need a ';' before the '}' but I have one after the second print statement. Is there something I'm missing?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint main(void)\n{\n    printf(\"Welcome to CS1200\");\n    printf(\"\\nMy name is Sam Proos\");\n}\n</code></pre>\n"}, {"tags": ["c", "haskell", "opengl", "glfw"], "comments": [{"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1567553487, "post_id": 57779502, "comment_id": 101994270, "body": "Does de C version works for OGL3.3? You can also try adding <code>glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);</code>"}, {"owner": {"reputation": 846, "user_id": 4904534, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh3.googleusercontent.com/-SY_kYs8we_U/AAAAAAAAAAI/AAAAAAAAAZY/7Ljb0wVhmuA/photo.jpg?sz=128", "display_name": "Ace shinigami", "link": "https://stackoverflow.com/users/4904534/ace-shinigami"}, "reply_to_user": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 1, "creation_date": 1567561256, "post_id": 57779502, "comment_id": 101995500, "body": "no, it doesn&#39;t. Also I&#39;ve tried adding and removing <code>glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);</code> and the Haskell equivalent from their respective programs with no success"}, {"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1567600431, "post_id": 57779502, "comment_id": 102010306, "body": "Old driver may accept only OGL <b>3.2</b> version, and not 3.3 one."}], "answers": [{"comments": [{"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1567600559, "post_id": 57785760, "comment_id": 102010366, "body": "I frequently  see recomending <code>GLFW_OPENGL_FORWARD_COMPAT</code> on OSX. But the <a href=\"https://developer.apple.com/documentation/appkit/nsopenglpixelformat/1436146-opengl_profiles\" rel=\"nofollow noreferrer\">Apple docs</a> and <a href=\"https://developer.apple.com/documentation/appkit/nsopenglpixelformat/1436213-opengl_pixel_format_attributes\" rel=\"nofollow noreferrer\">Apple docs</a> have not this context flag"}, {"owner": {"reputation": 18064, "user_id": 2579738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oXata.png?s=128&g=1", "display_name": "BDL", "link": "https://stackoverflow.com/users/2579738/bdl"}, "reply_to_user": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1567601452, "post_id": 57785760, "comment_id": 102010821, "body": "@Ripi2: As far as I know, macOS core profiles are always forward compatible (they don&#39;t implemented non forward compatible profiles). But I have never check it in detail. The glfw doc states: &quot;The OS only supports forward-compatible core profile contexts for OpenGL versions 3.2 and later.  Before creating an OpenGL context of version 3.2 or later you must set the GLFW_OPENGL_FORWARD_COMPAT&quot; (Source: <a href=\"https://github.com/glfw/glfw/blob/a4d910b4a72f3a85d7be42ea2f91162cdfd28375/include/GLFW/glfw3.h\" rel=\"nofollow noreferrer\">glfw3.h:2583</a>)"}], "tags": [], "owner": {"reputation": 18064, "user_id": 2579738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oXata.png?s=128&g=1", "display_name": "BDL", "link": "https://stackoverflow.com/users/2579738/bdl"}, "is_accepted": true, "score": 3, "last_activity_date": 1567590362, "creation_date": 1567590362, "answer_id": 57785760, "question_id": 57779502, "link": "https://stackoverflow.com/questions/57779502/unable-to-create-window-with-opengl-3-3-context-macos-with-glfw-installed-throug/57785760#57785760", "title": "unable to create window with OpenGL 3.3 context macOS with GLFW installed through brew", "body": "<p>When requesting an OpenGL context on MacOS, two additional flags have to be set:</p>\n\n<pre><code>glfwWindowHint (GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE);\nglfwWindowHint (GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);\n</code></pre>\n"}], "owner": {"reputation": 846, "user_id": 4904534, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh3.googleusercontent.com/-SY_kYs8we_U/AAAAAAAAAAI/AAAAAAAAAZY/7Ljb0wVhmuA/photo.jpg?sz=128", "display_name": "Ace shinigami", "link": "https://stackoverflow.com/users/4904534/ace-shinigami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 57785760, "answer_count": 1, "score": 1, "last_activity_date": 1567590362, "creation_date": 1567550458, "last_edit_date": 1567553735, "question_id": 57779502, "link": "https://stackoverflow.com/questions/57779502/unable-to-create-window-with-opengl-3-3-context-macos-with-glfw-installed-throug", "title": "unable to create window with OpenGL 3.3 context macOS with GLFW installed through brew", "body": "\n\n<p>I am unable to create GLFW windows with versions past 2.1 after install glfw through brew using the command <code>brew install glfw</code>.</p>\n\n<p>basically my problem is that this code works:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified Graphics.UI.GLFW as GLFW\n\nconfigAndCreateWindow :: IO (Maybe GLFW.Window)\nconfigAndCreateWindow = do              \n    GLFW.windowHint (GLFW.WindowHint'ContextVersionMajor 2)\n    GLFW.windowHint (GLFW.WindowHint'ContextVersionMinor 1)\n    GLFW.createWindow 100 100 \"test\" Nothing Nothing\n\nmain :: IO ()\nmain = do\n    GLFW.init\n    maybeWindow &lt;- configAndCreateWindow\n    case maybeWindow of\n        Nothing -&gt; putStrLn \"Failure :(\"\n        Just _ -&gt; putStrLn \"Success!\"\n</code></pre>\n\n<p>but if I change</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>GLFW.windowHint (GLFW.WindowHint'ContextVersionMajor 2)\nGLFW.windowHint (GLFW.WindowHint'ContextVersionMinor 1)\n</code></pre>\n\n<p>to</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>GLFW.windowHint (GLFW.WindowHint'ContextVersionMajor 3)\nGLFW.windowHint (GLFW.WindowHint'ContextVersionMinor 3)\n</code></pre>\n\n<p>it breaks.</p>\n\n<p>Just to make sure it didn't have to do with GLFW-b I also wrote a c program:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#define GLFW_INCLUDE_GL_3\n#include &lt;GLFW/glfw3.h&gt;\n#include &lt;stdio.h&gt;\n\nint main ()\n{\n    glfwInit();\n\n    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 3);\n    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 3);\n\n    GLFWwindow* window = glfwCreateWindow(800, 600, \"GLFW test\", NULL, NULL);\n    if (window == NULL) {\n        printf(\"Success!\");\n    } else {\n        printf(\"Failure :(\");\n    }\n}\n</code></pre>\n\n<p>and if I change context version number it works just like with the Haskell example.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1567549229, "post_id": 57779372, "comment_id": 101993528, "body": "Please include the exact warning you get. Each compiler has their own rules."}, {"owner": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "edited": false, "score": 1, "creation_date": 1567549325, "post_id": 57779372, "comment_id": 101993549, "body": "What is &#39;i&#39;? Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}, {"owner": {"reputation": 3270, "user_id": 3059385, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dc876278926d67b3da29594601fdc82a?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Schneider", "link": "https://stackoverflow.com/users/3059385/christopher-schneider"}, "edited": false, "score": 1, "creation_date": 1567549336, "post_id": 57779372, "comment_id": 101993553, "body": "And what is <code>i &gt; 1</code>? There is no <code>i</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11954200"}, "reply_to_user": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "edited": false, "score": 0, "creation_date": 1567549587, "post_id": 57779372, "comment_id": 101993608, "body": "@machine_1 updated with an example error."}, {"owner": {"reputation": 339, "user_id": 11481911, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4ffd66240439bb9e97191fda1f42ab4?s=128&d=identicon&r=PG&f=1", "display_name": "Ezphares", "link": "https://stackoverflow.com/users/11481911/ezphares"}, "edited": false, "score": 2, "creation_date": 1567549734, "post_id": 57779372, "comment_id": 101993637, "body": "I get the <code>-Wconstant-logical-operand</code> when compiling with clang, and it suggests that the compiler thinks that you might want to use bitwise and. My suspicion is that the reason 0 and 1 does not give the warning is that the compiler converts them to booleans."}, {"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 2, "creation_date": 1567549889, "post_id": 57779372, "comment_id": 101993667, "body": "You didn&#39;t show the actual warning, only the note that follows it. Post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1567551132, "post_id": 57779372, "comment_id": 101993897, "body": "overreach.   disable warnings from the code generator (clang, gcc) and employ a proper static analyzer (lint) if that is what you want.   This is the difference between a project and a product."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 1, "creation_date": 1567551292, "post_id": 57779372, "comment_id": 101993930, "body": "The compiler warnings are intended to catch common programming mistakes, while remaining silent about common programming idioms. They don&#39;t always get it right. OTOH, I don&#39;t see anything in your examples that indicates that they got it wrong."}, {"owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "edited": false, "score": 3, "creation_date": 1567551903, "post_id": 57779372, "comment_id": 101994051, "body": "You&#39;re being bitten by an overzealous linter.  Using <code>&amp;&amp;</code> outside of a control expression for an <code>if</code>, <code>while</code>, <code>for</code>, etc., is unusual, and the compiler is basically saying &quot;are you <i>sure</i> that&#39;s what you meant, because a lot of people write <code>&amp;&amp;</code> when they mean <code>&amp;</code> in this context&quot;.  It&#39;s similar to the warnings you get if you write <code>if ( a = b )</code> - you fully intend for <code>a</code> to be updated as part of the condition, but more often than not people meant to do a comparison and wrote <code>=</code> instead of <code>==</code>, so most compilers issue an &quot;are you sure&quot; warning."}, {"owner": {"reputation": 1149, "user_id": 2472827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t5rYY.jpg?s=128&g=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/2472827/neil"}, "edited": false, "score": 0, "creation_date": 1567554777, "post_id": 57779372, "comment_id": 101994463, "body": "&#39;1&#39; is true, &#39;2&#39; is also true. But why &#39;2&#39;?"}], "answers": [{"tags": [], "owner": {"reputation": 354, "user_id": 11727918, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bTaZpiC4KJ8/AAAAAAAAAAI/AAAAAAAAABQ/ycG-qmsyeCA/photo.jpg?sz=128", "display_name": "J CHEN", "link": "https://stackoverflow.com/users/11727918/j-chen"}, "is_accepted": true, "score": 1, "last_activity_date": 1567574505, "creation_date": 1567574505, "answer_id": 57781921, "question_id": 57779372, "link": "https://stackoverflow.com/questions/57779372/boolean-tests-with-integers-in-c/57781921#57781921", "title": "Boolean tests with integers in C", "body": "<p>For Not 0 value is true, like below</p>\n\n<pre><code>int main(){ \n\n    int i;\n    for(i=-3;i&lt;=3;i++){\n        if(i){\n            printf(\"True :%d\\n\",i);\n        }else{\n            printf(\"False :%d\\n\",i);\n        }\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>So if you don't want warn using &amp; is right in your case</p>\n\n<p>because  0 &amp; X is always 0</p>\n\n<p>and add a function if you only want 0 or 1</p>\n\n<pre><code>int BeBool(int a){\n    if(a){\n        return 1;\n    }\n    return 0;\n}\n</code></pre>\n\n<hr>\n\n<p>int holding_variable = BeBool(2&amp;2); </p>\n\n<p>instead int holding_variable = (2 &amp;&amp; 2);</p>\n\n<hr>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;time.h&gt;\n\nint BeBool(int a){\n    if(a){\n        return 1;\n    }\n    return 0;\n}\n\nint main(){ \n\n    int i;\n    for(i=-3;i&lt;=3;i++){\n        if(i){\n            printf(\"True :%d\\n\",i);\n        }else{\n            printf(\"False :%d\\n\",i);\n        }\n    }\n    int holding_variable = BeBool(2&amp;2);\n    printf(\"Value :%d\\n\",holding_variable);\n    return 0;\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11954200"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 57781921, "answer_count": 1, "score": 0, "last_activity_date": 1567574505, "creation_date": 1567549152, "last_edit_date": 1567550032, "question_id": 57779372, "link": "https://stackoverflow.com/questions/57779372/boolean-tests-with-integers-in-c", "title": "Boolean tests with integers in C", "body": "<p>The following works in C without giving a warning:</p>\n\n<pre><code>int holding_variable = (-5 &amp;&amp; 1);\nint holding_variable = (1 &amp;&amp; 1);\nint holding_variable = (0 &amp;&amp; 0);\n</code></pre>\n\n<p>Yet the following gives warning (numbers are greater than 1):</p>\n\n<pre><code>int holding_variable = (-5 &amp;&amp; 2);\nint holding_variable = (2 &amp;&amp; 2);\n</code></pre>\n\n<p>An example warning would be:</p>\n\n<pre><code>$ gcc main.c -o main.out &amp;&amp; ./main.out\nmain.c:66:28: warning: use of logical '&amp;&amp;' with constant operand [-Wconstant-logical-operand]\n    int holding_variable = (1 &amp;&amp; -1);\n                              ^  ~~\nmain.c:66:28: note: use '&amp;' for a bitwise operation\n    int holding_variable = (1 &amp;&amp; -1);\n                              ^~\n                              &amp;\nmain.c:66:28: note: remove constant to silence this warning\n    int holding_variable = (1 &amp;&amp; -1);\n                             ~^~~~~\n1 warning generated.\n</code></pre>\n\n<p>What accounts for the difference in the above two categories as to why the first will execute but the second ones will not?</p>\n"}, {"tags": ["c", "pointers"], "comments": [{"owner": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "edited": false, "score": 1, "creation_date": 1567548047, "post_id": 57779188, "comment_id": 101993296, "body": "What is your question? What happens and how does it differ from your expectation?"}, {"owner": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "edited": false, "score": 0, "creation_date": 1567548515, "post_id": 57779188, "comment_id": 101993378, "body": "maybe related: <a href=\"https://stackoverflow.com/questions/5499504/shared-c-constants-in-a-header\" title=\"shared c constants in a header\">stackoverflow.com/questions/5499504/&hellip;</a>"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567548951, "post_id": 57779188, "comment_id": 101993470, "body": "We need a full program, not just snippets."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 1, "creation_date": 1567579593, "post_id": 57779188, "comment_id": 101999514, "body": "Gabriele Biagini, what JL2210 is trying to tell you is that making an answer would be much easier and probably more to the point, if you would make a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> to demonstrate your problem. (@JL2210 try typing <code>[mcve]</code> in a comment like that)"}, {"owner": {"reputation": 13, "user_id": 12003012, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ukJMlxkVRuc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdn1FBU-czvq-0SaRscBQpeIx9Ngw/photo.jpg?sz=128", "display_name": "Gabriele Biagini", "link": "https://stackoverflow.com/users/12003012/gabriele-biagini"}, "edited": false, "score": 0, "creation_date": 1567583977, "post_id": 57779188, "comment_id": 102001509, "body": "Sorry for not being much clear, I&#39;ve reformulated the question entirely, hope this helps!"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1567594509, "post_id": 57779188, "comment_id": 102007138, "body": "@Yunnosch I know about those: <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> [main] <a href=\"https://meta.stackoverflow.com\">Meta Stack Overflow</a>, etc."}], "answers": [{"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 0, "last_activity_date": 1567586225, "last_edit_date": 1592644375, "creation_date": 1567586225, "answer_id": 57784589, "question_id": 57779188, "link": "https://stackoverflow.com/questions/57779188/printing-out-an-array-of-pointers-defined-in-header-file/57784589#57784589", "title": "Printing out an array of pointers defined in header file", "body": "<p>There's many basic errors here.</p>\n<ul>\n<li><p>Never declare global variables anywhere, period.</p>\n</li>\n<li><p>Never define variables (or functions) in header files. This always leads to various linking hiccups and bugs where different instances of variables with the same name co-exist in different translation units.</p>\n<p>Instead, move all variable definitions and initializations to file scope inside a .c file, make them <code>static</code> and only let the caller access them through setter/getter functions. They will no longer be global, but note that they are still not thread safe.</p>\n</li>\n<li><p>You cannot use <code>sizeof</code> on a pointer, because pointers are not arrays. It gives the size of the pointer, not the length of the pointed-at string.</p>\n</li>\n</ul>\n"}], "owner": {"reputation": 13, "user_id": 12003012, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ukJMlxkVRuc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdn1FBU-czvq-0SaRscBQpeIx9Ngw/photo.jpg?sz=128", "display_name": "Gabriele Biagini", "link": "https://stackoverflow.com/users/12003012/gabriele-biagini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1567586225, "creation_date": 1567547783, "last_edit_date": 1567585660, "question_id": 57779188, "link": "https://stackoverflow.com/questions/57779188/printing-out-an-array-of-pointers-defined-in-header-file", "title": "Printing out an array of pointers defined in header file", "body": "<p>I'm currently working on a DBMS as a college project, I'm having issues at printing out an array of strings which is defined in an header file.</p>\n\n<p>I've tried playing around with pointers but I guess the problem is within the definition of the array, which being in another file can't be retrieved properly.</p>\n\n<p>Here's metacommand.h file</p>\n\n<pre><code>typedef enum {NORMAL, DB, TABLE} Mode;\n\nconst char* normalModeMetaCommands[] = {\".help\", \".exit\", \".db-mode\", \".table-mode\"};\nconst char* dbModeMetaCommands[] = {\".help\", \".exit\", \".workingdir\", \".dbs\", \".db\"};\nconst char* tableModeMetaCommands[] = {\".help\", \".exit\", \".tables\", \".table\", \".index\", \".select\"};\n\nconst char* getModeName(Mode mode);\nconst char* getModeInputPrompt(Mode mode);\nconst char* getModeMetaCommands(Mode mode);\n\nstatic void print_metacommands();\n</code></pre>\n\n<p>And here's some snippets from database.c file</p>\n\n<pre><code>static Mode mode = NORMAL;\n</code></pre>\n\n<pre><code>const char* getModeMetaCommands(Mode mode) \n{\n   switch (mode) \n   {\n      case NORMAL: return *normalModeMetaCommands;\n      case DB: return *dbModeMetaCommands;\n      case TABLE: return *tableModeMetaCommands;\n   }\n}\n\n</code></pre>\n\n<pre><code>static void print_metacommands(){\n\n    size_t size = sizeof(getModeMetaCommands(mode))/sizeof(getModeMetaCommands(mode)[0]);\n    for(int i=0; i&lt;size; i++){\n        printf(\"%s\\n\", getModeMetaCommands(mode)[i]);\n    }\n\n}\n</code></pre>\n\n<p>I have defined some functions that change the enum value in the database.c file, so that in each mode (NORMAL, DB and TABLE) I can print out an exclusive list of metacommands.</p>\n\n<p>EDIT</p>\n\n<p>My function <code>print_metacommands()</code> doesn't print those char pointers array (*normalModeMetaCommands[], *dbModeMetaCommands[], *tableModeMetaCommands[]).\nOutput is a segFault.</p>\n\n<p>If I change:</p>\n\n<pre><code>const char* getModeMetaCommands(Mode mode);\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>const char** getModeMetaCommands(Mode mode);\n</code></pre>\n\n<p>And:</p>\n\n<pre><code>const char* getModeMetaCommands(Mode mode) \n{\n   switch (mode) \n   {\n      case NORMAL: return *normalModeMetaCommands;\n      case DB: return *dbModeMetaCommands;\n      case TABLE: return *tableModeMetaCommands;\n   }\n}\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>const char** getModeMetaCommands(Mode mode) \n{\n   switch (mode) \n   {\n      case NORMAL: return normalModeMetaCommands;\n      case DB: return dbModeMetaCommands;\n      case TABLE: return tableModeMetaCommands;\n   }\n}\n</code></pre>\n\n<p>The output is only \".help\" because it seems like:</p>\n\n<pre><code>size_t size = sizeof(getModeMetaCommands(mode))/sizeof(getModeMetaCommands(mode)[0]);\n//evaluated to: size=1\n</code></pre>\n\n<p>So, how can I print out those char pointers array via <code>static void print_metacommands();</code>?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 104, "user_id": 4831400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f3eafee7d44e2b6b705846691307309?s=128&d=identicon&r=PG&f=1", "display_name": "alrevuelta", "link": "https://stackoverflow.com/users/4831400/alrevuelta"}, "edited": false, "score": 0, "creation_date": 1567548169, "post_id": 57779104, "comment_id": 101993324, "body": "I would suggest to include also a variable name in the function declaration in your header file (i.e. <code>int varName</code>). You should also double check the second function parameter. In the header file you specify a <code>const struct Charakter*</code> type, but then in the function you have <code>const struct Charater*</code>"}, {"owner": {"reputation": 1856, "user_id": 6607497, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/f0a0b03f5bbd44186399f4b0aea38049?s=128&d=identicon&r=PG&f=1", "display_name": "U. Windl", "link": "https://stackoverflow.com/users/6607497/u-windl"}, "edited": false, "score": 0, "creation_date": 1567553076, "post_id": 57779104, "comment_id": 101994216, "body": "Maybe fix some spelling errors."}, {"owner": {"reputation": 93, "user_id": 11924824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/688bd57ece3f66300b6ca70b3f24f64c?s=128&d=identicon&r=PG&f=1", "display_name": "zombieanfuehrer", "link": "https://stackoverflow.com/users/11924824/zombieanfuehrer"}, "edited": false, "score": 0, "creation_date": 1567568656, "post_id": 57779104, "comment_id": 101996646, "body": "Thank you a lot!  It was just a simple spelling error, I thought I was freaking out."}], "owner": {"reputation": 93, "user_id": 11924824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/688bd57ece3f66300b6ca70b3f24f64c?s=128&d=identicon&r=PG&f=1", "display_name": "zombieanfuehrer", "link": "https://stackoverflow.com/users/11924824/zombieanfuehrer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567547131, "creation_date": 1567547131, "question_id": 57779104, "link": "https://stackoverflow.com/questions/57779104/pointer-in-functions-from-a-pointer-declaration-is-incompatible", "title": "Pointer in Functions from a Pointer: Declaration is incompatible", "body": "<p>I habe problems with some parameters in a funktions.\nThe compiler say the declaration is incompatible, but i didnt see my mistake ?\nThe Funktions calls \"output\"\nSo the declaration is the same as the definition.</p>\n\n<p>I have to add:\nI use structs and varaibles, which i defined in the main function and I pass these on to the output function via pointer to two other functions.</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-css lang-css prettyprint-override\"><code>Header: \r\n#ifndef def_struct_H\r\n#define def_struct_H\r\nvoid output (const char * ,const struct Charakter *,struct Gegner *,int ,int);\r\n#endif \r\n\r\nFunktion \"Output\":\r\n#include &lt;stdio.h&gt;\r\n#include &lt;time.h&gt;\r\n#include &lt;string.h&gt;\r\n#include \"def_DDice.h\"\r\n#include \"def_data.h\"\r\n\r\nvoid output (const char Sitzungsname,const struct Charater* Daten,struct Gegner *NPCs,int SPC_ANZ,int NPC_ANZ) {\r\n\r\n    time_t t = time (NULL);\r\n    struct tm * ts;    \r\n    ts = localtime(&amp;t);\r\n    \r\n    struct sequence Initiativ_Reihenfolge [MAX_C*2];\r\n    struct sequence temp_sort [1];\r\n/*structs zusammen kopieren*/\r\n    int copy;\r\n    for (copy = 0; copy &gt;= SPC_ANZ+NPC_ANZ; ++copy) \r\n    {\r\n        if (copy &lt; NPC_ANZ) {\r\n            memcpy (Initiativ_Reihenfolge[copy].Teilnehmer,NPCs[copy].Name,sizeof((struct Gegner*)0)-&gt;Name);\r\n            memcpy (Initiativ_Reihenfolge[copy].Summe,NPCs[copy].Summe,sizeof((struct Gegner*)0)-&gt;Summe);\r\n        }\r\n        if (copy &gt;= NPC_ANZ &amp;&amp; copy &lt;= SPC_ANZ) {\r\n            memcpy (Initiativ_Reihenfolge[copy].Teilnehmer,Daten/*[copy].Name*/,sizeof((struct Charakter*)0)-&gt;Name);\r\n\r\n        }\r\n        \r\n\r\n/*Bubblesort*/\r\n    int all_1, all_2;\r\n\r\n    for (all_1 = 0; all_1 &lt; MAX_C*2; ++all_1) \r\n    {\r\n        for (all_2 = 0; all_2 &lt; (MAX_C*2)-all_1; ++all_2) \r\n        {\r\n            if (Initiativ_Reihenfolge[all_2].Summe &gt; Initiativ_Reihenfolge[all_2+1].Summe)\r\n            {\r\n                memcpy (&amp;temp_sort,&amp;Initiativ_Reihenfolge[all_2],sizeof(struct sequence)); //??\r\n                memcpy (&amp;Initiativ_Reihenfolge[all_2],&amp;Initiativ_Reihenfolge[all_2+1],sizeof(struct sequence));\r\n                memcpy (&amp;Initiativ_Reihenfolge[all_2+1],&amp;temp_sort,sizeof(struct sequence));                      \r\n            }\r\n        }\r\n    }  \r\n}\r\n\r\nCall in previous function:    \r\noutput (Sitzung,Daten,NPC,SPC_ANZ,NPC_ANZ);</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": ["c", "pointers", "struct", "malloc", "valgrind"], "comments": [{"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 1, "creation_date": 1567545687, "post_id": 57778737, "comment_id": 101992646, "body": "what is wrong with for() loops?  #style"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567545781, "post_id": 57778737, "comment_id": 101992668, "body": "<code>for( i = 0; i &lt; ac; i++ ) { &#47;* ... *&#47; }</code>?"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567545842, "post_id": 57778737, "comment_id": 101992690, "body": "<code>for( ; cur != NULL; next = cur-&gt;next ) { &#47;* ... *&#47; }</code>?"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1567549981, "post_id": 57778737, "comment_id": 101993686, "body": "PSA: <a href=\"https://stackoverflow.com/questions/605845/do-i-cast-the-result-of-malloc\">Don&#39;t cast the result of <code>malloc</code></a>."}], "answers": [{"comments": [{"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 1, "creation_date": 1567546657, "post_id": 57778778, "comment_id": 101992924, "body": "The problem is in <code>begin[0] = prev;</code>. Since <code>begin</code> is <code>&amp;ma</code>, changing <code>begin[0]</code> changes <code>ma</code>. So when you <code>free(ma)</code>, you aren&#39;t freeing the same address you got from <code>malloc</code>."}], "tags": [], "owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "is_accepted": false, "score": 4, "last_activity_date": 1567545343, "last_edit_date": 1567545343, "creation_date": 1567544997, "answer_id": 57778778, "question_id": 57778737, "link": "https://stackoverflow.com/questions/57778737/invalid-free-when-trying-to-reorder-a-linked-list/57778778#57778778", "title": "Invalid free() when trying to reorder a linked list", "body": "<p>You can only pass to <code>free()</code> a pointer that was returned by <code>malloc()/realloc()/calloc()</code> and you are passing a node that is a pointer to a <code>ma</code> plus some offset, precisely <code>&amp;ma[ac - 1]</code>.</p>\n\n<p>You could just change the content of the nodes instead of the nodes themeselves, or just write a normal linked list where every node is just allocated with <code>malloc()</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": false, "score": 2, "last_activity_date": 1567602532, "creation_date": 1567602532, "answer_id": 57789122, "question_id": 57778737, "link": "https://stackoverflow.com/questions/57778737/invalid-free-when-trying-to-reorder-a-linked-list/57789122#57789122", "title": "Invalid free() when trying to reorder a linked list", "body": "<p>You must pass the original pointer returned by <code>malloc()</code> to <code>free()</code>.</p>\n\n<p>Since <code>revarray</code> modifies the pointer received by address, you must save the original pointer to later pass to <code>free()</code>.</p>\n\n<p>Also note that <code>revArray</code> can be simplified by removing the test to set <code>next</code>.</p>\n\n<p>Here is a modified version:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\ntypedef struct myArray {\n    void *data;\n    struct myArray *next;\n} myArray_t;\n\nmyArray_t *paramsToList(int ac, char *const *av) {\n    myArray *ma = (myArray *)malloc(ac * sizeof(myArray));\n    if (ma == NULL)\n        return NULL;\n    for (int i = 0; i &lt; ac; i++) {\n        ma[i].data = av[i];\n        if (i &lt; ac - 1) {\n            ma[i].next = &amp;ma[i + 1];\n        } else {\n            ma[i].next = NULL;\n        }\n    }\n    return ma;\n}\n\nvoid revArray(myArray_t **begin) {\n    myArray *cur = *begin;\n    myArray *prev = NULL;\n    myArray *next = cur-&gt;next;\n    while (cur != NULL) {\n        next = cur-&gt;next;\n        cur-&gt;next = prev;\n        prev = cur;\n        cur = next;\n    }\n    *begin = prev;\n}\n\nint main(int argc, char **argv) {\n    myArray *ma = paramsToList(argc, argv);\n    myArray *orig_ma = ma;\n    revArray(&amp;ma);\n    printArray(ma);\n    free(orig_ma);\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 7082947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a73f70a66c06f6c6875699295823dcb?s=128&d=identicon&r=PG&f=1", "display_name": "fudgeBreadstein", "link": "https://stackoverflow.com/users/7082947/fudgebreadstein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1567602532, "creation_date": 1567544776, "last_edit_date": 1567602129, "question_id": 57778737, "link": "https://stackoverflow.com/questions/57778737/invalid-free-when-trying-to-reorder-a-linked-list", "title": "Invalid free() when trying to reorder a linked list", "body": "<p>I am attempting to reorder a linked list by swapping the pointers around. It works until I try to free the memory and then it gives me an error.</p>\n\n<p>I have gotten it to work, by swapping the data and not the pointers, but I am curious as to why this causes an issue with my memory. Here is my code</p>\n\n<pre><code>typedef struct myArray {\n    void *data;\n    struct myArray *next;\n} myArray_t;\n\nint main(int argc, char **argv) {\n    myArray *ma = paramsToList(argc, argv);\n    revArray(&amp;ma);\n    printArray(ma);\n    free(ma);\n    return 0;\n}\n\nmyArray_t *paramsToList(int ac, char *const *av) {\n    myArray *ma = (myArray*)malloc((ac) * sizeof(myArray));\n    int i = 0;\n    while (i &lt; ac) {\n        ma[i].data = av[i];\n        if (i &lt; ac - 1) {\n            ma[i].next = &amp;ma[i + 1];\n        } else {\n            ma[i].next = NULL;\n        }\n        i++;\n    }\n    return ma;\n}\n\nvoid revArray(myArray_t **begin) {\n    myArray *cur = begin[0];\n    myArray *prev = NULL;\n    myArray *next = cur-&gt;next;\n    while (cur != NULL) {\n        cur-&gt;next = prev;\n        prev = cur;\n        cur = next;\n        if (cur != NULL) {\n            next = cur-&gt;next;\n        }\n    }\n    begin[0] = prev;\n}\n</code></pre>\n\n<p>When I run the code I get this error</p>\n\n<pre><code>valgrind ./a.out one two three\n\nthree\ntwo\none\n./a.out\n==3662== Invalid free() / delete / delete[] / realloc()\n==3662==    at 0x4C2BDEC: free (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==3662==    by 0x400604: main (example.c:20)\n==3662==  Address 0x51fc070 is 48 bytes inside a block of size 64 alloc'd\n==3662==    at 0x4C2AB80: malloc (in /usr/lib/valgrind    /vgpreload_memcheck-amd64-linux.so)\n==3662==    by 0x40062B: paramsToList(int, char* const*) (example.c:26)\n==3662==    by 0x4005DC: main (example.c:17)\n==3662== \n==3662== \n==3662== HEAP SUMMARY:\n==3662==     in use at exit: 64 bytes in 1 blocks\n==3662==   total heap usage: 1 allocs, 1 frees, 64 bytes allocated\n==3662== \n==3662== LEAK SUMMARY:\n==3662==    definitely lost: 64 bytes in 1 blocks\n==3662==    indirectly lost: 0 bytes in 0 blocks\n==3662==      possibly lost: 0 bytes in 0 blocks\n==3662==    still reachable: 0 bytes in 0 blocks\n==3662==         suppressed: 0 bytes in 0 blocks\n==3662== Rerun with --leak-check=full to see details of leaked memory\n==3662== \n==3662== For counts of detected and suppressed errors, rerun with: -v\n==3662== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)\n</code></pre>\n"}, {"tags": ["java", "c", "floating-point", "printf"], "comments": [{"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 1, "creation_date": 1567544431, "post_id": 57778637, "comment_id": 101992260, "body": "Please note that the issue probably has nothing to do with the binary representation but the way the <code>printf</code> function works in each language."}, {"owner": {"reputation": 36902, "user_id": 41655, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/430ea1cba106cc65b7687d66e9df4f06?s=128&d=identicon&r=PG", "display_name": "millimoose", "link": "https://stackoverflow.com/users/41655/millimoose"}, "edited": false, "score": 6, "creation_date": 1567544591, "post_id": 57778637, "comment_id": 101992314, "body": "The default rounding behaviour is a somewhat arbitrary choice. Java <a href=\"https://docs.oracle.com/javase/8/docs/api/java/text/DecimalFormat.html\" rel=\"nofollow noreferrer\">seems to use banker&#39;s rounding</a>, the GNU libc <a href=\"https://www.gnu.org/software/libc/manual/html_node/Rounding-Functions.html\" rel=\"nofollow noreferrer\">seems to round to the nearest integer by default</a>."}, {"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "reply_to_user": {"reputation": 36902, "user_id": 41655, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/430ea1cba106cc65b7687d66e9df4f06?s=128&d=identicon&r=PG", "display_name": "millimoose", "link": "https://stackoverflow.com/users/41655/millimoose"}, "edited": false, "score": 0, "creation_date": 1567544742, "post_id": 57778637, "comment_id": 101992366, "body": "@millimoose you are referring of course to the string representation right?"}, {"owner": {"reputation": 36902, "user_id": 41655, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/430ea1cba106cc65b7687d66e9df4f06?s=128&d=identicon&r=PG", "display_name": "millimoose", "link": "https://stackoverflow.com/users/41655/millimoose"}, "reply_to_user": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 0, "creation_date": 1567544873, "post_id": 57778637, "comment_id": 101992406, "body": "@IharobAlAsimi - Java doesn&#39;t do rounding elsewhere in this case, the CPU rounds the actual floating point representation."}, {"owner": {"reputation": 36902, "user_id": 41655, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/430ea1cba106cc65b7687d66e9df4f06?s=128&d=identicon&r=PG", "display_name": "millimoose", "link": "https://stackoverflow.com/users/41655/millimoose"}, "edited": false, "score": 0, "creation_date": 1567544958, "post_id": 57778637, "comment_id": 101992425, "body": "Also emphasis on &quot;seems to&quot; because I found two contradictory statements about Java and I don&#39;t think the behaviour above is banker&#39;s rounding?"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 1, "creation_date": 1567546359, "post_id": 57778637, "comment_id": 101992817, "body": "The point is: Java will work with the value with the minimum number of digits, that will <b>uniquely identify</b> this value. This is <code>0.644696875</code>, which will be rounded up to <code>0.64469688</code>. In contrast, C will work with the exact double value, which is about <code>0.64469687499999999997363220316515253....</code>; this is rounded <i>down</i> to <code>0.64469687</code>"}, {"owner": {"reputation": 10856, "user_id": 93947, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4cfa27623a7f68e3d297e786e2264d24?s=128&d=identicon&r=PG", "display_name": "gdelfino", "link": "https://stackoverflow.com/users/93947/gdelfino"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1567551724, "post_id": 57778637, "comment_id": 101994015, "body": "@Ctx so it follows then that C is more accurate than Java because it uses the exact double value?"}, {"owner": {"reputation": 36902, "user_id": 41655, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/430ea1cba106cc65b7687d66e9df4f06?s=128&d=identicon&r=PG", "display_name": "millimoose", "link": "https://stackoverflow.com/users/41655/millimoose"}, "edited": false, "score": 0, "creation_date": 1567553587, "post_id": 57778637, "comment_id": 101994280, "body": "@gdelfino No. The value is the same underneath unless something truly bizarre is happening."}, {"owner": {"reputation": 36902, "user_id": 41655, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/430ea1cba106cc65b7687d66e9df4f06?s=128&d=identicon&r=PG", "display_name": "millimoose", "link": "https://stackoverflow.com/users/41655/millimoose"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 1, "creation_date": 1567553858, "post_id": 57778637, "comment_id": 101994318, "body": "@Ctx - what, no, none of what you said is correct. Both Java and C use an uhh 52-bit integer multiplied by 2 to the power of an 11-bit integer exponent. Decimal digits only appear when this representation is converted to a string for humans to use, unless you&#39;re using some arbitrary-precision class there are no decimal digits involved internally."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 36902, "user_id": 41655, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/430ea1cba106cc65b7687d66e9df4f06?s=128&d=identicon&r=PG", "display_name": "millimoose", "link": "https://stackoverflow.com/users/41655/millimoose"}, "edited": false, "score": 0, "creation_date": 1567561541, "post_id": 57778637, "comment_id": 101995540, "body": "@millimoose: CPUs generally do not have instructions to convert strings like \u201c0.644696875\u201d to floating-point. Java has to do that with its own subroutines. Furthermore, Java\u2019s behavior is tightly specified so that the same results are produced on different platforms\u2014each implementation must ensure it operates in the required way, regardless of whether it uses a single CPU instruction to do that or uses complicated subroutines."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 3, "creation_date": 1567561598, "post_id": 57778637, "comment_id": 101995549, "body": "@Ctx: Yes, a C implementation that uses round-to-nearest (the C standard is looser than the Java standard and does not require this) is more accurate than a Java implementation because, per my answer below, Java requires <b>two</b> rounding operations while formatting, and and this increases error."}], "answers": [{"comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567546896, "post_id": 57778753, "comment_id": 101992999, "body": "What&#39;s .22 of a decimal digit?"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 3, "creation_date": 1567550096, "post_id": 57778753, "comment_id": 101993716, "body": "@JL2210 In floating-point terms a very inaccurate representation that will flap between ~2.2 different values instead of the normal 10, or in other words, it&#39;s only 22% accurate, not 100%."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 2, "creation_date": 1567551400, "post_id": 57778753, "comment_id": 101993949, "body": "There is no <code>float</code> (32-bit binary floating-point) involved. If there were, the value would be 0.644696891307830810546875, and we would see \u201c0.64469689\u201d\u2014ending in 9, not 8 or 7."}, {"owner": {"reputation": 75299, "user_id": 139746, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/BhJLC.png?s=128&g=1", "display_name": "Pascal Cuoq", "link": "https://stackoverflow.com/users/139746/pascal-cuoq"}, "edited": false, "score": 1, "creation_date": 1567599457, "post_id": 57778753, "comment_id": 102009768, "body": "2+2 is always 4 in all the floating-point formats used by Java. Adding two values that are not exactly two may sometimes not produce exactly 4, but this applies to most numerical systems. If you see two possibilities but they are both at the level of superstition, it&#39;s fine not to answer (in fact, Java&#39;s conversion to decimal is different from that of most C compilers(1), and the conversion from decimal is identical to that of most C compilers(1))."}, {"owner": {"reputation": 75299, "user_id": 139746, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/BhJLC.png?s=128&g=1", "display_name": "Pascal Cuoq", "link": "https://stackoverflow.com/users/139746/pascal-cuoq"}, "edited": false, "score": 0, "creation_date": 1567599601, "post_id": 57778753, "comment_id": 102009840, "body": "(1) most C compilers including the one on tpcg.io"}], "tags": [], "owner": {"reputation": 123, "user_id": 10697181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68bc3a8905ad165088b168499c783a48?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob FW", "link": "https://stackoverflow.com/users/10697181/jacob-fw"}, "is_accepted": false, "score": 5, "last_activity_date": 1567550034, "last_edit_date": 1567550034, "creation_date": 1567544881, "answer_id": 57778753, "question_id": 57778637, "link": "https://stackoverflow.com/questions/57778637/why-do-c-and-java-round-floats-differently/57778753#57778753", "title": "Why do C and Java round floats differently?", "body": "<p>Likely what's happening here is they're using slightly different methods for converting the number to a string, which introduces a rounding error.  It's also possible that the method by which the string is converted to a float during compilation is different between them, which again, can give slightly different values due to rounding.</p>\n\n<p>Remember though, float has 24 bits of accuracy for its fraction, which comes out to ~7.22 decimal digits [log10(2)*24], and the first 7 digits agree between them, so it's just the last few least significant bits that are different.</p>\n\n<p>Welcome to the fun world of Floating Point Math, where 2+2 does not always equal 4.</p>\n"}, {"comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567594751, "post_id": 57779767, "comment_id": 102007292, "body": "What about &quot;shall be&quot;? That&#39;s more on terms with the standard-writing nowadays."}], "tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": true, "score": 19, "last_activity_date": 1567593247, "last_edit_date": 1592644375, "creation_date": 1567553314, "answer_id": 57779767, "question_id": 57778637, "link": "https://stackoverflow.com/questions/57778637/why-do-c-and-java-round-floats-differently/57779767#57779767", "title": "Why do C and Java round floats differently?", "body": "<h2>Conclusion</h2>\n<p>The Java specification requires a troublesome double rounding in this situation. The number 0.6446968749999999470645661858725361526012420654296875 is first converted to 0.644696875 and then rounded to 0.64469688.</p>\n<p>In contrast, the C implementation simply rounds 0.6446968749999999470645661858725361526012420654296875 directly to eight digits, producing 0.64469687.</p>\n<h2>Preliminaries</h2>\n<p>For <code>Double</code>, Java uses IEEE-754 basic 64-bit binary floating-point. In this format, the value nearest the number in the source text, 0.644696875, is 0.6446968749999999470645661858725361526012420654296875, and I believe this is the actual value to be formatted with <code>String.format(&quot;%10.8f&quot;,0.644696875)</code>.<sup>1</sup></p>\n<h2>What the Java Specification Says</h2>\n<p><a href=\"https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/util/Formatter.html#dndec\" rel=\"noreferrer\">The documentation for formatting with the <code>Double</code> type and <code>f</code> format</a> says:</p>\n<blockquote>\n<p>\u2026 If the precision is less than the number of digits which would appear after the decimal point in the string returned by <code>Float.toString(float)</code> or <code>Double.toString(double)</code> respectively, then the value will be rounded using the round half up algorithm. Otherwise, zeros may be appended to reach the precision\u2026</p>\n</blockquote>\n<p>Let\u2019s consider \u201cthe string returned by \u2026 <code>Double.toString(double)</code>\u201d. For the number 0.6446968749999999470645661858725361526012420654296875, this string is \u201c0.644696875\u201d. This is because the Java specification says that <a href=\"https://stackoverflow.com/a/54871593/298225\"><code>toString</code> produces just enough decimal digits to uniquely distinguish the number within the set of <code>Double</code> values</a>, and \u201c0.644696875\u201d has just enough digits in this case.<sup>2</sup></p>\n<p>That number has nine digits after the decimal point, and <code>&quot;%10.8f&quot;</code> requests eight, so the passage quoted above says \u201cthe value\u201d is rounded. Which value does it mean\u2014the actual operand of <code>format</code>, which is 0.6446968749999999470645661858725361526012420654296875, or that string it mentions, \u201c0.644696875\u201d? Since the latter is not a numeric value, I would have expected \u201cthe value\u201d to mean the former. However, the second sentence says \u201cOtherwise [that is, if more digits are requested], zeros may be appended\u2026\u201d If we were using the actual operand of <code>format</code>, we would show its digits, not use zeros. But, if we take the string as a numeric value, its decimal representation would have only zeros after the digits shown in it. So it seems this is the interpretation intended, and Java implementations appear to conform to that.</p>\n<p>So, to format this number with <code>&quot;%10.8f&quot;</code>, we first convert it to 0.644696875 and then round it using the round half up rule, which produces 0.64469688.</p>\n<p>This is a bad specification because:</p>\n<ul>\n<li>It requires two roundings, which can increase the error.</li>\n<li>The roundings occur in hard-to-predict and hard-to-control places. Some values will be rounded after two decimal places. Some will be rounded after 13. A program cannot easily predict this or adjust for it.</li>\n</ul>\n<p>(Also, it is a shame they wrote zeros \u201cmay be\u201d appended. Why not \u201cOtherwise, zeros <strong>are</strong> appended to reach the precision\u201d? With \u201cmay\u201d, it seems like they are giving the implementation a choice, although I suspect they meant the \u201cmay\u201d is predicated on whether zeros are needed to reach the precision, not on whether the implementor chooses to append them.)</p>\n<h2>Footnote</h2>\n<p><sup>1</sup> When <code>0.644696875</code> in the source text is converted to <code>Double</code>, I believe the result should be the nearest value representable in the <code>Double</code> format. (I have not located this in the Java documentation, but it fits the Java philosophy of requiring implementations to behave identically, and I suspect the conversion is done in accordance with <code>Double.valueOf(String s)</code>, which <a href=\"https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Double.html#valueOf(java.lang.String)\" rel=\"noreferrer\">does require this</a>.) The nearest <code>Double</code> to 0.644696875 is 0.6446968749999999470645661858725361526012420654296875.</p>\n<p><sup>2</sup> With fewer digits, the seven-digit 0.64469687 is insufficient because the <code>Double</code> value closest to it is 0.6446968<strong>699999999774519210404832847416400909423828125</strong>. So eight digits are needed to uniquely distinguish 0.6446968<strong>749999999470645661858725361526012420654296875</strong>.</p>\n"}], "owner": {"reputation": 10856, "user_id": 93947, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4cfa27623a7f68e3d297e786e2264d24?s=128&d=identicon&r=PG", "display_name": "gdelfino", "link": "https://stackoverflow.com/users/93947/gdelfino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 376, "favorite_count": 5, "accepted_answer_id": 57779767, "answer_count": 2, "score": 19, "last_activity_date": 1567595095, "creation_date": 1567544217, "last_edit_date": 1567595095, "question_id": 57778637, "link": "https://stackoverflow.com/questions/57778637/why-do-c-and-java-round-floats-differently", "title": "Why do C and Java round floats differently?", "body": "<p>Consider the floating point number 0.644696875. Let's convert it to a string with eight decimals using Java and C:</p>\n\n<h1>Java</h1>\n\n<pre class=\"lang-java prettyprint-override\"><code>import java.lang.Math;\npublic class RoundExample{\n     public static void main(String[] args){\n        System.out.println(String.format(\"%10.8f\",0.644696875));\n     }\n}\n</code></pre>\n\n<p>result: 0.6446968<strong>8</strong></p>\n\n<p>try it yourself: <a href=\"http://tpcg.io/oszC0w\" rel=\"noreferrer\">http://tpcg.io/oszC0w</a></p>\n\n<h1>C</h1>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    printf(\"%10.8f\", 0.644696875); //double to string\n    return 0;\n}\n</code></pre>\n\n<p>result: 0.6446968<strong>7</strong></p>\n\n<p>try it yourself: <a href=\"http://tpcg.io/fQqSRF\" rel=\"noreferrer\">http://tpcg.io/fQqSRF</a></p>\n\n<h1>The Question</h1>\n\n<p>Why is the last digit different?</p>\n\n<h1>Background</h1>\n\n<p>The number 0.644696875 cannot be represented exactly as a machine number. It is represented as the fraction 2903456606016923 / 4503599627370496 which has a value of 0.6446968749999999</p>\n\n<p>This is admittedly an edge case. But I am really curious as to the source of the difference.</p>\n\n<p>Related: <a href=\"https://mathematica.stackexchange.com/questions/204359/is-numberform-double-rounding-numbers\">https://mathematica.stackexchange.com/questions/204359/is-numberform-double-rounding-numbers</a> </p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 0, "creation_date": 1567543972, "post_id": 57778493, "comment_id": 101992106, "body": "<b>Not related to your question</b> but don&#39;t you see how your <code>while</code> loop is just a strange <code>for</code> loop? <b>Probably related</b> you should try to write your code in a clearer way. I also recommend more whitespace to separate operators from operands, that helps when reading it. Using a <code>for</code> loop will probably help."}, {"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 0, "creation_date": 1567544290, "post_id": 57778493, "comment_id": 101992213, "body": "I also suggest better names for your variables, I had to read for a while before I realized that <code>i</code> was probably just <code>total_length</code>."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1567544627, "post_id": 57778493, "comment_id": 101992327, "body": "Are you sure <code>12345678\\n</code> is the failing case and not <code>123456789\\n</code>, and <code>MAXLINE</code> was 10? With <code>123456789\\n</code>, your program processes nine characters in <code>getline</code>, then exits the loop due to the <code>j &lt; lim-1</code> test. The last character read was <code>9</code>, so it does not appending a newline. It appends a null character and returns, and the main routine prints <code>123456789</code>, with no newline. Then it calls <code>getline</code> again.  Then <code>getline</code> reads <code>\\n</code> and treats it as an empty line\u2014because <code>i&gt;0</code> is false, it does not append the newline character. It appends the null character and returns this empty string."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1567544684, "post_id": 57778493, "comment_id": 101992351, "body": "Thus, <code>getline</code> is designed to suppress completely blank lines, but the program fails because it uses <code>getline</code> to process both the start of a line and the continuation of a line, and <code>getline</code> has no way to know it is working on the continuation of an already non-blank line. You need to rethink the design."}, {"owner": {"reputation": 13, "user_id": 11998698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1b5b6ef423bb616497fc5ef3953414?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/11998698/john"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1567546146, "post_id": 57778493, "comment_id": 101992775, "body": "@Eric Postpischl I&#39;m confused. Why would <code>getline</code> read <code>\\n</code> and not <code>c</code> from calling <code>c=getchar()</code>? Right after the first call <code>line</code> would be <code>123456789\\0</code> no? Then the next call would read a new character, no? Why would the next call read <code>\\n</code>?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1567546797, "post_id": 57778493, "comment_id": 101992968, "body": "Please answer the question: Are you sure <code>12345678\\n</code> is the failing case and not <code>123456789\\n</code>, and <code>MAXLINE</code> was 10?"}, {"owner": {"reputation": 13, "user_id": 11998698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1b5b6ef423bb616497fc5ef3953414?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/11998698/john"}, "edited": false, "score": 0, "creation_date": 1567546969, "post_id": 57778493, "comment_id": 101993020, "body": "No, <code>12345678\\n</code> is not a failing case (I rewored the last paragraph to make this more clear). The program behaves exactly as I expected it to. <code>123456789\\n</code> is indeed the failing case. And yes <code>MAXLINE</code> is 10, defined in the second line."}], "answers": [{"comments": [{"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 2, "creation_date": 1567543855, "post_id": 57778571, "comment_id": 101992068, "body": "Doesn&#39;t <code>j &lt; lim-1</code> subtract 1 to allow room for the null?"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1567543905, "post_id": 57778571, "comment_id": 101992083, "body": "@Barmar Yeah, but I think this affects it: <code>if (c==&#39;\\n&#39; &amp;&amp; i&gt;0) {         s[i] = c;         ++i;     }</code>"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1567544023, "post_id": 57778571, "comment_id": 101992120, "body": "@JL2210: But that overruns the array only if <code>\\n</code> appears after 9 characters, which does not occur in the input cases complained in the problem. (One has 10, which is processed as 9 in the first call and 2 in the second, and the other has 8.)"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1567544191, "post_id": 57778571, "comment_id": 101992177, "body": "It&#39;s very strange that he assigns both <code>s[j] = c</code> and <code>s[i] = c</code> when <code>c == &#39;\\n&#39;</code>."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 1, "creation_date": 1567544243, "post_id": 57778571, "comment_id": 101992192, "body": "@JL2210: Actually, it can never overrun the array. If nine characters are read without seeing <code>&#39;\\n&#39;</code>, then the first loop is exited (due to <code>j&lt;lim-1</code>), and the character just read is not <code>&#39;\\n&#39;</code>, so it is not appended, and the following statement puts the null character in <code>s[9]</code>, which is fine."}, {"owner": {"reputation": 796, "user_id": 3152516, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8ea925575fe0c9b928d81ff648ef7d50?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Chase", "link": "https://stackoverflow.com/users/3152516/dan-chase"}, "edited": false, "score": 0, "creation_date": 1567544399, "post_id": 57778571, "comment_id": 101992251, "body": "Does the s[i] = &#39;\\0&#39; overrun perhaps? Remember c comes from the input not the loop. I suggest this because he is incrementing i before using it at the end."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1567545010, "post_id": 57778571, "comment_id": 101992437, "body": "@DanChase: There is no overrun. If you believe otherwise, put <code>if (lim &lt;= i) { fprintf(stderr, &quot;Gotcha!\\n&quot;); exit(EXIT_FAILURE); }</code> just before <code>s[i] = &#39;\\0&#39;;</code> and find some input data that triggers it."}, {"owner": {"reputation": 796, "user_id": 3152516, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8ea925575fe0c9b928d81ff648ef7d50?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Chase", "link": "https://stackoverflow.com/users/3152516/dan-chase"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1567546021, "post_id": 57778571, "comment_id": 101992744, "body": "@Eric Postpischil Interesting! I was trying not to put it into a debugger for him, and I am ending up cross eyed. what a mind teaser!"}], "tags": [], "owner": {"reputation": 796, "user_id": 3152516, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8ea925575fe0c9b928d81ff648ef7d50?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Chase", "link": "https://stackoverflow.com/users/3152516/dan-chase"}, "is_accepted": false, "score": -2, "last_activity_date": 1567543891, "last_edit_date": 1567543891, "creation_date": 1567543804, "answer_id": 57778571, "question_id": 57778493, "link": "https://stackoverflow.com/questions/57778493/why-does-my-code-print-past-the-null-character/57778571#57778571", "title": "Why does my code print past the null character?", "body": "<p>I don't know if this is the whole answer, but I think you need:</p>\n\n<pre><code> char line[MAXLINE+1].. this\n</code></pre>\n\n<p>This is because you are reading to 10, but your array needs an extra space for the null.</p>\n\n<p>Also, I would try to improve the readability of your code in general. Possibly split some things out into functions, do some things as separate steps. You will thank yourself in 6 months when you've long forgotten what the code is supposed to do.</p>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 11998698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1b5b6ef423bb616497fc5ef3953414?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/11998698/john"}, "edited": false, "score": 0, "creation_date": 1567555131, "post_id": 57779852, "comment_id": 101994518, "body": "So basically when you call <code>getchar()</code> any subsequent calls will first return any extra characters the user put as input in the first call? I didn&#39;t know that, thanks for clarifying it for me."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 13, "user_id": 11998698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1b5b6ef423bb616497fc5ef3953414?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/11998698/john"}, "edited": false, "score": 0, "creation_date": 1567555319, "post_id": 57779852, "comment_id": 101994553, "body": "@John: What? When the input contains 1, 2, 3, 4, 5, 6, 7, 8, 9, and newline, then <code>getchar()</code> successively returns <code>&#39;1&#39;</code>, <code>&#39;2&#39;</code>, <code>&#39;3&#39;</code>, <code>&#39;4&#39;</code>, <code>&#39;5&#39;</code>, <code>&#39;6&#39;</code>, <code>&#39;7&#39;</code>, <code>&#39;8&#39;</code>,<code>&#39;9&#39;</code>, and newline. That is all that is happening. <code>getchar()</code> does not care when your <code>getline</code> routine returns. The characters are in the input, and <code>getchar()</code> provides them."}, {"owner": {"reputation": 13, "user_id": 11998698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1b5b6ef423bb616497fc5ef3953414?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/11998698/john"}, "edited": false, "score": 0, "creation_date": 1567558260, "post_id": 57779852, "comment_id": 101995009, "body": "Okay, I get it now. I had a misunderstanding about how <code>getchar()</code> works!"}], "tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": true, "score": 0, "last_activity_date": 1567554207, "creation_date": 1567554207, "answer_id": 57779852, "question_id": 57778493, "link": "https://stackoverflow.com/questions/57778493/why-does-my-code-print-past-the-null-character/57779852#57779852", "title": "Why does my code print past the null character?", "body": "<p>When the input is \u201c123456789\u201d followed by a newline character:</p>\n\n<ul>\n<li>The loop <code>while (j&lt;lim-1 &amp;&amp; (c=getchar())!=EOF &amp;&amp; c!='\\n')</code> iterates nine times. In the last iteration, <code>c=getchar()</code> has put <code>'9'</code> in <code>c</code>, and <code>j</code> is 9.</li>\n<li>Then <code>j&lt;lim-1</code> is false because <code>j</code> is 9 and <code>lim-1</code> is 10\u22121, so the loop exits.</li>\n<li>Then <code>if (c=='\\n' &amp;&amp; i&gt;0)</code> does nothing because <code>c</code> contains <code>'9'</code>.</li>\n<li>Then <code>s[i] = '\\0';</code> appends a null character, and <code>getline</code> returns to <code>main</code>.</li>\n<li><code>main</code> prints the buffer (<code>line</code>), resulting in output of \u201c123456789\u201d.</li>\n<li>Then <code>main</code> calls <code>getline</code> again.</li>\n<li>This time, in the first iteration of <code>while (j&lt;lim-1 &amp;&amp; (c=getchar())!=EOF &amp;&amp; c!='\\n')</code>, <code>getchar()</code> returns <code>'\\n'</code>, and this is put into <code>c</code>. Then the loop terminates since <code>c!='\\n'</code> is false.</li>\n<li>Since the loop terminated without executing any iterations, <code>i</code> is 0.</li>\n<li>Then <code>if (c=='\\n' &amp;&amp; i&gt;0)</code> does nothing because <code>i&gt;0</code> is false.</li>\n<li>Then <code>s[i] = '\\0';</code> appends a null character, and <code>getline</code> returns to <code>main</code>.</li>\n<li>At this point, <code>line</code> contains a null character at its start. When <code>main</code> prints this, nothing is printed.</li>\n</ul>\n\n<p>Conclusion: The design is defective. <code>getline</code> is designed to suppress completely blank lines by not appending a newline if the line is empty (<code>i</code> is zero during the test <code>if (c=='\\n' &amp;&amp; i&gt;0)</code>), but it is called both for the start of a line and the continuation of a line that was not completely processed due to buffer size. When it is called for the continuation of a line and the line continues exactly at a newline character, it treats it as a completely blank line and suppresses the append of a newline.</p>\n\n<p>One remedy would be to add a parameter to <code>getline</code> to inform it whether it is being called for the start of a new line or the continuation of a line, and then modifying the test <code>if (c=='\\n' &amp;&amp; i&gt;0)</code> appropriately.</p>\n\n<p>Another defect in the design is that, if a line contains blanks and/or tabs just before where <code>getline</code> stops processing due to the buffer being full, they will be lost, because <code>getline</code> writes a null character to mark the end of the non-blank portion of the partial line and returns to <code>main</code>, thus forgetting about the pending blanks and/or tabs, which might be needed because the later continuation of the line contains non-blank characters.</p>\n"}], "owner": {"reputation": 13, "user_id": 11998698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b1b5b6ef423bb616497fc5ef3953414?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/11998698/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 57779852, "answer_count": 2, "score": -2, "last_activity_date": 1567554207, "creation_date": 1567543371, "last_edit_date": 1567547075, "question_id": 57778493, "link": "https://stackoverflow.com/questions/57778493/why-does-my-code-print-past-the-null-character", "title": "Why does my code print past the null character?", "body": "<p>I have recently starting learning C through K&amp;R, second edition. I am trying to solve Exercise 1-18 which has the following description: write a program to remove trailing blanks and tabs from each line of input and to delete entirely blank lines.</p>\n\n<p>Here is my attempt (using <code>MAXLINE=10</code> to debug the program):</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#define MAXLINE 10 /*maximum input line size*/\n\nint getline(char[],int);\n\nint main()\n{\n    int len; /*current line length*/\n    char line[MAXLINE]; /*current input line*/\n\n    while ((len = getline(line,MAXLINE))&gt;-1)\n        if (len&gt;0)\n            printf(\"%s\",line);\n    return 0;\n}\n\n/*getline:read a line into s without trailing whitespaces, return length*/\nint getline(char s[],int lim)\n{\n    int i,c,j;\n    i=j=0;\n    while (j&lt;lim-1 &amp;&amp; (c=getchar())!=EOF &amp;&amp; c!='\\n')\n    {\n        s[j]=c;\n        ++j;\n        if (c!='\\t' &amp;&amp; c!=' ')\n            i=j;\n    }\n    if (c=='\\n' &amp;&amp; i&gt;0) {\n        s[i] = c;\n        ++i;\n    }\n    s[i] = '\\0';\n    if (c==EOF)\n        return -1;\n    return i;\n}\n</code></pre>\n\n<p>So the basic idea is I keep filling reading characters into line, but also keep track of the position of (one-past) the last non-trailing blank character. I then put null character at this spot, with the idea that <code>printf(\"%s\",whatever)</code> will actually print the contents of whatever until it encounters the first null character.</p>\n\n<p>The program behaves as expected with 9 or less characters (including <code>\\n</code> at the end). However, it keeps printing input with more characters and I don't understand why. For instance, my program with input <code>1234567891\\n</code> actually prints back <code>1234567891\\n</code> (yes, it even changes line!). What am I missing?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 969, "user_id": 3009892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c242dcbc4582f69a0426a66bc6a8115?s=128&d=identicon&r=PG", "display_name": "borancar", "link": "https://stackoverflow.com/users/3009892/borancar"}, "edited": false, "score": 0, "creation_date": 1567543411, "post_id": 57778437, "comment_id": 101991918, "body": "Can you share more details about the compiler used and compiler flags (was any specific packing requested)? Were there any unions used anywhere?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 3, "creation_date": 1567545586, "post_id": 57778437, "comment_id": 101992607, "body": "There is no enough here to know why this was done or whether it was necessarily. The individual line <code>A_ptr = (structA *)(&amp; (C_obj.A_obj));</code> certainly could be just <code>A_ptr = &amp;C_obj.A_obj;</code>. But as to why <code>structC</code> was built with two structures in it even though only a pointer to the first is used at first is unclear. If there is no other code using it, there is no point to this. If there is other code using this, there could be a reason. You would have to show the other code."}, {"owner": {"reputation": 1149, "user_id": 2472827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t5rYY.jpg?s=128&g=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/2472827/neil"}, "edited": false, "score": 0, "creation_date": 1567553923, "post_id": 57778437, "comment_id": 101994328, "body": "C extends A and B? It would be hard to tell without some context."}], "answers": [{"comments": [{"owner": {"reputation": 1510, "user_id": 10334659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6afc02c5a2d072d70358d1712a0439d3?s=128&d=identicon&r=PG&f=1", "display_name": "Gaurav", "link": "https://stackoverflow.com/users/10334659/gaurav"}, "edited": false, "score": 0, "creation_date": 1567544176, "post_id": 57778497, "comment_id": 101992169, "body": "<code>A_ptr</code> might have been popped by the time function was over but the address allocated to <code>A_ptr</code> by <code>malloc</code> would still be valid and if somewhere (from where the function has been called) memory address pointed by<code>A_ptr</code>&#39; is returned then the `malloc&#39;ed memory would still be accessible. Please correct me if I am wrong. PLUS this all is happening just within a function."}, {"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "reply_to_user": {"reputation": 1510, "user_id": 10334659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6afc02c5a2d072d70358d1712a0439d3?s=128&d=identicon&r=PG&f=1", "display_name": "Gaurav", "link": "https://stackoverflow.com/users/10334659/gaurav"}, "edited": false, "score": 0, "creation_date": 1567544546, "post_id": 57778497, "comment_id": 101992300, "body": "Yes, you are correct. If this is happening all of it within a function then probably the pointer was used just to avoid the awkward syntax. Say if <code>A_ptr</code> is used multiple times within the function. I would do it!"}], "tags": [], "owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "is_accepted": false, "score": -1, "last_activity_date": 1567546376, "last_edit_date": 1567546376, "creation_date": 1567543387, "answer_id": 57778497, "question_id": 57778437, "link": "https://stackoverflow.com/questions/57778437/struct-inside-struct-and-typecasting/57778497#57778497", "title": "struct inside struct and typecasting", "body": "<p>There's a big difference between using <code>malloc()</code> and not doing so. For instance <code>A_ptr</code> if was returned from a function would be invalid in the scope where the function has already finished excuting, which means that the <code>A_ptr</code> is now pointing to \"<em>invalid</em>\" memory.</p>\n\n<p>You also cannot <code>free()</code> that pointer. And as explained above it can only be used anywhere before the function where the actual object was allocated exits.</p>\n\n<p>It was done like this to have a pointer to a local variable probably just inside a function, it's hard to say what the motivation was without seeing the actual use case.</p>\n\n<p>Also note that the member of type <code>structA</code> is not a pointer so you can't assign to it a pointer. You can create a pointer to it like they did in <code>A_ptr = ...</code>.</p>\n"}], "owner": {"reputation": 1510, "user_id": 10334659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6afc02c5a2d072d70358d1712a0439d3?s=128&d=identicon&r=PG&f=1", "display_name": "Gaurav", "link": "https://stackoverflow.com/users/10334659/gaurav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1567916897, "creation_date": 1567543073, "last_edit_date": 1567916897, "question_id": 57778437, "link": "https://stackoverflow.com/questions/57778437/struct-inside-struct-and-typecasting", "title": "struct inside struct and typecasting", "body": "<p>Today I found this code which looks like an elongated piece without any need:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\ntypedef struct\n{\n     //BLABLABLA\n}\nstructA;\n\ntypedef struct\n{\n    //BLAAAAAAAAAAAAAAA\n}\nstructB;\n\ntypedef struct\n{\n    structA A_obj;\n    structB B_obj;\n}\nstructC;\n\n\nint main(void)\n{\n    structA *A_ptr;\n    structC  C_obj;\n\n    A_ptr = (structA *)(&amp; (C_obj.A_obj)); //THIS LOOKS OVER-ENGINEERED\n    return 0;\n}\n</code></pre>\n\n<p>I am not able to understand why it was done like this rather than just using <code>malloc()</code> to allocate space directly using <code>structA</code>'s size or using <code>structA</code>'s object to be pointed by <code>A_ptr</code>? </p>\n"}, {"tags": ["c", "string"], "comments": [{"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1567542396, "post_id": 57778300, "comment_id": 101991567, "body": "Yes, that&#39;s basically what your initialization is equivalent to (except that <code>_string</code> has no name at all).  You could make it even closer by declaring <code>_string</code> as <code>const</code>."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 1, "creation_date": 1567542457, "post_id": 57778300, "comment_id": 101991590, "body": "As far as I know, though, what you&#39;re calling the &quot;short form&quot; has been part of C since the very beginning."}, {"owner": {"reputation": 1220, "user_id": 5878272, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/14e96159153b67fab5222b7c5fa18c71?s=128&d=identicon&r=PG&f=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/5878272/fredrik"}, "edited": false, "score": 3, "creation_date": 1567542467, "post_id": 57778300, "comment_id": 101991595, "body": "That\u2019s not how it is. The short form actually places the string in a read-only place at compile time. And that is not equal to the example you showed."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1567542592, "post_id": 57778300, "comment_id": 101991629, "body": "<code>char *string = &quot;Hello&quot;;</code> is actually the short form of <code>char *string = {&#39;H&#39;, &#39;e&#39;, &#39;l&#39;, &#39;l&#39;, &#39;o&#39;, &#39;\\0&#39;};</code>"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 1, "creation_date": 1567542664, "post_id": 57778300, "comment_id": 101991657, "body": "@Jabberwocky Except that that form of nameless array initializer was never part of K&amp;R C."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 1220, "user_id": 5878272, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/14e96159153b67fab5222b7c5fa18c71?s=128&d=identicon&r=PG&f=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/5878272/fredrik"}, "edited": false, "score": 2, "creation_date": 1567542743, "post_id": 57778300, "comment_id": 101991684, "body": "@Fredrik: Whether the array of a string literal is placed in read-only memory is implementation-dependent. It is not required by the C standard."}, {"owner": {"reputation": 1220, "user_id": 5878272, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/14e96159153b67fab5222b7c5fa18c71?s=128&d=identicon&r=PG&f=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/5878272/fredrik"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1567542873, "post_id": 57778300, "comment_id": 101991741, "body": "@Eric that may be, the important part is that the string is a compile time literal and \u2019lives\u2019 during the entire execution time."}, {"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1567543085, "post_id": 57778300, "comment_id": 101991803, "body": "@EricPostpischil Are you sure about <a href=\"https://stackoverflow.com/questions/57778300/long-form-notation-of-a-string-assignment#comment101991684_57778300\">this</a>?"}, {"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1567543197, "post_id": 57778300, "comment_id": 101991843, "body": "I clicked on it and it went to the right comment which is yours BTW. Your answer seems correct to me @EricPostpischil"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 1, "creation_date": 1567543359, "post_id": 57778300, "comment_id": 101991897, "body": "@IharobAlAsimi: Okay. Whether a browser is able to scroll to the comment may depend on window size and other factors."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11954200"}, "edited": false, "score": 0, "creation_date": 1567544105, "post_id": 57778442, "comment_id": 101992146, "body": "thanks for this explanation. Why wouldn&#39;t the second line just be <code>char *string = &amp;_string[0]</code> ? Or is <code>(char *) _string</code> equivalent to <code>&amp;_string[0]</code> ?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 3, "creation_date": 1567544361, "post_id": 57778442, "comment_id": 101992233, "body": "@Shared: When used in this way, <code>_string</code> is equivalent to <code>&amp;_string[0]</code>. The problem is <code>&amp;_string[0]</code> has type <code>const char *</code>, and assigning a <code>const char *</code> to <code>char *</code> is a constraint violation\u2014you cannot implicitly remove <code>const</code>. However, you can explicitly remove it with a cast, hence the <code>(char *)</code>."}], "tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": true, "score": 4, "last_activity_date": 1567543625, "last_edit_date": 1567543625, "creation_date": 1567543089, "answer_id": 57778442, "question_id": 57778300, "link": "https://stackoverflow.com/questions/57778300/long-form-notation-of-a-string-assignment/57778442#57778442", "title": "Long-form notation of a string assignment", "body": "<p>String literals have three properties your proposed long form does not:</p>\n\n<ul>\n<li>They have static storage duration, meaning they exist (in the computing model used by the C standard) for the duration of program execution.</li>\n<li>The behavior of attempting to modify them is not defined by the C standard, even though they do not have a <code>const</code> qualifier (which is a legacy due to the historical development of C).</li>\n<li>When the compiler sees identical string literals, it is allowed to consolidate them. This could be visible to the program by comparing addresses. The compiler is also allowed to consolidate \"abcdef\" and \"def\" to \"abcdef\", since the latter is a subsequence of the former.</li>\n</ul>\n\n<p>So a closer equivalent would be:</p>\n\n<pre><code>static const char _string[] = {'H', 'e', 'l', 'l', 'o', '\\0'};\nchar *string = (char *) _string;\n</code></pre>\n\n<p>Thus, <code>string</code> does not have the <code>const</code> qualifier, and it does point to an array of static storage duration for which attempting to modify it is not defined by the C standard.</p>\n\n<p>I do not believe there is a good way to replicate the third property, so <code>_string</code> will be a distinct object even if the same data appears elsewhere in the program.</p>\n\n<p>String literals have existed in C since at least 1978, as they appear in the first edition of <em>The C Programming Language</em> by Kernighan and Ritchie, which calls them string constants.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11954200"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 57778442, "answer_count": 1, "score": 1, "last_activity_date": 1567543625, "creation_date": 1567542281, "last_edit_date": 1567542621, "question_id": 57778300, "link": "https://stackoverflow.com/questions/57778300/long-form-notation-of-a-string-assignment", "title": "Long-form notation of a string assignment", "body": "<p>I was wondering what the equivalent \"long-form\" way of creating a string would be. My first thought as as follows:</p>\n\n<pre><code>char *string = \"Hello\";\n</code></pre>\n\n<p>is short-form for:</p>\n\n<pre><code>char _string[6] = {'H', 'e', 'l', 'l', 'o', '\\0'};\nchar *string = &amp;_string[0];\n</code></pre>\n\n<p>Is this the closest approximation of what a string assignment actually does? When was the short-form notation introduced?</p>\n"}, {"tags": ["c", "arduino-esp8266"], "comments": [{"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 1220, "user_id": 5878272, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/14e96159153b67fab5222b7c5fa18c71?s=128&d=identicon&r=PG&f=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/5878272/fredrik"}, "edited": false, "score": 0, "creation_date": 1567542326, "post_id": 57778235, "comment_id": 101991535, "body": "@Fredrik Isn&#39;t that what <code>configTime(0, 0, &quot;pool.ntp.org&quot;, &quot;time.nist.gov&quot;);</code> does?"}, {"owner": {"reputation": 3305, "user_id": 1428695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a843c704cdb7e32a93769cddfed4747?s=128&d=identicon&r=PG", "display_name": "yhyrcanus", "link": "https://stackoverflow.com/users/1428695/yhyrcanus"}, "edited": false, "score": 0, "creation_date": 1567542451, "post_id": 57778235, "comment_id": 101991587, "body": "<code>configTime</code> seems like it starts up the <code>sntp</code> app. If it can&#39;t connect, i guess it&#39;ll just stay in that loop basically forever (until we hit MIN_EPOCH).  Other than make sure you can connect to the internet, I don&#39;t think there&#39;s much you can do."}, {"owner": {"reputation": 466, "user_id": 3216326, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c2OLN.png?s=128&g=1", "display_name": "PKonstant", "link": "https://stackoverflow.com/users/3216326/pkonstant"}, "edited": false, "score": 0, "creation_date": 1567543330, "post_id": 57778235, "comment_id": 101991888, "body": "Again, I was given this code and not sure what&#39;s purpose of the loop. I was hoping someone would be able to explain it."}], "answers": [{"comments": [{"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 1, "creation_date": 1567568475, "post_id": 57778523, "comment_id": 101996615, "body": "Very minor nitpick: the computation <code>40 * 365 * 24 * 3600</code> ignores leap years, so it&#39;s actually just 14600 days or 39.97 years later, or December 22, 2009."}], "tags": [], "owner": {"reputation": 3305, "user_id": 1428695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a843c704cdb7e32a93769cddfed4747?s=128&d=identicon&r=PG", "display_name": "yhyrcanus", "link": "https://stackoverflow.com/users/1428695/yhyrcanus"}, "is_accepted": false, "score": 1, "last_activity_date": 1567543514, "creation_date": 1567543514, "answer_id": 57778523, "question_id": 57778235, "link": "https://stackoverflow.com/questions/57778235/sync-time-with-internet/57778523#57778523", "title": "Sync time with Internet?", "body": "<p>To explain what the loop is doing:</p>\n\n<p><code>configTime</code> starts up (or can start up) an asynchronous process to synch the time every so often. The loop checks and makes sure we have a sane time (40 years after jan 1st 1970 ie Jan 1st 2010). If it's not sane, we wait until we get synched.</p>\n\n<p>I think you might be able to make the SNTP process syncronous, which would mess you up if you got stuck in there.</p>\n"}, {"tags": [], "owner": {"reputation": 466, "user_id": 3216326, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c2OLN.png?s=128&g=1", "display_name": "PKonstant", "link": "https://stackoverflow.com/users/3216326/pkonstant"}, "is_accepted": false, "score": 0, "last_activity_date": 1567623454, "creation_date": 1567623454, "answer_id": 57794360, "question_id": 57778235, "link": "https://stackoverflow.com/questions/57778235/sync-time-with-internet/57794360#57794360", "title": "Sync time with Internet?", "body": "<p>I resolved the issue by changing the wi-fi connection to a different source that my Arduino was connected to and that alone resolved the issue.  Not sure why that resolved the issue but I glad its working now. Thank you for the help!</p>\n"}], "owner": {"reputation": 466, "user_id": 3216326, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c2OLN.png?s=128&g=1", "display_name": "PKonstant", "link": "https://stackoverflow.com/users/3216326/pkonstant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1567623454, "creation_date": 1567541896, "last_edit_date": 1567542647, "question_id": 57778235, "link": "https://stackoverflow.com/questions/57778235/sync-time-with-internet", "title": "Sync time with Internet?", "body": "<p>When my Arduino is starting up, I am trying to sync its time up with the internet and used the following code to do so.  This code has worked in the past but today its never getting out of the while loop so I put some debug statements in the loop to see what's going on.  Looking at the output, it would be in this loop for a long time.  I was given this code so I really don't know what the purpose of the while loop is for.  Any thought or is there a better way sync the time? Thank you for your help!</p>\n\n<pre><code>void initTime()\n{\n const int MIN_EPOCH = 40 * 365 * 24 * 3600;\n time_t epochTime;\n\n configTime(0, 0, \"pool.ntp.org\", \"time.nist.gov\");\n\n Serial.print(\"Fetching time from NTP\");\n\n epochTime = time(NULL);\n\n while (epochTime &lt; MIN_EPOCH)\n {\n   Serial.print(\".\");\n   delay(2000);\n   epochTime = time(NULL);\n\n   Serial.print(\"MIN EPOCH: \");\n   Serial.println(MIN_EPOCH);\n   Serial.print(\"EPOCH TIME: \");\n   Serial.println(epochTime);\n }\n\n Serial.println();\n Serial.print(\"Fetched NTP epoch time is: \");\n Serial.println(epochTime);\n}\n</code></pre>\n\n<h2>Output:</h2>\n\n<p>Fetching time from NTP.MIN EPOCH: 1261440000</p>\n\n<p>EPOCH TIME: 28810</p>\n\n<p>.MIN EPOCH: 1261440000</p>\n\n<p>EPOCH TIME: 28812</p>\n\n<p>.MIN EPOCH: 1261440000</p>\n\n<p>EPOCH TIME: 28814</p>\n\n<p>.MIN EPOCH: 1261440000</p>\n\n<p>EPOCH TIME: 28816</p>\n\n<p>.MIN EPOCH: 1261440000</p>\n\n<p>EPOCH TIME: 28818</p>\n\n<p>.MIN EPOCH: 1261440000</p>\n"}, {"tags": ["c", "pthreads", "mutex"], "comments": [{"owner": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "edited": false, "score": 1, "creation_date": 1567547528, "post_id": 57778025, "comment_id": 101993164, "body": "It could allocate resources dynamically on first use. In case of failure, it can fall back to polling. For example <code>CRITICAL_SECTION</code> can allocate internal event dynamically when it is requires. In theory an implementation can free such event in destroy function."}, {"owner": {"reputation": 87, "user_id": 11837920, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a63446cdf9e7f3ddcadccc5ea1147326?s=128&d=identicon&r=PG&f=1", "display_name": "user338717", "link": "https://stackoverflow.com/users/11837920/user338717"}, "reply_to_user": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "edited": false, "score": 0, "creation_date": 1567550946, "post_id": 57778025, "comment_id": 101993855, "body": "Good point I never considered the first-use scenario"}], "answers": [{"comments": [{"owner": {"reputation": 215710, "user_id": 134633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc6be45ddcfd038ba5e1e5fca319c7fa?s=128&d=identicon&r=PG", "display_name": "caf", "link": "https://stackoverflow.com/users/134633/caf"}, "edited": false, "score": 3, "creation_date": 1567573511, "post_id": 57780355, "comment_id": 101997519, "body": "Note that the LinuxThreads implementation is completely obsolete and hasn&#39;t been supported since glibc 2.3 (although roughly the same is true of the NPTL implementation - <code>pthread_mutex_destroy()</code> just checks that a robust mutex is unlocked, and sets the mutex to an invalid value)."}], "tags": [], "owner": {"reputation": 100407, "user_id": 16406, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/fadf252892475e9b177d5cd5e8b24145?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Dodd", "link": "https://stackoverflow.com/users/16406/chris-dodd"}, "is_accepted": false, "score": 2, "last_activity_date": 1567560101, "creation_date": 1567560101, "answer_id": 57780355, "question_id": 57778025, "link": "https://stackoverflow.com/questions/57778025/can-a-static-initializer-macro-require-dynamic-cleanup-could-pthread-mutex-ini/57780355#57780355", "title": "Can a static initializer macro require dynamic cleanup? (could pthread_mutex_initializer ever require pthread_mutex_destroy?)", "body": "<p>That quote is specific to Linux, and is a consequence of the fact that on linux, pthread_mutex_destroy is essentially a noop.  From the manual page:</p>\n\n<blockquote>\n  <p>pthread_mutex_destroy  destroys  a  mutex object, freeing the resources it might hold. The\n         mutex must be unlocked on entrance. In the LinuxThreads implementation, no  resources  are\n         associated  with  mutex  objects,  thus pthread_mutex_destroy actually does nothing except\n         checking that the mutex is unlocked.</p>\n</blockquote>\n\n<p>Thus on Linux, pthread_mutex_destroy is never required, for any mutex.</p>\n"}, {"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 2, "last_activity_date": 1567685085, "last_edit_date": 1567685085, "creation_date": 1567659047, "answer_id": 57798603, "question_id": 57778025, "link": "https://stackoverflow.com/questions/57778025/can-a-static-initializer-macro-require-dynamic-cleanup-could-pthread-mutex-ini/57798603#57798603", "title": "Can a static initializer macro require dynamic cleanup? (could pthread_mutex_initializer ever require pthread_mutex_destroy?)", "body": "<blockquote>\n  <p>If an API provides a macro to initialize an object/type, similar to\n  the <code>PTHREAD_MUTEX_INITIALIZER</code>, then is there anything that macro could\n  expand out to which would REQUIRE a call to a dynamic destructor\n  function?</p>\n</blockquote>\n\n<p>In general, yes.  A macro can expand to a function call, or to an initializer containing one, which might return a pointer to dynamically allocated space or a structure or union containing such a pointer.</p>\n\n<p>But for <code>PTHREAD_MUTEX_INITIALIZER</code> or any other macro that can be used to initialize a file-scope variable, no.  Such initializers must be constructed from constant expressions, and there is nothing such an initializer could contain that would obligate cleanup.</p>\n\n<p>Do note, however, that that's not a complete story.  However an object is initialized, there are innumerable ways in which its subsequent use could cause a requirement for releasing resources via a destructor function to adhere to it.  In particular, <a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/functions/pthread_mutex_destroy.html\" rel=\"nofollow noreferrer\">POSIX</a> does not promise that failing to destroy a mutex initialized via the macro will be without consequences.  Nor does it draw any distinction between the initial state of a mutex initialized via the initializer macro and the initial state of one initialized via <code>pthread_mutex_init()</code> with default attributes.  Either way, resources requiring cleanup could be associated with such a mutex by calls to <code>pthread_mutex_lock()</code>, for instance.</p>\n\n<p>But don't overlook that any \"requirement\" in this realm is conditional, not absolute.  Calling <code>pthread_mutex_destroy()</code> is potentially required <em>in order to</em> achieve a desirable outcome, such as avoiding a resource leak.  Not making the call means obtaining a different outcome, which may still be an acceptable one.</p>\n\n<p>Perhaps a good example would be the <code>NULL</code> macro.  Any pointer object may be initialized with <code>NULL</code>, which does not have any resource-management implications.  If a pointer to dynamically-allocated space is subsequently assigned to it, however, then failing to ever pass that object's value to <code>free()</code> may cause a resource leak.  Yet such a leak may be acceptable -- for example, if the allocated space needs to be retained until program termination anyway, then it makes little practical difference whether the program releases it itself, or whether it relies on the OS to handle that as part of cleaning up after the process.</p>\n"}], "owner": {"reputation": 87, "user_id": 11837920, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a63446cdf9e7f3ddcadccc5ea1147326?s=128&d=identicon&r=PG&f=1", "display_name": "user338717", "link": "https://stackoverflow.com/users/11837920/user338717"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 57798603, "answer_count": 2, "score": 2, "last_activity_date": 1567685085, "creation_date": 1567540728, "last_edit_date": 1567590257, "question_id": 57778025, "link": "https://stackoverflow.com/questions/57778025/can-a-static-initializer-macro-require-dynamic-cleanup-could-pthread-mutex-ini", "title": "Can a static initializer macro require dynamic cleanup? (could pthread_mutex_initializer ever require pthread_mutex_destroy?)", "body": "<p>I have viewed many other questions regarding this topic and I feel that I am informed on the topic... But there is one aspect to the question that I want to discuss.</p>\n\n<p>As stated here <a href=\"https://stackoverflow.com/questions/29295021/destroy-static-mutex-and-rwlock-initializers/42155550#42155550\">Destroy static mutex and rwlock initializers</a></p>\n\n<blockquote>\n  <p>(It is not necessary to call pthread_mutex_destroy() on a mutex that was statically initialized using PTHREAD_MUTEX_INITIALIZER.)</p>\n</blockquote>\n\n<p>However I want to pose a more fundamental question:</p>\n\n<p>If an API provides a macro to initialize an object/type, similar to the <code>PTHREAD_MUTEX_INITIALIZER</code>, then is there anything that macro could expand out to which would REQUIRE a call to a dynamic destructor function?</p>\n\n<p>To clarify what I'm asking:</p>\n\n<p>Is there anything that could be done in the <code>PTHREAD_MUTEX_INITIALIZER</code> that would require a dynamic destructor to cleanup?</p>\n\n<p>Would it be okay to safely assume that if an object/type has a static macro initializer like <code>PTHREAD_MUTEX_INITIALIZER</code> that it is <strong>impossible</strong> for the macro to initialize anything that would need dynamic cleanup, and therefore it's impossible for <code>pthread_mutex_destroy</code> to ever be necessary for <code>PTHREAD_MUTEX_INITIALIZER</code>?</p>\n\n<p>Or is it possible to change something in the future that may cause <code>PTHREAD_MUTEX_INITIALIZER</code> to do some operation that would absolutely require the <code>pthread_mutex_destroy</code> function to be called?</p>\n\n<p>edit: The only thing I could think of would be to maybe register a gcc <code>__attribute__((constructor))</code> or something in order to automatically call some code, at which point it's not really a static initialization anymore right? If it was truly a static initialization then that <em>by definition</em> means it cannot do anything dynamic; ergo <em>by definition</em> a static initializer macro couldn't require a dynamic cleanup function, right?</p>\n"}, {"tags": ["c", "gcc"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1567545675, "post_id": 57777515, "comment_id": 101992643, "body": "Like the solution <a href=\"https://stackoverflow.com/questions/29694564/what-is-the-use-of-start-in-c\">is right there</a>. What is funny, even the naming of the <code>my_main</code> function is the same."}, {"owner": {"reputation": 908, "user_id": 5484737, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1d28e4f9560bf7f5f4e7a92698f6b7fb?s=128&d=identicon&r=PG&f=1", "display_name": "RockBoro", "link": "https://stackoverflow.com/users/5484737/rockboro"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1567548618, "post_id": 57777515, "comment_id": 101993399, "body": "thanks.  I saw that yesterday. But then got confused because of a compile error."}], "answers": [{"tags": [], "owner": {"reputation": 1220, "user_id": 5878272, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/14e96159153b67fab5222b7c5fa18c71?s=128&d=identicon&r=PG&f=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/5878272/fredrik"}, "is_accepted": true, "score": 1, "last_activity_date": 1567545247, "creation_date": 1567545247, "answer_id": 57778820, "question_id": 57777515, "link": "https://stackoverflow.com/questions/57777515/can-c-start-function-be-made-to-call-entry-point-function-other-than-main/57778820#57778820", "title": "can C _start function be made to call entry point function other than main?", "body": "<p>Yes it <em>may</em> be possible, however it\u2019s all up to the compiler if that feature is supported or not. So you will have to look it up in your compiler manual.</p>\n"}], "owner": {"reputation": 908, "user_id": 5484737, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1d28e4f9560bf7f5f4e7a92698f6b7fb?s=128&d=identicon&r=PG&f=1", "display_name": "RockBoro", "link": "https://stackoverflow.com/users/5484737/rockboro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 1, "closed_date": 1567548450, "accepted_answer_id": 57778820, "answer_count": 1, "score": 0, "last_activity_date": 1567545247, "creation_date": 1567537924, "last_edit_date": 1567541765, "question_id": 57777515, "link": "https://stackoverflow.com/questions/57777515/can-c-start-function-be-made-to-call-entry-point-function-other-than-main", "closed_reason": "Duplicate", "title": "can C _start function be made to call entry point function other than main?", "body": "<p>Can the C _start function be made to call an entry point function other than main? </p>\n\n<p>The reason is I want to have a preprocessor embed additional functions in every C program I compile. The embedded code might provide test functions. Or some special debug features.  </p>\n\n<p>When I compile the program I would like to tell _start to call the my_main function instead of main. If command line argument -test is specified, my_main would call the special test functions. Otherwise, my_main calls the actual main function.</p>\n"}, {"tags": ["c", "c-preprocessor"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1567538377, "post_id": 57777501, "comment_id": 101990139, "body": "Consider adding a preprocessor tag."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1567538550, "post_id": 57777501, "comment_id": 101990192, "body": "It is not true that \u201ca multistep computation in a macro would be purposeful only if every comma-separated expression actually contributed in any way to the value of the macro itself\u201d. Expressions have both values and side effects. Side effects include such things as changing values in other objects (assigning to variables as you note, but not necessarily temporary variables), writing to standard output or to files, and more."}, {"owner": {"reputation": 28131, "user_id": 1956010, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bfdcb4596e9da98cccbf9a0069fdff6c?s=128&d=identicon&r=PG", "display_name": "nwellnhof", "link": "https://stackoverflow.com/users/1956010/nwellnhof"}, "edited": false, "score": 1, "creation_date": 1567538711, "post_id": 57777501, "comment_id": 101990257, "body": "Temporary variables could be passed to the macro as well: <code>#define MULTI_STEP(t, x, y) (t = x + y, t * t + 2)</code> (or simply assumed to be declared)"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1567538832, "post_id": 57777501, "comment_id": 101990293, "body": "We saw a <code>getch</code> or similar macro recently that checked whether a buffer contained characters, issued a read operation to get more characters if it did not, and then evaluated to the value of the next character in the buffer (or <code>EOF</code>). This macro needs to be a single expression, as that is how <code>getch()</code> is used. Just generally, we might implement it as <code>(UpdateBuffer(), Buffer.Next &lt; Buffer.Length ? EOF : Buffer.Data[Buffer.Next++])</code>. So this expression uses the comma operator to evaluate a function then provide a value."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 2, "creation_date": 1567540094, "post_id": 57777501, "comment_id": 101990774, "body": "Your example does not do what you say \u2013 <code>SYMVAR</code> is expanded to <code>(expr1, expr2, expr3)</code>. You might be confusing it with an assigment. <code>x = SYMVAR;</code> <i>would</i> set <code>x</code> to the value of <code>expr3</code>, after first evaluating the first two expressions (including side effects), and that sounds like the example you\u2019re looking for."}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 1, "creation_date": 1567590964, "post_id": 57777501, "comment_id": 102005323, "body": "&quot;<i><code>#define SYMVAR (expr1, expr2, expr3)</code> sets <code>SYMVAR</code> to <code>expr3</code></i>&quot; it does not. But the preprocessor replaced every occurrence <code>X</code> by <code>(expr1, expr2, expr3)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 4, "last_activity_date": 1567538906, "creation_date": 1567538906, "answer_id": 57777700, "question_id": 57777501, "link": "https://stackoverflow.com/questions/57777501/using-the-comma-operator-when-defining-a-macro/57777700#57777700", "title": "Using the comma operator when defining a macro", "body": "<p>Imagine a function</p>\n\n<pre><code>void debug_log(const char *s);\n</code></pre>\n\n<p>that writes the specified string (together with a timestamp) to some sort of log file.</p>\n\n<p>Then you could define the following macro:</p>\n\n<pre><code>#define TWICE(X)  (debug_log(\"Calling TWICE(\" #X \")\"), (X) * 2)\n</code></pre>\n\n<p><code>TWICE(21)</code> would then evaluate to <code>42</code>, but also write a message of the form</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[2019-09-03 12:34:56] Calling TWICE(21)\n</code></pre>\n\n<p>to the log file.</p>\n\n<p>The point is that expressions in C can have side effects. They can modify variables, they can write to files, etc., even if their return value is not used.</p>\n"}, {"tags": [], "owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "is_accepted": true, "score": 1, "last_activity_date": 1567540860, "creation_date": 1567540860, "answer_id": 57778054, "question_id": 57777501, "link": "https://stackoverflow.com/questions/57777501/using-the-comma-operator-when-defining-a-macro/57778054#57778054", "title": "Using the comma operator when defining a macro", "body": "<p>melpomene provided an example. Another example, although you could argue whether it's good or bad, is if you want to use the macro in a loop header.</p>\n\n<pre><code>#define MACRO(X) (X--, X&gt;0)\n\nint x=5;\nwhile(MACRO(x)) {\n    // Do stuff\n}\n</code></pre>\n\n<p>This example is definitely not the best in the world, but the point is that it would not work if you used semicolons instead to separate the expressions, no matter how you encapsulate them. </p>\n"}, {"tags": [], "owner": {"reputation": 14339, "user_id": 1466970, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/V1J6z.jpg?s=128&g=1", "display_name": "Richard Chambers", "link": "https://stackoverflow.com/users/1466970/richard-chambers"}, "is_accepted": false, "score": 2, "last_activity_date": 1569484176, "last_edit_date": 1569484176, "creation_date": 1567542908, "answer_id": 57778419, "question_id": 57777501, "link": "https://stackoverflow.com/questions/57777501/using-the-comma-operator-when-defining-a-macro/57778419#57778419", "title": "Using the comma operator when defining a macro", "body": "<p>Since the value of a comma operator statement is the last comma separated expression in the statement you can use this to perform several expressions while keeping the value only of the last expression.</p>\n\n<p>For instance, lets say that you want to have a macro that will do several calculations but the value of the macro is the last calculation. The following macro takes advantage of the assignment operator being used in an expression to perform a calculation and allow a different calculation to be the result of the macro:</p>\n\n<pre><code>#define SYMVAR(a,b)  ( ((a)=(b)), (b)*2)\n</code></pre>\n\n<p>This could also be a sequence of function calls such as:</p>\n\n<pre><code>int f1(int x) { return x * 3; }\n\nint f2(int x) { return x * 4; }\n\n// call first function f1() and then f2() with the value of the macro being the\n// value returned by function f2().\n#define SYMVARy(a) (f1(a), f2(a))\n</code></pre>\n\n<p>An example of using this approach:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n#define SYMVAR(a,b)  ( ((a)=(b)), (b)*2)\n\n#define SYMVAR2(a,b,z)  ( ((a)=(b)), ((z)=(b))*2)\n\nint main()\n{\n    int n1, n2;\n    int x1, x2;\n    int y0;\n    int i;\n\n    for (i = 0; i &lt; 10; i++) {\n        printf(\" i = %d  -&gt; \", i);\n        x1 = SYMVAR(n1, i);\n        printf(\" n1 = %d, i = %d, x1 = %d\\n\", n1, i, x1);\n    }\n\n    printf(\"\\nloop 2\\n\");\n    for (i = 0; i &lt; 10; i++) {\n        printf(\" i = %d  -&gt; \", i);\n        x2 = SYMVAR2(n2, i+3, y0);\n        printf(\" n2 = %d, i = %d, x2 = %d, y0 = %d\\n\", n2, i, x2, y0);\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>The output of this program is:</p>\n\n<pre><code> i = 0  -&gt;  n1 = 0, i = 0, x1 = 0\n i = 1  -&gt;  n1 = 1, i = 1, x1 = 2\n i = 2  -&gt;  n1 = 2, i = 2, x1 = 4\n i = 3  -&gt;  n1 = 3, i = 3, x1 = 6\n i = 4  -&gt;  n1 = 4, i = 4, x1 = 8\n i = 5  -&gt;  n1 = 5, i = 5, x1 = 10\n i = 6  -&gt;  n1 = 6, i = 6, x1 = 12\n i = 7  -&gt;  n1 = 7, i = 7, x1 = 14\n i = 8  -&gt;  n1 = 8, i = 8, x1 = 16\n i = 9  -&gt;  n1 = 9, i = 9, x1 = 18\n\nloop 2\n i = 0  -&gt;  n2 = 3, i = 0, x2 = 6, y0 = 3\n i = 1  -&gt;  n2 = 4, i = 1, x2 = 8, y0 = 4\n i = 2  -&gt;  n2 = 5, i = 2, x2 = 10, y0 = 5\n i = 3  -&gt;  n2 = 6, i = 3, x2 = 12, y0 = 6\n i = 4  -&gt;  n2 = 7, i = 4, x2 = 14, y0 = 7\n i = 5  -&gt;  n2 = 8, i = 5, x2 = 16, y0 = 8\n i = 6  -&gt;  n2 = 9, i = 6, x2 = 18, y0 = 9\n i = 7  -&gt;  n2 = 10, i = 7, x2 = 20, y0 = 10\n i = 8  -&gt;  n2 = 11, i = 8, x2 = 22, y0 = 11\n i = 9  -&gt;  n2 = 12, i = 9, x2 = 24, y0 = 12\n</code></pre>\n\n<p><strong>A Limitation of this approach</strong></p>\n\n<p>One limitation with this approach is the inability of creating temporary variables whose scope is the comma expression itself.</p>\n\n<p>A work around is to use the <code>do { \u2026 } while(0)</code> construct however you then have the problem of the macro is no longer valid in an assignment.</p>\n\n<p><strong>A Few Other Considerations</strong></p>\n\n<p>This sort of thing can be a bit tricky to use. You must always remember that the C Preprocessor is doing text substitution and there is not a great deal of smarts about it.</p>\n\n<p>You should use parenthesis to enforce a specific order of evaluation and to ensure that the substitution text provided when a macro is used will result in the correct order of operations (<code>(i + 3) * 2</code> and not <code>i + 3 * 2</code> which are two different statements due to the order of precedence of operators).</p>\n\n<p>Also be aware that using an expression with side effects in a macro that uses a macro argument more than once can result in unintended consequences. For instance:</p>\n\n<pre><code>#define SYMVAR(a,b)  ( ((a)=(b)), (b)*2)\n\nint xA, xB = 2, xVal;\n\nxVal = SYMVAR(xA, xB++);    // macro argument has a side effect, post increment\n</code></pre>\n\n<p>would result in <code>xVal</code> having a value of 6 (<code>xB</code> incremented once, since post increment, and then multiplied by 2), <code>xA</code> having a value of 2 (original value of <code>xB</code> since using post increment) and <code>xB</code> a value of 4 (<code>xB</code> is incremented twice).</p>\n\n<p>You could use one of the above macros in something like:</p>\n\n<pre><code>xx SYMVAR(n1, n2);\n</code></pre>\n\n<p>which would compile with a warning and then fail during the link. With Visual Studio 2017 I see the following warnings and errors when I add the above statement to the above program. Notice these warnings and errors are all about a missing external function <code>xx</code> and are not compiler errors which you might expect.</p>\n\n<pre><code>Severity    Code    Description Project File    Line    Suppression State\nWarning C4013   'xx' undefined; assuming extern returning int   console_scan    d:\\users\\rickc\\documents\\vs2017repos\\console_scan\\console_scan\\source_macro.c   27  \nError   LNK2019 unresolved external symbol _xx referenced in function _main console_scan    D:\\Users\\rickc\\Documents\\vs2017repos\\console_scan\\console_scan\\Source_Macro.obj 1   \nError   LNK1120 1 unresolved externals  console_scan    D:\\Users\\rickc\\Documents\\vs2017repos\\console_scan\\Debug\\console_scan.exe    1   \n</code></pre>\n"}], "owner": {"reputation": 393, "user_id": 6470928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ca50db72512cbab0ea4d95c14222d07?s=128&d=identicon&r=PG&f=1", "display_name": "bonehead", "link": "https://stackoverflow.com/users/6470928/bonehead"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 57778054, "answer_count": 3, "score": 0, "last_activity_date": 1569484176, "creation_date": 1567537862, "last_edit_date": 1567540591, "question_id": 57777501, "link": "https://stackoverflow.com/questions/57777501/using-the-comma-operator-when-defining-a-macro", "title": "Using the comma operator when defining a macro", "body": "<p>Considering situations where a comma operator would be of suitable use K&amp;R states (Chapter 3, page 63) \"<em>..., and in macros where a multistep computation has to be a single expression.</em>\"</p>\n\n<p>Now I know that <code>#define SYMVAR (expr1, expr2, expr3)</code> sets <code>SYMVAR</code> to <code>expr3</code> but that's not really the use the book is suggesting. My confusion stems from a lack of proper example for the mentioned use of the comma operator; secondly a multistep computation in a macro would be purposeful only if every comma-separated expression actually contributed in any way to the value of the macro itself which would be possible only if we somehow stored some intermediate values in some temporary variables which doesn't make any sense since we're talking about preprocessor directives.</p>\n\n<p>Am I missing something? What would be a proper example for such use of the comma operator that the book describes?</p>\n"}, {"tags": ["c", "linux", "terminal", "pty"], "answers": [{"comments": [{"owner": {"reputation": 185, "user_id": 11286381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bd2ffc4653496e286780db3b32ce3f5?s=128&d=identicon&r=PG&f=1", "display_name": "bicup", "link": "https://stackoverflow.com/users/11286381/bicup"}, "edited": false, "score": 0, "creation_date": 1567542059, "post_id": 57777726, "comment_id": 101991433, "body": "&quot;for all nonnegative k&lt;=1&quot; no; I used <code>float</code> to try 0.1, 0.5, 1, 2, 4 - they don&#39;t make all nonnegatives, but good samples. Can you explain some more why it can&#39;t work? When you say &quot;clipping it to the region you want to show&quot;, I&#39;m trying to &quot;extend/expand&quot; the view, not clip it. Side note: I tried using <code>screen</code>, but the same issue appears"}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "reply_to_user": {"reputation": 185, "user_id": 11286381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bd2ffc4653496e286780db3b32ce3f5?s=128&d=identicon&r=PG&f=1", "display_name": "bicup", "link": "https://stackoverflow.com/users/11286381/bicup"}, "edited": false, "score": 0, "creation_date": 1567550377, "post_id": 57777726, "comment_id": 101993762, "body": "@bicup: I don&#39;t understand what you mean by &quot;extend/expand&quot;; my best guess is that you mean you want to have a virtual size larger than the actual terminal (in which case displaying it would require clipping). But maybe I&#39;m misunderstanding what you want."}, {"owner": {"reputation": 185, "user_id": 11286381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bd2ffc4653496e286780db3b32ce3f5?s=128&d=identicon&r=PG&f=1", "display_name": "bicup", "link": "https://stackoverflow.com/users/11286381/bicup"}, "edited": false, "score": 0, "creation_date": 1567583000, "post_id": 57777726, "comment_id": 102001061, "body": "In the screenshot, see the mouse pointer, outside of the region of vim. I am trying to get vim use the full available screen. From what I understand, you might be thinking about the opposite way"}], "tags": [], "owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "is_accepted": false, "score": -1, "last_activity_date": 1567539052, "creation_date": 1567539052, "answer_id": 57777726, "question_id": 57777418, "link": "https://stackoverflow.com/questions/57777418/pty-runs-with-smaller-size/57777726#57777726", "title": "PTY runs with smaller size", "body": "<p>Your problem is almost surely not in the code you've shown but in the code you haven't. Also, your question isn't clear, but I suspect it's working fine not just for <code>k=0</code> but for all nonnegative <code>k</code> with <code>k&lt;=1</code>.</p>\n\n<p>Presumably you're passing the output from the program running on the pty through to the terminal your process has as its stdout, either as-is or modified in some way. In general this can't work. Rather, you'd have to actually emulate a (some particular type of) terminal, maintaining your own logical terminal contents in memory, then render that to the real terminal, clipping it to the region you want to show. This is rather nontrivial. Note that <code>screen</code> can already do at least a limited form of this though, without you having to write any new code.</p>\n"}], "owner": {"reputation": 185, "user_id": 11286381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bd2ffc4653496e286780db3b32ce3f5?s=128&d=identicon&r=PG&f=1", "display_name": "bicup", "link": "https://stackoverflow.com/users/11286381/bicup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 145, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1567630207, "creation_date": 1567537411, "last_edit_date": 1567538701, "question_id": 57777418, "link": "https://stackoverflow.com/questions/57777418/pty-runs-with-smaller-size", "title": "PTY runs with smaller size", "body": "<p>I'm writing a simple application to use ptys and run commands such as vi. When they run, regardless of my terminal emulator's size, the pty runs on a very small window; here's a screenshot: <a href=\"https://imgur.com/a/DdRG2Ib\" rel=\"nofollow noreferrer\">https://imgur.com/a/DdRG2Ib</a> the cursor is just outside the pty (and the screen is blank, nothing is written outside it).</p>\n\n<p>Keeping the terminal emulator at a maximum size, I aim to \"extend\" the pty's size and use the full screen.</p>\n\n<p>My approach was to get the size for stdout and set it on the master size of the terminal, following what I read here: <a href=\"https://stackoverflow.com/questions/11483141/cant-change-terminal-size-on-pty-n-works-on-ttyn\">Can&#39;t change terminal size on pty/N (works on ttyN)</a></p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#define err(x) { if((x)==-1) exit(1); }\nint set(int masterfd) {\n    float k = 0;\n    struct winsize w;\n    err(ioctl(STDOUT_FILENO, TIOCGWINSZ, &amp;w));\n    printf(\"wsz: r:%d c:%d\\n\", w.ws_row, w.ws_col);\n    w.ws_row *= k; w.ws_col *= k;\n    err(ioctl(masterfd, TIOCSWINSZ, &amp;w));\n    return 1;\n}\n</code></pre>\n\n<p>When <code>k</code> is non-zero, the whole screen is messed up. Only when both rows and columns are zero, the terminal is tiny but works.</p>\n\n<p>After opening the master, I was expecting a call to <code>set()</code> with the master fd to adjust the size of the terminal. The call to <code>printf()</code> shows that on <code>STDOUT_FILENO</code> the rows and columns are my display size, on the master fd they are 0.</p>\n\n<p>How can I make the pty use my full screen?</p>\n"}, {"tags": ["c", "sockets"], "comments": [{"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 1, "creation_date": 1567559081, "post_id": 57777398, "comment_id": 101995148, "body": "&quot;<i>My objective is to stop receiving when I have received the header whose end is marked by the delimiter</i>&quot; - then you are likely going to have to read 1 char at a time until you reach the delimiter. If the size of the header is not an even multiple of <code>CHUNK</code> then your <code>recv</code> loop will read too much data once it reaches the end of the header. Also, your use of <code>strstr()</code> is broken since <code>req_buffer</code> is not null terminated, and you are not concatenating each <code>req_buffer</code> received into an accumulated buffer on each loop iteration."}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1567559211, "post_id": 57777398, "comment_id": 101995170, "body": "&quot;<i>I am not guaranteed that the delimiter is present</i>&quot; - why not? What kind of protocol are you working with that it doesn&#39;t guarantee the delimiter is present? That would be very unusual, and very unstable, for a TCP-based protocol to not provide any way to reliably detect the end of the header. Are you sure the actual header size is not encoded inside the header itself? That would make more sense when a terminating delimiter is not used."}], "answers": [{"comments": [{"owner": {"reputation": 8973, "user_id": 831564, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b7b5cb565edb37aac67f053f64f0324f?s=128&d=identicon&r=PG", "display_name": "Marlin Pierce", "link": "https://stackoverflow.com/users/831564/marlin-pierce"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1567597017, "post_id": 57777583, "comment_id": 102008396, "body": "I am not sure if EOF is 0 or -1 and cannot confirm with online documentation.  However, I may be confusing it with <code>get</code> functions, which have to use 0 for zero bytes."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 2, "creation_date": 1567597149, "post_id": 57777583, "comment_id": 102008456, "body": "<a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/functions/recv.html\" rel=\"nofollow noreferrer\">Per POSIX</a>: &quot;Upon successful completion, recv() shall return the length of the message in bytes. If no messages are available to be received and the peer has performed an orderly shutdown, <code>recv()</code> shall return 0. Otherwise, -1 shall be returned and <code>errno</code> set to indicate the error.&quot;"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1567607024, "post_id": 57777583, "comment_id": 102014072, "body": "And from an <a href=\"http://man7.org/linux/man-pages/man2/recv.2.html\" rel=\"nofollow noreferrer\">online man page</a>: &quot;When a stream socket peer has performed an orderly shutdown, the        return value will be 0 (the traditional &quot;end-of-file&quot; return).&quot;"}, {"owner": {"reputation": 8973, "user_id": 831564, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b7b5cb565edb37aac67f053f64f0324f?s=128&d=identicon&r=PG", "display_name": "Marlin Pierce", "link": "https://stackoverflow.com/users/831564/marlin-pierce"}, "edited": false, "score": 0, "creation_date": 1567619028, "post_id": 57777583, "comment_id": 102020034, "body": "Thanks.  I found that page or a similar page but somehow couldn&#39;t find the return value section which mentioned EOF."}], "tags": [], "owner": {"reputation": 8973, "user_id": 831564, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b7b5cb565edb37aac67f053f64f0324f?s=128&d=identicon&r=PG", "display_name": "Marlin Pierce", "link": "https://stackoverflow.com/users/831564/marlin-pierce"}, "is_accepted": false, "score": 1, "last_activity_date": 1567596928, "last_edit_date": 1567596928, "creation_date": 1567538266, "answer_id": 57777583, "question_id": 57777398, "link": "https://stackoverflow.com/questions/57777398/what-do-send-and-recv-return-when-a-connection-is-open-but-no-data-is-being/57777583#57777583", "title": "What do send() and recv() return when a connection is open but no data is being sent?", "body": "<p>Yes there is improvement needed for your code.</p>\n\n<ol>\n<li><p>The reason you need a loop is that <code>recv</code> could return less than a full header, even if later in the header the delimiter will occur.  So you have to loop back and read more.</p>\n\n<p>You have a problem in your code that the second time <code>recv</code> is called, it will read the second time into the beginning of your buffer.</p></li>\n<li><p>You need to test for EOF.</p></li>\n<li><p>If no data is being sent, <code>recv</code> will wait until there is some.\nIf necessary it will wait forever,\nbut it will return with a non-success if the socket is closed.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "is_accepted": false, "score": 3, "last_activity_date": 1567538423, "creation_date": 1567538423, "answer_id": 57777612, "question_id": 57777398, "link": "https://stackoverflow.com/questions/57777398/what-do-send-and-recv-return-when-a-connection-is-open-but-no-data-is-being/57777612#57777612", "title": "What do send() and recv() return when a connection is open but no data is being sent?", "body": "<p>If the socket is in blocking mode (the default), <code>recv()</code> will wait until there is data available to return. The only way to deal with this is with a timeout. The easiest way to do this is with <code>select()</code> or <code>epoll()</code>.</p>\n\n<p>If the socket is in non-blocking mode, <code>recv()</code> will return <code>-1</code> immediately if there's nothing available, and <code>errno</code> will be set to <code>EWOULDBLOCK</code>. You'll still need to use some kind of timeout, since this could happen simply because you're calling <code>recv()</code> too soon, before all the data that has been sent is received.</p>\n\n<p>Timeouts are a pretty fragile mechanism, because it's always possible that there can be temporary network errors that last longer than the timeout, and you'll mistakenly treat the data before the outage as complete.</p>\n\n<p>Maybe you can redesign the protocol to handle this better. Rather than reading until a delimiter, have the sender send a prefix with the number of bytes in the message, then you call <code>recv()</code> until you get that many bytes.</p>\n"}], "owner": {"reputation": 513, "user_id": 6615337, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/Icgqz.jpg?s=128&g=1", "display_name": "Anthony O", "link": "https://stackoverflow.com/users/6615337/anthony-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 301, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1567596928, "creation_date": 1567537342, "question_id": 57777398, "link": "https://stackoverflow.com/questions/57777398/what-do-send-and-recv-return-when-a-connection-is-open-but-no-data-is-being", "title": "What do send() and recv() return when a connection is open but no data is being sent?", "body": "<p>I want to receive a request that is being sent in multiple chunks. In order to do so, I am using a TCP socket with recv. I loop over recv as follows:</p>\n\n<pre><code>while ((total_recv &lt; MAX_HEADER) &amp;&amp; (received = recv(client, req_buffer, CHUNK, 0)) &gt; 0) {\ntotal_recv += received;\nif (strstr(req_buffer, delimiter) != NULL)\n    break;\n}\n</code></pre>\n\n<p>My objective is to stop receiving when I have received the header whose end is marked by the delimiter. I am not guaranteed that the delimiter is present and so I break the loop if the total_recv is great or equal to the maximum known header size. </p>\n\n<p>I do not like this. What bothers me is I can receive a packet with no delimiter that is smaller than the maximum header size. In this case I then have to assume that recv will continue to increment total_recv until the loop breaks. I know from reading the sockets API that recv will return the number of bytes read into the buffer, -1 on error, or 0 if the connection has been closed.</p>\n\n<p>Is there a better way to loop on recv without relying on timeouts? What exactly are send() and recv() returning when a connection is open but not data is being transmitted by the sender or to the receiver?</p>\n"}, {"tags": ["c", "binary"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1567535415, "post_id": 57776925, "comment_id": 101989032, "body": "This is not as easy as it sounds, as storing binary data usually ends up in the data segment, which is not executable. You have to rellocate it into an executable segment first yourself and create a new process around that segment so it can be called in an <code>exec</code>-like way. In short, you have to reimplement the dynamic loader of the operating system."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1567535497, "post_id": 57776925, "comment_id": 101989071, "body": "I&#39;d be surprised if this isn&#39;t a <a href=\"https://stackoverflow.com/questions/42235175/how-do-i-add-contents-of-text-file-as-a-section-in-an-elf-file\">duplicate of this question</a> - or a similar one...."}, {"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 0, "creation_date": 1567536022, "post_id": 57776925, "comment_id": 101989278, "body": "<i><a href=\"https://codeplea.com/embedding-files-in-c-programs\" rel=\"nofollow noreferrer\">THIS</a></i> may, or may not address all of your needs, but it will likely  answer a few questions about feasibility."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 2, "creation_date": 1567536264, "post_id": 57776925, "comment_id": 101989364, "body": "The easiest thing to do might be to embed the binary, then, when it is needed, write it to a file and use one of the <code>exec</code> routines to execute that file. Or simply copy your own other binaries over when you are copying over this program. But this is likely an X-Y problem: To collect forensic data from a compromised system, you should not run that system at all. You should copy data directly from its storage (e.g., remove its storage and read it with another computer, or, if the hardware is not completely untrusted, boot it in \u201ctarget disk mode\u201d [a Mac feature] and read the data)."}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1567536322, "post_id": 57776925, "comment_id": 101989390, "body": "I have taken note of your forensic scheme and prepared a kernel mode rootkit."}, {"owner": {"reputation": 11, "user_id": 12015985, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCgP7b7VzDjITGopn5r3SGThOjZ96uJw_G_wUJiEA=k-s128", "display_name": "elsiesemico", "link": "https://stackoverflow.com/users/12015985/elsiesemico"}, "edited": false, "score": 0, "creation_date": 1567539344, "post_id": 57776925, "comment_id": 101990470, "body": "What do you mean Joshua?"}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "edited": false, "score": 0, "creation_date": 1567560485, "post_id": 57776925, "comment_id": 101995387, "body": "Using certified binaries actually won&#39;t help as much as you think. The kernel ABIs are simply going to lie to everybody who doesn&#39;t know the secret handshake."}, {"owner": {"reputation": 11, "user_id": 12015985, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCgP7b7VzDjITGopn5r3SGThOjZ96uJw_G_wUJiEA=k-s128", "display_name": "elsiesemico", "link": "https://stackoverflow.com/users/12015985/elsiesemico"}, "edited": false, "score": 0, "creation_date": 1567917051, "post_id": 57776925, "comment_id": 102106510, "body": "Joshua can you provide any references regarding the concept of Kernel ABIs and how these can be compromised?"}], "answers": [{"comments": [{"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1567536026, "post_id": 57777029, "comment_id": 101989281, "body": "The question states they do not want to use the binaries on the system, so <code>execl(&quot;&#47;bin&#47;ls&quot;\u2026)</code> is not an acceptable solution."}, {"owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1567536169, "post_id": 57777029, "comment_id": 101989331, "body": "@EricPostpischil: I see. I made a slight fix. He can ship the binaries as files and call them normally."}], "tags": [], "owner": {"reputation": 33990, "user_id": 14768, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/b6aMa.png?s=128&g=1", "display_name": "Joshua", "link": "https://stackoverflow.com/users/14768/joshua"}, "is_accepted": false, "score": 0, "last_activity_date": 1567536138, "last_edit_date": 1567536138, "creation_date": 1567535432, "answer_id": 57777029, "question_id": 57776925, "link": "https://stackoverflow.com/questions/57776925/embed-a-binary-in-c-program/57777029#57777029", "title": "Embed a binary in C program", "body": "<p>The ELF header of a binary isn't a function. You can't call it. If you could (like in some ancient binary formats) it would be a really bad idea because it would never return.</p>\n\n<p>If you want to run another program midstream do this:</p>\n\n<pre><code>int junk;\npid_t pid;\nif (!(pid = fork())) {\n    execl(\"ls\", \"/bin/ls\", ...); /* this results in running ls in current directory which is probably what you want but maybe you need to adjust */\n    _exit(3);\n}\nif (pid &gt; 0) waitpid(pid, &amp;junk, 0);\n</code></pre>\n\n<p>Error handling omitted for brevity.</p>\n\n<p>In your case, you should ship your own copies of your binaries alongside your program.</p>\n"}], "owner": {"reputation": 11, "user_id": 12015985, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCgP7b7VzDjITGopn5r3SGThOjZ96uJw_G_wUJiEA=k-s128", "display_name": "elsiesemico", "link": "https://stackoverflow.com/users/12015985/elsiesemico"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1567536138, "creation_date": 1567534950, "question_id": 57776925, "link": "https://stackoverflow.com/questions/57776925/embed-a-binary-in-c-program", "title": "Embed a binary in C program", "body": "<p>I am trying to write a program in C that would be able to call certain binaries (ex. lsof, netstat) with options. The purpose of this program is to collect forensic data from a computer, while at the same time this program should not use the binaries of the computer under analysis as they might be compromised. As a result it is required the certified/uncompromised  binaries (ex. lsof, netstat -antpu etc) already to be embedded in a C program or to be called by the C program stored in a usb drive for example.</p>\n\n<ol>\n<li>Having for example the binary of the \"ls\" command I created an object file using the linker as follows:</li>\n</ol>\n\n<pre><code>    $ ld -s -r -b binary -o testls.o bin-x86-2.4/ls\n</code></pre>\n\n<ol start=\"2\">\n<li>Using the following command I extracted the following entry points from the object file</li>\n</ol>\n\n<pre><code>    $ nm testls.o\n\n    000000000007a0dc D _binary_bin_x86_2_4_ls_end\n    000000000007a0dc A _binary_bin_x86_2_4_ls_size\n    0000000000000000 D _binary_bin_x86_2_4_ls_start\n</code></pre>\n\n<ol start=\"3\">\n<li><p>The next step would be to call the \"function\" from the main program with some options that I might need for example \"ls -al\". Thus I made a C program to call the entry point of the object file.</p></li>\n<li><p>Then I compiled the program with the following gcc options</p></li>\n</ol>\n\n<pre><code>    gcc -Wall -static testld.c testls.o -o testld\n</code></pre>\n\n<p>This is the main program: </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nextern int _binary_bin_x86_2_4_ls_start();\n\nint main(void)  \n{\n    _binary_bin_x86_2_4_ls_start();\n    return 0;\n}\n</code></pre>\n\n<p>When I run the program I am getting a segmentation fault. I checked the entry points using the objdump in the testld program and the linking seems to be successful. Why then I am getting a segmentation fault?\nI still need also to call \"ls\" with options. How I could do this, i.e. call the \"function\" with the arguments \"-al\".</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["c", "kernel", "pipe", "fork", "system-calls"], "comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1567535162, "post_id": 57776861, "comment_id": 101988922, "body": "Just because you write N bytes to one end of a pipe or stream socket in one go doesn&#39;t mean you&#39;ll read N bytes in one go on the other end."}, {"owner": {"reputation": 39, "user_id": 11747724, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oHqKx.png?s=128&g=1", "display_name": "Mihir Srivastava", "link": "https://stackoverflow.com/users/11747724/mihir-srivastava"}, "reply_to_user": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1567535238, "post_id": 57776861, "comment_id": 101988956, "body": "But why does it work in case of a Child process but in the case of Parent process? And then how can I do this?"}, {"owner": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1567535694, "post_id": 57776861, "comment_id": 101989145, "body": "Undefined behavior for out-of-bounds write."}, {"owner": {"reputation": 39, "user_id": 11747724, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oHqKx.png?s=128&g=1", "display_name": "Mihir Srivastava", "link": "https://stackoverflow.com/users/11747724/mihir-srivastava"}, "edited": false, "score": 0, "creation_date": 1567540047, "post_id": 57776861, "comment_id": 101990755, "body": "Can you please explain what do you mean?"}, {"owner": {"reputation": 4732, "user_id": 8477999, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f8172e1919af53269de92316dcf03a03?s=128&d=identicon&r=PG&f=1", "display_name": "Gem Taylor", "link": "https://stackoverflow.com/users/8477999/gem-taylor"}, "edited": false, "score": 0, "creation_date": 1567541493, "post_id": 57776861, "comment_id": 101991243, "body": "Not the issue, but <code>sizeof(str)</code> tells you about the buffer size, not the content length, and anyway you need 9 characters to store a zero terminated 8 letter string.  <code>strlen(str)&#47;(8*sizeof(char))</code> is integer maths and won&#39;t do what you think it will!"}], "answers": [{"tags": [], "owner": {"reputation": 1599, "user_id": 9948091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JANyt.png?s=128&g=1", "display_name": "HAL9000", "link": "https://stackoverflow.com/users/9948091/hal9000"}, "is_accepted": false, "score": 0, "last_activity_date": 1567542089, "last_edit_date": 1567542089, "creation_date": 1567541384, "answer_id": 57778145, "question_id": 57776861, "link": "https://stackoverflow.com/questions/57776861/how-to-work-with-two-pipes-while-sending-data-between-child-and-parent-process/57778145#57778145", "title": "How to work with two pipes while sending data between child and parent process?", "body": "<p>Your string-handling is broken. You need an array of length 9 to hold a string of length 8. (Remember that strings in c are zero-terminated). <strong><em>DO NOT WRITE <code>scanf(\"%s\", str);</code> TO READ STRINGS !!</em></strong> That is just as bad as using <code>gets()</code>. It allows you to overflow the buffer (Which actually happens in your case). Read strings like this:</p>\n\n<pre><code>scanf(\"%8s\", str);\n</code></pre>\n\n<p>This will read at most 8 (non-whitespace) characters and store them together with the zero-termination in str. (remember again that str must be large enough for 8 charecters + 1 termination character)</p>\n\n<p>Then to check the length of a string, use <code>strlen()</code>, do not use <code>sizeof()</code>. <code>sizeof</code> may only tell the size of the array holding the string, or the pointer pointing to the string. Remember that the array holding the string must be at least 1 character larger than the string, but is allowed to be larger than that. And the size of the array is fixed at creation. It doesn't change size depending on what you put in it.</p>\n\n<p>Oh, and by the way. You don't send/receive the termination character, so you have to set it yourself manually after you have called read():</p>\n\n<pre><code>read(pipe1[0], str, 8);\nstr[8] = 0;\n</code></pre>\n\n<p>There may be other problems with your code, but unless you fix the string-issues, you have undefined behavior, and everything else doesn't really matter.</p>\n"}], "owner": {"reputation": 39, "user_id": 11747724, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oHqKx.png?s=128&g=1", "display_name": "Mihir Srivastava", "link": "https://stackoverflow.com/users/11747724/mihir-srivastava"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1567542089, "creation_date": 1567534596, "question_id": 57776861, "link": "https://stackoverflow.com/questions/57776861/how-to-work-with-two-pipes-while-sending-data-between-child-and-parent-process", "title": "How to work with two pipes while sending data between child and parent process?", "body": "<p>I am learning about system calls, fork and pipe. I am creating a C program in which the parent process sends a character array to the child process and child process capitalizes the first 4 characters of the array and sends it back. The array is sent properly from parent to child, child makes the conversion and even writes to the second pipe properly, but parent process is not able to read the new array from the pipe 2.</p>\n\n<p>I've tried closing the unnecessary descriptors as well, but that didn't work. I read somewhere that parent process might be finishing before there is something to read from the pipe, for which I tried wait function(but I might have done this wrong. I am not sure.)</p>\n\n<p>I tried checking the size of values sent and received by the processes, </p>\n\n<p>Parent writes (8)</p>\n\n<p>Child reads (8)</p>\n\n<p>Child writes (8)</p>\n\n<p>Parent reads (1)</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\n#include&lt;unistd.h&gt;\n#include&lt;sys/types.h&gt;\n#include&lt;sys/wait.h&gt;\n\nint main(int argc, char *argv[]){\n    int pipe1[2];\n    int pipe2[2];\n    char str[8], str1[8];\n    pid_t pid;\n\n    if(pipe(pipe1) &lt; 0){\n        perror(\"Pipe 1 not created\\n\");\n        exit(EXIT_FAILURE);\n    }\n\n    if(pipe(pipe2) &lt; 0){\n        perror(\"Pipe 2 not created\\n\");\n        exit(EXIT_FAILURE);\n    } \n\n    pid = fork();\n\n    if (pid == 0){\n        close(pipe1[1]);\n        close(pipe2[0]);\n        printf(\"\\nChild Process\");\n        ssize_t rd_stat_child = read(pipe1[0], str, 8*sizeof(char));\n        if(rd_stat_child &gt; 0){\n            printf(\"rc%zd\\n\", rd_stat_child);\n            for(int i = 0; i &lt; 4; i++){\n                str[i] = ((char)(((int)str[i])-32));\n            }\n\n            printf(\"\\nFinal str in child: %s\\n\", str);\n            ssize_t wr_stat_child = write(pipe2[1], str, 8*sizeof(char));\n            printf(\"wc%zd\\n\", wr_stat_child);\n            if(wr_stat_child != sizeof(str)){\n                perror(\"Sending to parent failed\");\n                exit(EXIT_FAILURE);\n            }\n        }else{\n            perror(\"Child failed to read\");\n            exit(EXIT_FAILURE);\n        }\n\n    }else if (pid &gt; 0){\n        close(pipe1[0]);\n        close(pipe2[1]);\n        printf(\"\\nParent Process\");\n        printf(\"\\nEnter a 8 character string: \");\n        scanf(\"%s\", str);\n        if(sizeof(str)/(8*sizeof(char)) != 1){\n            perror(\"Size of string greater than 8\\n\");\n            exit(EXIT_FAILURE);\n        }else{\n            ssize_t wr_stat_parent = write(pipe1[1], str, 8*sizeof(char));\n            printf(\"wp%zd\\n\", wr_stat_parent);\n            if(wr_stat_parent != sizeof(str)){\n                perror(\"Parent failed writing.\\n\");\n                exit(EXIT_FAILURE);\n            }\n            ssize_t rd_stat_parent = read(pipe2[0], str, 8*sizeof(char));\n            close(pipe2[0]);\n            if(rd_stat_parent &lt;= sizeof(str)){\n                printf(\"rp%zd\\n\", rd_stat_parent);\n                printf(\"\\nParent Recieved\\n %s\", str);\n            }else{\n                perror(\"Parent error while reading\\n\");\n                exit(EXIT_FAILURE);\n            }\n\n        }\n    }\n\n    return 0;\n}\n</code></pre>\n\n<h3>Expected Output</h3>\n\n<p>Parent Process\n(input) >> lkybzqgv</p>\n\n<p>Child Process\n(process) >> LKYBzqgv</p>\n\n<p>Parent Process\n(output) >> LKYBzqgv</p>\n\n<h3>Actual Output</h3>\n\n<p>Parent Process\n(input) >> lkybzqgv</p>\n\n<p>Child Process\n(process) >> LKYBzqgv</p>\n\n<p>Parent Process\n(output) >> kybzqgv</p>\n"}, {"tags": ["c", "stack"], "comments": [{"owner": {"reputation": 26552, "user_id": 448932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QgLLl.png?s=128&g=1", "display_name": "500 - Internal Server Error", "link": "https://stackoverflow.com/users/448932/500-internal-server-error"}, "edited": false, "score": 4, "creation_date": 1567527301, "post_id": 57775336, "comment_id": 101985974, "body": "Usually, yes. But theoretically the two variables could also be allocated as the scope is entered and destroyed when the scope ends. It should not matter to the programmer."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1567531225, "post_id": 57775336, "comment_id": 101987481, "body": "Since neither <code>b</code> nor <code>c</code> are ever used, they&#39;re probably optimized out and never created."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 26552, "user_id": 448932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QgLLl.png?s=128&g=1", "display_name": "500 - Internal Server Error", "link": "https://stackoverflow.com/users/448932/500-internal-server-error"}, "edited": false, "score": 0, "creation_date": 1567533330, "post_id": 57775336, "comment_id": 101988285, "body": "@500: That is certainly true, but in practice the existence of the <code>goto</code> statement complicates the theoretical implementation you mention. (It&#39;s legal to jump into a block skipping over a declaration as long as the declaration isn&#39;t a VLA.)"}, {"owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "edited": false, "score": 0, "creation_date": 1567541192, "post_id": 57775336, "comment_id": 101991144, "body": "The compilers I&#39;m familiar with will allocate space for the inner scope objects at function entry - for a straightforward case like this, they&#39;ll allocate space for an additional <code>int</code> object at the beginning of the function, and that space will be used for either <code>b</code> or <code>c</code> depending on which branch is taken."}], "answers": [{"tags": [], "owner": {"reputation": 8833, "user_id": 337149, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3bbd41f2b74254f902cfe20acef9030b?s=128&d=identicon&r=PG", "display_name": "August Karlstrom", "link": "https://stackoverflow.com/users/337149/august-karlstrom"}, "is_accepted": false, "score": 0, "last_activity_date": 1567528128, "creation_date": 1567528128, "answer_id": 57775569, "question_id": 57775336, "link": "https://stackoverflow.com/questions/57775336/how-stack-structure-works-with-compound-statements-inside-a-function/57775569#57775569", "title": "How stack structure works with compound statements inside a function?", "body": "<p>Your example as stated is not valid since you have no brackets in the if-else statement. However, in the example below all variables are typically allocated when the function is entered:</p>\n\n<pre><code>int main(void)\n{\n    int a = 10;\n\n    if (a &lt; 50) {\n        int b = 9;\n    } else {\n        int c = 10;\n    }\n}\n</code></pre>\n\n<p>As mentioned by user \"500 - Internal Server Error\", this is an implementation issue.</p>\n"}, {"tags": [], "owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "is_accepted": true, "score": 1, "last_activity_date": 1567572974, "last_edit_date": 1567572974, "creation_date": 1567533588, "answer_id": 57776679, "question_id": 57775336, "link": "https://stackoverflow.com/questions/57775336/how-stack-structure-works-with-compound-statements-inside-a-function/57776679#57776679", "title": "How stack structure works with compound statements inside a function?", "body": "<p>The C standard doesn't specify how such things are to be implemented. The C standard doesn't even mention a stack! A stack is a common way of implementing function calls but nothing in the standard requires a stack. All such things are implementation specific details. For the posted code, the standard only specifies when the variables are in scope. </p>\n\n<p>So there is no general answer to your question. The answer depends on your specific system, i.e. processor, compiler, etc.</p>\n\n<p>Provided that your system uses a stack (which is likely), the compiler may reserve stack space for all 3 variables or it may reserve space for 2 variables, i.e. one for <code>a</code>while <code>b</code> and <code>c</code> share the other. Both implementations will be legal. The compiler is even allowed to place the variables directly in some registers so that nothing needs to be reserved on the stack.</p>\n\n<p>You can check your specific system by looking at the generated assembly code.</p>\n"}, {"tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": false, "score": 1, "last_activity_date": 1567534329, "creation_date": 1567534329, "answer_id": 57776812, "question_id": 57775336, "link": "https://stackoverflow.com/questions/57775336/how-stack-structure-works-with-compound-statements-inside-a-function/57776812#57776812", "title": "How stack structure works with compound statements inside a function?", "body": "<p>A C implementation may implement this in multiple ways. Let\u2019s suppose your example objects, <code>a</code>, <code>b</code>, and <code>c</code>, are actually used in your code in some way that results in the compiler actually allocating memory for them and not optimizing them away. Then:</p>\n\n<ul>\n<li>The compiler could allocate stack space (by decreasing the top-of-stack pointer) for all of <code>a</code>, <code>b</code>, and <code>c</code> when the function starts, and release it when the function ends.</li>\n<li>The compiler could allocate stack space for <code>a</code> when the function starts, then allocate space (again by decreasing the stack pointer) in the middle of the function when space for <code>b</code> or <code>c</code> is needed, then release that stack space as each block ends.</li>\n<li>In a good modern compiler, the compiler is likely to analyze all the active lifetimes of the objects and find a somewhat optimal solution for using stack space in overlapping ways. By \u201cactive lifetime\u201d, I mean the time from when the value of an object is set to the last time that value is needed (not the C standard\u2019s definition of \u201clifetime\u201d). For example, in <code>int a = f(x); \u2026 g(a); h(y); a = f(y); \u2026 g(a);</code>, there are actually two lifetimes for <code>a</code>, from its initial assignment to the first <code>g(a)</code> and from the assignment <code>a = f(y);</code> to the second <code>g(a);</code>. If the compiler needs memory to store <code>a</code>, it might use different memory for these two lifetimes.</li>\n</ul>\n\n<p>Because of the above, what memory is used for which C object can get quite complicated. A particular memory location might be used for <code>a</code> at one time and for <code>b</code> at another. It may depend on loops and <code>goto</code> statements in your code. It also depends on whether the address of an object is taken\u2014if the address is taken, the compiler may have to keep the object in one place, so that the address is consistent. (It might be able to get away without doing that, depending on how it can see the address is used.)</p>\n\n<p>Basically, the compiler is free to use the stack, other memory, and registers in whatever way it chooses as long as the <em>observable behavior</em> of your program remains as it is defined by the C standard.</p>\n\n<p>(The <em>observable behavior</em> is the input/output interactions of your program, the data written to files, and the accesses to volatile objects.)</p>\n"}], "owner": {"reputation": 21, "user_id": 7362605, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hElcW.png?s=128&g=1", "display_name": "coder_86", "link": "https://stackoverflow.com/users/7362605/coder-86"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 57776679, "answer_count": 3, "score": 0, "last_activity_date": 1567572974, "creation_date": 1567527088, "last_edit_date": 1567533288, "question_id": 57775336, "link": "https://stackoverflow.com/questions/57775336/how-stack-structure-works-with-compound-statements-inside-a-function", "title": "How stack structure works with compound statements inside a function?", "body": "<p>I'm trying to learn c programming and can't understand how stacks work.</p>\n\n<p>Everywhere I read I find that when a function is called stack frame is created in the stack which contains all the data for the function call- <strong>parameters, return address and local variables.</strong> And the stack frame is removed releasing the memory when the function returns.</p>\n\n<p>But what if we had a compound statement inside the function which have its own variables. Is the memory for the local variables for block is also allocated inside the stack frame when the function call and released when it returns.</p>\n\n<p><strong>Example</strong></p>\n\n<pre><code>int main(){\n    int a = 10;\n\n    if(int a&lt;50){\n        int b=9;\n    }\n    else{\n        int c=10;\n    }\n}\n</code></pre>\n\n<p>Is the memory for <em>b</em> and <em>c</em> is allocated with <em>a</em>  when the function starts executing?\nAnd deallocated when the function returns?</p>\n\n<p>If so than there is no difference other than the visibility of the variable when declaring it in the beginning of the function or inside a another block in the function.</p>\n\n<p>Please explain.    </p>\n"}, {"tags": ["c", "gdb"], "comments": [{"owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "edited": false, "score": 0, "creation_date": 1567532475, "post_id": 57775190, "comment_id": 101987945, "body": "Why, oh why, is this code style still taught these days? K&amp;R is outdated for more than 30 years... :-( Poor students."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 12015458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/338d0d791e928ea41ed0980ae55bbff1?s=128&d=identicon&r=PG&f=1", "display_name": "Sil", "link": "https://stackoverflow.com/users/12015458/sil"}, "edited": false, "score": 0, "creation_date": 1567533523, "post_id": 57775853, "comment_id": 101988361, "body": "I should&#39;ve specified, that I know the issue is that you eventually divide by 0. But raise() does matter to GDB. I can&#39;t run GDB commands because of that error.   I&#39;ll list my steps as follows: gdb crash1.out (opens gdb) run (runs program and then gives the raise.c issue) then if I try to do anything like &quot;display x&quot; I get:  <code>(gdb) display x No symbol &quot;x&quot; in current context.</code>  So that error prevents me from using gdb at all from my current knowledge."}, {"owner": {"reputation": 1, "user_id": 12015458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/338d0d791e928ea41ed0980ae55bbff1?s=128&d=identicon&r=PG&f=1", "display_name": "Sil", "link": "https://stackoverflow.com/users/12015458/sil"}, "edited": false, "score": 0, "creation_date": 1567533725, "post_id": 57775853, "comment_id": 101988435, "body": "I tried formatting the above prettier, but that apparently doesn&#39;t do anything? Sorry for the ugly mess of words. Also, when I try running something like &#39;step I get&#39;  <code>Program terminated with signal SIGFPE, Arithmetic exception. The program no longer exists.</code>"}, {"owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "reply_to_user": {"reputation": 1, "user_id": 12015458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/338d0d791e928ea41ed0980ae55bbff1?s=128&d=identicon&r=PG&f=1", "display_name": "Sil", "link": "https://stackoverflow.com/users/12015458/sil"}, "edited": false, "score": 0, "creation_date": 1567535504, "post_id": 57775853, "comment_id": 101989078, "body": "Great, good finding, I spotted the same. If GDB says that there are no symbols in the current context, you have to compile the program with debugger support. This is done with the option <code>-g</code>. GDB will have told you for now &quot;No debugging symbols found in crash1.out&quot;, doesn&#39;t it? BTW on my Arch Linux derivative GDB gives me &quot;Program received signal SIGFPE, Arithmetic exception. 0x... in main () at crash1.c:7&quot; with the location part only when compiled with debugger support. And yes, the formatting in the option are quite limited. :-}"}, {"owner": {"reputation": 1, "user_id": 12015458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/338d0d791e928ea41ed0980ae55bbff1?s=128&d=identicon&r=PG&f=1", "display_name": "Sil", "link": "https://stackoverflow.com/users/12015458/sil"}, "edited": false, "score": 0, "creation_date": 1567539677, "post_id": 57775853, "comment_id": 101990617, "body": "Just recompiled to make sure, but I have confirmed I&#39;ve compiled with gcc -g and still get the same errors for displaying variables and everything"}, {"owner": {"reputation": 1, "user_id": 12015458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/338d0d791e928ea41ed0980ae55bbff1?s=128&d=identicon&r=PG&f=1", "display_name": "Sil", "link": "https://stackoverflow.com/users/12015458/sil"}, "edited": false, "score": 0, "creation_date": 1567541247, "post_id": 57775853, "comment_id": 101991164, "body": "I made a quick video of <a href=\"https://videobin.org/+126j/17xc.html\" rel=\"nofollow noreferrer\">what I&#39;m doing</a>. Sorry for the low quality though."}], "tags": [], "owner": {"reputation": 5397, "user_id": 11294831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M9BL5.png?s=128&g=1", "display_name": "the busybee", "link": "https://stackoverflow.com/users/11294831/the-busybee"}, "is_accepted": false, "score": 1, "last_activity_date": 1567580236, "last_edit_date": 1567580236, "creation_date": 1567529337, "answer_id": 57775853, "question_id": 57775190, "link": "https://stackoverflow.com/questions/57775190/how-to-fix-gdb-not-finding-file-sysdeps-unix-sysv-linux-raise-c50/57775853#57775853", "title": "How to fix GDB not finding file: &quot;../sysdeps/unix/sysv/linux/raise.c:50&quot;", "body": "<p>It does not really matter that the source for <code>raise()</code> is not found. It would only show you the line where the exception is finally raised, but not the place where the error is triggered.</p>\n\n<p>Run the erroneous program again in GDB. And when the exception is raised, investigate the call stack and the stackframes with GBDs commands. This is the point in your task, so I won't give you more than this hint.</p>\n\n<p>If you're clever you can see the error in the given source just by looking at it. ;-)</p>\n\n<p>When GDB does not know any symbol, you need to compile with the option <code>-g</code> to get debugger support.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Now on a Windows system this is my log (please excuse the colouring, I didn't found a language selector for pure text):</p>\n\n<pre><code>D:\\tmp\\StackOverflow\\so_027 &gt; type crash1.c\n#include &lt;stdio.h&gt;\nmain()\n{\n        int x,y;\n        y=54389;\n        for (x=10; x&gt;=0; x--)\n        y=y/x;\n        printf(\"%d\\n\",y);\n}\n\nD:\\tmp\\StackOverflow\\so_027 &gt; gcc crash1.c -g -o crash1.out\ncrash1.c:2:1: warning: return type defaults to 'int' [-Wimplicit-int]\n main()\n ^~~~\n\nD:\\tmp\\StackOverflow\\so_027 &gt; dir\n[...cut...]\n04.09.2019  08:33               144 crash1.c\n04.09.2019  08:40            54.716 crash1.out\n\nD:\\tmp\\StackOverflow\\so_027 &gt; gdb crash1.out\nGNU gdb (GDB) 8.1\n[...cut...]\nThis GDB was configured as \"x86_64-w64-mingw32\".\n[...cut...]\nReading symbols from crash1.out...done.\n(gdb) run\nStarting program: D:\\tmp\\StackOverflow\\so_027\\crash1.out\n[New Thread 4520.0x28b8]\n[New Thread 4520.0x33f0]\n\nThread 1 received signal SIGFPE, Arithmetic exception.\n0x0000000000401571 in main () at crash1.c:7\n7               y=y/x;\n(gdb) backtrace\n#0  0x0000000000401571 in main () at crash1.c:7\n(gdb) help stack\nExamining the stack.\nThe stack is made up of stack frames.  Gdb assigns numbers to stack frames\ncounting from zero for the innermost (currently executing) frame.\n\nAt any time gdb identifies one frame as the \"selected\" frame.\nVariable lookups are done with respect to the selected frame.\nWhen the program being debugged stops, gdb selects the innermost frame.\nThe commands below can be used to select other frames by number or address.\n\nList of commands:\n\nbacktrace -- Print backtrace of all stack frames\nbt -- Print backtrace of all stack frames\ndown -- Select and print stack frame called by this one\nframe -- Select and print a stack frame\nreturn -- Make selected stack frame return to its caller\nselect-frame -- Select a stack frame without printing anything\nup -- Select and print stack frame that called this one\n\nType \"help\" followed by command name for full documentation.\nType \"apropos word\" to search for commands related to \"word\".\nCommand name abbreviations are allowed if unambiguous.\n(gdb) next\n\nThread 1 received signal SIGFPE, Arithmetic exception.\n0x0000000000401571 in main () at crash1.c:7\n7               y=y/x;\n(gdb) next\n[Inferior 1 (process 4520) exited with code 030000000224]\n(gdb) next\nThe program is not being run.\n(gdb) quit\n\nD:\\tmp\\StackOverflow\\so_027 &gt;\n</code></pre>\n\n<p>Well, it marks directly the erroneous source line. That is different to your environment as you use a Raspi. However, it shows you some GDB commands to try.</p>\n\n<p>Concerning your video:</p>\n\n<ul>\n<li>It is clear that inside <code>raise()</code> you can't access <code>x</code>. That's why GDB moans about it.</li>\n<li>If an exception is raised usually the program is about to quit. So there is no value in stepping forward.</li>\n<li>Instead, as shown in my log, use GDB commands to investigate the stack frames. I think this is the issue you are about to learn.</li>\n</ul>\n\n<p>BTW, do you know that you should be able to copy the screen content? This will make reading so much easier for us.</p>\n"}, {"tags": [], "owner": {"reputation": 428, "user_id": 1418663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80ef9e8cf2739567a75dbd94e6eb124a?s=128&d=identicon&r=PG", "display_name": "Christian B", "link": "https://stackoverflow.com/users/1418663/christian-b"}, "is_accepted": false, "score": 1, "last_activity_date": 1568523214, "creation_date": 1568523214, "answer_id": 57941257, "question_id": 57775190, "link": "https://stackoverflow.com/questions/57775190/how-to-fix-gdb-not-finding-file-sysdeps-unix-sysv-linux-raise-c50/57941257#57941257", "title": "How to fix GDB not finding file: &quot;../sysdeps/unix/sysv/linux/raise.c:50&quot;", "body": "<p>From a practical standpoint the other answer is correct, but if you do want the libc sources:</p>\n\n<p>apt-get source is the right way to get the sources of libc, but yes, you do need to have source repositories configured in /etc/apt/sources.list.</p>\n\n<p>If you're using Ubuntu, see the deb-src lines in <a href=\"https://help.ubuntu.com/community/Repositories/CommandLine\" rel=\"nofollow noreferrer\">https://help.ubuntu.com/community/Repositories/CommandLine</a></p>\n\n<p>For debian, see <a href=\"https://wiki.debian.org/SourcesList#Example_sources.list\" rel=\"nofollow noreferrer\">https://wiki.debian.org/SourcesList#Example_sources.list</a></p>\n\n<p>Then apt-get source should work. Remember to tell GDB where those sources are using the \"directory\" command.</p>\n"}], "owner": {"reputation": 1, "user_id": 12015458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/338d0d791e928ea41ed0980ae55bbff1?s=128&d=identicon&r=PG&f=1", "display_name": "Sil", "link": "https://stackoverflow.com/users/12015458/sil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2977, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1568523214, "creation_date": 1567526486, "question_id": 57775190, "link": "https://stackoverflow.com/questions/57775190/how-to-fix-gdb-not-finding-file-sysdeps-unix-sysv-linux-raise-c50", "title": "How to fix GDB not finding file: &quot;../sysdeps/unix/sysv/linux/raise.c:50&quot;", "body": "<p>We're learning to use GDB in my Computer Architecture class. To do this we do most of our work by using SSH to connect to a raspberry pi. When running GDB on some code he gave us to debug though it ends with an error message on how it can't find raise.c</p>\n\n<p>I've tried:</p>\n\n<p>installing libc6, libc6-dbg (says they're already up-to-date)</p>\n\n<p>apt-get source glibc (gives me: \"You must put some 'source' URIs in your sources.list\")</p>\n\n<p><a href=\"https://stackoverflow.com/a/48287761/12015458\">https://stackoverflow.com/a/48287761/12015458</a> (apt source returns same thing as the apt-get source above, the \"find $PWD\" command the user gave returns nothing)</p>\n\n<p>I've tried looking for it manually where told it may be? (/lib/libc doesn't exist for me)</p>\n\n<p>This is the code he gave us to try debugging on GDB:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nmain()\n{\n        int x,y;\n        y=54389;\n        for (x=10; x&gt;=0; x--)\n        y=y/x;\n        printf(\"%d\\n\",y);\n}\n</code></pre>\n\n<p>However, whenever I run the code in GDB I get the following error:</p>\n\n<pre><code>Program received signal SIGFPE, Arithmetic exception.\n__GI_raise (sig=8) at ../sysdeps/unix/sysv/linux/raise.c:50\n50      ../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n</code></pre>\n\n<p>I asked him about it and he didn't really have any ideas on how to fix it.</p>\n"}, {"tags": ["c", "function", "syntax", "clion", "definition"], "comments": [{"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 1, "creation_date": 1567525336, "post_id": 57774708, "comment_id": 101985044, "body": "How did you run the program in a debugger if yout get syntax errors? This normally means the compiler cannot create any executable from your code. The lines you marked do not look bad."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567525406, "post_id": 57774708, "comment_id": 101985081, "body": "I don&#39;t get any error from GCC. Only some warnings about statement with no effect. These are mentioned in Vlad&#39;s answer."}, {"owner": {"reputation": 43, "user_id": 11826738, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gK4KG10I5kk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfdMzX6pfzS5LOtL7sYBvaGP0DO2g/photo.jpg=k-s128", "display_name": "Matteo", "link": "https://stackoverflow.com/users/11826738/matteo"}, "reply_to_user": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567525628, "post_id": 57774708, "comment_id": 101985190, "body": "I guess CLion with the debugger my school chose to use does not want to give extra help such as warnings like that. @Gerhardh"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567525737, "post_id": 57774708, "comment_id": 101985245, "body": "I assume you have some mismatch between code in your editor and code that is really compiled. Maybe project settings are messed up? The code you showed definitely has no syntax error. I could imagine the compiling failed and you happened to still run the debugger that used some older executable."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567525760, "post_id": 57774708, "comment_id": 101985261, "body": "Enabling warnings should be one of the first lessons to learn in a programming class."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1567525831, "post_id": 57774708, "comment_id": 101985293, "body": "BTW: A Debugger does not give any warnings. It does not look at the code at all. It is the compiler&#39;s job. You must learn to distinguish them. Otherwise you will run into lots of strange conversation. ;)"}], "answers": [{"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": true, "score": 4, "last_activity_date": 1567525196, "last_edit_date": 1567525196, "creation_date": 1567524738, "answer_id": 57774782, "question_id": 57774708, "link": "https://stackoverflow.com/questions/57774708/getting-a-syntax-error-on-a-variable-declaration-in-c/57774782#57774782", "title": "Getting a syntax error on a variable declaration in C", "body": "<p>It seems you mean</p>\n\n<pre><code>multipleOf3 += 3\n</code></pre>\n\n<p>and</p>\n\n<pre><code>multipleOf5 += 5\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>multipleOf3 + 3\n</code></pre>\n\n<p>and </p>\n\n<pre><code>multipleOf5 + 5\n</code></pre>\n\n<p>With these changes the function compiles without errors.</p>\n"}], "owner": {"reputation": 43, "user_id": 11826738, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gK4KG10I5kk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfdMzX6pfzS5LOtL7sYBvaGP0DO2g/photo.jpg=k-s128", "display_name": "Matteo", "link": "https://stackoverflow.com/users/11826738/matteo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 583, "favorite_count": 0, "accepted_answer_id": 57774782, "answer_count": 1, "score": 2, "last_activity_date": 1567525196, "creation_date": 1567524384, "last_edit_date": 1567524917, "question_id": 57774708, "link": "https://stackoverflow.com/questions/57774708/getting-a-syntax-error-on-a-variable-declaration-in-c", "title": "Getting a syntax error on a variable declaration in C", "body": "<p>I see a syntax error when I run the debugger on the two variables I declare in CLion. I commented the debugger errors it shows me in the lines of the two variables.</p>\n\n<pre><code>int sum3or5Multiples() {\n\n    int sum = 0;    // sum: error: A syntax error in expression, near `/mt sum`.\n    int multipleOf3;    // multipleOf3: error: A syntax error in expression, near `/mt multipleOf3`\n    for (multipleOf3 = 0; multipleOf3 &lt; 1000; multipleOf3 + 3) {\n        sum = sum + multipleOf3;\n    }\n    int multipleOf5;\n    for (multipleOf5 = 0; multipleOf5 &lt; 1000; multipleOf5 + 5) {\n        sum = sum + multipleOf5;\n        if ((3 * multipleOf5) &lt; 1000) {\n            sum = sum - (3 * multipleOf5);\n        }\n    }\n    return sum;\n}\n</code></pre>\n"}, {"tags": ["c", "multithreading", "unix", "destructor"], "comments": [{"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 0, "creation_date": 1567524380, "post_id": 57774613, "comment_id": 101984581, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/840501/how-do-function-pointers-in-c-work\">How do function pointers in C work?</a>"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1567525591, "post_id": 57774613, "comment_id": 101985174, "body": "<code>pthread_once</code> uses a flag to make sure that a function is called one time only. In this case that function is <code>thread_init</code>, which uses a pointer to <code>key</code> to initialize it, and a pointer to the <code>destructor</code> function to clean it up. That is useful to avoid memory leaks or open files or anything that might be opened or allocated because threads can exit for many reasons, such as error conditions. A destructor function makes it easier to handle."}, {"owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1567525813, "post_id": 57774613, "comment_id": 101985284, "body": "@ZanLynx, but in this example destructor function does nothing. Am I right?"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 1, "creation_date": 1567525992, "post_id": 57774613, "comment_id": 101985379, "body": "@Rudzianko\u016d We don&#39;t know because all that code shows is a declaration, not any definition of the function. As is, it would compile but fail to link."}], "answers": [{"tags": [], "owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "is_accepted": false, "score": 3, "last_activity_date": 1567525333, "creation_date": 1567525333, "answer_id": 57774939, "question_id": 57774613, "link": "https://stackoverflow.com/questions/57774613/why-pthread-key-need-destructor/57774939#57774939", "title": "Why pthread_key need destructor?", "body": "<blockquote>\n  <p>I don't understand how does <code>key</code> initialize</p>\n</blockquote>\n\n<p><code>key</code> is used to identify a slot in thread-specific storage. <code>pthread_key_create</code> stores the slot number in <code>key</code>.</p>\n\n<blockquote>\n  <p>Why does this key need destructor? And what does this destructor do?</p>\n</blockquote>\n\n<p>See <a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/functions/pthread_key_create.html\" rel=\"nofollow noreferrer\"><code>pthread_key_create</code></a>:</p>\n\n<blockquote>\n  <p>An optional destructor function may be associated with each key value. At thread exit, if a key value has a non-NULL destructor pointer, and the thread has a non-NULL value associated with that key, the value of the key is set to NULL, and then the function pointed to is called with the previously associated value as its sole argument. The order of destructor calls is unspecified if more than one destructor exists for a thread when it exits.</p>\n</blockquote>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567525333, "creation_date": 1567524007, "last_edit_date": 1567525272, "question_id": 57774613, "link": "https://stackoverflow.com/questions/57774613/why-pthread-key-need-destructor", "title": "Why pthread_key need destructor?", "body": "<p>I am reading <a href=\"http://www.apuebook.com/apue3e.html\" rel=\"nofollow noreferrer\">APUE</a> the chapter about thread specific data. I see following code snipit:</p>\n\n<pre><code>void destructor(void *);\npthread_key_t key;\npthread_once_t init_done = PTHREAD_ONCE_INIT;\n\nvoid thread_init(void){\n    err = pthread_key_create(&amp;key, destructor);\n}\nint threadfunc(void *arg){\n    pthread_once(&amp;init_done, thread_init);\n//...\n}\n</code></pre>\n\n<p>I have several questions:</p>\n\n<ol>\n<li>I don't understand how does <code>key</code> initialize </li>\n<li>Why does this key need destructor? And what does this destructor do?</li>\n</ol>\n"}, {"tags": ["c", "loops", "while-loop", "string-comparison", "c-strings"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 2, "creation_date": 1567522737, "post_id": 57774127, "comment_id": 101983709, "body": "You can&#39;t compare strings with <code>==</code> in C. You&#39;ll need to isolate each word in the file, and then compare it with each keyword in the array using <code>strcmp</code> or a similar function of your own devising. If you don&#39;t want to use <code>strcmp</code> then the first job is to write the equivalent function."}, {"owner": {"reputation": 3268, "user_id": 182634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d5b602ab0bc363e3e990f2e904b671d?s=128&d=identicon&r=PG", "display_name": "eyalm", "link": "https://stackoverflow.com/users/182634/eyalm"}, "edited": false, "score": 0, "creation_date": 1567522939, "post_id": 57774127, "comment_id": 101983825, "body": "are you looking for an alternative to strcmp? is it ok to implement it by yourself?"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 4, "creation_date": 1567523045, "post_id": 57774127, "comment_id": 101983897, "body": "What&#39;s wrong with <code>strcmp</code>? It sounds like: <i>I want to print my word document without using my printer</i>."}], "answers": [{"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 0, "last_activity_date": 1567523826, "last_edit_date": 1567523826, "creation_date": 1567523116, "answer_id": 57774377, "question_id": 57774127, "link": "https://stackoverflow.com/questions/57774127/how-to-compare-two-2-d-string-without-using-strcmp/57774377#57774377", "title": "how to compare two 2 d string without using strcmp", "body": "<p>To compare two strings without using standard C functions you can use a loop like that</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void) \n{\n    char key[]   = \"while\";\n    char word1[] = \"while\";\n    char word2[] = \"when\";\n\n    size_t i = 0;\n\n    while ( key[i] != '\\0' &amp;&amp; key[i] == word1[i] ) ++i;\n\n    int equal = key[i] == word1[i];\n\n    printf( \"key == word1: = %d\\n\", equal );\n\n    i = 0;\n\n    while ( key[i] != '\\0' &amp;&amp; key[i] == word2[i] ) ++i;\n\n    equal = key[i] == word2[i];\n\n    printf( \"key == word2: = %d\\n\", equal );\n\n    return 0;\n}\n</code></pre>\n\n<p>The program output is</p>\n\n<pre><code>key == word1: = 1\nkey == word2: = 0\n</code></pre>\n\n<p>Or you can write a separate function. For example</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint equal( const char *s1, const char *s2 )\n{\n    while ( *s1 != '\\0' &amp;&amp; *s1 == *s2 ) \n    {\n        ++s1; ++s2;\n    }\n\n    return *s1 == *s2;\n}\n\nint main(void) \n{\n    enum { N = 10 };\n    char key[][N] ={ \"if\",  \"while\" };\n    const size_t N1 = sizeof( key ) / sizeof( *key );\n    char words[][N] = { \"welcome\", \"user\", \"HII\", \"if\",  \"while\" };\n    const size_t N2 = sizeof( words ) / sizeof( *words );\n\n    for ( size_t i = 0; i &lt; N2; i++ )\n    {\n        for ( size_t j = 0; j &lt; N1; j++ )\n        {\n            if ( equal( key[j], words[i] ) )\n            {\n                printf( \"\\\"%s\\\" == \\\"%s\\\"[%zu]\\n\", key[j], words[i], i );\n            }               \n        }\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>the program output is</p>\n\n<pre><code>\"if\" == \"if\"[3]\n\"while\" == \"while\"[4]\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11638812, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-i2KL9Xu5JIc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rer_L5t8mxkYtMdcb34mSjyH5oDwQ/mo/photo.jpg?sz=128", "display_name": "Pragati Shandilya", "link": "https://stackoverflow.com/users/11638812/pragati-shandilya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 301, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1567524581, "creation_date": 1567522198, "last_edit_date": 1567524581, "question_id": 57774127, "link": "https://stackoverflow.com/questions/57774127/how-to-compare-two-2-d-string-without-using-strcmp", "title": "how to compare two 2 d string without using strcmp", "body": "<p>I have data file in which some data is kept.\nexample: <code>welcome   user    HII if  while</code><br>\nI have made 2D character array to store all the keywords in c.\nnow I want two know if the data file contain the keyword or not.</p>\n\n<pre><code>enter code here\n  for(i=0;i&lt;32;i++)\n  for(j=0;j&lt;no_of_words_in_file;j++)\n      if(k[i]==t[j])\n         printf(\"%s is keyword\",t[j]);\n</code></pre>\n\n<p>here the k[i] represents the 2D character array where all the keywords in c are stored and t[i] represents the 2D character array where all the words of file are stored.\nI want to compare these 2D arrays without using strcmp.</p>\n"}, {"tags": ["c", "kernel"], "answers": [{"tags": [], "owner": {"reputation": 5450, "user_id": 2758823, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9Nxaq.jpg?s=128&g=1", "display_name": "Giacomo Catenazzi", "link": "https://stackoverflow.com/users/2758823/giacomo-catenazzi"}, "is_accepted": false, "score": 1, "last_activity_date": 1567522746, "creation_date": 1567522746, "answer_id": 57774288, "question_id": 57773940, "link": "https://stackoverflow.com/questions/57773940/why-only-the-kernel-can-switch-cpu-execution-mode/57774288#57774288", "title": "Why only the kernel can switch CPU execution mode?", "body": "<p>It is not totally true. The CPU will switch execution mode, and user space program can force such switch. Just that kernel should assure that all methods will get in kernel controlled memory.</p>\n\n<p>System calls are one of the most common method to go in kernel mode. There are various methods do do a system call, e.g. with a software interrupt, or just a far call (far call: using a custom segment, specially marked on segment table).</p>\n\n<p>But userspace programs could make CPU to switch into kernel, with exceptions (e.g. division by zero, so with explicit instructions), protection exceptions (accessing protected memory), debug registers, etc.</p>\n\n<p>And hardware interrupts (timers, but also new inputs) could make the CPU to switch into kernel mode (in this case in a special interrupt mode, where the stack is small, but if there are many things to do, the interrupt code will cause to go into kernel mode after the interrupt it done).</p>\n\n<p>Note: Any code in real mode could switch into protected mode, but this is relevant only for boot phase.</p>\n"}, {"tags": [], "owner": {"reputation": 4859, "user_id": 7431860, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/P6Jko.jpg?s=128&g=1", "display_name": "Nick Reed", "link": "https://stackoverflow.com/users/7431860/nick-reed"}, "is_accepted": false, "score": 2, "last_activity_date": 1567524124, "creation_date": 1567524124, "answer_id": 57774641, "question_id": 57773940, "link": "https://stackoverflow.com/questions/57773940/why-only-the-kernel-can-switch-cpu-execution-mode/57774641#57774641", "title": "Why only the kernel can switch CPU execution mode?", "body": "<p>I trust you already know <em>why</em> we have user and kernel mode - <a href=\"https://blog.codinghorror.com/understanding-user-and-kernel-mode/\" rel=\"nofollow noreferrer\">separation</a> of <a href=\"https://www.tutorialspoint.com/User-Mode-vs-Kernel-Mode\" rel=\"nofollow noreferrer\">trusted and untrusted</a> <a href=\"https://stackoverflow.com/a/1311432/7431860\">software</a> - so let's try to address the <em>how.</em> (I'm assuming a linux environment, as you're reading about the linux kernel.)</p>\n\n<p>User programs can't really be trusted with low-level memory and hardware access; at best, the could overwrite one another's data, and at worst, they could damage the hardware. However, when a program just has to have access to low-level functions like memory allocation or hardware I/O, they can use a list of <a href=\"http://tldp.org/HOWTO/KernelAnalysis-HOWTO-3.html\" rel=\"nofollow noreferrer\">trusted system calls</a> to perform their operations.</p>\n\n<p>According to LINFO, the standard procedure for switching from user mode to kernel mode is to call <a href=\"http://www.linfo.org/kernel_mode.html\" rel=\"nofollow noreferrer\">software interrupt <code>INT 0x80</code></a> - this assumes you're <a href=\"http://www.linfo.org/int_0x80.html\" rel=\"nofollow noreferrer\">on an x86 processor.</a> Specifically, the interrupt is thrown when a process in user mode <a href=\"https://www.tutorialspoint.com/User-Mode-vs-Kernel-Mode\" rel=\"nofollow noreferrer\">attempts to access a privileged operation</a>; this is illegal, and a trap (exception) is generated.  Before the user process fires this interrupt, it stores in the process register (very small, very fast memory built into the processor) the <a href=\"http://www.linfo.org/system_call_number.html\" rel=\"nofollow noreferrer\">system call number</a> and any arguments to said call. </p>\n\n<p>Once the user's program fires the interrupt, the kernel takes notice of it, checks the call and its argument, and then <a href=\"https://stackoverflow.com/a/13209180/7431860\">switches the mode bit</a> (stored in the CS register) to kernel mode. The system call executes, the mode is switched back to user, and control returns to the user's program. </p>\n\n<hr>\n\n<p>The operation is only possible in this context, in no small part because it's <a href=\"https://blog.codinghorror.com/understanding-user-and-kernel-mode/\" rel=\"nofollow noreferrer\">enforced by the hardware.</a> I'm not sure if it's actually possible for a <em>user</em> to execute code in kernel space, but it's possible to trick the system into thinking you're root in order to access low-level hardware - that's called <a href=\"https://en.wikipedia.org/wiki/Privilege_escalation\" rel=\"nofollow noreferrer\">privilege escalation</a>, and while such vulnerabilities and exploits are rare, they're a <em>huge</em> problem when they pop up. </p>\n\n<hr>\n\n<p><strong>tl;dr:</strong> User program tries to access a privileged instruction, gets blocked, and fires an interrupt requesting the kernel's help. The kernel catches it, switches the mode bit to go into kernel mode to perform the call, and then switches the bit back and returns to the user. Users shouldn't be able to execute in kernel mode, and if they can, you've got a serious problem on your hands.</p>\n"}, {"comments": [{"owner": {"reputation": 910, "user_id": 6422591, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/wIpwn.jpg?s=128&g=1", "display_name": "manish ma", "link": "https://stackoverflow.com/users/6422591/manish-ma"}, "edited": false, "score": 0, "creation_date": 1567537527, "post_id": 57776959, "comment_id": 101989840, "body": "So this means user space code can never run in CPU kernel mode? but it can load kernel extensions to do the priveleged work in kernel?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 910, "user_id": 6422591, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/wIpwn.jpg?s=128&g=1", "display_name": "manish ma", "link": "https://stackoverflow.com/users/6422591/manish-ma"}, "edited": false, "score": 1, "creation_date": 1567538181, "post_id": 57776959, "comment_id": 101990068, "body": "@sergeyrar: \u201cNever\u201d is an absolute. A privileged process could load and execute a kernel extension, and kernel extension could do anything, including changing the operating system to let the process run its own code in kernel mode. But, normally, user processes cannot run in kernel mode."}], "tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": false, "score": 1, "last_activity_date": 1567535120, "creation_date": 1567535120, "answer_id": 57776959, "question_id": 57773940, "link": "https://stackoverflow.com/questions/57773940/why-only-the-kernel-can-switch-cpu-execution-mode/57776959#57776959", "title": "Why only the kernel can switch CPU execution mode?", "body": "<p>A user process <strong>can</strong> instruct the processor to switch to kernel mode, but (in the absence of bugs) this is <strong>only</strong> possible in a way designed to give control to kernel software. The instruction to switch to kernel mode saves information about the user process and then changes program execution to kernel software. So when the switch to kernel mode is made, the software running is that of the kernel, not of your process. When the operating system first starts running on a processor, it configures the processor to support this operation.</p>\n\n<p>This feature is used for user processes to request services from the kernel. If the user process wants to write data to disk or open a network connection or do anything else privileged, it formats a request (in some way that depends on the operating system and the hardware), and then executes an instruction to switch to kernel mode. This causes the kernel software to run, which examines the request and processes it.</p>\n\n<p>When the kernel is done, it executes another special instruction that resumes running the process in user mode.</p>\n\n<p>Normally, it is not possible for your process to request that it run in kernel mode, not through any sequence of instructions. If your process is privileged, it may be able to do various things with requests to the kernel that enable it to run software in kernel mode. (Most simply, on some systems, privileged processes can load kernel extensions and then use those for privileged operations.)</p>\n"}], "owner": {"reputation": 910, "user_id": 6422591, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/wIpwn.jpg?s=128&g=1", "display_name": "manish ma", "link": "https://stackoverflow.com/users/6422591/manish-ma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 446, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1567535120, "creation_date": 1567521521, "last_edit_date": 1567522332, "question_id": 57773940, "link": "https://stackoverflow.com/questions/57773940/why-only-the-kernel-can-switch-cpu-execution-mode", "title": "Why only the kernel can switch CPU execution mode?", "body": "<p>From what I've read in the book \"Understanding the Linux kernel 3rd edition\".\nThat only the kernel can change the CPU execution mode from \"user mode\" to \"kernel mode\" and vice versa.</p>\n\n<blockquote>\n  <p>Each CPU model provides special instructions to switch from User Mode to Kernel Mode and vice versa. A program usually executes in User Mode and switches to Kernel Mode only when requesting a service provided by the kernel. When the kernel has satisfied the program's request, it puts the program back in User Mode.</p>\n</blockquote>\n\n<p>How does the kernel do this? How is this operation possible only in that context?\nIf I get the correct \"recipe\" (the special instructions each CPU model provides) can I do it in user space?</p>\n"}, {"tags": ["c", "arrays"], "comments": [{"owner": {"reputation": 4398, "user_id": 3697264, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5adc5afbd7a1145fdd762d872b4b43bb?s=128&d=identicon&r=PG", "display_name": "SPlatten", "link": "https://stackoverflow.com/users/3697264/splatten"}, "edited": false, "score": 2, "creation_date": 1567521198, "post_id": 57773806, "comment_id": 101982806, "body": "Use memcpy, pass it the address of your character array which must be at least 4 bytes in length and the address of the float, with sizeof(float).  This will copy the binary representation of how the float is represented in memory, not a human readable version.  You can then copy this from the character array back to a float by doing the same and swapping the pointers."}, {"owner": {"reputation": 2815, "user_id": 1462295, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/ts6jy.jpg?s=128&g=1", "display_name": "BurnsBA", "link": "https://stackoverflow.com/users/1462295/burnsba"}, "edited": false, "score": 2, "creation_date": 1567521242, "post_id": 57773806, "comment_id": 101982842, "body": "see <a href=\"http://www.cplusplus.com/reference/cstdio/snprintf/\" rel=\"nofollow noreferrer\">cplusplus.com/reference/cstdio/snprintf</a>"}, {"owner": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "reply_to_user": {"reputation": 4398, "user_id": 3697264, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5adc5afbd7a1145fdd762d872b4b43bb?s=128&d=identicon&r=PG", "display_name": "SPlatten", "link": "https://stackoverflow.com/users/3697264/splatten"}, "edited": false, "score": 2, "creation_date": 1567521283, "post_id": 57773806, "comment_id": 101982881, "body": "@SPlatten I think he wants the float to be formatted into text."}, {"owner": {"reputation": 4398, "user_id": 3697264, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5adc5afbd7a1145fdd762d872b4b43bb?s=128&d=identicon&r=PG", "display_name": "SPlatten", "link": "https://stackoverflow.com/users/3697264/splatten"}, "reply_to_user": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "edited": false, "score": 2, "creation_date": 1567521350, "post_id": 57773806, "comment_id": 101982919, "body": "@uneven_mark, then in that case a simple sprintf with the format as &quot;%.#f&quot; where # is the number of decimals, the buffer should be large enough for the formatted number + 1."}, {"owner": {"reputation": 63, "user_id": 7536906, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eetZ8.jpg?s=128&g=1", "display_name": "Pooya Behravesh", "link": "https://stackoverflow.com/users/7536906/pooya-behravesh"}, "edited": false, "score": 0, "creation_date": 1567523140, "post_id": 57773806, "comment_id": 101983945, "body": "in this case, i want that two seperated string lines in http_cmd to stay! but with sprintf i&#39;ve tried, they lost! how can i add them in this current format?"}], "answers": [{"comments": [{"owner": {"reputation": 6477, "user_id": 3961271, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/2cKoq.jpg?s=128&g=1", "display_name": "Woodrow Barlow", "link": "https://stackoverflow.com/users/3961271/woodrow-barlow"}, "edited": false, "score": 2, "creation_date": 1567522623, "post_id": 57773960, "comment_id": 101983643, "body": "worth noting: <code>%.4f</code> will print <i>up to</i> four digits <i>after the decimal</i> -- which is an important distinction when deciding how large to make the <code>http_cmd</code> buffer. also worth pointing out the <code>snprintf</code> function which can provide more buffer safety if it&#39;s available in the OP&#39;s stdlib."}, {"owner": {"reputation": 63, "user_id": 7536906, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eetZ8.jpg?s=128&g=1", "display_name": "Pooya Behravesh", "link": "https://stackoverflow.com/users/7536906/pooya-behravesh"}, "edited": false, "score": 0, "creation_date": 1567522991, "post_id": 57773960, "comment_id": 101983861, "body": "this works but previous strings in http_cmd are lost! that two lines :                    &quot;Host: 39c309ae.ngrok.io\\r\\n&quot;                   &quot;\\r\\n&quot;; are so important! how to add them! because they must not be linear in a string!! and i dont know why just i got errors!"}, {"owner": {"reputation": 49, "user_id": 11365099, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-iKxwNB3XfTo/AAAAAAAAAAI/AAAAAAAAQt8/XTUTKUQvUII/photo.jpg?sz=128", "display_name": "Sordinho", "link": "https://stackoverflow.com/users/11365099/sordinho"}, "edited": false, "score": 0, "creation_date": 1567523259, "post_id": 57773960, "comment_id": 101984021, "body": "You can compose the string like a normal printf. The difference is printing to another string instead of stdout"}, {"owner": {"reputation": 3305, "user_id": 1428695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a843c704cdb7e32a93769cddfed4747?s=128&d=identicon&r=PG", "display_name": "yhyrcanus", "link": "https://stackoverflow.com/users/1428695/yhyrcanus"}, "edited": false, "score": 1, "creation_date": 1567523302, "post_id": 57773960, "comment_id": 101984039, "body": "Note that sprintf is MASSIVE for a small uC, depending on what he&#39;s trying to do."}], "tags": [], "owner": {"reputation": 49, "user_id": 11365099, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-iKxwNB3XfTo/AAAAAAAAAAI/AAAAAAAAQt8/XTUTKUQvUII/photo.jpg?sz=128", "display_name": "Sordinho", "link": "https://stackoverflow.com/users/11365099/sordinho"}, "is_accepted": true, "score": 1, "last_activity_date": 1567523579, "last_edit_date": 1567523579, "creation_date": 1567521611, "answer_id": 57773960, "question_id": 57773806, "link": "https://stackoverflow.com/questions/57773806/how-to-put-a-float-number-inside-an-char-array-in-c/57773960#57773960", "title": "how to put a float number inside an char array in C?", "body": "<p>Using sprintf()</p>\n\n<pre><code>float latitude = 36.423156, longitude = 48.526484;\nsprintf( http_cmd, \"GET /index.php?lat=%f&amp;long=%f HTTP/1.0\\r\\n \n         Host: 39c309ae.ngrok.io\\r\\n\\r\\n\", latitude, longitude);\n</code></pre>\n\n<p>You can compose your own string by printing chars, integers, float... And you can decide how many digits print to the array (in this case 4 digits).</p>\n"}], "owner": {"reputation": 63, "user_id": 7536906, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eetZ8.jpg?s=128&g=1", "display_name": "Pooya Behravesh", "link": "https://stackoverflow.com/users/7536906/pooya-behravesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 1, "accepted_answer_id": 57773960, "answer_count": 1, "score": -1, "last_activity_date": 1567523579, "creation_date": 1567521022, "question_id": 57773806, "link": "https://stackoverflow.com/questions/57773806/how-to-put-a-float-number-inside-an-char-array-in-c", "title": "how to put a float number inside an char array in C?", "body": "<p>i want to put some float numbers inside a string in C for an arduino project.\nbut i don't have any idea that can simply do this and not take lot storage(because of using arduino with 8kb).</p>\n\n<p>this is my string:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>char http_cmd[] = \"GET /index.php?lat=*****&amp;long=***** HTTP/1.0\\r\\n\"\n                  \"Host: 39c309ae.ngrok.io\\r\\n\"\n                  \"\\r\\n\";\n</code></pre>\n\n<p>and i want to replace that *****s with numerical variables like :</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>float latitude = 36.423156, longitude = 48.526484;\n</code></pre>\n"}, {"tags": ["c", "stm32", "i2c", "nucleo"], "answers": [{"comments": [{"owner": {"reputation": 1753, "user_id": 4303196, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-At8dHdjZue4/AAAAAAAAAAI/AAAAAAAAA1A/LNQh2L2c3QQ/photo.jpg?sz=128", "display_name": "Rollback", "link": "https://stackoverflow.com/users/4303196/rollback"}, "edited": false, "score": 0, "creation_date": 1567588772, "post_id": 57774733, "comment_id": 102004058, "body": "Thanks theSealion, yep! that was my bad!!"}], "tags": [], "owner": {"reputation": 922, "user_id": 8653951, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LRbxO.jpg?s=128&g=1", "display_name": "theSealion", "link": "https://stackoverflow.com/users/8653951/thesealion"}, "is_accepted": false, "score": 1, "last_activity_date": 1567524516, "creation_date": 1567524516, "answer_id": 57774733, "question_id": 57773781, "link": "https://stackoverflow.com/questions/57773781/i2c-stm32-nucleo-unable-to-establish-connection/57774733#57774733", "title": "i2c stm32 nucleo unable to establish connection", "body": "<p>First of all, a \"general\" c error:</p>\n\n<pre><code>uint8_t buffer[1];\nbuffer[0] = 0;\nbuffer[1] = 0;\n</code></pre>\n\n<p><code>buffer</code>has only a size of 1, so <code>buffer[1]</code>is an illegal memory access.</p>\n\n<p>And the I2C Problem:</p>\n\n<p>It seems you code is missing the pin initialization. You should have a <code>HAL_I2C_MspInit()</code> funcktion to do that job.</p>\n\n<p>Normally the CubeMx should create this function with the pins you selected for the peripheral. Maybe you have switche to the LL (LowLevel) Library on the Project-> Advance tab for the I2C->GPIOs</p>\n"}, {"comments": [{"owner": {"reputation": 1753, "user_id": 4303196, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-At8dHdjZue4/AAAAAAAAAAI/AAAAAAAAA1A/LNQh2L2c3QQ/photo.jpg?sz=128", "display_name": "Rollback", "link": "https://stackoverflow.com/users/4303196/rollback"}, "edited": false, "score": 0, "creation_date": 1567588713, "post_id": 57774815, "comment_id": 102004027, "body": "Thanks berendi, I thought cubeMX would inizialize anything you needed! Seems like I was missing <code>__HAL_RCC_GPIOB_CLK_ENABLE();</code>! Do you mind giving some more examples of how to configure the GPIO pins for i2c? (I think other people who will have the same problem as me would really love that)"}, {"owner": {"reputation": 6873, "user_id": 5131711, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z5oP7.png?s=128&g=1", "display_name": "followed Monica to Codidact", "link": "https://stackoverflow.com/users/5131711/followed-monica-to-codidact"}, "reply_to_user": {"reputation": 1753, "user_id": 4303196, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-At8dHdjZue4/AAAAAAAAAAI/AAAAAAAAA1A/LNQh2L2c3QQ/photo.jpg?sz=128", "display_name": "Rollback", "link": "https://stackoverflow.com/users/4303196/rollback"}, "edited": false, "score": 0, "creation_date": 1567591119, "post_id": 57774815, "comment_id": 102005424, "body": "Pin initialization depends on the hardware in and around the MCU, it&#39;s not possible to give an example that works on all STM32 devices and pinout configuration. Read the chapter on <i>General-Purpose I/Os</i> in the reference manual for your device, it lists the register values for possible configurations, then set the GPIO registers for the I2C pins accordingly."}], "tags": [], "owner": {"reputation": 6873, "user_id": 5131711, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z5oP7.png?s=128&g=1", "display_name": "followed Monica to Codidact", "link": "https://stackoverflow.com/users/5131711/followed-monica-to-codidact"}, "is_accepted": true, "score": 1, "last_activity_date": 1567524855, "creation_date": 1567524855, "answer_id": 57774815, "question_id": 57773781, "link": "https://stackoverflow.com/questions/57773781/i2c-stm32-nucleo-unable-to-establish-connection/57774815#57774815", "title": "i2c stm32 nucleo unable to establish connection", "body": "<p><strong>I<sup>2</sup>C peripheral clock is not enabled in RCC</strong></p>\n\n<p>Each peripheral block should be enabled in some <code>RCC</code> register, the exact register bit depends on the series. The calls in <code>MX_GPIO_Init()</code> take care of the GPIO blocks, but neither I<sup>2</sup>C1 nor the UART is enabled.</p>\n\n<p><strong>GPIO pins are not initialized</strong></p>\n\n<p>Each peripheral I/O pin should be set to a mode appropriate for the peripheral. For I<sup>2</sup>C, this would be <em>alternate function open-drain output</em>, for the UART <em>alternate function input</em> for RX and <em>alternate function push-pull output</em> for TX (unless you have some weird multi-master UART setup). The alternate function numbers for each pin are listed in the datasheet, the rest is documented in the reference manual.</p>\n"}], "owner": {"reputation": 1753, "user_id": 4303196, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-At8dHdjZue4/AAAAAAAAAAI/AAAAAAAAA1A/LNQh2L2c3QQ/photo.jpg?sz=128", "display_name": "Rollback", "link": "https://stackoverflow.com/users/4303196/rollback"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 0, "accepted_answer_id": 57774815, "answer_count": 2, "score": 1, "last_activity_date": 1567524855, "creation_date": 1567520923, "question_id": 57773781, "link": "https://stackoverflow.com/questions/57773781/i2c-stm32-nucleo-unable-to-establish-connection", "title": "i2c stm32 nucleo unable to establish connection", "body": "<p>I am new to the whole stm32 environment. I've always used arduino in the past and I wanted to try something new for this project.</p>\n\n<p>I am having a really hard time setting up an i2c connection between a nucleo board (MASTER) and an arduino(SLAVE).</p>\n\n<p>I have tested the slave using another arduino as a MASTER and it works fine, then I decided it was time to write the code for the nucleo MASTER.</p>\n\n<p>Here is the code I am using, and it seems pretty straigh foward to me, the problem is that I am unable to communicate with the arduino.</p>\n\n<p><code>HAL_I2C_IsDeviceReady</code>\n always returns <code>HAL_ERROR</code>, so my code must have some problems.</p>\n\n<pre><code>/* USER CODE BEGIN Header */\n/**\n  ******************************************************************************\n  * @file           : main.c\n  * @brief          : Main program body\n  ******************************************************************************\n  * @attention\n  *\n  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2019 STMicroelectronics.\n  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;\n  *\n  * This software component is licensed by ST under BSD 3-Clause license,\n  * the \"License\"; You may not use this file except in compliance with the\n  * License. You may obtain a copy of the License at:\n  *                        opensource.org/licenses/BSD-3-Clause\n  *\n  ******************************************************************************\n  */\n/* USER CODE END Header */\n\n/* Includes ------------------------------------------------------------------*/\n#include \"main.h\"\n\n/* Private includes ----------------------------------------------------------*/\n/* USER CODE BEGIN Includes */\n\n/* USER CODE END Includes */\n\n/* Private typedef -----------------------------------------------------------*/\n/* USER CODE BEGIN PTD */\n\n/* USER CODE END PTD */\n\n/* Private define ------------------------------------------------------------*/\n/* USER CODE BEGIN PD */\n\n/* USER CODE END PD */\n\n/* Private macro -------------------------------------------------------------*/\n/* USER CODE BEGIN PM */\n\n/* USER CODE END PM */\n\n/* Private variables ---------------------------------------------------------*/\nI2C_HandleTypeDef hi2c1;\n\nUART_HandleTypeDef hlpuart1;\n\n/* USER CODE BEGIN PV */\n\n/* USER CODE END PV */\n\n/* Private function prototypes -----------------------------------------------*/\nvoid SystemClock_Config(void);\nstatic void MX_GPIO_Init(void);\nstatic void MX_LPUART1_UART_Init(void);\nstatic void MX_I2C1_Init(void);\n/* USER CODE BEGIN PFP */\n\n/* USER CODE END PFP */\n\n/* Private user code ---------------------------------------------------------*/\n/* USER CODE BEGIN 0 */\n\n/* USER CODE END 0 */\n\n/**\n  * @brief  The application entry point.\n  * @retval int\n  */\nint main(void)\n{\n  /* USER CODE BEGIN 1 */\n\n  /* USER CODE END 1 */\n\n\n  /* MCU Configuration--------------------------------------------------------*/\n\n  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */\n  HAL_Init();\n\n  /* USER CODE BEGIN Init */\n\n  /* USER CODE END Init */\n\n  /* Configure the system clock */\n  SystemClock_Config();\n\n  /* USER CODE BEGIN SysInit */\n\n  /* USER CODE END SysInit */\n\n  /* Initialize all configured peripherals */\n  MX_GPIO_Init();\n  MX_LPUART1_UART_Init();\n  MX_I2C1_Init();\n  /* USER CODE BEGIN 2 */\n  uint8_t buffer[1];\n  buffer[0] = 0;\n  buffer[1] = 0;\n  /* USER CODE END 2 */\n\n  /* Infinite loop */\n  /* USER CODE BEGIN WHILE */\n  while (1)\n  {\n    /* USER CODE END WHILE */\n\n    /* USER CODE BEGIN 3 */\n      for(uint16_t i = 0; i &lt;256; i ++){\n          if(HAL_I2C_IsDeviceReady(&amp;hi2c1, i, 2, 10)== HAL_OK){\n              HAL_I2C_Master_Transmit(&amp;hi2c1, i, buffer, sizeof(buffer), 10);\n          }\n      }\n  }\n  /* USER CODE END 3 */\n}\n\n/**\n  * @brief System Clock Configuration\n  * @retval None\n  */\nvoid SystemClock_Config(void)\n{\n  RCC_OscInitTypeDef RCC_OscInitStruct = {0};\n  RCC_ClkInitTypeDef RCC_ClkInitStruct = {0};\n  RCC_PeriphCLKInitTypeDef PeriphClkInit = {0};\n\n  /** Configure the main internal regulator output voltage \n  */\n  HAL_PWREx_ControlVoltageScaling(PWR_REGULATOR_VOLTAGE_SCALE1);\n  /** Initializes the CPU, AHB and APB busses clocks \n  */\n  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;\n  RCC_OscInitStruct.HSIState = RCC_HSI_ON;\n  RCC_OscInitStruct.HSIDiv = RCC_HSI_DIV1;\n  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;\n  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_NONE;\n  if (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)\n  {\n    Error_Handler();\n  }\n  /** Initializes the CPU, AHB and APB busses clocks \n  */\n  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK\n                              |RCC_CLOCKTYPE_PCLK1;\n  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;\n  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;\n  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;\n\n  if (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_0) != HAL_OK)\n  {\n    Error_Handler();\n  }\n  /** Initializes the peripherals clocks \n  */\n  PeriphClkInit.PeriphClockSelection = RCC_PERIPHCLK_LPUART1|RCC_PERIPHCLK_I2C1;\n  PeriphClkInit.Lpuart1ClockSelection = RCC_LPUART1CLKSOURCE_PCLK1;\n  PeriphClkInit.I2c1ClockSelection = RCC_I2C1CLKSOURCE_PCLK1;\n  if (HAL_RCCEx_PeriphCLKConfig(&amp;PeriphClkInit) != HAL_OK)\n  {\n    Error_Handler();\n  }\n}\n\n/**\n  * @brief I2C1 Initialization Function\n  * @param None\n  * @retval None\n  */\nstatic void MX_I2C1_Init(void)\n{\n\n  /* USER CODE BEGIN I2C1_Init 0 */\n\n  /* USER CODE END I2C1_Init 0 */\n\n  /* USER CODE BEGIN I2C1_Init 1 */\n\n  /* USER CODE END I2C1_Init 1 */\n  hi2c1.Instance = I2C1;\n  hi2c1.Init.Timing = 100000;\n  hi2c1.Init.OwnAddress1 = 0;\n  hi2c1.Init.AddressingMode = I2C_ADDRESSINGMODE_7BIT;\n  hi2c1.Init.DualAddressMode = I2C_DUALADDRESS_DISABLE;\n  hi2c1.Init.OwnAddress2 = 0;\n  hi2c1.Init.OwnAddress2Masks = I2C_OA2_NOMASK;\n  hi2c1.Init.GeneralCallMode = I2C_GENERALCALL_DISABLE;\n  hi2c1.Init.NoStretchMode = I2C_NOSTRETCH_DISABLE;\n  if (HAL_I2C_Init(&amp;hi2c1) != HAL_OK)\n  {\n    Error_Handler();\n  }\n  /** Configure Analogue filter \n  */\n  if (HAL_I2CEx_ConfigAnalogFilter(&amp;hi2c1, I2C_ANALOGFILTER_ENABLE) != HAL_OK)\n  {\n    Error_Handler();\n  }\n  /** Configure Digital filter \n  */\n  if (HAL_I2CEx_ConfigDigitalFilter(&amp;hi2c1, 0) != HAL_OK)\n  {\n    Error_Handler();\n  }\n  /* USER CODE BEGIN I2C1_Init 2 */\n\n  /* USER CODE END I2C1_Init 2 */\n\n}\n\n/**\n  * @brief LPUART1 Initialization Function\n  * @param None\n  * @retval None\n  */\nstatic void MX_LPUART1_UART_Init(void)\n{\n\n  /* USER CODE BEGIN LPUART1_Init 0 */\n\n  /* USER CODE END LPUART1_Init 0 */\n\n  /* USER CODE BEGIN LPUART1_Init 1 */\n\n  /* USER CODE END LPUART1_Init 1 */\n  hlpuart1.Instance = LPUART1;\n  hlpuart1.Init.BaudRate = 209700;\n  hlpuart1.Init.WordLength = UART_WORDLENGTH_7B;\n  hlpuart1.Init.StopBits = UART_STOPBITS_1;\n  hlpuart1.Init.Parity = UART_PARITY_NONE;\n  hlpuart1.Init.Mode = UART_MODE_TX_RX;\n  hlpuart1.Init.HwFlowCtl = UART_HWCONTROL_NONE;\n  hlpuart1.Init.OneBitSampling = UART_ONE_BIT_SAMPLE_DISABLE;\n  hlpuart1.Init.ClockPrescaler = UART_PRESCALER_DIV1;\n  hlpuart1.AdvancedInit.AdvFeatureInit = UART_ADVFEATURE_NO_INIT;\n  hlpuart1.FifoMode = UART_FIFOMODE_DISABLE;\n  if (HAL_UART_Init(&amp;hlpuart1) != HAL_OK)\n  {\n    Error_Handler();\n  }\n  if (HAL_UARTEx_SetTxFifoThreshold(&amp;hlpuart1, UART_TXFIFO_THRESHOLD_1_8) != HAL_OK)\n  {\n    Error_Handler();\n  }\n  if (HAL_UARTEx_SetRxFifoThreshold(&amp;hlpuart1, UART_RXFIFO_THRESHOLD_1_8) != HAL_OK)\n  {\n    Error_Handler();\n  }\n  if (HAL_UARTEx_DisableFifoMode(&amp;hlpuart1) != HAL_OK)\n  {\n    Error_Handler();\n  }\n  /* USER CODE BEGIN LPUART1_Init 2 */\n\n  /* USER CODE END LPUART1_Init 2 */\n\n}\n\n/**\n  * @brief GPIO Initialization Function\n  * @param None\n  * @retval None\n  */\nstatic void MX_GPIO_Init(void)\n{\n\n  /* GPIO Ports Clock Enable */\n  __HAL_RCC_GPIOC_CLK_ENABLE();\n  __HAL_RCC_GPIOF_CLK_ENABLE();\n  __HAL_RCC_GPIOA_CLK_ENABLE();\n  __HAL_RCC_GPIOB_CLK_ENABLE();\n\n\n}\n\n/* USER CODE BEGIN 4 */\n\n/* USER CODE END 4 */\n\n/**\n  * @brief  This function is executed in case of error occurrence.\n  * @retval None\n  */\nvoid Error_Handler(void)\n{\n  /* USER CODE BEGIN Error_Handler_Debug */\n  /* User can add his own implementation to report the HAL error return state */\n\n  /* USER CODE END Error_Handler_Debug */\n}\n\n#ifdef  USE_FULL_ASSERT\n/**\n  * @brief  Reports the name of the source file and the source line number\n  *         where the assert_param error has occurred.\n  * @param  file: pointer to the source file name\n  * @param  line: assert_param error line source number\n  * @retval None\n  */\nvoid assert_failed(uint8_t *file, uint32_t line)\n{ \n  /* USER CODE BEGIN 6 */\n  /* User can add his own implementation to report the file name and line number,\n     tex: printf(\"Wrong parameters value: file %s on line %d\\r\\n\", file, line) */\n  /* USER CODE END 6 */\n}\n#endif /* USE_FULL_ASSERT */\n\n/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/\n</code></pre>\n\n<p>I don't think the wiring is the problem, because it worked between the 2 arduinos. But I will explain how everything is wired.</p>\n\n<p><strong>SCL</strong> and <strong>SDA</strong> have both a pull up resistor of 8kohm, I am also using a logic analyzer to monitor the communication, but both <strong>SCL</strong> and <strong>SDA</strong> are alway <strong>HIGH</strong>.</p>\n\n<p>Thank you in advance for the help!</p>\n"}, {"tags": ["c", "memory-management", "hashtable"], "answers": [{"tags": [], "owner": {"reputation": 7879, "user_id": 245622, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a18972c4ea4565ddb0606c5fe01d94cc?s=128&d=identicon&r=PG", "display_name": "Ofir", "link": "https://stackoverflow.com/users/245622/ofir"}, "is_accepted": true, "score": 0, "last_activity_date": 1567671209, "last_edit_date": 1567671209, "creation_date": 1567520673, "answer_id": 57773704, "question_id": 57773497, "link": "https://stackoverflow.com/questions/57773497/how-do-i-allocate-memory-for-a-hash-table-int-c/57773704#57773704", "title": "How do I allocate memory for a hash table int C?", "body": "<p>You have several issues, but the main one is handling str, first of all, if you initialize the keys with empty strings - you need to free them when you assign to them, second - when you compare a cell, don't use ==, since that checks that the pointer is identical, use something like strcmp, and last - when you assign, depending on your implementation of the program - you may need to use something like strdup to copy str, otherwise you are pointing to same space as the pointer you got.\ne.g:</p>\n\n<pre><code>int htable_insert(htable h, char *str){\nint i;\nint number = htable_word_to_int(str) % h-&gt;capacity;\n\nfor(i=0; i&lt;h-&gt;capacity; i++){\n\nif(number == h-&gt;capacity){\n  number = 0;\n}\n\nif(strlen(h-&gt;keys[number]) == 0){\n  free(h-&gt;keys[number]);\n  h-&gt;keys[number] = strdup(str);\n  h-&gt;frequencies[number]++;\n\n  h-&gt;num_keys++;\n  return h-&gt;frequencies[number];\n\n}\nif(!strcmp(h-&gt;keys[number], str)){\n  h-&gt;frequencies[number]++;\n  return h-&gt;frequencies[number];\n}\nnumber++;\n}\nreturn 0;\n}\n</code></pre>\n\n<p>This isn't perfect, it doeesn't handle memory allocation failures, or null pointers in the parameters, a better way would be to initialize the keys to NULL values - but it illustrates the main issues</p>\n\n<p>Also - It isn't clear if the size needs to remain constant, if not you need logic to expand the hash table when it is full (detecting the condition, realloc'ing the frequencies and keys, redistributing the keys and frequencies according to the new capacity, handling realloc failures, etc.)</p>\n"}, {"comments": [{"owner": {"reputation": 3854, "user_id": 2235885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09d0d6a08639ef79ef960a52bd013e02?s=128&d=identicon&r=PG", "display_name": "joop", "link": "https://stackoverflow.com/users/2235885/joop"}, "edited": false, "score": 0, "creation_date": 1567526003, "post_id": 57774818, "comment_id": 101985388, "body": "First part of your answer is nonsense, <code>sizeof result-&gt;frequencies[0]</code> is perfectly fit, even better than your <i>improvement</i> The relevant syntax  is <code>sizeof expression</code>, and semantically, this expression will not be evaluated by the <code>sizeof</code> operator."}, {"owner": {"reputation": 3854, "user_id": 2235885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09d0d6a08639ef79ef960a52bd013e02?s=128&d=identicon&r=PG", "display_name": "joop", "link": "https://stackoverflow.com/users/2235885/joop"}, "edited": false, "score": 0, "creation_date": 1567529002, "post_id": 57774818, "comment_id": 101986663, "body": "And the second part of your answer: <code>realloc(h-&gt;keys, h-&gt;capacity);</code> &lt;&lt;-- <code>realloc()</code> returns a value. You&#39;d better use it..."}], "tags": [], "owner": {"reputation": 11, "user_id": 9146981, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-iurzHDT0eFQ/AAAAAAAAAAI/AAAAAAAABsY/kqjcMIfAyEA/photo.jpg?sz=128", "display_name": "akiva zonenfeld", "link": "https://stackoverflow.com/users/9146981/akiva-zonenfeld"}, "is_accepted": false, "score": 0, "last_activity_date": 1567609859, "last_edit_date": 1567609859, "creation_date": 1567524872, "answer_id": 57774818, "question_id": 57773497, "link": "https://stackoverflow.com/questions/57773497/how-do-i-allocate-memory-for-a-hash-table-int-c/57774818#57774818", "title": "How do I allocate memory for a hash table int C?", "body": "<p>if the capacity is const so you don't need to realloc (you can return -1 to signal that there is no place for this str). </p>\n\n<p>elsewhere, you can add after the <code>for</code> in <code>htable_insert</code> (if we reach there it's mean the <code>keys</code> array is full so we need to resize it).</p>\n\n<pre><code>for(..){\n...\n}\nh-&gt;capacity *= 2;\nh-&gt;keys = realloc(h-&gt;keys, h-&gt;capacity); // copy the data into a new array, two time size than \n                               //the old one\nreturn htable_insert(h,str);\n</code></pre>\n\n<p>notice, you will have to resize your frequency array also.</p>\n"}], "owner": {"reputation": 3, "user_id": 11999997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18a11b6da155795565619d357258b29b?s=128&d=identicon&r=PG&f=1", "display_name": "ned232", "link": "https://stackoverflow.com/users/11999997/ned232"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 0, "accepted_answer_id": 57773704, "answer_count": 2, "score": 0, "last_activity_date": 1567671209, "creation_date": 1567519900, "question_id": 57773497, "link": "https://stackoverflow.com/questions/57773497/how-do-i-allocate-memory-for-a-hash-table-int-c", "title": "How do I allocate memory for a hash table int C?", "body": "<p>i'm very new to C and very confused about memory allocation. I'm trying to create a hash table but don't know what to do in regards to memory, especially for the keys parameter which is an array of strings.</p>\n\n<p>I'm trying to set the code up to scan in words from a text file and print their frequencies. I've read around a bit and found that I might need to use the realloc function but i'm not completely sure.</p>\n\n<p>Any help is appreciated, thanks!</p>\n\n<pre><code>struct htablerec {\nint capacity;\nint num_keys;\nint *frequencies;\nchar **keys;\n};\n\nhtable htable_new(int capacity2){\n  int i;\n  htable result = malloc(sizeof *result);\n  result-&gt;capacity = capacity2;\n  result-&gt;num_keys = 0;\n\n  result-&gt;frequencies = malloc(result-&gt;capacity * sizeof\n            result-&gt;frequencies[0]);\n\n  result-&gt;keys = malloc(result-&gt;capacity * sizeof(char *));\n\n  for(i=0;i&lt;result-&gt;capacity;i++){\n    result-&gt;frequencies[i] = 0;\n    result-&gt;keys[i] = malloc(1); \n    result-&gt;keys[i][0] = 0; \n  }\n  return result;\n}\n\nint htable_insert(htable h, char *str){\n  int i;\n  int number = htable_word_to_int(str) % h-&gt;capacity;\n\n  for(i=0; i&lt;h-&gt;capacity; i++){\n\n    if(number == h-&gt;capacity){\n      number = 0;\n    }\n\n    if(strlen(h-&gt;keys[number]) == 0){\n      h-&gt;keys[number] = str;\n      h-&gt;frequencies[number]++;\n\n      h-&gt;num_keys++;\n      return h-&gt;frequencies[number];\n\n    }\n    if(h-&gt;keys[number] == str){\n      h-&gt;frequencies[number]++;\n      return h-&gt;frequencies[number];\n    }\n    number++;\n  }\n  return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "sockets"], "comments": [{"owner": {"reputation": 1894, "user_id": 8473031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4878bfc9d6a80397a8446111fffa4dd?s=128&d=identicon&r=PG&f=1", "display_name": "RoQuOTriX", "link": "https://stackoverflow.com/users/8473031/roquotrix"}, "edited": false, "score": 0, "creation_date": 1567518782, "post_id": 57773028, "comment_id": 101981411, "body": "Where is end_msg and server_msg defined?"}, {"owner": {"reputation": 137, "user_id": 6834611, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eUZAR.jpg?s=128&g=1", "display_name": "Shubham Kumar", "link": "https://stackoverflow.com/users/6834611/shubham-kumar"}, "reply_to_user": {"reputation": 1894, "user_id": 8473031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4878bfc9d6a80397a8446111fffa4dd?s=128&d=identicon&r=PG&f=1", "display_name": "RoQuOTriX", "link": "https://stackoverflow.com/users/8473031/roquotrix"}, "edited": false, "score": 0, "creation_date": 1567519496, "post_id": 57773028, "comment_id": 101981857, "body": "end_msg and server_msg are defined above as a string. Those are not so important code only problem lies in the given snippet"}, {"owner": {"reputation": 2149, "user_id": 2096401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uVjii.jpg?s=128&g=1", "display_name": "TripeHound", "link": "https://stackoverflow.com/users/2096401/tripehound"}, "edited": false, "score": 2, "creation_date": 1567519723, "post_id": 57773028, "comment_id": 101981975, "body": "Seeing as the &quot;actual result&quot; from the server looks to be what you are expecting, the problem may be in the client-code that is reading the messages... it feels like it is not detecting that a different message is being returned. Can you show that code?"}, {"owner": {"reputation": 137, "user_id": 6834611, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eUZAR.jpg?s=128&g=1", "display_name": "Shubham Kumar", "link": "https://stackoverflow.com/users/6834611/shubham-kumar"}, "edited": false, "score": 0, "creation_date": 1567519891, "post_id": 57773028, "comment_id": 101982063, "body": "<code>while(1) \t{ \t\tprintf(&quot;Enter command: &quot;); \t\tscanf(&quot;%s&quot;,client_request); \t\tsend(client_socket,&amp;client_request,sizeof(char)*strlen(cli&zwnj;&#8203;ent_request),0); &#47;&#47; sending command from the client \t\tmemset(server_response,0,sizeof(server_response)); &#47;&#47; cleaning the buffer \t\trecv(client_socket,&amp;server_response,sizeof(server_response&zwnj;&#8203;),0);\t&#47;&#47;data receiving from the server \t\tprintf(&quot;%s\\n&quot;,server_response);\t&#47;&#47;printing data to console \t\tif(strcmp(client_request,&quot;exit&quot;)==0)break; &#47;&#47; termnating condition for the client \t} \tclose(client_socket);\t&#47;&#47;closing the socket \treturn 0; </code>"}, {"owner": {"reputation": 451, "user_id": 3811394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94cda424634dbce919c5f536793e32e3?s=128&d=identicon&r=PG&f=1", "display_name": "Trickzter", "link": "https://stackoverflow.com/users/3811394/trickzter"}, "edited": false, "score": 0, "creation_date": 1567519912, "post_id": 57773028, "comment_id": 101982077, "body": "Please edit your question. No code in the comment section."}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 0, "creation_date": 1567525626, "post_id": 57773028, "comment_id": 101985188, "body": "Broken for the usual three reasons."}], "answers": [{"tags": [], "owner": {"reputation": 2065, "user_id": 85696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9d5b650b104a98538d5aab145ea192d?s=128&d=identicon&r=PG", "display_name": "danadam", "link": "https://stackoverflow.com/users/85696/danadam"}, "is_accepted": true, "score": 0, "last_activity_date": 1567526692, "creation_date": 1567526692, "answer_id": 57775246, "question_id": 57773028, "link": "https://stackoverflow.com/questions/57773028/server-not-returning-the-last-response-message-to-client/57775246#57775246", "title": "Server not returning the last response message to client", "body": "<p>That's because you send <code>Hello, From server</code> already after accepting the client connection, so the order of events is something like this:</p>\n\n<ol>\n<li>client: connect and wait for user input</li>\n<li>server: accept the connection, send server message <code>S</code> (hello from server)</li>\n<li>user: enter command <code>C</code> (whatever)</li>\n<li>client: send <code>C</code>, read <code>S</code> from step 2, wait for user input</li>\n<li>server: read <code>C</code>, send <code>S</code></li>\n<li>user: enter command <code>Exit</code></li>\n<li>client: send <code>Exit</code>, read <code>S</code> from step 5, exit</li>\n<li>server: read <code>Exit</code>, send <code>E</code> (exit from server) but at this point the client is probably not connected any more.</li>\n</ol>\n\n<p>If you remove that sending of the message after accepting the connection but before the <code>while</code> loop then it should work as expected.</p>\n"}], "owner": {"reputation": 137, "user_id": 6834611, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eUZAR.jpg?s=128&g=1", "display_name": "Shubham Kumar", "link": "https://stackoverflow.com/users/6834611/shubham-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 57775246, "answer_count": 1, "score": 0, "last_activity_date": 1567526692, "creation_date": 1567518241, "last_edit_date": 1567520194, "question_id": 57773028, "link": "https://stackoverflow.com/questions/57773028/server-not-returning-the-last-response-message-to-client", "title": "Server not returning the last response message to client", "body": "<p>I made a client/server program where for every command from client server returns \"Hello, From server\" and for exit it should return \"Exiting the server\" but it returns \"Hello, From server\" and exits</p>\n\n<p>I tried by putting a string before and break statement and also put a string after while loop both are printed while ending from the server is not printing to the client</p>\n\n<p>client.c</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n\n#include &lt;sys/types.h&gt;\n#include &lt;sys/socket.h&gt;\n\n#include &lt;netinet/in.h&gt;\n\nint main(void)\n{\n    int client_socket = socket(AF_INET, SOCK_STREAM, 0); //creating client socket\n\n    struct sockaddr_in server_address;  //creating structure for server address\n    server_address.sin_family = AF_INET;\n    server_address.sin_port = htons(9002);\n    server_address.sin_addr.s_addr = INADDR_ANY;\n\n    if(connect(client_socket,(struct sockaddr *)&amp;server_address,sizeof(server_address))&lt;0)  //establishing connection between client and server\n    {\n        printf(\"Something went wrong while connecting to server!\\n\");\n        close(client_socket);\n        return -3;\n    }\n\n    char server_response[256];  //creating buffer for receiving data from server\n    char client_request[256];   // creating buffer for sending request from the client\n    while(1)\n    {\n        printf(\"Enter command: \");\n        scanf(\"%s\",client_request);\n        send(client_socket,&amp;client_request,sizeof(char)*strlen(client_request),0); // sending command from the client\n        memset(server_response,0,sizeof(server_response)); // cleaning the buffer\n        recv(client_socket,&amp;server_response,sizeof(server_response),0); //data receiving from the server\n        printf(\"%s\\n\",server_response); //printing data to console\n        if(strcmp(client_request,\"exit\")==0)break; // termnating condition for the client\n    }\n    close(client_socket);   //closing the socket\n    return 0;\n}\n\n</code></pre>\n\n<p>server.c</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n\n#include &lt;sys/types.h&gt;\n#include &lt;sys/socket.h&gt;\n\n#include &lt;netinet/in.h&gt;\n\nvoid print_client(struct sockaddr_in client_address)\n{\n    unsigned long address = ntohl(client_address.sin_addr.s_addr);\n    unsigned int a = (address &amp; (0xff));\n    unsigned int b = (address &amp; (0xff &lt;&lt;  8)) &gt;&gt;  8;\n    unsigned int c = (address &amp; (0xff &lt;&lt; 16)) &gt;&gt; 16;\n    unsigned int d = (address &amp; (0xff &lt;&lt; 24)) &gt;&gt; 24;\n    printf(\"Cient address: %u.%u.%u.%u \",d,c,b,a);\n    return;\n}\n\nint main(void)\n{\n    char server_msg[256] = \"Hello, From server\";    // server response message\n    char end_msg[256] = \"Exiting the server\";// server ending message\n    char client_request[256];\n    int client_request_len;\n    int server_socket = socket(AF_INET, SOCK_STREAM, 0); // creating tcp/ip socket for server\n\n    struct sockaddr_in server_address;  // creating server address\n    server_address.sin_family = AF_INET;    \n    server_address.sin_port = htons(9002);\n    server_address.sin_addr.s_addr = INADDR_ANY;\n\n    if(bind(server_socket,(struct sockaddr *)&amp;server_address, sizeof(server_address)) &lt; 0) //binding socket to server address\n    {\n        printf(\"Could not bind address try later!\\n\");\n    }\n    listen(server_socket, 5); //making connection limited to 5 clients\n    struct sockaddr_in client_address;\n    unsigned int client_address_len;\n    int client_socket = accept(server_socket,(struct sockaddr *)&amp;client_address,&amp;client_address_len);   //accepting the client request\n    print_client(client_address);\n    printf(\" and port: %u connected\\n\",client_address.sin_port);\n    send(client_socket,server_msg,sizeof(server_msg),0);\n    while(1)\n    {\n        memset(client_request,0,sizeof(client_request)); // cleaning the buffer\n        recv(client_socket,&amp;client_request,sizeof(client_request),0); // receiving request from client\n        printf(\"Message from client: %s\\n\",client_request);\n        if(strcmp(client_request,\"exit\")==0)\n        {\n            printf(\"breaking condition\\n\");\n            break; // terminating the connection\n        }\n        send(client_socket,server_msg,sizeof(server_msg),0);    // sending server_msg to client\n    }\n    printf(\"send this message\\n\");\n    send(client_socket,end_msg,sizeof(end_msg),0);\n    close(server_socket); // closing the server socket\n    return 0;   \n}\n\n</code></pre>\n\n<p>actual result \n\"client\" <code>Enter command: shubham\nHello, From server\nEnter command: kumar\nHello, From server\nEnter command: end\nHello, From server\nEnter command: exit\nHello, From server</code>\nexpected result \"client\"</p>\n\n<pre><code>Hello, From server\nEnter command: kumar\nHello, From server\nEnter command: end\nHello, From server\nEnter command: exit\nExiting the server\n</code></pre>\n\n<p>actual result \"server\"</p>\n\n<pre><code>Cient address: 127.0.0.1  and port: 20710 connected\nMessage from client: shubham\nMessage from client: kumar\nMessage from client: end\nMessage from client: exit\nbreaking condition\nsend this message\n</code></pre>\n"}, {"tags": ["c", "linux", "linux-kernel", "linux-device-driver", "device-driver"], "comments": [{"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1567520196, "post_id": 57773007, "comment_id": 101982246, "body": "&quot;How does Linux link device file with device driver?&quot; - By <b>major</b> and <b>minor</b> <b>numbers</b>. Actually, any device file contains only these numbers. Only when device file is opened, Linux kernel checks whether a device with such numbers is registered, and calls corresponded functions for that device."}, {"owner": {"reputation": 667, "user_id": 2762678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee48142c79e0272fef5875126ebe6912?s=128&d=identicon&r=PG&f=1", "display_name": "QnA", "link": "https://stackoverflow.com/users/2762678/qna"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1567651257, "post_id": 57773007, "comment_id": 102028231, "body": "@Tsyvarev thanks, so what does <code>device_driver</code> provide in this process, since the <code>cdev</code> struct already have <code>file_operations</code>?"}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1567667776, "post_id": 57773007, "comment_id": 102032714, "body": "If you look into <code>device_driver</code> <a href=\"https://elixir.bootlin.com/linux/v3.9.11/source/include/linux/device.h#L218\" rel=\"nofollow noreferrer\">structure&#39;s definition</a> you will find that this structure describes completely different things than the file operations. It has e.g. <code>probe</code> function which binds the device with a driver."}], "answers": [{"tags": [], "owner": {"reputation": 969, "user_id": 3009892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c242dcbc4582f69a0426a66bc6a8115?s=128&d=identicon&r=PG", "display_name": "borancar", "link": "https://stackoverflow.com/users/3009892/borancar"}, "is_accepted": false, "score": 1, "last_activity_date": 1567532308, "creation_date": 1567532308, "answer_id": 57776427, "question_id": 57773007, "link": "https://stackoverflow.com/questions/57773007/how-does-linux-link-device-file-with-device-driver-does-open-syscall-eventual/57776427#57776427", "title": "How does Linux link device file with device driver? Does open() syscall eventually call device driver code?", "body": "<p>Short answer, it knows which open function to call ultimately based on the major and minor numbers. You provide these or get ones automatically generated for you when you register your driver, whether character, block or tty.</p>\n\n<p>What additionally happens with udev or systemd or mdev is that a device gets created under <code>/dev</code> automatically. There are cases with embedded distros (e.g. buildroot) and character devices where this won't happen automatically and you need to manually do it. I would suggest checking \"Linux Device Drivers, 3rd edition, Chapter 3: Char Drivers\" for more details.</p>\n"}, {"comments": [{"owner": {"reputation": 667, "user_id": 2762678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee48142c79e0272fef5875126ebe6912?s=128&d=identicon&r=PG&f=1", "display_name": "QnA", "link": "https://stackoverflow.com/users/2762678/qna"}, "edited": false, "score": 0, "creation_date": 1567621982, "post_id": 57787779, "comment_id": 102021242, "body": "Thanks. Exactly what I was looking for."}, {"owner": {"reputation": 667, "user_id": 2762678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee48142c79e0272fef5875126ebe6912?s=128&d=identicon&r=PG&f=1", "display_name": "QnA", "link": "https://stackoverflow.com/users/2762678/qna"}, "edited": false, "score": 0, "creation_date": 1567649156, "post_id": 57787779, "comment_id": 102027920, "body": "A follow up question. It seems <code>cdev</code> contains the driver code and <code>cdev_add()</code> registers it to <code>cdev_map</code> kernel variable. They already link device file to a driver, but what about <code>device_driver</code> struct and <code>driver_register()</code> function, which seem to be related to sysfs? Does device driver need to call both <code>driver_register()</code> (directly or indirectly) and <code>cdev_add()</code> in driver&#39;s initialization code?"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "reply_to_user": {"reputation": 667, "user_id": 2762678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee48142c79e0272fef5875126ebe6912?s=128&d=identicon&r=PG&f=1", "display_name": "QnA", "link": "https://stackoverflow.com/users/2762678/qna"}, "edited": false, "score": 0, "creation_date": 1567677350, "post_id": 57787779, "comment_id": 102037588, "body": "@QnA There are different aspects to a character device. A driver needs hardware devices which usually come by matching hardware device IDs on a bus, and that&#39;s where <code>driver_register</code> comes in. At the file access level, a device needs a device number and a set of file operations, so there are functions to reserve device numbers (<code>register_chrdev_region</code>, <code>alloc_chrdev_region</code>, <code>__register_chrdev</code>) and associate device numbers with file operations (<code>cdev_add</code>, <code>__register_chrdev</code>). A third aspect is creating the file path in &quot;/dev&quot; dynamically via <code>class_create</code> and <code>device_create</code>."}], "tags": [], "owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "is_accepted": true, "score": 3, "last_activity_date": 1567598374, "last_edit_date": 1567598374, "creation_date": 1567597777, "answer_id": 57787779, "question_id": 57773007, "link": "https://stackoverflow.com/questions/57773007/how-does-linux-link-device-file-with-device-driver-does-open-syscall-eventual/57787779#57787779", "title": "How does Linux link device file with device driver? Does open() syscall eventually call device driver code?", "body": "<p>The following applies to opening character special devices.</p>\n\n<p>When the file is opened, the <code>i_fop</code> pointer from the inode object gets copied to the <code>f_op</code> pointer of the file object. For character special devices, this points to <code>def_chr_fops</code>. <code>def_chr_fops.open</code> points to <code>chrdev_open</code>, so <code>chrdev_open(inode, filp)</code> is called when opening any character special device.</p>\n\n<p><code>chrdev_open</code> looks through its set of registered <code>struct cdev</code> objects which map the inode's major/minor numbers (combined into a <code>dev_t</code> number) to a particular registered <code>struct cdev</code>. If no matching <code>struct cdev</code> is found, it returns <code>-ENXIO</code>. Otherwise, it replaces the <code>f_op</code> pointer in the file object with the <code>ops</code> pointer from the <code>struct cdev</code>, which was set by the driver for the character special device.</p>\n\n<p>If the file object's <code>f_op-&gt;open</code> is non-null, it is called and its return value is returned by <code>chrdev_open</code>. Otherwise, no special \"open\" handling is required for this character special device and 0 is returned.</p>\n\n<p>If <code>chrdev_open</code> returns 0, the file object is in the \"open\" state and its <code>f_op</code> pointer points to the driver-specific file operations. The <code>open</code> syscall will eventually return a file descriptor. If <code>chrdev_open</code> returns a negative errno value, the file object will be destroyed, the <code>open</code> syscall will return -1 and <code>errno</code> will be set according to the return value from <code>chrdev_open</code>.</p>\n"}], "owner": {"reputation": 667, "user_id": 2762678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee48142c79e0272fef5875126ebe6912?s=128&d=identicon&r=PG&f=1", "display_name": "QnA", "link": "https://stackoverflow.com/users/2762678/qna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 775, "favorite_count": 0, "accepted_answer_id": 57787779, "answer_count": 2, "score": 1, "last_activity_date": 1582222943, "creation_date": 1567518176, "last_edit_date": 1582222943, "question_id": 57773007, "link": "https://stackoverflow.com/questions/57773007/how-does-linux-link-device-file-with-device-driver-does-open-syscall-eventual", "title": "How does Linux link device file with device driver? Does open() syscall eventually call device driver code?", "body": "<p>I have a question about Linux device file and drivers, with my current understanding as the following:</p>\n\n<ol>\n<li><p>When a user calls <code>open()</code> on some device file, at some point of time kernel will ask <code>inode</code> of the device file for the <code>read()</code>/<code>write()</code> function.</p></li>\n<li><p>The device file was created by <code>udev</code> earlier, based on devices in <code>/sys</code> folder, meaning the <code>inode</code> of the device file should have <code>i_fop</code> field pointed to functions that know how to talk to the device, such as <code>read/write/mmap/ioctl/poll</code>. And that means each device file's <code>inode-&gt;i_fop</code> field should point to a different <code>file_operations</code> struct.</p></li>\n</ol>\n\n<p>If so, the device driver will be providing these <code>read()</code>/<code>write()</code> functions, maybe the complete <code>file_operations</code> struct, including <code>read/write/mmap/ioctl</code>, etc.</p>\n\n<p>now , ULK says (in the description of <code>open()</code> syscall for device files) \"sets the <code>i_fop</code> field of the <code>inode</code> object to the address of either the <code>def_blk_fops</code> or the <code>def_chr_fops</code> file operation table, according to the type of device file.\" And that means all block device files have the same <code>read()</code>/<code>write()</code> function, but then how can a user talk to <em>different</em> devices?</p>\n\n<p>I also checked the <code>device_driver</code> struct, and indeed, there are no place to store file access functions, so how exactly an <code>open()</code> syscall performs its job using a device specific driver then? And where do device specific operation function live, if not in <code>device_driver</code>?</p>\n"}]