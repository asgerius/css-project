[{"tags": ["c++", "c", "linker-errors", "extern"], "comments": [{"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 1, "creation_date": 1576712054, "post_id": 59401416, "comment_id": 104991878, "body": "<code>static MyClass stat_MyClass</code> is a declaration of a static variable. You also need a definition."}, {"owner": {"reputation": 12557, "user_id": 1270789, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/FXwoB.png?s=128&g=1", "display_name": "Ken Y-N", "link": "https://stackoverflow.com/users/1270789/ken-y-n"}, "edited": false, "score": 2, "creation_date": 1576712151, "post_id": 59401416, "comment_id": 104991903, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/5019856/initialize-static-variables-in-c-class\">Initialize static variables in C++ class?</a> Or <a href=\"https://stackoverflow.com/q/9282354/1270789\">this one</a>?"}, {"owner": {"reputation": 143, "user_id": 11584125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a4ba4ec506a871bdc7600de20f20304?s=128&d=identicon&r=PG&f=1", "display_name": "Scott", "link": "https://stackoverflow.com/users/11584125/scott"}, "reply_to_user": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 1, "creation_date": 1576712614, "post_id": 59401416, "comment_id": 104992015, "body": "@HolyBlackCat you&#39;re completely right, that was my stupid error. Adding &quot;MyClass MyClass::stat_MyClass&quot; to the top of my .cpp file fixed everything. The error didn&#39;t show up when I was just compiling the file so I didn&#39;t think to focus my efforts on stuff that was (or wasn&#39;t) there before I added in the extern code. Thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 143, "user_id": 11584125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a4ba4ec506a871bdc7600de20f20304?s=128&d=identicon&r=PG&f=1", "display_name": "Scott", "link": "https://stackoverflow.com/users/11584125/scott"}, "is_accepted": true, "score": 3, "last_activity_date": 1576713091, "last_edit_date": 1576713091, "creation_date": 1576712709, "answer_id": 59401516, "question_id": 59401416, "link": "https://stackoverflow.com/questions/59401416/trying-to-call-c-method-in-c-using-extern-c-get-a-linker-error-of-undefine/59401516#59401516", "title": "Trying to call C++ method in C using extern &quot;C&quot;, get a linker error of &quot;undefined reference to&quot; object", "body": "<p>@HolyBlackCat was right, my error was that I had forgotten to define stat_MyClass. Adding the following line to the top of myclass.cpp fixed everything.</p>\n\n<pre><code>MyClass MyClass::stat_MyClass;\n</code></pre>\n\n<p>The error didn't show up when I was just compiling the standalone file so I didn't think to focus my efforts on stuff that was (or wasn't) there before I added in the extern code. Thank you!</p>\n"}], "owner": {"reputation": 143, "user_id": 11584125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a4ba4ec506a871bdc7600de20f20304?s=128&d=identicon&r=PG&f=1", "display_name": "Scott", "link": "https://stackoverflow.com/users/11584125/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "closed_date": 1576719154, "accepted_answer_id": 59401516, "answer_count": 1, "score": 0, "last_activity_date": 1576713091, "creation_date": 1576711881, "question_id": 59401416, "link": "https://stackoverflow.com/questions/59401416/trying-to-call-c-method-in-c-using-extern-c-get-a-linker-error-of-undefine", "closed_reason": "Duplicate", "title": "Trying to call C++ method in C using extern &quot;C&quot;, get a linker error of &quot;undefined reference to&quot; object", "body": "<p>What I am <em>trying</em> to do is call a C++ method from within a C file, in a new-to-me-but-fairly-large codebase. I have cribbed an implementation from elsewhere in the codebase, but am getting linker errors when I try to build it.</p>\n\n<p>What I <em>think</em> I am doing is making a class in a .cpp/.h file pair. In a global header file, I declare a wrapper function, and in the .cpp file I define that wrapper function within <em>extern \"C\"</em> and have it call one of the class' methods. Then I call the wrapper function from my main .c file. </p>\n\n<p>What I am <em>actually</em> doing is something wrong. I've spent the last few hours reading around on similar stackoverflow errors and how <em>extern \"C\"</em> works, but I still don't understand what isn't going right. Is there an obvious mistake in what I'm doing here?</p>\n\n<p>I am not confident in my understanding of how the build system for this project is set up, but I generally trust that it's set up correctly, and that I've added myclass.cpp to the correct list of build targets. So I'm thinking the error is probably somewhere below.</p>\n\n<p><strong>Error message:</strong></p>\n\n<pre><code>Creating objlist.lnk...\nLinking into output.elf\n\nmodule.o: In function `MyClass::MyMethod()':\n~/myclass.cpp:5: undefined reference to `MyClass::stat_MyClass'\n~/myclass.cpp:5: undefined reference to `MyClass::stat_MyClass'\nmodule.o:~/myclass.cpp:5: more undefined references to `MyClass::stat_MyClass' follow\ncollect2: error: ld returned 1 exit status\nmake[1]: *** [output.elf] Error 1\nmake: *** [default] Error 2\n</code></pre>\n\n<p><strong>Paraphrased code:</strong></p>\n\n<p>global.h</p>\n\n<pre><code>#ifdef __cplusplus\nextern \"C\" {\n#endif\n  int my_c_wrapper_func(void);\n  // other function declarations\n#ifdef __cplusplus\n}\n#endif\n</code></pre>\n\n<p>global.c</p>\n\n<pre><code>#include \"global.h\"\n// my_c_wrapper_func() not defined here\n// other function definitions\n</code></pre>\n\n<p>myclass.h</p>\n\n<pre><code>#include \"global.h\"\nclass MyClass {\npublic:\n  static MyClass* get() { return &amp;stat_MyClass; } // Get the singleton\n  int MyMethod();\n\nprivate:\n  static MyClass stat_MyClass; // The singleton\n}\n</code></pre>\n\n<p>myclass.cpp</p>\n\n<pre><code>#include \"myclass.h\"\n\nextern \"C\" int my_c_wrapper_func() {\n  return MyClass::get()-&gt;MyMethod();\n}\n\nint MyClass::MyMethod() {\n  return 1;\n}\n</code></pre>\n\n<p>main.c</p>\n\n<pre><code>#include \"global.h\"\nint main() {\n  return(my_c_wrapper_func());\n}\n</code></pre>\n"}, {"tags": ["c", "c99", "ansi"], "comments": [{"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 5, "creation_date": 1576711511, "post_id": 59401323, "comment_id": 104991745, "body": "What is your objective for reading the standard? If you are just starting out to learn C I&#39;m not sure reading the standard is  the way to go (others may differ). IMHO better to do some free tutorials or invest your money on a good book."}, {"owner": {"reputation": 9301, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "edited": false, "score": 0, "creation_date": 1576711517, "post_id": 59401323, "comment_id": 104991747, "body": "Related: <a href=\"https://stackoverflow.com/questions/81656/where-do-i-find-the-current-c-or-c-standard-documents\" title=\"where do i find the current c or c standard documents\">stackoverflow.com/questions/81656/&hellip;</a> and also: <a href=\"https://stackoverflow.com/questions/562303/the-definitive-c-book-guide-and-list\" title=\"the definitive c book guide and list\">stackoverflow.com/questions/562303/&hellip;</a>"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 4, "creation_date": 1576711849, "post_id": 59401323, "comment_id": 104991811, "body": "You can usually go with the final draft of the current standard: <a href=\"https://web.archive.org/web/20181230041359if_/http://www.open-std.org/jtc1/sc22/wg14/www/abq/c17_updated_proposed_fdis.pdf\" rel=\"nofollow noreferrer\">web.archive.org/web/20181230041359if_/http://www.open-std.or&zwnj;&#8203;g/&hellip;</a> (no, it is not illegal to read this)"}, {"owner": {"reputation": 77, "user_id": 12561572, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tputicWQvxs/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfc45Xhlmxx4Pajig5QI7vVLU9WQw/photo.jpg?sz=128", "display_name": "lev.1 code", "link": "https://stackoverflow.com/users/12561572/lev-1-code"}, "edited": false, "score": 0, "creation_date": 1576712272, "post_id": 59401323, "comment_id": 104991927, "body": "- kaylum Learning C, I got fundamental questions about C, and I think what i need is axiom of C."}, {"owner": {"reputation": 77, "user_id": 12561572, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tputicWQvxs/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfc45Xhlmxx4Pajig5QI7vVLU9WQw/photo.jpg?sz=128", "display_name": "lev.1 code", "link": "https://stackoverflow.com/users/12561572/lev-1-code"}, "edited": false, "score": 0, "creation_date": 1576712342, "post_id": 59401323, "comment_id": 104991946, "body": "- bob__, Ctx 7  thank you, I&#39;m going to try these links right now."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 6, "creation_date": 1576712636, "post_id": 59401323, "comment_id": 104992023, "body": "Unless you&#39;re already an experienced programmer, the text of a language standard is going to be pretty confusing. It&#39;s not written in simple language, it&#39;s targeted to the people who write compilers and similar programs."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1576712894, "post_id": 59401323, "comment_id": 104992092, "body": "@Barmar: A programming language standard <b>cannot</b> be targeted just to the people who write compilers and similar programs. If it were, only the people who write compilers and similar programs would know what it says. The people who write programs <b>for</b> those compilers would not have the information they need to write correctly and well for those compilers, especially if they want to write portably and not just for a single compiler. So good programmers in general also need to be familiar with the programming language specification, so it should be written for them too."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1576713107, "post_id": 59401323, "comment_id": 104992137, "body": "@EricPostpischil You are fully correct here; I wished, there was an annotated version of the standard, that is <i>accurate</i> and <i>easy understandable</i> (human [or at least nerd] language, augmented with examples), that is not a pain to read and interpret..."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 4, "creation_date": 1576713244, "post_id": 59401323, "comment_id": 104992170, "body": "@EricPostpischil It&#39;s also targeted to other experienced programmers who write manuals, tutorials, test suites, etc. I didn&#39;t feel the need to get into all the details just to point out that it&#39;s NOT written to be accessible to newbies."}, {"owner": {"reputation": 100407, "user_id": 16406, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/fadf252892475e9b177d5cd5e8b24145?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Dodd", "link": "https://stackoverflow.com/users/16406/chris-dodd"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1576714700, "post_id": 59401323, "comment_id": 104992505, "body": "@EricPostpischil: Arguably it <i>should</i> be written for a more general audience, but generally it is not.  It tends to be written by and for people who are intimately familiar with the implementation details of the compilers."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 100407, "user_id": 16406, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/fadf252892475e9b177d5cd5e8b24145?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Dodd", "link": "https://stackoverflow.com/users/16406/chris-dodd"}, "edited": false, "score": 1, "creation_date": 1576715956, "post_id": 59401323, "comment_id": 104992736, "body": "@ChrisDodd: Maybe by, but not for. It explicitly states that (C 2018 footnote 1). Certainly many programmers neglect it\u2014too many. But the C standard is intended for programmers to read, not just compiler implementors. It is technical because it has to be, so it is not for novices, but professional programmers are negligent if they use standard C professionally and do not study the standard to some extent. It does not make sense that it would not be for programmers to read\u2014how would they <b>know</b> how to program correctly? Not just assumefrom examples or unauthoritative lessons, but truly know?"}], "answers": [{"tags": [], "owner": {"reputation": 440, "user_id": 12548337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f829d01c9a63e940910bcaee001c9bb?s=128&d=identicon&r=PG&f=1", "display_name": "jerch", "link": "https://stackoverflow.com/users/12548337/jerch"}, "is_accepted": true, "score": 2, "last_activity_date": 1576715231, "creation_date": 1576715231, "answer_id": 59401814, "question_id": 59401323, "link": "https://stackoverflow.com/questions/59401323/why-c99-standards-document-is-more-expensive-than-c11-c18-versions/59401814#59401814", "title": "Why C99 Standards Document is more expensive than C11, C18 versions?", "body": "<blockquote>\n  <p>I\u2019m trying to learn C as my first programming language.</p>\n</blockquote>\n\n<p>Your first programming language as in \"my first prgramming language ever\" or \"the one I will write most code with\"? If you have no prior programming experience I suggest not to go into reference business right from the beginning, it will distract you from getting familiar with common language paradigms. There are really good tutorials and introductionary books* that will be much easier to digest. Most of the better books even have a language reference section.</p>\n\n<p>About C specs / language specs in general:</p>\n\n<p>C is more on the legacy side of evolution. Most things that were standardized with C11/C18 were already common as custom compiler extensions for many years. As a beginner most of these changes will not help you to get used to C. Secondly specs are written to represent a formal correct write down of a language, that is not quite easy to understand without some background in formal languages and/or compilers.</p>\n\n<p>Furthermore you should check if your compiler(s) for your target platforms support a certain standard. There are many compilers that stopped progressing at C89 or C99. Nothing is more frustrating than learning about a useful pattern that simply does not work because of an outdated compiler. Also at a certain level of C programming a good compiler reference will become more important than the C reference itself due to many custom extensions and switches.</p>\n\n<p>About books vs. PDFs:\nBooks will not always follow the \"oh its old, thus less pricey\" rule. If an edition is almost sold out it gets rare and the price might go up (eventually leading to a new edition release if demand is still high).\nMost of the C specs are in public as PDFs, they are not illegal.</p>\n\n<p>[*] Did not want to advertise here, I am sure you will find lots of good books with an  internet search.</p>\n"}], "owner": {"reputation": 77, "user_id": 12561572, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tputicWQvxs/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfc45Xhlmxx4Pajig5QI7vVLU9WQw/photo.jpg?sz=128", "display_name": "lev.1 code", "link": "https://stackoverflow.com/users/12561572/lev-1-code"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 620, "favorite_count": 0, "closed_date": 1576715385, "accepted_answer_id": 59401814, "answer_count": 1, "score": 0, "last_activity_date": 1576739098, "creation_date": 1576711240, "last_edit_date": 1576739098, "question_id": 59401323, "link": "https://stackoverflow.com/questions/59401323/why-c99-standards-document-is-more-expensive-than-c11-c18-versions", "closed_reason": "Opinion-based", "title": "Why C99 Standards Document is more expensive than C11, C18 versions?", "body": "<p>C18 is developed version of C11 as C11 is developed version of C99.</p>\n\n<p>Then I think</p>\n\n<p>Price of C99 &lt; Price of C11 &lt; Price of C18 is right.\nI\u2019m trying to learn C as my first programming language. And I thought Standard\u2019s of C helps me a lot about my curiosity about C. I want to buy the standard. But what standard should I buy?</p>\n\n<p>It seems reasonable to buy C18 as it\u2019s the latest version of ANSI C. But why? Why C18 is $232.00 and C99 is $403.00? Does C18 encompass only revised section of C99? Or it\u2019s for man who already buy C99? I feel so confused.\nAnd when I google 'ISO/IEC 9899:1999', I can easily see C99's pdf file at the first page. What is it? C99 is originally require money to access. Is it illegal document?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1576709362, "post_id": 59401003, "comment_id": 104991164, "body": "To answer I think we need to see how <code>calculate_product</code> is called. Including how the parameters to the function are allocated. I fear you have passed 2D arrays as first and second parameters."}, {"owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 1, "creation_date": 1576709387, "post_id": 59401003, "comment_id": 104991171, "body": "C or C++? I don&#39;t think it&#39;s both."}, {"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 2, "creation_date": 1576709474, "post_id": 59401003, "comment_id": 104991208, "body": "Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal verifiable example</a>. That is, please show a <code>main</code> including how the function is called."}, {"owner": {"reputation": 3108, "user_id": 4641116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gc52U.png?s=128&g=1", "display_name": "Eljay", "link": "https://stackoverflow.com/users/4641116/eljay"}, "edited": false, "score": 4, "creation_date": 1576709575, "post_id": 59401003, "comment_id": 104991242, "body": "<code>sizeof(int)</code> could possibly be different than the size of a double."}, {"owner": {"reputation": 9301, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "edited": false, "score": 0, "creation_date": 1576712395, "post_id": 59401003, "comment_id": 104991962, "body": "About your last edit, you can&#39;t multiply a 4x2 matrix by a 3x4, their &quot;inner&quot; dimensions aren&#39;t equal. Did you mean a 3x4 multiplied by a 4x2? Are you sure that you are passing the arguments (dimensions) in the correct order?"}, {"owner": {"reputation": 1, "user_id": 12561415, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBGWZwGKnzL6It5imBiBMU1ZRwfJMkZyjaSsFlknQ=k-s128", "display_name": "Kev", "link": "https://stackoverflow.com/users/12561415/kev"}, "reply_to_user": {"reputation": 9301, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "edited": false, "score": 0, "creation_date": 1576712997, "post_id": 59401003, "comment_id": 104992116, "body": "@Bob__ You are right you cannot do the product AxB in that case but I have another function that makes the user decide whether to make AxB or BxA and simply pass the parameters to the contrary."}, {"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 0, "creation_date": 1576713284, "post_id": 59401003, "comment_id": 104992177, "body": "A minimal verifiable example means complete code. That is, no <code>...</code> missing parts in the code. Note that doesn&#39;t mean show all the code you have but to construct an example that has all the irrelevant parts removed but still compilable and able to reproduce the problem."}, {"owner": {"reputation": 1, "user_id": 12561415, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBGWZwGKnzL6It5imBiBMU1ZRwfJMkZyjaSsFlknQ=k-s128", "display_name": "Kev", "link": "https://stackoverflow.com/users/12561415/kev"}, "reply_to_user": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 0, "creation_date": 1576842080, "post_id": 59401003, "comment_id": 105035424, "body": "@kaylum i wanted to edit my post with an example but i can&#39;t because someone have delete it. I&#39;m new on this platform so i still don&#39;t know well how make the perfect post about a problem but i didn&#39;t think someone could delete YOUR post. Anyway i gonna try to make onther one with everything the people needs to solve this problem. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 12561415, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBGWZwGKnzL6It5imBiBMU1ZRwfJMkZyjaSsFlknQ=k-s128", "display_name": "Kev", "link": "https://stackoverflow.com/users/12561415/kev"}, "edited": false, "score": 0, "creation_date": 1576710859, "post_id": 59401211, "comment_id": 104991598, "body": "I tried and it&#39;s continuing to go in segmentation fault :("}, {"owner": {"reputation": 9301, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "reply_to_user": {"reputation": 1, "user_id": 12561415, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBGWZwGKnzL6It5imBiBMU1ZRwfJMkZyjaSsFlknQ=k-s128", "display_name": "Kev", "link": "https://stackoverflow.com/users/12561415/kev"}, "edited": false, "score": 0, "creation_date": 1576711855, "post_id": 59401211, "comment_id": 104991815, "body": "@Kev Have you also changed in the prevoius allocation <code>int *</code> to <code>double *</code>?"}, {"owner": {"reputation": 1, "user_id": 12561415, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBGWZwGKnzL6It5imBiBMU1ZRwfJMkZyjaSsFlknQ=k-s128", "display_name": "Kev", "link": "https://stackoverflow.com/users/12561415/kev"}, "edited": false, "score": 0, "creation_date": 1576712289, "post_id": 59401211, "comment_id": 104991932, "body": "Yes, i did but without succes..."}], "tags": [], "owner": {"reputation": 2385, "user_id": 1009270, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/33fcdc9c0604cf69abb15e17840d2a3c?s=128&d=identicon&r=PG", "display_name": "john elemans", "link": "https://stackoverflow.com/users/1009270/john-elemans"}, "is_accepted": false, "score": 1, "last_activity_date": 1576710507, "creation_date": 1576710507, "answer_id": 59401211, "question_id": 59401003, "link": "https://stackoverflow.com/questions/59401003/segmentation-fault-core-dump-with-multiplication-of-dynamic-matrices/59401211#59401211", "title": "Segmentation fault (core dump) with multiplication of dynamic matrices", "body": "<p>Eljay has it. </p>\n\n<pre><code>prod_matrix[i] = (double *)malloc((dim_col2)*sizeof(int)); \n</code></pre>\n\n<p>should be </p>\n\n<pre><code>prod_matrix[i] = (double *)malloc((dim_col2)*sizeof(double));\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 12561415, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBGWZwGKnzL6It5imBiBMU1ZRwfJMkZyjaSsFlknQ=k-s128", "display_name": "Kev", "link": "https://stackoverflow.com/users/12561415/kev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "closed_date": 1576715399, "answer_count": 1, "score": 0, "last_activity_date": 1576711863, "creation_date": 1576709115, "last_edit_date": 1576711863, "question_id": 59401003, "link": "https://stackoverflow.com/questions/59401003/segmentation-fault-core-dump-with-multiplication-of-dynamic-matrices", "closed_reason": "Not suitable for this site", "title": "Segmentation fault (core dump) with multiplication of dynamic matrices", "body": "<p>I'm writing this code but it's continue on giving me a core dump error but i cannot understand why...This code takes 4 int inputs and two double matrices and gives me two outputs (result and the product matrix). I think the problem is in the allocation but I'm not sure... Thanks in advance for your help!</p>\n\n<pre><code>double **calculate product (double** matrix1,\n                        double** matrix2,\n                        int *result,\n                        int dim_rows1,\n                        int dim_rows2,\n                        int dim_col1,\n                        int dim_col2)\n{ \n   int i, j, k;\n   double** prod_matrix = NULL;\n\n   if(matrix1 == NULL || matrix2 == NULL)\n     *result = 0;\n   else \n   {\n      *result = 1;\n      if(dim_col1 == dim_rows2)\n      {\n         prod_matrix = (double **)malloc((dim_rows1)*sizeof(int *));\n\n         for(i = 0; i &lt; dim_rows1; i++)\n         {\n            prod_matrix[i] = (double *)malloc((dim_col2)*sizeof(int));\n         }\n\n         for(i = 0; i &lt; dim_rows1; i++)\n         {\n            for(j = 0; j &lt; dim_col2; j++)\n            {\n               prod_matrix[i][j] = 0;\n\n               for(k = 0; k &lt; dim_rows2; k++)\n               {\n                  prod_matrix[i][j] += matrix1[i][k]*matrix2[k][j] \n               }\n            }\n         }\n     }\n     else\n      *result = 0;\n\n  return(prod_matrix);\n}\n</code></pre>\n\n<p>An example of main is:</p>\n\n<pre><code>int main (void){\n    int result,\n        dim_col1,\n        dim_col2,\n        dim_rows1,\n        dim_rows2,\n        selected;\n    double **matrix1 = NULL,\n           **matrix2 = NULL,\n           **sum_matrix = NULL,\n           **prod_matrix = NULL;\n\n    selected = text(); /* client chose a number beetween 1 and 6*/\n\n    switch(selected)\n    {\n      case 1: /* case 1 and case 2 take the dimension of the matrix */\n      .\n      . \n      .\n      case 5: /* makes sum beetween matrix */\n      . \n      .\n      case 6: prod_matrix = prod_matrix (matrix1, matrix2, &amp;result, dim_rows1 . . . dim col2)\n        if(result == 1)\n            //do things\n        else\n            //do things\n\n    }\nreturn(0);\n}\n</code></pre>\n\n<p>I forgot to say, usally it works but when i try with the first one matrix (4,2) and the second one (3,4) it goes always in segmentation fault.</p>\n"}, {"tags": ["c", "arrays", "loops", "for-loop", "gcc"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 3, "creation_date": 1576708588, "post_id": 59400902, "comment_id": 104990931, "body": "Your array has only place for 5 elements. Assigning to the 6th element is undefined behavior."}, {"owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "edited": false, "score": 0, "creation_date": 1576708968, "post_id": 59400902, "comment_id": 104991036, "body": "@Kevin Camp This statement  n = n + 1; does not make the array larger."}, {"owner": {"reputation": 7, "user_id": 8175009, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3DE24.jpg?s=128&g=1", "display_name": "Kevin Camp", "link": "https://stackoverflow.com/users/8175009/kevin-camp"}, "edited": false, "score": 0, "creation_date": 1576708992, "post_id": 59400902, "comment_id": 104991045, "body": "When I change to LA[j] = LA[j-1] I also get unexpected answer"}, {"owner": {"reputation": 7, "user_id": 8175009, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3DE24.jpg?s=128&g=1", "display_name": "Kevin Camp", "link": "https://stackoverflow.com/users/8175009/kevin-camp"}, "edited": false, "score": 0, "creation_date": 1576709039, "post_id": 59400902, "comment_id": 104991063, "body": "I thought it looked wrong - just following their example, thanks"}], "answers": [{"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 1, "last_activity_date": 1576711345, "last_edit_date": 1576711345, "creation_date": 1576710081, "answer_id": 59401147, "question_id": 59400902, "link": "https://stackoverflow.com/questions/59400902/new-to-gcc-running-a-array-insertion-gives-me-different-output-locally-than-on/59401147#59401147", "title": "New to GCC - running a array insertion gives me different output locally than on online compiler", "body": "<p>You defined an array of exactly 5 elements. </p>\n\n<pre><code>int LA[] = {1, 3, 5, 7, 8};\n</code></pre>\n\n<p>So the valid range of indices to access elements of the array is <code>[0, 5)</code>.</p>\n\n<p>This array may not be enlarged. So using an index equal to or greater than 5 results in access and overwriting the memory beyond the array.</p>\n\n<p>You need initially to define the array with the number of elements that allows to insert new elements apart from the 5 explicitly initialized elements.</p>\n\n<p>What you mean is something like the following</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void) \n{\n    enum { N = 10 };\n\n    int a[N] = { 1, 3, 5, 7, 8 };\n\n    size_t n = 0;\n\n    while ( a[n] != 0 ) ++n;\n\n    printf( \"The original array elements are :\" );\n    for ( size_t i = 0; i &lt; n; i++ ) printf( \"%d \", a[i] );\n    putchar( '\\n' );\n\n    int item = 10;\n    size_t pos = 3;\n\n    size_t j = n;\n\n    if ( pos &lt; j )\n    {\n        for ( ; j != pos; j-- )\n        {\n            a[j] = a[j-1];\n        }\n    }\n\n    a[j] = item;\n\n    ++n;\n\n    printf( \"The array elements after insertion : \" );\n\n    for ( size_t i = 0; i &lt; n; i++ ) printf( \"%d \", a[i] );\n    putchar( '\\n' );\n\n    return 0;\n}\n</code></pre>\n\n<p>The program output is</p>\n\n<pre><code>The original array elements are :1 3 5 7 8 \nThe array elements after insertion : 1 3 5 10 7 8 \n</code></pre>\n\n<p>Note: This code snippet</p>\n\n<pre><code>    if ( pos &lt; j )\n    {\n        for ( ; j != pos; j-- )\n        {\n            a[j] = a[j-1];\n        }\n    }\n</code></pre>\n\n<p>can be substituted for this loop</p>\n\n<pre><code>for ( ; pos &lt; j; j-- )\n{\n    a[j] = a[j-1];\n}\n</code></pre>\n"}], "owner": {"reputation": 7, "user_id": 8175009, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3DE24.jpg?s=128&g=1", "display_name": "Kevin Camp", "link": "https://stackoverflow.com/users/8175009/kevin-camp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1576711345, "creation_date": 1576708444, "last_edit_date": 1576710603, "question_id": 59400902, "link": "https://stackoverflow.com/questions/59400902/new-to-gcc-running-a-array-insertion-gives-me-different-output-locally-than-on", "title": "New to GCC - running a array insertion gives me different output locally than on online compiler", "body": "<p>I am going through a TuturialsPoint algorithm and trying to run the C code with GCC. Would anyone know why my local output would be different that what is produced by an online C compiler?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nmain()\n{\n    int LA[] = {1, 3, 5, 7, 8};\n    int item = 10, k = 3, n = 5;\n    int i = 0, j = n;\n\n    printf(\"The original array elements are :\\n\");\n\n    for (i = 0; i &lt; n; i++)\n    {\n        printf(\"LA[%d] = %d \\n\", i, LA[i]);\n    }\n\n    n = n + 1;\n\n    while (j &gt;= k)\n    {\n        LA[j + 1] = LA[j];\n        j = j - 1;\n    }\n\n    LA[k] = item;\n\n    printf(\"The array elements after insertion :\\n\");\n\n    for (i = 0; i &lt; n; i++)\n    {\n        printf(\"LA[%d] = %d \\n\", i, LA[i]);\n    }\n}\n</code></pre>\n\n<p>Expected output (from online gcc compiler)</p>\n\n<pre><code>The original array elements are :\nLA[0] = 1 \nLA[1] = 3 \nLA[2] = 5 \nLA[3] = 7 \nLA[4] = 8 \nThe array elements after insertion :\nLA[0] = 1 \nLA[1] = 3 \nLA[2] = 5 \nLA[3] = 10 \nLA[4] = 7 \nLA[5] = 8 \n</code></pre>\n\n<p>My local output: </p>\n\n<pre><code>The original array elements are :\nLA[0] = 1\nLA[1] = 3\nLA[2] = 5\nLA[3] = 7\nLA[4] = 8\nThe array elements after insertion :\nLA[0] = 1\nLA[1] = 3\nLA[2] = 5\nLA[3] = 7\nLA[4] = 8\nLA[5] = 6\n</code></pre>\n\n<p>I am using gcc version 8.2.0 (MinGW.org GCC-8.2.0-5)</p>\n"}, {"tags": ["c", "language-lawyer", "pointer-arithmetic", "strict-aliasing"], "answers": [{"comments": [{"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1576707082, "post_id": 59400603, "comment_id": 104990405, "body": "What rule, if any, would exempt from the constraints in N1570 6.5p7 accesses made to array objects using lvalues of their element types?  A compiler that couldn&#39;t accommodate accesses made to arrays using element types would be pretty useless, but is there anything in the Standard that would actually require compilers to process such accesses usefully?"}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 1, "creation_date": 1576707348, "post_id": 59400603, "comment_id": 104990495, "body": "@supercat objects that are part of an array have declared type as the type of the element of the array. So they would be compatible with an lvalue expression of element type."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 2, "creation_date": 1576707911, "post_id": 59400603, "comment_id": 104990725, "body": "@AjayBrahmakshatriya: Yes, but an object which is within an array is <i>also</i> part of an array object, and thus any access to an object within an array is also an access to the array object.  This isn&#39;t observable with stand-alone array objects, since one can&#39;t directly use an lvalue of array type, but is observable with arrays that are contained within structures or unions.  Both clang and gcc apply different aliasing assumptions to <code>aggregate.memberArray[index]</code> vs <code>(*((aggregate.memberArray)+(index)))</code> even though the Standard defines the former as the latter."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1576708765, "post_id": 59400603, "comment_id": 104990982, "body": "@supercat that is an interesting point. I always thought of the &quot;access&quot; in 6.5p7 to be lvalue to rvalue conversion not the actual <code>*</code> operator. Here aggregate.memberArray is an lvalue of type <code>int[]</code>. And it is being immediately being converted to rvalue of type <code>int[]</code> (for the arithmetic). Thus the lvalue used to access the object of type array is array. I am not sure though"}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1576709865, "post_id": 59400603, "comment_id": 104991323, "body": "@AjayBrahmakshatriya: I think the best way to interpret things would be to say that an operation which forms an object&#39;s address and the use of the resulting pointer together constitute an access to the parent object, and the rules in 6.5p7 identify the only cases where such accesses may overlap.  Such an interpretation would accommodate most constructs that clang and gcc can&#39;t handle without <code>-fno-strict-aliasing</code>, but the authors of clang and gcc have doubled down on their refusal to process such code and would block any mandate requiring it."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1576710042, "post_id": 59400603, "comment_id": 104991376, "body": "@AjayBrahmakshatriya: Such an interpretation would have also avoided the need for the nonsensical rationale given in Defect Report 28 <a href=\"http://www.open-std.org/jtc1/sc22/wg14/www/docs/dr_028.html\" rel=\"nofollow noreferrer\">open-std.org/jtc1/sc22/wg14/www/docs/dr_028.html</a> which has resulted in 25 years of needless confusion."}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 1, "last_activity_date": 1576706779, "creation_date": 1576706779, "answer_id": 59400603, "question_id": 59400569, "link": "https://stackoverflow.com/questions/59400569/does-this-break-the-strict-aliasing-rule/59400603#59400603", "title": "Does this break the strict aliasing rule?", "body": "<p>This does <strong>not</strong> break strict aliasing.</p>\n\n<p>After <code>num</code> is casted to a <code>char *</code> and arithmetic performed on it, the resulting pointer is cast to <code>int *</code>, and that pointer points to a valid <code>int</code> object.  So it may be dereferenced safely.</p>\n"}, {"comments": [{"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1576869982, "post_id": 59400631, "comment_id": 105046696, "body": "@curiousguy I am not sure which pointer and object you are referring to. Could you elaborate a little more on the question?"}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1576870698, "post_id": 59400631, "comment_id": 105046947, "body": "What is the effect of <code>+ sizeof(int)</code>? Can pointers be manipulated that way?"}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1576874503, "post_id": 59400631, "comment_id": 105048185, "body": "@curiousguy yes, the definition of arrays guarantees that objects of type integer are spaced with <code>sizeof(int)</code>"}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1576874883, "post_id": 59400631, "comment_id": 105048282, "body": "That they have a given layout is one thing, that you can do arithmetic on pointers as if they were integers is another. And it doesn&#39;t seem obvious to me."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1576875030, "post_id": 59400631, "comment_id": 105048323, "body": "@curiousguy we are not doing arithmetic on them as integers, we are doing arithmetic on <code>char*</code> pointers which have well-defined semantics. You can find it here <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.5.6p8\" rel=\"nofollow noreferrer\">6.5.6p8</a>"}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1576875580, "post_id": 59400631, "comment_id": 105048471, "body": "I see no explanation of what happens when you add <code>sizeof(int)</code> in that text. It actually says that adding 1 (not <code>sizeof(int)</code>!) moves to the next element. It doesn&#39;t even describe &quot;spacing&quot; of array elements."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1576880112, "post_id": 59400631, "comment_id": 105049565, "body": "@curiousguy <i>..if the expression P points to the i-th element of an array object, the expressions (P)+N (equivalently, N+(P)) and (P)-N (where N has the value n) point to, respectively, the i+n-th and i-n-th elements of the array object, provided they exist...</i>"}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "edited": false, "score": 0, "creation_date": 1576880171, "post_id": 59400631, "comment_id": 105049580, "body": "@curiousguy I didn&#39;t cite the layout of arrays because you asked about the pointer arithmetic."}, {"owner": {"reputation": 7287, "user_id": 963864, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/94e2dd813e278309b6281b4a4b7fdddd?s=128&d=identicon&r=PG", "display_name": "curiousguy", "link": "https://stackoverflow.com/users/963864/curiousguy"}, "reply_to_user": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1576901250, "post_id": 59400631, "comment_id": 105052321, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/204639/discussion-between-curiousguy-and-ajay-brahmakshatriya\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "is_accepted": true, "score": 2, "last_activity_date": 1576707380, "last_edit_date": 1592644375, "creation_date": 1576706942, "answer_id": 59400631, "question_id": 59400569, "link": "https://stackoverflow.com/questions/59400569/does-this-break-the-strict-aliasing-rule/59400631#59400631", "title": "Does this break the strict aliasing rule?", "body": "<p>Quoting <code>C11</code>, chapter <a href=\"http://port70.net/%7Ensz/c/c11/n1570.html#6.5p7\" rel=\"nofollow noreferrer\">\u00a76.5p7</a></p>\n<blockquote>\n<p>An object shall have its stored value accessed only by an lvalue expression that has one of the following types:</p>\n<ol>\n<li>a type compatible with the <strong>effective type</strong> of the object</li>\n</ol>\n</blockquote>\n<p>Also</p>\n<p>Quoting <code>C11</code>, chapter <a href=\"http://port70.net/%7Ensz/c/c11/n1570.html#6.5p6\" rel=\"nofollow noreferrer\">\u00a76.5p6</a></p>\n<blockquote>\n<p>The effective type of an object for an access to its stored value is the <strong>declared type</strong> of the object, if any....</p>\n</blockquote>\n<p><sub>Emphases mine</sub></p>\n<p>Here the effective type of the object pointed by <code>num</code> is indeed <code>int</code> and hence it is okay to dereference it with a pointer to <code>int</code>.</p>\n"}], "owner": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 1, "accepted_answer_id": 59400631, "answer_count": 2, "score": 5, "last_activity_date": 1576812934, "creation_date": 1576706605, "last_edit_date": 1576812934, "question_id": 59400569, "link": "https://stackoverflow.com/questions/59400569/does-this-break-the-strict-aliasing-rule", "title": "Does this break the strict aliasing rule?", "body": "<p>Inspired by my comment on the recent post: <a href=\"https://stackoverflow.com/questions/59398799/c-get-element-on-place-without-parenthesis\">C get element on place without parenthesis</a> , I would like to know if the following code breaks the strict aliasing rule:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void)\n{\n    int num[3] = { 1, 2, 3 };\n\n    printf(\"num[1] = %d\\n\", *(int *)((char *)num + sizeof(int)));\n\n    return 0;\n}\n</code></pre>\n\n<p>I know that de-referencing a pointer that is type-cast to a different type other than <code>char</code> is a violation, but here, the original pointer is of type <code>int *</code>. It is de-referenced after it is cast to <code>char *</code> then to <code>int *</code>.</p>\n\n<p>Does this violate the strict aliasing rule?</p>\n"}, {"tags": ["c", "gcc"], "comments": [{"owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 1, "creation_date": 1576706836, "post_id": 59400526, "comment_id": 104990326, "body": "I think the macros are even worse than the digraphs. Blech!"}, {"owner": {"reputation": 74843, "user_id": 2988730, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/ZOX7t.jpg?s=128&g=1", "display_name": "Mad Physicist", "link": "https://stackoverflow.com/users/2988730/mad-physicist"}, "edited": false, "score": 3, "creation_date": 1576707360, "post_id": 59400526, "comment_id": 104990503, "body": "In the spirit of the thing, it should be <code>%: define CCURLY_BRACE &lt;%</code>"}, {"owner": {"reputation": 74843, "user_id": 2988730, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/ZOX7t.jpg?s=128&g=1", "display_name": "Mad Physicist", "link": "https://stackoverflow.com/users/2988730/mad-physicist"}, "edited": false, "score": 1, "creation_date": 1576707494, "post_id": 59400526, "comment_id": 104990549, "body": "Or better yet, <code>??=define CCURLY_BRACE ??&lt;</code>, and <code>return 1 ??&#39; 2 ??&#39; 3 ??&#39; 4 ??&#39; 5 ??&#39; 6 ??&#39; 7 SEMICOLON</code>"}], "owner": {"reputation": 81, "user_id": 7419139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c3a53e90b8c267fb46de9238ba86c5a?s=128&d=identicon&r=PG&f=1", "display_name": "jaklh", "link": "https://stackoverflow.com/users/7419139/jaklh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "closed_date": 1576706624, "answer_count": 0, "score": 2, "last_activity_date": 1576706387, "creation_date": 1576706387, "question_id": 59400526, "link": "https://stackoverflow.com/questions/59400526/what-does-percent-colon-mean-in-c", "closed_reason": "Duplicate", "title": "What does &quot;%:&quot; (percent colon) mean in C?", "body": "<p>In one of my courses I've been given this cryptic c code.</p>\n\n<pre><code>%:define BBRACE (\n%:define BRACEE )\n%:define CCURLY_BRACE {\n%:define CURLY_BRACEE }\n%:define SEMICOLON ;\n%:define COMMA ,\nint main BBRACE int argc COMMA char *argv&lt;::&gt; BRACEE CCURLY_BRACE return 1^2^3^4^5^6^7 SEMICOLON CURLY_BRACEE\n</code></pre>\n\n<p>Its not that complicated but I've never seen <code>%:define ...</code> is there any difference to <code>#define ...</code>? I found nothing about <code>%:</code>online.</p>\n\n<p>Same goes with <code>char *argv&lt;::&gt;</code> but I don't know if this really deserves a second question.</p>\n"}, {"tags": ["c", "gcc", "64-bit", "long-integer"], "comments": [{"owner": {"reputation": 3470, "user_id": 531679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LYlCV.gif?s=128&g=1", "display_name": "Steve Friedl", "link": "https://stackoverflow.com/users/531679/steve-friedl"}, "edited": false, "score": 2, "creation_date": 1576702802, "post_id": 59399883, "comment_id": 104988900, "body": "<code>unsigned long long</code> requires a <code>%llu</code> format, I believe"}, {"owner": {"reputation": 511, "user_id": 813801, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/14616e8dce95f1acfb6596c2558dc215?s=128&d=identicon&r=PG", "display_name": "user813801", "link": "https://stackoverflow.com/users/813801/user813801"}, "reply_to_user": {"reputation": 3470, "user_id": 531679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LYlCV.gif?s=128&g=1", "display_name": "Steve Friedl", "link": "https://stackoverflow.com/users/531679/steve-friedl"}, "edited": false, "score": 0, "creation_date": 1576702942, "post_id": 59399883, "comment_id": 104988945, "body": "@SteveFriedl now works"}, {"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 0, "creation_date": 1576703146, "post_id": 59399883, "comment_id": 104989018, "body": "Also, the correct format for <code>size_t</code> (the type of a <code>sizeof</code> expression) is <code>%zu</code>."}, {"owner": {"reputation": 1599, "user_id": 9948091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JANyt.png?s=128&g=1", "display_name": "HAL9000", "link": "https://stackoverflow.com/users/9948091/hal9000"}, "edited": false, "score": 0, "creation_date": 1576708546, "post_id": 59399883, "comment_id": 104990919, "body": "Always compile with <code>-Wall</code> and read the warnings"}], "answers": [{"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 1, "last_activity_date": 1576703115, "last_edit_date": 1576703115, "creation_date": 1576702949, "answer_id": 59399931, "question_id": 59399883, "link": "https://stackoverflow.com/questions/59399883/gcc-long-long-int-width-same-as-int/59399931#59399931", "title": "gcc long long int width same as int", "body": "<p>You're using the wrong format specifier to print.</p>\n\n<p>An <code>unsigned long long int</code> requires the use of the <code>%llu</code> format specifier.  You're using <code>%lu</code> instead, which is for <code>unsigned long int</code>.  Mismatching the format specifier to the type invokes <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behavior</a>.</p>\n\n<p>What's <em>probably</em> happening in this case is that the first 4 bytes of the <code>unsigned long long</code> value are being read as an <code>unsigned long</code>.</p>\n\n<p>Print like this:</p>\n\n<pre><code>printf(\"ULLONG_MAX   :   %llu\\n\", (unsigned long long int) ULLONG_MAX);\nprintf(\"Big Integer   :   %llu\\n\", (unsigned long long int) 1234567890123456);\n</code></pre>\n\n<p>And you should see the expected results.</p>\n"}, {"comments": [{"owner": {"reputation": 511, "user_id": 813801, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/14616e8dce95f1acfb6596c2558dc215?s=128&d=identicon&r=PG", "display_name": "user813801", "link": "https://stackoverflow.com/users/813801/user813801"}, "edited": false, "score": 0, "creation_date": 1576704458, "post_id": 59399952, "comment_id": 104989482, "body": "used -W -Wall and now says &quot;unknown conversion type character &#39;l&#39; in format&quot; after doing your fix of printf(&quot;ULLONG_MAX   :   %llu\\n&quot;, (unsigned long long) ULLONG_MAX);"}, {"owner": {"reputation": 3470, "user_id": 531679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LYlCV.gif?s=128&g=1", "display_name": "Steve Friedl", "link": "https://stackoverflow.com/users/531679/steve-friedl"}, "reply_to_user": {"reputation": 511, "user_id": 813801, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/14616e8dce95f1acfb6596c2558dc215?s=128&d=identicon&r=PG", "display_name": "user813801", "link": "https://stackoverflow.com/users/813801/user813801"}, "edited": false, "score": 0, "creation_date": 1576704596, "post_id": 59399952, "comment_id": 104989545, "body": "Hmm, that&#39;s odd, because <code>%llu</code> should be correct. Are you sure it&#39;s pointing to that line?"}, {"owner": {"reputation": 511, "user_id": 813801, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/14616e8dce95f1acfb6596c2558dc215?s=128&d=identicon&r=PG", "display_name": "user813801", "link": "https://stackoverflow.com/users/813801/user813801"}, "edited": false, "score": 0, "creation_date": 1576704685, "post_id": 59399952, "comment_id": 104989580, "body": "c_pro2.c:15:32: warning: unknown conversion type character &#39;l&#39; in format [-Wformat=]      printf(&quot;ULLONG_MAX   :   %llu\\n&quot;, (unsigned long long) ULLONG_MAX);"}, {"owner": {"reputation": 3470, "user_id": 531679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LYlCV.gif?s=128&g=1", "display_name": "Steve Friedl", "link": "https://stackoverflow.com/users/531679/steve-friedl"}, "reply_to_user": {"reputation": 511, "user_id": 813801, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/14616e8dce95f1acfb6596c2558dc215?s=128&d=identicon&r=PG", "display_name": "user813801", "link": "https://stackoverflow.com/users/813801/user813801"}, "edited": false, "score": 0, "creation_date": 1576705107, "post_id": 59399952, "comment_id": 104989721, "body": "Maybe this is relevant?  <a href=\"https://stackoverflow.com/questions/23718110/error-unknown-conversion-type-character-l-in-format-scanning-long-long\" title=\"error unknown conversion type character l in format scanning long long\">stackoverflow.com/questions/23718110/&hellip;</a>"}, {"owner": {"reputation": 511, "user_id": 813801, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/14616e8dce95f1acfb6596c2558dc215?s=128&d=identicon&r=PG", "display_name": "user813801", "link": "https://stackoverflow.com/users/813801/user813801"}, "edited": false, "score": 0, "creation_date": 1576823513, "post_id": 59399952, "comment_id": 105028234, "body": "this works <a href=\"https://stackoverflow.com/a/55586/813801\">stackoverflow.com/a/55586/813801</a>"}], "tags": [], "owner": {"reputation": 3470, "user_id": 531679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LYlCV.gif?s=128&g=1", "display_name": "Steve Friedl", "link": "https://stackoverflow.com/users/531679/steve-friedl"}, "is_accepted": true, "score": 2, "last_activity_date": 1576703348, "last_edit_date": 1576703348, "creation_date": 1576703031, "answer_id": 59399952, "question_id": 59399883, "link": "https://stackoverflow.com/questions/59399883/gcc-long-long-int-width-same-as-int/59399952#59399952", "title": "gcc long long int width same as int", "body": "<p><code>printf</code> needs to know the difference between <code>long</code> and <code>long long</code>, and that's with the <code>%lld</code> (signed) or <code>%llu</code> (unsigned):</p>\n\n<pre><code>    printf(\"ULLONG_MAX  :   %llu\\n\", (unsigned long long int) ULLONG_MAX);\n    printf(\"Big Integer :   %llu\\n\", (unsigned long long int) 1234567890123456);\n</code></pre>\n\n<p>This should work as you expect. Otherwise, printf is grabbing only part of the bits from the stack, giving the bad answers you were getting.</p>\n\n<p>Furthermore, if you'd turn on compiler warnings it would have told you this:</p>\n\n<pre><code>long.c: In function \u2018main\u2019:\nlong.c:13:5: warning: format \u2018%lu\u2019 expects argument of type \u2018long unsigned int\u2019, but argument 2 has type \u2018long long unsigned int\u2019 [-Wformat=]\n     printf(\"ULLONG_MAX  :   %lu\\n\", (unsigned long long int) ULLONG_MAX);\n     ^\nlong.c:14:5: warning: format \u2018%lu\u2019 expects argument of type \u2018long unsigned int\u2019, but argument 2 has type \u2018long long unsigned int\u2019 [-Wformat=]\n     printf(\"Big Integer :   %lu\\n\", (unsigned long long int) 1234567890123456);\n     ^\nlong.c:16:5: warning: format \u2018%d\u2019 expects argument of type \u2018int\u2019, but argument 2 has type \u2018long unsigned int\u2019 [-Wformat=]\n</code></pre>\n\n<p>It's a really, really good idea to always turn on the warnings - with GCC I normally use <code>-W -Wall</code> - so it tells me what I'm getting wrong.</p>\n\n<p>Compiler warnings are like SO but without the downvotes :-)</p>\n"}], "owner": {"reputation": 511, "user_id": 813801, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/14616e8dce95f1acfb6596c2558dc215?s=128&d=identicon&r=PG", "display_name": "user813801", "link": "https://stackoverflow.com/users/813801/user813801"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "closed_date": 1576703175, "accepted_answer_id": 59399952, "answer_count": 2, "score": -1, "last_activity_date": 1576703379, "creation_date": 1576702669, "last_edit_date": 1576703379, "question_id": 59399883, "link": "https://stackoverflow.com/questions/59399883/gcc-long-long-int-width-same-as-int", "closed_reason": "Duplicate", "title": "gcc long long int width same as int", "body": "<p>I am testing gcc version 8.2</p>\n\n<p>gcc seems to be treating <code>long long int</code> as <code>int</code>. Is there any way to fix this? </p>\n\n<p>Here is the code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;limits.h&gt;\n#include &lt;float.h&gt;\n\nint main(int argc, char** argv) {\n\n    printf(\"INT_MAX     :   %d\\n\", INT_MAX);\n    printf(\"INT_MIN     :   %d\\n\", INT_MIN);\n    printf(\"LONG_MAX    :   %ld\\n\", (long) LONG_MAX);\n    printf(\"LONG_MIN    :   %ld\\n\", (long) LONG_MIN);\n    printf(\"UINT_MAX    :   %u\\n\", (unsigned int) UINT_MAX);\n    printf(\"ULLONG_MAX   :   %lu\\n\", (unsigned long long int) ULLONG_MAX);\n    printf(\"Big Integer   :   %lu\\n\", (unsigned long long int) 1234567890123456);\n\n    printf(\"%d\\n\", sizeof(long long int));\n    return 0;\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>INT_MAX     :   2147483647\nINT_MIN     :   -2147483648\nLONG_MAX    :   2147483647\nLONG_MIN    :   -2147483648\nUINT_MAX    :   4294967295\nULLONG_MAX   :   4294967295\nBig Integer   :   1015724736\n8\n</code></pre>\n\n<p>C:\\prog_c\\c_pro>gcc --version\ngcc (MinGW.org GCC-8.2.0-5) 8.2.0\nCopyright (C) 2018 Free Software Foundation, Inc...</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 731, "user_id": 8024280, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/nQZKP.jpg?s=128&g=1", "display_name": "wair92", "link": "https://stackoverflow.com/users/8024280/wair92"}, "edited": false, "score": 3, "creation_date": 1576701215, "post_id": 59399590, "comment_id": 104988332, "body": "What about using a debugger? Or print sizes?"}, {"owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 3, "creation_date": 1576701290, "post_id": 59399590, "comment_id": 104988359, "body": "<code>#</code> is not a comment delimiter in C."}, {"owner": {"reputation": 195333, "user_id": 253056, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1977cbe0ac5ffec4f6ee5ee24363988a?s=128&d=identicon&r=PG", "display_name": "Paul R", "link": "https://stackoverflow.com/users/253056/paul-r"}, "edited": false, "score": 7, "creation_date": 1576701301, "post_id": 59399590, "comment_id": 104988363, "body": "SIZE is unsigned."}, {"owner": {"reputation": 5676, "user_id": 5023438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uvlov.jpg?s=128&g=1", "display_name": "alter igel", "link": "https://stackoverflow.com/users/5023438/alter-igel"}, "edited": false, "score": 1, "creation_date": 1576701351, "post_id": 59399590, "comment_id": 104988374, "body": "Listen to your compiler warnings! I expect your compiler is trying to warn you about a comparison between signed and unsigned values using <code>&lt;</code>"}, {"owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "reply_to_user": {"reputation": 5676, "user_id": 5023438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uvlov.jpg?s=128&g=1", "display_name": "alter igel", "link": "https://stackoverflow.com/users/5023438/alter-igel"}, "edited": false, "score": 0, "creation_date": 1576701597, "post_id": 59399590, "comment_id": 104988458, "body": "@alterigel: I don&#39;t seem to get a compile warning unless I use <code>-Wextra</code>, unfortunately."}, {"owner": {"reputation": 2849, "user_id": 10573793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XP0ED.gif?s=128&g=1", "display_name": "preciousbetine", "link": "https://stackoverflow.com/users/10573793/preciousbetine"}, "reply_to_user": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 0, "creation_date": 1576703248, "post_id": 59399590, "comment_id": 104989049, "body": "@FredLarson neither is #size a preprocessor."}, {"owner": {"reputation": 116, "user_id": 8245017, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jUl9I.jpg?s=128&g=1", "display_name": "Iliya Iliev", "link": "https://stackoverflow.com/users/8245017/iliya-iliev"}, "edited": false, "score": 0, "creation_date": 1576703745, "post_id": 59399590, "comment_id": 104989216, "body": "You can get the prints by typecasting SIZE as int, it should look like this: <code>#define SIZE (int)(sizeof(array)&#47;sizeof(array[0])) &#47;&#47;size is 6</code>"}, {"owner": {"reputation": 398, "user_id": 5871187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hu64h.jpg?s=128&g=1", "display_name": "S Dao", "link": "https://stackoverflow.com/users/5871187/s-dao"}, "edited": false, "score": 0, "creation_date": 1576835911, "post_id": 59399590, "comment_id": 105032775, "body": "<code>i = -1</code> when compare with <code>SIZE</code> (<code>sizeof</code> return <code>unsigned</code> number) will be promoted to <code>unsigned</code> type which means 0xFFFFFFFF (32 bits machine) hence <code>i &lt; SIZE</code> ~ <code>0xFFFFFFFF &lt; 6</code> which is FALSE."}], "owner": {"reputation": 177, "user_id": 11499479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c678e6fca8d8a345cb62c4b5f0004683?s=128&d=identicon&r=PG&f=1", "display_name": "au.tumn", "link": "https://stackoverflow.com/users/11499479/au-tumn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "closed_date": 1576701688, "answer_count": 0, "score": 0, "last_activity_date": 1576701202, "creation_date": 1576701108, "last_edit_date": 1576701202, "question_id": 59399590, "link": "https://stackoverflow.com/questions/59399590/why-nothing-will-be-printed-in-this-c-language-code", "closed_reason": "Duplicate", "title": "why nothing will be printed in this C language code?", "body": "<p>why nothing will be printed in this code?\n<code>SIZE</code> is equal to 6, when I change <code>int i= -1</code> to <code>int i= 0</code> i have print. also when i change \n<code>i&lt; SIZE</code> to <code>i&lt;6</code> i have print. but why nothing will be printed in this code?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint array[6] = {4, 5, 6, 10, -1, 0};\n#define SIZE (sizeof(array)/sizeof(array[0])) #size is 6\nint main() \n {\n\n  for (int i= -1; i&lt; SIZE ; ++i) \n   {\n    printf(\"%s\\n\",\"--------\");\n    printf(\"%d\\n\",i);\n    printf(\"%d\\n\", array[i+1]);\n  }\n  return 0;\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 1, "creation_date": 1576699021, "post_id": 59399159, "comment_id": 104987504, "body": "&quot;I get Segmentation fault and I don&#39;t know why&quot;. The way to try and find out why is to run your program in a debugger."}, {"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1576699044, "post_id": 59399159, "comment_id": 104987513, "body": "You are returning the address of a local variable at <code>return r;</code>"}, {"owner": {"reputation": 1340, "user_id": 7218062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0e0d5a2d3c49c93f1aafd67adaaca59?s=128&d=identicon&r=PG&f=1", "display_name": "jmq", "link": "https://stackoverflow.com/users/7218062/jmq"}, "edited": false, "score": 0, "creation_date": 1576699209, "post_id": 59399159, "comment_id": 104987562, "body": "Not directly related to your problem, but comparing character by character is an inefficient way of comparing strings.  Something like strcmp(toupper(names[i]), toupper(names[j])) would be faster and cleaner.  Converting both names to upper case gets rid of the plus and minus 32 cases."}, {"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 1, "creation_date": 1576699275, "post_id": 59399159, "comment_id": 104987590, "body": "<code>w&lt; MAX_L || same ==false</code> That looks pretty dangerous. The point of <code>w&lt;MAX_L</code> is to ensure the array bounds are not exceeded. Adding <code>||</code> potentially removes that safety barrier."}, {"owner": {"reputation": 4046, "user_id": 4971422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4abf51a937ddda51cc6813445605c50?s=128&d=identicon&r=PG&f=1", "display_name": "FredK", "link": "https://stackoverflow.com/users/4971422/fredk"}, "edited": false, "score": 1, "creation_date": 1576699842, "post_id": 59399159, "comment_id": 104987815, "body": "And don&#39;t compare <code>same</code> to <code>true</code> or <code>false</code>. Just use <code>if (same)</code> or <code>if( !same )</code>. It is too easy to mistype the number of equal signs, creating an error that is usually very difficult to find."}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 12560832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b77da98eaad082dde7725ca111e1515a?s=128&d=identicon&r=PG&f=1", "display_name": "Dando", "link": "https://stackoverflow.com/users/12560832/dando"}, "edited": false, "score": 0, "creation_date": 1576707273, "post_id": 59399555, "comment_id": 104990467, "body": "Thanks for your answer! Just a question if I want make the code little bit easier with compare the string without bool and every single character in the compare section. How can I do it. I tried this code but didnt work.                                                                                                                                                                   if (strlen(names[i]) == strlen(names[j])){ \t\t\t    if (strcmp(toupper(names[i]), toupper(names[j]) == 0){ \t \t     \t\t    printf(&quot;\\nERROR! You already entered this name!&quot;); \t\t    \t\t    return 0; \t\t\t}  }"}, {"owner": {"reputation": 39, "user_id": 12560832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b77da98eaad082dde7725ca111e1515a?s=128&d=identicon&r=PG&f=1", "display_name": "Dando", "link": "https://stackoverflow.com/users/12560832/dando"}, "edited": false, "score": 0, "creation_date": 1576708061, "post_id": 59399555, "comment_id": 104990784, "body": "<code>if (strlen(names[i]) == strlen(names[j])){ \t\t\tif (strcmp(toupper(names[i]), toupper(names[j]) == 0){ \t \t     \t\tprintf(&quot;\\nERROR! You already entered this name!&quot;); \t\t    \t\treturn 0; \t\t\t}   \t\t}</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user12531529"}, "edited": false, "score": 0, "creation_date": 1576744504, "post_id": 59399555, "comment_id": 104999728, "body": "There are a lot of <a href=\"https://i.stack.imgur.com/gB23x.png\" rel=\"nofollow noreferrer\">warnings</a> for your updated code, <a href=\"http://www.cplusplus.com/reference/cctype/toupper/\" rel=\"nofollow noreferrer\">check out</a> <code>toupper</code> function, it&#39;s used for <code>int</code> variables, not for a string. By the way don&#39;t forget to mark my answer as accepted with \u200e\u2713 sign."}, {"owner": {"reputation": 39, "user_id": 12560832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b77da98eaad082dde7725ca111e1515a?s=128&d=identicon&r=PG&f=1", "display_name": "Dando", "link": "https://stackoverflow.com/users/12560832/dando"}, "edited": false, "score": 0, "creation_date": 1576767047, "post_id": 59399555, "comment_id": 105011260, "body": "Thanks Artem Bondar"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user12531529"}, "is_accepted": true, "score": 1, "last_activity_date": 1576700916, "creation_date": 1576700916, "answer_id": 59399555, "question_id": 59399159, "link": "https://stackoverflow.com/questions/59399159/segmentation-fault-core-dumped-with-strings/59399555#59399555", "title": "Segmentation fault (core dumped) with strings", "body": "<p>Use <a href=\"https://www.gnu.org/software/gdb/\" rel=\"nofollow noreferrer\">gdb</a> to debug your program.</p>\n\n<p>All you need to do is:</p>\n\n<ol>\n<li>Compile your program with <code>-g</code> flag, e.g.: <code>gcc -g -Wall main.c -o prog</code></li>\n<li>Launch gdb: <code>gdb prog</code></li>\n<li>Set breakpoint(-s):</li>\n</ol>\n\n<pre class=\"lang-sh prettyprint-override\"><code>gdb) b 36\nBreakpoint \n</code></pre>\n\n<ol start=\"4\">\n<li>Run your program: <code>(gdb) r</code></li>\n<li>Use <code>s</code> to step by step debug and <code>c</code> to continue to next breakpoint</li>\n</ol>\n\n<p>And you will easily discover the cause of your segmentation fault:</p>\n\n<pre><code>Program received signal SIGSEGV, Segmentation fault.\n0x000055555555526f in main () at main.c:39\n39                  if (names[i][w] != names[j][w]){\n</code></pre>\n\n<p>To see why exactly it segfaults you can print variables using <code>p %variable name%</code>:</p>\n\n<pre><code>(gdb) p i\n$1 = 1\n(gdb) p w\n$2 = 139115\n(gdb) p j\n$3 = 0\n(gdb) p same\n$4 = false\n</code></pre>\n\n<p>So the cause is obvious: <code>same ==false</code> condition make your <code>w</code> variable overflow.</p>\n"}], "owner": {"reputation": 39, "user_id": 12560832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b77da98eaad082dde7725ca111e1515a?s=128&d=identicon&r=PG&f=1", "display_name": "Dando", "link": "https://stackoverflow.com/users/12560832/dando"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 59399555, "answer_count": 1, "score": 0, "last_activity_date": 1576700916, "creation_date": 1576698802, "question_id": 59399159, "link": "https://stackoverflow.com/questions/59399159/segmentation-fault-core-dumped-with-strings", "title": "Segmentation fault (core dumped) with strings", "body": "<p>I must write a function which gets 30 names without repeated names and after that it prints random on name of this 30. But when I run the program after my second name I entered, I get Segmentation fault and I don't know why. Cause when I put the first name every thing is good.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;ctype.h&gt;\n#include &lt;stdbool.h&gt;\n\n#define SIZE 30  /*The size of the array of names*/\n#define MAX_L 21    /*The length of a name included  the ending 0*/\n#define REPEAT 10 /*The amount of getting a random name in the names list */\n\nchar names[SIZE][MAX_L];/* = { 0 } ; /*Global array for the names we get from the users*/\n\n/*Gives back a random name in an array nameslist*/\nchar * get_name(){\n    int random; /*the random index we get of the names list*/\n    char *r; /*the string name to return*/\n\n    random= rand()%SIZE; /*picks a random number from 0-29 */\n    r= names[random]; /*r points to the random name in the list*/\n    return r;\n}\n\n\n/*Gets from user 30 names without repeat and calls after that function get_names 10 times*/\nint  main(){\n    int i;  /*counter for array names list */\n    int j;  /*counter for array in the first inner loop to check if there are repeated names*/\n    int k;  /*counter for the repeat loop for random names*/\n    int w;  /*counter for the index of the character in the string */\n    bool same = true; /*says if two strings are the same or not*/\n\n    for (i=0; i&lt; SIZE; i++){  /*Gets from the user 30 names and initialize them in the array*/\n        printf(\"\\nPlease enter a name (repeated names forbidden until we'll get to 30 names)\\n\");\n        scanf(\"%s\", names[i]);\n\n       if (i&gt;0){\n       for (j=0; j&lt;i; j++){  /*checks if is a repeated name or not*/\n        for (w=0; w&lt; MAX_L || same ==false; w++){\n            if (names[i][w] != names[j][w]){\n                    if (names[i][w] &gt;= 'a' &amp;&amp; names[i][w] &lt;= 'z'){ \n                            if (names[i][w] - 32 != names[j][w]) \n                                same=false;}\n\n                else if (names[i][w] &gt;= 'A' &amp;&amp; names[i][w] &lt;= 'Z'){\n                            if (names[i][w] + 32 != names[j][w]) \n                                same=false;}\n            }\n        }   \n        if (same ==true){ /*repeated name*/\n             printf(\"\\nERROR! You already entered this name!\");\n             return 0;}     \n       }}\n       printf(\"\\nThe name you entered is: %s\\n\", names[i]);\n    }\n\n    for (k=0; k&lt;REPEAT; k++){ /*Calls the function get_name 10 times to get 10 random names from the array*/\n        printf(\"\\nThe random name you got from the list is: %s\", get_name());\n    }\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 7273, "user_id": 2193968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1beed39f2b04409ff584a0af1d59325c?s=128&d=identicon&r=PG", "display_name": "Jerry Jeremiah", "link": "https://stackoverflow.com/users/2193968/jerry-jeremiah"}, "edited": false, "score": 0, "creation_date": 1576699564, "post_id": 59399006, "comment_id": 104987698, "body": "Your version runs out of memory not because the numbers get big - that would just overflow the integers and produce the wrong numbers.  Why it runs out of memory is because C does not have tail recursion so every time a function is called a new stack frame is added to the stack.  But there is a maximum size allocated to stack and when you overflow that by making a million function calls you write over important stuff and everything crashes."}], "answers": [{"comments": [{"owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1576700223, "post_id": 59399293, "comment_id": 104987974, "body": "The C code is accessing and allocating the array quite wrong; it needs to make a 2^nbits * 2^mbits array; it makes a 2^nbits + 2^mbits, so randomly tromps on memory...."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "reply_to_user": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1576700410, "post_id": 59399293, "comment_id": 104988032, "body": "@mevets: It makes 2^(nbits + mbits) = 2^nbits * 2^mbits."}, {"owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1576700846, "post_id": 59399293, "comment_id": 104988204, "body": "sorry, you are right, but where it indexes into it by m&lt;&lt;n_storageBits, it needs to be bound m by 1 &lt;&lt; m_storageBits."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "reply_to_user": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 1, "creation_date": 1576701037, "post_id": 59399293, "comment_id": 104988271, "body": "@mevets: True, but it has the excuse that it will never finish computing nor produce a correct result for m \u2265 6 \u2013 the function grows too quickly :)"}], "tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 2, "last_activity_date": 1576700070, "last_edit_date": 1576700070, "creation_date": 1576699525, "answer_id": 59399293, "question_id": 59399006, "link": "https://stackoverflow.com/questions/59399006/ackermann-function-4-1-in-c-not-calculating-ackermann-with-caching/59399293#59399293", "title": "Ackermann Function (4, 1) in C Not Calculating - Ackermann with Caching", "body": "<blockquote>\n  <p>As I said, quite bold to ask someone to comb this and explain it to me but I am stumped. If not, I'd be happy just understanding why my simplified approach conks out at ack(4, 1) (which is quite demanding but I have a fairly modern ThinkPad).</p>\n</blockquote>\n\n<p>I\u2019ll use Python to illustrate, because it has a built-in dict type.</p>\n\n<pre><code>import sys\nsys.setrecursionlimit(16392)\n\ncache = {}\n\n\ndef ackermann(m, n):\n    if m == 0:\n        return (n + 1, 1)\n\n    if (m, n) in cache:\n        return cache[(m, n)]\n\n    if n == 0:\n        r = cache[(m, n)] = ackermann(m - 1, 1)\n        return r\n\n    r1, e1 = ackermann(m, n - 1)\n    r2, e2 = ackermann(m - 1, r1)\n    r = cache[(m, n)] = (r2, e1 + e2)\n    return r\n\n\nprint(ackermann(4, 1))\n</code></pre>\n\n<p>The code is a bit of a mess \u2013 simplifying with <code>functools.lru_cache</code> runs afoul of the C stack on my platform \u2013 but the important thing is that it evaluates A(4, 1) <em>and</em> keeps track of how many calls to <code>ackermann</code> it would have produced without the cache.</p>\n\n<blockquote>\n  <p>(65533, 1431459240)</p>\n</blockquote>\n\n<p>1,431,459,240 is a lot of calls, even for a fairly modern ThinkPad.</p>\n\n<p>As for the C code: it\u2019s doing the same thing, keeping a mapping of (m, n) to A(m, n) to avoid the blowup in number of calls, but because C doesn\u2019t have a built-in hash table, it keeps things simple by using one big block of memory as a two-dimensional array, where each index\u2019s least significant <code>n_storageBits</code> bits represent n and the rest represent m. That\u2019s what the bit shifting does.</p>\n\n<ul>\n<li>A(4, 1) is evaluated</li>\n<li>(4, 1) is converted to an index in such a way that every supported (M, N) pair produces a distinct result, in this case with 2<sup>b</sup> M + N with b chosen such that N &lt; 2<sup>b</sup> for any supported N</li>\n<li>The index is used to look up and store the result in an array with size 2<sup>b</sup> M + N + 1 for the maximum supported M.</li>\n</ul>\n"}], "owner": {"reputation": 145, "user_id": 11632419, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--qO8ukQL0Mk/AAAAAAAAAAI/AAAAAAAAERc/m1SX-Oh8lXw/photo.jpg?sz=128", "display_name": "Rowan", "link": "https://stackoverflow.com/users/11632419/rowan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "accepted_answer_id": 59399293, "answer_count": 1, "score": 1, "last_activity_date": 1576700070, "creation_date": 1576697894, "question_id": 59399006, "link": "https://stackoverflow.com/questions/59399006/ackermann-function-4-1-in-c-not-calculating-ackermann-with-caching", "title": "Ackermann Function (4, 1) in C Not Calculating - Ackermann with Caching", "body": "<p>After using high-level languages for a while to get work done (MATLAB, R) I've recently become quite interested in C, and am using it to try and understand the interaction between software and hardware a little better.\nI wrote out quite a simple recursive function to compute Ackermann:</p>\n\n<pre><code>int ackermann(int m, int n)\n{\n    if (m == 0)\n    {\n        return n + 1;\n    }\n\n    if (m &gt; 0 &amp;&amp; n == 0)\n    {\n        return ackermann((m - 1), 1);\n    }\n\n    if (m &gt; 0 &amp;&amp; n &gt; 0)\n    {\n        return ackermann((m - 1), ackermann(m, (n - 1)));\n    }\n}\n</code></pre>\n\n<p>(with a loop for <code>m</code> and <code>n</code> in <code>main</code>, of course) which works for values up to (4, 1). I know this is quite a large value and it is not feasible to calculate beyond this. I added some print statements to my driver loop to figure out what is happening:</p>\n\n<pre><code> for (int m = 0; m &lt; 5; m++)\n    {\n        for (int n = 0; n &lt; (6 - m); n++)\n        {\n            printf(\"\\nCalculating Ackermann of (%d, %d)...\\n\", m, n);\n            printf(\"Ackermann(%d, %d) = %d \\n\", m, n, ackermann(m, n));\n        }\n    }\n</code></pre>\n\n<p>It sits at <code>Calculating Ackermann of (4, 1)...</code> for around 5 seconds or so and then the program stops. It doesn't seem to be gobbling up memory although I can't say for sure that it isn't running out of resources.</p>\n\n<p>I went to find a solution and stumbled upon this code on a website named RosettaCode.com. The author states that it caches some known values to allow some larger values to be calculated.</p>\n\n<p>Quite audacious, but could anybody explain what this is doing? I have seen the left bit-shift <code>&lt;&lt;</code> before, I'm aware that <code>malloc</code> is for dynamic memory allocation (so I assume this is handling the array of pre-cached variables?) but the <code>storage_bits</code> have just completely baffled me (I'm interested in, but not familiar with this low-level stuff). </p>\n\n<pre><code>// Ackermann function with caching - Understand how the bit-shift works?\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;time.h&gt;\n\nint m_storageBits = 0;\nint n_storageBits = 0;\nint *valCache;\n\nlong int ackFunc(int m, int n)\n{\n    int cacheIndex = 0;\n    int ackResult  = 0;\n\n    if(!m)\n    {\n        return (n + 1);\n    }\n    if (n &gt;= 1 &lt;&lt; n_storageBits)\n    {\n        printf(\"%d, %d\\n\", m, n);\n        cacheIndex = 0;\n    } else {\n        cacheIndex = (m &lt;&lt; n_storageBits) + n;\n        if (valCache[cacheIndex])\n        {\n            return valCache[cacheIndex];\n        }\n    }\n\n    if (!n)\n    {\n        ackResult = ackFunc((m - 1), 1);\n    } else {\n        ackResult = ackFunc((m - 1), ackFunc(m, n - 1));\n    }\n\n    if (cacheIndex)\n    {\n        valCache[cacheIndex] = ackResult;\n        return ackResult;\n    }\n\n    return 0;\n}\n\nint main()\n{\n    int m = 0;\n    int n = 0;\n\n    // Specify value size that may be saved\n    m_storageBits = 3;\n    m_storageBits = 20;   // 2**20, ~1 megabyte\n\n    valCache = malloc(sizeof(int) * (1 &lt;&lt; (m_storageBits + n_storageBits)));\n        printf(\"\\nValue cache before memset: %i\", valCache);\n    memset(valCache, 0, sizeof(int) * (1 &lt;&lt; (m_storageBits + n_storageBits)));\n        printf(\"\\nValue cache after memset: %i\", valCache);\n\n    for (m = 0; m &lt;= 4; m++)\n    {\n        for (n = 0; n &lt;= 6 - m; n++)\n        {\n            printf(\"\\nCalculating Ackermann of (%d, %d)...\\n\", m, n);\n            printf(\"Ackermann(%d, %d) = %d\\n\", m, n, ackFunc(m, n));\n        }\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>As you can see I added some print statements around the <code>memset</code> but the values appear the same. I tried a few different formats but I'm honestly not sure how, or even if, I can output this properly. I've changed some of the syntax and replaced the completely unhelpful one- or three-character variable names with some more useful descriptors based on what I can understand from the code. </p>\n\n<p>As I said, quite bold to ask someone to comb this and explain it to me but I am stumped. If not, I'd be <strong>happy just understanding why my simplified approach conks out at ack(4, 1)</strong> (which is quite demanding but I have a fairly modern ThinkPad).</p>\n\n<p>Thanks! Help appreciated. </p>\n"}, {"tags": ["c", "loops", "if-statement", "arguments"], "comments": [{"owner": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "edited": false, "score": 2, "creation_date": 1576698495, "post_id": 59398964, "comment_id": 104987288, "body": "<code>int main(char **argv)</code> isn&#39;t a valid form for <code>main</code>. Did you want <code>int main(int argc, char **argv)</code> instead?"}], "answers": [{"tags": [], "owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "is_accepted": false, "score": 0, "last_activity_date": 1576702219, "creation_date": 1576702219, "answer_id": 59399802, "question_id": 59398964, "link": "https://stackoverflow.com/questions/59398964/could-you-help-me-understand-the-following-code/59399802#59399802", "title": "Could you help me understand the following code :", "body": "<p>Assuming you meant the standard:</p>\n\n<pre><code>int main(int argc, char **argv)\n</code></pre>\n\n<p><code>argv[1]</code> is a pointer to the first command line argument to the program. <code>*argv[1]</code> is then the first character of the argument, the same as <code>argv[1][0]</code>.</p>\n\n<p>Incrementing <code>argv[1]</code> makes it point to the next character of that argument.</p>\n\n<p>The <code>while (*argv[1])</code> test will fail when it gets to the null terminator of the string.</p>\n\n<p>So this code is looping over the characters in the first argument, and printing <code>a</code> whenever finds an <code>a</code> character in the argument.  If you run:</p>\n\n<pre><code>./a.out aardvark\n</code></pre>\n\n<p>it will print</p>\n\n<pre><code>aaa\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 12542030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c2cf1b5027b5030f47fc56bf80fc98?s=128&d=identicon&r=PG&f=1", "display_name": "syrow001", "link": "https://stackoverflow.com/users/12542030/syrow001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1576702219, "creation_date": 1576697687, "question_id": 59398964, "link": "https://stackoverflow.com/questions/59398964/could-you-help-me-understand-the-following-code", "title": "Could you help me understand the following code :", "body": "<p>is *argv[1] a way to go over all elements of an array</p>\n\n<pre><code>#include &lt;unistd.h&gt;\n\nint     main(char **argv)\n{\n\n    while (*argv[1])\n    {\n        if (*argv[1] == 'a')\n        {\n            write(1, \"a\", 1);\n            break;\n        }\n        argv[1]++;\n    }\n}\n</code></pre>\n\n<p>what about argv[1]++ : is it to add one to the address</p>\n"}, {"tags": ["c", "arrays"], "comments": [{"owner": {"reputation": 44000, "user_id": 535275, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Ft2Mw.jpg?s=128&g=1", "display_name": "Scott Hunter", "link": "https://stackoverflow.com/users/535275/scott-hunter"}, "edited": false, "score": 2, "creation_date": 1576696991, "post_id": 59398799, "comment_id": 104986651, "body": "Google &quot;pointer arithmetic&quot;."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 6, "creation_date": 1576697015, "post_id": 59398799, "comment_id": 104986660, "body": "What is different? <code>sizeof(int)</code> is not equal to <code>1</code>."}, {"owner": {"reputation": 2310, "user_id": 9185253, "user_type": "registered", "profile_image": "https://graph.facebook.com/114451586026362/picture?type=large", "display_name": "Maestro", "link": "https://stackoverflow.com/users/9185253/maestro"}, "edited": false, "score": 0, "creation_date": 1576697257, "post_id": 59398799, "comment_id": 104986746, "body": "Integers can be 2,4, bytes."}, {"owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 0, "creation_date": 1576697265, "post_id": 59398799, "comment_id": 104986752, "body": "Related: <a href=\"https://stackoverflow.com/q/381542/10077\">With arrays, why is it the case that <code>a[5]</code> == <code>5[a]</code>?</a>"}, {"owner": {"reputation": 37414, "user_id": 204883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba29060be0758fa6537ff3d768a91757?s=128&d=identicon&r=PG", "display_name": "Arkku", "link": "https://stackoverflow.com/users/204883/arkku"}, "edited": false, "score": 1, "creation_date": 1576697781, "post_id": 59398799, "comment_id": 104986970, "body": "Pointer arithmetic works in units of the type being pointed to, so <code>*(num + 1)</code> is <code>num[1]</code>, whereas <code>*(num + sizeof int)</code> overshoots it by <code>sizeof(int) - 1</code> elements."}, {"owner": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "edited": false, "score": 0, "creation_date": 1576698294, "post_id": 59398799, "comment_id": 104987192, "body": "Try: <code>printf(&quot;%d&quot;, *(int *)((char *)num + (sizeof(int)*1)));</code> Not sure if this breaks the strict aliasing rule though."}], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 3980558, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ve9D.jpg?s=128&g=1", "display_name": "Eyal Golan", "link": "https://stackoverflow.com/users/3980558/eyal-golan"}, "is_accepted": true, "score": 6, "last_activity_date": 1576698304, "last_edit_date": 1576698304, "creation_date": 1576697405, "answer_id": 59398904, "question_id": 59398799, "link": "https://stackoverflow.com/questions/59398799/c-get-element-on-place-without-parenthesis/59398904#59398904", "title": "C get element on place without parenthesis", "body": "<p>I understand you thought incrementing the pointer using <code>sizeof(int)</code> will get you to the next member in the array. However, this is not how it works:</p>\n\n<p>when you write:</p>\n\n<pre><code>printf(\"%d\", *(num + 1));\n</code></pre>\n\n<p>the pointer advances to the next member in the array (it is an int pointer and therefore when you increment it, it advances sizeof(int) (which is usually 4) bytes). But when you write:</p>\n\n<pre><code>printf(\"%d\", *(num + (sizeof(int)*1)));\n</code></pre>\n\n<p>you try to advance the pointer by 4 members (or 4*sizeof(int) bytes), which is out of the boundaries of your array.</p>\n"}, {"comments": [{"owner": {"reputation": 37414, "user_id": 204883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba29060be0758fa6537ff3d768a91757?s=128&d=identicon&r=PG", "display_name": "Arkku", "link": "https://stackoverflow.com/users/204883/arkku"}, "edited": false, "score": 1, "creation_date": 1576698601, "post_id": 59398972, "comment_id": 104987338, "body": "<code>sizeof int</code> is not necessarily 4, e.g., on a 64-bit system it could be 8, and there are even systems (such as DSPs) where <code>CHAR_BIT</code> is not 8, i.e., sizes are not in units of 8-bit bytes."}, {"owner": {"reputation": 71, "user_id": 9047883, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lqpZ7Z8mUHU/AAAAAAAAAAI/AAAAAAAADPY/A2RVqtLf0Hg/photo.jpg?sz=128", "display_name": "Ianau Andrei", "link": "https://stackoverflow.com/users/9047883/ianau-andrei"}, "reply_to_user": {"reputation": 37414, "user_id": 204883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba29060be0758fa6537ff3d768a91757?s=128&d=identicon&r=PG", "display_name": "Arkku", "link": "https://stackoverflow.com/users/204883/arkku"}, "edited": false, "score": 0, "creation_date": 1576766458, "post_id": 59398972, "comment_id": 105010922, "body": "Indeed, I see your point and you are right. I could&#39;ve express myself better."}, {"owner": {"reputation": 100407, "user_id": 16406, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/fadf252892475e9b177d5cd5e8b24145?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Dodd", "link": "https://stackoverflow.com/users/16406/chris-dodd"}, "edited": false, "score": 1, "creation_date": 1576873513, "post_id": 59398972, "comment_id": 105047873, "body": "The first C compiler I ever used (Aztec C/6502 on an Apple][) had sizeof(int) == 2..."}], "tags": [], "owner": {"reputation": 71, "user_id": 9047883, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lqpZ7Z8mUHU/AAAAAAAAAAI/AAAAAAAADPY/A2RVqtLf0Hg/photo.jpg?sz=128", "display_name": "Ianau Andrei", "link": "https://stackoverflow.com/users/9047883/ianau-andrei"}, "is_accepted": false, "score": 1, "last_activity_date": 1576697713, "creation_date": 1576697713, "answer_id": 59398972, "question_id": 59398799, "link": "https://stackoverflow.com/questions/59398799/c-get-element-on-place-without-parenthesis/59398972#59398972", "title": "C get element on place without parenthesis", "body": "<p>for <code>printf(\"%d\", *(num + (sizeof(int)*1)));</code> has \n<code>(sizeof(int)*1))</code> which is 4 [size of int = 4]. <code>num</code> is of type int pointer, which means that the addition <code>num + (sizeof(int)*1))</code> will get you to the fourth element of the array, which is out of bounds, because you initialized the array with just 3 elements.</p>\n"}, {"comments": [{"owner": {"reputation": 91, "user_id": 11772923, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1Nobj.jpg?s=128&g=1", "display_name": "Egodev", "link": "https://stackoverflow.com/users/11772923/egodev"}, "reply_to_user": {"reputation": 37414, "user_id": 204883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba29060be0758fa6537ff3d768a91757?s=128&d=identicon&r=PG", "display_name": "Arkku", "link": "https://stackoverflow.com/users/204883/arkku"}, "edited": false, "score": 0, "creation_date": 1576699848, "post_id": 59399029, "comment_id": 104987819, "body": "@Arkku yes, rigorously speaking, you are correct, thanks."}], "tags": [], "owner": {"reputation": 91, "user_id": 11772923, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1Nobj.jpg?s=128&g=1", "display_name": "Egodev", "link": "https://stackoverflow.com/users/11772923/egodev"}, "is_accepted": false, "score": 1, "last_activity_date": 1576699535, "last_edit_date": 1576699535, "creation_date": 1576698006, "answer_id": 59399029, "question_id": 59398799, "link": "https://stackoverflow.com/questions/59398799/c-get-element-on-place-without-parenthesis/59399029#59399029", "title": "C get element on place without parenthesis", "body": "<p>The operator <em>sizeof</em> gives the number of bytes needed for a given type. As such, this result will change depending on the type and machine, and will not be always equal to 1. For integers (32bit), generally, it will be 4 and you are trying to access <em>num[5]</em> which doesn't exist.</p>\n\n<p>You can find more about <em>sizeof</em> for different types <a href=\"https://en.wikibooks.org/wiki/C%2B%2B_Programming/Programming_Languages/C%2B%2B/Code/Keywords/sizeof\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 435, "user_id": 11455772, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3igl9y_OX-E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rce1slUOfzNzFk1wXaxEZ8Js0sa-g/mo/photo.jpg?sz=128", "display_name": "gal leshem", "link": "https://stackoverflow.com/users/11455772/gal-leshem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 59398904, "answer_count": 3, "score": 0, "last_activity_date": 1577137186, "creation_date": 1576696901, "last_edit_date": 1577137186, "question_id": 59398799, "link": "https://stackoverflow.com/questions/59398799/c-get-element-on-place-without-parenthesis", "title": "C get element on place without parenthesis", "body": "<p>I created array:</p>\n\n<pre><code>int main()\n{\n    int num[3] = {1, 2, 3}\n    return 0;\n}\n</code></pre>\n\n<p>I want to get element in place 1.</p>\n\n<p>Why can not I get the element by this code?</p>\n\n<pre><code>printf(\"%d\", *(num + (sizeof(int)*1)));\n</code></pre>\n\n<p>What is the different to this?</p>\n\n<pre><code>printf(\"%d\", *(num + 1));\n</code></pre>\n"}, {"tags": ["c", "shell", "signals", "jobs", "keyboardinterrupt"], "comments": [{"owner": {"reputation": 101, "user_id": 12123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be4a1a7749f4659e6afd61181f3a6f67?s=128&d=identicon&r=PG&f=1", "display_name": "G89_Cl215", "link": "https://stackoverflow.com/users/12123600/g89-cl215"}, "edited": false, "score": 0, "creation_date": 1576699136, "post_id": 59398765, "comment_id": 104987543, "body": "The wierdest part is that it seems to come specifically from &quot;ls -R /&quot;: I can launch 10 times the &quot;yes&quot; command and stop it without any problem but as soon as ls comes around, any subsequent yes it unstoppable."}, {"owner": {"user_type": "does_not_exist", "display_name": "user12531529"}, "edited": false, "score": 0, "creation_date": 1576702429, "post_id": 59398765, "comment_id": 104988757, "body": "Sorry, I haven&#39;t touched C for 3 years, but I made the same shell project and in mine there is no problem you are dealing with. Maybe the working implementation will give you an idea, maybe it won&#39;t. If you&#39;re brave enough to dig into someone&#39;s else code, you&#39;re welcome <a href=\"https://github.com/artem-bondar/system-operating-shell\" rel=\"nofollow noreferrer\">here</a>."}], "owner": {"reputation": 101, "user_id": 12123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be4a1a7749f4659e6afd61181f3a6f67?s=128&d=identicon&r=PG&f=1", "display_name": "G89_Cl215", "link": "https://stackoverflow.com/users/12123600/g89-cl215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576696744, "creation_date": 1576696744, "question_id": 59398765, "link": "https://stackoverflow.com/questions/59398765/sigtstp-isnt-caught-by-child-processes", "title": "SIGTSTP isn&#39;t caught by child processes", "body": "<p>I am working on a shell project in C, and more specifically on the job control aspect of it. I am on the late testing bits and here is what is happening to me :</p>\n\n<p>I am creating foreground jobs that I want to stop thanks to ctrl-Z (or to interrupt with Ctrl-C ; I get exactly the same behaviour) and I am testing this behaviour on long commands such as \"ls -R /\".</p>\n\n<p>The first time I suspend the job works just fine : I get my input back, I see the suspended job in my job list, etc..</p>\n\n<p>Then, I try launching a second \"ls -R /\" (with the first one still stopped), but this time I can't stop it ; And I can't seem to know why...</p>\n\n<p>The job is in the foreground of the terminal (checked with the \"ps -o state\" command), it catches the SIGTSTP signal if I hard code a kill(SIGTSTP) in the parent shell (but it doesn't catch a \"kill -TSTP [pid_of_child]\" command sent from another shell), I can see the Ctrl-Z I am typing in my terminal when I do, but it just wont stop. It seems like the first ls call toggles something that blocks the signal handlers.</p>\n\n<p>It also seems like this behaviour may happen after a random number of calls to \"ls -R /\" (its not always the second call that is unstoppable, though it often is).</p>\n\n<p>For obvious reasons I am not posting all of the code of 42sh here. Alltough here are a few bits :</p>\n\n<pre><code>void                    ft_set_child_signal(int shell_pid)\n{\n\nsigset_t                wakeup_sig;\nstruct sigaction        action;\n\nft_bzero(&amp;action, sizeof(sigaction));\naction.sa_handler = &amp;ft_catch_sigusr1;\nsigaction(SIGUSR1, &amp;action, NULL);\n\nsigfillset(&amp;wakeup_sig); // is here for synchronicity of multi-process jobs.\nsigdelset(&amp;wakeup_sig, SIGUSR1); //same\nkill(shell_pid, SIGUSR1); //same\nsigsuspend(&amp;wakeup_sig); //same\nsignal(SIGCONT, SIG_DFL);\nsignal(SIGINT, SIG_DFL);\nsignal(SIGQUIT, SIG_DFL);\nsignal(SIGTSTP, SIG_DFL); // is reset to default in child while SIG_IGN in parent\nsignal(SIGTTIN, SIG_DFL);\nsignal(SIGTTOU, SIG_DFL);\nsignal(SIGUSR1, SIG_IGN);\nsignal(SIGUSR2, SIG_IGN);\n}\n</code></pre>\n\n<p>Of course, after that ft_set_child_signal function, I will call execve (which might reset the behaviour of signals ? Or so I read). I made sure all child process are fork from the shell directly. This is how I wait for childs in the parent:</p>\n\n<pre><code>int             ft_wait_foreground(t_job* job)\n{\nsigset_t        wakeup_sig;\n\ntcsetpgrp(STDIN_FILENO, job-&gt;pgid);\nsigfillset(&amp;wakeup_sig);\nsigdelset(&amp;wakeup_sig, SIGCHLD);\nkillpg(job-&gt;pgid, SIGUSR1);\nft_dprintf(2, \"Job in foreground: %i\\n\", tcgetpgrp(0));\nwhile (ISRUNNING(job-&gt;status))\n        sigsuspend(&amp;wakeup_sig);\ntcsetpgrp(STDIN_FILENO, getpid());\nif (WIFSTOPPED(job-&gt;status))\n        return (job-&gt;status);\nreturn (((t_process*)(job-&gt;process-&gt;content))-&gt;status);\n}\n\nvoid            ft_sigchld_handler(int nbr)\n{\nint                     ret_status;\nint                     pid;\nt_job           *job;\nt_process       *process;\n\n(void)nbr;\nwhile ((pid = waitpid(-1, &amp;ret_status, WUNTRACED | WNOHANG)) &gt; 0)\n{\nft_dprintf(2, \"handler: wait caught pid: %i\\n\", pid);\n        if ((job = ft_get_job_pgid(pid)))\n        {\n                job-&gt;status = ret_status | (BACKGROUND &amp;job-&gt;status);\n                process = ft_get_process_from_job(job, pid);\n        }\n        else if (!(process = ft_get_process_pid(pid)))\n                continue ;\n        ft_dprintf(2, \"handler: process updated: %i\\n\", ret_status);\n        process-&gt;status = ret_status;\n}\nft_update_job_status();\n}\n</code></pre>\n\n<p>If you see any errors or have any idea concerning my problem, let me know (I am also taking any advice :)</p>\n"}, {"tags": ["c", "gcc", "scanf", "undefined-behavior"], "comments": [{"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 2, "creation_date": 1576693317, "post_id": 59398025, "comment_id": 104985136, "body": "<code>int</code> is not a <code>long</code>.  Change declaration to <code>long int var1</code>, etc."}, {"owner": {"reputation": 19, "user_id": 10427111, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tnDW2ZeFPNM/AAAAAAAAAAI/AAAAAAAAA5o/KuiuST32WZ4/photo.jpg?sz=128", "display_name": "Hyunyoung Go", "link": "https://stackoverflow.com/users/10427111/hyunyoung-go"}, "reply_to_user": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 0, "creation_date": 1576693429, "post_id": 59398025, "comment_id": 104985178, "body": "I already know how to figure out this one. I wonder the reason why var2 assigned correctly but var1 does not."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 2, "creation_date": 1576693452, "post_id": 59398025, "comment_id": 104985185, "body": "This is because you should use <code>%d</code> format to match <code>int</code>. Also, please don&#39;t check the return value from <code>scanf</code> with <code>!</code> but with the number of conversions expected: <code>if(scanf(&quot;%d %d&quot;, &amp;var1, &amp;var2) != 2)</code>"}, {"owner": {"reputation": 19, "user_id": 10427111, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tnDW2ZeFPNM/AAAAAAAAAAI/AAAAAAAAA5o/KuiuST32WZ4/photo.jpg?sz=128", "display_name": "Hyunyoung Go", "link": "https://stackoverflow.com/users/10427111/hyunyoung-go"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1576693711, "post_id": 59398025, "comment_id": 104985297, "body": "@WeatherVane Could you explain more detail? If just incorrect then, both of them should not be assigned. But it&#39;s not."}, {"owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "edited": false, "score": 0, "creation_date": 1576694156, "post_id": 59398025, "comment_id": 104985495, "body": "@HyunyoungGo that leads to <a href=\"https://stackoverflow.com/questions/16864552/what-happens-when-i-use-the-wrong-format-specifier\">Undefined Behavior</a>, please see my answer, where I merged Weather Vane&#39;s and Mark Ronson&#39;s comment."}], "answers": [{"comments": [{"owner": {"reputation": 269328, "user_id": 5987, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/2a1f9f4986b58015691eb2014e78869f?s=128&d=identicon&r=PG", "display_name": "Mark Ransom", "link": "https://stackoverflow.com/users/5987/mark-ransom"}, "edited": false, "score": 6, "creation_date": 1576693886, "post_id": 59398122, "comment_id": 104985379, "body": "The key point left unsaid is that using a format that doesn&#39;t agree with the variable types leads to undefined behavior. Trying to make sense of anything after that is worthless."}, {"owner": {"reputation": 269328, "user_id": 5987, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/2a1f9f4986b58015691eb2014e78869f?s=128&d=identicon&r=PG", "display_name": "Mark Ransom", "link": "https://stackoverflow.com/users/5987/mark-ransom"}, "reply_to_user": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 1, "creation_date": 1576696961, "post_id": 59398122, "comment_id": 104986631, "body": "@R.. even that is subject to change with different compiler versions.  Trying to reason about undefined behavior is a good way to drive yourself crazy."}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "reply_to_user": {"reputation": 269328, "user_id": 5987, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/2a1f9f4986b58015691eb2014e78869f?s=128&d=identicon&r=PG", "display_name": "Mark Ransom", "link": "https://stackoverflow.com/users/5987/mark-ransom"}, "edited": false, "score": 0, "creation_date": 1576703569, "post_id": 59398122, "comment_id": 104989153, "body": "@MarkRansom: For exploits you just need to know what your target compiled it with. Which is easy if they&#39;re using a mainstream binary distro."}], "tags": [], "owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "is_accepted": true, "score": 7, "last_activity_date": 1576694112, "last_edit_date": 1576694112, "creation_date": 1576693666, "answer_id": 59398122, "question_id": 59398025, "link": "https://stackoverflow.com/questions/59398025/scanf-integer-with-ld-ld-is-not-work-correctly/59398122#59398122", "title": "scanf integer with %ld %ld is not work correctly", "body": "<p>The format specifier <code>%ld</code> is for <code>long int</code> (and <code>%lld</code> for <code>long long int</code>).</p>\n\n<p><code>int</code> should be matched with the <code>%d</code> format specifier.  Using a format specifier that does <em>not</em> agree with the variable types leads to <strong>Undefined Behavior.</strong></p>\n\n<p>Don't check the return value from scanf with the <code>!</code> operator but with the number of conversions expected instead, like this:</p>\n\n<pre><code>if(scanf(\"%d %d\", &amp;var1, &amp;var2) != 2)\n  printf(\"--- ERROR\\n\");\n</code></pre>\n\n<p><strong>Further Reading</strong><br>\n<a href=\"https://stackoverflow.com/questions/16864552/what-happens-when-i-use-the-wrong-format-specifier\">What happens when I use the wrong format specifier?</a></p>\n"}], "owner": {"reputation": 19, "user_id": 10427111, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tnDW2ZeFPNM/AAAAAAAAAAI/AAAAAAAAA5o/KuiuST32WZ4/photo.jpg?sz=128", "display_name": "Hyunyoung Go", "link": "https://stackoverflow.com/users/10427111/hyunyoung-go"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 0, "accepted_answer_id": 59398122, "answer_count": 1, "score": 1, "last_activity_date": 1576694112, "creation_date": 1576693246, "last_edit_date": 1576693980, "question_id": 59398025, "link": "https://stackoverflow.com/questions/59398025/scanf-integer-with-ld-ld-is-not-work-correctly", "title": "scanf integer with %ld %ld is not work correctly", "body": "<p>I'm using gcc 4.4.7.</p>\n\n<p>When I run below simple logic(C lang).</p>\n\n<p>Then inputted '1 2'.</p>\n\n<pre><code> int var1 = 0; \n int var2 = 0;\n\n if(!scanf(\"%ld %ld\",&amp;var1, &amp;var2))\n {\n    printf(\"--- ERROR\\n\");\n }\n else\n {\n    printf(\"--- var1  [%ld] \\n\", var1);\n    printf(\"--- var2  [%ld] \\n\", var2);\n }\n</code></pre>\n\n<p>Result :\n--- var1 [0] \n--- var2 [2] </p>\n\n<p><strong>I already know %ld works for long int. What I realy want to know is how does scanf working in detail.</strong>\nThis happens when I try to scan 2 or more numbers.</p>\n"}, {"tags": ["c", "date", "scanf"], "comments": [{"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 2, "creation_date": 1576692972, "post_id": 59397885, "comment_id": 104984977, "body": "How about reading the whole string and then using <code>strtok</code>?"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1576694877, "post_id": 59397885, "comment_id": 104985805, "body": "If you&#39;re going to read data into these buffers there&#39;s no reason to pre-initialize them. Also since these are numbers you don&#39;t need to declare <code>char</code> buffers. Just use the original buffer, tokenize, and convert."}], "answers": [{"comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1576693256, "post_id": 59397958, "comment_id": 104985108, "body": "I think this stems from a frequent misunderstanding that the string set format specifier is <code>%s[]</code> or <code>%[]s</code> when, as you show, it should be <code>%[]</code>."}, {"owner": {"reputation": 3918, "user_id": 2774842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mR91F.jpg?s=128&g=1", "display_name": "Unn", "link": "https://stackoverflow.com/users/2774842/unn"}, "edited": false, "score": 0, "creation_date": 1576693450, "post_id": 59397958, "comment_id": 104985183, "body": "For safety, you should probably use <code>%2[^&#47;]</code> and <code>%2s</code> to avoid overrunning the buffer."}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "reply_to_user": {"reputation": 3918, "user_id": 2774842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mR91F.jpg?s=128&g=1", "display_name": "Unn", "link": "https://stackoverflow.com/users/2774842/unn"}, "edited": false, "score": 0, "creation_date": 1576694252, "post_id": 59397958, "comment_id": 104985541, "body": "@Unn Good call.  Updated."}, {"owner": {"reputation": 29, "user_id": 9711169, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-fyWcnJpp3ys/AAAAAAAAAAI/AAAAAAAABPM/-40EXyRQl5s/photo.jpg?sz=128", "display_name": "Nathaniel King", "link": "https://stackoverflow.com/users/9711169/nathaniel-king"}, "edited": false, "score": 0, "creation_date": 1576695611, "post_id": 59397958, "comment_id": 104986122, "body": "@dbush thanks that&#39;s amazing. It&#39;s so complicated and I&#39;m still trying to get my head around it but it works amazingly."}, {"owner": {"reputation": 1599, "user_id": 9948091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JANyt.png?s=128&g=1", "display_name": "HAL9000", "link": "https://stackoverflow.com/users/9948091/hal9000"}, "edited": false, "score": 0, "creation_date": 1576709344, "post_id": 59397958, "comment_id": 104991153, "body": "Since you are reading a response to a prompt from <code>stdin</code>, it may be a good idea to read, and ignore, the rest of the line. This gets rid of whitespace and stuff that couldn&#39;t be parsed, and puts <code>stdin</code> in a &quot;clean&quot; state for the next read."}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 5, "last_activity_date": 1576694243, "last_edit_date": 1576694243, "creation_date": 1576692974, "answer_id": 59397958, "question_id": 59397885, "link": "https://stackoverflow.com/questions/59397885/entering-date-as-a-char-in-c-cant-work-out-how-to-avoid-the/59397958#59397958", "title": "Entering date as a char in C, can&#39;t work out how to avoid the /", "body": "<p>The first <code>%s</code> in your format string is capturing everything up to the first whitespace character, which is your whole date string.  The <code>[^/]</code> the immediately proceeds it it matching exact characters.</p>\n\n<p>What you want is to use the <code>%[</code> format specifier to grab characters up to a <code>/</code>.</p>\n\n<pre><code>scanf(\"%2[^/]%*c%2[^/]%*c%4s\", &amp;day, &amp;month, &amp;year);\n</code></pre>\n\n<p>Also note the inclusion of a field width to each to prevent writing past the end of the given buffers.</p>\n"}], "owner": {"reputation": 29, "user_id": 9711169, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-fyWcnJpp3ys/AAAAAAAAAAI/AAAAAAAABPM/-40EXyRQl5s/photo.jpg?sz=128", "display_name": "Nathaniel King", "link": "https://stackoverflow.com/users/9711169/nathaniel-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 59397958, "answer_count": 1, "score": 2, "last_activity_date": 1576694243, "creation_date": 1576692636, "question_id": 59397885, "link": "https://stackoverflow.com/questions/59397885/entering-date-as-a-char-in-c-cant-work-out-how-to-avoid-the", "title": "Entering date as a char in C, can&#39;t work out how to avoid the /", "body": "<pre><code>#include &lt;stdio.h&gt;\n\nint main(void)\n{\n    char day[3] = {\"\"};\n    char month[3] = {\"\"};\n    char year[5] = {\"\"};\n\n    printf(\"Date of Birth: \");\n    scanf(\"%s[^/]%*c%s[^/]%*c%s\", &amp;day, &amp;month, &amp;year);\n    printf(\"\\n1. %s\", day);\n    printf(\"\\n2. %s\", month);\n    printf(\"\\n3. %s\", year);\n}\n</code></pre>\n\n<p>I'm trying to enter the date and discarding the <code>/</code>.  Currently, the whole entry gets stored into char day[3] and the other three chars are left blank. </p>\n\n<p>I am using char because I want to keep the leading zeros and I am using the strings to make a file name without the <code>/</code>. </p>\n"}, {"tags": ["c", "arrays", "pointers", "multidimensional-array", "reference"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1576688939, "post_id": 59396886, "comment_id": 104983113, "body": "I would translate &quot;2d-array of pointers to characters&quot; as an array of arrays (the &quot;2d-array part) of pointers to <code>char</code>. I.e. an array of arrays of string-pointers, e.g. <code>char *array[DIM1][DIM2]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 0, "creation_date": 1576694376, "post_id": 59398058, "comment_id": 104985605, "body": "Do you intend to answer the part of the question having to do with <code>3D</code> arrays?  (i.e. for example <code>char *array[m][n];</code>"}, {"owner": {"reputation": 166, "user_id": 9166558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/478cc3ab8ce513fa5e43f931f104cd7a?s=128&d=identicon&r=PG&f=1", "display_name": "T W Bennet", "link": "https://stackoverflow.com/users/9166558/t-w-bennet"}, "edited": false, "score": 0, "creation_date": 1576778045, "post_id": 59398058, "comment_id": 105016779, "body": "Worth noting that, while the suggestion compiles in plain C, the argument of the call to fill does not actually match the parameter type.  The matching parameter type is the very peculiar char (*p)[N], which is then not compatible with the existing function body.  Multi-dimension arrays in C are very strange."}], "tags": [], "owner": {"reputation": 12724, "user_id": 12139179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a50aa08ca41bf24e8478a9b4dbc067c3?s=128&d=identicon&r=PG&f=1", "display_name": "RobertS supports Monica Cellio", "link": "https://stackoverflow.com/users/12139179/roberts-supports-monica-cellio"}, "is_accepted": false, "score": 0, "last_activity_date": 1576697529, "last_edit_date": 1576697529, "creation_date": 1576693394, "answer_id": 59398058, "question_id": 59396886, "link": "https://stackoverflow.com/questions/59396886/how-to-declare-define-and-call-a-functions-in-c-program-which-have-to-1fill/59398058#59398058", "title": "How to declare, define, and call a functions in C program which have to 1)&quot;fill&quot; the 3D-array and 2)&quot;read&quot; the 3D-array of characters", "body": "<p>I would like to first leave this whole mess of questions and concentrate on the task you want to do. </p>\n\n<p>You have given several examples for operations with functions, to operate with an three-dimensional array. I will choose the option to fill an array with values by the use of <code>scanf()</code> as example.</p>\n\n<p>What i would do is just give a pointer to the 3D array as function argument. </p>\n\n<p>The declaration/prototype for this function would be:</p>\n\n<p><code>void fill(char *p);</code></p>\n\n<p>Furthermore, i would increase that pointer inside the function, plus use this increased pointer in loops to fill all elements:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nconst int M = 3;\nconst int N = 3;\n\nint main(void)\n{\n    char a[M][N];\n    fill(a);\n\n    return 0;\n}\n\nvoid fill(char *p)\n{\n    int i,j;\n\n    for(i = 0, j = 0; i &lt; ( M * N ); i++,j++)\n    {\n      if(j == M)\n      { \n          printf(\"\\n\");\n          j = 0;\n      }\n\n      scanf(\"%c\",(p + i));\n    }\n}\n</code></pre>\n\n<p>For the other questions, I would recommend that you ask separate questions for each to get more answers and to get an answer which is most appropriate for its special case. </p>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 12559754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b66e5ba42bf8696cee0dc8718d7471a8?s=128&d=identicon&r=PG&f=1", "display_name": "Mk Kvease", "link": "https://stackoverflow.com/users/12559754/mk-kvease"}, "edited": false, "score": 0, "creation_date": 1576836889, "post_id": 59398455, "comment_id": 105033237, "body": "That is a gold explanation, thank you very much!!! I&#39;ve got something from it(to get all I need more time..) and made some working code, I&#39;ve just added it to the topic."}], "tags": [], "owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "is_accepted": true, "score": 0, "last_activity_date": 1576695279, "creation_date": 1576695279, "answer_id": 59398455, "question_id": 59396886, "link": "https://stackoverflow.com/questions/59396886/how-to-declare-define-and-call-a-functions-in-c-program-which-have-to-1fill/59398455#59398455", "title": "How to declare, define, and call a functions in C program which have to 1)&quot;fill&quot; the 3D-array and 2)&quot;read&quot; the 3D-array of characters", "body": "<p>A \"pointer to T\" can be used to point to a single T variable or to point to the first element of an array of T. All elements of the array of T can be accessed via the pointer.</p>\n\n<pre><code>T a;\nT arr[3];  // Array [3] of T\nT *pa = &amp;a; // Pointer to T\nT *parr = &amp;arr[0]; // Pointer to T. Equivalent initializer: T *parr = arr;\n\n*pa = foo;     // will set a = foo;\nparr[2] = bar; // will set arr[2] = bar;\n</code></pre>\n\n<p><code>pa</code> and <code>parr</code> are both of type \"pointer to T\".</p>\n\n<p>A \"2-D array of T\" is an \"array of array of T\":</p>\n\n<pre><code>T aa[4][3]; // Array [4] of array [3] of T\n\naa[0][1] = foo;\n</code></pre>\n\n<p>An \"array of pointers to T\" can be used to mimic a 2-D array of T. Each pointer element points to its own array of T which could be dynamically allocated as below:</p>\n\n<pre><code>T *ad[4]; // Array [4] of pointer to T\n\nfor (i = 0; i &lt; 4; i++) {\n    ad[i] = calloc(3, sizeof (T));\n}\n\nad[0][1] = foo;\n</code></pre>\n\n<p>A \"pointer to an array of T\" can be used to access elements of a 2-D array of T:</p>\n\n<pre><code>T aa[4][3]; // Array [4] of array [3] of T\nT (*paa)[3] = aa; // Pointer to array [3] of T. Equivalent initializer: T (*paa)[3] = &amp;aa[0];\n\npaa[0][1] = foo; // will set aa[0][1] = foo;\n</code></pre>\n\n<p>A \"pointer to pointer to T\" can be used to access the elements of an \"array of pointer to T\":</p>\n\n<pre><code>T arow0[3], arow1[3], arow2[3], arow3[3]; // Each is array [3] of T\nT *ad[4] = {arow0, arow1, arow2, arow3}; // Array [4] of pointer to T\nT **pad = &amp;ad[0]; // Pointer to pointer to T. Equivalent initializer: T **pad = ad;\n\npad[0][1] = foo; // will set ad[0][1] = foo; will set arow0[1] = foo;\n</code></pre>\n\n<p>A \"3-D array of T\" is an \"array of array of array of T\":</p>\n\n<pre><code>T aaa[4][3][2]; // Array [4] of array [3] of array [2] of T\n</code></pre>\n\n<p>A \"pointer to 2-D array of T\" is a \"pointer to array of array of T\", and can be used to access the elements of a 3-D array of T (of compatible dimensions):</p>\n\n<pre><code>T aaa[4][3][2]; // Array [4] of array [3] of array [2] of T\nT (*paaa)[3][2]; // Pointer to array [3] of array [2] of T\n\npaaa = aaa; // Equivalent: paaa = &amp;aaa[0];\npaaa[0][1][1] = foo; // will set aaa[0][1][[1] = foo;\n</code></pre>\n\n<p>A \"2-D array of pointers to T\" is an \"array of array of pointers to T\":</p>\n\n<pre><code>T arow00[2], arow01[2], arow02[2]; // Each is array [2] of T\nT arow10[2], arow11[2], arow12[2];\nT arow20[2], arow21[2], arow22[2];\nT arow30[2], arow31[2], arow32[2];\nT *app[4][3] = {\n      {arow00, arow01, arow02},\n      {arow10, arow11, arow12},\n      {arow20, arow21, arow22},\n      {arow30, arow31, arow32}\n    }; // Array [4] of array [3] of pointer to T\n\napp[0][1][1] = foo; // Will set arow01[1] = foo;\n</code></pre>\n\n<p>A \"pointer to pointer to pointer to T\" can be used to access the elements of an array of pointers to pointers to T:</p>\n\n<pre><code>T arow00[2], arow01[2], arow02[2]; // Each is array [2] of T\nT arow10[2], arow11[2], arow12[2];\nT arow20[2], arow21[2], arow22[2];\nT arow30[2], arow31[2], arow32[2];\nT *parow0[3] = { arow00, arow01, arow02 }; // Each is array [3] of pointer to T\nT *parow1[3] = { arow10, arow11, arow12 };\nT *parow2[3] = { arow20, arow21, arow22 };\nT *parow3[3] = { arow30, arow31, arow32 };\nT **ppa[4] = { parow0, parow1, parow2, parow3 }; // Array [4] of pointer to pointer to T\nT ***pppa = ppa; // Pointer to pointer to pointer to T;\n\npppa[0][1][1] = foo;\n// will set ppa[0][1][1] = foo;\n// will set parow0[1][1] = foo;\n// will set arow01[1] = foo; \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 12559754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b66e5ba42bf8696cee0dc8718d7471a8?s=128&d=identicon&r=PG&f=1", "display_name": "Mk Kvease", "link": "https://stackoverflow.com/users/12559754/mk-kvease"}, "edited": false, "score": 0, "creation_date": 1576837961, "post_id": 59415210, "comment_id": 105033745, "body": "Thank you, that&#39;s a valuable addition."}], "tags": [], "owner": {"reputation": 166, "user_id": 9166558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/478cc3ab8ce513fa5e43f931f104cd7a?s=128&d=identicon&r=PG&f=1", "display_name": "T W Bennet", "link": "https://stackoverflow.com/users/9166558/t-w-bennet"}, "is_accepted": false, "score": 0, "last_activity_date": 1576780429, "creation_date": 1576780429, "answer_id": 59415210, "question_id": 59396886, "link": "https://stackoverflow.com/questions/59396886/how-to-declare-define-and-call-a-functions-in-c-program-which-have-to-1fill/59415210#59415210", "title": "How to declare, define, and call a functions in C program which have to 1)&quot;fill&quot; the 3D-array and 2)&quot;read&quot; the 3D-array of characters", "body": "<p>Ian Abbott's answer is good.  To summarize a bit, an array name is a pointer to the first member, as always.  But only for one dimension.  So <code>int a[10]</code> is an array of <code>int</code> and becomes a pointer to <code>int</code>, written <code>int *</code>. The array <code>int a[10][20]</code> is an array of ten arrays of 20 <code>int</code>.  It becomes a pointer to an array of 20 <code>int</code>, written <code>int (*)[20]</code>, but not pointer to pointer to <code>int</code>.</p>\n\n<p>You also cannot leave out the extra sizes.  They are part of the type.  If you need to be able to write a function which takes any three-dimensional array, you're sunk.  You can use C++ and make a template.  In plain C, the usual is to declare your array as single-dimension and impose any dimensional structure by doing your own subscript arithmetic.</p>\n"}], "owner": {"reputation": 3, "user_id": 12559754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b66e5ba42bf8696cee0dc8718d7471a8?s=128&d=identicon&r=PG&f=1", "display_name": "Mk Kvease", "link": "https://stackoverflow.com/users/12559754/mk-kvease"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 59398455, "answer_count": 3, "score": 0, "last_activity_date": 1576837215, "creation_date": 1576688477, "last_edit_date": 1576837215, "question_id": 59396886, "link": "https://stackoverflow.com/questions/59396886/how-to-declare-define-and-call-a-functions-in-c-program-which-have-to-1fill", "title": "How to declare, define, and call a functions in C program which have to 1)&quot;fill&quot; the 3D-array and 2)&quot;read&quot; the 3D-array of characters", "body": "<p>I am a novice in C-programming and I need help from anyone who is familiar with 3D-arrays and can perform some changes on them by functions. \n All explanations, which I found on net, based on 2D-arrays. I can't understand them.</p>\n\n<p>I mean, I understand the basics of pointers, function prototypes(declarations), function definitions, and how to operate with 1D-arrays of data.</p>\n\n<p>I know that any function call can make a local copy or change a variable data in its physical storage, but I can't understand one thing. When you call function with <code>char *</code> type parameter(array), you always type it like \u2014 <code>void func_name(char * var_name)</code> \u2014 so, if you need to change the value, you type it in just like that, and when you have not to change \u2014 you add <code>const</code> before <code>char * var_name</code>. \n For parameters of <code>int</code> and <code>char</code>-types we have another rule: you have to add (de?)reference operator - <code>*</code> - in func prototype and its definition, if you want to change the variable data in storage, and you don't have to use it if there's no need of changing(\"take local copy\" command); and, you have to call a func with dereference operator <code>&amp;</code>, applied to parameter \u2014 for example <code>void func_name(&amp;var_name);</code> , if you have to change the variable data.</p>\n\n<p>Could you please explain how to behave properly when my task is to operate with 3D-arrays by specific functions \u2014 \"fill the first dimension\", \"fill the 3rd dimension\" \"read Nth dimension(local copy)\"-commands? How I have to write function prototypes to change and not to change the value of 3D-array? </p>\n\n<p><code>void func_name(char *array[][][])</code> \u2014 is that correct?</p>\n\n<p><code>void func_name( char *(***array) )</code> \u2014 or maybe like that?</p>\n\n<p>If I have to operate with elements in EACH dimension, do I have to prototype functions like this? :</p>\n\n<pre><code>void func_name( char *(*array), char *(**array), char *(***array) ) {. . .}\n</code></pre>\n\n<p>Is there any specific rules for <strong>calling</strong> 3D-array-operating functions? Or I just have to leave them like <code>func_name(var_name);</code> ?</p>\n\n<p>I've found some working code, which try to explain how to define a function with 2d-array as a parameter in it and how to call this function which just \"reads\" the 2d-array(takes local copy).\nBut this code doesn't make it clear for me how to perform another operation(\"fill\") with functions and how to write prototype properly. And, the example has only operations with <code>int</code>-type, but I need <code>char *</code>..\nThe code: </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nconst int M = 3;\nconst int N = 3;\n\nvoid print(int arr[M][N])\n{\n    int i, j;\n    for (i = 0; i &lt; M; i++)\n      for (j = 0; j &lt; N; j++)\n        printf(\"%d \", arr[i][j]);\n}\n\n\nint main()\n{\n    int arr[][3] = {{1, 2, 3}, {4, 5, 6}, {7, 8, 9}};\n    print(arr);\n    char answer[10];\n    printf(\"ok? : \");\n    scanf(\"%s\", answer);\n    return 0;\n}\n</code></pre>\n\n<p>And finally, I can't understand clearly what does these phrases mean: \"2d-array of pointers to characters\" , \"Pointer to 2D-array of characters\" ; and I can't understand contexts, where to use \"array of pointers\" and where to use \"pointer to array\". \nThe mess in my head is grown from the fact, that in function prototypes and definitions we use <code>(type-name) *</code> as a type always with array as a function argument.</p>\n\n<p>There are a lot of questions, so I will appreciate any help, thanks!</p>\n\n<p>EDIT 1:</p>\n\n<p>Guys, I've poked around for a while and got some working compilation, which resolves my task. Thanks everyone for the feedback, my solution is below.</p>\n\n<p>Solution:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nvoid find(int a, char *name, char *country, char *city, const char (*paaa)[4][100]);\nvoid fill( char (*paaa)[4][100] );\n\n// --------------------------------------------//\nint main()\n{\n  char name[100] = {0}, country[50] = {0}, city[50] = {0};\n\n  char array3D[100][4][100]; // 0 field is for name, 1 - for city, 2 - for country\n  char (*paaa)[4][100] = &amp;array3D[0]; // initialize the pointer 'paaa'\n\n  fill(paaa); // fills 12 entries with the same data in each field\n\n  printf(\"&gt; full array: \\n\");\n  printf(\"\\033[0;34m\"); // set text color to blue\n  for (int x = 0; x &lt; 12*4; x++) // each entry contains 4 fields of strings, so '12*4' here\n  {\n    printf(\"%s\", (*paaa)[x]);\n  }\n  printf(\"\\033[0m\"); // reset text color to default\n\n  int a = 0;\n  printf(\"&gt; input entry number(max:11): \");\n  scanf(\"%u\", &amp;a);\n  printf(\"\\n\");\n\n  find(a, name, country, city, paaa); // retrieve each field in variables\n\n  printf(\"ENTRY No. %u : \\n\\n\", a);\n  printf(\"&gt; Name - %s\\n\", name);\n  printf(\"&gt; City - %s\\n\", city);\n  printf(\"&gt; Country - %s\\n\", country);\n  printf(\"&gt; Good? : \");\n  scanf(\"%u\", &amp;a);\n  printf(\"&gt; Done.\\n\\n\");\n\n  return 0;\n}\n// --------------------------------------------//\n\n\nvoid fill( char (*paaa)[4][100] )\n{\n    char local_name[50] = { \" Jacob Goodman \\n\" };\n    char local_city[50] = { \" Melbourne \\n\" };\n    char local_country[50] = { \" Australia \\n\" };\n\n    int entries_amount = 12;\n    int en = 0, da = 0; //entry, data\n\n    for (en = 0; en &lt; entries_amount ; en++)\n    {\n\n          for ( da = 0; local_name[da] != '\\0'; da++)\n            {\n            paaa[en][0][da] = local_name[da];\n            }\n          for ( da = 0; local_city[da] != '\\0'; da++)\n            {\n            paaa[en][1][da] = local_city[da];\n            }\n          for ( da = 0; local_country[da] != '\\0'; da++)\n            {\n            paaa[en][2][da] = local_country[da];\n            }\n\n    }\n}\n\n// takes an entry number,\n// reads from 3D-array 3 fields of given entry\n// and saves each field to 3 global variables\nvoid find(int a, char *name, char *city, char *country, const char (*paaa)[4][100])\n{\n  int da = 0;\n  for ( da = 0; paaa[a][0][da] != '\\0'; da++)\n    {\n    name[da] = paaa[a][0][da];\n    }\n  for ( da = 0; paaa[a][1][da] != '\\0'; da++)\n    {\n    city[da] = paaa[a][1][da];\n    }\n  for ( da = 0; paaa[a][2][da] != '\\0'; da++)\n    {\n    country[da] = paaa[a][2][da];\n    }\n\n}\n</code></pre>\n"}, {"tags": ["c", "alsa"], "answers": [{"tags": [], "owner": {"reputation": 157205, "user_id": 11654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/586424ca0847070dc1868aa58077003e?s=128&d=identicon&r=PG", "display_name": "CL.", "link": "https://stackoverflow.com/users/11654/cl"}, "is_accepted": false, "score": 1, "last_activity_date": 1576706727, "creation_date": 1576706727, "answer_id": 59400592, "question_id": 59396728, "link": "https://stackoverflow.com/questions/59396728/how-to-properly-handle-xrun-in-alsa-programming-when-playing-audio-with-snd-pcm/59400592#59400592", "title": "How to properly handle xrun in ALSA programming when playing audio with snd_pcm_writei()?", "body": "<p>The best way to handle underruns is to avoid handling them by preventing them. This can be done by writing samples early enough before the buffers is empty. To do this,</p>\n\n<ul>\n<li>reorganize your program so that the new samples are already available to be written when you need to call <code>snd_pcm_write*()</code>, and/or</li>\n<li>increase the priority of your process/thread (if possible; this is probably not helpful if other programs interfere with your disk OI/O), and/or</li>\n<li>increase the buffer size (this also increases the latency).</li>\n</ul>\n\n<p>When an underrun happens, you have to decide what should happen with the samples that should have been played but were not written to the buffer at the correct time.</p>\n\n<ul>\n<li>To play these samples later (i.e., to move <em>all</em> following samples to a later time), configure the device so that an underrun stops it. (This is the default setting.) Your program has to restart the device when it has new samples.</li>\n<li><p>To continue with the following samples at the same time as if the missing samples had actually be played, configure the device so that an underrun does not stop it. This can be done by setting the stop threshold\u00b9 to the boundary value\u00b2. (Other errors, like unplugging a USB device, will still stop the device.)</p>\n\n<p>When an underrun does happen, the device will play those samples that happen to be in the ring buffer. By default, these are the old samples from some time ago, which will not sound correct. To play silence instead (which will not sound correct either, but in a different way), tell the device to clear each part of the buffer immediately after it has been played by setting the silence threshold\u00b3 to zero and the silence size\u2074 to the boundary value.</p></li>\n</ul>\n\n<p>To (try to) reinitialize a device after an error (an xrun or some other error), you could call either <code>snd_pcm_prepare()</code> or <code>snd_pcm_recover()</code>. The latter calls the former, and also handles a suspended device (by waiting for it to be resumed).</p>\n\n<p>\u00b9stop threshold: <code>snd_pcm_sw_params_set_stop_threshold()</code><br>\n\u00b2boundary value: <code>snd_pcm_sw_params_get_boundary()</code><br>\n\u00b3silence threshold: <code>snd_pcm_sw_params_set_silence_threshold()</code><br>\n\u2074silence size: <code>snd_pcm_sw_params_set_silence_size()</code></p>\n"}], "owner": {"reputation": 249, "user_id": 9042748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08cfeb52356fedfb1599961625e42dc8?s=128&d=identicon&r=PG&f=1", "display_name": "AlphaCentauri", "link": "https://stackoverflow.com/users/9042748/alphacentauri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1520, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1576706727, "creation_date": 1576687861, "question_id": 59396728, "link": "https://stackoverflow.com/questions/59396728/how-to-properly-handle-xrun-in-alsa-programming-when-playing-audio-with-snd-pcm", "title": "How to properly handle xrun in ALSA programming when playing audio with snd_pcm_writei()?", "body": "<p>I've tried multiple example programs that appear to have code to handle xruns under playback:</p>\n\n<p><a href=\"https://albertlockett.wordpress.com/2013/11/06/creating-digital-audio-with-alsa/\" rel=\"nofollow noreferrer\">https://albertlockett.wordpress.com/2013/11/06/creating-digital-audio-with-alsa/</a></p>\n\n<p><a href=\"https://www.linuxjournal.com/article/6735\" rel=\"nofollow noreferrer\">https://www.linuxjournal.com/article/6735</a> (listing 3)</p>\n\n<p>When using snd_pcm_writei(), it appears that when the return value is -EPIPE (which is xrun/underrun), they do:</p>\n\n<pre><code>if (rc == -EPIPE) {\n  /* EPIPE means underrun */\n  fprintf(stderr, \"underrun occurred\\n\");\n  snd_pcm_prepare(handle);\n}\n</code></pre>\n\n<p>I.e. call snd_pcm_prepare() on the handle.</p>\n\n<p>However, I still get stuttering when I attempt to run programs like these. Typically, I will get at least a few, to maybe half a dozen xrun, and then it will play smoothly and continuously without further xruns. However, if I have something else using the sound card, such as Firefox, I will get many more xruns, and sometimes only xruns. But again, even if I kill any other program that uses the sound card, I still experience the issue with some initial xruns and actual stuttering on the speakers.</p>\n\n<p>This is not acceptable for me, how can I modify this type of xrun handling to prevent stuttering?</p>\n\n<p>My own attempt at figuring this out:</p>\n\n<p>From the ALSA API, I see that snd_pcm_prepare() does:</p>\n\n<blockquote>\n  <p>Prepare PCM for use.</p>\n</blockquote>\n\n<p>This is not very helpful to an ALSA beginner like myself. It is not explained how this can be used to recover xrun issues.</p>\n\n<p>I also note, from: <a href=\"https://www.alsa-project.org/alsa-doc/alsa-lib/pcm.html\" rel=\"nofollow noreferrer\">https://www.alsa-project.org/alsa-doc/alsa-lib/pcm.html</a></p>\n\n<blockquote>\n  <p>SND_PCM_STATE_XRUN\n      The PCM device reached overrun (capture) or underrun (playback). You can use the -EPIPE return code from I/O functions\n  (snd_pcm_writei(), snd_pcm_writen(), snd_pcm_readi(), snd_pcm_readn())\n  to determine this state without checking the actual state via\n  snd_pcm_state() call. It is recommended to use the helper function\n  snd_pcm_recover() to recover from this state, but you can also use\n  snd_pcm_prepare(), snd_pcm_drop() or snd_pcm_drain() calls.</p>\n</blockquote>\n\n<p>Again, it is not clear to me. I can use snd_pcm_prepare() OR I can use these other calls? What is the difference? What should I use?</p>\n"}, {"tags": ["c++", "c", "gcc"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 2, "creation_date": 1576687856, "post_id": 59396641, "comment_id": 104982568, "body": "The <a href=\"https://linux.die.net/man/3/isunordered\" rel=\"nofollow noreferrer\">docs</a> are pretty clear about it,"}, {"owner": {"reputation": 1073, "user_id": 3763139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gkUYr.jpg?s=128&g=1", "display_name": "Sopel", "link": "https://stackoverflow.com/users/3763139/sopel"}, "edited": false, "score": 0, "creation_date": 1576687902, "post_id": 59396641, "comment_id": 104982595, "body": "also <a href=\"https://gcc.gnu.org/onlinedocs/gcc-3.3.6/gcc/Other-Builtins.html\" rel=\"nofollow noreferrer\">gcc.gnu.org/onlinedocs/gcc-3.3.6/gcc/Other-Builtins.html</a> &quot;GCC provides built-in versions of the ISO C99 floating point comparison macros that avoid raising exceptions for unordered operands. They have the same names as the standard macros ( isgreater, isgreaterequal, isless, islessequal, islessgreater, and isunordered) , with <i>_builtin</i> prefixed. We intend for a library implementor to be able to simply #define each standard macro to its built-in equivalent.&quot; That&#39;s not exactly about this, but the behaviour is equivalent."}], "owner": {"reputation": 1129, "user_id": 6319901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1fb677ce3a7ce11c93597c803c82fbda?s=128&d=identicon&r=PG&f=1", "display_name": "Dark Sorrow", "link": "https://stackoverflow.com/users/6319901/dark-sorrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "closed_date": 1576687832, "answer_count": 0, "score": 1, "last_activity_date": 1576687535, "creation_date": 1576687535, "question_id": 59396641, "link": "https://stackoverflow.com/questions/59396641/isless-vs-or-isgreater-vs", "closed_reason": "Duplicate", "title": "isless vs &lt; or isgreater vs &gt;", "body": "<p>Can  someone advice what is the difference between <code>isgreater(x,y)</code> and <code>&gt;</code> or <code>isless(x,y)</code> and <code>&lt;</code>.\nMy understanding is isless and similar function raise exception (C++).\nWhich is recommended to use?</p>\n\n<pre><code>#define isgreater(x,y) \\\n          (__extension__ ({__typeof__(x) __x = (x); __typeof__(y) __y = (y); \\\n                           !isunordered(__x,__y) &amp;&amp; (__x &gt; __y);}))\n#define isless(x,y) \\\n          (__extension__ ({__typeof__(x) __x = (x); __typeof__(y) __y = (y); \\\n                           !isunordered(__x,__y) &amp;&amp; (__x &lt; __y);}))\n</code></pre>\n"}, {"tags": ["c++", "c", "language-lawyer", "standards", "language-features"], "comments": [{"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 4, "creation_date": 1576686492, "post_id": 59396256, "comment_id": 104981804, "body": "C&#39;s <code>_Bool</code> type was inspired by C++&#39;s <code>bool</code> I believe."}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 2, "creation_date": 1576686740, "post_id": 59396256, "comment_id": 104981955, "body": "Being able to declare variables in other locations than at the very top of a function was also a C++ first, later adopted by C I think."}, {"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "reply_to_user": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1576686852, "post_id": 59396256, "comment_id": 104982019, "body": "@JesperJuhl Sure? This has been a feature of C much longer than most people think, and predates the first C++ standard."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 2, "creation_date": 1576686866, "post_id": 59396256, "comment_id": 104982026, "body": "I think function prototypes came from C++, IIRC."}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 2, "creation_date": 1576686909, "post_id": 59396256, "comment_id": 104982052, "body": "Not allowing &quot;implicit int&quot; as a function return type (except for <code>main()</code>) is (I think) also something that C++ pioneered and C subsequently adopted."}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "reply_to_user": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 0, "creation_date": 1576686981, "post_id": 59396256, "comment_id": 104982090, "body": "@Konrad Am I sure? No. I explicitly said &quot;I think&quot;. Which implies that I&#39;m <i>not</i> certain. I&#39;m going by my <i>memory</i> of reading the standards over the years, but I have not double checked my memory."}, {"owner": {"reputation": 119716, "user_id": 643383, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/uQ5JF.png?s=128&g=1", "display_name": "Caleb", "link": "https://stackoverflow.com/users/643383/caleb"}, "edited": false, "score": 5, "creation_date": 1576687079, "post_id": 59396256, "comment_id": 104982145, "body": "This doesn&#39;t seem like a question with one clear answer, and there&#39;s no obvious problem here."}, {"owner": {"reputation": 151, "user_id": 5895811, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1bed50a2eb82fc748c4b0062e517eec5?s=128&d=identicon&r=PG&f=1", "display_name": "TZof", "link": "https://stackoverflow.com/users/5895811/tzof"}, "edited": false, "score": 0, "creation_date": 1576687165, "post_id": 59396256, "comment_id": 104982193, "body": "You can see the C99 directives"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "reply_to_user": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 2, "creation_date": 1576687536, "post_id": 59396256, "comment_id": 104982391, "body": "@JesperJuhl I think declaring variables inside an inner block of a function might predate C++, but mixing declarations and statements within a block probably came from C++ since it has only been a standard feature since C99."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1576688750, "post_id": 59396256, "comment_id": 104983009, "body": "<a href=\"https://chat.stackoverflow.com/\">chat.stackoverflow.com</a>"}, {"owner": {"reputation": 48092, "user_id": 136208, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a30f566f1b7c9ae44cf245138850ba4?s=128&d=identicon&r=PG", "display_name": "AProgrammer", "link": "https://stackoverflow.com/users/136208/aprogrammer"}, "edited": false, "score": 1, "creation_date": 1576690132, "post_id": 59396256, "comment_id": 104983695, "body": "<a href=\"http://www.stroustrup.com/sibling_rivalry.pdf\" rel=\"nofollow noreferrer\">Here</a> B. Stroustrup relates the early history of C and C++."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1576690674, "post_id": 59396256, "comment_id": 104983949, "body": "Advancements to C were purposely put on hold during C++ nascent years.  Features that appeared first in C++ then C are then not necessarily due to &quot;C++ has it so let&#39;s put it in C&quot; as much as the C update was postponed and the feature came up in both.  I&#39;m thinking of <code>&#47;&#47;</code>, inline, and maybe others."}], "answers": [{"comments": [{"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 1, "creation_date": 1576687804, "post_id": 59396498, "comment_id": 104982530, "body": "@KonradRudolph Anonymous: <code>union named { struct { int i;}; };</code> Unnamed: <code>union named { struct { int i;} unnamed; };</code>. The unnamed struct is has no name, but has a named variable. Anonymous struct is unnamed and has no named variable."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1576687865, "post_id": 59396498, "comment_id": 104982570, "body": "@Konrad <a href=\"https://stackoverflow.com/a/14248127/560648\">stackoverflow.com/a/14248127/560648</a>"}, {"owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 1, "creation_date": 1576689576, "post_id": 59396498, "comment_id": 104983409, "body": "Inline functions existed in GCC and other compilers before C++."}], "tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": true, "score": 4, "last_activity_date": 1576689539, "last_edit_date": 1576689539, "creation_date": 1576687100, "answer_id": 59396498, "question_id": 59396256, "link": "https://stackoverflow.com/questions/59396256/which-c-features-are-influenced-by-derived-from-c-features/59396498#59396498", "title": "Which C Features are influenced by/derived from C++ Features?", "body": "<p>I cannot confirm that they were definitely influenced by C++ directly<sup>1</sup>, but here is a list of features in standard C++ that were added in C99:</p>\n\n<ul>\n<li>single line comments (as mentioned)</li>\n<li>inline functions</li>\n<li>variables allowed after beginning of block</li>\n<li>boolean datatype</li>\n<li>complex math library</li>\n</ul>\n\n<p>C11:</p>\n\n<ul>\n<li>Anonymous unions (C11 allows anonymous structs too). Anonymous unions were already in standard C++. (Anonymous structs are still not allowed in standard C++).</li>\n</ul>\n\n<p><sup>1</sup> For example BCPL, predecessor of B which in turn is the predecessor of C already had same syntax for single line comments. Some of these may have been supported as language extensions in some C implementation prior to their incorporation to standard C++. In these cases both standard C and standard C++ may have been influenced by the same source, rather than influencing one another.</p>\n"}, {"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576690865, "post_id": 59396526, "comment_id": 104984037, "body": "Interesting, yet  &quot;will be added&quot; is not guaranteed."}], "tags": [], "owner": {"reputation": 605, "user_id": 7128840, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RdNYI.jpg?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/7128840/adam"}, "is_accepted": false, "score": 2, "last_activity_date": 1576687555, "last_edit_date": 1576687555, "creation_date": 1576687164, "answer_id": 59396526, "question_id": 59396256, "link": "https://stackoverflow.com/questions/59396256/which-c-features-are-influenced-by-derived-from-c-features/59396526#59396526", "title": "Which C Features are influenced by/derived from C++ Features?", "body": "<p><a href=\"https://en.wikipedia.org/wiki/C%2B%2B11#Attributes\" rel=\"nofollow noreferrer\">Attributes</a> were added in C++11 and will be added in the next C standard revision <a href=\"https://en.wikipedia.org/wiki/C2x\" rel=\"nofollow noreferrer\">C2x</a>. The <a href=\"http://www.open-std.org/jtc1/sc22/wg14/www/docs/n2165.pdf\" rel=\"nofollow noreferrer\">proposal</a> (and <a href=\"http://www.open-std.org/jtc1/sc22/wg14/www/docs/n2175.pdf\" rel=\"nofollow noreferrer\">here</a>) for this feature specifically references C++.</p>\n\n<blockquote>\n  <p>Attributes can be useful for providing information that, for example, helps the compiler to issue better diagnostics or optimize the generated code. <a href=\"https://en.wikipedia.org/wiki/C%2B%2B11#Attributes\" rel=\"nofollow noreferrer\">Source</a></p>\n</blockquote>\n\n<p>Example: </p>\n\n<pre><code>int [[attr1]] i [[attr2, attr3]];\n\n[[attr4(arg1, arg2)]] if (cond)\n\n{\n    [[vendor::attr5]] return i;\n}\n</code></pre>\n\n<p>In this example, \"<em>attribute attr1 applies to the type of variable i, attr2 and attr3 apply to the variable itself, attr4 applies to the if statement and vendor::attr5 applies to the return statement.</em>\" <a href=\"https://en.wikipedia.org/wiki/C%2B%2B11#Attributes\" rel=\"nofollow noreferrer\">Source</a> </p>\n"}], "owner": {"reputation": 12724, "user_id": 12139179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a50aa08ca41bf24e8478a9b4dbc067c3?s=128&d=identicon&r=PG&f=1", "display_name": "RobertS supports Monica Cellio", "link": "https://stackoverflow.com/users/12139179/roberts-supports-monica-cellio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 1, "closed_date": 1576709052, "accepted_answer_id": 59396498, "answer_count": 2, "score": 8, "last_activity_date": 1576689539, "creation_date": 1576686336, "last_edit_date": 1576686999, "question_id": 59396256, "link": "https://stackoverflow.com/questions/59396256/which-c-features-are-influenced-by-derived-from-c-features", "closed_reason": "Opinion-based", "title": "Which C Features are influenced by/derived from C++ Features?", "body": "<p>What are features from the actual C Standard, which originally weren\u00b4t part of C, but were invented in/for C++ and because of its benefits, were later adopted to C?</p>\n\n<p>One prominent example is the single-line comment <code>//</code>, which originally came from C++ and later was adopted by C.</p>\n\n<p>Do you know more features of the actual C Standard, which explicitly or implicitly came from the development of C++?</p>\n\n<p>Info:\nOf course, I know that C++ is derived from C but i was just thinking about which features was adopted from the development of its derivative, C++.</p>\n"}, {"tags": ["c", "pointers", "scanf", "pass-by-reference", "ampersand"], "comments": [{"owner": {"reputation": 12724, "user_id": 12139179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a50aa08ca41bf24e8478a9b4dbc067c3?s=128&d=identicon&r=PG&f=1", "display_name": "RobertS supports Monica Cellio", "link": "https://stackoverflow.com/users/12139179/roberts-supports-monica-cellio"}, "edited": false, "score": 0, "creation_date": 1576690662, "post_id": 59396211, "comment_id": 104983939, "body": "Is it intented, that the first two <code>scanf()</code> do not have the <code>&amp;</code>?"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 12724, "user_id": 12139179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a50aa08ca41bf24e8478a9b4dbc067c3?s=128&d=identicon&r=PG&f=1", "display_name": "RobertS supports Monica Cellio", "link": "https://stackoverflow.com/users/12139179/roberts-supports-monica-cellio"}, "edited": false, "score": 3, "creation_date": 1576690860, "post_id": 59396211, "comment_id": 104984032, "body": "@RobertS-ReinstateMonica \u2014 yes, the inputs are strings so the <code>&amp;</code> is not required.  (More precisely, though less concisely, the members <code>firstname</code> and <code>lastname</code> are almost certainly arrays of <code>char</code> and therefore passing them as written passes a <code>char *</code> which is what <code>%s</code> expects.  Adding the <code>&amp;</code> would pass a <code>char (*)[n]</code> where <code>n</code> is the size of the array \u2014 a very different type.)"}, {"owner": {"reputation": 12724, "user_id": 12139179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a50aa08ca41bf24e8478a9b4dbc067c3?s=128&d=identicon&r=PG&f=1", "display_name": "RobertS supports Monica Cellio", "link": "https://stackoverflow.com/users/12139179/roberts-supports-monica-cellio"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1576691790, "post_id": 59396211, "comment_id": 104984455, "body": "@JonathanLeffler Thank you very much, Jonathan. I did not knew the case when you have the input assignment of <code>scanf</code>()` to a stucture&#180;s member. So, this coding technique is equivalent to <code>scanf(&quot;%s&quot;,array);</code> when <code>a</code> would be an array of <code>char</code>, and <code>&amp;</code> is redundant, if not invalid though, because <code>array</code> already points to the first element of the array, which is required for the operation."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 12724, "user_id": 12139179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a50aa08ca41bf24e8478a9b4dbc067c3?s=128&d=identicon&r=PG&f=1", "display_name": "RobertS supports Monica Cellio", "link": "https://stackoverflow.com/users/12139179/roberts-supports-monica-cellio"}, "edited": false, "score": 2, "creation_date": 1576692080, "post_id": 59396211, "comment_id": 104984569, "body": "@RobertS-ReinstateMonica \u2014 yes, the situations are essentially the same. Using the <code>&amp;</code> is technically incorrect (as I said) because the type of pointer passed in is incorrect.  In practice, you normally get away with it, but it is officially UB (undefined behaviour) and UB should be avoided at all costs (and typing one less character is a very small cost)."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1576819571, "post_id": 59396211, "comment_id": 105027256, "body": "it is not next, as there&#39;s a parenthesis in between.  Check operator precedence and you&#39;ll see that <code>.</code> has higher precedence than <code>&amp;</code>."}], "answers": [{"comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1576686640, "post_id": 59396261, "comment_id": 104981897, "body": "The &#39;parentheses to clarify&#39; might be of use to a novice programmer, but using them emphasises &quot;novice&quot;.  I couldn&#39;t recommend them.  YMMV \u2014 and apparently does."}], "tags": [], "owner": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "is_accepted": false, "score": 3, "last_activity_date": 1576686356, "creation_date": 1576686356, "answer_id": 59396261, "question_id": 59396211, "link": "https://stackoverflow.com/questions/59396211/why-dereference-a-reference-in-c-using-next-to/59396261#59396261", "title": "Why dereference a reference in C? Using &amp; next to *", "body": "<p>The two symbols are referring to different things.</p>\n\n<p>The <code>&amp;</code> is taking the address of the <code>aveGrade</code> member.</p>\n\n<p>The <code>*</code> is deferencing the <code>studptr</code> to get a structure.</p>\n\n<hr>\n\n<p>If it were up to me, I'd write it using the Arrow operator for pointers-to-structures:</p>\n\n<pre><code>scanf(\"%lf\", &amp;studptr-&gt;aveGrade);\n</code></pre>\n\n<p>If you want parens to clarify:</p>\n\n<pre><code>scanf(\"%lf\", &amp;(studptr-&gt;aveGrade) );\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1153, "user_id": 3255525, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/frDd0.jpg?s=128&g=1", "display_name": "JimLohse", "link": "https://stackoverflow.com/users/3255525/jimlohse"}, "edited": false, "score": 0, "creation_date": 1576686785, "post_id": 59396285, "comment_id": 104981979, "body": "So many good answers! But this was first and most concise answer, thanks everyone!"}], "tags": [], "owner": {"reputation": 22777, "user_id": 133203, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/Fp3hB.jpg?s=128&g=1", "display_name": "Federico klez Culloca", "link": "https://stackoverflow.com/users/133203/federico-klez-culloca"}, "is_accepted": true, "score": 5, "last_activity_date": 1576686424, "creation_date": 1576686424, "answer_id": 59396285, "question_id": 59396211, "link": "https://stackoverflow.com/questions/59396211/why-dereference-a-reference-in-c-using-next-to/59396285#59396285", "title": "Why dereference a reference in C? Using &amp; next to *", "body": "<p>Because <code>&amp;</code> doesn't refer to <code>(*stupdtr)</code>, it refers to <code>(*studptr).aveGrade</code>. The <code>.</code> operator has higher precedence.</p>\n"}, {"comments": [{"owner": {"reputation": 1153, "user_id": 3255525, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/frDd0.jpg?s=128&g=1", "display_name": "JimLohse", "link": "https://stackoverflow.com/users/3255525/jimlohse"}, "edited": false, "score": 0, "creation_date": 1576686907, "post_id": 59396315, "comment_id": 104982051, "body": "Thanks, I could tell this MOOC was outdated and/or pedantic"}], "tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": false, "score": 8, "last_activity_date": 1576686519, "creation_date": 1576686519, "answer_id": 59396315, "question_id": 59396211, "link": "https://stackoverflow.com/questions/59396211/why-dereference-a-reference-in-c-using-next-to/59396315#59396315", "title": "Why dereference a reference in C? Using &amp; next to *", "body": "<p>In the fragment:</p>\n\n<pre><code>scanf(\"%lf\", &amp;(*studptr).aveGrade);\n</code></pre>\n\n<p>the <code>&amp;</code> operator applies as if there were parentheses:</p>\n\n<pre><code>scanf(\"%lf\", &amp;((*studptr).aveGrade));\n</code></pre>\n\n<p>There's no good reason to use <code>(*ptr).member</code> in preference to <code>ptr-&gt;member</code>; indeed, explicit indirection notation is more verbose, and doubly so when there are chains of operations:</p>\n\n<pre><code>(*(*(*ptr).ptrmember).altptr).member\n</code></pre>\n\n<p>vs:</p>\n\n<pre><code>ptr-&gt;ptrmember-&gt;altptr-&gt;member\n</code></pre>\n\n<p>So, the code should be:</p>\n\n<pre><code>scanf(\"%lf\", &amp;studptr-&gt;aveGrade);\n</code></pre>\n\n<p>Yes, the two are 'equivalent', but the arrow notation is idiomatic C and the other is not.</p>\n"}, {"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 3, "last_activity_date": 1576686618, "creation_date": 1576686618, "answer_id": 59396344, "question_id": 59396211, "link": "https://stackoverflow.com/questions/59396211/why-dereference-a-reference-in-c-using-next-to/59396344#59396344", "title": "Why dereference a reference in C? Using &amp; next to *", "body": "<blockquote>\n  <p>Why not just use studptr.aveGrade in scanf?</p>\n</blockquote>\n\n<p>As you wrote <code>studptr</code> is a pointer, So this expression <code>studptr.aveGrade</code> is invalid.</p>\n\n<p>It is correctly to write either <code>studptr-&gt;aveGrade</code> or <code>( *studptr ).aveGrade</code></p>\n\n<p>So the call of scanf can be written either like</p>\n\n<pre><code>scanf(\"%lf\", &amp;studptr-&gt;aveGrade);\n</code></pre>\n\n<p>or like</p>\n\n<pre><code>scanf(\"%lf\", &amp;(*studptr).aveGrade);\n</code></pre>\n\n<p>Take into account that </p>\n\n<pre><code>&amp;(*studptr).aveGrade\n</code></pre>\n\n<p>and</p>\n\n<pre><code>( &amp;*studptr).aveGrade\n</code></pre>\n\n<p>are different expressions.</p>\n\n<p>The first expression can be rewritten using more parentheses like</p>\n\n<pre><code>&amp; ( ( *studptr ).aveGrade )\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 1, "last_activity_date": 1576686801, "creation_date": 1576686801, "answer_id": 59396402, "question_id": 59396211, "link": "https://stackoverflow.com/questions/59396211/why-dereference-a-reference-in-c-using-next-to/59396402#59396402", "title": "Why dereference a reference in C? Using &amp; next to *", "body": "<p>It's true that when <code>&amp;</code> immediately precedes <code>*</code> that the two cancel each other out.  However, that's not what's happening here:</p>\n\n<pre><code>&amp;(*studptr).aveGrade\n</code></pre>\n\n<p>Looking at each operator:</p>\n\n<ul>\n<li>The <code>*</code> operator is applied to <code>studptr</code> in the parenthesized expression</li>\n<li>Given <code>(*studptr)</code>, the <code>.</code> operator has higher precedence than <code>&amp;</code> so it is applied next</li>\n<li><code>&amp;</code> is then applied to (*studptr).aveGrade)</li>\n</ul>\n\n<p>So <code>&amp;</code> is giving you the address of the <code>aveGrade</code> member of what <code>studptr</code> points to.  Without parenthesis, the <code>&amp;</code> and <code>*</code> would cancel and you'd get a syntax error because  <code>studptr</code> is a pointer to a struct, not a struct.</p>\n"}, {"comments": [{"owner": {"reputation": 1153, "user_id": 3255525, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/frDd0.jpg?s=128&g=1", "display_name": "JimLohse", "link": "https://stackoverflow.com/users/3255525/jimlohse"}, "edited": false, "score": 0, "creation_date": 1576687949, "post_id": 59396701, "comment_id": 104982627, "body": "Thanks for the answer but I think if you read the other answers you&#39;ll see why the construct is not absurd -- just outdated. @Johnathon Leffler&#39;s answer <a href=\"https://stackoverflow.com/a/59396315/3255525\">stackoverflow.com/a/59396315/3255525</a> explains why -&gt; is better, more accepted practice."}, {"owner": {"reputation": 5, "user_id": 11774797, "user_type": "registered", "profile_image": "https://graph.facebook.com/2300484216702888/picture?type=large", "display_name": "Avneesh Sirohi", "link": "https://stackoverflow.com/users/11774797/avneesh-sirohi"}, "reply_to_user": {"reputation": 1153, "user_id": 3255525, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/frDd0.jpg?s=128&g=1", "display_name": "JimLohse", "link": "https://stackoverflow.com/users/3255525/jimlohse"}, "edited": false, "score": 1, "creation_date": 1576688344, "post_id": 59396701, "comment_id": 104982812, "body": "@JimLohse yes I know about arrow operator being preferred over this way. They about arrow operator should be preferred in mooc too."}], "tags": [], "owner": {"reputation": 5, "user_id": 11774797, "user_type": "registered", "profile_image": "https://graph.facebook.com/2300484216702888/picture?type=large", "display_name": "Avneesh Sirohi", "link": "https://stackoverflow.com/users/11774797/avneesh-sirohi"}, "is_accepted": false, "score": 0, "last_activity_date": 1576690679, "last_edit_date": 1576690679, "creation_date": 1576687727, "answer_id": 59396701, "question_id": 59396211, "link": "https://stackoverflow.com/questions/59396211/why-dereference-a-reference-in-c-using-next-to/59396701#59396701", "title": "Why dereference a reference in C? Using &amp; next to *", "body": "<p>In structure, <code>aveGrade</code> is <code>double</code> so if you want to access that you need to dereference <code>studptr</code> to <code>aveGrade</code> by using ampersand(&amp;). So it's absurd to use <code>(*studptr).aveGrade</code> in <code>scanf</code>.</p>\n"}], "owner": {"reputation": 1153, "user_id": 3255525, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/frDd0.jpg?s=128&g=1", "display_name": "JimLohse", "link": "https://stackoverflow.com/users/3255525/jimlohse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 1, "accepted_answer_id": 59396285, "answer_count": 6, "score": 2, "last_activity_date": 1576690679, "creation_date": 1576686172, "last_edit_date": 1576686970, "question_id": 59396211, "link": "https://stackoverflow.com/questions/59396211/why-dereference-a-reference-in-c-using-next-to", "title": "Why dereference a reference in C? Using &amp; next to *", "body": "<p>I looked at <a href=\"https://stackoverflow.com/questions/2094666/pointers-in-c-when-to-use-the-ampersand-and-the-asterisk\">this</a> and <a href=\"https://stackoverflow.com/questions/1931850/why-doesnt-scanf-need-an-ampersand-for-strings-and-also-works-fine-in-printf-i\">this</a> and <a href=\"https://stackoverflow.com/questions/5406935/reading-a-string-with-scanf\">this</a> and <a href=\"https://stackoverflow.com/questions/47081879/c-reference-after-dereference-terminology\">this</a> and more.</p>\n\n<p><strong>Question is</strong>: </p>\n\n<p>A basic C Programming MOOC on EdX is showing how to access a member of a struct within a function, when the struct was passed by pointer. <strong>Why in the world are they using <code>&amp;</code> next to <code>*</code>???</strong></p>\n\n<p>They show: <code>scanf(\"%lf\", &amp;(*studptr).aveGrade);</code></p>\n\n<p>Why not just use <code>studptr.aveGrade</code> in scanf? </p>\n\n<p>(<em>Leaving aside the separate question, \"why use scanf at all\"</em>)</p>\n\n<p>(Was asked for complete example)</p>\n\n<pre><code>void readStudent(struct student *studptr) {\n    print(\"\\nEnter a new student record: \\n\");\n    printf(\"First name: \");\n    scanf(\"%s\", (*studptr).firstName);\n    printf(\"Last name: \");\n    scanf(\"%s\", (*studptr).lastName);\n    printf(\"Birth year: \");\n    scanf(\"%d\", &amp;(*studptr).birthYear);\n    printf(\"Average grade: \");\n    scanf(\"%lf\", &amp;(*studptr).aveGrade);\n}\n</code></pre>\n"}, {"tags": ["c", "linux", "makefile", "linux-kernel", "kbuild"], "comments": [{"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1576686497, "post_id": 59396154, "comment_id": 104981807, "body": "&quot;Why is building the target <code>&#47;home&#47;memyself&#47;lkm&#47;procfs_write_perm&#47;pfsw.o</code> causes building <code>&#47;home&#47;memyself&#47;lkm&#47;procfs_write_perm&#47;src&#47;init.o</code>?&quot; - Eh? Exactly the line <code>pfsw-objs := src&#47;init.o</code> tells that <code>pfsw</code> module consists from <code>src&#47;init.o</code> object."}, {"owner": {"reputation": 23069, "user_id": 2786156, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/fWMLm.jpg?s=128&g=1", "display_name": "St.Antario", "link": "https://stackoverflow.com/users/2786156/st-antario"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1576686690, "post_id": 59396154, "comment_id": 104981931, "body": "@Tsyvarev That&#39;s right, but <code>pfsw-objs := src&#47;init.o</code> is used to &quot;Replace multi-part objects by their individual parts&quot; as stated in the comments to the source code I referenced further. It results in <a href=\"https://github.com/torvalds/linux/blob/v5.0/scripts/Makefile.lib#L57\" rel=\"nofollow noreferrer\"><code>real-obj-m := &#47;home&#47;memyself&#47;lkm&#47;procfs_write_perm&#47;src&#47;init.o</code></a> I did not find used anywhere as targets or prerequisites..."}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 3, "creation_date": 1576687630, "post_id": 59396154, "comment_id": 104982431, "body": "Hm, searching a string &quot;-objs&quot; in <code>scripts&#47;Makefile.build</code> has found this line: <code>$(call multi_depend, $(multi-used-m), .o, -objs -y -m)</code>. It smells like exactly this line is responsible for dependency between <code>pfsw.o</code> and <code>init.o</code>. The macro <code>multi_depend</code> is defined in <a href=\"https://github.com/torvalds/linux/blob/v5.0/scripts/Makefile.lib#L181\" rel=\"nofollow noreferrer\">scripts/Makefile.lib</a>."}, {"owner": {"reputation": 23069, "user_id": 2786156, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/fWMLm.jpg?s=128&g=1", "display_name": "St.Antario", "link": "https://stackoverflow.com/users/2786156/st-antario"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1576688293, "post_id": 59396154, "comment_id": 104982789, "body": "@Tsyvarev Very likely to be so, thanks much! I checked the value of <code>multi-used-m</code>. It was <code>multi-used-m := &#47;home&#47;memyself&#47;lkm&#47;procfs_write_perm&#47;pfsw.o</code> connecting it with <code>&#47;home&#47;memyself&#47;lkm&#47;procfs_write_perm&#47;src&#47;init.o</code>. If you post it as an answer I would accept it."}, {"owner": {"reputation": 23069, "user_id": 2786156, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/fWMLm.jpg?s=128&g=1", "display_name": "St.Antario", "link": "https://stackoverflow.com/users/2786156/st-antario"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1576688464, "post_id": 59396154, "comment_id": 104982878, "body": "@Tsyvarev Judging by the <code>make -d</code> output this is definitely it."}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 3, "creation_date": 1576698575, "post_id": 59396154, "comment_id": 104987324, "body": "No, I don&#39;t want to write an answer. I didn&#39;t read the KBuild makefiles in a deep manner. My comment was just a hint. Feel free to post your answer and use this hint in it."}], "answers": [{"tags": [], "owner": {"reputation": 23069, "user_id": 2786156, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/fWMLm.jpg?s=128&g=1", "display_name": "St.Antario", "link": "https://stackoverflow.com/users/2786156/st-antario"}, "is_accepted": true, "score": 0, "last_activity_date": 1576730232, "creation_date": 1576730232, "answer_id": 59403360, "question_id": 59396154, "link": "https://stackoverflow.com/questions/59396154/linux-kernel-makefile-build-strange-behavior-when-building-external-modules/59403360#59403360", "title": "Linux Kernel Makefile.build strange behavior when building external modules", "body": "<p>As @Tsyvarev hinted in the comments there is a rule to build <code>obj-m</code> from its <code>-objs</code>.</p>\n\n<p>When analyzing the behavior I mistakenly considered an implicit pattern rule  to build the <code>obj-m</code> which in my case is expanded to <code>/home/memyself/lkm/procfs_write_perm/pfsw.o</code>. Running the build with <code>make -p</code> it is possible to notice the following entry in the output:</p>\n\n<pre><code>/home/memyself/lkm/procfs_write_perm/pfsw.o: FORCE /home/memyself/lkm/procfs_write_perm/src/init.o\n#  Implicit rule search has not been done.\n#  Implicit/static pattern stem: ''\n#  File is an intermediate prerequisite.\n#  Last modified 2019-12-18 21:13:48.337755924\n#  File has been updated.\n#  Successfully updated.\n# automatic\n# @ := /home/memyself/lkm/procfs_write_perm/pfsw.o\n# automatic\n# % := \n# automatic\n# * := \n# automatic\n# + := FORCE /home/memyself/lkm/procfs_write_perm/src/init.o\n# automatic\n# | := \n# automatic\n# &lt; := FORCE\n# automatic\n# ^ := FORCE /home/memyself/lkm/procfs_write_perm/src/init.o\n# automatic\n# ? := FORCE /home/memyself/lkm/procfs_write_perm/src/init.o\n# variable set hash-table stats:\n# Load=8/32=25%, Rehash=0, Collisions=13/382=3%\n#  recipe to execute (from 'scripts/Makefile.build', line 474):\n    $(call if_changed,link_multi-m)\n    @{ echo $(@:.o=.ko); echo $(filter %.o,$^); \\\n       $(cmd_undef_syms); } &gt; $(MODVERDIR)/$(@F:.o=.mod)\n</code></pre>\n\n<p>So there is a not-implicit rule specifying a recipe to build <code>/home/memyself/lkm/procfs_write_perm/pfsw.o</code> implying that the implicit rule <a href=\"https://github.com/torvalds/linux/blob/v5.0/scripts/Makefile.build#L275\" rel=\"nofollow noreferrer\"><code>$(obj)/%.o:</code></a> should not be considered for that specific case.</p>\n\n<p>The <code>make</code> database entry specified above also contains a line number of the recipe to execute and a file it came from. In this case it is</p>\n\n<pre><code>recipe to execute (from 'scripts/Makefile.build', line 474):\n</code></pre>\n\n<p>pointing to the <a href=\"https://github.com/torvalds/linux/blob/v5.0/scripts/Makefile.build#L464\" rel=\"nofollow noreferrer\"><code>scripts/Makefile.build</code></a> entry which in my case is</p>\n\n<pre><code>$(multi-used-m): FORCE\n    $(call if_changed,link_multi-m) # &lt;------ This is the line the database points to\n    @{ echo $(@:.o=.ko); echo $(filter %.o,$^); \\\n       $(cmd_undef_syms); } &gt; $(MODVERDIR)/$(@F:.o=.mod)\n$(call multi_depend, $(multi-used-m), .o, -objs -y -m)\n</code></pre>\n"}], "owner": {"reputation": 23069, "user_id": 2786156, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/fWMLm.jpg?s=128&g=1", "display_name": "St.Antario", "link": "https://stackoverflow.com/users/2786156/st-antario"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 59403360, "answer_count": 1, "score": 0, "last_activity_date": 1576730232, "creation_date": 1576685957, "question_id": 59396154, "link": "https://stackoverflow.com/questions/59396154/linux-kernel-makefile-build-strange-behavior-when-building-external-modules", "title": "Linux Kernel Makefile.build strange behavior when building external modules", "body": "<p>I need some <code>KBuild</code> implementation details advice related to building of external modules.</p>\n\n<p><code>Linux Kernel 5.0.0-32</code></p>\n\n<p>Here is my <code>LKM</code> Makefile:</p>\n\n<pre><code>obj-m += pfsw.o\npfsw-objs := src/init.o\n\nall:\n    make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules\n</code></pre>\n\n<p>Looking at the implementation of <a href=\"https://github.com/torvalds/linux/blob/v5.0/scripts/Makefile.build\" rel=\"nofollow noreferrer\"><code>scripts/Makefile.build</code></a> and printing the debug output with <code>-d</code> option I found that the target of this makefile being executed is <a href=\"https://github.com/torvalds/linux/blob/v5.0/scripts/Makefile.build#L70\" rel=\"nofollow noreferrer\"><code>__build</code></a>:</p>\n\n<pre><code>__build: $(if $(KBUILD_BUILTIN),$(builtin-target) $(lib-target) $(extra-y)) \\\n     $(if $(KBUILD_MODULES),$(obj-m) $(modorder-target)) \\\n     $(subdir-ym) $(always)\n    @:\n</code></pre>\n\n<p>Since I'm building External LKM the only prerequisites are <code>$(obj-m)</code> and <code>$(modorder-target)</code>. I got their values from the database:</p>\n\n<pre><code>obj-m := /home/memyself/lkm/procfs_write_perm/pfsw.o\nmodorder-target := /home/memyself/lkm/procfs_write_perm/modules.order\n</code></pre>\n\n<p>So to execute <code>__build</code> the prerequisite <code>/home/memyself/lkm/procfs_write_perm/pfsw.o</code> have to be built first. There is the following <a href=\"https://github.com/torvalds/linux/blob/v5.0/scripts/Makefile.build#L275\" rel=\"nofollow noreferrer\"><code>$(obj)/%.o:</code></a> pattern rule defined in <code>Makefile.build</code>:</p>\n\n<pre><code>$(obj)/%.o: $(src)/%.c $(recordmcount_source) $(objtool_dep) FORCE\n    $(call cmd,force_checksrc)\n    $(call if_changed_rule,cc_o_c)\n</code></pre>\n\n<p>I added debug output to print the name of the target automatic variable:</p>\n\n<pre><code>$(obj)/%.o: $(src)/%.c $(recordmcount_source) $(objtool_dep) FORCE\n    @echo \"$@\"\n    $(call cmd,force_checksrc)\n    $(call cmd,force_check_kmsg)\n    $(call if_changed_rule,cc_o_c)\n</code></pre>\n\n<p>and expected <code>/home/memyself/lkm/procfs_write_perm/pfsw.o</code> to be printed, but actually <code>/home/memyself/lkm/procfs_write_perm/src/init.o</code> was printed. \nThis looks like some magic...</p>\n\n<p><strong>QUESTION:</strong> Why is building the target <code>/home/memyself/lkm/procfs_write_perm/pfsw.o</code> causes building <code>/home/memyself/lkm/procfs_write_perm/src/init.o</code>? Where does it specified in the code?</p>\n\n<p>I understand that there is the <code>real-obj-m</code> variable containing exactly the value, but <code>grep</code>ing the code base I did not find it depending on something...</p>\n"}, {"tags": ["c", "scanf"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1576685926, "post_id": 59396005, "comment_id": 104981477, "body": "The <code>%s</code> format specifier reads <i>space-delimited <b>words</i></b>."}, {"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 0, "creation_date": 1576685974, "post_id": 59396005, "comment_id": 104981506, "body": "You should use <code>fgets</code>."}, {"owner": {"reputation": 21449, "user_id": 1839439, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/agMKZ.png?s=128&g=1", "display_name": "Dharman", "link": "https://stackoverflow.com/users/1839439/dharman"}, "edited": false, "score": 1, "creation_date": 1576782369, "post_id": 59396005, "comment_id": 105018500, "body": "Please don&#39;t make more work for other people by vandalizing your posts. By posting on the Stack Exchange network, you&#39;ve granted a non-revocable right, under the <a href=\"//creativecommons.org/licenses/by-sa/4.0/\" rel=\"nofollow noreferrer\">CC BY-SA license</a>, for Stack Exchange to distribute that content (i.e. regardless of your future choices). By Stack Exchange policy, the non-vandalized version of the post is the one which is distributed. Thus, any vandalism will be reverted. If you want to know more about deleting a post please see: <a href=\"//meta.stackexchange.com/q/5221\">How does deleting work?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3268, "user_id": 182634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d5b602ab0bc363e3e990f2e904b671d?s=128&d=identicon&r=PG", "display_name": "eyalm", "link": "https://stackoverflow.com/users/182634/eyalm"}, "is_accepted": false, "score": 3, "last_activity_date": 1576691383, "creation_date": 1576691383, "answer_id": 59397589, "question_id": 59396005, "link": "https://stackoverflow.com/questions/59396005/writing-a-letter-using-scanf-in-c/59397589#59397589", "title": "Writing a letter using scanf in C", "body": "<p>your program should do the following:</p>\n\n<pre><code>while (1)\n{\n    scnaf into a fixed length buffer;\n    if the buffer equals to \"-\"\n        break the loop;\n    duplicate the buffer;\n    add the duplicate to any structure (like a linked list);\n}\n\nrun over the list and print all the lines.\n</code></pre>\n\n<p>regarding <code>scanf</code>, a naive call will not work since it reads only aword. Use <code>fgets</code> or a more permissive scan format specifier. Googling it I found this option:</p>\n\n<pre><code>scanf(\"%[^\\n]\", str);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 12559866, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB7us9j5RAzEmaE5CMQYG-rCbPCWgvmCLdJywL05w=k-s128", "display_name": "yAbOyZeR0", "link": "https://stackoverflow.com/users/12559866/yaboyzer0"}, "edited": false, "score": 0, "creation_date": 1576696083, "post_id": 59398257, "comment_id": 104986286, "body": "Ohhh thanks, I tried using fgets but it just skipped it completely, is there anything i can do about the dash by the way?"}, {"owner": {"reputation": 4633, "user_id": 11383441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fe326a8e47283a622c4dc9bf700992?s=128&d=identicon&r=PG&f=1", "display_name": "Kalana", "link": "https://stackoverflow.com/users/11383441/kalana"}, "reply_to_user": {"reputation": 31, "user_id": 12559866, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB7us9j5RAzEmaE5CMQYG-rCbPCWgvmCLdJywL05w=k-s128", "display_name": "yAbOyZeR0", "link": "https://stackoverflow.com/users/12559866/yaboyzer0"}, "edited": false, "score": 0, "creation_date": 1576731367, "post_id": 59398257, "comment_id": 104995529, "body": "what dash? Can you explain further?"}, {"owner": {"reputation": 31, "user_id": 12559866, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB7us9j5RAzEmaE5CMQYG-rCbPCWgvmCLdJywL05w=k-s128", "display_name": "yAbOyZeR0", "link": "https://stackoverflow.com/users/12559866/yaboyzer0"}, "edited": false, "score": 0, "creation_date": 1576740887, "post_id": 59398257, "comment_id": 104998328, "body": "So inputting a dash (-) is supposed to end the sentence, one sentence is supposed to be one scanf according to the exercise I think."}, {"owner": {"reputation": 4633, "user_id": 11383441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fe326a8e47283a622c4dc9bf700992?s=128&d=identicon&r=PG&f=1", "display_name": "Kalana", "link": "https://stackoverflow.com/users/11383441/kalana"}, "reply_to_user": {"reputation": 31, "user_id": 12559866, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB7us9j5RAzEmaE5CMQYG-rCbPCWgvmCLdJywL05w=k-s128", "display_name": "yAbOyZeR0", "link": "https://stackoverflow.com/users/12559866/yaboyzer0"}, "edited": false, "score": 0, "creation_date": 1576741060, "post_id": 59398257, "comment_id": 104998404, "body": "Yes it is. If you want to write like paragraphs you have use another few char arrays."}, {"owner": {"reputation": 31, "user_id": 12559866, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB7us9j5RAzEmaE5CMQYG-rCbPCWgvmCLdJywL05w=k-s128", "display_name": "yAbOyZeR0", "link": "https://stackoverflow.com/users/12559866/yaboyzer0"}, "edited": false, "score": 0, "creation_date": 1576741176, "post_id": 59398257, "comment_id": 104998447, "body": "Could you explain how the dash ends a sentence? I tried using an if statement and loops but couldn&#39;t get it right"}, {"owner": {"reputation": 4633, "user_id": 11383441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fe326a8e47283a622c4dc9bf700992?s=128&d=identicon&r=PG&f=1", "display_name": "Kalana", "link": "https://stackoverflow.com/users/11383441/kalana"}, "reply_to_user": {"reputation": 31, "user_id": 12559866, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB7us9j5RAzEmaE5CMQYG-rCbPCWgvmCLdJywL05w=k-s128", "display_name": "yAbOyZeR0", "link": "https://stackoverflow.com/users/12559866/yaboyzer0"}, "edited": false, "score": 0, "creation_date": 1576741404, "post_id": 59398257, "comment_id": 104998546, "body": "when you enter dash you want to display &quot;Sincerely&quot; message am I correct."}, {"owner": {"reputation": 31, "user_id": 12559866, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB7us9j5RAzEmaE5CMQYG-rCbPCWgvmCLdJywL05w=k-s128", "display_name": "yAbOyZeR0", "link": "https://stackoverflow.com/users/12559866/yaboyzer0"}, "edited": false, "score": 0, "creation_date": 1576741913, "post_id": 59398257, "comment_id": 104998732, "body": "No, I think the dash should end the sentence so I can write the next one and the final dash must display &quot;sincerely&quot;"}, {"owner": {"reputation": 4633, "user_id": 11383441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fe326a8e47283a622c4dc9bf700992?s=128&d=identicon&r=PG&f=1", "display_name": "Kalana", "link": "https://stackoverflow.com/users/11383441/kalana"}, "reply_to_user": {"reputation": 31, "user_id": 12559866, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB7us9j5RAzEmaE5CMQYG-rCbPCWgvmCLdJywL05w=k-s128", "display_name": "yAbOyZeR0", "link": "https://stackoverflow.com/users/12559866/yaboyzer0"}, "edited": false, "score": 0, "creation_date": 1576743591, "post_id": 59398257, "comment_id": 104999360, "body": "use fullstop to end a sentence. Real challenge is write multiple sentences by pressing <code>Enter</code>. If you enter <code>-</code> all paragraphs will stop and display &quot;Sincerely&quot; message. I can do it for you."}, {"owner": {"reputation": 31, "user_id": 12559866, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB7us9j5RAzEmaE5CMQYG-rCbPCWgvmCLdJywL05w=k-s128", "display_name": "yAbOyZeR0", "link": "https://stackoverflow.com/users/12559866/yaboyzer0"}, "edited": false, "score": 0, "creation_date": 1576747307, "post_id": 59398257, "comment_id": 105001200, "body": "That&#39;d be too much to ask, wouldn&#39;t it?"}, {"owner": {"reputation": 4633, "user_id": 11383441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fe326a8e47283a622c4dc9bf700992?s=128&d=identicon&r=PG&f=1", "display_name": "Kalana", "link": "https://stackoverflow.com/users/11383441/kalana"}, "reply_to_user": {"reputation": 31, "user_id": 12559866, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB7us9j5RAzEmaE5CMQYG-rCbPCWgvmCLdJywL05w=k-s128", "display_name": "yAbOyZeR0", "link": "https://stackoverflow.com/users/12559866/yaboyzer0"}, "edited": false, "score": 0, "creation_date": 1576749701, "post_id": 59398257, "comment_id": 105002351, "body": "No,It&#39;s not too much. I think you have to raise another question. Your problem is too much to this question. Ask new question by mentioning your new problem."}, {"owner": {"reputation": 31, "user_id": 12559866, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB7us9j5RAzEmaE5CMQYG-rCbPCWgvmCLdJywL05w=k-s128", "display_name": "yAbOyZeR0", "link": "https://stackoverflow.com/users/12559866/yaboyzer0"}, "edited": false, "score": 0, "creation_date": 1576751781, "post_id": 59398257, "comment_id": 105003344, "body": "So should I ask again but about the dash?"}, {"owner": {"reputation": 4633, "user_id": 11383441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fe326a8e47283a622c4dc9bf700992?s=128&d=identicon&r=PG&f=1", "display_name": "Kalana", "link": "https://stackoverflow.com/users/11383441/kalana"}, "reply_to_user": {"reputation": 31, "user_id": 12559866, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB7us9j5RAzEmaE5CMQYG-rCbPCWgvmCLdJywL05w=k-s128", "display_name": "yAbOyZeR0", "link": "https://stackoverflow.com/users/12559866/yaboyzer0"}, "edited": false, "score": 0, "creation_date": 1576752390, "post_id": 59398257, "comment_id": 105003670, "body": "Yes, start a new question add code what have you tried with dash and explain what you really want to archive."}], "tags": [], "owner": {"reputation": 4633, "user_id": 11383441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fe326a8e47283a622c4dc9bf700992?s=128&d=identicon&r=PG&f=1", "display_name": "Kalana", "link": "https://stackoverflow.com/users/11383441/kalana"}, "is_accepted": true, "score": 3, "last_activity_date": 1576694325, "creation_date": 1576694325, "answer_id": 59398257, "question_id": 59396005, "link": "https://stackoverflow.com/questions/59396005/writing-a-letter-using-scanf-in-c/59398257#59398257", "title": "Writing a letter using scanf in C", "body": "<p>Your 3rd <code>scanf</code> skipped because you have put spaces between in second <code>scanf</code>. To avoid this use <code>get()</code> method instead of <code>scanf()</code></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    char name1[100];       \n    char mail1[9999];     \n    char name2[100]; \n\n    printf(\"Dear \"); \n\n    gets(name1);\n    gets(mail1);\n\n    printf(\"Sincerely, \"); \n\n    gets(name2);\n\n    return 0;   \n}\n</code></pre>\n\n<p><strong>But</strong> If you want to try this using only <code>scanf()</code> follow this code.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    char name1[100];       \n    char mail1[9999];     \n    char name2[100]; \n\n    printf(\"Dear \");\n\n    scanf(\"%[^\\n]%*c\", name1);\n    scanf(\"%[^\\n]%*c\", mail1);\n\n    printf(\"Sincerely, \"); \n\n    scanf(\"%[^\\n]%*c\", name2);\n\n    return 0;   \n}\n</code></pre>\n\n<p><strong>output of both codes -:</strong> </p>\n\n<pre><code>Dear Son                                                                                                            \nI love you                                                                                                          \nSincerely, Your Mom\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 12559866, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB7us9j5RAzEmaE5CMQYG-rCbPCWgvmCLdJywL05w=k-s128", "display_name": "yAbOyZeR0", "link": "https://stackoverflow.com/users/12559866/yaboyzer0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 59398257, "answer_count": 2, "score": 2, "last_activity_date": 1576784091, "creation_date": 1576685461, "last_edit_date": 1576784091, "question_id": 59396005, "link": "https://stackoverflow.com/questions/59396005/writing-a-letter-using-scanf-in-c", "title": "Writing a letter using scanf in C", "body": "<p>I was given this exercise:</p>\n\n<blockquote>\n  <p>Imagine, somebody wants to write a letter. Each sentence is entered using a single scanf-command execution. Each sentence is to be stored in a character array of\n  optimal length. If the user enters a line which only consists of a dash (-), the text is\n  assumed to be finished. After all text has been entered, it is to be printed out to the\n  console.</p>\n</blockquote>\n\n<p>I couldn't quite get what it means but I decided to try and write an email using scanf</p>\n\n<pre><code>#include &lt;stdio.h&gt;         \nint main()        \n{          \n\nchar name1[100];       \nchar mail1[9999];     \nchar name2[100];        \nprintf(\"Dear \");      \nscanf(\"%s\", name1);     \nscanf(\"%s\", mail1);      \nprintf(\"Sincerely,\");         \nscanf(\"%s\", name2);       \n\n\nreturn 0;      \n}\n</code></pre>\n\n<p>This is what I could write. After I write someone's name after it prints \"Dear\", I just write the body of the letter but if I write more than one word it doesn't let me write anything after Sincerely</p>\n"}, {"tags": ["c", "file", "printf", "buffer", "fwrite"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1576684026, "post_id": 59395535, "comment_id": 104980346, "body": "What is <code>todo.title</code>? How do you open the file? Please try to show us a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. And if the &quot;edit&quot; of it makes it a different length then the write could write past the end of the old text in the file. Modifying variable-length texts in a file can&#39;t be by a simple read and rewrite."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1576684066, "post_id": 59395535, "comment_id": 104980367, "body": "As for the warning, please read about the <a href=\"https://en.cppreference.com/w/c/io/fflush\" rel=\"nofollow noreferrer\"><code>fflush</code></a> function."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1576684185, "post_id": 59395535, "comment_id": 104980439, "body": "By the way, the code as you show it have another problem: After you have read the <code>todo</code> structure from the file, the file-pointer will be placed <i>after</i> that structure, so you will write the string in the wrong place. You need to reseek and rewrite the full structure."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1576684841, "post_id": 59395535, "comment_id": 104980820, "body": "Note that <a href=\"https://stackoverflow.com/questions/5431941/why-is-while-feof-file-always-wrong\"><code>while (!feof(file))</code> is always wrong</a>. You should also inspect the value returned by <code>fread()</code> to make sure you got what you expected."}], "answers": [{"tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": false, "score": 1, "last_activity_date": 1576685654, "last_edit_date": 1592644375, "creation_date": 1576685654, "answer_id": 59396066, "question_id": 59395535, "link": "https://stackoverflow.com/questions/59395535/how-to-clear-buffer-in-c/59396066#59396066", "title": "How to clear buffer in C?", "body": "<p>If you have a file open for update (read and write) then the C11 standard requires:</p>\n<blockquote>\n<p>\u00a77.21.5.3 The <code>fopen</code> function</p>\n<p>\u00b67 When a file is opened with update mode ('<code>+</code>' as the second or third character in the above list of mode argument values), both input and output may be performed on the associated stream. However, output shall not be directly followed by input without an intervening call to the <code>fflush</code> function or to a file positioning function (<code>fseek</code>, <code>fsetpos</code>, or <code>rewind</code>), and input shall not be directly followed by output without an intervening call to a file positioning function, unless the input operation encounters end-of-file. Opening (or creating) a text file with update mode may instead open (or create) a binary stream in some implementations.</p>\n</blockquote>\n<p><sup><em>The quote comes from the C11 specification, but the wording is essentially unchanged in all versions of the standard.</em></sup></p>\n<p>Note that you must do a seek operation, even if it is just <code>fseek(f, 0, SEEK_CUR)</code>, between a read and a write operation, and between a write and a read operation.</p>\n<p>Your code has an <code>fread()</code> followed by an <code>fwrite()</code> with no intervening <code>fseek()</code>.  That's probably an oversight since you change the record and overwrite the next record in the file with the updated information.  You probably need an <code>fseek(f, -(long)sizeof(schedule), SEEK_CUR)</code> or thereabouts to move back and overwrite the record just read and changed.</p>\n"}], "owner": {"reputation": 11, "user_id": 10819084, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KRB4s.jpg?s=128&g=1", "display_name": "Phoebe", "link": "https://stackoverflow.com/users/10819084/phoebe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 356, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576685654, "creation_date": 1576683842, "question_id": 59395535, "link": "https://stackoverflow.com/questions/59395535/how-to-clear-buffer-in-c", "title": "How to clear buffer in C?", "body": "<p>I have following problem:</p>\n\n<pre><code>void edit(FILE *f, int cnt)\n{\n    int i = 0;\n    int offset = 0;\n    rewind(f);\n\n    schedule todo;\n    schedule *p = &amp;todo;\n\n    fprintf(stdout, \"\\n%s\\n\", \"------------------------------------------------\");\n    fread(&amp;todo, sizeof(schedule), 1, f);\n    while (!feof(f)) {\n        fprintf(stdout, \"%6d%18s\\n\",                                \n            ++i, todo.title);\n        fread(&amp;todo, sizeof(schedule), 1, f);\n    }\n    fprintf(stdout, \"%s\\n\\n\", \"-------------------------------------------------\");\n    fprintf(stdout, \"%s\\n\\n\", \"Number: \");\n\n    scanf(\"%d\", &amp;i);\n    getchar();\n\n    rewind(f);\n    offset = (long) sizeof(schedule);\n    fseek(f, (i - 1)*offset, SEEK_CUR);\n\n    fread(&amp;todo, sizeof(schedule), 1, f);\n    printf(\"Edit: %s\\n\", todo.title);\n    fprintf(stdout, \"%6d%18s%8s%10s%8d\\n\",                              \n        todo.number, todo.title, todo.where, todo.details, todo.importance);\n\n    scanf(\"%s\", todo.title);\n\n    fwrite(&amp;todo, (long)sizeof(todo.title), 1, f);\n\n}\n</code></pre>\n\n<p>It's part of editing data codes.\nThis is what I expected. </p>\n\n<p>If a user put a number(i in the code), the program will find the location (in binary file).\nThen, the user put <strong>todo.title</strong> by (<code>scanf(\"%s\", todo.title);</code>) and the program will edit it by using \n<code>fwrite(&amp;todo, (long)sizeof(todo.title), 1, f);</code></p>\n\n<p>I got a warning like</p>\n\n<blockquote>\n  <p>Expression: (\"Flush between consecutive read and write.\", !stream.has_any_of(_IOREAD))</p>\n</blockquote>\n\n<p>I think there's problems with buffer, but I can't fix this.</p>\n"}, {"tags": ["c", "string", "char", "int", "binary-search-tree"], "comments": [{"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 1, "creation_date": 1576683123, "post_id": 59395268, "comment_id": 104979821, "body": "Take a look at <a href=\"https://www.geeksforgeeks.org/strtok-strtok_r-functions-c-examples/\" rel=\"nofollow noreferrer\">strtok</a> and <a href=\"https://stackoverflow.com/a/7021750/3436922\">THIS</a>"}, {"owner": {"reputation": 1599, "user_id": 9948091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JANyt.png?s=128&g=1", "display_name": "HAL9000", "link": "https://stackoverflow.com/users/9948091/hal9000"}, "edited": false, "score": 1, "creation_date": 1576683628, "post_id": 59395268, "comment_id": 104980122, "body": "If you want to convert everything up to the first <code>,</code> to an integer, take a look at <code>sscanf()</code> or <code>fscanf()</code>, By the way, your <code>filename</code> variable serves no purpose, just do <code>fopen(&quot;file.txt&quot;, &quot;r&quot;);</code> directly. It is a good idea to drop arrays when possible."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 2, "creation_date": 1576685552, "post_id": 59395268, "comment_id": 104981257, "body": "In your code, <code>while (line != NULL)</code>, <code>line</code> is an array and will decay to a pointer to its first element, so it will <i>never</i> be <code>NULL</code>."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 4669014, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/02a1c77bdede7ba0c7f7f2e9b5396a15?s=128&d=identicon&r=PG&f=1", "display_name": "Polecalex", "link": "https://stackoverflow.com/users/4669014/polecalex"}, "edited": false, "score": 0, "creation_date": 1576721964, "post_id": 59396150, "comment_id": 104993823, "body": "I used this before however, it gave an error I can&#39;t remember. For some reason it didn&#39;t like atoi"}], "tags": [], "owner": {"reputation": 74, "user_id": 1700925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c9a1956a530fcdc2bff9fde9949388b?s=128&d=identicon&r=PG&f=1", "display_name": "melissanais", "link": "https://stackoverflow.com/users/1700925/melissanais"}, "is_accepted": false, "score": 1, "last_activity_date": 1576685944, "creation_date": 1576685944, "answer_id": 59396150, "question_id": 59395268, "link": "https://stackoverflow.com/questions/59395268/split-string-into-two-variables-in-c/59396150#59396150", "title": "Split string into two variables in C", "body": "<p>Like @LPs suggested, and assuming each line is like \"2019, blah, blah, blah\", you can get the ID for each line by calling:</p>\n\n<pre><code>   int id = atoi(strtok(line, \",\"));\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 143, "user_id": 4669014, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/02a1c77bdede7ba0c7f7f2e9b5396a15?s=128&d=identicon&r=PG&f=1", "display_name": "Polecalex", "link": "https://stackoverflow.com/users/4669014/polecalex"}, "edited": false, "score": 0, "creation_date": 1576722055, "post_id": 59402074, "comment_id": 104993838, "body": "I appreciate this work however, it is indeed overkill. This program is simply to take data from a file, then input it into a binary tree and display it."}, {"owner": {"reputation": 1149, "user_id": 2472827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t5rYY.jpg?s=128&g=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/2472827/neil"}, "reply_to_user": {"reputation": 143, "user_id": 4669014, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/02a1c77bdede7ba0c7f7f2e9b5396a15?s=128&d=identicon&r=PG&f=1", "display_name": "Polecalex", "link": "https://stackoverflow.com/users/4669014/polecalex"}, "edited": false, "score": 1, "creation_date": 1576781656, "post_id": 59402074, "comment_id": 105018220, "body": "If the lines are in a <i>constant</i> format, one might use something like <code>sscanf(s, &quot;%d, %s, %s, %s\\n&quot;, ...)</code> and check the return; that&#39;s fairly simple as compared to this."}], "tags": [], "owner": {"reputation": 1149, "user_id": 2472827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t5rYY.jpg?s=128&g=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/2472827/neil"}, "is_accepted": false, "score": 1, "last_activity_date": 1576717832, "creation_date": 1576717832, "answer_id": 59402074, "question_id": 59395268, "link": "https://stackoverflow.com/questions/59395268/split-string-into-two-variables-in-c/59402074#59402074", "title": "Split string into two variables in C", "body": "<p>If one wants to parse files like,</p>\n\n<pre><code>2409, blah, blah, blah\n   0x10,foo,    bar,    baz, qux\n# This is more difficult.\n    010   , a\\\na,   b  b\\#\\\\\\,still b,c\n</code></pre>\n\n<p>one is probably better off just using a parser generator like <a href=\"http://dinosaur.compilertools.net/\" rel=\"nofollow noreferrer\">lex and yacc</a> or my favourite, <a href=\"https://re2c.org/\" rel=\"nofollow noreferrer\">re2c</a>.</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;limits.h&gt;\n#include &lt;assert.h&gt;\n\n/* Tokens. */\n#define PARAM(A) A\n#define STRINGISE(A) #A\n#define TOKENS(X) X(ERROR), X(END), X(COMMA), X(NEWLINE), \\\n    X(ESCAPE), X(WSP), X(NUMBER), X(WORD)\nenum Token { TOKENS(PARAM) };\nstatic const char *const tokens[] = { TOKENS(STRINGISE) };\n\nstruct Lexer { size_t line; char *marker, *from, *cursor; };\n\nstatic enum Token lex(struct Lexer *lexer) {\n    assert(lexer);\n/*!re2c\n    re2c:yyfill:enable   = 0;\n    re2c:define:YYCTYPE  = char;\n    re2c:define:YYCURSOR = lexer-&gt;cursor;\n    re2c:define:YYMARKER = lexer-&gt;marker; // Rules overlap.\n\n    newline = \"\\n\" | (\"\\r\" \"\\n\"?);\n    oct = \"0\" [0-7]*;\n    dec = [1-9][0-9]*;\n    hex = '0x' [0-9a-fA-F]+;\n    num = oct | dec | hex;\n    word = [^\\x00\\\\\\n\\r \\t\\v\\f,0-9]+;\n    comment = \"#\" [^\\x00\\n\\r]* newline;\n*/\nscan:\n    lexer-&gt;from = lexer-&gt;cursor;\n/*!re2c\n    * { return ERROR; }\n    \"\\x00\" { return END; }\n    [ \\t\\v\\f]+ { return WSP; }\n    newline { lexer-&gt;line++; return NEWLINE; }\n    \"\\\\\\n\" | comment { lexer-&gt;line++; goto scan; }\n    \"\\\\\\\\\" | \"\\\\,\" | \"\\\\ \" | \"\\\\n\" | \"\\\\#\" { return ESCAPE; }\n    \",\" { return COMMA; }\n    word { return WORD; }\n    num { return NUMBER; }\n*/\n}\n\nstruct Buffer {\n    char *data;\n    size_t size, capacity;\n};\n\nstatic char *buffer_reserve(struct Buffer *const buf, const size_t reserve) {\n    const size_t min = buf-&gt;size + reserve;\n    size_t c = buf-&gt;capacity;\n    char *data;\n    assert(buf);\n    if(reserve &gt; (size_t)-1 - buf-&gt;size || min &gt; ((size_t)-1 &gt;&gt; 1) + 1)\n        { errno = ERANGE; return 0; }\n    if(min &gt; c) {\n        if(!c) c = 1;\n        while(min &lt;= c) c &lt;&lt;= 1;\n        if(!(data = realloc(buf-&gt;data, c))) return 0;\n        buf-&gt;data = data;\n        buf-&gt;capacity = c;\n    }\n    return buf-&gt;data + buf-&gt;size;\n}\n\nstruct Word { char *start, *end; };\n\nstruct Parser {\n    int id, id_set, first_comma;\n    size_t num_words;\n    struct Word words[64]; /* Lazy. */\n    char *start_words, *end_words;\n};\nstatic size_t parser_max_words = sizeof ((struct Parser *)0)-&gt;words\n    / sizeof *((struct Parser *)0)-&gt;words;\n\nstatic void clear_parser(struct Parser *const parser) {\n    assert(parser);\n    parser-&gt;id_set = 0;\n    parser-&gt;first_comma = 1;\n    parser-&gt;num_words = 0;\n    parser-&gt;start_words = parser-&gt;end_words = 0;\n}\nstatic void print_parser(const struct Parser *const parser) {\n    const struct Word *word = parser-&gt;words,\n        *word_end = parser-&gt;words + parser-&gt;num_words;\n    assert(parser &amp;&amp; parser-&gt;id_set &amp;&amp; parser-&gt;num_words &lt;= parser_max_words);\n    printf(\"#%d: \", parser-&gt;id);\n    for( ; word &lt; word_end; word++) {\n        if(word != parser-&gt;words) printf(\", \");\n        if(!word-&gt;start) { printf(\"&lt;null&gt;\"); continue; }\n        assert(word-&gt;start &lt;= word-&gt;end);\n        if(word-&gt;start == word-&gt;end) { printf(\"&lt;empty&gt;\"); continue; }\n        printf(\"&lt;%.*s&gt;\", (int)(word-&gt;end - word-&gt;start), word-&gt;start);\n    }\n    fputc('\\n', stdout);\n}\nstatic void expand_word(struct Parser *const parser,\n    const struct Lexer *const lexer) {\n    assert(parser &amp;&amp; lexer &amp;&amp; lexer-&gt;from &lt; lexer-&gt;cursor);\n    if(!parser-&gt;start_words) {\n        assert(!parser-&gt;end_words);\n        parser-&gt;start_words = lexer-&gt;from;\n    }\n    parser-&gt;end_words = (lexer-&gt;from + INT_MAX &gt;= lexer-&gt;cursor) ?\n        lexer-&gt;cursor : lexer-&gt;from + INT_MAX;\n}\nstatic int store_word(struct Parser *const parser) {\n    struct Word *word;\n    assert(parser);\n    if(parser-&gt;num_words &gt;= parser_max_words) return errno = EILSEQ, 0;\n    word = parser-&gt;words + parser-&gt;num_words++;\n    word-&gt;start = parser-&gt;start_words;\n    word-&gt;end = parser-&gt;end_words;\n    parser-&gt;start_words = parser-&gt;end_words = 0;\n    return 1;\n}\n\nint main(int argc, char **argv) {\n    const size_t granularity = 1024;\n    struct Lexer lexer = { 1, 0, 0, 0 };\n    struct Parser parser;\n    size_t nread;\n    struct Buffer buf = { 0, 0, 0 };\n    char *b;\n    FILE *fp = 0;\n    int success = 0, end_of_buffer = 0;\n\n    /* Open. */\n    if(argc != 2) return fprintf(stderr, \"Needs filename.\\n\"), EXIT_FAILURE;\n    if(!(fp = fopen(argv[1], \"r\"))) goto catch;\n\n    /* Read. */\n    do {\n        if(!(b = buffer_reserve(&amp;buf, granularity))) goto catch;\n        nread = fread(b, 1, granularity, fp);\n        buf.size += nread;\n    } while(nread == granularity);\n    if(ferror(fp)) goto catch;\n    fclose(fp), fp = 0;\n    if(!(b = buffer_reserve(&amp;buf, 1))) goto catch;\n    *b = '\\0'; /* Make sure it's a string. */\n\n    /* Parse. */\n    lexer.cursor = buf.data;\n    clear_parser(&amp;parser);\n    do {\n        enum Token tok;\n        switch((tok = lex(&amp;lexer))) {\n        case ERROR: goto catch;\n        case END: end_of_buffer = 1; break;\n        case COMMA:\n            if(!parser.id_set) { errno = EILSEQ; goto catch; }\n            if(parser.first_comma) { parser.first_comma = 0; break; }\n            if(!store_word(&amp;parser)) goto catch;\n            break;\n        case NEWLINE:\n            if(parser.id_set) {\n                /* We require at least key, data. */\n                if(!store_word(&amp;parser)) goto catch;\n                print_parser(&amp;parser);\n                clear_parser(&amp;parser);\n            } else if(parser.start_words) {\n                errno = EILSEQ; goto catch;\n            }\n            break;\n        case ESCAPE:\n            if(!parser.id_set) { errno = EILSEQ; goto catch; }\n            expand_word(&amp;parser, &amp;lexer);\n            break;\n        case WSP: break;\n        case NUMBER:\n            if(parser.id_set) {\n                expand_word(&amp;parser, &amp;lexer);\n            } else {\n                char *end;\n                long i = strtol(lexer.from, &amp;end, 0);\n                if(end != lexer.cursor || i &lt; INT_MIN || i &gt; INT_MAX)\n                    { errno = EDOM; goto catch; }\n                parser.id = (int)i;\n                parser.id_set = 1;\n            }\n            break;\n        case WORD:\n            expand_word(&amp;parser, &amp;lexer);\n            break;\n        }\n    } while(!end_of_buffer);\n    success = EXIT_SUCCESS;\n    goto finally;\ncatch:\n    fprintf(stderr, \"While on line %lu.\\n\", (unsigned long)lexer.line);\n    perror(\"parsing\");\n    assert(!lexer.from || (lexer.from &lt; lexer.cursor\n        &amp;&amp; lexer.from + INT_MAX &gt;= lexer.cursor));\n    if(lexer.from) fprintf(stderr, \"While on %.*s.\\n\",\n        (int)(lexer.cursor - lexer.from), lexer.from);\nfinally:\n    free(buf.data);\n    if(fp) fclose(fp);\n    return success;\n}\n</code></pre>\n\n<p>Prints,</p>\n\n<pre><code>#2409: &lt;blah&gt;, &lt;blah&gt;, &lt;blah&gt;\n#16: &lt;foo&gt;, &lt;bar&gt;, &lt;baz&gt;, &lt;qux&gt;\n#8: &lt;a\\\na&gt;, &lt;b  b\\#\\\\\\,still b&gt;, &lt;c&gt;\n</code></pre>\n\n<p>but that's probably overkill.</p>\n"}, {"tags": [], "owner": {"reputation": 143, "user_id": 4669014, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/02a1c77bdede7ba0c7f7f2e9b5396a15?s=128&d=identicon&r=PG&f=1", "display_name": "Polecalex", "link": "https://stackoverflow.com/users/4669014/polecalex"}, "is_accepted": true, "score": 1, "last_activity_date": 1576722266, "creation_date": 1576722266, "answer_id": 59402519, "question_id": 59395268, "link": "https://stackoverflow.com/questions/59395268/split-string-into-two-variables-in-c/59402519#59402519", "title": "Split string into two variables in C", "body": "<p>As @HAL9000 mentioned, I was able to complete this by using sscanf. Simply extracting the integer and string from the line using <code>sscanf(line, \"%d %[^\\n]s\", &amp;ID, details);</code></p>\n\n<p>I did try using strtok however, couldn't get my head around it as it wasn't working. sscanf was the easiest to do so this is what I am going to use, thanks.</p>\n"}, {"tags": [], "owner": {"reputation": 398, "user_id": 5871187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hu64h.jpg?s=128&g=1", "display_name": "S Dao", "link": "https://stackoverflow.com/users/5871187/s-dao"}, "is_accepted": false, "score": 0, "last_activity_date": 1576836960, "creation_date": 1576836960, "answer_id": 59423524, "question_id": 59395268, "link": "https://stackoverflow.com/questions/59395268/split-string-into-two-variables-in-c/59423524#59423524", "title": "Split string into two variables in C", "body": "<p>Using <code>sscanf</code></p>\n\n<p>e.g</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>int main(int argc, char *argv[]) {\n    const char *str = \"123, this, is, a test ;@#\";\n    char buff[128] = {0};\n    int num = 0;\n\n    if (2 == sscanf(str, \"%d,%[^\\r\\n]s\", &amp;num, buff))\n        printf(\"== num: %d, string: '%s'\\n\", num, buff);\n    else\n        printf(\"== Wrong!\\n\");\n    return 0;\n}\n</code></pre>\n\n<p>result: <code>== num: 123, string: ' this, is, a test ;@#'</code></p>\n"}], "owner": {"reputation": 143, "user_id": 4669014, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/02a1c77bdede7ba0c7f7f2e9b5396a15?s=128&d=identicon&r=PG&f=1", "display_name": "Polecalex", "link": "https://stackoverflow.com/users/4669014/polecalex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 517, "favorite_count": 1, "accepted_answer_id": 59402519, "answer_count": 4, "score": 1, "last_activity_date": 1576836960, "creation_date": 1576682964, "question_id": 59395268, "link": "https://stackoverflow.com/questions/59395268/split-string-into-two-variables-in-c", "title": "Split string into two variables in C", "body": "<p>I have been givin an assignment which uses C to read a given file and input data into a binary tree. My current problem is splitting the line read from the file into two different variables.</p>\n\n<p>The file that has been given contains two bits of data, an ID and some information. <code>2409, blah, blah, blah</code></p>\n\n<p>Currently, the program is reading the file correctly and storing each line and then displaying it. I have tried to use token's, memmove and trying to simply select the characters manually however this needs to be dynamic. The ID is not a fixed amount of numbers so manually selecting it will not work. As mentioned, I have tried to use strtok using \", \" as a delimited however it just doesn't change anything.</p>\n\n<p>This is currently what I am using to display the information, I intent to split the string within the while loop for each line:</p>\n\n<pre><code>int main() {\n\n    struct node* root = NULL;\n\n    FILE *file;\n    char filename[15];\n    char buff[255];\n    char line[128];\n\n    strcpy(filename, \"file.txt\");\n\n    file = fopen(filename, \"r\");\n    if (file == NULL) {\n        printf(\"File could not be openned.\\n\");\n        exit(0);\n    }\n\n    while (line != NULL)\n    {\n        strcpy(line, fgets(buff, 255, file));\n\n        printf(\"%s\", line);\n    }\n    fclose(file);\n}\n</code></pre>\n\n<p>Is there any way that I am able to simply select the first characters up to the first occurance of \",\" and convert them into an integer. Then select the rest of the data removing the first \"ID, \" and insert that into a char variable.</p>\n\n<p>Your help is greatly appreciated.</p>\n"}, {"tags": ["python", "c++", "c", "python-c-api"], "comments": [{"owner": {"reputation": 23048, "user_id": 4657412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4915a27d01efa79d81d322511ee517a9?s=128&d=identicon&r=PG&f=1", "display_name": "DavidW", "link": "https://stackoverflow.com/users/4657412/davidw"}, "edited": false, "score": 1, "creation_date": 1576773974, "post_id": 59395037, "comment_id": 105015024, "body": "It doesn&#39;t look like you have the right version of MSVC installed: <a href=\"https://wiki.python.org/moin/WindowsCompilers\" rel=\"nofollow noreferrer\">wiki.python.org/moin/WindowsCompilers</a>. I don&#39;t know exactly what error to expect from this but it seems a plausible cause."}, {"owner": {"reputation": 380, "user_id": 1774707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f1f919c8e23436bc8a2177afef92c44?s=128&d=identicon&r=PG", "display_name": "user42723", "link": "https://stackoverflow.com/users/1774707/user42723"}, "reply_to_user": {"reputation": 23048, "user_id": 4657412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4915a27d01efa79d81d322511ee517a9?s=128&d=identicon&r=PG&f=1", "display_name": "DavidW", "link": "https://stackoverflow.com/users/4657412/davidw"}, "edited": false, "score": 0, "creation_date": 1576883701, "post_id": 59395037, "comment_id": 105050270, "body": "@DavidW Good point, but that didn&#39;t seem to be the problem."}, {"owner": {"reputation": 23048, "user_id": 4657412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4915a27d01efa79d81d322511ee517a9?s=128&d=identicon&r=PG&f=1", "display_name": "DavidW", "link": "https://stackoverflow.com/users/4657412/davidw"}, "edited": false, "score": 0, "creation_date": 1576926297, "post_id": 59395037, "comment_id": 105055834, "body": "Glad you got it sorted. I&#39;m a little surprised that linking to the debug dll would cause it to crash, but if it works then go with it."}, {"owner": {"reputation": 380, "user_id": 1774707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f1f919c8e23436bc8a2177afef92c44?s=128&d=identicon&r=PG", "display_name": "user42723", "link": "https://stackoverflow.com/users/1774707/user42723"}, "reply_to_user": {"reputation": 23048, "user_id": 4657412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4915a27d01efa79d81d322511ee517a9?s=128&d=identicon&r=PG&f=1", "display_name": "DavidW", "link": "https://stackoverflow.com/users/4657412/davidw"}, "edited": false, "score": 1, "creation_date": 1576927779, "post_id": 59395037, "comment_id": 105056071, "body": "@DavidW It seems the structs have different members in the debug build. <a href=\"https://github.com/python/cpython/blob/f522a6ddb67a238bab5673608111f74ec4e22205/Include/object.h#L68\" rel=\"nofollow noreferrer\">For example here</a>. This also explains the &quot;Type does not define the tp_name field&quot; error."}], "answers": [{"tags": [], "owner": {"reputation": 380, "user_id": 1774707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f1f919c8e23436bc8a2177afef92c44?s=128&d=identicon&r=PG", "display_name": "user42723", "link": "https://stackoverflow.com/users/1774707/user42723"}, "is_accepted": true, "score": 1, "last_activity_date": 1576883364, "creation_date": 1576883364, "answer_id": 59432233, "question_id": 59395037, "link": "https://stackoverflow.com/questions/59395037/python-c-api-access-violation-when-trying-example-module-with-msvc/59432233#59432233", "title": "Python C API: Access Violation when trying example module with MSVC", "body": "<p>I found the solution: I need to build in release mode instead of debug mode and link to python37.lib instead of python37_d.lib.</p>\n"}], "owner": {"reputation": 380, "user_id": 1774707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f1f919c8e23436bc8a2177afef92c44?s=128&d=identicon&r=PG", "display_name": "user42723", "link": "https://stackoverflow.com/users/1774707/user42723"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 59432233, "answer_count": 1, "score": 0, "last_activity_date": 1576883364, "creation_date": 1576682200, "question_id": 59395037, "link": "https://stackoverflow.com/questions/59395037/python-c-api-access-violation-when-trying-example-module-with-msvc", "title": "Python C API: Access Violation when trying example module with MSVC", "body": "<p>I'm making a Python module in C++. Until now I used MingW to compile the module, which worked fine. But I want to switch to MSVC because an other library that I use is easier to use with MSVC.</p>\n\n<p>But, I cannot get it to work. Compiling and linking works, but problems arise when I try to use the newly created module from Python. I get the error <code>SystemError: Type does not define the tp_name field.</code> when I call <code>PyType_Ready</code>. In the source code of Python I see that this error is reported when <code>tp_name</code> is null, but I checked that it is not null.</p>\n\n<p>My module is too big to debug, so I tried the <a href=\"https://docs.python.org/3.7/extending/newtypes_tutorial.html\" rel=\"nofollow noreferrer\">example module</a> of the Python documentation instead, which gives a different problem. Here my files and the output of <code>run.bat</code>.</p>\n\n<h1>custom.c</h1>\n\n<pre><code>#define PY_SSIZE_T_CLEAN\n#include &lt;Python.h&gt;\n\ntypedef struct {\n    PyObject_HEAD\n    /* Type-specific fields go here. */\n} CustomObject;\n\nstatic PyTypeObject CustomType = {\n    PyVarObject_HEAD_INIT(NULL, 0)\n    .tp_name = \"custom.Custom\",\n    .tp_doc = \"Custom objects\",\n    .tp_basicsize = sizeof(CustomObject),\n    .tp_itemsize = 0,\n    .tp_flags = Py_TPFLAGS_DEFAULT,\n    .tp_new = PyType_GenericNew,\n};\n\nstatic PyModuleDef custommodule = {\n    PyModuleDef_HEAD_INIT,\n    .m_name = \"custom\",\n    .m_doc = \"Example module that creates an extension type.\",\n    .m_size = -1,\n};\n\nPyMODINIT_FUNC\nPyInit_custom(void)\n{\n    PyObject *m;\n    if (PyType_Ready(&amp;CustomType) &lt; 0)\n        return NULL;\n\n    m = PyModule_Create(&amp;custommodule);\n    if (m == NULL)\n        return NULL;\n\n    Py_INCREF(&amp;CustomType);\n    if (PyModule_AddObject(m, \"Custom\", (PyObject *) &amp;CustomType) &lt; 0) {\n        Py_DECREF(&amp;CustomType);\n        Py_DECREF(m);\n        return NULL;\n    }\n\n    return m;\n}\n</code></pre>\n\n<h1>CMakeLists.txt</h1>\n\n<pre><code>cmake_minimum_required(VERSION 3.15)\n\nproject(module)\n\nadd_library(module SHARED custom.c)\n\ntarget_include_directories(module PRIVATE \"C:/Program Files/Python37/include\")\ntarget_link_libraries(module \"C:/Program Files/Python37/libs/python37_d.lib\")\n\n# Output name\nset_target_properties(module PROPERTIES PREFIX \"\")\nset_target_properties(module PROPERTIES OUTPUT_NAME \"custom\")\nset_target_properties(module PROPERTIES SUFFIX \".pyd\")\n</code></pre>\n\n<h1>run.bat</h1>\n\n<pre><code>@echo off\necho ----- Compiling -----\ncmake .\ncmake --build .\necho.\necho ----- Running -----\npython -c \"import sys; sys.path.append('Debug'); import custom; print('ok')\"\necho Error code: %errorlevel%\n</code></pre>\n\n<h1>Output</h1>\n\n<pre><code>Microsoft Windows [Version 10.0.17763.914]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\x\\pythontest&gt;run\n----- Compiling -----\n-- Building for: Visual Studio 16 2019\n-- Selecting Windows SDK version 10.0.18362.0 to target Windows 10.0.17763.\n-- The C compiler identification is MSVC 19.24.28314.0\n-- The CXX compiler identification is MSVC 19.24.28314.0\n-- Check for working C compiler: H:/Program Files (x86)/Microsoft Visual Studio/2019/Community/VC/Tools/MSVC/14.24.28314/bin/Hostx64/x64/cl.exe\n-- Check for working C compiler: H:/Program Files (x86)/Microsoft Visual Studio/2019/Community/VC/Tools/MSVC/14.24.28314/bin/Hostx64/x64/cl.exe -- works\n-- Detecting C compiler ABI info\n-- Detecting C compiler ABI info - done\n-- Detecting C compile features\n-- Detecting C compile features - done\n-- Check for working CXX compiler: H:/Program Files (x86)/Microsoft Visual Studio/2019/Community/VC/Tools/MSVC/14.24.28314/bin/Hostx64/x64/cl.exe\n-- Check for working CXX compiler: H:/Program Files (x86)/Microsoft Visual Studio/2019/Community/VC/Tools/MSVC/14.24.28314/bin/Hostx64/x64/cl.exe -- works\n-- Detecting CXX compiler ABI info\n-- Detecting CXX compiler ABI info - done\n-- Detecting CXX compile features\n-- Detecting CXX compile features - done\n-- Configuring done\n-- Generating done\n-- Build files have been written to: C:/x/pythontest\nMicrosoft (R) Build Engine version 16.4.0+e901037fe for .NET Framework\nCopyright (C) Microsoft Corporation. All rights reserved.\n\n  Checking Build System\n  Building Custom Rule C:/x/pythontest/CMakeLists.txt\n  custom.c\n     Creating library C:/x/pythontest/Debug/custom.lib and object C:/x/pythontest/Debug/custom.exp\n  module.vcxproj -&gt; C:\\x\\pythontest\\Debug\\custom.pyd\n  Building Custom Rule C:/x/pythontest/CMakeLists.txt\n\n----- Running -----\nError code: -1073741819\n</code></pre>\n\n<p>Error code -1073741819 is 0xC0000005, which is Access Violation. So the example code crashes. This is a different error as with my own module, but it probably has the same cause. What am I doing wrong?</p>\n"}, {"tags": ["c", "macros"], "comments": [{"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 4, "creation_date": 1576681272, "post_id": 59394700, "comment_id": 104978756, "body": "...and what happens to the part of code that uses that variable if you add a line before the variable declaration ...."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 3, "creation_date": 1576681273, "post_id": 59394700, "comment_id": 104978758, "body": "What happens if you use the macro in two different source file, and it just happens to be at the same line in both? You can&#39;t have two different variables with the same name in multiple translation units."}, {"owner": {"reputation": 33, "user_id": 12540706, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EKuRy9Fz_CY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcTPBasCwTQ5_-TTaaUlMw621nXMg/photo.jpg?sz=128", "display_name": "Wayne Xiong", "link": "https://stackoverflow.com/users/12540706/wayne-xiong"}, "reply_to_user": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 0, "creation_date": 1576681467, "post_id": 59394700, "comment_id": 104978875, "body": "@LPs Actually, I will not use the variable directly, it will generated data in the compiled target, I will read the data directly from the target. I name the variable just to meet the requirement of the compiler."}, {"owner": {"reputation": 33, "user_id": 12540706, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EKuRy9Fz_CY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcTPBasCwTQ5_-TTaaUlMw621nXMg/photo.jpg?sz=128", "display_name": "Wayne Xiong", "link": "https://stackoverflow.com/users/12540706/wayne-xiong"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1576681600, "post_id": 59394700, "comment_id": 104978944, "body": "@Someprogrammerdude That&#39;s a good question. I suppose usually it won&#39;t happen. Any suggestion? Actually I don&#39;t care the name, but the compiler doesn&#39;t allow duplication."}, {"owner": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1576681739, "post_id": 59394700, "comment_id": 104979025, "body": "@someprogrammerdude:   You can have two different variables with the same name if they&#39;re both <code>static</code> (eg, local to the translation unit), right?"}], "answers": [{"tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": false, "score": 1, "last_activity_date": 1576681675, "creation_date": 1576681675, "answer_id": 59394865, "question_id": 59394700, "link": "https://stackoverflow.com/questions/59394700/is-it-possible-to-use-line-in-the-auto-generated-variable-name-in-c/59394865#59394865", "title": "Is it possible to use __LINE__ in the auto-generated variable name in C?", "body": "<p>This works:</p>\n\n<pre><code>#define CAT_(A,B) A##B\n#define CAT(A,B) CAT_(A,B)\n\n\n#define ROUTE(path, impl) \\\n    char * CAT(CAT(k##impl,__LINE__),_route) = \"{\"#path\":\\\"\"#impl\"\\\"}\";\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "is_accepted": true, "score": 2, "last_activity_date": 1576681868, "creation_date": 1576681868, "answer_id": 59394928, "question_id": 59394700, "link": "https://stackoverflow.com/questions/59394700/is-it-possible-to-use-line-in-the-auto-generated-variable-name-in-c/59394928#59394928", "title": "Is it possible to use __LINE__ in the auto-generated variable name in C?", "body": "<p>You need one more level of nesting:</p>\n\n<pre><code>#define ROUTE(path, impl) ROUTE_(path, impl, __LINE__)\n\n#define ROUTE_(path, impl, line) ROUTE_1(path, impl, line)\n\n#define ROUTE_1(path, impl, line) \\\n    char * k##impl##line##_route = \"{\"#path\":\\\"\"#impl\"\\\"}\";\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "is_accepted": false, "score": 1, "last_activity_date": 1576682486, "creation_date": 1576682486, "answer_id": 59395124, "question_id": 59394700, "link": "https://stackoverflow.com/questions/59394700/is-it-possible-to-use-line-in-the-auto-generated-variable-name-in-c/59395124#59395124", "title": "Is it possible to use __LINE__ in the auto-generated variable name in C?", "body": "<p>If you're not using the variable try <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.5.2.5\" rel=\"nofollow noreferrer\">\"compound literals\"</a></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;time.h&gt;\n\nint main(void) {\n    // using preprocessor 'trick'\n    struct tm uniquenamewith__LINE__inthename = {0};\n    uniquenamewith__LINE__inthename.tm_year = 2019 - 1900;\n    uniquenamewith__LINE__inthename.tm_mon = 12 - 1;\n    uniquenamewith__LINE__inthename.tm_mday = 18;\n    time_t foo = mktime(&amp;uniquenamewith__LINE__inthename);\n\n    // using compound literal\n    time_t bar = mktime(&amp;(struct tm){.tm_year=2019-1900, .tm_mon=12-1, .tm_mday=18});\n\n    printf(\"foo is %lu, bar is %lu\\n\", (unsigned long)foo, (unsigned long)bar);\n    return 0;\n}\n</code></pre>\n\n<p>See <a href=\"https://ideone.com/zJxxNz\" rel=\"nofollow noreferrer\">code running on ideone</a></p>\n"}], "owner": {"reputation": 33, "user_id": 12540706, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EKuRy9Fz_CY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcTPBasCwTQ5_-TTaaUlMw621nXMg/photo.jpg?sz=128", "display_name": "Wayne Xiong", "link": "https://stackoverflow.com/users/12540706/wayne-xiong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 59394928, "answer_count": 3, "score": 2, "last_activity_date": 1576682486, "creation_date": 1576681132, "last_edit_date": 1576681803, "question_id": 59394700, "link": "https://stackoverflow.com/questions/59394700/is-it-possible-to-use-line-in-the-auto-generated-variable-name-in-c", "title": "Is it possible to use __LINE__ in the auto-generated variable name in C?", "body": "<p>To avoid duplication, I want to use <code>__LINE__</code> in the auto-generated variable name.</p>\n\n<pre><code>#define ROUTE(path, impl) \\\nchar * k##impl##__LINE__##_route = \"{\"#path\":\\\"\"#impl\"\\\"}\";\n</code></pre>\n\n<p>But it always be treated as a normal string <code>__LINE__</code>.</p>\n\n<p>Even if I define it as the following, I can not get what I want:</p>\n\n<pre><code>#define ROUTE(path, impl) ROUTE_(path, impl, __LINE__)\n\n#define ROUTE_(path, impl, line) \\\nchar * k##impl##line##_route = \"{\"#path\":\\\"\"#impl\"\\\"}\";\n</code></pre>\n"}, {"tags": ["c", "unit-testing", "googletest"], "comments": [{"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 0, "creation_date": 1576860016, "post_id": 59394613, "comment_id": 105043232, "body": "Rather than stubbing out <code>fopen</code>, consider an alternative approach: separate logic and file IO as much as possible. Write unit tests for your logic code, and write <i>integration tests</i> for your logic + IO code. This way allows you to avoid the added complexity that mocking carries."}, {"owner": {"reputation": 47, "user_id": 11877100, "user_type": "registered", "profile_image": "https://graph.facebook.com/2362160460737963/picture?type=large", "display_name": "Ti\u1ebfn TeoCri", "link": "https://stackoverflow.com/users/11877100/ti%e1%ba%bfn-teocri"}, "reply_to_user": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 0, "creation_date": 1577093882, "post_id": 59394613, "comment_id": 105087773, "body": "Can you give me a example ?"}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 11877100, "user_type": "registered", "profile_image": "https://graph.facebook.com/2362160460737963/picture?type=large", "display_name": "Ti\u1ebfn TeoCri", "link": "https://stackoverflow.com/users/11877100/ti%e1%ba%bfn-teocri"}, "edited": false, "score": 0, "creation_date": 1577093904, "post_id": 59428522, "comment_id": 105087781, "body": "Can you give me a example ?"}, {"owner": {"reputation": 2333, "user_id": 6783775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d399a7e1545b42ae65bca9b4568099a?s=128&d=identicon&r=PG", "display_name": "rveerd", "link": "https://stackoverflow.com/users/6783775/rveerd"}, "reply_to_user": {"reputation": 47, "user_id": 11877100, "user_type": "registered", "profile_image": "https://graph.facebook.com/2362160460737963/picture?type=large", "display_name": "Ti\u1ebfn TeoCri", "link": "https://stackoverflow.com/users/11877100/ti%e1%ba%bfn-teocri"}, "edited": false, "score": 0, "creation_date": 1577105440, "post_id": 59428522, "comment_id": 105092456, "body": "Sure. I have edited my answer and added an example."}, {"owner": {"reputation": 47, "user_id": 11877100, "user_type": "registered", "profile_image": "https://graph.facebook.com/2362160460737963/picture?type=large", "display_name": "Ti\u1ebfn TeoCri", "link": "https://stackoverflow.com/users/11877100/ti%e1%ba%bfn-teocri"}, "edited": false, "score": 0, "creation_date": 1577114788, "post_id": 59428522, "comment_id": 105096577, "body": "stub.c function still be used ?. ASSERT_NE(NULL, file(&amp;my_fopen)); ???. I still confuse ."}, {"owner": {"reputation": 2333, "user_id": 6783775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d399a7e1545b42ae65bca9b4568099a?s=128&d=identicon&r=PG", "display_name": "rveerd", "link": "https://stackoverflow.com/users/6783775/rveerd"}, "reply_to_user": {"reputation": 47, "user_id": 11877100, "user_type": "registered", "profile_image": "https://graph.facebook.com/2362160460737963/picture?type=large", "display_name": "Ti\u1ebfn TeoCri", "link": "https://stackoverflow.com/users/11877100/ti%e1%ba%bfn-teocri"}, "edited": false, "score": 0, "creation_date": 1577171700, "post_id": 59428522, "comment_id": 105110345, "body": "Yes, if you do not want to actually call the <code>fopen()</code> system function but your own mock function."}, {"owner": {"reputation": 47, "user_id": 11877100, "user_type": "registered", "profile_image": "https://graph.facebook.com/2362160460737963/picture?type=large", "display_name": "Ti\u1ebfn TeoCri", "link": "https://stackoverflow.com/users/11877100/ti%e1%ba%bfn-teocri"}, "edited": false, "score": 0, "creation_date": 1577282160, "post_id": 59428522, "comment_id": 105135031, "body": "I have tested as you guild, but it not success, you can give me full code example for it, please.THANKS"}], "tags": [], "owner": {"reputation": 2333, "user_id": 6783775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d399a7e1545b42ae65bca9b4568099a?s=128&d=identicon&r=PG", "display_name": "rveerd", "link": "https://stackoverflow.com/users/6783775/rveerd"}, "is_accepted": true, "score": 1, "last_activity_date": 1577105410, "last_edit_date": 1577105410, "creation_date": 1576859383, "answer_id": 59428522, "question_id": 59394613, "link": "https://stackoverflow.com/questions/59394613/stub-system-function-in-google-test/59428522#59428522", "title": "Stub system function in google test", "body": "<p>Your <code>file()</code> function in <code>sample.c</code> calls <code>fopen()</code>. Defining <code>fopen</code> as something else in a totally different file (<em>compilation unit</em>) is not going to change that.</p>\n\n<p>You cannot simply <a href=\"https://github.com/google/googletest/blob/master/googlemock/docs/cook_book.md#mocking-free-functions\" rel=\"nofollow noreferrer\">mock a free function</a>.</p>\n\n<p>You can change the <code>file()</code> function to take a pointer to the <code>fopen()</code> function to use. In your tests you then provide a pointer to your mock function when calling the <code>file()</code> function. This is a form of <em>dependency injection</em>.</p>\n\n<p>Another option is to use conditional compilation.</p>\n\n<p>An example of using dependency injection:</p>\n\n<pre><code>// Typedef for our \"fopen interface\". Makes our code a bit more readable.\ntypedef FILE *(*fopen_type)(const char *, const char *);\n\nFILE *file(fopen_type fopen_func)\n{\n    FILE *f = fopen_func(\"abc\", \"r\"); // Call the provided \"fopen\" function.\n    return f; // Let's return the opened file or `NULL`.\n}\n</code></pre>\n\n<p>And then in your test code:</p>\n\n<pre><code>TEST(OPEN_FILE, OK)\n{\n    ASSERT_NE(NULL, file(&amp;my_fopen));\n}\n</code></pre>\n\n<p>If you use many system functions that you want to mock, you can also create a struct that contains pointers to all the relevant functions.</p>\n\n<pre><code>struct system_calls {\n   fopen_type fopen;\n   // Add more system calls here.\n};\n\nFILE *file(struct system_calls *p)\n{\n    FILE *f = p-&gt;fopen(\"abc\", \"r\");\n    return f;\n}\n</code></pre>\n\n<p>The premise here is that if you want to test your code, you need to write <em>testable code</em>. Dependency injection is one way to achieve that.</p>\n"}], "owner": {"reputation": 47, "user_id": 11877100, "user_type": "registered", "profile_image": "https://graph.facebook.com/2362160460737963/picture?type=large", "display_name": "Ti\u1ebfn TeoCri", "link": "https://stackoverflow.com/users/11877100/ti%e1%ba%bfn-teocri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 671, "favorite_count": 0, "accepted_answer_id": 59428522, "answer_count": 1, "score": 1, "last_activity_date": 1577589343, "creation_date": 1576680814, "last_edit_date": 1577589343, "question_id": 59394613, "link": "https://stackoverflow.com/questions/59394613/stub-system-function-in-google-test", "title": "Stub system function in google test", "body": "<blockquote>\n  <p>I am trying to use Google Test to test C code but I am encounter some problem related to write stub for system functions like: fopen,fclose,fread,fwrite, memcpy,memset,stat,...I don't known how to stub them correctly to cover all branchs in function that need to be tested.</p>\n</blockquote>\n\n<p>Example , I have a function, how to test it by stub fopen, fclose, fwrite, fread?\nOnly Stub, not Mock.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(){\n    FILE *f;\n    //initialize the arr1 with values\n    int arr1[5]={1,2,3,4,5};\n    int arr2[5];\n    int i=0;\n\n    //open the file for write operation\n    if((f=fopen(\"includehelp.txt\",\"w\"))==NULL){\n        //if the file does not exist print the string\n        printf(\"Cannot open the file...\");\n        exit(1);\n    }\n    //write the values on the file\n    if((fwrite(arr1,sizeof(int),5,f))!=5){\n        printf(\"File write error....\\n\");\n    }\n    //close the file\n    fclose(f);\n\n    //open the file for read operation\n    if((f=fopen(\"includehelp.txt\",\"r\"))==NULL){\n        //if the file does not exist print the string\n        printf(\"Cannot open the file...\");\n        exit(1);\n    }\n    //read the values from the file and store it into the array\n    if((fread(arr2,sizeof(int),5,f))!=5){\n        printf(\"File write error....\\n\");\n    }\n    fclose(f);\n\n    printf(\"The array content is-\\n\");\n    for(i=0;i&lt;5;i++){\n        printf(\"%d\\n\",arr2[i]);\n    }\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "gdb"], "comments": [{"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 2, "creation_date": 1576679985, "post_id": 59394339, "comment_id": 104977966, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/9568201/gdb-show-typeinfo-of-some-data\">gdb: show typeinfo of some data</a>"}, {"owner": {"reputation": 33, "user_id": 3746400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/424136efc4a59f0cab07ffa3d8a9cd40?s=128&d=identicon&r=PG&f=1", "display_name": "Gandhal", "link": "https://stackoverflow.com/users/3746400/gandhal"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1576680074, "post_id": 59394339, "comment_id": 104978019, "body": "No, it doesn&#39;t. I have already seen this answer. I want to have the type of the variable as a string for automatic usage, I don&#39;t want to copy it by hand."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1576680112, "post_id": 59394339, "comment_id": 104978037, "body": "What is the <i>actual</i> problem you need to solve? Why do you need the type as a string in a debugger variable? It&#39;s okay if it&#39;s just for curiosity (but then please state it in the question), otherwise it&#39;s better to ask about the problem you have directly instead of asking about a possible solution. Please read about <a href=\"https://en.wikipedia.org/wiki/XY_problem\" rel=\"nofollow noreferrer\">the XY problem</a>, and think about how it relates to your question."}, {"owner": {"reputation": 33, "user_id": 3746400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/424136efc4a59f0cab07ffa3d8a9cd40?s=128&d=identicon&r=PG&f=1", "display_name": "Gandhal", "link": "https://stackoverflow.com/users/3746400/gandhal"}, "edited": false, "score": 0, "creation_date": 1576680339, "post_id": 59394339, "comment_id": 104978166, "body": "I have a group of functions in my program that change name according to the type they serve (I know it&#39;s not remotely the best way to do this, but I cannot change that). I want to write a gdb function which I can feed with just the variable and the rest will be done automatically, without my intevention. Preferably, I would also like to avoid a wall of if/else if"}, {"owner": {"reputation": 4732, "user_id": 8477999, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f8172e1919af53269de92316dcf03a03?s=128&d=identicon&r=PG&f=1", "display_name": "Gem Taylor", "link": "https://stackoverflow.com/users/8477999/gem-taylor"}, "edited": false, "score": 1, "creation_date": 1576681115, "post_id": 59394339, "comment_id": 104978640, "body": "Just to be clear, given a pointer p, of type <code>MyCarType</code>, you want a way in gdb to infer the name <code>polymethod_MyCarType(MyCarType* ptr)</code> ?"}, {"owner": {"reputation": 33, "user_id": 3746400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/424136efc4a59f0cab07ffa3d8a9cd40?s=128&d=identicon&r=PG&f=1", "display_name": "Gandhal", "link": "https://stackoverflow.com/users/3746400/gandhal"}, "edited": false, "score": 0, "creation_date": 1576681185, "post_id": 59394339, "comment_id": 104978693, "body": "Yes, that is exactly what I want."}, {"owner": {"reputation": 27546, "user_id": 6266, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/398efb709eb606ef79ee6436f55f93bd?s=128&d=identicon&r=PG", "display_name": "Fire Lancer", "link": "https://stackoverflow.com/users/6266/fire-lancer"}, "edited": false, "score": 0, "creation_date": 1576681202, "post_id": 59394339, "comment_id": 104978707, "body": "Still not really sure what you are getting at. <code>ptype myvariable</code> will give you a type name for the variable type. But things like <code>std::string</code> vs <code>std::basic_string&lt;...&gt;</code> and so forth can make any such names in C++ sometimes confusing."}, {"owner": {"reputation": 33, "user_id": 3746400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/424136efc4a59f0cab07ffa3d8a9cd40?s=128&d=identicon&r=PG&f=1", "display_name": "Gandhal", "link": "https://stackoverflow.com/users/3746400/gandhal"}, "edited": false, "score": 0, "creation_date": 1576681246, "post_id": 59394339, "comment_id": 104978740, "body": "(well, maybe also <code>polymethod_MyCarType_withextension(MyCarType* ptr)</code>...) :)"}, {"owner": {"reputation": 33, "user_id": 3746400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/424136efc4a59f0cab07ffa3d8a9cd40?s=128&d=identicon&r=PG&f=1", "display_name": "Gandhal", "link": "https://stackoverflow.com/users/3746400/gandhal"}, "reply_to_user": {"reputation": 27546, "user_id": 6266, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/398efb709eb606ef79ee6436f55f93bd?s=128&d=identicon&r=PG", "display_name": "Fire Lancer", "link": "https://stackoverflow.com/users/6266/fire-lancer"}, "edited": false, "score": 0, "creation_date": 1576681347, "post_id": 59394339, "comment_id": 104978800, "body": "@FireLancer Yes, what you say is true, but in my current problem I am only dealing with C structs. Maybe I should remove the C++ tag."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 3746400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/424136efc4a59f0cab07ffa3d8a9cd40?s=128&d=identicon&r=PG&f=1", "display_name": "Gandhal", "link": "https://stackoverflow.com/users/3746400/gandhal"}, "edited": false, "score": 0, "creation_date": 1576683633, "post_id": 59395159, "comment_id": 104980126, "body": "It may need some tweaking, but I think I can work with this. I&#39;ll get back to you later. Thanks!"}, {"owner": {"reputation": 33, "user_id": 3746400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/424136efc4a59f0cab07ffa3d8a9cd40?s=128&d=identicon&r=PG&f=1", "display_name": "Gandhal", "link": "https://stackoverflow.com/users/3746400/gandhal"}, "edited": false, "score": 0, "creation_date": 1576685234, "post_id": 59395159, "comment_id": 104981076, "body": "Thankfully, my gdb does support the <code>python</code> scripting extensions.  In the end, this is what provides what I need:  <code>eval &quot;python gdb.execute(\\&quot;set $_type_=\\\\\\&quot;\\&quot;+(gdb.execute(\\&quot;whatis $arg0\\&quot;, False, True)).strip()+\\&quot;\\\\\\&quot;\\&quot;)&quot;</code>  And I call it like this:  <code>type2var myvar</code>  <code>print $_type_</code>  <code>$1 = &quot;type = char [32]&quot;</code>  As you can see, I am ok with pre-naming the local variable <code>$_type_</code>.  I have not researched what the <code>True</code> and <code>False</code> arguments define, but since it works, I suppose it&#39;s not that important.  Thanks a lot for the swift reply!"}], "tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": true, "score": 1, "last_activity_date": 1576682600, "creation_date": 1576682600, "answer_id": 59395159, "question_id": 59394339, "link": "https://stackoverflow.com/questions/59394339/gdb-in-c-get-type-of-variable-as-string/59395159#59395159", "title": "gdb in C: Get type of variable as string", "body": "<p>If your gdb supports the <code>python</code> scripting extensions, you can try it like this:</p>\n\n<pre><code>define type2var\n  eval \"python gdb.execute(\\\"set $%s=\\\\\\\"\\\"+(gdb.execute(\\\"ptype %s\\\", False, True)).strip()+\\\"\\\\\\\"\\\")\",$arg1,$arg0\nend\n</code></pre>\n\n<p>Now you can call it like this:</p>\n\n<pre><code>&gt;&gt;&gt; type2var \"variable\" \"typevar\"\n&gt;&gt;&gt; print $typevar\n$1 = \"type = char [32]\"\n</code></pre>\n\n<p>You can of course format it further as needed using python string functions.</p>\n"}], "owner": {"reputation": 33, "user_id": 3746400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/424136efc4a59f0cab07ffa3d8a9cd40?s=128&d=identicon&r=PG&f=1", "display_name": "Gandhal", "link": "https://stackoverflow.com/users/3746400/gandhal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 59395159, "answer_count": 1, "score": 3, "last_activity_date": 1576682600, "creation_date": 1576679896, "last_edit_date": 1576681581, "question_id": 59394339, "link": "https://stackoverflow.com/questions/59394339/gdb-in-c-get-type-of-variable-as-string", "title": "gdb in C: Get type of variable as string", "body": "<p>I want to see if it is possible to get the type of a variable in gdb as a string. For example, if</p>\n\n<pre><code>int i = 1;\nMyStruct *ms = NULL;\n</code></pre>\n\n<p>then I want to get something like</p>\n\n<pre><code>(gdb) &lt;the-command-I-am-looking-for&gt; i $local_var_i\n(gdb) p $local_var_i\n      $local_var_i = \"int\"\n(gdb) &lt;the-command-I-am-looking-for&gt; ms $local_var_ms\n(gdb) p $local_var_ms\n      $local_var_ms = \"MyStruct *\"\n</code></pre>\n\n<p>I may have allocated the local variables before the above code segment, and the command may be a custom command.</p>\n\n<p>Is such a thing possible? How could I achieve this?</p>\n\n<p>Edit for clarification:\nI have a group of functions in my program that change name according to the type they serve (I know it's not remotely the best way to do this, but I cannot change that). I want to write a gdb function which I can feed with just the variable and the rest will be done automatically, without my intevention. Preferably, I would also like to avoid a wall of if/else if.</p>\n"}, {"tags": ["c", "memcpy"], "comments": [{"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 5, "creation_date": 1576679510, "post_id": 59394196, "comment_id": 104977681, "body": "Using <code>memcpy</code> for one byte would probably take more time than direct assignment."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 6, "creation_date": 1576679605, "post_id": 59394196, "comment_id": 104977743, "body": "Choose the best readable version and leave the compiler to do the optimization. <code>memcpy()</code> looks inappropriate here, indeed."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 0, "creation_date": 1576680247, "post_id": 59394196, "comment_id": 104978105, "body": "@FiddlingBits or then not."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1576680285, "post_id": 59394196, "comment_id": 104978128, "body": "Modern compilers are likely to change the memcpy into an assignment.  If you can read assembly code, put this code into <a href=\"https://godbolt.org/\" rel=\"nofollow noreferrer\">godbolt.org</a> , or you can even just skim the assembly code and see that it doesn&#39;t call memcpy."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 2, "creation_date": 1576680289, "post_id": 59394196, "comment_id": 104978133, "body": "The premise of the question is wrong. If these variables <i>change</i> in a multithreaded program while doing the assignment then you have a <i>data race</i> and the behaviour of the program is <i>undefined</i>."}, {"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1576680338, "post_id": 59394196, "comment_id": 104978165, "body": "@AnttiHaapala Sorry, I don&#39;t understand what you mean. :-("}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 1, "creation_date": 1576680366, "post_id": 59394196, "comment_id": 104978181, "body": "@FiddlingBits <code>memcpy</code> is a standard library function and the compiler is allowed to optimize as it pleases."}, {"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1576680392, "post_id": 59394196, "comment_id": 104978197, "body": "@AnttiHaapala Gotcha.  Using one or the other may result in the same machine code, unless you disable optimization, right?"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 1, "creation_date": 1576680527, "post_id": 59394196, "comment_id": 104978270, "body": "@FiddlingBits <a href=\"https://godbolt.org/z/U9PkwY\" rel=\"nofollow noreferrer\">godbolt.org/z/U9PkwY</a> everything is possible."}], "answers": [{"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1576682593, "post_id": 59395090, "comment_id": 104979502, "body": "What has this to do with the question? Nobody is trying to write an addess into 1 byte anywhere."}], "tags": [], "owner": {"reputation": 115, "user_id": 4861723, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-8j_TWx3TT-g/AAAAAAAAAAI/AAAAAAAAAEY/HtuasC_CYfA/photo.jpg?sz=128", "display_name": "alexparkjw", "link": "https://stackoverflow.com/users/4861723/alexparkjw"}, "is_accepted": false, "score": -1, "last_activity_date": 1576695963, "last_edit_date": 1576695963, "creation_date": 1576682384, "answer_id": 59395090, "question_id": 59394196, "link": "https://stackoverflow.com/questions/59394196/data-copy-method-direct-assign-vs-memcpy-in-c/59395090#59395090", "title": "Data copy method direct assign vs memcpy in c", "body": "<p>The most of modern computer's size of address is 8 bytes which 64bit.\nYou just do not assign a address which 8bytes into 1byte(8bit) storage variable.</p>\n\n<p>for example \nmemcpy(&amp;cus_data[0], &amp;pack_id, sizeof(uinit8_t*));</p>\n\n<p>However, you did this below 3 times, for a sequence.\nmemcpy(&amp;cus_data[0], &amp;pack_id, sizeof(uinit8_t));</p>\n\n<p>memcpy() func. is such as this</p>\n\n<pre><code>void memcpy(void *dest, void *src, size_t size) { \nchar *c_src = (char *)src; \nchar *c_dest = (char *)dest; \nfor (int i=0; i&lt;size; i++) \n    c_dest[i] = c_src[i]; \n</code></pre>\n\n<p>} </p>\n\n<p>It will copy src to dest 1byte by 1byte. and so on..</p>\n\n<p>so, I like to use struct, case 1 instead of above\nfurther case 2 code copy a pointer once. </p>\n\n<pre><code>struct PACK{\nuint8_t id;\nuint8_t age;\nuint8_t cmd;\n</code></pre>\n\n<p>};</p>\n\n<p>int main() {</p>\n\n<pre><code>struct PACK pack = { .id = 123, .age = 76, .cmd = 30 };\nuint8_t cus_data[3];\n\n// case 1\nmemcpy(cus_data, &amp;pack, 3);\n\n// case 2\nuint8_t *p = (uint8_t*)&amp;pack;\n\n\nfor(int i=0; i&lt;3; i++)\n    printf(\"%d\\n\", p[i]);\nreturn 0;\n</code></pre>\n\n<p>}</p>\n"}, {"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": true, "score": 6, "last_activity_date": 1576682521, "creation_date": 1576682521, "answer_id": 59395139, "question_id": 59394196, "link": "https://stackoverflow.com/questions/59394196/data-copy-method-direct-assign-vs-memcpy-in-c/59395139#59395139", "title": "Data copy method direct assign vs memcpy in c", "body": "<p><code>cus_data[0] = pack_id;</code> is never slower than <code>memcpy(&amp;cus_data[0], &amp;pack_id, sizeof(pack_id));</code>. They may however be equally fast, if the compiler inlines the memcpy call, which is very likely.</p>\n\n<p>What you should do instead of worrying about micro-optimizations is to write <em>the most readable code possible</em>. Worry about optimizations when you encounter actual performance problems. </p>\n\n<p>Since <code>cus_data[0] = pack_id;</code> is the most readable, that's what you should be doing.</p>\n\n<hr>\n\n<blockquote>\n  <p>in such case since it is running in multithreaded environment</p>\n</blockquote>\n\n<p>Doesn't make a difference. Either you need to protect the variables against re-entrancy bugs, or you don't need to protect them. This has nothing to do with simple assignment vs memcpy, because neither of them are guaranteed to be atomic.</p>\n\n<p>It doesn't matter how small/large the variables are, since nothing in the C language guarantees atomic access unless you use C11 <code>_Atomic</code> and similar.</p>\n"}, {"comments": [{"owner": {"reputation": 549, "user_id": 7520070, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DJrTs.jpg?s=128&g=1", "display_name": "Omarito", "link": "https://stackoverflow.com/users/7520070/omarito"}, "edited": false, "score": 1, "creation_date": 1576696278, "post_id": 59395462, "comment_id": 104986366, "body": "Vote up for the assembly."}], "tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": false, "score": 4, "last_activity_date": 1576683611, "creation_date": 1576683611, "answer_id": 59395462, "question_id": 59394196, "link": "https://stackoverflow.com/questions/59394196/data-copy-method-direct-assign-vs-memcpy-in-c/59395462#59395462", "title": "Data copy method direct assign vs memcpy in c", "body": "<p>Practically every optimizing compiler (certainly gcc, clang, and icc) treats <code>memcpy</code> (and a handful of other libc functions, e.g., <code>memcmp</code>) as a builtin that's backed up by a real libc function of the same name.</p>\n\n<p>Compilers will generally only call the real function iff doing the work with inline assembly looks like too much work. </p>\n\n<p>Copying a character certainly doesn't fall in that category. These two generate the <a href=\"https://gcc.godbolt.org/z/CmQAzg\" rel=\"nofollow noreferrer\">same assembly with gcc/clang/icc</a>:</p>\n\n<pre><code>#include &lt;string.h&gt; //compilers generally know about memcpy\n//but C still requires that it should be prototyped\n\nvoid assign_char(char *X)\n{\n    *X = 'x';\n}\n\nvoid memcpy_char(char *X)\n{\n    memcpy(X,\"x\",1);\n}\n</code></pre>\n\n<p>x86_64 output:</p>\n\n<pre><code> assign_char:\n        mov     BYTE PTR [rdi], 120\n        ret\n memcpy_char:\n        mov     BYTE PTR [rdi], 120\n        ret\n</code></pre>\n\n<p>It doesn't matter which one you use. The <code>memcpy</code> version is more generic (works on arrays too, even though arrays can't be assigned to/from in C) and allows you to circumvent strict aliasing, but it's also a bit more verbose to write.</p>\n"}], "owner": {"reputation": 91, "user_id": 9929585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0856e6ed5641637ad3cbc9c3321152ee?s=128&d=identicon&r=PG", "display_name": "Alan", "link": "https://stackoverflow.com/users/9929585/alan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 59395139, "answer_count": 3, "score": 2, "last_activity_date": 1576695963, "creation_date": 1576679376, "last_edit_date": 1576679683, "question_id": 59394196, "link": "https://stackoverflow.com/questions/59394196/data-copy-method-direct-assign-vs-memcpy-in-c", "title": "Data copy method direct assign vs memcpy in c", "body": "<p>I want to copy data from different variables and put it together in an array so that I can process it further.</p>\n\n<p>I have studied direct assignment and memcpy method and think memcpy is used to copy complete buffer and not individual elements. Also I think it may take time and waste CPU cycles to use memcpy for individual bytes.</p>\n\n<p>Can you please let me know from below example what should be used in such case since it is running in multithreaded environment(different example) and varibles may change?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\n\nint main()\n{\n\n    printf(\"Direct assign method\\n\");\n\n    uint8_t pack_id = 123;\n    uint8_t pack_age = 76;\n    uint8_t pack_cmd = 30;\n\n    uint8_t cus_data[3] = {0};\n\n    cus_data[0] = pack_id;\n    cus_data[1] = pack_age;\n    cus_data[2] = pack_cmd;\n\n    printf(\"Memcpy method\\n\");\n\n    pack_id = 112;\n    pack_age = 89;\n    pack_cmd = 25;\n\n    memcpy(&amp;cus_data[0], &amp;pack_id, sizeof(pack_id));\n    memcpy(&amp;cus_data[1], &amp;pack_age, sizeof(pack_age));\n    memcpy(&amp;cus_data[2], &amp;pack_cmd, sizeof(pack_cmd));\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "memory-management", "linked-list"], "comments": [{"owner": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "edited": false, "score": 0, "creation_date": 1576679023, "post_id": 59393964, "comment_id": 104977384, "body": "Why do you use those confusing macros? They make the code look as if it belongs to a different language."}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1576679648, "post_id": 59393964, "comment_id": 104977767, "body": "<code>free(a)</code> does not free the <code>value</code> member of the node."}, {"owner": {"reputation": 141, "user_id": 11748947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0da0b6a761394a7bdf6034bac309498a?s=128&d=identicon&r=PG", "display_name": "JuiceFV", "link": "https://stackoverflow.com/users/11748947/juicefv"}, "reply_to_user": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "edited": false, "score": 0, "creation_date": 1576679979, "post_id": 59393964, "comment_id": 104977964, "body": "@machine_1 As I comprehend there is two ways (opaque pointers and templates). The templates more safe. We don&#39;t use the (void*) cast and memory allocate, where I can get some leaks."}, {"owner": {"reputation": 141, "user_id": 11748947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0da0b6a761394a7bdf6034bac309498a?s=128&d=identicon&r=PG", "display_name": "JuiceFV", "link": "https://stackoverflow.com/users/11748947/juicefv"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1576680018, "post_id": 59393964, "comment_id": 104977988, "body": "@Paul Ogilvie  Ok, I see. Thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "is_accepted": true, "score": 0, "last_activity_date": 1576680424, "creation_date": 1576680424, "answer_id": 59394474, "question_id": 59393964, "link": "https://stackoverflow.com/questions/59393964/freeing-a-linked-lists-nodes-by-freeing-whole-object/59394474#59394474", "title": "freeing a linked_list&#39;s nodes, by freeing whole object", "body": "<p><code>free(a)</code> frees the object <code>a</code> points to. It doesn't free the objects which <em>that</em> object points to. So it will free the <code>stack</code> object, but it won't free any of the <code>node</code> objects.</p>\n"}], "owner": {"reputation": 141, "user_id": 11748947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0da0b6a761394a7bdf6034bac309498a?s=128&d=identicon&r=PG", "display_name": "JuiceFV", "link": "https://stackoverflow.com/users/11748947/juicefv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 0, "accepted_answer_id": 59394474, "answer_count": 1, "score": 0, "last_activity_date": 1576680424, "creation_date": 1576678559, "question_id": 59393964, "link": "https://stackoverflow.com/questions/59393964/freeing-a-linked-lists-nodes-by-freeing-whole-object", "title": "freeing a linked_list&#39;s nodes, by freeing whole object", "body": "<p>I would to implement the stack using linked-list. Moreover, I want to use something like templates.\nThus I got such structures:</p>\n\n<ol>\n<li>node</li>\n</ol>\n\n<pre><code>#define node(T)            \\\n  struct node_##T {        \\\n    T value;               \\\n    struct node_##T *next; \\\n  }\n</code></pre>\n\n<ol start=\"2\">\n<li>stack</li>\n</ol>\n\n<pre><code>#define stack(T)           \\\n  struct stack_##T {       \\\n    size_t size;           \\\n    node(T) * begin, *end; \\\n  }\n</code></pre>\n\n<p>At the end I want to free the stack. Always I did it using while/recursive. Somthing like that:</p>\n\n<pre><code>while (begin != NULL)\n{\n    temp = begin;\n    begin = begin-&gt;next;\n    free(temp);\n}\n</code></pre>\n\n<p>In my case the usage of this method is more compicated rather than usally. Consequently, I just freeing the object.</p>\n\n<pre><code>#include \"stack.h\"\ntypedef char* string;\nint main() {\n  stack(string)* a;\n  stack_constructor(string, a);\n  stack_resize(a, 5);\n  free(a);\n  return (0);\n}\n</code></pre>\n\n<p>The debug shows that all is fine. I have set two break-points before \"free(a)\" and after \"free(a)\".\n<a href=\"https://i.stack.imgur.com/LvQXc.png\" rel=\"nofollow noreferrer\">before freeing</a>\n<a href=\"https://i.stack.imgur.com/VyO2k.png\" rel=\"nofollow noreferrer\">after freeing</a>\nBut I have some doubts about these. I think that we're deleting the memory which we have allocated for the pointer, but the values still in memory. Am I mistakning?</p>\n"}, {"tags": ["c", "ruby", "shared-libraries", "static-linking", "dynamic-linking"], "comments": [{"owner": {"reputation": 4732, "user_id": 8477999, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f8172e1919af53269de92316dcf03a03?s=128&d=identicon&r=PG&f=1", "display_name": "Gem Taylor", "link": "https://stackoverflow.com/users/8477999/gem-taylor"}, "edited": false, "score": 0, "creation_date": 1576684484, "post_id": 59393918, "comment_id": 104980607, "body": "I think perhaps you are confusing static linking. Any mention of .so means you are looking at a dynamically linked library, not statically linked."}, {"owner": {"reputation": 11332, "user_id": 52499, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e13c0896a2408caf559934466737f716?s=128&d=identicon&r=PG", "display_name": "x-yuri", "link": "https://stackoverflow.com/users/52499/x-yuri"}, "reply_to_user": {"reputation": 4732, "user_id": 8477999, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f8172e1919af53269de92316dcf03a03?s=128&d=identicon&r=PG&f=1", "display_name": "Gem Taylor", "link": "https://stackoverflow.com/users/8477999/gem-taylor"}, "edited": false, "score": 0, "creation_date": 1576685296, "post_id": 59393918, "comment_id": 104981110, "body": "@GemTaylor I&#39;m indeed not sure what are sure signs that it&#39;s linked statically. But everything suggests that it is. That is, that <code>nokogiri.so</code> is linked statically to <code>libxml2</code>. And I&#39;m sure that <code>rmagick.so</code> is linked dynamically to <code>libxml2</code>. Ruby loads <code>nokogiri.so</code> and <code>rmagick.so</code> when they are <code>require</code>d."}], "answers": [{"comments": [{"owner": {"reputation": 11332, "user_id": 52499, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e13c0896a2408caf559934466737f716?s=128&d=identicon&r=PG", "display_name": "x-yuri", "link": "https://stackoverflow.com/users/52499/x-yuri"}, "edited": false, "score": 0, "creation_date": 1576831140, "post_id": 59419800, "comment_id": 105030706, "body": "Awesome answer. But can you elaborate please? What are archive libraries? To build correctly one has to add <a href=\"https://stackoverflow.com/a/43626454/52499\"><code>-fvisibility=hidden</code></a>?"}, {"owner": {"reputation": 11332, "user_id": 52499, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e13c0896a2408caf559934466737f716?s=128&d=identicon&r=PG", "display_name": "x-yuri", "link": "https://stackoverflow.com/users/52499/x-yuri"}, "edited": false, "score": 0, "creation_date": 1576839168, "post_id": 59419800, "comment_id": 105034243, "body": "And by any chance do you know a reason why they decided to emulate archive libraries? Also, I&#39;ve filed a <a href=\"https://github.com/sparklemotion/nokogiri/issues/1959\" rel=\"nofollow noreferrer\">bug report</a>. In case you want to correct my phrasing or elaborate on the solution."}], "tags": [], "owner": {"reputation": 162629, "user_id": 50617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YFykQ.png?s=128&g=1", "display_name": "Employed Russian", "link": "https://stackoverflow.com/users/50617/employed-russian"}, "is_accepted": true, "score": 2, "last_activity_date": 1576816078, "creation_date": 1576816078, "answer_id": 59419800, "question_id": 59393918, "link": "https://stackoverflow.com/questions/59393918/can-a-dynamically-linked-library-override-a-static-one/59419800#59419800", "title": "Can a dynamically linked library override a static one?", "body": "<blockquote>\n  <p>So how come can nokogiri access libxml2.so's variables?</p>\n</blockquote>\n\n<p>This is by design (and due to the fact that <code>nokogiri</code> was built incorrectly).</p>\n\n<p>UNIX shared libraries are <em>designed</em> to emulate archive libraries. This means that the first ELF image to export a given symbol wins (there are some complications for libraries linked with <code>-Bstatic</code> flag, but we'll ignore them for now).</p>\n\n<blockquote>\n  <p>Does that mean that loading libxml2.so overrides any statically linked versions?</p>\n</blockquote>\n\n<p>Yes, if statically linked version is also exported and calls to it go though PLT.</p>\n\n<blockquote>\n  <p>Can that happen in the middle of code execution?</p>\n</blockquote>\n\n<p>With lazy symbol resolution (which is default, except when <code>LD_BIND_NOW</code> or <code>-z now</code> are in effect) it will <em>always</em> happen in the middle of code execution.</p>\n\n<p>Now, the problem is that if <code>nokogiri</code> links in a static copy of <code>libxml.a</code>, it should <em>hide</em> that fact by localizing that copy within itself and not exporting any of its symbols. That would prevent end users from having to deal with symbol conflicts.</p>\n\n<p>Your best bet is to either build your own <code>nokogiri</code> compiling and linking it against the same version of libxml, or to contact <code>nokogiri</code> maintainers and ask them to fix their builds.</p>\n"}], "owner": {"reputation": 11332, "user_id": 52499, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e13c0896a2408caf559934466737f716?s=128&d=identicon&r=PG", "display_name": "x-yuri", "link": "https://stackoverflow.com/users/52499/x-yuri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 59419800, "answer_count": 1, "score": 1, "last_activity_date": 1576816078, "creation_date": 1576678442, "question_id": 59393918, "link": "https://stackoverflow.com/questions/59393918/can-a-dynamically-linked-library-override-a-static-one", "title": "Can a dynamically linked library override a static one?", "body": "<p><code>nokogori</code> gem comes with its own version of <code>libxml2</code>. Moreover it <a href=\"https://github.com/sparklemotion/nokogiri/blob/v1.10.7/lib/nokogiri/version.rb#L41\" rel=\"nofollow noreferrer\">warns</a> about <code>libxml2.so</code> of a different version being loaded before it was required:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>      if compiled_parser_version != loaded_parser_version\n        [\"Nokogiri was built against LibXML version #{compiled_parser_version}, but has dynamically loaded #{loaded_parser_version}\"]\n</code></pre>\n\n<p>It basically <a href=\"https://github.com/sparklemotion/nokogiri/blob/v1.10.7/ext/nokogiri/nokogiri.c#L78-L85\" rel=\"nofollow noreferrer\">compares</a> <a href=\"http://www.xmlsoft.org/html/libxml-xmlversion.html#LIBXML_DOTTED_VERSION\" rel=\"nofollow noreferrer\"><code>LIBXML_DOTTED_VERSION</code></a> macro and <a href=\"http://www.xmlsoft.org/html/libxml-globals.html#xmlGlobalState\" rel=\"nofollow noreferrer\"><code>xmlParserVersion</code></a> global variable:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>  rb_const_set( mNokogiri,\n                rb_intern(\"LIBXML_VERSION\"),\n                NOKOGIRI_STR_NEW2(LIBXML_DOTTED_VERSION)\n              );\n  rb_const_set( mNokogiri,\n                rb_intern(\"LIBXML_PARSER_VERSION\"),\n                NOKOGIRI_STR_NEW2(xmlParserVersion)\n              );\n</code></pre>\n\n<p>And I'm experiencing it firsthand. When <code>rmagick</code> (which dynamically links to <code>libxml2.so</code>, <code>ldd</code> confirms that) is required before <code>nokogiri</code>, the latter complains.</p>\n\n<p>From what I can see <code>nokogiri</code> is linked to <code>libxml2</code> statically. First that is <a href=\"https://github.com/sparklemotion/nokogiri/blob/v1.10.7/ext/nokogiri/extconf.rb#L475\" rel=\"nofollow noreferrer\">the default</a> (supposedly). Then when <code>rmagick</code> is not required I can't see <code>libxml2.so</code> in <code>/proc/PID/maps</code>. I neither can see another version of <code>libxml2.so</code>. <code>ldd</code> doesn't list <code>libxml2.so</code> as a <code>nokogiri.so</code>'s dependency. <code>objdump</code> lists <a href=\"http://www.xmlsoft.org/html/libxml-parser.html#xmlReadMemory\" rel=\"nofollow noreferrer\"><code>xmlReadMemory</code></a> (and friends) as a <code>nokogori.so</code>'s symbol (probably a sign that it was linked statically).</p>\n\n<p>So how come can <code>nokogiri</code> access <code>libxml2.so</code>'s variables? Does that mean that loading <code>libxml2.so</code> overrides any statically linked versions? Can that happen in the middle of code execution?</p>\n"}, {"tags": ["c", "command"], "answers": [{"tags": [], "owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": true, "score": 1, "last_activity_date": 1576677939, "creation_date": 1576677939, "answer_id": 59393763, "question_id": 59393663, "link": "https://stackoverflow.com/questions/59393663/preserving-status-in-command-function/59393763#59393763", "title": "Preserving status in command function", "body": "<p>The <code>CreateProcess</code> starts a brand new process that is running independently from yours.</p>\n\n<p>If you make that independent process change its own current working directory, then it will be changed only in the new process, and not in your process running your program.</p>\n"}], "owner": {"reputation": 25, "user_id": 8814468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8ede66bc7723c1520902c090de674bc6?s=128&d=identicon&r=PG&f=1", "display_name": "John John", "link": "https://stackoverflow.com/users/8814468/john-john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 59393763, "answer_count": 1, "score": 0, "last_activity_date": 1576677939, "creation_date": 1576677610, "question_id": 59393663, "link": "https://stackoverflow.com/questions/59393663/preserving-status-in-command-function", "title": "Preserving status in command function", "body": "<p>I made a function where you get the output of a command. It works but it doesn't preserve the status of the previous command, for example if you change directory (cd dir) it isn't changed in the new command. Can I change the function such that if I change the directory it is preserved in the next command? This is my function:</p>\n\n<pre><code>    int execute(char *command, char *output)\n    {\n            int rc;\n            char buffer[4096], *cmd;\n            DWORD byte, bytes;\n            HANDLE in_read, in_write, out_read, out_write;\n            PROCESS_INFORMATION pi;\n            SECURITY_ATTRIBUTES sa;\n            STARTUPINFO si;\n\n            cmd = malloc(sizeof(char) * (strlen(command) + 8));\n            strcpy(cmd, \"cmd /c \");\n            strcat(cmd, command);\n\n            ZeroMemory(&amp;pi, sizeof(PROCESS_INFORMATION));\n            ZeroMemory(&amp;sa, sizeof(SECURITY_ATTRIBUTES));\n            ZeroMemory(&amp;si, sizeof(STARTUPINFO));\n\n            sa.nLength = sizeof(SECURITY_ATTRIBUTES);\n            sa.bInheritHandle = TRUE;\n            sa.lpSecurityDescriptor = NULL;\n\n            rc = CreatePipe(&amp;out_read, &amp;out_write, &amp;sa, 0);\n            check(rc != 0)\n            rc = SetHandleInformation(out_read, HANDLE_FLAG_INHERIT, 0);\n            check(rc != 0)\n            rc = CreatePipe(&amp;in_read, &amp;in_write, &amp;sa, 0);\n            check(rc != 0)\n            rc = SetHandleInformation(in_write, HANDLE_FLAG_INHERIT, 0);\n            check(rc != 0)\n\n            si.cb = sizeof(STARTUPINFO);\n            si.dwFlags = STARTF_USESTDHANDLES;\n            si.hStdError = out_write;\n            si.hStdOutput = out_write;\n            si.hStdInput = in_read;\n\n            CloseHandle(pi.hProcess);\n            CloseHandle(pi.hThread);\n\n            rc = CreateProcess(NULL, cmd, NULL, NULL, TRUE, CREATE_NO_WINDOW, \n            NULL, NULL, &amp;si, &amp;pi);\n            check(rc != 0)\n\n            CloseHandle(out_write);\n\n            bytes = 0;\n            while (ReadFile(out_read, &amp;buffer, 4096, &amp;byte, NULL)) {\n                if (bytes == 0) {\n                    bytes = bytes + byte;\n                    check(bytes &gt; sizeof(output))\n                    strcpy(output, buffer);\n                    ZeroMemory(&amp;buffer, sizeof(buffer));\n                } else {\n                    bytes = bytes + byte;\n                    check(bytes &gt; sizeof(output))\n                    strcat(output, buffer);\n                    ZeroMemory(&amp;buffer, sizeof(buffer));\n                }\n            };\n\n            CloseHandle(in_read);\n            CloseHandle(in_write);\n            CloseHandle(out_read);\n            free(cmd);\n\n            return 1;\n\n        error:\n            free(cmd);\n\n            return -1;\n    }\n</code></pre>\n"}, {"tags": ["c", "windows", "msys2"], "comments": [{"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 0, "creation_date": 1576677842, "post_id": 59393592, "comment_id": 104976762, "body": "Pass a pointer and the size of the array to your function..."}, {"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 0, "creation_date": 1576678760, "post_id": 59393592, "comment_id": 104977248, "body": "Could you post the relevant part of your code? Are you passing an allocated big array (maybe static) or do you want to allocate a big array inside a function?"}, {"owner": {"reputation": 655, "user_id": 3616601, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d9dbe1da7416f8fa9b0cf1d0974269e7?s=128&d=identicon&r=PG&f=1", "display_name": "Phantom", "link": "https://stackoverflow.com/users/3616601/phantom"}, "reply_to_user": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 0, "creation_date": 1576679101, "post_id": 59393592, "comment_id": 104977431, "body": "I&#39;m passing a static array, declared in the main"}], "answers": [{"comments": [{"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 1, "creation_date": 1576678501, "post_id": 59393831, "comment_id": 104977121, "body": "An explanation stating that this avoids the problem by creating the array in static storage rather than on the stack. (Not my downvote)"}, {"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "reply_to_user": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1576678659, "post_id": 59393831, "comment_id": 104977192, "body": "@ikegami Per my understanding, OP has a big array and wants to pass it to a function (<i>callstack</i>)...but baybe you are right"}], "tags": [], "owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "is_accepted": true, "score": 0, "last_activity_date": 1576678126, "creation_date": 1576678126, "answer_id": 59393831, "question_id": 59393592, "link": "https://stackoverflow.com/questions/59393592/stackoverfflow-with-msys2/59393831#59393831", "title": "Stackoverfflow with Msys2", "body": "<p>Pass the large array by pointer</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nchar large_array[100000000];\n\nvoid myfunc (char *array, size_t size)\n{\n    for (int i=0; i&lt;size; i++)\n        //STUFF\n}\n\nint main()\n{\n    myfunc(large_array, sizeof(large_array)/sizeof(large_array[0]));\n\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 655, "user_id": 3616601, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d9dbe1da7416f8fa9b0cf1d0974269e7?s=128&d=identicon&r=PG&f=1", "display_name": "Phantom", "link": "https://stackoverflow.com/users/3616601/phantom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 59393831, "answer_count": 1, "score": 0, "last_activity_date": 1576678126, "creation_date": 1576677439, "question_id": 59393592, "link": "https://stackoverflow.com/questions/59393592/stackoverfflow-with-msys2", "title": "Stackoverfflow with Msys2", "body": "<p>I'm under Windows (10, I guess), using Msys2 for development. I'm coding a program where I need a large array, but I can't use dynamic memory. The problem is, this array is too large to fit on the callstack, which produces a stackoverflow.</p>\n\n<p>I tried to change the callstack size with <code>ulimit -s 100000</code>. But my program still crash. When I check  with the same command <code>ulimit -s</code> I've got the limit I set. But when I check with a small program with <a href=\"https://linux.die.net/man/2/getrlimit\" rel=\"nofollow noreferrer\"><code>getrlimit</code></a>, I've got the default value.</p>\n\n<p>I saw in <a href=\"https://stackoverflow.com/a/447874/3616601\">this thread</a> that we can change some of the Msys2 config values with the file <code>msys.bat</code>, but i can't find this file.</p>\n\n<p><br/>\n<strong>My Question</strong><br/>\nHow can I change the callstack on windows/Msys2?</p>\n"}, {"tags": ["c", "static-code-analysis", "buffer-overrun"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 2, "creation_date": 1576677237, "post_id": 59393480, "comment_id": 104976419, "body": "<code>considering size of unsigned int on the machine is 2 bytes</code> - and 2 bytes are 4 characters in hex representation, so when <code>i=19</code> you can overflow. <code>writes up to 9 bytes</code> - I think your static analysis tool doesn&#39;t know that you have <code>sizeof(int) = 2</code>. What analysis tool are you running? How did you configured the tool?"}, {"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 1, "creation_date": 1576677276, "post_id": 59393480, "comment_id": 104976439, "body": "The warning is clear.  Writing <code>9</code> bytes to <code>dest[38]</code> would result in a buffer overrun."}, {"owner": {"reputation": 870061, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 0, "creation_date": 1576677969, "post_id": 59393480, "comment_id": 104976834, "body": "It is possible, try it with source ending with &#39;\u20ac&#39; for example.  Char is a signed type for many compilers, so the cast can generate a very large unsigned int value that requires 9 characters.  The kind of gotcha that makes code analyzers useful.  Cast to (unsigned char) instead."}], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 4988953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0Zg2f.jpg?s=128&g=1", "display_name": "Vaibhav Kulkarni", "link": "https://stackoverflow.com/users/4988953/vaibhav-kulkarni"}, "edited": false, "score": 0, "creation_date": 1576689348, "post_id": 59393969, "comment_id": 104983309, "body": "The same warning is reported when &quot;source&quot; is of type unit8_t*, considering the fact that uint8_t is typedef as unsigned char there should not any buffer overrun."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 29, "user_id": 4988953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0Zg2f.jpg?s=128&g=1", "display_name": "Vaibhav Kulkarni", "link": "https://stackoverflow.com/users/4988953/vaibhav-kulkarni"}, "edited": false, "score": 0, "creation_date": 1576702052, "post_id": 59393969, "comment_id": 104988603, "body": "@VaibhavKulkarni i.e. the analyzer is stupid, but it did find a valid bug ;)"}], "tags": [], "owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "is_accepted": false, "score": 1, "last_activity_date": 1576702095, "last_edit_date": 1576702095, "creation_date": 1576678576, "answer_id": 59393969, "question_id": 59393480, "link": "https://stackoverflow.com/questions/59393480/buffer-overrun-issue-reported-by-static-code-analysis-tool/59393969#59393969", "title": "Buffer overrun issue reported by static code analysis tool", "body": "<p><code>char</code> can be signed, and is so by default in x86 compilers. On my computer</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void) {\n    printf(\"%02x\\n\", (unsigned int)(char)128);\n}\n</code></pre>\n\n<p>prints <code>ffffff80</code>.</p>\n\n<p>What you <em>want</em> to do is use format <code>\"%02hhx\"</code> and argument <code>(unsigned char)c</code>. </p>\n"}], "owner": {"reputation": 29, "user_id": 4988953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0Zg2f.jpg?s=128&g=1", "display_name": "Vaibhav Kulkarni", "link": "https://stackoverflow.com/users/4988953/vaibhav-kulkarni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576702095, "creation_date": 1576677094, "last_edit_date": 1576681370, "question_id": 59393480, "link": "https://stackoverflow.com/questions/59393480/buffer-overrun-issue-reported-by-static-code-analysis-tool", "title": "Buffer overrun issue reported by static code analysis tool", "body": "<p>My piece of code:</p>\n\n<pre><code>void temp(char *source)\n{\n    char dest[41];\n\n    for(int i = 0; i &lt; 20; i++)\n    {\n        sprintf(&amp;dest[i*2], \"%02x\", (unsigned int)source[i]);\n    }\n}\n</code></pre>\n\n<p>When I run the static code analysis tool, I get the warning below:</p>\n\n<blockquote>\n  <p>On 19th iteration of the loop : This code could write past the end of the buffer pointed to by &amp;dest[i * 2]. &amp;dest[i * 2] evaluates to [dest + 38]. sprintf() writes up to 9 bytes starting at offset 38 from the beginning of the buffer pointed to by &amp;dest[i * 2], whose capacity is\n  41 bytes.The number of bytes written could exceed the number of allocated bytes beyond that offset. The overrun occurs in stack memory.</p>\n</blockquote>\n\n<p>My question is: since in every loop iteration, we are only copying 2 bytes (considering size of unsigned int on the machine is 2 bytes) from source to destination, where is the possibility of copying 9 bytes on the last iteration?</p>\n"}, {"tags": ["c", "memory", "malloc", "free"], "comments": [{"owner": {"reputation": 367, "user_id": 9043460, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/buWls.jpg?s=128&g=1", "display_name": "Vio Ariton", "link": "https://stackoverflow.com/users/9043460/vio-ariton"}, "edited": false, "score": 0, "creation_date": 1576690801, "post_id": 59393273, "comment_id": 104984004, "body": "If they all have the same size, why not just use an array instead and a bitmap so you can take advantage of caching."}, {"owner": {"reputation": 367, "user_id": 9043460, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/buWls.jpg?s=128&g=1", "display_name": "Vio Ariton", "link": "https://stackoverflow.com/users/9043460/vio-ariton"}, "edited": false, "score": 0, "creation_date": 1576691973, "post_id": 59393273, "comment_id": 104984532, "body": "Have you tested the code? The union doesn&#39;t make sense as the members utilize  the same chunk of memory, which means padding and data will contain the same address."}], "answers": [{"comments": [{"owner": {"reputation": 303, "user_id": 5485742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3eb4087e2ec30c51f76959c8c7f5627?s=128&d=identicon&r=PG&f=1", "display_name": "MrSonic", "link": "https://stackoverflow.com/users/5485742/mrsonic"}, "edited": false, "score": 0, "creation_date": 1576705709, "post_id": 59397935, "comment_id": 104989921, "body": "Thank you very much! BTW, I wrote API_malloc() and API_free() on C."}], "tags": [], "owner": {"reputation": 1599, "user_id": 9948091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JANyt.png?s=128&g=1", "display_name": "HAL9000", "link": "https://stackoverflow.com/users/9948091/hal9000"}, "is_accepted": true, "score": 1, "last_activity_date": 1576693416, "last_edit_date": 1576693416, "creation_date": 1576692856, "answer_id": 59397935, "question_id": 59393273, "link": "https://stackoverflow.com/questions/59393273/implements-pool-memory-api-dealing-with-unions/59397935#59397935", "title": "Implements pool memory API - dealing with unions", "body": "<p>You have the problem that since <code>padding</code> and <code>next</code> share the same memory (belongs to a union), when you assign to <code>next</code>, whatever data <code>padding</code> points to will be lost.</p>\n\n<p>Your solution is for your chunks to either <em>be your data</em>, or be the pointer to your next free chunk. So for each <code>malloc()</code>, we need to allocate <code>max(sizeof(union Chunk), sizeOfObj)</code></p>\n\n<pre><code>union Chunk{\n    char data[1]; /* `1` is a dummy value, the compiler doesn't actually really care \n                     if we allocate and use more than 1 char */ \n    union Chunk* next;\n};\n\n\n/* We return `struct Pool` by value to save a `malloc()`  (c is not java)*/ \nstruct Pool API_init(size_t sizeOfObj, size_t numOfObj){\n\n    union Chunk* prev = NULL;\n    size_t chunksize = max(sizeof (union Chunk), sizeOfObj);\n\n    /* counting upwards is easier than downwards */\n    for(size_t i = 0; i &lt; numOfObj; i++){\n\n        /* We don't cast the return value from `malloc()`. This is c, not c++ */\n        curr = malloc(chunksize);\n\n        curr-&gt;next = prev;\n\n        prev = curr;\n    }\n\n    struct Pool res;   \n    res.nextFreeChunk = curr;\n    return res;\n}\n</code></pre>\n\n<p>Your <code>API_malloc()</code> and <code>API_free()</code> looks OK, except that they are written in c++ rather than c. Don't use c++ syntax when you are writing in c. And use the c-compiler, not the c++ one.</p>\n\n<p>You can improve on this by mallocing your whole pool in one go rather than using multiple <code>malloc()</code>:</p>\n\n<pre><code>struct Pool{\n    char *buffer;\n    Chunk* nextFreeChunk;\n};\n\nstruct Pool API_init(size_t sizeOfObj, size_t numOfObj){\n\n    size_t chunksize = max(sizeof (union Chunk), sizeOfObj);\n\n    /* Checking for overflow is left as an exercise for the reader */\n    size_t buffersize = numOfObj * chunksize;\n\n    char *buffer = malloc(buffersize);\n\n\n    for(size_t i = 0; i &lt; numOfObj - 1; i++){\n\n        union Chunk *curr = (union Chunk *)(buffer + i * chunksize);\n        curr-&gt;next = (union Chunk *)(buffer + (i+1) * chunksize);\n\n    }\n\n    if (numOfObj)\n    {\n        union Chunk *last = (union Chunk *)(buffer + (numOfObj - 1) * chunksize);\n        last-&gt;next = NULL;\n    }\n\n\n    struct Pool res;\n    res.buffer = buffer;    \n    res.nextFreeChunk = (union Chunk *)buffer;\n    return res;\n}\n</code></pre>\n\n<p>Naturally, any error checking and minor bugfixing are left out for brevity</p>\n"}], "owner": {"reputation": 303, "user_id": 5485742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3eb4087e2ec30c51f76959c8c7f5627?s=128&d=identicon&r=PG&f=1", "display_name": "MrSonic", "link": "https://stackoverflow.com/users/5485742/mrsonic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 59397935, "answer_count": 1, "score": 0, "last_activity_date": 1576693416, "creation_date": 1576676351, "question_id": 59393273, "link": "https://stackoverflow.com/questions/59393273/implements-pool-memory-api-dealing-with-unions", "title": "Implements pool memory API - dealing with unions", "body": "<p>I'd like to implement an API for a data structure that allocates memory in advance to a number of objects of a certain size, instead of each time using 'malloc' and 'free' for each object, as will be needed.</p>\n\n<p>The API should include the following three functions:</p>\n\n<pre><code>pool* API_init(size_t sizeOfObj, int numOfObj)\n</code></pre>\n\n<p>Accepts two parameters, the object size and the number of such objects we wish to store, and returns pointer to a pool - a data structure that manage the memory.</p>\n\n<pre><code>void* API_malloc(Pool* pool)\n</code></pre>\n\n<p>Accept pool and return pointer for new allocation of a single objects.</p>\n\n<pre><code>void API_free(Pool* pool, void* obj)\n</code></pre>\n\n<p>Accepts two parameters, pool and the address which is need to be marked as unused.</p>\n\n<p>The complexity time requirements for methods 'API_malloc' and 'API_free' is constant, and the memory complexity of pool should be 'sizeOfObj' * 'numOfObj' + constant.</p>\n\n<p>In order to deal with fragments, I thought to defined a pool as linked list of chunks of size 'sizeOfObj' bytes, which in addition contains a pointer to the next unused chunk.\nIn order to save memory space, I decide to defined chunk with UNION.</p>\n\n<p>This is my implementaion:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\ntypedef struct Pool Pool;\ntypedef union Chunk Chunk;\n\n\nunion Chunk{\n\n    char* padding;\n    Chunk* next;\n};\n\nstruct Pool{\n\n    Chunk* nextFreeChunk;\n};\n\nPool* API_init(int sizeOfObj, int numOfObj){\n\n    Pool* res = (Pool*) malloc(sizeof(Pool));\n    Chunk* next;\n    Chunk* curr;\n\n    for(int i = numOfObj -1; i &gt;= 0; i--){\n\n        curr = (Chunk*) malloc (sizeof(Chunk));\n        curr-&gt;padding = (char*) malloc(sizeOfObj);\n\n        if(i &lt; numOfObj -1)\n            curr-&gt;next = next;\n\n        next = curr;\n    }\n\n    res-&gt;nextFreeChunk = curr;\n    return res;\n}\n\nvoid* API_malloc(Pool* pool){\n\n    void* res = pool-&gt;nextFreeChunk;\n    pool-&gt;nextFreeChunk = (pool-&gt;nextFreeChunk)-&gt;next;\n    return res;\n}\n\nvoid API_free(Pool* pool, void* obj){\n\n    Chunk* ch = (Chunk*) obj;\n    ch-&gt;next = pool-&gt;nextFreeChunk;\n    pool-&gt;nextFreeChunk = ch;\n}\n</code></pre>\n\n<p>My problem is that the chunks, as I defined, don't necessarily have size of 'sizeOfObj' as given, and the char pointers are wasting memory (more then constant). </p>\n\n<p>I know that union can't have as member a flexible char array, so I can't defined member 'char padding[sizeOfObj]' inside 'API_init'. </p>\n\n<p>Any suggestion for solving my problem or for new implementation approach will be gratefully appreciated.</p>\n"}, {"tags": ["c", "compilation", "stack", "stack-frame"], "comments": [{"owner": {"reputation": 26552, "user_id": 448932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QgLLl.png?s=128&g=1", "display_name": "500 - Internal Server Error", "link": "https://stackoverflow.com/users/448932/500-internal-server-error"}, "edited": false, "score": 1, "creation_date": 1576682449, "post_id": 59393220, "comment_id": 104979404, "body": "It appears to allocate room for, and store, a so-called canary value - the <code>mov    eax,gs:0x14</code> bit - which is checked against for stack corruption on exit. -- The rest of the overhead is for variable alignment purposes."}, {"owner": {"reputation": 23, "user_id": 12558356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0283851c3d462b89cab94f4b4ddc4164?s=128&d=identicon&r=PG&f=1", "display_name": "user12558356", "link": "https://stackoverflow.com/users/12558356/user12558356"}, "reply_to_user": {"reputation": 26552, "user_id": 448932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QgLLl.png?s=128&g=1", "display_name": "500 - Internal Server Error", "link": "https://stackoverflow.com/users/448932/500-internal-server-error"}, "edited": false, "score": 0, "creation_date": 1576693395, "post_id": 59393220, "comment_id": 104985167, "body": "Thanks for the answer! I thought about there being a canary, but I ruled it out since I didn&#39;t get where the other bytes came from. I guess alignment makes sense!"}], "owner": {"reputation": 23, "user_id": 12558356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0283851c3d462b89cab94f4b4ddc4164?s=128&d=identicon&r=PG&f=1", "display_name": "user12558356", "link": "https://stackoverflow.com/users/12558356/user12558356"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1576676794, "creation_date": 1576676204, "last_edit_date": 1576676794, "question_id": 59393220, "link": "https://stackoverflow.com/questions/59393220/stack-frame-preparation", "title": "Stack frame preparation", "body": "<p>In order to improve my binary exploitation skills, and deepen my understanding in low level environments I tried solving challenges in pwnable.kr, The third challenge- called <code>bof</code> has the following C code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\nvoid func(int key){\n    char overflowme[32];\n    printf(\"overflow me : \");\n    gets(overflowme);   // smash me!\n    if(key == 0xcafebabe){\n        system(\"/bin/sh\");\n    }\n    else{\n        printf(\"Nah..\\n\");\n    }\n}\nint main(int argc, char* argv[]){\n    func(0xdeadbeef);\n    return 0;\n}\n</code></pre>\n\n<p>Disassembling the func:</p>\n\n<pre><code>0x5655562c &lt;+0&gt;:        push   ebp\n0x5655562d &lt;+1&gt;:        mov    ebp,esp\n**0x5655562f &lt;+3&gt;:        sub    esp,0x48**\n0x56555632 &lt;+6&gt;:        mov    eax,gs:0x14\n0x56555638 &lt;+12&gt;:       mov    DWORD PTR [ebp-0xc],eax\n0x5655563b &lt;+15&gt;:       xor    eax,eax\n0x5655563d &lt;+17&gt;:       mov    DWORD PTR [esp],0x5655578c\n0x56555644 &lt;+24&gt;:       call   0xf7e28b70 &lt;puts&gt;\n0x56555649 &lt;+29&gt;:       lea    eax,[ebp-0x2c]\n0x5655564c &lt;+32&gt;:       mov    DWORD PTR [esp],eax\n0x5655564f &lt;+35&gt;:       call   0xf7e280c0 &lt;gets&gt;\n0x56555654 &lt;+40&gt;:       cmp    DWORD PTR [ebp+0x8],0xcafebabe\n0x5655565b &lt;+47&gt;:       jne    0x5655566b &lt;func+63&gt;\n0x5655565d &lt;+49&gt;:       mov    DWORD PTR [esp],0x5655579b\n0x56555664 &lt;+56&gt;:       call   0xf7dfc8b0 &lt;system&gt;\n0x56555669 &lt;+61&gt;:       jmp    0x56555677 &lt;func+75&gt;\n0x5655566b &lt;+63&gt;:       mov    DWORD PTR [esp],0x565557a3\n0x56555672 &lt;+70&gt;:       call   0xf7e28b70 &lt;puts&gt;\n0x56555677 &lt;+75&gt;:       mov    eax,DWORD PTR [ebp-0xc]\n0x5655567a &lt;+78&gt;:       xor    eax,DWORD PTR gs:0x14\n0x56555681 &lt;+85&gt;:       je     0x56555688 &lt;func+92&gt;\n0x56555683 &lt;+87&gt;:       call   0xf7ece820 &lt;__stack_chk_fail&gt;\n0x56555688 &lt;+92&gt;:       leave  \n0x56555689 &lt;+93&gt;:       ret\n</code></pre>\n\n<p>I know how to solve it, but when I disassembled the binary I found out that <code>esp</code> creates a stack frame(Highlighted the command where it happens) 0x48 bytes long. And I don't understand why - I thought it'd allocate 32 bytes since the only variable it allocates the stack for is <code>overflowme</code>. </p>\n\n<p>Can anybody explain why the stack allocates this many extra bytes? </p>\n\n<p>I have another question,I printed 32 bytes of 'A' into the program and I inspected the stack at the <code>gets</code> function line(after the execution). This is the result:</p>\n\n<pre><code>0xffffcd20: 0xffffcd3c  0xffffce24  0xf7fa0000  0xf7f9ea60\n0xffffcd30: 0x00000000  0xf7fa0000  0xf7ffc840  0x41414141\n0xffffcd40: 0x41414141  0x41414141  0x41414141  0x41414141\n0xffffcd50: 0x41414141  0x41414141  0x41414141  0x93e65400\n0xffffcd60: 0x56556ff4  0xf7fa0000  0xffffcd88  0x5655569f\n0xffffcd70: 0xdeadbeef  0x00000000  0x565556b9  0x00000000\n0xffffcd80: 0xf7fa0000  0xf7fa0000  0x00000000  0xf7dd5fb9\n0xffffcd90: 0x00000001  0xffffce24  0xffffce2c  0xffffcdb4\n0xffffcda0: 0x00000001  0x00000000  0xf7fa0000  0x00000000\n0xffffcdb0: 0xf7ffd000  0x00000000  0xf7fa0000  0xf7fa0000\n</code></pre>\n\n<p>The question is: What are the bytes between the <code>0x5655569f</code> (which is the return address) value, and the end of the 'A's? Are there just random junk?</p>\n\n<p>EDIT: Forgot to add, the binary is a 32 bit binary, dynamically linked, with debugging symbols.</p>\n"}, {"tags": ["c", "pass-by-reference"], "comments": [{"owner": {"reputation": 6595, "user_id": 5218277, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZuEZa.jpg?s=128&g=1", "display_name": "Alex Lop.", "link": "https://stackoverflow.com/users/5218277/alex-lop"}, "edited": false, "score": 5, "creation_date": 1576676312, "post_id": 59393195, "comment_id": 104975921, "body": "No difference from the syntax point of view. The <code>&amp;data[0]</code> is a bit longer but much more informative to the observer. It says that <code>data</code> is not just some variable but an array and you are passing the address of the beginning of it."}], "answers": [{"tags": [], "owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": true, "score": 4, "last_activity_date": 1576676752, "last_edit_date": 1576676752, "creation_date": 1576676299, "answer_id": 59393252, "question_id": 59393195, "link": "https://stackoverflow.com/questions/59393195/difference-between-data0-vs-data/59393252#59393252", "title": "Difference between : &amp;data[0] vs. data", "body": "<p>There is no difference. Arrays (\"proper\" arrays) automatically <em>decay</em> to pointers to their first element.</p>\n\n<p>For example, lets say you have</p>\n\n<pre><code>int my_array[10];\n</code></pre>\n\n<p>then using plain <code>my_array</code> will automatically decay to a pointer to its first element, which is <code>&amp;my_array[0]</code>.</p>\n\n<p>It is this array-to-pointer decay that allows you to use both pointer arithmetic and array indexing for both arrays and pointers. For the array above <code>my_array[i]</code> is exactly equal to <code>*(my_array + i)</code>. This equivalence also exists for pointers:</p>\n\n<pre><code>int *my_pointer = my_array;  // Make my_pointer point to the first element of my_array\n</code></pre>\n\n<p>Then <code>my_pointer[i]</code> is <em>also</em> exactly equal to <code>*(my_pointer + i)</code>.</p>\n\n<hr>\n\n<p>For curiosity (and something you should never do in real programs), thanks to the <a href=\"https://en.wikipedia.org/wiki/Commutative_property\" rel=\"nofollow noreferrer\">commutative property</a> of addition an expression such as <code>*(my_array + i)</code> will also be equal to <code>*(i + my_array)</code> which is then equal to <code>i[my_array]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1576677071, "post_id": 59393253, "comment_id": 104976339, "body": "Conversely, if you know the function operates only on the single element, rather than treating as an array, it may communicate intent to write <code>&amp;data[0]</code>, though that is unusual to see."}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 2, "last_activity_date": 1576676300, "creation_date": 1576676300, "answer_id": 59393253, "question_id": 59393195, "link": "https://stackoverflow.com/questions/59393195/difference-between-data0-vs-data/59393253#59393253", "title": "Difference between : &amp;data[0] vs. data", "body": "<p>An array, when passed as a parameter to a function, automatically <em>decays</em> to a pointer to its first element.  So passing either <code>data</code> or <code>&amp;data[0]</code> to the function are exactly equivalent.  </p>\n\n<p>From a readability standpoint I would opt for the former.  It makes it clear to the reader that the function is potentially operating on the entire array and not just on one element.</p>\n"}, {"tags": [], "owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "is_accepted": false, "score": 1, "last_activity_date": 1576677148, "last_edit_date": 1576677148, "creation_date": 1576676323, "answer_id": 59393261, "question_id": 59393195, "link": "https://stackoverflow.com/questions/59393195/difference-between-data0-vs-data/59393261#59393261", "title": "Difference between : &amp;data[0] vs. data", "body": "<p>No difference. When coerced into a pointer, an array (<code>data</code>) decays into a pointer to its first element (<code>&amp;data[0]</code>).</p>\n\n<p>Remember that <code>data[0]</code> simply means <code>*(data+0)</code>, so <code>&amp;data[0]</code> is equivalent to <code>&amp;*(data+0)</code>, which simplifies to <code>data</code> (because <code>&amp;*</code> cancels out).</p>\n\n<p>Demo:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void) {\n   int data[2];\n   printf(\"%p\\n\", (void*)data);\n   printf(\"%p\\n\", (void*)&amp;*(data+0));\n   printf(\"%p\\n\", (void*)&amp;data[0]);\n   return 0;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ gcc -Wall -Wextra -pedantic a.c -o a &amp;&amp; a\n0x3c2180f4fa0\n0x3c2180f4fa0\n0x3c2180f4fa0\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 0, "creation_date": 1576676495, "post_id": 59393270, "comment_id": 104976044, "body": "\u201cdata is a pointer to the beginning of the array\u201d \u2014 No. It\u2019s the array itself. It <i>decays to</i> a pointer, but that isn\u2019t the same thing, as you can easily check by inspecting the value of <code>sizeof data</code>. As for \u201ceasier to read\u201d \u2014 you can make this argument but at least one answerer gives a compelling opposing argument, so it\u2019s clearly not universal."}], "tags": [], "owner": {"reputation": 69, "user_id": 11818732, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sbOgnv3Vk6Y/AAAAAAAAAAI/AAAAAAAAJek/w1Cus9f_z1c/photo.jpg?sz=128", "display_name": "Jakub Nov&#225;k", "link": "https://stackoverflow.com/users/11818732/jakub-nov%c3%a1k"}, "is_accepted": false, "score": 1, "last_activity_date": 1576676347, "creation_date": 1576676347, "answer_id": 59393270, "question_id": 59393195, "link": "https://stackoverflow.com/questions/59393195/difference-between-data0-vs-data/59393270#59393270", "title": "Difference between : &amp;data[0] vs. data", "body": "<p>data is a pointer to the beginning of the array.\n&amp;data[0] is an address of the first element of an array. </p>\n\n<p>When reading a code, the first option is, for the most people, more readable and i suppose is a way most programmers will and should choose</p>\n"}, {"tags": [], "owner": {"reputation": 3158, "user_id": 11422223, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LWB0w.gif?s=128&g=1", "display_name": "Anirban166", "link": "https://stackoverflow.com/users/11422223/anirban166"}, "is_accepted": false, "score": 1, "last_activity_date": 1576676392, "creation_date": 1576676392, "answer_id": 59393282, "question_id": 59393195, "link": "https://stackoverflow.com/questions/59393195/difference-between-data0-vs-data/59393282#59393282", "title": "Difference between : &amp;data[0] vs. data", "body": "<p>There isn't any difference as both point to the same starting location of the array i.e. a[0]. </p>\n"}, {"tags": [], "owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "is_accepted": false, "score": 2, "last_activity_date": 1576676400, "creation_date": 1576676400, "answer_id": 59393285, "question_id": 59393195, "link": "https://stackoverflow.com/questions/59393195/difference-between-data0-vs-data/59393285#59393285", "title": "Difference between : &amp;data[0] vs. data", "body": "<p>Apart from the obvious (<code>data</code> being shorter than <code>&amp;data[0]</code>; therefore easier to write and to read), there's no difference.</p>\n\n<p>Think about what <code>&amp;data[0]</code> means:</p>\n\n<ul>\n<li>It's a pointer to <code>data[0]</code>.</li>\n<li>And <code>data[0]</code> just means <code>*(data+0)</code>, i.e. <code>*data</code>.</li>\n<li>A pointer to <code>*data</code> is simply <code>data</code>.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 1, "last_activity_date": 1576677474, "last_edit_date": 1576677474, "creation_date": 1576676969, "answer_id": 59393444, "question_id": 59393195, "link": "https://stackoverflow.com/questions/59393195/difference-between-data0-vs-data/59393444#59393444", "title": "Difference between : &amp;data[0] vs. data", "body": "<p>I always advice to use a general approach.</p>\n\n<p>Just consider the function</p>\n\n<pre><code>void myFunction( char* data);\n</code></pre>\n\n<p>where the parameter has the type <code>char *</code> instead of <code>int *</code>.</p>\n\n<p>And now let's assume that you want to pass to the function a string literal.</p>\n\n<p>It can be done either like</p>\n\n<pre><code>myFunction( \"Hello\" );\n</code></pre>\n\n<p>or like</p>\n\n<pre><code>myFunction( &amp;\"Hello\"[0] );\n</code></pre>\n\n<p>It is evident that the first approach is more clear and readable. </p>\n\n<p>So I prefer to use the first approach.:)</p>\n\n<p>In fact such an expression</p>\n\n<pre><code>&amp;data[i];\n</code></pre>\n\n<p>is syntactically redundant.. In fact it looks like</p>\n\n<pre><code>&amp;( *( data + i ) )\n</code></pre>\n\n<p>that is equivalent to just</p>\n\n<pre><code>data + i\n</code></pre>\n\n<p>When <code>i</code> is equal to 0 then you have</p>\n\n<pre><code>data + 0\n</code></pre>\n\n<p>that in expressions  is equivalent (I do not take into account for example the sizeof operaor) to</p>\n\n<pre><code>data\n</code></pre>\n\n<p>So use <code>data</code> instead of <code>&amp;data[0]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 90, "user_id": 12558878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d03ef96774b65865c2cfb2179433e0b?s=128&d=identicon&r=PG&f=1", "display_name": "Hakachukai", "link": "https://stackoverflow.com/users/12558878/hakachukai"}, "is_accepted": false, "score": 1, "last_activity_date": 1576677058, "creation_date": 1576677058, "answer_id": 59393470, "question_id": 59393195, "link": "https://stackoverflow.com/questions/59393195/difference-between-data0-vs-data/59393470#59393470", "title": "Difference between : &amp;data[0] vs. data", "body": "<p>I would just use <code>my_function(data)</code> because why make it more confusing than it has to be?</p>\n\n<p>If for some reason you needed to find the memory address of a single element somewhere in the middle of data, then <code>my_function(&amp;data[17])</code> might possibly be warranted, but there are probably better ways to handle that case too.</p>\n\n<p>In general if you have to manually and specifically pick out single pieces of data like that by hand, you are probably not doing it in a very good way.</p>\n\n<p>There are rare cases where it can makes sense ( like if you are parsing data from some other source and you ALWAYS 100% of the time only care about the 17th byte )... but that's not usually the case.</p>\n\n<p>Consider the following:\nAs your code evolves and you make changes, you will probably also slightly change data structures. Data[17] might no longer be the magical byte that you need anymore. Now it might be data[18]. If you manually hard coded data[17] in 100 or 1000 different places in your code, you will now have to go manually change them all and hope that it doesn't cause any new bugs. Also... portability issues.</p>\n\n<p>Instead design functions that can find and return whatever data you need from your data structures without needing any hard coded addresses. They will still work ( if designed properly ) as your code evolves and will be 1000 times more portable. </p>\n"}], "owner": {"reputation": 889, "user_id": 8080758, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5ce11073e465a49f65a4a6430e090dae?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/8080758/cl%c3%a9ment"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 412, "favorite_count": 0, "accepted_answer_id": 59393252, "answer_count": 8, "score": 3, "last_activity_date": 1576677474, "creation_date": 1576676114, "question_id": 59393195, "link": "https://stackoverflow.com/questions/59393195/difference-between-data0-vs-data", "title": "Difference between : &amp;data[0] vs. data", "body": "<p>When I want to pass an array by reference to a function I don't know what to choose.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>void myFunction(int* data);\n</code></pre>\n\n<p>Is there a difference or a best coding way between those two cases:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>myFunction(&amp;data[0]);\n</code></pre>\n\n<p><strong>Or</strong></p>\n\n<pre class=\"lang-c prettyprint-override\"><code>myFunction(data);\n</code></pre>\n"}, {"tags": ["c", "linux", "null", "ncurses"], "comments": [{"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 3, "creation_date": 1576676382, "post_id": 59393188, "comment_id": 104975971, "body": "Also see the <a href=\"https://linux.die.net/man/3/mvwprintw\" rel=\"nofollow noreferrer\"><code>mvwprintw(3)</code> man page</a>. You should probably use an empty format string in this case. Consider, you cannot <code>printf(NULL)</code>, so you should not <code>mvwprintw(..., NULL)</code>. <code>mvwprintw(..., &quot;&quot;)</code> should side-step the landmine. (I can&#39;t find a Q&amp;A about <code>printf(NULL)</code> to cite for you)."}, {"owner": {"reputation": 90, "user_id": 12558878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d03ef96774b65865c2cfb2179433e0b?s=128&d=identicon&r=PG&f=1", "display_name": "Hakachukai", "link": "https://stackoverflow.com/users/12558878/hakachukai"}, "reply_to_user": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1576677327, "post_id": 59393188, "comment_id": 104976471, "body": "Is &quot;&quot; as a NULL terminated string != NULL?  said another way: <code>&quot;&quot; == NULL</code>  &lt;-- is this true?"}, {"owner": {"reputation": 90, "user_id": 12558878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d03ef96774b65865c2cfb2179433e0b?s=128&d=identicon&r=PG&f=1", "display_name": "Hakachukai", "link": "https://stackoverflow.com/users/12558878/hakachukai"}, "reply_to_user": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1576677788, "post_id": 59393188, "comment_id": 104976733, "body": "Sorry I should have specified that I using GNU C. I edited the post to reflect that."}, {"owner": {"reputation": 90, "user_id": 12558878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d03ef96774b65865c2cfb2179433e0b?s=128&d=identicon&r=PG&f=1", "display_name": "Hakachukai", "link": "https://stackoverflow.com/users/12558878/hakachukai"}, "reply_to_user": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1576678000, "post_id": 59393188, "comment_id": 104976849, "body": "After some thought, I think I now understand. &quot;&quot; is a pointer to an address who&#39;s value is NULL. NULL is a pointer to address 0x0. The two are not the same. Thanks for the help!"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 3, "creation_date": 1576678093, "post_id": 59393188, "comment_id": 104976896, "body": "<code>&quot;&quot; == NULL</code> No. A <code>&quot;&quot;</code> is a pointer that points to a readonly location with a single byte that contains zero. A <code>NULL</code> is a 0. They differ."}, {"owner": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "edited": false, "score": 1, "creation_date": 1576708828, "post_id": 59393188, "comment_id": 104990999, "body": "It&#39;s undefined behavior (for instance <a href=\"https://www.geeksforgeeks.org/g-fact-44-passing-null-to-printf-in-c/\" rel=\"nofollow noreferrer\">this comment</a>).  ncurses does a number of pointer checks, anyway, but could miss some useful ones."}], "answers": [{"tags": [], "owner": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "is_accepted": false, "score": 0, "last_activity_date": 1576960363, "creation_date": 1576960363, "answer_id": 59439643, "question_id": 59393188, "link": "https://stackoverflow.com/questions/59393188/linux-c-ncurses-issue/59439643#59439643", "title": "Linux C Ncurses issue", "body": "<p>Actually (there's no sample <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">MCVE</a>) to test in this question), ncurses does check for this null pointer and is expected to ignore the <code>printw</code> which would be called after the <code>wmove</code> part.</p>\n\n<p>To see this, follow the source-code:</p>\n\n<ul>\n<li><a href=\"https://github.com/ThomasDickey/ncurses-snapshots/blob/d43e273aa3a4a69881cecdfd631d689fbd4224d8/ncurses/base/lib_printw.c#L110\" rel=\"nofollow noreferrer\"><code>mvprintw</code></a> is always a function call (due to the variable-length argument list)</li>\n<li><a href=\"https://github.com/ThomasDickey/ncurses-snapshots/blob/d43e273aa3a4a69881cecdfd631d689fbd4224d8/ncurses/base/lib_printw.c#L151\" rel=\"nofollow noreferrer\"><code>vw_printw</code></a> is the next step, which calls</li>\n<li><a href=\"https://github.com/ThomasDickey/ncurses-snapshots/blob/d43e273aa3a4a69881cecdfd631d689fbd4224d8/ncurses/base/safe_sprintf.c#L221\" rel=\"nofollow noreferrer\"><code>_nc_printf_string</code></a>, which <strong><a href=\"https://github.com/ThomasDickey/ncurses-snapshots/blob/d43e273aa3a4a69881cecdfd631d689fbd4224d8/ncurses/base/safe_sprintf.c#L227\" rel=\"nofollow noreferrer\">sees</a></strong> the null-pointer for the format, and returns null,</li>\n<li>making <code>vw_printw</code> <strong><a href=\"https://github.com/ThomasDickey/ncurses-snapshots/blob/d43e273aa3a4a69881cecdfd631d689fbd4224d8/ncurses/base/lib_printw.c#L162\" rel=\"nofollow noreferrer\">ignore</a></strong> the call.</li>\n</ul>\n"}], "owner": {"reputation": 90, "user_id": 12558878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d03ef96774b65865c2cfb2179433e0b?s=128&d=identicon&r=PG&f=1", "display_name": "Hakachukai", "link": "https://stackoverflow.com/users/12558878/hakachukai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576960363, "creation_date": 1576676092, "last_edit_date": 1576677651, "question_id": 59393188, "link": "https://stackoverflow.com/questions/59393188/linux-c-ncurses-issue", "title": "Linux C Ncurses issue", "body": "<p>I'm having a strange problem with Ncurses in C that I can't seem to find documented anywhere, nor on the web. Maybe I'm not using the correct search terms?</p>\n\n<h2>Here is the problem:</h2>\n\n<p>I have several windows and panels and LOTs of code. It all works perfectly UNTIL this happens:</p>\n\n<p><code>mvwprintw(windowptr[i], y, x, NULL); &lt;-- That NULL value is what sets off the bomb</code></p>\n\n<p>I would expect that a NULL string would simply print a string of 0 length, but that's not what happens. What actually happens is that it corrupts all of my windows/panels. It seems to be somehow deleting all previously written chars and disabling the displaying of new chars on all windows / panels except the current window / panel. The current window / panel does not get blanked, but no new chars can be printed to it.</p>\n\n<p>Is this a bug? ... or maybe an undocumented feature?</p>\n\n<h2>Here's my Ncurses version:</h2>\n\n<pre><code>$ dpkg -l | grep -i ncurse\nii  libncurses5:amd64                             6.0+20160213-1ubuntu1                           amd64        shared libraries for terminal handling\nii  libncurses5:i386                              6.0+20160213-1ubuntu1                           i386         shared libraries for terminal handling\nii  libncurses5-dev:amd64                         6.0+20160213-1ubuntu1                           amd64        developer's libraries for ncurses\nii  libncursesw5:amd64                            6.0+20160213-1ubuntu1                           amd64        shared libraries for terminal handling (wide character support)\nii  libncursesw5:i386                             6.0+20160213-1ubuntu1                           i386         shared libraries for terminal handling (wide character support)\nii  mtr-tiny                                      0.86-1ubuntu0.1                                 amd64        Full screen ncurses traceroute tool\nii  ncurses-base                                  6.0+20160213-1ubuntu1                           all          basic terminal type definitions\nii  ncurses-bin                                   6.0+20160213-1ubuntu1                           amd64        terminal-related programs and man pages\nii  ncurses-term                                  6.0+20160213-1ubuntu1                           all          additional terminal type definitions\n</code></pre>\n"}, {"tags": ["c", "pointers", "enums", "function-pointers", "void-pointers"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1576675987, "post_id": 59393090, "comment_id": 104975739, "body": "On modern systems memory is divided into pages. A page can be mapped to your process or not. If a page is <i>not</i> mapped to your process the process can&#39;t access memory in it. No user-space process will have the page &quot;zero&quot; (which include the address <code>0</code>, commonly the null pointer) mapped. Attempting to access any memory in an unmapped page will result in an error. Perhaps you should take some time to rethink how you use the values in the structure, especially you should not treat them as pointers unless you actually <i>know</i> that the value is a valid pointer?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1576676201, "post_id": 59393090, "comment_id": 104975866, "body": "Regarding ways to handle the value (&quot;parameter&quot; as you call it), perhaps is should really be a <i>parameter</i>, i.e. an <i>argument</i> that you pass to the function that is called? And then the called function could do what it want with the &quot;parameter&quot;, including casting it back to <code>menu_menus_type</code>."}, {"owner": {"reputation": 111, "user_id": 6881667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/464cfef52dca45936c8c2fdcc7c67f31?s=128&d=identicon&r=PG", "display_name": "L. Heinrichs", "link": "https://stackoverflow.com/users/6881667/l-heinrichs"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1576676239, "post_id": 59393090, "comment_id": 104975887, "body": "Thanks for the clarification. I wonder how I may pass a constant value taken from an enum to a function that expects a void pointer. Without storing it in an intermediate variable. About the second comment: If i pass it as a parameter, then internal library functions and callback functions can not change the values of this parameter? (or you thinking of sending the address as a parameter and creating a pointer to that address?)"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1576682158, "post_id": 59393090, "comment_id": 104979235, "body": "Don&#39;t cast integers into pointers, that&#39;s a smelly API design. Either pass values or pointers to variables containing values. Some oddball MCUs might trap if they fed get a misaligned pointer, even if you don&#39;t de-reference it."}], "answers": [{"comments": [{"owner": {"reputation": 111, "user_id": 6881667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/464cfef52dca45936c8c2fdcc7c67f31?s=128&d=identicon&r=PG", "display_name": "L. Heinrichs", "link": "https://stackoverflow.com/users/6881667/l-heinrichs"}, "edited": false, "score": 0, "creation_date": 1576676815, "post_id": 59393345, "comment_id": 104976203, "body": "I changed the derefencing to a simple cast, and the unit tests run fine now. I dunno what hit me while i was initially writing that. Ofc, if i input a number, i just use a number. But why did this work on the microcontroller?"}, {"owner": {"reputation": 2275, "user_id": 3742943, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ijesw.jpg?s=128&g=1", "display_name": "LoPiTaL", "link": "https://stackoverflow.com/users/3742943/lopital"}, "reply_to_user": {"reputation": 111, "user_id": 6881667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/464cfef52dca45936c8c2fdcc7c67f31?s=128&d=identicon&r=PG", "display_name": "L. Heinrichs", "link": "https://stackoverflow.com/users/6881667/l-heinrichs"}, "edited": false, "score": 0, "creation_date": 1576677933, "post_id": 59393345, "comment_id": 104976815, "body": "@L.Heinrichs New edit trying to explain a bit more what happened."}, {"owner": {"reputation": 111, "user_id": 6881667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/464cfef52dca45936c8c2fdcc7c67f31?s=128&d=identicon&r=PG", "display_name": "L. Heinrichs", "link": "https://stackoverflow.com/users/6881667/l-heinrichs"}, "edited": false, "score": 0, "creation_date": 1576678095, "post_id": 59393345, "comment_id": 104976897, "body": "I figured out why it behaved differently. There is a function changing the menu that was specifically designed for unit tests, to be able to change the menu without having the rest of the menu system being active. In this version, the value was dereferenced as described above, leading to memory access violations. The menu systems internals that would usually change the menu did not derefence but typecast the value, exactly what you pointed out was the right way to go."}], "tags": [], "owner": {"reputation": 2275, "user_id": 3742943, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ijesw.jpg?s=128&g=1", "display_name": "LoPiTaL", "link": "https://stackoverflow.com/users/3742943/lopital"}, "is_accepted": true, "score": 2, "last_activity_date": 1576677918, "last_edit_date": 1576677918, "creation_date": 1576676617, "answer_id": 59393345, "question_id": 59393090, "link": "https://stackoverflow.com/questions/59393090/c-pass-an-typedefd-enum-value-to-a-function-as-a-pointer/59393345#59393345", "title": "C: Pass an typedef&#39;d enum value to a function as a pointer", "body": "<p>The derreferencing you are using is wrong.</p>\n\n<p>You should NOT derreference it.</p>\n\n<p>In order to get the number, you should just cast it, the reverse way as you used in the <code>functions</code>array:</p>\n\n<pre><code>//Note that there are no pointer casting, nor derreference.\n//All you want is to cast a \"void pointer\" (pointer) to an \"int\", so just do it:\nint myNumber=(menu_menus_type)pointer;\n</code></pre>\n\n<p>If you derreference it, then you access the invalid memory and you have the crash then.</p>\n\n<p>NOTE: You should cast to the ACTUAL type. You should not cast to an <code>int</code>, <code>uint8_t</code> or any other, since the compiler is free to use any suitable size for the <code>enums</code>, and if it choose a different integer type, then the cast could be incorrect.\nThe correct way is as shown in the example, using a cast directly to the enum type.</p>\n\n<hr>\n\n<blockquote>\n  <p>the pointer is dereferenced as <em>(uint8_t</em>)pointer. Shouldnt this return the value stored at address 1?</p>\n</blockquote>\n\n<p>No, you have not stored anything in the pointer. You have set the value of the pointer to point to address <code>1</code>. When derreferencing this address, you are trying to read the data in that address, which is not what you want.</p>\n\n<p>You want to recover the value of the pointer, which is what you have set in the first place. So just a cast is enough.</p>\n\n<hr>\n\n<blockquote>\n  <p>But why did this work on the microcontroller?</p>\n</blockquote>\n\n<p>Because probably the microcontroller does not have any memory protection, while in a computer you have memory protection (given by the OS). </p>\n\n<p>So, the microcontroller tries to access that pointer anad the (unexisting) memory protection allows it to do so. This is why the tests crashes.</p>\n\n<p>But then, usually, in the low addresses of the microcontrollers is stored the interrupt table, so the addresses at 0x0 and up are usually valid in these devices, thus succeeding the read and not giving any error.</p>\n\n<p>But the read value is not the value you are expecting. It would contain the data in the address 0x1, and not the value 0x1</p>\n\n<blockquote>\n  <p>, the system would try to change to menu ID address of interrupt handler.</p>\n</blockquote>\n\n<p>This is not correct either.</p>\n\n<p>You are accessing the address \"0x1\".\nAssuming a uC with 32 bit pointers, the pointer size is 4, so you are accessing an address beginning in the second byte, not the first (the first handler would be at address 0x0, the second at address 0x4, and so)...</p>\n\n<p>And after accessing the address, you are casting it to <code>uint8_t*</code>, thus saying \"at this address, there is contained a value of just one byte size. Then derreferencing it, so you are reading a single byte at address 0x1, which may be whatever, but not an address, just a byte.\nProbably, by chance, it contains a 0x1 on it, so you have been lucky.</p>\n\n<p>This is the definition of \"Undefined Behaviour\": anything can happen, even work correctly, but that case is just luck</p>\n"}], "owner": {"reputation": 111, "user_id": 6881667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/464cfef52dca45936c8c2fdcc7c67f31?s=128&d=identicon&r=PG", "display_name": "L. Heinrichs", "link": "https://stackoverflow.com/users/6881667/l-heinrichs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 0, "accepted_answer_id": 59393345, "answer_count": 1, "score": 0, "last_activity_date": 1576677918, "creation_date": 1576675699, "question_id": 59393090, "link": "https://stackoverflow.com/questions/59393090/c-pass-an-typedefd-enum-value-to-a-function-as-a-pointer", "title": "C: Pass an typedef&#39;d enum value to a function as a pointer", "body": "<p><strong>CONCEPT</strong></p>\n\n<p>I have a library that runs some library code and then calls a user callback function with help of a function pointer. As a minimal example, it may be defined as follows:</p>\n\n<pre><code>function_typDef functions[] = {\n    { READ_INT      , set_led_pwm, (void*)&amp;pwm_value } };\n     ^library func  ^user func    ^parameter\n</code></pre>\n\n<p>For anyone wondering what this is for: in this case it is used for a menu system. The library provides internal functions like changing menus, printing the current menu or reading user inputs. Every time the library is called, a user callback function may be run after the internal function, with a void-pointer passed as the parameter. The example above changes to input mode, reads a user input, converts it to an INT, stores this int at &amp;pwm_value and then calls set_led_pwm((void*)&amp;pwm_value).</p>\n\n<p><strong>PROBLEM</strong></p>\n\n<p>One of the main functions of a menu is to change between (sub)menus/menu pages. Menus are listed in a menu_menus_type, a typedef'd enum.</p>\n\n<pre><code>typedef enum menu_menus_type{\n    MENU_MAIN,\n    MENU_SUB1,\n    MENU_COUNT\n} menu_menus_type; \n</code></pre>\n\n<p>To change a menu, the same concept as shown above for the PWM value change shall be used to change the menu:</p>\n\n<pre><code>function_typDef functions[] = {\n    { READ_INT      , set_led_pwm, (void*)&amp;pwm_value },\n    { CHANGE_MENU   , NULL       , (void*) MENU_SUB1 } };\n     ^library func    ^user func   ^parameter\n</code></pre>\n\n<p>This works perfectly fine on the microcontroller I tested this on. However, <em>the program crashes during unit testing, due to a memory access violation</em>.</p>\n\n<p><strong>QUESTIONS</strong></p>\n\n<p>From what I understand, enum elements are just replaced by integer numbers during preprocessing. The typedef does not have any effect on this, it just tells the compiler to check if the identifier passed is part of the typedef'd enum. Correct?</p>\n\n<p>If the above is correct, (void*)MENU_SUB1 should create a pointer to address 1. This is most likely not a valid address when used with an operating system, that will detect the violation?</p>\n\n<p>When actually changing the menu, the pointer is dereferenced as <code>*(uint8_t*)pointer</code>. Shouldnt this return the value stored at address 1? That would be anything, but certainly not a valid ID for a menu. Why does this work on the microcontroller?</p>\n"}, {"tags": ["c++", "c", "objective-c"], "comments": [{"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 3, "creation_date": 1576675448, "post_id": 59393006, "comment_id": 104975471, "body": "What language are you actually using?  This is tagged with three different ones."}, {"owner": {"reputation": 6192, "user_id": 2041317, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/58b0m.png?s=128&g=1", "display_name": "cup", "link": "https://stackoverflow.com/users/2041317/cup"}, "edited": false, "score": 0, "creation_date": 1576675666, "post_id": 59393006, "comment_id": 104975584, "body": "Look up Stringification in the C preprocessor.   You might be surprised at what can be done"}, {"owner": {"reputation": 33, "user_id": 12540706, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EKuRy9Fz_CY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcTPBasCwTQ5_-TTaaUlMw621nXMg/photo.jpg?sz=128", "display_name": "Wayne Xiong", "link": "https://stackoverflow.com/users/12540706/wayne-xiong"}, "reply_to_user": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 0, "creation_date": 1576676474, "post_id": 59393006, "comment_id": 104976030, "body": "@NathanOliver-ReinstateMonica Actually, I am using Objective-C. But to macro definition and processing, Objective-C is same as C."}], "answers": [{"comments": [{"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 0, "creation_date": 1576677437, "post_id": 59393099, "comment_id": 104976522, "body": "Not contain, only start-with. <code>n__n</code> is a valid variable name for application use."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 0, "creation_date": 1576677622, "post_id": 59393099, "comment_id": 104976633, "body": "@R.. Yes contain. <code>n__n</code> is reserved. You may be confused with the rule that identifiers starting with underscore followed capital letter are also reserved. Also all identifiers starting with underscore followed by any character in global namespace."}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 0, "creation_date": 1576679187, "post_id": 59393099, "comment_id": 104977486, "body": "This question is tagged for 3 separate languages, so perhaps you have a different one in mind than I do (C). <code>n__n</code> is not reserved in C."}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "reply_to_user": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 0, "creation_date": 1576679229, "post_id": 59393099, "comment_id": 104977514, "body": "@R.. Oh, I didn&#39;t notice the language tags. My answer applies to C++. You may be correct regarding C."}, {"owner": {"reputation": 33, "user_id": 12540706, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EKuRy9Fz_CY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcTPBasCwTQ5_-TTaaUlMw621nXMg/photo.jpg?sz=128", "display_name": "Wayne Xiong", "link": "https://stackoverflow.com/users/12540706/wayne-xiong"}, "edited": false, "score": 0, "creation_date": 1576848566, "post_id": 59393099, "comment_id": 105038120, "body": "Since it&#39;s not the right way to solve my problem, I have changed my mind to solve it in another way: <a href=\"https://stackoverflow.com/questions/59394700/is-it-possible-to-use-line-in-the-auto-generated-variable-name-in-c\" title=\"is it possible to use line in the auto generated variable name in c\">stackoverflow.com/questions/59394700/&hellip;</a>."}], "tags": [], "owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "is_accepted": true, "score": 0, "last_activity_date": 1576679248, "last_edit_date": 1576679248, "creation_date": 1576675746, "answer_id": 59393099, "question_id": 59393006, "link": "https://stackoverflow.com/questions/59393006/is-it-possible-to-replace-or-in-a-string-with-in-a-macro/59393099#59393099", "title": "Is it possible to replace / or . in a string with __ in a macro?", "body": "<blockquote>\n  <p>But with macro, is it possible?</p>\n</blockquote>\n\n<p>No. It is not possible to replace characters of an argument using the standard preprocessor.</p>\n\n<blockquote>\n  <p>acceptable by variable naming, such as __</p>\n</blockquote>\n\n<p><code>__</code> is not an acceptable variable name because it is reserved to the implementation. As are all identifiers that contain consecutive underscores in C++.</p>\n"}], "owner": {"reputation": 33, "user_id": 12540706, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EKuRy9Fz_CY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcTPBasCwTQ5_-TTaaUlMw621nXMg/photo.jpg?sz=128", "display_name": "Wayne Xiong", "link": "https://stackoverflow.com/users/12540706/wayne-xiong"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "closed_date": 1576675909, "accepted_answer_id": 59393099, "answer_count": 1, "score": 0, "last_activity_date": 1576679248, "creation_date": 1576675328, "question_id": 59393006, "link": "https://stackoverflow.com/questions/59393006/is-it-possible-to-replace-or-in-a-string-with-in-a-macro", "closed_reason": "Duplicate", "title": "Is it possible to replace / or . in a string with __ in a macro?", "body": "<p>I want to convert a string with / or . into an auto-generated variable name. So I need convert / or . into something acceptable by variable naming, such as __.</p>\n\n<p>It's easy to do it with a function. But with macro, is it possible?</p>\n\n<pre><code>#define ROUTE(path, impl) \\\nchar * k##path##_route = \"{\"#path\":\\\"\"#impl\"\\\"}\"; // compilation failure for path like /usr/abc or ./abc\n</code></pre>\n\n<p>I can use impl to name the variable, but since multiple paths may map to the same impl, the compiler will complain about duplication for different paths with the same impl.</p>\n"}, {"tags": ["c", "linux", "macos", "makefile", "makefile-errors"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1576674980, "post_id": 59392877, "comment_id": 104975252, "body": "Perhaps you don&#39;t have to? What problems do you have with the makefile in its current form? What happens when you use it and run <code>make</code>?"}, {"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 1, "creation_date": 1576675013, "post_id": 59392877, "comment_id": 104975267, "body": "Please <a href=\"https://stackoverflow.com/posts/59392877/edit\">edit</a> your question and explain why you need to change the Makefile. Do you get an error message?"}, {"owner": {"reputation": 17, "user_id": 11810706, "user_type": "registered", "profile_image": "https://graph.facebook.com/158156952006088/picture?type=large", "display_name": "Roman Kshetri", "link": "https://stackoverflow.com/users/11810706/roman-kshetri"}, "edited": false, "score": 0, "creation_date": 1576676019, "post_id": 59392877, "comment_id": 104975763, "body": "Thank you for your comments. I am trying to compile my c program code .The error I get is &quot; fatal error: eggx.h file not found&#39;.EGGX is a graphic library which is used as a header file in my program.I thought that it&#39;s a problem of makefile ,so i requested a help here."}, {"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 1, "creation_date": 1576679666, "post_id": 59392877, "comment_id": 104977777, "body": "Why did you revert the grammatical fixes?"}, {"owner": {"reputation": 17, "user_id": 11810706, "user_type": "registered", "profile_image": "https://graph.facebook.com/158156952006088/picture?type=large", "display_name": "Roman Kshetri", "link": "https://stackoverflow.com/users/11810706/roman-kshetri"}, "edited": false, "score": 0, "creation_date": 1576759414, "post_id": 59392877, "comment_id": 105007086, "body": "I am sorry, its by a mistake."}], "answers": [{"comments": [{"owner": {"reputation": 67968, "user_id": 584192, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YBSIc.png?s=128&g=1", "display_name": "Samuel Liew", "link": "https://stackoverflow.com/users/584192/samuel-liew"}, "edited": false, "score": 0, "creation_date": 1576799317, "post_id": 59393059, "comment_id": 105023822, "body": "Comments are not for extended discussion; this conversation has been <a href=\"https://chat.stackoverflow.com/rooms/204584/discussion-on-answer-by-mark-setchell-how-to-change-the-following-makefile-so-th\">moved to chat</a>."}], "tags": [], "owner": {"reputation": 144819, "user_id": 2836621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/suHg4.jpg?s=128&g=1", "display_name": "Mark Setchell", "link": "https://stackoverflow.com/users/2836621/mark-setchell"}, "is_accepted": false, "score": 1, "last_activity_date": 1576761824, "last_edit_date": 1576761824, "creation_date": 1576675591, "answer_id": 59393059, "question_id": 59392877, "link": "https://stackoverflow.com/questions/59392877/how-to-change-the-following-makefile-so-that-it-works-for-macos/59393059#59393059", "title": "How to change the following Makefile so that it works for MacOS?", "body": "<p>You will want to review at least the following:</p>\n\n<ul>\n<li><p>do you want to continue to use <code>gcc</code> as your compiler, or move to Apple's <code>clang</code></p></li>\n<li><p>if you want to use X11, you will need to install <strong>XQuartz</strong> and add the following options:</p>\n\n<p><code>X11FLAGS=-I /opt/X11/include</code>\n<code>X11LIBS=-L /opt/X11/lib -lx11</code></p></li>\n<li><p>you can remove <code>/usr/local/lib64</code> because <strong>macOS</strong> doesn't use that</p></li>\n<li><p>you will want to decide it you are going to use a package manager, such as <strong>homebrew</strong> because Apple doesn't provide one. Associated with that, you may want to use <code>pkgconfig</code> from <strong>homebrew</strong> to automate your compiler and linker flags and switches.</p></li>\n</ul>\n\n<p>You may also find <a href=\"https://stackoverflow.com/a/32338889/2836621\">this</a> helpful, and <a href=\"https://stackoverflow.com/a/34341219/2836621\">this</a>.</p>\n\n<hr>\n\n<p>I modified the <code>Makefile</code> included in the <code>egg</code> package to look like this and it compiles and builds fine on my Mac under macOS Mojave:</p>\n\n<pre><code>CC    = gcc\nCFLAGS = -O2 -Wall\nDESTDIR =\nUSERCC   = gcc\nUSERCCFLAGS = -O2 -Wall\nUSERFC   = gfortran\nUSERFCFLAGS = -O2 -Wall\n\nIINC  = -I/opt/X11/include\nLLIB  = -L /opt/X11/lib\n\nPREFIX = /usr/local\n\nINCDIR = $(PREFIX)/include\nLIBDIR = $(PREFIX)/lib\nBINDIR = $(PREFIX)/bin\n\nLOCALINC = -I$(INCDIR)\nLOCALLIB = -L$(LIBDIR)\n\nLLINKS = -leggx -lX11 -lm\n\nDEFS = $(VDEFS) $(TDEFS) $(UDEFS) $(PDEFS) $(XDEFS)\n\nall:: _xslave_ mkexheader exec_xslave.h lib egg\n\ninstall:: lib egg\n    if [ ! -d $(DESTDIR)$(LIBDIR) ];then sh install-sh -d $(DESTDIR)$(LIBDIR); fi\n    if [ ! -d $(DESTDIR)$(INCDIR) ];then sh install-sh -d $(DESTDIR)$(INCDIR); fi\n    if [ ! -d $(DESTDIR)$(BINDIR) ];then sh install-sh -d $(DESTDIR)$(BINDIR); fi\n    sh install-sh -m 644 libeggx.a $(DESTDIR)$(LIBDIR)\n    sh install-sh -m 644 eggx*.h $(DESTDIR)$(INCDIR)\n    sh install-sh -m 755 egg $(DESTDIR)$(BINDIR)\n    ranlib $(DESTDIR)$(LIBDIR)/libeggx.a\n\n.c.o:   ; $(CC) $(CFLAGS) $(IINC) $(DEFS) -c $*.c\n\n_xslave_: _xslave_.o _eggx_scrollbar.o\n    $(CC) $(CFLAGS) _xslave_.o _eggx_scrollbar.o -o _xslave_ $(LLIB) -lX11\n\nmkexheader: mkexheader.o\n    $(CC) $(CFLAGS) mkexheader.o -o mkexheader\n\nexec_xslave.h: mkexheader _xslave_\n    ./mkexheader _xslave_ &gt; exec_xslave.h\n\neggx_base.o: exec_xslave.h\n\nlib:: eggx_base.o eggx_color.o\n    ar cruv libeggx.a eggx_base.o eggx_color.o\n    ranlib libeggx.a\n\negg:: egg.sh\n    cat egg.sh &gt; egg\n    rm -f egg.t\n    for i in USERCC \"x@@$(USERCC)\" USERFC \"x@@$(USERFC)\" \\\n      USERCCFLAGS \"x@@$(USERCCFLAGS)\" USERFCFLAGS \"x@@$(USERFCFLAGS)\" \\\n      IINC \"x@@$(IINC)\" LLIB \"x@@$(LLIB)\" LOCALINC \"x@@$(LOCALINC)\" \\\n      LOCALLIB \"x@@$(LOCALLIB)\" LLINKS \"x@@$(LLINKS)\" ; do { \\\n      if [ -f egg.t ] ; then \\\n        if [ \"$$i\" = \"x@@\" ] ; then \\\n          cat egg.t | sed -e \"s|@@@TARGET@@@||\" &gt; egg ; \\\n        else \\\n          cat egg.t | sed -e \"s|@@@TARGET@@@|$$i|\" | sed -e 's|x@@||' &gt; egg ; \\\n        fi ; \\\n        rm -f egg.t ; \\\n      else \\\n        cat egg | sed -e \"s|@$$i@|@@@TARGET@@@|\" &gt; egg.t ; \\\n      fi ; \\\n    } done\n    chmod 755 egg\n\nclean::\n    rm -f *.o *.exe egg egg.t libeggx.a _xslave_ mkexheader exec_xslave.h\n</code></pre>\n\n<p>If you saved the <code>tarball</code> of <code>eggx</code> in directory <code>HOME/eggx</code>, you would need to do this:</p>\n\n<pre><code>cd $HOME/eggx\ntar -xvf eggx-0.93r5.tar\ncd eggx-0.93r5\n</code></pre>\n\n<p>Then copy the modified <code>Makefile</code> from above and save it in that directory as <code>Makefile</code>. Now just run:</p>\n\n<pre><code>make\n</code></pre>\n\n<p>and it should all build fine.</p>\n"}], "owner": {"reputation": 17, "user_id": 11810706, "user_type": "registered", "profile_image": "https://graph.facebook.com/158156952006088/picture?type=large", "display_name": "Roman Kshetri", "link": "https://stackoverflow.com/users/11810706/roman-kshetri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "closed_date": 1576774718, "answer_count": 1, "score": 0, "last_activity_date": 1576761824, "creation_date": 1576674878, "last_edit_date": 1576720946, "question_id": 59392877, "link": "https://stackoverflow.com/questions/59392877/how-to-change-the-following-makefile-so-that-it-works-for-macos", "closed_reason": "Not suitable for this site", "title": "How to change the following Makefile so that it works for MacOS?", "body": "<p>I used to do C programming in Linux. Now,I got MacBook and I want to do programming on the Mac.</p>\n\n<p>How should I change the following makefile ?</p>\n\n<pre><code># Makefile\n\nOBJS = main\n\n$(OBJS): $(OBJS).o\n#   gcc -O2 -Wall $(OBJS).c -o $(OBJS)  -I/usr/local/include  -L/usr/local/lib64   -leggx -lX11 -lm\n    gcc $(OBJS).c -o $(OBJS)  -I/usr/local/include  -L/usr/local/lib64   -leggx -lX11 -lm\n\n$(OBJS).o: $(OBJS).c\n    gcc -c $(OBJS).c\n\n.PHONY: clean\nclean:\n     rm -f $(OBJS) $(OBJS).o \n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 2, "creation_date": 1576674358, "post_id": 59392704, "comment_id": 104974957, "body": "Oh, <code>questions</code> is saved and read successfully, but <code>questions</code> is just a pointer, and the thing it points to doesn&#39;t get saved and read."}, {"owner": {"reputation": 301, "user_id": 4287117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec64f958fb4cc3f79c4b7677670d0811?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/4287117/siddharth"}, "edited": false, "score": 0, "creation_date": 1576674766, "post_id": 59392704, "comment_id": 104975153, "body": "Have another call where you fwrite the list separately, followed by fwrite&#39;ing the two variables. Similar for fread. Something like myfread and myfwrite..."}], "answers": [{"comments": [{"owner": {"reputation": 99, "user_id": 10799483, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d65e62e96aec2817239f1585a318d26d?s=128&d=identicon&r=PG&f=1", "display_name": "shadowfish", "link": "https://stackoverflow.com/users/10799483/shadowfish"}, "edited": false, "score": 0, "creation_date": 1576676637, "post_id": 59393044, "comment_id": 104976110, "body": "What is the difference between <code>struct question* questions</code> and <code>question** questions</code>?"}], "tags": [], "owner": {"reputation": 458, "user_id": 1465347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a44d70d9d20883b8ae6230ea98d58e5c?s=128&d=identicon&r=PG", "display_name": "Melan", "link": "https://stackoverflow.com/users/1465347/melan"}, "is_accepted": false, "score": 3, "last_activity_date": 1576675514, "creation_date": 1576675514, "answer_id": 59393044, "question_id": 59392704, "link": "https://stackoverflow.com/questions/59392704/how-to-write-and-read-a-struct-which-contains-another-struct-in-c/59393044#59393044", "title": "How to write and read a struct which contains another struct in C?", "body": "<p>Can you try something like this in your struct definitions </p>\n\n<pre><code>typedef struct \n{\n    char* description;\n    char* alternativeAnswer[4];\n    int rightAnswer;\n}question;\n\ntypedef struct \n{\n    struct question* questions;\n    int size;\n    int max;\n}questionList;\n</code></pre>\n\n<p>Consider the following sample code </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nstruct student_college_detail\n{\n    int college_id;\n    char college_name[50];\n};\n\nstruct student_detail \n{\n    int id;\n    char name[20];\n    float percentage;\n    // structure within structure\n    struct student_college_detail clg_data;\n}stu_data;\n\nint main() \n{\n    struct student_detail stu_data = {1, \"Alex\", 90.5, 71145,\n                                       \"UCB\"};\n    FILE *outfile; \n\n    // open file for writing \n    outfile = fopen (\"student_detail.dat\", \"w\"); \n    if (outfile == NULL) \n    { \n        fprintf(stderr, \"\\nError opend file\\n\"); \n        exit (1); \n    } \n\n    // stu_data to file \n    fwrite (&amp;stu_data, sizeof(struct student_detail), 1, outfile); \n\n    if(fwrite != 0)  \n        printf(\"contents to file written successfully !\\n\"); \n    else \n        printf(\"error writing file !\\n\"); \n\n    // close file \n    fclose (outfile); \n\n    return 0;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 99, "user_id": 10799483, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d65e62e96aec2817239f1585a318d26d?s=128&d=identicon&r=PG&f=1", "display_name": "shadowfish", "link": "https://stackoverflow.com/users/10799483/shadowfish"}, "edited": false, "score": 0, "creation_date": 1576680843, "post_id": 59393615, "comment_id": 104978476, "body": "Thank you so much! I have two more questions.What does <code>nBytes</code> do?And is it necessary to coercion <code>q</code> ,<code>qList-&gt;size</code> and <code>qList-&gt;max</code> ?"}, {"owner": {"reputation": 695, "user_id": 2526978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f8879f3faf8d7b0ece063c3d127e3bc?s=128&d=identicon&r=PG", "display_name": "J C Gonzalez", "link": "https://stackoverflow.com/users/2526978/j-c-gonzalez"}, "reply_to_user": {"reputation": 99, "user_id": 10799483, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d65e62e96aec2817239f1585a318d26d?s=128&d=identicon&r=PG&f=1", "display_name": "shadowfish", "link": "https://stackoverflow.com/users/10799483/shadowfish"}, "edited": false, "score": 0, "creation_date": 1576737453, "post_id": 59393615, "comment_id": 104997169, "body": "The signature of the fwrite() function is <code>size_t      fwrite(const void *restrict ptr, size_t size, size_t nitems, FILE *restrict stream);</code>;  it returns the number of bytes written.  That helps you to know if everything went well.  The variable nBytes just gets this numbers.  This is not used in the functions above, but you may want to check, after every write or at the end, if you wrote/read what was expected. And fwrite/fread expect a (const) <code>void</code> pointer, so you simply cast it, so the compiler does not complain."}], "tags": [], "owner": {"reputation": 695, "user_id": 2526978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f8879f3faf8d7b0ece063c3d127e3bc?s=128&d=identicon&r=PG", "display_name": "J C Gonzalez", "link": "https://stackoverflow.com/users/2526978/j-c-gonzalez"}, "is_accepted": true, "score": 4, "last_activity_date": 1576677504, "creation_date": 1576677504, "answer_id": 59393615, "question_id": 59392704, "link": "https://stackoverflow.com/questions/59392704/how-to-write-and-read-a-struct-which-contains-another-struct-in-c/59393615#59393615", "title": "How to write and read a struct which contains another struct in C?", "body": "<p>Note that, as mentioned in a comment, this does not work due to the fact that you are using pointers for the question list.  For the char strings the program will read characters until a <code>\\0</code> is found.  But for anything else, only the value of the pointer variable will be written; that is, just the memory address.  </p>\n\n<p>(By the way, it is a bit strange that you use a double pointer for a list of questions.  I will assume that this is a mistake, and you meant <code>question * questions</code>.)</p>\n\n<p>My recommendation is to write, for each structure, a <code>write_&lt;structure&gt;</code> function, and use those for internal components in the functions of more external ones, following the structures' hierarchy from inside out.  Here you have only one level of indirection, and only one list of items, but this approach can be very useful for a multilevel, multilists problem.</p>\n\n<p>Note, however, that since you are using pointers, you will end up having to pre-allocate them at reading time.  And, since you did not specify the length of those strings at declaration time (you can allocate 10 or 10000 chars for the same pointer), you will not know how many characters to read for each string.  For this reason, I would also use predefined maximum lengths for the char strings; otherwise, you will end up having to pre-allocate them at reading time.  Doing so, in addition, you can write the entire structure at once.  The declarations would look like this:</p>\n\n<pre><code>#define NUM_OF_QUESTIONS    10\n#define MAX_STRING_LEN     256\n#define NUM_OF_ALT_ANSWERS   4\n\ntypedef struct {\n    char description[MAX_STRING_LEN];\n    char alternativeAnswer[NUM_OF_ALT_ANSWERS][MAX_STRING_LEN];\n    int rightAnswer;\n} question;\n\ntypedef struct  {\n    question questions[NUM_OF_QUESTIONS];\n    int size;\n    int max;\n} questionList;\n</code></pre>\n\n<p>Doing so, <em>you can now</em> use a single <code>fwrite</code> and a single <code>fread</code> to write and read in one single go the entire list of questions.  For this particular case, you will be done.</p>\n\n<p>Note that I fixed the number of questions.  If you don't want to do this (that is if you still have <code>question * questions</code>), my recommendation is to use the former (more extensible) suggested approach, that is, having something like this:</p>\n\n<pre><code>int write_question(FILE * fHdl, question * q, int items) {\n    return fwrite((void*)(q), sizeof(question), items, fHdl);\n}\n\nint write_questionList(FILE * fHdl, questionList * qList, int numOfQuestions) {\n    int nBytes = write_question(fHdl, qList-&gt;questions, numOfQuestions);\n    if (0 != nBytes) { \n        nBytes += fwrite((void*)(&amp;(qList-&gt;size)), sizeof(int), 1, fHdl);\n        nBytes += fwrite((void*)(&amp;(qList-&gt;max)), sizeof(int), 1, fHdl);\n    }\n    return nBytes;\n}\n</code></pre>\n\n<p>And the same for reading.</p>\n"}], "owner": {"reputation": 99, "user_id": 10799483, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d65e62e96aec2817239f1585a318d26d?s=128&d=identicon&r=PG&f=1", "display_name": "shadowfish", "link": "https://stackoverflow.com/users/10799483/shadowfish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 59393615, "answer_count": 2, "score": 3, "last_activity_date": 1576677504, "creation_date": 1576674180, "question_id": 59392704, "link": "https://stackoverflow.com/questions/59392704/how-to-write-and-read-a-struct-which-contains-another-struct-in-c", "title": "How to write and read a struct which contains another struct in C?", "body": "<p>Here is my structs:</p>\n\n<pre><code>typedef struct \n{\n    char* description;\n    char* alternativeAnswer[4];\n    int rightAnswer;\n}question;\n\ntypedef struct \n{\n    question** questions;\n    int size;\n    int max;\n}questionList;\n</code></pre>\n\n<p>I want to save a <code>questionList</code> to a file and then read from it.\nBut if I write in this way:</p>\n\n<pre><code>fwrite(a_questionList,sizeof(questionList),1,outfile);\n</code></pre>\n\n<p>and read in this way:</p>\n\n<pre><code>fread(newQuestionList,sizeof(questionList),1,infile);\n</code></pre>\n\n<p>I find that only <code>size</code> and <code>max</code> are saved and read successfully.So how to save and read <code>questions</code>?\nThank you!</p>\n"}, {"tags": ["c", "gcc", "casting", "strict-aliasing", "type-punning"], "comments": [{"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1576674383, "post_id": 59392655, "comment_id": 104974966, "body": "Isn&#39;t the padding in structs entirely up to the compiler? That means that different builds could fill <code>bytes</code> differently."}, {"owner": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "edited": false, "score": 1, "creation_date": 1576674407, "post_id": 59392655, "comment_id": 104974982, "body": "Why not just add all possible mutations of the data you require as different structs inside your union?"}, {"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 0, "creation_date": 1576674594, "post_id": 59392655, "comment_id": 104975081, "body": "I&#39;m not sure about the alignment of your <code>union spec_pkt</code>. Maybe in your case it is only byte-aligned, but in case someone reuses your code with a <code>struct</code> that needs a stricter alignment, you may get problems. Instead of reinterpreting a <code>uint8_t*</code>buffer pointer as a structure pointer, I suggest to define your buffer to be of this union type and pass the <code>bytes</code> field to the UART functions."}, {"owner": {"reputation": 71860, "user_id": 366377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863018588657c38d29f22e72dc81325e?s=128&d=identicon&r=PG", "display_name": "Jens Gustedt", "link": "https://stackoverflow.com/users/366377/jens-gustedt"}, "edited": false, "score": 0, "creation_date": 1576674816, "post_id": 59392655, "comment_id": 104975171, "body": "Converting from an <code>uint8_t*</code> to a <code>struct</code> or <code>union</code> is undefined. The simple reason is that some members may have stronger alignment. The other way around is possible, because then you are relaxing constraints."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1576677005, "post_id": 59392655, "comment_id": 104976306, "body": "What matters is how the actual data is stored for the first time, i.e what &quot;effective type&quot; it got. You need to show that part of the code or there&#39;s no telling if this is a strict aliasing violation."}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 2, "creation_date": 1576677487, "post_id": 59392655, "comment_id": 104976556, "body": "If you&#39;re worried about strict aliasing, you can always compile with <code>-fno-strict-aliasing</code>"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1576677780, "post_id": 59392655, "comment_id": 104976727, "body": "Since this is for an embedded system, then yes always compile with <code>-fno-strict-aliasing -ffreestanding</code>. gcc wasn&#39;t really designed with embedded systems in mind."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 71860, "user_id": 366377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863018588657c38d29f22e72dc81325e?s=128&d=identicon&r=PG", "display_name": "Jens Gustedt", "link": "https://stackoverflow.com/users/366377/jens-gustedt"}, "edited": false, "score": 1, "creation_date": 1576690789, "post_id": 59392655, "comment_id": 104984000, "body": "@JensGustedt: A lot of confusion stems from the fact that the Standard uses the same terminology for actions that should be expected to behave predictably under some circumstances but not all, based upon implementation-specific factors, as for those which shouldn&#39;t generally be expected to behave predictably under any circumstances.  For some reason, people seem to think the Standard uses the term &quot;Implementation-Defined&quot; for the former, but it doesn&#39;t; Implementation-Defined is reserved for actions which <i>all</i> implementations should <i>always</i> handle predictably."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1576867761, "post_id": 59392655, "comment_id": 105045915, "body": "@ikegami: The Standard was written after C had become popular.  Just about every C implementation that doesn&#39;t go out of its way to be weird will place each structure member at the first offset that follows earlier members and satisfy its alignment, unless something unusual about the target platform would make that impractical.  Such behavior would be sufficiently universal as to justify standardizing it, except that doing so would require a means of identifying which target platforms are sufficiently &quot;unusual&quot; as to justify different behavior, and implementations for normal platforms..."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1576867782, "post_id": 59392655, "comment_id": 105045920, "body": "...consistently behave in the stated fashion without regard for whether the Standard requires them to do so."}, {"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "reply_to_user": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1576868108, "post_id": 59392655, "comment_id": 105046012, "body": "@supercat, Re &quot;<i>Just about every C implementation that doesn&#39;t go out of its way to be weird will place each structure member at the first offset that follows earlier members and satisfy its alignment,</i>&quot;, That&#39;s not the case for gcc on an x86. x86 has no alignment restrictions, yet <code>struct {    char ch;    int i; }</code> includes padding on that system"}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1576946456, "post_id": 59392655, "comment_id": 105059991, "body": "@ikegami: The x86 can only perform single-operation loads and stores of data which does not cross alignment boundaries.  Although the processor includes logic to split other loads and stores into multiple operations, the underlying bus interface is limited to accesses that don&#39;t straddle alignment boundaries.  Further, while a 16-bit object could be placed at e.g. offset 9 within a 32-bit aligned structure without ever crossing a 32-bit boundary, alignment requirements are typically expressed as the smallest power of two for which <i>no</i> multiple will cross an alignment boundary."}, {"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "reply_to_user": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1576947119, "post_id": 59392655, "comment_id": 105060168, "body": "@supercat, I didn&#39;t say there was no reason for adding padding."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1576953175, "post_id": 59392655, "comment_id": 105061533, "body": "@ikegami: Perhaps I should have made clear that &quot;satisfies its alignment&quot; doesn&#39;t necessarily mean &quot;satisfies the minimum alignment necessary to avoid a trap&quot;, but &quot;satisfies the alignment specified by the implementation&quot;.  I don&#39;t think any implementations add padding without documenting that they do so, but some do provide options to control what alignment they assume for various types.  On a 68000-based system, for example, 32-bit objects must be 16-bit aligned but there can be accessed equally fast at any location satisfying that alignment; some other processors in that family..."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "edited": false, "score": 0, "creation_date": 1576953298, "post_id": 59392655, "comment_id": 105061560, "body": "...no longer require 16-bit alignment, but will perform slower when using 32-bit objects that aren&#39;t 32-bit aligned.  In any case, structure layouts where every object is aligned to a multiple of the smallest power of two less than its will be devoid of padding except on weird implementations."}], "answers": [{"comments": [{"owner": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "edited": false, "score": 0, "creation_date": 1576751699, "post_id": 59397213, "comment_id": 105003315, "body": "What is the conclusion then? Does the OP&#39;s code violate the rules, or not? Or are the rules so vague that this cannot be determined?"}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "edited": false, "score": 0, "creation_date": 1576768139, "post_id": 59397213, "comment_id": 105011853, "body": "@th33lf: The rules are meant to say when lvalues of different types must be <i>presumed</i> capable of aliasing despite the lack of direct evidence that they do so.  They make no effort to say when compilers should recognize <i>direct</i> evidence that two lvalues access the same storage, because they recognized that different compilers should use slightly different rules based upon their design and intended purpose.  For example, a compiler that does no optimizations wouldn&#39;t need to recognize any accesses as potentially affecting the same storage, one that only does intra-procedural..."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "edited": false, "score": 0, "creation_date": 1576768352, "post_id": 59397213, "comment_id": 105011972, "body": "...optimizations should be able to focus only on the current function, one that does intra-procedural optimizations should be able to recognize evidence that&#39;s split between the functions being optimized, etc.  Unfortunately, the authors of C89 deliberately tried to avoid any statements about how compilers <i>should</i> process non-portable code, and such avoidance has been interpreted as a judgment that compilers should make no effort to process non-portable code usefully despite the authors&#39; explicit statements to the contrary in the published Rationale."}, {"owner": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "edited": false, "score": 0, "creation_date": 1576835274, "post_id": 59397213, "comment_id": 105032483, "body": "In the OP&#39;s example, within the function <code>process()</code>, there are only two pointers involved, one of which is a struct and other is a char. The compiler has cannot assume, as per the standard, that they do not alias. So where is the scope for optimizations that do not account for aliasing breaking anything here? Also, is the rationale document available online? It is proving surprisingly difficult to find for C11!"}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "edited": false, "score": 0, "creation_date": 1576865533, "post_id": 59397213, "comment_id": 105045207, "body": "@th33lf: I haven&#39;t seen the Rationale document for C11, but N1570 6.5p6 and 6.5p7 are identical to the corresponding portions in C99, whose published Rationale is available.  The Standard does not recognize generally function boundaries, or even compilation-unit boundaries, as optimization barriers, so given something like <code>T1 *p1, T2 *p2;... f1(p1); f2(p2); f3(p1);</code> a compiler might reasonably assume that any load performed in <code>f3()</code> will retrieve the same value as in <code>f1</code>.  The problem is that gcc makes no effort to notice any actions between the calls that would derive <code>p1</code> and <code>p2</code> from..."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "edited": false, "score": 0, "creation_date": 1576865895, "post_id": 59397213, "comment_id": 105045329, "body": "...lvalues that might legitimately identify the same object, but wouldn&#39;t always do so, e.g. <code>f1(&amp;arrayOfUnions[i].m1); f2(&amp;arrayOfUnions[j].m2); f3(&amp;arrayOfUnions[i].m1);</code>  If code were to create a pointer to <code>arrayOfUnions[i].m1</code> before the call to <code>f2()</code>, any use of <i>that</i> pointer in <code>f3</code>, without re-derivation, would alias any use of the pointer to <code>arrayOfUnions[j].m2</code> to access the same storage, but if code re-derives the pointer a quality compiler should have no trouble recognizing that.  Unfortunately, neither clang nor gcc make any effort to do so."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "edited": false, "score": 0, "creation_date": 1576866840, "post_id": 59397213, "comment_id": 105045619, "body": "@th33lf: What&#39;s needed to make things work is to separate the data-dependency or sequencing implications of actions from the &quot;physical&quot; actions themselves.  A statement like <code>p1 = &amp;arrayOfUnions[i].m1;</code> should be recognized as not only loading <code>p1</code> with an address, but also creating a data dependency between anything that might be done with <code>arrayOfUnions[i]</code> before the call and anything done with <code>*p1</code> afterward.  If <code>&amp;arrayOfUnions[i].m1</code> is re-evaluated, a compiler might omit the repeated address calculation, but doing so would not entitle it to ignore the second data dependency."}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 1939, "user_id": 3214247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f1c6ec676d1a5661ff13305b99f23e3?s=128&d=identicon&r=PG&f=1", "display_name": "th33lf", "link": "https://stackoverflow.com/users/3214247/th33lf"}, "edited": false, "score": 0, "creation_date": 1576866978, "post_id": 59397213, "comment_id": 105045676, "body": "@th33lf: From what I can tell, clang and gcc both infer data dependencies from actions that generate code, which means that if a compiler decides that it can omit the repeated address calculation, it will no longer have any record of the required data dependency that had been implied by its computation."}], "tags": [], "owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "is_accepted": true, "score": 1, "last_activity_date": 1576689743, "creation_date": 1576689743, "answer_id": 59397213, "question_id": 59392655, "link": "https://stackoverflow.com/questions/59392655/strict-aliasing-and-casting-union-pointers/59397213#59397213", "title": "Strict aliasing and casting union pointers", "body": "<p>The Standard completely fails to specify the circumstances under which a structure or union object may be accessed via a non-character lvalue whose type is not that of the structure or union.  If one recognizes that the purpose of the Standard is to purely indicate when a compiler must recognize that an object is being accessed by a <em>seemingly-unrelated</em> lvalue, but is not meant to apply to situations where a compiler would be able to see that an lvalue or pointer of one type is used to derive another which is then used to access storage associated with the first, without any intervening conflicting action on that storage, this omission would make sense.  For example, given:</p>\n\n<pre><code>struct sizedPointer { int length,size; int *dat; };\nvoid storeThing(struct sizedPointer *dest, int n)\n{\n  if (dest-&gt;length &lt; dest-&gt;size)\n  {\n    dest-&gt;dat[dest-&gt;length] = n;\n    dest-&gt;length++;\n  }\n}\n</code></pre>\n\n<p>such an interpretation would allow a compiler to assume that <code>dest-&gt;length</code> will not be written using <code>dest-&gt;dat</code>, since its value has been observed after <code>dest-&gt;dat</code> was formed, but would require that a compiler recognize that given:</p>\n\n<pre><code>union blob { uint16_t hh[8]; uint64_t oo[2]; } myBblob;\n</code></pre>\n\n<p>an operation like</p>\n\n<pre><code>sscanf(someString, \"%4x\", &amp;myBlob.hh[1]);\n</code></pre>\n\n<p>might interact with any lvalues that are derived from <code>myBlob</code> after the function returns.</p>\n\n<p>Unfortunately, gcc and clang instead interpret the rule as only mandating recognition in cases where failure to do so would completely gut the language.  Because the Standard doesn't mandate that member-type lvalues be usable in any fashion whatsoever, and gcc and clang have explicitly stated that they should not be relied upon to do anything beyond what the Standard requires, support for anything useful should be viewed as being at the whim of the maintainers of clang and gcc.</p>\n"}], "owner": {"reputation": 2798, "user_id": 492747, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/6175ac3e7ef6faba1f1ac2a3decbec7b?s=128&d=identicon&r=PG", "display_name": "evading", "link": "https://stackoverflow.com/users/492747/evading"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 59397213, "answer_count": 1, "score": 0, "last_activity_date": 1576689743, "creation_date": 1576674002, "question_id": 59392655, "link": "https://stackoverflow.com/questions/59392655/strict-aliasing-and-casting-union-pointers", "title": "Strict aliasing and casting union pointers", "body": "<p>I have looked around this site to try to figure out if my use of casting to different unions is violating strict aliasing or otherwise UB.</p>\n\n<p>I have packets coming in on a serial line and I store/get them like:</p>\n\n<pre><code>union uart_data {\n  struct {\n    uint8_t start;\n    uint8_t addr;\n    uin16_t length;\n    uint8_t data[];\n  };\n  uint8_t bytes[BUFFER_SIZE];\n};\n\nvoid store_byte(uint8_t byte) {\n  uart_data-&gt;start = byte;\n  /* and so on with the other named fields. */\n}\n\nuint8_t * get_buffer() {\n  return uart_data-&gt;bytes;\n}\n</code></pre>\n\n<p>My understanding is that this is, at least with GCC and GNU extensions an valid way to do type punning.</p>\n\n<p>However, I then want to cast the return value from <code>get_buffer()</code> to a more specific type of packet that the uart doesn't need to know the details about.</p>\n\n<pre><code>union spec_pkt {\n  struct {\n    uint8_t start;\n    uint8_t addr;\n    uin16_t length;\n    uint8_t command;\n    uint8_t some_field;\n    uint16_t data_length;\n    uint8_t data[];\n  };\n  uint8_t bytes[BUFFER_SIZE];\n};\n\nvoid process(uint8_t *data) {\n  union specific_pkt *pkt = (union specific_pkt *)data;\n}\n</code></pre>\n\n<p>I recall having read somewhere that this is valid since I'm casting from a type that exists in the union but I can't find the source.</p>\n\n<p>My rationale for doing this it this way is that I can have a uart driver that only needs to know about the lowest level details. I'm on an MCU so I only have access to pre-allocated buffers to data and this way I don't have to <code>memcpy</code> between buffers, wasting space. And in my application code I can handle the packet in a nicer way than:</p>\n\n<pre><code>uint8_t data[BUFFER_SIZE];\n\ndata[START_POS];\ndata[LEN_POS];\ndata[DATA_POS];\n</code></pre>\n\n<p>If this is violating the SA rule or is UB I'd love some alternatives to achieve the same.</p>\n\n<p>I'm using GCC on a target that supports unaligned access and GCC allows type punning through unions.</p>\n"}, {"tags": ["c", "contiki"], "comments": [{"owner": {"reputation": 1311, "user_id": 10177569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ReqZ.jpg?s=128&g=1", "display_name": "yxor", "link": "https://stackoverflow.com/users/10177569/yxor"}, "edited": false, "score": 1, "creation_date": 1576673936, "post_id": 59392565, "comment_id": 104974734, "body": "Perhaps you did not seed the random function when calling it from a different header ? could you please provide the body of <code>random_rand</code>"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 3, "creation_date": 1576674017, "post_id": 59392565, "comment_id": 104974776, "body": "<code>currentTrafficType</code> is too small."}, {"owner": {"reputation": 159, "user_id": 10957632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DLEuW.jpg?s=128&g=1", "display_name": "SUBHANSHU SAHU", "link": "https://stackoverflow.com/users/10957632/subhanshu-sahu"}, "reply_to_user": {"reputation": 1311, "user_id": 10177569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ReqZ.jpg?s=128&g=1", "display_name": "yxor", "link": "https://stackoverflow.com/users/10177569/yxor"}, "edited": false, "score": 0, "creation_date": 1576674185, "post_id": 59392565, "comment_id": 104974861, "body": "@yxor random_rand is provided by contiki itself. Please refer to <a href=\"https://github.com/contiki-os/contiki/blob/master/core/lib/random.h\" rel=\"nofollow noreferrer\">github.com/contiki-os/contiki/blob/master/core/lib/random.h</a> and <a href=\"https://github.com/contiki-os/contiki/blob/master/core/lib/random.c\" rel=\"nofollow noreferrer\">github.com/contiki-os/contiki/blob/master/core/lib/random.c</a>"}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 1, "creation_date": 1576674214, "post_id": 59392565, "comment_id": 104974882, "body": "<code>currentTrafficType[6];</code> is too small; the buffer will not be nul-terminated (and: strncpy is almost allways wrong)"}, {"owner": {"reputation": 1311, "user_id": 10177569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ReqZ.jpg?s=128&g=1", "display_name": "yxor", "link": "https://stackoverflow.com/users/10177569/yxor"}, "edited": false, "score": 1, "creation_date": 1576674290, "post_id": 59392565, "comment_id": 104974916, "body": "did you use <code>void random_init(unsigned short seed)</code> in the file ?"}, {"owner": {"reputation": 159, "user_id": 10957632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DLEuW.jpg?s=128&g=1", "display_name": "SUBHANSHU SAHU", "link": "https://stackoverflow.com/users/10957632/subhanshu-sahu"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1576674292, "post_id": 59392565, "comment_id": 104974919, "body": "@wildplasser Can you please guide how to resolve this?"}, {"owner": {"reputation": 159, "user_id": 10957632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DLEuW.jpg?s=128&g=1", "display_name": "SUBHANSHU SAHU", "link": "https://stackoverflow.com/users/10957632/subhanshu-sahu"}, "reply_to_user": {"reputation": 1311, "user_id": 10177569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ReqZ.jpg?s=128&g=1", "display_name": "yxor", "link": "https://stackoverflow.com/users/10177569/yxor"}, "edited": false, "score": 0, "creation_date": 1576674339, "post_id": 59392565, "comment_id": 104974948, "body": "@yxor No I directly called the <code>random_rand()</code> function only"}, {"owner": {"reputation": 1311, "user_id": 10177569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ReqZ.jpg?s=128&g=1", "display_name": "yxor", "link": "https://stackoverflow.com/users/10177569/yxor"}, "edited": false, "score": 1, "creation_date": 1576674384, "post_id": 59392565, "comment_id": 104974968, "body": "that&#39;s your issue. @SUBHANSHUSAHU you cannot get a random number without seeding the generator first, try seeding it at the beginning of your program."}, {"owner": {"reputation": 159, "user_id": 10957632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DLEuW.jpg?s=128&g=1", "display_name": "SUBHANSHU SAHU", "link": "https://stackoverflow.com/users/10957632/subhanshu-sahu"}, "reply_to_user": {"reputation": 1311, "user_id": 10177569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ReqZ.jpg?s=128&g=1", "display_name": "yxor", "link": "https://stackoverflow.com/users/10177569/yxor"}, "edited": false, "score": 0, "creation_date": 1576674966, "post_id": 59392565, "comment_id": 104975246, "body": "@yxor I tried seeding as well but didn&#39;t get any success. Added <code>random_init(50);</code> as the first line of <code>newTrafficGenerator</code> method"}, {"owner": {"reputation": 1311, "user_id": 10177569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ReqZ.jpg?s=128&g=1", "display_name": "yxor", "link": "https://stackoverflow.com/users/10177569/yxor"}, "edited": false, "score": 0, "creation_date": 1576675106, "post_id": 59392565, "comment_id": 104975317, "body": "@SUBHANSHUSAHU, you&#39;re seeding the generator the same number before generating once, Of course you will get the same result. Please <code>#include &lt;time.h&gt;</code> then <code>random_init(time(NULL));</code> in the <code>generateInfiniteRandomNumber</code> function."}, {"owner": {"reputation": 301, "user_id": 4287117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec64f958fb4cc3f79c4b7677670d0811?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/4287117/siddharth"}, "edited": false, "score": 0, "creation_date": 1576675110, "post_id": 59392565, "comment_id": 104975321, "body": "How about trying to print the value of i?"}, {"owner": {"reputation": 159, "user_id": 10957632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DLEuW.jpg?s=128&g=1", "display_name": "SUBHANSHU SAHU", "link": "https://stackoverflow.com/users/10957632/subhanshu-sahu"}, "reply_to_user": {"reputation": 301, "user_id": 4287117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec64f958fb4cc3f79c4b7677670d0811?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/4287117/siddharth"}, "edited": false, "score": 0, "creation_date": 1576675782, "post_id": 59392565, "comment_id": 104975636, "body": "@Siddharth I have updated the results"}, {"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "reply_to_user": {"reputation": 1311, "user_id": 10177569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ReqZ.jpg?s=128&g=1", "display_name": "yxor", "link": "https://stackoverflow.com/users/10177569/yxor"}, "edited": false, "score": 2, "creation_date": 1576676091, "post_id": 59392565, "comment_id": 104975810, "body": "@yxor No, that\u2018s bad advice. <b>Do not</b> reseed the random number generator needlessly. Seed it <i>once</i>, before doing all the other work. In fact, with your advice you will be guaranteed to generate the same random number several times in a row, because of the limited precision of <code>time</code>."}, {"owner": {"reputation": 301, "user_id": 4287117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec64f958fb4cc3f79c4b7677670d0811?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/4287117/siddharth"}, "edited": false, "score": 0, "creation_date": 1576676112, "post_id": 59392565, "comment_id": 104975826, "body": "Try calling random_init() before calling the random_rand()"}, {"owner": {"reputation": 159, "user_id": 10957632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DLEuW.jpg?s=128&g=1", "display_name": "SUBHANSHU SAHU", "link": "https://stackoverflow.com/users/10957632/subhanshu-sahu"}, "reply_to_user": {"reputation": 301, "user_id": 4287117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec64f958fb4cc3f79c4b7677670d0811?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/4287117/siddharth"}, "edited": false, "score": 0, "creation_date": 1576676146, "post_id": 59392565, "comment_id": 104975835, "body": "@Siddharth tried that as well but didn&#39;t get any success"}, {"owner": {"reputation": 301, "user_id": 4287117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec64f958fb4cc3f79c4b7677670d0811?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/4287117/siddharth"}, "edited": false, "score": 0, "creation_date": 1576676601, "post_id": 59392565, "comment_id": 104976095, "body": "<a href=\"https://stackoverflow.com/questions/9711076/why-does-rand-always-return-the-same-value\" title=\"why does rand always return the same value\">stackoverflow.com/questions/9711076/&hellip;</a>"}, {"owner": {"reputation": 159, "user_id": 10957632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DLEuW.jpg?s=128&g=1", "display_name": "SUBHANSHU SAHU", "link": "https://stackoverflow.com/users/10957632/subhanshu-sahu"}, "reply_to_user": {"reputation": 301, "user_id": 4287117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec64f958fb4cc3f79c4b7677670d0811?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/4287117/siddharth"}, "edited": false, "score": 0, "creation_date": 1576676752, "post_id": 59392565, "comment_id": 104976170, "body": "@Siddharth As I stated in my post, this works as expected when <code>newTrafficGenerator</code> is in the same program file where it is called. The issue is occurring when I define it in a new header file and then call it."}, {"owner": {"reputation": 1311, "user_id": 10177569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ReqZ.jpg?s=128&g=1", "display_name": "yxor", "link": "https://stackoverflow.com/users/10177569/yxor"}, "reply_to_user": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 0, "creation_date": 1576677070, "post_id": 59392565, "comment_id": 104976337, "body": "@KonradRudolph That&#39;s what i meant. perhaps I wasn&#39;t very clear in my choice of words. thank you for clearing it."}, {"owner": {"reputation": 159, "user_id": 10957632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DLEuW.jpg?s=128&g=1", "display_name": "SUBHANSHU SAHU", "link": "https://stackoverflow.com/users/10957632/subhanshu-sahu"}, "reply_to_user": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 0, "creation_date": 1576677370, "post_id": 59392565, "comment_id": 104976494, "body": "@KonradRudolph Can you guide how to resolve this issue"}, {"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 0, "creation_date": 1576677451, "post_id": 59392565, "comment_id": 104976533, "body": "@SUBHANSHUSAHU Honestly, no. I can\u2019t add anything to the discussion that hasn\u2019t already been said. You need to edit your question to include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">complete, minimal reproducible example</a>. Currently it\u2019s unclear what the problem is."}, {"owner": {"reputation": 301, "user_id": 4287117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec64f958fb4cc3f79c4b7677670d0811?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/4287117/siddharth"}, "edited": false, "score": 0, "creation_date": 1576677509, "post_id": 59392565, "comment_id": 104976571, "body": "I tried to reproduce, always getting type C but getting different random number everytime... Please elaborate on reproduction..."}, {"owner": {"reputation": 301, "user_id": 4287117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec64f958fb4cc3f79c4b7677670d0811?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/4287117/siddharth"}, "edited": false, "score": 0, "creation_date": 1576677692, "post_id": 59392565, "comment_id": 104976686, "body": "Now I&#39;m getting expected (correct) output :P"}], "answers": [{"tags": [], "owner": {"reputation": 1599, "user_id": 9948091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JANyt.png?s=128&g=1", "display_name": "HAL9000", "link": "https://stackoverflow.com/users/9948091/hal9000"}, "is_accepted": false, "score": 1, "last_activity_date": 1576686340, "creation_date": 1576686340, "answer_id": 59396257, "question_id": 59392565, "link": "https://stackoverflow.com/questions/59392565/same-random-number-is-displayed-on-calling-the-function/59396257#59396257", "title": "Same random number is displayed on calling the function", "body": "<p>@wildplasser is right, you have undefined behavior in your program. All the discussion about seeding or no seeding is useless before you fix that issue. You need space for the null-terminator in <code>currentTrafficType</code>:</p>\n\n<pre><code>static char currentTrafficType[7];\n</code></pre>\n\n<p>Having the return value in a static local variable, is typically bad practice when it can be avoided. It makes your function non-reentrant, and thread-unsafe. In your case, the data you want to return, already exists as string literals, so you can drop the whole array:</p>\n\n<pre><code>/* return type modified from `char *` to `const char *` */\nconst char* newTrafficGenerator(void)\n{\n    int i;\n    int count =0;\n\n    /* Use pointer rather than array */\n    const char *currentTrafficType;\n\n    i = random_rand();\n    printf(\"Current random no is: %d\\n\",i);\n    if (i&gt;0 &amp;&amp; i&lt;32767)\n    {\n        currentTrafficType = \"Type A\";\n    }\n    else if(i&gt;32767 &amp;&amp; i&lt;55705)\n    {\n        currentTrafficType = \"Type B\";\n    }\n    else\n    {\n        currentTrafficType = \"Type C\";\n    }   \n    return currentTrafficType;\n}\n</code></pre>\n\n<p>String literals are guaranteed to exist for the whole duration of your program, so we can pass them around by pointer value, rather than doing slow and cumbersome array copying. Just be aware that string literals are read-only and therefore should only be assigned to <code>const char *</code> and not <code>char *</code>. </p>\n"}], "owner": {"reputation": 159, "user_id": 10957632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DLEuW.jpg?s=128&g=1", "display_name": "SUBHANSHU SAHU", "link": "https://stackoverflow.com/users/10957632/subhanshu-sahu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "closed_date": 1576687643, "answer_count": 1, "score": -1, "last_activity_date": 1576686340, "creation_date": 1576673737, "last_edit_date": 1576675970, "question_id": 59392565, "link": "https://stackoverflow.com/questions/59392565/same-random-number-is-displayed-on-calling-the-function", "closed_reason": "Not suitable for this site", "title": "Same random number is displayed on calling the function", "body": "<p>I have created a method that returns a string as per the value of generated random number. This work as expected when the function is in the same program file where it is called.</p>\n\n<p>But when I define this method in a new header file and then call it in a different file then it is returning same random number.</p>\n\n<p>Defined method:</p>\n\n<pre><code>char* newTrafficGenerator(void)\n{\n    int i;\n    int count =0;\n    static char currentTrafficType[6];\n    i = random_rand();\n    printf(\"Current random no is: %d\\n\",i);\n    if (i&gt;0 &amp;&amp; i&lt;32767)\n    {\n        strncpy(currentTrafficType,\"Type A\",sizeof(currentTrafficType));\n    }\n    else if(i&gt;32767 &amp;&amp; i&lt;55705)\n    {\n        strncpy(currentTrafficType,\"Type B\",sizeof(currentTrafficType));\n    }\n    else\n    {\n        strncpy(currentTrafficType,\"Type C\",sizeof(currentTrafficType));\n    }   \n    return currentTrafficType;\n}\n</code></pre>\n\n<p>Called by following code:</p>\n\n<pre><code>static void generateInfiniteRandomNumber(void)\n{\n    int count=0;\n    char *c;\n    while(count&lt;10)\n    {\n        c = newTrafficGenerator();\n        printf(\"Type is %s\\n\",c);\n        count++;\n    }\n}\n</code></pre>\n\n<p>The output when called in same file is:</p>\n\n<pre><code>Current random no is: 18547\nType is Type A\nCurrent random no is: 56401\nType is Type C\nCurrent random no is: 23807\nType is Type A\nCurrent random no is: 37962\nType is Type B\nCurrent random no is: 22764\nType is Type A\nCurrent random no is: 7977\nType is Type A\nCurrent random no is: 31949\nType is Type A\nCurrent random no is: 22714\nType is Type A\nCurrent random no is: 55211\nType is Type B\nCurrent random no is: 16882\nType is Type A\n</code></pre>\n\n<p>When defined in a new header file and then output upon calling is:</p>\n\n<pre><code>Current random no is: 1920540202\nType is Type C\nCurrent random no is: 1920540202\nType is Type C\nCurrent random no is: 1920540202\nType is Type C\nCurrent random no is: 1920540202\nType is Type C\nCurrent random no is: 1920540202\nType is Type C\nCurrent random no is: 1920540202\nType is Type C\nCurrent random no is: 1920540202\nType is Type C\nCurrent random no is: 1920540202\nType is Type C\nCurrent random no is: 1920540202\nType is Type C\nCurrent random no is: 1920540202\nType is Type C\n</code></pre>\n"}, {"tags": ["c", "gcc"], "comments": [{"owner": {"reputation": 34174, "user_id": 65464, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/d1fc3a85db4ff7618a7639742f356b3b?s=128&d=identicon&r=PG", "display_name": "Erich Kitzmueller", "link": "https://stackoverflow.com/users/65464/erich-kitzmueller"}, "edited": false, "score": 2, "creation_date": 1576674080, "post_id": 59392556, "comment_id": 104974813, "body": "Did you check the assembler output or is this just your assumption? I think the <code>POW</code> function is way more expensive than the division."}, {"owner": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "reply_to_user": {"reputation": 34174, "user_id": 65464, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/d1fc3a85db4ff7618a7639742f356b3b?s=128&d=identicon&r=PG", "display_name": "Erich Kitzmueller", "link": "https://stackoverflow.com/users/65464/erich-kitzmueller"}, "edited": false, "score": 0, "creation_date": 1576674283, "post_id": 59392556, "comment_id": 104974910, "body": "I checked it with perf record, in the assembly code the division takes the 50% and other are multiplications"}, {"owner": {"reputation": 20736, "user_id": 1115360, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uMQGl.png?s=128&g=1", "display_name": "Andrew Morton", "link": "https://stackoverflow.com/users/1115360/andrew-morton"}, "edited": false, "score": 0, "creation_date": 1576674420, "post_id": 59392556, "comment_id": 104974988, "body": "Could it be that <code>POW</code> with a negative exponent is more expensive than with a positive exponent?"}, {"owner": {"reputation": 8351, "user_id": 4279155, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/841b7391f3f7873bec1a8d9d8d2dc759?s=128&d=identicon&r=PG&f=1", "display_name": "Dominique", "link": "https://stackoverflow.com/users/4279155/dominique"}, "edited": false, "score": 1, "creation_date": 1576675559, "post_id": 59392556, "comment_id": 104975521, "body": "Just a question: you say that this division is eating your performance. Instead of trying to optimise the performance of the division itself, you might ask yourself the question why this division is happening that many times. Is it possible that you have a routine which performs this division repeatedly, while it could simply do it once and hold on to the results, instead of doing it over and over again?"}, {"owner": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "reply_to_user": {"reputation": 8351, "user_id": 4279155, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/841b7391f3f7873bec1a8d9d8d2dc759?s=128&d=identicon&r=PG&f=1", "display_name": "Dominique", "link": "https://stackoverflow.com/users/4279155/dominique"}, "edited": false, "score": 0, "creation_date": 1576676348, "post_id": 59392556, "comment_id": 104975946, "body": "@Dominique the operation is in a O(N^2) complexity, so yes."}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 1, "creation_date": 1576679007, "post_id": 59392556, "comment_id": 104977375, "body": "That doesn&#39;t look like ordinary C code.  What&#39;s <code>real</code>?  and <code>POW</code>?  and <code>distSqr</code>?  Question is meaningless without such context.  Give us a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> so we can confirm for ourselves!"}, {"owner": {"reputation": 34174, "user_id": 65464, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/d1fc3a85db4ff7618a7639742f356b3b?s=128&d=identicon&r=PG", "display_name": "Erich Kitzmueller", "link": "https://stackoverflow.com/users/65464/erich-kitzmueller"}, "edited": false, "score": 0, "creation_date": 1576679397, "post_id": 59392556, "comment_id": 104977617, "body": "Why don&#39;t you just write <code>-1.5</code> instead of <code>-3.0&#47;2.0</code> if the division hurts you so much?"}, {"owner": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "reply_to_user": {"reputation": 34174, "user_id": 65464, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/d1fc3a85db4ff7618a7639742f356b3b?s=128&d=identicon&r=PG", "display_name": "Erich Kitzmueller", "link": "https://stackoverflow.com/users/65464/erich-kitzmueller"}, "edited": false, "score": 0, "creation_date": 1576679884, "post_id": 59392556, "comment_id": 104977907, "body": "@ErichKitzmueller The change has no impact on performance"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1576680316, "post_id": 59392556, "comment_id": 104978150, "body": "<a href=\"https://godbolt.org/z/oKjATF\" rel=\"nofollow noreferrer\">Here</a> the compiler optimizes to a square root, a multiplication, and a division. It may be the compiler designers figure a square root and a division are faster than <code>pow</code>. If you get different code, show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> along with compiler version and the switches used to compile."}, {"owner": {"reputation": 34174, "user_id": 65464, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/d1fc3a85db4ff7618a7639742f356b3b?s=128&d=identicon&r=PG", "display_name": "Erich Kitzmueller", "link": "https://stackoverflow.com/users/65464/erich-kitzmueller"}, "edited": false, "score": 0, "creation_date": 1576690712, "post_id": 59392556, "comment_id": 104983971, "body": "@Chariot If the change has no impact on performance, it can only mean one thing: the division of the two literals never happened in the first place, it was optimized away as expected. The divisions you see in your perf record happen at another place, probably in the POW function."}], "answers": [{"tags": [], "owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "is_accepted": true, "score": 4, "last_activity_date": 1576688256, "last_edit_date": 1576688256, "creation_date": 1576680309, "answer_id": 59394443, "question_id": 59392556, "link": "https://stackoverflow.com/questions/59392556/why-the-compiler-does-this-division/59394443#59394443", "title": "Why the compiler does this division", "body": "<p>I'll have to make several assumptions here (that the variables are all type <code>double</code>, and that <code>POW</code> is a macro that expands to <code>pow</code>):</p>\n\n<pre><code>#include &lt;math.h&gt;\n\ndouble f0(double a, double b) {\n    return a / pow(b, 1.5);\n}\n\ndouble f1(double a, double b) {\n    return a * pow(b, -1.5);\n}\n</code></pre>\n\n<p>This gives me (on x86):</p>\n\n<pre class=\"lang-asm-x86 prettyprint-override\"><code>f0:\n    .cfi_startproc\n    movapd  %xmm1, %xmm2\n    sqrtsd  %xmm2, %xmm2\n    mulsd   %xmm1, %xmm2\n    divsd   %xmm2, %xmm0\n    ret\n    .cfi_endproc\nf1:\n    .cfi_startproc\n    movapd  %xmm1, %xmm2\n    sqrtsd  %xmm2, %xmm2\n    mulsd   %xmm1, %xmm2\n    divsd   %xmm2, %xmm0\n    ret\n    .cfi_endproc\n</code></pre>\n\n<p>Transforming <code>pow(x, 1.5)</code> into <code>x * \u221ax</code> is a reasonable optimisation, and the consequent division is still much faster than calling the expensive <code>pow()</code> function.  In other words, the compiler has quite reasonably chosen to represent <code>pow(x, -1.5)</code> as  <code>1/(x*\u221ax)</code> when using <code>-Ofast</code>.</p>\n"}], "owner": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 59394443, "answer_count": 1, "score": -4, "last_activity_date": 1586847816, "creation_date": 1576673702, "last_edit_date": 1576673902, "question_id": 59392556, "link": "https://stackoverflow.com/questions/59392556/why-the-compiler-does-this-division", "title": "Why the compiler does this division", "body": "<p>I'm trying to optimize nbody algorithm and this operation is expensive </p>\n\n<pre><code>real s = jMass / POW(distSqr,3.0/2.0);\n</code></pre>\n\n<p>so I tried to convert in:</p>\n\n<pre><code>s = jMass * POW(distSqr, -3.0/2.0);\n</code></pre>\n\n<p>but the compiler gcc with -Ofast option does the division anyway, why?</p>\n"}, {"tags": ["c", "gcc", "assembly", "x86", "strcmp"], "comments": [{"owner": {"reputation": 26552, "user_id": 448932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QgLLl.png?s=128&g=1", "display_name": "500 - Internal Server Error", "link": "https://stackoverflow.com/users/448932/500-internal-server-error"}, "reply_to_user": {"reputation": 13124, "user_id": 1419272, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dcbff46aa5cd0a98d13d76595b3375f0?s=128&d=identicon&r=PG", "display_name": "alinsoar", "link": "https://stackoverflow.com/users/1419272/alinsoar"}, "edited": false, "score": 2, "creation_date": 1576670431, "post_id": 59391415, "comment_id": 104972946, "body": "@alinsoar: That&#39;s not what&#39;s happening here, though. This is a regular in-lined string comparison. To the OP: the 10 moved to <code>ecx</code> is the repeat count for the string compare."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 2, "creation_date": 1576670572, "post_id": 59391415, "comment_id": 104973011, "body": "<code>repz cmps</code> is what compares the strings.  Look it up in the Intel manuals!"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1576671598, "post_id": 59391415, "comment_id": 104973550, "body": "If you compile with a recent <a href=\"http://gcc.gnu.org/\" rel=\"nofollow noreferrer\">GCC</a> you should try <code>gcc -O2 -S -Wall -fverbose-asm src.c</code> then look inside the generated assembler code <code>src.s</code>"}], "answers": [{"comments": [{"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1576676483, "post_id": 59391674, "comment_id": 104976039, "body": "Fun fact: <code>repe cmpsb</code> is not fast, and this strcmp strategy isn&#39;t great.  <a href=\"//stackoverflow.com/q/49375094\">Coaxing GCC to emit REPE CMPSB</a>.  And gcc used to even inline strlen as <code>repne scasb</code> at -O1, leading to a huge performance downside for code that used it on very long strings: <a href=\"//stackoverflow.com/q/55563598\">Why is this code 6.5x slower with optimizations enabled?</a>"}, {"owner": {"reputation": 6595, "user_id": 5218277, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZuEZa.jpg?s=128&g=1", "display_name": "Alex Lop.", "link": "https://stackoverflow.com/users/5218277/alex-lop"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1576676853, "post_id": 59391674, "comment_id": 104976224, "body": "@PeterCordes right... comparing memory byte by byte on 32bit or 64bit systems is  not efficient at all however it might be good enough for 10 bytes strings like in this case."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1576676913, "post_id": 59391674, "comment_id": 104976257, "body": "There are better ways, e.g. 3x <code>cmp</code>-immediate/<code>jne</code> to compare in 4-byte chunks.  (But that has more total branching).  Or two unaligned <code>movq xmm0, [eax]</code> loads that line up with the start and end of the buffer, respectively.  Or maybe movq/movhps to do two overlapping 8-byte loads into one register, for <code>pcmpeqb</code> against a 16-byte constant."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1576677219, "post_id": 59391674, "comment_id": 104976409, "body": "SSE4.2 <code>pcmpistri</code> is useful if you know you can overread the source without risk of crossing into an unmapped page and faulting.  But in that case you might as well just use <code>pcmpeqb</code> / <code>pmovmskb</code> and AND away the bits you don&#39;t care about.  e.g. <code>and eax, (1&lt;&lt;10) - 1</code> / <code>cmp eax, (1&lt;&lt;10) - 1</code>"}, {"owner": {"reputation": 6595, "user_id": 5218277, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZuEZa.jpg?s=128&g=1", "display_name": "Alex Lop.", "link": "https://stackoverflow.com/users/5218277/alex-lop"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1576677466, "post_id": 59391674, "comment_id": 104976544, "body": "@PeterCordes definitely. However it requires the target CPU to support SSE4.2, I don&#39;t know with what <code>cpu</code> flags it was compiled... on the other hand even it were compiled with such flags, I doubt GCC would produce anything similar to what you suggested."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1576678058, "post_id": 59391674, "comment_id": 104976880, "body": "Like I said, if you could use <code>pcmpistri</code> safely, it would still be better <i>not</i> to.  SSE2 <code>pcmpeqb</code> plus masking away the high bits of the <code>pmovmskb</code> result would be faster.  On Skylake <code>pcmpistri</code> has 10 cycle latency and costs 3 uops vs. 1 uop / 1c for <code>pcmpeqb</code>.  And you&#39;re right, gcc doesn&#39;t know this strategy for inlining <code>strcmp</code>.  That&#39;s my point: it <i>should</i> use a better strategy like it does for <code>memcmp</code> against a constant.  But it&#39;s hard unless you check for the pointer being near the end of a page.  e.g. a pointer to a <code>&#39;\\0&#39;</code> as the last byte of a page is safe for <code>repe cmpsb</code>."}], "tags": [], "owner": {"reputation": 6595, "user_id": 5218277, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZuEZa.jpg?s=128&g=1", "display_name": "Alex Lop.", "link": "https://stackoverflow.com/users/5218277/alex-lop"}, "is_accepted": true, "score": 5, "last_activity_date": 1576675966, "last_edit_date": 1576675966, "creation_date": 1576670694, "answer_id": 59391674, "question_id": 59391415, "link": "https://stackoverflow.com/questions/59391415/compiler-optimization-of-strcmp-i-dont-understand-against-a-constant-string/59391674#59391674", "title": "Compiler optimization of strcmp I don&#39;t understand, against a constant string", "body": "<p>The compiler inlined <code>strcmp</code> against a known-length string using <a href=\"https://www.felixcloutier.com/x86/rep:repe:repz:repne:repnz\" rel=\"nofollow noreferrer\"><code>repe cmpsb</code></a> which implements memcmp.</p>\n\n<p>It loads into register <code>esi</code> the address of the constant literal string \"LETMEWIN\\n\". Note that the length of this string is 10 (with the '\\0' at the end).\nThen it loads the address of <code>buf</code> into <code>edi</code> register, then it calls for the x86 instruction:</p>\n\n<pre><code>repz cmps BYTE PTR ds:[esi],BYTE PTR es:[edi]\n</code></pre>\n\n<p><a href=\"https://docs.oracle.com/cd/E19620-01/805-4693/instructionset-64/index.html\" rel=\"nofollow noreferrer\"><code>repz</code></a> repeats the following instruction as long as zero flag is set and up to the number of times stored in <code>ecx</code> (this explains you the <code>mov    ecx,0xa ; what is this?</code>).</p>\n\n<p>The repeated instruction is <a href=\"https://docs.oracle.com/cd/E19620-01/805-4693/instructionset-59/index.html\" rel=\"nofollow noreferrer\"><code>cmps</code></a> which compares strings (byte by byte) and automatically increases the pointers by 1 on each iteration.\nWhen the compared bytes are equal, it sets the zero flag.</p>\n\n<p>So per your questions:</p>\n\n<blockquote>\n  <p>Where is the strcmp call? And why is it like that?</p>\n</blockquote>\n\n<p>No explicit call for <code>strcmp</code>, it is optimized out and replaced with inlined code:</p>\n\n<pre><code> 80484fc:   ba 46 86 04 08          mov    edx,0x8048646 ; \"LETMEWIN\\n\" address\n 8048501:   b8 60 a0 04 08          mov    eax,0x804a060 ; buf address\n 8048506:   b9 0a 00 00 00          mov    ecx,0xa ; number of bytes to compare\n 804850b:   89 d6                   mov    esi,edx\n 804850d:   89 c7                   mov    edi,eax\n 804850f:   f3 a6                   repz cmps BYTE PTR ds:[esi],BYTE PTR es:[edi] ;\n</code></pre>\n\n<p>Actually it misses the part where it should check if the returned value of <code>strcmp</code> is zero or not. I think you just didn't copy it here. There probably should be something like <code>je ...</code> / <code>jz ...</code> / <code>jne ...</code> / <code>jnz ...</code> right after the <code>repz ...</code> line.</p>\n\n<blockquote>\n  <p>What does this 8048506:    b9 0a 00 00 00 mov ecx,0xa do?</p>\n</blockquote>\n\n<p>It sets the maximum number of bytes to compare.</p>\n"}], "owner": {"reputation": 23, "user_id": 12558356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0283851c3d462b89cab94f4b4ddc4164?s=128&d=identicon&r=PG&f=1", "display_name": "user12558356", "link": "https://stackoverflow.com/users/12558356/user12558356"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 283, "favorite_count": 0, "accepted_answer_id": 59391674, "answer_count": 1, "score": 1, "last_activity_date": 1576772507, "creation_date": 1576669827, "last_edit_date": 1576772507, "question_id": 59391415, "link": "https://stackoverflow.com/questions/59391415/compiler-optimization-of-strcmp-i-dont-understand-against-a-constant-string", "title": "Compiler optimization of strcmp I don&#39;t understand, against a constant string", "body": "<p>In order to improve my binary exploitation skills, and deepen my understanding in low level environments I tried solving challenges in <code>pwnable.kr</code>, The first challenge- called <code>fd</code> has the following C code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\nchar buf[32];\nint main(int argc, char* argv[], char* envp[]){\n        if(argc&lt;2){\n                printf(\"pass argv[1] a number\\n\");\n                return 0;\n        }\n        int fd = atoi( argv[1] ) - 0x1234;\n        int len = 0;\n        len = read(fd, buf, 32);\n        if(!strcmp(\"LETMEWIN\\n\", buf)){\n                printf(\"good job :)\\n\");\n                system(\"/bin/cat flag\");\n                exit(0);\n        }\n        printf(\"learn about Linux file IO\\n\");\n        return 0;\n\n}\n</code></pre>\n\n<p>I used <code>objdump -S -g ./fd</code> in order to disassemble it, and I got confused, because insteaad of calling a strcmp function. It just compared the strings without calling it. \nThis is the assembly code im talking about:</p>\n\n<pre><code> 80484c6:   e8 05 ff ff ff          call   80483d0 &lt;atoi@plt&gt; \n 80484cb:   2d 34 12 00 00          sub    eax,0x1234 \n ; eax = atoi( argv[1] ) - 0x1234;\n ; initialize fd=eax\n 80484d0:   89 44 24 18             mov    DWORD PTR [esp+0x18],eax\n ; initialize len\n 80484d4:   c7 44 24 1c 00 00 00    mov    DWORD PTR [esp+0x1c],0x0\n\n ; Set up read variables\n 80484db:   00 \n 80484dc:   c7 44 24 08 20 00 00    mov    DWORD PTR [esp+0x8],0x20 ; read 32 bytes\n 80484e3:   00 \n 80484e4:   c7 44 24 04 60 a0 04    mov    DWORD PTR [esp+0x4],0x804a060 ; buf variable address\n 80484eb:   08 \n 80484ec:   8b 44 24 18             mov    eax,DWORD PTR [esp+0x18]\n 80484f0:   89 04 24                mov    DWORD PTR [esp],eax ; fd variable\n 80484f3:   e8 78 fe ff ff          call   8048370 &lt;read@plt&gt; \n\n 80484f8:   89 44 24 1c             mov    DWORD PTR [esp+0x1c],eax\n 80484fc:   ba 46 86 04 08          mov    edx,0x8048646 ; \"LETMEWIN\\n\" address\n 8048501:   b8 60 a0 04 08          mov    eax,0x804a060 ; buf address\n 8048506:   b9 0a 00 00 00          mov    ecx,0xa ; what is this?\n ; strcmp starts here?\n 804850b:   89 d6                   mov    esi,edx\n 804850d:   89 c7                   mov    edi,eax\n 804850f:   f3 a6                   repz cmps BYTE PTR ds:[esi],BYTE PTR es:[edi] ; &lt;------- ?STRCMP?\n</code></pre>\n\n<p>The things I don't understand are:</p>\n\n<ol>\n<li>Where is the <code>strcmp</code> call? And why is it like that? </li>\n<li>What does this <code>8048506:    b9 0a 00 00 00 mov ecx,0xa</code> do? </li>\n</ol>\n"}, {"tags": ["c"], "answers": [{"tags": [], "owner": {"reputation": 27546, "user_id": 6266, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/398efb709eb606ef79ee6436f55f93bd?s=128&d=identicon&r=PG", "display_name": "Fire Lancer", "link": "https://stackoverflow.com/users/6266/fire-lancer"}, "is_accepted": false, "score": 1, "last_activity_date": 1576670049, "creation_date": 1576670049, "answer_id": 59391481, "question_id": 59391321, "link": "https://stackoverflow.com/questions/59391321/c-programming-variable-read-write-restriction/59391481#59391481", "title": "c programming variable read/write restriction", "body": "<p>C doesn't have a way to make a variable only writable from certain places, but <code>static</code> is limited to that source file. So instead what you might do is have a \"getter\" function only, to keep the variable \"hidden\" in just the desired file.</p>\n\n<pre><code>// Header\nint get_a();\n\n\n// Source file1\nstatic int a;\nint get_a()\n{\n    return a;\n}\n\nvoid foo()\n{\n    a = 42; //OK\n}\n\n// Source file2\nvoid bar()\n{\n    int x = get_a(); // OK, function in header\n    a = x + 1; // Error, a was never declared in the header\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 12558263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f1c5be8407400674702e6a4385e75c6?s=128&d=identicon&r=PG&f=1", "display_name": "chiranth", "link": "https://stackoverflow.com/users/12558263/chiranth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31, "favorite_count": 0, "closed_date": 1576673933, "answer_count": 1, "score": 0, "last_activity_date": 1576670442, "creation_date": 1576669507, "last_edit_date": 1576670442, "question_id": 59391321, "link": "https://stackoverflow.com/questions/59391321/c-programming-variable-read-write-restriction", "closed_reason": "Needs details or clarity", "title": "c programming variable read/write restriction", "body": "<p>In file1 I have defined a variable <code>int a = 5</code> and this can be modified in the file, I want to access the value of the variable a in file2, but I should not be able to modify the value here ex <code>a = 10</code> should not work. </p>\n"}, {"tags": ["c++", "c", "linux"], "comments": [{"owner": {"reputation": 301, "user_id": 4287117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec64f958fb4cc3f79c4b7677670d0811?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/4287117/siddharth"}, "edited": false, "score": 1, "creation_date": 1576670205, "post_id": 59391062, "comment_id": 104972837, "body": "Yes, no is an abbreviation for the number. It is a common practice to use no for number and nos for numbers."}], "answers": [{"comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 4, "creation_date": 1576668664, "post_id": 59391063, "comment_id": 104972077, "body": "This is also relevant:  <a href=\"https://english.stackexchange.com/questions/459968/why-does-no-mean-number\" title=\"why does no mean number\">english.stackexchange.com/questions/459968/&hellip;</a>"}], "tags": [], "owner": {"reputation": 595, "user_id": 1217854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b1c0a58acc4682a6ef9c0331ee265f?s=128&d=identicon&r=PG", "display_name": "Patapoom", "link": "https://stackoverflow.com/users/1217854/patapoom"}, "is_accepted": false, "score": 8, "last_activity_date": 1576668482, "creation_date": 1576668482, "answer_id": 59391063, "question_id": 59391062, "link": "https://stackoverflow.com/questions/59391062/fileno-errno-what-does-the-no-mean-non-native-english/59391063#59391063", "title": "fileno, errno: What does the &quot;no&quot; mean? (Non native English)", "body": "<p>In the <a href=\"http://man7.org/linux/man-pages/man3/fileno.3.html\" rel=\"noreferrer\">man documentation of <code>fileno()</code></a> this is not explicit but this is written:</p>\n\n<blockquote>\n  <p>The function <code>fileno()</code> examines the argument stream and returns its integer descriptor.</p>\n</blockquote>\n\n<p>So with this explanation we should say that \"<em>no</em>\" means <em>file descriptor</em>.</p>\n\n<p>But in the <a href=\"http://man7.org/linux/man-pages/man3/errno.3.html\" rel=\"noreferrer\">man description of <code>errno</code></a> there is an explicit description:</p>\n\n<blockquote>\n  <p><code>errno</code> - number of last error</p>\n</blockquote>\n\n<p>So we can deduce that \"<em>no</em>\" really means \"<em>number</em>\".</p>\n\n<p>Anyway Wikipedia comes to explicit the explanation of the <a href=\"https://en.wikipedia.org/wiki/Numero_sign\" rel=\"noreferrer\">Numero sign</a>:</p>\n\n<blockquote>\n  <p>The numero sign or numero symbol, \u2116 (also represented as N\u00ba, <strong>No</strong>, No./no. (US English),<a href=\"http://man7.org/linux/man-pages/man3/fileno.3.html\" rel=\"noreferrer\">1</a> or <strong>No/no</strong> (UK English); plural Nos./nos. (US English) or Nos/nos (UK English)<a href=\"http://man7.org/linux/man-pages/man3/errno.3.html\" rel=\"noreferrer\">2</a>), is a typographic abbreviation of the word number(s) indicating ordinal numeration, especially in names and titles.</p>\n</blockquote>\n\n<p>And if you still had some doubts, there is also the <a href=\"https://en.wikipedia.org/wiki/Errno.h\" rel=\"noreferrer\">Wikipedia page for errno.h</a> that says:</p>\n\n<blockquote>\n  <p>It defines macros for reporting and retrieving error conditions using the symbol <strong>errno (short for \"error number\"</strong>).</p>\n</blockquote>\n"}], "owner": {"reputation": 595, "user_id": 1217854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b1c0a58acc4682a6ef9c0331ee265f?s=128&d=identicon&r=PG", "display_name": "Patapoom", "link": "https://stackoverflow.com/users/1217854/patapoom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1586250419, "creation_date": 1576668482, "last_edit_date": 1586250419, "question_id": 59391062, "link": "https://stackoverflow.com/questions/59391062/fileno-errno-what-does-the-no-mean-non-native-english", "title": "fileno, errno: What does the &quot;no&quot; mean? (Non native English)", "body": "<p>I'm a <strong>non native English</strong> so there are idiomatic terms I don't understand.</p>\n\n<p>What does the \"<em>no</em>\" really means in the function <code>fileno()</code> or the header<code>errno.h</code> ?</p>\n\n<p>Does the \"<em>no</em>\" an abbreviation of \"<em>number</em>\"?</p>\n\n<p>If yes why?</p>\n"}, {"tags": ["c++", "c", "sqlite"], "comments": [{"owner": {"reputation": 1628, "user_id": 4000694, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6dFJ5.jpg?s=128&g=1", "display_name": "HappyCactus", "link": "https://stackoverflow.com/users/4000694/happycactus"}, "edited": false, "score": 0, "creation_date": 1576668782, "post_id": 59391052, "comment_id": 104972147, "body": "<code>sqlite&gt;.header on</code> is not a valid shell command. and since each system will start the <code>sqlite3</code> in a new shell, it will not work this way. You should not mix <code>sqlite3</code> user program commands with C apis, because it will not work. You should receive the results and format them using <code>printf()</code> or whatever you want."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 11972476, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Birp8rUBDK4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reTvulrWgaJn5_mMGug1vOyadPy1w/photo.jpg?sz=128", "display_name": "Ixa", "link": "https://stackoverflow.com/users/11972476/ixa"}, "edited": false, "score": 0, "creation_date": 1576670832, "post_id": 59391299, "comment_id": 104973143, "body": "Hello,   this gives me this result:  <a href=\"https://i.imgur.com/2pS5niN.png\" rel=\"nofollow noreferrer\">i.imgur.com/2pS5niN.png</a>  and not the table format i&#39;d wish to get, did I do something wrong?  wanted result : <a href=\"https://i.imgur.com/IXvVPEu.png\" rel=\"nofollow noreferrer\">i.imgur.com/IXvVPEu.png</a>"}], "tags": [], "owner": {"reputation": 1628, "user_id": 4000694, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6dFJ5.jpg?s=128&g=1", "display_name": "HappyCactus", "link": "https://stackoverflow.com/users/4000694/happycactus"}, "is_accepted": false, "score": 1, "last_activity_date": 1576669424, "creation_date": 1576669424, "answer_id": 59391299, "question_id": 59391052, "link": "https://stackoverflow.com/questions/59391052/formatting-sqlite3-exec-result/59391299#59391299", "title": "formatting sqlite3_exec result", "body": "<p>You can't control the formatting from the <code>sqlite3</code> user program, so using <code>system()</code> to call it will not control the C API.</p>\n\n<p>You should do this using the <code>callback</code> function. From the same <a href=\"https://www.tutorialspoint.com/sqlite/sqlite_c_cpp.htm\" rel=\"nofollow noreferrer\">tutorialpoint site</a>:</p>\n\n<pre><code>static int callback(void *data, int argc, char **argv, char **azColName){\n   int i;\n   fprintf(stderr, \"%s: \", (const char*)data);\n\n   for(i = 0; i&lt;argc; i++){\n      printf(\"%s = %s\\n\", azColName[i], argv[i] ? argv[i] : \"NULL\");\n   }\n\n   printf(\"\\n\");\n   return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 11972476, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Birp8rUBDK4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reTvulrWgaJn5_mMGug1vOyadPy1w/photo.jpg?sz=128", "display_name": "Ixa", "link": "https://stackoverflow.com/users/11972476/ixa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 22, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1576669424, "creation_date": 1576668435, "question_id": 59391052, "link": "https://stackoverflow.com/questions/59391052/formatting-sqlite3-exec-result", "title": "formatting sqlite3_exec result", "body": "<p>Hello how would I go about formatting the result of</p>\n\n<pre><code>   sql = \"SELECT * from COMPANY ORDER BY ID\";\n\n   rc = sqlite3_exec(db, sql, callback, (void*)data, &amp;zErrMsg);\n</code></pre>\n\n<p>I read there are console commands for it on here <a href=\"https://www.tutorialspoint.com/sqlite/sqlite_commands.htm\" rel=\"nofollow noreferrer\">https://www.tutorialspoint.com/sqlite/sqlite_commands.htm</a></p>\n\n<p>so I tried</p>\n\n<pre><code>   std::string c3 = \"sqlite&gt;.header on\";\n   std::string c1 = \"sqlite&gt;.mode column\";\n\n   cout &lt;&lt; system(c3.c_str()) &lt;&lt; endl;\n   cout &lt;&lt; system(c1.c_str()) &lt;&lt; endl;\n</code></pre>\n\n<p>but that didn't work to get a table format like result</p>\n\n<p>How would I do this? I've been googling for 3 hours and still didn't get anywhere</p>\n"}, {"tags": ["c", "multithreading", "file-read"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1576668510, "post_id": 59391042, "comment_id": 104971997, "body": "How would you calculate the total number of lines without reading the entire file?"}, {"owner": {"reputation": 1, "user_id": 9517849, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Salman Bajwa", "link": "https://stackoverflow.com/users/9517849/salman-bajwa"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1576668722, "post_id": 59391042, "comment_id": 104972111, "body": "For Example I m using 4 threads and i want to find a string from a file I want that Each thread run parallel any of the thread find the string the program will stop Basically I want to achieve this.."}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 3, "creation_date": 1576668725, "post_id": 59391042, "comment_id": 104972117, "body": "You need to clarify what &quot;read a whole file&quot; means. Line by line ? As text?, as fixed length records? As parsed JSON or XML ? Further, just fyi, If the file is contiguous, multi-threaded reading is pointless unless it&#39;s on solid-state hardware (and even there, it&#39;s questionable). On spindles the seek flapping alone will <i>reduce</i>, not increase, performance; you&#39;re better off in that scenario simply sequentially scanning the file, or mapping it directly into process space."}, {"owner": {"reputation": 45685, "user_id": 69809, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/yCVF0.jpg?s=128&g=1", "display_name": "Groo", "link": "https://stackoverflow.com/users/69809/groo"}, "edited": false, "score": 1, "creation_date": 1576669677, "post_id": 59391042, "comment_id": 104972609, "body": "The only thing that would make sense, if there is substantial processing you need to do for your lines, is to read the file sequentially and push lines into a queue which will be consumed by multiple threads (ideally a pool of threads with the count equal to the number of cores in your system). I.e. single producer-multiple consumer scenario. Actually creating 4 different pointers and going over the file doesn&#39;t seem like something that would help with performance."}], "owner": {"reputation": 1, "user_id": 9517849, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Salman Bajwa", "link": "https://stackoverflow.com/users/9517849/salman-bajwa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 24, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576668403, "creation_date": 1576668403, "question_id": 59391042, "link": "https://stackoverflow.com/questions/59391042/reading-file-using-threads", "title": "Reading FIle Using Threads", "body": "<p>How we can read a whole file using multiple threads if the total number of lines are not given ?</p>\n\n<p>Maybe first we calculate total numbers of lines but I don't think its a good approach. </p>\n\n<p>Can Someone Help ?</p>\n"}, {"tags": ["c", "linked-list", "doubly-linked-list"], "comments": [{"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 0, "creation_date": 1576667862, "post_id": 59390868, "comment_id": 104971718, "body": "This is a standard case where using a debugger you can find the error easily..."}, {"owner": {"reputation": 3, "user_id": 7221489, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b06de1669e2aefbe886dcad2226e0cdd?s=128&d=identicon&r=PG&f=1", "display_name": "Edwin Ansari", "link": "https://stackoverflow.com/users/7221489/edwin-ansari"}, "reply_to_user": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 0, "creation_date": 1576668157, "post_id": 59390868, "comment_id": 104971854, "body": "I just print <code>hd-&gt;last</code> every time and it is <code>0</code>  so <code>ld_last</code> should be always the first element in memory! I don&#39;t understand why it changes after the first insertion. If I use debugger I can just know this kind of things."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1576668585, "post_id": 59390868, "comment_id": 104972035, "body": "There is not enough information to reproduce the problem. Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 3, "user_id": 7221489, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b06de1669e2aefbe886dcad2226e0cdd?s=128&d=identicon&r=PG&f=1", "display_name": "Edwin Ansari", "link": "https://stackoverflow.com/users/7221489/edwin-ansari"}, "edited": false, "score": 0, "creation_date": 1576669551, "post_id": 59390868, "comment_id": 104972541, "body": "I edited my code now you have really all the things that is needed!"}, {"owner": {"reputation": 81, "user_id": 1980197, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/mFJRg.jpg?s=128&g=1", "display_name": "teowey", "link": "https://stackoverflow.com/users/1980197/teowey"}, "edited": false, "score": 0, "creation_date": 1576672169, "post_id": 59390868, "comment_id": 104973805, "body": "Can you post the whole main function so the code is reproducible?"}, {"owner": {"reputation": 3, "user_id": 7221489, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b06de1669e2aefbe886dcad2226e0cdd?s=128&d=identicon&r=PG&f=1", "display_name": "Edwin Ansari", "link": "https://stackoverflow.com/users/7221489/edwin-ansari"}, "reply_to_user": {"reputation": 81, "user_id": 1980197, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/mFJRg.jpg?s=128&g=1", "display_name": "teowey", "link": "https://stackoverflow.com/users/1980197/teowey"}, "edited": false, "score": 0, "creation_date": 1576676286, "post_id": 59390868, "comment_id": 104975907, "body": "@teowey ok now i have edited the code so you can compile and run it."}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 1, "creation_date": 1576677696, "post_id": 59390868, "comment_id": 104976687, "body": "Read <a href=\"https://ericlippert.com/2014/03/05/how-to-debug-small-programs/\" rel=\"nofollow noreferrer\"><i>How to debug small programs</i></a>"}, {"owner": {"reputation": 81, "user_id": 1980197, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/mFJRg.jpg?s=128&g=1", "display_name": "teowey", "link": "https://stackoverflow.com/users/1980197/teowey"}, "edited": false, "score": 0, "creation_date": 1576683337, "post_id": 59390868, "comment_id": 104979960, "body": "@EdwinAnsari Please paste the headers you use."}, {"owner": {"reputation": 3, "user_id": 7221489, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b06de1669e2aefbe886dcad2226e0cdd?s=128&d=identicon&r=PG&f=1", "display_name": "Edwin Ansari", "link": "https://stackoverflow.com/users/7221489/edwin-ansari"}, "reply_to_user": {"reputation": 81, "user_id": 1980197, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/mFJRg.jpg?s=128&g=1", "display_name": "teowey", "link": "https://stackoverflow.com/users/1980197/teowey"}, "edited": false, "score": 0, "creation_date": 1576700857, "post_id": 59390868, "comment_id": 104988209, "body": "@teowey i pasted all of the variable and struct of my header in the first section."}], "owner": {"reputation": 3, "user_id": 7221489, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b06de1669e2aefbe886dcad2226e0cdd?s=128&d=identicon&r=PG&f=1", "display_name": "Edwin Ansari", "link": "https://stackoverflow.com/users/7221489/edwin-ansari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1576677590, "creation_date": 1576667809, "last_edit_date": 1576677590, "question_id": 59390868, "link": "https://stackoverflow.com/questions/59390868/last-element-doesnt-work-well-in-a-doubly-linked-list-implementation-in-c", "title": "Last element doesn&#39;t work well in a Doubly Linked List implementation in C", "body": "<p>here is all dependency needed in this part of code:</p>\n\n<pre><code>\n#define NTRANCHES 1024\n\nsize_t nb_blocs(size_t n){\n    return ceil((double)n/(double)sizeof(align_data));\n}\n\ntypedef union {\n    intmax_t a;\n    void* adr;\n    long double c;\n} align_data;\n\ntypedef struct node{\n    ptrdiff_t next; //shift from the start point of memory\n    ptrdiff_t previous; //same like next\n    size_t len;\n    align_data data[];\n} node;\n\n//tranche mean cut in french!\n typedef struct{\n    ptrdiff_t decalage; //the shift from the start point of the memory\n    size_t nb_blocs; // number of blocs in this cut\n} tranche; //used to save free space of the memory in another array called libre* in the head\n\ntypedef struct{\n    void* memory; //single memory to save all nodes\n    ptrdiff_t first; //shift from start\n    ptrdiff_t last;  //shift from start\n    tranche* libre; //array to save free spaces\n    size_t size;    //size of the memory\n    size_t nb_elem; //number of elements in the memory\n    size_t nb_bloc_libre; //number of free blocs\n} head;\n\nvoid* ld_create(size_t nboctets){\n    tranche* tab_tranches =malloc(NTRANCHES * sizeof(tranche));\n    head* res=malloc(sizeof(head));\n    res-&gt;size=nb_blocs(nboctets)*sizeof(align_data);\n    res-&gt;memory=malloc(res-&gt;size);\n    res-&gt;first=0;\n    res-&gt;last=0;\n    res-&gt;libre=tab_tranches;\n    res-&gt;nb_bloc_libre=nb_blocs(nboctets);\n    res-&gt;nb_elem=0;\n    tab_tranches[0].decalage=0;\n    tab_tranches[0].nb_blocs=res-&gt;nb_bloc_libre;\n    return res;\n\n} //to initialize the memory\n\n void* ld_first(void* liste){\n     head* head=liste;\n     if(head-&gt;nb_elem==0){\n         return NULL;\n     }\n     return (node*)(align_data*)(head-&gt;memory + head-&gt;first);\n }\n\n void* ld_last(void* liste){\n    head* head=liste;\n    if(head-&gt;nb_elem==0){\n         return NULL;\n    }\n    return (node*)(align_data*)(head-&gt;memory + head-&gt;last);\n }\n\n</code></pre>\n\n<p>and here is the function that doesn't work well:</p>\n\n<pre><code>void* ld_insert_first(void* liste, size_t len, void* p_data){\n    // len : length of the whole node\n    head* hd=liste;\n    node* new_node;\n    node* first_node = ld_first(hd);\n\n    tranche* tab_tranche = hd-&gt;libre; //to maintain free spaces in the memory\n\n    for(int i=0;i&lt;NTRANCHES;i++){\n        if( tab_tranche[i].nb_blocs&gt; nb_blocs(len)){\n            int dec=tab_tranche[i].decalage;\n            printf(\"dec: %d\\n\",dec);\n            new_node = (node*)(align_data*)(hd-&gt;memory+dec); \n\n            new_node-&gt;previous=0;\n            new_node-&gt;next= hd-&gt;first - dec;\n            new_node-&gt;len=len;\n            memmove(new_node-&gt;data , (align_data*) p_data , len-sizeof(node));\n\n            if(first_node!=NULL)\n                first_node-&gt;previous = dec - hd-&gt;first;\n\n            hd-&gt;first = dec;\n\n            if(hd-&gt;nb_elem==0){\n                hd-&gt;last= dec;\n            }\n            tab_tranche[i].decalage = dec + nb_blocs(len);\n            tab_tranche[i].nb_blocs -= nb_blocs(len);\n\n            hd-&gt;nb_elem++;\n            hd-&gt;nb_bloc_libre--;\n\n            break;\n\n        }\n    }\n    return new_node;\n}\n\n</code></pre>\n\n<p>and here is a test that doesn't work well.\nwhen I insert just one element at the first of the list, the last element is correct; but if I insert 2 or more elements, the last element will be a large random number!\nWe can see that <code>head-&gt;last</code> will always be <code>0</code> after the first insertion so I can't understand why the function doesn't print the correct number after the first insertion:</p>\n\n<pre><code>\nint main(){\n\n    head* hd= ld_create(1000);\n    align_data data1[5];\n    data1-&gt;a=1;\n    (data1+1)-&gt;a=2;\n    (data1+2)-&gt;a=3;\n    (data1+3)-&gt;a=4;\n    (data1+4)-&gt;a=5;\n\n    align_data data2[3];\n    data2-&gt;a=10;\n    (data2+1)-&gt;a=20;\n    (data2+2)-&gt;a=30;\n\n    ld_insert_first(hd,sizeof(node)+sizeof(data1),data1);\n    printf(\"%ld \\n\", ((node*) ld_last(hd)) -&gt; len); //print 112 correct!\n\n    ld_insert_first(hd,sizeof(node)+sizeof(data2),data2);\n    printf(\"%ld \\n\", ((node*) ld_last(hd)) -&gt; len); //print a large number!\n\n    return 0;\n\n}\n</code></pre>\n"}, {"tags": ["c", "casting"], "comments": [{"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 0, "creation_date": 1576667026, "post_id": 59390567, "comment_id": 104971278, "body": "Compilers warn about stuff like <code>printf(&quot;%i&quot;, (char*)x)</code> mismatches. A good starting point would be to read the warnings."}, {"owner": {"reputation": 375, "user_id": 11958500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/808134f06cedf9957a27a924d1589f3a?s=128&d=identicon&r=PG&f=1", "display_name": "gaston", "link": "https://stackoverflow.com/users/11958500/gaston"}, "reply_to_user": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 0, "creation_date": 1576667250, "post_id": 59390567, "comment_id": 104971410, "body": "@PSkocik No, I am using cross compiler that did not show me any warning for that problem!"}, {"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 0, "creation_date": 1576667403, "post_id": 59390567, "comment_id": 104971491, "body": "<a href=\"https://stackoverflow.com/questions/tagged/c\">c</a> uses null terminated strings so <code>char buf_wr[10];</code> is not enough (assuming 32 bit integers) to store the worst case <code>\u22122147483647</code>"}], "answers": [{"comments": [{"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 1, "creation_date": 1576667248, "post_id": 59390596, "comment_id": 104971409, "body": "<code>char buf_wr[10]</code> ----&gt; <code>char buf_wr[12]</code> at least and use <code>snprintf</code> to check string bounds properly"}], "tags": [], "owner": {"reputation": 12106, "user_id": 4431643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CoZjt.jpg?s=128&g=1", "display_name": "kiran Biradar", "link": "https://stackoverflow.com/users/4431643/kiran-biradar"}, "is_accepted": true, "score": 1, "last_activity_date": 1576666881, "creation_date": 1576666881, "answer_id": 59390596, "question_id": 59390567, "link": "https://stackoverflow.com/questions/59390567/c-how-to-send-an-int-type-variable-to-an-array-of-char/59390596#59390596", "title": "C : How to send an int type variable to an array of char?", "body": "<pre><code>printf(\"buf_wr contains : %i\\n\", buf_wr);\n</code></pre>\n\n<p>You should be using <code>%s</code> to print <code>string</code>.</p>\n\n<pre><code>printf(\"buf_wr contains : %s\\n\", buf_wr);\n</code></pre>\n"}], "owner": {"reputation": 375, "user_id": 11958500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/808134f06cedf9957a27a924d1589f3a?s=128&d=identicon&r=PG&f=1", "display_name": "gaston", "link": "https://stackoverflow.com/users/11958500/gaston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 0, "closed_date": 1576667810, "accepted_answer_id": 59390596, "answer_count": 1, "score": -2, "last_activity_date": 1576666881, "creation_date": 1576666760, "question_id": 59390567, "link": "https://stackoverflow.com/questions/59390567/c-how-to-send-an-int-type-variable-to-an-array-of-char", "closed_reason": "Not suitable for this site", "title": "C : How to send an int type variable to an array of char?", "body": "<p>I am trying to write an integer variable, named <strong>value</strong>, in an array of char buffer, named <strong>buf_wr</strong>.\nThis is the function where I am facing the problem : </p>\n\n<pre><code>void receiveData(int n, siginfo_t *info, void *unused) \n{\n    int nw;\n    int fd;\n    char buf_wr[10];\n    int value;\n\n    printf(\" \\nreceived value %i\\n\", info-&gt;si_int);\n    value = (info-&gt;si_int);\n    printf(\"value = %i\\n\", value);\n    sprintf(buf_wr, \"%i\", value);\n    printf(\"buf_wr contains : %i\\n\", buf_wr);\n    nw = write(fd,buf_wr,strlen(buf_wr));\n    if (nw &lt; 0)\n    {\n        perror(\"Failed to write the message to the device.\");\n    }\n}\n</code></pre>\n\n<p>When I execute the entire code, it shows me :</p>\n\n<pre><code>received value 260\nvalue = 260\nbuf_wr contains : 135264\n</code></pre>\n\n<p><strong>buf_wr</strong> does not contain the value I want to get into it which is <strong>260</strong>.</p>\n\n<p>How can I fix the problem ? Thank you.</p>\n"}, {"tags": ["c", "floating-point", "ieee-754"], "comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1576666904, "post_id": 59390537, "comment_id": 104971237, "body": "What about sub-normal <code>a</code> and / or <code>b</code>?"}, {"owner": {"reputation": 845, "user_id": 1289198, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ed1ed50abd03457dd455c60a4e80d7c6?s=128&d=identicon&r=PG", "display_name": "yakoudbz", "link": "https://stackoverflow.com/users/1289198/yakoudbz"}, "reply_to_user": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1576667077, "post_id": 59390537, "comment_id": 104971310, "body": "Good question. x cannot be sub-normal, it should be in a &quot;safe range&quot; such that <code>max &#47; x</code> never overflow for any value of n below 32."}, {"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 2, "creation_date": 1576667092, "post_id": 59390537, "comment_id": 104971314, "body": "Although you mentioned that <code>1 &lt;&lt; n</code> cannot overflow, you should ensure that you use unsigned type large enough to fit possible bits, for example <code>1ull &lt;&lt; n</code>."}, {"owner": {"reputation": 845, "user_id": 1289198, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ed1ed50abd03457dd455c60a4e80d7c6?s=128&d=identicon&r=PG", "display_name": "yakoudbz", "link": "https://stackoverflow.com/users/1289198/yakoudbz"}, "edited": false, "score": 0, "creation_date": 1576667407, "post_id": 59390537, "comment_id": 104971493, "body": "I gave more detailed on the constraints on n and added <code>ull</code>"}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 0, "creation_date": 1576672897, "post_id": 59390537, "comment_id": 104974217, "body": "Is <code>f</code> allowed to become subnormal?"}, {"owner": {"reputation": 845, "user_id": 1289198, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ed1ed50abd03457dd455c60a4e80d7c6?s=128&d=identicon&r=PG", "display_name": "yakoudbz", "link": "https://stackoverflow.com/users/1289198/yakoudbz"}, "edited": false, "score": 0, "creation_date": 1576673515, "post_id": 59390537, "comment_id": 104974506, "body": "Actually, x is a geometric coordinates in my application. f being subnormal would mean that x is abnormally large..."}, {"owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "edited": false, "score": 0, "creation_date": 1576673607, "post_id": 59390537, "comment_id": 104974564, "body": "Quite right, but that doesn&#39;t answer my question!"}, {"owner": {"reputation": 845, "user_id": 1289198, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ed1ed50abd03457dd455c60a4e80d7c6?s=128&d=identicon&r=PG", "display_name": "yakoudbz", "link": "https://stackoverflow.com/users/1289198/yakoudbz"}, "edited": false, "score": 0, "creation_date": 1576673709, "post_id": 59390537, "comment_id": 104974630, "body": "It&#39;s not allowed to be subnormal. I don&#39;t deal with sub-normals, infinite, NaN, overflows or underflows."}], "answers": [{"comments": [{"owner": {"reputation": 845, "user_id": 1289198, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ed1ed50abd03457dd455c60a4e80d7c6?s=128&d=identicon&r=PG", "display_name": "yakoudbz", "link": "https://stackoverflow.com/users/1289198/yakoudbz"}, "edited": false, "score": 0, "creation_date": 1576685606, "post_id": 59394532, "comment_id": 104981285, "body": "I went to see one of my collegue and we arrived exactly to the same answer ! Just found out your answer coming back to my office."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576689252, "post_id": 59394532, "comment_id": 104983267, "body": "&quot;ix the nearest floating point to 1/x&quot; is a good first step.  Yet IEEE754 has rounding modes may differ than round to nearest.  I suspect this answer still holds in other modes, yet may be worthy of investigation to see if a counter-example exists."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1576689309, "post_id": 59394532, "comment_id": 104983290, "body": "This answer may have been on the right track, but it looks like it went off the rails a bit. We do not want to find an <code>ix = 1&#47;x - r&#47;x</code>, where the rounding went downward. We want a case where the rounding goes upward."}, {"owner": {"reputation": 8425, "user_id": 1396822, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f2e818842b0436e98b279af7f69997cb?s=128&d=identicon&r=PG", "display_name": "aka.nice", "link": "https://stackoverflow.com/users/1396822/aka-nice"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1576689422, "post_id": 59394532, "comment_id": 104983342, "body": "@EricPostpischil yes, unfortunate notations indeed, <code>r</code> is signed and interesting case is negative <code>r</code>"}, {"owner": {"reputation": 8425, "user_id": 1396822, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f2e818842b0436e98b279af7f69997cb?s=128&d=identicon&r=PG", "display_name": "aka.nice", "link": "https://stackoverflow.com/users/1396822/aka-nice"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576689470, "post_id": 59394532, "comment_id": 104983360, "body": "@chux-ReinstateMonica right, I could have mentionned the default rounding mode..."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576689538, "post_id": 59394532, "comment_id": 104983392, "body": "@chux: Of course it cannot hold when rounding is upward (toward +infinity). An exact division will round upward, and then the product necessarily exceeds the original dividend."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1576689673, "post_id": 59394532, "comment_id": 104983449, "body": "@EricPostpischil Suggest posting <a href=\"https://stackoverflow.com/questions/59390537/ieee754-floating-point-1-x-x-1-0/59394532?noredirect=1#comment104983392_59394532\">that</a> then as an example of <code>printf(&quot;found !!! x=%.30f\\n&quot;, x);</code> as it appears to be a good answer to OP."}, {"owner": {"reputation": 8425, "user_id": 1396822, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f2e818842b0436e98b279af7f69997cb?s=128&d=identicon&r=PG", "display_name": "aka.nice", "link": "https://stackoverflow.com/users/1396822/aka-nice"}, "reply_to_user": {"reputation": 845, "user_id": 1289198, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ed1ed50abd03457dd455c60a4e80d7c6?s=128&d=identicon&r=PG", "display_name": "yakoudbz", "link": "https://stackoverflow.com/users/1289198/yakoudbz"}, "edited": false, "score": 0, "creation_date": 1576690007, "post_id": 59394532, "comment_id": 104983629, "body": "@yakoudbz also note I have assumed strict ieee754, so of course you have to use appropriate c compiler options that will offer such guaranty (no use of excess precision etc...)"}], "tags": [], "owner": {"reputation": 8425, "user_id": 1396822, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f2e818842b0436e98b279af7f69997cb?s=128&d=identicon&r=PG", "display_name": "aka.nice", "link": "https://stackoverflow.com/users/1396822/aka-nice"}, "is_accepted": true, "score": 1, "last_activity_date": 1576692115, "last_edit_date": 1576692115, "creation_date": 1576680567, "answer_id": 59394532, "question_id": 59390537, "link": "https://stackoverflow.com/questions/59390537/ieee754-floating-point-1-x-x-1-0/59394532#59394532", "title": "ieee754 floating point 1/x * x &gt; 1.0", "body": "<p>Multiplication by a power of two is just a scaling of exponent, it does not change the problem: so it's the same as finding <code>x</code> such that <code>(1/x) * x &gt; 1</code>.</p>\n\n<p>One solution is brute force search.<br>\nFor same reasons, we can limit the search of such <code>x</code> in the interval (1.0,2.0(</p>\n\n<p>A better approach is to analyze error bounds without brute force.</p>\n\n<p>Let's note <code>ix</code> the nearest floating point to <code>1/x</code>.</p>\n\n<p>Considering <code>x</code>and <code>ix</code>as exact fractions, we can write the integer division: <code>1 = ix * x + r</code> where <code>r</code>is the remainder<br>\n(these are all fractions with denominators being powers of 2, so we have to multiply the whole equation by appropriate power of 2 to really have integer division).<br>\nIn other words, <code>ix = 1/x - r/x</code>, where <code>-r/x</code> is the rounding error of inversion.<br>\nWhen we multiply the inverse approximation by <code>x</code>, the exact value is <code>ix*x = 1 - r</code>.<br>\nWe know that the floating point result will be rounded to the nearest float to that exact value.<br>\nSo, assumming default rounding mode to nearest, tie to even, the question asked is whether <code>-r</code> can exceed <code>0.5 ulp</code>.</p>\n\n<p>The short answer is never!<br>\nSuppose <code>|r| &gt; 0.5 ulp</code>, then the rounding error <code>-r/x</code> does exceed half ulp of exact result <code>1/x</code>.<br>\nThis is not a proper answer, because the exact result is not a floating point and does not have an ulp, but you get the idea...<br>\nI might come back with a correct proof if i have time, but my bet is that you can find it already done, possibly on SO</p>\n\n<p><strong>EDIT</strong>\nWhy can you find <code>(1/x) * x &lt; 1</code>?</p>\n\n<p>Simply because 1.0 is at a binade limit, so below 1, we have to prove that <code>r&lt;0.25 ulp</code>, what we cannot...</p>\n"}, {"comments": [{"owner": {"reputation": 19034, "user_id": 780717, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/eead3a6ab011b880ca6ec354ca00f0b3?s=128&d=identicon&r=PG", "display_name": "njuffa", "link": "https://stackoverflow.com/users/780717/njuffa"}, "edited": false, "score": 1, "creation_date": 1577083303, "post_id": 59397254, "comment_id": 105084353, "body": "See also: Alan Edelman, &quot;When is x \u2731(1/x) \u2260 1?&quot; <a href=\"http://www-math.mit.edu/~edelman/homepage/papers/ieee.pdf\" rel=\"nofollow noreferrer\">Online draft</a>, December 7, 1994."}], "tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": false, "score": 4, "last_activity_date": 1577372524, "last_edit_date": 1577372524, "creation_date": 1576689953, "answer_id": 59397254, "question_id": 59390537, "link": "https://stackoverflow.com/questions/59390537/ieee754-floating-point-1-x-x-1-0/59397254#59397254", "title": "ieee754 floating point 1/x * x &gt; 1.0", "body": "<p>In the absence of underflow or overflow, the exponents are irrelevant; if <code>M/x*x &gt; M</code>, then <code>(M/p) / (x/q) * (x/q) &gt; (M/p)</code> for any powers of two <code>p</code> and <code>q</code>. So let\u2019s consider 2<sup>52</sup> \u2264 <code>x</code> &lt; 2<sup>53</sup> and <code>M</code> = 2<sup>105</sup>. We can eliminate <code>x</code> = 2<sup>52</sup> since this yields exact floating-point arithmetic, so 2<sup>52</sup> &lt; <code>x</code> &lt; 2<sup>53</sup>.</p>\n\n<p>Division of 2<sup>105</sup> by <code>x</code> yields integer quotient <code>q</code> and integer remainder <code>r</code>, with 2<sup>52</sup> <code>q</code> &lt; 2<sup>53</sup>, 0 &lt; <code>r</code> &lt; <code>x</code>, and 2<sup>105</sup> = <code>q</code>\u2022<code>x</code> + <code>r</code>.</p>\n\n<p>In order for <code>M/x*x</code> to exceed <code>M</code>, both the division and the multiplication must round up. Since the division rounds up, <code>x</code>/2 \u2264 <code>r</code>.</p>\n\n<p>With rounding up, the result of floating-point division of 2<sup>105</sup> by <code>x</code> yields <code>q</code>+1. Then the exact (not rounded) multiplication yields (<code>q</code>+1)\u2022<code>x</code> = <code>q</code>\u2022<code>x</code> + <code>x</code> = <code>q</code>\u2022<code>x</code> + <code>x</code> + <code>r</code> - <code>r</code> = <code>q</code>\u2022<code>x</code> + <code>r</code> + <code>x</code> \u2212 <code>r</code> = 2<sup>105</sup> + <code>x</code> \u2212 <code>r</code>. Since <code>x</code>/2 &lt; <code>r</code>, <code>x</code> \u2212 <code>r</code> \u2264 <code>x</code>/2, so rounding this exact result rounds down, yielding 2<sup>105</sup>. (The \u201c&lt;\u201d case always rounds down, and the \u201c=\u201d case rounds down because 2<sup>105</sup> has the low even bit.)</p>\n\n<p>Therefore, for powers of two <code>M</code> and all arithmetic within exponent bounds, <code>M/x*x &gt; M</code> never occurs with round-to-nearest-ties-to-even.</p>\n"}, {"comments": [{"owner": {"reputation": 845, "user_id": 1289198, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ed1ed50abd03457dd455c60a4e80d7c6?s=128&d=identicon&r=PG", "display_name": "yakoudbz", "link": "https://stackoverflow.com/users/1289198/yakoudbz"}, "edited": false, "score": 0, "creation_date": 1576702867, "post_id": 59399582, "comment_id": 104988923, "body": "179769313486231550856124328384506240234343437157459335924404&zwnj;&#8203;87244858184575455611&zwnj;&#8203;43884706399431262203&zwnj;&#8203;21960804027157371570&zwnj;&#8203;80985288496451174304&zwnj;&#8203;40876627676009095943&zwnj;&#8203;31927728237078876188&zwnj;&#8203;76057953256376869865&zwnj;&#8203;40648252621157710157&zwnj;&#8203;91463983014857704008&zwnj;&#8203;12341945938624514172&zwnj;&#8203;37031480975291084233&zwnj;&#8203;58883457665451722744&zwnj;&#8203;025579520 is definitely not in the range of number that I consider..."}, {"owner": {"reputation": 2202, "user_id": 4196475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c503780a3af66d4c9f0e25837b0dddd?s=128&d=identicon&r=PG&f=1", "display_name": "Dimas Mendes", "link": "https://stackoverflow.com/users/4196475/dimas-mendes"}, "edited": false, "score": 0, "creation_date": 1576703254, "post_id": 59399582, "comment_id": 104989050, "body": "Please, provide more details about your question."}, {"owner": {"reputation": 11, "user_id": 12561074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc9f1f379ed7d4eeea2ac270abf98eb1?s=128&d=identicon&r=PG", "display_name": "kashi", "link": "https://stackoverflow.com/users/12561074/kashi"}, "edited": false, "score": 0, "creation_date": 1576718382, "post_id": 59399582, "comment_id": 104993219, "body": "Why? the value is representable by IEEE754 double precision format."}, {"owner": {"reputation": 845, "user_id": 1289198, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ed1ed50abd03457dd455c60a4e80d7c6?s=128&d=identicon&r=PG", "display_name": "yakoudbz", "link": "https://stackoverflow.com/users/1289198/yakoudbz"}, "edited": false, "score": 0, "creation_date": 1576767084, "post_id": 59399582, "comment_id": 105011282, "body": "1.0/(pow(2, 1023) * (2 - pow(2, -51))) = 5.56268464626800345772558179333e-309             That is definitely a subnormal number because the smallest normal number is around 1e-38. I wanted a proof involving only normal numbers with no overflow or underflow. I should have been more precise. Anyway, I got two satisfying answers, proving rigorously that it cannot happen with IEE754 round-to-nearest-ties-to-even."}, {"owner": {"reputation": 11, "user_id": 12561074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc9f1f379ed7d4eeea2ac270abf98eb1?s=128&d=identicon&r=PG", "display_name": "kashi", "link": "https://stackoverflow.com/users/12561074/kashi"}, "edited": false, "score": 0, "creation_date": 1576769183, "post_id": 59399582, "comment_id": 105012444, "body": "OK. I understand. But, the smallest normal number of double precision is 2^(-1022) ~= 2.225e-308. 1e-38 is that of single precision. As you say, 5.56e-309 is a subnormal number, and I think that such a phenomenon does not happen in normal number."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 845, "user_id": 1289198, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ed1ed50abd03457dd455c60a4e80d7c6?s=128&d=identicon&r=PG", "display_name": "yakoudbz", "link": "https://stackoverflow.com/users/1289198/yakoudbz"}, "edited": false, "score": 0, "creation_date": 1576854418, "post_id": 59399582, "comment_id": 105040817, "body": "@yakoudbz Re; <a href=\"https://stackoverflow.com/questions/59390537/ieee754-floating-point-1-x-x-1-0#comment105011282_59399582\">t cannot happen with IEE754 round-to-nearest-ties-to-even</a>: Although the post talks about <code>roundToNearest</code>, the question itself is not restricted to &quot;round-to-nearest-ties-to-even&quot;.  Such restrictions in your comment deserved to have been in the original post."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 845, "user_id": 1289198, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ed1ed50abd03457dd455c60a4e80d7c6?s=128&d=identicon&r=PG", "display_name": "yakoudbz", "link": "https://stackoverflow.com/users/1289198/yakoudbz"}, "edited": false, "score": 0, "creation_date": 1576854602, "post_id": 59399582, "comment_id": 105040898, "body": "@yakoudbz Note <a href=\"https://stackoverflow.com/questions/59390537/ieee754-floating-point-1-x-x-1-0#comment105011282_59399582\">the smallest normal number is around 1e-38</a> is amiss.  A <code>double</code> with IEEE754  smallest normal is about 2.2250738585072014E-308."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576855050, "post_id": 59399582, "comment_id": 105041074, "body": "The answer shows a failed case and meets the 5  bullet-ed point criteria."}], "tags": [], "owner": {"reputation": 11, "user_id": 12561074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc9f1f379ed7d4eeea2ac270abf98eb1?s=128&d=identicon&r=PG", "display_name": "kashi", "link": "https://stackoverflow.com/users/12561074/kashi"}, "is_accepted": false, "score": 1, "last_activity_date": 1576701070, "creation_date": 1576701070, "answer_id": 59399582, "question_id": 59390537, "link": "https://stackoverflow.com/questions/59390537/ieee754-floating-point-1-x-x-1-0/59399582#59399582", "title": "ieee754 floating point 1/x * x &gt; 1.0", "body": "<p>canfail(1, pow(2, 1023) * (2 - pow(2, -51))) will return 1.</p>\n"}], "owner": {"reputation": 845, "user_id": 1289198, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ed1ed50abd03457dd455c60a4e80d7c6?s=128&d=identicon&r=PG", "display_name": "yakoudbz", "link": "https://stackoverflow.com/users/1289198/yakoudbz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "accepted_answer_id": 59394532, "answer_count": 3, "score": 5, "last_activity_date": 1577372524, "creation_date": 1576666636, "last_edit_date": 1576677306, "question_id": 59390537, "link": "https://stackoverflow.com/questions/59390537/ieee754-floating-point-1-x-x-1-0", "title": "ieee754 floating point 1/x * x &gt; 1.0", "body": "<p>I want to know whether the program defined below can return 1 assuming:</p>\n\n<ul>\n<li>IEEE754 floating point arithmetics</li>\n<li>no overflow (neither in <code>max/x</code> nor in <code>f*x</code>)</li>\n<li>no nan or inf (obviously)</li>\n<li>0 &lt; x and 0 &lt; n &lt; 32</li>\n<li>no unsafe math optimization</li>\n</ul>\n\n<pre><code>int canfail(int n, double x) {\n    double max = 1ULL &lt;&lt; n; // 2^n\n    double f = max / x;\n    return f * x &gt; max;\n}\n</code></pre>\n\n<p>In my opinion, it should sometime return 1, as <code>roundToNearest(max / x)</code> can in general be greater than <code>max/x</code>.\nI'm able to find numbers for the opposite case, where <code>f * x &lt; max</code>, but I have no examples of input that show <code>f * x &gt; max</code> and I have no idea of how to find one. Can somebody help ?</p>\n\n<p><strong>EDIT</strong>:\nI know the value of x if in a range between 10^(-6) and 10^6 (that still leaves a lot (too much possible double values), but I know I will not have to deal with overflow, underflow or sub-normal numbers !\nIn addition, I just realized that because <code>max</code> is a power of two and we don't deal with overflow, <strong>the solution will be the same by fixing <code>max=1</code></strong> as it is exactly the same computation, but shifted.</p>\n\n<p>Therefore, the problem correspond to finding a positive, normal double value <code>x</code> such that `(1/x) * x > 1.0 !!</p>\n\n<p>I made a little program to try to find a solution:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;math.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;omp.h&gt;\n\nint main( void ) {\n    #pragma omp parallel\n    {\n        unsigned short int xsubi[3] = {\n            omp_get_thread_num(),\n            omp_get_thread_num(),\n            omp_get_thread_num()\n        };\n\n        #pragma omp for\n        for(int64_t i=0; i&lt;INT64_MAX; i++) {\n            double x = fmod(nrand48(xsubi), 1048576.0);\n            if(x&lt;0.000001)\n                continue;\n\n            double f = 1.0 / x;\n            if(f * x &gt; 1.0) {\n                printf(\"found !!! x=%.30f\\n\", x);\n                fflush(stdout);\n            }\n        }\n    }\n    return 1;\n}\n</code></pre>\n\n<p>If you change the sign of the comparison, you will find some value quickly. However, it seems to run forever with <code>f * x &gt; 1.0</code></p>\n"}, {"tags": ["c", "semaphore", "mkfifo"], "comments": [{"owner": {"reputation": 296, "user_id": 1119949, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f2b554424d5a379f327515cadc7d67b5?s=128&d=identicon&r=PG", "display_name": "imbuedHope", "link": "https://stackoverflow.com/users/1119949/imbuedhope"}, "edited": false, "score": 0, "creation_date": 1576696118, "post_id": 59390515, "comment_id": 104986305, "body": "Looks like a timing issue based on the errors. Writes to a fifo are blocked until something is connected to on the other end so test2 is basically trying to open a fifo before it has been created (because test2 tries to open the fifo to write the result before test gets to creating the fifo).  Have you tried making the both mkfifo calls the first thing that happens in test.c?  See the docs here <a href=\"https://linux.die.net/man/3/mkfifo\" rel=\"nofollow noreferrer\">linux.die.net/man/3/mkfifo</a>"}, {"owner": {"reputation": 43, "user_id": 10566291, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6588cQVAUhY/AAAAAAAAAAI/AAAAAAAABak/lP_k74ALVe8/photo.jpg?sz=128", "display_name": "\u043a\u0438\u0440\u0438\u043b\u043b \u0431\u0430\u043b\u0430\u0448\u043e\u0432", "link": "https://stackoverflow.com/users/10566291/%d0%ba%d0%b8%d1%80%d0%b8%d0%bb%d0%bb-%d0%b1%d0%b0%d0%bb%d0%b0%d1%88%d0%be%d0%b2"}, "reply_to_user": {"reputation": 296, "user_id": 1119949, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f2b554424d5a379f327515cadc7d67b5?s=128&d=identicon&r=PG", "display_name": "imbuedHope", "link": "https://stackoverflow.com/users/1119949/imbuedhope"}, "edited": false, "score": 0, "creation_date": 1576815930, "post_id": 59390515, "comment_id": 105026608, "body": "Sorry, I did not understand your question"}], "owner": {"reputation": 43, "user_id": 10566291, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6588cQVAUhY/AAAAAAAAAAI/AAAAAAAABak/lP_k74ALVe8/photo.jpg?sz=128", "display_name": "\u043a\u0438\u0440\u0438\u043b\u043b \u0431\u0430\u043b\u0430\u0448\u043e\u0432", "link": "https://stackoverflow.com/users/10566291/%d0%ba%d0%b8%d1%80%d0%b8%d0%bb%d0%bb-%d0%b1%d0%b0%d0%bb%d0%b0%d1%88%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576666564, "creation_date": 1576666564, "question_id": 59390515, "link": "https://stackoverflow.com/questions/59390515/malfunctioning-semaphore", "title": "Malfunctioning semaphore", "body": "<p>I am trying to organize the interaction of two processes. The first process sends in the second 2 numbers. The second finds the amount and passes it to the first process. I use a named semaphore to synchronize these processes. After creating MKFIFO, I block this process so that it does not open it ahead of time. The second process at this time opens the previously created channel and writes the result to it, then releases the first process. But it turns out that the second process does not see the channel that created the first process for it. What am I doing wrong?</p>\n\n<p><a href=\"https://i.stack.imgur.com/Bro1m.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Bro1m.png\" alt=\"enter image description here\"></a>\n<a href=\"https://i.stack.imgur.com/Z1O7A.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Z1O7A.png\" alt=\"enter image description here\"></a></p>\n\n<p>test.c:</p>\n\n<pre><code>#define SEMAPHORE_NAME \"/my_named_semaphore\"\n\nsem_t *sem;\nint f1,f2;\ndouble summ = 0;\nunlink(\"mk.fifo\");\n\nif (mkfifo(\"mk.fifo\", S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH) == -1 &amp;&amp; errno != EEXIST)\n    error(0, errno, \"mkfifo() error\");\n\nf1 = open(\"mk.fifo\", O_WRONLY);\nperror(\"Opening \");\n\nwrite(f1, &amp;a, sizeof(double));\nwrite(f1, &amp;b, sizeof(double));\nperror(\"Writing \");\n\nclose(f1);\n\nunlink(\"mk.fifoSumm\");\nif (mkfifo(\"mk.fifoSumm\", S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH) == -1 &amp;&amp; errno != EEXIST)\n    error(0, errno, \"mkfifo() error\");\n\n    sem = sem_open(SEMAPHORE_NAME, O_CREAT, 0777, 0);\n    printf(\"\u0437\u0430\u0448\u043b\u0438 \u0432 \u0441\u0435\u043c\u0430\u0444\u043e\u0440\\n\");\n    printf(\"\u0436\u0434\u0435\u043c\\n\");\n    sem_wait(sem);\n    printf(\"\u043f\u043e\u0434\u043e\u0436\u0434\u0430\u043b\u0438\\n\");\n    f2 = open(\"mk.fifoSumm\", O_RDONLY);\n    perror(\"Opening \");\n\n    read(f2, &amp;summ, sizeof(double));\n    perror(\"Reading \");\n\n    close(f2);\n\nprintf(\"Received string '%lf'\\n\", summ);\n\nreturn summ;\n}\n</code></pre>\n\n<p>test2.c:</p>\n\n<pre><code>#define SEMAPHORE_NAME \"/my_named_semaphore\"\n\nsem_t *sem;\nint f2,f1;\ndouble a = 0;\ndouble b = 0;\ndouble summ = 0;\n\nf2 = open(\"mk.fifo\", O_RDONLY);\nperror(\"Opening \");\n\nread(f2, &amp;a, sizeof(double));\nread(f2, &amp;b, sizeof(double));\nperror(\"Reading \");\n\nclose(f2);\n\nprintf(\"Received string '%lf'\\n\", a);\nprintf(\"Received string '%lf'\\n\", b);\n\nsumm = a + b;\n\nsem = sem_open(SEMAPHORE_NAME, 0);\nf1 = open(\"mk.fifoSumm\", O_WRONLY);\nperror(\"Opening \");\n\nwrite(f1, &amp;summ, sizeof(double));\nperror(\"Writing \");\n\nsem_post(sem);\nprintf(\"\u043e\u0441\u0432\u043e\u0431\u043e\u0434\u0438\u043b\u0438 \u0441\u0435\u043c\u0430\u0444\u043e\u0440\\n\");\n\nclose(f1);\n</code></pre>\n"}, {"tags": ["c", "gcc", "assembly", "inline-assembly"], "comments": [{"owner": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 4, "creation_date": 1576667165, "post_id": 59390465, "comment_id": 104971368, "body": "The <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html\" rel=\"nofollow noreferrer\">manual says</a>: <i>&quot;Use the \u2018&amp;\u2019 constraint modifier (see Modifiers) on all output operands that must not overlap an input. Otherwise, GCC may allocate the output operand in the same register as an unrelated input operand, on the assumption that the assembler code consumes its inputs before producing outputs. This assumption may be false if the assembler code actually consists of more than one instruction. &quot;</i>"}, {"owner": {"reputation": 659, "user_id": 3775615, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d2986c3db72e19a9ca9f88b86f23e42a?s=128&d=identicon&r=PG&f=1", "display_name": "TSG", "link": "https://stackoverflow.com/users/3775615/tsg"}, "reply_to_user": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 0, "creation_date": 1576668051, "post_id": 59390465, "comment_id": 104971804, "body": "This seems to be perfectly relevant. This implies that GCC is not using the sort of lifetime analysis that compilers generally use. Is there a real challenge to doing this with inline assembly?"}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 4, "creation_date": 1576668556, "post_id": 59390465, "comment_id": 104972015, "body": "@TSG The compiler does not inspect your inline assembly for it cannot and must not.  You have to do this analysis and present it as constraints to your assembly code.  That&#39;s why I usually advice to avoid inline assembly if possible."}, {"owner": {"reputation": 659, "user_id": 3775615, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d2986c3db72e19a9ca9f88b86f23e42a?s=128&d=identicon&r=PG&f=1", "display_name": "TSG", "link": "https://stackoverflow.com/users/3775615/tsg"}, "edited": false, "score": 0, "creation_date": 1576669357, "post_id": 59390465, "comment_id": 104972438, "body": "Aha! Makes sense, though we are relying on it for a lot of work, including register allocation."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1576669473, "post_id": 59390465, "comment_id": 104972497, "body": "@TSG Yeah, but inline assembly is basically \u201cmanual mode\u201d concerning lifetime analysis and instruction selection."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1576678471, "post_id": 59390465, "comment_id": 104977105, "body": "<code>movq TARGET(%%rip), %[tmp];</code> You know that&#39;s a load of the machine-code bytes of the function epilogue, right?  Did you want a RIP-relative LEA to get a pointer to store in something you&#39;re calling a pointer?  I have no idea what you&#39;re doing here.  You definitely can&#39;t safely jump to <code>TARGET:</code>.  If you want that, use a C label and <code>asm goto</code>."}, {"owner": {"reputation": 659, "user_id": 3775615, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d2986c3db72e19a9ca9f88b86f23e42a?s=128&d=identicon&r=PG&f=1", "display_name": "TSG", "link": "https://stackoverflow.com/users/3775615/tsg"}, "edited": false, "score": 0, "creation_date": 1576681392, "post_id": 59390465, "comment_id": 104978829, "body": "I realised that the appropriate opcode is <code>lea</code> not <code>mov</code> since I do want to jump to TARGET eventually. I&#39;ve updated my code accordingly."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1576683105, "post_id": 59390465, "comment_id": 104979814, "body": "Didn&#39;t see your reply, don&#39;t forget to @TSG people.  (You get notified because we&#39;re commenting under your answer.  Other people don&#39;t.)  Anyway, perhaps you&#39;re looking for GNU C computed goto / taking the address of a C label. <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Labels-as-Values.html\" rel=\"nofollow noreferrer\">gcc.gnu.org/onlinedocs/gcc/Labels-as-Values.html</a>.  You can use the label address as an input for an asm statement, or just cast to <code>uintptr_t</code> and avoid inline asm entirely. The advantage here is that the compiler knows there&#39;s a possible jump target there, and you can use <code>asm goto</code> so your jump can optimize safely."}, {"owner": {"reputation": 6093, "user_id": 2189500, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/109f747845a9ce762a1fff72eb8cf6f3?s=128&d=identicon&r=PG", "display_name": "David Wohlferd", "link": "https://stackoverflow.com/users/2189500/david-wohlferd"}, "edited": false, "score": 0, "creation_date": 1576706204, "post_id": 59390465, "comment_id": 104990097, "body": "<a href=\"https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html\" rel=\"nofollow noreferrer\">GCC</a> <i>does not parse the assembler instructions themselves and does not know what they mean or even whether they are valid assembler input.</i>  I believe other compilers (clang?) might do things differently, but for gcc, the efficiently and functionality of the asm block lives and dies by the constraints.  Obscure details like <code>&amp;</code> are part of the reason I suggest people <a href=\"https://gcc.gnu.org/wiki/DontUseInlineAsm\" rel=\"nofollow noreferrer\">don&#39;t use inline asm</a>. It&#39;s hard to get right, easy to get wrong, and daunting for others to maintain."}, {"owner": {"reputation": 659, "user_id": 3775615, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d2986c3db72e19a9ca9f88b86f23e42a?s=128&d=identicon&r=PG&f=1", "display_name": "TSG", "link": "https://stackoverflow.com/users/3775615/tsg"}, "reply_to_user": {"reputation": 6093, "user_id": 2189500, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/109f747845a9ce762a1fff72eb8cf6f3?s=128&d=identicon&r=PG", "display_name": "David Wohlferd", "link": "https://stackoverflow.com/users/2189500/david-wohlferd"}, "edited": false, "score": 2, "creation_date": 1578315638, "post_id": 59390465, "comment_id": 105388212, "body": "&quot;don&#39;t use inline asm. It&#39;s hard to get right, easy to get wrong, and daunting for others to maintain. \u2013 David Wohlferd Dec 18 &#39;19&quot;. Going on my wall. @DavidWohlferd"}], "answers": [{"comments": [{"owner": {"reputation": 9461, "user_id": 8422330, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c0f90445d03447c587d1e595d531f69?s=128&d=identicon&r=PG&f=1", "display_name": "prl", "link": "https://stackoverflow.com/users/8422330/prl"}, "edited": false, "score": 0, "creation_date": 1578334723, "post_id": 59395235, "comment_id": 105397372, "body": "There\u2019s a another problem with the constraints in this inline assembly code that this answer doesn\u2019t mention. <code>arg1</code> is listed only as a input in the constraints, but it is modified by the assembly code."}, {"owner": {"reputation": 659, "user_id": 3775615, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d2986c3db72e19a9ca9f88b86f23e42a?s=128&d=identicon&r=PG&f=1", "display_name": "TSG", "link": "https://stackoverflow.com/users/3775615/tsg"}, "reply_to_user": {"reputation": 9461, "user_id": 8422330, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c0f90445d03447c587d1e595d531f69?s=128&d=identicon&r=PG&f=1", "display_name": "prl", "link": "https://stackoverflow.com/users/8422330/prl"}, "edited": false, "score": 0, "creation_date": 1578424310, "post_id": 59395235, "comment_id": 105431505, "body": "@prl, you might be correct. It is, however, totally irrelevant in the rest of the code, so I&#39;ll let it lie and not further complicate this QA"}], "tags": [], "owner": {"reputation": 659, "user_id": 3775615, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d2986c3db72e19a9ca9f88b86f23e42a?s=128&d=identicon&r=PG&f=1", "display_name": "TSG", "link": "https://stackoverflow.com/users/3775615/tsg"}, "is_accepted": true, "score": 3, "last_activity_date": 1578315446, "last_edit_date": 1578315446, "creation_date": 1576682869, "answer_id": 59395235, "question_id": 59390465, "link": "https://stackoverflow.com/questions/59390465/conflicting-register-allocation-in-gcc-x86-64-asm-lifetime-ignored/59395235#59395235", "title": "Conflicting register allocation in GCC x86_64 asm. Lifetime ignored", "body": "<p>Firstly, thanks @Jester for the perfect comment which answers this question. To quote:</p>\n\n<blockquote>\n  <p>The <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html\" rel=\"nofollow noreferrer\">manual</a> says: \"Use the \u2018&amp;\u2019 constraint modifier (see Modifiers) on all output operands that must not overlap an input. Otherwise, GCC may allocate the output operand in the same register as an unrelated input operand, on the assumption that the assembler code consumes its inputs before producing outputs. This assumption may be false if the assembler code actually consists of more than one instruction. \"</p>\n</blockquote>\n\n<p>In short, my inline assembly does not agree with <code>gcc</code>s assumption that inputs be consumed before outputs are written to. In fact, <code>gcc</code> provides the appropriate, if somewhat obscure, constraint modifier (<code>&amp;</code>) to express this.</p>\n\n<p>The fix:</p>\n\n<pre><code>-       : [ptr] \"+m\" (ptr), [tmp] \"=r\" (tmp)\n+       : [ptr] \"+m\" (ptr), [tmp] \"=&amp;r\" (tmp)\n</code></pre>\n\n<p>The fixed assembly output:</p>\n\n<pre><code>00000000000005fa &lt;foo&gt;:\n 5fa:   55                      push   %rbp\n 5fb:   48 89 e5                mov    %rsp,%rbp\n 5fe:   48 89 7d f8             mov    %rdi,-0x8(%rbp)\n 602:   48 8b 45 f8             mov    -0x8(%rbp),%rax\n 606:   48 8d 15 0e 00 00 00    lea    0xe(%rip),%rdx        # 61b &lt;TARGET&gt;\n 60d:   48 c1 e0 04             shl    $0x4,%rax\n 611:   48 29 c2                sub    %rax,%rdx\n 614:   48 89 15 fd 09 20 00    mov    %rdx,0x2009fd(%rip)        # 201018 &lt;ptr&gt;\n\n000000000000061b &lt;TARGET&gt;:\n 61b:   90                      nop\n 61c:   5d                      pop    %rbp\n 61d:   c3                      retq   \n</code></pre>\n"}], "owner": {"reputation": 659, "user_id": 3775615, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d2986c3db72e19a9ca9f88b86f23e42a?s=128&d=identicon&r=PG&f=1", "display_name": "TSG", "link": "https://stackoverflow.com/users/3775615/tsg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 59395235, "answer_count": 1, "score": 0, "last_activity_date": 1578315446, "creation_date": 1576666395, "last_edit_date": 1576682691, "question_id": 59390465, "link": "https://stackoverflow.com/questions/59390465/conflicting-register-allocation-in-gcc-x86-64-asm-lifetime-ignored", "title": "Conflicting register allocation in GCC x86_64 asm. Lifetime ignored", "body": "<p>I have a function containing a small assembly block. The assembly for this function compiled by GCC is incorrect since it assigns the same register to two different variables. This is the function source:</p>\n\n<pre><code>void *ptr;\nuint64_t foo(uint64_t arg1) {\n  register uint64_t tmp;\n  asm (\"lea TARGET(%%rip), %[tmp];\"\n       \"shl  $4, %[arg1];\"\n       \"sub  %[arg1], %[tmp];\"\n       \"movq %[tmp], %[ptr];\"\n      : [ptr] \"+m\" (ptr), [tmp] \"=r\" (tmp)\n      : [arg1] \"r\" (arg1)\n      :);\n\n  asm (\"TARGET:;\");\n}\n</code></pre>\n\n<p>I use the constraint \"+m\" for the global <code>ptr</code> since I write to it, and it is should be in memory. The constraint for <code>tmp</code> is \"=r\" since its only being written to. The constaint for the input <code>arg1</code> is merely \"r\". This might be important.</p>\n\n<p>The SSA pseudo-code for the assembly block is:</p>\n\n<pre><code>tmp_0 = something\narg1_1 = arg1_0 &lt;&lt; 4\ntmp_1 = tmp_0 - arg_1\n*ptr_0 = tmp_1\n</code></pre>\n\n<p>The compiled assembly for this function at optimization <code>O0</code> is </p>\n\n<pre><code>00000000000005fa &lt;foo&gt;:\n 5fa:   55                      push   %rbp\n 5fb:   48 89 e5                mov    %rsp,%rbp\n 5fe:   48 89 7d f8             mov    %rdi,-0x8(%rbp)       # Storing arg1 to stack (optimization level O0)\n 602:   48 8b 45 f8             mov    -0x8(%rbp),%rax       # arg1_0 is assigned register rax\n 606:   48 8d 05 0e 00 00 00    lea    0xe(%rip),%rax        # 61b &lt;TARGET&gt;, tmp_0 is ALSO assigned rax\n 60d:   48 c1 e0 04             shl    $0x4,%rax             # arg1_0 is used, its lifetime ends\n 611:   48 29 c0                sub    %rax,%rax             # subtracting two vars both assigned the same register\n 614:   48 89 05 fd 09 20 00    mov    %rax,0x2009fd(%rip)   # 201018 &lt;ptr&gt;, store to global\n\n000000000000061b &lt;TARGET&gt;:\n 61b:   90                      nop\n 61c:   5d                      pop    %rbp\n 61d:   c3                      retq \n</code></pre>\n\n<p>Inspecting the assembly, we see that in address 0x602, the register <code>rax</code> is assigned to the SSA register <code>arg1_0</code> whose lifetime is till the instruction 0x60d. Meanwhile, the instruction at address 0x606 ALSO assigns the register <code>rax</code> to the SSA register <code>tmp_0</code>. It seems that a physical register was assigned to another SSA register during its lifetime. </p>\n\n<p>System information:</p>\n\n<ul>\n<li>x86_64 CPU</li>\n<li>gcc version 7.4.0</li>\n<li>Ubuntu 18.04.3</li>\n</ul>\n\n<p>My questions:</p>\n\n<ul>\n<li>Why does GCC create such an assembly output?</li>\n<li>Are my constraints to the assembly inputs and outputs correct? If not, why?</li>\n<li>Is this a GCC bug?</li>\n</ul>\n"}, {"tags": ["c", "arrays", "char"], "comments": [{"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 2, "creation_date": 1576666281, "post_id": 59390376, "comment_id": 104970921, "body": "First loop <code>s1[i-1]</code> invokes <a href=\"https://stackoverflow.com/a/4105123/3436922\">UB</a>"}, {"owner": {"reputation": 172529, "user_id": 140750, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c7af12cad08c95bc206a9636d164224?s=128&d=identicon&r=PG", "display_name": "William Pursell", "link": "https://stackoverflow.com/users/140750/william-pursell"}, "edited": false, "score": 0, "creation_date": 1576666360, "post_id": 59390376, "comment_id": 104970955, "body": "This is horribly non-idiomatic.  Using indices for this sort of thing instead of incrementing <code>s1</code> and <code>s2</code> make the code difficult to read."}, {"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 1, "creation_date": 1576666408, "post_id": 59390376, "comment_id": 104970977, "body": "When <code>i</code> is zero, the loop potentially accesses <code>s1[-1]</code>.   That causes undefined behaviour if <code>s1</code>, as passed, is the first element of an array.     In any event, for anyone to help you further, you&#39;ll need to show a representative example of how you CALL the function.    Read up on how to provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 172529, "user_id": 140750, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c7af12cad08c95bc206a9636d164224?s=128&d=identicon&r=PG", "display_name": "William Pursell", "link": "https://stackoverflow.com/users/140750/william-pursell"}, "edited": false, "score": 1, "creation_date": 1576666434, "post_id": 59390376, "comment_id": 104970995, "body": "Why are you looking at <code>s2[i+1]</code> before you&#39;ve assigned it?"}, {"owner": {"reputation": 301, "user_id": 4287117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec64f958fb4cc3f79c4b7677670d0811?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/4287117/siddharth"}, "edited": false, "score": 1, "creation_date": 1576666659, "post_id": 59390376, "comment_id": 104971104, "body": "from a-z if you want z to be printed, you will have to have <code>for (k = s1[i-1]+1; k &lt; s1[i+1]; ++j, ++k)</code> to <code>for (k = s1[i-1]+1; k &lt;= s1[i+1]; ++j, ++k)</code> ... notice the equal to sign in the termination condition... Also, please do a memset on the 2nd array if you are not going to put a &#39;\\0&#39; explicitly... BTW, the program worked for me, but there are better ways to write code..."}, {"owner": {"reputation": 172529, "user_id": 140750, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4c7af12cad08c95bc206a9636d164224?s=128&d=identicon&r=PG", "display_name": "William Pursell", "link": "https://stackoverflow.com/users/140750/william-pursell"}, "edited": false, "score": 0, "creation_date": 1576666676, "post_id": 59390376, "comment_id": 104971113, "body": "And why is one assignment to <code>s2[j]</code> but the other is to <code>s2[i]</code>?  As I commented above, using indices like this is making the logic overly convoluted.  Increment the pointers."}, {"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 0, "creation_date": 1576666982, "post_id": 59390376, "comment_id": 104971263, "body": "Hint: if the format is fixted (lower case letter and -) after a check of the format you can simply increment first letter up to the last: char are numbers at the end...<code>void expand (char *text_to_expand, char *expanded_text) {     int i=0;          if (text_to_expand[1] == &#39;-&#39;)     {         uint8_t nData = tolower(text_to_expand[2])-tolower(text_to_expand[0])+1;                          for (i=0; i&lt;nData; i++)         expanded_text[i] = text_to_expand[0]+i;     }          expanded_text[i]= &#39;\\0&#39;; }</code>"}], "answers": [{"tags": [], "owner": {"reputation": 301, "user_id": 4287117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec64f958fb4cc3f79c4b7677670d0811?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/4287117/siddharth"}, "is_accepted": false, "score": 0, "last_activity_date": 1576668172, "creation_date": 1576668172, "answer_id": 59390963, "question_id": 59390376, "link": "https://stackoverflow.com/questions/59390376/chars-are-not-getting-copied-properly/59390963#59390963", "title": "chars are not getting copied properly", "body": "<p>Why so many complications?\nYour code has some problems, nevertheless, it produces a meaningful output for me than what you are getting.</p>\n\n<pre><code>$ ./main.out\nabcdefghijklmnopqrstuvwxyz\n</code></pre>\n\n<p>Just that, you need to modify the termination condition in the inner loop to include the last character.</p>\n\n<p>Let me help you with a readable solution. I have tried to derive it out of your code's gist only, as there's nothing horribly wrong there. There are still much better ways to write code than below, but for quickness' sake... You can put your own validations.</p>\n\n<pre><code>void expand (char s1[], char s2[])\n{\n    int cnt = 0;\n    for (int i = 0; i &lt; s1[i] != '\\0'; ++i)\n    {\n        switch (s1[i])\n        {\n            case '-':\n                for (char k = s1[i-1]+1; k &lt; s1[i+1]; ++k)\n                    s2[cnt++] = k;\n                continue;\n            break;\n            default:\n                s2[cnt++] = s1[i];\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "is_accepted": false, "score": 0, "last_activity_date": 1576826612, "last_edit_date": 1576826612, "creation_date": 1576820626, "answer_id": 59420375, "question_id": 59390376, "link": "https://stackoverflow.com/questions/59390376/chars-are-not-getting-copied-properly/59420375#59420375", "title": "chars are not getting copied properly", "body": "<p>In function, you are using the next snippet of code</p>\n\n<pre><code>for (i = 0, j = 0; s1[i] != '\\0'; i++, j++) {\n        if (s1[i] == '-' &amp;&amp; s1[i-1] != ' ' &amp;&amp; s1[i+1] != ' ') {\n</code></pre>\n\n<p>If you are going to do something with <code>s1[i-1]</code>, then <code>i</code> cannot go from <code>0</code>, or you'll be checking <code>s1[-1]</code> in first loop iteration, which is out of array bounds.  This is an error, that produces Undefined Behaviour.  An alternative would be to begin at <code>i = 1</code>, or to check if <code>strcmp(s1 + i, \" - \") == 0</code>, which never checks before <code>i</code> or never goes after a <code>\\0</code>.</p>\n\n<pre><code>for (i = 0, j = 0; s1[i] != '\\0'; i++, j++) {\n        if (strcmp(s1 + i, \" - \") == 0) {\n</code></pre>\n\n<p>(but it is possible that this is not what you are looking for, while checking that the character at <code>i</code> is <code>-</code> <strong>and</strong> the character at <code>i-1</code> is a space, <strong>and</strong> the character at <code>i+1</code> is another space is somehow equivalent as checking if the character sequence at <code>i</code> ---well, not at <code>i-1</code>--- is the sequence <code>-</code>)</p>\n\n<p>The problem in your code is that you need a buffer to copy the strings... as when you say something like: <code>a-z</code>, then that spans a string longer than the original <code>a-z</code> sequence.  First of all, you must recognize the subsequence of two chars (which can or cannot be the <code>-</code> char) and a <code>-</code> in the middle.  This is something you can do with this state machine:</p>\n\n<pre><code>/* expand.c -- expands ranges in the form a-b\n * Date: Fri Dec 20 08:02:30 EET 2019\n */\n\n#include &lt;stdio.h&gt;\n\n#define ERR_ENOSPACE      (-1)\n#define ERR_ERANGE        (-2)\n\nssize_t expand(\n        char *source,           /* the source string */\n        char *target,           /* the target string */\n        size_t target_length)   /* the target length */\n{\n    int     ch,         /* the character to copy */\n            first_char, /* first char in range */\n            last_char;  /* last char in range */\n    size_t  len = 0;    /* the length of the complete range string */\n    ssize_t result = 0; /* the length returned */\n\n    while((ch = *source++) != 0) {  /* s is the input string */\n        switch (len) { /* length of substring (or machine state). */\n        case 0:\n                first_char = ch; /* annotate first char */\n                len = 1; /* state is now 1 */\n                break;\n\n        case 1: switch (ch) {\n            case '-': /* valid range go to state 2 */\n                len = 2;\n                break;\n            default: /* not a valid range, store a new first char\n                        and remain in this state.  And copy the last\n                        char to the output string. */\n                if (target_length &lt; 3) {\n                    /* not enough space (3 is needed for first_char,\n                     * this char and the final \\0 char) */\n                    return ERR_ENOSPACE;\n                }\n                *target++ = first_char; target_length--;\n                first_char = ch; /* len = 1; */\n                result++;\n            } break;\n\n        case 2:\n            last_char = ch; /* we completed a range */\n            if (first_char &gt; last_char)\n                return ERR_ERANGE;\n            ssize_t n = last_char - first_char + 1; /* number of output chars */\n            if (n + 1 &gt; target_length) {\n                /* we need space for n characters, * plus a '\\0' char */\n                return ERR_ENOSPACE;\n            }\n            /* copy the string */ \n            while (first_char &lt;= last_char)\n                *target++ = first_char++;\n            target_length -= n; \n            result += n;\n            len = 0; /* state comes back to 0 */\n            break;\n        } /* switch (l) */ \n    } /* while */\n\n    /* check state on end. */\n    switch (len) { /* depending on length we need to add a partial\n                      built sequence */\n    case 0: break; /* nothing to append */\n    case 1: /* we have a spare first_char, add it */\n            if (target_length &lt; 2)\n                return ERR_ENOSPACE;\n            *target++ = first_char; target_length--;\n            result++;\n            break;\n    case 2: if (target_length &lt; 3)\n                return ERR_ENOSPACE;\n            *target++ = first_char; *target++ = '-';\n            target_length -= 2; result += 2;\n            break;\n    }\n    /* now fill the final \\0 */\n    if (target_length &lt; 1) {\n        return ERR_ENOSPACE;\n    }\n    *target = '\\0';\n    return result;\n} /* expand */\n\nint main()\n{\n    char line[1024];\n    char outbuf[8192];\n    while (fgets(line, sizeof line, stdin)) {\n        ssize_t n = expand(line, outbuf, sizeof outbuf);\n#define CASE(err) case err: fprintf(stderr, \"ERROR: \" #err \"\\n\"); break;\n        switch(n) {\n        CASE(ERR_ENOSPACE)\n        CASE(ERR_ERANGE)\n        default: printf(\"OUTPUT: %s\\n\", outbuf); break;\n        } /* switch */\n    } /* while */\n} /* main */\n</code></pre>\n\n<p>The sample code is a full sample (with a <code>main()</code> routine) you can compile and test.</p>\n"}, {"tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": false, "score": 0, "last_activity_date": 1576826970, "creation_date": 1576826970, "answer_id": 59421394, "question_id": 59390376, "link": "https://stackoverflow.com/questions/59390376/chars-are-not-getting-copied-properly/59421394#59421394", "title": "chars are not getting copied properly", "body": "<p>To add a bit of flexibility in handling your <code>s1</code> string so it will accept <code>\"a-z\"</code>, <code>\"az\"</code> or <code>\"a #%^#%&amp;       z\"</code>, assuming the string starts with the first character in the range, you can save the first character and then iterate over <code>s1</code> looking for the next <em>alpha</em> character as the end character for the expansion. You can use the <code>isalpha()</code> macro provided in <code>ctype.h</code>. </p>\n\n<p>You also need to handle the cases where no ending character is found, or the ending character is less than the beginning from an ASCII value standpoint.</p>\n\n<p>Note this only works for ASCII character sets. Others character sets do not guarantee sequential alpha-characters <code>\"A-Z\"</code> or <code>\"a-z\"</code>.</p>\n\n<p>You can do something similar to the following:</p>\n\n<pre><code>#include &lt;ctype.h&gt;\n...\nvoid expand (const char *s1, char *s2)\n{\n    int c = *s1;            /* assign 1st char in s1 to c */\n\n    if (!isalpha(*s1++)) {  /* validate 1st char is alpha character */\n        fputs (\"error: invalid format s1\\n\", stderr);\n        return;\n    }\n\n    *s2++ = c;              /* assign c to 1st char in s2 */\n    *s2 = 0;                /* nul-terminate in case end char in s1 not found */\n\n    while (*s1 &amp;&amp; !isalpha(*s1))    /* loop s1 looking for next alpha char */\n        s1++;\n\n    if (!*s1) { /* if 2nd alpha char not found, handle error */\n        fputs (\"error: invalid format s1\\n\", stderr);\n        return;\n    }\n\n    for (; c &lt;= *s1; c++)   /* loop until c == end char in s1 */\n        *s2++ = c;          /* assign c to s2, increment pointer */\n\n    *s2 = 0;                /* nul-terminate s2 */\n}\n</code></pre>\n\n<p>(<strong>note:</strong> the initial <em>nul-termination</em> of <code>s2</code> after the first character covers both cases where (1) no ending alpha-character is found or (2) the end character has an ASCII value less than the first.  Consider changing the order of the <code>s1</code> and <code>s2</code> parameter to make them consistent with <code>strcpy</code>, etc..)</p>\n\n<p>If you like you can iterate to find the first alpha character in <code>s1</code> to handle leading non-alpha characters -- that is left to you.</p>\n\n<p>Look things over and let me know if you have further questions.</p>\n"}], "owner": {"reputation": 11, "user_id": 11570090, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-shSnAfElalY/AAAAAAAAAAI/AAAAAAAAABk/_jvNRny8GPI/photo.jpg?sz=128", "display_name": "Iyad", "link": "https://stackoverflow.com/users/11570090/iyad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1576826970, "creation_date": 1576666096, "last_edit_date": 1576666772, "question_id": 59390376, "link": "https://stackoverflow.com/questions/59390376/chars-are-not-getting-copied-properly", "title": "chars are not getting copied properly", "body": "<p>This function is supposed to expand expressions like <code>\"a-z\"</code> in <code>s1</code> to <code>\"abcd....xyz\"</code> in <code>s2</code>,\nbut for some reasons it does not work properly, every time i print <code>s2</code> it stops at the second char that is supposed to be expanded.\n<br>\nFor example, if <code>s1=\"a-z\"</code>, printing <code>s2</code> gives me <code>\"ab\"</code>.\n<br>\nWhy?</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>void expand(char s1[], char s2[]) {\n    int i, j, k;\n    for (i = 0, j = 0; s1[i] != '\\0'; i++, j++) {\n        if (s1[i] == '-' &amp;&amp; s1[i-1] != ' ' &amp;&amp; s1[i+1] != ' ') {\n            for (k = s1[i-1]+1; k &lt; s1[i+1]; ++j, ++k)\n                s2[j] = k;\n        } else {\n            s2[j] = s1[i];\n        }\n    }\n } \n</code></pre>\n\n<p>The function is called this way:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>int caller (void) {\n  char des[30];\n  expand(\"a-z\", des);\n  printf(\"%s\\n\", des);\n}\n</code></pre>\n"}, {"tags": ["c", "security", "gdb", "buffer-overflow"], "comments": [{"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1576664006, "post_id": 59389649, "comment_id": 104969715, "body": "It is different, because one is the address of some stack variable <code>stackp</code> and the other one is the stack pointer, as it was somewhere in the middle of the function <code>get_sp()</code>. These can hardly be the same, why do you expect them to be equal?"}, {"owner": {"reputation": 3, "user_id": 10124406, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-2Q-MLZbtO_w/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qRYTx7rPH_C3qUm4GrvkHigeaGig/mo/photo.jpg?sz=128", "display_name": "Alessandro Savona", "link": "https://stackoverflow.com/users/10124406/alessandro-savona"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1576664372, "post_id": 59389649, "comment_id": 104969919, "body": "yeah, i was thinking they&#39;d be the same!! thanks for the answer.. so, now, how can i calculate the &quot;evil size&quot; (the distance between the top chunk pointer in the heap and the $eip) ?"}], "owner": {"reputation": 3, "user_id": 10124406, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-2Q-MLZbtO_w/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qRYTx7rPH_C3qUm4GrvkHigeaGig/mo/photo.jpg?sz=128", "display_name": "Alessandro Savona", "link": "https://stackoverflow.com/users/10124406/alessandro-savona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576663712, "creation_date": 1576663712, "question_id": 59389649, "link": "https://stackoverflow.com/questions/59389649/how-can-i-obtain-a-pointer-to-esp-or-eip-in-order-to-exploit-with-house-of-for", "title": "how can i obtain a pointer to $esp or $eip in order to exploit with house of force attack?", "body": "<p>the probelm is that i want to obtain a pointer to the return addres of the main function in order to calculate the distance between my heap top chunk and the $eip store in the stack (for the house of force attack) . then i will override that $eip with the address of the \"win function\".</p>\n\n<p>i searched the $eip with gdb and that is the result on my machine :</p>\n\n<pre><code>info frame  --&gt; saved eip = 0xb7e1d286\n                saved registers:  eip at 0xbffff12c\n\nprint $esp --&gt;  $1 = (void * ) 0xbffff0d0\n</code></pre>\n\n<p>ok now i will show the code of the code to be exploited  where i tried to obtian that pointer to esp:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;malloc.h&gt;\n#define offset 18\nvoid win()\n{\n  printf(\"Congratulations, you win!!! You successfully changed the code flow\\n\");\n}\n\nunsigned long get_sp(void)\n{\n    /* This function (suggested in alephOne's paper) prints the\n       stack pointer using assembly code. */\n    __asm__(\"movl %esp,%eax\");\n}\n\nint main(int argc, char *argv[])\n{\n   char *buf1, *buf2, *buf3 ;\n   int *c ;\n   int real_size ;\n\n   if(argc != 4) return 0;\n\n   printf(\"The goal of this attack is to execute the win function!!!\\n\") ;\n\n   buf1 = malloc(256) ;\n   strcpy(buf1, argv[1]) ;\n\n\n   void * return_address = get_sp() + offset;\n   void * stackp = get_sp();\n   printf(\"return_address value is %p at register %p\\n\", &amp;return_address,return_address);\n   printf(\"stack_pointer at address %p\\n and contain  %p \",(void  *)get_sp(),(void *)&amp;stackp);\n   real_size = malloc_usable_size(buf1) ;\n   intptr_t *ptr_top = (intptr_t *) ((char *)buf1 + real_size - sizeof(long)) ;\n   printf(\"Top chunck is: %p\\n\", ptr_top) ;\n\n   //unsigned long evilsize = (unsigned long) return_address - sizeof(long)*4 - (unsigned long)ptr_top;\n   //printf(\"evilsize is : %lu\",evilsize);\n   buf2 = malloc(strtoul(argv[2], NULL, 16)) ;\n   buf3 = malloc(256) ;\n   strcpy(buf3, argv[3]) ;\n\n   //free(buf3) ;\n   //free(buf2) ;\n   //free(buf1) ;\n\n   return 0;\n\n\n}\n</code></pre>\n\n<p>the $esp printed is different with the one shown by gdb :</p>\n\n<pre><code>stack_pointer at address 0xbffff268 and contains 0xbffff274\n</code></pre>\n\n<p>why is it different? how can obtain it? thank you very much</p>\n"}, {"tags": ["c", "stack", "virtual-machine", "bytecode", "byte-code-enhancement"], "comments": [{"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 2, "creation_date": 1576663547, "post_id": 59389532, "comment_id": 104969452, "body": "Less size requirements, better caching, easier to parse (no redundancy)... to be continued."}, {"owner": {"reputation": 239210, "user_id": 2711488, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FhkI9.jpg?s=128&g=1", "display_name": "Holger", "link": "https://stackoverflow.com/users/2711488/holger"}, "edited": false, "score": 1, "creation_date": 1576749793, "post_id": 59389532, "comment_id": 105002406, "body": "The size of the instructions heavily affects the performance of the first time execution as it is dominated by loading the code from the main memory while the interpreter loop will be in the instruction cache soon. This is relevant for short running programs or instruction sequences executed a single time only, a domain of interpreted languages, but also for mixed mode engines, like a JVM, which starts with interpreting the bytecode and compiles frequently executed code, so it has first time execution dominated interpretation and input format agnostic compiled code execution."}], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 12553512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7abf64e443d7062089cbbfbd3c0e2b21?s=128&d=identicon&r=PG&f=1", "display_name": "elafalw", "link": "https://stackoverflow.com/users/12553512/elafalw"}, "is_accepted": true, "score": 1, "last_activity_date": 1576666206, "creation_date": 1576666206, "answer_id": 59390409, "question_id": 59389532, "link": "https://stackoverflow.com/questions/59389532/benefits-of-compact-bytecode-stack-machine-vm/59390409#59390409", "title": "Benefits of &quot;compact&quot; bytecode - stack-machine VM", "body": "<p>Benefits I can think of:</p>\n\n<ul>\n<li>Less memory usage</li>\n<li>Less cache misses</li>\n<li>Less actual size (in case you want to store/deploy the bytecode)</li>\n</ul>\n"}], "owner": {"reputation": 21415, "user_id": 1270812, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/LmoZ6.jpg?s=128&g=1", "display_name": "Dr.Kameleon", "link": "https://stackoverflow.com/users/1270812/dr-kameleon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 2, "accepted_answer_id": 59390409, "answer_count": 1, "score": 2, "last_activity_date": 1576666206, "creation_date": 1576663308, "question_id": 59389532, "link": "https://stackoverflow.com/questions/59389532/benefits-of-compact-bytecode-stack-machine-vm", "title": "Benefits of &quot;compact&quot; bytecode - stack-machine VM", "body": "<p>First of all, let me make it clear that I'm currently writing a bytecode interpreter.</p>\n\n<p>I've been reading everywhere about the bytecode having to be \"compact\". However, I don't really understand what this is supposed to mean, or what the advantages would be.</p>\n\n<p>Currently, for example, my \"bytecode\" is an array of tuples, the first element being a byte - the opcode itself (8 bits) and the second one a uint64 (what one would call an <code>unsigned long long</code>) - the optional parameter for the operation (64 bits).</p>\n\n<p>Tha makes each \"instruction\" 72 bits. (Admittedly quite innecessary, since many of them don't take any argument, but I thought it was easier - and more performant? - this way since I don't have to check every time if there is a parameter, and just go through the list of instructions).</p>\n\n<p><strong>So, my questions:</strong></p>\n\n<ul>\n<li>what are the benefits of a more compact code? (what would I achieve if, for example, each instruction was 32 bits instead of 72?)</li>\n<li>what could I do to make it better? (how do I handle \"optional\" arguments in an efficient way? that is: variable-sized instructions)</li>\n</ul>\n"}, {"tags": ["c", "debugging", "gcc"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1576660595, "post_id": 59388740, "comment_id": 104968012, "body": "What version of GCC? And can you try to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> which replicates the behavior and show it to us?"}], "answers": [{"comments": [{"owner": {"reputation": 1033, "user_id": 5778803, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b5CcU.jpg?s=128&g=1", "display_name": "Eliyahu Machluf", "link": "https://stackoverflow.com/users/5778803/eliyahu-machluf"}, "edited": false, "score": 1, "creation_date": 1576665976, "post_id": 59388902, "comment_id": 104970762, "body": "Please specify on which gcc version did you run the loop code. I tried it with gcc 4.4.6, and I did not get a warning using -O2. I did get a warning when I used -O3: warning: array subscript is above array bounds"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 1033, "user_id": 5778803, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b5CcU.jpg?s=128&g=1", "display_name": "Eliyahu Machluf", "link": "https://stackoverflow.com/users/5778803/eliyahu-machluf"}, "edited": false, "score": 1, "creation_date": 1576666538, "post_id": 59388902, "comment_id": 104971041, "body": "@EliyahuMachluf I added this information to the answer"}], "tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": true, "score": 8, "last_activity_date": 1576666523, "last_edit_date": 1576666523, "creation_date": 1576661006, "answer_id": 59388902, "question_id": 59388740, "link": "https://stackoverflow.com/questions/59388740/gcc-shows-different-warnings-depending-on-optimisation-level/59388902#59388902", "title": "gcc shows different warnings depending on optimisation level", "body": "<p>Some optimization levels of gcc analyze the code a bit more deeply than others, which can also lead to the detection of errors. One example is loop optimization, that is performed from optimization level 2 on.</p>\n\n<p>Consider this code:</p>\n\n<pre><code>void func (void) {\n    char buf[9];\n\n    for (i = 0; i &lt; 10; i++)\n        buf[i] = i;\n}\n</code></pre>\n\n<p>If you compile it with O0 or O1, no loop optimization is performed. But on level O2 and upwards, the compiler detects, that the last loop iteration invokes undefined behaviour:</p>\n\n<pre><code>main.c:5:10: warning: iteration 9 invokes undefined behavior [-Waggressive-loop-optimizations]\n   buf[i] = i;\n   ~~~~~~~^~~\nmain.c:4:2: note: within this loop\n  for (int i = 0; i &lt; 10; i++)\n  ^~~\n</code></pre>\n\n<p>So yes, heavy optimizations can help detecting bugs because gcc puts more effort into analyzing the code for optimization purposes.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>For this specific warning, actually the <em>Value Range Propagation</em> optimization (-ftree-vrp) is responsible.</p>\n\n<p>From the gcc documentation:</p>\n\n<blockquote>\n  <p>This is similar to the constant propagation pass, but instead of values, ranges of values are propagated. This allows the optimizers to remove unnecessary range checks like array bound checks and null pointer checks. This is enabled by default at -O2 and higher. Null pointer check elimination is only done if -fdelete-null-pointer-checks is enabled.</p>\n</blockquote>\n\n<p><strong>Edit 2:</strong></p>\n\n<p>The observations may differ with the gcc version; in this case, gcc version <em>8.3.0</em> was used.</p>\n"}], "owner": {"reputation": 2077, "user_id": 1071669, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/701fc95be1eaf05adaccd367ba33ec9b?s=128&d=identicon&r=PG", "display_name": "dargaud", "link": "https://stackoverflow.com/users/1071669/dargaud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 59388902, "answer_count": 1, "score": 5, "last_activity_date": 1576780328, "creation_date": 1576660434, "last_edit_date": 1576780328, "question_id": 59388740, "link": "https://stackoverflow.com/questions/59388740/gcc-shows-different-warnings-depending-on-optimisation-level", "title": "gcc shows different warnings depending on optimisation level", "body": "<p>I compiled a C program with <code>-O0 -Wall</code> and then <code>-O1</code>, <code>-O2</code>, <code>-O3</code> and I received different warning messages, some of them actually important enough that they showed actual bugs (for instance a function returning a string that was local instead of static in <code>-O1</code> IIRC).</p>\n\n<p>Why is that ? Can I get <em>more</em> warnings ?</p>\n"}, {"tags": ["c", "recursion"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1576657758, "post_id": 59387974, "comment_id": 104966739, "body": "I recommend you learn how to use a debugger to step through your code statement by statement, and step into function calls. That will allow you to see exactly what happens with e.g <code>power(2, 8)</code> and <code>power(2, 9)</code>."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1576657786, "post_id": 59387974, "comment_id": 104966751, "body": "You can put a <code>printf</code> at the top of the function, and print <code>a</code> and <code>n</code> to see why 9 takes one extra call."}, {"owner": {"reputation": 322, "user_id": 939428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f787a9aa9ed21842fc61e0de63c4df7?s=128&d=identicon&r=PG", "display_name": "Petros", "link": "https://stackoverflow.com/users/939428/petros"}, "edited": false, "score": 1, "creation_date": 1576657822, "post_id": 59387974, "comment_id": 104966765, "body": "Check out this article <a href=\"https://www.geeksforgeeks.org/write-a-c-program-to-calculate-powxn/\" rel=\"nofollow noreferrer\">geeksforgeeks.org/write-a-c-program-to-calculate-powxn</a> . It explains exactly how you can achieve O(logn) by making it a recursion problem."}], "answers": [{"tags": [], "owner": {"reputation": 15165, "user_id": 1116364, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b67dfca0caba03083330d39a304b1766?s=128&d=identicon&r=PG", "display_name": "Daniel Jour", "link": "https://stackoverflow.com/users/1116364/daniel-jour"}, "is_accepted": false, "score": 0, "last_activity_date": 1576658299, "creation_date": 1576658299, "answer_id": 59388249, "question_id": 59387974, "link": "https://stackoverflow.com/questions/59387974/how-is-it-possible-to-achive-olog-n-power-function-an-by-only-using-recursion/59388249#59388249", "title": "How is it possible to achive O(log n) power function a^n by only using recursion?", "body": "<p>The power function has two base cases: n = 0 and n = 1.</p>\n\n<p>The power function has two recursive calls. Only one of them is made in any given call.</p>\n\n<p>Let's first consider the case when n is even: In that case, the recursive call is made with n / 2.</p>\n\n<p>If all calls would use this case, then you half n in each call down until you reach 1. This is indeed <code>log(n)</code> calls (plus 1 for the base case).</p>\n\n<p>The other case, when n is odd, reduces n only by one. If all calls would end up using this recursive call then the function would be called n times; clearly not logarithmic but linear thus.</p>\n\n<p><strong>But</strong> what happens to an odd number when you subtract one from it? It becomes an even number. Thus the feared linear behaviour mentioned above cannot occur.</p>\n\n<p>Worst case is: n is odd, thus use second recursive call. Now n is even, thus first recursive call. Now n is odd, this use second, ... and so on down until n is one. In that case every second call reduces n to n / 2. Therefore you need <code>2 * log(n)</code> calls then (plus one for the base case).</p>\n\n<p>So yes, this is in <code>O(log(n))</code>. This algorithm is often called <a href=\"https://en.wikipedia.org/wiki/Exponentiation_by_squaring\" rel=\"nofollow noreferrer\">binary exponentiation</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "is_accepted": true, "score": 3, "last_activity_date": 1576662274, "creation_date": 1576662274, "answer_id": 59389262, "question_id": 59387974, "link": "https://stackoverflow.com/questions/59387974/how-is-it-possible-to-achive-olog-n-power-function-an-by-only-using-recursion/59389262#59389262", "title": "How is it possible to achive O(log n) power function a^n by only using recursion?", "body": "<p>Your implementation is O(logN), but it could be made slightly more efficient.</p>\n\n<p>Note that hereafter, a log is a log base 2. </p>\n\n<p>You have log(n) calls of <code>power(a*a,n/2)</code>, and a call to <code>power(a, n-1)</code> for every bit set in <em>n</em>. </p>\n\n<p>The number of bits set in <em>n</em> is at most log(n) +1. </p>\n\n<p>Thus, the number of calls to <code>power</code> is at most log(n)+log(n)+1. For instance, when <em>n</em> = 15, the sequence of calls is </p>\n\n<pre><code>power(15), power(14), power(7), power(6), power(3), power(2), power(1)\n</code></pre>\n\n<p>log(n)+log(n)+1 = 3+3+1 = 7 </p>\n\n<p>Here is a more efficient implementation that has only log(n)+2 calls of <code>power</code>.</p>\n\n<pre><code>int power(int a, int n) {\n  if(n == 0) {\n    return 1;\n  }\n  if (n&amp;1 == 0) {\n    return power(a*a, n/2);\n  }else{\n    return a * power(a*a, n/2);\n  }\n}\n</code></pre>\n\n<p>In this case the sequence of calls when <em>n</em> = 15 is </p>\n\n<pre><code>power(15), power(7), power(3), power(1), power(0)\n</code></pre>\n\n<p>I removed the <code>if (n == 1)</code> condition because we can avoid this test that would be performed log(n) time by adding one call to <code>power</code>. </p>\n\n<p>We then have log(n)+2\u00a0calls to power which is better than 2log(n)+1. </p>\n"}, {"tags": [], "owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "is_accepted": false, "score": 0, "last_activity_date": 1576663895, "last_edit_date": 1576663895, "creation_date": 1576663108, "answer_id": 59389477, "question_id": 59387974, "link": "https://stackoverflow.com/questions/59387974/how-is-it-possible-to-achive-olog-n-power-function-an-by-only-using-recursion/59389477#59389477", "title": "How is it possible to achive O(log n) power function a^n by only using recursion?", "body": "<p>The reason why the algorithm remains &Omicron;(lg<em>N</em>) even with the extra calls for the odd number case is because the number of extra calls is bounded by a constant. In the worst case, <em>N/2</em> is odd at each iteration, but this would only double the number of extra calls (the constant is 2). That is, at worst, there will be 2lg<em>N</em> calls to complete the algorithm.</p>\n\n<hr>\n\n<p>To more easily observe that the algorithm is &Omicron;(lg<em>N</em>), you can rewrite the function to always reduce the power by half at each iteration, so that at worst case, there are only lg<em>N</em> calls. To leverage tail recursion, you can add a function parameter to accumulate the carried multiplier from the odd <em>N</em>.</p>\n\n<pre><code>int power_i (int a, unsigned N, int c) {\n    if (N == 0) return c;\n    return power_i(a*a, N/2, N%2 ? a*c : c);\n}\n\nint power (int a, unsigned N) {\n    return power_i(a, N, 1);\n}\n</code></pre>\n\n<p>The advantage of tail recursion is that the optimized code will be converted into a simple loop by most modern C compilers.</p>\n\n<p><a href=\"https://tio.run/##bY5BCsIwEEX3OcXfCGlJqnZpW7xBXHgAiTHWbFJJUhTUs8ekVARxYIb5M8z7c5T@EqOSAW1b4YleKfB7SvCdB0/NHnwAJ8YGXIebdgcDmoVkGK03vdUnCIY8UgUeBCnMGVSg67Aq4HQYnYVqps2sZhKVZcKIZZ3KosYWslTYJE5DXuRr@cfw4/TLY/mX9XRfxfgG\" rel=\"nofollow noreferrer\" title=\"Bash \u2013 Try It Online\">Try it online!</a></p>\n"}], "owner": {"reputation": 448, "user_id": 9414424, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "user9414424", "link": "https://stackoverflow.com/users/9414424/user9414424"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 736, "favorite_count": 0, "accepted_answer_id": 59389262, "answer_count": 3, "score": 3, "last_activity_date": 1576663895, "creation_date": 1576657201, "question_id": 59387974, "link": "https://stackoverflow.com/questions/59387974/how-is-it-possible-to-achive-olog-n-power-function-an-by-only-using-recursion", "title": "How is it possible to achive O(log n) power function a^n by only using recursion?", "body": "<p>Below, the purpose of the code is to compute power of an integer.\nMy friend told me that the time complexity of this algorithm is O(log n).\nBut, in fact the number of function calls is not equal to logn.\nFor example, power(2, 9) calls power functions 5 times (including the calling power(2,9)), while power(2, 8) calls power function 4 times (including the calling power(2,8).\nNevertheless the number of bits needed for 8 and 9 are same, the numbers of function calls are different.</p>\n\n<p>Why does this happen? Is this really O(log n) algorithm?</p>\n\n<pre><code>#include &lt;stdio.h&gt;                                                                                    \nint power(int a, int n) {\n  if(n == 0) {\n    return 1;\n  }\n\n  if(n == 1) {\n    return a;\n  }\n  if (n%2 == 0) {\n    return power(a*a, n/2);\n  }else{\n    return a * power(a, n - 1);\n  }\n}\n\nint main() {\n  for (int i = 0; i &lt; 15; i++)\n    printf(\"pow(%d, %d) = %d\\n\", 2, i, power(2, i));\n\n  return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "swift", "callback", "wrapper"], "answers": [{"tags": [], "owner": {"reputation": 12781, "user_id": 271166, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76bc24262b75ff8cab315c6f745a8913?s=128&d=identicon&r=PG", "display_name": "Kalle", "link": "https://stackoverflow.com/users/271166/kalle"}, "is_accepted": false, "score": 0, "last_activity_date": 1576656868, "creation_date": 1576656868, "answer_id": 59387897, "question_id": 59387896, "link": "https://stackoverflow.com/questions/59387896/arbitrary-c-callback-wrappers-in-swift/59387897#59387897", "title": "Arbitrary C callback wrappers in Swift", "body": "<p>This is the solution I have:</p>\n\n<pre><code>class CUserInfoClass&lt;T&gt; {\n    let v: T\n    init(_ v: T) {\n        self.v = v\n    }\n    init(_ userInfo: UnsafeMutableRawPointer) {\n        self.v = CUserInfoCallback&lt;T&gt;(userInfo).v.v\n    }\n}\n\nclass CExpectation : CUserInfoClass&lt;XCTestExpectation&gt; {\n    func fulfill() {\n        self.v.fulfill()\n    }\n}\n\nclass CUserInfoCallback&lt;T&gt; {\n    let v: CUserInfoClass&lt;T&gt;\n    init(_ v: CUserInfoClass&lt;T&gt;) {\n        self.v = v\n    }\n    init(_ userInfo: UnsafeMutableRawPointer) {\n        self.v = Unmanaged&lt;CUserInfoClass&lt;T&gt;&gt;.fromOpaque(userInfo).takeUnretainedValue()\n    }\n    func wrap() -&gt; UnsafeMutableRawPointer {\n        return UnsafeMutableRawPointer(Unmanaged.passUnretained(self.v).toOpaque())\n    }\n}\n</code></pre>\n\n<p>I use this in the following manner:</p>\n\n<pre><code>    func testAsyncThingie() {\n        let exp = CUserInfoCallback(CUserInfoClass(expectation(description: \"Wait for async thingie\")))\n        DoAsyncThing(exp.wrap()) {\n            (ui, err) in\n            XCTAssertNil(err)\n            CExpectation(ui!).fulfill()\n        }\n        waitForExpectations(timeout: 10, handler: nil)\n    }\n</code></pre>\n\n<p>where <code>DoAsyncThing</code> is</p>\n\n<pre><code>void DoAsyncThing(void*, void (*)(void* userInfo, const char* error))\n</code></pre>\n"}], "owner": {"reputation": 12781, "user_id": 271166, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76bc24262b75ff8cab315c6f745a8913?s=128&d=identicon&r=PG", "display_name": "Kalle", "link": "https://stackoverflow.com/users/271166/kalle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576656868, "creation_date": 1576656868, "question_id": 59387896, "link": "https://stackoverflow.com/questions/59387896/arbitrary-c-callback-wrappers-in-swift", "title": "Arbitrary C callback wrappers in Swift", "body": "<p>I have a C library with a lot of callbacks in the form</p>\n\n<pre><code>void asynchronous_thing(..., void* userInfo, SOMECBTYPE cb)\n</code></pre>\n\n<p>I am writing unit tests for these in Swift/XCT, and am wondering what the best solution to pass vars into the closure that Xcode/Swift generates for me automatically (I am providing one answer but my Swift is sub-par, so chances are high there is a much more elegant way to do this).</p>\n"}, {"tags": ["c", "memory", "struct", "minesweeper"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1576655840, "post_id": 59387598, "comment_id": 104965951, "body": "I suggest you read about <a href=\"https://en.wikipedia.org/wiki/Flexible_array_member\" rel=\"nofollow noreferrer\"><i>flexible array member</i></a>. Then you don&#39;t need <code>cells</code> to be a pointer and you don&#39;t have to bother with pointer arithmetic or casting."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1576655908, "post_id": 59387598, "comment_id": 104965980, "body": "I also suggest you use <a href=\"https://en.cppreference.com/w/c/memory/calloc\" rel=\"nofollow noreferrer\"><code>calloc</code></a> as that will &quot;clear&quot; (set to zero) the memory for you."}], "answers": [{"tags": [], "owner": {"reputation": 15165, "user_id": 1116364, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b67dfca0caba03083330d39a304b1766?s=128&d=identicon&r=PG", "display_name": "Daniel Jour", "link": "https://stackoverflow.com/users/1116364/daniel-jour"}, "is_accepted": false, "score": 2, "last_activity_date": 1576655960, "creation_date": 1576655960, "answer_id": 59387695, "question_id": 59387598, "link": "https://stackoverflow.com/questions/59387598/memory-allocation-with-different-struct-types-at-once-valgrind-proof/59387695#59387695", "title": "Memory Allocation with different struct types at once? (Valgrind proof)", "body": "<pre><code>Minesweeper-&gt;cells = (cell *)game_memory + sizeof(board);\n</code></pre>\n\n<p>Type casts have a higher <a href=\"https://en.cppreference.com/w/c/language/operator_precedence\" rel=\"nofollow noreferrer\">precedence</a> than addition, thus you want a set of parentheses here:</p>\n\n<pre><code>Minesweeper-&gt;cells = (cell *)(game_memory + sizeof(board));\n</code></pre>\n\n<p>Otherwise that <code>+ sizeof(board)</code> advances the pointer by more than <code>sizeof(board)</code> bytes ... actually by <code>sizeof(board) * sizeof(cell)</code></p>\n\n<p>I'm also not sure but I think you also need to make sure that memory is properly aligned ....</p>\n"}, {"tags": [], "owner": {"reputation": 19, "user_id": 12556980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6b0a79b7913507c85a6cdb887ab7faa?s=128&d=identicon&r=PG&f=1", "display_name": "h1ghrise", "link": "https://stackoverflow.com/users/12556980/h1ghrise"}, "is_accepted": false, "score": 0, "last_activity_date": 1576704129, "creation_date": 1576704129, "answer_id": 59400156, "question_id": 59387598, "link": "https://stackoverflow.com/questions/59387598/memory-allocation-with-different-struct-types-at-once-valgrind-proof/59400156#59400156", "title": "Memory Allocation with different struct types at once? (Valgrind proof)", "body": "<p>i found the answer by myself.\nI allocated the memory using <code>malloc</code>, but never was initializing it properly.\nA simple <code>memset</code> afterwards now gives me no errors in valgrind.</p>\n\n<p>Thanks all for your help and pointing me in the right direction.\nBet this was not the last post here ;) </p>\n"}], "owner": {"reputation": 19, "user_id": 12556980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6b0a79b7913507c85a6cdb887ab7faa?s=128&d=identicon&r=PG&f=1", "display_name": "h1ghrise", "link": "https://stackoverflow.com/users/12556980/h1ghrise"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1576741630, "creation_date": 1576655400, "last_edit_date": 1576741630, "question_id": 59387598, "link": "https://stackoverflow.com/questions/59387598/memory-allocation-with-different-struct-types-at-once-valgrind-proof", "title": "Memory Allocation with different struct types at once? (Valgrind proof)", "body": "<p>Hi Stack Overflow Community,\nI'm currently coding a minewsweeper game in C using structs.</p>\n\n<p>The structs i use look like this:</p>\n\n<pre><code>typedef struct cell_s {\n    bool isFlagged;\n    bool isMine;\n    bool isRevealed;\n    //struct coordinates_s coordinates;\n} cell;\n\ntypedef struct board_s {\n    uint8_t width;\n    uint8_t height;\n    struct cell_s *cells;\n} board;\n</code></pre>\n\n<p>to allocate memory, i use the following function:</p>\n\n<p><code>board *Minesweeper = initialize(10,10);</code></p>\n\n<p>which looks like this:</p>\n\n<pre><code>board *initialize(uint8_t height, uint8_t width){\n\n    printf(\"[*] Allocating memory\\n\");\n    uint8_t *game_memory = malloc(sizeof(board) + sizeof(cell) * width * height);\n    printf(\"[*] creating Game Instance\\n\");\n    board *Minesweeper = (board *)game_memory;\n\n    //Initing Board Parameters\n    printf(\"[*] setting parameters\\n\");\n    Minesweeper-&gt;cells = (cell *)game_memory + sizeof(board);\n    Minesweeper-&gt;width = width;\n    Minesweeper-&gt;height = height;\n    printf(\"[+] board width: %d\\n\",Minesweeper-&gt;width);\n    printf(\"[+] board height: %d\\n\",Minesweeper-&gt;height);\n    printf(\"[+] setting up cells\");\n    memset(Minesweeper-&gt;cells, 0, sizeof(cell) * width * height);\n\n    return Minesweeper;\n}\n</code></pre>\n\n<p>the program itself runs fine, but when checking with valgrind, it reports a lot of errors (mostly in the memset part of the cells) writing/reading in memory areas which are not allocated (will paste the valgrind output later).</p>\n\n<p>I cannot spot the mistake.\nCan somebody enlighten me, what i do wrong with allocation?</p>\n\n<p>Edit:\nThanks so much for your reponses. As I'm still pretty new to programming in C, this helped me a lot.\nI decided to rewrite the init function, and make it less complicated.\nAlso the valgrind errors have minimized now ;)</p>\n\n<p>function *initialize looks now as:</p>\n\n<pre><code>board *initialize(uint8_t width, uint8_t height, uint8_t mineCount){\n  printf(\"[*] Allocating memory\\n\");\n  board *Minesweeper = malloc(sizeof(board));   // now only allocating memory for the board itself.\n  printf(\"[*] setting parameters\\n\");\n  Minesweeper-&gt;cells = calloc(width*height,sizeof(cell)); //calloc for the cells (+init ?)\n  Minesweeper-&gt;width = width;\n  Minesweeper-&gt;height = height;\n  Minesweeper-&gt;mines = mineCount;\n  printf(\"[+] board width: %d\\n\",Minesweeper-&gt;width);\n  printf(\"[+] board height: %d\\n\",Minesweeper-&gt;height);\n  printf(\"[+] Mines: %d\\n\",Minesweeper-&gt;mines);\n  //placeMines(Minesweeper,mineCount);\n  //getNeighborMines(Minesweeper); \n  return Minesweeper;\n}\n</code></pre>\n\n<p>the valgrind output is now:</p>\n\n<pre><code>==14991== Conditional jump or move depends on uninitialised value(s)\n==14991==    at 0x109D52: DrawBoard (init.c:34)\n==14991==    by 0x10992F: GameLoop (gamelogic.c:86)\n==14991==    by 0x10A042: main (main.c:14)\n==14991==  Uninitialised value was created by a heap allocation\n==14991==    at 0x483877F: malloc (vg_replace_malloc.c:309)\n==14991==    by 0x109BF7: initialize (init.c:7)\n==14991==    by 0x10A01D: main (main.c:12)\n==14991== \n01  _ _ _ _ _ \n02  _ _ _ _ _ \n03  _ _ _ _ _ \n04  _ _ _ _ _ \n05  _ _ _ _ _ \nYour Move: exit\n[*] Memory free'd\n==14991== \n==14991== HEAP SUMMARY:\n==14991==     in use at exit: 0 bytes in 0 blocks\n==14991==   total heap usage: 4 allocs, 4 frees, 2,164 bytes allocated\n==14991== \n==14991== All heap blocks were freed -- no leaks are possible\n==14991== \n==14991== ERROR SUMMARY: 25 errors from 1 contexts (suppressed: 0 from 0)\n==14991== \n==14991== 25 errors in context 1 of 1:\n==14991== Conditional jump or move depends on uninitialised value(s)\n==14991==    at 0x109D52: DrawBoard (init.c:34)\n==14991==    by 0x10992F: GameLoop (gamelogic.c:86)\n==14991==    by 0x10A042: main (main.c:14)\n==14991==  Uninitialised value was created by a heap allocation\n==14991==    at 0x483877F: malloc (vg_replace_malloc.c:309)\n==14991==    by 0x109BF7: initialize (init.c:7)\n==14991==    by 0x10A01D: main (main.c:12)\n==14991== \n==14991== ERROR SUMMARY: 25 errors from 1 contexts (suppressed: 0 from 0)\n</code></pre>\n"}, {"tags": ["c", "loops", "file", "sorting", "struct"], "comments": [{"owner": {"reputation": 10428, "user_id": 3135317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e914266956f4052eef356be7850ea49?s=128&d=identicon&r=PG&f=1", "display_name": "FoggyDay", "link": "https://stackoverflow.com/users/3135317/foggyday"}, "edited": false, "score": 2, "creation_date": 1576655080, "post_id": 59387416, "comment_id": 104965645, "body": "It looks like the code is part of a quicksort routine.  This link might help explain what the function is intended to do: <a href=\"https://www.khanacademy.org/computing/computer-science/algorithms/quick-sort/a/linear-time-partitioning\" rel=\"nofollow noreferrer\">Linear-time partitioning</a>"}, {"owner": {"reputation": 15295, "user_id": 3436922, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y8KQX.jpg?s=128&g=1", "display_name": "LPs", "link": "https://stackoverflow.com/users/3436922/lps"}, "edited": false, "score": 1, "creation_date": 1576656079, "post_id": 59387416, "comment_id": 104966037, "body": "<a href=\"https://www.geeksforgeeks.org/quick-sort/\" rel=\"nofollow noreferrer\">THIS</a> can be helpful"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 2, "creation_date": 1576657254, "post_id": 59387416, "comment_id": 104966519, "body": "What does the book say next to the code?"}], "owner": {"reputation": 1, "user_id": 12285862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f8dcf22ce5f9d7881e1bd65e1693b8f?s=128&d=identicon&r=PG&f=1", "display_name": "jack", "link": "https://stackoverflow.com/users/12285862/jack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576658667, "creation_date": 1576654591, "last_edit_date": 1576658667, "question_id": 59387416, "link": "https://stackoverflow.com/questions/59387416/quck-sort-file-handling-in-c", "title": "quck sort file handling in c", "body": "<p>Hello guys I am new to c programming I got this code from a book and I trying to figure it out what does this code meant can anyone explain it? thanks </p>\n\n<pre class=\"lang-c prettyprint-override\"><code>    int partition (struct Data data[1000], int low, int high) {\n      int pivot = data[high].G3;\n      int i = (low - 1);\n\n      for (int j = low; j &lt;= high- 1; j++) {\n        if (data[j].G3 &gt; pivot) {\n            i++;\n            swap(&amp;data[i], &amp;data[j]);\n        }\n      }\n      swap(&amp;data[i + 1], &amp;data[high]);\n      return (i + 1);\n    }\n</code></pre>\n"}, {"tags": ["c++", "c", "deadlock"], "comments": [{"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 6, "creation_date": 1576654186, "post_id": 59387283, "comment_id": 104965320, "body": "A signal handler may only call a very specific set of functions. Scroll down here: <a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/functions/V2_chap02.html#tag_15_04_03\" rel=\"nofollow noreferrer\">pubs.opengroup.org/onlinepubs/9699919799/functions/&hellip;</a> <code>localtime()</code> is not within this set."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1576654294, "post_id": 59387283, "comment_id": 104965353, "body": "If you read e.g. <a href=\"http://man7.org/linux/man-pages/man7/signal-safety.7.html\" rel=\"nofollow noreferrer\">this signal-safety (Linux) manual page</a> it does not list <code>localtime</code> as a signal-safe function."}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 5551818, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-h1fV-zpnnKg/AAAAAAAAAAI/AAAAAAAAAC4/cXngmigAfxs/photo.jpg?sz=128", "display_name": "ram914", "link": "https://stackoverflow.com/users/5551818/ram914"}, "edited": false, "score": 0, "creation_date": 1576694860, "post_id": 59387386, "comment_id": 104985799, "body": "localtime is not   thread safe. so I tried with localtime_r() function. But still same issue persists. frommmm localtime_r documentation, it is stated that it is thread safe. what I am doing wrong?"}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1576696111, "post_id": 59387386, "comment_id": 104986301, "body": "You can&#39;t do this kind of thing from a signal handler. Have the signal handler dispatch a thread to do this kind of work. You have <code>localtime</code> in your call stack twice. You are calling <code>localtime</code> while calling <code>localtime</code>."}], "tags": [], "owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "is_accepted": false, "score": 2, "last_activity_date": 1576655624, "last_edit_date": 1576655624, "creation_date": 1576654499, "answer_id": 59387386, "question_id": 59387283, "link": "https://stackoverflow.com/questions/59387283/localtime-function-is-invoking-lll-lock-wait-private-which-is-making-the/59387386#59387386", "title": "localtime() function is invoking ___lll_lock_wait_private() which is making the thread to go deadlock", "body": "<p>The programs blocks inside a signal handler in <code>__tz_convert()</code> being called from <code>localtime()</code>. The signal handler interrupted <code>__tz_convert()</code> being called from <code>localtime()</code>.</p>\n\n<pre><code>#0  0x000000fff4c47b9c in __lll_lock_wait_private () from /lib64/libc.so.6\n#1  0x000000fff4bf0364 in __tz_convert () from /lib64/libc.so.6\n#2  0x000000fff4bee2c0 in localtime () from /lib64/libc.so.6\n...\n#11 &lt;signal handler called&gt;\n...\n#13 0x000000fff4bf02a8 in __tz_convert () from /lib64/libc.so.6\n#14 0x000000fff4bee2c0 in localtime () from /lib64/libc.so.6\n...\n#25 0x0000000010007538 in main ()\n</code></pre>\n\n<p><code>localtime()</code> seems to <strong>not</strong> be reintrant.</p>\n\n<p>A signal handler may only call a very specific set of functions. Scroll down here: <a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/functions/V2_chap02.html#tag_15_04_03\" rel=\"nofollow noreferrer\">https://pubs.opengroup.org/onlinepubs/9699919799/functions/V2_chap02.html#tag_15_04_03</a></p>\n\n<p><code>localtime()</code> is not within this set.</p>\n\n<p>Signal handler should be short and simple.</p>\n\n<p>You could set up a thread doing the formatting and logging which  for example via a pipe is being fed by the signal handler with all necessary information to format and log. The functions to do so <em>are</em> listed within the set linked above.</p>\n"}, {"comments": [{"owner": {"reputation": 141, "user_id": 5551818, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-h1fV-zpnnKg/AAAAAAAAAAI/AAAAAAAAAC4/cXngmigAfxs/photo.jpg?sz=128", "display_name": "ram914", "link": "https://stackoverflow.com/users/5551818/ram914"}, "edited": false, "score": 0, "creation_date": 1576734568, "post_id": 59398685, "comment_id": 104996352, "body": "Unfortunately, the process that is going to deadlock is a single thread process by design. It can not have another thread. The single thread is going to deadlock. currently I am trying to implement what localtime does, in a user-defined function to avoid using localtime. Do you have any suggestions"}, {"owner": {"reputation": 141, "user_id": 5551818, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-h1fV-zpnnKg/AAAAAAAAAAI/AAAAAAAAAC4/cXngmigAfxs/photo.jpg?sz=128", "display_name": "ram914", "link": "https://stackoverflow.com/users/5551818/ram914"}, "edited": false, "score": 0, "creation_date": 1576734776, "post_id": 59398685, "comment_id": 104996406, "body": "But there is a problem with above approach too, I need to know the timezone in a number format. Like for GMT+5:30 timezone, I need to have 5.5 as timezone. I don&#39;t know how to get this from system without hardcoding."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "reply_to_user": {"reputation": 141, "user_id": 5551818, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-h1fV-zpnnKg/AAAAAAAAAAI/AAAAAAAAAC4/cXngmigAfxs/photo.jpg?sz=128", "display_name": "ram914", "link": "https://stackoverflow.com/users/5551818/ram914"}, "edited": false, "score": 0, "creation_date": 1576736932, "post_id": 59398685, "comment_id": 104997003, "body": "@ram914 Then have the log logic just add raw information to a collection that some other code converts to the necessary format. Store the raw time and call <code>localtime</code> after the signal handler returns."}], "tags": [], "owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "is_accepted": false, "score": 2, "last_activity_date": 1576696378, "creation_date": 1576696378, "answer_id": 59398685, "question_id": 59387283, "link": "https://stackoverflow.com/questions/59387283/localtime-function-is-invoking-lll-lock-wait-private-which-is-making-the/59398685#59398685", "title": "localtime() function is invoking ___lll_lock_wait_private() which is making the thread to go deadlock", "body": "<pre><code>#4  0x000000fff516756c in LogClass::logBegin() () from /usr/sbin/sajet/sharedobj/liblibLite.so\n#16 0x000000fff516756c in LogClass::logBegin() () from /usr/sbin/sajet/sharedobj/liblibLite.so\n</code></pre>\n\n<p>Notice that <code>LogClass::logBegin</code> appears in your call stack twice?</p>\n\n<p>You have two core problems.</p>\n\n<ol>\n<li><p>You are calling <code>localtime</code> from a signal handler. That is not allowed.</p></li>\n<li><p>You are looking at the wrong thread's stack. This thread got stuck in a deadlock caused by other threads and then was interrupted, getting stuck in the deadlock again. It's a victim of the deadlock (twice!). The perpetrator is another thread.</p></li>\n</ol>\n\n<p>If you're going to log from a signal handlers, you need very tight control over all the code that runs in the signal handler and you need to pass the \"heavy lifting\" off to another thread that can safely call non-reentrant functions.</p>\n"}], "owner": {"reputation": 141, "user_id": 5551818, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-h1fV-zpnnKg/AAAAAAAAAAI/AAAAAAAAAC4/cXngmigAfxs/photo.jpg?sz=128", "display_name": "ram914", "link": "https://stackoverflow.com/users/5551818/ram914"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1576696378, "creation_date": 1576654040, "last_edit_date": 1576695354, "question_id": 59387283, "link": "https://stackoverflow.com/questions/59387283/localtime-function-is-invoking-lll-lock-wait-private-which-is-making-the", "title": "localtime() function is invoking ___lll_lock_wait_private() which is making the thread to go deadlock", "body": "<p>I have seen many questions in which <code>___lll_lock_wait_private ()</code> is going into deadlock. But their call stack is different. Their code was calling <code>malloc()</code> or <code>free()</code> or <code>fork()</code>.</p>\n\n<p>But in my case, I have a Log class, which is trying to print a log. That log is making my thread to go deadlock.</p>\n\n<p>See below call stack,</p>\n\n<pre><code>#0  0x000000fff4c47b9c in __lll_lock_wait_private () from /lib64/libc.so.6\n#1  0x000000fff4bf0364 in __tz_convert () from /lib64/libc.so.6\n#2  0x000000fff4bee2c0 in localtime () from /lib64/libc.so.6\n#3  0x000000fff5167188 in getTimeStr() () from /usr/sbin/sajet/sharedobj/liblibLite.so\n#4  0x000000fff516756c in LogClass::logBegin() () from /usr/sbin/sajet/sharedobj/liblibLite.so\n#5  0x000000fff5318c90 in DaemonCtrlServer::strtDaemon(daemonInfo&amp;) () from /usr/sbin/sajet/sharedobj/libDaemonCtlServer.so\n#6  0x000000fff531abc0 in DaemonCtrlServer::restrtDiedDaemon(daemonInfo&amp;) () from /usr/sbin/sajet/sharedobj/libDaemonCtlServer.so\n#7  0x000000fff531ae64 in DaemonCtrlServer::handleChildDeath() () from /usr/sbin/sajet/sharedobj/libDaemonCtlServer.so\n#8  0x00000000100080ac in sj_initd::DaemonDeathHandler() ()\n#9  0x000000001000b8f8 in sj_initd::SignalHandler(int) ()\n#10 0x00000000100080e8 in sj_initd_SigHandler::sj_initdSigHandler(int) ()\n#11 &lt;signal handler called&gt;\n#12 0x000000fff4bedc00 in __offtime () from /lib64/libc.so.6\n#13 0x000000fff4bf02a8 in __tz_convert () from /lib64/libc.so.6\n#14 0x000000fff4bee2c0 in localtime () from /lib64/libc.so.6\n#15 0x000000fff5167188 in getTimeStr() () from /usr/sbin/sajet/sharedobj/liblibLite.so\n#16 0x000000fff516756c in LogClass::logBegin() () from /usr/sbin/sajet/sharedobj/liblibLite.so\n#17 0x000000fff52e868c in ConnectionOS::ProcessReadEvent() () from /usr/sbin/sajet/sharedobj/libconnV2.so\n#18 0x000000fff52ef354 in ConnectionOSManager::ProcessConns(fd_set*, fd_set*) () from /usr/sbin/sajet/sharedobj/libconnV2.so\n#19 0x000000fff52f0a0c in SocketsManager::ProcessFds(bool) () from /usr/sbin/sajet/sharedobj/libconnV2.so\n#20 0x000000fff52c51b4 in EventReactorBase::IO (this=0x19a65e80) at EventReactorBase.cpp:361\n#21 0x000000fff52c457c in EventReactorBase::React (this=0x19a65e80) at EventReactorBase.cpp:419\n#22 0x000000fff52c10cc in Task::Run (this=0x19a65e30) at Task.cpp:222\n#23 0x000000fff52c1218 in startTask (t=0x19a65e30) at Task.cpp:152\n#24 0x000000001000a9c4 in TaskManager::Start() ()\n#25 0x0000000010007538 in main ()\n</code></pre>\n\n<p>sj_init is a daemon which monitors the live status of other daemons in a system. When a daemon dies(which closes the connection with sj_init), it tries to restart that daemon. Then, <code>startDaemon()</code> is trying to print a log, which is calling <code>getTimeStr()</code> which internally calling <code>___lll_lock_wait_private</code> </p>\n\n<p><strong>Edit</strong></p>\n\n<p>as <code>localtime</code> is not threadsafe, I tried with <code>localtime_r</code> but it also lead the thread to go into a deadlock. but acc. to <code>localtime_r</code> description this is threadsafe  function. What am I doing wrong here?</p>\n"}, {"tags": ["c", "macos", "assembly", "shellcode"], "comments": [{"owner": {"reputation": 3177, "user_id": 4832634, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153157104716597/picture?type=large", "display_name": "Pawe\u0142 \u0141ukasik", "link": "https://stackoverflow.com/users/4832634/pawe%c5%82-%c5%81ukasik"}, "edited": false, "score": 0, "creation_date": 1576658382, "post_id": 59386678, "comment_id": 104966977, "body": "do you know where you would like to <code>ret</code>urn?"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1576681529, "post_id": 59386678, "comment_id": 104978912, "body": "If you want to <code>ret</code> from it, you&#39;re just writing a function in machine code instead of asm.  It&#39;s not something that would work if you injected this code as part of a buffer overflow because it wouldn&#39;t be called with a return address on the stack (unless your payload includes an extra return address)."}, {"owner": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1576683922, "post_id": 59386678, "comment_id": 104980287, "body": "@PeterCordes, yes I can see what you mean.  Its just that I haven&#39;t done any assembly level coding in a while and I wasn&#39;t sure if a system call was needed in order to return."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1576684058, "post_id": 59386678, "comment_id": 104980364, "body": "Look at compiler-generated code for whole functions.  That&#39;s what the <code>ret</code> instruction is for!  <a href=\"//stackoverflow.com/a/38552509\">How to remove &quot;noise&quot; from GCC/clang assembly output?</a>  (Using a system call to modify the architectural state of your own thread, like setting the program counter (RIP), would be insanely slow.)"}], "answers": [{"comments": [{"owner": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "edited": false, "score": 0, "creation_date": 1576661424, "post_id": 59388557, "comment_id": 104968435, "body": "Thanks! After reading your comment and answer, I&#39;ve added the boilerplate to show how I execute the shellcode.  It&#39;s through a function call.  I&#39;ll try to digest your advice and see what I can achieve."}, {"owner": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "edited": false, "score": 0, "creation_date": 1576661608, "post_id": 59388557, "comment_id": 104968537, "body": "Using your 1st suggestion resulted in a seg fault after printing hello the first time.  How can I get the address to return to, and do I need to push anything onto the stack at the start of the shellcode?"}, {"owner": {"reputation": 3177, "user_id": 4832634, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153157104716597/picture?type=large", "display_name": "Pawe\u0142 \u0141ukasik", "link": "https://stackoverflow.com/users/4832634/pawe%c5%82-%c5%81ukasik"}, "reply_to_user": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "edited": false, "score": 1, "creation_date": 1576661750, "post_id": 59388557, "comment_id": 104968613, "body": "thanks for the code. I&#39;ll check it today and update the answer"}, {"owner": {"reputation": 3177, "user_id": 4832634, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153157104716597/picture?type=large", "display_name": "Pawe\u0142 \u0141ukasik", "link": "https://stackoverflow.com/users/4832634/pawe%c5%82-%c5%81ukasik"}, "reply_to_user": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "edited": false, "score": 0, "creation_date": 1576679825, "post_id": 59388557, "comment_id": 104977867, "body": "I&#39;ve updated the answer it should be ok - though I will be able to verify this on MacOS tomorrow unless it will work for you."}, {"owner": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "edited": false, "score": 0, "creation_date": 1576681033, "post_id": 59388557, "comment_id": 104978590, "body": "Yes, I&#39;m generating the shellcode from Assembly source using NASM.  I&#39;m using Shellme.py to extract the bytecode from the object file.  I had to modify Shellme a little to handle the case when objdump is not able to disassemble the instruction and uses the label <code>&lt;unknown&gt;</code> instead of the mnemonic."}, {"owner": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "edited": false, "score": 0, "creation_date": 1576684585, "post_id": 59388557, "comment_id": 104980666, "body": "Interesting.  It worked after I removed the following <code>00000026  E8D7FFFFFF        call 0x2</code> from the shellcode.  I&#39;ve seen examples with that line in the source, but my NASM (Homebrew v2.14.02) issues an error for that line:  <code>27: error: unable to find a suitable absolute  symbol for this reference</code>, so I remove it (and it still works)."}], "tags": [], "owner": {"reputation": 3177, "user_id": 4832634, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153157104716597/picture?type=large", "display_name": "Pawe\u0142 \u0141ukasik", "link": "https://stackoverflow.com/users/4832634/pawe%c5%82-%c5%81ukasik"}, "is_accepted": true, "score": 2, "last_activity_date": 1576679756, "last_edit_date": 1576679756, "creation_date": 1576659681, "answer_id": 59388557, "question_id": 59386678, "link": "https://stackoverflow.com/questions/59386678/return-from-shellcode-instead-of-exit/59388557#59388557", "title": "Return from Shellcode instead of exit", "body": "<blockquote>\n  <p>I have a loop that calls my shellcode</p>\n</blockquote>\n\n<p>So if it's an actual <code>call</code> then you are good to go and the only change you need to do is to remove the 3 last instructions (<code>mov</code>, <code>mov</code> and <code>syscall</code>) and replaced them with a <code>ret</code> since the return address will be on the stack already. But we need to additionally clean up the stack a little bit since the address of the text string is put there for the sake of <code>syscall</code>, we want to get rid of it before the return. </p>\n\n<p>Also since you shellcode contains an offset (the first <code>jmp</code> opcode with the value of <code>0x24</code>) it's safer to not delete anything (as it will change the offsets) but to replace with <code>NOP</code>. Unless you modify the shellcode's source code and generate it every time - than it's fine to remove stuff. </p>\n\n<p>So what I would actually propose to do is to replace the bytes that constitutes for the last 3 opcodes with <code>0x90</code>(NOP) and the last 2 bytes from that replace with <code>pop rax\\ret</code> so bytes <code>0x58</code> and <code>0xc3</code>. The final shellcode could look like this:</p>\n\n<pre><code>const char shellcode[] = \"\\xeb\\x24\\xb8\\x04\\x00\\x00\\x02\\xbf\\x01\\x00\\x00\\x00\\x48\\x8d\\x35\\x18\\x00\\x00\\x00\\xba\\x0f\\x00\\x00\\x00\\x0f\\x05\\x90\\x90\\x90\\x90\\x90\\x90\\x90\\x90\\x90\\x90\\x58\\xc3\\xe8\\xd7\\xff\\xff\\xff\\x48\\x65\\x6c\\x6c\\x6f\\x2c\\x20\\x77\\x6f\\x72\\x6c\\x64\\x21\\x0d\\x0a\";\n</code></pre>\n"}], "owner": {"reputation": 957, "user_id": 1756090, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/535d2c26455b0452e41fe9ba29e8885f?s=128&d=identicon&r=PG", "display_name": "gone", "link": "https://stackoverflow.com/users/1756090/gone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 59388557, "answer_count": 1, "score": 1, "last_activity_date": 1576679756, "creation_date": 1576651157, "last_edit_date": 1576661310, "question_id": 59386678, "link": "https://stackoverflow.com/questions/59386678/return-from-shellcode-instead-of-exit", "title": "Return from Shellcode instead of exit", "body": "<p>I'm working on a shared mem assignment for uni and I've 'borrowed' and 'massaged' some shellcode I've seen in posts I've read here and other places.  I've been able to construct an example that runs on my MacBook (Mojave) and almost does what I want.</p>\n\n<p>However, since I'm not that experienced with assembly programming in an OS environment (MacOS in this case), and because I don't fully understand the assembly below, I need a little help to overcome my last issue.</p>\n\n<p>In my C boilerplate wrapper, I have a loop that calls my shellcode periodically, but the loop only executes one iteration.  This leads me to the conclusion that the second <code>syscall</code> (in the code below) is performing an <code>exit 0</code>, thus terminating the process.</p>\n\n<p>How can I modify the assembly to <em>return</em> instead of <em>exit</em>?</p>\n\n<p><em>Note</em> if asked, I can post more information about the wrapper code and tools I'm using.</p>\n\n<pre><code>bits 64\n\nSection .text\n  global start\n\nstart:\n  jmp       short MESSAGE     ;00000000  EB24              jmp short 0x26\n\nGOBACK:\n  mov       eax, 0x2000004    ;00000002  B804000002        mov eax,0x2000004  ; write\n  mov       edi, 0x1          ;00000007  BF01000000        mov edi,0x1\n  lea       rsi, [rel msg]    ;0000000C  488D3518000000    lea rsi,[rel 0x2b]\n  mov       edx, 0xf          ;00000013  BA0F000000        mov edx,0xf\n  syscall                     ;00000018  0F05              syscall\n\n  mov       eax,0x2000001     ;0000001A  B801000002        mov eax,0x2000001  ;exit\n  mov       edi,0x0           ;0000001F  BF00000000        mov edi,0x0\n  syscall                     ;00000024  0F05              syscall\n\n\nMESSAGE:\n  call      GOBACK\n  msg:      db      \"Hello, world!\", 0dh, 0ah\n  .len:     equ     $ - msg\n</code></pre>\n\n<p>Here is my C boilerplate code, which includes the shellcode from above.</p>\n\n<pre><code>#include &lt;string.h&gt;\n#include &lt;sys/mman.h&gt;\n#include &lt;unistd.h&gt;\n\nconst char shellcode[] = \"\\xeb\\x24\\xb8\\x04\\x00\\x00\\x02\\xbf\\x01\\x00\\x00\\x00\\x48\\x8d\\x35\\x18\\x00\\x00\\x00\\xba\\x0f\\x00\\x00\\x00\\x0f\\x05\\xb8\\x01\\x00\\x00\\x02\\xbf\\x00\\x00\\x00\\x00\\x0f\\x05\\xe8\\xd7\\xff\\xff\\xff\\x48\\x65\\x6c\\x6c\\x6f\\x2c\\x20\\x77\\x6f\\x72\\x6c\\x64\\x21\\x0d\\x0a\";\n\nint main(int argc, char **argv)\n{\n  void *mem = mmap(0, sizeof(shellcode), PROT_READ|PROT_WRITE, MAP_SHARED|MAP_ANONYMOUS, -1, 0);\n\n  memcpy(mem, shellcode, sizeof(shellcode));\n\n  mprotect(mem, sizeof(shellcode), PROT_READ|PROT_WRITE|PROT_EXEC);\n\n  for (int i = 0; i &lt; 10; i++) {\n    int (*func)();\n    func = (int (*)())mem;\n    (int)(*func)();\n    sleep(5);\n  }\n\n  munmap(mem, sizeof(shellcode));\n\n  return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "memory-management", "standards", "realloc"], "comments": [{"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1576650295, "post_id": 59386465, "comment_id": 104963928, "body": "You need to take into account that already reading the value of a pointer pointing to invalid memory invokes undefined behaviour. Then you can answer your question yourself."}, {"owner": {"reputation": 3470, "user_id": 531679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LYlCV.gif?s=128&g=1", "display_name": "Steve Friedl", "link": "https://stackoverflow.com/users/531679/steve-friedl"}, "edited": false, "score": 4, "creation_date": 1576650301, "post_id": 59386465, "comment_id": 104963933, "body": "I don&#39;t see how there would be an upside to requiring this, it would handcuff implementations for no really good reason.  It does make sense that reallocating to a smaller chunk could be in-place, but there are allocators that keep different arenas for different blocksizes, and this artificial requirement would make this more difficult, for no good reason I can see.  Besides, what does &quot;try&quot; mean in the context of a standard, and what use could you make of this behavior?"}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 1, "creation_date": 1576650357, "post_id": 59386465, "comment_id": 104963950, "body": "The standard doesn&#39;t say anything about to implement the function; that gives the people who do write it lots of freedom. Why restrict that?"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1576651229, "post_id": 59386465, "comment_id": 104964214, "body": "What benefit would you expect from putting that in the standard?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1576655413, "post_id": 59386465, "comment_id": 104965766, "body": "The C standard doesn&#39;t specify anything about how memory is handled overall, so why would heap allocation be any different?"}, {"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 0, "creation_date": 1576668711, "post_id": 59386465, "comment_id": 104972103, "body": "The qualifier from about the return value &quot;(which may have the same value as a pointer to the old object)&quot;  certainly permits an implementation to (in your words) &quot;do in-place reallocation&quot;.    However, it allows the implementation to behave as it sees fit.    Forcing an implementation to behave in the specific way you suggest will limit opportunities to optimise - for example to tweak allocation and reallocation to better use available hardware resources."}], "answers": [{"tags": [], "owner": {"reputation": 3470, "user_id": 531679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LYlCV.gif?s=128&g=1", "display_name": "Steve Friedl", "link": "https://stackoverflow.com/users/531679/steve-friedl"}, "is_accepted": true, "score": 11, "last_activity_date": 1576688963, "last_edit_date": 1576688963, "creation_date": 1576651449, "answer_id": 59386745, "question_id": 59386465, "link": "https://stackoverflow.com/questions/59386465/why-does-realloc-not-re-allocate-in-place-when-possible/59386745#59386745", "title": "Why does `realloc` not re-allocate in-place when possible?", "body": "<p>I think I'm going to propose this an answer.</p>\n\n<p>The notion of \"try\" doesn't mean much in the context of a standard - how hard does the implementer have to try before they have tried enough? How would one measure compliance?</p>\n\n<p>Many common implementations will work exactly as you suggest: If you're resizing downward, or even resizing upward and the following memory happens to be free, they might return the original pointer after adjusting the housekeeping but not having to copy any data. Yay!</p>\n\n<p>But I can think of lots of reasons why an allocator would not do this even if it were possible:</p>\n\n<ul>\n<li><p>Some allocators keep different arenas for different sizes, where (making this up) it's a different pool for chunks from 1-128 bytes than there are for 64kbytes and larger. The whole scheme breaks down if the \"big\" pool has to keep small allocations around. This is especially the case if you're intentionally keeping \"big\" allocations on page boundaries.</p></li>\n<li><p>Multi-thread aware applications often have to take special care to avoid contention so that memory allocation is not a bottleneck. If you're realloc'ing a chunk that was allocated in a different thread, it might be non-blocking to give you a new chunk (with copy) and defer on freeing the old pointer, but allowing you to keep the same pointer would block this or some other thread.</p></li>\n<li><p>A debugging allocator will <em>intentionally</em> return different pointers to make sure the program doesn't incorrectly hang onto an old pointer by mistake: this breaks things sooner rather than later.</p></li>\n</ul>\n\n<p>I cannot think of a case where a \"please try\" statement in the standard would change any decisions of any library designer. If keeping the same pointer makes sense for a given implementation, then <em>of course</em> they're going to use it, but if there's an overriding technical reason not to, then they won't.</p>\n\n<p>I'm also not sure I can think of a case where this nudge would make any difference to the <em>user</em> of a library either. You still have to code it to account for all the cases, even one that \"tries\", so it's not like it's going to save you any code.</p>\n\n<p>In the end, this is an implementation detail that a standard would never handcuff an implementer about, and the library will be judged on its own merits (performance, codesize, reliability, etc.) and this is just one aspect.</p>\n\n<p>You can always code your own allocator if you really need that behavior for some reason.</p>\n\n<hr>\n\n<p><strong>EDIT</strong>: Another reason why an allocator would want to return a different pointer even if reallocing <em>the same size</em>: reducing memory fragmentation.</p>\n\n<p>If my realloc request comes in at a time when there's a lot of free space on either side, the allocator could realize: I could extend this chunk in place (fast and easy), <strong>or</strong> I could move it some other place and coalesce what's left behind into a much larger free block.</p>\n\n<p>This has been a nagging problem for a customer-written project: written ages ago in 32-bit Delphi, it runs for days at a time with a lot of memory pressure, and eventually the memory is so fragmented that it's unavailable to service modest requests even though there are many hundreds of megabytes free.</p>\n\n<p>Ref: <a href=\"https://stackoverflow.com/questions/57683466/are-concatenated-delphi-strings-held-in-a-hidden-temporary-variable-that-retains\">Are concatenated Delphi strings held in a hidden temporary variable that retains a reference to the string?</a></p>\n\n<p>There's little I can do about this in Delphi, but in C it's very easy to imagine \"aggressive avoiding of memory fragmentation\" being a property of an allocator.</p>\n"}, {"tags": [], "owner": {"reputation": 2858, "user_id": 12491175, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mPSJY.png?s=128&g=1", "display_name": "Zig Razor", "link": "https://stackoverflow.com/users/12491175/zig-razor"}, "is_accepted": false, "score": -1, "last_activity_date": 1576656945, "creation_date": 1576656945, "answer_id": 59387911, "question_id": 59386465, "link": "https://stackoverflow.com/questions/59386465/why-does-realloc-not-re-allocate-in-place-when-possible/59387911#59387911", "title": "Why does `realloc` not re-allocate in-place when possible?", "body": "<p>A standard is a general purpose description, it doesn't need to specify if it <strong><em>try to do somethings</em></strong>, it describes the general behavior of a function.</p>\n\n<p>It is clear and logic, that for optimization purpose the system will try to resize the buffer in the same location, <strong><em>but since there are no guarantees that this happens</em></strong>, it can't specify it in the standard.</p>\n"}], "owner": {"reputation": 14929, "user_id": 2051137, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/1sIMq.jpg?s=128&g=1", "display_name": "Remi.b", "link": "https://stackoverflow.com/users/2051137/remi-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 1, "accepted_answer_id": 59386745, "answer_count": 2, "score": 4, "last_activity_date": 1576688963, "creation_date": 1576650007, "last_edit_date": 1592644375, "question_id": 59386465, "link": "https://stackoverflow.com/questions/59386465/why-does-realloc-not-re-allocate-in-place-when-possible", "title": "Why does `realloc` not re-allocate in-place when possible?", "body": "<p>From c99:</p>\n<blockquote>\n<p>The <code>realloc</code> function deallocates the old object pointed to by <code>ptr</code> and returns a pointer to a new object that has the size specified by size. The contents of the new object shall be the same as that of the old object prior to deallocation, up to the lesser of the new and old sizes. Any bytes in the new object beyond the size of the old object have indeterminate values.</p>\n<p>[..]</p>\n<p>The realloc function returns a pointer to the new object (which may have the same value as a pointer to the old object), or a null pointer if the new object could not be allocated.</p>\n</blockquote>\n<p>I am surprised that the standards do not specify that <code>realloc</code> should &quot;try&quot; to do in-place reallocation. Typically, if the reallocation size is lower than the currently allocated size, I would have expected the standards to ensure that the <code>realloc</code> would return the same pointer.</p>\n<p>Is there a logic for the standards not to specify that <code>realloc</code> should be in-place if the size is reduced?</p>\n"}, {"tags": ["c", "windows", "opengl", "glfw"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 12555626, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/516026dee4a0fbfd33c36d9481db3557?s=128&d=identicon&r=PG&f=1", "display_name": "EnglishPoor", "link": "https://stackoverflow.com/users/12555626/englishpoor"}, "edited": false, "score": 0, "creation_date": 1576718828, "post_id": 59398363, "comment_id": 104993289, "body": "thanks a lot,When I close Vsync,A funny thing happened,My program Very simple ,Just Keep rotating a box , Every time my FPS goes down , eg:FPS 600 - FPS 200 ,,The box is going to be slow ; to be precise is When the Geforce Experience In-game coverage starts ,Why?"}, {"owner": {"reputation": 35, "user_id": 12555626, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/516026dee4a0fbfd33c36d9481db3557?s=128&d=identicon&r=PG&f=1", "display_name": "EnglishPoor", "link": "https://stackoverflow.com/users/12555626/englishpoor"}, "edited": false, "score": 0, "creation_date": 1576719453, "post_id": 59398363, "comment_id": 104993405, "body": "When I open Vsync ,That wouldn&#39;t have happened :&lt;"}], "tags": [], "owner": {"reputation": 47449, "user_id": 44729, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tyWaU.png?s=128&g=1", "display_name": "genpfault", "link": "https://stackoverflow.com/users/44729/genpfault"}, "is_accepted": true, "score": 4, "last_activity_date": 1576695887, "last_edit_date": 1576695887, "creation_date": 1576694820, "answer_id": 59398363, "question_id": 59386410, "link": "https://stackoverflow.com/questions/59386410/disable-vsync-with-glfw/59398363#59398363", "title": "Disable vsync with GLFW?", "body": "<p>Once you've made your GL context current via <code>glfwMakeContextCurrent()</code> you can use <a href=\"https://www.glfw.org/docs/latest/group__context.html#ga6d4e0cdf151b5e579bd67f13202994ed\" rel=\"nofollow noreferrer\"><code>glfwSwapInterval(0)</code></a> to request that vsync be disabled:</p>\n\n<pre><code>int main( int, char** )\n{\n    GLFWwindow* window;\n    glfwInit();\n    window = glfwCreateWindow( 640, 480, \"GLFW\", NULL, NULL );\n    glfwMakeContextCurrent( window );\n    glfwSwapInterval( 0 );\n    ...\n</code></pre>\n\n<p>Note that this is only a request, since your GL implementation may not support the underlying swap interval extension or vsync may be forced 'on' at the driver/OS level.</p>\n"}], "owner": {"reputation": 35, "user_id": 12555626, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/516026dee4a0fbfd33c36d9481db3557?s=128&d=identicon&r=PG&f=1", "display_name": "EnglishPoor", "link": "https://stackoverflow.com/users/12555626/englishpoor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 674, "favorite_count": 0, "accepted_answer_id": 59398363, "answer_count": 1, "score": 2, "last_activity_date": 1576695887, "creation_date": 1576649702, "last_edit_date": 1576679808, "question_id": 59386410, "link": "https://stackoverflow.com/questions/59386410/disable-vsync-with-glfw", "title": "Disable vsync with GLFW?", "body": "<p>I use GLFW and GLEW; the problem is vsync is enabled by default, how can I shut it down?</p>\n\n<ul>\n<li>Windows 10</li>\n<li>Visual C++ 2019</li>\n<li>OpenGL 3.0</li>\n</ul>\n"}, {"tags": ["c", "visual-studio-code"], "answers": [{"comments": [{"owner": {"reputation": 429, "user_id": 2703314, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qRgDA.jpg?s=128&g=1", "display_name": "Ondrej Rozinek", "link": "https://stackoverflow.com/users/2703314/ondrej-rozinek"}, "edited": false, "score": 0, "creation_date": 1615206707, "post_id": 59386353, "comment_id": 117611298, "body": "The question is not fully answered because you show only simple project with main.cpp and not complex structure with header files, libs etc."}, {"owner": {"reputation": 2892, "user_id": 391691, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vCKhh.jpg?s=128&g=1", "display_name": "Simson", "link": "https://stackoverflow.com/users/391691/simson"}, "reply_to_user": {"reputation": 429, "user_id": 2703314, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qRgDA.jpg?s=128&g=1", "display_name": "Ondrej Rozinek", "link": "https://stackoverflow.com/users/2703314/ondrej-rozinek"}, "edited": false, "score": 0, "creation_date": 1615248132, "post_id": 59386353, "comment_id": 117627681, "body": "@OndrejRozinek, feel free to add another answer, if it is good I will upvote it. Sometimes even an incomplete answer can push someone in the right direction."}], "tags": [], "owner": {"reputation": 2892, "user_id": 391691, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vCKhh.jpg?s=128&g=1", "display_name": "Simson", "link": "https://stackoverflow.com/users/391691/simson"}, "is_accepted": false, "score": 0, "last_activity_date": 1576655149, "last_edit_date": 1576655149, "creation_date": 1576649423, "answer_id": 59386353, "question_id": 59386202, "link": "https://stackoverflow.com/questions/59386202/how-to-link-all-c-files-automaticly-in-vscode/59386353#59386353", "title": "How to link all C files automaticly in VSCODE?", "body": "<p>You must still have a make system for your project for instance a Makefile.</p>\n\n<p>So you should create a build rule in your Makefile and the run <code>make</code> from tasks.json</p>\n\n<p>Here is an <a href=\"https://github.com/simonsso/empty-cpp-project\" rel=\"nofollow noreferrer\">example I have on github</a>, it is for C++ but the concept is the same for C.</p>\n"}], "owner": {"reputation": 99, "user_id": 10799483, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d65e62e96aec2817239f1585a318d26d?s=128&d=identicon&r=PG&f=1", "display_name": "shadowfish", "link": "https://stackoverflow.com/users/10799483/shadowfish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 141, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1578546883, "creation_date": 1576648467, "last_edit_date": 1578546883, "question_id": 59386202, "link": "https://stackoverflow.com/questions/59386202/how-to-link-all-c-files-automaticly-in-vscode", "title": "How to link all C files automaticly in VSCODE?", "body": "<p>I have lots of <code>.c</code> files and <code>.h</code> files and I want to compile all of them. But I find I must add every filename manually in <code>tasks.json</code>. Is there any way to link all the <code>.c</code> files in the same folder?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 8251, "user_id": 2912665, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XrRhd.jpg?s=128&g=1", "display_name": "CinCout", "link": "https://stackoverflow.com/users/2912665/cincout"}, "edited": false, "score": 0, "creation_date": 1576645558, "post_id": 59385745, "comment_id": 104962746, "body": "Debug it once. All will be clear."}, {"owner": {"reputation": 265, "user_id": 2577434, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/1351863934/picture?type=large", "display_name": "Eric Lang", "link": "https://stackoverflow.com/users/2577434/eric-lang"}, "reply_to_user": {"reputation": 8251, "user_id": 2912665, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XrRhd.jpg?s=128&g=1", "display_name": "CinCout", "link": "https://stackoverflow.com/users/2912665/cincout"}, "edited": false, "score": 0, "creation_date": 1576645862, "post_id": 59385745, "comment_id": 104962825, "body": "@CinCout-ReinstateMonica  I did, yet wasn&#39;t left very satisfied with my understanding how that constant correlates. I am not inept, and can debug code. I don&#39;t doubt I&#39;m missing something rather simple, but simultaneously wouldn&#39;t have posted this here if I didn&#39;t stare at it for long enough to be confused."}, {"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 4, "creation_date": 1576645889, "post_id": 59385745, "comment_id": 104962833, "body": "It&#39;s an octal literal. Did you notice <i>that</i> ?"}, {"owner": {"reputation": 265, "user_id": 2577434, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/1351863934/picture?type=large", "display_name": "Eric Lang", "link": "https://stackoverflow.com/users/2577434/eric-lang"}, "reply_to_user": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1576645991, "post_id": 59385745, "comment_id": 104962852, "body": "@WhozCraig Yeah, first thing I did was convert it, and really don&#39;t see anything super special about the integer 150964650272183."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1576647473, "post_id": 59385745, "comment_id": 104963176, "body": "Nit.. technically your <code>puts(&#39;2&#39;);</code> must be <code>puts(&quot;2&quot;);</code>"}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 0, "creation_date": 1576647488, "post_id": 59385745, "comment_id": 104963181, "body": "note that the above code has UB in <code>printf(&quot;%lld\\n&quot;, p);</code> because p is an <code>unsigned long long</code> which must be printed using <code>%llu</code>"}, {"owner": {"reputation": 265, "user_id": 2577434, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/1351863934/picture?type=large", "display_name": "Eric Lang", "link": "https://stackoverflow.com/users/2577434/eric-lang"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1576651317, "post_id": 59385745, "comment_id": 104964235, "body": "@DavidC.Rankin I knew that, I was just testing you.  I quickly copied it off vim, and didn&#39;t grab that line, so I trusted myself to type it without needing gcc to tell me to go write that crap in a python interpreter."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1576656576, "post_id": 59385745, "comment_id": 104966240, "body": "@EricLang no worries, as long as you have <code>100010010100110100110010010110100110010110110111</code> figured out and how it is just a simple odd count starting from 3 at the right and outputting the value for each <code>1-bit</code> that is set, you are good to go. (it was a cruel way to tell a student how to generate primes from 1-100....)"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1577077060, "post_id": 59385745, "comment_id": 105083002, "body": "Chuckling.... yuck! Don&#39;t throw me in that java brier-patch.. Thankfully my first programming class came a year or two after A&amp;M got rid of the punch-card readers and had a shiny new Vax system. FORTRAN on a Vax was a step up from keeping punch cards in order... Then I went to work at JSC in &#39;89 and we had Sun with C! But then how to move 750K lines of FORTAN to C... Ouch -- thank goodness for contractors.... Fast forward 30 years and son is at A&amp;M, and programming has moved to microcontrollers -- but at least it is C."}], "answers": [{"tags": [], "owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "is_accepted": false, "score": 3, "last_activity_date": 1576646767, "creation_date": 1576646767, "answer_id": 59385968, "question_id": 59385745, "link": "https://stackoverflow.com/questions/59385745/how-does-this-unsigned-long-long-translate-to-being-a-point-to-evaluate-prime-nu/59385968#59385968", "title": "How does this unsigned long long translate to being a point to evaluate prime numbers from 3-100 in this for loop?", "body": "<p>Here is a somewhat less oblique version of it:</p>\n\n<pre><code>int main()\n{\n#define bit(n)  (1ull&lt;&lt;(n))\n    unsigned long long bitmask = 04224646226462667ull;\n    puts(\"2\");\n\n    for (int i=0; bit(i) &lt; bitmask; i++)\n        if (bitmask &amp; bit(i))\n            printf(\"%u\\n\", 3 + i*2);\n\n    return 0;\n}\n</code></pre>\n\n<p>So the funny literal is a compressed encoding of the prime numbers between 3 and 100.  The compression eliminates all the even numbers (obviously not prime), so that if bit i is set, then the corresponding prime number is 3 + i * 2.</p>\n"}, {"tags": [], "owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "is_accepted": true, "score": 3, "last_activity_date": 1576646925, "creation_date": 1576646925, "answer_id": 59385991, "question_id": 59385745, "link": "https://stackoverflow.com/questions/59385745/how-does-this-unsigned-long-long-translate-to-being-a-point-to-evaluate-prime-nu/59385991#59385991", "title": "How does this unsigned long long translate to being a point to evaluate prime numbers from 3-100 in this for loop?", "body": "<p>The author has effectively buried the prime sequence in a constant based on the fact that</p>\n\n<ol>\n<li>There are fewer than 63 primes between 2 and 100, so an encoding used 64bits of a ULL can be used.</li>\n<li>Starting with 3, it navigates only odd numbers between 3 and 99 inclusively. Since there are only 49 such numbers in 3...99, we have plenty of bits to encode with.</li>\n<li>Each iteration effectively does a right-shift of <code>b</code> by one bit (with <code>b /= 2</code>).</li>\n</ol>\n\n<p>Therefore, by encoding the constant such that the zero bit of <code>b</code> is lit on the current iteration if the value <code>p</code> is a prime, and you only print <code>p</code> in that specific case, The result is a list of numbers that detail exactly what was encoded, and nothing more. In this case that encoding was primes, but that the numbers are primes have nothing to do with the actual math; it's all about the pre-determine encoding, the bit shift, and reporting a counter if that first bit is lit after the shift.</p>\n"}], "owner": {"reputation": 265, "user_id": 2577434, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/1351863934/picture?type=large", "display_name": "Eric Lang", "link": "https://stackoverflow.com/users/2577434/eric-lang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 59385991, "answer_count": 2, "score": 0, "last_activity_date": 1576646925, "creation_date": 1576645240, "question_id": 59385745, "link": "https://stackoverflow.com/questions/59385745/how-does-this-unsigned-long-long-translate-to-being-a-point-to-evaluate-prime-nu", "title": "How does this unsigned long long translate to being a point to evaluate prime numbers from 3-100 in this for loop?", "body": "<pre><code>int main()\n\n{\n\nputs('2');\n\nfor (unsigned long long b = 04224646226462667ull, p = 3; b; p += 2, b /= 2)\n\nif (b % 2) printf(\"%lld\\n\", p);\n\nreturn 0;\n\n}\n</code></pre>\n\n<p>I found this online on a post where someone was trying to screw with a kid soliciting homework solutions, and for the life of me, I can't figure it out. I understand it probably has something to do with the integer division performed on the unsigned long long, but other than that, I fail to see what's facilitating it's exclusion of the certain values in the range through 100.</p>\n"}, {"tags": ["python", "c", "ctypes"], "comments": [{"owner": {"reputation": 6531, "user_id": 507028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/150b5324471a76f6f2fa9dd2380ad611?s=128&d=identicon&r=PG", "display_name": "Neitsa", "link": "https://stackoverflow.com/users/507028/neitsa"}, "edited": false, "score": 0, "creation_date": 1576657450, "post_id": 59385744, "comment_id": 104966615, "body": "In your example <code>ntcGetCameraCount</code> doesn&#39;t seem to take any argument, you defined it with one in python. The second parameter to <code>ntcGetCameraInfo</code> should be a <code>ctypes.c_uint32</code> according to your example. <code>ntcOpen</code>takes 3 arguments but you defined it only with 2. Check what is the underlying type of <code>ENeptuneDevAccess</code> and add it to your python function prototype."}, {"owner": {"reputation": 28355, "user_id": 4788546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2jWn.jpg?s=128&g=1", "display_name": "CristiFati", "link": "https://stackoverflow.com/users/4788546/cristifati"}, "edited": false, "score": 0, "creation_date": 1576665231, "post_id": 59385744, "comment_id": 104970405, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/58610333/c-function-called-from-python-via-ctypes-returns-incorrect-value\">C function called from Python via ctypes returns incorrect value</a>. It&#39;s a <i>argtype<b>s</i></b>."}], "owner": {"reputation": 1, "user_id": 11001139, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-U__eWRNK46A/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPVZjZXpQmnqYgfK2cnFtV7oaXe_g/mo/photo.jpg?sz=128", "display_name": "huang lin", "link": "https://stackoverflow.com/users/11001139/huang-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576645236, "creation_date": 1576645236, "question_id": 59385744, "link": "https://stackoverflow.com/questions/59385744/invalid-parameter-when-using-python-ctypes-to-call-dll-function", "title": "Invalid parameter when using python ctypes to call dll function", "body": "<p>The following section is the manual provided by them.</p>\n\n<h3>Definition</h3>\n\n<blockquote>\n  <p>NeptuneCamHandle ntcOpen(_char_t* pstrDevID, NeptuneCamHandle* phCamHandle,ENeptuneDevAccess eAccessFlag=NEPTUNE_DEV_ACCESS_EXCLUSIVE)</p>\n</blockquote>\n\n<h3>Parameters</h3>\n\n<ul>\n<li>[IN] pstrDevID : ID string of a camera</li>\n<li>[OUT] phCamHandle : camera handle</li>\n<li>[IN, Optional] AccessFlag : control mode</li>\n</ul>\n\n<h3>Example</h3>\n\n<pre><code>_uint32_t nCameras = ntcGetCameraCount();\nif ( nCameras &gt; 0 )\n{\n pCamInfo = new NEPTUNE_CAM_INFO[nCameras];\n ntcGetCameraInfo(pCamInfo, nCameras);\n}\nNeptuneCamHandle hCamHandle;\n// if unicast\nntcOpen(pCamInfo[0].strCamID, &amp;hCamHandle);\n// if multicast\nntcOpen(pCamInfo[0].strCamID, &amp;hCamHandle, NEPTUNE_DEV_ACCESS_CONTROL);\n</code></pre>\n\n<p>This is how I use it in my code:</p>\n\n<pre><code>class _NEPTUNE_CAM_INFO_(Structure):\n    pass\n\n\n_NEPTUNE_CAM_INFO_._fields_ = [\n    ('strVendor', c_char * 512),\n    ('strModel', c_char * 512),\n    ('strSerial', c_char * 512),\n    ('strUserID', c_char * 512),\n    ('strIP', c_char * 512),\n    ('strMAC', c_char * 32),\n    ('strSubnet', c_char * 512),\n    ('strGateway', c_char * 512),\n    ('strCamID', c_char * 512),\n]\nNEPTUNE_CAM_INFO = _NEPTUNE_CAM_INFO_\n\n\nclass IMICamera:\n\n    def __init__(self):\n        self._handle = c_void_p()  # \u8bb0\u5f55\u5f53\u524d\u8fde\u63a5\u8bbe\u5907\u7684\u53e5\u67c4\n        self.handle = pointer(self._handle)  # \u521b\u5efa\u53e5\u67c4\u6307\u9488\n        self.IMI_ntcInit()\n\n    def IMI_ntcInit(self):\n        IMICamCtrldll.ntcGetCameraCount.restype = c_int\n        return IMICamCtrldll.ntcInit()\n        # return MvCamCtrldll.ntcInit()\n\n    def IMI_ntcGetCameraCount(self, count):\n        IMICamCtrldll.ntcGetCameraCount.argtype = (c_void_p,)\n        IMICamCtrldll.ntcGetCameraCount.restype = c_int\n        return IMICamCtrldll.ntcGetCameraCount(byref(count))\n\n    def IMI_ntcGetCameraInfo(self, pInfo, count):\n        IMICamCtrldll.ntcGetCameraInfo.argtype = (c_void_p, c_void_p)\n        IMICamCtrldll.ntcGetCameraInfo.restype = c_int\n        return IMICamCtrldll.ntcGetCameraInfo(byref(pInfo), count)\n\n    def IMI_ntcOpen(self, pstrDevID):\n        IMICamCtrldll.ntcOpen.argtype = (c_char, c_void_p)\n        IMICamCtrldll.ntcOpen.restype = c_int\n        return IMICamCtrldll.ntcOpen(pstrDevID, byref(self.handle))\nif __name__ == '__main__':\n    mv = IMICamera()\n    count = c_uint()\n    res = mv.IMI_ntcGetCameraCount(count)\n    if res != 0:\n        print('IMI_ntcGetCameraCount', res)\n    pInfo = (NEPTUNE_CAM_INFO * count.value)()\n    res = mv.IMI_ntcGetCameraInfo(pInfo, count)\n    if res != 0:\n        print('IMI_ntcGetCameraInfo', res)\n    strCamID = pInfo[1].strCamID\n    pid = (c_char * 512)()\n    for i in range(len(strCamID)):\n        pid[i] = strCamID[i]\n\n    pid2 = ctypes.create_string_buffer(512)\n    pid2.value = strCamID\n\n    pid3 = c_char_p(b'00:09:7e:02:80:88')\n    res = mv.IMI_ntcOpen(pid3)\n</code></pre>\n\n<p>I try many type parameters,as you can see in my code.\nAfter I run my code, the result is always get error_code -203,it means NEPTUNE_ERR_InvalidParameter.</p>\n\n<p>How can i fix this? What have I done wrong? Thanks! </p>\n"}, {"tags": ["c", "makefile", "sdl"], "comments": [{"owner": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "edited": false, "score": 3, "creation_date": 1576645277, "post_id": 59385622, "comment_id": 104962684, "body": "typo: <code>-LSDL2_ttf</code> -&gt; <code>-lSDL2_ttf</code>"}], "owner": {"reputation": 31, "user_id": 12556197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b0ba74afc4b08b4422de5d57d075116?s=128&d=identicon&r=PG&f=1", "display_name": "etresevo", "link": "https://stackoverflow.com/users/12556197/etresevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 1, "closed_date": 1576673519, "answer_count": 0, "score": 3, "last_activity_date": 1576644480, "creation_date": 1576644480, "question_id": 59385622, "link": "https://stackoverflow.com/questions/59385622/undefined-reference-to-ttf-init-linking-error-when-compiling-c-file-using-sd", "closed_reason": "Not suitable for this site", "title": "&quot;Undefined reference to TTF_Init()&quot; linking error when compiling C file using SDL", "body": "<p>When using SDL_ttf.h in an SDL project of mine written in C. The compiler (during the linking process as object files show up and it references <code>ld</code>) spits out an error reading </p>\n\n<pre><code>gcc -o ttftesting ttftest.o `sdl2-config --libs --cflags` -LSDL2_ttf -ggdb3 -O0 --std=c99 -lSDL2main -lSDL2\n/usr/bin/ld: ttftest.o: in function `main':\n/home/first/Code/c/testing/ttftest.c:8: undefined reference to `TTF_Init'\n/usr/bin/ld: /home/first/Code/c/testing/ttftest.c:9: undefined reference to `TTF_Quit'\ncollect2: error: ld returned 1 exit status\nmake: *** [Makefile:30: ttftesting] Error 1\n</code></pre>\n\n<p>Here is the source file.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;SDL2/SDL.h&gt;\n#include &lt;SDL2/SDL_ttf.h&gt;\n\nint main(int argc, char *argv[]){\n   SDL_Init(SDL_INIT_TIMER);\n   TTF_Init();\n   TTF_Quit();\n   SDL_Quit();\n   return 0;\n}\n</code></pre>\n\n<pre><code>CFLAGS := `sdl2-config --libs --cflags` -LSDL2_ttf -ggdb3 -O0 --std=c99 -lSDL2main -lSDL2\n</code></pre>\n\n<p>Here is what is in the Makefile.</p>\n\n<p>I'm not too sure what causes this error. I'm running Arch Linux and the libSDLdev libraries are all installed. SDL_tiff.h also is in /usr/include/SDL2/ yet there is a linking error. Is there something wrong with the Makefile's CFLAGS? Did I mess up the order? </p>\n"}, {"tags": ["c++", "c", "printf"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1576647218, "post_id": 59385035, "comment_id": 104963118, "body": "<code>%.3u</code> and <code>%03u</code> are equivalent.  The <a href=\"http://www.open-std.org/jtc1/sc22/wg14/www/C99RationaleV5.10.pdf\" rel=\"nofollow noreferrer\">rationale for the C99 standard</a> says that it prefers the <code>.</code> notation to the <code>0</code> flag \u2014 but the flag isn&#39;t going away because it is used far too widely.  The composite <code>%03.3u</code> combines two equivalent notations \u2014 and gives the same result."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1576647725, "post_id": 59385035, "comment_id": 104963243, "body": "The reference is on p152 of the PDF file: <i>The use of leading zero in field widths to specify zero padding is superseded by a precision field. The older mechanism was retained.</i>"}], "answers": [{"tags": [], "owner": {"reputation": 767708, "user_id": 14860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vXG1F.png?s=128&g=1", "display_name": "paxdiablo", "link": "https://stackoverflow.com/users/14860/paxdiablo"}, "is_accepted": true, "score": 3, "last_activity_date": 1576642707, "last_edit_date": 1576642707, "creation_date": 1576640560, "answer_id": 59385189, "question_id": 59385035, "link": "https://stackoverflow.com/questions/59385035/understand-03-3u-in-printf-format-specification/59385189#59385189", "title": "Understand %03.3u in printf format specification", "body": "<p>The output will be the same for the particular <em>values</em> you have used. The number before the <code>.</code> is the minimum <em>field width</em> while the number after (for the <code>u</code> conversion specifier, at least) it is the minimum number of <em>digits</em> to output. You can see the difference between the two with something like:</p>\n\n<pre><code>printf(\"%3.2u\\n\", 7)\n</code></pre>\n\n<p>which gives you <code><kbd>space</kbd>07</code> - minimum two digits output and minimum three characters wide.</p>\n\n<p>However, the fact that you have the numbers the same means that you'll get three digits minimum in a field at least three characters wide. Even if you had used <code>%03.2u</code> (different minimums), the presence of that <code>0</code> means to left-pad with <code>0</code> rather than <code><kbd>space</kbd></code>, so you'd <em>still</em> see <code>005</code>.</p>\n\n<hr>\n\n<p>Bottom line is, to get the full three digits, you can use the <code>0</code> zero-pad modifier <em>or</em> the minimum digit count modifier but you don't need <em>both.</em></p>\n\n<p>However, since having both doesn't have any adverse effects beyond forcing people to question the sanity of those that wrote it :-), it's <em>functionally</em> okay.</p>\n"}, {"tags": [], "owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "is_accepted": false, "score": 2, "last_activity_date": 1576641058, "creation_date": 1576641058, "answer_id": 59385239, "question_id": 59385035, "link": "https://stackoverflow.com/questions/59385035/understand-03-3u-in-printf-format-specification/59385239#59385239", "title": "Understand %03.3u in printf format specification", "body": "<p>The <code>03</code> is the <em>field width</em> with zero-padding. This means that a minimum of 3 <strong>characters</strong> are to be output, and if there were fewer than three, left-pad with zeroes.</p>\n\n<p>The second <code>3</code> is the minimum number of <strong>digits</strong> to output.</p>\n\n<p>When both of these are specified, the precision will be applied, and if the result is narrower than the minimum field width, then the output will be padded. For example<code>printf(\"q%6.3u\", 5)</code> will produce <code>q   005</code> .  (I use the <code>q</code> because stackoverflow formatting eats the spaces otherwise).</p>\n\n<p>If you're printing an unsigned integer and you didn't use the sign flag,  then the number of digits is the same as the field width (since the only output is digits).  <code>%03u</code>, <code>%.3u</code> and <code>%03.3u</code> all have the same effect.  </p>\n\n<p>I guess the person wrote <code>%03.3u</code> since they did not properly understand the meaning of these things so they guessed something, it worked, and they decided to not make any further changes.</p>\n\n<p>If you print a sign character then the field width differs from the digit count, e.g. you could experiment with <code>%+3u</code> versus <code>%+.3u</code>. Or if you use <code>%d</code> and print a negative number.</p>\n"}], "owner": {"reputation": 1253, "user_id": 2704265, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/519a2a2b5688e294cf4d3f7e914b3415?s=128&d=identicon&r=PG&f=1", "display_name": "alancc", "link": "https://stackoverflow.com/users/2704265/alancc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 0, "accepted_answer_id": 59385189, "answer_count": 2, "score": 0, "last_activity_date": 1576648004, "creation_date": 1576639259, "last_edit_date": 1576648004, "question_id": 59385035, "link": "https://stackoverflow.com/questions/59385035/understand-03-3u-in-printf-format-specification", "title": "Understand %03.3u in printf format specification", "body": "<p>I am using printf to output contents. Now I see the format specification as \"%03.3u\" in another person's code, as per my understanding the \"03\" before the dot already specifies the width of the output as 3 digits, and padding with zeros if there are not 3, while the \"3\" after the dot also specifies that there should be 3 digits output. Therefore, it seems \"03\" before the dot and \"3\" after the dot is duplicated.</p>\n\n<p>I make the following tests:</p>\n\n<pre><code>    char l[50];\n\n    sprintf(l, \"%03.3u\", 5);\n    sprintf(l, \"%03u\", 5);\n    sprintf(l, \"%.3u\", 5);  \n</code></pre>\n\n<p>And confirm the output is always 005. So why someone else should use \"%03.3u\" instead of \"%03u\" or \"%.3u\"?</p>\n"}, {"tags": ["c", "arm", "gnu", "ld", "linker-scripts"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 12551644, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mA8DEGkCbt0T7DvjAuug4RH1M2IlLcJCNi3B6lM=k-s128", "display_name": "Terry_LR", "link": "https://stackoverflow.com/users/12551644/terry-lr"}, "edited": false, "score": 0, "creation_date": 1576658863, "post_id": 59385206, "comment_id": 104967200, "body": "Thank you very much for your reply. But what I mean is to place the binary at 0x80000 in the output image, not VMA address. For example, without firmware binary, the origin image is 200K. The firmware binary is 100K. Then I need to create an combined output image like: &lt;200K origin image&gt; -- &lt;312K unused data (maybe filled with 0x0)&gt; -- &lt;100K firmware binary&gt;."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 11, "user_id": 12551644, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mA8DEGkCbt0T7DvjAuug4RH1M2IlLcJCNi3B6lM=k-s128", "display_name": "Terry_LR", "link": "https://stackoverflow.com/users/12551644/terry-lr"}, "edited": false, "score": 0, "creation_date": 1576686167, "post_id": 59385206, "comment_id": 104981616, "body": "thats just arm...objcopy -O binary in out  once you have your linker script.  see the latter example above the .bin file has padding between the first defined  address space and the other.  you can make as many of these as you desire.  If you are trying to do two programs in one binary it is far simpler to build two separate binaries, and the write the 5-10 line program to combine them into the output you desire.  significantly less work and pain than trying to get gnu to do it."}, {"owner": {"reputation": 11, "user_id": 12551644, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mA8DEGkCbt0T7DvjAuug4RH1M2IlLcJCNi3B6lM=k-s128", "display_name": "Terry_LR", "link": "https://stackoverflow.com/users/12551644/terry-lr"}, "edited": false, "score": 0, "creation_date": 1576722458, "post_id": 59385206, "comment_id": 104993906, "body": "I know the way to combine it even with <i>cat</i> command under linux. But in the code in first image, I need to use fw_image_start value to read binary data out. That&#39;s why I use incbin to add the binary data into output image."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 11, "user_id": 12551644, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mA8DEGkCbt0T7DvjAuug4RH1M2IlLcJCNi3B6lM=k-s128", "display_name": "Terry_LR", "link": "https://stackoverflow.com/users/12551644/terry-lr"}, "edited": false, "score": 0, "creation_date": 1576723448, "post_id": 59385206, "comment_id": 104994085, "body": "various ways to solve this problem without the gnu nightmare, wasnt suggesting cat, that wouldnt be reliable nor desirable.  just a handful/dozen lines of C...much much easier than gnu ld.  But for gnu ld as in other stackoverflow questions you may have to pull in all the objects in the second image into the linker script."}], "tags": [], "owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "is_accepted": false, "score": 2, "last_activity_date": 1576640737, "creation_date": 1576640737, "answer_id": 59385206, "question_id": 59384637, "link": "https://stackoverflow.com/questions/59384637/how-to-to-build-a-binary-into-a-image-at-a-fixed-address-0x80000/59385206#59385206", "title": "How to to build a binary into a image at a fixed address 0x80000?", "body": "<p>What did you find when you looked at the documentation and examples from GNU?  Some of it is admittedly confusing or misleading, but some is pretty easy.  This should give a hit of at least one way to do it (there are multiple ways to solve your problem).</p>\n\n<p>novectors.s</p>\n\n<pre><code>.global _start\n_start:\n    bl notmain\n    b .\n\n.globl bounce\nbounce:\n    bx lr\n\n.section .hello_world\n.word 1,2,3,4\n</code></pre>\n\n<p>notmain.c</p>\n\n<pre><code>void bounce ( unsigned int );\nunsigned int mybss[8];\nint notmain ( void )\n{\n    unsigned int ra;\n\n    for(ra=0;ra&lt;1000;ra++) bounce(ra);\n\n    return(0);\n}\n</code></pre>\n\n<p>memmap.ld</p>\n\n<pre><code>MEMORY\n{\n    ram : ORIGIN = 0x80000, LENGTH = 0x1000\n}\nSECTIONS\n{\n    .text : { *(.text*) } &gt; ram\n    .rodata : { *(.rodata*) } &gt; ram\n    .hello_world : { *(.hello_world) } &gt; ram\n    .bss : { *(.bss*) } &gt; ram\n}\n</code></pre>\n\n<p>build</p>\n\n<pre><code>arm-none-eabi-as --warn --fatal-warnings  novectors.s -o novectors.o\narm-none-eabi-gcc -Wall -Werror -O2 -nostdlib -nostartfiles -ffreestanding -c notmain.c -o notmain.o\narm-none-eabi-ld -o notmain.elf -T memmap.ld novectors.o notmain.o\narm-none-eabi-objdump -D notmain.elf &gt; notmain.list\narm-none-eabi-objcopy notmain.elf notmain.bin -O binary\n</code></pre>\n\n<p>examine results</p>\n\n<pre><code>Disassembly of section .text:\n\n00080000 &lt;_start&gt;:\n   80000:   eb000001    bl  8000c &lt;notmain&gt;\n   80004:   eafffffe    b   80004 &lt;_start+0x4&gt;\n\n00080008 &lt;bounce&gt;:\n   80008:   e12fff1e    bx  lr\n\n0008000c &lt;notmain&gt;:\n   8000c:   e92d4010    push    {r4, lr}\n   80010:   e3a04000    mov r4, #0\n   80014:   e1a00004    mov r0, r4\n   80018:   e2844001    add r4, r4, #1\n   8001c:   ebfffff9    bl  80008 &lt;bounce&gt;\n   80020:   e3540ffa    cmp r4, #1000   ; 0x3e8\n   80024:   1afffffa    bne 80014 &lt;notmain+0x8&gt;\n   80028:   e3a00000    mov r0, #0\n   8002c:   e8bd4010    pop {r4, lr}\n   80030:   e12fff1e    bx  lr\n\nDisassembly of section .hello_world:\n\n00080034 &lt;.hello_world&gt;:\n   80034:   00000001    andeq   r0, r0, r1\n   80038:   00000002    andeq   r0, r0, r2\n   8003c:   00000003    andeq   r0, r0, r3\n   80040:   00000004    andeq   r0, r0, r4\n\nDisassembly of section .bss:\n\n00080034 &lt;mybss&gt;:\n    ...\n</code></pre>\n\n<p>Naturally:</p>\n\n<pre><code>MEMORY\n{\n    bob : ORIGIN = 0x80000, LENGTH = 0x1000\n    ted : ORIGIN = 0xB0000, LENGTH = 0x1000\n}\nSECTIONS\n{\n    .text : { *(.text*) } &gt; bob\n    .rodata : { *(.rodata*) } &gt; bob\n    .hello_world : { *(.hello_world) } &gt; ted\n    .bss : { *(.bss*) } &gt; ted\n}\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>Disassembly of section .text:\n\n00080000 &lt;_start&gt;:\n   80000:   eb000001    bl  8000c &lt;notmain&gt;\n   80004:   eafffffe    b   80004 &lt;_start+0x4&gt;\n\n00080008 &lt;bounce&gt;:\n   80008:   e12fff1e    bx  lr\n\n0008000c &lt;notmain&gt;:\n   8000c:   e92d4010    push    {r4, lr}\n   80010:   e3a04000    mov r4, #0\n   80014:   e1a00004    mov r0, r4\n   80018:   e2844001    add r4, r4, #1\n   8001c:   ebfffff9    bl  80008 &lt;bounce&gt;\n   80020:   e3540ffa    cmp r4, #1000   ; 0x3e8\n   80024:   1afffffa    bne 80014 &lt;notmain+0x8&gt;\n   80028:   e3a00000    mov r0, #0\n   8002c:   e8bd4010    pop {r4, lr}\n   80030:   e12fff1e    bx  lr\n\nDisassembly of section .hello_world:\n\n000b0000 &lt;.hello_world&gt;:\n   b0000:   00000001    andeq   r0, r0, r1\n   b0004:   00000002    andeq   r0, r0, r2\n   b0008:   00000003    andeq   r0, r0, r3\n   b000c:   00000004    andeq   r0, r0, r4\n\nDisassembly of section .bss:\n\n000b0000 &lt;mybss&gt;:\n    ...\n</code></pre>\n\n<p>and as demonstrated the name ram, rom, etc are not special can call it other things like bob, ted, alice...I assume there are some reserved words you cant use.</p>\n\n<p>Again there are numerous solutions, see the GNU documentation, I like this method as it reads better for me, but you will see solutions that skip the MEMORY part.</p>\n\n<p>(no this wasnt intended to be completely correct code, but demonstrates the assembly language bootstrap, the C code and the linker script).</p>\n"}], "owner": {"reputation": 11, "user_id": 12551644, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mA8DEGkCbt0T7DvjAuug4RH1M2IlLcJCNi3B6lM=k-s128", "display_name": "Terry_LR", "link": "https://stackoverflow.com/users/12551644/terry-lr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1576742906, "creation_date": 1576636000, "last_edit_date": 1576742906, "question_id": 59384637, "link": "https://stackoverflow.com/questions/59384637/how-to-to-build-a-binary-into-a-image-at-a-fixed-address-0x80000", "title": "How to to build a binary into a image at a fixed address 0x80000?", "body": "<p>In our c project, we need to build a binary firmware into a image at a fixed file offset 0x80000.</p>\n\n<p>Then when the image is loaded to memory. We can load firmware from offset 0x80000 to a specified address.\n  Meanwhile, as the firmware is placed at file offset 0x80000, we can upgrade the firmare independently.</p>\n\n<p>So I'm trying to use GNU linker script to implement that.\n  What I do now is use incbin to include my binary file in a asm file.\n  And in linker script, my code is:</p>\n\n<pre><code>       .fw_image_start : {\n                *(.__fw_image_start)\n        }\n\n       .fw_image : {\n              KEEP(*(.fw_image))\n        }\n\n       .fw_image_end : {\n                *(.__fw_image_end)\n        }\n\n</code></pre>\n\n<p>Then I can use fw_image_start to load firmware in image code.</p>\n\n<p>But I still can't find a way to put the firmware binary to file offset 0x80000 in the final image.</p>\n\n<p>Could you help me on this?</p>\n\n<p>Thank you in advance!</p>\n"}, {"tags": ["c", "fread", "cs50"], "comments": [{"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 0, "creation_date": 1576637595, "post_id": 59384556, "comment_id": 104961252, "body": "Please see my answer below. When I made those changes to your code it worked for me with a test JPG file. However, your debug data suggests there may be other problems. But let me know how that goes."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 0, "creation_date": 1576639625, "post_id": 59384556, "comment_id": 104961588, "body": "<code>int f_length = ftell(fp);</code> is wrong. See <a href=\"http://man7.org/linux/man-pages/man3/fseek.3.html\" rel=\"nofollow noreferrer\">man ftell</a> -- what <code>type</code> does <code>ftell</code> return?. If you have length, and you <code>malloc(f_length);</code> (don&#39;t cast the return of <code>malloc</code>), then why do you <code>while(fread(buffer, 512, 1, fp) == 1)</code> instead of <code>if (fread (buffer, lenfth, 1, fp) != 1) { &#47;* handle error *&#47; }</code>? As @kaylum explained, you want <code>unsigned char *buffer;</code> not <code>int*</code>..."}], "answers": [{"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1576639716, "post_id": 59384811, "comment_id": 104961611, "body": "May want to point out the other issues as well and explain there is no need to cast the return of <code>malloc</code>, it is unnecessary. See: <a href=\"http://stackoverflow.com/q/605845/995714\">Do I cast the result of malloc?</a> Also worth mentioning that the <code>else</code> is superfluous -- it just adds unnecessary indentation. You already <code>return</code> in the <code>if</code> block."}], "tags": [], "owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "is_accepted": true, "score": 1, "last_activity_date": 1576637526, "creation_date": 1576637526, "answer_id": 59384811, "question_id": 59384556, "link": "https://stackoverflow.com/questions/59384556/how-can-i-properly-print-the-bytes-of-a-jpeg-file-cs50-pset3-recover/59384811#59384811", "title": "How can I properly print the bytes of a JPEG file? - CS50 PSET3 Recover", "body": "<p><code>int *buffer</code> is not correct because the intention is to deal with bytes and not ints. If <code>int *</code> is used, then for example, <code>buffer[0]</code> will be the first 4 bytes and not the first byte as intended. Change that to <code>unsigned char *buffer</code>. </p>\n\n<p>So explicitly, that line should be the following (including removing the unnecessary cast):</p>\n\n<pre><code>unsigned char *buffer = malloc(f_length);\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 12555613, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UiQD1.jpg?s=128&g=1", "display_name": "TheDude1256", "link": "https://stackoverflow.com/users/12555613/thedude1256"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 59384811, "answer_count": 1, "score": 0, "last_activity_date": 1576637526, "creation_date": 1576635159, "question_id": 59384556, "link": "https://stackoverflow.com/questions/59384556/how-can-i-properly-print-the-bytes-of-a-jpeg-file-cs50-pset3-recover", "title": "How can I properly print the bytes of a JPEG file? - CS50 PSET3 Recover", "body": "<p>I am trying to use fread on a file containing multiple JPEGs and write the JPEGs into new files, but before I can do that I need to properly look through the file and look for the JPEGs based on their first bytes based on the if statement at the bottom of the code below.</p>\n\n<p>I have not been able to get into the if statement, and have been trying to print out the bytes, but I have been running into issues in printing.</p>\n\n<p>I'm looking to print just the 0 byte of the buffer, but my output is looking like this:\n711151a6\ncec117f0\n7603c9a9\n73599166</p>\n\n<p>I'm very new to C and fread, and any help would be appreciated!</p>\n\n<p>Code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(int argc, char *argv[])\n{\n    // Check for 2 arguments, the name of the program and the file being read\n    if (argc != 2)\n    {\n        printf(\"Usage: ./recover image\\n\");\n        return 1;\n    }\n    else\n    {\n        //Open the file\n        FILE * fp;\n        fp = fopen(argv[1], \"r\");\n\n        //Get file length\n        fseek(fp, 0, SEEK_END);\n        int f_length = ftell(fp);\n        fseek(fp, 0, SEEK_SET);\n\n        // If not file is found then exit\n        if(fp == NULL)\n        {\n            printf(\"File not found\\n\");\n            return 2;\n        }\n\n        // Allocate buffer for fread function\n        int *buffer = (int*)malloc(f_length);\n        if (buffer == NULL)\n        {\n            printf(\"Buffer is null\\n\");\n            return 1;\n        }\n\n        // Read thorugh the file\n        while(fread(buffer, 512, 1, fp) == 1)\n        {\n\n\n            for (int i = 0; i &lt; 1; i++)\n            {\n                printf(\"%x\\n\", buffer[i]);\n            }\n\n            if (buffer[0] == 0xff &amp;&amp; buffer[1] == 0xd8 &amp;&amp; buffer[2] == 0xff &amp;&amp; (buffer[3] &amp; 0xf0) == 0xe0)\n            {\n                printf(\"Found a jpg\\n\");\n            }\n        }\n\n        // Exit the program\n        return 0;\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "sdk", "sketchup"], "answers": [{"tags": [], "owner": {"reputation": 15, "user_id": 12359605, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gkT_1uB3BAQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcn8CagUf9621K0bu1PrOcufhwhIQ/photo.jpg?sz=128", "display_name": "cloud", "link": "https://stackoverflow.com/users/12359605/cloud"}, "is_accepted": false, "score": 0, "last_activity_date": 1576636796, "last_edit_date": 1576636796, "creation_date": 1576634493, "answer_id": 59384495, "question_id": 59384343, "link": "https://stackoverflow.com/questions/59384343/how-to-get-the-material-of-group-in-sketchup/59384495#59384495", "title": "how to get the Material of group in sketchup?", "body": "<p>I found the answer, convert the group object into an entity, and then get the texture of the entity through the <code>SUTextureWriterLoadEntity</code> method\u3002</p>\n\n<pre><code>SUGroupRef _group\uff1b\nlong EntityTextureId = 0;    \nSUTextureWriterLoadEntity(m_uvWrite, SUGroupToEntity(_group), &amp;EntityTextureId)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2208, "user_id": 6584878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eef2518f750afd08b60ab22d5ec9ddb8?s=128&d=identicon&r=PG&f=1", "display_name": "avariant", "link": "https://stackoverflow.com/users/6584878/avariant"}, "is_accepted": true, "score": 0, "last_activity_date": 1582141605, "creation_date": 1582141605, "answer_id": 60308094, "question_id": 59384343, "link": "https://stackoverflow.com/questions/59384343/how-to-get-the-material-of-group-in-sketchup/60308094#60308094", "title": "how to get the Material of group in sketchup?", "body": "<p>A face can have a front material (and back material) and still be in a group with a group material.  In fact it's very common.  In that case, the face material takes precedence over the group material.</p>\n\n<pre><code>SU_RESULT SUFaceGetFrontMaterial(SUFaceRef face, SUMaterialRef* material);\nSU_RESULT SUFaceGetBackMaterial(SUFaceRef face, SUMaterialRef* material);\n</code></pre>\n\n<p>In addition, there is a much more direct way to get the material of a group.</p>\n\n<pre><code>SUDrawingElementRef draw = SUGroupToDrawingElement(group);\nSUMaterialRef material = SU_INVALID;\nSUDrawingElementGetMaterial(draw, &amp;material);\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 12359605, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gkT_1uB3BAQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcn8CagUf9621K0bu1PrOcufhwhIQ/photo.jpg?sz=128", "display_name": "cloud", "link": "https://stackoverflow.com/users/12359605/cloud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 60308094, "answer_count": 2, "score": 0, "last_activity_date": 1582141605, "creation_date": 1576632798, "question_id": 59384343, "link": "https://stackoverflow.com/questions/59384343/how-to-get-the-material-of-group-in-sketchup", "title": "how to get the Material of group in sketchup?", "body": "<p>I have done iterating through the entities in a group, getting all the faces, and then getting the material of each face. However, if the material belongs to a group, there is no material on the face. How do I get the material of the group in this case? I use the C API.</p>\n"}, {"tags": ["c", "gcc", "fpu", "amiga"], "comments": [{"owner": {"reputation": 4593, "user_id": 105104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b23920ac852e946b333d3f9d0d95c1?s=128&d=identicon&r=PG", "display_name": "dvhh", "link": "https://stackoverflow.com/users/105104/dvhh"}, "edited": false, "score": 1, "creation_date": 1576634216, "post_id": 59384338, "comment_id": 104960639, "body": "what is your emulator ? that might help for having some insight into your issue"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 2, "creation_date": 1576638171, "post_id": 59384338, "comment_id": 104961338, "body": "What does it print for <code>printf(&quot;%f\\n&quot;, -0.);</code>? What for <code>%g</code> or <code>%e</code>?"}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 1, "creation_date": 1576639027, "post_id": 59384338, "comment_id": 104961466, "body": "gcc 2.7.0 is too old. I don&#39;t think any bug fixing will happen on it"}, {"owner": {"reputation": 55, "user_id": 1586676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f11313cfa5788cd177e23e1b1f56d8b9?s=128&d=identicon&r=PG", "display_name": "lasermc", "link": "https://stackoverflow.com/users/1586676/lasermc"}, "edited": false, "score": 1, "creation_date": 1576647634, "post_id": 59384338, "comment_id": 104963216, "body": "I can&#39;t see a reply button, so I hope the users commenting know I responded....%f with -0. gives 1.:00000  and %g with -0. gives 1.: and %e with 0. gives 1.:00000+00.  And the emulator is WinUAE."}, {"owner": {"reputation": 55, "user_id": 1586676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f11313cfa5788cd177e23e1b1f56d8b9?s=128&d=identicon&r=PG", "display_name": "lasermc", "link": "https://stackoverflow.com/users/1586676/lasermc"}, "reply_to_user": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 0, "creation_date": 1576648184, "post_id": 59384338, "comment_id": 104963337, "body": "@phuclv I know 2.7.0 is too old.  I tried the code on a linux machine (x86 not 68000) and predictably it worked fine, so either it&#39;s specific to 68000/68881 or it was fixed a long time ago (just not in 2.7.0).  I was just hoping there was some command line argument that would bypass problem (or even a printf format option)."}, {"owner": {"reputation": 55, "user_id": 1586676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f11313cfa5788cd177e23e1b1f56d8b9?s=128&d=identicon&r=PG", "display_name": "lasermc", "link": "https://stackoverflow.com/users/1586676/lasermc"}, "reply_to_user": {"reputation": 4593, "user_id": 105104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b23920ac852e946b333d3f9d0d95c1?s=128&d=identicon&r=PG", "display_name": "dvhh", "link": "https://stackoverflow.com/users/105104/dvhh"}, "edited": false, "score": 1, "creation_date": 1576648265, "post_id": 59384338, "comment_id": 104963364, "body": "@dvhh WinUAE is the emulator (in case you didn&#39;t see it in my other comment)"}, {"owner": {"reputation": 32308, "user_id": 20270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37335856df5e5e73d82bca5a805bd647?s=128&d=identicon&r=PG", "display_name": "Hasturkun", "link": "https://stackoverflow.com/users/20270/hasturkun"}, "edited": false, "score": 2, "creation_date": 1576656018, "post_id": 59384338, "comment_id": 104966019, "body": "I&#39;ve done a very quick search, and it looks like someone maintains a fork of GCC 6.5 for amiga, at least (with associated cross toolchain). links: <a href=\"https://github.com/bebbo/amiga-gcc/\" rel=\"nofollow noreferrer\">github.com/bebbo/amiga-gcc</a> <a href=\"https://github.com/bebbo/gcc\" rel=\"nofollow noreferrer\">github.com/bebbo/gcc</a> <a href=\"https://franke.ms/amiga/gcc.wiki\" rel=\"nofollow noreferrer\">franke.ms/amiga/gcc.wiki</a> . Someone also seems to maintain a fork of GCC 8.1, <a href=\"https://github.com/mooli/gcc-amiga/\" rel=\"nofollow noreferrer\">github.com/mooli/gcc-amiga</a> and <a href=\"https://retrocomputing.stackexchange.com/q/605\">retrocomputing.stackexchange.com/q/605</a> (Disregard this if irrelevant, I think I missed that you might want to compile on Amiga)"}, {"owner": {"reputation": 55, "user_id": 1586676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f11313cfa5788cd177e23e1b1f56d8b9?s=128&d=identicon&r=PG", "display_name": "lasermc", "link": "https://stackoverflow.com/users/1586676/lasermc"}, "reply_to_user": {"reputation": 32308, "user_id": 20270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37335856df5e5e73d82bca5a805bd647?s=128&d=identicon&r=PG", "display_name": "Hasturkun", "link": "https://stackoverflow.com/users/20270/hasturkun"}, "edited": false, "score": 0, "creation_date": 1576657437, "post_id": 59384338, "comment_id": 104966610, "body": "@Hasturkun Thanks for the links, I&#39;ll check them out when I get a chance.  I did look at aminet.net further - there are newer gcc&#39;s but they run on i386/i686 (I guess for those Amiga-like linux&#39;s?), and some that are cross-compilers."}], "answers": [{"tags": [], "owner": {"reputation": 55, "user_id": 1586676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f11313cfa5788cd177e23e1b1f56d8b9?s=128&d=identicon&r=PG", "display_name": "lasermc", "link": "https://stackoverflow.com/users/1586676/lasermc"}, "is_accepted": false, "score": 0, "last_activity_date": 1577345940, "creation_date": 1577345940, "answer_id": 59485363, "question_id": 59384338, "link": "https://stackoverflow.com/questions/59384338/floating-point-multiply-bug-using-gcc-2-7-0-on-amiga-with-68881-any-fixes-work/59485363#59485363", "title": "Floating Point Multiply Bug Using gcc 2.7.0 on Amiga with 68881 - Any Fixes/Workarounds?", "body": "<p>This isn't exactly an answer, but a revelation that the problem is rather complicated (more so than a simple bug with gcc).  Here's the info:</p>\n\n<p>If I set the Amiga emulator to emulate a 68020 or a 68030 and a 68881 or a 68882 INSTEAD of a 68040 using the 68040's internal FPU it doesn't produce the 1.:00000 (in other words, it works).  So that could mean the emulator is to blame for not emulating the 68040's FPU correctly (though I imagine the 68040's FPU is likely compatible with the 68881/68882).  (Don't know if there's a performance hit in setting the emulator to 68020/30 68881/2 (I have the emulator set to run as fast as possible on the host machine instead of going at the speed of the 680xx)).</p>\n\n<p>However, if I compile with the Amiga's gcc's -noixemul option, the code works correctly in every combination of CPU and FPU.  So that would indicate it's a problem with the Amiga's version of gcc (really the part of the gcc system that tries to emulate UNIX on an Amiga (that is what ixemul.library does)).  So that might not be gcc's fault (if it were compiled on some other system that uses a 68040 it would probably work), but the fault of the people who ported gcc to Amiga.</p>\n\n<p>So, you might say \"problem solved, just use -noixemul\" - well not so fast...  Although the simple test program doesn't crash, my bigger program that exposed this problem crashes on program exit (recoverable GURU meditation) only when compiled with -noixemul (perhaps it's trying to close a library that was never opened, I don't know).  This is why I didn't use -noixemul even though I wanted to.</p>\n\n<p>So, it's not exactly solved, but I would say it's not likely a non-Amiga gcc bug.</p>\n"}], "owner": {"reputation": 55, "user_id": 1586676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f11313cfa5788cd177e23e1b1f56d8b9?s=128&d=identicon&r=PG", "display_name": "lasermc", "link": "https://stackoverflow.com/users/1586676/lasermc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1577345940, "creation_date": 1576632728, "last_edit_date": 1576634086, "question_id": 59384338, "link": "https://stackoverflow.com/questions/59384338/floating-point-multiply-bug-using-gcc-2-7-0-on-amiga-with-68881-any-fixes-work", "title": "Floating Point Multiply Bug Using gcc 2.7.0 on Amiga with 68881 - Any Fixes/Workarounds?", "body": "<p>For the heck of it, I decided to see if a program I started writing on an Amiga many years ago and much further developed on other machines would still compile and run on an Amiga (after being developed on other machines).  I originally used Lattice C because that's what I used before.  But the 68881 support in Lattice is VERY buggy.  So I decided to try gcc.  I think the most recent version of gcc for Amiga is 2.7.0 (so I can't upgrade).  It's worked rather well except for one bug in 68881 support:  When multiplying any negative number by zero, the result is always:</p>\n\n<p><code>1.:00000</code></p>\n\n<p>when printed out (colon is NOT a typo).  BTW, if you set x to zero, then print out, it's 0.00000 like it should be.</p>\n\n<p>Here's a sample program to test the bug, it doesn't matter which variable is 0 and which is negative, and if the non-zero value is positive, it works fine.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n\nmain()\n{\n    float x,a,b;\n\n    a=-10.0;\n    b=0.0;\n    x=a*b;\n    printf(\"%f\\n\",x);\n}\n</code></pre>\n\n<p>and it's compiled with:  <code>gcc -o tt -m68020 -m68881 tt.c -lm</code></p>\n\n<p>Taking out <code>-m68881</code> works fine (but of course, doesn't use the FPU)\nTaking out <code>-lm</code> and/or <code>math.h</code> makes no difference.</p>\n\n<p>Does anyone know of a bug fix or workaround?  Maybe a gcc command line argument?  (would rather not have to do UGLY things like \"<code>if ((a&lt;0)&amp;&amp;(b==0))</code>\")</p>\n\n<p>BTW, since I don't have a working Amiga anymore, I've had to use an emulator.  If you want to see what I've been doing on this project (using Lattice C version), you can view my video at:</p>\n\n<p><a href=\"https://www.youtube.com/watch?v=x8O-qYQvP4M\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=x8O-qYQvP4M</a></p>\n\n<p>(Amiga part starts at 10:07)</p>\n\n<p>Thanks for any help.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 117699, "user_id": 62576, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/15264f7bf48e10ce32dfa4865a13763c?s=128&d=identicon&r=PG", "display_name": "Ken White", "link": "https://stackoverflow.com/users/62576/ken-white"}, "edited": false, "score": 3, "creation_date": 1576629854, "post_id": 59384025, "comment_id": 104959842, "body": "You can&#39;t post some random, totally out of context characters of (presumably) code here and expect us to explain it to you. Without other code that gives that any chance of having meaning, it can&#39;t be explained. Also, <i>can you tell me what is going on here?</i> is not any sort of meaningful title or question. You&#39;ll find your experiences here will be much better if you spend some time taking the <a href=\"https://stackoverflow.com/tour\">tour</a> and reading the <a href=\"https://stackoverflow.com/help\">help center</a> pages (especially <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>) to learn how the site works and what our expectations are before you begin posting."}, {"owner": {"reputation": 6031, "user_id": 10871900, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-noQwojQppnY/AAAAAAAAAAI/AAAAAAAAACs/59RU8UyHFSk/photo.jpg?sz=128", "display_name": "dan1st", "link": "https://stackoverflow.com/users/10871900/dan1st"}, "edited": false, "score": 0, "creation_date": 1576647970, "post_id": 59384025, "comment_id": 104963292, "body": "I would say, that would result in a compilation error or a SEGENV(Segmentation fault)"}, {"owner": {"reputation": 6746, "user_id": 8185995, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02d69271095c22ec7a2f5cad43ea3ac0?s=128&d=identicon&r=PG&f=1", "display_name": "robthebloke", "link": "https://stackoverflow.com/users/8185995/robthebloke"}, "reply_to_user": {"reputation": 6031, "user_id": 10871900, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-noQwojQppnY/AAAAAAAAAAI/AAAAAAAAACs/59RU8UyHFSk/photo.jpg?sz=128", "display_name": "dan1st", "link": "https://stackoverflow.com/users/10871900/dan1st"}, "edited": false, "score": 0, "creation_date": 1576650888, "post_id": 59384025, "comment_id": 104964097, "body": "@dan1st Nope. See my answer below. it is valid C/C++"}, {"owner": {"reputation": 6031, "user_id": 10871900, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-noQwojQppnY/AAAAAAAAAAI/AAAAAAAAACs/59RU8UyHFSk/photo.jpg?sz=128", "display_name": "dan1st", "link": "https://stackoverflow.com/users/10871900/dan1st"}, "reply_to_user": {"reputation": 6746, "user_id": 8185995, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02d69271095c22ec7a2f5cad43ea3ac0?s=128&d=identicon&r=PG&f=1", "display_name": "robthebloke", "link": "https://stackoverflow.com/users/8185995/robthebloke"}, "edited": false, "score": 0, "creation_date": 1576651087, "post_id": 59384025, "comment_id": 104964166, "body": "@robthebloke ok..."}, {"owner": {"reputation": 6746, "user_id": 8185995, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02d69271095c22ec7a2f5cad43ea3ac0?s=128&d=identicon&r=PG&f=1", "display_name": "robthebloke", "link": "https://stackoverflow.com/users/8185995/robthebloke"}, "reply_to_user": {"reputation": 6031, "user_id": 10871900, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-noQwojQppnY/AAAAAAAAAAI/AAAAAAAAACs/59RU8UyHFSk/photo.jpg?sz=128", "display_name": "dan1st", "link": "https://stackoverflow.com/users/10871900/dan1st"}, "edited": false, "score": 0, "creation_date": 1576651139, "post_id": 59384025, "comment_id": 104964185, "body": "@dan1st Admittedly it&#39;s not a coding style I&#39;d recommend :)"}], "answers": [{"tags": [], "owner": {"reputation": 6746, "user_id": 8185995, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02d69271095c22ec7a2f5cad43ea3ac0?s=128&d=identicon&r=PG&f=1", "display_name": "robthebloke", "link": "https://stackoverflow.com/users/8185995/robthebloke"}, "is_accepted": false, "score": 1, "last_activity_date": 1576650858, "creation_date": 1576650858, "answer_id": 59386621, "question_id": 59384025, "link": "https://stackoverflow.com/questions/59384025/can-you-tell-me-what-is-going-on-here/59386621#59386621", "title": "Can you tell me what is going on here", "body": "<p>Technically speaking, that is valid C code, but it is not worth writing it like that. Consider this stupid example. </p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>char v = array[3];\n</code></pre>\n\n<p>Now, we can rewrite that in pointer arithmetic. e.g.</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>char v = *(array + 3);\n</code></pre>\n\n<p>However, since addition is commutative, it follows that this is also valid:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>char v = *(3 + array);\n</code></pre>\n\n<p>And since addition is commutative, it therefore follows that array brackets are also commutative. So this is perfectly valid in C:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>char v = 3[array];\n</code></pre>\n\n<p>If you wish to untangle the code you've posted, you can do it in steps.... </p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>float f0(float*** ptr)\n{\n    return -1[0[ptr]][0];\n}\nfloat f1(float*** ptr)\n{\n    return -1[ptr[0]][0];\n}\nfloat f2(float*** ptr)\n{\n    return -ptr[0][1][0];\n}\n</code></pre>\n\n<p>And here is the proof they are the same:</p>\n\n<p><a href=\"https://godbolt.org/z/_gSUXF\" rel=\"nofollow noreferrer\">https://godbolt.org/z/_gSUXF</a></p>\n\n<p>(f2 and f3 just result in tail calls to f1)</p>\n\n<p>/edit I think it's a little unfair you've been marked down so harshly for asking this question. It's actually a cool quirk of C/C++ that very few people know. </p>\n"}], "owner": {"reputation": 5, "user_id": 9037980, "user_type": "registered", "profile_image": "https://graph.facebook.com/1301846213295077/picture?type=large", "display_name": "Deepak Shekhawat", "link": "https://stackoverflow.com/users/9037980/deepak-shekhawat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "closed_date": 1576749256, "answer_count": 1, "score": -13, "last_activity_date": 1576650858, "creation_date": 1576629421, "last_edit_date": 1576631102, "question_id": 59384025, "link": "https://stackoverflow.com/questions/59384025/can-you-tell-me-what-is-going-on-here", "closed_reason": "Duplicate", "title": "Can you tell me what is going on here", "body": "<p>What is going on here in this line:   </p>\n\n<pre><code>-1[0[ptr]][0] \n</code></pre>\n"}, {"tags": ["c", "csv", "lib"], "comments": [{"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 0, "creation_date": 1576627265, "post_id": 59383504, "comment_id": 104959319, "body": "Use <code>fgets</code> to read a single line of the file (ie, the first row) and then call <code>csv_parse</code> with just that read data."}, {"owner": {"reputation": 531, "user_id": 8339821, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0148d1cfa01aea7231cf3195f54f2d78?s=128&d=identicon&r=PG&f=1", "display_name": "user14063792468", "link": "https://stackoverflow.com/users/8339821/user14063792468"}, "reply_to_user": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 0, "creation_date": 1576637223, "post_id": 59383504, "comment_id": 104961172, "body": "@kaylum won\u2019t do because csv fields might contain newlines as well."}], "owner": {"reputation": 531, "user_id": 8339821, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0148d1cfa01aea7231cf3195f54f2d78?s=128&d=identicon&r=PG&f=1", "display_name": "user14063792468", "link": "https://stackoverflow.com/users/8339821/user14063792468"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576625082, "creation_date": 1576625082, "question_id": 59383504, "link": "https://stackoverflow.com/questions/59383504/please-advise-with-libcsv-i-need-to-read-only-first-row", "title": "Please advise with libcsv. I need to read only first row", "body": "<p>I had successfully used <code>libcsv</code> to parse <code>CSV</code> files. Fast and simple to use, I tell you. But now comes a situation where I am a little stuck. Being able to parse file as whole, now I need to parse only first row.</p>\n\n<p>My basic usage(not too far from the official documentation) is following:</p>\n\n<pre><code>typedef struct data_t {\n &lt;...&gt;\n} data_t;\n...\nvoid cb_f(void *s, size_t len, void *data) {\n...\n}\nvoid cb_r(int c, void *data) {\n ((counts*)data)-&gt;rows++;\n}\n...\nstruct csv_parser  p;\ndata_t             data;\n...\nif(csv_parse(&amp;p, buf, fsize, cb_f, cb_r, &amp;data) != fsize) {\n fprintf(stderr, \" * while parsing file: %s\\n\", csv_strerror(csv_error(&amp;p)) );\n return 1;\n}\n...\ncsv_fini(&amp;p, NULL, NULL, NULL);\n</code></pre>\n\n<p>Now I need to somehow stop the parser after it had processed the first row of a <code>CSV</code> file. \nI did try to call <code>csv_fini(&amp;p, NULL, NULL, NULL);</code> in the row callback, <code>cb_r</code>, early. No luck, the parser stops only after parsing whole buffer.</p>\n\n<p>Any suggestions of how to change the <code>libcsv</code> parser operation mode ?</p>\n"}, {"tags": ["c", "macros", "declaration"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1576624410, "post_id": 59383345, "comment_id": 104958662, "body": "Is the problem to define this macro, or is this a problem you&#39;re trying to solve <i>with</i> the macro? C arrays are zero-indexed. The need for` ENTRY` goes away if you just accept that."}, {"owner": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "edited": false, "score": 3, "creation_date": 1576625067, "post_id": 59383345, "comment_id": 104958814, "body": "Why was this question marked as off-topic?"}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 1, "creation_date": 1576625217, "post_id": 59383345, "comment_id": 104958855, "body": "I don&#39;t know if this was a genuine typo, but it might not be, given that elsewhere in C and the preprocessor, whitespace is insignificant. Was it a typo, @vincent.perl99?"}], "answers": [{"comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1576624436, "post_id": 59383379, "comment_id": 104958667, "body": "Should even be <code>(a[(b)-1])</code> to be thorough."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 1, "creation_date": 1576624487, "post_id": 59383379, "comment_id": 104958680, "body": "@M.M Even better, yes."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1578491117, "post_id": 59383379, "comment_id": 105455324, "body": "And this is the reason why the C standard syntax is written in such a peculiar manner: <code># define identifier lparen identifier-listopt ) replacement-list new-line</code>. They defined an item <i>lparen</i> for the left brace, whereas the right brace is simply listed as <code>)</code>. Looking at the definition for <i>lparen</i> in turn, it is: &quot;a <code>(</code> character not immediately preceded by white-space&quot;."}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1578491618, "post_id": 59383379, "comment_id": 105455585, "body": "@Lundin Thanks. I had hyperlinked this part of the standard but I have now included it in the answer as well so it&#39;s easier to see."}], "tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": false, "score": 7, "last_activity_date": 1578491874, "last_edit_date": 1578491874, "creation_date": 1576624110, "answer_id": 59383379, "question_id": 59383345, "link": "https://stackoverflow.com/questions/59383345/incorrect-expansion-of-a-function-like-macro/59383379#59383379", "title": "Incorrect expansion of a function-like macro", "body": "<p>Function-like macro definitions can't have <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.10\" rel=\"nofollow noreferrer\">whitespace</a> after the macro name</p>\n\n<pre><code>#define ENTRY (a,b) (a[b-1])              // wrong\n</code></pre>\n\n<p>=></p>\n\n<pre><code>#define ENTRY(a,b) ((a)[(b)-1])               // correct\n</code></pre>\n\n<p><a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.10\" rel=\"nofollow noreferrer\">6.10 \u2013 Preprocessing directives</a>:</p>\n\n<blockquote>\n  <p>...</p>\n  \n  <p>control-line:<br>\n  ...</p>\n  \n  <p><code># define</code> <em>identifier</em> <em>lparen</em> <em>identifier-listopt</em> <code>)</code> <em>replacement-list new-line</em><br>\n   <code># define</code> <em>identifier</em> <em>lparen</em> <code>... )</code> <em>replacement-list</em> <em>new-line</em><br>\n   <code># define</code> <em>identifier</em> <em>lparen</em> <em>identifier-list</em> <code>, ... )</code> <em>replacement-list</em> <em>new-line</em>  </p>\n  \n  <p>... </p>\n  \n  <p>lparen:<br>\n     a <code>(</code> character not immediately preceded by white-space</p>\n</blockquote>\n\n<p>With the space, you get an object-like macro that expands to <code>(a,b) (a[b-1])</code>.</p>\n\n<p>(For additional robustness, it's also recommended to parenthesize the parameters so that it also works if you pass in more complex expressions.)</p>\n"}], "owner": {"reputation": 67, "user_id": 12393995, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8f8008a153705e7ca277ab0ac191d11?s=128&d=identicon&r=PG&f=1", "display_name": "vincent.perl99", "link": "https://stackoverflow.com/users/12393995/vincent-perl99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1578491874, "creation_date": 1576623902, "last_edit_date": 1578491108, "question_id": 59383345, "link": "https://stackoverflow.com/questions/59383345/incorrect-expansion-of-a-function-like-macro", "title": "Incorrect expansion of a function-like macro", "body": "<p>Good evening,<br>\nI have a problem with macros. I am supposed to come up with a macro <code>ENTRY</code>, that puts a value into an array ( <code>scanf(\"%d\",&amp;ENTRY(x,i))</code> was given).  </p>\n\n<p>I tried: <code>#define ENTRY (a,b) (a[b-1])</code>, but that didn't work.<br>\nIt created a compiler error that says, that a and b are undeclared.<br>\nBut I thought that I don't have to declare variables used in macros, especially because, for example: <code>#define min (a,b) ((a)&lt;(b)?(a):(b))</code> worked in another program. </p>\n\n<p>So what am I doing wrong here?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#define N 3\n#define ENTRY (a,b) (a[b-1])\n\nint main(void)\n{\n\n    int x[N],i;\n    float y[N];\n\n    for(i=1;i&lt;=N;i++){ printf(\"x_%d = \",i);scanf(\"%d\",&amp;ENTRY(x,i));}\n    for(i=1;i&lt;=N;i++){ printf(\"y_%d = \",i);scanf(\"%lf\",&amp;ENTRY(y,i));}\n\n    return 0\n}\n</code></pre>\n"}, {"tags": ["c", "char", "ascii", "cs50", "alphabetical"], "comments": [{"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1576623144, "post_id": 59383223, "comment_id": 104958331, "body": "Don&#39;t use <code>c % 32</code>, that filters out the case."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1576623208, "post_id": 59383223, "comment_id": 104958347, "body": "Use <code>c - &#39;a&#39;</code> for lowercase, and <code>c - &#39;A&#39;</code> for uppercase. Also, you should use <code>isupper()</code> and <code>islower()</code> rather than hard-coding ASCII codes."}, {"owner": {"reputation": 29, "user_id": 2513526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba4f57d7c31d7faee4cf2a560a0c322d?s=128&d=identicon&r=PG", "display_name": "Fransweezy", "link": "https://stackoverflow.com/users/2513526/fransweezy"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1576623317, "post_id": 59383223, "comment_id": 104958386, "body": "Ok so should i put c - &#39;a&#39; in the &quot;if&quot; before print which has atoi?"}, {"owner": {"reputation": 475, "user_id": 8378383, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-AsKVCZLfAu4/AAAAAAAAAAI/AAAAAAAABWg/5-E_XUykXNw/photo.jpg?sz=128", "display_name": "Nuno Palma", "link": "https://stackoverflow.com/users/8378383/nuno-palma"}, "edited": false, "score": 0, "creation_date": 1576624976, "post_id": 59383223, "comment_id": 104958801, "body": "If you have to manipulate the original string, why don&#39;t you simply copy it into a &quot;placeholder&quot; using <code>strcpy</code> ?"}, {"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 1, "creation_date": 1576626405, "post_id": 59383223, "comment_id": 104959122, "body": "Don&#39;t use magic numbers. Don&#39;t expect the reader to know what <code>97</code> and <code>122</code> means. Character constants <code>&#39;a&#39;</code> and <code>&#39;z&#39;</code> are better (they&#39;re even of type <code>int</code>). Even better, don&#39;t make assumptions about the numeric values of letters; see <code>isupper()</code>, <code>islower()</code>, <code>toupper()</code>, and <code>tolower()</code> in <code>&lt;ctype.h&gt;</code>. C doesn&#39;t guarantee <code>&#39;z&#39; - &#39;a&#39; == 25</code>"}], "owner": {"reputation": 29, "user_id": 2513526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba4f57d7c31d7faee4cf2a560a0c322d?s=128&d=identicon&r=PG", "display_name": "Fransweezy", "link": "https://stackoverflow.com/users/2513526/fransweezy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 151, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1579236178, "creation_date": 1576623006, "last_edit_date": 1579236178, "question_id": 59383223, "link": "https://stackoverflow.com/questions/59383223/how-to-preserve-case-of-inputted-chars-in-c", "title": "How to Preserve Case of Inputted Chars in C?", "body": "<p>The user inputs chars that can be uppercase or lowercase. I need to spit an answer back that preserves the case of the inputted char after that char is processed by my code. How do I preserve case when the char was converted to its ASCII value and then to its alphabetical index equivalent.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>#include &lt;cs50.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;ctype.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(int argc, string argv[])\n{\n  int counter = 0;\n  if (argc == 2) {\n    for (int k = 0; k &lt; strlen(argv[1]); k++) {\n      if (isdigit(argv[1][k])) {\n        counter++;\n      }\n    }\n\n    if (strlen(argv[1]) == counter)\n    {\n      string s = get_string(\"plaintext: \");\n      printf(\"ciphertext: \");\n\n      for (int i = 0; i &lt; strlen(s); i++) {\n        int c = (int) s[i];\n        if (c &gt;= 97 &amp;&amp; c &lt;= 122)\n        {\n          printf(\"%i\\n\", (((c % 32) - 1 + atoi(argv[1]))) % 26);\n        }\n        printf(\"\\n\");\n\n        if (c &gt;= 65 &amp;&amp; c &lt;= 90)\n        {\n          printf(\"%i\", (((c % 32)) - 1 + atoi(argv[1])) % 26);\n        }\n\n        printf(\"\\n\");\n      }\n\n    } else {\n      printf(\"Usage: ./caesar key\\n\");\n    }\n  }\n}\n</code></pre>\n\n<p>Expected behavior would print Zoo as \"App\" if Key entered in command line were 1.</p>\n"}, {"tags": ["c", "unix", "pipe", "fork"], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 11881184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb96f6e47dbf4a512093d21234e31b5e?s=128&d=identicon&r=PG&f=1", "display_name": "Vallaris", "link": "https://stackoverflow.com/users/11881184/vallaris"}, "edited": false, "score": 0, "creation_date": 1576621347, "post_id": 59382919, "comment_id": 104957839, "body": "Thanks a lot man! I didn&#39;t realize that I also have to close the pipes I don&#39;t use at all."}, {"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "reply_to_user": {"reputation": 37, "user_id": 11881184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb96f6e47dbf4a512093d21234e31b5e?s=128&d=identicon&r=PG&f=1", "display_name": "Vallaris", "link": "https://stackoverflow.com/users/11881184/vallaris"}, "edited": false, "score": 0, "creation_date": 1576621605, "post_id": 59382919, "comment_id": 104957916, "body": "Re &quot;<i>I didn&#39;t realize that I also have to close the pipes I don&#39;t use at all.</i>&quot;, That&#39;s a weird thing to say since you close <code>pipe_one[1]</code> in the first child even though you don&#39;t use it."}, {"owner": {"reputation": 37, "user_id": 11881184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb96f6e47dbf4a512093d21234e31b5e?s=128&d=identicon&r=PG&f=1", "display_name": "Vallaris", "link": "https://stackoverflow.com/users/11881184/vallaris"}, "edited": false, "score": 0, "creation_date": 1576622965, "post_id": 59382919, "comment_id": 104958280, "body": "Yes, I meant that because I never use pipe_two in the first child, I&#39;d also never have to close it (only the unused ends for pipe_one since this is the one pipe I&#39;m using). But now that I think about it it only makes sense that I have to close everything."}], "tags": [], "owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "is_accepted": false, "score": 5, "last_activity_date": 1576622183, "last_edit_date": 1576622183, "creation_date": 1576621134, "answer_id": 59382919, "question_id": 59382821, "link": "https://stackoverflow.com/questions/59382821/redirecting-stdin-to-children-makes-the-program-not-terminate/59382919#59382919", "title": "Redirecting stdin to children makes the program not terminate", "body": "<p>The read end of a pipe only reaches EOF once all descriptors to the write end are closed.</p>\n\n<p>You don't close <code>pipe_two[0]</code> in the first child, so the second child won't exit until the first one does.</p>\n\n<p>You don't close <code>pipe_one[0]</code> in the second child, so the first child won't exit until the second one does.</p>\n\n<hr>\n\n<p>By the way,</p>\n\n<p>It would be nice to close <code>pipe_two[1]</code> in the first child.</p>\n\n<p>It would be nice to close <code>pipe_one[1]</code> in the second child.</p>\n\n<p>Also,</p>\n\n<pre><code>dup2(pipe_one[0], STDIN_FILENO);\nclose(pipe_one[0]);\nwhile (fgets(buf, 100, stdin)) ...;\n</code></pre>\n\n<p>can be reduced to</p>\n\n<pre><code>FILE *f = fdopen(pipe_one[0]);\nwhile (fgets(buf, 100, f)) ...;\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 11881184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb96f6e47dbf4a512093d21234e31b5e?s=128&d=identicon&r=PG&f=1", "display_name": "Vallaris", "link": "https://stackoverflow.com/users/11881184/vallaris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576622183, "creation_date": 1576620600, "question_id": 59382821, "link": "https://stackoverflow.com/questions/59382821/redirecting-stdin-to-children-makes-the-program-not-terminate", "title": "Redirecting stdin to children makes the program not terminate", "body": "<p>what I've been trying to do is to set up a program that forks two children. The parent reads from stdin and then redirects it to its child processes via pipes. The child then duplicates the read end of the pipe so that it can read from stdin (instead of the pipe) and then print it into stdout. Here is the code:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;string.h&gt;\n\nint main(int argc, char **argv) {\n    char buf[100];\n    int pipe_one[2];\n//    int pipe_two[2];\n\n    pipe(pipe_one);\n//    pipe(pipe_two);\n\n    // First child\n    switch(fork()) {\n        case -1:\n            exit(EXIT_FAILURE);\n        case 0:\n            close(pipe_one[1]);\n            dup2(pipe_one[0], STDIN_FILENO);\n            close(pipe_one[0]);\n            while (fgets(buf, 100, stdin)) {\n                fputs(buf, stdout);\n            }\n            fflush(stdout);\n            exit(EXIT_SUCCESS);\n        default:\n            break;\n    }\n\n    // Second child\n/*    switch(fork()) {\n        case -1:\n            exit(EXIT_FAILURE);\n        case 0:\n            close(pipe_two[1]);\n            dup2(pipe_two[0], STDIN_FILENO);\n            close(pipe_two[0]);\n            while (fgets(buf, 100, stdin)) {\n                fputs(buf, stdout);\n            }\n            fflush(stdout);\n            exit(EXIT_SUCCESS);\n        default:\n            break;\n    }*/\n\n    close(pipe_one[0]);\n//    close(pipe_two[0]);\n    FILE *out_1 = fdopen(pipe_one[1], \"w\");\n//    FILE *out_2 = fdopen(pipe_two[1], \"w\");\n\n    while (fgets(buf, 100, stdin)) {\n        fputs(buf, out_1);\n//        fputs(buf, out_2);\n    }\n\n    fflush(out_1);\n//    fflush(out_2);\n    fclose(out_1);\n//    fclose(out_2);\n    close(pipe_one[1]);\n//    close(pipe_two[1]);\n\n    wait(NULL);\n    //wait(NULL);\n\n    exit(EXIT_SUCCESS);\n}\n</code></pre>\n\n<p>I've commented out all the parts relating to the second child. If I run this program, it works flawlessly (it reads from stdin until it meets EOF and then prints it into stdout). However, if I try to do the exact same thing with a second fork (see the parts commented out), it does the exact same thing except that after printing everything the program doesn't terminate. And I haven't been able to find the reason why. </p>\n\n<p>My guess would be that I'm not to duplicate stdinfileno twice in two children. However, our tasks requires us to do so. Is there anything I am missing? I'd be really glad if someone could take a look at it!</p>\n"}, {"tags": ["c", "arrays", "string", "printf"], "comments": [{"owner": {"reputation": 29641, "user_id": 10871073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ddBW9.png?s=128&g=1", "display_name": "Adrian Mole", "link": "https://stackoverflow.com/users/10871073/adrian-mole"}, "edited": false, "score": 2, "creation_date": 1576620417, "post_id": 59382770, "comment_id": 104957532, "body": "There&#39;s a <code>tolower</code> function that works in much the same way as <code>toupper</code> (with one obvious difference)."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1576620499, "post_id": 59382770, "comment_id": 104957561, "body": "Aside: you don&#39;t need to check with <code>isalpha</code> before calling <code>toupper</code>, which is safe."}, {"owner": {"reputation": 1404, "user_id": 10496710, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5cb3d11da053d8e1e94ef99a27ca6af?s=128&d=identicon&r=PG&f=1", "display_name": "B. Go", "link": "https://stackoverflow.com/users/10496710/b-go"}, "edited": false, "score": 0, "creation_date": 1576621289, "post_id": 59382770, "comment_id": 104957826, "body": "It&#39;s not mandatory, put you should take the habit of using {} in your for/if/... even if there is only one statement following it. Especially in `for (int i = 0; i &lt; len; ++i) \\n if (isalpha(word[i]))``, to begin with. The code is both easier to read and safer if ever changed later"}, {"owner": {"reputation": 9, "user_id": 11262914, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4T4LbdROgXU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdkgQFKgXlh2lK1hRQbrV3dVvgTeA/mo/photo.jpg?sz=128", "display_name": "senpai", "link": "https://stackoverflow.com/users/11262914/senpai"}, "reply_to_user": {"reputation": 29641, "user_id": 10871073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ddBW9.png?s=128&g=1", "display_name": "Adrian Mole", "link": "https://stackoverflow.com/users/10871073/adrian-mole"}, "edited": false, "score": 0, "creation_date": 1576621320, "post_id": 59382770, "comment_id": 104957836, "body": "@AdrianMole I know but I can&#39;t figure out where to add it in my code. I know it&#39;s simple but I am really stuck"}], "owner": {"reputation": 9, "user_id": 11262914, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4T4LbdROgXU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdkgQFKgXlh2lK1hRQbrV3dVvgTeA/mo/photo.jpg?sz=128", "display_name": "senpai", "link": "https://stackoverflow.com/users/11262914/senpai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576620315, "creation_date": 1576620315, "question_id": 59382770, "link": "https://stackoverflow.com/questions/59382770/accepting-case-insensitive-input-and-printing-them-out-correctly", "title": "accepting case-insensitive input and printing them out correctly", "body": "<p>Hi guys I wrote a better and improved hangman game that accepts lowercase input and uppercase input.\nThe only problem that I have is that for example if the String looks like this \"tnt\" it prints out every character big in the console. I am trying to make it print out the exact same string.\nSo if I input big 'T' then it should accept it and output small 't'.</p>\n\n<p>Could someone help me?</p>\n\n<p>Thank you in advance.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdbool.h&gt;\n#include &lt;string.h&gt;\n#include &lt;ctype.h&gt;\n\n#define MAX_WORD 100\n\nint get_word(char *word, int size) {\n    fgets(word, size, stdin);\n    int len = strlen(word);\n    if (len &amp;&amp; word[len - 1] == '\\n')\n        word[--len] = '\\0';\n    for (int i = 0; i &lt; len; ++i)\n        if (isalpha(word[i]))\n            word[i] = toupper(word[i]);\n        else\n            return -1;\n    return len;\n}\n\nvoid create_output(char *output, int len) {\n    for (int i = 0; i &lt; len; ++i)\n        output[i] = '_';\n    output[len] = '\\0';\n}\n\nvoid print_output(const char *output, const char *alpha, int tries) {\n    printf(\"(%d)  \", tries);\n    for (int i = 0; output[i]; ++i)\n        printf(\"%c \", output[i]);\n    printf(\"  %s\\n\", alpha);\n}\n\nbool play_game(const char *word, int len) {\n    char alpha[] = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\n    char output[MAX_WORD];\n    create_output(output, len);\n    int tries = 0, guessed = 0;\n    while (tries &lt; len &amp;&amp; guessed &lt; len) {  // using word length for number of tries (?!)\n        print_output(output, alpha, tries);\n        printf(\"Guess: \");\n        char guess;\n        scanf(\" %c\", &amp;guess);\n        guess = toupper(guess);\n        if (alpha[guess - 'A'] != ' ') {\n            for (int i = 0; i &lt; len; ++i)\n                if (word[i] == guess &amp;&amp; output[i] == '_') {\n                    output[i] = word[i];\n                    ++guessed;\n                }\n            alpha[guess - 'A'] = ' ';\n            ++tries;\n        }\n    }\n    print_output(output, alpha, tries);\n    return guessed == len;\n}\n\nint main() {\n    printf(\"Enter word to guess: \");\n    char word[MAX_WORD];\n    int len = get_word(word, sizeof word);\n    if (len == -1) {\n        printf(\"The word cannot contain spaces.\\n\");\n        return EXIT_FAILURE;\n    }\n    if (play_game(word, len))\n        printf(\"You win!\\n\");\n    else\n        printf(\"You lose.\\nThe word was %s.\\n\", word);\n    return 0;\n} \n</code></pre>\n"}, {"tags": ["c", "shell", "malloc", "free"], "comments": [{"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 1, "creation_date": 1576619188, "post_id": 59382565, "comment_id": 104957077, "body": "Suggest you run your program with <a href=\"http://valgrind.org\" rel=\"nofollow noreferrer\">valgrind</a> as it can help find many memory issues."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 2, "creation_date": 1576619491, "post_id": 59382565, "comment_id": 104957168, "body": "Small point from a sea of code: do you know that the <code>strncpy</code> function does not always append a null terminator character?"}, {"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 1, "creation_date": 1576619861, "post_id": 59382565, "comment_id": 104957311, "body": "valgrind points to this line of code accessing uninitialised memory: <code>while(userinput-&gt;parametersArray[i] != NULL)</code>. And looking at the allocation code this line looks wrong: <code>user_input-&gt;parametersArray = (char**)malloc(user_input-&gt;size_of_array);</code>. Should be <code>malloc(user_input-&gt;size_of_array * sizeof *user_input-&gt;parametersArray)</code>,"}, {"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 3, "creation_date": 1576620007, "post_id": 59382565, "comment_id": 104957358, "body": "I hope that is enough for you to dig deeper yourself with valgrind. It&#39;s a bit of an ask to expect people to debug all your code so your best bet is to take the debugging advice and try it yourself. Good luck!"}], "answers": [{"tags": [], "owner": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "is_accepted": false, "score": 0, "last_activity_date": 1576620349, "creation_date": 1576620349, "answer_id": 59382778, "question_id": 59382565, "link": "https://stackoverflow.com/questions/59382565/writing-my-own-shell-in-c-free-causing-problems/59382778#59382778", "title": "Writing my own shell in c - free() causing problems", "body": "<p>I recommend the use of <code>valgrind</code>.</p>\n\n<p>Compile with your code with the flag <code>-ggdb3</code> and then execute <code>valgrind</code> with your program. It'll show you all the invalid reads and writes during the execution of the program. Not only that, it'll tell you exactly in what line they happen and the corresponding function call trace.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/5134891/how-do-i-use-valgrind-to-find-memory-leaks\">This question</a> is a great starting point if you're a beginner to <code>valgrind</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 63, "user_id": 7378742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2378c3fe3b82f833aa6a50c930b0db0?s=128&d=identicon&r=PG&f=1", "display_name": "Jessica Grahm", "link": "https://stackoverflow.com/users/7378742/jessica-grahm"}, "edited": false, "score": 0, "creation_date": 1576658746, "post_id": 59383274, "comment_id": 104967139, "body": "Thank you very much for your time. I tried everything you wrote, but the real problem was with strncpy. The allocations were fine."}], "tags": [], "owner": {"reputation": 30170, "user_id": 5231607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QzGsq.jpg?s=128&g=1", "display_name": "1201ProgramAlarm", "link": "https://stackoverflow.com/users/5231607/1201programalarm"}, "is_accepted": false, "score": 0, "last_activity_date": 1576623434, "creation_date": 1576623434, "answer_id": 59383274, "question_id": 59382565, "link": "https://stackoverflow.com/questions/59382565/writing-my-own-shell-in-c-free-causing-problems/59383274#59383274", "title": "Writing my own shell in c - free() causing problems", "body": "<p>One problem is that your \"counting how many token we have\" is wrong.  It will exit on the first iteration, because the condition <code>a[i] != '&lt;' || a[i] != '&gt;'</code> will always be true.  I think the comparison you want is <code>a[i] == '&lt;' || a[i] == '&gt;'</code>, which will exit the loop if either of those characters is found.  This will result in <code>user_input-&gt;size_of_array</code> being 2 (or 3, if the first character in <code>a</code> is a space).  Later, when you actually pull tokens from the string, you write past allocated memory if there are more than two (or possibly three) tokens.</p>\n\n<p>This counting loop itself is flawed, because it counts differently than the loop that actually extracts the tokens.  (For example, if a token is \"a>b\", your counter would stop but the tokenizer loop would treat that as a token and keep going.)  It would be better to use the same sort of loop to count the token, using <code>strtok</code>, or better yet use a way to dynamically resize your parameters array so you only need to make one pass and don't need to count.  With either loop, multiple adjacent spaces result in an empty token.</p>\n\n<p>But that isn't all.  The count being wrong isn't currently an issue because of the next problem: the allocation for <code>user_input-&gt;parametersArray</code> uses the wrong size.  Since you want <code>user_input-&gt;size_of_array</code> elements, you should use</p>\n\n<pre><code>user_input-&gt;parametersArray = malloc(user_input-&gt;size_of_array * sizeof(char *));\n</code></pre>\n\n<p>or, to avoid problems with the proper type, you can go with</p>\n\n<pre><code>user_input-&gt;parametersArray = malloc(user_input-&gt;size_of_array * sizeof(*user_input-&gt;parametersArray));\n</code></pre>\n\n<p>Note that I have removed the cast of the return value from <code>malloc</code>.  It is not necessary in C, and can lead to subtle problems if the type used in the cast is not the correct one.</p>\n\n<p>Another problem is the call to <code>strncpy</code>.  Since the length of the string is <code>size</code>, the terminating nul character will not be copied.  Since you now the buffer is big enough, you should just use <code>strcpy</code> (or <code>strcpy_s</code> if your compiler is new enough to support it).</p>\n"}], "owner": {"reputation": 63, "user_id": 7378742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2378c3fe3b82f833aa6a50c930b0db0?s=128&d=identicon&r=PG&f=1", "display_name": "Jessica Grahm", "link": "https://stackoverflow.com/users/7378742/jessica-grahm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1576623434, "creation_date": 1576619130, "question_id": 59382565, "link": "https://stackoverflow.com/questions/59382565/writing-my-own-shell-in-c-free-causing-problems", "title": "Writing my own shell in c - free() causing problems", "body": "<p>I'm trying to write my own shell, but something is not working with the allocations and free. I reviewed my code over and over, and I cannot understand why my free function is causing me problems... When I don't use it, everything works fine, but when I use it, the code stops working after the second iteration...\nI would really appreciate your help...</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n#include &lt;limits.h&gt; //for PATH_MAX - longest path name permited in linux\n#include &lt;sys/wait.h&gt;\n#include &lt;fcntl.h&gt;\n\ntypedef struct{\nchar **parametersArray; //this array contains the command and the parameters\nint size_of_array; //the number of strings in the array\nint toFileFlag; //if we wnat to write to file\nchar *toFile; //name of file to write to\nint fromFileFlag;//if we wnat to read from file\nchar *fromFile; //name of file to read to\n}UserInput;\n\nint runInBackground = 0; //is command running in background? if so, runInBackground=1;\n\n//********************************************************************************************************************\n//functions list:\n\nUserInput* inputTokenization(char *a); //recieve string of the user input, and returns pointer to struct of UserInput.   \nvoid execCommand(UserInput *user_input); //exec the requestd command with the parameters given \nvoid free_All_Allocations(UserInput *userinput); \n\n //*******************************************************************************************************************\nint main(int argc, char *argv[])\n{\n    char userInputTxt[LINE_MAX]; //the line the user enters (hopefully command+parameters)   \n    UserInput *u_i;   \n    int i = 0;\n\n    while(1)\n    {\n        i = 0;\n        printf(\"\\033[1;35m\"); //print in with color (purple)\n        printf(\"### \"); //### is the prompt I chose    \n        fflush(stdout);\n        memset(userInputTxt, 0, LINE_MAX); //cleaning array from previous iteration \n        read(0, userInputTxt, LINE_MAX); \n\n        if(strcmp(userInputTxt, \"exit\\n\") == 0) //exit the program if the user enters \"exit\"       \n            exit(EXIT_SUCCESS);\n\n        u_i = inputTokenization(userInputTxt); //parsing the char array userInputTxt\n        execCommand(u_i); \n        free_All_Allocations(u_i);\n    }\n\n}\n\nUserInput* inputTokenization(char *a)\n{   \n    int i=0, size;    \n    size = strlen(a);\n    UserInput *user_input = (UserInput*)malloc(sizeof(UserInput)*1); \n    if(user_input == NULL)\n     {\n        perror(\"failed to allocate memory\");\n        exit(EXIT_FAILURE); \n    }\n\n\n    user_input-&gt;fromFileFlag = 0;\n    user_input-&gt;toFileFlag = 0;\n    user_input-&gt;size_of_array = 2;\n\n    //counting how many token we have\n    while(i&lt;size)\n    {\n        if(a[i] == ' ')\n            (user_input-&gt;size_of_array)++;\n        if (a[i] != '&lt;' || a[i] != '&gt;' )\n            break;\n        i++;\n    }\n    printf(\"%d\\n\", user_input-&gt;size_of_array);\n\n    //we don't want to change original array(a), so we'll copy a to tmp and use tmp\n    char *tmp = (char*)malloc(size+1);\n    if(tmp == NULL)\n     {\n        perror(\"failed to allocate memory\");\n        exit(EXIT_FAILURE); \n    }\n    strncpy(tmp, a, size-1);\n\n    //we'll allocate array of arrays. It's size: number of tokens in the original array, even though we might not use all of it-\n    //some tokens might be name of file to read or write to\n    user_input-&gt;parametersArray = (char**)malloc(user_input-&gt;size_of_array);\n    if(user_input-&gt;parametersArray == NULL)\n     {\n        perror(\"failed to allocate memory\");\n        exit(EXIT_FAILURE); \n    }\n\n    i=0;    \n    char* token = strtok(tmp, \" \");   \n    user_input-&gt;parametersArray[i] = (char*)malloc(strlen(token)+1);\n    if(user_input-&gt;parametersArray[i] == NULL)\n     {\n        perror(\"failed to allocate memory\");\n        exit(EXIT_FAILURE); \n    }\n    strcpy(user_input-&gt;parametersArray[i], token);\n    i++; \n\n    while(token != NULL)\n    {\n        token = strtok(NULL, \" \");\n        if(token !=NULL)\n        {\n            if(strcmp(token, \"&lt;\") != 0 &amp;&amp; strcmp(token, \"&gt;\") !=0 &amp;&amp; strcmp(token, \"&amp;\") != 0)\n            {\n                user_input-&gt;parametersArray[i] = (char*)malloc(strlen(token)+1);\n                if(user_input-&gt;parametersArray[i] == NULL)\n                {\n                    perror(\"failed to allocate memory\");\n                    exit(EXIT_FAILURE); \n                }\n                strcpy(user_input-&gt;parametersArray[i], token);                \n                i++;\n                continue;\n            }\n\n            if(strcmp(token, \"&lt;\") == 0)\n            {\n               user_input-&gt;fromFileFlag = 1;\n               token = strtok(NULL, \" \");\n               if(token !=NULL)\n               {\n                   user_input-&gt;fromFile = (char*)malloc(strlen(token)+1);\n                   if(user_input-&gt;fromFile == NULL)\n                    {\n                        perror(\"failed to allocate memory\");\n                        exit(EXIT_FAILURE); \n                    }\n                   strcpy(user_input-&gt;fromFile, token);\n               }               \n            }\n\n            if(strcmp(token, \"&gt;\") == 0)\n            {\n               user_input-&gt;toFileFlag = 1;\n               token = strtok(NULL, \" \");\n               if(token != NULL)\n               {\n                   user_input-&gt;toFile = (char*)malloc(strlen(token)+1);\n                   if(user_input-&gt;toFile == NULL)\n                    {\n                        perror(\"failed to allocate memory\");\n                        exit(EXIT_FAILURE); \n                    }\n                   strcpy(user_input-&gt;toFile, token);\n               }               \n            }\n            if(strcmp(token, \"&amp;\") == 0)\n            {\n               runInBackground = 1;\n               break;                            \n            }\n\n        }\n    }        \n\n    user_input-&gt;parametersArray[i] = NULL;\n\n    free(tmp);\n    return user_input;       \n}\n\nvoid execCommand(UserInput *user_input)\n{\n   pid_t pid;\n   int status;   \n\n    pid = fork();\n\n    if(pid == -1) //fork failed\n    {\n        perror(\"fork() failed\");\n        exit(EXIT_FAILURE);\n    }\n    if(pid == 0) //child process\n    {        \n        if(user_input-&gt;fromFileFlag == 1) //if we have file to read from\n        {\n            close(0);\n            if(open(user_input-&gt;fromFile, O_RDONLY) == -1) \n            {                \n                perror(\"open file to read failed\");\n                exit(EXIT_FAILURE);\n            }\n        }\n        if(user_input-&gt;toFileFlag == 1) //if we have file to write to\n        {\n            close(1);\n            if(open(user_input-&gt;toFile, O_WRONLY | O_CREAT, 0766) == -1)\n            {\n                perror(\"open file to write failed\");\n                exit(EXIT_FAILURE);\n            }\n        }\n\n        if(execvp(user_input-&gt;parametersArray[0], user_input-&gt;parametersArray) == -1)\n        {\n            perror(\"execvp() failed\");\n            exit(EXIT_FAILURE);\n        }\n    }\n\n    if(runInBackground == 0) //as long as this is the only command to execute, \n        waitpid(pid, &amp;status, 0); //wait until chile process (execvp) finish. Otherwise, father process go again, and chile process run in background   \n}\n\nvoid free_All_Allocations(UserInput *userinput)\n{\n    int i=0;\n\n    while(userinput-&gt;parametersArray[i] != NULL)\n     {                \n         free(userinput-&gt;parametersArray[i]);\n         i++;        \n     }    \n\n     free(userinput-&gt;parametersArray);   \n     if(userinput-&gt;fromFileFlag == 1)\n         free(userinput-&gt;fromFile);\n     if(userinput-&gt;toFileFlag == 1)\n        free(userinput-&gt;toFile);       \n     free(userinput);    \n}\n</code></pre>\n"}, {"tags": ["c++", "c"], "comments": [{"owner": {"reputation": 29641, "user_id": 10871073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ddBW9.png?s=128&g=1", "display_name": "Adrian Mole", "link": "https://stackoverflow.com/users/10871073/adrian-mole"}, "edited": false, "score": 3, "creation_date": 1576617860, "post_id": 59382289, "comment_id": 104956509, "body": "This loop <code>for (i=3;i&gt;0;i+=2)</code> will run forever. (Unless integer overflow turns <code>i</code> negative.)"}, {"owner": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "edited": false, "score": 1, "creation_date": 1576617957, "post_id": 59382289, "comment_id": 104956553, "body": "1) &quot;<i>The code compiles successfully but doesn&#39;t work, it doesn&#39;t even run.</i>&quot; The code compiling does not guarantee, that it will work. Imagine you wrote an essay: all compiler did was to check if it is grammatically correct. It didn&#39;t check, that anything made sense. 2) Did you try stepping through your code, <b>line-by-line</b>, with a debugger, while observing the values of all the variables, at each execution step, to see at which, exact point, the execution didn&#39;t match your expectations?"}, {"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 0, "creation_date": 1576618296, "post_id": 59382289, "comment_id": 104956726, "body": "I think you mean idle rather than ideal."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "reply_to_user": {"reputation": 29641, "user_id": 10871073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ddBW9.png?s=128&g=1", "display_name": "Adrian Mole", "link": "https://stackoverflow.com/users/10871073/adrian-mole"}, "edited": false, "score": 0, "creation_date": 1576619788, "post_id": 59382289, "comment_id": 104957284, "body": "@AdrianMole even if integer overflow could lead to negative it may still have infinite loop."}, {"owner": {"reputation": 29641, "user_id": 10871073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ddBW9.png?s=128&g=1", "display_name": "Adrian Mole", "link": "https://stackoverflow.com/users/10871073/adrian-mole"}, "reply_to_user": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1576620128, "post_id": 59382289, "comment_id": 104957412, "body": "@SlavasupportsMonica Anything can happen. Integer overflow is <b>undefined behaviour</b>!"}, {"owner": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "reply_to_user": {"reputation": 29641, "user_id": 10871073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ddBW9.png?s=128&g=1", "display_name": "Adrian Mole", "link": "https://stackoverflow.com/users/10871073/adrian-mole"}, "edited": false, "score": 1, "creation_date": 1576621115, "post_id": 59382289, "comment_id": 104957764, "body": "@AdrianMole &quot;<i>Integer overflow is undefined behaviour!</i>&quot; I would like to add to that: <b>signed</b> integer overflow is undefined behavior. Unsigned integer overflow is defined."}, {"owner": {"reputation": 29641, "user_id": 10871073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ddBW9.png?s=128&g=1", "display_name": "Adrian Mole", "link": "https://stackoverflow.com/users/10871073/adrian-mole"}, "reply_to_user": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "edited": false, "score": 0, "creation_date": 1576621181, "post_id": 59382289, "comment_id": 104957788, "body": "@AlgirdasPreid\u017eius Good point."}], "answers": [{"comments": [{"owner": {"reputation": 29641, "user_id": 10871073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ddBW9.png?s=128&g=1", "display_name": "Adrian Mole", "link": "https://stackoverflow.com/users/10871073/adrian-mole"}, "reply_to_user": {"reputation": 45, "user_id": 12456303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f52dc16132cd44815f9f8d14fee51671?s=128&d=identicon&r=PG&f=1", "display_name": "DevilsSnare", "link": "https://stackoverflow.com/users/12456303/devilssnare"}, "edited": false, "score": 0, "creation_date": 1576620191, "post_id": 59382348, "comment_id": 104957437, "body": "@ChetanPaliwal Out of curiosity, what is the <i>correct</i> loop statement?"}], "tags": [], "owner": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "is_accepted": true, "score": 3, "last_activity_date": 1576618300, "last_edit_date": 1576618300, "creation_date": 1576618031, "answer_id": 59382348, "question_id": 59382289, "link": "https://stackoverflow.com/questions/59382289/code-compiles-but-doesnt-work-the-cmd-window-just-sits-ideal-and-ideal-but-not/59382348#59382348", "title": "Code compiles but doesn&#39;t work! The cmd window just sits ideal and ideal but nothing happens", "body": "<p>The <code>for</code> cycle in your <code>sine</code> function doesn't seem to be right. You're checking for <code>i &gt; 0</code>, yet you initialize it to 3 and increment it in steps of 2. That cycle might only be broken when <code>i</code> overflows, but that is undefined behavior (see <a href=\"https://www.gnu.org/software/autoconf/manual/autoconf-2.63/html_node/Integer-Overflow-Basics.html\" rel=\"nofollow noreferrer\">here</a>).</p>\n"}, {"comments": [{"owner": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "edited": false, "score": 0, "creation_date": 1576618229, "post_id": 59382385, "comment_id": 104956695, "body": "How are you sure it&#39;s infinite? <code>i</code> will eventually overflow, thus leading to undefined behavior."}, {"owner": {"reputation": 20522, "user_id": 11941443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f27a880243178eedf3abdab24898b335?s=128&d=identicon&r=PG&f=1", "display_name": "walnut", "link": "https://stackoverflow.com/users/11941443/walnut"}, "edited": false, "score": 0, "creation_date": 1576618438, "post_id": 59382385, "comment_id": 104956784, "body": "Your new condition will never execute the loop."}, {"owner": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "reply_to_user": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "edited": false, "score": 1, "creation_date": 1576618439, "post_id": 59382385, "comment_id": 104956785, "body": "@SaucyGoat &quot;<i>Once <code>i</code> overflows, its value will be negative thus breaking the cycle.</i>&quot; Overflowing signed integers is undefined behavior. Hence - it is not guaranteed, that it will overflow into a negative number."}, {"owner": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "reply_to_user": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "edited": false, "score": 0, "creation_date": 1576618479, "post_id": 59382385, "comment_id": 104956802, "body": "@AlgirdasPreid\u017eius I corrected my comment, but thanks for pointing that out!"}, {"owner": {"reputation": 1500, "user_id": 3151562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/V0mVp.jpg?s=128&g=1", "display_name": "Scalway", "link": "https://stackoverflow.com/users/3151562/scalway"}, "edited": false, "score": 0, "creation_date": 1576618560, "post_id": 59382385, "comment_id": 104956835, "body": "Yeah... maybe you are right, maybe not. Nevertheless error was in this loop."}, {"owner": {"reputation": 45, "user_id": 12456303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f52dc16132cd44815f9f8d14fee51671?s=128&d=identicon&r=PG&f=1", "display_name": "DevilsSnare", "link": "https://stackoverflow.com/users/12456303/devilssnare"}, "edited": false, "score": 0, "creation_date": 1576618887, "post_id": 59382385, "comment_id": 104956965, "body": "thanks for pointing that out @Scalway You see Sine is an infinite series and I was caughtup in that infinite flow of the loop."}], "tags": [], "owner": {"reputation": 1500, "user_id": 3151562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/V0mVp.jpg?s=128&g=1", "display_name": "Scalway", "link": "https://stackoverflow.com/users/3151562/scalway"}, "is_accepted": false, "score": 0, "last_activity_date": 1576618194, "creation_date": 1576618194, "answer_id": 59382385, "question_id": 59382289, "link": "https://stackoverflow.com/questions/59382289/code-compiles-but-doesnt-work-the-cmd-window-just-sits-ideal-and-ideal-but-not/59382385#59382385", "title": "Code compiles but doesn&#39;t work! The cmd window just sits ideal and ideal but nothing happens", "body": "<p>Loop in <code>void sine</code> is infinite. You have wrong termination condition there.</p>\n\n<pre><code>for (i=3;i&lt;=0;i+=2) {...}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 12456303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f52dc16132cd44815f9f8d14fee51671?s=128&d=identicon&r=PG&f=1", "display_name": "DevilsSnare", "link": "https://stackoverflow.com/users/12456303/devilssnare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 59382348, "answer_count": 2, "score": 1, "last_activity_date": 1576618300, "creation_date": 1576617768, "question_id": 59382289, "link": "https://stackoverflow.com/questions/59382289/code-compiles-but-doesnt-work-the-cmd-window-just-sits-ideal-and-ideal-but-not", "title": "Code compiles but doesn&#39;t work! The cmd window just sits ideal and ideal but nothing happens", "body": "<p>The question is to evaluate the Sin(x) series using functions. The code compiles successfully but doesn't work, it doesn't even run.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\nvoid sine(int, float *);\nvoid factorial(int, int *);\nint main()\n{\n    int x, fact;\n    float sol;\n    scanf(\"%d\", &amp;x);\n    sine(x, &amp;sol);\n    printf(\"Solution of Sin(x) series is %f.\", sol);\n    return 0;\n}\nvoid sine(int x, float *sol)\n{\n    int i;\n    int fact=1;\n    factorial(x, &amp;fact);\n    for (i=3;i&gt;0;i+=2)\n        *sol=x+pow(-1, i)*pow(x, i)/fact;\n}\nvoid factorial(int x, int *fact)\n{\n    int j;\n    for (j=1;j&lt;=x;j++)\n        *fact*=j;\n}\n</code></pre>\n"}, {"tags": ["c", "linux", "networking", "linux-kernel", "netfilter"], "comments": [{"owner": {"reputation": 191202, "user_id": 147356, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b9506717d24256a090524dd5505d3207?s=128&d=identicon&r=PG", "display_name": "larsks", "link": "https://stackoverflow.com/users/147356/larsks"}, "edited": false, "score": 0, "creation_date": 1576624482, "post_id": 59382141, "comment_id": 104958679, "body": "This is going to be tricky, because an interface can have multiple addresses, all with different netmasks."}], "answers": [{"tags": [], "owner": {"reputation": 4173, "user_id": 4450651, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l6IMB.jpg?s=128&g=1", "display_name": "red0ct", "link": "https://stackoverflow.com/users/4450651/red0ct"}, "is_accepted": true, "score": 2, "last_activity_date": 1576751697, "last_edit_date": 1576751697, "creation_date": 1576703708, "answer_id": 59400074, "question_id": 59382141, "link": "https://stackoverflow.com/questions/59382141/obtain-interface-netmask-in-linux-kernel-module/59400074#59400074", "title": "Obtain interface netmask in Linux kernel module", "body": "<p>There is a pretty easy way to get it.<br>\nNetwork device is described by <code>struct net_device</code>.<br>\n<a href=\"https://elixir.bootlin.com/linux/v5.1.21/source/include/linux/netdevice.h#L1789\" rel=\"nofollow noreferrer\"><code>&lt;linux/netdevice.h&gt;</code></a>:</p>\n\n<pre><code>struct net_device {\n    ...\n    struct in_device __rcu  *ip_ptr;\n    ...\n</code></pre>\n\n<p><code>net_device</code> has a pointer to \"inet\" device (<code>in_device</code>).</p>\n\n<p><a href=\"https://elixir.bootlin.com/linux/v5.1.21/source/include/linux/inetdevice.h#L25\" rel=\"nofollow noreferrer\"><code>&lt;linux/inetdevice.h&gt;</code></a>:</p>\n\n<pre><code>struct in_device {\n    ...\n    struct in_ifaddr    *ifa_list;  /* IP ifaddr chain      */\n    ...\n</code></pre>\n\n<p>which finnaly points to chain of <a href=\"https://elixir.bootlin.com/linux/v5.1.21/source/include/linux/inetdevice.h#L137\" rel=\"nofollow noreferrer\"><code>in_ifaddr</code></a> that contains all the interface info:</p>\n\n<pre><code>struct in_ifaddr {\n    struct hlist_node   hash;\n    struct in_ifaddr    *ifa_next;\n    struct in_device    *ifa_dev;\n    struct rcu_head     rcu_head;\n    __be32              ifa_local;\n    __be32              ifa_address;\n    __be32              ifa_mask;\n    __u32               ifa_rt_priority;\n    __be32              ifa_broadcast;\n    unsigned char       ifa_scope;\n    unsigned char       ifa_prefixlen;\n    __u32               ifa_flags;\n    char                ifa_label[IFNAMSIZ];\n\n    /* In seconds, relative to tstamp. Expiry is at tstamp + HZ * lft. */\n    __u32               ifa_valid_lft;\n    __u32               ifa_preferred_lft;\n    unsigned long       ifa_cstamp; /* created timestamp */\n    unsigned long       ifa_tstamp; /* updated timestamp */\n};\n</code></pre>\n\n<hr>\n\n<p>To make my answer more versatile, here is an abstract example (without binding to <a href=\"/questions/tagged/netfilter\" class=\"post-tag\" title=\"show questions tagged &#39;netfilter&#39;\" rel=\"tag\">netfilter</a> and <a href=\"/questions/tagged/skb\" class=\"post-tag\" title=\"show questions tagged &#39;skb&#39;\" rel=\"tag\">skb</a> devices logic):</p>\n\n<pre><code>struct in_ifaddr *ifa;\nstruct net_device *dev = dev_get_by_name(&amp;init_net, \"wlp7s0\");\nif(!dev) {\n    printk(KERN_ERR \"Can't obtain device\\n\");\n    return;\n}\n\n// roughly\nrcu_read_lock();\nfor(ifa = rcu_dereference(dev-&gt;ip_ptr-&gt;ifa_list);\n          ifa;\n          ifa = rcu_dereference(ifa-&gt;ifa_next))\n    printk(\"address: %pI4, mask: %pI4\\n\", &amp;ifa-&gt;ifa_address, &amp;ifa-&gt;ifa_mask);\nrcu_read_unlock();\n</code></pre>\n\n<p>From example you can see that you can handle the whole chain(that @larsks mentioned in comment) depending on some specific logic.</p>\n\n<p>P.S. don't forget to include <code>&lt;linux/netdevice.h&gt;</code> and <code>&lt;linux/inetdevice.h&gt;</code>.</p>\n"}], "owner": {"reputation": 23, "user_id": 9642917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e69621d68d4c283cb0069387a1f9e61?s=128&d=identicon&r=PG&f=1", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439", "link": "https://stackoverflow.com/users/9642917/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 59400074, "answer_count": 1, "score": 0, "last_activity_date": 1576751697, "creation_date": 1576617135, "last_edit_date": 1576703941, "question_id": 59382141, "link": "https://stackoverflow.com/questions/59382141/obtain-interface-netmask-in-linux-kernel-module", "title": "Obtain interface netmask in Linux kernel module", "body": "<p>I write Linux kernel module with netfilter hook. I want to block any packet that is not from my subnet.</p>\n\n<p>Is there any simple method to get netmask of the interface in kernel-mode? I found only the way to get it using <code>ioctl()</code> in user-mode.</p>\n"}, {"tags": ["python", "c++", "c", "types", "swig"], "comments": [{"owner": {"reputation": 531, "user_id": 8339821, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0148d1cfa01aea7231cf3195f54f2d78?s=128&d=identicon&r=PG&f=1", "display_name": "user14063792468", "link": "https://stackoverflow.com/users/8339821/user14063792468"}, "edited": false, "score": 0, "creation_date": 1576639054, "post_id": 59382118, "comment_id": 104961471, "body": "I know nothing about typemap thingy, but abovementioned types are just ints. At least they were ints last time I had used windows. If you compiling a C code, you could, with a glance at win32 headers, typedef these types as int. In python... I just do not know how to do a cast. Never thought of it. Maybe int(value) will do?"}, {"owner": {"reputation": 116, "user_id": 8406172, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3Ko7V.jpg?s=128&g=1", "display_name": "tansy", "link": "https://stackoverflow.com/users/8406172/tansy"}, "edited": false, "score": 0, "creation_date": 1578428450, "post_id": 59382118, "comment_id": 105433290, "body": "According to msdn <a href=\"https://docs.microsoft.com/en-us/windows/win32/winprog/windows-data-types\" rel=\"nofollow noreferrer\">windows data types</a>, they are pointers <code>typedef void *PVOID; typedef PVOID HANDLE; typedef HANDLE HWND; </code> <i>void*</i> pointers to be more precise."}], "answers": [{"tags": [], "owner": {"reputation": 2343, "user_id": 9448377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Wim Lavrijsen", "link": "https://stackoverflow.com/users/9448377/wim-lavrijsen"}, "is_accepted": true, "score": 2, "last_activity_date": 1576652688, "creation_date": 1576652688, "answer_id": 59386979, "question_id": 59382118, "link": "https://stackoverflow.com/questions/59382118/how-do-i-wrap-hwnd-and-hinstance-types-with-swig/59386979#59386979", "title": "How do I wrap HWND and HINSTANCE types with SWIG?", "body": "<p>These types are <code>void*</code>s per the Microsoft documentation:\n  <a href=\"https://docs.microsoft.com/en-us/windows/win32/winprog/windows-data-types\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/windows/win32/winprog/windows-data-types</a></p>\n\n<p>Although to be sure, cppyy (through Clang parsing the Windows headers) resolves them as pointers to opaque types (i.e. forward declared, but not defined):</p>\n\n<pre><code>$ python\n&gt;&gt;&gt; import cppyy\n&gt;&gt;&gt; print(cppyy.gbl.HWND)\n&lt;cppyy.TypedefPointerToClass object at 0x00000245E8839558&gt;\n&gt;&gt;&gt;\n</code></pre>\n\n<p>so you may want to look up the typedefs if you want to know for sure.</p>\n\n<p>However, regardless whether HWND and HINSTANCE are pointers to opaque classes or pointers to <code>void</code>, even as you could cast them on 32b Windows, on 64b casting from <code>long</code> to <code>void*</code> (or \"<code>opaque*</code>\") won't work because the <code>long</code> value will have been truncated. So, use <code>PyLong_AsVoidPtr</code> instead of <code>PyInt_AsLong</code> in your typemap. See the Python C-API documentation:\n  <a href=\"https://docs.python.org/3/c-api/long.html#c.PyLong_AsVoidPtr\" rel=\"nofollow noreferrer\">https://docs.python.org/3/c-api/long.html#c.PyLong_AsVoidPtr</a></p>\n\n<p>If the types are of opaque classes, you will also need the explicit cast, and the final code would look like:</p>\n\n<pre><code>/* handle HINSTANCE */\n%typemap(in) HINSTANCE {\n    $1 = (HINSTANCE)PyLong_AsVoidPtr($input);\n}\n\n/* handle hwnds */\n%typemap(in) HWND {\n    $1 = (HWND)PyLong_AsVoidPtr($input);\n}\n</code></pre>\n\n<p>Of course, if both <code>HWND</code> and <code>HINSTANCE</code> are indeed <code>void*</code> as per that Microsoft documentation page, then that cast will be a no-op.</p>\n"}], "owner": {"reputation": 308, "user_id": 992521, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/sa3jr.jpg?s=128&g=1", "display_name": "Nick2253", "link": "https://stackoverflow.com/users/992521/nick2253"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 59386979, "answer_count": 1, "score": 0, "last_activity_date": 1576652688, "creation_date": 1576617032, "last_edit_date": 1576617536, "question_id": 59382118, "link": "https://stackoverflow.com/questions/59382118/how-do-i-wrap-hwnd-and-hinstance-types-with-swig", "title": "How do I wrap HWND and HINSTANCE types with SWIG?", "body": "<p>I'm wrapping a third-party provided Windows DLL with SWIG for use in Python.  I have been able to successfully compile my SWIG module and import it into Python, but I'm running into issues with one function (from the <code>.h</code> header file):</p>\n\n<pre><code>_APPFN ServerID _CALLCONV OpenServer(HINSTANCE hAppInst, HWND hWnd);\n</code></pre>\n\n<p>I'm running into issues using this function, because I don't have types for <code>HINSTANCE</code> or <code>HWND</code> in Python.  Per the documentation for this function, these values can be null, 0, or basically anything (currently an unused feature), so I'm trying to figure out how to use <code>typemap</code> to make these integers so I can just pass in 0s.  From my <code>.i</code> file:</p>\n\n<pre><code>/* handle HINSTANCE */\n%typemap(in) HINSTANCE {\n    $1 = PyInt_AsLong($input);\n}\n\n/* handle hwnds */\n%typemap(in) HWND {\n    $1 = PyInt_AsLong($input);\n}\n</code></pre>\n\n<p>When I try to compile my wrapper file (I'm using Visual Studio) with the above typemaps, I get errors: <code>cannot convert from 'long' to 'HINSTANCE'</code> and <code>cannot convert from 'long' to 'HWND'</code>.</p>\n\n<p>Based on my reading, I believe that <code>HINSTANCE</code> and <code>HWND</code> are \"structs\", and so I need to do something in order to \"cast\" the struct to an integer, but unfortunately, this is all really above my head.  I'm mostly a self-taught Python programmer, and dealing with C/C++ data typing is rather confusing.</p>\n\n<p>I'm hoping that someone can look at what I'm doing, and guide me on how I need to change my typemapping.</p>\n"}, {"tags": ["c", "algorithm", "optimization"], "comments": [{"owner": {"reputation": 19034, "user_id": 780717, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/eead3a6ab011b880ca6ec354ca00f0b3?s=128&d=identicon&r=PG", "display_name": "njuffa", "link": "https://stackoverflow.com/users/780717/njuffa"}, "edited": false, "score": 0, "creation_date": 1576627391, "post_id": 59382071, "comment_id": 104959350, "body": "Try this: <code>y &#47; x**(3&#47;2) = y * x**(-3&#47;2) = y * x**(-1) * x**(-1&#47;2) = y * (1&#47;x) * rsqrt(x)</code>, where <code>**</code> denotes exponentiation. Your compiler may or may not offer <code>rsqrt()</code> as it is currently an extension (to be included in a future standard). Check the documentation. Reciprocal 1/x should be cheap when you compile with a &quot;fast math&quot; switch."}], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "edited": false, "score": 0, "creation_date": 1576618225, "post_id": 59382150, "comment_id": 104956692, "body": "Where can I find a more extensive explanation?"}, {"owner": {"reputation": 44162, "user_id": 752843, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/dfab97c10311207545414b6d7d9bde93?s=128&d=identicon&r=PG", "display_name": "Richard", "link": "https://stackoverflow.com/users/752843/richard"}, "reply_to_user": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "edited": false, "score": 3, "creation_date": 1576618623, "post_id": 59382150, "comment_id": 104956863, "body": "@Chariot: I think Google is the best way to go there. Your question is very broad with many possible answers, so asking here is not the best solution."}], "tags": [], "owner": {"reputation": 44162, "user_id": 752843, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/dfab97c10311207545414b6d7d9bde93?s=128&d=identicon&r=PG", "display_name": "Richard", "link": "https://stackoverflow.com/users/752843/richard"}, "is_accepted": true, "score": 6, "last_activity_date": 1576617169, "creation_date": 1576617169, "answer_id": 59382150, "question_id": 59382071, "link": "https://stackoverflow.com/questions/59382071/optimizing-n-body-simulation/59382150#59382150", "title": "Optimizing n-body simulation", "body": "<p>Convert</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>for(int i=0;i&lt;N;i++)\nfor(int j=0;j&lt;N;j++)\n</code></pre>\n\n<p>into</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>for(int i=0;  i&lt;N;i++)\nfor(int j=i+1;j&lt;N;j++)\n</code></pre>\n\n<p>Restructure to take advantage of <a href=\"https://en.wikipedia.org/wiki/SIMD\" rel=\"noreferrer\">SIMD</a> operators, this can quadruple your throughput.</p>\n\n<p>Use <a href=\"https://www.openmp.org/\" rel=\"noreferrer\">OpenMP</a> to parallelize the loops either across your CPU or by offloading to your GPU (OpenMP 4.5+).</p>\n\n<p>Learn about the <a href=\"https://en.wikipedia.org/wiki/Barnes%E2%80%93Hut_simulation\" rel=\"noreferrer\">Barnes-Hut algorithm</a>, which groups particles to achieve <em>O(N log N)</em> complexity (down from your <em>O(N^2)</em>).</p>\n"}, {"comments": [{"owner": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "edited": false, "score": 0, "creation_date": 1576672936, "post_id": 59383779, "comment_id": 104974241, "body": "I have tried this real s = jMass * POW(distSqr, -3.0/2.0); but the compiler does the division equally"}], "tags": [], "owner": {"reputation": 6746, "user_id": 8185995, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02d69271095c22ec7a2f5cad43ea3ac0?s=128&d=identicon&r=PG&f=1", "display_name": "robthebloke", "link": "https://stackoverflow.com/users/8185995/robthebloke"}, "is_accepted": false, "score": 2, "last_activity_date": 1576627181, "creation_date": 1576627181, "answer_id": 59383779, "question_id": 59382071, "link": "https://stackoverflow.com/questions/59382071/optimizing-n-body-simulation/59383779#59383779", "title": "Optimizing n-body simulation", "body": "<p>This is actually quite a nice one to SIMD. It's worth noting that this:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>real s = jMass / POW(distSqr,3.0/2.0);\n</code></pre>\n\n<p>can be refactored into this if you negate the power: (removes a division)</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>real s = jMass * POW(distSqr, -3.0/2.0);\n</code></pre>\n\n<p>Its now worth noting that you can remove the call to pow completely here, since you are dealing with a very simple exponent. so... </p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>real s = jMass * std::sqrt(distSqr) / (distSqr * distSqr);\n</code></pre>\n\n<p>If you know your laws of powers, you can do an additional refactor step here:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>real s = jMass / (std::sqrt(distSqr) * distSqr);\n</code></pre>\n\n<p>Now with any luck, your compiler <em>should</em> hopefully be performing this transformation for you already (you'll need -O2 and -ffast-math typically). Example:\n<a href=\"https://godbolt.org/z/8YqFYA\" rel=\"nofollow noreferrer\">https://godbolt.org/z/8YqFYA</a></p>\n\n<p>The reason this is nice, is that now you have removed a cmath call from your code completely. This makes it very easy to drop to something like simd, and extremely easy if you happpen to be using clang or gcc. e.g. </p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;immintrin.h&gt;\n\ntypedef __m256 real;\nstruct real3 { real x, y, z; };\n\n// i had to make up a value\nconst __m256 SOFTENING_SQUARED = _mm256_set1_ps(1.23f); \n\nreal3 bodyBodyInteraction(real iPosx, real iPosy, real iPosz, \n                          real jPosx, real jPosy, real jPosz, real jMass)\n{\n  real rx, ry, rz;\n\n  rx = jPosx - iPosx;\n  ry = jPosy - iPosy;\n  rz = jPosz - iPosz;\n\n  real distSqr = rx*rx+ry*ry+rz*rz;\n  distSqr += SOFTENING_SQUARED;\n\n  real s = jMass / (_mm256_sqrt_ps(distSqr) * distSqr);\n\n  real3 f;\n  f.x = rx * s;\n  f.y = ry * s;\n  f.z = rz * s;\n\n  return f;\n}\n</code></pre>\n\n<p>And in godbolt:</p>\n\n<p><a href=\"https://godbolt.org/z/JTCwm-\" rel=\"nofollow noreferrer\">https://godbolt.org/z/JTCwm-</a></p>\n"}], "owner": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 59382150, "answer_count": 2, "score": 0, "last_activity_date": 1576627181, "creation_date": 1576616763, "last_edit_date": 1576619931, "question_id": 59382071, "link": "https://stackoverflow.com/questions/59382071/optimizing-n-body-simulation", "title": "Optimizing n-body simulation", "body": "<p>I'm trying to optimize the n-body algorithm, I have seen that the most expensive function is this:</p>\n\n<pre><code>real3 bodyBodyInteraction(real iPosx, real iPosy, real iPosz, \n                          real jPosx, real jPosy, real jPosz, real jMass)\n{\n  real rx, ry, rz;\n\n  rx = jPosx - iPosx;\n  ry = jPosy - iPosy;\n  rz = jPosz - iPosz;\n\n  real distSqr = rx*rx+ry*ry+rz*rz;\n  distSqr += SOFTENING_SQUARED;\n\n\n   real s = jMass / POW(distSqr,3.0/2.0); //very expensive\n\n  real3 f;\n  f.x = rx * s;\n  f.y = ry * s;\n  f.z = rz * s;\n\n  return f;\n}\n</code></pre>\n\n<p>Using perf record I can see the division is the most expensive instruction and this one have a O(n^2) complexity, but I don't really know how to optimize it. </p>\n"}, {"tags": ["c", "floating-point", "rounding"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1576617072, "post_id": 59381846, "comment_id": 104956189, "body": "65519 is an integer. Round to what? Are you just setting the last <i>N</i> bits to zero?"}, {"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1576617604, "post_id": 59381846, "comment_id": 104956415, "body": "@tadman This is half-precision floating point so OP must mean 65519.0 cannot be represented."}, {"owner": {"reputation": 163, "user_id": 10344534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f6a329d546ebb9d0981763614a3c9c1?s=128&d=identicon&r=PG&f=1", "display_name": "envy grunt", "link": "https://stackoverflow.com/users/10344534/envy-grunt"}, "edited": false, "score": 0, "creation_date": 1576617885, "post_id": 59381846, "comment_id": 104956515, "body": "it cannot be represented. For example, i want to round integers between 32768 and 65519 to a multiple of 32, integers between 16384 and 32768 round to a multiple of 16 and so on. Looking for best way to implement this on c"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "reply_to_user": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 0, "creation_date": 1576618609, "post_id": 59381846, "comment_id": 104956856, "body": "@FiddlingBits That&#39;d make more sense, sure."}], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 10344534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f6a329d546ebb9d0981763614a3c9c1?s=128&d=identicon&r=PG&f=1", "display_name": "envy grunt", "link": "https://stackoverflow.com/users/10344534/envy-grunt"}, "edited": false, "score": 0, "creation_date": 1576618066, "post_id": 59382320, "comment_id": 104956624, "body": "but in this way other values will still be truncated, for example 8199 will be represented by 8192, but the nearest representable for 8199 is 8200"}, {"owner": {"reputation": 378, "user_id": 2620017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/517078d0e5e19b98b4b8c7228da5aadf?s=128&d=identicon&r=PG", "display_name": "hko", "link": "https://stackoverflow.com/users/2620017/hko"}, "reply_to_user": {"reputation": 163, "user_id": 10344534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f6a329d546ebb9d0981763614a3c9c1?s=128&d=identicon&r=PG&f=1", "display_name": "envy grunt", "link": "https://stackoverflow.com/users/10344534/envy-grunt"}, "edited": false, "score": 1, "creation_date": 1576626782, "post_id": 59382320, "comment_id": 104959223, "body": "My edit should fix your issue. So down vote shouldn&#39;t be necessary anymore :) Unless I missed something else, please let me know."}, {"owner": {"reputation": 163, "user_id": 10344534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f6a329d546ebb9d0981763614a3c9c1?s=128&d=identicon&r=PG&f=1", "display_name": "envy grunt", "link": "https://stackoverflow.com/users/10344534/envy-grunt"}, "edited": false, "score": 1, "creation_date": 1576632361, "post_id": 59382320, "comment_id": 104960307, "body": "it doesn&#39;t work correct for some test cases (for example 65539 should be represented by infinity). I want to implement precision limitations exactly like they are described on Wiki page (<a href=\"https://en.wikipedia.org/wiki/Half-precision_floating-point_format\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Half-precision_floating-point_format</a>)"}, {"owner": {"reputation": 378, "user_id": 2620017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/517078d0e5e19b98b4b8c7228da5aadf?s=128&d=identicon&r=PG", "display_name": "hko", "link": "https://stackoverflow.com/users/2620017/hko"}, "reply_to_user": {"reputation": 163, "user_id": 10344534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f6a329d546ebb9d0981763614a3c9c1?s=128&d=identicon&r=PG&f=1", "display_name": "envy grunt", "link": "https://stackoverflow.com/users/10344534/envy-grunt"}, "edited": false, "score": 0, "creation_date": 1576633396, "post_id": 59382320, "comment_id": 104960509, "body": "Actually just read your title again, it mentions round-to-even. Now I understand what you want."}, {"owner": {"reputation": 163, "user_id": 10344534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f6a329d546ebb9d0981763614a3c9c1?s=128&d=identicon&r=PG&f=1", "display_name": "envy grunt", "link": "https://stackoverflow.com/users/10344534/envy-grunt"}, "edited": false, "score": 0, "creation_date": 1576633534, "post_id": 59382320, "comment_id": 104960528, "body": "i want round-to-even, i think in this case it will be equal to round to nearest representable. Am i wrong?"}, {"owner": {"reputation": 378, "user_id": 2620017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/517078d0e5e19b98b4b8c7228da5aadf?s=128&d=identicon&r=PG", "display_name": "hko", "link": "https://stackoverflow.com/users/2620017/hko"}, "reply_to_user": {"reputation": 163, "user_id": 10344534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f6a329d546ebb9d0981763614a3c9c1?s=128&d=identicon&r=PG&f=1", "display_name": "envy grunt", "link": "https://stackoverflow.com/users/10344534/envy-grunt"}, "edited": false, "score": 1, "creation_date": 1576636828, "post_id": 59382320, "comment_id": 104961093, "body": "I updated the code again. I think this time it should round-to-even"}, {"owner": {"reputation": 163, "user_id": 10344534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f6a329d546ebb9d0981763614a3c9c1?s=128&d=identicon&r=PG&f=1", "display_name": "envy grunt", "link": "https://stackoverflow.com/users/10344534/envy-grunt"}, "edited": false, "score": 0, "creation_date": 1576678385, "post_id": 59382320, "comment_id": 104977056, "body": "can value (manbits - 13) become negative in this implementation ? Can you explain why it&#39;s correct ?"}, {"owner": {"reputation": 163, "user_id": 10344534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f6a329d546ebb9d0981763614a3c9c1?s=128&d=identicon&r=PG&f=1", "display_name": "envy grunt", "link": "https://stackoverflow.com/users/10344534/envy-grunt"}, "edited": false, "score": 0, "creation_date": 1576682456, "post_id": 59382320, "comment_id": 104979411, "body": "there are still problems with representing some integers, trying to find suitable test cases for them"}, {"owner": {"reputation": 378, "user_id": 2620017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/517078d0e5e19b98b4b8c7228da5aadf?s=128&d=identicon&r=PG", "display_name": "hko", "link": "https://stackoverflow.com/users/2620017/hko"}, "reply_to_user": {"reputation": 163, "user_id": 10344534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f6a329d546ebb9d0981763614a3c9c1?s=128&d=identicon&r=PG&f=1", "display_name": "envy grunt", "link": "https://stackoverflow.com/users/10344534/envy-grunt"}, "edited": false, "score": 0, "creation_date": 1576691937, "post_id": 59382320, "comment_id": 104984520, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/204498/discussion-between-hko-and-envy-grunt\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 378, "user_id": 2620017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/517078d0e5e19b98b4b8c7228da5aadf?s=128&d=identicon&r=PG", "display_name": "hko", "link": "https://stackoverflow.com/users/2620017/hko"}, "is_accepted": true, "score": 3, "last_activity_date": 1576698639, "last_edit_date": 1576698639, "creation_date": 1576617895, "answer_id": 59382320, "question_id": 59381846, "link": "https://stackoverflow.com/questions/59381846/convert-integer-to-half-precision-floating-point-format-using-round-to-even/59382320#59382320", "title": "Convert integer to half-precision floating point format using round-to-even", "body": "<p>You need two pieces to achieve what you want.</p>\n\n<p><strong>1. add rounding before you do the conversion</strong></p>\n\n<p>&emsp;&emsp;by adding:</p>\n\n<pre><code>  // round the number if necessary before we do the conversion\n  if (manbits &gt; 13)\n    absx += (2&lt;&lt;(manbits-13));\n\n  manbits = 0;\n  tmp = absx;\n  while (tmp)\n  {\n    tmp &gt;&gt;= 1;\n    manbits++;\n  }\n</code></pre>\n\n<p>&emsp;&emsp;before you do the conversion.</p>\n\n<p><strong>2. Change the clipping to infinty to <code>&gt; 16</code></strong></p>\n\n<p>&emsp;&emsp;by changing</p>\n\n<pre><code>  if (exp + truncated &gt; 15)\n</code></pre>\n\n<p>&emsp;&emsp;to:</p>\n\n<pre><code>  if (exp + truncated &gt; 16)\n</code></pre>\n\n<p>I updated the original code <a href=\"https://ideone.com/mWqgSP\" rel=\"nofollow noreferrer\">https://ideone.com/mWqgSP</a></p>\n"}], "owner": {"reputation": 163, "user_id": 10344534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f6a329d546ebb9d0981763614a3c9c1?s=128&d=identicon&r=PG&f=1", "display_name": "envy grunt", "link": "https://stackoverflow.com/users/10344534/envy-grunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 59382320, "answer_count": 1, "score": 4, "last_activity_date": 1576698639, "creation_date": 1576615658, "last_edit_date": 1576618299, "question_id": 59381846, "link": "https://stackoverflow.com/questions/59381846/convert-integer-to-half-precision-floating-point-format-using-round-to-even", "title": "Convert integer to half-precision floating point format using round-to-even", "body": "<p>I already know how to implement conversion to half-precision floating point using truncating (thanks to <a href=\"https://stackoverflow.com/a/12819124/10344534\">this answer</a>). But how can I do the same conversion using rounding for nearest representable ? For example, i want 65519 to round to 0x7bff (which is 65504), not to infinity. One more example: in the linked solution 8199 will be represented by 8192, but the nearest representable for 8199 is 8200</p>\n\n<p><strong>UPD:</strong> For more example cases:  I want to round integers between 32768 and 65519 to a multiple of 32, integers between 16384 and 32768 round to a multiple of 16 and so on. In this solution 8199 will be represented by 8192, but the nearest representable for 8199 is 8200</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 0, "creation_date": 1576615081, "post_id": 59381702, "comment_id": 104955403, "body": "Edit your code, put an obnoxious ugly (easy to see) comment in the code showing where the problem occurs.  (if it&#39;s already there, I did not find it. :)"}, {"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 0, "creation_date": 1576615393, "post_id": 59381702, "comment_id": 104955550, "body": "My bad, I must have copied wrong.  The code is complete. (embarrassed)."}, {"owner": {"reputation": 1, "user_id": 12554491, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAD2rY5s89iVxGnJwZRM1J4A1E3tVVtViLMBtiKxQ=k-s128", "display_name": "ORR AVRAHAM", "link": "https://stackoverflow.com/users/12554491/orr-avraham"}, "reply_to_user": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 0, "creation_date": 1576615432, "post_id": 59381702, "comment_id": 104955561, "body": "Hey sorry for the inconvenience I edited the code to the exact line were the problem is"}, {"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 0, "creation_date": 1576615532, "post_id": 59381702, "comment_id": 104955597, "body": "Still do not see it.  About what line, or what word can I search for?"}, {"owner": {"reputation": 1, "user_id": 12554491, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAD2rY5s89iVxGnJwZRM1J4A1E3tVVtViLMBtiKxQ=k-s128", "display_name": "ORR AVRAHAM", "link": "https://stackoverflow.com/users/12554491/orr-avraham"}, "reply_to_user": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 0, "creation_date": 1576615661, "post_id": 59381702, "comment_id": 104955639, "body": "This is the line that doesn&#39;t work basically:if (getCell(row, col) == &#39;X&#39; &amp;&amp; getCell(row - 1, col + 1) == &#39;X&#39; &amp;&amp; getCell(row - 2, col + 2) == &#39;X&#39; &amp;&amp; getCell(row - 3, col + 3) == &#39;X&#39;)\\\\this is the part that doesn&#39;t work for some reason          {             return 1;         }"}, {"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 0, "creation_date": 1576617686, "post_id": 59381702, "comment_id": 104956439, "body": "In the expression:  <code>getCell(row - 3, col + 3)</code>, What would happen if <code>row  &lt;  3</code>?  Can that happen in your code?"}], "answers": [{"tags": [], "owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "is_accepted": false, "score": 1, "last_activity_date": 1576673672, "last_edit_date": 1576673672, "creation_date": 1576615949, "answer_id": 59381911, "question_id": 59381702, "link": "https://stackoverflow.com/questions/59381702/win-check-function-isnt-working-properly-in-connect-four-programmed-in-c/59381911#59381911", "title": "win check function isn&#39;t working properly in connect four programmed in c;", "body": "<p>One apparent problem is that this code seems to be more liberal in its array indexing than the C language allows for.<br>\nC uses <a href=\"https://developerinsider.co/why-does-the-indexing-of-array-start-with-zero-in-c/\" rel=\"nofollow noreferrer\">zero based indexing for arrays</a>.  For example, an array such as this:</p>\n\n<pre><code>int array[10]; //has room for 10 integer values, accessed like this:\n\nfor(int i=0;i&lt;10;i++)\n{\n    array[i] = i;  //populates array[0] through array[9]\n}\n</code></pre>\n\n<p>eg. For:</p>\n\n<pre><code>#define ROWS 6\n#define COLS 7\nchar board[ROWS][COLS];\n\n ...\n\n    for (i = 1; i &lt;= 4; i++)\n    {\n        if (getCell(row, i) == 'X' &amp;&amp; getCell(row, i + 1) == 'X' &amp;&amp; getCell(row, i + 2) == 'X' &amp;&amp; getCell(row, i + 3) == 'X')\n</code></pre>\n\n<p>Array indexing should really be:</p>\n\n<pre><code>    for (i = 0; i &lt; 7; i++)\n    {     \n        if (getCell(row, i) == 'X' &amp;&amp; getCell(row, i + 1) == 'X' &amp;&amp; getCell(row, i + 2) == 'X' &amp;&amp; getCell(row, i + 3) == 'X')\n</code></pre>\n\n<p>In this section <code>row - 3</code> will at some point be a negative value, resulting in a negative array index, which might be the problem you were seeing:</p>\n\n<pre><code>   if (getCell(row, col) == 'X' &amp;&amp; getCell(row - 1, col + 1) == 'X' &amp;&amp; getCell(row - 2, col + 2) == 'X' &amp;&amp; getCell(row - 3, col + 3) == 'X')\n    {\n        return 1;\n    }\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 12554491, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAD2rY5s89iVxGnJwZRM1J4A1E3tVVtViLMBtiKxQ=k-s128", "display_name": "ORR AVRAHAM", "link": "https://stackoverflow.com/users/12554491/orr-avraham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "closed_date": 1576626270, "answer_count": 1, "score": 0, "last_activity_date": 1576673672, "creation_date": 1576614855, "last_edit_date": 1576615358, "question_id": 59381702, "link": "https://stackoverflow.com/questions/59381702/win-check-function-isnt-working-properly-in-connect-four-programmed-in-c", "closed_reason": "Not suitable for this site", "title": "win check function isn&#39;t working properly in connect four programmed in c;", "body": "<p>Hey guys so i'm just starting to learn c and my teacher gave me an assignment to create a version of connect four; everything works great exept for the wincheck for the bottom left with player one , the code is identical but for some reason it wont recognize a bottom left diaganol for player one and i cnat figure out why here is what i got so far (note that some functions were given to me by the teacher himself so their definition is kind of lacking):</p>\n\n<pre><code>#define _CRT_SECURE_NO_WARNINGS\n#include \"stdio.h\"\n#include&lt;stdbool.h&gt;\n#include \"stdlib.h\"\n#define MAXturns 42\n#define ROWS 6\n#define COLS 7\nchar board[ROWS][COLS];\n\nvoid printboard();\n\n\nchar playerswap(int i);\n\nint inputprint(int colp, char apropriate);\n\nint wincheck(int row, int col);\n\nvoid initBoard();\n\nchar getCell(int row, int col);\n\nvoid setCell(int row, int col, char sign);\n\nvoid clearScreen();\nint main()\n{\n    int i, col = 0,clonerow=0;\n    initBoard();\n    printboard();\n    printf(\"\\n\");\n    for ( i = 0; i &lt;=MAXturns ; i++)  \n    {\n        if (i==MAXturns)\n        {\n            printf(\"it's a tie try again\\n\");\n            system(\"pause\");\n            clearScreen();\n            initBoard();\n            printboard();\n            i = 0;\n        }\n        if (playerswap(i) == 'X') \n        {\n            printf(\"\\nPlayer1:\\nPlease enter a column number between 1-7:\\n\");\n        }\n        else\n        {\n            printf(\"\\nPlayer2:\\nPlease enter a column number between 1-7:\\n\");\n        }\n        scanf(\"%d\", &amp;col);\n        if (col &gt; 0 &amp;&amp; col &lt;= COLS)\n        {\n            if (getCell(1, col) != ' ')\n            {\n                printf(\"no room please try another column.\\n\");\n                i--;\n            }\n            else\n            {\n                clonerow=inputprint(col, playerswap(i));\n                clearScreen();\n                printboard();\n                printf(\"\\n\");\n            }\n        }\n        else\n        {\n            printf(\"non applicable input\\n\");\n            i--;\n        }\n        if (wincheck(clonerow,col)==1)\n        {\n            printf(\"\\nplayer 1 you'r the winner!!!!\\n\");\n            system(\"pause\");\n            break;\n        }\n        else\n        {\n            if (wincheck(clonerow,col)==2)\n            {\n                printf(\"\\nplayer 2 you'r the winner!!!!\\n\");\n                system(\"pause\");\n                break;\n            }\n        }\n    }\n    return 0;\n}\n\nchar getCell(int row, int col)\n{\n    return board[row - 1][col - 1];\n}\n\nvoid setCell(int row, int col, char sign)\n{\n    board[row - 1][col - 1] = sign;\n}\n\nvoid initBoard()\n{\n    int i, j;\n\n    for (i = 0; i &lt; ROWS; i++)\n    {\n        for (j = 0; j &lt; COLS; j++)\n        {\n            setCell(i + 1, j + 1, ' ');\n        }\n    }\n}\n\nvoid clearScreen()\n{\n    system(\"cls\");\n}\n    void printboard()\n{\n        int i, j, y_col = 1;\n        for (i = 0; i &lt;= ROWS; i++)\n        {\n            if (i == 0)\n            {\n                for (j = 1; j &lt;= COLS; j++)\n                    printf(\"  %d\", j);\n            }\n            else\n            {\n                printf(\"\\n\");\n                printf(\"%c\", i+64);\n                for (y_col = 1; y_col &lt;= COLS; y_col++)\n                {\n                    if (y_col == 1)\n                    {\n                        printf(\" %c\", getCell(i, y_col));\n                    }\n                    else\n                    {\n                    printf(\"  %c\", getCell(i, y_col));\n                    }\n                }\n            }\n        }\n    }\n    int wincheck(int row,int col)\n    {\n        int i = 1, j = 1;\n        for (i = 1; i &lt;= 4; i++)\n        {\n            if (getCell(row, i) == 'X' &amp;&amp; getCell(row, i + 1) == 'X' &amp;&amp; getCell(row, i + 2) == 'X' &amp;&amp; getCell(row, i + 3) == 'X')\n            {\n            return 1;\n            }\n            else\n            {\n            if (getCell(row, i) == 'O' &amp;&amp; getCell(row, i + 1) == 'O' &amp;&amp; getCell(row, i + 2) == 'O' &amp;&amp; getCell(row, i + 3) == 'O')\n                {\n                return 2;\n                }\n            }\n        }\n        if (row &lt;= 3)\n        {\n            for (j = 1; j &lt;= 3; j++)\n            {\n                if (getCell(j, col) == 'O' &amp;&amp; getCell(j + 1, col) == 'O' &amp;&amp; getCell(j + 2, col) == 'O' &amp;&amp; getCell(j + 3, col) == 'O')\n                {\n                return 2;\n                }\n                if (getCell(j, col) == 'X' &amp;&amp; getCell(j + 1, col) == 'X' &amp;&amp; getCell(j + 2, col) == 'X' &amp;&amp; getCell(j + 3, col) == 'X')\n                {\n                return 1;\n                }\n            }\n        }\n        if (getCell(row,col)=='X'&amp;&amp;getCell(row-1,col-1)=='X'&amp;&amp;getCell(row-2,col-2)=='X'&amp;&amp;getCell(row-3,col-3)=='X')\n        {\n            return 1;\n        }\n        if (getCell(row, col) == 'X' &amp;&amp; getCell(row - 1, col + 1) == 'X' &amp;&amp; getCell(row - 2, col + 2) == 'X' &amp;&amp; getCell(row - 3, col + 3) == 'X')\\\\this is the part that doesn't work for some reason \n        {\n            return 1;\n        }\n        if (getCell(row, col) == 'X' &amp;&amp; getCell(row+1, col - 1) == 'X' &amp;&amp; getCell(row+2, col - 2) == 'X' &amp;&amp; getCell(row+3, col - 3) == 'X')\n        {\n            return 1;\n        }\n\n        if (getCell(row, col) == 'O' &amp;&amp; getCell(row+1, col + 1) == 'O' &amp;&amp; getCell(row+2, col + 2) == 'O' &amp;&amp; getCell(row+3, col + 3) == 'O')\n        {\n            return 2;\n        }\n        if (getCell(row, col) == 'O' &amp;&amp; getCell(row - 1, col - 1) == 'O' &amp;&amp; getCell(row - 2, col - 2) == 'O' &amp;&amp; getCell(row - 3, col - 3) == 'O')\n        {\n            return 2;\n        }\n        if (getCell(row, col) == 'O' &amp;&amp; getCell(row - 1, col + 1) == 'O' &amp;&amp; getCell(row - 2, col + 2) == 'O' &amp;&amp; getCell(row - 3, col + 3) == 'O')\n        {\n            return 2;\n        }\n        if (getCell(row, col) == 'O' &amp;&amp; getCell(row + 1, col - 1) == 'O' &amp;&amp; getCell(row + 2, col - 2) == 'O' &amp;&amp; getCell(row + 3, col - 3) == 'O')\n        {\n            return 2;\n        }\n        if (getCell(row, col) == 'O' &amp;&amp; getCell(row + 1, col + 1) == 'O' &amp;&amp; getCell(row + 2, col + 2) == 'O' &amp;&amp; getCell(row + 3, col + 3) == 'O')\n        {\n            return 2;\n        }\n    }\n\n    int inputprint(int colp, char apropriate) {\n        int i;\n        for (i = 1; i &lt;= ROWS; i++)\n        {\n            if (getCell(i, colp) != ' ')\n            {\n                setCell(i - 1, colp, apropriate);\n                break;\n            }\n            else\n            {\n                if (i == ROWS)\n                    setCell(i, colp, apropriate);\n            }\n        }\n        return i-1;\n    }\n    char playerswap(int i)\n    {\n        if (i % 2 == 0)\n            return 'X';\n        else\n            return 'O';\n    }\n---\n</code></pre>\n"}, {"tags": ["c", "segmentation-fault"], "comments": [{"owner": {"reputation": 86506, "user_id": 701092, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xYrM0.jpg?s=128&g=1", "display_name": "0x499602D2", "link": "https://stackoverflow.com/users/701092/0x499602d2"}, "edited": false, "score": 5, "creation_date": 1576614156, "post_id": 59381570, "comment_id": 104955046, "body": "You didn&#39;t put a null terminator in <code>d</code>."}], "answers": [{"comments": [{"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 0, "creation_date": 1576614479, "post_id": 59381593, "comment_id": 104955166, "body": "Typo: <code>==</code> instead of <code>=</code>."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "reply_to_user": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 1, "creation_date": 1576614522, "post_id": 59381593, "comment_id": 104955184, "body": "@FiddlingBits It is not typo, its intentional, that line is whole loop. Edited to make that obvious and avoid possible compiler warning"}, {"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 0, "creation_date": 1576614565, "post_id": 59381593, "comment_id": 104955197, "body": "Okay, I get it now.  When <code>s[i] == 0</code> it ends."}, {"owner": {"reputation": 26087, "user_id": 1312406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5418f577abfa7c529dd026723462b440?s=128&d=identicon&r=PG", "display_name": "Paul Evans", "link": "https://stackoverflow.com/users/1312406/paul-evans"}, "edited": false, "score": 0, "creation_date": 1576614704, "post_id": 59381593, "comment_id": 104955245, "body": "Some might argue about <code>for( size_t i = 0; ( s[i] = d[i] ) != 0; ++i );</code> being a <i>proper loop</i>."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "reply_to_user": {"reputation": 26087, "user_id": 1312406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5418f577abfa7c529dd026723462b440?s=128&d=identicon&r=PG", "display_name": "Paul Evans", "link": "https://stackoverflow.com/users/1312406/paul-evans"}, "edited": false, "score": 1, "creation_date": 1576614727, "post_id": 59381593, "comment_id": 104955254, "body": "@PaulEvans what is wrong with it? (despite I assigned to <code>s</code> instead of <code>d</code>)"}, {"owner": {"reputation": 26087, "user_id": 1312406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5418f577abfa7c529dd026723462b440?s=128&d=identicon&r=PG", "display_name": "Paul Evans", "link": "https://stackoverflow.com/users/1312406/paul-evans"}, "reply_to_user": {"reputation": 11, "user_id": 12525382, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mDu8KFHrIUfQZKkrxUGN8tgveZdGJ7_Neel1mWq=k-s128", "display_name": "Shinobi San", "link": "https://stackoverflow.com/users/12525382/shinobi-san"}, "edited": false, "score": 2, "creation_date": 1576614788, "post_id": 59381593, "comment_id": 104955283, "body": "@ShinobiSan Well right of the bat the person you&#39;re showing it to misunderstood it. And it&#39;s bad to combine assignment and a boolean expression.  Hard for anyone to read and reason about. And a <code>for</code> loop having no body is also hard to read, what if the subsequent line gets indented and is read as the body? Or is indented because someone thinks it&#39;s the body?"}, {"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "reply_to_user": {"reputation": 26087, "user_id": 1312406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5418f577abfa7c529dd026723462b440?s=128&d=identicon&r=PG", "display_name": "Paul Evans", "link": "https://stackoverflow.com/users/1312406/paul-evans"}, "edited": false, "score": 1, "creation_date": 1576615201, "post_id": 59381593, "comment_id": 104955464, "body": "I agree with @PaulEvans.  For an empty body I&#39;d at least add <code>continue</code> so that my intention is clear."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "reply_to_user": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 0, "creation_date": 1576615270, "post_id": 59381593, "comment_id": 104955499, "body": "@FiddlingBits that&#39;s a matter of taste"}, {"owner": {"reputation": 26087, "user_id": 1312406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5418f577abfa7c529dd026723462b440?s=128&d=identicon&r=PG", "display_name": "Paul Evans", "link": "https://stackoverflow.com/users/1312406/paul-evans"}, "edited": false, "score": 1, "creation_date": 1576615380, "post_id": 59381593, "comment_id": 104955542, "body": "@SlavasupportsMonica It&#39;s a matter of readability not taste.  The number one reason it&#39;s bad is exactly what happened right off the bat -- someone thinking you meant <code>==</code> instead of assignment. Languages have banned it for this reason."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "reply_to_user": {"reputation": 26087, "user_id": 1312406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5418f577abfa7c529dd026723462b440?s=128&d=identicon&r=PG", "display_name": "Paul Evans", "link": "https://stackoverflow.com/users/1312406/paul-evans"}, "edited": false, "score": 0, "creation_date": 1576615526, "post_id": 59381593, "comment_id": 104955592, "body": "@PaulEvans readability is quite subjective. I found this code readable and I added condition to make it obvious. In current version its quite difficult not to see intention of assignment there."}, {"owner": {"reputation": 26087, "user_id": 1312406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5418f577abfa7c529dd026723462b440?s=128&d=identicon&r=PG", "display_name": "Paul Evans", "link": "https://stackoverflow.com/users/1312406/paul-evans"}, "edited": false, "score": 1, "creation_date": 1576615693, "post_id": 59381593, "comment_id": 104955657, "body": "@SlavasupportsMonica Readability is all about making it easier for <i>most people to read</i>. It&#39;s not about: I can read it so therefore it&#39;s readable. It&#39;s not subjective at all if it truly is readable."}, {"owner": {"reputation": 26087, "user_id": 1312406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5418f577abfa7c529dd026723462b440?s=128&d=identicon&r=PG", "display_name": "Paul Evans", "link": "https://stackoverflow.com/users/1312406/paul-evans"}, "edited": false, "score": 0, "creation_date": 1576615886, "post_id": 59381593, "comment_id": 104955739, "body": "Speaking about decisions that language designers (<i>eg</i> Python) have made and why they made them."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "reply_to_user": {"reputation": 26087, "user_id": 1312406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5418f577abfa7c529dd026723462b440?s=128&d=identicon&r=PG", "display_name": "Paul Evans", "link": "https://stackoverflow.com/users/1312406/paul-evans"}, "edited": false, "score": 0, "creation_date": 1576616038, "post_id": 59381593, "comment_id": 104955791, "body": "@PaulEvans we are talking about C here, not python. Such code is quite common for C and should be readable for any seasoned C developer. I do not think you have to write code in C readable for python developers. (disclaimer I do not have anything against python or python developers)."}], "tags": [], "owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "is_accepted": true, "score": 2, "last_activity_date": 1576615116, "last_edit_date": 1576615116, "creation_date": 1576614224, "answer_id": 59381593, "question_id": 59381570, "link": "https://stackoverflow.com/questions/59381570/iam-having-segmentation-fault-and-i-dont-understand-why/59381593#59381593", "title": "I&#39;am having segmentation fault and i don&#39;t understand why", "body": "<p>In this line of code:</p>\n\n<pre><code>int i, p = 0;\n</code></pre>\n\n<p>you only initialize <code>p</code>, variable <code>i</code> is uninitialized, reading from it leads to UB.</p>\n\n<p>Proper loop could be written like this:</p>\n\n<pre><code>for( size_t i = 0; ( d[i] = s[i] ) != 0; ++i );\n</code></pre>\n\n<p>(it will also copy null-terminator which you would be missing if initialize <code>i</code> properly)</p>\n\n<p>Another variant is classical C way:</p>\n\n<pre><code>void cp(const char *s, char *d) \n{\n    while( *d++ = *s++ );\n}\n</code></pre>\n\n<p>but usually in C target is the first parameter, not the second (for example <code>strcpy()</code>)</p>\n"}, {"tags": [], "owner": {"reputation": 26087, "user_id": 1312406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5418f577abfa7c529dd026723462b440?s=128&d=identicon&r=PG", "display_name": "Paul Evans", "link": "https://stackoverflow.com/users/1312406/paul-evans"}, "is_accepted": false, "score": 1, "last_activity_date": 1576614431, "last_edit_date": 1576614431, "creation_date": 1576614262, "answer_id": 59381600, "question_id": 59381570, "link": "https://stackoverflow.com/questions/59381570/iam-having-segmentation-fault-and-i-dont-understand-why/59381600#59381600", "title": "I&#39;am having segmentation fault and i don&#39;t understand why", "body": "<p>You copy only while:</p>\n\n<pre><code>while (s[i] != '\\0')\n</code></pre>\n\n<p>so <code>'\\0'</code> isn't copied so when you run:</p>\n\n<pre><code> printf(\"%s\\n++++++++\\n%s\\n\", s, d);\n</code></pre>\n\n<p>you get a segfault.</p>\n\n<p>Also <code>i</code> is uninitialised:</p>\n\n<pre><code>int i, p = 0;\n</code></pre>\n\n<p>using separate lines avoids this typo:</p>\n\n<pre><code>int i = 0;\nint p = 0;\n</code></pre>\n\n<p>an uninitialised <code>i</code> can blow up:</p>\n\n<pre><code>d[i] = s[i];\n</code></pre>\n\n<p>causing a segfault.</p>\n"}], "owner": {"reputation": 11, "user_id": 12525382, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mDu8KFHrIUfQZKkrxUGN8tgveZdGJ7_Neel1mWq=k-s128", "display_name": "Shinobi San", "link": "https://stackoverflow.com/users/12525382/shinobi-san"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 59381593, "answer_count": 2, "score": -1, "last_activity_date": 1576615116, "creation_date": 1576614115, "last_edit_date": 1576614163, "question_id": 59381570, "link": "https://stackoverflow.com/questions/59381570/iam-having-segmentation-fault-and-i-dont-understand-why", "title": "I&#39;am having segmentation fault and i don&#39;t understand why", "body": "<p>As the title says. I don't Understand why this code gives me segfault!</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n\nvoid cp(char s[], char d[]);\nint main () {\n    char s[100] = \"hi there how are you\";\n    char d[100];\n    cp(s, d);\n    printf(\"%s\\n++++++++\\n%s\\n\", s, d);\n    return 0;\n}\n\nvoid cp(char s[], char d[]) {\n    int i, p = 0;\n    while (s[i] != '\\0') {\n        d[i] = s[i];\n        ++i;\n        ++p;\n    }\n}\n</code></pre>\n\n<p>I know the cp implementation is terrible! I wrote it like this just for fun, then the segfault happened.</p>\n"}, {"tags": ["c", "pointers", "malloc"], "comments": [{"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 6, "creation_date": 1576613179, "post_id": 59381353, "comment_id": 104954678, "body": "You can compare <code>argv[1]</code> to <code>argv[2]</code> directly: <code>strcmp(argv[1], argv[2])</code>."}, {"owner": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 4, "creation_date": 1576613248, "post_id": 59381353, "comment_id": 104954707, "body": "You don\u2019t need any allocations since on the next line you\u2019re leaking the allocated memory away by assigning another value to the variables. There\u2019s also no reason to cast into double pointer when they\u2019re just pointers. Just use the pointers as they are."}, {"owner": {"reputation": 1591, "user_id": 7264980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6251945f2fe3a58c482788f1cd20fa9?s=128&d=identicon&r=PG", "display_name": "Anatoliy R", "link": "https://stackoverflow.com/users/7264980/anatoliy-r"}, "edited": false, "score": 4, "creation_date": 1576613283, "post_id": 59381353, "comment_id": 104954718, "body": "you have <code>strTwo - argv[2];</code> in your code, probably should be <code>strTwo = argv[2];</code>, is that mistype or you run it?"}, {"owner": {"reputation": 27279, "user_id": 857132, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4fd51ed5980999c7c6ce3729d6cb2184?s=128&d=identicon&r=PG", "display_name": "John3136", "link": "https://stackoverflow.com/users/857132/john3136"}, "edited": false, "score": 1, "creation_date": 1576614360, "post_id": 59381353, "comment_id": 104955117, "body": "All the comments/answers are right but no one has said what you did wrong: 1) <code>strOne = argv[1];</code> in your case causes a memory leak. If you wanted a copy use <code>strdup</code> or <code>strcpy</code> into the buffer you allocated. 2) <code>cmpstringp()</code> is a mess. You pass it pointers but then you treat the parameters as <code>**</code>"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 3, "creation_date": 1576614402, "post_id": 59381353, "comment_id": 104955145, "body": "You&#39;re always allowed to pass a pointer to non-<code>const</code> to a function that expects <code>const</code>. The <code>const</code> in the function declaration just indicates that it will not modify the data, which is fine even though the argument data is modifiable."}], "answers": [{"comments": [{"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 1, "creation_date": 1576613648, "post_id": 59381451, "comment_id": 104954857, "body": "<code>if(strcmp(argv[1], argv[2]) == 0)</code> would work too, unless you&#39;re paid by the line. ;-)"}, {"owner": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "reply_to_user": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 0, "creation_date": 1576613760, "post_id": 59381451, "comment_id": 104954898, "body": "It would, but I thought of keeping the return value just in case you needed it for alphabetical sorting or something. Thank you though! :)"}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 1, "creation_date": 1576615600, "post_id": 59381451, "comment_id": 104955620, "body": "To avoid spurious warnings, I suggest <code>return strcmp((const char *)a, (const char *)b);</code> if C++ compatibility is useful or <code>return strcmp(a, b);</code> if not."}, {"owner": {"reputation": 13, "user_id": 12170265, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I5lqaSoTUOA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re_qTiIQIVJZvpuJnbpHuWBT7TcZQ/photo.jpg?sz=128", "display_name": "Jackson", "link": "https://stackoverflow.com/users/12170265/jackson"}, "edited": false, "score": 0, "creation_date": 1576617157, "post_id": 59381451, "comment_id": 104956235, "body": "Awesome thank you for the tips, this helps a lot :)"}, {"owner": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "reply_to_user": {"reputation": 13, "user_id": 12170265, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I5lqaSoTUOA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re_qTiIQIVJZvpuJnbpHuWBT7TcZQ/photo.jpg?sz=128", "display_name": "Jackson", "link": "https://stackoverflow.com/users/12170265/jackson"}, "edited": false, "score": 0, "creation_date": 1576617744, "post_id": 59381451, "comment_id": 104956456, "body": "@Jackson No problem :) If you liked my answer, please consider accepting it. Cheers!"}], "tags": [], "owner": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "is_accepted": true, "score": 5, "last_activity_date": 1576617691, "last_edit_date": 1576617691, "creation_date": 1576613568, "answer_id": 59381451, "question_id": 59381353, "link": "https://stackoverflow.com/questions/59381353/having-trouble-comparing-two-strings-in-c/59381451#59381451", "title": "Having trouble comparing two strings in C", "body": "<p>Just take a look at the return value of applying <code>strcmp</code> directly to <code>argv</code>:</p>\n\n<pre><code>int main(int argc, char * argv[])\n{\n    int ret;\n\n    ret = strcmp(argv[1], argv[2]);\n    if (ret == 0)\n        printf(\"Equal strings.\\n\");\n\n    return 0;\n}\n</code></pre>\n\n<p>By the way, if you're looking to have a function with generic arguments that compares two strings (i.e. to use in <code>qsort()</code>), here's how you could go about it:</p>\n\n<pre><code>int string_cmp(const void * a, const void * b)\n{\n     return strcmp((const char*)a, (const char*)b);\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 12170265, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I5lqaSoTUOA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re_qTiIQIVJZvpuJnbpHuWBT7TcZQ/photo.jpg?sz=128", "display_name": "Jackson", "link": "https://stackoverflow.com/users/12170265/jackson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 59381451, "answer_count": 1, "score": 1, "last_activity_date": 1576617691, "creation_date": 1576613075, "last_edit_date": 1576615384, "question_id": 59381353, "link": "https://stackoverflow.com/questions/59381353/having-trouble-comparing-two-strings-in-c", "title": "Having trouble comparing two strings in C", "body": "<p>I am trying to take in two strings via command line arguments in C and then compare them. I know that <code>malloc</code> returns a <code>void</code> pointer although I do not understand how to pass this to my compare function because it is looking for a <code>const void</code> pointer. I assume I will have to cast the pointers that point to the memory on the heap where the strings will be allocated (?) although I'm not sure how to go about this, any help is appreciated.</p>\n\n<pre><code>int cmpstringp(const void *arg1, const void *arg2);\n\nint main(int argc, char **argv) {\n    char *strOne;\n    char *strTwo;\n    int n = 10;\n    strOne = (char *)malloc((n + 1) * sizeof(char));\n    strTwo = (char *)malloc((n + 1) * sizeof(char));\n    strOne = argv[1];\n    strTwo - argv[2];\n    cmpstringp(strOne, strTwo);\n}\n\nint cmpstringp(const void *arg1, const void *arg2) {\n    const char * const * ptr1 = (const char **)arg1;\n    const char * const * ptr2 = (const char **)arg2;\n\n    const char *str1 = *ptr1; \n    const char *str2 = *ptr2;\n\n    return strcmp(str1, str2);\n}\n\n</code></pre>\n"}, {"tags": ["c", "arrays", "struct", "char"], "comments": [{"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1576615281, "post_id": 59381253, "comment_id": 104955505, "body": "You can&#39;t refer to variables and types dynamically from strings. These names are all resolved at compile time."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1576615389, "post_id": 59381253, "comment_id": 104955547, "body": "What you could look into is macros with token pasting, so you don&#39;t have to repeat all the common parts of each variable declaration and initialization."}, {"owner": {"reputation": 1320, "user_id": 5495906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5b319c1b73d80f4155fbdd4fcb81525?s=128&d=identicon&r=PG&f=1", "display_name": "LegendofPedro", "link": "https://stackoverflow.com/users/5495906/legendofpedro"}, "edited": false, "score": 0, "creation_date": 1576623620, "post_id": 59381253, "comment_id": 104958460, "body": "How different is <code>AB_A_Group_A_Network</code> to <code>AB_A_Group_B_Network</code> to <code>AB_D_Group_ZF_Network</code> etc.? It seems strange to <code>typedef</code> a <code>struct</code> you only use once. An array of identical structs (with function pointers and <code>union</code>s as required) could simplify the problem into a couple of loops."}, {"owner": {"reputation": 1320, "user_id": 5495906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5b319c1b73d80f4155fbdd4fcb81525?s=128&d=identicon&r=PG&f=1", "display_name": "LegendofPedro", "link": "https://stackoverflow.com/users/5495906/legendofpedro"}, "edited": false, "score": 0, "creation_date": 1576624210, "post_id": 59381253, "comment_id": 104958609, "body": "&quot;<code>CD_Array_Set(95,GroupZF.Member_96);</code>&quot; contradicts &quot;signals are grouped into 32 groups with 3 members each&quot;. Should it be <code>95%3=2</code> i.e. <code>CD_Array_Set(95,GroupZF.Member_2);</code>?"}, {"owner": {"reputation": 35, "user_id": 12553118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b83cc1f027073d2e8ad63e8fd07c8123?s=128&d=identicon&r=PG&f=1", "display_name": "Bree", "link": "https://stackoverflow.com/users/12553118/bree"}, "reply_to_user": {"reputation": 1320, "user_id": 5495906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5b319c1b73d80f4155fbdd4fcb81525?s=128&d=identicon&r=PG&f=1", "display_name": "LegendofPedro", "link": "https://stackoverflow.com/users/5495906/legendofpedro"}, "edited": false, "score": 0, "creation_date": 1576712226, "post_id": 59381253, "comment_id": 104991915, "body": "@LegendofPedro Each of them are pretty much exactly the same, with some variation on exactly where each of the members sits in values[]. The support files in my project are computer-generated, and there are structures in the file that look nothing like this; I&#39;m assuming the devs were just making the software as flexible as possible. Do structs generally go nicely into arrays?"}, {"owner": {"reputation": 35, "user_id": 12553118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b83cc1f027073d2e8ad63e8fd07c8123?s=128&d=identicon&r=PG&f=1", "display_name": "Bree", "link": "https://stackoverflow.com/users/12553118/bree"}, "reply_to_user": {"reputation": 1320, "user_id": 5495906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5b319c1b73d80f4155fbdd4fcb81525?s=128&d=identicon&r=PG&f=1", "display_name": "LegendofPedro", "link": "https://stackoverflow.com/users/5495906/legendofpedro"}, "edited": false, "score": 0, "creation_date": 1576713373, "post_id": 59381253, "comment_id": 104992200, "body": "@LegendofPedro The &#39;groups&#39; really just refer the way that the members are stored in the program. Each group utilizes some bytes of storage, and each member takes up an amount of those bytes. It&#39;s weird, I&#39;ll give you that, but the signals all belong to the same set of data, so they are numbered 1 to 96."}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 12553118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b83cc1f027073d2e8ad63e8fd07c8123?s=128&d=identicon&r=PG&f=1", "display_name": "Bree", "link": "https://stackoverflow.com/users/12553118/bree"}, "edited": false, "score": 0, "creation_date": 1576767810, "post_id": 59381885, "comment_id": 105011668, "body": "This answer is really helpful! By &quot;no loops in the preprocessor&quot;, do you mean that I could not replace the 0 in <code>CD_Array_Set(0,Group  ##group .Member_1)</code> with a variable? How does that number or line differ from the other lines I am replacing? Also, with this method, it seems I can write a loop with the line <code>INIT_GROUP(i, j)</code>, as long as I set the arrays separately. Is this correct?"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 35, "user_id": 12553118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b83cc1f027073d2e8ad63e8fd07c8123?s=128&d=identicon&r=PG&f=1", "display_name": "Bree", "link": "https://stackoverflow.com/users/12553118/bree"}, "edited": false, "score": 0, "creation_date": 1576773712, "post_id": 59381885, "comment_id": 105014891, "body": "Variables don&#39;t get values until the program is running, macros are expanded when you&#39;re compiling."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 35, "user_id": 12553118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b83cc1f027073d2e8ad63e8fd07c8123?s=128&d=identicon&r=PG&f=1", "display_name": "Bree", "link": "https://stackoverflow.com/users/12553118/bree"}, "edited": false, "score": 0, "creation_date": 1576773851, "post_id": 59381885, "comment_id": 105014956, "body": "<code>INIT_GROUP(i, j)</code> will expand into <code>AB_i_Group_j_Network Groupj; ...</code>. The variables will just be incorporated textually, not their values."}], "tags": [], "owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "is_accepted": true, "score": 0, "last_activity_date": 1576615815, "creation_date": 1576615815, "answer_id": 59381885, "question_id": 59381253, "link": "https://stackoverflow.com/questions/59381253/dynamic-method-of-calling-structures-in-c/59381885#59381885", "title": "Dynamic method of calling structures in C", "body": "<p>There's no way to refer to variables and type names dynamically from strings at runtime. But you can use token pasting in a macro to avoid all the repeated code.</p>\n\n<pre><code>#define INIT_GROUP(dataset, group) \\\nAB_ ## dataset ## _Group_ ## group ## _Network Group ## group; \\\nAB_ ## dataset ## _Group_ ## group ## _Network_Init(&amp;Group ## group); \\\nCD_Array_Set(0,Group ## group .Member_1); \\\nCD_Array_Set(1,Group ## group .Member_2); \\\n...\nCD_Array_Set(95,Group ## group .Member_96);\n</code></pre>\n\n<p>Unfortunately, there are no loops in the preprocessor, so you have to write all 96 <code>CD_Array_Set</code> lines in the macro.</p>\n\n<p>With this macro, you can then write:</p>\n\n<pre><code>INIT_GROUP(A, A)\nINIT_GROUP(A, B)\n...\nINIT_GROUP(A, ZF)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29, "user_id": 8964221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a90b298fcf44ad6005762eb98c5147b?s=128&d=identicon&r=PG&f=1", "display_name": "Tim Weissenfels", "link": "https://stackoverflow.com/users/8964221/tim-weissenfels"}, "is_accepted": false, "score": -1, "last_activity_date": 1576622643, "last_edit_date": 1592644375, "creation_date": 1576622643, "answer_id": 59383167, "question_id": 59381253, "link": "https://stackoverflow.com/questions/59381253/dynamic-method-of-calling-structures-in-c/59383167#59383167", "title": "Dynamic method of calling structures in C", "body": "<h2>Auto generated C code</h2>\n<p>It is possible to do such things in C but it requires <em>ugly</em> Macros.</p>\n<p>First thing i would look at is</p>\n<blockquote>\n<p>An old Stackoverflow question: <a href=\"https://stackoverflow.com/a/12591965/8964221\">https://stackoverflow.com/a/12591965/8964221</a></p>\n<p>And the mentioned gist in it: <a href=\"https://gist.github.com/epatel/3786323\" rel=\"nofollow noreferrer\">https://gist.github.com/epatel/3786323</a></p>\n</blockquote>\n<p><strong>BUT!</strong>\nI would think about the time it would consume to have it bug free and working.\nIt won`t be that easy to transform it to ur needs.</p>\n"}], "owner": {"reputation": 35, "user_id": 12553118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b83cc1f027073d2e8ad63e8fd07c8123?s=128&d=identicon&r=PG&f=1", "display_name": "Bree", "link": "https://stackoverflow.com/users/12553118/bree"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 59381885, "answer_count": 2, "score": 1, "last_activity_date": 1576622643, "creation_date": 1576612579, "question_id": 59381253, "link": "https://stackoverflow.com/questions/59381253/dynamic-method-of-calling-structures-in-c", "title": "Dynamic method of calling structures in C", "body": "<p>I have a project which involves writing a C program for some software used by my company. I want it to be as efficient as possible, but the way the software references the signals I'm working with is a little wonky. I'm working with 4 sets of 96 signals; these signals are grouped into 32 groups with 3 members each. Rather than generic functions to work with these signals (the generic functions exist, but there's no documentation on how they work), the auto-generated header file has defined a group of macros (I think) for each of these groups.</p>\n\n<p>Each of the groups are defined as follows...</p>\n\n<pre><code>typedef struct {\n//struct members\n} AB_A_Group_A_Network\n</code></pre>\n\n<p>Each of those structures have a group of macros(?) defined like this...</p>\n\n<pre><code>void AB_A_Group_ZF_Network_Init(AB_A_Group_A_Network *pAbc)\n{\n    double values[6]\n    ...\n    pAbc-&gt;Member_1 = values[3] //array positions vary\n    pAbc-&gt;Member_2 = values[4]\n    pAbc-&gt;Member_3 = values[5]\n}\n</code></pre>\n\n<p>The software's tech support suggested I do the following, but I was hoping there'd be a better way to do it. Of course this is a long method, but I can write it with a python script no problem, if need be. These 250+ lines of code will run every second in my application for each data set.</p>\n\n<pre><code>AB_A_Group_A_Network GroupA;\nAB_A_Group_B_Network GroupB;\n//...and so on\nAB_A_Group_ZF_Network GroupZF;\n\nAB_A_Group_A_Network_Init(&amp;GroupA);\nAB_A_Group_B_Network_Init(&amp;GroupB);\n//...and so on\nAB_A_Group_ZF_Network_Init(&amp;GroupZF);\n\nCD_Array_Set(0,GroupA.Member_1); //a custom array function meant to interface with the software\nCD_Array_Set(1,GroupA.Member_2);\n//...and so on\nCD_Array_Set(95,GroupZF.Member_96);\n\n//...Repeat 3 times for 4 sets of data (Data sets A-D), with checks to see if that data exists\n</code></pre>\n\n<p>I thought of doing something like this, but I'm not sure you can use char arrays in this way. I'll add the disclaimer don't have much experience with C, so this might look/sound really stupid. This isn't working code, just a stream of consciousness. I'm also not sure if doing it in this way, if possible, would just end up losing efficiency. I'm completely open to other methods.</p>\n\n<pre><code>char groupName[70] = \"AB_*_Group_*_Network\";\nchar dataset = 'A';\nchar group = 'A';\nchar member = '1';\nchar groupInit[70]\n\n//write a loop to increment dataset alphabetically\n//check if dataset exists\ngroupName[3] = dataset;\n\n//write a sub-loop to increment group alphabetically (each set has 32 groups)\ngroupName[27] = group;\n\n//use groupName in place of struct name (not sure how or if this is possible with my current methods)\n\ngroupInit = strncat(groupName, \"_Init\", 5);\n\n//use groupInit in place of _init macro name\n\n//write a sub-loop to increment member numerically (each group has 3 members)\nchar member[10] = \"Member_*\";\nmember[7] = member;\n\nCD_Array_Set(i,groupName.member);\n</code></pre>\n\n<p>Is the long method really the best way of doing this? Any advice you can offer is appreciated!</p>\n"}, {"tags": ["c", "dangling-pointer"], "comments": [{"owner": {"reputation": 699, "user_id": 7562074, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mYiplUjiang/AAAAAAAAAAI/AAAAAAAAASg/IuJhDArg780/photo.jpg?sz=128", "display_name": "Roy Avidan", "link": "https://stackoverflow.com/users/7562074/roy-avidan"}, "edited": false, "score": 0, "creation_date": 1576610728, "post_id": 59380812, "comment_id": 104953599, "body": "Is the error only in your compiler/debugger? Because in the first case it would notice but in the second the compiler/debugger doesn&#39;t know you&#39;re returning the dangling pointer."}, {"owner": {"reputation": 28330, "user_id": 298054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7dffcc86140441472cfb6119375a9d7?s=128&d=identicon&r=PG", "display_name": "jweyrich", "link": "https://stackoverflow.com/users/298054/jweyrich"}, "edited": false, "score": 3, "creation_date": 1576610744, "post_id": 59380812, "comment_id": 104953602, "body": "Dereferencing a dangling pointer may &quot;work&quot; (in quotes), but it&#39;s not guaranteed. It&#39;s undefined behavior and you should not rely on it."}, {"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 6, "creation_date": 1576611280, "post_id": 59380812, "comment_id": 104953852, "body": "&quot;can check this by calling printf&quot;. No you can&#39;t. It&#39;s not guaranteed to seg fault and in fact in many cases it may not. That&#39;s what is referred to as &quot;undefined behvaiour&quot; in C. Unfortunately the language doesn&#39;t have any easy way to check whether a pointer is valid before accessing it. There are some platform specific ways. But in general C programmers need to rely on development best practices such as code reviews, testing and debugging to root out memory issues like this. There are also tools such as <a href=\"http://valgrind.org\" rel=\"nofollow noreferrer\">valgrind</a> which can help."}, {"owner": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "edited": false, "score": 2, "creation_date": 1576611382, "post_id": 59380812, "comment_id": 104953896, "body": "<i>...I can check this by calling <code>printf (&quot;forty two : %d\\n&quot;, *(fortytwo_pointer()));</code></i> Not really. It&#39;s undefined behavior. <i>On the other hand... does not produce the same &#39;Segmentation fault&#39; error.</i> Because it&#39;s undefined behavior."}, {"owner": {"reputation": 11194, "user_id": 3003365, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dP9Od.jpg?s=128&g=1", "display_name": "kaylum", "link": "https://stackoverflow.com/users/3003365/kaylum"}, "edited": false, "score": 0, "creation_date": 1576611416, "post_id": 59380812, "comment_id": 104953918, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/551069/testing-pointers-for-validity-c-c\">Testing pointers for validity (C/C++)</a>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1576643165, "post_id": 59380812, "comment_id": 104962251, "body": "regarding: <code>int v = 42;   return &amp;v;</code>  this is returning the address of a variable that is located on the local stack of the function.  When that function exits, that variable goes out-of-scope.  It is an error to return the address of a variable that is on the local stack."}, {"owner": {"reputation": 29, "user_id": 7825861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32a55673ba70730db50dffdb941e603f?s=128&d=identicon&r=PG&f=1", "display_name": "QGarchery", "link": "https://stackoverflow.com/users/7825861/qgarchery"}, "edited": false, "score": 0, "creation_date": 1576664527, "post_id": 59380812, "comment_id": 104969999, "body": "Thank you all for your feedback! In the first case I get a warning from the compiler &#39;function returns address of local variable&#39; and the &#39;Segmentation fault (core dumped)&#39; when I execute the program. In the second case I get no warning and the program prints &#39;forty two : 42&#39;. I edited my question to explain the difference with the question &#39;testing pointers for validity&#39;."}], "answers": [{"tags": [], "owner": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "is_accepted": false, "score": 3, "last_activity_date": 1576611833, "last_edit_date": 1576611833, "creation_date": 1576611434, "answer_id": 59381011, "question_id": 59380812, "link": "https://stackoverflow.com/questions/59380812/do-we-get-a-dangling-pointer-by-copying-a-dangling-pointer/59381011#59381011", "title": "Do we get a dangling pointer by copying a dangling pointer?", "body": "<p><strong>Yes</strong>, you do. As pointed out in the comments on your question, you cannot \"check it\" by using <code>printf</code>. From the moment that the function stack is popped, you're dealing with undefined behavior.</p>\n\n<p>Use <code>valgrind</code> to run your program, and it will point out any read/write errors. Those may not cause your program to fail every time, but should be taken care of nonetheless. I'm sure your dangling pointer will show up in there, and <code>valgrind</code> will be kind enough to show you the full trace of where each error occurs.</p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 13713472, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-46LhSdqjqB8/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucnIab4vqszuaHA6QHuXwkgzgzBtRQ/photo.jpg?sz=128", "display_name": "Amir Mohsen Ghasemi", "link": "https://stackoverflow.com/users/13713472/amir-mohsen-ghasemi"}, "is_accepted": false, "score": 0, "last_activity_date": 1594954267, "creation_date": 1594954267, "answer_id": 62946359, "question_id": 59380812, "link": "https://stackoverflow.com/questions/59380812/do-we-get-a-dangling-pointer-by-copying-a-dangling-pointer/62946359#62946359", "title": "Do we get a dangling pointer by copying a dangling pointer?", "body": "<blockquote>\n<p>I would expect it to also be an instance of a dangling pointer because the value v goes out of scope just the same. Is it true ? If so, how to check that the pointer is indeed dangling ?</p>\n</blockquote>\n<p><strong>Yes</strong>, the variable you have declared in <code>int* fortytwo_pointer()</code> is a local variable. This means the variable you have declared stores in a stack frame and at the end of this function, the variable is going to become freed and there's no a good address to dereference and that's why <code>v</code> is a dangling pointer.</p>\n<p>My suggestion to resolve this problem is allocating memory from heap by using some functions such as <code>malloc()</code> or <code>calloc()</code>. Functions delete all variables in stack, not heap.</p>\n<p>So, you can write your code below :</p>\n<pre><code>int* fortytwo_pointer () {\nint *v = (int*) malloc (sizeof(int));\nif(v == NULL)\n{\n    printf(&quot;An error occurred.\\n&quot;);\n    getch();\n}\n\n*v = 42;\nreturn v;\n}\n</code></pre>\n<p>and finally, don't forget to free <code>*v</code> pointer. You can free that by using <code>free()</code>.</p>\n"}], "owner": {"reputation": 29, "user_id": 7825861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32a55673ba70730db50dffdb941e603f?s=128&d=identicon&r=PG&f=1", "display_name": "QGarchery", "link": "https://stackoverflow.com/users/7825861/qgarchery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1594954267, "creation_date": 1576610596, "last_edit_date": 1576664174, "question_id": 59380812, "link": "https://stackoverflow.com/questions/59380812/do-we-get-a-dangling-pointer-by-copying-a-dangling-pointer", "title": "Do we get a dangling pointer by copying a dangling pointer?", "body": "<p>On one hand, if I write the following code :</p>\n\n<pre><code>int* fortytwo_pointer () {\n  int v = 42;\n  return &amp;v;\n}\n</code></pre>\n\n<p>I get a dangling pointer and I can check this by calling\n<code>printf (\"forty two : %d\\n\", *(fortytwo_pointer()));</code></p>\n\n<p>On the other hand </p>\n\n<pre><code>int* copy (int *pointer) {\n  return pointer;\n}\nint* fortytwo_pointer () {\n  int v = 42;\n  return copy (&amp;v);\n}\n</code></pre>\n\n<p>does not produce the same 'Segmentation fault' error.</p>\n\n<p>I would expect it to also be an instance of a dangling pointer because the value <code>v</code> goes out of scope just the same. Is it true ? If so, how to check that the pointer is indeed dangling ?</p>\n\n<p>Edit : \n<a href=\"https://stackoverflow.com/questions/551069/testing-pointers-for-validity-c-c\">This question</a> is more focused on dynamically checking that a pointer is valid, for example if we get a pointer from a call of a library function. I'm more interested in checking if the code could produce invalid pointers.</p>\n"}, {"tags": ["c", "pointers", "struct"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 7348980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dbaa42ba9c28454e48c7885a197aafe?s=128&d=identicon&r=PG&f=1", "display_name": "syoma", "link": "https://stackoverflow.com/users/7348980/syoma"}, "edited": false, "score": 0, "creation_date": 1576610575, "post_id": 59380734, "comment_id": 104953543, "body": "Thanks for quick answer. But the problem is that I really need to access <code>struct foo</code> members by <code>j.var_a</code> and so on - so does legacy code, which I can&#39;t change."}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "reply_to_user": {"reputation": 1, "user_id": 7348980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dbaa42ba9c28454e48c7885a197aafe?s=128&d=identicon&r=PG&f=1", "display_name": "syoma", "link": "https://stackoverflow.com/users/7348980/syoma"}, "edited": false, "score": 0, "creation_date": 1576610686, "post_id": 59380734, "comment_id": 104953586, "body": "@syoma Then you&#39;re out of luck.  Something needs to change."}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 0, "last_activity_date": 1576610258, "creation_date": 1576610258, "answer_id": 59380734, "question_id": 59380716, "link": "https://stackoverflow.com/questions/59380716/c-structure-and-user-variables-share-same-memory-possible/59380734#59380734", "title": "C - Structure and user variables share same memory - possible?", "body": "<p>You're correct that <code>j = &amp;a</code> will not do what you expect for the reasons you gave.</p>\n\n<p>What you can do instead is define the members of <code>struct foo</code> to be pointers:</p>\n\n<pre><code>struct foo {\n   char  *var_a;\n   char  *var_b;\n   char  *var_c;\n};\n\nchar a, b, c;\nfoo j = { &amp;a, &amp;b, &amp;c };\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 7348980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dbaa42ba9c28454e48c7885a197aafe?s=128&d=identicon&r=PG&f=1", "display_name": "syoma", "link": "https://stackoverflow.com/users/7348980/syoma"}, "edited": false, "score": 0, "creation_date": 1576610813, "post_id": 59380804, "comment_id": 104953633, "body": "Thanks I will try your suggestion. To let you know the variables are global."}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 1, "user_id": 7348980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dbaa42ba9c28454e48c7885a197aafe?s=128&d=identicon&r=PG&f=1", "display_name": "syoma", "link": "https://stackoverflow.com/users/7348980/syoma"}, "edited": false, "score": 0, "creation_date": 1576611135, "post_id": 59380804, "comment_id": 104953795, "body": "@syoma if they&#39;re global and visible then your goal actually is achievable with some nonstandard linker tricks."}, {"owner": {"reputation": 1, "user_id": 7348980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dbaa42ba9c28454e48c7885a197aafe?s=128&d=identicon&r=PG&f=1", "display_name": "syoma", "link": "https://stackoverflow.com/users/7348980/syoma"}, "edited": false, "score": 0, "creation_date": 1576611801, "post_id": 59380804, "comment_id": 104954103, "body": "Maybe that&#39;s a point. Actually to make situation clearer - this is how these variables are defined in two different .c files and I have to link them together somehow, better without additional computational code."}], "tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": false, "score": 0, "last_activity_date": 1576610559, "creation_date": 1576610559, "answer_id": 59380804, "question_id": 59380716, "link": "https://stackoverflow.com/questions/59380716/c-structure-and-user-variables-share-same-memory-possible/59380804#59380804", "title": "C - Structure and user variables share same memory - possible?", "body": "<p><code>char a, b, c;</code> local variables are't guaranteed to be contiguous, in-order, and to exit in memory.</p>\n\n<p>There's no way to robustly overlay a struct over them.</p>\n\n<p>The closes thing you could do to pretending some local variables overlay a struct is to make those <em>\"local variabled\"</em> macros:</p>\n\n<pre><code>struct foo {\n   char  var_a;\n   char  var_b;\n   char  var_c;\n};\n\nint main(void)\n{\n    struct foo j;\n    #define a j.var_a\n    #define b j.var_b\n    #define c j.var_c\n\n    /*now a,b,c are sort of like contiguous locals\n      that overlay j */\n\n    #undef a\n    #undef b\n    #undef c\n\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 7348980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dbaa42ba9c28454e48c7885a197aafe?s=128&d=identicon&r=PG&f=1", "display_name": "syoma", "link": "https://stackoverflow.com/users/7348980/syoma"}, "edited": false, "score": 0, "creation_date": 1576611036, "post_id": 59380842, "comment_id": 104953748, "body": "Hi supercat. Actually I didn&#39;t thought about defines like you and @PSkocik suggested. I will try this. Thanks!"}, {"owner": {"reputation": 1, "user_id": 7348980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dbaa42ba9c28454e48c7885a197aafe?s=128&d=identicon&r=PG&f=1", "display_name": "syoma", "link": "https://stackoverflow.com/users/7348980/syoma"}, "edited": false, "score": 0, "creation_date": 1576611316, "post_id": 59380842, "comment_id": 104953866, "body": "Some stupid question about this - is it possible to do another way around? A.g. woozle and moozle are declared as real variables, but myfoo.foo_woozle would be obfuscated?"}, {"owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "reply_to_user": {"reputation": 1, "user_id": 7348980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dbaa42ba9c28454e48c7885a197aafe?s=128&d=identicon&r=PG&f=1", "display_name": "syoma", "link": "https://stackoverflow.com/users/7348980/syoma"}, "edited": false, "score": 0, "creation_date": 1576613769, "post_id": 59380842, "comment_id": 104954904, "body": "@syoma: That is not possible, unless the name of the structure and all member names are used exclusively for those purposes.  One could do something horrible like replace <code>myfoo</code> with <code>((0*sizeof somestruct</code> and <code>foo_woozle</code> with <code>somemember)[&amp;woozle])</code> so that <code>myfoo.foo_woozle</code> would become <code>((0*sizeof somestruct.somemember)[&amp;woozle])</code>, but in scenarios where that would work, it would almost certainly be easier to replace <code>myfoo.</code> with <code>myfoo_</code>."}], "tags": [], "owner": {"reputation": 69012, "user_id": 363751, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/135a97c4150691234931a93f3a27a52f?s=128&d=identicon&r=PG", "display_name": "supercat", "link": "https://stackoverflow.com/users/363751/supercat"}, "is_accepted": false, "score": 0, "last_activity_date": 1576610728, "creation_date": 1576610728, "answer_id": 59380842, "question_id": 59380716, "link": "https://stackoverflow.com/questions/59380716/c-structure-and-user-variables-share-same-memory-possible/59380842#59380842", "title": "C - Structure and user variables share same memory - possible?", "body": "<p>Although there are some circumstances when it would be useful to be able to use \"ordinary variable\" syntax to access members of a structure (among other things, it may improve performance, allow code that saves/restores a program's state to be reduced to a single structure write/read, etc.) the closest C comes to allowing that is allowing the use of <code>#define</code> macros to replace the \"variable\" name with a reference to the structure.</p>\n\n<p>For example,</p>\n\n<pre><code>struct foo { int foo_woozle, foo_moozle; } myFoo;\n#define woozle myFoo.foo_woozle\n#define moozle myFoo.foo_moozle\n</code></pre>\n\n<p>Unfortunately, this approach requires that the \"variable\" names not appear as tokens in any other context within the compilation unit.  If, for example, one tried to declare a structure with a member named <code>woozle</code>, the structure declaration would fail because its name would get replaced with <code>myFoo.foo_woozle</code>.</p>\n\n<p>On some implementations it may be possible to do something like:</p>\n\n<pre><code>extern int woozle,boozle;\nextern volatile struct foo myFoo;\n</code></pre>\n\n<p>and then use code written in another language (e.g. assembly) to overlay the objects as desired.  Unfortunately, this is likely to be unreliable unless optimizations are disabled or the objects are all qualified <code>volatile</code>.  The approach using <code>#define</code> will thus be able to generate more efficient code, but is unfortunately saddled with the ugly semantic limitations of macro substitution.</p>\n"}], "owner": {"reputation": 1, "user_id": 7348980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dbaa42ba9c28454e48c7885a197aafe?s=128&d=identicon&r=PG&f=1", "display_name": "syoma", "link": "https://stackoverflow.com/users/7348980/syoma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1576610728, "creation_date": 1576610127, "last_edit_date": 1576610313, "question_id": 59380716, "link": "https://stackoverflow.com/questions/59380716/c-structure-and-user-variables-share-same-memory-possible", "title": "C - Structure and user variables share same memory - possible?", "body": "<p>Sorry for newbie question in C. I have following problem.</p>\n\n<p>Let's say I have a structure of:</p>\n\n<pre><code>struct foo {\n   char  var_a;\n   char  var_b;\n   char  var_c;\n};\n</code></pre>\n\n<p>And a list of variables:</p>\n\n<pre><code>foo j;\nchar a, b, c;\n</code></pre>\n\n<p>I want to make sure, that in all moments of time j.var_a is equal to a, j.var_b equals to b and j.var_c equals to c. E.g I want that structure members would be also accessible like normal user variables at any moment. I thought that struct members just need to share the same memory locations with defined user variables, so assumed that something from this has to be defined as pointer and tried this:</p>\n\n<pre><code>foo *j;\nchar a, b, c;\n</code></pre>\n\n<p>And in main() function:</p>\n\n<pre><code>j = &amp;a;\n</code></pre>\n\n<p>With the aim of assigning address of structure pointer to address of a and with assumption that a,b,c will be located in adjacent memory spaces. But compiler throws error obviously because I can't point pointer of one type to address of other type. I also feel this is unsafe as it relates to the order of variables in memory. </p>\n\n<p>So is there a safe way to achieve this goal without manual reassignment each time when any of variables are changed and additional memory copying? I have an embedded target, so would like to save memory and processor time.</p>\n"}, {"tags": ["c", "valgrind"], "comments": [{"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 1, "creation_date": 1576610353, "post_id": 59380691, "comment_id": 104953440, "body": "Which compiler are you using, and what flags did you specify for the compile?"}, {"owner": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "reply_to_user": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1576610451, "post_id": 59380691, "comment_id": 104953483, "body": "@RobertHarvey I&#39;m using gcc and I specified 100 iterations and 100 bodies"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 1, "creation_date": 1576610640, "post_id": 59380691, "comment_id": 104953565, "body": "Your math seems a little suspicious. I get 11200, not 1120"}, {"owner": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1576610745, "post_id": 59380691, "comment_id": 104953603, "body": "@user3386109 true"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 4, "creation_date": 1576610844, "post_id": 59380691, "comment_id": 104953651, "body": "Ok, now I have to wonder what all the colons represent. If 32K is the top of the Y-axis, then the colons seem to be at about 10K, which matches your expected memory usage."}, {"owner": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1576611492, "post_id": 59380691, "comment_id": 104953953, "body": "@user3386109 probably yes, but why is # getting the top at the begining?"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1576611598, "post_id": 59380691, "comment_id": 104954002, "body": "Try <code>n==1</code> and look at the <i>change</i> in memory usage.  See if that is a expected."}, {"owner": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "edited": false, "score": 0, "creation_date": 1576611619, "post_id": 59380691, "comment_id": 104954012, "body": "Are you allocating your memory in the beginning of the program execution?"}, {"owner": {"reputation": 3305, "user_id": 1428695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a843c704cdb7e32a93769cddfed4747?s=128&d=identicon&r=PG", "display_name": "yhyrcanus", "link": "https://stackoverflow.com/users/1428695/yhyrcanus"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1576613465, "post_id": 59380691, "comment_id": 104954789, "body": "I&#39;m pretty certain everything @user3386109 said is correct. That looks exactly right."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1576618185, "post_id": 59380691, "comment_id": 104956675, "body": "Do you use C standard library in your program? Did you include all the allocations the standard library does in your calculations?"}], "answers": [{"tags": [], "owner": {"reputation": 1599, "user_id": 9948091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JANyt.png?s=128&g=1", "display_name": "HAL9000", "link": "https://stackoverflow.com/users/9948091/hal9000"}, "is_accepted": true, "score": 3, "last_activity_date": 1576617329, "creation_date": 1576617329, "answer_id": 59382179, "question_id": 59380691, "link": "https://stackoverflow.com/questions/59380691/why-my-program-occupies-32kb-and-not-11200b-valgrinds-massif/59382179#59382179", "title": "Why my program occupies 32KB and not 11200B (Valgrind&#39;s massif)", "body": "<p>I am not fammilliar with <code>massif</code>, but when talking about heap memory, there are two numbers that are interesting, how much memory has the allocator requested from the OS, and how much has the allocator given to your program through <code>malloc()</code>. If your program has requested ~10K of bytes, it is reasonable to think that the allocator may have requested a round number like 32K from the OS. The allocator typically request memory in large blocks from the OS since kernel calls are slow. (and a few other reasons)</p>\n\n<p>So I would guess that the 32K that you are seeing, is what the allocator has aquired from the OS, ready to be given to your program through any additional <code>malloc()</code> that may happen.</p>\n"}], "owner": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 59382179, "answer_count": 1, "score": 1, "last_activity_date": 1576617329, "creation_date": 1576609997, "last_edit_date": 1576610756, "question_id": 59380691, "link": "https://stackoverflow.com/questions/59380691/why-my-program-occupies-32kb-and-not-11200b-valgrinds-massif", "title": "Why my program occupies 32KB and not 11200B (Valgrind&#39;s massif)", "body": "<p>The n-body program does this at the begining:</p>\n\n<pre><code>  real4 *pin  = (real4*)malloc(n * sizeof(real4));\n  real4 *pout = (real4*)malloc(n * sizeof(real4));\n  real3 *v    = (real3*)malloc(n * sizeof(real3));\n  real3 *f    = (real3*)malloc(n * sizeof(real3));\n</code></pre>\n\n<p>the total size of this should be (if n = 100): 100*32 + 100*32 + 100*24 + 100*24 = 11200B but with Valgrind's massif I have this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/vPbyn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vPbyn.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["c", "pointers", "struct", "segmentation-fault", "malloc"], "comments": [{"owner": {"reputation": 8362, "user_id": 2993960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/svN5z.jpg?s=128&g=1", "display_name": "Fiddling Bits", "link": "https://stackoverflow.com/users/2993960/fiddling-bits"}, "edited": false, "score": 2, "creation_date": 1576610027, "post_id": 59380668, "comment_id": 104953309, "body": "Need to <code>malloc</code> memory for <code>elem</code> too."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1576642449, "post_id": 59380668, "comment_id": 104962131, "body": "regarding: <code>const celula *nulo = NULL;</code>  This is using the <code>celula</code> before it is defined.  Suggest moving that statement to after the definition of the struct"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1576642594, "post_id": 59380668, "comment_id": 104962151, "body": "OT: regarding: <code>floresta p = (floresta)malloc(sizeof(celfloresta));</code>  1) in C, the returned type is <code>void*</code> which can be assigned to any pointer.  Casting just clutters the code.  Suggest removing the cast.  2) always check (!=NULL) the returned value to assure the operation was successful."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1576642740, "post_id": 59380668, "comment_id": 104962177, "body": "OT: regarding: <code>typedef struct celfloresta *floresta;</code> and <code>typedef struct celfloresta *posicfloresta;</code>  and typedef celula *noh;` and <code>typedef celula *arvore;</code>  It is a very poor programming practice (and very misleading to the human reader of the code) to hide pointers in a <code>typedef</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "is_accepted": true, "score": 2, "last_activity_date": 1576610428, "creation_date": 1576610428, "answer_id": 59380776, "question_id": 59380668, "link": "https://stackoverflow.com/questions/59380668/c-malloc-segmentation-fault-struct/59380776#59380776", "title": "C malloc segmentation fault struct", "body": "<p><code>elem</code> is a pointer. You need to allocate memory for it:</p>\n\n<pre><code>p-&gt;elem = malloc(sizeof(arvore));\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12248615, "user_type": "registered", "profile_image": "https://graph.facebook.com/2583742491684198/picture?type=large", "display_name": "medmik", "link": "https://stackoverflow.com/users/12248615/medmik"}, "is_accepted": false, "score": 0, "last_activity_date": 1576611275, "creation_date": 1576611275, "answer_id": 59380971, "question_id": 59380668, "link": "https://stackoverflow.com/questions/59380668/c-malloc-segmentation-fault-struct/59380971#59380971", "title": "C malloc segmentation fault struct", "body": "<p>Basically malloc return a void pointer then to cast is should use a variable of type pointer\nan example :</p>\n\n<pre><code>int *p = malloc(sizeof(int))\nstruct s_list *l = malloc(sizeof(struct s_list))\n</code></pre>\n\n<p>then you can dereference the pointer for example</p>\n\n<pre><code>l-&gt;data = 12;\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 9383634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40bb8c3b02e7893292a58f289a799b69?s=128&d=identicon&r=PG&f=1", "display_name": "Benuck", "link": "https://stackoverflow.com/users/9383634/benuck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 59380776, "answer_count": 2, "score": 0, "last_activity_date": 1576611427, "creation_date": 1576609904, "last_edit_date": 1576611427, "question_id": 59380668, "link": "https://stackoverflow.com/questions/59380668/c-malloc-segmentation-fault-struct", "title": "C malloc segmentation fault struct", "body": "<p>In the textbook my teacher provided us, there is this C code's sample, which when I try to run gives a Segmentation Fault error:</p>\n\n<pre><code>const celula *nulo = NULL;\ntypedef char informacao;\ntypedef celula *noh;\ntypedef celula *arvore;\nstruct celula {informacao info; noh pai; noh fesq; noh idir;};\n\n...\n\ntypedef struct celfloresta celfloresta;\ntypedef struct celfloresta *floresta;\ntypedef struct celfloresta *posicfloresta;\nstruct celfloresta {arvore elem; celfloresta *prox;};\n\n...\n\nvoid FormarListaNohs(){\n    floresta p = (floresta)malloc(sizeof(celfloresta));\n    p-&gt;elem-&gt;info = '3';\n}\n\n...\n</code></pre>\n\n<p>Why does the line \n<code>p-&gt;elem-&gt;info = '3';</code>\ngive segmentation fault here?</p>\n"}, {"tags": ["c"], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "edited": false, "score": 0, "creation_date": 1576607028, "post_id": 59380027, "comment_id": 104952122, "body": "Can you be more precise?"}, {"owner": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "reply_to_user": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "edited": false, "score": 0, "creation_date": 1576607475, "post_id": 59380027, "comment_id": 104952304, "body": "@Chariot I edited my answer to include some basic instructions. As always, I recommend that you read the manual for the tool! If I answered your question, please consider accepting it so others can benefit from this question. Cheers!"}], "tags": [], "owner": {"reputation": 1468, "user_id": 10332049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-b85YaqT-DmE/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rmt7ZG1JNW3HMFwSmbw7iYxcGZTw/mo/photo.jpg?sz=128", "display_name": "Saucy Goat", "link": "https://stackoverflow.com/users/10332049/saucy-goat"}, "is_accepted": true, "score": 3, "last_activity_date": 1576607384, "last_edit_date": 1576607384, "creation_date": 1576606923, "answer_id": 59380027, "question_id": 59379944, "link": "https://stackoverflow.com/questions/59379944/how-to-know-the-amount-of-memory-to-be-used-in-this-program-and-if-it-fits-in-th/59380027#59380027", "title": "How to know the amount of memory to be used in this program and if it fits in the caches?", "body": "<p><code>valgrind</code>'s <a href=\"https://valgrind.org/docs/manual/ms-manual.html\" rel=\"nofollow noreferrer\"><code>massif</code></a> tool does what you want. It is a very complete heap profiler. </p>\n\n<p>Here's how to use it:</p>\n\n<p><code>valgrind --tool=massif &lt;program&gt;</code>, where <code>&lt;program&gt;</code> is, well, your program. Running this will write the memory profiling data to a file called <code>massif.out.&lt;pid&gt;</code>, where <code>&lt;pid&gt;</code> is the process ID of the program you ran.</p>\n\n<p>Then you can run the command <code>ms_print massif.out.&lt;pid&gt;</code>, which will present you with the output graph showing the memory consumption.</p>\n\n<p>Usage example:</p>\n\n<pre><code>valgrind --tool=massif myprogram\nms_print massif.out.12345\n</code></pre>\n\n<p>I strongly recommend that you read the manual that I linked above, as it contains more detailed instructions and describes how you can further use this awesome tool.</p>\n"}], "owner": {"reputation": 315, "user_id": 7802118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b7f749e887418ae2ea8929eb536af25?s=128&d=identicon&r=PG&f=1", "display_name": "Chariot", "link": "https://stackoverflow.com/users/7802118/chariot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 59380027, "answer_count": 1, "score": 0, "last_activity_date": 1576607384, "creation_date": 1576606546, "question_id": 59379944, "link": "https://stackoverflow.com/questions/59379944/how-to-know-the-amount-of-memory-to-be-used-in-this-program-and-if-it-fits-in-th", "title": "How to know the amount of memory to be used in this program and if it fits in the caches?", "body": "<p>I have a nbody algorithm in c, I want to know the memory of that program use and in what cache memory resides. How I can calculate this?\nI tried to multiply the n positions of the array by the size of each element of the array and comparare this result with the cache size. I'm right?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 880, "user_id": 3661738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acddd9c3372908d0903c4611aea1a9b7?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/3661738/tyler"}, "edited": false, "score": 0, "creation_date": 1576606168, "post_id": 59379817, "comment_id": 104951722, "body": "What are you expecting to happen"}, {"owner": {"reputation": 1, "user_id": 7024308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2092c0e36a0620346e0c2a52e0a0ead1?s=128&d=identicon&r=PG&f=1", "display_name": "satwik", "link": "https://stackoverflow.com/users/7024308/satwik"}, "reply_to_user": {"reputation": 880, "user_id": 3661738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acddd9c3372908d0903c4611aea1a9b7?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/3661738/tyler"}, "edited": false, "score": 0, "creation_date": 1576606412, "post_id": 59379817, "comment_id": 104951833, "body": "I am trying to understand the actual snippet of how the code works internally. why &quot;*end&quot; is not getting printed.. it&#39;s not about the result every time!! I am trying to figure out the concept behind... How actually start&lt;org behaving?"}, {"owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 0, "creation_date": 1576607506, "post_id": 59379817, "comment_id": 104952318, "body": "When the line after your comment executes, <code>end</code> will point at the terminating null character of the original string. If you print <code>*end</code>, you shouldn&#39;t expect to get anything. The rest of the function will copy the original string starting at that point, so you get the original string doubled. So the function name <code>double_string</code> seems to agree with its effect. Does the behavior of the program differ from your expectations?"}, {"owner": {"reputation": 1, "user_id": 7024308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2092c0e36a0620346e0c2a52e0a0ead1?s=128&d=identicon&r=PG&f=1", "display_name": "satwik", "link": "https://stackoverflow.com/users/7024308/satwik"}, "reply_to_user": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 0, "creation_date": 1576607908, "post_id": 59379817, "comment_id": 104952466, "body": "@FredLarson As the end pointer is pointing to the null and *org is pointing to the end pointer address as well..... How actually the comparision is happening  between start and org which is pointing to null..Please let me know"}, {"owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 0, "creation_date": 1576608733, "post_id": 59379817, "comment_id": 104952816, "body": "Be careful not confuse a pointer to a null character with a null pointer. <code>end</code> and <code>org</code> both point at the null terminator to begin with. But <code>end</code> gets incremented as the characters are copied to the end of the original string. <code>org</code> remains pointing to where the original string ended, so the <code>start&lt;org</code> comparison tells when to stop copying."}, {"owner": {"reputation": 1, "user_id": 7024308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2092c0e36a0620346e0c2a52e0a0ead1?s=128&d=identicon&r=PG&f=1", "display_name": "satwik", "link": "https://stackoverflow.com/users/7024308/satwik"}, "reply_to_user": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 0, "creation_date": 1576609361, "post_id": 59379817, "comment_id": 104953052, "body": "@FredLarson Thank you very very much .. *org = end // here org points to null pointer, where end pointer is shifted from addind strlen(ary)    `` `` so org should also be null `` `` But Start is pointing to the first element in the ary.... ``` How can first element in the ary less then null value which is pointed by null pointer org"}, {"owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 0, "creation_date": 1576610560, "post_id": 59379817, "comment_id": 104953531, "body": "The comparison is on the <i>pointers</i>, not the characters the pointers point to."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 7024308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2092c0e36a0620346e0c2a52e0a0ead1?s=128&d=identicon&r=PG&f=1", "display_name": "satwik", "link": "https://stackoverflow.com/users/7024308/satwik"}, "edited": false, "score": 0, "creation_date": 1576607072, "post_id": 59379984, "comment_id": 104952140, "body": "My confusion is why  is it not returning type error when we are adding two different typed things...ary which is &quot;character array&quot; and strlen(ary) which is &quot;unsigned long&quot;.. Please let me know"}, {"owner": {"reputation": 880, "user_id": 3661738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acddd9c3372908d0903c4611aea1a9b7?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/3661738/tyler"}, "reply_to_user": {"reputation": 1, "user_id": 7024308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2092c0e36a0620346e0c2a52e0a0ead1?s=128&d=identicon&r=PG&f=1", "display_name": "satwik", "link": "https://stackoverflow.com/users/7024308/satwik"}, "edited": false, "score": 0, "creation_date": 1576607233, "post_id": 59379984, "comment_id": 104952214, "body": "@satwik They are implicitly cast to types the compiler knows how to handle. + operator isn&#39;t always &quot;adding&quot;, in this case it is moving a pointer a number of bytes. But it is almost like adding a number of bytes to a position in memory, to get a new position"}, {"owner": {"reputation": 1, "user_id": 7024308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2092c0e36a0620346e0c2a52e0a0ead1?s=128&d=identicon&r=PG&f=1", "display_name": "satwik", "link": "https://stackoverflow.com/users/7024308/satwik"}, "edited": false, "score": 0, "creation_date": 1576607517, "post_id": 59379984, "comment_id": 104952323, "body": "Thank you.. but when I tried to check the sizeof the &quot; *end &quot; with different word lengths...I am always getting same size as 8..but infact if bytes increases size should increase isn&#39;t it ? or am  I thinking the wrong way?"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 1, "user_id": 7024308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2092c0e36a0620346e0c2a52e0a0ead1?s=128&d=identicon&r=PG&f=1", "display_name": "satwik", "link": "https://stackoverflow.com/users/7024308/satwik"}, "edited": false, "score": 1, "creation_date": 1576608584, "post_id": 59379984, "comment_id": 104952744, "body": "@satwik You are probably thinking the wrong way. sizeof(end) is always 8 because end is a pointer and pointers take up 8 bytes on your computer. sizeof(*end) would always be 1 because *end is a char and chars are always 1 byte."}, {"owner": {"reputation": 1, "user_id": 7024308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2092c0e36a0620346e0c2a52e0a0ead1?s=128&d=identicon&r=PG&f=1", "display_name": "satwik", "link": "https://stackoverflow.com/users/7024308/satwik"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1576608852, "post_id": 59379984, "comment_id": 104952857, "body": "@user253751 Thank you very much I got it now but the only confusion is ..How actually the comparision is happening between start and org which is pointing to null..Please let me know"}], "tags": [], "owner": {"reputation": 880, "user_id": 3661738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acddd9c3372908d0903c4611aea1a9b7?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/3661738/tyler"}, "is_accepted": false, "score": 1, "last_activity_date": 1576606705, "creation_date": 1576606705, "answer_id": 59379984, "question_id": 59379817, "link": "https://stackoverflow.com/questions/59379817/what-happens-when-i-add-character-array-with-unsigned-long-in-c/59379984#59379984", "title": "What happens when I add character array with unsigned long in c?", "body": "<p><code>char *end = ary + strlen(ary);</code> </p>\n\n<p>This line of code is taking the starting address of the char array in memory, adding the number of bytes inside the array, returned by strlen(), and essentially moving the pointer to the end. The end of the array is the null terminator. Printing that will show nothing as it takes it as an empty string. </p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 7024308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2092c0e36a0620346e0c2a52e0a0ead1?s=128&d=identicon&r=PG&f=1", "display_name": "satwik", "link": "https://stackoverflow.com/users/7024308/satwik"}, "edited": false, "score": 0, "creation_date": 1576609969, "post_id": 59380616, "comment_id": 104953285, "body": "Best explanation I have ever got.... Thank you very much for sharing so many internal things which made concepts very clearer to me... Thank you again"}, {"owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "reply_to_user": {"reputation": 1, "user_id": 7024308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2092c0e36a0620346e0c2a52e0a0ead1?s=128&d=identicon&r=PG&f=1", "display_name": "satwik", "link": "https://stackoverflow.com/users/7024308/satwik"}, "edited": false, "score": 0, "creation_date": 1576610036, "post_id": 59380616, "comment_id": 104953313, "body": "Glad to be of service! Drawing things like this on paper can often help understand pointer issues."}], "tags": [], "owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "is_accepted": false, "score": 0, "last_activity_date": 1576610672, "last_edit_date": 1576610672, "creation_date": 1576609667, "answer_id": 59380616, "question_id": 59379817, "link": "https://stackoverflow.com/questions/59379817/what-happens-when-i-add-character-array-with-unsigned-long-in-c/59380616#59380616", "title": "What happens when I add character array with unsigned long in c?", "body": "<p>Adding an <code>unsigned int</code> (or even a signed <code>int</code>!) is known as <em>pointer arithmetic</em>. It's legal and quite common in C code.  You do have to be very careful about going out of the bounds of your memory buffer, though, or you will experience <em>undefined behavior</em>. This is bad. Fortunately, this code appears to be quite well behaved as long as the original string is less than half the length of its memory buffer.</p>\n\n<p>Allow me to try some ASCII art to see if I can make clear what's going on in the <code>double_string</code> function. It starts with this:</p>\n\n<pre><code>   char *start = ary;\n   char *end = ary + strlen(ary);\n   char *org = end;\n</code></pre>\n\n<p>At this point, your pointers look like this:</p>\n\n<pre><code>    start                                end\n      |                                   |\n      |                                  org\n      |                                   |\n      v                                   V\n    ----------------------------------------------------------------------------------\nary | T | A | C | s | a | s | a | s | a |\\0 |   |   |   |   |   |   |   |   |   |   | ...\n    ----------------------------------------------------------------------------------\n</code></pre>\n\n<p>Then we have the loop.</p>\n\n<pre><code>  while(start&lt;org)\n  {\n     *end = *start;\n     start++;\n     end++;\n  }\n</code></pre>\n\n<p>After the first loop iteration, it looks like this:</p>\n\n<pre><code>        start                                end\n          |                                   |\n          |                              org  |\n          |                               |   |\n          v                               V   V\n    ----------------------------------------------------------------------------------\nary | T | A | C | s | a | s | a | s | a | T |   |   |   |   |   |   |   |   |   |   | ...\n    ----------------------------------------------------------------------------------\n</code></pre>\n\n<p>Second iteration:</p>\n\n<pre><code>            start                                end\n              |                                   |\n              |                          org      |\n              |                           |       |\n              v                           V       V\n    ----------------------------------------------------------------------------------\nary | T | A | C | s | a | s | a | s | a | T | A |   |   |   |   |   |   |   |   |   | ...\n    ----------------------------------------------------------------------------------\n</code></pre>\n\n<p>And so on. The loop continues as long as <code>start</code> is less than (to the left of, in my illustration) <code>org</code>:</p>\n\n<pre><code>                                        start                                end\n                                          |                                   |\n                                         org                                  |\n                                          |                                   |\n                                          V                                   V\n    ----------------------------------------------------------------------------------\nary | T | A | C | s | a | s | a | s | a | T | A | C | s | a | s | a | s | a |   |   | ...\n    ----------------------------------------------------------------------------------\n</code></pre>\n\n<p>Now <code>start&lt;org</code> is no longer true, because they're equal. They point to the same location. The loop terminates. All that's left to do is terminate the string with <code>*end = '\\0';</code>:</p>\n\n<pre><code>                                        start                                end\n                                          |                                   |\n                                         org                                  |\n                                          |                                   |\n                                          V                                   V\n    ----------------------------------------------------------------------------------\nary | T | A | C | s | a | s | a | s | a | T | A | C | s | a | s | a | s | a |\\0 |   | ...\n    ----------------------------------------------------------------------------------\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 7024308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2092c0e36a0620346e0c2a52e0a0ead1?s=128&d=identicon&r=PG&f=1", "display_name": "satwik", "link": "https://stackoverflow.com/users/7024308/satwik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1576610672, "creation_date": 1576605951, "question_id": 59379817, "link": "https://stackoverflow.com/questions/59379817/what-happens-when-i-add-character-array-with-unsigned-long-in-c", "title": "What happens when I add character array with unsigned long in c?", "body": "<pre><code>#include &lt;stdio.h&gt;\n#include&lt;string.h&gt;\nvoid  double_string(char ary[])\n{\n  char *start = ary;\n // dont exactly know what is happening here nothing is getting printed when consoled\n  char *end = ary + strlen(ary);\n  char *org = end;\n\n  while(start&lt;org)\n  {\n     *end = *start;\n     start++;\n     end++;\n  }\n  *end = '\\0';\n}\n\nint main(void) {\n   char word[255] = {\"TACsasasa\"};\n   double_string(word);\n   printf(\"%s\",word);\n  return 0;\n}\n</code></pre>\n\n<p>I am unable to understand what is getting stored in character array \"*end\", I tried printing it but I am not getting any output printed..</p>\n"}, {"tags": ["c", "arrays"], "comments": [{"owner": {"reputation": 31255, "user_id": 28494, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/c14ME.gif?s=128&g=1", "display_name": "qrdl", "link": "https://stackoverflow.com/users/28494/qrdl"}, "edited": false, "score": 0, "creation_date": 1576607853, "post_id": 59379736, "comment_id": 104952451, "body": "No. You can use <code>strtok()</code> to split source string into chunks and save these chunks as array elements"}, {"owner": {"reputation": 1320, "user_id": 5495906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5b319c1b73d80f4155fbdd4fcb81525?s=128&d=identicon&r=PG&f=1", "display_name": "LegendofPedro", "link": "https://stackoverflow.com/users/5495906/legendofpedro"}, "edited": false, "score": 0, "creation_date": 1576661955, "post_id": 59379736, "comment_id": 104968723, "body": "Note that your declaration of <code>A</code> won&#39;t compile as it has an incomplete type. Should it be one or two dimensional?"}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 12096264, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Nvgoa8X6yfc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rexvf_ti5eFNYnHdOnTIBZyzvsjLQ/photo.jpg?sz=128", "display_name": "mrunje", "link": "https://stackoverflow.com/users/12096264/mrunje"}, "edited": false, "score": 0, "creation_date": 1576661057, "post_id": 59382130, "comment_id": 104968245, "body": "You forgot that snprintf puts \\0 after VAL is added... So that doesnt work"}, {"owner": {"reputation": 1320, "user_id": 5495906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5b319c1b73d80f4155fbdd4fcb81525?s=128&d=identicon&r=PG&f=1", "display_name": "LegendofPedro", "link": "https://stackoverflow.com/users/5495906/legendofpedro"}, "reply_to_user": {"reputation": 55, "user_id": 12096264, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Nvgoa8X6yfc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rexvf_ti5eFNYnHdOnTIBZyzvsjLQ/photo.jpg?sz=128", "display_name": "mrunje", "link": "https://stackoverflow.com/users/12096264/mrunje"}, "edited": false, "score": 0, "creation_date": 1576661647, "post_id": 59382130, "comment_id": 104968557, "body": "I tested it in gdb and only <code>A[28] == 0</code>. That&#39;s why the whole array prints with just one <code>%s</code> format specifier."}], "tags": [], "owner": {"reputation": 1320, "user_id": 5495906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5b319c1b73d80f4155fbdd4fcb81525?s=128&d=identicon&r=PG&f=1", "display_name": "LegendofPedro", "link": "https://stackoverflow.com/users/5495906/legendofpedro"}, "is_accepted": false, "score": 0, "last_activity_date": 1576617085, "creation_date": 1576617085, "answer_id": 59382130, "question_id": 59379736, "link": "https://stackoverflow.com/questions/59379736/how-to-edit-certain-part-of-char-array/59382130#59382130", "title": "How to edit certain part of char array", "body": "<p>You would have to specify what you're looking for (the <code>needle</code>s) in the haystack (<code>A</code>).\n<code>strstr()</code> finds a pointer to the needle, if it exists in the haystack. Since your replacement values are <code>int</code>, not <code>char</code> or <code>char[]</code> (or a pointer to those types), you need to use <code>sprintf</code>/<code>snprintf</code> to save a formatted string into your variable.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint main(int argc, char* argv[]) {   \n    char A[] = {\"/text/X/text/Y/text/G/text/H\"};\n    int VAL[] = {0,1,2,3};\n    char needle[][2] = {\n        {\"X\"},\n        {\"Y\"},\n        {\"g\"},\n        {\"H\"}\n    };\n\n    printf(\"Original A: %s\\r\\n\", A);\n    //swap/edit -&gt; set X to VAL[0],set Y to VAL[1],set g to VAL[2],set H to VAL[3]\n    for(int i=0; i&lt;(sizeof(VAL)/sizeof(int)); i++) {\n        char *p = NULL;\n        p = strstr(A, needle[i]);\n        if(p) snprintf(p, 1, \"%1i\", VAL[i]);\n    }\n    printf(\"Edited A: %s\\r\\n\", A);\n    return 0;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Original A: /text/X/text/Y/text/G/text/H\nEdited A: /text/0/text/1/text/G/text/3\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 12096264, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Nvgoa8X6yfc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rexvf_ti5eFNYnHdOnTIBZyzvsjLQ/photo.jpg?sz=128", "display_name": "mrunje", "link": "https://stackoverflow.com/users/12096264/mrunje"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1576617085, "creation_date": 1576605567, "question_id": 59379736, "link": "https://stackoverflow.com/questions/59379736/how-to-edit-certain-part-of-char-array", "title": "How to edit certain part of char array", "body": "<p>Is there any function or method in c to do swap/edit of certain part of char array. </p>\n\n<p>Some pseudocode:</p>\n\n<pre><code>char A[] = {\"/text/X/text/Y\",\"/text/G/text/H\"};\nint VAL[] = {0,1,2,3};\n\nswap/edit -&gt; set X to VAL[0],set Y to VAL[1],set g to VAL[2],set H to VAL[3]\n</code></pre>\n"}, {"tags": ["c", "linux"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 8, "creation_date": 1576605510, "post_id": 59379709, "comment_id": 104951410, "body": "You tell it \u2014 that&#39;s what <code>%d</code> says.  The arguments after the format string are subject to default argument promotion rules \u2014 <code>unsigned short</code> and <code>short</code> are both converted to <code>int</code> (but they&#39;re converted to different <code>int</code> values under normal circumstances) before <code>printf()</code> is called.  (See C11 <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.5.2.2p6\" rel=\"nofollow noreferrer\">&#167;6.5.2.2 Function calls &#182;6</a> for details.)"}, {"owner": {"reputation": 25937, "user_id": 338904, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/dea29233fa03ea84f8a853102deb0344?s=128&d=identicon&r=PG", "display_name": "e2-e4", "link": "https://stackoverflow.com/users/338904/e2-e4"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1576606941, "post_id": 59379709, "comment_id": 104952099, "body": "Try with <code>unsigned</code> and <code>int</code> since it should have the size <code>%d</code> expects (no short-&gt;int extension), say 4 bytes, and using that <code>int</code> size for the assignment, i.e. <code>0xffffffff</code>, and printf will not produce miracles anymore... @JonathanLeffler You should write an answer, this is an interesting question."}], "answers": [{"tags": [], "owner": {"reputation": 1957, "user_id": 12056564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ec003d02adbcf6a3065097f6f29fa29?s=128&d=identicon&r=PG&f=1", "display_name": "Gerd", "link": "https://stackoverflow.com/users/12056564/gerd"}, "is_accepted": false, "score": 1, "last_activity_date": 1576651435, "last_edit_date": 1576651435, "creation_date": 1576614399, "answer_id": 59381629, "question_id": 59379709, "link": "https://stackoverflow.com/questions/59379709/how-does-printf-know-when-its-being-passed-a-signed-int/59381629#59381629", "title": "How does printf know when it&#39;s being passed a signed int", "body": "<p>I think we have to more carefully distinguish between the type conversions on the different integer types on one hand and the <code>printf</code> format specifiers (allowing to force <code>printf</code> how to interpret the data) on the other hand. </p>\n\n<p>Systematically: </p>\n\n<pre><code>printf(\"%hd %hd\\n\", positive, negative);\n// gives: -1 -1\n</code></pre>\n\n<p>Both values are interpreted as <em>signed short int</em> by <code>printf</code>, regardless of the declaration. </p>\n\n<pre><code>printf(\"%hu %hu\\n\", positive, negative);\n// gives: 65535 65535\n</code></pre>\n\n<p>Both values are interpreted as <em>unsigned short int</em> by <code>printf</code>, regardless of the declaration. </p>\n\n<p>However, </p>\n\n<pre><code>printf(\"%d %d\\n\", positive, negative);\n// gives: 65535 -1\n</code></pre>\n\n<p>Both values are implicitly converted to (a longer) <em>int</em>, while the sign is kept. </p>\n\n<p>Finally, </p>\n\n<pre><code>printf(\"%u %u\\n\", positive, negative);\n// gives 65535 4294967295\n</code></pre>\n\n<p>Again, both values are implicitly converted to <em>int</em>, while the sign is kept, but then the negative value is interpreted as unsigned. As we can see here, plain <code>int</code> is actually 32-bit (on this system).</p>\n\n<hr>\n\n<p>Curiously, only if I compile with <code>gcc</code> and <code>-Wpedantic</code>, it gives me a warning for the assignment <code>short int negative = 0xffff;</code>. </p>\n"}], "owner": {"reputation": 51, "user_id": 12190484, "user_type": "registered", "profile_image": "https://graph.facebook.com/10215519207595104/picture?type=large", "display_name": "Paul Lord", "link": "https://stackoverflow.com/users/12190484/paul-lord"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1576651435, "creation_date": 1576605453, "last_edit_date": 1576606566, "question_id": 59379709, "link": "https://stackoverflow.com/questions/59379709/how-does-printf-know-when-its-being-passed-a-signed-int", "title": "How does printf know when it&#39;s being passed a signed int", "body": "<p>I'm trying to figure out how variables really work in C and find it strange how the <code>printf</code> function seems to know the difference between different variables of the same size, I'm assuming they're both 16 bits.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void) {\n    unsigned short int positive = 0xffff;\n    short int negative = 0xffff;\n\n    printf(\"%d\\n%d\\n\", positive, negative);\nreturn 0;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>65535\n-1\n</code></pre>\n"}]