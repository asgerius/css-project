[{"tags": ["c++", "c", "function-pointers"], "comments": [{"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 4, "creation_date": 1525910244, "post_id": 50263615, "comment_id": 87545250, "body": "How to solve it is to add fuel to the fire and add a bunch of explicit casts everywhere. This is very fragile, and type-unsafe. An even better solution is to rewrite the whole thing in typesafe C++."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 2, "creation_date": 1525910297, "post_id": 50263615, "comment_id": 87545263, "body": "C++ has stronger typing rules with respect to what you can do with a <code>void*</code> It demands that you acknowledge that you&#39;re doing something dodgy with a cast."}, {"owner": {"reputation": 5896, "user_id": 1106415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6fvK.png?s=128&g=1", "display_name": "hlt", "link": "https://stackoverflow.com/users/1106415/hlt"}, "edited": false, "score": 2, "creation_date": 1525910563, "post_id": 50263615, "comment_id": 87545321, "body": "Are you really explicitly casting to <code>bool*</code>? Seems like you should cast to <code>(void (*)(bool))</code> instead..."}, {"owner": {"reputation": 13, "user_id": 9767717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c9a5d69836128311157f0050abad96?s=128&d=identicon&r=PG&f=1", "display_name": "ivan braga", "link": "https://stackoverflow.com/users/9767717/ivan-braga"}, "edited": false, "score": 0, "creation_date": 1525910880, "post_id": 50263615, "comment_id": 87545389, "body": "Sam Varshavchik, I know that if everything was in C ++ it would be right, but I try to reuse the code in c, because what I&#39;m trying to do is a RAD tool, ie drag and drop. So, I need the c code, as this will be used by the final application in c."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 2, "creation_date": 1525911135, "post_id": 50263615, "comment_id": 87545456, "body": "You should compile the C files in C.  (Maybe you are unaware that compiled C files can be linked into a C++ project)"}, {"owner": {"reputation": 13, "user_id": 9767717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c9a5d69836128311157f0050abad96?s=128&d=identicon&r=PG&f=1", "display_name": "ivan braga", "link": "https://stackoverflow.com/users/9767717/ivan-braga"}, "edited": false, "score": 0, "creation_date": 1525911258, "post_id": 50263615, "comment_id": 87545491, "body": "hit, I applied (void (<i>) (bool)), and the error stopped. You could explain (void (</i>) (bool)), so I understand what happens."}, {"owner": {"reputation": 6058, "user_id": 3871028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfbe44ff5c56628e85683c8918602c96?s=128&d=identicon&r=PG&f=1", "display_name": "Ripi2", "link": "https://stackoverflow.com/users/3871028/ripi2"}, "edited": false, "score": 0, "creation_date": 1525911436, "post_id": 50263615, "comment_id": 87545542, "body": "<code>void (*fchd_ptr)(bool)</code> declares a pointer to a function that accepts a <code>bool</code> parameter and returns <code>void</code>"}, {"owner": {"reputation": 13, "user_id": 9767717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c9a5d69836128311157f0050abad96?s=128&d=identicon&r=PG&f=1", "display_name": "ivan braga", "link": "https://stackoverflow.com/users/9767717/ivan-braga"}, "edited": false, "score": 0, "creation_date": 1525911666, "post_id": 50263615, "comment_id": 87545600, "body": "M.M, I was going in that direction, compile in c and link."}], "answers": [{"comments": [{"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 1, "creation_date": 1525912371, "post_id": 50263792, "comment_id": 87545718, "body": "<i>recommend reworking the C API so that it really takes a function pointer</i> -- this will avoid the need of a cast for assignment."}, {"owner": {"reputation": 13, "user_id": 9767717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c9a5d69836128311157f0050abad96?s=128&d=identicon&r=PG&f=1", "display_name": "ivan braga", "link": "https://stackoverflow.com/users/9767717/ivan-braga"}, "edited": false, "score": 0, "creation_date": 1525912650, "post_id": 50263792, "comment_id": 87545789, "body": "jxh, Could you give an example? How would you do with the code example above?"}, {"owner": {"reputation": 5896, "user_id": 1106415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6fvK.png?s=128&g=1", "display_name": "hlt", "link": "https://stackoverflow.com/users/1106415/hlt"}, "edited": false, "score": 1, "creation_date": 1525912773, "post_id": 50263792, "comment_id": 87545818, "body": "Basically the idea is to replace <code>void *fchd_ptr</code> in the function signature with <code>void (*fchd_ptr)(bool)</code> - the same function pointer type that you need later. That lets you avoid the cast, and the errors that can happen with <code>void *</code>"}], "tags": [], "owner": {"reputation": 5896, "user_id": 1106415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6fvK.png?s=128&g=1", "display_name": "hlt", "link": "https://stackoverflow.com/users/1106415/hlt"}, "is_accepted": true, "score": 1, "last_activity_date": 1525911711, "creation_date": 1525911711, "answer_id": 50263792, "question_id": 50263615, "link": "https://stackoverflow.com/questions/50263615/void-to-void-bool-errors-with-pointers-compiling-files-in-c-with-a-c/50263792#50263792", "title": "&#39;void *&#39; to &#39;void (*) (bool)&#39; Errors with pointers compiling files in c with a c ++ compiler", "body": "<p>Your explicit cast is wrong. You cast to <code>bool *</code> (pointer to object of type <code>bool</code>), when you really should be casting to <code>void (*)(bool)</code> (pointer to function taking a <code>bool</code> and returning nothing).<sup>1</sup></p>\n\n<p>If you replace that line by</p>\n\n<pre><code>ptr-&gt;fchd_ptr = (void (*)(bool)) fchd_ptr;\n</code></pre>\n\n<p>it will compile in both C and C++.</p>\n\n<hr>\n\n<p>If possible, however, you should try to compile your C code in C only - while we might get this one thing working, the two languages are not always fully compatible, and you may well run into trouble down the road. Generally, it is possible to compile C code separately from the C++ parts. If you use <a href=\"https://stackoverflow.com/questions/1041866/what-is-the-effect-of-extern-c-in-c#1041880\"><code>extern \"C\"</code></a> in your header files, you can simply link the C++ objects and the C objects together, or keep the C part in a separate library (static or dynamic).</p>\n\n<p>Additionally, I would recommend reworking the C API so that it really takes a function pointer all the way through if that is at all possible. Aliasing through <code>void *</code> is ugly and can lead to some really nasty bugs and crashes if you pass in the wrong pointer type.</p>\n\n<hr>\n\n<p><sup>1</sup> Function pointers are generally very different from object pointers, and it is implementation-defined whether you are even allowed to cast between the two. Here, you want a pointer to a function, not a pointer to an object (like <code>bool*</code> would be a pointer to an object of type <code>bool</code>) so that you can call it later. You can see in your code sample that <code>void (*fchd_ptr)(bool)</code> is the declaration of the variable that you assign to, which makes <code>void (*)(bool)</code> its type. If you find the notation somewhat confusing, <a href=\"https://cdecl.org\" rel=\"nofollow noreferrer\">cdecl.org</a> is a great way to deal with those convoluted array, pointer and function pointer names that come from C.</p>\n"}, {"tags": [], "owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "is_accepted": false, "score": 1, "last_activity_date": 1525914437, "last_edit_date": 1525914437, "creation_date": 1525912293, "answer_id": 50263861, "question_id": 50263615, "link": "https://stackoverflow.com/questions/50263615/void-to-void-bool-errors-with-pointers-compiling-files-in-c-with-a-c/50263861#50263861", "title": "&#39;void *&#39; to &#39;void (*) (bool)&#39; Errors with pointers compiling files in c with a c ++ compiler", "body": "<p>If you change the signature of the function to accept a function pointer that matches the type expected by <code>ptr-&gt;fchd_ptr</code>. Then, you would not need to use a cast to complete the assignment.</p>\n\n<p>Based on your question, this would be:</p>\n\n<pre><code>void BT_SetHandler(BUTTON_t* ptr, void (*fchd_ptr)(bool))\n</code></pre>\n\n<p>However, if you are not sure what the type is for <code>ptr-&gt;fchd_ptr</code>, you can make the compiler figure it out for you. Previously, this could only be done with a template function and it would derive a type based on what was passed into the function call at compile time. However, C++.11 provdes <code>decltype</code>, which allows you to enforce the type you want for the function parameter, rather than letting the compiler deduce one from callers of the function.</p>\n\n<pre><code>void BT_SetHandler(BUTTON_t* ptr, decltype(ptr-&gt;fchd_ptr) fchd_ptr)\n</code></pre>\n\n<p>This is fine so long as you are intent on compiling your code with a C++ compiler.</p>\n"}], "owner": {"reputation": 13, "user_id": 9767717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c9a5d69836128311157f0050abad96?s=128&d=identicon&r=PG&f=1", "display_name": "ivan braga", "link": "https://stackoverflow.com/users/9767717/ivan-braga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "accepted_answer_id": 50263792, "answer_count": 2, "score": 0, "last_activity_date": 1525917781, "creation_date": 1525910185, "last_edit_date": 1525917781, "question_id": 50263615, "link": "https://stackoverflow.com/questions/50263615/void-to-void-bool-errors-with-pointers-compiling-files-in-c-with-a-c", "title": "&#39;void *&#39; to &#39;void (*) (bool)&#39; Errors with pointers compiling files in c with a c ++ compiler", "body": "<p>First of all, thank you to whoever is reading and to whom you can respond.</p>\n\n<p>This part of code, is part of an interface library gui, totally written in c.</p>\n\n<p>But I'm tempted to compile these written files in c, with a c ++ compiler to be able to integrate into a program I'm doing with wxwidgets.</p>\n\n<p>Within the c files, I have several function calls that have as arguments, pointers to other functions. </p>\n\n<pre><code> typedef struct {\n      void (*fchd_ptr)(bool);   \n      uint16_t xpos;         \n      uint16_t ypos;          \n        ...\n        ...\n}BUTTON_t;\n\nvoid BT_SetHandler(BUTTON_t* ptr, void* fchd_ptr)\n{\n    if (ptr == NULL)\n        return;\n\n    ptr-&gt;fchd_ptr =  fchd_ptr;  // OK in C, ERROR In C++\n}\n</code></pre>\n\n<p>When I try to compile in C ++, I get this error.</p>\n\n<pre><code>ptr-&gt; fkt_ptr = fkt_ptr;\n// error: invalid conversion from 'void *' to 'void (*) (bool)' [-fpermissive]\n</code></pre>\n\n<p>If I cast an explicit cast.</p>\n\n<pre><code>ptr-&gt; fkt_ptr = (bool *) fkt_ptr;\n// error: can not convert 'bool *' to 'void (*) (bool)' in assignment\n</code></pre>\n\n<p>Any help, and explanation how to solve it will be welcome.</p>\n"}, {"tags": ["c", "pipe"], "comments": [{"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525918213, "post_id": 50263596, "comment_id": 87546976, "body": "immediately after: <code>execvp(argList[0], argList);</code> should be: <code>perror( &quot;execvp failed&quot; ); exit( EXIT_FAILURE );  then there needs to be a </code>} else { ` (the &#39;else&#39; related to: <code>if(cpid ==0)</code>) waitpid( cpid, &amp;status ); followed by any code you might want to use to look at the <code>status</code>."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525918472, "post_id": 50263596, "comment_id": 87547029, "body": "what is the contents of the array <code>arglist[]</code>?"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525918602, "post_id": 50263596, "comment_id": 87547052, "body": "after the code executed: <code>close(myPipe[0]);</code> no one will be able to <code>read()</code> from <code>myPipe[0]</code>"}, {"owner": {"reputation": 135, "user_id": 8882578, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-9rGcv-iFbcs/AAAAAAAAAAI/AAAAAAAAABY/GvyjPRU0Dfo/photo.jpg?sz=128", "display_name": "Lazarus", "link": "https://stackoverflow.com/users/8882578/lazarus"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525918654, "post_id": 50263596, "comment_id": 87547062, "body": "@user3629249 in this case arglist contains the string &quot;echo Lazarus&quot; (arglist is an array of strings, so it really contains &quot;echo&quot; and &quot;Lazarus&quot;). That string gets executed by the exec function, then I need to take what stdout is given (&quot;Lazarus&quot;) and I need to pipe it back into <code>expand</code>."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525918836, "post_id": 50263596, "comment_id": 87547102, "body": "regarding this comment: <code>read from the pipe in a loop until EOF</code> and following block of code:  using the <code>read()</code> function to read from the pipe, a EOF will never be seen, rather a byte count of 0 will be returned from<code>read()</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525920264, "post_id": 50263596, "comment_id": 87547454, "body": "regarding: <code>string = &quot;echo Lazarus&quot;;</code>,  How is <code>string</code> defined.  (I suspect it is defined as <code>char *string = NULL;</code>   the character string: <code>echo Lazarus</code> will be located in readonly memory, so cannot added to, changed, etc."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525920317, "post_id": 50263596, "comment_id": 87547472, "body": "Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> so we can reproduce your problem and therefore be able to give you good suggestions."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525920750, "post_id": 50263596, "comment_id": 87547563, "body": "Regarding your comment about the contents of <code>arglist[]</code>  The last entry always needs to be NULL.  The first entry, you say is <code>echo</code>  Well, that will not execute on its&#39; own.  The first entry needs to be (in linux) something like <code>&#47;bin&#47;bash</code> and the second entry needs to be something like <code>-c</code> and both pipes need to be open when calling <code>execvp()</code>"}, {"owner": {"reputation": 135, "user_id": 8882578, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-9rGcv-iFbcs/AAAAAAAAAAI/AAAAAAAAABY/GvyjPRU0Dfo/photo.jpg?sz=128", "display_name": "Lazarus", "link": "https://stackoverflow.com/users/8882578/lazarus"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525921398, "post_id": 50263596, "comment_id": 87547693, "body": "@user3629249 I&#39;m working on creating a shell, and this is part of that. I should have mentioned that for sure (I&#39;ve updated the question). The exec part works great. What&#39;s happening here is:  <code>1) I find something that looks like $(echo hello)</code> &gt; <code>2) I extract &quot;echo hello&quot; from that and send it to changeString</code> &gt; <code>3) in changestring, I call exec on that, which gives an output in the terminal of &quot;hello&quot;</code> &gt;&gt;&gt; now step 4 needs to be <code>pipe that output back into expand so that I can put it into my new string</code>. A good example is  &quot;echo my directory  is $(pwd)&quot;!  &gt;&gt;  &quot;my directory is /home/....!&quot;"}], "owner": {"reputation": 135, "user_id": 8882578, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh3.googleusercontent.com/-9rGcv-iFbcs/AAAAAAAAAAI/AAAAAAAAABY/GvyjPRU0Dfo/photo.jpg?sz=128", "display_name": "Lazarus", "link": "https://stackoverflow.com/users/8882578/lazarus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1525922759, "creation_date": 1525910017, "last_edit_date": 1525922759, "question_id": 50263596, "link": "https://stackoverflow.com/questions/50263596/putting-the-output-from-exec-into-a-pipe", "title": "putting the output from exec() into a pipe", "body": "<p>I'm having some trouble with a bit of piping. I'm creating a shell and I am in the process of expanding command line parameters. \nI think I need to use <code>dup2</code>, but I've been having trouble implementing it to the point that I just reset all my code to what I had the day before because of how broken it ended up being. Right now I have two functions that interact with each other. One makes a string, and the other calls <code>exec</code>, and I need to grab that output and put it into the string in the other function using a pipe.</p>\n\n<p>I have a function called <code>expand</code>:</p>\n\n<pre><code>...\nnew = \"my username is \";\nstring = \"echo Lazarus\";\n\n//make the pipe\nint myPipe[2];\npipe(myPipe);\nint n;\nchar buffer[65000];\n\n//call changeString         \nchangeString(string, myPipe[0], myPipe[1]);\n\n/*currently, this is how I can get a string into the pipe. \nI need to do this in changeString instead.*/\nwrite(myPipe[1], \"this is a test\", 14); \n\n//read from the pipe in a loop until EOF\nint stillReading = 1;\nwhile(stillReading != 0){\n   if((n = read(myPipe[0], buffer, 65000)) &gt;= 0){   \n      stillReading = 0;\n      buffer[n] = '\\0';\n   }    \n}\n\nclose(myPipe[0]);\n...\n\n//add the result to the new string\nfor(int i = 0; i &lt; bufferLength; i++){\n   string[stringIndex++] = buffer[i];\n}\n\nprintf(\"string is now '%s'\\n\", string); //should output: 'my username is Lazarus'\n...\n</code></pre>\n\n<p>And then I have a process <code>changeString</code>:</p>\n\n<pre><code>...\n\ncpid = fork();\nif(cpid &lt; 0){\n   return -1;\n}\n\nif(cpid == 0){\n   //We are the child!\n\n   //where argList[0] == the first word of string, and argList = string\n   //(this works just fine)\n   execvp(argList[0], argList);\n\n...\n\n...\n</code></pre>\n\n<p>What I need to do is put some code into changeString (dup2?) that allows me to put the output from exec into the new string. So that at the end, I get <code>new</code> being \"my username is Lazarus\"</p>\n"}, {"tags": ["c++", "c", "loops", "if-statement", "while-loop"], "comments": [{"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 5, "creation_date": 1525909565, "post_id": 50263523, "comment_id": 87545084, "body": "Pop quiz: what does <code>=</code> do? What does <code>==</code> do? When should you use one, or the other? Are you using them correctly? (Cheat sheet: the answer to the last one is &quot;no&quot;) Bonus question: <a href=\"https://stackoverflow.com/questions/50263460/c-function-not-receiving-return-value\">do you know the person who asked his question just before you did yours?</a>"}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 3, "creation_date": 1525909575, "post_id": 50263523, "comment_id": 87545088, "body": "Sadly <code>=</code> != <code>==</code>."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "reply_to_user": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 0, "creation_date": 1525909616, "post_id": 50263523, "comment_id": 87545099, "body": "@SamVarshavchik Ever get the feeling you are repeating yourself?"}, {"owner": {"reputation": 83151, "user_id": 3943312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc00b38b94ca7b6f820622b0a8af8ded?s=128&d=identicon&r=PG", "display_name": "Sam Varshavchik", "link": "https://stackoverflow.com/users/3943312/sam-varshavchik"}, "edited": false, "score": 1, "creation_date": 1525909652, "post_id": 50263523, "comment_id": 87545108, "body": "It&#39;s a thankless task, but someone has to do it..."}, {"owner": {"reputation": 5896, "user_id": 1106415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6fvK.png?s=128&g=1", "display_name": "hlt", "link": "https://stackoverflow.com/users/1106415/hlt"}, "edited": false, "score": 0, "creation_date": 1525910759, "post_id": 50263523, "comment_id": 87545367, "body": "<i>repetitio est mater studiorum</i>"}, {"owner": {"reputation": 86, "user_id": 14462794, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lPLzy.png?s=128&g=1", "display_name": "Rane", "link": "https://stackoverflow.com/users/14462794/rane"}, "edited": false, "score": 0, "creation_date": 1616059823, "post_id": 50263523, "comment_id": 117886355, "body": "Turn on all warnings (<code>-Wall -Wextra -Wpedantic</code>), read and fix them. This typo could have been avoided."}], "answers": [{"comments": [{"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1525910846, "post_id": 50263543, "comment_id": 87545382, "body": "Don&#39;t waste time answering trivial typo questions. Just flag them for closing."}], "tags": [], "owner": {"reputation": 159, "user_id": 6224137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d9239cae05f73d8bed41c693bd45655?s=128&d=identicon&r=PG", "display_name": "Ahmed Abdelaal", "link": "https://stackoverflow.com/users/6224137/ahmed-abdelaal"}, "is_accepted": false, "score": 1, "last_activity_date": 1564029655, "last_edit_date": 1564029655, "creation_date": 1525909592, "answer_id": 50263543, "question_id": 50263523, "link": "https://stackoverflow.com/questions/50263523/c-why-wont-my-program-loop-and-if-statements-not-work/50263543#50263543", "title": "C Why won&#39;t my program loop and &quot;if-statements&quot; not work?", "body": "<p>use <code>==</code> instead of <code>=</code>\nfor example </p>\n\n<pre><code>if (paycode == 1)\n{\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 135, "user_id": 1623055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69580c601325f2ec7964a43579d9d2a7?s=128&d=identicon&r=PG", "display_name": "Daman Pal Singh Khanna", "link": "https://stackoverflow.com/users/1623055/daman-pal-singh-khanna"}, "edited": false, "score": 0, "creation_date": 1525909887, "post_id": 50263574, "comment_id": 87545165, "body": "Additionally you should look to use switch case instead of if and break down your code into small chunks (functions)"}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1525910031, "post_id": 50263574, "comment_id": 87545201, "body": "Recommend an edit to the answer to move that comment into it. It&#39;s a worthwhile addition."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 2, "creation_date": 1525910870, "post_id": 50263574, "comment_id": 87545386, "body": "Don&#39;t waste time answering trivial typo questions. Just flag the question for closing."}, {"owner": {"reputation": 19, "user_id": 9767845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c30ec020bf5bee1151facffb837e55?s=128&d=identicon&r=PG&f=1", "display_name": "Cronin709", "link": "https://stackoverflow.com/users/9767845/cronin709"}, "edited": false, "score": 0, "creation_date": 1525960394, "post_id": 50263574, "comment_id": 87565752, "body": "Thanks a million! I can&#39;t believe I overlooked this simple fix... I will look more carefully at my coding from now on."}], "tags": [], "owner": {"reputation": 135, "user_id": 1623055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69580c601325f2ec7964a43579d9d2a7?s=128&d=identicon&r=PG", "display_name": "Daman Pal Singh Khanna", "link": "https://stackoverflow.com/users/1623055/daman-pal-singh-khanna"}, "is_accepted": true, "score": 1, "last_activity_date": 1525909807, "creation_date": 1525909807, "answer_id": 50263574, "question_id": 50263523, "link": "https://stackoverflow.com/questions/50263523/c-why-wont-my-program-loop-and-if-statements-not-work/50263574#50263574", "title": "C Why won&#39;t my program loop and &quot;if-statements&quot; not work?", "body": "<p>your if statements needs to have '==' instead of '='. Do the changes and try it out, if statements will start working.</p>\n"}], "owner": {"reputation": 19, "user_id": 9767845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2c30ec020bf5bee1151facffb837e55?s=128&d=identicon&r=PG&f=1", "display_name": "Cronin709", "link": "https://stackoverflow.com/users/9767845/cronin709"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "closed_date": 1525910719, "accepted_answer_id": 50263574, "answer_count": 2, "score": -3, "last_activity_date": 1616049701, "creation_date": 1525909386, "last_edit_date": 1616049701, "question_id": 50263523, "link": "https://stackoverflow.com/questions/50263523/c-why-wont-my-program-loop-and-if-statements-not-work", "closed_reason": "Not suitable for this site", "title": "C Why won&#39;t my program loop and &quot;if-statements&quot; not work?", "body": "<p>I am trying to write a code for school that allows the user to calculate different salaries based on the type of employee it is working. I believe I have all of the math coding done correctly however I need to make the program loop after each employee is selected. Here is the coding that I have completed thus far:</p>\n<pre><code>int paycode = 0;                                        \ndouble manager_salary;                                  \ndouble worker_salary;                                   \ndouble worker_hours;                                    \ndouble ot;                                              \ndouble worker_wage;                                     \ndouble sales;                                           \ndouble commission;                                      \ndouble pieces;                                          \ndouble piece_wage;                                      \ndouble pieceworker;                                     \n\nwhile (paycode &gt;= 0 &amp;&amp; paycode != 1)                    \n{\n    printf(&quot;\\n Enter the employee paycode (1-4) (-1 to end): &quot;);        \n    scanf_s(&quot;%d&quot;, &amp;paycode);\n\n    if (paycode = 1)                                                    \n    {\n        printf(&quot;\\n Manager Selected&quot;);                                  \n        printf(&quot;\\n Enter weekly Salary: &quot;);                             \n        scanf_s(&quot;%lf&quot;, &amp;manager_salary);\n        printf(&quot;\\nManagers Pay is $%.2f&quot;, manager_salary);              \n    }\n    else if (paycode = 2)\n    {\n        printf(&quot;\\n Hourly Worker Selected&quot;);                            \n        printf(&quot;\\n Enter the hourly salary: &quot;);                         \n        scanf_s(&quot;%lf&quot;, &amp;worker_salary);\n        printf(&quot;\\n Enter the total hours worked: &quot;);                    \n        scanf_s(&quot;%lf&quot;, &amp;worker_hours);\n        if (worker_hours &gt; 40.00)                                               \n            ot = (worker_hours - 40.00) * worker_salary *1.5;                   \n        else\n            ot = 0.00;                                                          \n        if (worker_hours &gt; 40.00)                                               \n            worker_wage = 40 * 16.78 + ot;                                      \n        else\n            worker_wage = worker_hours * worker_salary;                         \n        printf(&quot;\\n Hourly Worker's Pay is $%.2f&quot;, worker_wage);                 \n    }\n    else if (paycode = 3)\n    {\n        printf(&quot;\\n Commission Worker Selected&quot;);                        \n        printf(&quot;\\n Enter gross weekly sales: &quot;);                        \n        scanf_s(&quot;%lf&quot;, &amp;sales);\n        commission = sales * .057 + 250;                                \n        printf(&quot;\\n Commission Worker's Pay is $%.2f&quot;, commission);      \n    }\n    else if (paycode = 4)\n    {\n        printf(&quot;\\n Pieceworker Selected&quot;);                              \n        printf(&quot;\\n Enter number of pieces: &quot;);                          \n        scanf_s(&quot;%lf&quot;, &amp;pieces);\n        printf(&quot;\\n Enter wage per piece: &quot;);                            \n        scanf_s(&quot;%lf&quot;, &amp;piece_wage);\n        pieceworker = pieces * piece_wage;\n        printf(&quot;\\n Pieceworker's pay is $%.2f&quot;, pieceworker);           \n    }\n}\nreturn 0;\n</code></pre>\n<p>}</p>\n<p>When I run the program the if statements don't work and the program just spits out every single printf statement I have written.</p>\n<p>Please help me in telling me how to get my if statements to work and how to properly make a loop when properly filling out an employee salary.</p>\n<p>TIA</p>\n"}, {"tags": ["c", "string", "parsing", "struct"], "comments": [{"owner": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "edited": false, "score": 2, "creation_date": 1525907193, "post_id": 50263176, "comment_id": 87544546, "body": "First, you want to convert the string to a 64 bit integer. Then I would not use <code>union</code> for reasons you are experiencing (<code>struct</code> padding, in particular). Why not just directly assign each member? I know it&#39;s not clever, but it&#39;s clear, reliable, and, in this case, concise since you only have 3 structure members. For example, something like, <code>s.flags = (value &amp; 0xff);</code>, and <code>s.refresh_rate = (value &gt;&gt; 8) &amp; 0xffff;</code> and <code>s.timestamp = (value &gt;&gt; 24) &amp; 0xffffffff;</code>. Of course, this assumes you&#39;re using a 64 bit integer for <code>value</code>."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1525907225, "post_id": 50263176, "comment_id": 87544551, "body": "I would use <code>strtoull</code> to convert the string into a 64-bit value. And then use shifting and masking to extract the fields. Or you can break the string into three pieces, and convert each piece with <code>strtoul</code>."}, {"owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "edited": false, "score": 0, "creation_date": 1525909247, "post_id": 50263176, "comment_id": 87545015, "body": "Your structure would likely be 12 bytes on a 32-bit machine because of structure alignment to word boundaries.  You have 8 bytes for the pcBytes field, and up to 32 bits = 4 bytes for the anonymous field."}, {"owner": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "reply_to_user": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "edited": false, "score": 0, "creation_date": 1525982442, "post_id": 50263176, "comment_id": 87577829, "body": "Thanks @lurker. I will test this way.."}, {"owner": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "reply_to_user": {"reputation": 2267, "user_id": 8242447, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M6884.gif?s=128&g=1", "display_name": "\u1e42\u0173\u1efb\u1ecbg\u01fb\u0148\u1ea1c\u1ec3\u01a1\u1eed\u1e69", "link": "https://stackoverflow.com/users/8242447/%e1%b9%82%c5%b3%e1%bb%bb%e1%bb%8bg%c7%bb%c5%88%e1%ba%a1c%e1%bb%83%c6%a1%e1%bb%ad%e1%b9%a9"}, "edited": false, "score": 0, "creation_date": 1525982536, "post_id": 50263176, "comment_id": 87577881, "body": "Yes @Mulliganaceous"}], "answers": [{"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1525910237, "post_id": 50263480, "comment_id": 87545249, "body": "Recommend <code>strtoul</code> and <code>long long unsigned</code>, or better include <code>stdint.h</code> and use <code>uint64_t</code> exact width type to avoid potential problems with signed values."}], "tags": [], "owner": {"reputation": 2267, "user_id": 8242447, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M6884.gif?s=128&g=1", "display_name": "\u1e42\u0173\u1efb\u1ecbg\u01fb\u0148\u1ea1c\u1ec3\u01a1\u1eed\u1e69", "link": "https://stackoverflow.com/users/8242447/%e1%b9%82%c5%b3%e1%bb%bb%e1%bb%8bg%c7%bb%c5%88%e1%ba%a1c%e1%bb%83%c6%a1%e1%bb%ad%e1%b9%a9"}, "is_accepted": false, "score": 1, "last_activity_date": 1525910316, "last_edit_date": 1525910316, "creation_date": 1525909008, "answer_id": 50263480, "question_id": 50263176, "link": "https://stackoverflow.com/questions/50263176/how-to-parse-string-to-struct/50263480#50263480", "title": "How to parse string to struct?", "body": "<p>Here, you have a string of length 14, representing a 7-byte value, consisting of 14 hexadecimal values. Consider this code using <code>strtol</code>, which hexadecimally converts your string into a long int, and then decodes it digit-wise.</p>\n\n<pre><code>uint64_t n = strtoul(str, NULL, 16); // Convert to hexadecimal\nint flags = n % 0x10;\nint refresh_rate = (n / 0x100) % 0x100000;\nint timestamp = n / 0x1000000;\n</code></pre>\n\n<p>Here is a test case (#import <code>&lt;stdlib.h&gt;</code>):</p>\n\n<pre><code>char str[16] = \"5ABBF13EE00AFF\";\nuint64_t n = strtoul(str, NULL, 16); // Convert to hexadecimal\n\n// Use divide and mod to extract digit segment\nint flags = n % 0x100;\nint refresh_rate = (n / 0x100) % 0x10000;\nint timestamp = n / 0x1000000;\n// Print timestamp, refresh rate, and flags\nprintf(\"%p %p %p\", timestamp, refresh_rate, flags);\n</code></pre>\n\n<p>The expected result is <code>0x5abbf13e 0xe00a 0xff</code> as expected.</p>\n"}, {"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 1, "creation_date": 1525924982, "post_id": 50264212, "comment_id": 87548562, "body": "Good comment, will do. And good catch, I&#39;m so used to 64-bit boxes today, those 4-bit longs sneak by every now and then."}, {"owner": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1525986058, "post_id": 50264212, "comment_id": 87579438, "body": "Thanks @david-c-rankin. I will use your method."}, {"owner": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1525986404, "post_id": 50264212, "comment_id": 87579577, "body": "Just one question. How errno  will validate if one error occur?"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1525990804, "post_id": 50264212, "comment_id": 87581130, "body": "<code>man strtoll</code> &quot;<i>If an underflow occurs, strtoll()returns LLONG_MIN. If an overflow occurs, strtol() returns LLONG_MAX.  In both cases, errno is set to ERANGE.</i>&quot; (LL in context for L)"}, {"owner": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1526508763, "post_id": 50264212, "comment_id": 87777449, "body": "i&#39;m using this in STM32 microcontroller, so i don&#39;t know if all things in manual applies to this. I&#39;m testing this code microcontroller and some strange happens. My string is <code>5ABBF13A001E01</code> and strtoll returns <code>0x3a001e01005abbf1</code>.Do you know why?"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1526513477, "post_id": 50264212, "comment_id": 87778722, "body": "@R.Rodrigues post the exact conversion and I&#39;ll look at it. It would help to edit your question and <b>add</b> the code to the end of your question (don&#39;t erase any parts of the original -- or comments and answers won&#39;t make sense any more) I&#39;ll try and look up what a STM32 microcontroller is in the mean time."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1526515457, "post_id": 50264212, "comment_id": 87779170, "body": "@R.Rodrigues according to <a href=\"http://www.keil.com/support/man/docs/armcc/armcc_chr1359125009502.htm\" rel=\"nofollow noreferrer\">Basic data types in ARM C and C++</a> arm has a full 8-byte <code>long long</code>, so you are not exceeding the type-size. The problem must be in your code prior to the conversion."}, {"owner": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1526559376, "post_id": 50264212, "comment_id": 87797917, "body": "Could be because arm is 32-bit and pc 64-bit? I will post the code anyway.."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1526574905, "post_id": 50264212, "comment_id": 87808695, "body": "I don&#39;t think so, if you look at the link in my comment, the stm32 has a full-size 8-byte <code>long long</code> which is the same as an x86-64 pc. (that means they just use 2-registers for the 8-byte number -- much like an x86 pc does)"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1526582299, "post_id": 50264212, "comment_id": 87812502, "body": "Ok, let me look into what <code>bDecode_HexString(teste);</code> is -- that&#39;s not a standard C-library function. You should be using <code>long long val = strtoull (teste, NULL, 16);</code> (or you can use an actual <code>endptr</code> parameter instead of <code>NULL</code> so you can validate a conversion occurred). I have a bit of work to do, but I should be back with you in an hour or so."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1526587422, "post_id": 50264212, "comment_id": 87815197, "body": "You can NOT declare <code>uint64_t data = 0;</code> <b>inside</b> <code>bDecode_HexString()</code> and expect to use it <b>outside</b> the function!!! When you declare any variable inside a function, it is declared local to that function within the <i>function stack memory</i>. When the function returns, that memory is destroyed (released for reuse). You invoke <i>Undefined Behavior</i> when you attempt to access a variable that has gone out of scope. (the only caveat, is a function can always return its own <code>type</code>, but <code>data</code> ain&#39;t <code>bool</code>) Change <code>bool bDecode_HexString(char *p, uint64_t *data)</code> and pass a pointer to <code>data</code>."}, {"owner": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1526587794, "post_id": 50264212, "comment_id": 87815403, "body": "i changed the optimization level of compiler to level 0 and strtoull returns the expected value"}, {"owner": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1526587851, "post_id": 50264212, "comment_id": 87815428, "body": "i don&#39;t want to return the data, just process data and put the values in sensor_t struct. So, i think that this isn&#39;t the problem"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1526593129, "post_id": 50264212, "comment_id": 87817537, "body": "Ok then it was an optimization issue -- you will need to chase down why. Something along the way was optimized out or wrong. That I have no clue about the inter-workings of the STM32 compiler optimizations."}, {"owner": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "edited": false, "score": 0, "creation_date": 1526594458, "post_id": 50264212, "comment_id": 87818000, "body": "I don&#39;t know why optimization don&#39;t works right... But thanks for your help!!"}], "tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": true, "score": 2, "last_activity_date": 1525925098, "last_edit_date": 1525925098, "creation_date": 1525915700, "answer_id": 50264212, "question_id": 50263176, "link": "https://stackoverflow.com/questions/50263176/how-to-parse-string-to-struct/50264212#50264212", "title": "How to parse string to struct?", "body": "<p>If you are still struggling with the separation of your input into <code>flags, rate &amp; timestamp</code>, then the suggestions in the comments regarding using an unsigned type to hold your input string converted to a value, and using the exact width types provided in <code>&lt;stdint.h&gt;</code>, will avoid potential problems inherent in manipulating signed types (e.g. potential <em>sign-extension</em>, etc.)</p>\n\n<p>If you want to separate the values and coordinate those in struct, that is 100% fine. The work come in separating the individual <code>flags, rate &amp; timestamp</code>. How you choose to store them so they are convenient within your code is up to you. A simple struct utilizing exact-width type could be:</p>\n\n<pre><code>typedef struct {    /* struct holding sensor data */\n    uint8_t  flags;\n    uint16_t rate;\n    uint32_t tstamp;   \n} sensor_t;\n</code></pre>\n\n<p>In a conversion from <code>char *</code> to <code>uint64_t</code> with <code>strtoull</code>, you have two primary validation checks:</p>\n\n<ol>\n<li><p>utilize both the pointer to the string to convert and the <code>endptr</code> parameter to validate that digits were in fact converted (<code>strtoull</code> sets <code>endptr</code> to point 1-character after the last digit converted). You use this to compare <code>endptr</code> with the original pointer for the data converted to confirm that a conversion took place (if no digits were converted the original pointer and <code>endptr</code> will be the same and the value returned will be zero); and</p></li>\n<li><p>you set <code>errno = 0;</code> before the conversion and then check again after the conversion to insure no error occurred during the conversion itself. If <code>strtoull</code> encounters an error, value exceeds range, etc.., <code>errno</code> is set to a positive value.</p></li>\n<li><p>(and if you have specific range validations, e.g. you want to store the result in a size less than that of the conversion, like <code>uint32_t</code> instead of <code>uint64_t</code>, you need to validate the final value can be stored in the smaller type)</p></li>\n</ol>\n\n<p>A simple approach would be:</p>\n\n<pre><code>    uint64_t data = 0;                  /* exact width type for conversion */\n    ...\n    char *p = argc &gt; 1 ? argv[1] : \"0x5ABBF13A000A01\",  /* input */\n        *endptr = p;                    /* endptr for strtoul validation */\n    errno = 0;          /* reset errno */\n    ...\n    data = strtoull (p, &amp;endptr, 0);    /* convert input to uint64_t */\n\n    if (p == endptr &amp;&amp; data == 0) {     /* validate digits converted */\n        fprintf (stderr, \"error: no digits converted.\\n\");\n        return 1;\n    }\n    if (errno) {    /* validate no error occurred during conversion */\n        fprintf (stderr, \"error: conversion failure.\\n\");\n        return 1;\n    }\n    printf (\"data: 0x%\" PRIx64 \"\\n\\n\", data); /* output conerted string */\n</code></pre>\n\n<p>Finally, separating the value in <code>data</code> into the individual values of <code>flags, rate &amp; timestamp</code>, can be done with simple shifts &amp; ANDS, e.g.</p>\n\n<pre><code>    sensor_t sensor = { .flags = 0 };   /* declare instance of sensor */\n    ...\n    sensor.flags = data &amp; 0xFF;                             /* set flags */\n    sensor.rate = (data &gt;&gt; CHAR_BIT) &amp; 0xFFFF;              /* set rate */\n    sensor.tstamp = (data &gt;&gt; (3 * CHAR_BIT)) &amp; 0xFFFFFFFF;  /* set timestamp */\n\n    /* output sensor struct */\n    printf (\"sensor.flags : 0x%02\" PRIx8 \"\\nsensor.rate  : 0x%04\" PRIx16\n            \"\\nsensor.tstamp: 0x%08\" PRIx32 \"\\n\", sensor.flags, sensor.rate,\n            sensor.tstamp);\n</code></pre>\n\n<p>Putting it altogether, you could do something similar to:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;inttypes.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;limits.h&gt;\n\ntypedef struct {    /* struct holding sensor data */\n    uint8_t  flags;\n    uint16_t rate;\n    uint32_t tstamp;   \n} sensor_t;\n\nint main (int argc, char **argv) {\n\n    uint64_t data = 0;                  /* exact width type for conversion */\n    sensor_t sensor = { .flags = 0 };   /* declare instace of sensor */\n    char *p = argc &gt; 1 ? argv[1] : \"0x5ABBF13A000A01\",  /* input */\n        *endptr = p;                    /* endptr for strtoul validation */\n    errno = 0;          /* reset errno */\n\n    data = strtoull (p, &amp;endptr, 0);    /* convert input to uint64_t */\n\n    if (p == endptr &amp;&amp; data == 0) {     /* validate digits converted */\n        fprintf (stderr, \"error: no digits converted.\\n\");\n        return 1;\n    }\n    if (errno) {    /* validate no error occurred during conversion */\n        fprintf (stderr, \"error: conversion failure.\\n\");\n        return 1;\n    }\n    printf (\"data: 0x%\" PRIx64 \"\\n\\n\", data); /* output conerted string */\n\n    sensor.flags = data &amp; 0xFF;                             /* set flags */\n    sensor.rate = (data &gt;&gt; CHAR_BIT) &amp; 0xFFFF;              /* set rate */\n    sensor.tstamp = (data &gt;&gt; (3 * CHAR_BIT)) &amp; 0xFFFFFFFF;  /* set timestamp */\n\n    /* output sensor struct */\n    printf (\"sensor.flags : 0x%02\" PRIx8 \"\\nsensor.rate  : 0x%04\" PRIx16\n            \"\\nsensor.tstamp: 0x%08\" PRIx32 \"\\n\", sensor.flags, sensor.rate,\n            sensor.tstamp);\n\n    return 0;\n}\n</code></pre>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/struct_sensor_bitwise\ndata: 0x5abbf13a000a01\n\nsensor.flags : 0x01\nsensor.rate  : 0x000a\nsensor.tstamp: 0x5abbf13a\n</code></pre>\n\n<p>Look things over and let me know if you have further questions.</p>\n"}], "owner": {"reputation": 55, "user_id": 7164810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b03848c82bf75ecd767f01708d6842?s=128&d=identicon&r=PG&f=1", "display_name": "R. Rodrigues", "link": "https://stackoverflow.com/users/7164810/r-rodrigues"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1086, "favorite_count": 2, "accepted_answer_id": 50264212, "answer_count": 2, "score": 1, "last_activity_date": 1526582000, "creation_date": 1525906531, "last_edit_date": 1526582000, "question_id": 50263176, "link": "https://stackoverflow.com/questions/50263176/how-to-parse-string-to-struct", "title": "How to parse string to struct?", "body": "<p>I want to know if there is any way to convert a string like <code>\"5ABBF13A000A01\"</code> to the next struct using struct and union method:</p>\n\n<pre><code>struct xSensorData2{\n    unsigned char flags;           \n    unsigned int refresh_rate;\n    unsigned int timestamp;\n};\n</code></pre>\n\n<p>Data should be:</p>\n\n<pre><code>flags = 0x01 (last byte);\nrefresh_rate = 0x000A (two bytes);\ntimestamp = 5ABBF13A (four bytes);\n</code></pre>\n\n<p>I'm thinking in next struct of data:</p>\n\n<pre><code>struct xData{\n    union{\n        struct{\n            unsigned char flags:8;\n            unsigned int refresh_rate:16;\n            unsigned int timestamp:32;\n        };\n        char pcBytes[8];\n    };\n}__attribute__ ((packed));\n</code></pre>\n\n<p>But I got a struct of 12 bytes, I think it's because bit fields don't work for different types of data. I should just convert string to array of hex, copy to <code>pcBytes</code> and have access to each field.</p>\n\n<p>Update:\nIn stm32 platform i used this code:</p>\n\n<pre><code>bool bDecode_HexString(char *p)\n{\nuint64_t data = 0;                  /* exact width type for conversion \n*/\nchar *endptr = p;                   /* endptr for strtoul validation */\nerrno = 0;                                          /* reset errno */\n\ndata = strtoull (p, &amp;endptr, 16);    /* convert input to uint64_t */\n\nif (p == endptr &amp;&amp; data == 0) {     /* validate digits converted */\n    fprintf (stderr, \"error: no digits converted.\\n\");\n    return false;\n}\nif (errno) {    /* validate no error occurred during conversion */\n    fprintf (stderr, \"error: conversion failure.\\n\");\n    return false;\n}\n//printf (\"data: 0x%\" PRIx64 \"\\n\\n\", data); /* output conerted string */\n\nsensor.flags = data &amp; 0xFF;                             /* set flags */\nsensor.rate = (data &gt;&gt; CHAR_BIT) &amp; 0xFFFF;              /* set rate */\nsensor.tstamp = (data &gt;&gt; (3 * CHAR_BIT)) &amp; 0xFFFFFFFF;  /* set timestamp */\n\n    return true;\n\n/* output sensor struct */\n//    printf (\"sensor.flags : 0x%02\" PRIx8 \"\\nsensor.rate  : 0x%04\" PRIx16\n//            \"\\nsensor.tstamp: 0x%08\" PRIx32 \"\\n\", sensor.flags, sensor.rate,\n//            sensor.tstamp);\n}\n</code></pre>\n\n<p>and call the function:</p>\n\n<pre><code>char teste[50] = \"5ABBF13A000A01\";\nbDecode_HexString(teste);\n</code></pre>\n\n<p>I get <code>data = 0x3a000a01005abbf1</code></p>\n"}, {"tags": ["c", "pointers", "struct"], "answers": [{"tags": [], "owner": {"reputation": 763, "user_id": 2351027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06043828fe6c14c215de4b7d7586a332?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/2351027/steve"}, "is_accepted": true, "score": 2, "last_activity_date": 1525906214, "creation_date": 1525906214, "answer_id": 50263127, "question_id": 50263019, "link": "https://stackoverflow.com/questions/50263019/in-c-how-does-a-array-of-struct-look-in-memory/50263127#50263127", "title": "In C how does a array of struct look in memory", "body": "<p>An array is a contiguous block of memory in c, so an array of structs will have a size of <code>sizeof(struct b)*number_of_structs</code>. All of the structs are allocated within the array.</p>\n\n<p>Note that in your example <code>sizeof(struct b)</code> is not guaranteed to be 6 because the compiler is allowed to insert padding to byte align the structs - you can use \"packed\" to avoid this if you like but it may hinder performance. <a href=\"https://stackoverflow.com/questions/4306186/structure-padding-and-packing\">Structure padding and packing</a></p>\n"}], "owner": {"reputation": 399, "user_id": 1246028, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a2a4268dd076f236c418fa82d847953f?s=128&d=identicon&r=PG", "display_name": "Milind", "link": "https://stackoverflow.com/users/1246028/milind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 578, "favorite_count": 0, "closed_date": 1525906509, "accepted_answer_id": 50263127, "answer_count": 1, "score": 0, "last_activity_date": 1525906371, "creation_date": 1525905488, "question_id": 50263019, "link": "https://stackoverflow.com/questions/50263019/in-c-how-does-a-array-of-struct-look-in-memory", "closed_reason": "Duplicate", "title": "In C how does a array of struct look in memory", "body": "<p>I am trying to understand how does a array of structs look like in memory. Suppose I have the following</p>\n\n<pre><code>struct b{\n     int x;\n     int y;\n     int z;\n};\nb barray[100];\n</code></pre>\n\n<p>So now barray is an array of structs where barray is the pointer to the 1st struct i.e. barray=&amp;barray[0]. \nIf int is taking 2 bytes and then say the struct b takes 6 bytes and lets say barray = 1000 and the size of pointer is say 4 bytes. Then is barray+1=1004 or is it 1006? \nI mean is the array an array of pointers each pointing to its instance of the structure or are all the 100 structures placed in a continuous memory location and incrementing the index of the array jumps to the next struct?</p>\n"}, {"tags": ["c", "malloc"], "comments": [{"owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "edited": false, "score": 3, "creation_date": 1525906378, "post_id": 50262919, "comment_id": 87544366, "body": "Another problem in <code>nop</code> is that <code>sizeof *a</code> should be a constraint violation (the expression <code>*a</code> has type <code>void</code>, and <code>void</code> doesn&#39;t have a size).  Some compilers in non-conforming mode will evaluate <code>sizeof (void)</code> to be 1, but it&#39;s just generally a bad idea.  Better to declare <code>a</code> as a pointer to a non-<code>void</code> type."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1526156325, "post_id": 50262919, "comment_id": 87636585, "body": "regarding: <code>printf(&quot;Dereferenced: %p\\n&quot;, *box-&gt;value);</code>  the &#39;%p&#39; is expecting an address. but the &#39;*box-&gt;value&#39; is dereferencing that address to access the actual <code>int</code> value.  So there is a mismatch between the output/format specifier and the parameter"}], "answers": [{"tags": [], "owner": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "is_accepted": false, "score": 2, "last_activity_date": 1525906018, "last_edit_date": 1525906018, "creation_date": 1525905041, "answer_id": 50262966, "question_id": 50262919, "link": "https://stackoverflow.com/questions/50262919/why-does-this-c-function-have-side-effects/50262966#50262966", "title": "Why does this C function have side effects?", "body": "<p>Your program has undefined behavior. <code>box-&gt;value</code> pointer inside <code>main</code> contains indeterminate value. Inside <code>makeBox</code> it used to point to a <em>local</em> variable <code>value</code>, but now <code>makeBox</code> is finished and that local variable is gone for good. Trying to dereference it as <code>*box-&gt;value</code> results in undefined behavior. That is what you observe.</p>\n"}, {"comments": [{"owner": {"reputation": 2613, "user_id": 2899048, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/D0bb9.jpg?s=128&g=1", "display_name": "Chiru", "link": "https://stackoverflow.com/users/2899048/chiru"}, "edited": false, "score": 0, "creation_date": 1525905273, "post_id": 50262985, "comment_id": 87544051, "body": "I was under the impression that using <code>malloc</code> would create the variable on the heap; and I&#39;m only returning a pointer to the heap, so the stack should not be a problem to me. Could you address this (probable) misconception in your answer?"}, {"owner": {"reputation": 9829, "user_id": 108044, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3db0153e155905539ef5b289ea35da12?s=128&d=identicon&r=PG", "display_name": "Gavin H", "link": "https://stackoverflow.com/users/108044/gavin-h"}, "reply_to_user": {"reputation": 2613, "user_id": 2899048, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/D0bb9.jpg?s=128&g=1", "display_name": "Chiru", "link": "https://stackoverflow.com/users/2899048/chiru"}, "edited": false, "score": 1, "creation_date": 1525905436, "post_id": 50262985, "comment_id": 87544106, "body": "Sure. This line <code>int *value = NULL;</code> allocates an <code>int *</code> on the stack. Now, you later end up setting that pointer to point to a block of memory on the heap however the pointer itself is on the stack."}, {"owner": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "reply_to_user": {"reputation": 2613, "user_id": 2899048, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/D0bb9.jpg?s=128&g=1", "display_name": "Chiru", "link": "https://stackoverflow.com/users/2899048/chiru"}, "edited": false, "score": 0, "creation_date": 1525905464, "post_id": 50262985, "comment_id": 87544117, "body": "@Chiru the <code>struct </code>represented by <code>box</code> is on the heap, but <code>value</code> is not on the heap, so <code>&amp;value</code> does not represent the address that exists in the heap. You assigned this temporal address to a member of the <code>box</code> structure."}, {"owner": {"reputation": 2613, "user_id": 2899048, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/D0bb9.jpg?s=128&g=1", "display_name": "Chiru", "link": "https://stackoverflow.com/users/2899048/chiru"}, "edited": false, "score": 0, "creation_date": 1525905632, "post_id": 50262985, "comment_id": 87544167, "body": "What&#39;s the idiomatic C approach here? Could I get <code>value</code> onto the heap by initializing it as <code>int *value = malloc(0)</code>?"}, {"owner": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "reply_to_user": {"reputation": 2613, "user_id": 2899048, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/D0bb9.jpg?s=128&g=1", "display_name": "Chiru", "link": "https://stackoverflow.com/users/2899048/chiru"}, "edited": false, "score": 1, "creation_date": 1525905926, "post_id": 50262985, "comment_id": 87544244, "body": "@Chiru: There&#39;s no &quot;idiomatic approach&quot; until you explain in detail what you are trying to do. Why is <code>box-&gt;value</code> even a pointer? Why is it a <code>**</code> pointer? The question makes no sense without knowing all that."}, {"owner": {"reputation": 2613, "user_id": 2899048, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/D0bb9.jpg?s=128&g=1", "display_name": "Chiru", "link": "https://stackoverflow.com/users/2899048/chiru"}, "reply_to_user": {"reputation": 290304, "user_id": 187690, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/89a4da7af5bf1558b7d2704309f1f118?s=128&d=identicon&r=PG", "display_name": "AnT", "link": "https://stackoverflow.com/users/187690/ant"}, "edited": false, "score": 0, "creation_date": 1525906038, "post_id": 50262985, "comment_id": 87544276, "body": "@AnT <code>makeBox</code> is supposed to initialize the members of a newly created <code>Box</code> struct, and then return a pointer to it. Basically, I don&#39;t want to trust the caller to initialize all the <code>Box</code> members; hence, I want to emulate something similar to a constructor."}, {"owner": {"reputation": 9829, "user_id": 108044, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3db0153e155905539ef5b289ea35da12?s=128&d=identicon&r=PG", "display_name": "Gavin H", "link": "https://stackoverflow.com/users/108044/gavin-h"}, "reply_to_user": {"reputation": 2613, "user_id": 2899048, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/D0bb9.jpg?s=128&g=1", "display_name": "Chiru", "link": "https://stackoverflow.com/users/2899048/chiru"}, "edited": false, "score": 0, "creation_date": 1525906478, "post_id": 50262985, "comment_id": 87544396, "body": "@Chiru doesn&#39;t answer the more pressing question of why <code>value</code> in <code>Box</code> is a <code>int **</code>. While there are valid situations you would need two levels of indirection it could also be incorrect. As is - you could set <code>box-&gt;value = malloc(sizeof(int*))</code>. Keep in mind that <code>*(box-&gt;value)</code> would then be uninitialized as you would have allocated a pointer on the heap, not an integer itself. I would really try and figure out first if you intentionally want to define the structure that way."}], "tags": [], "owner": {"reputation": 9829, "user_id": 108044, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3db0153e155905539ef5b289ea35da12?s=128&d=identicon&r=PG", "display_name": "Gavin H", "link": "https://stackoverflow.com/users/108044/gavin-h"}, "is_accepted": true, "score": 2, "last_activity_date": 1525905189, "creation_date": 1525905189, "answer_id": 50262985, "question_id": 50262919, "link": "https://stackoverflow.com/questions/50262919/why-does-this-c-function-have-side-effects/50262985#50262985", "title": "Why does this C function have side effects?", "body": "<p>Basically the <code>nop()</code> function has \"side effects\" just as a result of using the stack. The problem is in the <code>makeBox()</code> function which is setting a pointer to a stack variable. I added some comments in the snippet:</p>\n\n<pre><code>struct Box *makeBox(void) {\n    // value is an integer pointer on the stack\n    int *value = NULL;\n    struct Box *box = malloc(sizeof *box);\n    // box-&gt;value is set to the address of the stack location of value\n    box-&gt;value = &amp;value;\n    return box;\n}\n</code></pre>\n\n<p>When <code>nop()</code> allocates <code>a</code> on the stack it is essentially stomping on the stack where your other pointer was. This is an example of why you cannot return a pointer to a stack variable as that does not persist outside of the scope of the function in which it is allocated.</p>\n"}, {"tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": false, "score": -1, "last_activity_date": 1526155688, "last_edit_date": 1526155688, "creation_date": 1525964682, "answer_id": 50275997, "question_id": 50262919, "link": "https://stackoverflow.com/questions/50262919/why-does-this-c-function-have-side-effects/50275997#50275997", "title": "Why does this C function have side effects?", "body": "<p>using your posted code (slightly reformated for readability:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nstruct Box\n{\n    int **value;\n};\n\n\nvoid nop(void)\n{\n    /* Why does this function have side effects? */\n    void *a = malloc(sizeof *a);\n    free(a);\n}\n\n\nstruct Box *makeBox(void)\n{\n    int *value = NULL;\n    struct Box *box = malloc(sizeof *box);\n    box-&gt;value = &amp;value;\n    return box;\n}\n\n\nint main(void)\n{\n    struct Box *box = makeBox();\n    printf(\"Dereferenced: %p\\n\", *box-&gt;value);\n    nop();\n    printf(\"Dereferenced: %p\\n\", *box-&gt;value);\n}\n</code></pre>\n\n<p>always enable the warnings when compiling. then fix those warnings.  (for <code>gcc</code>, at a minimum use: </p>\n\n<pre><code>-Wall -Wextra -Wconversion -pedantic -std=gnu11\n</code></pre>\n\n<p>This will result in the compiler outputting several warning messages.</p>\n\n<p>(just because the message says 'warning' rather than 'error' does not mean the warnings can be ignored.</p>\n\n<p>The warnings: </p>\n\n<ol>\n<li><p>:13:29: warning: invalid application of \u2018sizeof\u2019 to a void type [-Wpointer-arith] </p></li>\n<li><p>:30:12: warning: format \u2018%p\u2019 expects argument of type\n\u2018void *\u2019, but argument 2 has type \u2018int *\u2019 [-Wformat=]</p></li>\n<li><p>:32:12: warning: format \u2018%p\u2019 expects argument of type \u2018void *\u2019, but argument 2 has type \u2018int *\u2019 [-Wformat=]</p></li>\n</ol>\n\n<p>EDIT:\nThe <code>makebox()</code> function is returning the address of a local variable.  local variables go out-of-scope when the function exits.  so this is undefined behavior.</p>\n\n<p>The above undefined behavior is a problem when the function: <code>nop()</code> is called. because it is using the same stack area as was used in the 'makebox()` function. </p>\n\n<p>The local variable: <code>void *a</code> is using the same part of the stack as the <code>makebox()</code> function variable <code>value</code>.  </p>\n\n<p>so when the <code>main()</code> function dereferences the field in <code>struct Box, which points to the same area on the stack, and that area has been modified by the later call to</code>nop()`, then the value on the stack, at that area has been changed. </p>\n\n<p>so the calls to <code>printf()</code> will, on the first call, pickup the original value and on the second call will pickup the address returned from the call to <code>malloc()</code></p>\n\n<p>I.E.  modify the code so it does not have any undefined behavior.  This can be done by either changing the <code>struct box</code> so it contains the actual data or move the local variable: <code>value</code> to some 'safe area', such as giving it file scope, perhaps by inserting the modifier <code>static</code> before the variable declaration</p>\n"}], "owner": {"reputation": 2613, "user_id": 2899048, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/D0bb9.jpg?s=128&g=1", "display_name": "Chiru", "link": "https://stackoverflow.com/users/2899048/chiru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 50262985, "answer_count": 3, "score": 0, "last_activity_date": 1526155688, "creation_date": 1525904756, "question_id": 50262919, "link": "https://stackoverflow.com/questions/50262919/why-does-this-c-function-have-side-effects", "title": "Why does this C function have side effects?", "body": "<p>Could someone help me understand what's wrong with this C program?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\nstruct Box {\n    int **value;\n};\nvoid nop(void) {\n    /* Why does this function have side effects? */\n    void *a = malloc(sizeof *a);\n    free(a);\n}\nstruct Box *makeBox(void) {\n    int *value = NULL;\n    struct Box *box = malloc(sizeof *box);\n    box-&gt;value = &amp;value;\n    return box;\n}\nint main(void) {\n    struct Box *box = makeBox();\n    printf(\"Dereferenced: %p\\n\", *box-&gt;value);\n    nop();\n    printf(\"Dereferenced: %p\\n\", *box-&gt;value);\n}\n</code></pre>\n\n<p>If I run it, it prints:</p>\n\n<pre><code>Dereferenced: (nil)\nDereferenced: 0x562831863727\n</code></pre>\n\n<p>However, if I comment out the <code>nop</code> function, I get:</p>\n\n<pre><code>Dereferenced: (nil)\nDereferenced: (nil)\n</code></pre>\n\n<p>Can someone help me understand why calling <code>nop</code> changes <code>*box-&gt;value</code>?</p>\n"}, {"tags": ["c", "multithreading", "concurrency", "pthreads", "mutex"], "comments": [{"owner": {"reputation": 6196, "user_id": 5822075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ba9afcd0c36d9685e3e1b5f2f82be2?s=128&d=identicon&r=PG&f=1", "display_name": "e0k", "link": "https://stackoverflow.com/users/5822075/e0k"}, "edited": false, "score": 0, "creation_date": 1525904645, "post_id": 50262651, "comment_id": 87543854, "body": "I suggest asking <a href=\"https://codereview.stackexchange.com/\">codereview.stackexchange.com</a> since your question seems to be one of best practice, which can be subjective."}, {"owner": {"reputation": 1415, "user_id": 4288486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fceeebcdab5325a9b458c1af8c51111d?s=128&d=identicon&r=PG", "display_name": "Jo&#227;o Neto", "link": "https://stackoverflow.com/users/4288486/jo%c3%a3o-neto"}, "edited": false, "score": 1, "creation_date": 1525913289, "post_id": 50262651, "comment_id": 87545914, "body": "Tip: you can take a look at conditional variables (<code>pthread_cond</code>) to replace your END_THREADS and SYNC_THREADS active-wait mechanism: <a href=\"https://stackoverflow.com/questions/20772476/when-to-use-pthread-conditional-variables\" title=\"when to use pthread conditional variables\">stackoverflow.com/questions/20772476/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 310760, "user_id": 12711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c330bdee507c95c603a93ca91d9145a9?s=128&d=identicon&r=PG", "display_name": "Michael Burr", "link": "https://stackoverflow.com/users/12711/michael-burr"}, "edited": false, "score": 2, "creation_date": 1525914960, "post_id": 50264049, "comment_id": 87546244, "body": "Another very important part of the contract for using condition variables is that the mutex that controls the modification of the predicate (<code>start_threads</code> in the example) <i>must</i> be held while checking the predicate and calling <code>pthread_cond_wait()</code>.  That is why <code>pthread_cond_wait()</code> take a pointer to a mutex - so it can release the mutex at the precisely correct time."}, {"owner": {"reputation": 1415, "user_id": 4288486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fceeebcdab5325a9b458c1af8c51111d?s=128&d=identicon&r=PG", "display_name": "Jo&#227;o Neto", "link": "https://stackoverflow.com/users/4288486/jo%c3%a3o-neto"}, "reply_to_user": {"reputation": 310760, "user_id": 12711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c330bdee507c95c603a93ca91d9145a9?s=128&d=identicon&r=PG", "display_name": "Michael Burr", "link": "https://stackoverflow.com/users/12711/michael-burr"}, "edited": false, "score": 0, "creation_date": 1525915996, "post_id": 50264049, "comment_id": 87546476, "body": "Well-said! Forgot that detail :)"}, {"owner": {"reputation": 120, "user_id": 4698015, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jOVkv.jpg?s=128&g=1", "display_name": "nagimov", "link": "https://stackoverflow.com/users/4698015/nagimov"}, "edited": false, "score": 0, "creation_date": 1526010177, "post_id": 50264049, "comment_id": 87585472, "body": "Thanks! This is awesome! I guess I didn&#39;t do my homework on mutexes thoroughly enough :)"}], "tags": [], "owner": {"reputation": 1415, "user_id": 4288486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fceeebcdab5325a9b458c1af8c51111d?s=128&d=identicon&r=PG", "display_name": "Jo&#227;o Neto", "link": "https://stackoverflow.com/users/4288486/jo%c3%a3o-neto"}, "is_accepted": true, "score": 2, "last_activity_date": 1526046199, "last_edit_date": 1592644375, "creation_date": 1525914068, "answer_id": 50264049, "question_id": 50262651, "link": "https://stackoverflow.com/questions/50262651/synchronization-of-p-threads-using-globals/50264049#50264049", "title": "Synchronization of p_threads using globals", "body": "<p>I didn't realize what was the question :-)</p>\n<p>So, the question is if you're thinking well with your <code>SYNC_THREADS</code> and <code>END_THREADS</code> synchronization mechanism.<br />\n<strong>Yes!... Almost.</strong> The problem is that threads are burning CPU while waiting.</p>\n<h1>Conditional Variables</h1>\n<p>To make threads wait for an event you have conditional variables (<code>pthread_cond</code>). These offer a few useful functions like <code>wait()</code>, <code>signal()</code> and <code>broadcast()</code>:</p>\n<ul>\n<li><code>wait(&amp;cond, &amp;m)</code> blocks a thread in a given condition variable. <strong>[note 2]</strong></li>\n<li><code>signal(&amp;cond)</code> unlocks a thread waiting in a given condition variable.</li>\n<li><code>broadcast(&amp;cond)</code> unlocks all threads waiting in a given condition variable.</li>\n</ul>\n<p>Initially you'd have all the threads waiting <strong>[note 1]</strong>:</p>\n<pre><code>while(!start_threads)\n  pthread_cond_wait(&amp;cond_start);\n</code></pre>\n<p>And, when the main thread is ready:</p>\n<pre><code>start_threads = 1;\npthread_cond_broadcast(&amp;cond_start);\n</code></pre>\n<hr />\n<h1>Barriers</h1>\n<p>If you have data dependencies between iterations, you'd want to make sure threads are executing the same iteration at any given moment.</p>\n<p>To synchronize threads at the end of each iteration, you'll want to take a look at barriers (<code>pthread_barrier</code>):</p>\n<ul>\n<li><code>pthread_barrier_init(count)</code>: initializes a barrier to synchronize <code>count</code> threads.</li>\n<li><code>pthread_barrier_wait()</code>: thread waits here until all <code>count</code> threads reach the barrier.</li>\n</ul>\n<h2>Extending functionality of barriers</h2>\n<p>Sometimes you'll want the last thread reaching a barrier to compute something (e.g. to increment the counter of number of iterations, or to compute some global value, or to check if execution should stop). You have two alternatives</p>\n<h3>Using <code>pthread_barrier</code>s</h3>\n<p>You'll need to essentially have two barriers:</p>\n<pre><code>int rc = pthread_barrier_wait(&amp;b);\nif(rc != 0 &amp;&amp; rc != PTHREAD_BARRIER_SERIAL_THREAD)\n  if(shouldStop()) stop = 1;\npthread_barrier_wait(&amp;b);\nif(stop) return;\n</code></pre>\n<h3>Using <code>pthread_cond</code>s to implement our own specialized barrier</h3>\n<pre><code>pthread_mutex_lock(&amp;mutex)\nremainingThreads--;\n// all threads execute this\nexecutedByAllThreads();\nif(remainingThreads == 0) {\n  // reinitialize barrier\n  remainingThreads = N;\n  // only last thread executes this\n  if(shouldStop()) stop = 1;\n  pthread_cond_broadcast(&amp;cond);\n} else {\nwhile(remainingThreads &gt; 0)\n  pthread_cond_wait(&amp;cond, &amp;mutex);\n}\npthread_mutex_unlock(&amp;mutex);\n</code></pre>\n<hr />\n<p><strong>Note 1:</strong> why is <code>pthread_cond_wait()</code> inside a <code>while</code> block? May seem a bit odd. The reason behind it is due to the existence of spurious wakeups. The function may return even if no <code>signal()</code> or <code>broadcast()</code> was issued. So, just to guarantee correctness, it's usual to have an extra variable to guarantee that if a thread suddenly wakes up before it should, it runs back into the <code>pthread_cond_wait()</code>.</p>\n<p>From the manual:</p>\n<blockquote>\n<p>When  using  condition  variables  there  is  always a Boolean predicate involving shared variables associated with each condition wait that is true if the thread should proceed. Spurious wakeups from the <code>pthread_cond_timedwait()</code> or <code>pthread_cond_wait()</code> functions may occur. Since the return from <code>pthread_cond_timedwait()</code> or <code>pthread_cond_wait()</code> does not imply anything about the value of this predicate, the predicate should be re-evaluated upon such return.</p>\n<p>(...)</p>\n<p>If a signal is delivered to a thread waiting for a condition variable, upon return from the signal handler the thread resumes waiting for the  condition  variable as if it was not interrupted, or it shall return zero due to spurious wakeup.</p>\n</blockquote>\n<p><strong>Note 2:</strong></p>\n<p>An noted by Michael Burr in the comments, you should hold a <em>companion</em> lock whenever you modify the predicate (<code>start_threads</code>) and <code>pthread_cond_wait()</code>. <code>pthread_cond_wait()</code> will release the mutex when called; and re-acquires it when it returns.</p>\n<p>PS: It's a bit late here; sorry if my text is confusing :-)</p>\n"}], "owner": {"reputation": 120, "user_id": 4698015, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jOVkv.jpg?s=128&g=1", "display_name": "nagimov", "link": "https://stackoverflow.com/users/4698015/nagimov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 1, "accepted_answer_id": 50264049, "answer_count": 1, "score": 0, "last_activity_date": 1526046199, "creation_date": 1525903171, "question_id": 50262651, "link": "https://stackoverflow.com/questions/50262651/synchronization-of-p-threads-using-globals", "title": "Synchronization of p_threads using globals", "body": "<p>I'm pretty new to C, so I'm not sure where even to start digging about my problem.\nI'm trying to port python number-crunching algos to C, and since there's no GIL in C (woohoo), I can change whatever I want in memory from threads, for as long as I make sure there are no races.</p>\n\n<p>I did my homework on mutexes, however, I cannot wrap my head around use of mutexes in case of continuously running threads accessing the same array over and over.</p>\n\n<p>I'm using p_threads in order to split the workload on a big array <code>a[N]</code>.\nNumber crunching algorithm on array <code>a[N]</code> is additive, so I'm splitting it using <code>a_diff[N_THREADS][N]</code> array, writing changes to be applied to <code>a[N]</code> array from each thread to <code>a_diff[N_THREADS][N]</code> and then merging them all together after each step.</p>\n\n<p>I need to run the crunching on different versions of array <code>a[N]</code>, so I pass them via global pointer <code>p</code> (in the MWE, there's only one <code>a[N]</code>)</p>\n\n<p>I'm synchronizing threads using another global array <code>SYNC_THREADS[N_THREADS]</code> and make sure threads quit when I need them to by setting <code>END_THREADS</code> global (I know, I'm using too many globals - I don't care, code is ~200 lines). My question is in regard to this synchronization technique - is it safe to do so and what is cleaner/better/faster way to achieve that?</p>\n\n<p>MWEe:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;pthread.h&gt;\n#define N_THREADS 3\n#define N 10000000\n#define STEPS 3\n\ndouble a[N];  // main array\ndouble a_diff[N_THREADS][N];  // diffs array\ndouble params[N];  // parameter used for number-crunching\ndouble (*p)[N];  // pointer to array[N]\n\n// structure for bounds for crunching the array\nstruct bounds {\n    int lo;\n    int hi;\n    int thread_num;\n};\nstruct bounds B[N_THREADS];\nint SYNC_THREADS[N_THREADS];  // for syncing threads\nint END_THREADS = 0;  // signal to terminate threads\n\n\nstatic void *crunching(void *arg) {\n    // multiple threads run number-crunching operations according to assigned low/high bounds\n    struct bounds *data = (struct bounds *)arg;\n    int lo = (*data).lo;\n    int hi = (*data).hi;\n    int thread_num = (*data).thread_num;\n    printf(\"worker %d started for bounds [%d %d] \\n\", thread_num, lo, hi);\n\n    int i;\n\n    while (END_THREADS != 1) {  // END_THREADS tells threads to terminate\n        if (SYNC_THREADS[thread_num] == 1) {  // SYNC_THREADS allows threads to start number-crunching\n            printf(\"worker %d working... \\n\", thread_num );\n            for (i = lo; i &lt;= hi; ++i) {\n                a_diff[thread_num][i] += (*p)[i] * params[i];  // pretend this is an expensive operation...\n            }\n            SYNC_THREADS[thread_num] = 0;  // thread disables itself until SYNC_THREADS is back to 1\n            printf(\"worker %d stopped... \\n\", thread_num );\n        }\n    }\n    return 0;\n}\n\n\nint i, j, th,s;\ndouble joiner;\n\nint main() {\n    // pre-fill arrays\n    for (i = 0; i &lt; N; ++i) {\n        a[i] = i + 0.5;\n        params[i] = 0.0;\n    }\n\n    // split workload between workers\n    int worker_length = N / N_THREADS;\n    for (i = 0; i &lt; N_THREADS; ++i) {\n        B[i].thread_num = i;\n        B[i].lo = i * worker_length;\n        if (i == N_THREADS - 1) {\n            B[i].hi = N;\n        } else {\n            B[i].hi = i * worker_length + worker_length - 1;\n        }\n    }\n    // pointer to parameters to be passed to worker\n    struct bounds **data = malloc(N_THREADS * sizeof(struct bounds*));\n    for (i = 0; i &lt; N_THREADS; i++) {\n        data[i] = malloc(sizeof(struct bounds));\n        data[i]-&gt;lo = B[i].lo;\n        data[i]-&gt;hi = B[i].hi;\n        data[i]-&gt;thread_num = B[i].thread_num;\n    }\n    // create thread objects\n    pthread_t threads[N_THREADS];\n\n    // disallow threads to crunch numbers\n    for (th = 0; th &lt; N_THREADS; ++th) {\n        SYNC_THREADS[th] = 0;\n    }\n\n    // launch workers\n    for(th = 0; th &lt; N_THREADS; th++) {\n        pthread_create(&amp;threads[th], NULL, crunching, data[th]);\n    }\n\n    // big loop of iterations\n    for (s = 0; s &lt; STEPS; ++s) {\n        for (i = 0; i &lt; N; ++i) {\n            params[i] += 1.0;  // adjust parameters\n\n            // zero diff array\n            for (i = 0; i &lt; N; ++i) {\n                for (th = 0; th &lt; N_THREADS; ++th) {\n                    a_diff[th][i] = 0.0;\n                }\n            }\n            p = &amp;a;  // pointer to array a\n            // allow threads to process numbers and wait for threads to complete\n            for (th = 0; th &lt; N_THREADS; ++th) { SYNC_THREADS[th] = 1; }\n            // ...here threads started by pthread_create do calculations...\n            for (th = 0; th &lt; N_THREADS; th++) { while (SYNC_THREADS[th] != 0) {} }\n\n            // join results from threads (number-crunching is additive)\n            for (i = 0; i &lt; N; ++i) {\n                joiner = 0.0;\n                for (th = 0; th &lt; N_THREADS; ++th) {\n                    joiner += a_diff[th][i];\n                }\n                a[i] += joiner;\n            }\n        }\n    }\n\n\n    // join workers\n    END_THREADS = 1;\n    for(th = 0; th &lt; N_THREADS; th++) {\n        pthread_join(threads[th], NULL);\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>I see that workers don't overlap time-wise:</p>\n\n<pre><code>worker 0 started for bounds [0 3333332]\nworker 1 started for bounds [3333333 6666665]\nworker 2 started for bounds [6666666 10000000]\nworker 0 working...\nworker 1 working...\nworker 2 working...\nworker 2 stopped...\nworker 0 stopped...\nworker 1 stopped...\nworker 2 working...\nworker 0 working...\nworker 1 working...\nworker 1 stopped...\nworker 0 stopped...\nworker 2 stopped...\nworker 2 working...\nworker 0 working...\nworker 1 working...\nworker 1 stopped...\nworker 2 stopped...\nworker 0 stopped...\n\nProcess returned 0 (0x0)   execution time : 1.505 s\n</code></pre>\n\n<p>and I make sure worker's don't get into each other workspaces by separating them via <code>a_diff[thead_num][N]</code> sub-arrays, however, I'm not sure that's always the case and that I'm not introducing hidden races somewhere...</p>\n"}, {"tags": ["c++", "c", "memory", "malloc", "free"], "comments": [{"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "edited": false, "score": 0, "creation_date": 1525903569, "post_id": 50262641, "comment_id": 87543463, "body": "Are you making sure that <code>cpih</code> is assigned to <code>_cpih</code> nad <code>cpiw</code> is assigned to <code>_cpiw</code>?"}, {"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "edited": false, "score": 5, "creation_date": 1525903613, "post_id": 50262641, "comment_id": 87543478, "body": "In cases like this, it&#39;s almost impossible to say where things could go wrong without looking at a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 5896, "user_id": 1106415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6fvK.png?s=128&g=1", "display_name": "hlt", "link": "https://stackoverflow.com/users/1106415/hlt"}, "edited": false, "score": 0, "creation_date": 1525903692, "post_id": 50262641, "comment_id": 87543517, "body": "Which line in the code that you show is <code>hn_hog.h:320</code>?"}, {"owner": {"reputation": 846, "user_id": 587820, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/d01afc60749606210ff4929a132befb2?s=128&d=identicon&r=PG&f=1", "display_name": "h.nodehi", "link": "https://stackoverflow.com/users/587820/h-nodehi"}, "reply_to_user": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "edited": false, "score": 0, "creation_date": 1525904377, "post_id": 50262641, "comment_id": 87543780, "body": "@RSahu yes, <code>_cpih</code> and <code>_cpiw</code> always have the updated value. I edited the code."}, {"owner": {"reputation": 846, "user_id": 587820, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/d01afc60749606210ff4929a132befb2?s=128&d=identicon&r=PG&f=1", "display_name": "h.nodehi", "link": "https://stackoverflow.com/users/587820/h-nodehi"}, "reply_to_user": {"reputation": 5896, "user_id": 1106415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6fvK.png?s=128&g=1", "display_name": "hlt", "link": "https://stackoverflow.com/users/1106415/hlt"}, "edited": false, "score": 0, "creation_date": 1525904513, "post_id": 50262641, "comment_id": 87543815, "body": "@hlt This: <code>free(_hist[i][j]);</code>. As I&#39;ve mentioned, error always occurs at this line."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1525906742, "post_id": 50262641, "comment_id": 87544462, "body": "Probably not related: <a href=\"https://stackoverflow.com/questions/228783/what-are-the-rules-about-using-an-underscore-in-a-c-identifier\">Keep an eye on the rules for using underscores in identifiers.</a>"}, {"owner": {"reputation": 159, "user_id": 9448914, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Kyle Huff", "link": "https://stackoverflow.com/users/9448914/kyle-huff"}, "edited": false, "score": 0, "creation_date": 1525907806, "post_id": 50262641, "comment_id": 87544703, "body": "What is the scope of i and j in free_memory?  Could another thread be altering these values?"}, {"owner": {"reputation": 846, "user_id": 587820, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/d01afc60749606210ff4929a132befb2?s=128&d=identicon&r=PG&f=1", "display_name": "h.nodehi", "link": "https://stackoverflow.com/users/587820/h-nodehi"}, "reply_to_user": {"reputation": 159, "user_id": 9448914, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Kyle Huff", "link": "https://stackoverflow.com/users/9448914/kyle-huff"}, "edited": false, "score": 0, "creation_date": 1525908492, "post_id": 50262641, "comment_id": 87544864, "body": "@KyleHuff they are static inside the function (free_memory). No threading at all."}, {"owner": {"reputation": 159, "user_id": 9448914, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Kyle Huff", "link": "https://stackoverflow.com/users/9448914/kyle-huff"}, "edited": false, "score": 1, "creation_date": 1525908958, "post_id": 50262641, "comment_id": 87544958, "body": "Well then I don&#39;t see anything wrong with the code.  I have to guess that the heap is getting corrupted somewhere else."}, {"owner": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "edited": false, "score": 1, "creation_date": 1525910212, "post_id": 50262641, "comment_id": 87545241, "body": "Often mistakes like out-of-bounds memory writes won&#39;t cause errors immediately, only later when you try to allocate or deallocate memory. A tool like valgrind might help find the actual source of such a mistake."}, {"owner": {"reputation": 846, "user_id": 587820, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/d01afc60749606210ff4929a132befb2?s=128&d=identicon&r=PG&f=1", "display_name": "h.nodehi", "link": "https://stackoverflow.com/users/587820/h-nodehi"}, "reply_to_user": {"reputation": 159, "user_id": 9448914, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Kyle Huff", "link": "https://stackoverflow.com/users/9448914/kyle-huff"}, "edited": false, "score": 0, "creation_date": 1525910253, "post_id": 50262641, "comment_id": 87545253, "body": "@KyleHuff and everyone, yes, my code was corrupting the heap."}], "owner": {"reputation": 846, "user_id": 587820, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/d01afc60749606210ff4929a132befb2?s=128&d=identicon&r=PG&f=1", "display_name": "h.nodehi", "link": "https://stackoverflow.com/users/587820/h-nodehi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 273, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1525910516, "creation_date": 1525903111, "last_edit_date": 1525910516, "question_id": 50262641, "link": "https://stackoverflow.com/questions/50262641/c-error-while-trying-to-free-allocated-memory-to-a-3-dimensional-array", "title": "C++: Error while trying to &#39;free&#39; allocated memory to a 3-dimensional array", "body": "<p>In my code, I need to build dynamic multidimensional arrays (matrices). I'm using <code>malloc</code> and <code>free</code> to do this, and yes, I know this is not C++ style. The problem is that I get error on freeing the array <strong>sometimes, randomly, not always</strong>!</p>\n\n<p><strong>Allocation code:</strong></p>\n\n<pre><code>void allocate_memory(const int &amp;cpiw, const int &amp;cpih)\n{\n    if (_hist == nullptr)\n    {\n        _hist = (float ***)malloc(cpih * sizeof(float **));\n        for (int i = 0; i &lt; cpih; ++i)\n        {\n            _hist[i] = (float **)malloc(cpiw * sizeof(float *));\n            for (int j = 0; j &lt; cpiw; ++j)\n            {\n                _hist[i][j] = (float *)malloc(bins * sizeof(float));\n            }\n        }\n    }\n    _cpiw = cpiw;\n    _cpih = cpih;\n}\n</code></pre>\n\n<p><strong>Freeing (deallocation) code:</strong></p>\n\n<pre><code>void free_memory()\n{\n    if (_hist != nullptr)\n    {\n        for (i = 0; i &lt; _cpih; ++i)\n        {\n            for (j = 0; j &lt; _cpiw; ++j)\n            {\n                free(_hist[i][j]);\n            }\n            free(_hist[i]);\n        }\n        free(_hist);\n        _hist = nullptr;\n    }\n}\n</code></pre>\n\n<p>My code frees and reallocates the arrays in a loop with 20 iterations. The strangest thing is that the error always occurs (if occurs) in 3rd iteration, always in 'freeing' code, and always in most inner loop (<code>free(_hist[i][j]);</code>). As I said, error raises randomly, and I get three different errors:</p>\n\n<ol>\n<li>Segmentation fault (core dumped)</li>\n<li>*** Error in `./hog': munmap_chunk(): invalid pointer: 0x... *** Aborted (core dumped)</li>\n<li>*** Error in `./hog': double free or corruption (out): 0x... *** Aborted (core dumped)</li>\n</ol>\n\n<p>I get no error on allocation, <code>malloc</code>s never return <code>nullptr</code>. If I comment out the 'freeing' code, everything goes fine, no error, no overflow, no 'out of memory'. But I know this is not OK, and I must free the array.</p>\n\n<p><strong>Edit:</strong> Call stack on error:</p>\n\n<pre><code>__GI_raise(int sig) (/build/glibc-itYbWN/glibc-2.26/sysdeps/unix/sysv/linux/raise.c:51)\n__GI_abort() (/build/glibc-itYbWN/glibc-2.26/stdlib/abort.c:90)\n__libc_message(enum __libc_message_action action, const char * fmt) (/build/glibc-itYbWN/glibc-2.26/sysdeps/posix/libc_fatal.c:181)\nmalloc_printerr(mstate ar_ptr, void * ptr, const char * str, int action) (/build/glibc-itYbWN/glibc-2.26/malloc/malloc.c:5426)\nmunmap_chunk(mchunkptr p) (/build/glibc-itYbWN/glibc-2.26/malloc/malloc.c:2877)\n__GI___libc_free(void * mem) (/build/glibc-itYbWN/glibc-2.26/malloc/malloc.c:3138)\nhn::hog::free_memory() (/home/.../CProjects/HOG/hn_hog.h:320)\nhn::hog::extractHOG_jpg(const JSAMPROW * image, const int &amp; iw, const int &amp; ih, const int &amp; cw, const int &amp; ch, const int &amp; bw, const int &amp; bh, const int &amp; bins, const int &amp; isunsigned) (/home/.../CProjects/HOG/hn_hog.h:458)\nmain(int argc, char ** argv) (/home/.../CProjects/HOG/main.cpp:168)\n</code></pre>\n\n<p><strong>Edit: Problem solved.</strong> Sorry everyone and moderators. By more and more debugging, finally I found out that somewhere in my code 'out-of-bounds' writes (on negative indices) were occurring. Thanks everyone.</p>\n"}, {"tags": ["c", "merge"], "comments": [{"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 1, "creation_date": 1525902563, "post_id": 50262337, "comment_id": 87543158, "body": "Get in the habit of not using 1-letter variable names.  In merge, change m,n to sizea, sizeb and change i,j,k to indexa, indexb, indexc."}, {"owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "reply_to_user": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 5, "creation_date": 1525902791, "post_id": 50262337, "comment_id": 87543231, "body": "@stark 1-letter variable names aren&#39;t inherently bad. They are bad when they are not descriptive enough. Replacing <code>i</code> and <code>j</code> with <code>indexa</code> and <code>indexb</code> is just as bad if not worse since pretty much everyone understands that <code>i</code>, <code>j</code>, and <code>k</code> are loop iterators."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 2, "creation_date": 1525903302, "post_id": 50262337, "comment_id": 87543386, "body": "Do not use <code>assert()</code> to check for runtime errors.  It is for testing conditions whose falsehood would signal a <i>programming</i> error.  You cannot safely rely on the expression within ever being evaluated (it depends on compilation details)."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1525904061, "post_id": 50262337, "comment_id": 87543660, "body": "Whereas I&#39;m inclined to agree that single-letter variable names are not <i>always</i> bad, there are a lot of them in your code that interfere significantly with understanding what the code does.  It would be a useful exercise to change the names to more meaningful ones, especially those of the function parameters.  To do that, of course, have to study the code to figure out what names would be meaningful, but that&#39;s part of the usefulness of the exercise."}, {"owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "edited": false, "score": 1, "creation_date": 1525904654, "post_id": 50262337, "comment_id": 87543858, "body": "I would recommend changing the <code>key</code> array to something smaller, maybe of size 2 or 4, and seeing what the code does by stepping through it in a debugger, or adding lots of printfs of you don&#39;t know how to use a debugger yet."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525922396, "post_id": 50262337, "comment_id": 87547892, "body": "How do you expect us to reproduce your problem?  Amongst other things, there is no <code>main()</code> function"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525922557, "post_id": 50262337, "comment_id": 87547919, "body": "to avoid problems (of which non-protected header files can cause many problems.)  Always write your headers similar to: <code>#ifndef MERGESORT_H  #define MERGESORT_H  &lt;rest of the header file&gt;  #endif &#47;&#47; MERGESORT_H</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525922744, "post_id": 50262337, "comment_id": 87547953, "body": "when calling any of the heap allocation functions: <code>malloc</code> <code>calloc</code> <code>realloc</code>: 1) those functions are expecting all the parameters to be of type <code>size_t</code>.  Regarding: <code>w = calloc(m, sizeof(int));</code>  the parameter <code>m</code> is declared as an <code>int</code> rather than as a <code>size_t</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525922903, "post_id": 50262337, "comment_id": 87547989, "body": "in the function: <code>mergesort()</code> there is the unused variable <code>y</code> and the unused variable <code>x</code>.  You should either remove them or fix the code so they are properly used.   When compiling, always enable the warnings, then fix those warnings.  ( for <code>gcc</code>, at a minimum use: <code>-Wall -Wextra -Wconversion -pedantic -std=gnu11</code> )"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525922986, "post_id": 50262337, "comment_id": 87548013, "body": "do NOT use <code>assert()</code> to check if the function: <code>calloc</code> was successful, Suggest: `if( !w ) { perror( &quot;calloc failed&quot; );  exit( EXIT_FAILURE ); }"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525923067, "post_id": 50262337, "comment_id": 87548032, "body": "please use a search engine, like <code>google</code> to find a &#39;good&#39; implementation, in C, of the <code>merge-sort</code> algorithm."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525923213, "post_id": 50262337, "comment_id": 87548083, "body": "variable (and parameter) names should indicate <code>content</code> or <code>usage</code> (or better, both).  Names like: a[] b[] c[] m, etc etc are meaningless, even in the current context.  Programs should be written so they inform the reader of what is being done, not to confuse the reader with cryptic/meaningless names"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525923339, "post_id": 50262337, "comment_id": 87548115, "body": "it is a poor programming practice to include header files within header files unless the rest of the header file is using the contents of the included header file."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525923611, "post_id": 50262337, "comment_id": 87548193, "body": "the function: <code>wrt()</code>  is not called from anywhere"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525923765, "post_id": 50262337, "comment_id": 87548237, "body": "for your own piece of mind, do not leave out optional opening/closing braces.   It is way to easy, when debugging or maintaining the code to destroy the execution sequence of the code when the optional braces are not used"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525923852, "post_id": 50262337, "comment_id": 87548263, "body": "since when, is it a requirement that an array in a sort merge operation having to be a power of 2?"}], "answers": [{"tags": [], "owner": {"reputation": 9095, "user_id": 8542346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11b206b49cec657d28a5876f8330780e?s=128&d=identicon&r=PG&f=1", "display_name": "H.S.", "link": "https://stackoverflow.com/users/8542346/h-s"}, "is_accepted": true, "score": 1, "last_activity_date": 1525923692, "last_edit_date": 1525923692, "creation_date": 1525922949, "answer_id": 50265038, "question_id": 50262337, "link": "https://stackoverflow.com/questions/50262337/c-why-is-this-program-printing-two-0s/50265038#50265038", "title": "C - Why is this program printing two 0&#39;s?", "body": "<p>The problem is in this part of code of function <code>mergesort()</code>:</p>\n\n<pre><code>    for (m = 1; m &lt; n; m *= 2)      /*m is a power of 2*/\n    if (n &lt; m){\n        printf(\"ERROR: Array size not a power of 2 - bye!\\n\");\n        exit(1);\n    }\n</code></pre>\n\n<p>This is supposed to check whether the size of the array, to be sort, is having the size in power of <code>2</code> and the size of the array you are passing is <code>13</code> (not the power of <code>2</code>):</p>\n\n<pre><code>int sz, key[] = {67, 55, 8, 0, 4, -5, 37, 7, 4, 2, 9, 1, -1};\n</code></pre>\n\n<p>it should throw error and exit but since the <code>power of 2</code> check is incorrect it proceeds further and <strong>your merge sort code is not capable of sorting an array of uneven size</strong>. Hence, you are getting the incorrect output for the array of uneven size.</p>\n\n<p>In the <code>for</code> loop</p>\n\n<pre><code>for (m = 1; m &lt; n; m *= 2) \n            ^^^^^\n</code></pre>\n\n<p>the loop will iterate till <code>m &lt; n</code> and the in the loop body <code>if</code> condition you are checking </p>\n\n<pre><code>if (n &lt; m){ ....\n</code></pre>\n\n<p>which will never happen because as soon as <code>m &gt; n</code> the loop will exit. </p>\n\n<p>Instead of checking the power of <code>2</code>, I believe you want to check whether the size of the array is <code>even</code> or not.\nTo check whether the size is <em>even</em> or not you can simply do:</p>\n\n<pre><code>   if (n &amp; 1)\n   {\n       printf(\"ERROR: Array size not a multiple of 2 - bye!\\n\");\n       exit(1);\n   }\n</code></pre>\n\n<p>For sorting an array using merge sort, it's not required that the size of the array should be <strong>even</strong>. You can use merge sort to sort an array of <strong>odd</strong> size as well. Check <a href=\"https://stackoverflow.com/questions/40796394/c-merge-sort-of-an-array-with-uneven-number-of-elements\"><strong>this answer</strong></a>.</p>\n"}], "owner": {"reputation": 29, "user_id": 9604882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d194755307f2b9cb4b70319f5b67eb2?s=128&d=identicon&r=PG&f=1", "display_name": "DFT95", "link": "https://stackoverflow.com/users/9604882/dft95"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 50265038, "answer_count": 1, "score": 0, "last_activity_date": 1525923692, "creation_date": 1525901317, "last_edit_date": 1525902159, "question_id": 50262337, "link": "https://stackoverflow.com/questions/50262337/c-why-is-this-program-printing-two-0s", "title": "C - Why is this program printing two 0&#39;s?", "body": "<p>Here is the program. It takes a hardcoded set of integers and sorts them from least to greatest. I copied it from a book and I can't for the life of my decipher how it does what it does so maybe someone can help me understand.</p>\n\n<p><strong>MAIN</strong></p>\n\n<pre><code>/* Test merge() and mergesort(). */\n\n#include \"mergesort.h\"\n\nint main(void) {\n    int sz, key[] = {67, 55, 8, 0, 4, -5, 37, 7, 4, 2, 9, 1, -1};\n\n    sz = sizeof(key) / sizeof(int);\n    printf(\"Before mergesort:\");\n    wrt(key, sz);\n    mergesort(key, sz);\n    printf(\"After mergesort:\");\n    wrt(key, sz);\n    return 0;\n}\n</code></pre>\n\n<p><strong>MERGE.C</strong></p>\n\n<pre><code>/* Merge a[] of size m and b[] of size n into c[]. */\n#include \"mergesort.h\"\nvoid merge(int a[], int b[], int c[], int m, int n)\n{\n    int i = 0, j = 0, k = 0;\n\n    while (i &lt; m &amp;&amp; j &lt; n)\n        if (a[i] &lt; b[j])\n            c[k++] = a[i++];\n        else\n            c[k++] = b[j++];\n    while (i &lt; m)   /* pick up an remainder */\n        c[k++] = a[i++];\n    while (j &lt; n)\n        c[k++] = b[j++];\n}\n</code></pre>\n\n<p><strong>MERGESORT.C</strong></p>\n\n<pre><code>/* Mergesort: Use merge() to sort an array of size n. */\n\n#include \"mergesort.h\"\nvoid mergesort(int key[], int n) // n is 0 to begin with\n{\n    int j,k,m, *w;\n    int x,y;\n\n    for (m = 1; m &lt; n; m *= 2)      /*m is a power of 2*/\n        if (n &lt; m){\n            printf(\"ERROR: Array size not a power of 2 - bye!\\n\");\n            exit(1);\n        }\n\n    w = calloc(m, sizeof(int));     /* allocate workspace */\n    assert(w != NULL);             /* check that calloc() worked */\n    for (k = 1; k &lt; n; k *= 2) {\n        for (j = 0; j &lt; n - k; j += 2 * k)\n            /*\n              Merge two subarrays of key[] into a subarray of w[].\n            */\n            merge(key + j, key + j + k, w + j, k, k); // todo: make the two k's not equal\n        for (j = 0; j &lt; n; ++j)\n            key[j] = w[j];\n    }\n\n\n    free(w);\n}\n</code></pre>\n\n<p><strong>MERGESORT.H</strong></p>\n\n<pre><code>#include &lt;assert.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\nvoid merge(int a[], int b[], int c[], int m, int n);\nvoid mergesort(int key[], int n);\nvoid wrt(int key[] , int sz);\n</code></pre>\n\n<p><strong>WRT.C</strong></p>\n\n<pre><code>#include \"mergesort.h\"\n\nvoid wrt(int key[], int sz)\n{\n    int i;\n\n    for (i = 0; i &lt; sz; ++i)\n        printf(\"%4d%s\", key[i], ((i &lt; sz - 1) ? \"\" : \"\\n\"));\n}\n</code></pre>\n\n<p>When it's printed out, there are two zeroes. How is this happening? I think the secret to this lies in mergesort.c, with the k value. As you can see near the bottom, I commented in \"todo: make the two k's not equal\", this is the simplified solution my teacher offered for me. I also put in the x and y ints which will be the separate k values. But I don't understand, how can I split this one value into two? </p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 3599, "user_id": 2487517, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/cRCpa.jpg?s=128&g=1", "display_name": "Tibrogargan", "link": "https://stackoverflow.com/users/2487517/tibrogargan"}, "edited": false, "score": 0, "creation_date": 1525900574, "post_id": 50262128, "comment_id": 87542445, "body": "I suspect your issue may be related to this line: <code>if ((Input == ConfirmButton || Input == ToUpper(ConfirmButton)))</code>"}, {"owner": {"reputation": 145, "user_id": 9277833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2370dac57aee12261ae08fb777efe8ef?s=128&d=identicon&r=PG&f=1", "display_name": "VallyMan", "link": "https://stackoverflow.com/users/9277833/vallyman"}, "reply_to_user": {"reputation": 3599, "user_id": 2487517, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/cRCpa.jpg?s=128&g=1", "display_name": "Tibrogargan", "link": "https://stackoverflow.com/users/2487517/tibrogargan"}, "edited": false, "score": 0, "creation_date": 1525900620, "post_id": 50262128, "comment_id": 87542466, "body": "That&#39;s what I am thinking actually, remember that, the issue isn&#39;t that the confirm button isn&#39;t working, it is that ONLY the confirm button is properly changing the binding, whilst the others stay the same"}, {"owner": {"reputation": 3599, "user_id": 2487517, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/cRCpa.jpg?s=128&g=1", "display_name": "Tibrogargan", "link": "https://stackoverflow.com/users/2487517/tibrogargan"}, "edited": false, "score": 0, "creation_date": 1525903461, "post_id": 50262128, "comment_id": 87543430, "body": "There issue with only <code>ConfirmButton</code> working is almost certainly in <code>ControlMenu</code>, but since it&#39;s not shown it&#39;s not possible to confirm."}], "answers": [{"comments": [{"owner": {"reputation": 145, "user_id": 9277833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2370dac57aee12261ae08fb777efe8ef?s=128&d=identicon&r=PG&f=1", "display_name": "VallyMan", "link": "https://stackoverflow.com/users/9277833/vallyman"}, "edited": false, "score": 0, "creation_date": 1525901043, "post_id": 50262252, "comment_id": 87542635, "body": "I see, and can I change anything with the parameters as well?"}, {"owner": {"reputation": 4470, "user_id": 1884363, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/DmTLe.jpg?s=128&g=1", "display_name": "sudo", "link": "https://stackoverflow.com/users/1884363/sudo"}, "reply_to_user": {"reputation": 145, "user_id": 9277833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2370dac57aee12261ae08fb777efe8ef?s=128&d=identicon&r=PG&f=1", "display_name": "VallyMan", "link": "https://stackoverflow.com/users/9277833/vallyman"}, "edited": false, "score": 0, "creation_date": 1525901085, "post_id": 50262252, "comment_id": 87542655, "body": "The parameters should work, only the naming isn&#39;t ideal."}, {"owner": {"reputation": 4470, "user_id": 1884363, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/DmTLe.jpg?s=128&g=1", "display_name": "sudo", "link": "https://stackoverflow.com/users/1884363/sudo"}, "reply_to_user": {"reputation": 145, "user_id": 9277833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2370dac57aee12261ae08fb777efe8ef?s=128&d=identicon&r=PG&f=1", "display_name": "VallyMan", "link": "https://stackoverflow.com/users/9277833/vallyman"}, "edited": false, "score": 0, "creation_date": 1525901148, "post_id": 50262252, "comment_id": 87542673, "body": "More importantly, are you set up with a compiler or IDE that shows you the warnings? Otherwise, these bugs are easy to miss."}, {"owner": {"reputation": 145, "user_id": 9277833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2370dac57aee12261ae08fb777efe8ef?s=128&d=identicon&r=PG&f=1", "display_name": "VallyMan", "link": "https://stackoverflow.com/users/9277833/vallyman"}, "edited": false, "score": 0, "creation_date": 1525901177, "post_id": 50262252, "comment_id": 87542690, "body": "I am using Visual Studio, i&#39;m not sure if its the best to use for this case"}, {"owner": {"reputation": 145, "user_id": 9277833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2370dac57aee12261ae08fb777efe8ef?s=128&d=identicon&r=PG&f=1", "display_name": "VallyMan", "link": "https://stackoverflow.com/users/9277833/vallyman"}, "edited": false, "score": 0, "creation_date": 1525901235, "post_id": 50262252, "comment_id": 87542717, "body": "Hmm when I change it to the way you told me to, it gives me a write access violation for each of the cases"}, {"owner": {"reputation": 4470, "user_id": 1884363, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/DmTLe.jpg?s=128&g=1", "display_name": "sudo", "link": "https://stackoverflow.com/users/1884363/sudo"}, "reply_to_user": {"reputation": 145, "user_id": 9277833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2370dac57aee12261ae08fb777efe8ef?s=128&d=identicon&r=PG&f=1", "display_name": "VallyMan", "link": "https://stackoverflow.com/users/9277833/vallyman"}, "edited": false, "score": 0, "creation_date": 1525901235, "post_id": 50262252, "comment_id": 87542718, "body": "I&#39;ve never used it, but I&#39;d expect it to be ok."}, {"owner": {"reputation": 4470, "user_id": 1884363, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/DmTLe.jpg?s=128&g=1", "display_name": "sudo", "link": "https://stackoverflow.com/users/1884363/sudo"}, "reply_to_user": {"reputation": 145, "user_id": 9277833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2370dac57aee12261ae08fb777efe8ef?s=128&d=identicon&r=PG&f=1", "display_name": "VallyMan", "link": "https://stackoverflow.com/users/9277833/vallyman"}, "edited": false, "score": 0, "creation_date": 1525901682, "post_id": 50262252, "comment_id": 87542865, "body": "The code you&#39;ve pasted indicates that those variables are pointers, but the behavior you described suggests they&#39;re <code>char</code>s. There must be a discrepancy somewhere when you made the code example. I&#39;d suggest making your function arguments different from the global variable names for now just to avoid any confusion then go from there. Your <code>char ControlNames[]</code> declaration also should be a warning or error."}, {"owner": {"reputation": 145, "user_id": 9277833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2370dac57aee12261ae08fb777efe8ef?s=128&d=identicon&r=PG&f=1", "display_name": "VallyMan", "link": "https://stackoverflow.com/users/9277833/vallyman"}, "edited": false, "score": 0, "creation_date": 1525902074, "post_id": 50262252, "comment_id": 87542998, "body": "Ok I took your advice, Changed the cases to: *MoveLeftPoint = Input; Changed the Method Parameters To: void ControlsMenu(char *MoveLeftPoint, char *MoveRightPoint, char *MoveUpPoint, char *MoveDownPoint, char *BackButtonPoint, char *ConfirmButtonPoint, char *ShowStatsPoint, char *ShowInventoryPoint, char *ShowLegendPoint, char *ShowControlsPoint) {  Changed the calling to:\tControlsMenu(MoveLeftP, MoveRightP, MoveUpP, MoveDownP, BackButtonP, ConfirmButtonP, ShowStatsP, ShowInventoryP, ShowLegendP, ShowControlsP);"}, {"owner": {"reputation": 145, "user_id": 9277833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2370dac57aee12261ae08fb777efe8ef?s=128&d=identicon&r=PG&f=1", "display_name": "VallyMan", "link": "https://stackoverflow.com/users/9277833/vallyman"}, "edited": false, "score": 0, "creation_date": 1525902170, "post_id": 50262252, "comment_id": 87543024, "body": "It ALMOST works perfectly, but it is now showing the wrong characters in the display"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1525902767, "post_id": 50262252, "comment_id": 87543219, "body": "Your functions with 10s 9f arguments are ridiculous.  Create the data structure as pass the  pointer to it"}], "tags": [], "owner": {"reputation": 4470, "user_id": 1884363, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/DmTLe.jpg?s=128&g=1", "display_name": "sudo", "link": "https://stackoverflow.com/users/1884363/sudo"}, "is_accepted": false, "score": 0, "last_activity_date": 1525901044, "last_edit_date": 1525901044, "creation_date": 1525900925, "answer_id": 50262252, "question_id": 50262128, "link": "https://stackoverflow.com/questions/50262128/c-changing-characters-with-pointers/50262252#50262252", "title": "C - Changing Characters With Pointers", "body": "<p>Not sure what's going on with <code>ConfirmButton</code>, but I see an issue with the stuff in your switch statement. Looking at <code>MoveLeft = Input;</code> as an example.\n<code>MoveLeft</code> is a <code>char*</code> in your function (i.e. a memory address), but <code>Input</code> is a <code>char</code> (i.e. an ASCII value). To assign <code>Input</code> to the memory pointed to by <code>MoveLeft</code>, you need to do <code>*MoveLeft = Input</code>. Your compiler should have given you a warning about incompatible assignment there. And similarly for the rest.</p>\n\n<p>By the way, the convention for C variable names is to use lower-case with underscores, or some people do camel-cased with first letter lower. And it's confusing to give all the function params the same names as some global variables.</p>\n"}], "owner": {"reputation": 145, "user_id": 9277833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2370dac57aee12261ae08fb777efe8ef?s=128&d=identicon&r=PG&f=1", "display_name": "VallyMan", "link": "https://stackoverflow.com/users/9277833/vallyman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525901044, "creation_date": 1525900307, "question_id": 50262128, "link": "https://stackoverflow.com/questions/50262128/c-changing-characters-with-pointers", "title": "C - Changing Characters With Pointers", "body": "<p>I am trying to make a game and I am currently making rebindable controls.</p>\n\n<p>These are the variables, with assigned pointers</p>\n\n<pre><code>//Controls\nchar MoveLeft = 'a';\nchar MoveRight = 'd';\nchar MoveUp = 'w';\nchar MoveDown = 's';\nchar BackButton = 't';\nchar ConfirmButton = 'y';\nchar ShowStats = 'u';\nchar ShowInventory = 'i';\nchar ShowLegend = 'o';\nchar ShowControls = 'p';\n\n//Pointers\nchar *MoveLeftP = &amp;MoveLeft;\nchar *MoveRightP = &amp;MoveRight;\nchar *MoveUpP = &amp;MoveUp;\nchar *MoveDownP = &amp;MoveDown;\nchar *BackButtonP = &amp;BackButton;\nchar *ConfirmButtonP = &amp;ConfirmButton;\nchar *ShowStatsP = &amp;ShowStats;\nchar *ShowInventoryP = &amp;ShowInventory;\nchar *ShowLegendP = &amp;ShowLegend;\nchar *ShowControlsP = &amp;ShowControls;\n</code></pre>\n\n<p>This is my control methods menu function</p>\n\n<pre><code>void ControlsMenu(char *MoveLeft, char *MoveRight, char *MoveUp, char *MoveDown, char *BackButton, char *ConfirmButton, char *ShowStats, char *ShowInventory, char *ShowLegend, char *ShowControls) {\n//Input\nchar Input = '0';\n\n//Menu Variables\nchar ControlNames[] = {MoveLeft,MoveRight,MoveUp,MoveDown,BackButton,ConfirmButton,ShowStats,ShowInventory,ShowLegend,ShowControls};\nchar *MainMenuNames[] = { \"- Move Left\", \"- Move Right\",\"- Move Up\",\"- Move Down\",\"- Back\",\"- Confirm\",\"- Show Stats\",\"- Show Inventory\",\"- Show Legend\",\" - Show Controls\"};\nint MenuChosen = 0;\nint *MenuPointer = 0;\nMenuPointer = &amp;MenuChosen;\nint MinArray = 0;\nint MaxArray = 8;\nint *ControlPointer = 0;\n\n//Main Loop\ndo {\n    //Loop\n    system(\"cls\");\n    for (int i = 0; i &lt; 9; i++) {\n        printf(\"%c\", ToUpper(ControlNames[i]));\n        ShowMenu(MainMenuNames, i, MenuChosen);\n    }\n\n    Input = getch();\n\n    ControlMenu(Input, MenuChosen, MenuPointer, MinArray, MaxArray);\n\n    if ((Input == ConfirmButton || Input == ToUpper(ConfirmButton))) {\n        system(\"cls\");\n        printf(\"Chaning key binding for %s\\n\", MainMenuNames[MenuChosen]);\n        printf(\"Old Binding: %c\\n\", ToUpper(ControlNames[MenuChosen]));\n        printf(\"Press the key you want to bind\");\n        printf(\"%d\", MenuChosen);\n        Input = getch();\n        ControlNames[MenuChosen] = Input;\n        //Commit Controls\n\n        switch (MenuChosen) {\n        case 0: \n            MoveLeft = Input;\n            break;\n        case 1: \n            MoveRight = Input;\n            break;\n        case 2: \n            MoveUp = Input;\n            break;\n        case 3: \n            MoveDown = Input;\n            break;\n        case 4: \n            BackButton = Input;\n            break;\n        case 5: \n            ConfirmButton = Input;\n            break;\n        case 6: \n            ShowStats = Input;\n            break;\n        case 7: \n            ShowInventory = Input;\n            break;\n        case 8: \n            ShowLegend = Input;\n            break;\n        case 9: \n            ShowControls = Input;\n            break;\n        }\n\n\n    }\n} while (1);\n}\n</code></pre>\n\n<p>And this is how it is called</p>\n\n<pre><code>    ControlsMenu(*MoveLeftP,*MoveRightP,*MoveUpP,*MoveDownP,*BackButtonP,*ConfirmButtonP,*ShowStatsP,*ShowInventoryP,*ShowLegendP,*ShowControlsP);\n</code></pre>\n\n<p>Now here is the issue, for some odd reason, the text of the character does change but the actual binding stays the same. The only binding that I can successfully change is the ConfirmButton binding, no matter what I change it to, it works, but anything else like MoveUp or MoveDown doesn't change the actual binding, but only the text shown.</p>\n"}, {"tags": ["c", "pointers"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 2, "creation_date": 1525900152, "post_id": 50262076, "comment_id": 87542270, "body": "<code>words</code> is locally scoped.  Once it leaves scope, that data is garbage.  You need to allocate it on the heap with <code>malloc</code> if you want the data to survive leaving scope."}, {"owner": {"reputation": 25, "user_id": 9646443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d13b7bd14e05fdff061070cffd6f6a47?s=128&d=identicon&r=PG&f=1", "display_name": "HQ189", "link": "https://stackoverflow.com/users/9646443/hq189"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1525900536, "post_id": 50262076, "comment_id": 87542435, "body": "so do you mean like words = malloc(sizeof(char))? Thanks for the fast answer"}, {"owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 2, "creation_date": 1525900546, "post_id": 50262076, "comment_id": 87542440, "body": "@ChristianGibbons: Or, they need to pass the target buffer as an argument to the function."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1525900773, "post_id": 50262076, "comment_id": 87542532, "body": "@HQ189 you would want the argument to malloc to be be the size of the buffer.  In your given example you have an array of 20 chars, so you&#39;d similarly want to tell malloc that your buffer will hold 20 chars: <code>malloc(20 * sizeof(char))</code> (note that <code>sizeof(char)</code> is redundant as a char is always 1 byte)."}, {"owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "edited": false, "score": 0, "creation_date": 1525900951, "post_id": 50262076, "comment_id": 87542594, "body": "Wait, you want to read and store an <i>array</i> of words?  Because right now you&#39;re only storing a single word (the last word read from the stream).  If your file contains 3 words and you want to save all 3 of them, then you&#39;ll need to create an array <i>of arrays</i> of <code>char</code>."}, {"owner": {"reputation": 25, "user_id": 9646443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d13b7bd14e05fdff061070cffd6f6a47?s=128&d=identicon&r=PG&f=1", "display_name": "HQ189", "link": "https://stackoverflow.com/users/9646443/hq189"}, "reply_to_user": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "edited": false, "score": 0, "creation_date": 1525901155, "post_id": 50262076, "comment_id": 87542681, "body": "@JohnBode not exactly store, after that i want to write those choosen words in a new file"}], "owner": {"reputation": 25, "user_id": 9646443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d13b7bd14e05fdff061070cffd6f6a47?s=128&d=identicon&r=PG&f=1", "display_name": "HQ189", "link": "https://stackoverflow.com/users/9646443/hq189"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "closed_date": 1525900521, "answer_count": 0, "score": 0, "last_activity_date": 1525903583, "creation_date": 1525900086, "last_edit_date": 1525903583, "question_id": 50262076, "link": "https://stackoverflow.com/questions/50262076/function-returns-only-address-and-not-character", "closed_reason": "Duplicate", "title": "Function returns only address and not character", "body": "<p>I'm not so talented with pointers. My function returns only the address and not the word itself.</p>\n\n<pre><code> char* randstring(){\n  char words[20];\n  FILE *fp;\n  int i = 0, j =0, ran = 0;\n  srand(time(NULL));\n  fp = fopen(\"text.txt\", \"r\");\n\n  //get size of the file\n  for(; fgets(words , sizeof(words), fp); j++);\n\n  ran = rand() % 10;\n  rewind(fp);\n  for( i = ran; i &lt; j ; i++){\n    fgets(words, sizeof(words), fp);\n  }\n  return words;\n}\n</code></pre>\n\n<p>The goal of this function is to return a list of words from a text file, after that, I write in a File.\nWhere exactly is the error with my pointer?</p>\n"}, {"tags": ["c", "linux", "bash"], "comments": [{"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 1, "creation_date": 1525900092, "post_id": 50262044, "comment_id": 87542246, "body": "Pass one argument other than the program&#39;s name on the command line. That&#39;s all there is to it. The program&#39;s name becomes <code>argv[0]</code> (by default), the other argument becomes <code>argv[1]</code>, and because there are two of them, argc is 2."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1525900183, "post_id": 50262044, "comment_id": 87542285, "body": "Could you <a href=\"https://stackoverflow.com/posts/50262044/edit\">edit</a> the question to show the invocation you&#39;re using, which you <i>expect</i> to have this effect but does not have it in practice?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1525900239, "post_id": 50262044, "comment_id": 87542308, "body": "About the code comment <code>&#47;* turi mesti close klaida *&#47;</code> (must throw a close mistake). C does not throw/catch mistakes. They either break the code immediately, or later, or you detect them yourself from the return value of functions you call, before executing more code."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1525900341, "post_id": 50262044, "comment_id": 87542356, "body": "@WeatherVane I think he&#39;s referring to the <code>perror(&quot;close() failed&quot;);</code> in the function."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1525900421, "post_id": 50262044, "comment_id": 87542389, "body": "You run the program as <code>.&#47;programname filename</code>. That will set <code>argv[1]</code> to <code>&quot;filename&quot;</code>"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1525900482, "post_id": 50262044, "comment_id": 87542414, "body": "@Barmar, ...was I not clear enough in trying to communicate the same thing in the very first comment on the question?"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1525900577, "post_id": 50262044, "comment_id": 87542446, "body": "BTW, &quot;test&quot; is not a particularly good name to use for a program, since it&#39;s also the name of a shell-builtin command."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1525900760, "post_id": 50262044, "comment_id": 87542528, "body": "@CharlesDuffy I&#39;m just helping you understand what he meant by &quot;must throw a close mistake&quot;. The comment is just saying that he expects that second call to trigger the perror."}], "answers": [{"tags": [], "owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "is_accepted": true, "score": 0, "last_activity_date": 1525900448, "creation_date": 1525900448, "answer_id": 50262154, "question_id": 50262044, "link": "https://stackoverflow.com/questions/50262044/running-program-in-bash-with-chosen-main-arguments/50262154#50262154", "title": "running program in bash with chosen main() arguments", "body": "<p><code>argc</code> is set to the number of arguments your program is invoked with, <em>including <code>argv[0]</code></em> (which is by default set to the name of the program itself).</p>\n\n<p>Thus, if you run:</p>\n\n<pre><code>./yourprogram \"some argument\"\n</code></pre>\n\n<p><code>argc</code> will be 2, because <code>yourprogram</code> is one argument (<code>argv[0]</code>) and <code>some argument</code> is another (<code>argv[1]</code>).</p>\n"}], "owner": {"reputation": 19, "user_id": 7009173, "user_type": "registered", "profile_image": "https://graph.facebook.com/1411359138892887/picture?type=large", "display_name": "Edvinas Deksnys", "link": "https://stackoverflow.com/users/7009173/edvinas-deksnys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "closed_date": 1525939079, "accepted_answer_id": 50262154, "answer_count": 1, "score": 0, "last_activity_date": 1525900477, "creation_date": 1525899966, "last_edit_date": 1525900477, "question_id": 50262044, "link": "https://stackoverflow.com/questions/50262044/running-program-in-bash-with-chosen-main-arguments", "closed_reason": "Duplicate", "title": "running program in bash with chosen main() arguments", "body": "<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;unistd.h&gt;\nint kp_test_open(const char *name);\nint kp_test_close(int fd);\n\nint kp_test_open(const char *name){\n   int dskr;\n   dskr = open( name, O_RDONLY );\n   if( dskr == -1 ){\n      perror( name );\n      exit(1);\n   }\n   printf( \"dskr = %d\\n\", dskr );\n   return dskr;\n}\n\nint kp_test_close(int fd){\n   int rv;\n   rv = close( fd );\n   if( rv != 0 ) perror ( \"close() failed\" );\n   else puts( \"closed\" );\n   return rv;\n}\n\nint main( int argc, char *argv[] ){\n   int d;\n   if( argc != 2 ){\n      printf( \"Naudojimas:\\n %s failas_ar_katalogas\\n\", argv[0] );\n      exit( 255 );\n   }\n   d = kp_test_open( argv[1] );\n   kp_test_close( d );\n   kp_test_close( d ); /* turi mesti close klaida */\n   return 0;\n}\n</code></pre>\n\n<p>so i have program written in C called test and i want to run it in bash so that </p>\n\n<pre><code> d = kp_test_open( argv[1] );\n   kp_test_close( d );\n   kp_test_close( d ); \n</code></pre>\n\n<p>these 3 lines would be activated, i have to somehow change argc value to 2, can i somehow do it in bash?</p>\n\n<p>When i run my compiled script i use </p>\n\n<pre><code>./test\n</code></pre>\n\n<p>and now i get these results </p>\n\n<pre><code>Naudojimas:\n./test failas_ar_katalogas\n</code></pre>\n"}, {"tags": ["c", "dynamic-memory-allocation"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1525899429, "post_id": 50261777, "comment_id": 87541965, "body": "Aside: <code>char spaces</code> ==&gt; <code>int spaces</code> please look at the return type of the functions you use. Otherwise: a wall of code. <code>char lines</code> is another culprit."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1525899732, "post_id": 50261777, "comment_id": 87542099, "body": "Mystified by <code>ctrSpaces ++; if (ctrSpaces == EOF) { ... )</code>"}, {"owner": {"reputation": 3, "user_id": 9767333, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-atT8NFzSqoQ/AAAAAAAAAAI/AAAAAAAAABk/1P7P2OMPM48/photo.jpg?sz=128", "display_name": "Hadrian Hu", "link": "https://stackoverflow.com/users/9767333/hadrian-hu"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1525904354, "post_id": 50261777, "comment_id": 87543773, "body": "@WeatherVane: <code>ctrSpaces ++</code> is used to count spaces in the file being read."}, {"owner": {"reputation": 13530, "user_id": 593382, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f7326fd554e09edf21ca727d6854e22e?s=128&d=identicon&r=PG", "display_name": "Grady Player", "link": "https://stackoverflow.com/users/593382/grady-player"}, "edited": false, "score": 0, "creation_date": 1525905215, "post_id": 50261777, "comment_id": 87544036, "body": "and when would it equal EOF ? when it happens to equal EOF (usually -1)"}, {"owner": {"reputation": 3, "user_id": 9767333, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-atT8NFzSqoQ/AAAAAAAAAAI/AAAAAAAAABk/1P7P2OMPM48/photo.jpg?sz=128", "display_name": "Hadrian Hu", "link": "https://stackoverflow.com/users/9767333/hadrian-hu"}, "reply_to_user": {"reputation": 13530, "user_id": 593382, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f7326fd554e09edf21ca727d6854e22e?s=128&d=identicon&r=PG", "display_name": "Grady Player", "link": "https://stackoverflow.com/users/593382/grady-player"}, "edited": false, "score": 0, "creation_date": 1525906420, "post_id": 50261777, "comment_id": 87544377, "body": "@GradyPlayer: Sorry that was a typo. I meant <code>spaces</code>, not <code>ctrSpaces.</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525924933, "post_id": 50261777, "comment_id": 87548552, "body": "the posted code causes the compiler to output a long string of warning messages.  When compiling, always enable the warnings, then fix those warnings.  ( for <code>gcc</code>, at a minimum use: <code>-Wall -Wextra -Wconversion -pedantic -std=gnu11</code> )  Note: other compilers will use different parameters to obtain the same effect."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525925123, "post_id": 50261777, "comment_id": 87548603, "body": "when calling any of the heap allocation functions: <code>malloc</code> <code>calloc</code> <code>realloc</code> 1) always check (!=NULL) the returned value to assure the operation was successful.  If not successful, call <code>perror()</code> to output your error message and the text of why the OS thinks the error occurred to <code>stderr</code>.  2) the returned type is <code>void*</code> which can be assigned to any pointer.  Casting just clutters the code, making it more difficult to understand, debug, etc"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525925283, "post_id": 50261777, "comment_id": 87548643, "body": "for ease of readability and understanding: 1) follow the axiom: <i>only one statement per line and (at most) one variable declaration per statement.</i>  2) consistently indent the code.  Indent after every opening brace &#39;{&#39;.  Unindent before every closing brace &#39;}&#39;.  Suggest each indent level be 4 spaces."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525925409, "post_id": 50261777, "comment_id": 87548671, "body": "regarding: <code>printf (&quot;\\nSorry, not enough memory!\\n\\n&quot;);         exit (0);</code>  1) error messages should be output to <code>stderr</code>, not <code>stdout</code> and when the error is from a C library function, also output the text reason the OS thinks the error occurred. (function: <code>perror()</code> handles this very nicely.)  in general, a returned value of 0 indicates success,  Suggest using: <code>EXIT_FAILURE</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525925616, "post_id": 50261777, "comment_id": 87548718, "body": "Once the code block beginning with: ` for (lines = fgetc (ptrOut); lines != EOF; lines == fgetc (ptrOut))` exits, then the &#39;file pointer&#39; will be at the end of the file and EOF will be active.  So the code block beginning with: <code>for (spaces = fgetc (ptrOut); spaces != EOF; spaces = fgetc(ptrOut))</code> will never be executed"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525925759, "post_id": 50261777, "comment_id": 87548746, "body": "when calling: <code>fopen()</code>, always check (!=NULL) the returned value to assure the operation was successful."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525925928, "post_id": 50261777, "comment_id": 87548776, "body": "when calling any of the <code>scanf()</code> family of functions: 1) always check the returned value (not the parameter values) to assure the operation was successful.  2) when using the input/format specifiers &#39;%s&#39; and/or &#39;%[...]&#39;, always include a MAX FIELD WIDTH modifier that is 1 less than the length of the input buffer because those specifiers always append a NUL byte to the input.  This also avoids any possibility of a buffer overflow and resulting undefined behavior"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525926026, "post_id": 50261777, "comment_id": 87548792, "body": "regarding: <code>char spaces; char lines;</code>  the returned value from: <code>fgetc()</code> is an integer and EOF is an integer. so those statements should be: `int spaces; int lines;"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525926377, "post_id": 50261777, "comment_id": 87548890, "body": "regarding: <code>if (spaces == &#39;\\n&#39;)     {         ctrSpaces ++;         if (spaces == EOF)</code>  there is no way that &#39;spaces&#39; can be equal to &#39; &#39; AND equal to EOF at the same time"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525926563, "post_id": 50261777, "comment_id": 87548940, "body": "the code sequence starting with: <code>matrixOut = ,,, malloc( ... )</code> and ending with: <code>free(matrixOut);</code>  does absolutely nothing and can be completely eliminated"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525926747, "post_id": 50261777, "comment_id": 87548985, "body": "regarding: <code>fclose (ptrOut);  &#47;&#47;reopen the file and get the information from the file  ptrOut = fopen (outFileName, &quot;r&quot;);</code>  the code could simply say: <code>rewind( ptrOut );</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525926943, "post_id": 50261777, "comment_id": 87549039, "body": "regarding: <code>goto FILE_NAME;</code>  The <code>goto()</code> statement is rarely ever a good idea.  Strongly suggest implementing a loop to get a usable file name.  (and you might want to learn about <code>stat()</code>"}, {"owner": {"reputation": 3, "user_id": 9767333, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-atT8NFzSqoQ/AAAAAAAAAAI/AAAAAAAAABk/1P7P2OMPM48/photo.jpg?sz=128", "display_name": "Hadrian Hu", "link": "https://stackoverflow.com/users/9767333/hadrian-hu"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525984409, "post_id": 50261777, "comment_id": 87578738, "body": "@user3629249: Thanks. I was able to solve the problem. Just a matter of reopening the file after the first iteration of countlng lines."}], "answers": [{"tags": [], "owner": {"reputation": 3, "user_id": 9767333, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-atT8NFzSqoQ/AAAAAAAAAAI/AAAAAAAAABk/1P7P2OMPM48/photo.jpg?sz=128", "display_name": "Hadrian Hu", "link": "https://stackoverflow.com/users/9767333/hadrian-hu"}, "is_accepted": true, "score": 0, "last_activity_date": 1525982885, "creation_date": 1525982885, "answer_id": 50280790, "question_id": 50261777, "link": "https://stackoverflow.com/questions/50261777/c-reading-lines-and-spaces-from-a-file-using-dynamic-allocation/50280790#50280790", "title": "C reading lines and spaces from a file using dynamic allocation", "body": "<p>I finally did thanks to user3629249. I just had to separate the two operations of reading line number and reading row numbers. For row numbers, I had to subtract 1 from the total row count since it adds in an extra <code>\\0</code>after <code>EOL</code>. </p>\n\n<p>Here is my final code (along with the functions that I did not mention originally to print out the major and \"minor\" diagonals of a square matrix. </p>\n\n<pre><code> //preprocessors\n\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;math.h&gt;\n\n//macros\n\n#define STRING_MAX 50\n\n//function prototypes\n\nvoid printMajorDiagonal (double ** m, int r, int c);\nvoid printMinorDiagonal (double ** m, int r, int c);\n\nint main (int argc, char * argv [ ])\n{\nFILE * ptrIn;\nFILE * ptrOut;\n\nchar inFileName [STRING_MAX];\nchar outFileName [STRING_MAX];\n\nint row;\nint col;\n\nint r;\nint c_temp;\nint c;\n\nchar spaces;\nchar lines;\nchar ch;\n\nint i, j, k;\n\nint ctrSpaces = 0;\nint ctrLines = 0;\nint ctrH = 0;\nint ctrV = 0;\nint charCount = 0;\nint lineCount = 0;\n\ndouble matrixVals;\ndouble ** matrixIn;\ndouble ** matrixOut;\n\n//get a file name first\n\nprintf (\"\\nEnter a file name &gt;&gt; \");\nscanf (\"%s\", inFileName);\n\n//open the file\n\nptrIn = fopen (inFileName, \"w\");\n\n//get matrix dimensions\n\nprintf (\"\\nEnter the row and column sizes &gt;&gt; \");\nscanf (\"%d\", &amp;row);\nscanf (\"%d\", &amp;col);\nprintf (\"\\nRows &gt;&gt; %d\\nCols &gt;&gt; %d\\n\\n\", row, col);\n\nmatrixIn = (double **) malloc (row * sizeof (double *));\nif (matrixIn == NULL)\n{\n    printf (\"\\nSORRY, NOT ENOUGH MEMORY!\\n\\n\");\n    exit (0);\n}\nfor (i = 0; i &lt; row; i ++ )\n{\n    matrixIn [i] = (double *) malloc (col * sizeof (double));\n    if (matrixIn [i] == NULL)\n    {\n        printf (\"\\nSORRY, NOT ENOUGH MEMORY!\\n\\n\");\n        exit (0);\n    }\n}\n\n//input the values into the matrix\n\nprintf (\"\\nEnter the values into the matrix &gt;&gt; \\n\\n\");\n\nfor (i = 0; i &lt; row; i ++)\n{\n    for (j = 0; j &lt; col; j ++)\n    {\n        printf (\"\\n\\nEnter [%d][%d] of [%d][%d] &gt;&gt; \", (i + 1), (j + 1), row, col);\n        scanf (\"%lf\", &amp;matrixIn [i] [j]);\n    }\n}\n\n//print out the matrix\n\nprintf (\"\\nElements in the matrix &gt;&gt; \\n\\n\");\nfor (i = 0; i &lt; row; i ++)\n{\n    for (j = 0; j &lt; col; j ++)\n    {\n        printf (\"%.3lf\\t\", matrixIn [i][j]);\n        fprintf (ptrIn, \"%.3lf\\t\", matrixIn [i][j]);\n    }\n    printf (\"\\n\");\n    fprintf (ptrIn, \"\\n\");\n}\nprintf (\"\\n\");\nfprintf (ptrIn, \"\\n\");\n\nfor (i = 0; i &lt; row; i ++)\n{\n    free (matrixIn [i]);\n}\nfree (matrixIn);\n\nfclose (ptrIn);\n\nprintf (\"\\n-----------------------------------------------------------------------------------------------------------------\\n\\n\");\n\n/**------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/\n\n//now retrieve the file by first getting user input for file name and check that the file exists\n\nFILE_CHECK:\n\nprintf (\"\\nEnter the name of file to access &gt;&gt; \" );\nscanf (\"%s\", outFileName);\nprintf (\"\\nThe name of the file is &gt;&gt; %s\\n\\n\", outFileName);\n\n//now open the file\n\nptrOut = fopen (outFileName, \"r\");\nif (ptrOut == NULL)\n{\n    printf (\"Sorry, the file does not exist. Re-enter another file-name.\\n\\n\");\n    goto FILE_CHECK;\n}\n\n//read lines first - total number of lines == total number of rows\n\nfor (lines = getc (ptrOut); lines != EOF; lines = getc (ptrOut))\n{\n    if (lines == '\\n')\n    {\n        ctrLines ++ ;\n    }\n}\n\nr = ctrLines - 1;\n\nmatrixOut = (double **) malloc (r * sizeof (double *));\nif (matrixOut == NULL)\n{\n    printf (\"\\nSorry, not enough memory!\\n\\n\");\n    exit (0);\n}\n\nfree (matrixOut);\n\nprintf (\"\\nRows &gt;&gt; %d\\n\\n\", r);\n\n/*******************************************************************************************************************************************/\n\n//open the file again to count columns\n\nptrOut = fopen (outFileName, \"r\");\n\nfor (spaces = getc (ptrOut); spaces != EOF; spaces = getc (ptrOut))\n{\n    if (spaces == ' ' || spaces == '\\t' || spaces == '\\b')\n    {\n        ctrSpaces ++ ;\n    }\n}\n\nc_temp = ctrSpaces;\n\nc = c_temp / r;\n\nprintf (\"\\nCols &gt;&gt; %d\\n\\n\", c);\n\nfor (i = 0; i &lt; r; i ++)\n{\n    matrixOut [i] = (double *) malloc (c * sizeof (double));\n    if (matrixOut [i] == NULL)\n    {\n        printf (\"\\nSorry, not enough memory!\\n\\n\");\n        exit (0);\n    }\n}\n\nfor (i = 0; i &lt; r; i ++ )\n{\n    free (matrixOut [i]);\n}\nfclose (ptrOut);\n\n//reopen the file again to read the matrix elements line by line\n\nptrOut = fopen (outFileName, \"r\");\n\nmatrixOut = (double **) malloc (r * sizeof (double *));\n\nfor (i = 0; i &lt; r; i ++)\n{\n    matrixOut [i] = (double *) malloc (c * sizeof (double));\n}\n\n//print out the matrix here\n\nprintf (\"\\nThe matrix in the file %s of size %d x %d.\\n\\n\", outFileName, r, c);\n\nfor (i = 0; i &lt; r; i ++)\n{\n    for (j = 0; j &lt; c; j++)\n    {\n        fscanf (ptrOut, \"%lf\", &amp;matrixVals);\n        matrixOut [i] [j] = matrixVals;\n        printf (\"%.3lf\\t\", matrixOut [i] [j]);\n    }\n    printf (\"\\n\");\n}\nprintf (\"\\n\");\n\nprintMajorDiagonal (matrixOut, r, c);\nprintMinorDiagonal (matrixOut, r, c);\n\nfor (i = 0; i &lt; r; i ++)\n{\n    free (matrixOut [i]);\n}\nfree (matrixOut);\n\nfclose (ptrOut);\n\nreturn (0);\n}\n\n//function definitions\n\nvoid printMajorDiagonal (double ** m, int r, int c)\n{\n//prints out the major diagonal\nint i, j;\nif (r == c)\n{\n    printf (\"\\nMajor Diagonal &gt;&gt; \\n\\n\");\n    for (i = 0; i &lt; r; i ++)\n    {\n        printf (\"%.3lf\\t\", m [i] [i]);\n    }\n    printf (\"\\n\");\n}\nelse if (r != c)\n{\n    printf (\"\\nThe major diagonal cannot be printed since the given matrix is not a square matrix.\\n\\n\");\n}\n}\n\nvoid printMinorDiagonal (double ** m, int r, int c)\n{\n//prints out the opposite \"minor\" diagonal\nint i, j;\nif (r == c)\n{\n    printf (\"\\nMinor Diagonal &gt;&gt; \\n\\n\");\n    for (i = 0; i &lt; r; i ++)\n    {\n        printf (\"%.3lf\\t\", m [r - i - 1] [i]);\n    }\n    printf (\"\\n\");\n}\nelse if (r != c)\n{\n    printf (\"\\nThe major diagonal cannot be printed since the given matrix is not a square matrix.\\n\\n\");\n}\n}\n</code></pre>\n\n<p>Once again, thanks everyone involved in helping me out. My mistake was failing to re-initiate the file after the first iteration of line counting. </p>\n\n<p>Much appreciated <code>StackOverFlow!</code> </p>\n"}], "owner": {"reputation": 3, "user_id": 9767333, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-atT8NFzSqoQ/AAAAAAAAAAI/AAAAAAAAABk/1P7P2OMPM48/photo.jpg?sz=128", "display_name": "Hadrian Hu", "link": "https://stackoverflow.com/users/9767333/hadrian-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 50280790, "answer_count": 1, "score": 0, "last_activity_date": 1525982885, "creation_date": 1525898795, "last_edit_date": 1525906558, "question_id": 50261777, "link": "https://stackoverflow.com/questions/50261777/c-reading-lines-and-spaces-from-a-file-using-dynamic-allocation", "title": "C reading lines and spaces from a file using dynamic allocation", "body": "<p>I am attempting to read a matrix from a file by using reverse engineering process. The first part of what I am attempting to do is to create a file using malloc or calloc. I used malloc since the user is prompted the number of rows or columns to enter. I also made the final matrix to be printed out on the screen and a user-defined file-name. </p>\n\n<p>The issue that I am having right now is that I am able to fetch the file name on the second part, however once the file name is found, the program freezes and ceases to perform the next operation. </p>\n\n<p>Here is my code below: </p>\n\n<pre><code>//preprocessors\n\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;math.h&gt;\n\n//macros\n\n#define STRING_MAX 50\n\n//function prototypes\n\nvoid printDiagonal (double ** m, int r, int c);\n\nint main (int argc, char * argv [ ])\n{\nFILE * ptrIn;\nFILE * ptrOut;\n\nchar inFileName [STRING_MAX];\nchar outFileName [STRING_MAX];\n\nint row;\nint col;\n\nint r;\nint c_temp;\nint c;\n\nchar spaces;\nchar lines;\n\nint i, j, k;\n\nint ctrSpaces = 0;\nint ctrLines = 0;\nint ctrH = 0;\nint ctrV = 0;\n\ndouble matrixVals;\ndouble ** matrixIn;\ndouble ** matrixOut;\n\n//get a file name first\n\nprintf (\"\\nEnter a file name &gt;&gt; \");\nscanf (\"%s\", inFileName);\n\n//open the file\n\nptrIn = fopen (inFileName, \"w\");\n\n//get matrix dimensions\n\nprintf (\"\\nEnter the row and column sizes &gt;&gt; \");\nscanf (\"%d\", &amp;row);\nscanf (\"%d\", &amp;col);\nprintf (\"\\nRows &gt;&gt; %d\\nCols &gt;&gt; %d\\n\\n\", row, col);\n\nmatrixIn = (double **) malloc (row * sizeof (double *));\nif (matrixIn == NULL)\n{\n    printf (\"\\nSORRY, NOT ENOUGH MEMORY!\\n\\n\");\n    exit (0);\n}\nfor (i = 0; i &lt; row; i ++ )\n{\n    matrixIn [i] = (double *) malloc (col * sizeof (double));\n    if (matrixIn [i] == NULL)\n    {\n        printf (\"\\nSORRY, NOT ENOUGH MEMORY!\\n\\n\");\n        exit (0);\n    }\n}\n\n//input the values into the matrix\n\nprintf (\"\\nEnter the values into the matrix &gt;&gt; \\n\\n\");\n\nfor (i = 0; i &lt; row; i ++)\n{\n    for (j = 0; j &lt; col; j ++)\n    {\n        printf (\"\\n\\nEnter [%d][%d] of [%d][%d] &gt;&gt; \", (i + 1), (j + 1), row, col);\n        scanf (\"%lf\", &amp;matrixIn [i] [j]);\n    }\n}\n\n//print out the matrix\n\nprintf (\"\\nElements in the matrix &gt;&gt; \\n\\n\");\nfor (i = 0; i &lt; row; i ++)\n{\n    for (j = 0; j &lt; col; j ++)\n    {\n        printf (\"%.3lf\\t\", matrixIn [i][j]);\n        fprintf (ptrIn, \"%.3lf\\t\", matrixIn [i][j]);\n    }\n    printf (\"\\n\");\n    fprintf (ptrIn, \"\\n\");\n}\nprintf (\"\\n\");\nfprintf (ptrIn, \"\\n\");\n\nfor (i = 0; i &lt; row; i ++)\n{\n    free (matrixIn [i]);\n}\nfree (matrixIn);\n\nfclose (ptrIn);\n\nprintf (\"\\n-----------------------------------------------------------------------------------------------------------------\\n\\n\");\n\n/**------------------------------------------------------------------------------------------------------------------------------------------------------------------------------**/\n\n//now retrieve the file by first getting user input for file name and check that the file exists\n\nFILE_NAME:\n\nprintf (\"\\nEnter the name of file to access &gt;&gt; \");\nscanf (\"%s\", outFileName);\nprintf (\"\\nThe name of the file is &gt;&gt; %s\\n\\n\", outFileName);\n\n//now open the file\n\nptrOut = fopen (outFileName, \"r\");\n\n//check that the file exists\n\nif (ptrOut == NULL)\n{\n    printf (\"\\nSORRY, THE FILE DOES NOT EXIST. PLEASE ENTER A VALID FILE NAME.\\n\\n\");\n    goto FILE_NAME;\n}\n\n//get the number of rows and columns\n\nfor (lines = fgetc (ptrOut); lines != EOF; lines == fgetc (ptrOut))\n{\n    if (lines == '\\t' || lines == ' ')\n    {\n        ctrLines ++;\n        if (lines == EOF)\n        {\n            break;\n        }\n    }\n}\n\nc_temp = ctrLines;\n\nfor (spaces = fgetc (ptrOut); spaces != EOF; spaces = fgetc(ptrOut))\n{\n    if (spaces == '\\n')\n    {\n        ctrSpaces ++;\n        if (spaces == EOF)\n        {\n            break;\n        }\n    }\n}\n\nr = ctrSpaces;\n\n//total number of rows is:\n\nc = c_temp / r;\n\nprintf (\"\\nNumber of rows &gt;&gt; %d\\n\\nNumber of columns &gt;&gt; %d\\n\\n\", r, c);\n\nmatrixOut = (double **) malloc (r * sizeof (double *));\nif (matrixOut == NULL)\n{\n    printf (\"\\nSorry, not enough memory!\\n\\n\");\n    exit (0);\n}\n\nfor (i = 0; i &lt; r; i ++)\n{\n    matrixOut [i] = (double *) malloc (c * sizeof (double));\n    if (matrixOut [i] == NULL)\n    {\n        printf (\"\\nSorry, not enough memory!\\n\\n\");\n        exit (0);\n    }\n}\n\nfor (i = 0; i &lt; r; i ++)\n{\n    free (matrixOut [i]);\n}\nfree(matrixOut);\n\nfclose (ptrOut);\n\n//reopen the file and get the information from the file\n\nptrOut = fopen (outFileName, \"r\");\n\nmatrixOut = (double **) malloc (c * sizeof (double *));\n\nfor (i = 0; i &lt; r; i++)\n{\n    matrixOut [i] = (double *) malloc (c * sizeof (double));\n}\n\nprintf (\"\\nMatrix from File %s of dimensions %d X %d &gt;&gt;\\n\\n\", outFileName, r, c);\n\nfor (i = 0; i &lt; r; i ++)\n{\n    for (j = 0; j &lt; c; j ++)\n    {\n        fscanf (ptrOut, \"%lf\", &amp;matrixVals);\n        matrixOut [i] [j] = matrixVals;\n        printf (\"%.3lf\\t\", matrixOut [i] [j]);\n    }\n    printf (\"\\n\");\n}\nprintf (\"\\n\");\n\nfor (i = 0; i &lt; r; i ++)\n{\n    free (matrixOut [i]);\n}\nfree(matrixOut);\n\nfclose (ptrOut);\n\nreturn (0);\n}\n</code></pre>\n\n<p>This is my output: \n<a href=\"https://1drv.ms/u/s!AqM2tvkVzTumh58mcliiAUKD9Uu7Ew\" rel=\"nofollow noreferrer\">https://1drv.ms/u/s!AqM2tvkVzTumh58mcliiAUKD9Uu7Ew</a>. </p>\n\n<p>For clarification of my problem. </p>\n\n<p>Thanks</p>\n"}, {"tags": ["c", "hex"], "answers": [{"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1525933625, "post_id": 50266680, "comment_id": 87551381, "body": "I suspect the OP is looking for the 2nd, but you have all bases covered. Had not made use of <code>%a</code> before -- interesting, but a bit bewildered where I would use it outside of something like this."}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1525933728, "post_id": 50266680, "comment_id": 87551436, "body": "I guess that OP don&#39;t know all the pitfalls of floating point (and neither do I). I have given some pointers."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1525933984, "post_id": 50266680, "comment_id": 87551558, "body": "Would <code>%a</code> output enough data by default for an exact roundtrip conversion? Does it make a difference that <code>x</code> is a <code>float</code> not a <code>double</code>?"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1525934068, "post_id": 50266680, "comment_id": 87551601, "body": "That is actually a tricky question.... IIRC <code>float</code>-s are converted to <code>double</code>-s when passed as argument, but I leave you to check that (it could have changed between C90 &amp; C99)"}], "tags": [], "owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "is_accepted": false, "score": 1, "last_activity_date": 1525933882, "last_edit_date": 1525933882, "creation_date": 1525933060, "answer_id": 50266680, "question_id": 50261686, "link": "https://stackoverflow.com/questions/50261686/how-do-i-represent-floating-point-numbers-in-hexadecimal-values-to-use-in-c-prog/50266680#50266680", "title": "How do I represent floating point numbers in hexadecimal values to use in c program?", "body": "<p>Stricto sensu, your question does not make any sense. A floating number is not an integer so it cannot be represented in hexadecimal (base 16).</p>\n\n<p>Read <a href=\"http://floating-point-gui.de/\" rel=\"nofollow noreferrer\">http://floating-point-gui.de/</a> at first.</p>\n\n<p>Perhaps you want to output a float in hexadecimal <em>notation</em>. Then read documentation of <a href=\"http://en.cppreference.com/w/c/io/fprintf\" rel=\"nofollow noreferrer\">printf</a>, and, if your C implementation is C99 compliant, use <code>%a</code> like <code>printf(\"x=%a\\n\", x);</code> for example.</p>\n\n<p>Maybe you want to output in hexadecimal the bitwise representation of your <code>float</code>. That would depend on the <a href=\"https://en.wikipedia.org/wiki/Endianness\" rel=\"nofollow noreferrer\">endianess</a> of your machine (and on the fact that it uses <a href=\"https://en.wikipedia.org/wiki/IEEE_754\" rel=\"nofollow noreferrer\">IEEE754</a> for floating point representation), so the output won't be the same on a x86 and on an ARM. You might use a <a href=\"https://en.wikipedia.org/wiki/Union_type\" rel=\"nofollow noreferrer\"><code>union</code> type</a>: </p>\n\n<pre><code>union {\n  unsigned u;\n  float f;\n} un;\nun.f = x;\nprintf(\"%#x\\n\", un.u);\n</code></pre>\n\n<p>Of course, that makes sense only when <code>sizeof(unsigned)</code> is the same as <code>sizeof(float)</code> (and even in that case, the behavior is implementation defined).</p>\n"}, {"comments": [{"owner": {"reputation": 121, "user_id": 9766867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a37d61904921fecfff1a8a9a8e78c49?s=128&d=identicon&r=PG&f=1", "display_name": "Aman Gupta", "link": "https://stackoverflow.com/users/9766867/aman-gupta"}, "edited": false, "score": 0, "creation_date": 1525958247, "post_id": 50266797, "comment_id": 87564397, "body": "I m working in Ubuntu Linux using GCC would that work for me?"}], "tags": [], "owner": {"reputation": 15724, "user_id": 1716339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/835fc3719b0118c68c4d202b3e5cbf18?s=128&d=identicon&r=PG", "display_name": "Aki Suihkonen", "link": "https://stackoverflow.com/users/1716339/aki-suihkonen"}, "is_accepted": false, "score": 1, "last_activity_date": 1525933571, "last_edit_date": 1525933571, "creation_date": 1525933533, "answer_id": 50266797, "question_id": 50261686, "link": "https://stackoverflow.com/questions/50261686/how-do-i-represent-floating-point-numbers-in-hexadecimal-values-to-use-in-c-prog/50266797#50266797", "title": "How do I represent floating point numbers in hexadecimal values to use in c program?", "body": "<p>In C99 the format to initialize a hexadecimal fp is <code>float a=0x1.abcdefp-5;</code>\nThe exponent is in decimal.</p>\n"}], "owner": {"reputation": 121, "user_id": 9766867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a37d61904921fecfff1a8a9a8e78c49?s=128&d=identicon&r=PG&f=1", "display_name": "Aman Gupta", "link": "https://stackoverflow.com/users/9766867/aman-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1525933882, "creation_date": 1525898455, "last_edit_date": 1525932539, "question_id": 50261686, "link": "https://stackoverflow.com/questions/50261686/how-do-i-represent-floating-point-numbers-in-hexadecimal-values-to-use-in-c-prog", "title": "How do I represent floating point numbers in hexadecimal values to use in c program?", "body": "<p>If <code>x</code> is variable defined as <code>float x</code>, how do I write a floating value as hexadecimal?</p>\n\n<p>I don't know what should I do, please guide me.</p>\n"}, {"tags": ["c", "linux", "multithreading", "pthreads", "fork"], "comments": [{"owner": {"reputation": 124, "user_id": 6438359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e85e5b3614e75c70f38d39736f72d02?s=128&d=identicon&r=PG&f=1", "display_name": "Tianjiao Huang", "link": "https://stackoverflow.com/users/6438359/tianjiao-huang"}, "edited": false, "score": 1, "creation_date": 1525897442, "post_id": 50261334, "comment_id": 87540986, "body": "Since you said that &quot;they don&#39;t need any data structure, fd or socket of the main server&quot;, then forking a new process won&#39;t be too expensive. It won&#39;t copy everything when you fork it, it will <a href=\"https://stackoverflow.com/questions/4597893/specifically-how-does-fork-handle-dynamically-allocated-memory-from-malloc/4597931#4597931\">copy on write</a>"}, {"owner": {"reputation": 65414, "user_id": 768469, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/383724e63ab04b146277912c16f27f54?s=128&d=identicon&r=PG", "display_name": "Nemo", "link": "https://stackoverflow.com/users/768469/nemo"}, "reply_to_user": {"reputation": 124, "user_id": 6438359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e85e5b3614e75c70f38d39736f72d02?s=128&d=identicon&r=PG&f=1", "display_name": "Tianjiao Huang", "link": "https://stackoverflow.com/users/6438359/tianjiao-huang"}, "edited": false, "score": 3, "creation_date": 1525897621, "post_id": 50261334, "comment_id": 87541066, "body": "@TianjiaoHuang: The parent&#39;s memory will also be marked copy-on-write, so <code>fork</code> is probably not all that cheap."}, {"owner": {"reputation": 65414, "user_id": 768469, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/383724e63ab04b146277912c16f27f54?s=128&d=identicon&r=PG", "display_name": "Nemo", "link": "https://stackoverflow.com/users/768469/nemo"}, "edited": false, "score": 0, "creation_date": 1525897669, "post_id": 50261334, "comment_id": 87541086, "body": "<code>fork</code> is the only choice for &quot;durable&quot;. Is it an option to keep some slave processes running and give them commands via IPC? (pipe, socket, shared memory...)"}, {"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1525897756, "post_id": 50261334, "comment_id": 87541123, "body": "If the main process is killed, then what should these sub-whatevers do?  What is orchestrating them?  What are they communicating with?"}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 1, "creation_date": 1525897954, "post_id": 50261334, "comment_id": 87541229, "body": "Just look at your design wrt. inter-whatever comms.  If your design relies on frequent signaling of large data items, then threads will be much more efficient  because you can signal pointers instead of copying bulk data.  If, however, there is a considerable degree of data isolation, then there is little advantage to threads over processes.  Horses for courses."}, {"owner": {"reputation": 743, "user_id": 5091033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d0737443a012e096ab556ef60a197f?s=128&d=identicon&r=PG&f=1", "display_name": "simo-r", "link": "https://stackoverflow.com/users/5091033/simo-r"}, "edited": false, "score": 0, "creation_date": 1525897971, "post_id": 50261334, "comment_id": 87541238, "body": "There&#39;s no way for achieving durability without <code>fork</code>. If you don&#39;t want to use it you&#39;ve to re-think about your problem and find another way. It&#39;s not true that if a thread &quot;generates&quot; an error could block everything because if you&#39;ve enough isolation between threads and controls in your code you can easily manage errors."}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 3, "creation_date": 1525898162, "post_id": 50261334, "comment_id": 87541323, "body": "..or you could just take the pragmatic approach of designing your system so that you can easily try both, and then just testmeasure."}], "answers": [{"comments": [{"owner": {"reputation": 2070, "user_id": 6193113, "user_type": "registered", "accept_rate": 74, "profile_image": "https://graph.facebook.com/1692333061036108/picture?type=large", "display_name": "Phocs", "link": "https://stackoverflow.com/users/6193113/phocs"}, "edited": false, "score": 0, "creation_date": 1525903854, "post_id": 50262552, "comment_id": 87543573, "body": "clone: it could be a solution but which flags to use to inherit as little as possible? From what I understand, clone behaves similar to fork, it replicates the process with the option to choose which part of its execution context to share. Fork + exec solution seems to be the best in my case, but I would like to avoid generating separate executable files."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 2070, "user_id": 6193113, "user_type": "registered", "accept_rate": 74, "profile_image": "https://graph.facebook.com/1692333061036108/picture?type=large", "display_name": "Phocs", "link": "https://stackoverflow.com/users/6193113/phocs"}, "edited": false, "score": 0, "creation_date": 1525904398, "post_id": 50262552, "comment_id": 87543783, "body": "As I said, @alessiovolpe, I doubt that what you wrote fully captures the semantics you have in mind.  Clone <i>does</i> behave similarly to fork.  If you read through the flag list, you will see that pretty much all of them request more sharing with the original process, so specifying no flags gives you as little sharing as possible.  But no sharing means <i>copying</i> instead (with copy-on-write where applicable, like fork).  But you get the specified function as entry point, and return from it terminates the child."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 2, "last_activity_date": 1525902561, "creation_date": 1525902561, "answer_id": 50262552, "question_id": 50261334, "link": "https://stackoverflow.com/questions/50261334/create-a-new-thin-process-fork-or-threads/50262552#50262552", "title": "Create a new thin process, fork or threads?", "body": "<blockquote>\n  <p>fork: I get durability over time but copying the main server means to\n  copy all its data structures, fd etc. that would weigh down the new\n  process unnecessarily.</p>\n</blockquote>\n\n<p>Not as much as you may think.  Linux <code>fork()</code> has long been implemented via copy-on-write pages.  The child process will have the same <em>address space</em> as the parent, but it will not have its own copies of any pages that neither process modifies.  Moreover, the cost of copying modified pages is amortized over time.  The initial <code>fork()</code> is pretty cheap.</p>\n\n<blockquote>\n  <p>thread: light and fast but not durable and above all very unstable (if\n  a thread for some reason generates an error could block everything).</p>\n</blockquote>\n\n<p>Given that analysis, threads are not a real option after all.  Durability and stability are functional requirements.  Minimum weight and to some extent even speed are efficiency issues.  The former category trumps the latter pretty much every time.</p>\n\n<blockquote>\n  <p>The ideal thing would be a magic system call, that executes an ex novo\n  process that has a function as entry point but I think there is\n  nothing like that.</p>\n</blockquote>\n\n<p>Since you're targeting Linux, have you considered <a href=\"http://man7.org/linux/man-pages/man2/clone.2.html\" rel=\"nofollow noreferrer\"><code>clone()</code></a>?  It does exactly what you describe, though I'm doubtful that what you said fully captures the semantics you imagine for such a feature.</p>\n\n<p>Alternatively, have you considered fork + exec?  That would probably require some refactoring, but by performing an exec the child would shed the context shared with its parent as much as is possible, right after the (cheap) initial fork.</p>\n"}], "owner": {"reputation": 2070, "user_id": 6193113, "user_type": "registered", "accept_rate": 74, "profile_image": "https://graph.facebook.com/1692333061036108/picture?type=large", "display_name": "Phocs", "link": "https://stackoverflow.com/users/6193113/phocs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 50262552, "answer_count": 1, "score": 2, "last_activity_date": 1525902561, "creation_date": 1525896901, "last_edit_date": 1525897271, "question_id": 50261334, "link": "https://stackoverflow.com/questions/50261334/create-a-new-thin-process-fork-or-threads", "title": "Create a new thin process, fork or threads?", "body": "<p>I'm working on a small project and I'm looking for advice.</p>\n\n<p>Basically, I have a main process that is a server with a variety of dynamically growing data structures and some sockets here and there. </p>\n\n<p>In some cases I need to create processes that run a small loop as long as necessary (they don't need any data structure, fd or socket of the main server). \nAn important requirement is that they should be: fast, light and durable (even if the main server killed).</p>\n\n<p>fork: I get durability over time but copying the main server means to copy all its data structures, fd etc. that would weigh down the new process unnecessarily.</p>\n\n<p>thread: light and fast but not durable and above all very unstable (if a thread for some reason generates an error could block everything).</p>\n\n<p>The ideal thing would be a magic system call, that executes an ex novo process that has a function as entry point but I think there is nothing like that.</p>\n\n<p>Do you have any advice for me?</p>\n"}, {"tags": ["c", "arrays", "file", "structure", "fwrite"], "comments": [{"owner": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1525895920, "post_id": 50260918, "comment_id": 87540311, "body": "Fyi, in <code>remove_book</code>, your inner-for condition <code>index &lt;= (*num) - 1 </code> - is not right. That&#39;s the same as <code>index &lt; (*num)</code> which is what you want to <i>avoid</i>. That should be strictly-less-than."}, {"owner": {"reputation": 1, "user_id": 9760593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83f25c1e6b56e8c6edc41a9693f72e7f?s=128&d=identicon&r=PG&f=1", "display_name": "n01s0n", "link": "https://stackoverflow.com/users/9760593/n01s0n"}, "reply_to_user": {"reputation": 6975, "user_id": 3121023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f52448806175b9aa66c86d40cf0829f1?s=128&d=identicon&r=PG&f=1", "display_name": "user3121023", "link": "https://stackoverflow.com/users/3121023/user3121023"}, "edited": false, "score": 0, "creation_date": 1525896035, "post_id": 50260918, "comment_id": 87540374, "body": "I could, but unfortunately the exercise says I have to do this with only one file open and only in &quot;r+b&quot; mode to overwrite the past content :/ Anyway, thanks a lot @user3121023"}, {"owner": {"reputation": 1, "user_id": 9760593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83f25c1e6b56e8c6edc41a9693f72e7f?s=128&d=identicon&r=PG&f=1", "display_name": "n01s0n", "link": "https://stackoverflow.com/users/9760593/n01s0n"}, "reply_to_user": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1525896106, "post_id": 50260918, "comment_id": 87540418, "body": "@WhozCraig You&#39;re right, I&#39;m going to correct it, thanks :)"}, {"owner": {"reputation": 1, "user_id": 9760593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83f25c1e6b56e8c6edc41a9693f72e7f?s=128&d=identicon&r=PG&f=1", "display_name": "n01s0n", "link": "https://stackoverflow.com/users/9760593/n01s0n"}, "reply_to_user": {"reputation": 58995, "user_id": 1322972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/puZFr.png?s=128&g=1", "display_name": "WhozCraig", "link": "https://stackoverflow.com/users/1322972/whozcraig"}, "edited": false, "score": 0, "creation_date": 1525901862, "post_id": 50260918, "comment_id": 87542923, "body": "I will keep the post in case some pieces of the code will be found useful by someone, for example the read() function works well instead of gets() which is unsafe but still used by many people :D"}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "edited": false, "score": 0, "creation_date": 1526206912, "post_id": 50260918, "comment_id": 87645934, "body": "It looks like this question was answered by editing it to overwrite the question with an answer. We don&#39;t do that here, since it leaves us an answer with no question. Please post a summary of the solution in the answer box below - self-answered questions are warmly welcomed here."}], "owner": {"reputation": 1, "user_id": 9760593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83f25c1e6b56e8c6edc41a9693f72e7f?s=128&d=identicon&r=PG&f=1", "display_name": "n01s0n", "link": "https://stackoverflow.com/users/9760593/n01s0n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1526206849, "creation_date": 1525894883, "last_edit_date": 1526206849, "question_id": 50260918, "link": "https://stackoverflow.com/questions/50260918/how-to-remove-a-structure-from-an-array-of-structures-and-correctly-overwrite-a", "title": "How to remove a structure from an array of structures and correctly overwrite a file using fwrite()", "body": "<p><strong>Hi everyone I'm new to C. I had to create a \"library\" where I can store some books and make some changes on them (add a book, remove a book or change it) using an array of structures, then I have to save it in a file.</strong></p>\n\n<p>The problem is that it should be possible to remove a book and overwrite the changes in the file opened in \"r+b\" mode using the fwrite() function.</p>\n\n<p>At first I read from the file to the array of structures and count the number of books in it using fread(), then after I remove a book I scroll the structures down and I assign an empty structure to the last structure.</p>\n\n<p>Ex.</p>\n\n<ul>\n<li>Book1</li>\n<li>Book2</li>\n<li>Book3</li>\n</ul>\n\n<p>After removing \"Book2\" and scrolling down the structures:</p>\n\n<ul>\n<li>Book1</li>\n<li>Book3</li>\n<li>Book3</li>\n</ul>\n\n<p>After assigning an empty structure to the last one that has been read:</p>\n\n<ul>\n<li>Book1</li>\n<li>Book3</li>\n<li>Random_Stuff</li>\n</ul>\n\n<p>Then I save only the first two structures to the file and when I read the file I get:</p>\n\n<ul>\n<li>Book1</li>\n<li>Book3</li>\n<li>Book3</li>\n</ul>\n\n<p>If I overwrite the file with the 3 structures I get:</p>\n\n<ul>\n<li>Book1</li>\n<li>Book3</li>\n<li>Random_Stuff</li>\n</ul>\n\n<p>And that's reasonable, but how can I overwrite the whole file just with, in this case, the first two structures using fwrite()?</p>\n\n<p>This is my structure</p>\n\n<pre><code>typedef struct book {\n        char title[MAXTIT];\n        char autor[MAXAUT];\n        float price;\n} info;\n</code></pre>\n\n<p>This is the function to remove a book:</p>\n\n<pre><code>void remove_book(info bibl[], int * num) {\n\n// Empty structure to assign to the last structure after the removal\ninfo empty;\n\nchar title[256];\n\nputs(\"Enter the title of the book you want to remove:\");\nread(title, 256);\n\n// Scrolling down the structures to cover the removed one\nfor (int i = 0 ; i &lt; *num ; i++)\n    if (strcmp(title, bibl[i].title) == 0) {\n        for (int index = i ; index &lt; *num ; index++)\n            bibl[index] = bibl[index + 1];\n        bibl[*num] = empty;\n        (*num)--;\n        break;\n    }\n\nfor (int index = 0 ; index &lt; *num ; index++)\n    printf(\"%s, autor: %s, price: %.2f \u20ac\\n\", bibl[index].title, bibl[index].autor, bibl[index].price);\n}\n</code></pre>\n\n<p>This is the full code (just in case):</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdbool.h&gt;\n\n#define MAXTIT  40          // Maximum lenght of the title\n#define MAXAUT  40          // Maximum lenght of the name of the autor\n#define MAXBOOK 10          // Maximum number of books\n\ntypedef struct book {\n        char title[MAXTIT];\n        char autor[MAXAUT];\n        float price;\n} info;\n\nint size = sizeof(info);\nint counter = 0;\nint counterp;\nFILE * fp;\nchar file_name[64];\n\nint menu(void);\nvoid add_book(info [], int *);\nvoid remove_book(info [], int *);\nvoid modify_book(info [], int);\nvoid input(info [], int *, int *);\nchar *read(char *, int);\n\nint main(void) {\n\ninfo bibl[MAXBOOK];\nint index, choice;\n\nputs(\"Please, enter the file to be read:\");\nread(file_name, 64);\n\n// If returns a NULL pointer puts an error message and ends the program\nif (!(fp = fopen(file_name, \"r+b\"))) {\n    fprintf(stderr, \"An error occurred while trying to open \\\"%s\\\".\", file_name);\n    exit(1);\n}\n\n// Read the content of the file\ninput(bibl, &amp;counter, &amp;counterp);\n\n    // If the file is empty lets the user add a book\n    if (counterp == 0) {\n        add_book(bibl, &amp;counter);\n        fwrite(&amp;bibl[counterp], size, counter - counterp, fp);\n\n        // If the user added a book shows the content of the file\n        if (counter &gt; 0) {\n            puts(\"Updated file content:\");\n            for (index = 0 ; index &lt; counter ; index++)\n                printf(\"%d) %s, autor: %s, price: %.2f \u20ac\\n\", index + 1, bibl[index].title, bibl[index].autor, bibl[index].price);\n            putchar('\\n');\n        }\n    }\n\n    // If there is something in the file lets the user choose between some options (add, remove, modify a book or simply quit)\n    if (counter &gt; 0) {\n\n        // Menu returns a value for the switch function\n        choice = menu();\n\n        // Repeats the choice until the \"Quit\" option has been chosen\n        while (choice) {\n\n            switch(choice) {\n\n            // First case, reads from the file, adds the book and writes everything in the file\n            case 1 :    input(bibl, &amp;counter, &amp;counterp);\n                    add_book(bibl, &amp;counter);\n                    fwrite(&amp;bibl[counterp], size, counter - counterp, fp);\n                    break;\n\n            // Second case, reads from the file, (should) removes the book and overwrites everything in the file\n           case 2 : input(bibl, &amp;counter, &amp;counterp);\n                    remove_book(bibl, &amp;counter);\n                    rewind(fp);                 // Rewind to overwrite the new values in the file\n                    fwrite(&amp;bibl[0], size, counterp, fp);\n                    break;\n\n            // Third case, reads from the file, modifies the book and overwrites everything in the file\n           case 3 : input(bibl, &amp;counter, &amp;counterp);\n                    modify_book(bibl, counter);\n                    rewind(fp);                 // Same as before\n                    fwrite(&amp;bibl[0], size, counter, fp);\n                    break;\n\n            // Forth case, quits the menu\n           case 4 : break;\n\n            // Should never activate but I put it in case I'd like to modify something in the menu ecc...\n          default : fputs(\"You entered wrong data!\", stderr);\n                    break;\n\n          }\n\n        // If a change has been made shows the new content\n        if (choice &gt;= 1 &amp;&amp; choice &lt;= 3) {\n            puts(\"Updated file content:\");\n\n            for (index = 0 ; index &lt; counter ; index++)\n                printf(\"%d) %s, autor: %s, price: %.2f \u20ac\\n\", index + 1, bibl[index].title, bibl[index].autor, bibl[index].price);\n\n            putchar('\\n');\n        }\n\n        // Exit the loop in case of \"Quit\" option\n        if (choice == 4)\n            break;\n\n        choice = menu();\n    }\n\n} else\n    puts(\"No books? What a pity!\");\n\n// If fclose() != NULL, an error occurred\nif (fclose(fp))\n    fprintf(stderr, \"An error occurred while trying to close \\\"%s\\\".\", file_name);\n\nputs(\"Ending process...\");\n\nreturn 0;\n}\n\n// Function that shows the options of the menu\nint menu(void) {\n\nint num;\n\nputs(\"Choose between:\\n1) Add a book\\n2) Remove book\\n3) Modify a book\\n4) Quit\");\n\nwhile (scanf(\"%d\", &amp;num) != 1 || num &lt; 1 || num &gt; 4)\n    puts(\"Choice between:\\n1) Add a book\\n2) Remove book\\n3) Modify a book\\n4) Quit\");\n\nwhile (getchar() != '\\n');\n\nreturn num;\n}\n\n// Function used to add a book to the file (works fine)\nvoid add_book(info bibl[], int * num) {\n\nint index;\nbool flag = false;\n\nputs(\"Please, enter a new title ([enter] at the start of the line ends the process):\");\n\nwhile (*num &lt; MAXBOOK &amp;&amp; read(bibl[*num].title, MAXTIT) &amp;&amp; bibl[*num].title[0] != '\\0') {\n\n    puts(\"Now enter the autor.\");\n    read(bibl[*num].autor, MAXAUT);\n\n    for (index = 0 ; index &lt; *num ; index++)\n        if (strcmp(bibl[index].title, bibl[*num].title) == 0 &amp;&amp; strcmp(bibl[index].autor, bibl[*num].autor) == 0) {\n            puts(\"This book is already in your library.\");\n            puts(\"Please, enter a new title ([enter] at the start of the line ends the process):\");\n            flag = true;\n            break;\n        }\n\n    if (flag)\n        continue;\n\n    puts(\"And finally enter the price.\");\n    scanf(\"%f\", &amp;bibl[(*num)++].price);\n\n    while (getchar() != '\\n');\n\n    if (*num &lt; MAXBOOK)\n        puts(\"\\nPlease, enter a new title ([enter] at the start of the line ends the process):\");\n    }\n}\n\n// Function that should work and do what it's meant to do but it doesn't for I don't know what reason\nvoid remove_book(info bibl[], int * num) {\n\n// Empty structure to assign to the last structure after the removal\ninfo empty;\n\nchar title[256];\n\nputs(\"Enter the title of the book you want to remove:\");\nread(title, 256);\n\n// Scrolling down the structures to cover the removed one\nfor (int i = 0 ; i &lt; *num ; i++)\n    if (strcmp(title, bibl[i].title) == 0) {\n        for (int index = i ; index &lt; *num ; index++)\n            bibl[index] = bibl[index + 1];\n        bibl[*num] = empty;\n        (*num)--;\n        break;\n    }\n\nfor (int index = 0 ; index &lt; *num ; index++)\n    printf(\"%s, autor: %s, price: %.2f \u20ac\\n\", bibl[index].title, bibl[index].autor, bibl[index].price);\n}\n\n// Function used to change a book's informations\nvoid modify_book(info bibl[], int num) {\n\n    char title[256];\n    int choice;\n\n    puts(\"Enter the title of the book you want to modify:\");\n    read(title, 256);\n\n    puts(\"Choose what you want to modify:\\n1) Title\\n2) Autor\\n3) Price\\n4) Everything\");\n    while(scanf(\"%d\", &amp;choice) != 1 || choice &lt; 1 || choice &gt; 4)\n        puts(\"Choose what you want to modify:\\n1) Title\\n2) Autor\\n3) Price\\n4) Everything\");\n\n    while (getchar() != '\\n');\n\n    for (int i = 0 ; i &lt; num ; i++) {\n        if (strcmp(title, bibl[i].title) == 0) {\n\n            switch (choice) {\n\n\n            case 1 :    puts(\"Please, enter the new title of the book:\");\n                        read(bibl[i].title, MAXTIT);\n                        break;\n\n            case 2 :    puts(\"Enter the new autor of the book:\");\n                        read(bibl[i].autor, MAXAUT);\n                        break;\n\n            case 3 :    puts(\"Enter the new price:\");\n                        scanf(\"%f\", &amp;bibl[i].price);\n                        while (getchar() != '\\n');\n                        break;\n\n            case 4 :    puts(\"Please, enter the title of the book:\");\n                        read(bibl[i].title, MAXTIT);\n                        puts(\"Now enter the autor of the book:\");\n                        read(bibl[i].autor, MAXAUT);\n                        puts(\"And finally its cost:\");\n                        scanf(\"%f\", &amp;bibl[i].price);\n                        while (getchar() != '\\n');\n                        break;\n\n            default :   break;\n\n            }\n\n            break;\n        }\n    }\n\n    for (int index = 0 ; index &lt; num ; index++)\n        printf(\"%s, autor: %s, price: %.2f \u20ac\\n\", bibl[index].title, bibl[index].autor, bibl[index].price);\n}\n\n// Function that reads from the file in which we are saving the structures\nvoid input(info bibl[], int * counter, int * counterp) {\n\n    *counter = 0;\n    rewind(fp);\n\n    while (*counter &lt; MAXBOOK &amp;&amp; fread(&amp;bibl[*counter], size, 1, fp) == 1) {\n\n        if (*counter == 0)\n            printf(\"Actual content of the file \\\"%s\\\":\\n\", file_name);\n\n        printf(\"%d) %s by %s: %.2f \u20ac\\n\", *counter + 1, bibl[*counter].title, bibl[*counter].autor, bibl[*counter].price);\n        (*counter)++;\n    }\n\n    if (*counter &gt; 0 &amp;&amp; *counter &lt; MAXBOOK)\n        putchar('\\n');\n\n    *counterp = *counter;\n    if (*counter == MAXBOOK) {\n        fprintf(stderr, \"The file \\\"%s\\\" is full.\", file_name);\n        exit(1);\n    }\n}\n\n// Better alternative for gets()\nchar *read(char * str, int len) {\n\n    char * res, * here;\n\n    if (res = fgets(str, len, stdin))\n        if (here = strchr(str, '\\n'))\n            *here = '\\0';\n        else\n            while (getchar() != '\\n');\n\n    return res;\n}\n</code></pre>\n"}, {"tags": ["c", "assembly", "x86-64", "i386"], "comments": [{"owner": {"reputation": 4654, "user_id": 332733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BR7yE.jpg?s=128&g=1", "display_name": "Mgetz", "link": "https://stackoverflow.com/users/332733/mgetz"}, "edited": false, "score": 0, "creation_date": 1525896079, "post_id": 50260855, "comment_id": 87540403, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/2003608/linux-equivalent-of-getcommandline-and-commandlinetoargv\">Linux equivalent of GetCommandLine and CommandLineToArgv?</a>"}, {"owner": {"reputation": 4654, "user_id": 332733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BR7yE.jpg?s=128&g=1", "display_name": "Mgetz", "link": "https://stackoverflow.com/users/332733/mgetz"}, "edited": false, "score": 0, "creation_date": 1525896114, "post_id": 50260855, "comment_id": 87540422, "body": "when you enter into <code>_start</code> you have nothing, the only way to get the command line is to ask the OS for it. Either way if you&#39;re going to do this in ASM you&#39;ll need to make a system call."}, {"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 1, "creation_date": 1525896278, "post_id": 50260855, "comment_id": 87540500, "body": "<a href=\"https://sourceware.org/git/?p=glibc.git;a=blob;f=sysdeps/i386/start.S;h=91035fa83fb7ee38a0ca5834ba1d215b4a7f78e8;hb=HEAD\" rel=\"nofollow noreferrer\">sourceware.org/git/?p=glibc.git;a=blob;f=sysdeps/i386/&hellip;</a> for x86, <a href=\"https://sourceware.org/git/?p=glibc.git;a=blob;f=sysdeps/x86_64/start.S;h=354d2e6ec78f0eaf9ab0f8ed665c2e5499388df0;hb=HEAD\" rel=\"nofollow noreferrer\">sourceware.org/git/?p=glibc.git;a=blob;f=sysdeps/x86_64/&hellip;</a> for x86_64; in particular, <code>argv</code> and <code>argc</code> are on the stack, not in registers."}, {"owner": {"reputation": 71, "user_id": 7910804, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e901ccb42f19a16ddc2a0f027fb7334?s=128&d=identicon&r=PG&f=1", "display_name": "C Perfomance", "link": "https://stackoverflow.com/users/7910804/c-perfomance"}, "reply_to_user": {"reputation": 4654, "user_id": 332733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BR7yE.jpg?s=128&g=1", "display_name": "Mgetz", "link": "https://stackoverflow.com/users/332733/mgetz"}, "edited": false, "score": 0, "creation_date": 1525896741, "post_id": 50260855, "comment_id": 87540698, "body": "@Mgetz , I know working with syscall. Please send documentation about this item. Or guide. Thank You."}, {"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 0, "creation_date": 1525896804, "post_id": 50260855, "comment_id": 87540729, "body": "The main problem there is, you cannot do it into a &quot;regular&quot; C function, as gcc will manipulate the stack before you&#39;ll have a chance to do anything. The simplest thing is to do as glibc does and implement <code>_start</code> straight in assembly and perform the handoff to a C function using the regular C calling convention. From there onwards, it&#39;s all C. Otherwise, I think you may be able to do something with a <code>naked</code> function, but then again, you want to get the arguments and forward them to a &quot;normal&quot; C function using the regular ABI immediately."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "reply_to_user": {"reputation": 4654, "user_id": 332733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BR7yE.jpg?s=128&g=1", "display_name": "Mgetz", "link": "https://stackoverflow.com/users/332733/mgetz"}, "edited": false, "score": 3, "creation_date": 1525896822, "post_id": 50260855, "comment_id": 87540735, "body": "@Mgetz This is not correct for Linux. The argument, environment, and auxillary vectors are already present in the new executable&#39;s address space when control reaches <code>_start</code>."}, {"owner": {"reputation": 71, "user_id": 7910804, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e901ccb42f19a16ddc2a0f027fb7334?s=128&d=identicon&r=PG&f=1", "display_name": "C Perfomance", "link": "https://stackoverflow.com/users/7910804/c-perfomance"}, "reply_to_user": {"reputation": 4654, "user_id": 332733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BR7yE.jpg?s=128&g=1", "display_name": "Mgetz", "link": "https://stackoverflow.com/users/332733/mgetz"}, "edited": false, "score": 0, "creation_date": 1525896969, "post_id": 50260855, "comment_id": 87540794, "body": "@Mgetz , <code>Read from file &#47;proc&#47;self&#47;cmdline</code> , Is this the real way?"}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 0, "creation_date": 1525897000, "post_id": 50260855, "comment_id": 87540810, "body": "@CPerfomance No, it is not.  Hold your horses, I&#39;m still typing."}, {"owner": {"reputation": 71, "user_id": 7910804, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e901ccb42f19a16ddc2a0f027fb7334?s=128&d=identicon&r=PG&f=1", "display_name": "C Perfomance", "link": "https://stackoverflow.com/users/7910804/c-perfomance"}, "reply_to_user": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 0, "creation_date": 1525897275, "post_id": 50260855, "comment_id": 87540903, "body": "@zwol , Thankful. Waiting."}], "answers": [{"tags": [], "owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "is_accepted": false, "score": 5, "last_activity_date": 1526036420, "last_edit_date": 1526036420, "creation_date": 1525897872, "answer_id": 50261564, "question_id": 50260855, "link": "https://stackoverflow.com/questions/50260855/how-get-arguments-value-using-inline-assembly-in-c-without-glibc/50261564#50261564", "title": "How Get arguments value using inline assembly in C without Glibc?", "body": "<p>This answer is for x86-64, 64-bit Linux ABI, only.  All the other OSes and ABIs mentioned will be broadly similar, but different enough in the fine details that you will need to write your custom <code>_start</code> once for each.</p>\n\n<p>You are looking for the specification of the <em>initial process state</em> in the \"<a href=\"https://github.com/hjl-tools/x86-psABI/wiki/X86-psABI\" rel=\"nofollow noreferrer\">x86-64 psABI</a>\", or, to give it its full title, \"System V Application Binary Interface, AMD64 Architecture Processor Supplement (With LP64 and ILP32 Programming Models)\".  I will reproduce figure 3.9, \"Initial Process Stack\", here:</p>\n\n<blockquote>\n  <pre class=\"lang-none prettyprint-override\"><code>Purpose                            Start Address                  Length\n------------------------------------------------------------------------\nInformation block, including                                      varies\nargument strings, environment\nstrings, auxiliary information\n...\n------------------------------------------------------------------------\nNull auxiliary vector entry                                  1 eightbyte\nAuxiliary vector entries...                            2 eightbytes each\n0                                                              eightbyte\nEnvironment pointers...                                 1 eightbyte each\n0                                  8+8*argc+%rsp               eightbyte\nArgument pointers...               8+%rsp                argc eightbytes\nArgument count                     %rsp                        eightbyte\n</code></pre>\n</blockquote>\n\n<p>It goes on to say that the initial registers are unspecified except\nfor <code>%rsp</code>, which is of course the stack pointer, and <code>%rdx</code>, which may contain \"a function pointer to register with atexit\".</p>\n\n<p>So all the information you are looking for is already present in memory, but it hasn't been laid out according to the normal calling convention, which means you must write <code>_start</code> in assembly language.  It is <code>_start</code>'s responsibility to set everything up to call <code>main</code> with, based on the above.  A minimal <code>_start</code> would look something like this:</p>\n\n<pre class=\"lang-asm prettyprint-override\"><code>_start:\n        xorl   %ebp, %ebp       #  mark the deepest stack frame\n\n  # Current Linux doesn't pass an atexit function,\n  # so you could leave out this part of what the ABI doc says you should do\n  # You can't just keep the function pointer in a call-preserved register\n  # and call it manually, even if you know the program won't call exit\n  # directly, because atexit functions must be called in reverse order\n  # of registration; this one, if it exists, is meant to be called last.\n        testq  %rdx, %rdx       #  is there \"a function pointer to\n        je     skip_atexit      #  register with atexit\"?\n\n        movq   %rdx, %rdi       #  if so, do it\n        call   atexit\n\nskip_atexit:\n        movq   (%rsp), %rdi           #  load argc\n        leaq   8(%rsp), %rsi          #  calc argv (pointer to the array on the stack)\n        leaq   8(%rsp,%rdi,8), %rdx   #  calc envp (starts after the NULL terminator for argv[])\n        call   main\n\n        movl   %eax, %edi   # pass return value of main to exit\n        call   exit\n\n        hlt                 # should never get here\n</code></pre>\n\n<p>(Completely untested.)</p>\n\n<p>(In case you're wondering why there's no adjustment to maintain stack pointer alignment, this is because upon a normal procedure call, <code>8(%rsp)</code> is 16-byte aligned, but when <code>_start</code> is called, <code>%rsp</code> itself is 16-byte aligned.  Each <code>call</code> instruction displaces <code>%rsp</code> down by eight, producing the alignment situation expected by normal compiled functions.)</p>\n\n<p>A more thorough <code>_start</code> would do more things, such as clearing all the other registers, arranging for greater stack pointer alignment than the default if desired, calling into the C library's own initialization functions, setting up <code>environ</code>, initializing the state used by thread-local storage, doing something constructive with the auxiliary vector, etc.</p>\n\n<p>You should also be aware that if there is a dynamic linker (<code>PT_INTERP</code> section in the executable), it receives control <em>before</em> <code>_start</code> does.  Glibc's <code>ld.so</code> cannot be used with any C library other than glibc itself; if you are writing your own C library, and you want to support dynamic linkage, you will also need to write your own <code>ld.so</code>.  (Yes, this is unfortunate; ideally, the dynamic linker would be a separate development project and its complete interface would be specified.)</p>\n"}, {"comments": [{"owner": {"reputation": 71, "user_id": 7910804, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e901ccb42f19a16ddc2a0f027fb7334?s=128&d=identicon&r=PG&f=1", "display_name": "C Perfomance", "link": "https://stackoverflow.com/users/7910804/c-perfomance"}, "edited": false, "score": 0, "creation_date": 1525985850, "post_id": 50261819, "comment_id": 87579344, "body": "Could you help with the sys write of the number (argc)?"}, {"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "reply_to_user": {"reputation": 71, "user_id": 7910804, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e901ccb42f19a16ddc2a0f027fb7334?s=128&d=identicon&r=PG&f=1", "display_name": "C Perfomance", "link": "https://stackoverflow.com/users/7910804/c-perfomance"}, "edited": false, "score": 0, "creation_date": 1525987772, "post_id": 50261819, "comment_id": 87580060, "body": "@CPerfomance: StackOverflow doesn&#39;t work this way. The original question has been answered conclusively, if you have other questions you should post them separately. Besides, what you are asking is not difficult at all - you&#39;ll just have to convert the integer to a string and then write it out using the <code>write</code> syscall (that I already provided). If you don&#39;t know how to convert an integer to string without using the standard library (i.e. how to write by yourself your <code>itoa</code>), probably you should study basic algorithms before working with this kind of ultra-specific/low-level stuff."}, {"owner": {"reputation": 71, "user_id": 7910804, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e901ccb42f19a16ddc2a0f027fb7334?s=128&d=identicon&r=PG&f=1", "display_name": "C Perfomance", "link": "https://stackoverflow.com/users/7910804/c-perfomance"}, "edited": false, "score": 0, "creation_date": 1525990194, "post_id": 50261819, "comment_id": 87580925, "body": "I know that. I just wanted to make sure. Because I would probably have a way to print a direct number! Thank you for your complete answer."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1526052722, "post_id": 50261819, "comment_id": 87608064, "body": "You could implement <code>bare_write</code> as a regular function using GNU C Extended-asm, like <code>long bare_write(int fd, const char *buf, unsigned long len) { long retval; asm volatile(&quot;syscall&quot; : &quot;=a&quot;(retval) : &quot;a&quot;(__NR_write), &quot;D&quot;(fd), &quot;S&quot;(buf), &quot;d&quot;(len), &quot;m&quot;(*(const char(*)[])buf) : &quot;rcx&quot;, &quot;r11&quot;); return retval; }</code>  (<a href=\"https://godbolt.org/g/a2W8zS\" rel=\"nofollow noreferrer\">godbolt.org/g/a2W8zS</a>).  Then the compiler can take advantage of it only clobbering a couple registers, and not the arg-passing regs, and take advantage of <code>fd = __NR_write</code>."}], "tags": [], "owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "is_accepted": false, "score": 8, "last_activity_date": 1525964312, "last_edit_date": 1525964312, "creation_date": 1525898954, "answer_id": 50261819, "question_id": 50260855, "link": "https://stackoverflow.com/questions/50260855/how-get-arguments-value-using-inline-assembly-in-c-without-glibc/50261819#50261819", "title": "How Get arguments value using inline assembly in C without Glibc?", "body": "<p>As specified in the comment, <code>argc</code> and <code>argv</code> are provided on the stack, so you cannot use a regular C function to get them, even with inline assembly, as the compiler will touch the stack pointer to allocate the local variables, setup the stack frame &amp; co.; hence, <code>_start</code> must be written in assembly, as it's done in glibc (<a href=\"https://sourceware.org/git/?p=glibc.git;a=blob;f=sysdeps/i386/start.S;h=91035fa83fb7ee38a0ca5834ba1d215b4a7f78e8;hb=HEAD\" rel=\"nofollow noreferrer\">x86</a>; <a href=\"https://sourceware.org/git/?p=glibc.git;a=blob;f=sysdeps/x86_64/start.S;h=354d2e6ec78f0eaf9ab0f8ed665c2e5499388df0;hb=HEAD\" rel=\"nofollow noreferrer\">x86_64</a>). A small stub can be written to just grab the stuff and forward it to your \"real\" C entrypoint according to the regular calling convention.</p>\n\n<p>Here a minimal example of a program (both for x86 and x86_64) that reads <code>argc</code> and <code>argv</code>, prints all the values in <code>argv</code> on stdout (separated by newline) and exits using <code>argc</code> as status code; it can be compiled with the usual <code>gcc -nostdlib</code> (and <code>-static</code> to make sure <code>ld.so</code> isn't involved; not that it does any harm here).</p>\n\n<pre><code>#ifdef __x86_64__\nasm(\n        \".global _start\\n\"\n        \"_start:\\n\"\n        \"   xorl %ebp,%ebp\\n\"       // mark outermost stack frame\n        \"   movq 0(%rsp),%rdi\\n\"    // get argc\n        \"   lea 8(%rsp),%rsi\\n\"     // the arguments are pushed just below, so argv = %rbp + 8\n        \"   call bare_main\\n\"       // call our bare_main\n        \"   movq %rax,%rdi\\n\"       // take the main return code and use it as first argument for...\n        \"   movl $60,%eax\\n\"        // ... the exit syscall\n        \"   syscall\\n\"\n        \"   int3\\n\");               // just in case\n\nasm(\n        \"bare_write:\\n\"             // write syscall wrapper; the calling convention is pretty much ok as is\n        \"   movq $1,%rax\\n\"         // 1 = write syscall on x86_64\n        \"   syscall\\n\"\n        \"   ret\\n\");\n#endif\n#ifdef __i386__\nasm(\n        \".global _start\\n\"\n        \"_start:\\n\"\n        \"   xorl %ebp,%ebp\\n\"       // mark outermost stack frame\n        \"   movl 0(%esp),%edi\\n\"    // argc is on the top of the stack\n        \"   lea 4(%esp),%esi\\n\"     // as above, but with 4-byte pointers\n        \"   sub $8,%esp\\n\"          // the start starts 16-byte aligned, we have to push 2*4 bytes; \"waste\" 8 bytes\n        \"   pushl %esi\\n\"           // to keep it aligned after pushing our arguments\n        \"   pushl %edi\\n\"\n        \"   call bare_main\\n\"       // call our bare_main\n        \"   add $8,%esp\\n\"          // fix the stack after call (actually useless here)\n        \"   movl %eax,%ebx\\n\"       // take the main return code and use it as first argument for...\n        \"   movl $1,%eax\\n\"         // ... the exit syscall\n        \"   int $0x80\\n\"\n        \"   int3\\n\");               // just in case\n\nasm(\n        \"bare_write:\\n\"             // write syscall wrapper; convert the user-mode calling convention to the syscall convention\n        \"   pushl %ebx\\n\"           // ebx is callee-preserved\n        \"   movl 8(%esp),%ebx\\n\"    // just move stuff from the stack to the correct registers\n        \"   movl 12(%esp),%ecx\\n\"\n        \"   movl 16(%esp),%edx\\n\"\n        \"   mov $4,%eax\\n\"          // 4 = write syscall on i386\n        \"   int $0x80\\n\"\n        \"   popl %ebx\\n\"            // restore ebx\n        \"   ret\\n\");                // notice: the return value is already ok in %eax\n#endif\n\nint bare_write(int fd, const void *buf, unsigned count);\n\nunsigned my_strlen(const char *ch) {\n    const char *ptr;\n    for(ptr = ch; *ptr; ++ptr);\n    return ptr-ch;\n}\n\nint bare_main(int argc, char *argv[]) {\n    for(int i = 0; i &lt; argc; ++i) {\n        int len = my_strlen(argv[i]);\n        bare_write(1, argv[i], len);\n        bare_write(1, \"\\n\", 1);\n    }\n    return argc;\n}\n</code></pre>\n\n<p>Notice that here several subtleties are ignored - in particular, the <code>atexit</code> bit. All the documentation about the machine-specific startup state has been extracted from the comments in the two glibc files linked above. </p>\n"}, {"comments": [{"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 0, "creation_date": 1526015467, "post_id": 50283880, "comment_id": 87586563, "body": "Fun experiment, but this is several levels beyond scary - I wouldn&#39;t trust even a toy project to work with this stuff. :-D"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 1, "creation_date": 1526015536, "post_id": 50283880, "comment_id": 87586588, "body": "@MatteoItalia: Just to repeat the most important part of this answer:  <b>If it breaks, you get to keep both pieces.</b> :)"}], "tags": [], "owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": false, "score": 3, "last_activity_date": 1618522097, "last_edit_date": 1618522097, "creation_date": 1526003713, "answer_id": 50283880, "question_id": 50260855, "link": "https://stackoverflow.com/questions/50260855/how-get-arguments-value-using-inline-assembly-in-c-without-glibc/50283880#50283880", "title": "How Get arguments value using inline assembly in C without Glibc?", "body": "<p><strong>As a quick and dirty hack</strong>, you <em>can</em> make an executable with a compiled C function as the ELF entry point.  Just make sure you use <code>exit</code> or <code>_exit</code> instead of returning.</p>\n<p>(Link with <code>gcc -nostartfiles</code> to omit CRT but still link other libraries, and write a <code>_start()</code> in C.  Beware of ABI violations like stack alignment, e.g. use <code>-mincoming-stack-boundary=2</code> or an <code>__attribte__</code> on <code>_start</code>, as in <a href=\"https://stackoverflow.com/questions/2548486/compiling-without-libc?noredirect=1&amp;lq=1#comment109923208_2548601\">Compiling without libc</a>)</p>\n<p>If it's dynamically linked, you <em>can</em> still use glibc functions on Linux (because the dynamic linker runs glibc's init functions).  Not all systems are like this, e.g. on cygwin you definitely can't call libc functions if you (or the CRT start code) hasn't called the libc init functions in the correct order.  I'm not sure it's even guaranteed that this works on Linux, so don't depend on it except for experimentation on your own system.</p>\n<p><strong>I have used a C <code>_start(void){ ... }</code> + calling <code>_exit()</code> for making a static executable to microbenchmark some compiler-generated code with less startup overhead for <code>perf stat ./a.out</code></strong>.</p>\n<p>Glibc's  <code>_exit()</code> works even if glibc wasn't initialized (<code>gcc -O3 -static</code>), or use inline asm to run <code>xor %edi,%edi</code> / <code>mov $60, %eax</code> / <code>syscall</code> (sys_exit(0) on Linux) so you don't have to even statically link libc. (<code>gcc -O3 -nostdlib</code>)</p>\n<hr />\n<p><strong>With even more dirty hacking and UB, you can access argc and argv</strong> by knowing the x86-64 System V ABI that you're compiling for (see <a href=\"https://stackoverflow.com/questions/50260855/how-get-arguments-value-using-inline-assembly-in-c-without-glibc/50261564#50261564\">@zwol's answer</a> for a quote from ABI doc), and how the process startup state differers from the function calling convention:</p>\n<ul>\n<li><strong><code>argc</code> is where the return address would be for a normal function</strong> (pointed to by RSP).  <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Return-Address.html\" rel=\"nofollow noreferrer\">GNU C has a builtin for accessing the return address</a> of the current function (or for walking up the stack.)</li>\n<li><strong><code>argv[0]</code> is where the 7th integer/pointer arg should be (the first stack arg</strong>, just above the return address).  It happens to / seems to work to take its address and use that as an array!</li>\n</ul>\n\n<pre><code>// Works only for the x86-64 SystemV ABI; only tested on Linux.\n// DO NOT USE THIS EXCEPT FOR EXPERIMENTS ON YOUR OWN COMPUTER.\n\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n// tell gcc *this* function is called with a misaligned RSP\n__attribute__((force_align_arg_pointer))\nvoid _start(int dummy1, int dummy2, int dummy3, int dummy4, int dummy5, int dummy6, // register args\n        char *argv0) {\n\n    int argc = (int)(long)__builtin_return_address(0);  // load (%rsp), casts to silence gcc warnings.\n    char **argv = &amp;argv0;\n\n    printf(&quot;argc = %d, argv[argc-1] = %s\\n&quot;, argc, argv[argc-1]);\n\n    printf(&quot;%f\\n&quot;, 1.234);  // segfaults if RSP is misaligned\n    exit(0);\n    //_exit(0);  // without flushing stdio buffers!\n}\n</code></pre>\n\n<pre><code>   # with a version without the FP printf\npeter@volta:~/src/SO$ gcc -nostartfiles _start.c -o bare_start \npeter@volta:~/src/SO$ ./bare_start \nargc = 1, argv[argc-1] = ./bare_start\npeter@volta:~/src/SO$ ./bare_start abc def hij\nargc = 4, argv[argc-1] = hij\npeter@volta:~/src/SO$ file bare_start\nbare_start: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=af27c8416b31bb74628ef9eec51a8fc84e49550c, not stripped\n # I could have used  -fno-pie -no-pie to make a non-PIE executable\n</code></pre>\n<p>This works with or without optimization, with gcc7.3.  I was worried that without optimization, the address of <code>argv0</code> would be below <code>rbp</code> where it copies the arg, rather than its original location.  But apparently it works.</p>\n<p><code>gcc -nostartfiles</code> links glibc but <em>not</em> the CRT start files.</p>\n<p><code>gcc -nostdlib</code> omits both libraries and CRT startup files.</p>\n<p><strong>Very little of this is <em>guaranteed</em> to work, but it does in practice work with current gcc on current x86-64 Linux, and has worked in the past for years.  If it breaks, you get to keep both pieces.</strong>  IDK what C features are broken by omitting the CRT startup code and just relying on the dynamic linker to run glibc init functions.  Also, taking the address of an arg and accessing pointers above it is UB, so you could maybe get broken code-gen.  gcc7.3 happens to do what you'd expect in this case.</p>\n<p><strong>Things that definitely break</strong></p>\n<ul>\n<li><code>atexit()</code> cleanup, e.g. flushing stdio buffers.</li>\n<li><a href=\"https://stackoverflow.com/questions/2204608/does-c-call-destructors-for-global-and-class-static-variables\">static destructors</a> for static objects in dynamically-linked libraries.  (On entry to <code>_start</code>, RDX is a function pointer you should register with atexit for this reason.  In a dynamically linked executable, the dynamic linker runs before your <code>_start</code> and sets RDX before jumping to your <code>_start</code>.  Statically linked executables have RDX=0 under Linux.)</li>\n</ul>\n<hr />\n<p><code>gcc -mincoming-stack-boundary=3</code> (i.e. 2^3 = 8 bytes) is another way to get gcc to realign the stack, because the <code>-mpreferred-stack-boundary=4</code> default of 2^4 = 16 is still in place.  But that makes gcc assume under-aligned RSP for <em>all</em> functions, not just for <code>_start</code>, which is why I <a href=\"https://gcc.gnu.org/onlinedocs/gcc/x86-Function-Attributes.html\" rel=\"nofollow noreferrer\">looked in the docs</a> and found an attribute that was intended for 32-bit when the ABI transitioned from only requiring 4-byte stack alignment to the current requirement of 16-byte alignment for <code>ESP</code> in 32-bit mode.</p>\n<p>The SysV ABI requirement for 64-bit mode has always been 16-byte alignment, but gcc options let you make code that doesn't follow the ABI.</p>\n<pre><code>// test call to a function the compiler can't inline\n// to see if gcc emits extra code to re-align the stack\n\n// like it would if we'd used -mincoming-stack-boundary=3 to assume *all* functions\n// have only 8-byte (2^3) aligned RSP on entry, with the default -mpreferred-stack-boundary=4\nvoid foo() {\n    int i = 0;\n    atoi(NULL);\n}\n</code></pre>\n<p>With <code>-mincoming-stack-boundary=3</code>, we get stack-realignment code there, where we don't need it.  gcc's stack-realignment code is pretty clunky, so we'd like to avoid that.  (Not that you'd really ever use this to compile a significant program where you care about efficiency, please only use this stupid computer trick as a learning experiment.)</p>\n<p>But anyway, <a href=\"https://gcc.godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(j:1,lang:c%2B%2B,source:%27%23include+%3Cstdio.h%3E%0A%23include+%3Cstdlib.h%3E%0A%0A//+tell+gcc+*this*+function+is+called+with+a+misaligned+RSP%0A__attribute__((force_align_arg_pointer))%0Avoid+_start(int+dummy1,+int+dummy2,+int+dummy3,+int+dummy4,+int+dummy5,+int+dummy6,+//+register+args%0A%09++++char+*argv0)+%7B%0A%0A%09int+argc+%3D+(int)(long)__builtin_return_address(0)%3B++//+load+(%25rsp),+casts+to+silence+gcc+warnings.%0A%09char+**argv+%3D+%26argv0%3B%0A%0A%09printf(%22argc+%3D+%25d,+argv%5Bargc-1%5D+%3D+%25s%5Cn%22,+argc,+argv%5Bargc-1%5D)%3B%0A%0A%09printf(%22%25f%5Cn%22,+1.234)%3B++//+segfaults+because+if+RSP+is+misaligned%0A%09exit(0)%3B%0A%09//_exit(0)%3B++//+without+flushing+stdio+buffers!!%0A%7D%0A%0A%0A%0A//+test+call+to+a+function+the+compiler+can!%27t+inline%0A//+to+see+if+gcc+emits+extra+code+to+re-align+the+stack%0A%0A//+like+it+would+if+we!%27d+used+-mincoming-stack-boundary%3D3+to+assume+*all*+functions%0A//+have+only+8-byte+(2%5E3)+aligned+RSP+on+entry,+with+the+default+-mpreferred-stack-boundary%3D4%0Avoid+foo()+%7B%0A%09volatile+int+i+%3D+atoi(%22345%22)%3B%0A%7D%0A//+my+local+gcc+still+calls+strtol+if+I+don!%27t+store+the+result+of+atoi(NULL)%0A//+but+on+Godbolt+it+doesn!%27t.%0A%27),l:%275%27,n:%270%27,o:%27C%2B%2B+source+%231%27,t:%270%27)),k:39.26106374340236,l:%274%27,n:%270%27,o:%27%27,s:0,t:%270%27),(g:!((h:compiler,i:(compiler:g73,filters:(b:%270%27,binary:%271%27,commentOnly:%270%27,demangle:%270%27,directives:%270%27,execute:%271%27,intel:%270%27,trim:%271%27),lang:c%2B%2B,libs:!(),options:%27-Wall+-O2%27,source:1),l:%275%27,n:%270%27,o:%27x86-64+gcc+7.3+(Editor+%231,+Compiler+%231)+C%2B%2B%27,t:%270%27)),k:30.674995976672047,l:%274%27,m:100,n:%270%27,o:%27%27,s:0,t:%270%27),(g:!((h:compiler,i:(compiler:g73,filters:(b:%270%27,binary:%271%27,commentOnly:%270%27,demangle:%270%27,directives:%270%27,execute:%271%27,intel:%270%27,trim:%271%27),lang:c%2B%2B,libs:!(),options:%27-Wall+-O2+-mincoming-stack-boundary%3D3%27,source:1),l:%275%27,n:%270%27,o:%27x86-64+gcc+7.3+(Editor+%231,+Compiler+%232)+C%2B%2B%27,t:%270%27)),k:30.063940279925593,l:%274%27,n:%270%27,o:%27%27,s:0,t:%270%27)),l:%272%27,n:%270%27,o:%27%27,t:%270%27)),version:4\" rel=\"nofollow noreferrer\">see the code on the Godbolt compiler explorer with and without <code>-mpreferred-stack-boundary=3</code></a>.</p>\n"}], "owner": {"reputation": 71, "user_id": 7910804, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e901ccb42f19a16ddc2a0f027fb7334?s=128&d=identicon&r=PG&f=1", "display_name": "C Perfomance", "link": "https://stackoverflow.com/users/7910804/c-perfomance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1794, "favorite_count": 2, "answer_count": 3, "score": 3, "last_activity_date": 1618522097, "creation_date": 1525894619, "last_edit_date": 1525990312, "question_id": 50260855, "link": "https://stackoverflow.com/questions/50260855/how-get-arguments-value-using-inline-assembly-in-c-without-glibc", "title": "How Get arguments value using inline assembly in C without Glibc?", "body": "<p>How Get arguments value using inline assembly in C without Glibc?</p>\n\n<p>i require this code for <code>Linux</code> archecture <code>x86_64</code> and <code>i386</code>.\nif you know about <code>MAC OS X</code> or <code>Windows</code> , also submit and please guide.</p>\n\n<pre><code>void exit(int code)\n{\n    //This function not important!\n    //...\n}\nvoid _start()\n{\n    //How Get arguments value using inline assembly\n    //in C without Glibc?\n    //argc\n    //argv\n    exit(0);\n}\n</code></pre>\n\n<hr>\n\n<h2>New Update</h2>\n\n<p><a href=\"https://gist.github.com/apsun/deccca33244471c1849d29cc6bb5c78e\" rel=\"nofollow noreferrer\">https://gist.github.com/apsun/deccca33244471c1849d29cc6bb5c78e</a></p>\n\n<p>and </p>\n\n<pre><code>#define ReadRdi(To) asm(\"movq %%rdi,%0\" : \"=r\"(To));\n#define ReadRsi(To) asm(\"movq %%rsi,%0\" : \"=r\"(To));\nlong argcL;\nlong argvL;\nReadRdi(argcL);\nReadRsi(argvL);\nint argc = (int) argcL;\n//char **argv = (char **) argvL;\nexit(argc);\n</code></pre>\n\n<p>But it still returns 0.\nSo this code is wrong!\nplease help.</p>\n"}, {"tags": ["c", "sdl"], "comments": [{"owner": {"reputation": 25, "user_id": 9766965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21c0d66e119cf1c119b5bd55a9616ffb?s=128&d=identicon&r=PG&f=1", "display_name": "Maciej Kr&#243;l", "link": "https://stackoverflow.com/users/9766965/maciej-kr%c3%b3l"}, "edited": false, "score": 0, "creation_date": 1525894595, "post_id": 50260634, "comment_id": 87539704, "body": "I was trying to change formats of surfaces from bmp to png and i tried changing SDL_RENDERER_ACCELERATED for SDL_RENDERER_SOFTWARE and it didnt work also"}, {"owner": {"reputation": 15473, "user_id": 744720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65030f1bd22dbb4d1e6976cfac08a1c5?s=128&d=identicon&r=PG", "display_name": "keltar", "link": "https://stackoverflow.com/users/744720/keltar"}, "edited": false, "score": 0, "creation_date": 1525925343, "post_id": 50260634, "comment_id": 87548662, "body": "Calling your functions <code>free</code> and <code>close</code> is a really bad idea that will bite you at every step. Don&#39;t use standard library names."}], "answers": [{"comments": [{"owner": {"reputation": 15415, "user_id": 982257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pRf2i.jpg?s=128&g=1", "display_name": "Iguananaut", "link": "https://stackoverflow.com/users/982257/iguananaut"}, "edited": false, "score": 0, "creation_date": 1525897909, "post_id": 50261485, "comment_id": 87541210, "body": "As an aside, in <code>Inicjalizacja</code> you might consider just returning <code>false</code> as soon as some operation fails, rather that using the <code>success</code> variable and deep nesting.  You can see that for each operation, if any of the preceding operations failed then the initialization is unsuccessful, so you might as well un-nest everything and just perform all the operations one by one, returning <code>false</code> as soon as one fails."}, {"owner": {"reputation": 25, "user_id": 9766965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21c0d66e119cf1c119b5bd55a9616ffb?s=128&d=identicon&r=PG&f=1", "display_name": "Maciej Kr&#243;l", "link": "https://stackoverflow.com/users/9766965/maciej-kr%c3%b3l"}, "edited": false, "score": 0, "creation_date": 1525900818, "post_id": 50261485, "comment_id": 87542547, "body": "Thank you very much know everything is ok"}], "tags": [], "owner": {"reputation": 15415, "user_id": 982257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pRf2i.jpg?s=128&g=1", "display_name": "Iguananaut", "link": "https://stackoverflow.com/users/982257/iguananaut"}, "is_accepted": true, "score": 3, "last_activity_date": 1525897563, "creation_date": 1525897563, "answer_id": 50261485, "question_id": 50260634, "link": "https://stackoverflow.com/questions/50260634/invalid-renderer-sdl2/50261485#50261485", "title": "Invalid renderer SDL2", "body": "<p>When you get to <code>Odczyt_z_Pliku</code>, <code>Renderer</code> is still a <code>NULL</code> pointer.</p>\n\n<p>As it stands, in your <code>main()</code> function you have a variable <code>Renderer</code> of type <code>SDL_Renderer*</code> (initialized to <code>NULL</code>).  You then pass that value <code>NULL</code> into SDL_Renderer* which also takes an argument of type <code>SDL_Renderer*</code>.</p>\n\n<p>However, in C this is just a pass by copy of the value of the pointer itself (not the value pointed to by the pointer).  In other words, the argument <code>Renderer</code> to your function just creates a local variable in that function.  So in <code>Odczyt_z_Pliku</code> when you do <code>Renderer = SDL_CreateRenderer(...);</code> that may return a new pointer but it's only assigning it to the local variable <code>Renderer</code>, but this has no effect on the <code>Renderer</code> variable in your <code>main()</code> function.</p>\n\n<p>In C, the way to write a function that sets the value of a pointer that is a local variable in the calling function is to use a <em>double pointer</em>.  That is, change the signature of <code>Inicjalizacja</code> to</p>\n\n<pre><code>bool Inicjalizacja(SDL_Window **Okno, SDL_Renderer **Renderer)\n</code></pre>\n\n<p>then in <code>main()</code> (or wherever else) call it like:</p>\n\n<pre><code>SDL_Window * Okno = NULL;\nSDL_Renderer* Renderer = NULL;\n...\nif (!Inicjalizacja(&amp;Okno, &amp;Renderer)) {\n...\n}\n</code></pre>\n\n<p>and so on.  <em>(Note: You made the same mistake with the <code>SDL_Window</code> Okno as well, and possibly elsewhere--I haven't read the full code).</em></p>\n\n<p>The syntax <code>&amp;Okno</code> means pass the address of (i.e. a pointer to) the variable <code>Okno</code>.  Since <code>Okno</code> is itself a pointer, the address of the pointer is a <em>double pointer</em>.</p>\n\n<p>Then in <code>Inicjalizacja</code> write:</p>\n\n<pre><code>*Renderer = SDL_CreateRenderer(...);\n</code></pre>\n\n<p>and similarly with <code>Okno</code>.  The <code>*Renderer</code> syntax (which I find somewhat confusing) means the value pointed to by a pointer.  Since <code>Renderer</code> here is a double pointer, this means assign the <em>single pointer</em> (of type <code>Renderer*</code>) into the pointer pointed to by <code>Renderer</code>.  Now the <code>Renderer*</code> pointer in your <code>main()</code> function will be properly initialized.</p>\n\n<p>Note, similarly you should change the following check to:</p>\n\n<pre><code>if (*Renderer == NULL) {...}\n</code></pre>\n\n<p>and so on.  We <em>know</em> <code>Renderer != NULL</code> since it's a pointer to a local variable allocated in our <code>main()</code> function.  The interesting question is what value <code>SDL_CreateRenderer</code> returned, so we want to look at <code>*Renderer</code>.</p>\n"}], "owner": {"reputation": 25, "user_id": 9766965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21c0d66e119cf1c119b5bd55a9616ffb?s=128&d=identicon&r=PG&f=1", "display_name": "Maciej Kr&#243;l", "link": "https://stackoverflow.com/users/9766965/maciej-kr%c3%b3l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 613, "favorite_count": 0, "accepted_answer_id": 50261485, "answer_count": 1, "score": 1, "last_activity_date": 1525901375, "creation_date": 1525893633, "last_edit_date": 1525901375, "question_id": 50260634, "link": "https://stackoverflow.com/questions/50260634/invalid-renderer-sdl2", "title": "Invalid renderer SDL2", "body": "<p>I am looking through the code and i cant find solution for the problem of invalid renderer. I am beginner with SDL2 and i have to write code in pure C.\nI think that in my code there is more errors but because of this one i cant go further. Code is half in polish language so if u cant get what is where i can rewrite this a bit . Problem occure when in main i try to load function\"Odczyt_z_Pliku\". Probably somewhere there is a problem.\nSDL_GetError() says\" invalid renderer.</p>\n\n<pre><code>            #include&lt;SDL.h&gt;\n        #include&lt;stdio.h&gt;\n        #include&lt;SDL_image.h&gt;\n        #pragma warning(disable : 4996)\n        #define WYSOKOSC_EKRANU 768\n        #define SZEROKOSC_EKRANU 1024\n\n        typedef enum bool{\n            false,true\n        }bool;\n\n        typedef struct sTekstura {\n            int wysokosc;\n            int szerokosc;\n            SDL_Texture *Tekstura;\n\n        }sTekstura;\n\n        void IniTekstury(sTekstura T)\n        {\n            T.wysokosc = 0;\n            T.szerokosc = 0;\n            T.Tekstura = NULL;\n        }\n\n        void free(sTekstura T)\n        {\n            //Free texture if it exists\n            if (T.Tekstura != NULL)\n            {\n                SDL_DestroyTexture(T.Tekstura);\n                T.Tekstura = NULL;\n                T.szerokosc = 0;\n                T.wysokosc = 0;\n            }\n        }\n\n        int Odczyt_z_Pliku(char nazwa[50],sTekstura T,SDL_Renderer* Renderer)\n        {\n            free(T);\n\n            SDL_Texture* nTekstura = NULL;\n\n            //Load image at specified path\n            SDL_Surface* Powierzchnia = IMG_Load(nazwa);\n            if (Powierzchnia == NULL)\n            {\n                printf(\"Unable to load image %s! SDL_image Error: %s\\n\", nazwa, IMG_GetError());\n            }\n            else\n            {\n                SDL_SetColorKey(Powierzchnia, SDL_TRUE, SDL_MapRGB(Powierzchnia-&gt;format, 0xFF, 0xFF, 0xFF));\n\n                //Create texture from surface pixels\n                nTekstura = SDL_CreateTextureFromSurface(Renderer, Powierzchnia);\n                if (nTekstura == NULL)\n                {\n                    printf(\"Unable to create texture from %s! SDL Error: %s\\n\", nazwa, SDL_GetError());\n                }\n                else\n                {\n                    //Get image dimensions\n                    T.szerokosc = Powierzchnia-&gt;w;\n                    T.wysokosc = Powierzchnia-&gt;h;\n                }\n\n                //Get rid of old loaded surface\n                SDL_FreeSurface(Powierzchnia);\n            }\n\n            //Return success\n            T.Tekstura = nTekstura;\n            if (T.Tekstura != NULL)\n            {\n                return 1;\n            }\n            else\n            {\n                return 0;\n            }\n\n\n        }\n        bool Inicjalizacja(SDL_Window *Okno,SDL_Renderer *Renderer)\n        {\n            //Initialization flag\n            bool success = true;\n\n            //Initialize SDL\n            if (SDL_Init(SDL_INIT_VIDEO) &lt; 0)\n            {\n                printf(\"SDL could not initialize! SDL Error: %s\\n\", SDL_GetError());\n                success = false;\n            }\n            else\n            {\n                //Set texture filtering to linear\n                if (!SDL_SetHint(SDL_HINT_RENDER_SCALE_QUALITY, \"1\"))\n                {\n                    printf(\"Warning: Linear texture filtering not enabled!\");\n                }\n\n                //Create window\n                Okno = SDL_CreateWindow(\"SDL Tutorial\", SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, SZEROKOSC_EKRANU, WYSOKOSC_EKRANU, SDL_WINDOW_SHOWN);\n                if (Okno == NULL)\n                {\n                    printf(\"Window could not be created! SDL Error: %s\\n\", SDL_GetError());\n                    success = false;\n                }\n                else\n                {\n                    //Create renderer for window\n                    Renderer = SDL_CreateRenderer(Okno, -1, SDL_RENDERER_ACCELERATED | SDL_RENDERER_PRESENTVSYNC);\n                    if (Renderer == NULL)\n                    {\n                        printf(\"Renderer could not be created! SDL Error: %s\\n\", SDL_GetError());\n                        success = false;\n                    }\n                    else\n                    {\n                        //Initialize renderer color\n                        SDL_SetRenderDrawColor(Renderer, 0xFF, 0xFF, 0xFF, 0xFF);\n\n\n                        //Initialize PNG loading\n                        int imgFlags = IMG_INIT_PNG;\n                        if (!(IMG_Init(imgFlags) &amp; imgFlags))\n                        {\n                            printf(\"SDL_image could not initialize! SDL_image Error: %s\\n\", IMG_GetError());\n                            success = false;\n                        }\n                    }\n                }\n            }\n\n            return success;\n        }\n        void setBlendMode(sTekstura T, SDL_BlendMode blending) //MK: Funkcja ustawiaj\u0105ca przezroczystosc\n        {\n            //Set blending function\n            SDL_SetTextureBlendMode(T.Tekstura, blending);\n        }\n\n        void setAlpha(sTekstura T,Uint8 alpha)  //MK: Funkcja ustawiaj\u0105ca przezroczysto\u015b\u0107\n        {\n            //Modulate texture alpha\n            SDL_SetTextureAlphaMod(T.Tekstura, alpha);\n        }\n        void render(int x, int y,sTekstura T,SDL_Renderer *Renderer)\n        {\n            //Set rendering space and render to screen\n            SDL_Rect renderQuad = { x, y, T.szerokosc, T.wysokosc };\n            SDL_RenderCopy(Renderer, T.Tekstura, NULL, &amp;renderQuad);\n        }\n\n\n        int main(int argc, char *argv[])\n        {\n            SDL_Window * Okno = NULL;\n            SDL_Renderer* Renderer = NULL;\n            sTekstura TloMenu;\n            TloMenu.szerokosc = 0;\n            TloMenu.wysokosc = 0;\n            TloMenu.Tekstura = NULL;\n            sTekstura TloGra;\n            TloGra.szerokosc = 0;\n            TloGra.wysokosc = 0;\n            TloGra.Tekstura = NULL;\n            sTekstura Pudlo;\n            Pudlo.szerokosc = 0;\n            Pudlo.wysokosc = 0;\n            Pudlo.Tekstura = NULL;\n            sTekstura Sciana;\n            Sciana.szerokosc = 0;\n            Sciana.wysokosc = 0;\n            Sciana.Tekstura = NULL;\n            sTekstura StartGry;\n            StartGry.szerokosc = 0;\n            StartGry.wysokosc = 0;\n            StartGry.Tekstura = NULL;\n            sTekstura KoniecGry;\n            KoniecGry.szerokosc = 0;\n            KoniecGry.wysokosc = 0;\n            KoniecGry.Tekstura = NULL;\n            SDL_Event e;\n\n            //Start up SDL and create window\n            if (!Inicjalizacja(Okno,Renderer))\n            {\n\n                printf(\"Failed to initialize!\\n\");\n            }\n            else\n            {\n\n                if(!Odczyt_z_Pliku(\"MENU BOMBERMAN.png\", Sciana, Renderer))\n                {\n                    puts(\"Nie wczytano kostki\");\n                    return 0;\n                }\n                if (!Odczyt_z_Pliku(\"pudlo3.bmp\", Pudlo, Renderer))\n                {\n                    puts(\"Nie wczytano pudla\");\n                    return 0;\n                }\n                if (!Odczyt_z_Pliku(\"MenuBomberman.bmp\", TloMenu, Renderer))\n                {\n                    puts(\"Nie wczytano menu\");\n                    return 0;\n                }\n                if (!Odczyt_z_Pliku(\"Mapa.bmp\", TloGra, Renderer))\n                {\n                    puts(\"Nie wczytano mapy\");\n                    return 0;\n                }\n                if (!Odczyt_z_Pliku(\"NEW GAME.bmp\", StartGry, Renderer))\n                {\n                    puts(\"Nie wczytano napisu nowej gry\");\n                    return 0;\n                }\n                else\n                {\n                    //Set standard alpha blending\n                    setBlendMode(StartGry, SDL_BLENDMODE_BLEND);\n                }\n                if (!Odczyt_z_Pliku(\"exitgimp.bmp\", KoniecGry, Renderer))\n                {\n                    puts(\"Nie wczytano napisu koniec gry\");\n                    return 0;\n                }\n                else\n                {\n                    //Set standard alpha blending\n                    setBlendMode(StartGry, SDL_BLENDMODE_BLEND);\n                }\n\n\n                    //Main loop flag\n                    bool quit = false;\n\n                    //Modulation component\n                    Uint8 AlphaStartu = 255;\n                    Uint8 AlphaKonca = 127;\n\n                    //While application is running\n                    while (!quit)\n                    {\n                        //Handle events on queue\n                        while (SDL_PollEvent(&amp;e) != 0)\n                        {\n                            //User requests quit\n                            if (e.type == SDL_QUIT)\n                            {\n                                quit = true;\n                            }\n                            //Handle key presses\n                            else if (e.type == SDL_KEYDOWN)\n                            {\n                                //Increase alpha on w\n                                if (e.key.keysym.sym == SDLK_w)\n                                {\n                                    AlphaKonca = 127;\n                                    AlphaStartu = 255;\n                                }\n                                //Decrease alpha on s\n                                else if (e.key.keysym.sym == SDLK_s)\n                                {\n                                    AlphaKonca = 256;\n                                    AlphaStartu = 127;\n                                }\n                            }\n                        }\n\n                        //Clear screen\n                        SDL_SetRenderDrawColor(Renderer, 0xFF, 0xFF, 0xFF, 0xFF);\n                        SDL_RenderClear(Renderer);\n\n                        //Render background\n                        render(0, 0, TloMenu, Renderer);\n\n                        //Render front blended\n                        setAlpha(KoniecGry,AlphaKonca);\n                        setAlpha(StartGry, AlphaStartu);\n                        render(0, 0,StartGry,Renderer);\n                        render(0, 0,KoniecGry,Renderer);\n\n                        //Update screen\n                        SDL_RenderPresent(Renderer);\n                    }\n\n            }\n\n            //Free resources and close SDL\n            close();\n\n            return 0;\n        }\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1525893652, "post_id": 50260619, "comment_id": 87539223, "body": "Just make it <code>arr[current - 97]++;</code> ..."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1525893788, "post_id": 50260619, "comment_id": 87539294, "body": "Your code subtracts <code>97</code> (possibly <code>&#39;a&#39;</code>) when <code>isupper(current)</code> is true (please look up <code>isupper()</code> etc). <code>32</code> is added and then <code>97</code> subtracted. So you then use a negative index in <code>arr[current]++;</code>"}, {"owner": {"reputation": 67, "user_id": 9612321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e537f9b51b20a0f1c609b16b78848de?s=128&d=identicon&r=PG&f=1", "display_name": "verrrilog", "link": "https://stackoverflow.com/users/9612321/verrrilog"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1525893828, "post_id": 50260619, "comment_id": 87539314, "body": "@EugeneSh. what if I want to use <code>arr[current]</code> without using math in the <code>[]</code>"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1525894028, "post_id": 50260619, "comment_id": 87539426, "body": "You could try making it <code>unsigned char</code>."}], "answers": [{"comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1525893894, "post_id": 50260664, "comment_id": 87539345, "body": "<code>int</code> can be negative too, but it won&#39;t warn."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1525893949, "post_id": 50260664, "comment_id": 87539378, "body": "@EugeneSh.<code>int</code> won&#39;t change signedness from platform to platform, which is apparently what the warning is worried about."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1525894106, "post_id": 50260664, "comment_id": 87539467, "body": "Given the tests and assuming ASCII, both <code>current - &#39;A&#39;</code> and <code>current   - &#39;a&#39;</code> are in the range <code>0..25</code>. The <code>char</code> variable is promoted to <code>int</code> before the subtraction and the result has type <code>int</code> which does not produce a warning."}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": false, "score": 1, "last_activity_date": 1525894022, "last_edit_date": 1525894022, "creation_date": 1525893770, "answer_id": 50260664, "question_id": 50260619, "link": "https://stackoverflow.com/questions/50260619/error-array-subscript-has-type-char-in-a-function-c/50260664#50260664", "title": "error: array subscript has type &#39;char&#39; in a function (C)", "body": "<p>The <code>char</code> type can be signed or unsigned depending on the compiler configuration. The warning tells you that is <code>current</code> happens to be negative, the code would have undefined behavior as you would probably access and attempt to modify a byte outside the array boundaries. Given your code and assuming the target system uses ASCII, it is not going to happen.</p>\n\n<p>You can prevent the warning by computing the offset from <code>'a'</code> directly as an <code>int</code> expression instead of updating the <code>char</code> variable.</p>\n\n<p>Here is a modified version, that still assumes ASCII but uses more explicit character values:</p>\n\n<pre><code>void count(int arr[N]) {\n    char current;\n    while (scanf(\" %c\", &amp;current) &gt; 0 &amp;&amp; current != '#') {\n        if (current &gt;= 'A' &amp;&amp; current &lt;= 'Z') {\n            arr[current - 'A']++;\n        } else if (current &gt;= 'a' &amp;&amp; current &lt;= 'z') {\n            arr[current - 'a']++;\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 9612321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e537f9b51b20a0f1c609b16b78848de?s=128&d=identicon&r=PG&f=1", "display_name": "verrrilog", "link": "https://stackoverflow.com/users/9612321/verrrilog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "closed_date": 1525894193, "answer_count": 1, "score": 1, "last_activity_date": 1525894022, "creation_date": 1525893579, "question_id": 50260619, "link": "https://stackoverflow.com/questions/50260619/error-array-subscript-has-type-char-in-a-function-c", "closed_reason": "Duplicate", "title": "error: array subscript has type &#39;char&#39; in a function (C)", "body": "<p>I wrote the following function in C:</p>\n\n<pre><code>void count(int arr[N]) {\n    char current;\n    while(scanf(\" %c\", &amp;current) &gt; 0 &amp;&amp; (current != '#'))\n    {\n        if(current &gt;= 'A' &amp;&amp; current &lt;= 'Z') {\n            current += 32;\n        } else if(current &lt; 'a' || current &gt; 'z') {\n            continue;\n        }\n        current -= 97;\n        arr[current]++;\n    }\n}\n</code></pre>\n\n<p>Although I get a warning when compiling: <code>error: array subscript has type 'char'</code>. Cant I user <code>current</code> as <code>int</code> value? </p>\n"}, {"tags": ["c", "linux", "glibc"], "comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1525891464, "post_id": 50260082, "comment_id": 87538155, "body": "<b>Don&#39;t fork in a multi-threaded process</b> (except when followed by <code>exec</code>). <i>&quot;After a fork() in a multithreaded program, the child can safely call only async-signal-safe functions (see signal-safety(7)) until such time as it calls execve(2).&quot;</i>"}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1525891504, "post_id": 50260082, "comment_id": 87538179, "body": "@AnttiHaapala: Calling <code>popen</code> from a multi-threaded process is completely valid and reasonable. So is calling <code>fork</code> then immediately one of the exec-family functions (although in that case <code>posix_spawn</code> would be preferable)."}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 0, "creation_date": 1525891874, "post_id": 50260082, "comment_id": 87538381, "body": "Can you show a full backtrace, not just the first 3 frames?"}, {"owner": {"reputation": 59, "user_id": 6855706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/218bc3dceef2d46f7d86a5d9c8a4b0b1?s=128&d=identicon&r=PG&f=1", "display_name": "S. Forman", "link": "https://stackoverflow.com/users/6855706/s-forman"}, "edited": false, "score": 0, "creation_date": 1525901594, "post_id": 50260082, "comment_id": 87542833, "body": "In our 54 threaded process, there are 17 threads deadlocked in __lll_lock_wait_private.  One of the threads had __fopen_internal() as the 3rd frame.  Other threads have our local functions as the 3rd frame."}], "answers": [{"comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1525891814, "post_id": 50260139, "comment_id": 87538342, "body": "Well, it wasn&#39;t me."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 0, "creation_date": 1525895235, "post_id": 50260139, "comment_id": 87539998, "body": "Not my downvote. But, the bug report does not involve any async safe call violations. Have an upvote."}, {"owner": {"reputation": 59, "user_id": 6855706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/218bc3dceef2d46f7d86a5d9c8a4b0b1?s=128&d=identicon&r=PG&f=1", "display_name": "S. Forman", "link": "https://stackoverflow.com/users/6855706/s-forman"}, "edited": false, "score": 0, "creation_date": 1525901717, "post_id": 50260139, "comment_id": 87542874, "body": "R, thanks for your answer.  The popen call is made from a pthread function as follows: popen(&quot;ntpq -p | awk &#39;NR==3 {print $9}&#39;&quot;, &quot;r&quot;)).  But when I run &quot;ntpq -p&quot; from the command line, I get a &quot;ntpq: read: Connection refused&quot; error.  Do you think the error from ntpq could cause this problem?"}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 0, "creation_date": 1525923069, "post_id": 50260139, "comment_id": 87548033, "body": "Please don&#39;t accept my answer at this time, as I don&#39;t think it&#39;s solved your problem."}], "tags": [], "owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "is_accepted": false, "score": 4, "last_activity_date": 1525891459, "creation_date": 1525891459, "answer_id": 50260139, "question_id": 50260082, "link": "https://stackoverflow.com/questions/50260082/deadlock-in-malloc-atfork/50260139#50260139", "title": "Deadlock in malloc_atfork", "body": "<p>While this is a bug in glibc, it should not be able to happen except when you are calling <code>fork</code> from an async-signal context, where it has interrupted code that's already holding the <code>malloc</code> lock and the interrupted code cannot make forward progress. Otherwise, it's another thread holding the lock, and that thread should eventually make forward progress and allow the <code>fork</code> to continue.</p>\n\n<p>Are you possibly calling <code>popen</code> from a signal handler? If so, that's not valid usage, and you should expect it to be able to fail in many other ways, not just this one.</p>\n"}], "owner": {"reputation": 59, "user_id": 6855706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/218bc3dceef2d46f7d86a5d9c8a4b0b1?s=128&d=identicon&r=PG&f=1", "display_name": "S. Forman", "link": "https://stackoverflow.com/users/6855706/s-forman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 838, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1525894992, "creation_date": 1525891228, "last_edit_date": 1525894992, "question_id": 50260082, "link": "https://stackoverflow.com/questions/50260082/deadlock-in-malloc-atfork", "title": "Deadlock in malloc_atfork", "body": "<p>Our multi-threaded process is deadlocked in several threads, each showing the 3 frames below at the top of the stack.  GDB shows that another thread is stuck in fork (called via popen), which is presumably why malloc_atfork, instead of malloc, is being called to allocate memory.</p>\n\n<pre><code>#0  0x00007f4f02c4aeec in __lll_lock_wait_private () from \n/usr/lib64/libc.so.6\n#1  0x00007f4f02bc807c in _L_lock_14817 () from /usr/lib64/libc.so.6\n#2  0x00007f4f02bc51df in malloc_atfork () from /usr/lib64/libc.so.6\n</code></pre>\n\n<p>There is a RedHat bug (<a href=\"https://bugzilla.redhat.com/show_bug.cgi?id=906468\" rel=\"nofollow noreferrer\">https://bugzilla.redhat.com/show_bug.cgi?id=906468</a>) about a deadlock in glibc between fork and malloc and other reports about deadlocks in malloc_atfork.  </p>\n\n<p>And this link, <a href=\"https://sourceware.org/ml/libc-alpha/2016-02/msg00269.html\" rel=\"nofollow noreferrer\">https://sourceware.org/ml/libc-alpha/2016-02/msg00269.html</a>, from Feb, 2016, contains a patch for removing malloc_atfork.</p>\n\n<p>Does anyone know a solution to this problem?</p>\n"}, {"tags": ["c", "error-handling", "goto"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 3, "creation_date": 1525890922, "post_id": 50259991, "comment_id": 87537865, "body": "<i>I was trying to convert this piece of code to a code that uses just gotos</i> - Why???"}, {"owner": {"reputation": 43, "user_id": 9360669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4wvRY.jpg?s=128&g=1", "display_name": "donpwner", "link": "https://stackoverflow.com/users/9360669/donpwner"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1525891094, "post_id": 50259991, "comment_id": 87537944, "body": "I want to learn about the goto  construct .Plus it is a good step to convert the code to assembly"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1525891111, "post_id": 50259991, "comment_id": 87537957, "body": "You should <b>fix</b> your code."}, {"owner": {"reputation": 43, "user_id": 9360669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4wvRY.jpg?s=128&g=1", "display_name": "donpwner", "link": "https://stackoverflow.com/users/9360669/donpwner"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1525891195, "post_id": 50259991, "comment_id": 87538001, "body": "@Antti what do you mean?"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 2, "creation_date": 1525891207, "post_id": 50259991, "comment_id": 87538009, "body": "Also, you shouldn&#39;t <i>ever</i> use the xor swap - if the compiler <b>is not smart</b>, <i>it doesn&#39;t know to replace the xor swap with swap that uses an intermediate variable</i>."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1525891208, "post_id": 50259991, "comment_id": 87538010, "body": "There&#39;s very little need to learn about the goto construct, and why do you think you need to convert it into assembly.  The xor-swapping algorithm isn&#39;t very sensible, either \u2014 it is a bad way to do the swap."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1525891330, "post_id": 50259991, "comment_id": 87538080, "body": "So you have learnt about <code>goto</code> very well now. The lesson is that it is very hard to follow and debug and thus you should avoid it."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1525891356, "post_id": 50259991, "comment_id": 87538099, "body": "@AnttiHaapala worth mentioning that XOR swap will give your zeroes if the values being swapped are already equal."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 2, "creation_date": 1525891430, "post_id": 50259991, "comment_id": 87538142, "body": "@ChristianGibbons hem?"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1525891540, "post_id": 50259991, "comment_id": 87538200, "body": "@AnttiHaapala If you are trying to swap A and B with XOR swap, well the first step is <code>A XOR B</code>.  If A = B, then you get <code>A XOR A</code> which is 0."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 2, "creation_date": 1525891558, "post_id": 50259991, "comment_id": 87538210, "body": "@ChristianGibbons I think you have a misunderstanding about the XOR swapping.. <a href=\"https://en.wikipedia.org/wiki/XOR_swap_algorithm\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/XOR_swap_algorithm</a>"}, {"owner": {"reputation": 43, "user_id": 9360669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4wvRY.jpg?s=128&g=1", "display_name": "donpwner", "link": "https://stackoverflow.com/users/9360669/donpwner"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1525891572, "post_id": 50259991, "comment_id": 87538218, "body": "@Antti so should I just use a normal swap ?"}, {"owner": {"reputation": 43, "user_id": 9360669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4wvRY.jpg?s=128&g=1", "display_name": "donpwner", "link": "https://stackoverflow.com/users/9360669/donpwner"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1525891595, "post_id": 50259991, "comment_id": 87538234, "body": "@Eugene I can tell :)"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 4, "creation_date": 1525891696, "post_id": 50259991, "comment_id": 87538279, "body": "But  xor swap will fail if trying to swap the same <i>object</i> with itself, not the same value. It can happen when working with arrays..."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1525892003, "post_id": 50259991, "comment_id": 87538448, "body": "@EugeneSh. Oh, okay, I see what you mean.  Important distinction."}, {"owner": {"reputation": 43, "user_id": 9360669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4wvRY.jpg?s=128&g=1", "display_name": "donpwner", "link": "https://stackoverflow.com/users/9360669/donpwner"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1525892352, "post_id": 50259991, "comment_id": 87538616, "body": "@Antti why should the compiler replace the xor swap with the intuitive swap?"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1525892367, "post_id": 50259991, "comment_id": 87538622, "body": "Yes, you should use an intermediate variable. It will result in faster code. The one that @EugeneSh. mentions cannot happen in <i>your</i> code because of the <code>+ 1</code>, the zeroing can only happen when you&#39;re swapping the an object with <i>itself</i>, not 2 distinct objects having the same value. Nevertheless, you should unlearn it."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1525892388, "post_id": 50259991, "comment_id": 87538630, "body": "@donpwner the intuitive swap is <i>faster</i>."}, {"owner": {"reputation": 43, "user_id": 9360669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4wvRY.jpg?s=128&g=1", "display_name": "donpwner", "link": "https://stackoverflow.com/users/9360669/donpwner"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1525894267, "post_id": 50259991, "comment_id": 87539553, "body": "@AnttiHaapala I see thanks"}], "answers": [{"comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1525892606, "post_id": 50260361, "comment_id": 87538737, "body": "Or from the perspective of transforming the original code to the new code, the <code>n--</code> in the control statement of the <code>for</code> loop has not been transformed into anything."}, {"owner": {"reputation": 43, "user_id": 9360669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4wvRY.jpg?s=128&g=1", "display_name": "donpwner", "link": "https://stackoverflow.com/users/9360669/donpwner"}, "edited": false, "score": 0, "creation_date": 1525892873, "post_id": 50260361, "comment_id": 87538840, "body": "Oh I see Thanks!"}, {"owner": {"reputation": 43, "user_id": 9360669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4wvRY.jpg?s=128&g=1", "display_name": "donpwner", "link": "https://stackoverflow.com/users/9360669/donpwner"}, "edited": false, "score": 0, "creation_date": 1525894153, "post_id": 50260361, "comment_id": 87539490, "body": "Thanks,that did it . I also fixed some other mistakes"}], "tags": [], "owner": {"reputation": 249, "user_id": 4237493, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/my1IB.png?s=128&g=1", "display_name": "Kovalainen", "link": "https://stackoverflow.com/users/4237493/kovalainen"}, "is_accepted": true, "score": 2, "last_activity_date": 1525892468, "creation_date": 1525892468, "answer_id": 50260361, "question_id": 50259991, "link": "https://stackoverflow.com/questions/50259991/time-limit-exceeded-error-in-c-code-how-do-i-overcome-it/50260361#50260361", "title": "Time Limit Exceeded error in C code . How do I overcome it?", "body": "<p>The program never ends because the only <code>goto Lend</code> is in <code>Lcond: if(n&lt;=1) goto Lend;</code>, and <code>n</code> never changes, so the program keeps looping endlessly. You need an end condition.</p>\n"}], "owner": {"reputation": 43, "user_id": 9360669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4wvRY.jpg?s=128&g=1", "display_name": "donpwner", "link": "https://stackoverflow.com/users/9360669/donpwner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 1, "accepted_answer_id": 50260361, "answer_count": 1, "score": 0, "last_activity_date": 1525892468, "creation_date": 1525890857, "last_edit_date": 1525891067, "question_id": 50259991, "link": "https://stackoverflow.com/questions/50259991/time-limit-exceeded-error-in-c-code-how-do-i-overcome-it", "title": "Time Limit Exceeded error in C code . How do I overcome it?", "body": "<p>I was trying to convert this piece of code to a code that uses just gotos,but I keep getting the Time limit error when I try to run it on the online IDEs,and when I try to run on my console it doesn't even react or print errors.</p>\n\n<p>here is the original code:</p>\n\n<pre><code>void sort (int skip, int \u2217A, int length) {\n    for (int n = length ; n &gt; 1 ; n\u2212\u2212) {\n        int i = 0 ;\n        while (true) {\n            if (skip == 0 &amp;&amp; i &lt; n\u22121) {\n                if (A[i] &gt; A[i +1]) {\n                    A[i] = A[i] ^ A[i+1];\n                    A[i +1] = A[i +1] ^ A[i] ;\n                    A[i] = A[i] ^ A[i+1] ;\n                }\n            }else\n                break ;\n            i++;\n       }\n   }\n}\n</code></pre>\n\n<p>and this is the transformed code :</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nvoid sort(int skip,int *A,int length){\n    int n=length;\n    int i,temp,temp2;\nLcond:\n    if(n&lt;=1) goto Lend;\nLbody:\n    i=0;\nLcond_:\n    if(skip!=0) goto Lelse;\n    temp=n-1;\n    if(i&gt;=temp) goto Lelse;\nLbody_:\n    temp2=i+1;\n    if(A[i]&gt;A[temp2]) goto Lbody__;\n    i++;\n    goto Lcond_;\nLbody__:\n    A[i]=A[i]^A[temp2];\n    A[temp2]=A[temp2]^A[i];\n    A[i]=A[i]^A[temp2];\n    i++;\n    goto Lcond_;\nLelse:\n    goto Lcond;\nLend:\n    return;\n}\nint main(){\n    int skip=0;\n    int A[5]={3,5,1,4,2};\n    int length=5;\n    sort(skip,A,length);\n    for (int i=0;i&lt;5;i++){\n            printf(\"%d\\t\",A[i]);\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "struct", "char", "printf"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1525890549, "post_id": 50259884, "comment_id": 87537676, "body": "Note: the standard C data type is spelled <code>_Bool</code>, not <code>Bool</code>."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1525890618, "post_id": 50259884, "comment_id": 87537711, "body": "Note2: for most string-handling purposes, <code>&quot;\\0&quot;</code> is effectively the same as <code>&quot;&quot;</code>."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1525891180, "post_id": 50259884, "comment_id": 87537996, "body": "The first rule of C string manipulation is to always, <i>always</i> ensure that your strings are properly terminated.  That rule having been followed, there are a couple of ways to do what you&#39;re after, but it&#39;s not clear why what you&#39;re already doing isn&#39;t working.  You would do yourself and us a favor by replacing the code presented with a bona fide <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that demonstrates your problem."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1525894559, "post_id": 50259884, "comment_id": 87539695, "body": "If it works with <code>sprintf()</code>, I can&#39;t see any reason why it wouldn&#39;t work with <code>snprintf()</code>. They&#39;re identical except that <code>snprintf()</code> prevents a buffer overflow. The problem is probably somewhere else."}, {"owner": {"reputation": 3817, "user_id": 2082884, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8c1a7c51faf6f8622ecdbb8b638d3550?s=128&d=identicon&r=PG", "display_name": "hetepeperfan", "link": "https://stackoverflow.com/users/2082884/hetepeperfan"}, "edited": false, "score": 0, "creation_date": 1525895143, "post_id": 50259884, "comment_id": 87539957, "body": "When you call malloc in C make sure that the result isn&#39;t NULL, because than you didn&#39;t get any memory"}], "answers": [{"comments": [{"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1525897721, "post_id": 50260871, "comment_id": 87541104, "body": "This answer is substantially contained in a link, which is strongly discouraged by SO. SO posts should be substantially self-contained; links may contain auxiliary information or examples, but the post should still be intelligible if the link becomes invalid, which is almost inevitable."}], "tags": [], "owner": {"reputation": 87, "user_id": 9557323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7b5f2162e8f969ce9d2e7a75f995e6d?s=128&d=identicon&r=PG&f=1", "display_name": "Fabrice Derepas", "link": "https://stackoverflow.com/users/9557323/fabrice-derepas"}, "is_accepted": false, "score": -1, "last_activity_date": 1525894675, "creation_date": 1525894675, "answer_id": 50260871, "question_id": 50259884, "link": "https://stackoverflow.com/questions/50259884/c-snprintf-to-append-struct-member-char/50260871#50260871", "title": "C snprintf to append struct member char*", "body": "<p>Here are some issues with your code. Type <code>Bool</code> should be defined, and <code>False</code> as well. Data pointed to by <code>pointer</code> is not initialized. In your call to <code>sprintf</code> you read and write to <code>result-&gt;value</code> which is an undefined behavior.</p>\n\n<p>Here is a full working implementation, without undefined behavior, where the value of <code>result-&gt;name</code> is read and result of <code>snprintf</code> is written to <code>result-&gt;value</code>:</p>\n\n<p><a href=\"https://taas.trust-in-soft.com/tsnippet/t/de28e2a6\" rel=\"nofollow noreferrer\">https://taas.trust-in-soft.com/tsnippet/t/de28e2a6</a></p>\n"}, {"comments": [{"owner": {"reputation": 149, "user_id": 2119156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2dd07218a7c1509c90c6918e0f069f4?s=128&d=identicon&r=PG", "display_name": "Aethalides", "link": "https://stackoverflow.com/users/2119156/aethalides"}, "edited": false, "score": 0, "creation_date": 1525971953, "post_id": 50262035, "comment_id": 87572726, "body": "my man page for memcpy says that the results are undefined when using memcpy with overlapping areas. Can that ever be the case with the code sample provided here?"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 149, "user_id": 2119156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2dd07218a7c1509c90c6918e0f069f4?s=128&d=identicon&r=PG", "display_name": "Aethalides", "link": "https://stackoverflow.com/users/2119156/aethalides"}, "edited": false, "score": 1, "creation_date": 1525972123, "post_id": 50262035, "comment_id": 87572796, "body": "@Aethalides: Since the part of the string being copied to has clearly never been used before (it&#39;s uninitialized), no it cannot. Side note: strcpy has the same restriction."}], "tags": [], "owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "is_accepted": true, "score": 1, "last_activity_date": 1525929098, "last_edit_date": 1525929098, "creation_date": 1525899908, "answer_id": 50262035, "question_id": 50259884, "link": "https://stackoverflow.com/questions/50259884/c-snprintf-to-append-struct-member-char/50262035#50262035", "title": "C snprintf to append struct member char*", "body": "<p>This is undefined behaviour because the input arguments cannot be part of the output buffer (both in the case of <code>snprintf</code> and <code>sprintf</code>):</p>\n\n<pre><code>snprintf(result-&gt;value,VALUE_BUFFER,\"the quick...%s%s\",result-&gt;value,pointer);\n</code></pre>\n\n<p>This is specified telegraphically in the C standard:</p>\n\n<blockquote>\n  <p>&sect;7.21.6.5/para 2: &hellip;If copying takes place between objects that overlap, the behavior is undefined. <em>(the same sentence appears in &sect;7.21.6.6/2 with respect to <code>sprintf</code>)</em></p>\n</blockquote>\n\n<p>and also in <a href=\"http://man7.org/linux/man-pages/man3/printf.3.html\" rel=\"nofollow noreferrer\"><code>man sprintf</code></a>:</p>\n\n<blockquote>\n  <p>&hellip;the results are undefined if a call to <code>sprintf()</code>, <code>snprintf()</code>, <code>vsprintf()</code>, or <code>vsnprintf()</code> would cause copying to take place between objects that overlap (e.g., if the target string array and one of the supplied input arguments refer to the same buffer). <em>(Linux version)</em></p>\n</blockquote>\n\n<p>If it happens to produce the expected result in some circumstances, you were lucky (or unlucky, since the fluke could lead you to an invalid conclusion).</p>\n\n<p>Although it is not incorrect, this line is ridiculously complicated for what it does:</p>\n\n<pre><code>sprintf(result-&gt;name,\"%s\",\"\\0\");\n</code></pre>\n\n<p><code>\"\\0\"</code> is treated as a zero-length string because strings are terminated by the first NUL character, so it only differs from <code>\"\"</code> by the fact that it uses up two bytes instead of one. But in any case, you could simply write:</p>\n\n<pre><code>result-&gt;name[0] = 0; /* Or ... `\\0` if you like typing */\n</code></pre>\n\n<p>The standard library includes <code>strcat</code> and <code>strncat</code> for concatenating strings, but the \"safe\" version <code>strncat</code> only lets you specify a limit to the number of characters to append, not a limit to the total length of the string. So you need to keep track of the number of characters available yourself, and if you're going to do that, you might as well instead keep track of the position of the end of the string, which is where you want to copy the appended string, rather than searching for the end every time you do a concatenation. For this reason, <code>str(n)cat</code> are hardly ever the correct solution for string concatenation.</p>\n\n<p>Here's a simple outline for concatenating multiple chunks to an output buffer:</p>\n\n<pre><code>size_t used = 0;\nresult-&gt;value = malloc(MAX_VALUE_LEN + 1);\nfor (...) { /* loop which produces the strings to append */\n  ...\n  /* append a chunk */\n  size_t chunk_len = strlen(chunk);\n  if (MAX_VALUE_LEN - used &gt;= chunk_len) {\n    memcpy(result-&gt;value + used, chunk, chunk_len);\n    used += chunk_len;\n  }\n  else {\n    /* Value is too long; return an error */\n  }\n}\nresult-&gt;value[used] = 0;\n</code></pre>\n\n<p>Not everyone will agree with my use of memcpy rather than strcpy; I did it because I already knew the length of the string to copy (which I had to figure out in order to check whether there was enough space), and it is usually more efficient to copy a known number of bytes than to copy bytes until you hit a NUL.</p>\n\n<p>The use of <code>memcpy</code> forces me to explicitly NUL-terminate the result, but I would otherwise have had to insert a NUL at the beginning in case the loop didn't manage to append anything. In order to leave room for the NUL, I initially allocated <code>MAX_VALUE_LEN + 1</code> bytes. However, in practice I would probably start with a small allocation and exponentially <code>realloc</code> if necessary, rather than imposing an artificial limit and wasting memory in the common case that the artificial limit was much greater than the memory actually needed.</p>\n\n<p>If the size limit is not artificial -- that is, if there is some externality which constrains the length of the appended string, such as the size of an output display box -- then one might choose to simply truncate the string rather than throwing an error for over-size results:</p>\n\n<pre><code>size_t used = 0;\nresult-&gt;value = malloc(MAX_VALUE_LEN + 1);\nfor (...) { /* loop which produces the strings to append */\n  ...\n  /* append a chunk */\n  size_t chunk_len = strlen(chunk);\n  if (MAX_VALUE_LEN - used &lt; chunk_len) {\n    chunk_len = MAX_VALUE_LEN - used;\n  }\n  memcpy(result-&gt;value + used, chunk, chunk_len);\n  used += chunk_len;\n}\nresult-&gt;value[used] = 0;\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 2119156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2dd07218a7c1509c90c6918e0f069f4?s=128&d=identicon&r=PG", "display_name": "Aethalides", "link": "https://stackoverflow.com/users/2119156/aethalides"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 0, "accepted_answer_id": 50262035, "answer_count": 2, "score": 0, "last_activity_date": 1525929098, "creation_date": 1525890424, "question_id": 50259884, "link": "https://stackoverflow.com/questions/50259884/c-snprintf-to-append-struct-member-char", "title": "C snprintf to append struct member char*", "body": "<p>When I print out result->value I get garbage (text from other memory areas), and a free(): invalid pointer</p>\n\n<p>I am trying to safely append a string to an existing char* (the value member of the struct of which result is an instance)</p>\n\n<pre><code>unsigned const NAME_BUFFER=100;\nunsigned const VALUE_BUFFER=1000;\n\ntypedef struct {\n    char *name;\n    int  ID;\n    char *value;\n} props;\n\n\u2026\nstatic Bool\nmyfunc(props *result) \n{\n    unsigned char *pointer;\n\n    result-&gt;name=malloc(NAME_BUFFER);\n    result-&gt;value=malloc(VALUE_BUFFER);\n\n// not sure I need to do this, previous instances of the code produced\n// output such as the quick...(null)someoutput\n// which I thought might be because the member is empty the first time?\n    sprintf(result-&gt;name,\"%s\",\"\\0\");\n    sprintf(result-&gt;value,\"%s\",\"\\0\");\n\n    \u2026\n\n    // in a loop which sets pointer, we want to safely append the value of pointer to the\n    // value of the member called value\n\n    snprintf(result-&gt;value,VALUE_BUFFER,\"the quick...%s%s\",result-&gt;value,pointer);\n\n    \u2026\n\n    return False;\n}\n\nstatic void \nmy_print_func() \n{\n    props *result=malloc(sizeof(props));\n\n    if(my_func(result))\n        printf(\"%d\\t%s\",result-&gt;ID,result-&gt;value);\n}\n</code></pre>\n\n<p>Changing the above to use sprintf doesn't cause these problems:</p>\n\n<pre><code>sprintf(result-&gt;value,\"the quick...%s%s\",result-&gt;value,pointer);\n</code></pre>\n\n<p>... other than the fact that it would happily try to insert more characters than allocated.</p>\n\n<p>So what is the correct way of appending with sprintf (or variant) whilst also making sure we don't go out of bounds?</p>\n\n<p>Ideally, it wouldn't involve temporary variables other constructs that need more than one line as I need to repeat this append in several places.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1525890282, "post_id": 50259796, "comment_id": 87537539, "body": "<code>arr[5]</code> is out of the bounds of the array."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1525890406, "post_id": 50259796, "comment_id": 87537616, "body": "a decent compiler should warn you when using static values as indices"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1525890903, "post_id": 50259796, "comment_id": 87537856, "body": "Please note that <code>result +=arr[i];</code> is <i>undefined behaviour</i> because you are using an <i>uninitialised variable</i> and the compiler should have warned you about that."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1525890957, "post_id": 50259796, "comment_id": 87537879, "body": "Don&#39;t change the posted code in response to comments except to clarify or format. Rolled back."}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 9409172, "user_type": "registered", "profile_image": "https://graph.facebook.com/784882431701206/picture?type=large", "display_name": "Du\u0161o Morh&#225;\u010d", "link": "https://stackoverflow.com/users/9409172/du%c5%a1o-morh%c3%a1%c4%8d"}, "edited": false, "score": 0, "creation_date": 1525890462, "post_id": 50259854, "comment_id": 87537641, "body": "How can I solve it then? Thanks"}, {"owner": {"reputation": 61, "user_id": 9409172, "user_type": "registered", "profile_image": "https://graph.facebook.com/784882431701206/picture?type=large", "display_name": "Du\u0161o Morh&#225;\u010d", "link": "https://stackoverflow.com/users/9409172/du%c5%a1o-morh%c3%a1%c4%8d"}, "edited": false, "score": 0, "creation_date": 1525890841, "post_id": 50259854, "comment_id": 87537819, "body": "Solved. Thanks!"}, {"owner": {"reputation": 1216, "user_id": 1088827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4375.png?s=128&g=1", "display_name": "tbrk", "link": "https://stackoverflow.com/users/1088827/tbrk"}, "edited": false, "score": 0, "creation_date": 1525890956, "post_id": 50259854, "comment_id": 87537878, "body": "Great. Don&#39;t forget to click the green tick ;-)"}, {"owner": {"reputation": 61, "user_id": 9409172, "user_type": "registered", "profile_image": "https://graph.facebook.com/784882431701206/picture?type=large", "display_name": "Du\u0161o Morh&#225;\u010d", "link": "https://stackoverflow.com/users/9409172/du%c5%a1o-morh%c3%a1%c4%8d"}, "reply_to_user": {"reputation": 1220, "user_id": 5878272, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/14e96159153b67fab5222b7c5fa18c71?s=128&d=identicon&r=PG&f=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/5878272/fredrik"}, "edited": false, "score": 2, "creation_date": 1525890975, "post_id": 50259854, "comment_id": 87537886, "body": "@Fredrik I am learning this into class. Sorry I am just simple student asking for some help. I wouldn&#180;t get this without help from tbrk. Now I learned from my mistake and will not do it anymore thanks to this."}, {"owner": {"reputation": 1216, "user_id": 1088827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4375.png?s=128&g=1", "display_name": "tbrk", "link": "https://stackoverflow.com/users/1088827/tbrk"}, "reply_to_user": {"reputation": 61, "user_id": 9409172, "user_type": "registered", "profile_image": "https://graph.facebook.com/784882431701206/picture?type=large", "display_name": "Du\u0161o Morh&#225;\u010d", "link": "https://stackoverflow.com/users/9409172/du%c5%a1o-morh%c3%a1%c4%8d"}, "edited": false, "score": 0, "creation_date": 1525891075, "post_id": 50259854, "comment_id": 87537934, "body": "@Du\u0161oMorh&#225;\u010d: Good luck with your studies."}], "tags": [], "owner": {"reputation": 1216, "user_id": 1088827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4375.png?s=128&g=1", "display_name": "tbrk", "link": "https://stackoverflow.com/users/1088827/tbrk"}, "is_accepted": true, "score": 1, "last_activity_date": 1525890769, "last_edit_date": 1525890769, "creation_date": 1525890279, "answer_id": 50259854, "question_id": 50259796, "link": "https://stackoverflow.com/questions/50259796/cannot-change-number-in-array-into-one-i-want/50259854#50259854", "title": "Cannot change number in array into one I want", "body": "<p>The declaration <code>int arr[5]</code> gives an array with five elements numbered from 0 to 4 inclusive. Accessing the 6th element, <code>arr[5]</code>, is undefined.</p>\n\n<p>If you want five elements and a \"sentinel\" (the zero marker), you could define <code>arr</code> as</p>\n\n<pre><code>int arr[6];\n</code></pre>\n\n<p>You should probably also initialize <code>result</code> to 0 otherwise its value is undefined since it's a local variable (in fact, the meaning of the whole program is, strictly speaking, undefined in this case).</p>\n"}], "owner": {"reputation": 61, "user_id": 9409172, "user_type": "registered", "profile_image": "https://graph.facebook.com/784882431701206/picture?type=large", "display_name": "Du\u0161o Morh&#225;\u010d", "link": "https://stackoverflow.com/users/9409172/du%c5%a1o-morh%c3%a1%c4%8d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "closed_date": 1525898633, "accepted_answer_id": 50259854, "answer_count": 1, "score": -2, "last_activity_date": 1525890973, "creation_date": 1525890033, "last_edit_date": 1525890973, "question_id": 50259796, "link": "https://stackoverflow.com/questions/50259796/cannot-change-number-in-array-into-one-i-want", "closed_reason": "Not suitable for this site", "title": "Cannot change number in array into one I want", "body": "<p>I have little problem here. Ever since I used srand command I no longer get output I want.\nI have to create program that will create array not matter how long.. I chose 5. Then it has to create random numbers into it and 5th number in it has to be 0 and then it has to count all five numbers together. I was sucessful and I did even use some printfs to check if arr[5] is zero. It is. In output I receieve this: 5random numbers (that ones that were created into array) 0 (to check if command where i set arr[5] really set it to zero and result which only count all 5random numbers together but without changing 5th arr into 0. Any ideas why? Thanks!\nCode looks like this:</p>\n\n<pre><code> #include &lt;stdio.h&gt;\n#include &lt;time.h&gt;\n        main()\n        {\n            srand(time(NULL));\n            int result,i;\n            int arr[5];\n            for (i=0;i&lt;5;i++)\n\n            {\n                arr[i] = rand() % 10+1;\n                printf(\"%d \",arr[i]);\n            }\n\n        arr[5]=0;\n        printf(\"\\n\");\n        printf(\"%d\\n\",arr[5]);\n        i=0;\n\n        for(;i&lt;5;i++)\n        {\n            result +=arr[i];\n        }\n\n        printf(\"%d\\n\",result);\n        printf(\"%d\\n\",arr[5]);\n\n        }\n</code></pre>\n"}, {"tags": ["c", "netbeans", "continuous-integration", "coding-style", "mplab"], "owner": {"reputation": 63, "user_id": 2325476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yEE3p.jpg?s=128&g=1", "display_name": "Antonio V&#225;zquez Blanco", "link": "https://stackoverflow.com/users/2325476/antonio-v%c3%a1zquez-blanco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1525889763, "creation_date": 1525889763, "question_id": 50259730, "link": "https://stackoverflow.com/questions/50259730/code-formatting-tool-with-netbeans-integration-and-continuous-integration", "title": "Code formatting tool with netbeans integration and continuous integration", "body": "<p>I am working with MPLAB X wich for those who don't know an IDE based on Netbeans. We are also using Git with continuous integration. I have now started to work in several different tests for our projects.</p>\n\n<p>For example, MPLAB lets you choose which encoding you want to use in your projects and UTF-8 is not the default option so from time to time we would find problems opening the projects in different platforms. Now I test that every source code file is properly encoded.</p>\n\n<p>We would also like to check code formatting and style. From what I've seen Netbeans comes with a tool to format code for you, but I don't see how to run this tool to print formatting mistakes as a test in our server. I have also seen that there are many tools like uncrustify that should be able to run in our server but they are not integrated with our IDE.</p>\n\n<p>I would prefer not to maintain two different configuration files for this task, for this reason I am asking if anybody knows if there is a tool that can be run both in a Linux based server and that can be integrated with Netbeans for this task.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 0, "creation_date": 1525889795, "post_id": 50259705, "comment_id": 87537282, "body": "Use it as a format string to <a href=\"https://en.cppreference.com/w/c/io/fprintf\" rel=\"nofollow noreferrer\"><code>sprintf</code></a>, maybe?"}, {"owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 0, "creation_date": 1525889871, "post_id": 50259705, "comment_id": 87537330, "body": "That&#39;s exactly what the <code>printf</code> family of functions does. printf itself prints to stdout, but you can print to a file, or even just assemble a string with <code>snprintf</code> and do with it what you like."}, {"owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 0, "creation_date": 1525889944, "post_id": 50259705, "comment_id": 87537358, "body": "printf and such are runtime functions. You can&#39;t achieve their effect at compile time."}], "answers": [{"tags": [], "owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "is_accepted": true, "score": 2, "last_activity_date": 1525890535, "creation_date": 1525890535, "answer_id": 50259908, "question_id": 50259705, "link": "https://stackoverflow.com/questions/50259705/c-printing-variables-within-strings/50259908#50259908", "title": "C - Printing Variables within Strings", "body": "<p>You can use the array element as a parameter to formatting functions like <code>printf()</code></p>\n\n<pre><code>char *commands = \"lrudbcsiln\";\nfor (int i; i &lt; strlen(commands); i++) {\n    printf(MainMenuNames[i], commands[i]);\n    putchar('\\n');\n}\n</code></pre>\n"}], "owner": {"reputation": 145, "user_id": 9277833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2370dac57aee12261ae08fb777efe8ef?s=128&d=identicon&r=PG&f=1", "display_name": "VallyMan", "link": "https://stackoverflow.com/users/9277833/vallyman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "accepted_answer_id": 50259908, "answer_count": 1, "score": 1, "last_activity_date": 1525890535, "creation_date": 1525889670, "last_edit_date": 1525889879, "question_id": 50259705, "link": "https://stackoverflow.com/questions/50259705/c-printing-variables-within-strings", "title": "C - Printing Variables within Strings", "body": "<p>Is it possible to include variables through using <code>%c</code> and such when you have strings saved into the array?</p>\n\n<pre><code>char *MainMenuNames[] = { \"%c - Move Left\", \"%c - Move Right\",\"%c - Move Up\",\"%c - Move Down\",\"%c - Back\",\"%c - Confirm\",\"%c - Show Stats\",\"%c - Show Inventory\",\"%c - Show Legend\",\"%c - Show Controls\"};\n</code></pre>\n\n<p>When I have something like this, is it possible to put something into the <code>%c</code>?</p>\n"}, {"tags": ["c", "string", "strcmp", "red-black-tree", "string.h"], "comments": [{"owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "edited": false, "score": 1, "creation_date": 1525889831, "post_id": 50259698, "comment_id": 87537308, "body": "Which line gives the error?"}, {"owner": {"reputation": 29, "user_id": 7297188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ssHCn.jpg?s=128&g=1", "display_name": "Kenyskrachor", "link": "https://stackoverflow.com/users/7297188/kenyskrachor"}, "reply_to_user": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "edited": false, "score": 0, "creation_date": 1525889926, "post_id": 50259698, "comment_id": 87537353, "body": "The first if with the strcmp in the instruction. But I think that also the second can give the same error, but I don&#39;t know why."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1525890188, "post_id": 50259698, "comment_id": 87537480, "body": "Are your strings properly NULL terminated?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1525890199, "post_id": 50259698, "comment_id": 87537484, "body": "The most likely problem is unterminated strings.  You&#39;ve not presented the code that needs to be checked for causing such a problem to arise."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1525890995, "post_id": 50259698, "comment_id": 87537898, "body": "You have a memory leak. First you set <code>temp</code> to the result of <code>malloc()</code>, then you immediately replace it with <code>temp = sent-&gt;left;</code>."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1525891236, "post_id": 50259698, "comment_id": 87538027, "body": "Do your array lengths in the structure have enough room for the trailing null bytes? <code>id_prod</code> and <code>id_piece</code> can only be 4 characters long, not 5."}, {"owner": {"reputation": 29, "user_id": 7297188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ssHCn.jpg?s=128&g=1", "display_name": "Kenyskrachor", "link": "https://stackoverflow.com/users/7297188/kenyskrachor"}, "edited": false, "score": 0, "creation_date": 1525893087, "post_id": 50259698, "comment_id": 87538952, "body": "I know. I&#39;ve set <code>id_prod[5]</code> because i need a 4 char array. The memory leak depend on?"}, {"owner": {"reputation": 10586, "user_id": 170383, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4d9f7a30948dca1bbd05eaf27f277ae6?s=128&d=identicon&r=PG", "display_name": "David R Tribble", "link": "https://stackoverflow.com/users/170383/david-r-tribble"}, "edited": false, "score": 1, "creation_date": 1525899251, "post_id": 50259698, "comment_id": 87541879, "body": "I like to declare string variables and members as <code>char name[N+1]</code>, where N is the max number of chars I want to reserve for the string. The <code>+1</code> makes it clear that I&#39;m explicitly allocating space for the terminating NUL char."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525927432, "post_id": 50259698, "comment_id": 87549165, "body": "loops like: <code>while (temp != sent)</code>  need to also be checking for NULL"}], "owner": {"reputation": 29, "user_id": 7297188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ssHCn.jpg?s=128&g=1", "display_name": "Kenyskrachor", "link": "https://stackoverflow.com/users/7297188/kenyskrachor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1525890544, "creation_date": 1525889648, "last_edit_date": 1525890544, "question_id": 50259698, "link": "https://stackoverflow.com/questions/50259698/comparing-two-strings-with-strcmp-give-exc-bad-access", "title": "Comparing two strings with strcmp() give EXC_BAD_ACCESS", "body": "<p>I have this function to insert a node in a red-black tree. The order key of this red-black tree is the string <code>id_prod</code> value, compared by the function <code>strcmp</code>. When I try to insert a node in this structure Xcode give to me this alert <code>EXC_BAD_ACCESS</code></p>\n\n<p>this is the function:</p>\n\n<pre><code>void insert_id(node *sent, node *new_node)\n{\n    if (sent-&gt;parent == NULL)\n    {\n        new_node-&gt;left = new_node-&gt;right = sent;\n        sent-&gt;parent = new_node;\n        new_node-&gt;color_node = black;\n    }\n    else\n    {\n        node *temp = malloc(sizeof(struct node));\n\n        temp = sent-&gt;left;\n\n        while (temp != sent)\n        {\n            if(strcmp(temp-&gt;id_prod, new_node-&gt;id_prod) &lt; 0)\n            {\n                temp = temp-&gt;left;\n            }\n            else\n            {\n                temp = temp-&gt;right;\n            }\n        }\n        if (strcmp(new_node-&gt;id_prod, temp-&gt;id_prod) &lt; 0)\n        {\n            temp-&gt;left = new_node;\n            new_node-&gt;parent = temp;\n        }\n        else\n        {\n            temp-&gt;right = new_node;\n            new_node-&gt;parent = temp;\n        }\n        new_node-&gt;left = new_node-&gt;right = sent;\n        new_node-&gt;color_node = black;\n        setup_tree(sent, new_node);\n    }\n    return;\n}\n</code></pre>\n\n<p>The strings are in a file. This is the function that read and assign data from file to struct node:</p>\n\n<p>struct:</p>\n\n<pre><code>typedef struct node\n{\ncolor   color_node;\nchar    id_prod[5],         \n        name[20],           \n        id_piece[5];        \nstruct  node    *left,\n                *right,\n                *parent;\n} node;\n</code></pre>\n\n<p>Function:</p>\n\n<pre><code>node* get_node_file(FILE *in)\n{\nnode *new_node = (node*) malloc(sizeof(node));\n\nfscanf(in, FORMAT_IN,   new_node-&gt;id_prod,\n                        new_node-&gt;name,\n                        new_node-&gt;id_piece);\n\n\nnew_node-&gt;left = NULL;\nnew_node-&gt;right = NULL;\nnew_node-&gt;parent = NULL;\nnew_node-&gt;color_node = black;\nreturn new_node;\n}\n</code></pre>\n\n<p>and this is the Main:</p>\n\n<pre><code>#define STORE \"Magazzino.txt\"\n\nint main()\n{\n\nFILE    *input;\nnode *sent = malloc(sizeof(struct node));\nsent-&gt;color_node = black;\nsent-&gt;left = sent-&gt;right = sent-&gt;parent = NULL;\n\n\ninput = fopen(STORE, \"r\");\n\ninsert_id(sent, get_node_file(input));\ninsert_id(sent, get_node_file(input));\ninsert_id(sent, get_node_file(input));\n\n\n\nreturn 0;\n}\n</code></pre>\n"}, {"tags": ["c", "char", "pipe"], "comments": [{"owner": {"reputation": 1497, "user_id": 5504922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15bc22b2096bef7bf39b68e241b81efb?s=128&d=identicon&r=PG&f=1", "display_name": "EdmCoff", "link": "https://stackoverflow.com/users/5504922/edmcoff"}, "edited": false, "score": 3, "creation_date": 1525889027, "post_id": 50259476, "comment_id": 87536905, "body": "Please post the relevant portion of your code."}, {"owner": {"reputation": 281, "user_id": 9766592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9609756016cdf08fcad9719ead7b160?s=128&d=identicon&r=PG&f=1", "display_name": "Szymon \u017bak", "link": "https://stackoverflow.com/users/9766592/szymon-%c5%bbak"}, "edited": false, "score": 0, "creation_date": 1525889743, "post_id": 50259476, "comment_id": 87537261, "body": "I added it already. The first one is a part of function &quot;producer&quot;, the second one is part of function &quot;consumer&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 1497, "user_id": 5504922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15bc22b2096bef7bf39b68e241b81efb?s=128&d=identicon&r=PG&f=1", "display_name": "EdmCoff", "link": "https://stackoverflow.com/users/5504922/edmcoff"}, "is_accepted": false, "score": 0, "last_activity_date": 1525891656, "creation_date": 1525891656, "answer_id": 50260178, "question_id": 50259476, "link": "https://stackoverflow.com/questions/50259476/cleaning-pipe-after-second-input/50260178#50260178", "title": "Cleaning pipe after second input", "body": "<p><code>read</code> returns the number of bytes read, so you should be able to do something like:</p>\n\n<pre><code>ssize_t bytesread;\nfor (int i = 0; (bytesread = read(fd[0], message, 10)) &gt; 0; i++)\n{\n  ...\n  write(filefd, message, bytesread);\n  ...\n}\n</code></pre>\n\n<p>The idea is to check the number of bytes read by the call to <code>read</code> (I'm storing it in a variable named <code>bytesread</code>) and pass that number to the <code>write</code> call instead of always passing 10.</p>\n\n<p>I assume you would make a similar change in both pieces of code you posted.</p>\n"}], "owner": {"reputation": 281, "user_id": 9766592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9609756016cdf08fcad9719ead7b160?s=128&d=identicon&r=PG&f=1", "display_name": "Szymon \u017bak", "link": "https://stackoverflow.com/users/9766592/szymon-%c5%bbak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1525891906, "creation_date": 1525888775, "last_edit_date": 1525891906, "question_id": 50259476, "link": "https://stackoverflow.com/questions/50259476/cleaning-pipe-after-second-input", "title": "Cleaning pipe after second input", "body": "<p>I'm new here and I'm beginner in C programming. I have a problem with using pipes to copy a one file to another. My buffer size is 10. When i copy from my file in.txt to out.txt there's always a \"p\" left on the end of char table. It's just because my last input contains only 9 characters, and the tenth char is from earlier input.\n\"reader: msg88=as nulla p\nreader: msg89=ariatur? p\n\"</p>\n\n<p>What should I do to clean my char table? I don't want the last \"p\" on the msg89. I need it to be the same files, but the in.txt doesn't contain the \"p\" on the end and the out.txt contains. When I use md5sum it's not the same:</p>\n\n<pre><code>197ee73779d545f0d3dc7981131736c0  in.txt\ned36f720a1ffc7e82983545d6305edc3  out.txt\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>filefd = open(argv[1], O_RDONLY, 0);\nfor(int i = 0; read(filefd, message, 10) &gt; 0; i++)\n{\n    printf(\"writer: msg%d=%s\\n\", i+1, message);\n    fflush(stdout);\n    write(fd[1], message, 10);\n    usleep(100000);\n}\n\n\nfilefd = open(argv[2], O_WRONLY | O_CREAT | O_TRUNC, 0666);\nfor(int i = 0; read(fd[0], message, 10) &gt; 0; i++)\n{\n    printf(\"reader: msg%d=%s\\n\", i+1, message);\n    fflush(stdout);\n    write(filefd, message, 10);\n    usleep(120000);\n}                       \n</code></pre>\n"}, {"tags": ["c", "embedded", "avr"], "comments": [{"owner": {"reputation": 871, "user_id": 8357969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d947836b34ed6238d065fd26bf75662?s=128&d=identicon&r=PG&f=1", "display_name": "fstop_22", "link": "https://stackoverflow.com/users/8357969/fstop-22"}, "edited": false, "score": 0, "creation_date": 1525887770, "post_id": 50259140, "comment_id": 87536261, "body": "Have you tried casting 0xFFFF to 32-bit int?  It almost seems as if compiler is treating 0xFFFF as 16-bit int."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1525887846, "post_id": 50259140, "comment_id": 87536301, "body": "<code>log</code> is a <i>natural</i> logarithm. Not speaking of the peculiarity of the whole method..."}, {"owner": {"reputation": 4074, "user_id": 808101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb24053e79c428dad4e874daa4da0cb?s=128&d=identicon&r=PG", "display_name": "benjarobin", "link": "https://stackoverflow.com/users/808101/benjarobin"}, "edited": false, "score": 2, "creation_date": 1525887981, "post_id": 50259140, "comment_id": 87536383, "body": "What is the size of an <code>int</code> on this platform (AVR toolchain), and for a <code>long</code> ? Is it really a 8 bits CPU ? You should try to append <code>uL</code> at the end of the constant"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 4074, "user_id": 808101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb24053e79c428dad4e874daa4da0cb?s=128&d=identicon&r=PG", "display_name": "benjarobin", "link": "https://stackoverflow.com/users/808101/benjarobin"}, "edited": false, "score": 0, "creation_date": 1525888310, "post_id": 50259140, "comment_id": 87536567, "body": "@benjarobin ATmega2560 is an 8-bit processor."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "reply_to_user": {"reputation": 4074, "user_id": 808101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb24053e79c428dad4e874daa4da0cb?s=128&d=identicon&r=PG", "display_name": "benjarobin", "link": "https://stackoverflow.com/users/808101/benjarobin"}, "edited": false, "score": 0, "creation_date": 1525892425, "post_id": 50259140, "comment_id": 87538652, "body": "@benjarobin : Yest it really is an 8 bit processor.  Why does that surprise you?  It is tagged embedded - a domain where 8 bit devices remain fairly common,"}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1525893022, "post_id": 50259140, "comment_id": 87538909, "body": "There are no hex and dec <code>int</code>s, they are all just <code>int</code>s.  The representation in the source code is just a human readable representation in different forms to suit different purposes.  The compiler generates the appropriate binary integers when it translates the source.  However while 0xFFFF is translated to an <code>unsigned int</code> and 65534 is a <code>signed int</code>."}], "answers": [{"comments": [{"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1525892630, "post_id": 50259948, "comment_id": 87538748, "body": "Nice answer.  However given the data type of the <code>print_int_new_line()</code> argument, casting to <code>uint64_t</code> might be more appropriate for complete type agreement and to avoid possible further type promotion issues for other larger values."}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 1, "creation_date": 1525967182, "post_id": 50259948, "comment_id": 87570041, "body": "Casts are a really bad idea. If you want a specific minimum width, use the <code>stdint.h</code> macros for constants, e.g. <code>UINT64_C</code>. To get unsigned types, append the <code>unsigned</code> marker to the constant, i.e. <code>65535U</code>, etc. That still leaves speculations what OP actually expected."}], "tags": [], "owner": {"reputation": 2316, "user_id": 469006, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3855250cd4b053ce9204c773246196b?s=128&d=identicon&r=PG", "display_name": "D Krueger", "link": "https://stackoverflow.com/users/469006/d-krueger"}, "is_accepted": true, "score": 5, "last_activity_date": 1525890723, "creation_date": 1525890723, "answer_id": 50259948, "question_id": 50259140, "link": "https://stackoverflow.com/questions/50259140/avr-c-hex-and-dec-multiplication-not-as-expected/50259948#50259948", "title": "AVR C hex and dec multiplication not as expected", "body": "<p>This behavior is due to differences in handling decimal and hexadecimal integer constants.</p>\n\n<p>For both <code>0xFFFF</code> and <code>65535</code>, the compiler will first try to convert the value to an <code>int</code>. But since the platform has a 16-bit <code>int</code> type where <code>INT_MAX</code> is <code>32767</code>, that conversion cannot be performed.</p>\n\n<p>The key difference is the next step. For the hexadecimal constant <code>0xFFFF</code>, the compiler will try to convert it to an <code>unsigned int</code>, which it does to the equivalent of <code>(unsigned int)65535</code>. But, for the decimal constants, conversions to unsigned types are not attempted. The next conversion attempt is to <code>long int</code>. This succeeds and is equivalent to <code>(long int)65535</code>.</p>\n\n<p>So the calls to <code>print_int_new_line</code> are equivalent to:</p>\n\n<pre><code>print_int_new_line((unsigned int)65535*2);\nprint_int_new_line((long int)65535*2);\n</code></pre>\n\n<p>And when <code>2</code> is promoted to do the multiplication:</p>\n\n<pre><code>print_int_new_line((unsigned int)65535*(unsigned int)2);\nprint_int_new_line((long int)65535*(long int)2);\n</code></pre>\n\n<p>The <code>unsigned int</code> result of the first multiplication is too small to hold the full result, so it is truncated to <code>65534</code>. The <code>long int</code> can hold the result, so it produces the correct answer of <code>131070</code>.</p>\n\n<p>You can force the hexadecimal constant to use a <code>long int</code> by appending an <code>L</code> (i.e. <code>0xFFFFL</code>).</p>\n"}], "owner": {"reputation": 53, "user_id": 9766462, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Lucan de Groot", "link": "https://stackoverflow.com/users/9766462/lucan-de-groot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 50259948, "answer_count": 1, "score": 3, "last_activity_date": 1525890723, "creation_date": 1525887489, "question_id": 50259140, "link": "https://stackoverflow.com/questions/50259140/avr-c-hex-and-dec-multiplication-not-as-expected", "title": "AVR C hex and dec multiplication not as expected", "body": "<p>I just discovered a bug in my code when multiplying hex integers (ex. 0xFFFF) with dec integers (ex. 2). This is the code where the problem occurs:</p>\n\n<pre><code>print_int_new_line(0xFFFF*2);\nprint_int_new_line(65535*2);\n</code></pre>\n\n<p>Executing this code gives me the following result:</p>\n\n<pre><code>65534\n131070\n</code></pre>\n\n<p>This is relevant UART code:</p>\n\n<pre><code>void print_int_new_line(uint64_t data) {\n    print_int(data);\n\n    print_new_line();\n}\n\nvoid print_int(uint64_t data) {\n    char data_buffer[(int)(log(data)+2)]; // size of the number (log(number)+1) + 1 for the /0\n\n    ultoa(data, data_buffer, 10); // convert the int to string, base 10\n\n    // print the newly created string\n    print_string(data_buffer);\n}\n\nvoid print_string(char * data) {\n\n    // transmit the data char by char\n    for(; *data != '\\0'; data++){\n        USART_transmit(data);\n    }\n}\n\nvoid USART_transmit(const char * data){\n    /* Wait for empty transmit buffer */\n    while ( !( UCSR0A &amp; (1&lt;&lt;UDRE0)) )\n    ;\n\n    /* Put data into buffer, sends the data */\n    UDR0 = *data;\n}\n</code></pre>\n\n<p>Some info about my setup:</p>\n\n<p>MCU: ATmega2560\nBoard: Arduino Mega2560\nUART baudrate: 38400\nIDE: Atmel Studio 7.0.4.1417</p>\n\n<p>Using the AVR toolchain.</p>\n\n<p>I read on <a href=\"https://stackoverflow.com/questions/28445459/can-hexadecimal-numbers-be-added-subtracted-with-decimal-numbers\">this</a> stackoverflow page that multiplication is possible between hex and dec ints. Also, testing this in an <a href=\"https://www.onlinegdb.com/online_c_compiler\" rel=\"nofollow noreferrer\">online</a> c compiler gives the correct output.</p>\n\n<p>Can anyone give me an explanation?</p>\n"}, {"tags": ["c", "server"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1525887453, "post_id": 50259085, "comment_id": 87536106, "body": "are your strings properly NULL-terminated?  This might also be a good time to learn to use a debugger and step through the code and inspect the variables."}, {"owner": {"reputation": 1602, "user_id": 6023771, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/67e7bfd227dd05ce79a8e4a4f18f37c2?s=128&d=identicon&r=PG&f=1", "display_name": "zee", "link": "https://stackoverflow.com/users/6023771/zee"}, "edited": false, "score": 0, "creation_date": 1525887561, "post_id": 50259085, "comment_id": 87536162, "body": "There isn&#39;t enough info here really, I think Chrisitan&#39;s suggestion might be reasonable, you need to check if the strings are null terminated. I think the easiest way for you to see what the issue is is to either use a debugger or print your string to see its contents"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 2, "creation_date": 1525887836, "post_id": 50259085, "comment_id": 87536294, "body": "Are you confusing <code>read</code> with <code>fgets</code>? The function <code>checkInput</code> shortens a string by <code>1</code> which is a poor way of getting rid of a trailing newline (which may not exist). And what happens when <code>strlen(in)</code> is <code>0</code>?"}, {"owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "edited": false, "score": 0, "creation_date": 1525889140, "post_id": 50259085, "comment_id": 87536962, "body": "what if you used <code>strncmp</code> instead, and specified the length of the static string as the 3rd parameter?"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525964912, "post_id": 50259085, "comment_id": 87568669, "body": "the posted code does not compile..  amongst other things, what is the declaration of <code>in</code> and <code>out</code>?"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525965295, "post_id": 50259085, "comment_id": 87568929, "body": "what are you expecting this: <code>in[strlen(in)-1]=0;</code> to accomplish?  Are you trying to eliminate a possible trailing newline?  If so, then use: `in[ strspn( in, &quot;\\n&quot; ) ] = &#39;\\0&#39;;"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525965347, "post_id": 50259085, "comment_id": 87568958, "body": "strongly suggest replacing the call to <code>read()</code> with a call to <code>fgets()</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525965504, "post_id": 50259085, "comment_id": 87569052, "body": "regarding: <code>write(fileDescriptor,out,strlen(out));</code>  strongly suggest using <code>fprintf()</code> rather than <code>write()</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525965719, "post_id": 50259085, "comment_id": 87569188, "body": "the function: <code>read()</code> does not NUL terminate the input.  I&#39;m thinking that is the root of the problem"}], "answers": [{"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1525903687, "post_id": 50260329, "comment_id": 87543515, "body": "Worth noting there are 2 <code>nc</code> packages that behave a bit differently from one another on this point. The <i>openbsd_netcat</i> doesn&#39;t like the <code>-l and -p</code> options together. The other package is <i>gnu-netcat</i>, which it looks like you are using here. Either way, good way to explain it."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1525903975, "post_id": 50260329, "comment_id": 87543619, "body": "@DavidC.Rankin: Ok, I removed the <code>-p</code> since gnu netcat seems to work either way. (Actually the point of using netcat and telnet like that was to illustrate how to diagnose problems.)"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1525909811, "post_id": 50260329, "comment_id": 87545154, "body": "I&#39;m just trying to snatch the pebbles from your hand here. I thought that was a dynamite example, I just stumbled into the issues trying to make it work <code>:)</code> (you get extra points and points for being old if you recall where the metaphor comes from)"}, {"owner": {"reputation": 13, "user_id": 8871137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc658f8b140fc5a4a37698758981c20c?s=128&d=identicon&r=PG&f=1", "display_name": "Ali9311", "link": "https://stackoverflow.com/users/8871137/ali9311"}, "edited": false, "score": 0, "creation_date": 1526053169, "post_id": 50260329, "comment_id": 87608333, "body": "Thanks for the answer. Using strncmp silved my problem :)"}], "tags": [], "owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "is_accepted": true, "score": 3, "last_activity_date": 1525903934, "last_edit_date": 1525903934, "creation_date": 1525892341, "answer_id": 50260329, "question_id": 50259085, "link": "https://stackoverflow.com/questions/50259085/strcmp-not-working-in-iterative-server-c/50260329#50260329", "title": "strcmp not working in iterative server C", "body": "<p>Let's try a little experiment.</p>\n\n<p>In one session, we start up a netcat (<code>nc</code> process) which listens for a connection and dumps what it receives through hexdump (<code>hd</code>) so that we can see what telnet actually sends:</p>\n\n<pre><code>$ nc -l 8888|hd\n</code></pre>\n\n<p>In another session, we use telnet to send a little string:</p>\n\n<pre><code>$ telnet localhost 8888 &lt;&lt;&lt;\"Hello, world!\"\n</code></pre>\n\n<p>Now, what do we see in the first terminal?</p>\n\n<pre><code>$ nc -l 8888|hd\n00000000  48 65 6c 6c 6f 2c 20 77  6f 72 6c 64 21 <b>0d</b> 0a     |Hello, world!..|\n0000000f\n$</code></pre>\n\n<p>Telnet sends CRLF at the end of each line (assuming the line was originally terminated with a LF). So when you're splitting the received input into lines on the server side, you need to remove both the <code>\\r</code> and the <code>\\n</code>. (If, for whatever reason, the original line was terminated by a <code>\\r</code> instead of a <code>\\n</code>, what you will receive on the other end will normally be a line terminated by <code>\\r\\0</code>, although telnet has an option to send <code>\\r\\n</code> in this case as well.</p>\n\n<p>Note that you should not assume that a single <code>read</code> call will return an entire line nor that it will return only a single line. The amount of data which is produced by a single <code>read</code> call is subject to so many environmental variations that no assumptions whatsoever should be made. At a minimum, you should find the end of the line by scanning for a <code>\\r</code> and then dropping both the <code>\\r</code> and the following <code>\\n</code> or <code>\\0</code>. If no line terminator is found, more data will have to be read. If the line terminator is followed by more data, then it will need to be processed in a subsequent step, instead of (or before) reading more input from the socket.</p>\n\n<p>For a bit more information on this subject, see <a href=\"https://tools.ietf.org/html/rfc1123\" rel=\"nofollow noreferrer\">RFC-1123</a> \"Requirements for Internet Hosts\" (which defines the telnet protocol in Chapter 3), and in particular section 3.3.1 \"Telnet End-of-line Convention\".</p>\n"}, {"tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": false, "score": 0, "last_activity_date": 1525967774, "creation_date": 1525967774, "answer_id": 50276894, "question_id": 50259085, "link": "https://stackoverflow.com/questions/50259085/strcmp-not-working-in-iterative-server-c/50276894#50276894", "title": "strcmp not working in iterative server C", "body": "<p>the following proposed code snippet should fix your problem</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\n\n// prototypes\nvoid checkInput(char in[],char out[]);\nvoid readWriteLoop( void );\n\nvoid readWriteLoop();\n{\n    char in[2000];\n    char out[2000];\n\n    FILE * fp = NULL;\n\n    fp = fopen( ..., \"a+\" ); // replace .... with the actual I/O device name\n    if( !fp )\n    {\n        perror( \"fopen failed\" );\n        exit( EXIT_FAILURE );\n    }\n\n    // implied else, fopen successful\n\n    while( fgets( in, sizeof( in ), fp) )  \n    { \n        in[ strspn( in, \"\\n\" ) ] = '\\0'; \n        checkInput( in, out );\n        fprintf( fp, \"%s\\n\", out );\n    }\n\n    fclose( fp );\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8871137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc658f8b140fc5a4a37698758981c20c?s=128&d=identicon&r=PG&f=1", "display_name": "Ali9311", "link": "https://stackoverflow.com/users/8871137/ali9311"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 50260329, "answer_count": 2, "score": 1, "last_activity_date": 1525967774, "creation_date": 1525887298, "question_id": 50259085, "link": "https://stackoverflow.com/questions/50259085/strcmp-not-working-in-iterative-server-c", "title": "strcmp not working in iterative server C", "body": "<p>We are working on an iterative server in C, which can be used with the telnet client on UNIX. Our Code works fine, except when it comes to performing stringcompares using strcmp(). We have tried the fix using \"\\n\" as suggested in this forum. The Code below works fine. We even enter the method <code>checkInput(in,out)</code></p>\n\n<pre><code>while(read(fileDescriptor,in,2000)&gt;0)\n{\n    in[strlen(in)-1]=0;\n    checkInput(in,out);\n    write(fileDescriptor,out,strlen(out));\n}\n</code></pre>\n\n<p>When we enter <code>checkInput(in,out)</code> we want to campare the string the user enters via telnet with another predefined string. But we always end in the else statement even though the twor strings are exactly the same.</p>\n\n<pre><code>void checkInput(char in[],char out[])\n{\n    char tempString[]=\"GET TEMPERATURE\\n\";\n    char buzzer[]=\"GET BUZZER\";\n\n    if(strcmp(in,tempString)==0)\n    {\n        strcpy(out,\"Get Temp!\");\n        //sprintf(out,\"%d\",temp);\n    }\n\n    else if(strcmp(in,\"GET HUMIDITY\")==0)\n    {\n        strcpy(out,\"Get Hum!\");\n        //sprintf(out,\"%d\",hum);\n    }\n\n    else if(strcmp(in,\"GET LIGHT\")==0)\n    {\n        strcpy(out,\"Get Light!\");\n        //sprintf(out,\"%d\",light);\n    }\n\n    else if(strcmp(in,\"GET LED\")==0)\n    {\n        strcpy(out,\"Get LED!\");\n        //sprintf(out,\"%d\",led);\n    }\n\n    else if(strcmp(in,\"GET SOUND\")==0)\n    {\n        strcpy(out,\"Get Sound!\");\n        //sprintf(out,\"%d\",sound);\n    }\n\n    else if(strncmp(in,buzzer, 11)==0)\n    {\n        strcpy(out,\"Get Buzzer!\");\n        //sprintf(out,\"%d\",buzzer);\n    }\n\n    else if(strcmp(in,\"exit\")==0)\n    {\n        strcpy(out,\"Exiting... Get Out!\");\n        exit(2);\n    }\n    else\n    {\n        strcpy(out,\"\\nDAAAAAMN YOU SERVER!!!!!!!!!\\n\");\n        sprintf(out,\"%d\",strcmp(in,buzzer));\n    }\n}\n</code></pre>\n\n<p>Any help would be greatly appreciated! Thank You!</p>\n"}, {"tags": ["c", "windows", "winapi", "localization", "environment-variables"], "comments": [{"owner": {"reputation": 2060, "user_id": 1231882, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/nkdVI.jpg?s=128&g=1", "display_name": "Neil Weicher", "link": "https://stackoverflow.com/users/1231882/neil-weicher"}, "edited": false, "score": 0, "creation_date": 1525899543, "post_id": 50258899, "comment_id": 87542015, "body": "Interesting: I cannot find any documentation anywhere that Set/GetEnvironmentVariable is affected by Localization, but apparently it is."}, {"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 1, "creation_date": 1525948544, "post_id": 50258899, "comment_id": 87558990, "body": "The <i>real</i> issue is, that you are calling the ANSI versions of API calls. Unless you absolutely must support Win9x, use the Unicode versions (with a trailing <code>W</code> character). They are cheaper to call, don&#39;t impose arbitrary length limits on their arguments, and just work as you&#39;d expect them to. Notably, since Unicode encodings do not rely on the currently active locale, they exhibit identical behavior across different systems with different locales. Unlike ANSI encoding."}, {"owner": {"reputation": 2060, "user_id": 1231882, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/nkdVI.jpg?s=128&g=1", "display_name": "Neil Weicher", "link": "https://stackoverflow.com/users/1231882/neil-weicher"}, "reply_to_user": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 0, "creation_date": 1525949231, "post_id": 50258899, "comment_id": 87559391, "body": "Yes, I was hoping that there was some double secret way of getting it to work using only the ANSI versions, but apparently there isn&#39;t. I might have painted myself into a corner."}, {"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 1, "creation_date": 1525950456, "post_id": 50258899, "comment_id": 87560039, "body": "There is no reliable way to get this to work using ANSI encoding. You don&#39;t control the user&#39;s environment, and they may just be using values with characters, that cannot be represented in the currently active ANSI code page. Besides that, ANSI encoding does not provide a self-contained representation. It always relies on a code page. Unicode encodings (like UTF-16LE), on the other hand, are self-contained, and can represent <i>any</i> code point there is."}], "answers": [{"comments": [{"owner": {"reputation": 2060, "user_id": 1231882, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/nkdVI.jpg?s=128&g=1", "display_name": "Neil Weicher", "link": "https://stackoverflow.com/users/1231882/neil-weicher"}, "edited": false, "score": 0, "creation_date": 1525947636, "post_id": 50265722, "comment_id": 87558507, "body": "Thanks for the reply. It gets stranger and stranger even with US localization. Let&#39;s say I have this input:       <code>PUCHAR binIn = &quot;&#47;x80&#47;x81&#47;x82...&#47;x8F&quot;;</code>       <code>SetEnvironmentVariableA(&quot;MYVAR&quot;, binIn);</code>       <code>GetEnvironmentVariableW(L&quot;MYVAR&quot;, binUt, SZ);</code>   You&#39;d expect the output to be something like this:       <code>8000810082008300....</code>   But in fact it is completely different:       <code>AC2081001A209201...</code>"}, {"owner": {"reputation": 26606, "user_id": 4603670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7eabc1427aa3c8185153cc81978289a?s=128&d=identicon&r=PG&f=1", "display_name": "Barmak Shemirani", "link": "https://stackoverflow.com/users/4603670/barmak-shemirani"}, "reply_to_user": {"reputation": 2060, "user_id": 1231882, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/nkdVI.jpg?s=128&g=1", "display_name": "Neil Weicher", "link": "https://stackoverflow.com/users/1231882/neil-weicher"}, "edited": false, "score": 0, "creation_date": 1525964528, "post_id": 50265722, "comment_id": 87568442, "body": "If <code>binUt</code> is <code>UCHAR</code> as parameter for <code>GetEnvironmentVariableW</code>, the C compiler gives warning (C++ compiler gives error) You are forcing a cast between <code>char</code> and <code>wchar_t</code>. UTF16 is complicated, it&#39;s sometimes 2 bytes per code point, sometimes 4 bytes. If <code>SetEnvironmentVariableA</code> was used, then only <code>GetEnvironmentVariableA</code> will retrieve the original bytes correctly. You might try <code>MultiByteToWideChar</code> with different code page (other than 932 which I guessed) But I think the error goes back to <code>SetEnvironmentVariableA</code> which didn&#39;t store the string correctly."}], "tags": [], "owner": {"reputation": 26606, "user_id": 4603670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7eabc1427aa3c8185153cc81978289a?s=128&d=identicon&r=PG&f=1", "display_name": "Barmak Shemirani", "link": "https://stackoverflow.com/users/4603670/barmak-shemirani"}, "is_accepted": true, "score": 1, "last_activity_date": 1525929508, "last_edit_date": 1525929508, "creation_date": 1525928048, "answer_id": 50265722, "question_id": 50258899, "link": "https://stackoverflow.com/questions/50258899/environment-variables-and-localization/50265722#50265722", "title": "Environment Variables and localization", "body": "<p>Evidently some characters are not supported in this string. You can duplicate the problem by converting the string to UTF16 and back:</p>\n\n<pre><code>wchar_t* get_unicode(const char* ansi, UINT codepage)\n{\n    if(!ansi) return 0;\n    int size = MultiByteToWideChar(codepage, 0, ansi, -1, 0, 0);\n    wchar_t* unicode = malloc(size * sizeof(wchar_t));\n    MultiByteToWideChar(codepage, 0, ansi, -1, unicode, size);\n    return unicode;\n}\n\nchar* get_char(const wchar_t* unicode, UINT codepage)\n{\n    if(!unicode) return 0;\n    int size = WideCharToMultiByte(codepage, 0, unicode, -1, 0, 0, 0, 0);\n    char* ansi = malloc(size);\n    WideCharToMultiByte(codepage, 0, unicode, -1, ansi, size, 0, 0);\n    return ansi;\n}\n\nint main()\n{\n    //932 for Japanese code page\n    wchar_t* unicode = get_unicode(\"\\x06\\xC7\\x86\\xC1\\x99\\x93\\xCF\", 932);\n    char* ansi = get_char(unicode, 932);\n    for(int i = 0, len = strlen(ansi); i &lt; len; i++)\n        printf(\"%02X \", ansi[i]&amp;0xFF);\n    printf(\"\\n\");\n    return 0;\n}\n</code></pre>\n\n<p>It's the same wrong result:</p>\n\n<pre><code>06 C7 81 45 99 93 CF\n</code></pre>\n\n<p>There might not be much you can do here. Maybe the original Japanese string was not converted properly, or maybe some characters are not supported.</p>\n\n<p>Use Unicode to easily solve the problem:</p>\n\n<pre><code>int main()\n{\n    SetEnvironmentVariableW(L\"MYVAR\", L\"\u65e5\u672c\u8a9e \u03b5\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac\");\n    wchar_t buf[100];\n    GetEnvironmentVariableW(L\"MYVAR\", buf, _countof(buf));\n    MessageBoxW(0, buf, 0, 0);\n    return 0;\n}\n</code></pre>\n\n<p>If the rest of your program is not Unicode or cannot be converted, you can store the wide char string in UTF8 format instead of UTF16, like the example below: </p>\n\n<pre><code>int main()\n{\n    char* utf8 = get_char(L\"\u65e5\u672c\u8a9e\", CP_UTF8);\n\n    wchar_t* unicode = get_unicode(utf8, CP_UTF8);\n    SetEnvironmentVariableW(L\"MYVAR\", unicode);\n    wchar_t buf[100];\n    GetEnvironmentVariableW(L\"MYVAR\", buf, _countof(buf));\n\n    MessageBoxW(0, buf, 0, 0);\n\n    free(utf8);\n    free(unicode);\n\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 2060, "user_id": 1231882, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/nkdVI.jpg?s=128&g=1", "display_name": "Neil Weicher", "link": "https://stackoverflow.com/users/1231882/neil-weicher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 50265722, "answer_count": 1, "score": 0, "last_activity_date": 1525929553, "creation_date": 1525886552, "last_edit_date": 1525929553, "question_id": 50258899, "link": "https://stackoverflow.com/questions/50258899/environment-variables-and-localization", "title": "Environment Variables and localization", "body": "<p>There does not seem to be any documentation about this in MSDN but apparently SetEnvironmentVariableA and GetEnvironmentVariableA seem to work differently with special characters depending on the localization and I was wondering if this was expected.</p>\n\n<p>I put together this simple C console program:</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\nint main()\n{\n    PUCHAR binIn = \"\\x06\\xC7\\x86\\xC1\\x99\\x93\\xCF\";\n    UCHAR binUt[16] = {0};\n    SetEnvironmentVariable(\"MYVAR\", binIn);\n    GetEnvironmentVariable(\"MYVAR\", binUt, 16);\n    printf(\"%X %X %X %X %X %X %X\\n\", binUt[0], binUt[0], binUt[1], binUt[2], binUt[3], binUt[4], binUt[5], binUt[6]);\n}\n</code></pre>\n\n<p>When run with System Locale as English, it displays the same bytes coming out as going in, i.e.:</p>\n\n<pre><code>06 C7 86 C1 99 93 CF\n</code></pre>\n\n<p>However, when run with System Locale as Japanese it displays slightly different output:</p>\n\n<pre><code>06 C7 81 45 99 93 CF\n</code></pre>\n\n<p>Is this expected? Is there a way to get it to return the same value regardless of the Locale?</p>\n"}, {"tags": ["c", "multithreading", "pthreads", "ipc"], "comments": [{"owner": {"reputation": 1352, "user_id": 2198121, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa303bed01349a6f8f42a872322c7eb2?s=128&d=identicon&r=PG", "display_name": "NuPagadi", "link": "https://stackoverflow.com/users/2198121/nupagadi"}, "edited": false, "score": 0, "creation_date": 1525885788, "post_id": 50258616, "comment_id": 87535271, "body": "Try <a href=\"https://github.com/petercrona/StsQueue\" rel=\"nofollow noreferrer\">github.com/petercrona/StsQueue</a>."}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1525887831, "post_id": 50258616, "comment_id": 87536291, "body": "<code>Therefore i came here to hopefully get some directions and tips.</code> - Stack Overflow is badly suited for &quot;suggestion&quot; questions. Actually, &quot;I want as little data movement between cores as possible&quot; is quite unclear: assuming <code>put</code> stores data (from one thread) somewhere, and <code>get</code> extracts these data (on other thread), you already have &quot;data movement&quot; between threads and, consequently, between cores. Also, semantic of <code>get</code> and <code>put</code> in case of empty/full queue affects a lot on the effectiveness of one or another communication mechanism."}, {"owner": {"reputation": 75, "user_id": 6836665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bb1a7c3ec23b917445dbc39ef4781d7?s=128&d=identicon&r=PG&f=1", "display_name": "mmoe", "link": "https://stackoverflow.com/users/6836665/mmoe"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1525888308, "post_id": 50258616, "comment_id": 87536566, "body": "Thanks for the heads-up @Tsyvarev the idea is that each thread will modify and work with the data and at less frequent times some other thread will put and get some data to this. So instead of having some data shared among the threads, where all threads are working with this data (creating greater data movement between cores), each thread will initialize the data storage and keep it close to itself. But i might be thinking incorrectly here. Also sorry if the questions seem vague, but that kind of why i came here in the first place"}], "owner": {"reputation": 75, "user_id": 6836665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bb1a7c3ec23b917445dbc39ef4781d7?s=128&d=identicon&r=PG&f=1", "display_name": "mmoe", "link": "https://stackoverflow.com/users/6836665/mmoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1525885816, "creation_date": 1525885487, "last_edit_date": 1525885816, "question_id": 50258616, "link": "https://stackoverflow.com/questions/50258616/c-best-inter-thread-communication-practice-supporting-both-put-and-gets", "title": "C - Best inter-thread communication practice supporting both put and gets", "body": "<p>Im trying to do an experiment where data and work is partitioned over the CPU cores on a specific machine. This is done by settings the CPU affinity and pinning one thread to each core. The data the thread stores is generated within the thread in an attempt to keep the data as close to the thread as possible (within the core cache). The data is of different types and each thread stores a different type of data. Now the main thread should be able to put and get data to each data container within each thread, but right here im not sure what to aim for. </p>\n\n<p>The experiment is implemented in C.</p>\n\n<p><strong>Assuming concurrent put and get requests to the different threads, which inter-thread communication technique would be best suited</strong>? The idea is that i want as little data movement between cores as possible, therefore im trying to avoid using shared communication buffers/mutexes. I initially aimed for using sockets at each thread, but it is a bit too much work as this is not really the purpose of the experiment. Right now im considering using some type of queues, and i guess i would need to implement some input and output queues in order to handle both puts and gets. Therefore i came here to hopefully get some directions and tips.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["c", "gcc"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1525884380, "post_id": 50258347, "comment_id": 87534546, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/3656077/command-line-to-see-the-contents-shared-object-modulelib-so\">Command Line to see the contents Shared Object Module(lib*.so)</a>"}, {"owner": {"reputation": 27, "user_id": 9457831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/993044c293e6264d4855646040ff7442?s=128&d=identicon&r=PG&f=1", "display_name": "jerry", "link": "https://stackoverflow.com/users/9457831/jerry"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1525885021, "post_id": 50258347, "comment_id": 87534882, "body": "I want to see the .o files.Do we have any command for dynamic library to check the same."}, {"owner": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 1, "creation_date": 1525885222, "post_id": 50258347, "comment_id": 87534985, "body": "Dynamic library does not contain any object files. Some information regarding origination of library content probably  can be found at debug symbols."}], "owner": {"reputation": 27, "user_id": 9457831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/993044c293e6264d4855646040ff7442?s=128&d=identicon&r=PG&f=1", "display_name": "jerry", "link": "https://stackoverflow.com/users/9457831/jerry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 158, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1525884305, "creation_date": 1525884305, "question_id": 50258347, "link": "https://stackoverflow.com/questions/50258347/how-can-we-see-the-list-of-files-in-dynamic-library-so", "title": "How can we see the list of files in dynamic library (.so)", "body": "<p>Is there a way to view the list of object files in dynamic library (.so) like static library below.</p>\n\n<pre><code>ar -t llibexample.a\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "edited": false, "score": 0, "creation_date": 1525884358, "post_id": 50258301, "comment_id": 87534530, "body": "It is not called a Trinomial operator.  It is the <a href=\"https://en.wikipedia.org/wiki/%3F:\" rel=\"nofollow noreferrer\">Ternary Operator</a>"}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "reply_to_user": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "edited": false, "score": 0, "creation_date": 1525884434, "post_id": 50258301, "comment_id": 87534575, "body": "@abelenky Also called &quot;conditional operator&quot;. People call it &quot;ternary operator&quot; just because it happens to be the only ternary operator (take 3 arguments)."}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 0, "creation_date": 1525884475, "post_id": 50258301, "comment_id": 87534598, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/13515434/does-the-c-c-ternary-operator-actually-have-the-same-precedence-as-assignment\">Does the C/C++ ternary operator actually have the same precedence as assignment operators?</a>"}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 0, "creation_date": 1525884489, "post_id": 50258301, "comment_id": 87534605, "body": "Also see this <a href=\"https://stackoverflow.com/questions/17406503/ternary-operator-and-assignment-operator\" title=\"ternary operator and assignment operator\">stackoverflow.com/questions/17406503/&hellip;</a>"}, {"owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "edited": false, "score": 1, "creation_date": 1525888458, "post_id": 50258301, "comment_id": 87536639, "body": "The <code>?:</code> operator is not a control structure and should <i>not</i> be used to emulate an <code>if</code> statement.  That&#39;s not its purpose.  abelenky&#39;s answer shows the proper usage."}], "answers": [{"tags": [], "owner": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "is_accepted": false, "score": 4, "last_activity_date": 1525884274, "creation_date": 1525884274, "answer_id": 50258341, "question_id": 50258301, "link": "https://stackoverflow.com/questions/50258301/lvalue-required-as-left-operand-of-assignment/50258341#50258341", "title": "lvalue required as left operand of assignment.....?", "body": "<p>Try instead:</p>\n\n<pre><code> hour   = (gap &gt; 0) ? gap/100 : (2400 - gap)/100;\n minute = (gap &gt; 0) ? gap%100 : (2400 - gap)%100;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 673100, "user_id": 335858, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/4af3541c00d591e9a518b9c0b3b1190a?s=128&d=identicon&r=PG", "display_name": "Sergey Kalinichenko", "link": "https://stackoverflow.com/users/335858/sergey-kalinichenko"}, "is_accepted": false, "score": 1, "last_activity_date": 1525884492, "creation_date": 1525884492, "answer_id": 50258398, "question_id": 50258301, "link": "https://stackoverflow.com/questions/50258301/lvalue-required-as-left-operand-of-assignment/50258398#50258398", "title": "lvalue required as left operand of assignment.....?", "body": "<p>Since both conditional expressions evaluate the same condition, it would be cleaner to combine assignments in an <code>if</code> statement:</p>\n\n<pre><code>if (gap &gt; 0) {\n    hour = gap/100;\n    minute = gap%100;\n} else {\n    hour = (2400 - gap)/100;\n    minute = (2400 - gap)%100;\n}\n</code></pre>\n\n<p>You could further simplify this by adding a new variable:</p>\n\n<pre><code>int numerator = gap &gt; 0 ? gap : 2400-gap;\nhour = numerator/100;\nminute = numerator%100;\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 9718207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bca058bae2c88fdbd0e71f85b8215085?s=128&d=identicon&r=PG&f=1", "display_name": "roku", "link": "https://stackoverflow.com/users/9718207/roku"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1525884492, "creation_date": 1525884135, "question_id": 50258301, "link": "https://stackoverflow.com/questions/50258301/lvalue-required-as-left-operand-of-assignment", "title": "lvalue required as left operand of assignment.....?", "body": "<p>I'm doing my c homework..... :( using a trinomial operator(?) _oo? oo : oo  </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    int time1, time2, gap;\n    int hour, minute;\n\n    setvbuf(stdout, NULL, _IONBF, 0);\n    setvbuf(stdout, NULL, _IONBF, 0);\n\n    printf(\"Enter first time: \\n\");\n    scanf(\"%d\", &amp;time1);\n\n    printf(\"Enter second time: \\n\");\n    scanf(\"%d\", &amp;time2);\n\n    gap = time2 - time1;\n\n    gap &gt; 0 ? hour = gap/100 : hour = (2400 - gap)/100;\n    gap &gt; 0 ? minute = gap%100 : minute = (2400 - gap)%100;\n\n    print(\"The gap of these times: %d hours, %d minutes\", hour, minute);\n\n}\n</code></pre>\n\n<p><em>gap > 0 ? gap/100 = hour : (2400 - gap)/100 = hour;</em></p>\n\n<p><em>gap > 0 ? minute = gap%100 : minute = (2400 - gap)%100;</em></p>\n\n<p>These two sentences are error(lvalue required as left operand of assignment)</p>\n\n<p><strong>The result I want</strong></p>\n\n<p>Enter first time:\n1925</p>\n\n<p>Enter second time:\n2358</p>\n\n<p>The gap of these times: 4 hours, 33 minutes</p>\n\n<p><strong>OR</strong></p>\n\n<p>Enter first time:\n1540</p>\n\n<p>Enter second time:\n1630</p>\n\n<p>The gap of these times: 0 hours, 50 minutes</p>\n\n<p><strong>OR</strong></p>\n\n<p>Enter first time:\n0730</p>\n\n<p>Enter second time:\n0720</p>\n\n<p>The gap of these times: 23 hours, 50 minutes</p>\n"}, {"tags": ["c++", "c", "networking", "posix"], "comments": [{"owner": {"reputation": 4989, "user_id": 3745413, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jQsNL.png?s=128&g=1", "display_name": "Ron Maupin", "link": "https://stackoverflow.com/users/3745413/ron-maupin"}, "edited": false, "score": 3, "creation_date": 1525883889, "post_id": 50258143, "comment_id": 87534300, "body": "&quot;<i>User space can call send and only send MTU size packets.</i>&quot; That depends on the transport protocol used. For example, you can give TCP large blocks of data to send, and it will segment the data into MSS sized segments and send it for you. TCP segmentation is <i>not</i> IP fragmentation."}, {"owner": {"reputation": 1639, "user_id": 2073349, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0266d3aafa1813f794a5b71058d5cd27?s=128&d=identicon&r=PG", "display_name": "Ritesh", "link": "https://stackoverflow.com/users/2073349/ritesh"}, "reply_to_user": {"reputation": 4989, "user_id": 3745413, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jQsNL.png?s=128&g=1", "display_name": "Ron Maupin", "link": "https://stackoverflow.com/users/3745413/ron-maupin"}, "edited": false, "score": 0, "creation_date": 1525885036, "post_id": 50258143, "comment_id": 87534889, "body": "@RonMaupin  You are right. TCP does it as part of protocol as it tries to get the MTU of link. The above problem is mainly due to UDP. I have updated my question."}, {"owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "edited": false, "score": 0, "creation_date": 1525889397, "post_id": 50258143, "comment_id": 87537083, "body": "normally, you would step through your buffer one MTU at a time, and send. But, udp doesn&#39;t guarantee order or success. So, the sender may need to retry, and the receiver may need to reorder the received packets."}, {"owner": {"reputation": 4989, "user_id": 3745413, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jQsNL.png?s=128&g=1", "display_name": "Ron Maupin", "link": "https://stackoverflow.com/users/3745413/ron-maupin"}, "edited": false, "score": 0, "creation_date": 1525890224, "post_id": 50258143, "comment_id": 87537508, "body": "Also, if you wish to avoid IP fragmentation altogether, you need to perform PMTUD (RFC 1191 for IPv4) before sending anything."}], "owner": {"reputation": 1639, "user_id": 2073349, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0266d3aafa1813f794a5b71058d5cd27?s=128&d=identicon&r=PG", "display_name": "Ritesh", "link": "https://stackoverflow.com/users/2073349/ritesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1525885098, "creation_date": 1525883603, "last_edit_date": 1525885098, "question_id": 50258143, "link": "https://stackoverflow.com/questions/50258143/how-to-send-large-data-on-network-using-udp-protocol", "title": "How to send large data on network using udp protocol?", "body": "<p>User space can call send and only send MTU size packets.\nThis will force multiple calls to send but will avoid IP fragmentation.\nBut multiple calls to send will force multiple user/kernel context switch.</p>\n\n<p>The other way is that user space can send big packets (may be N*MTU size) and that will cause N IP fragments, but will decrease user/kernel context switch.</p>\n\n<p>On the other hand, IP fragments can slow down the network path too, as all the routers need to accumulate the packet before routing forward.</p>\n\n<p>After my googling research, I came to conclusion that using iovec with readv/writev and sending MTU size is possibly a way to go as it will address both the concerns about context switch and IP fragmentation. </p>\n\n<p>I will appreciate any deep insight and opinion on this.</p>\n"}, {"tags": ["c", "linux", "file", "reader"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1525881912, "post_id": 50257645, "comment_id": 87533201, "body": "There are multiple ways to do it.  What specific problem are you trying to overcome?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1525881925, "post_id": 50257645, "comment_id": 87533206, "body": "Why do you think you need <code>malloc</code>?"}, {"owner": {"reputation": 32321, "user_id": 173397, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pqKT8.jpg?s=128&g=1", "display_name": "pm100", "link": "https://stackoverflow.com/users/173397/pm100"}, "edited": false, "score": 0, "creation_date": 1525881995, "post_id": 50257645, "comment_id": 87533242, "body": "sounds like homework"}, {"owner": {"reputation": 61, "user_id": 5805956, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8X9c_uBbipI/AAAAAAAAAAI/AAAAAAAAABg/q5PE-Y8N-f8/photo.jpg?sz=128", "display_name": "reByte", "link": "https://stackoverflow.com/users/5805956/rebyte"}, "edited": false, "score": 0, "creation_date": 1525882034, "post_id": 50257645, "comment_id": 87533273, "body": "I wanna create a simple copy &amp; paste script. So what function do I need to get the string.. fscanf needs input format, fgetc gives me just a char.. so what do I need"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1525882147, "post_id": 50257645, "comment_id": 87533339, "body": "Again. Let&#39;s assume you <i>can</i> use <code>malloc</code>. how will you implement it then ?"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1525882333, "post_id": 50257645, "comment_id": 87533433, "body": "You simple need an array of char that is bigger than the biggest file you expect to read."}, {"owner": {"reputation": 61, "user_id": 5805956, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8X9c_uBbipI/AAAAAAAAAAI/AAAAAAAAABg/q5PE-Y8N-f8/photo.jpg?sz=128", "display_name": "reByte", "link": "https://stackoverflow.com/users/5805956/rebyte"}, "edited": false, "score": 0, "creation_date": 1525882347, "post_id": 50257645, "comment_id": 87533442, "body": "I would use fread by referring a buffer to ptr"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1525882495, "post_id": 50257645, "comment_id": 87533536, "body": "<i>by referring a buffer to ptr</i> : what??"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 1, "creation_date": 1525882552, "post_id": 50257645, "comment_id": 87533562, "body": "Hint: to get the size of your file read <a href=\"https://stackoverflow.com/questions/238603/how-can-i-get-a-files-size-in-c\">this</a>"}, {"owner": {"reputation": 61, "user_id": 5805956, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8X9c_uBbipI/AAAAAAAAAAI/AAAAAAAAABg/q5PE-Y8N-f8/photo.jpg?sz=128", "display_name": "reByte", "link": "https://stackoverflow.com/users/5805956/rebyte"}, "edited": false, "score": 0, "creation_date": 1525882769, "post_id": 50257645, "comment_id": 87533675, "body": "Yea this is using malloc what im trying to avoid"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 2, "creation_date": 1525883014, "post_id": 50257645, "comment_id": 87533811, "body": "This question could look legit if you were posting here your solution using <code>malloc</code> and asking how to do without it."}, {"owner": {"reputation": 61, "user_id": 5805956, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8X9c_uBbipI/AAAAAAAAAAI/AAAAAAAAABg/q5PE-Y8N-f8/photo.jpg?sz=128", "display_name": "reByte", "link": "https://stackoverflow.com/users/5805956/rebyte"}, "edited": false, "score": 0, "creation_date": 1525883204, "post_id": 50257645, "comment_id": 87533924, "body": "Legit ?? Why should a question look legit lol: char * content= 0; \t\tint length; \t\tfseek(file, 0, SEEK_END); \t\tlength = ftell(file); \t\tfseek(file, 0, SEEK_SET); \t\tcontent = malloc(length); \t\tif (content){ \t\t\tfread(content, 1, length, file); \t\t} \t\tfclose(file);  \t\treturn content;"}, {"owner": {"reputation": 37256, "user_id": 736308, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/o5EqQ.jpg?s=128&g=1", "display_name": "cdarke", "link": "https://stackoverflow.com/users/736308/cdarke"}, "edited": false, "score": 2, "creation_date": 1525883543, "post_id": 50257645, "comment_id": 87534110, "body": "@reByte:  ALWAYS put code into your question, never in a comment unless it is a simple, short statement."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1525883854, "post_id": 50257645, "comment_id": 87534280, "body": "If you can&#39;t use <code>malloc</code> you need to define an array of <code>char</code> large enough to hold the file contents. If you can determine the file size and are allowed to define a variable-length array (VLA) you could define one of those."}, {"owner": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "edited": false, "score": 0, "creation_date": 1525884137, "post_id": 50257645, "comment_id": 87534428, "body": "If you&#39;re reading the file into a string you should <code>malloc</code> one byte extra so you have space to store the <code>NUL</code> and also add it as <code>fread</code> won&#39;t do it for you"}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1525884928, "post_id": 50257645, "comment_id": 87534840, "body": "Please explain what exactly you&#39;re having. Do you have a pointer pointing to a memory whose size is guaranteed to be at least the file size and a NUL?"}], "answers": [{"tags": [], "owner": {"reputation": 16, "user_id": 9766476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ff0b4c5add23e8da3720bf4b699ca7a?s=128&d=identicon&r=PG&f=1", "display_name": "Arthur G", "link": "https://stackoverflow.com/users/9766476/arthur-g"}, "is_accepted": true, "score": 0, "last_activity_date": 1525906913, "last_edit_date": 1525906913, "creation_date": 1525891320, "answer_id": 50260106, "question_id": 50257645, "link": "https://stackoverflow.com/questions/50257645/c-read-file-content-into-string-just-with-stdio-libary/50260106#50260106", "title": "C Read file content into string just with stdio libary", "body": "<p>I will attempt to answer your question. Keep in mind though - I am still fairly new to C, so there could be a better solution out there in which case please let me know about it too! :) </p>\n\n<p>EDIT: And there was... </p>\n\n<p>Here is how I see it... \nYou need to know the size of the file you want to store in a string. \nMore precisely - in the example solution that I'm providing, you need to know how many chars are in your input file.</p>\n\n<p>All you are doing with <code>malloc</code> is dynamically allocating memory on the 'heap'. I presume you already know that...\nSo regardless of where your <code>string</code> lives in memory (stack or heap) you need to know how big that <code>string</code> has to be, so all of the contents of your input file would fit in to it.</p>\n\n<p>Here is a quick pseudo-code and some code with a solution to your problem... I hope this is helpful and I am open to learn a better approach if there is one, peace! </p>\n\n<p>Pseudo-code:</p>\n\n<ol>\n<li><p>open input file for reading</p></li>\n<li><p>find out the size of the file</p>\n\n<blockquote>\n  <ul>\n  <li><p>forward seek file position indicator to the end of the file</p></li>\n  <li><p>get the total number of bytes (chars) in infile</p></li>\n  <li><p>rewind file position indicator back to the start\n  (because we will be reading from it again)</p></li>\n  </ul>\n</blockquote></li>\n<li><p>declare a char array, size of - all counted chars in infile + 1 for '\\0' \nat the end of the string.  </p></li>\n<li><p>read all chars of infile in to the array</p></li>\n<li><p>Terminate your string with '\\0' </p></li>\n<li><p>Close input file  </p></li>\n</ol>\n\n<p>Here is a simple program that does just that and prints your string:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void)\n{\n    // Open input file\n    FILE *infile = fopen(\"hello.py\", \"r\");\n    if (!infile)\n    {\n        printf(\"Failed to open input file\\n\");\n        return 1;\n    }\n\n    ////////////////////////////////\n    // Getting file size\n\n    // seek file position indicator to the end of the file\n    fseek(infile, 0L, SEEK_END);\n\n    // get the total number of bytes (chars) in infile\n    int size = ftell(infile); // ask for the position\n\n    // Rewind file position indicator back to the start of the file\n    rewind(infile);\n\n    //////////////////////////////////\n\n    // Declaring a char array, size of - all the chars from input file + 1 for the '\\0'\n    char str[size + 1];\n\n    // Read all chars of infile in to the array\n    fread(&amp;str, sizeof(char), size, infile);\n\n    // Terminate the string\n    str[size] = '\\0'; // since we are zero indexed 'size' happens to be the last element of our array[size + 1]\n\n    printf(\"%s\\n\", str);\n\n    // Close the input file\n    fclose(infile);\n\n    // The end\n    return 0;\n\n}\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 5805956, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8X9c_uBbipI/AAAAAAAAAAI/AAAAAAAAABg/q5PE-Y8N-f8/photo.jpg?sz=128", "display_name": "reByte", "link": "https://stackoverflow.com/users/5805956/rebyte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 336, "favorite_count": 0, "closed_date": 1525888855, "accepted_answer_id": 50260106, "answer_count": 1, "score": -4, "last_activity_date": 1525906913, "creation_date": 1525881763, "question_id": 50257645, "link": "https://stackoverflow.com/questions/50257645/c-read-file-content-into-string-just-with-stdio-libary", "closed_reason": "Needs details or clarity", "title": "C Read file content into string just with stdio libary", "body": "<p>Im struggleing by trying to read the files content into a string (char*).\nI just have to use the stdio.h libary, so I cant allocate memory with malloc.</p>\n\n<p>How can I read all the content of a file and return it into a string?</p>\n"}, {"tags": ["c", "gcc", "assembly"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 4, "creation_date": 1525881519, "post_id": 50257425, "comment_id": 87532992, "body": "Well.. it doesn&#39;t have <code>main</code>. Functions are <code>static</code>, so they cannot be linked to external <code>main</code>. So I am with the compiler."}], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 7469141, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qcch8.jpg?s=128&g=1", "display_name": "Hackerman", "link": "https://stackoverflow.com/users/7469141/hackerman"}, "edited": false, "score": 0, "creation_date": 1525892599, "post_id": 50257584, "comment_id": 87538734, "body": "Thank you very very much! We were giben some basic code so I didn&#39;t pay attention to that. Anyway, I also didn&#39;t know this gcc&#39;s behavior. Again, thank you."}], "tags": [], "owner": {"reputation": 571, "user_id": 6568778, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-n-fJoDVOdu8/AAAAAAAAAAI/AAAAAAAABQk/D8gkpGEHKp0/photo.jpg?sz=128", "display_name": "Tom Hebb", "link": "https://stackoverflow.com/users/6568778/tom-hebb"}, "is_accepted": true, "score": 6, "last_activity_date": 1525881564, "creation_date": 1525881564, "answer_id": 50257584, "question_id": 50257425, "link": "https://stackoverflow.com/questions/50257425/gcc-outputs-empty-assembly-file/50257584#50257584", "title": "GCC outputs empty assembly file", "body": "<p>Both your functions are declared <code>static</code>, which means that neither one is visible to other compilation units (i.e. other <code>.o</code> files) during linking.</p>\n\n<p>When you enable optimization, GCC notices that, since the functions are not externally visible nor are they called from any externally visible function, their presence is meaningless and so it omits them entirely to save space.</p>\n\n<p>To fix this, remove the <code>static</code> keyword from your function signatures.</p>\n"}], "owner": {"reputation": 153, "user_id": 7469141, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qcch8.jpg?s=128&g=1", "display_name": "Hackerman", "link": "https://stackoverflow.com/users/7469141/hackerman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 50257584, "answer_count": 1, "score": 1, "last_activity_date": 1525881564, "creation_date": 1525881000, "question_id": 50257425, "link": "https://stackoverflow.com/questions/50257425/gcc-outputs-empty-assembly-file", "title": "GCC outputs empty assembly file", "body": "<p>I'm trying to make some optimizations on a C program. I want GCC to autovectorize if possible. To check what's doing I generate the assembly file of the program with the \"-S\" option, but whenever the optimization level is greater than 0, GCC outputs an almost empty .s file. I'm using gcc-7, but I tried with older versions and it does the same thing.</p>\n\n<p>C code:</p>\n\n<pre><code>#include &lt;math.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define HEIGHT 2000\n#define WIDTH 1000\n\nstatic unsigned int idx(unsigned int x, unsigned int y, unsigned int stride){\n  return y * stride + x;\n}\n\nstatic void integral_image(const unsigned char * restrict in, unsigned int * restrict out){\n  unsigned int row_sum = 0;\n  unsigned char *newin = __builtin_assume_aligned(in, 16);\n  unsigned char *newout = __builtin_assume_aligned(out, 16);\n\n  for(unsigned int x = 0; x &lt; WIDTH; ++x){\n    row_sum += newin[x];\n    newout[x] = row_sum;\n  }\n\n  for(unsigned int y = 1; y &lt; HEIGHT; ++y){\n    row_sum = 0;\n\n    for(unsigned w = 0; w &lt; WIDTH; w += 4){\n      const unsigned int i1 = idx(w, y, WIDTH);\n      const unsigned int old1 = idx(w, y - 1, WIDTH);\n      const unsigned int i2 = idx(w + 1, y, WIDTH);\n      const unsigned int old2 = idx(w, y - 1, WIDTH);\n      const unsigned int i3 = idx(w + 2, y, WIDTH);\n      const unsigned int old3 = idx(w + 2, y - 1, WIDTH);\n      const unsigned int i4 = idx(w + 3, y, WIDTH);\n      const unsigned int old4 = idx(w + 3, y - 1, WIDTH);\n\n      row_sum += newin[i1];\n      newout[i1] = row_sum + newout[old1];\n\n      row_sum += newin[i2];\n      newout[i2] = row_sum + newout[old2];\n\n      row_sum += newin[i3];\n      newout[i3] = row_sum + newout[old3];\n\n      row_sum += newin[i4];\n      newout[i4] = row_sum + newout[old4];\n    }\n  }\n}\n</code></pre>\n\n<p>Now the GCC generated .s file:</p>\n\n<pre><code>.file   \"thrash.c\"\n.ident  \"GCC: (Ubuntu 7.1.0-10ubuntu1~16.04.york0) 7.1.0\"\n.section    .note.GNU-stack,\"\",@progbits\n</code></pre>\n\n<p>Thank you!</p>\n"}, {"tags": ["c", "linux", "io", "blocking"], "comments": [{"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1525880495, "post_id": 50257110, "comment_id": 87532342, "body": "<code>(::open)</code> looks more like C++ with unnecessary parentheses than C."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1525880868, "post_id": 50257110, "comment_id": 87532581, "body": "It doesn&#39;t look like any of those sets <code>O_NONBLOCK</code> to me. The second explicitly clears it."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1525881210, "post_id": 50257110, "comment_id": 87532795, "body": "Non-blocking IO is used pretty widely, and has been for a long time.  Instead of supposing that it doesn&#39;t work as documented, you should probably conclude that you&#39;re not using it (correctly)."}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 1, "creation_date": 1525881325, "post_id": 50257110, "comment_id": 87532872, "body": "This site <a href=\"http://man7.org/linux/man-pages/man2/open.2.html\" rel=\"nofollow noreferrer\">man7.org/linux/man-pages/man2/open.2.html</a> says: &quot;O_NONBLOCK or O_NDELAY: ..... Note that this flag has <b>no effect for regular files</b>  ....&quot;"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1525881377, "post_id": 50257110, "comment_id": 87532909, "body": "Among other things, regardless of non-blocking mode, <code>read()</code> will return 0 if that&#39;s how many bytes you request, or if the current file offset is at or past the end of the file."}, {"owner": {"reputation": 11, "user_id": 9765831, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xXDNBkFgPpg/AAAAAAAAAAI/AAAAAAAAABk/fAJFfvTEah8/photo.jpg?sz=128", "display_name": "guang chen", "link": "https://stackoverflow.com/users/9765831/guang-chen"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1525885779, "post_id": 50257110, "comment_id": 87535268, "body": "@molbdnilo, yes, both way just clear O_NONBLOCK, as I want block behavior, but it is not working"}, {"owner": {"reputation": 11, "user_id": 9765831, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xXDNBkFgPpg/AAAAAAAAAAI/AAAAAAAAABk/fAJFfvTEah8/photo.jpg?sz=128", "display_name": "guang chen", "link": "https://stackoverflow.com/users/9765831/guang-chen"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1525885925, "post_id": 50257110, "comment_id": 87535333, "body": "@JohnBollinger tell me what is the correctly use? Have you tried it? &quot;return 0 if  at or past the end of the file&quot; is also from the document, doesn&#39;t it conflict with  &quot;shall return -1&quot; or &quot;shall block the calling thread&quot;"}, {"owner": {"reputation": 11, "user_id": 9765831, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xXDNBkFgPpg/AAAAAAAAAAI/AAAAAAAAABk/fAJFfvTEah8/photo.jpg?sz=128", "display_name": "guang chen", "link": "https://stackoverflow.com/users/9765831/guang-chen"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1525886023, "post_id": 50257110, "comment_id": 87535402, "body": "@4386427 got it, very helpful. So maybe &quot;file that supports non-blocking reads&quot; is not regular file."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9765831, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xXDNBkFgPpg/AAAAAAAAAAI/AAAAAAAAABk/fAJFfvTEah8/photo.jpg?sz=128", "display_name": "guang chen", "link": "https://stackoverflow.com/users/9765831/guang-chen"}, "edited": false, "score": 0, "creation_date": 1525886215, "post_id": 50257616, "comment_id": 87535488, "body": "Ok, i think you are right, a lot of file system like mine did not implement &quot;supports non-blocking&quot; for file. So that&#39;s why read() always return 0 if it read to the tip of file."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 11, "user_id": 9765831, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xXDNBkFgPpg/AAAAAAAAAAI/AAAAAAAAABk/fAJFfvTEah8/photo.jpg?sz=128", "display_name": "guang chen", "link": "https://stackoverflow.com/users/9765831/guang-chen"}, "edited": false, "score": 0, "creation_date": 1525951536, "post_id": 50257616, "comment_id": 87560619, "body": "@guangchen The POSIX standard does seem to have the wording backwards - <code>read()</code> on a normal file is normally non-blocking.  What I think the standard is trying to say is &quot;non-blocking reads <b>as a special case</b>&quot;, meaning that setting <code>O_NONBLOCK</code> is treated differently.  As noted in the comments above, Linux explicitly states that the flag has no effect on regular files."}], "tags": [], "owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "is_accepted": false, "score": 1, "last_activity_date": 1525881684, "creation_date": 1525881684, "answer_id": 50257616, "question_id": 50257110, "link": "https://stackoverflow.com/questions/50257110/read-from-file-return-what/50257616#50257616", "title": "read() from file return what?", "body": "<p>The key part of <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/read.html\" rel=\"nofollow noreferrer\">the POSIX <code>read()</code> specification</a> that applies is bolded:</p>\n\n<blockquote>\n  <p>When attempting to read a file (other than a pipe or FIFO) <strong>that\n  supports non-blocking reads</strong> and has no data currently available:</p>\n  \n  <ul>\n  <li><p>If <code>O_NONBLOCK</code> is set, <code>read()</code> shall return <code>-1</code> and set <code>errno</code> to <code>[EAGAIN]</code>.</p></li>\n  <li><p>If <code>O_NONBLOCK</code> is clear, <code>read()</code> shall block the calling thread until some data becomes available.</p></li>\n  <li><p>The use of the <code>O_NONBLOCK</code> flag has no effect if there is some data available.</p></li>\n  </ul>\n</blockquote>\n\n<p>The underlying file system has to be designed and written to support non-blocking reads, and most file systems do not do that for files.</p>\n\n<p>It's impossible to know why filesystem developers have not written many filesystems that support <code>O_NONBLOCK</code> (if any...), but it's likely because it's not useful for a file.  File objects have a <em>state</em> - the filesystem knows if there's data available or not, and there is no outside dependency were some data might suddenly appear in a way that won't effect the state of the file.  </p>\n\n<p>While, \"You've read the whole file\" is different from, \"There's nothing in the pipe (yet)\", there's not so much difference in the information returned to the caller.</p>\n"}], "owner": {"reputation": 11, "user_id": 9765831, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xXDNBkFgPpg/AAAAAAAAAAI/AAAAAAAAABk/fAJFfvTEah8/photo.jpg?sz=128", "display_name": "guang chen", "link": "https://stackoverflow.com/users/9765831/guang-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1525881684, "creation_date": 1525880018, "question_id": 50257110, "link": "https://stackoverflow.com/questions/50257110/read-from-file-return-what", "title": "read() from file return what?", "body": "<p>in all reference below:</p>\n\n<p><a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/\" rel=\"nofollow noreferrer\">http://pubs.opengroup.org/onlinepubs/9699919799/</a></p>\n\n<p><a href=\"https://linux.die.net/man/3/read\" rel=\"nofollow noreferrer\">https://linux.die.net/man/3/read</a></p>\n\n<p>it says:</p>\n\n<blockquote>\n  <p>When attempting to read a file (other than a pipe or FIFO) that\n  supports non-blocking reads and has no data currently available:</p>\n  \n  <p>If O_NONBLOCK is set, read() shall return -1 and set errno to\n  [EAGAIN].</p>\n  \n  <p>If O_NONBLOCK is clear, read() shall block the calling thread until\n  some data becomes available.</p>\n  \n  <p>The use of the O_NONBLOCK flag has no effect if there is some data\n  available.</p>\n</blockquote>\n\n<p>But who really try it? As I tested, all above cases would let read() return 0.</p>\n\n<p>It seems O_NONBLOCK is not working no matter I set it this way:</p>\n\n<pre><code>int flags = O_RDONLY;\nint mode = S_IRGRP|S_IROTH|S_IRUSR;\nint _pbfd = (::open)(\"123\",flags,mode);\n</code></pre>\n\n<p>Or this way:</p>\n\n<pre><code>int _pbfd = (::open)(\"123\",flags,mode);\nint saved_flags = fcntl(_pbfd, F_GETFL);\nfcntl(_pbfd, F_SETFL, saved_flags &amp; ~O_NONBLOCK);\n</code></pre>\n"}, {"tags": ["c", "automake"], "comments": [{"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 0, "creation_date": 1525879722, "post_id": 50256967, "comment_id": 87531855, "body": "You have something wrong on or near line 890 of configure.ac.  Please copy and paste lines 880 through 900, or so, of that file into the question."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 0, "creation_date": 1525879794, "post_id": 50256967, "comment_id": 87531912, "body": "If you have <code>grep</code>, the output of <code>grep AC_CONFIG_FILES configure.ac</code> would also be helpful.  If you don&#39;t have <code>grep</code>, please try to get us that information (i.e. all of the lines in <code>configure.ac</code> on which the string <code>AC_CONFIG_FILES</code> appears) some other way."}, {"owner": {"reputation": 1604, "user_id": 2251250, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/10101633b337743c6b2beb5ad96d7ef7?s=128&d=identicon&r=PG", "display_name": "arslan", "link": "https://stackoverflow.com/users/2251250/arslan"}, "reply_to_user": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 0, "creation_date": 1525880040, "post_id": 50256967, "comment_id": 87532080, "body": "@zwol I added the part of the configure.ac file. could you take a look at it."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 0, "creation_date": 1525880047, "post_id": 50256967, "comment_id": 87532084, "body": "Blech. I need to see more context.  Can you provide a link to the source code of this program, which it sounds like you didn&#39;t write yourself?"}, {"owner": {"reputation": 1604, "user_id": 2251250, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/10101633b337743c6b2beb5ad96d7ef7?s=128&d=identicon&r=PG", "display_name": "arslan", "link": "https://stackoverflow.com/users/2251250/arslan"}, "reply_to_user": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 0, "creation_date": 1525880096, "post_id": 50256967, "comment_id": 87532120, "body": "@zwol the code is here: <a href=\"https://gitlab.com/alimjanyasin/slim-lightweight-hlground\" rel=\"nofollow noreferrer\">gitlab.com/alimjanyasin/slim-lightweight-hlground</a>  Yes, I did not write all of that but I extended the project, however never had to touch the configure before."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1525880109, "post_id": 50256967, "comment_id": 87532132, "body": "Looks likely that the files have CRLF newlines -- ie. that they&#39;re DOS text files, not UNIX files. Did you maybe use a Windows version of git to do the checkout?"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 1, "creation_date": 1525880162, "post_id": 50256967, "comment_id": 87532161, "body": "If you open the file up in vim, run <code>:set fileformat=unix</code> and save it, does that fix things?"}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 0, "creation_date": 1525880167, "post_id": 50256967, "comment_id": 87532167, "body": "I&#39;m looking at it.  Meanwhile, here are some things for you to try: (1) If you are building from a tarball release, you should not need to run <code>aclocal</code> at all.  Skip to the point in the build instructions where you run <code>.&#47;configure</code> and go from there.  (2) If you are building from a VCS checkout, instead of running <code>aclocal</code> (and then <code>automake</code> and <code>autoconf</code> and <code>autoheader</code> and ...) yourself, run <code>autoreconf -iv</code>."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "reply_to_user": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 0, "creation_date": 1525880233, "post_id": 50256967, "comment_id": 87532203, "body": "@zwol, ...unfortunately, which newlines git uses on checkout of text files is runtime-configurable, so looking at the repository doesn&#39;t provide a way to get a definitive answer re: what the OP has on disk."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 1, "creation_date": 1525880286, "post_id": 50256967, "comment_id": 87532232, "body": "@CharlesDuffy I was thinking of an entirely different set of potential problems than it seems you are.  Your hypothesis explains the mangled error message and mine doesn&#39;t, though."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 1, "creation_date": 1525880623, "post_id": 50256967, "comment_id": 87532424, "body": "@arslan see also <a href=\"https://stackoverflow.com/questions/26407408/dealing-with-eol-characters-in-cygwin-git-and-git-for-windows-accessing-the-same\">Dealing with EOL characters in Cygwin Git and Git for Windows accessing the same repository</a>; the lowest-effort workaround may to be use cygwin&#39;s own git to check out working trees you&#39;re going to be building and compiling with Cygwin tools, rather than using Git for Windows."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1525882886, "post_id": 50256967, "comment_id": 87533736, "body": "<code>$&#39;\\r&#39;</code> is a CR character -- so this is still a DOS-newline issue. Fix remains the same. (That said, while in this case the answer <i>wasn&#39;t</i> invalidated -- editing questions in a way that invalidates prior correct answers is frowned on here; this is what tends to be called a &quot;chameleon question&quot;; see <a href=\"https://meta.stackoverflow.com/questions/332820/what-to-do-when-someone-answers-dont-be-a-chameleon-dont-be-a-vandal\" title=\"what to do when someone answers dont be a chameleon dont be a vandal\">meta.stackoverflow.com/questions/332820/&hellip;</a>)."}], "answers": [{"comments": [{"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 1, "creation_date": 1525880485, "post_id": 50257206, "comment_id": 87532336, "body": "Further evidence for this hypothesis: I don&#39;t see any duplicate AC_OUTPUT/AC_CONFIG_FILES entries in the full configure.ac, but the DOS newlines could also be preventing M4 from interpreting \\-newline as intended, in which case the AC_OUTPUT construct shown in the question would be taken as containing many repetitions of a file named &quot;\\&quot;."}, {"owner": {"reputation": 1604, "user_id": 2251250, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/10101633b337743c6b2beb5ad96d7ef7?s=128&d=identicon&r=PG", "display_name": "arslan", "link": "https://stackoverflow.com/users/2251250/arslan"}, "edited": false, "score": 0, "creation_date": 1525880606, "post_id": 50257206, "comment_id": 87532412, "body": "I am trying to install vim on cygwin, and try your suggestion. :)"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1525880693, "post_id": 50257206, "comment_id": 87532478, "body": "If you don&#39;t already have vim, do you have <code>dos2unix</code>? It&#39;s also possible to use <code>tr</code> or other tools for the same purpose; see <a href=\"https://stackoverflow.com/questions/2613800/how-to-convert-dos-windows-newline-crlf-to-unix-newline-lf-in-a-bash-script\" title=\"how to convert dos windows newline crlf to unix newline lf in a bash script\">stackoverflow.com/questions/2613800/&hellip;</a> for a whole bunch of possible tools."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "reply_to_user": {"reputation": 1604, "user_id": 2251250, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/10101633b337743c6b2beb5ad96d7ef7?s=128&d=identicon&r=PG", "display_name": "arslan", "link": "https://stackoverflow.com/users/2251250/arslan"}, "edited": false, "score": 1, "creation_date": 1525880725, "post_id": 50257206, "comment_id": 87532495, "body": "@arslan You may need to convert all of the files in the <code>m4</code> directory, and all of the <code>Makefile.am</code> files throughout the project, as well as <code>configure.ac</code> itself.  The command-line tool <code>dos2unix</code> may be easier to install than vim."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 2, "creation_date": 1525880763, "post_id": 50257206, "comment_id": 87532518, "body": "...or use a Cygwin-native git to avoid having DOS newlines on your files in the first place."}, {"owner": {"reputation": 1604, "user_id": 2251250, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/10101633b337743c6b2beb5ad96d7ef7?s=128&d=identicon&r=PG", "display_name": "arslan", "link": "https://stackoverflow.com/users/2251250/arslan"}, "edited": false, "score": 0, "creation_date": 1525881304, "post_id": 50257206, "comment_id": 87532857, "body": "used cygwin git to clone the project, and did not work. maybe dos2unix is the option I should try."}, {"owner": {"reputation": 1604, "user_id": 2251250, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/10101633b337743c6b2beb5ad96d7ef7?s=128&d=identicon&r=PG", "display_name": "arslan", "link": "https://stackoverflow.com/users/2251250/arslan"}, "edited": false, "score": 0, "creation_date": 1525881579, "post_id": 50257206, "comment_id": 87533020, "body": "@CharlesDuffy dos2unix worked,  hope &quot;./configure&quot; and &quot;make&quot; work as well. :)"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1525882810, "post_id": 50257206, "comment_id": 87533701, "body": "re: cygwin clone not fixing the issue -- try setting <code>core.autocrlf</code> to <code>false</code> and <code>core.eol</code> to <code>lf</code> in your git configuration (as with <code>git config --global</code>)."}, {"owner": {"reputation": 1604, "user_id": 2251250, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/10101633b337743c6b2beb5ad96d7ef7?s=128&d=identicon&r=PG", "display_name": "arslan", "link": "https://stackoverflow.com/users/2251250/arslan"}, "edited": false, "score": 0, "creation_date": 1525882890, "post_id": 50257206, "comment_id": 87533739, "body": "@CharlesDuffy how can I set &quot;core.autocrlf&quot; to &quot;false&quot; and &quot;core.elf&quot; to &quot;If&quot;. I am not very familiar with these. I also updated the question regarding to using &quot;dos2unix&quot;."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1525883027, "post_id": 50257206, "comment_id": 87533821, "body": "<code>git config --global core.autocrlf false; git config --global core.eol lf</code>"}, {"owner": {"reputation": 1604, "user_id": 2251250, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/10101633b337743c6b2beb5ad96d7ef7?s=128&d=identicon&r=PG", "display_name": "arslan", "link": "https://stackoverflow.com/users/2251250/arslan"}, "edited": false, "score": 0, "creation_date": 1525886269, "post_id": 50257206, "comment_id": 87535522, "body": "@CharlesDuffy by doing these git settings, it worked. Thank you so much :) you saved the day."}], "tags": [], "owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "is_accepted": true, "score": 9, "last_activity_date": 1525886993, "last_edit_date": 1525886993, "creation_date": 1525880328, "answer_id": 50257206, "question_id": 50256967, "link": "https://stackoverflow.com/questions/50256967/aclocal-error-is-already-registered-with-ac-config-files-and-or-r-comma/50257206#50257206", "title": "aclocal error: &#39; is already registered with AC_CONFIG_FILES; and/or $&#39;\\r&#39;: command not found", "body": "<p>It's effectively certain that your issue is caused by DOS newlines.</p>\n\n<p>The giveaway is this error:</p>\n\n<blockquote>\n  <p>' is already registered with AC_CONFIG_FILES./usr/src/ports/autoconf2.5/autoconf2.5-2.69-3.noarch/src/autoconf-2.69/lib/autoconf/status.m4:288: AC_CONFIG_FILES is </p>\n</blockquote>\n\n<p>The line beginning with <code>' is already registered with</code> implies that the cursor was sent back to the beginning of the line partway through writing the line to the console -- the exact behavior of printing a string read from a DOS-format text file while it expecting it to be in UNIX format.</p>\n\n<hr>\n\n<h3>Configuring <code>git</code> to check out text files in UNIX format</h3>\n\n<pre><code>git config --global core.autocrlf false\ngit config --global core.eol lf\n</code></pre>\n"}], "owner": {"reputation": 1604, "user_id": 2251250, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/10101633b337743c6b2beb5ad96d7ef7?s=128&d=identicon&r=PG", "display_name": "arslan", "link": "https://stackoverflow.com/users/2251250/arslan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1679, "favorite_count": 0, "accepted_answer_id": 50257206, "answer_count": 1, "score": 1, "last_activity_date": 1525887098, "creation_date": 1525879547, "last_edit_date": 1525887098, "question_id": 50256967, "link": "https://stackoverflow.com/questions/50256967/aclocal-error-is-already-registered-with-ac-config-files-and-or-r-comma", "title": "aclocal error: &#39; is already registered with AC_CONFIG_FILES; and/or $&#39;\\r&#39;: command not found", "body": "<p>I was building a C automake project. Running \"aclocal\" is showing the following error.</p>\n\n<pre><code> $ aclocal\n ' is already registered with AC_CONFIG_FILES./usr/src/ports/autoconf2.5/autoconf2.5-2.69-3.noarch/src/autoconf-2.69/lib/autoconf/status.m4:288: AC_CONFIG_FILES is \n expanded from...\n configure.ac:890: the top level\n autom4te-2.69: /usr/bin/m4 failed with exit status: 1\n aclocal-1.15: error: echo failed with exit status: 1\n</code></pre>\n\n<p>I am using Cygwin on windows 10. </p>\n\n<p>The configure.ac has the following from the line 886 to the end.</p>\n\n<pre><code># ----------------------------------------------------------------------\n# Create output files\n#\necho $SLIM_VERSION &gt; VERSION\nAC_OUTPUT(Makefile \\\n      src/Makefile \\\n      src/genconfig \\\n      src/verifier/Makefile \\\n      src/utility/Makefile \\\n      src/test/Makefile \\\n      lib/Makefile \\\n      ext/Makefile \\\n      test/Makefile \\\n      test/system_check/Makefile \\\n      third_party/Makefile \\\n      third_party/zdelta-2.1/Makefile \\\n      third_party/google-perftools-1.8.3/Makefile \\\n      third_party/google-perftools-1.8.3/src/google/tcmalloc.h \\\n      third_party/google-perftools-1.8.3/src/windows/google/tcmalloc.h \\\n      doc/Makefile \\\n      doc/slim.1)\n</code></pre>\n\n<p>As suggested, I used \"dos2unix\" on every \"*.am\" files and \"configure.ac\", but running \"make\" is showing the following error.</p>\n\n<pre><code>configure.ac:596: the top level\ncd ../.. &amp;&amp; /bin/sh ./config.status third_party/zdelta-2.1/Makefile depfiles\nconfig.status: creating third_party/zdelta-2.1/Makefile\nconfig.status: executing depfiles commands\nsource='deflate.c' object='deflate.o' libtool=no \\\nDEPDIR=.deps depmode=none /bin/sh ../../depcomp \\\ngcc -DHAVE_CONFIG_H -I. -I../../src     -Wall -export-dynamic -O3  -fopenmp -c -o deflate.o deflate.c\n../../depcomp:\u884c2: $'\\r': \u672a\u627e\u5230\u547d\u4ee4\n../../depcomp:\u884c5: $'\\r': \u672a\u627e\u5230\u547d\u4ee4\n../../depcomp:\u884c10: $'\\r': \u672a\u627e\u5230\u547d\u4ee4\n../../depcomp:\u884c15: $'\\r': \u672a\u627e\u5230\u547d\u4ee4\n../../depcomp:\u884c20: $'\\r': \u672a\u627e\u5230\u547d\u4ee4\n../../depcomp:\u884c25: $'\\r': \u672a\u627e\u5230\u547d\u4ee4\n../../depcomp:\u884c27: $'\\r': \u672a\u627e\u5230\u547d\u4ee4\n../../depcomp:\u884c64: \u672a\u9884\u671f\u7684\u7b26\u53f7 `$'in\\r'' \u9644\u8fd1\u6709\u8bed\u6cd5\u9519\u8bef\n'./../depcomp:\u884c64: `case \"$depmode\" in\nmake[2]: *** [Makefile:419\uff1adeflate.o] \u9519\u8bef 2\nmake[2]: \u79bb\u5f00\u76ee\u5f55\u201c/cygdrive/c/LaViT2_8_9/lmntal/slim-lightweight- \nhlground/third_party/zdelta-2.1\u201d\nmake[1]: *** [Makefile:386\uff1aall-recursive] \u9519\u8bef 1\nmake[1]: \u79bb\u5f00\u76ee\u5f55\u201c/cygdrive/c/LaViT2_8_9/lmntal/slim-lightweight- \nhlground/third_party\u201d\nmake: *** [Makefile:425\uff1aall-recursive] \u9519\u8bef 1\n</code></pre>\n\n<p>Here,</p>\n\n<pre><code>\u884c2: $'\\r': \u672a\u627e\u5230\u547d\u4ee4\n</code></pre>\n\n<p>means\n    line 2: $'\\r': cannot find the command</p>\n\n<p>Could anyone help me fix this issue?</p>\n"}, {"tags": ["c", "sockets", "udp", "client-server"], "comments": [{"owner": {"reputation": 789, "user_id": 7868795, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/471c6f01b994a5aadf85dc6cfec40fc4?s=128&d=identicon&r=PG", "display_name": "Ra&#39;Jiska", "link": "https://stackoverflow.com/users/7868795/rajiska"}, "edited": false, "score": 0, "creation_date": 1525879922, "post_id": 50256925, "comment_id": 87531994, "body": "Not answering to the question but if you&#39;re transfering files, you&#39;re most likely wrong using UDP. You should consider using TCP which is safer regarding data corruption."}], "answers": [{"comments": [{"owner": {"reputation": 56858, "user_id": 131930, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/91536fe27d32713b8a154a0bf42f6748?s=128&d=identicon&r=PG", "display_name": "Jeremy Friesner", "link": "https://stackoverflow.com/users/131930/jeremy-friesner"}, "edited": false, "score": 0, "creation_date": 1525924948, "post_id": 50257550, "comment_id": 87548555, "body": "Window size is a TCP thing... you might be thinking of MTU."}], "tags": [], "owner": {"reputation": 53, "user_id": 9266154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/846a39e28dc25ffc348d16aa79d74b78?s=128&d=identicon&r=PG&f=1", "display_name": "\u0130lkerK", "link": "https://stackoverflow.com/users/9266154/%c4%b0lkerk"}, "is_accepted": false, "score": 0, "last_activity_date": 1525881454, "creation_date": 1525881454, "answer_id": 50257550, "question_id": 50256925, "link": "https://stackoverflow.com/questions/50256925/c-prorgramming-send-wav-file-over-udp/50257550#50257550", "title": "C prorgramming, send wav file over udp", "body": "<p>Its most probably either because of the window size(amount of data that can be sent in a packet) or the light-weight IP stack size(I believe this is more probable) which is related to the total maximum amount of bytes you can send at one function call.</p>\n\n<p>If the problem is the window size, you can divide your data and re-assemble in the client as it arrives.\nIf it is stack size you can simply look for where it is defined and change it</p>\n\n<p>I see your libraries doesn't contain lwip, but whatever you are using it must have something conceptually similar.</p>\n\n<p>Hope it helps.</p>\n"}, {"tags": [], "owner": {"reputation": 56858, "user_id": 131930, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/91536fe27d32713b8a154a0bf42f6748?s=128&d=identicon&r=PG", "display_name": "Jeremy Friesner", "link": "https://stackoverflow.com/users/131930/jeremy-friesner"}, "is_accepted": true, "score": 0, "last_activity_date": 1525925124, "creation_date": 1525925124, "answer_id": 50265303, "question_id": 50256925, "link": "https://stackoverflow.com/questions/50256925/c-prorgramming-send-wav-file-over-udp/50265303#50265303", "title": "C prorgramming, send wav file over udp", "body": "<p>Here, you are reading in (possibly as many as) <code>(BUFLEN2*sizeof(short))</code> bytes into your buffer:</p>\n\n<pre><code>while ((k = fread(buf, sizeof(short), BUFLEN2, file)) &gt; 0) {\n</code></pre>\n\n<p>... and here you are sending <code>BUFLEN2</code> bytes to the UDP socket:</p>\n\n<pre><code> if (sendto(s, buf, BUFLEN2, 0 , (struct sockaddr *) &amp;si_other, slen)==-1)\n</code></pre>\n\n<p>... and here you are receiving (possibly as many as) <code>BUFLEN2</code> bytes from the UDP socket:</p>\n\n<pre><code>recv_len = recvfrom(s, buf, BUFLEN2, 0, (struct sockaddr *) &amp;si_other, &amp;slen);\n</code></pre>\n\n<p>I think what you need to do is replace <code>BUFLEN2</code> with <code>k*sizeof(short)</code> in your <code>sendto()</code> call, and replace <code>BUFLEN2</code> with <code>sizeof(buf)</code> in your <code>recvfrom()</code> call, so that you will send and receive all of the data and not just the first half of it.</p>\n"}], "owner": {"reputation": 13, "user_id": 9765559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Wrath13", "link": "https://stackoverflow.com/users/9765559/wrath13"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 604, "favorite_count": 0, "accepted_answer_id": 50265303, "answer_count": 2, "score": 1, "last_activity_date": 1525925124, "creation_date": 1525879402, "last_edit_date": 1525901236, "question_id": 50256925, "link": "https://stackoverflow.com/questions/50256925/c-prorgramming-send-wav-file-over-udp", "title": "C prorgramming, send wav file over udp", "body": "<p>I created a UDP client/server communication in order to test sending wav files, the client send each time a buffer of 2048 samples of the file to the server. The problem is, for each buffer, only the first half (1024 samples) of the buffer is sent correctly, I couldn't figure out the reason behind this error.</p>\n\n<p>Here is the client code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;arpa/inet.h&gt;\n#include &lt;sys/socket.h&gt;\n#define SERVER \"127.0.0.1\"\n#define BUFLEN1 512\n#define BUFLEN2 2048\n#define PORT 8888\nvoid die(char *s)\n{\n    perror(s);\n    exit(1);\n}\n\nint main(void)\n{\n    struct sockaddr_in si_other;\n    int s, i, slen=sizeof(si_other);\n    char fileaddress[BUFLEN1];\n    short buf[BUFLEN2];\n    FILE *file;\n    int k;\n\n    if ( (s=socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP)) == -1)\n    {\n        die(\"socket\");\n    }\n\n    memset((char *) &amp;si_other, 0, sizeof(si_other));\n    si_other.sin_family = AF_INET;\n    si_other.sin_port = htons(PORT);\n\n    if (inet_aton(SERVER , &amp;si_other.sin_addr) == 0)\n    {\n        fprintf(stderr, \"inet_aton() failed\\n\");\n        exit(1);\n    }\n\n    printf(\"Enter file address: \");\n    gets(fileaddress);\n    file=fopen(fileaddress,\"rb\");\n    while ((k = fread(buf, sizeof(short), BUFLEN2, file)) &gt; 0) {\n        if (sendto(s, buf, BUFLEN2 , 0 , (struct sockaddr *) &amp;si_other, slen)==-1)\n        {\n            die(\"sendto()\");\n        }\n    }\n\n    close(s);\n    return 0;\n}\n</code></pre>\n\n<p>Server code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;arpa/inet.h&gt;\n#include &lt;sys/socket.h&gt;\n#define SERVER \"127.0.0.1\"\n#define BUFLEN2 2048\n#define PORT 8888\n\nvoid die(char *s)\n{\n    perror(s);\n    exit(1);\n}\nint main(void)\n{\n    struct sockaddr_in si_me, si_other;\n\n    int s, i, slen = sizeof(si_other) , recv_len;\n    short buf[BUFLEN2];\n\n    //create a UDP socket\n    if ((s=socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP)) == -1)\n    {\n        die(\"socket\");\n    }\n\n    // zero out the structure\n    memset((char *) &amp;si_me, 0, sizeof(si_me));\n\n    si_me.sin_family = AF_INET;\n    si_me.sin_port = htons(PORT);\n    si_me.sin_addr.s_addr = htonl(INADDR_ANY);\n\n    //bind socket to port\n    if( bind(s , (struct sockaddr*)&amp;si_me, sizeof(si_me) ) == -1)\n    {\n        die(\"bind\");\n    }\n    printf(\"Waiting for data...\\n\");\n    fflush(stdout);\n    while(1)\n    {\n        recv_len = recvfrom(s, buf, BUFLEN2, 0, (struct sockaddr *) &amp;si_other, &amp;slen);\n        if (recv_len == -1)\n        {\n            die(\"recvfrom()\");\n        }\n    }\n    close(s);\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "linux", "system-calls"], "comments": [{"owner": {"reputation": 1828, "user_id": 2584754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Q3gFD.jpg?s=128&g=1", "display_name": "sturcotte06", "link": "https://stackoverflow.com/users/2584754/sturcotte06"}, "edited": false, "score": 1, "creation_date": 1525879176, "post_id": 50256691, "comment_id": 87531493, "body": "Wrapper functions are also called system calls, as there&#39;s no way to directly generate the trap without using the wrapper."}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 1828, "user_id": 2584754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Q3gFD.jpg?s=128&g=1", "display_name": "sturcotte06", "link": "https://stackoverflow.com/users/2584754/sturcotte06"}, "edited": false, "score": 1, "creation_date": 1525879984, "post_id": 50256691, "comment_id": 87532044, "body": "@sturcotte06 That 2nd part of that statement doesn&#39;t make sense. You could always inline the wrappers code."}, {"owner": {"reputation": 1828, "user_id": 2584754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Q3gFD.jpg?s=128&g=1", "display_name": "sturcotte06", "link": "https://stackoverflow.com/users/2584754/sturcotte06"}, "edited": false, "score": 0, "creation_date": 1525880104, "post_id": 50256691, "comment_id": 87532128, "body": "What does inlining has to do with kernel mode switch and hardware trap generation?"}, {"owner": {"reputation": 100758, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1525880124, "post_id": 50256691, "comment_id": 87532145, "body": "You do when it&#39;s not useful to differentiate. Similarly, we say that we connect to stackoverflow.com even though you can&#39;t connect to hostnames, only IP addresses. It&#39;s not helpful or useful to consistently say &quot;I looked up stackoverflow.com and connected to its address&quot; outside of very specific networking discussion"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 1828, "user_id": 2584754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Q3gFD.jpg?s=128&g=1", "display_name": "sturcotte06", "link": "https://stackoverflow.com/users/2584754/sturcotte06"}, "edited": false, "score": 2, "creation_date": 1525880956, "post_id": 50256691, "comment_id": 87532641, "body": "@sturcotte06: If it were not possible to generate the trap without using the wrapper, it would be impossible to implement the wrapper."}], "answers": [{"comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1525879906, "post_id": 50256927, "comment_id": 87531980, "body": "I agree.  Note that POSIX doesn&#39;t define any system calls (see <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap03.html#tag_03_389\" rel=\"nofollow noreferrer\">Definitions 389-399</a>); it only defines functions which provide the services.  The details of how to achieve the required effect of any given function is left up to the implementation."}], "tags": [], "owner": {"reputation": 2213, "user_id": 7757891, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/472798cf3c4d45c418314f837590985c?s=128&d=identicon&r=PG&f=1", "display_name": "Petar Velev", "link": "https://stackoverflow.com/users/7757891/petar-velev"}, "is_accepted": false, "score": 3, "last_activity_date": 1525879406, "creation_date": 1525879406, "answer_id": 50256927, "question_id": 50256691, "link": "https://stackoverflow.com/questions/50256691/are-the-wrapper-functions-for-system-calls-also-called-system-calls/50256927#50256927", "title": "Are the wrapper functions for system calls also called system calls?", "body": "<p>Short answer - Yes.<br>\nLong answer - it depends. A system call is the programmatic way in which a computer program requests a service from the kernel of the operating system it is executed on. This may include hardware-related services (for example, accessing a hard disk drive), creation and execution of new processes, and communication with integral kernel services such as process scheduling. System calls provide an essential interface between a process and the operating system.  </p>\n\n<p>System calls are not defined as specific functions. Rather they are request for services or in other words the OS API. They are almost always hidden from the user by the standard functions which are provided by the language standard.\nAnd the standard is implemented in the compilers which differ from OS to OS.</p>\n"}, {"tags": [], "owner": {"reputation": 1602, "user_id": 6023771, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/67e7bfd227dd05ce79a8e4a4f18f37c2?s=128&d=identicon&r=PG&f=1", "display_name": "zee", "link": "https://stackoverflow.com/users/6023771/zee"}, "is_accepted": false, "score": 1, "last_activity_date": 1525886969, "creation_date": 1525886969, "answer_id": 50258993, "question_id": 50256691, "link": "https://stackoverflow.com/questions/50256691/are-the-wrapper-functions-for-system-calls-also-called-system-calls/50258993#50258993", "title": "Are the wrapper functions for system calls also called system calls?", "body": "<p>I think that the other answer by Petar is what is correct but I'd also like to add that for me the simplest way to explain why open is considered a system call is because syscalls are not guaranteed to be the same across all OS's. For example if we imagine an OS where syscall 1 is open, another OS's might use syscall 1 for write (as linux x64 does), so for the sake of compatibility functions such <code>open()</code> were added, where the OS would provide the implementation of <code>open()</code> as a call to the appropriate syscall value, and the programmer wouldn't have to worry about calling the right syscall number between different OS's</p>\n"}], "owner": {"reputation": 197, "user_id": 8041827, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/44b352a4b5dc351fde5ccfa4b3060fb7?s=128&d=identicon&r=PG&f=1", "display_name": "user247763", "link": "https://stackoverflow.com/users/8041827/user247763"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1911, "favorite_count": 3, "answer_count": 2, "score": 5, "last_activity_date": 1525886969, "creation_date": 1525878681, "question_id": 50256691, "link": "https://stackoverflow.com/questions/50256691/are-the-wrapper-functions-for-system-calls-also-called-system-calls", "title": "Are the wrapper functions for system calls also called system calls?", "body": "<p>The <a href=\"http://man7.org/linux/man-pages/man2/open.2.html\" rel=\"noreferrer\">documentation</a> for the <code>open()</code> function says the following:</p>\n\n<blockquote>\n  <p>The open() <strong>system call</strong> opens the file specified by pathname.</p>\n</blockquote>\n\n<p>I thought that <code>open()</code> is a wrapper function for a system call, and is not itself a system call.</p>\n\n<p>Or are the wrapper functions for system calls also called system calls?</p>\n"}, {"tags": ["c++", "c", "visual-studio-2015"], "comments": [{"owner": {"reputation": 1727, "user_id": 5440453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3500f6dc5327b259bb48da3399268b0?s=128&d=identicon&r=PG&f=1", "display_name": "Algirdas Preid\u017eius", "link": "https://stackoverflow.com/users/5440453/algirdas-preid%c5%beius"}, "edited": false, "score": 0, "creation_date": 1525878180, "post_id": 50256473, "comment_id": 87530811, "body": "Please copy-paste the output as text, instead of providing screenshots of it."}, {"owner": {"reputation": 23093, "user_id": 7359094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/HxJgU.jpg?s=128&g=1", "display_name": "Fran&#231;ois Andrieux", "link": "https://stackoverflow.com/users/7359094/fran%c3%a7ois-andrieux"}, "edited": false, "score": 2, "creation_date": 1525878247, "post_id": 50256473, "comment_id": 87530858, "body": "c and c++ are different languages, there is no c/c++ language. It seems like this is c. It&#39;s important to specify for which language you are asking since answers in c++ and answers in c are frequently very different."}, {"owner": {"reputation": 546, "user_id": 9721071, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u043c\u0430\u043b\u0438\u043d \u0447\u0435\u043a\u0443\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/9721071/%d0%bc%d0%b0%d0%bb%d0%b8%d0%bd-%d1%87%d0%b5%d0%ba%d1%83%d1%80%d0%be%d0%b2"}, "edited": false, "score": 0, "creation_date": 1525878367, "post_id": 50256473, "comment_id": 87530940, "body": "It&#39;s unclear what is this code supposed to do, what is wrong with the output and how should it look like?"}, {"owner": {"reputation": 494, "user_id": 1383880, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/258c2172c30ab4b732d6fb83ffb2c586?s=128&d=identicon&r=PG", "display_name": "CannedMoose", "link": "https://stackoverflow.com/users/1383880/cannedmoose"}, "edited": false, "score": 0, "creation_date": 1525878529, "post_id": 50256473, "comment_id": 87531044, "body": "<code>nullptr</code> is only available since C++11"}, {"owner": {"reputation": 31, "user_id": 9468054, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-X0GmZO5JE8k/AAAAAAAAAAI/AAAAAAAAAFI/4DLuGbSLi9w/photo.jpg?sz=128", "display_name": "Tony Mendes", "link": "https://stackoverflow.com/users/9468054/tony-mendes"}, "edited": false, "score": 0, "creation_date": 1525878878, "post_id": 50256473, "comment_id": 87531302, "body": "The dll was written in C++, the main program in C. The first output should be similar to the second. The second output is the &quot;good one&quot;. I can only achieve that if I have breakpoints on the code, and that makes no sense for me. Every iteration of the for loop should give a different output"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 9468054, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-X0GmZO5JE8k/AAAAAAAAAAI/AAAAAAAAAFI/4DLuGbSLi9w/photo.jpg?sz=128", "display_name": "Tony Mendes", "link": "https://stackoverflow.com/users/9468054/tony-mendes"}, "edited": false, "score": 0, "creation_date": 1525879184, "post_id": 50256699, "comment_id": 87531497, "body": "Spot on my friend, thanks. Thought that it would trigger a new time on every call"}, {"owner": {"reputation": 6463, "user_id": 6387170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d425edf9cc20e61c8cc3be162915f06?s=128&d=identicon&r=PG&f=1", "display_name": "UKMonkey", "link": "https://stackoverflow.com/users/6387170/ukmonkey"}, "reply_to_user": {"reputation": 31, "user_id": 9468054, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-X0GmZO5JE8k/AAAAAAAAAAI/AAAAAAAAAFI/4DLuGbSLi9w/photo.jpg?sz=128", "display_name": "Tony Mendes", "link": "https://stackoverflow.com/users/9468054/tony-mendes"}, "edited": false, "score": 3, "creation_date": 1525879602, "post_id": 50256699, "comment_id": 87531787, "body": "As an alternative; @TonyMendes there are better rand functions in c++ if you can move it to your dll."}], "tags": [], "owner": {"reputation": 61409, "user_id": 485343, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e18b024a122df74275dd2c4486e8a2b4?s=128&d=identicon&r=PG", "display_name": "rustyx", "link": "https://stackoverflow.com/users/485343/rustyx"}, "is_accepted": true, "score": 3, "last_activity_date": 1525878695, "creation_date": 1525878695, "answer_id": 50256699, "question_id": 50256473, "link": "https://stackoverflow.com/questions/50256473/different-result-when-hitting-breakpoints-using-dll-and-c-c/50256699#50256699", "title": "Different result when hitting breakpoints, using DLL and C/C++", "body": "<p>Yes it's because of the random generator.</p>\n\n<p>You are calling <code>srand(time(nullptr))</code> inside <code>get_powerup</code>.\nThat means the random number generator is seeded from the current time on every call, and because <code>time</code> is on a second granularity, will appear to return the same value when you run the code.</p>\n\n<p>The idea of <code>srand</code> is to be called only once during application startup to seed the PRNG. Move it to the beginning of the <code>main</code> function.</p>\n"}], "owner": {"reputation": 31, "user_id": 9468054, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-X0GmZO5JE8k/AAAAAAAAAAI/AAAAAAAAAFI/4DLuGbSLi9w/photo.jpg?sz=128", "display_name": "Tony Mendes", "link": "https://stackoverflow.com/users/9468054/tony-mendes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 50256699, "answer_count": 1, "score": 0, "last_activity_date": 1525878695, "creation_date": 1525877973, "last_edit_date": 1525878601, "question_id": 50256473, "link": "https://stackoverflow.com/questions/50256473/different-result-when-hitting-breakpoints-using-dll-and-c-c", "title": "Different result when hitting breakpoints, using DLL and C/C++", "body": "<p>I\u00b4m trying to develop a small game for school using C/C++ and a DLL that I made and linked implicitly. So far so good. \nNow I'm testing some functions and I'm getting different results when I run all code at once or if I put a breakpoint to stop the code.</p>\n\n<p>I'll show some code and I'll try to explain the best I can.</p>\n\n<pre><code>struct powerup get_powerup() {\nstruct powerup aux {};\n\nsrand(time(nullptr));\nint r = rand() % 100 + 1; // random number between 1 and 100\n\nif (r &lt;= 60) //common\n    aux.occurrence = common;\nelse if (r &gt; 60 &amp;&amp; r &lt; 90) //rare\n    aux.occurrence = uncommon;\nelse if (r &gt;= 90) //very rare\n    aux.occurrence = rare;\n\nswitch (aux.occurrence)\n{\ncase common:\n    r = rand() % 2 + 1;\n\n    if (r == 1)\n        aux = set_powerup(shield);\n    if (r == 2)\n        aux = set_powerup(enemy_boost);\n    break;\ncase uncommon:\n    r = rand() % 3 + 1;\n\n    if (r == 1)\n        aux = set_powerup(ice);\n    if (r == 2)\n        aux = set_powerup(battery);\n    else if (r == 3)\n        aux = set_powerup(alchool);\n    break;\ncase rare:\n    r = rand() % 2 + 1;\n\n    if (r == 1)\n        aux = set_powerup(life);\n    if (r == 2)\n        aux = set_powerup(noclip);\n    break;\n}\n\nreturn aux;\n}\n</code></pre>\n\n<p>This is the function I'm testing, very simple and works fine.</p>\n\n<pre><code>int _tmain(int argc, TCHAR *argv[]) {\n#ifdef UNICODE\n_setmode(_fileno(stdin), _O_WTEXT);\n_setmode(_fileno(stdout), _O_WTEXT);\n_setmode(_fileno(stderr), _O_WTEXT);\n#endif\nfor (int i = 0; i &lt; 10; i++)\n{\n    const struct powerup ajux = get_powerup();\n\n    _tprintf(TEXT(\"power up: %hs\\n\"), powerup_type_string[ajux.type]);\n}\n\nsystem(\"Pause\");\n\nreturn 0;\n}\n</code></pre>\n\n<p>This is my main code.\nNow the odd part, at least for me. And before you say \"its because it's a random generator\", hold on for a moment.</p>\n\n<p>When running the code all at once, I get the same result every time:</p>\n\n<pre><code>power up: Enemy Boost\npower up: Enemy Boost\npower up: Enemy Boost\npower up: Enemy Boost\npower up: Enemy Boost\npower up: Enemy Boost\npower up: Enemy Boost\npower up: Enemy Boost\npower up: Enemy Boost\npower up: Enemy Boost\n</code></pre>\n\n<p>But if put a breakpoint someone in the for loop, I get the expected result:</p>\n\n<pre><code>power up: Shield\npower up: Battery\npower up: Ice\npower up: Alchool\npower up: Alchool\npower up: Battery\npower up: No Clip\npower up: Life\npower up: Enemy Boost\npower up: Enemy Boost\n</code></pre>\n\n<p>Any suggestion for this?</p>\n"}, {"tags": ["c", "gdb"], "comments": [{"owner": {"reputation": 1101, "user_id": 7021836, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/299fc62810116e741333419b8e6cfd24?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Quilliam", "link": "https://stackoverflow.com/users/7021836/alex-quilliam"}, "edited": false, "score": 0, "creation_date": 1525877270, "post_id": 50256218, "comment_id": 87530218, "body": "What flags did you use to compile your program?"}, {"owner": {"reputation": 546, "user_id": 9721071, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u043c\u0430\u043b\u0438\u043d \u0447\u0435\u043a\u0443\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/9721071/%d0%bc%d0%b0%d0%bb%d0%b8%d0%bd-%d1%87%d0%b5%d0%ba%d1%83%d1%80%d0%be%d0%b2"}, "edited": false, "score": 0, "creation_date": 1525878505, "post_id": 50256218, "comment_id": 87531027, "body": "Make sure you have compiled for debugging with the -g flag as Alex Quilliam mentioned."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1525880154, "post_id": 50256218, "comment_id": 87532158, "body": "Before <code>r</code>, issue <code>d</code> command to delete all breakpoints perhaps?"}, {"owner": {"reputation": 69, "user_id": 9577107, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Hongwei Li", "link": "https://stackoverflow.com/users/9577107/hongwei-li"}, "edited": false, "score": 0, "creation_date": 1525880597, "post_id": 50256218, "comment_id": 87532408, "body": "I use gcc -g test.c -o test"}, {"owner": {"reputation": 69, "user_id": 9577107, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Hongwei Li", "link": "https://stackoverflow.com/users/9577107/hongwei-li"}, "edited": false, "score": 0, "creation_date": 1525880782, "post_id": 50256218, "comment_id": 87532529, "body": "I did compile it and there is definitely no breakpoints."}, {"owner": {"reputation": 2241, "user_id": 816536, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oeXXN.jpg?s=128&g=1", "display_name": "Greg A. Woods", "link": "https://stackoverflow.com/users/816536/greg-a-woods"}, "edited": false, "score": 0, "creation_date": 1535075750, "post_id": 50256218, "comment_id": 90942278, "body": "This problem continues with gdb-8.1.1  Worse, it doesn&#39;t seem to know how to load a core file on macOS 10.13.6 either (<code>no core file handler recognizes format</code>)"}], "owner": {"reputation": 69, "user_id": 9577107, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Hongwei Li", "link": "https://stackoverflow.com/users/9577107/hongwei-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 254, "favorite_count": 3, "answer_count": 0, "score": 5, "last_activity_date": 1527935849, "creation_date": 1525877206, "question_id": 50256218, "link": "https://stackoverflow.com/questions/50256218/gdb-not-running-program-mac-os", "title": "GDB not running program (Mac OS)", "body": "<p>I use gdb to run my program but it doesn't work with it. It returns warning:\nCannot insert breakpoint -1.\nCannot access memory at address 0xf726 \nI didn't set any breakpoint. I am not sure is it the problem of gdb and how could I fix it?\nHere is the result I got:</p>\n\n<pre><code>rihiroshibitekiMacBook-Pro:desktop Richard$ gdb test\nGNU gdb (GDB) 8.1\nCopyright (C) 2018 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-apple-darwin17.3.0\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n&lt;http://www.gnu.org/software/gdb/bugs/&gt;.\nFind the GDB manual and other documentation resources online at:\n&lt;http://www.gnu.org/software/gdb/documentation/&gt;.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from test...Reading symbols from \n/Users/Richard/Desktop/test.dSYM/\nContents/Resources/DWARF/test...done.\ndone.\n(gdb) r\nStarting program: /Users/Richard/Desktop/test \n[New Thread 0x1903 of process 776]\n[New Thread 0x1c03 of process 776]\nWarning:\nCannot insert breakpoint -1.\nCannot access memory at address 0xf726\nCommand aborted.\n</code></pre>\n"}, {"tags": ["c", "fopen", "fclose"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1525875918, "post_id": 50255784, "comment_id": 87529148, "body": "What OS?  What filesystem?  Also, you need to check the return value from <code>fclose()</code> as it can fail and you can lose data."}, {"owner": {"reputation": 37256, "user_id": 736308, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/o5EqQ.jpg?s=128&g=1", "display_name": "cdarke", "link": "https://stackoverflow.com/users/736308/cdarke"}, "edited": false, "score": 3, "creation_date": 1525876144, "post_id": 50255784, "comment_id": 87529316, "body": "There is a note in the Linux <code>man</code> pages for <code>fclose</code>:  <i>Note that fclose() flushes only the user-space buffers provided by        the C library.  To ensure that the data is physically stored on disk        the kernel buffers must be flushed too, for example, with sync(2) or        fsync(2).</i>"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1525876868, "post_id": 50255784, "comment_id": 87529925, "body": "C does not specify that there is any delay between when you <code>fclose()</code> a file and when you can subsequently <code>fopen()</code> the same underlying path, though it allows plenty of freedom for that to be the case for specific implementations.  For that matter, C does not forbid the same underlying path being open multiple times simultaneously, and some implementations in fact permit that."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 2, "creation_date": 1525877399, "post_id": 50255784, "comment_id": 87530292, "body": "Is this under Windows?  I&#39;ve had weird issues like this under Windows.  I can&#39;t imagine this happening under Unix or Linux."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1525877607, "post_id": 50255784, "comment_id": 87530443, "body": "This could be an antivirus problem. I&#39;ve stumbled upon such a thing a few years ago. Disable the antivirus and see if the problems goes away."}, {"owner": {"reputation": 1878, "user_id": 2588499, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/a774cbfdbf028557b13027b6ec42cccf?s=128&d=identicon&r=PG", "display_name": "Arun", "link": "https://stackoverflow.com/users/2588499/arun"}, "edited": false, "score": 0, "creation_date": 1525877611, "post_id": 50255784, "comment_id": 87530448, "body": "windows10 is the OS and NFTS is the filesystem"}, {"owner": {"reputation": 1878, "user_id": 2588499, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/a774cbfdbf028557b13027b6ec42cccf?s=128&d=identicon&r=PG", "display_name": "Arun", "link": "https://stackoverflow.com/users/2588499/arun"}, "edited": false, "score": 0, "creation_date": 1525877750, "post_id": 50255784, "comment_id": 87530539, "body": "will this be solved if I use fflush?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1525877894, "post_id": 50255784, "comment_id": 87530635, "body": "There is no reason to think that calling <code>fflush()</code> before <code>fclose()</code> will help, because <code>fclose()</code> implies <code>fflush()</code>.  You could try, but even if you see improved behavior, it will be difficult to be confident that the problem is fully solved."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1525883150, "post_id": 50255784, "comment_id": 87533891, "body": "Did you mean that the fopen in function<b>2</b> sometimes fails?"}], "answers": [{"comments": [{"owner": {"reputation": 13530, "user_id": 593382, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f7326fd554e09edf21ca727d6854e22e?s=128&d=identicon&r=PG", "display_name": "Grady Player", "link": "https://stackoverflow.com/users/593382/grady-player"}, "edited": false, "score": 2, "creation_date": 1525878573, "post_id": 50256584, "comment_id": 87531071, "body": "I dont think your file descriptor is valid after <code>fclose</code>"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1525884695, "post_id": 50256584, "comment_id": 87534714, "body": "The Microsoft documentation for <code>_fileno</code> says the result is undefined if the parameter does not specify an open file."}, {"owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1525899354, "post_id": 50256584, "comment_id": 87541936, "body": "@rici: You are right, and it does not make sense to call <code>fsync</code> on a closed stream. I have edited my post to use POSIX <code>sync</code> function."}], "tags": [], "owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "is_accepted": false, "score": 2, "last_activity_date": 1525899450, "last_edit_date": 1525899450, "creation_date": 1525878279, "answer_id": 50256584, "question_id": 50255784, "link": "https://stackoverflow.com/questions/50255784/does-fclose-release-the-file-immediately/50256584#50256584", "title": "Does fclose release the file immediately?", "body": "<p>Draft N1570 for C11 says as 7.21.5.1 The fclose function</p>\n\n<blockquote>\n  <p>A successful call to the fclose function causes the stream pointed to by stream to be\n  flushed and the associated file to be closed. Any unwritten buffered data for the stream\n  are delivered to the host environment to be written to the file; any unread buffered data\n  are discarded. Whether or not the call succeeds, the stream is disassociated from the file\n  and any buffer set by the setbuf or setvbuf function is disassociated from the stream\n  (and deallocated if it was automatically allocated).</p>\n</blockquote>\n\n<p>It makes no assumption on what happens at the host environment level, that is does the function returns only when the whole operation is finished, or does it returns as soon as a request has been queued.</p>\n\n<p>As race conditions can happen in your environment, you should retry a failed open a number of times, eventually with a delay between them. If portability is not a problem and if your system supports the POSIX <code>sync</code> function, you can also force a disk synchronisation of the file after closing it:</p>\n\n<ul>\n<li><p>Close part:</p>\n\n<pre><code>...\nfclose(fp)\nsync();         // forces synchronization of io buffers to disk \n</code></pre></li>\n<li><p>Re-open part</p>\n\n<pre><code>ntries = ...;   // number of open tries\nwhile (ntries-- &gt; 0) {\n    fp = fopen(...);\n    if (fp != NULL) break;   // open was successful\n    // optionaly add a delay\n}\n</code></pre></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 1, "last_activity_date": 1525878397, "creation_date": 1525878397, "answer_id": 50256619, "question_id": 50255784, "link": "https://stackoverflow.com/questions/50255784/does-fclose-release-the-file-immediately/50256619#50256619", "title": "Does fclose release the file immediately?", "body": "<p>In an environment and with a C implementation where you must accommodate such behavior, the best approach is probably to implement some fault tolerance around the <code>fopen()</code>s.  Although an <em>unconditional</em> <code>sleep()</code> is not the right answer, short, conditional delays via <code>sleep()</code> or a similar function may indeed be part of such an strategy.  For example, you might do something along these lines:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;errno.h&gt;\n#define MAX_ATTEMPTS 3\n\nFILE *tolerant_fopen(const char *path, const char *mode) {\n    FILE *result;\n    int attempts = 0;\n\n    while (!(result = fopen(path, mode))) {\n        if (errno != EACCES || attempts &gt;= MAX_ATTEMPTS) {\n            break;\n        }\n        if (sleep(1) == 0) {\n            attempts += 1;\n        }\n    }\n\n    return result;\n}\n</code></pre>\n\n<p>That attempts to open the file immediately, and in the event that that fails on account of access permissions, it waits a short time and then makes another attempt.  Overall it may make three or more attempts to open the file, spaced up to a second apart or perhaps slightly more.  (Note that <code>sleep()</code> can be interrupted early; in that case it returns the number of seconds left to sleep.)</p>\n\n<p>You can of course implement a different strategy for the timing and duration of the retries if you prefer, retry more error conditions, <em>etc</em>..</p>\n"}], "owner": {"reputation": 1878, "user_id": 2588499, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/a774cbfdbf028557b13027b6ec42cccf?s=128&d=identicon&r=PG", "display_name": "Arun", "link": "https://stackoverflow.com/users/2588499/arun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2587, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1525899450, "creation_date": 1525875811, "last_edit_date": 1525877264, "question_id": 50255784, "link": "https://stackoverflow.com/questions/50255784/does-fclose-release-the-file-immediately", "title": "Does fclose release the file immediately?", "body": "<p>I have 2 functions. The first function is opening a file in write mode and writing some contents to it and then closing it. </p>\n\n<pre><code>FILE *fp = fopen(\"file.txt\", \"w\");\n//writing itnot file using fwrite\nfclose(fp);\n</code></pre>\n\n<p>The second function opens the file in read mode, parses the content and then closes the file. </p>\n\n<pre><code>FILE *fp = fopen(\"file.txt\", \"r\");\n//parsing logic\nfclose(fp);\n</code></pre>\n\n<p>In <code>main</code>, I am calling <code>function1</code> and <code>function2</code> sequentially. </p>\n\n<pre><code>int main()\n{\n    function1();\n    function2();\n    return 1;\n}\n</code></pre>\n\n<p>Sometimes, <code>function1</code> <code>fopen</code> fails with error number 13 i.e. Permission Denied. I am observing this only sometimes. I introduced a <code>sleep</code> in <code>function1</code> after <code>fclose</code> for 2 seconds and it started working fine without any issues. </p>\n\n<p>So I am suspecting file is not immediately released after <code>fclose</code>. Sleep is not the right solution. Can anyone suggest how to resolve this problem? The example I have given here is a use case and the actual code is running in a thread environment.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 157, "user_id": 7391306, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Toshiyuki", "link": "https://stackoverflow.com/users/7391306/toshiyuki"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1525881077, "post_id": 50255778, "comment_id": 87532724, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/170704/discussion-between-toshiyuki-and-david-c-rankin\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": true, "score": 4, "last_activity_date": 1525883685, "last_edit_date": 1525883685, "creation_date": 1525883030, "answer_id": 50257992, "question_id": 50255778, "link": "https://stackoverflow.com/questions/50255778/errorinvalid-type-argument-of-have-queue-aka-struct-queue/50257992#50257992", "title": "error:invalid type argument of &#39;-&gt;&#39;(have &#39;Queue {aka struct Queue}", "body": "<p>Your problems are rudimentary, and you need to spend time competing <code>le_ficheiro</code>. For starters, you cannot assign the result of <code>atoi(s2)</code> to <code>p.pointer_instrucoes.head</code>. <code>head</code> is not an <code>int</code>, it is a <em>pointer to</em> <code>Node*</code>. You violate the <em>Strict Aliasing Rule</em> <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.5p6\" rel=\"nofollow noreferrer\">C11 Standard - \u00a76.5 Expressions (p6,7)</a> and probably a dozen others in attempting to access and modify <code>Node*</code> by assigning an <code>int</code> as its value.</p>\n\n<p>You invoke <em>Undefined Behavior</em> attempting to access <code>p-&gt;id</code> when it is indeterminate (uninitialized).</p>\n\n<p>You make life much more difficult than it needs to be by attempting to manually separate values from <code>line</code> using <code>strchr(line, ' ')</code>. You already have all values contained in <code>line</code>, you can use <code>sscanf</code> to parse all six values to <code>int</code> in a single call and validate the line, e.g.</p>\n\n<pre><code>    while ((read = getline (&amp;line, &amp;len,ficheiro)) != -1) //le de linha a linha\n    {\n        int a, b, c, d, e, f;\n        if (sscanf (line, \"%d %d %d %d %d %d\", \n                    &amp;a, &amp;b, &amp;c, &amp;d, &amp;e, &amp;f) != 6) {\n            fprintf (stderr, \"error: failed to parse line '%d'.\\n\",\n                    contador);\n            continue;\n        }\n        PCB *p = new_pcb (contador);\n        if (!p)  /* Validate EVERY Allocation */\n            exit (EXIT_FAILURE);\n</code></pre>\n\n<p>However, before you can validate every allocation and avoid potentially invoking <em>Undefined Behavior</em>, you must provide meaningful return values from <code>new_node, new_queue &amp; new_pcb</code>, to indicate success/failure, e.g.</p>\n\n<pre><code>Node *new_node (PCB *e)\n{\n    Node *n = malloc (sizeof *n);\n    if (!n) {   /* Validate EVERY Allocation */\n        perror (\"malloc-new_node\");\n        return NULL;  /* return NULL on failure */\n    }\n    n-&gt;element = e;\n    n-&gt;next = NULL;\n\n    return n;\n}\n\nQueue *new_queue (int limit)\n{\n    Queue *q = malloc (sizeof *q);   /* typo in declaration */\n    if (!q) {\n        perror (\"malloc-new_queue\");\n        return NULL;\n    }\n    q-&gt;limit = limit;\n    q-&gt;head = NULL;\n    q-&gt;sizeQueue = 0;\n\n    return q;\n}\n\nPCB *new_pcb (int id)\n{\n    PCB *p = malloc (sizeof *p);\n    if (!p) {\n        perror (\"malloc-new_pcb\");\n        return NULL;\n    }\n    p-&gt;id = id;\n    p-&gt;pointer_instrucoes = 0;\n    p-&gt;program_counter = 0;\n    p-&gt;size = 0;\n\n    return p;\n}\n</code></pre>\n\n<p>It is clear you got part way through <code>le_ficheiro</code> and just gave up. It isn't anywhere near complete, only 1 of the data values from each line of input was even used in your code (the rest you attempted to print as text just to see where your <code>s2</code> pointer was pointing -- but not make any further or meaningful use of the values)</p>\n\n<p>You don't even call <code>new_node</code> in order to create a <code>Node*</code> value that conceivably could be assigned to <code>p.pointer_instrucoes.head</code>. Take it step-by-step. You need to call <code>new_node</code> somewhere in <code>le_ficheiro</code> so that you have a pointer you can assign to <code>p.pointer_instrucoes.head</code>. There isn't any magic to it, but you must be methodical about insuring each value and each member of each structure is created and properly initialized with a value before you attempt to use them.</p>\n\n<p>Basically you had a shell for <code>le_ficheiro</code> which you need to continue to complete, working from a somewhat better starting position of:</p>\n\n<pre><code>int le_ficheiro (char* filename) \n{\n    FILE *ficheiro = fopen (filename,\"r\");\n    size_t len = 0;\n    ssize_t read = 0;\n    int contador = 1;   //onde comeca o id\n\n    if (ficheiro == NULL) {\n        perror (\"fopen-filename\");\n        exit (EXIT_FAILURE);\n    }\n\n    while ((read = getline (&amp;line, &amp;len,ficheiro)) != -1) //le de linha a linha\n    {\n        int a, b, c, d, e, f;\n        if (sscanf (line, \"%d %d %d %d %d %d\", \n                    &amp;a, &amp;b, &amp;c, &amp;d, &amp;e, &amp;f) != 6) {\n            fprintf (stderr, \"error: failed to parse line '%d'.\\n\",\n                    contador);\n            continue;\n        }\n        PCB *p = new_pcb (contador);\n        if (!p)\n            exit (EXIT_FAILURE);\n\n        p-&gt;instante = a;\n        printf (\"Instante: %d\\n\", p-&gt;instante);\n\n        /* you must assign and allocate as necessary to use remaining\n         * values read from file HERE. Nowhere do you assign p-&gt;id\n         * before attempting to print, etc...\n         */\n        printf (\"Id: %d\\n\", p-&gt;id);\n\n        /* you cannot assign atoi(s2) to p.pointer_instrucoes.head.\n         * it expects type 'Node *', not int.\n         */\n        // p.pointer_instrucoes.head = FIXME;\n        // printf (\"%d\\n\", p-&gt;pointer_instrucoes-&gt;head);\n        contador++;\n    }\n    fclose(ficheiro);\n\n    free (line);\n    free(s1);\n\n    exit(EXIT_SUCCESS);\n}\n</code></pre>\n\n<p>When you are stuck in writing a function, don't give up. Instead see <a href=\"https://ericlippert.com/2014/03/05/how-to-debug-small-programs/\" rel=\"nofollow noreferrer\"><strong>How to debug small programs</strong></a> and talk to the duck... Really, it helps <code>:)</code></p>\n"}], "owner": {"reputation": 157, "user_id": 7391306, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Toshiyuki", "link": "https://stackoverflow.com/users/7391306/toshiyuki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 50257992, "answer_count": 1, "score": 0, "last_activity_date": 1525883685, "creation_date": 1525875794, "last_edit_date": 1525880440, "question_id": 50255778, "link": "https://stackoverflow.com/questions/50255778/errorinvalid-type-argument-of-have-queue-aka-struct-queue", "title": "error:invalid type argument of &#39;-&gt;&#39;(have &#39;Queue {aka struct Queue}", "body": "<p>I'm trying read a file with this format instance|instruction...\nlike this 1 01 01 12 12 33, where the first number is the instance and after that is the numbers of the instruction.\nEach line has it own id. so in that example that line if was the first one the id was 1, and the next line 2, and so on.</p>\n\n<p>What I'm trying to do is group that information by a struct like the PCB struct I have. Each line has an id, and a queue where I store each number of the instruction part.</p>\n\n<p>I have a struct where i have some variables and a queue inside it. The problem is the queue is not working.</p>\n\n<pre><code>typedef struct Queue\n{\n  int sizeQueue;\n  int limit;\n  Node *head;\n\n\n}Queue;\n\ntypedef struct PCB\n{\n int id;\n int program_counter;\n int size;\n Queue pointer_instrucoes;\n int instante;\n\n}PCB;\n\ntypedef struct Node\n{\n PCB *element;\n Node *next;\n\n}Node;\n</code></pre>\n\n<p>And in the main I'm calling the struct with the queue to store some values.</p>\n\n<pre><code>PCB *p=new_pcb(contador);\n....\np-&gt;pointer_instrucoes-&gt;head=atoi(s2); //s2 is the some number of the //instruction\n</code></pre>\n\n<p>but I'm getting this error:invalid type argument of '->'(have 'Queue {aka struct Queue}</p>\n\n<p>MVCE:</p>\n\n<p>main file</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt; //para o output\n#include \"queue2.h\"\n\nint le_ficheiro(char* filename) {\nFILE *ficheiro=fopen(filename,\"r\");\nsize_t len=0;\nchar *line=NULL;\nssize_t read;\nchar *s1;//string antes do primeiro espa\u00e7o\nchar *s2;//string depois do primeiro espa\u00e7o\nchar *sp; //linha toda\nif(ficheiro==NULL) {\n    exit(EXIT_FAILURE);\n}\nint contador=1; //onde comeca o id\n\nwhile((read = getline (&amp;line, &amp;len,ficheiro))!=-1)   //le de linha a linha\n{\n    PCB *p=new_pcb(contador);\n    sp=strchr(line,' ');\n    if(!sp)\n    {\n        exit(EXIT_FAILURE);\n    }\n    s1=strndup(line,sp-line);\n    s2=sp+1;\n    p-&gt;instante=atoi(s1); //converte char to int\n\n    printf(\"Instante: %d\\n\",p-&gt;instante);\n    printf(\"Id: %d\\n\",p-&gt;id);\n\n    p.pointer_instrucoes.head=atoi(s2);\n\n    printf(\"%d\\n\",p-&gt;pointer_instrucoes-&gt;head);\n\n\n\n    printf(\"Retrieved line of length %zu:\\n\",read);\n    printf(\"%s\\n\",s2);\n    printf(\"Aqui : %c\\n\",line[0]);\n    contador++;\n}\n fclose(ficheiro);\n if(line)\n    free(line);\n    free(s1);\n exit(EXIT_SUCCESS);\n\n }\n\n\nint main()\n{\n  char name[50];\n  printf(\"Name of the file: \");\n  scanf(\"%s\",name);\n  le_ficheiro(name);\n  return 0;\n</code></pre>\n\n<p>}</p>\n\n<p>queue2.h file</p>\n\n<pre><code>#include &lt;stdbool.h&gt;\n\ntypedef struct PCB PCB;\ntypedef struct Node Node;\ntypedef struct Queue Queue;\ntypedef struct Queue\n{\n  int sizeQueue;\n  int limit;\n  Node *head;\n\n\n }Queue;\ntypedef struct PCB\n{\n  int id;\n  int program_counter;\n  int size;\n  Queue pointer_instrucoes;\n  int instante;\n\n }PCB;\n\n typedef struct Node\n {\n  PCB *element;\n  Node *next;\n\n  }Node;\n\n PCB * new_pcb(int id); \n Node * new_node(PCB * e);\n Queue * new_queue(int limit);\n</code></pre>\n\n<p>Queue2.c</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include \"queue2.h\"\n\n\nNode * new_node(PCB * e)\n {\n  Node *n=malloc(sizeof(Node));\n  n-&gt;element=e;\n  n-&gt;next=NULL;\n  return n;\n  }\n\n\n\n\nQueue * new_queue(int limit)\n{\n   Queue *q=malloc(sizeof(Queue));\n   q-&gt;limit=limit;\n   q-&gt;head=NULL;\n   q-&gt;sizeQueue=0;\n\n   return q;\n\n     }\n\n   PCB * new_pcb(int id)\n{\n   PCB *p = malloc(sizeof(PCB));\n   p-&gt;id=id;\n   p-&gt;pointer_instrucoes=0;\n   p-&gt;program_counter=0;\n   p-&gt;size=0;\n   return p;\n   }\n</code></pre>\n\n<p>Example of input: \n1 01 02 03 04 05</p>\n\n<p>2 01 02 03 02 11</p>\n"}, {"tags": ["c", "performance", "random", "boolean"], "comments": [{"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 0, "creation_date": 1525874735, "post_id": 50255406, "comment_id": 87528348, "body": "is your question how to write it or where to find something like this?"}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1525874767, "post_id": 50255406, "comment_id": 87528372, "body": "For random booleans, <code>clock()&amp;1</code> could suffice."}, {"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 3, "creation_date": 1525874784, "post_id": 50255406, "comment_id": 87528386, "body": "(1) You can probably just profile and compare.  (2) Assuming a perfect input RNG, you can extract 32 (or whatever your word size is) random booleans from each random integer."}, {"owner": {"reputation": 409, "user_id": 6292227, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/10208054450141667/picture?type=large", "display_name": "Gabriele", "link": "https://stackoverflow.com/users/6292227/gabriele"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1525875914, "post_id": 50255406, "comment_id": 87529145, "body": "@PaulOgilvie wouldn&#39;t <code>clock()&amp;1</code> be ok just for one random number? If I call it 20K times in a row, wouldn&#39;t it return very correlated randoms?"}, {"owner": {"reputation": 409, "user_id": 6292227, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/10208054450141667/picture?type=large", "display_name": "Gabriele", "link": "https://stackoverflow.com/users/6292227/gabriele"}, "reply_to_user": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 0, "creation_date": 1525875961, "post_id": 50255406, "comment_id": 87529174, "body": "@KamiKaze I&#39;m happy to write it or find it, as soon as it works fine :)"}, {"owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "edited": false, "score": 2, "creation_date": 1525876424, "post_id": 50255406, "comment_id": 87529560, "body": "Just use the <i>random</i> function that is available on your platform (<code>rand</code>, <code>random</code>, <code>arc4random</code>, etc.) and keep one bit from the returned value."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1525876547, "post_id": 50255406, "comment_id": 87529660, "body": "How <i>fast</i> do you need it? Sounds like premature optimization."}, {"owner": {"reputation": 1405, "user_id": 1764528, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e6da340d12df3f5e4c7a53681a9ac91e?s=128&d=identicon&r=PG", "display_name": "DollarAkshay", "link": "https://stackoverflow.com/users/1764528/dollarakshay"}, "edited": false, "score": 3, "creation_date": 1525876831, "post_id": 50255406, "comment_id": 87529894, "body": "generate an unsigned 64 bit integer and use the bits as boolean values. Thats like generating 64 boolean values in 1 go."}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 0, "creation_date": 1525879492, "post_id": 50255406, "comment_id": 87531718, "body": "or just read from <code>&#47;dev&#47;urandom</code> 2.5KB if you want 20K random boolean values"}], "answers": [{"tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": true, "score": 2, "last_activity_date": 1525881016, "last_edit_date": 1525881016, "creation_date": 1525879752, "answer_id": 50257035, "question_id": 50255406, "link": "https://stackoverflow.com/questions/50255406/fast-c-random-boolean-generator/50257035#50257035", "title": "Fast C random boolean generator", "body": "<p>Extracting say the last bit of a random number can wreak havoc as linear congruential generators can alternate between odd and even numbers<sup>1</sup>. A scheme like <code>clock() &amp; 1</code> would also have ghastly correlation plains.</p>\n\n<hr>\n\n<p>Consider a solution based on the quick and dirty generator of Donald Kunth: for <code>uint32_t I</code>, sequence</p>\n\n<pre><code>I = 1664525 * I + 1013904223;\n</code></pre>\n\n<p>and <code>2 * I &lt; I</code> is the conditional yielding the Boolean drawing. Here I'm relying on the wrap-around behaviour of <code>I</code> which should occur half the time, and a potentially expensive division is avoided.</p>\n\n<p>Testing <code>I &lt;= 0x7FFFFFFF</code> is less flashy and might be faster still, but the hardcoding of the midpoint is not entirely satisfactory.</p>\n\n<hr>\n\n<p><sup>1</sup> The generator I present here does.</p>\n"}, {"comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1525884486, "post_id": 50258258, "comment_id": 87534602, "body": "I wonder if this will work out faster than my solution in common use cases?"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1525884794, "post_id": 50258258, "comment_id": 87534762, "body": "@Bathsheba Many unknowns, particularly the cost of a wide integer multiplication.  The higher that cost, the more profitable to extract 1 bit and save the rest.  The <i>fuzzy</i> part is how <a href=\"http://dilbert.com/strip/2001-10-25\" rel=\"nofollow noreferrer\">low a quality random number</a> generator can we go to meet OP&#39;s need of randomness vs. speed?"}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1525884841, "post_id": 50258258, "comment_id": 87534788, "body": "Upped all the same."}], "tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 2, "last_activity_date": 1525885268, "last_edit_date": 1525885268, "creation_date": 1525883984, "answer_id": 50258258, "question_id": 50255406, "link": "https://stackoverflow.com/questions/50255406/fast-c-random-boolean-generator/50258258#50258258", "title": "Fast C random boolean generator", "body": "<blockquote>\n  <p>I'm interested in generating fast random booleans</p>\n</blockquote>\n\n<p>Using a <a href=\"https://en.wikipedia.org/wiki/Linear_congruential_generator\" rel=\"nofollow noreferrer\">LCG</a> can be fast, yet since OP's needs only a <code>bool</code> result, consider extracting only 1 bit at a time from a reasonable generator and save the rest for later. <a href=\"https://stackoverflow.com/questions/50255406/fast-c-random-boolean-generator/50258258?noredirect=1#comment87529894_50255406\">@Akshay L Aradhya</a></p>\n\n<p>Example based on <a href=\"https://stackoverflow.com/a/19735285/2410359\">@R..</a> and <a href=\"https://stackoverflow.com/a/19083740/2410359\">@R..</a> code.</p>\n\n<pre><code>extern uint32_t lcg64_temper(uint64_t *seed); // see R.. code\n\nstatic uint64_t gseed; //  Initialize this in some fashion.\nstatic unsigned gcount = 0;\n\nbool rand_bool(void) {\n  static uint32_t rbits;\n  if (gcount == 0) {\n    gcount = 32;  // I'd consider using 31 here, just to cope with some LCG weaknesses.\n    rbits = lcg64_temper(&amp;gseed);  \n  }\n  gcount--;\n  bool b = rbits &amp; 1;\n  rbits &gt;&gt;= 1;\n  return b;\n}\n</code></pre>\n"}], "owner": {"reputation": 409, "user_id": 6292227, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/10208054450141667/picture?type=large", "display_name": "Gabriele", "link": "https://stackoverflow.com/users/6292227/gabriele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324, "favorite_count": 1, "accepted_answer_id": 50257035, "answer_count": 2, "score": 2, "last_activity_date": 1525885268, "creation_date": 1525874636, "question_id": 50255406, "link": "https://stackoverflow.com/questions/50255406/fast-c-random-boolean-generator", "title": "Fast C random boolean generator", "body": "<p>I'm interested in generating fast random booleans (or equivalently a Bernoulli(0.5) random variable) in C. Of course if one has a fast random generator with a decent statistical behaviour the problem \"sample a random Bernoulli(0.5)\" is easily solved: sample <code>x</code> uniformly in (0,1) and return <code>1</code> if <code>x&lt;0.5</code>, <code>0</code> otherwise. </p>\n\n<p>Suppose speed is the most important thing, now I have two questions/considerations:</p>\n\n<ol>\n<li><p>Many random doubles generators first generate an integer <code>m</code> uniformly in a certain range <code>[0,M]</code> and then simply return the division <code>m/M</code>. Wouldn't it be faster just to check whether <code>m &lt; M/2</code> (here <code>M/2</code> is fixed, so we are saving one division)</p>\n\n<ol start=\"2\">\n<li>Is there any faster way to do it? At the end, we're asking for way less statistical properties here: we're maybe still interested in a long period but, for example, we don't care about the uniformity of the distribution (as long as roughly 50% of the values are in the first half of the range). </li>\n</ol></li>\n</ol>\n"}, {"tags": ["c", "eclipse", "initialization", "embedded", "flash-memory"], "comments": [{"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1525874486, "post_id": 50255178, "comment_id": 87528179, "body": "use the linker script to place the struct, use the language to initialize it"}, {"owner": {"reputation": 504, "user_id": 7028310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc91311c8dba19ad07db7c48e66f2532?s=128&d=identicon&r=PG&f=1", "display_name": "tanginaMoBobo", "link": "https://stackoverflow.com/users/7028310/tanginamobobo"}, "edited": false, "score": 0, "creation_date": 1525875751, "post_id": 50255178, "comment_id": 87529043, "body": "@Jim Fell what OS are you using?"}, {"owner": {"reputation": 12418, "user_id": 214296, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/268966bdb84008bef79268f0a45b533e?s=128&d=identicon&r=PG", "display_name": "Jim Fell", "link": "https://stackoverflow.com/users/214296/jim-fell"}, "reply_to_user": {"reputation": 504, "user_id": 7028310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc91311c8dba19ad07db7c48e66f2532?s=128&d=identicon&r=PG&f=1", "display_name": "tanginaMoBobo", "link": "https://stackoverflow.com/users/7028310/tanginamobobo"}, "edited": false, "score": 0, "creation_date": 1525876139, "post_id": 50255178, "comment_id": 87529309, "body": "@abcOfJavaAndCPP There&#39;s no OS. It&#39;s a bare metal C project."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1525876511, "post_id": 50255178, "comment_id": 87529631, "body": "Would it be so bad for the program to assign the wanted starting values to this struct immediately after program entry?"}, {"owner": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "edited": false, "score": 0, "creation_date": 1525877444, "post_id": 50255178, "comment_id": 87530321, "body": "Why the use of <code>volatile</code>?"}, {"owner": {"reputation": 12418, "user_id": 214296, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/268966bdb84008bef79268f0a45b533e?s=128&d=identicon&r=PG", "display_name": "Jim Fell", "link": "https://stackoverflow.com/users/214296/jim-fell"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1525877481, "post_id": 50255178, "comment_id": 87530352, "body": "@JohnBollinger It complicates system initialization because the values are expected to be in flash, programmed at the factory."}, {"owner": {"reputation": 12418, "user_id": 214296, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/268966bdb84008bef79268f0a45b533e?s=128&d=identicon&r=PG", "display_name": "Jim Fell", "link": "https://stackoverflow.com/users/214296/jim-fell"}, "reply_to_user": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "edited": false, "score": 0, "creation_date": 1525877536, "post_id": 50255178, "comment_id": 87530388, "body": "@12431234123412341234123 It tells the compiler not to optimize-out the unused label."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1525878839, "post_id": 50255178, "comment_id": 87531266, "body": "Is the program itself then also pre-programmed into flash (by which I guess you mean PROM-style flash)?  In that case, the fact that it&#39;s flash as opposed to some other random-access storage technology seems moot."}, {"owner": {"reputation": 12418, "user_id": 214296, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/268966bdb84008bef79268f0a45b533e?s=128&d=identicon&r=PG", "display_name": "Jim Fell", "link": "https://stackoverflow.com/users/214296/jim-fell"}, "edited": false, "score": 0, "creation_date": 1526306109, "post_id": 50255178, "comment_id": 87680139, "body": "Whomever secretly downvoted with close request due to question being unclear, try reading the post title.  It&#39;s pretty clear. <i>How to initialize structure in flash at compile time?</i>"}], "answers": [{"comments": [{"owner": {"reputation": 12418, "user_id": 214296, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/268966bdb84008bef79268f0a45b533e?s=128&d=identicon&r=PG", "display_name": "Jim Fell", "link": "https://stackoverflow.com/users/214296/jim-fell"}, "edited": false, "score": 0, "creation_date": 1525874472, "post_id": 50255230, "comment_id": 87528169, "body": "The catch is that it needs to be at a specific location in memory.  I already have the sections defined in the linker file.  The usage of <code>__attribute()</code> may be what I&#39;m missing."}, {"owner": {"reputation": 12418, "user_id": 214296, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/268966bdb84008bef79268f0a45b533e?s=128&d=identicon&r=PG", "display_name": "Jim Fell", "link": "https://stackoverflow.com/users/214296/jim-fell"}, "edited": false, "score": 0, "creation_date": 1525877640, "post_id": 50255230, "comment_id": 87530466, "body": "I accepted your answer because you got me on the right track.  Thanks!"}], "tags": [], "owner": {"reputation": 362958, "user_id": 28169, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ec9385dc533f1a6a93769077f852503e?s=128&d=identicon&r=PG", "display_name": "unwind", "link": "https://stackoverflow.com/users/28169/unwind"}, "is_accepted": true, "score": 0, "last_activity_date": 1525875752, "last_edit_date": 1525875752, "creation_date": 1525874190, "answer_id": 50255230, "question_id": 50255178, "link": "https://stackoverflow.com/questions/50255178/how-to-initialize-structure-in-flash-at-compile-time/50255230#50255230", "title": "How to initialize structure in flash at compile time?", "body": "<p>That makes no sense at all, syntactically that is.</p>\n\n<p>What you need to do is figure out how your compiler supports this, since it's not something you can do with just standard C.</p>\n\n<p>With GCC, you use <code>__attribute()</code> to put the symbol in a particular segment, then use the linker script to put that segment in a particular piece of actual memory.</p>\n\n<p>Or, just give your compiler the benefit of the doubt and try a <code>static const</code> structure, that <em>should</em> end up in flash.</p>\n"}, {"tags": [], "owner": {"reputation": 48, "user_id": 9624270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cd376a44ee28bc9911d79bd0f53e670?s=128&d=identicon&r=PG&f=1", "display_name": "CimCim", "link": "https://stackoverflow.com/users/9624270/cimcim"}, "is_accepted": false, "score": 0, "last_activity_date": 1525876121, "creation_date": 1525876121, "answer_id": 50255880, "question_id": 50255178, "link": "https://stackoverflow.com/questions/50255178/how-to-initialize-structure-in-flash-at-compile-time/50255880#50255880", "title": "How to initialize structure in flash at compile time?", "body": "<p>In the example you gave, a \";\" is missing after the declaration of MY_STRUCT_DATA_TYPE</p>\n\n<pre><code>typedef struct {\n    float foo[2];\n    ...other stuff...\n} MY_STRUCT_DATA_TYPE;\n</code></pre>\n\n<p>If it's not a copie/paste mistake, it's the kind of error which could lead to the type of error message you have</p>\n"}, {"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 0, "last_activity_date": 1525876583, "last_edit_date": 1525876583, "creation_date": 1525876261, "answer_id": 50255925, "question_id": 50255178, "link": "https://stackoverflow.com/questions/50255178/how-to-initialize-structure-in-flash-at-compile-time/50255925#50255925", "title": "How to initialize structure in flash at compile time?", "body": "<blockquote>\n  <p>I'm working on an embedded C project and would like to initialize, at\n  compile-time, a structure that is stored in flash (0x1200u), but I\n  keep getting weird compile errors.</p>\n</blockquote>\n\n<p>That's unsurprising, as C does not support what you're trying to do.  You can provide initializers for objects that C allocates, including pointers, but the C language has no concept of objects that exist independently.  Indeed, C makes no guarantees whatever about what happens when you do anything with <code>(MY_STRUCT_DATA_TYPE *)(0x1200u)</code> other than convert it back to an integer.</p>\n\n<blockquote>\n  <p>The error I'm getting is \"<strong>expected '{' before '(' token.</strong>\" </p>\n</blockquote>\n\n<p>The compiler is complaining because in</p>\n\n<pre><code>MY_FLASH_STRUCT MY_InitdStruct = {\n</code></pre>\n\n<p>, the expansion of <code>MY_FLASH_STRUCT</code> is not a type, therefore the construct is not a valid declaration.  Nor is it a valid assignment, but even if it were, assignment statements are executable, and therefore may appear only inside functions.</p>\n\n<p>Assigning an object to a specific address would be a function of the linker.  Whether you can assign an object to the particular address you want is system-dependent, and the mechanism, if any, for doing so depends on your toolchain.</p>\n"}], "owner": {"reputation": 12418, "user_id": 214296, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/268966bdb84008bef79268f0a45b533e?s=128&d=identicon&r=PG", "display_name": "Jim Fell", "link": "https://stackoverflow.com/users/214296/jim-fell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 50255230, "answer_count": 3, "score": -1, "last_activity_date": 1525877739, "creation_date": 1525874056, "last_edit_date": 1525877739, "question_id": 50255178, "link": "https://stackoverflow.com/questions/50255178/how-to-initialize-structure-in-flash-at-compile-time", "title": "How to initialize structure in flash at compile time?", "body": "<p>I'm working on an embedded C project and would like to initialize, at compile-time, a structure that is stored in flash (0x1200u), but I keep getting weird compile errors.</p>\n\n<pre><code>typedef struct {\n    float foo[2];\n    ...other stuff...\n} MY_STRUCT_DATA_TYPE\n\n#define MY_FLASH_STRUCT    ((MY_STRUCT_DATA_TYPE *)(0x1200u)) // &lt;-- error here\n\nMY_FLASH_STRUCT MY_InitdStruct = {\n        .foo[0] =  0.12345f;\n        .foo[1] =  0.54321f;\n        ...other stuff...\n};\n</code></pre>\n\n<p>The error I'm getting is \"<em>expected '{' before '(' token</em>.\"  Anyone know how to make this work?</p>\n\n<h2>Update</h2>\n\n<p>Added to linker file...</p>\n\n<pre><code>MEMORY\n{\n  ... other stuff ...\n  m_my_data_section    (RW)  : ORIGIN = 0x00001200, LENGTH = 0x00000400\n  ... other stuff ...\n}\n\nSECTIONS\n{\n  ... other stuff ..\n  .my_data_section :\n  {\n    . = ALIGN(4);\n    KEEP(*(.my_data_section))\n    . = ALIGN(4);\n  } &gt; m_my_data_section\n  ... other stuff ...\n}\n</code></pre>\n\n<p>C code...</p>\n\n<pre><code>static volatile const MY_STRUCT_DATA_TYPE __attribute__ ((section (\".my_data_section\"))) MY_InitdStruct = {\n        .foo[0] =  0.12345f;\n        .foo[1] =  0.54321f;\n        ...other stuff...\n};\n</code></pre>\n\n<p>I'm not sure the <code>static</code> or <code>const</code> keywords are necessary, since it's intended only for one-time use to initialize that section of flash memory at compile-time, but it doesn't hurt to restrict the label's usage.</p>\n"}, {"tags": ["c", "pointers", "malloc"], "comments": [{"owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "edited": false, "score": 0, "creation_date": 1525874198, "post_id": 50255171, "comment_id": 87527968, "body": "<code>sizeof( structDeep2 )</code>??"}, {"owner": {"reputation": 31, "user_id": 9653515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d66e569f111c24917e522046a164012?s=128&d=identicon&r=PG&f=1", "display_name": "cconigli", "link": "https://stackoverflow.com/users/9653515/cconigli"}, "reply_to_user": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "edited": false, "score": 0, "creation_date": 1525874327, "post_id": 50255171, "comment_id": 87528065, "body": "Yes it&#39;s bad rewrite of example I corrected that for all &quot;struct&quot;malloc. Thx"}, {"owner": {"reputation": 4031, "user_id": 7640269, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/szGUJ.png?s=128&g=1", "display_name": "danglingpointer", "link": "https://stackoverflow.com/users/7640269/danglingpointer"}, "edited": false, "score": 0, "creation_date": 1525876145, "post_id": 50255171, "comment_id": 87529317, "body": "You allocate the size for the struct not to the struct pointer."}], "answers": [{"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1525875863, "post_id": 50255372, "comment_id": 87529114, "body": "Don&#39;t worry, it won&#39;t be the last time that happens....  (and... <i>do not</i> assume <code>malloc</code> succeeds -- it has a return -- check it -- every time...)"}], "tags": [], "owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "is_accepted": false, "score": 2, "last_activity_date": 1525874546, "creation_date": 1525874546, "answer_id": 50255372, "question_id": 50255171, "link": "https://stackoverflow.com/questions/50255171/strange-error-in-c-with-a-malloc-of-pointer-in-a-pointer/50255372#50255372", "title": "Strange error in C with a malloc of pointer in a pointer", "body": "<p>When you do:</p>\n\n<pre><code>structDeep2-&gt;structDeep1 = malloc( sizeof( struct myStruct *) );\n</code></pre>\n\n<p>you allocate the size of a pointer, but you want to allocate a structure, so you must do:</p>\n\n<pre><code>structDeep2-&gt;structDeep1 = malloc( sizeof( struct myStruct) );\n</code></pre>\n\n<p>Now (assuming malloc succeeds), you can safely do:</p>\n\n<pre><code>structDeep2-&gt;structDeep1-&gt;arrChar1 = malloc( sizeof(char ) * 2); \n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 9653515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d66e569f111c24917e522046a164012?s=128&d=identicon&r=PG&f=1", "display_name": "cconigli", "link": "https://stackoverflow.com/users/9653515/cconigli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1614714800, "creation_date": 1525874042, "last_edit_date": 1614714800, "question_id": 50255171, "link": "https://stackoverflow.com/questions/50255171/strange-error-in-c-with-a-malloc-of-pointer-in-a-pointer", "title": "Strange error in C with a malloc of pointer in a pointer", "body": "<p>Here my example code which works fine:</p>\n<pre><code>//define struct\nstruct myStruct {\n   char     *arrChar1;\n   char     *arrChar2;\n}\n// code in Main\nstruct myStruct *structDeep1 = malloc( sizeof( struct myStruct *) );\nstructDeep1-&gt;arrChar1 = NULL;\nstructDeep1-&gt;arrChar2 = NULL;\nstructDeep1-&gt;arrChar1 = malloc( sizeof(char ) * 2); //2 char\n\nif( structDeep1-&gt;arrChar1 == NULL)  puts(&quot;trace error&quot;);\nelse                                    puts(&quot;trace ok&quot;)\n//stdout -&gt; trace OK\n</code></pre>\n<p>No problem.</p>\n<p>Now here my example with strange error:</p>\n<pre><code>// define a second struct\nstruct myStructDeep2{\n    struct myStruct     *structDeep1;\n}\n// next code in Main\nstruct myStructDeep2 structDeep2 = malloc( sizeof( struct myStructDeep2*) );\nstructDeep2-&gt;structDeep1 = malloc( sizeof( struct myStruct *) );\nstructDeep2-&gt;structDeep1-&gt;arrChar1 = NULL;\nstructDeep2-&gt;structDeep1-&gt;arrChar2 = NULL;\nstructDeep2-&gt;structDeep1-&gt;arrChar1 = malloc( sizeof(char ) * 2); //2 char\n\nif( structDeep2-&gt;structDeep1-&gt;arrChar1 == NULL)     puts(&quot;trace error&quot;);\nelse                                            puts(&quot;trace ok&quot;)\n//stdout -&gt; trace error\n</code></pre>\n<p>It's seem the malloc function write/crush in the second pointer.\nI don't understand where is the problem in my code, it's very strange.</p>\n"}, {"tags": ["c", "debian", "mmap", "virtual-address-space"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1525873669, "post_id": 50254826, "comment_id": 87527531, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/5216326/mmap-on-proc-pid-mem\">mmap on /proc/pid/mem</a>"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1525874746, "post_id": 50254826, "comment_id": 87528357, "body": "The error number reported seems surprising, but not so much the overall failure of the <code>mmap()</code> call.  <code>mmap()</code> does not work on just any open file descriptor -- ordinarily the FD must be open on a <i>regular</i> file or a shared-memory object.  However, when passed an FD referencing an unsupported kind of object, it ought to signal <code>EACCES</code>, not <code>EBADF</code>."}], "answers": [{"tags": [], "owner": {"reputation": 77, "user_id": 6603291, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CPeoQAS4Uk8/AAAAAAAAAAI/AAAAAAAAACM/VqHxRdR9EMc/photo.jpg?sz=128", "display_name": "Amal Augustine Jose", "link": "https://stackoverflow.com/users/6603291/amal-augustine-jose"}, "is_accepted": false, "score": 0, "last_activity_date": 1542899234, "creation_date": 1542899234, "answer_id": 53433763, "question_id": 50254826, "link": "https://stackoverflow.com/questions/50254826/getting-bad-file-descriptor-error-when-trying-to-mmap-bar-0-of-device/53433763#53433763", "title": "Getting &quot;Bad file descriptor&quot; error when trying to mmap BAR-0 of device", "body": "<p>I faced a similar issue while I was learning Linux Kernal programming. Running the program with superuser permission worked for me.</p>\n"}], "owner": {"reputation": 33, "user_id": 9087616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c05cae62e991cb5e39b04cb0503946a8?s=128&d=identicon&r=PG&f=1", "display_name": "A.Z.", "link": "https://stackoverflow.com/users/9087616/a-z"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1653, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1542899234, "creation_date": 1525873119, "question_id": 50254826, "link": "https://stackoverflow.com/questions/50254826/getting-bad-file-descriptor-error-when-trying-to-mmap-bar-0-of-device", "title": "Getting &quot;Bad file descriptor&quot; error when trying to mmap BAR-0 of device", "body": "<p>I am trying to mmap BAR-0 of a PCI device to the virtual address space in order to read (and later modify) its contents. However when I mmap it, I get the following error:</p>\n\n<pre><code>Path to BAR-0: /sys/bus/pci/devices/0000:00:16.0/resource0\nError at line 42, file src/main.c (9) [Bad file descriptor]\n</code></pre>\n\n<p>I am using Debian 9.1 32-Bit. The code I use is the following:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/mman.h&gt;\n#include &lt;sys/stat.h&gt; \n#include &lt;unistd.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;errno.h&gt;\n#include \"../include/eeprom.h\"\n#include \"../include/pci.h\"\n#include \"../include/i2c.h\"\n#include \"../include/types.h\"\n\n#define PRINT_ERROR \\\n    do { \\\n        fprintf(stderr, \"Error at line %d, file %s (%d) [%s]\\n\", \\\n        __LINE__, __FILE__, errno, strerror(errno)); exit(1);\\\n    } while(0)\n\n#define MAP_SIZE 4096\n#define MAP_MASK (MAP_SIZE - 1)\n\nint main (int argc, char* argv[]) {\n    uint32_t pci_dev;\n    void *mmap_base;\n    char *file = {\"/sys/bus/pci/devices/0000:00:16.0/resource0\"};\n    int i;\n\n    printf (\"Path to BAR-0: %s\\n\", file);\n\n    //Open Bar-0 of PCI device\n    pci_dev = open (file, O_RDWR | O_SYNC);\n    if (pci_dev &lt; 0)\n    {\n        PRINT_ERROR;\n    }\n\n    //Map BAR-0 from physical memory to virtual address space\n    mmap_base = mmap (NULL, MAP_SIZE, PROT_WRITE, MAP_SHARED, pci_dev, 0);\n    if (mmap_base == (void *)-1 || mmap_base == NULL)  //error here\n    {\n        PRINT_ERROR;\n    }\n    printf (\"Mapped on address %p of size %d Byte\\n\", mmap_base, MAP_SIZE);\n\n    return 0;\n}\n</code></pre>\n\n<p>I can already say, that I removed the Kernel Module used by the device, so this isn't the problem.</p>\n\n<p>Can somebody help me? Thanks in advance.</p>\n"}, {"tags": ["javascript", "c", "api", "encryption", "aes"], "comments": [{"owner": {"reputation": 403, "user_id": 9762520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e6ac2db55a32b0fac2323ec29bc145f?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Salman", "link": "https://stackoverflow.com/users/9762520/muhammad-salman"}, "edited": false, "score": 0, "creation_date": 1525873802, "post_id": 50254710, "comment_id": 87527631, "body": "You want to encrypt a string using AES ? is that what the whole question is ? (I am sorry unable to understand )"}, {"owner": {"reputation": 1819, "user_id": 1116068, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/833e391c99c8405d4ee64f9528584fc4?s=128&d=identicon&r=PG", "display_name": "Roni Gadot", "link": "https://stackoverflow.com/users/1116068/roni-gadot"}, "reply_to_user": {"reputation": 403, "user_id": 9762520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e6ac2db55a32b0fac2323ec29bc145f?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Salman", "link": "https://stackoverflow.com/users/9762520/muhammad-salman"}, "edited": false, "score": 0, "creation_date": 1525876254, "post_id": 50254710, "comment_id": 87529414, "body": "No, the question is library specific. thank you."}, {"owner": {"reputation": 403, "user_id": 9762520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e6ac2db55a32b0fac2323ec29bc145f?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Salman", "link": "https://stackoverflow.com/users/9762520/muhammad-salman"}, "edited": false, "score": 0, "creation_date": 1525876308, "post_id": 50254710, "comment_id": 87529454, "body": "I see , Oh well I am not aware of that library"}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1525942381, "post_id": 50254710, "comment_id": 87555604, "body": "If you are looking for good security use a well vetted implementation such as provided by the language or platform provider. While the results are the same there may be timing flaws or other side-channel vulnerabilities. Also the lack of padding support for ECB and CBC modes is problematic and null padding is not a good solution. Many solutions use processor AES instructions which are orders of magnitude faster."}, {"owner": {"reputation": 1819, "user_id": 1116068, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/833e391c99c8405d4ee64f9528584fc4?s=128&d=identicon&r=PG", "display_name": "Roni Gadot", "link": "https://stackoverflow.com/users/1116068/roni-gadot"}, "reply_to_user": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1525951021, "post_id": 50254710, "comment_id": 87560360, "body": "Thanks @zaph, the point is I&#39;m using this code in a WebAssembly model, using 3rd party libs are a headache. I&#39;m trying to extract the necessary code only."}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1525971010, "post_id": 50254710, "comment_id": 87572207, "body": "Do not use ECB mode in new work and update legacy work ASAP, it is not secure, see <a href=\"https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Electronic_Codebook_.28ECB.29\" rel=\"nofollow noreferrer\">ECB mode</a>, scroll down to the Penguin.  Instead use CBC mode with a random IV, just prefix the encrypted data with the IV for use in decryption, it does not need to be secret."}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1525971092, "post_id": 50254710, "comment_id": 87572253, "body": "Ah, headache vs security, which to choose\u2014a no-brainer. ;-)"}], "answers": [{"tags": [], "owner": {"reputation": 133, "user_id": 1328830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfae26417634ee8b1fbc3ccdf80e6e29?s=128&d=identicon&r=PG", "display_name": "user1328830", "link": "https://stackoverflow.com/users/1328830/user1328830"}, "is_accepted": false, "score": 0, "last_activity_date": 1525874487, "creation_date": 1525874487, "answer_id": 50255348, "question_id": 50254710, "link": "https://stackoverflow.com/questions/50254710/c-encrypt-and-decrypt-a-string-with-aes/50255348#50255348", "title": "C - Encrypt and decrypt a string with AES", "body": "<pre><code>uint8_t in[16]  = \"my message\";\n</code></pre>\n\n<p>your buffer needs to be a multiple of 16.</p>\n"}, {"comments": [{"owner": {"reputation": 1819, "user_id": 1116068, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/833e391c99c8405d4ee64f9528584fc4?s=128&d=identicon&r=PG", "display_name": "Roni Gadot", "link": "https://stackoverflow.com/users/1116068/roni-gadot"}, "edited": false, "score": 0, "creation_date": 1525876027, "post_id": 50255434, "comment_id": 87529216, "body": "Thank you so much for the reply, It would be great if you could provide a short code example (Please \ud83d\ude4f)."}, {"owner": {"reputation": 5101, "user_id": 700170, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gZ8hw.png?s=128&g=1", "display_name": "Morten Jensen", "link": "https://stackoverflow.com/users/700170/morten-jensen"}, "reply_to_user": {"reputation": 1819, "user_id": 1116068, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/833e391c99c8405d4ee64f9528584fc4?s=128&d=identicon&r=PG", "display_name": "Roni Gadot", "link": "https://stackoverflow.com/users/1116068/roni-gadot"}, "edited": false, "score": 0, "creation_date": 1525876298, "post_id": 50255434, "comment_id": 87529445, "body": "@RoniGadot <a href=\"https://github.com/kokke/tiny-AES-c/blob/master/test.c\" rel=\"nofollow noreferrer\">The test code</a> demonstrates the usage. I don&#39;t have much time to spare this week, so I won&#39;t be able to help for a couple of days."}, {"owner": {"reputation": 1819, "user_id": 1116068, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/833e391c99c8405d4ee64f9528584fc4?s=128&d=identicon&r=PG", "display_name": "Roni Gadot", "link": "https://stackoverflow.com/users/1116068/roni-gadot"}, "edited": false, "score": 0, "creation_date": 1525876547, "post_id": 50255434, "comment_id": 87529659, "body": "Thanks again, sorry for being such a new-be, but can I replace the in { 0x87, 0x4d, 0x61, 0x91... with a string?"}, {"owner": {"reputation": 5101, "user_id": 700170, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gZ8hw.png?s=128&g=1", "display_name": "Morten Jensen", "link": "https://stackoverflow.com/users/700170/morten-jensen"}, "reply_to_user": {"reputation": 1819, "user_id": 1116068, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/833e391c99c8405d4ee64f9528584fc4?s=128&d=identicon&r=PG", "display_name": "Roni Gadot", "link": "https://stackoverflow.com/users/1116068/roni-gadot"}, "edited": false, "score": 1, "creation_date": 1525876741, "post_id": 50255434, "comment_id": 87529820, "body": "@RoniGadot no worries :) Yes you can, but the data will still be treated like a binary array, so make sure the lengths are all a multiple of 16 bytes and pad accordingly (e.g. with zeros). Maybe it&#39;s easier to just replace each hex-value with a char, so the input becomes something like this: <code>{ &#39;m&#39;,&#39;y&#39;,&#39; &#39;,&#39;m&#39;,&#39;e&#39;,&#39;s&#39;,&#39;s&#39;,&#39;a&#39;,&#39;g&#39;,&#39;e&#39;,0,0,0,0,0,0}</code>"}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 1, "creation_date": 1525912686, "post_id": 50255434, "comment_id": 87545804, "body": "The CryptoJS code uses a PBKDF (password based key derivation function) to create the key and IV. So you will still not get the same result."}], "tags": [], "owner": {"reputation": 5101, "user_id": 700170, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gZ8hw.png?s=128&g=1", "display_name": "Morten Jensen", "link": "https://stackoverflow.com/users/700170/morten-jensen"}, "is_accepted": false, "score": 1, "last_activity_date": 1525876018, "last_edit_date": 1592644375, "creation_date": 1525874700, "answer_id": 50255434, "question_id": 50254710, "link": "https://stackoverflow.com/questions/50254710/c-encrypt-and-decrypt-a-string-with-aes/50255434#50255434", "title": "C - Encrypt and decrypt a string with AES", "body": "<p>I am the original author of the AES library you reference.</p>\n<p>When using ECB and CBC modes of operation, you need to make sure your key, iv and the input/output blocks are all 16 bytes long. You also need to decide on which padding scheme you want to use.</p>\n<p>You can use CTR-mode to avoid padding and stop worrying about block-sizes. This generally makes the AES algorithm much easier to use as there are fewer edge-cases to handle.</p>\n<p>BTW this is also stated in the project README:</p>\n<blockquote>\n<p>No padding is provided so for CBC and ECB all buffers should be mutiples of 16 bytes. For padding PKCS7 is recommendable.</p>\n<p>ECB mode is considered unsafe for most uses and is not implemented in streaming mode. If you need this mode, call the function for every block of 16 bytes you need encrypted. See wikipedia's article on ECB for more details.</p>\n</blockquote>\n<p>EDIT:</p>\n<p>If you extend your arrays so that they are 16 bytes long and zero-pad them (or alternatively, declare them static so they will be zero-initialized automatically), I think it should work for you :)</p>\n"}, {"comments": [{"owner": {"reputation": 1819, "user_id": 1116068, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/833e391c99c8405d4ee64f9528584fc4?s=128&d=identicon&r=PG", "display_name": "Roni Gadot", "link": "https://stackoverflow.com/users/1116068/roni-gadot"}, "edited": false, "score": 0, "creation_date": 1525941110, "post_id": 50268671, "comment_id": 87555012, "body": "Thanks, works as expected. @Morten Jensen is that an accepted usage?"}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 1, "creation_date": 1525942587, "post_id": 50268671, "comment_id": 87555700, "body": "When using CTR mode care must be taken never to use the same counter initial value and key combination more than once. This turns out to be a common flaw even major players have failed at."}, {"owner": {"reputation": 5101, "user_id": 700170, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gZ8hw.png?s=128&g=1", "display_name": "Morten Jensen", "link": "https://stackoverflow.com/users/700170/morten-jensen"}, "reply_to_user": {"reputation": 1819, "user_id": 1116068, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/833e391c99c8405d4ee64f9528584fc4?s=128&d=identicon&r=PG", "display_name": "Roni Gadot", "link": "https://stackoverflow.com/users/1116068/roni-gadot"}, "edited": false, "score": 0, "creation_date": 1526024522, "post_id": 50268671, "comment_id": 87590728, "body": "@RoniGadot sure looks like it :) Be mindful of zaph&#39;s advice: never reuse an IV + counter-combination in CTR-mode."}], "tags": [], "owner": {"reputation": 11208, "user_id": 1115237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a5b371929b9ddad5e22fc6997e5aab49?s=128&d=identicon&r=PG", "display_name": "Shlomi Schwartz", "link": "https://stackoverflow.com/users/1115237/shlomi-schwartz"}, "is_accepted": true, "score": 1, "last_activity_date": 1525941005, "creation_date": 1525941005, "answer_id": 50268671, "question_id": 50254710, "link": "https://stackoverflow.com/questions/50254710/c-encrypt-and-decrypt-a-string-with-aes/50268671#50268671", "title": "C - Encrypt and decrypt a string with AES", "body": "<p>As @Morten Jensen suggested, you can use the CTR-mode IE:<code>AES_CTR_xcrypt_buffer</code> </p>\n\n<pre><code>int main()\n{\n    uint8_t key[] = \"secret key 123\";\n    uint8_t in[]  = \"my message\";\n    uint8_t iv[16] = { 0xf0, 0xf1, 0xf2, 0xf3, 0xf4, 0xf5, 0xf6, 0xf7, 0xf8, 0xf9, 0xfa, 0xfb, 0xfc, 0xfd, 0xfe, 0xff };\n\n    printf(\"Length: %lu\",strlen((char*)in));\n\n    struct AES_ctx ctx;\n    AES_init_ctx_iv(&amp;ctx, key, iv);\n    AES_CTR_xcrypt_buffer(&amp;ctx, in, strlen((char*)in));\n    printf(\"\\nENC: %s\",(char*) in); // don't use this string as an input\n\n    AES_init_ctx_iv(&amp;ctx, key, iv);\n    AES_CTR_xcrypt_buffer(&amp;ctx, in, strlen((char*)in));\n    printf(\"\\nDEC: %s\",(char*) in);\n    return 0;\n}\n</code></pre>\n\n<p>Remember, printing the encrypted data is wrong, you should go over the output and convert it to base64 if you want to match your JS example.</p>\n"}], "owner": {"reputation": 1819, "user_id": 1116068, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/833e391c99c8405d4ee64f9528584fc4?s=128&d=identicon&r=PG", "display_name": "Roni Gadot", "link": "https://stackoverflow.com/users/1116068/roni-gadot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4901, "favorite_count": 2, "accepted_answer_id": 50268671, "answer_count": 3, "score": 2, "last_activity_date": 1525941005, "creation_date": 1525872741, "question_id": 50254710, "link": "https://stackoverflow.com/questions/50254710/c-encrypt-and-decrypt-a-string-with-aes", "title": "C - Encrypt and decrypt a string with AES", "body": "<p>I'm trying to understand how to use <a href=\"https://github.com/kokke/tiny-AES-c\" rel=\"nofollow noreferrer\">this c library</a> (<strong>tiny-AES-c</strong>). As a web developer, I'm looking to get an equivalent C code for <a href=\"https://jsfiddle.net/gcdfs3oo/112/\" rel=\"nofollow noreferrer\">this JS fiddle</a>.</p>\n\n<p>The JS code is straightforward:</p>\n\n<pre><code>// Encrypt\nvar ciphertext = CryptoJS.AES.encrypt('my message', 'secret key 123');\n\n\nconsole.log(\"Encrypted: \" + ciphertext.toString());\n\n// Decrypt\nvar bytes  = CryptoJS.AES.decrypt(ciphertext.toString(), 'secret key 123');\nvar plaintext = bytes.toString(CryptoJS.enc.Utf8);\n\nconsole.log(\"Decrypted: \" + plaintext);\n</code></pre>\n\n<p>Given a message to encrypt and a secret, the code generates the encrypted data and transform the results to a string.</p>\n\n<hr>\n\n<p>My C code:</p>\n\n<pre><code>int main()\n{\n    uint8_t in[]  = \"my message\";\n    uint8_t key[] =  \"secret key 123\";\n\n    struct AES_ctx ctx;\n\n    AES_init_ctx(&amp;ctx, key);\n    printf(\"ORIG: %s\",(char*) in);\n\n    // Encrypt\n    AES_ECB_encrypt(&amp;ctx, in);\n    printf(\"\\nENC: %s\",(char*) in);\n\n    // Decrypt\n    AES_ECB_decrypt(&amp;ctx, in);\n    printf(\"\\nDEC: %s\",(char*) in);\n\n    return 0;\n}\n</code></pre>\n\n<p>The output:</p>\n\n<pre><code>ORIG: my message\nENC: \u0324\ufffd+\ufffd\ufffd5&lt;n]EYK\ufffd\u0638/\ufffd\ufffd\ufffd\ufffd\nDEC: my message%  \n</code></pre>\n\n<p>I understand that I shouldn't try to print the result as a string, but couldn't figure out how to get similar (to the JS) results, using the <strong>tiny-AES-c</strong> API, plus when I tried using longer messages I got strange results, leading me to think I'm using this library the wrong way.</p>\n\n<p><strong>Q</strong>: What would be the C code equivalent to the above JS?</p>\n"}, {"tags": ["c++", "c", "dll", "delay-load"], "comments": [{"owner": {"reputation": 918, "user_id": 2135548, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/fM5xR.png?s=128&g=1", "display_name": "Mandar", "link": "https://stackoverflow.com/users/2135548/mandar"}, "edited": false, "score": 1, "creation_date": 1525873256, "post_id": 50254604, "comment_id": 87527198, "body": "Dont include your libs in your project just LoadLibrary() your dll whenever required. Also there is a flag /DELAYLOAD in VC++."}, {"owner": {"reputation": 14821, "user_id": 5743288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ea16526477fd6f1d4cc57f976af38d0?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Sanders", "link": "https://stackoverflow.com/users/5743288/paul-sanders"}, "edited": false, "score": 0, "creation_date": 1525873670, "post_id": 50254604, "comment_id": 87527532, "body": "I&#39;m not sure if /DELAYLOAD can be used if the DLL in question is outside your executable&#39;s folder.  But then I&#39;ve never tried."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1525880078, "post_id": 50254604, "comment_id": 87532104, "body": "You cannot call a function from a DLL without having that DLL somewhere, preferably at a place where it can be found. What are your requirements?"}, {"owner": {"reputation": 1120, "user_id": 4623418, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZIVAuvNP8WE/AAAAAAAAAAI/AAAAAAAAAEw/zzuok1S9_ZM/photo.jpg?sz=128", "display_name": "Bas in het Veld", "link": "https://stackoverflow.com/users/4623418/bas-in-het-veld"}, "reply_to_user": {"reputation": 918, "user_id": 2135548, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/fM5xR.png?s=128&g=1", "display_name": "Mandar", "link": "https://stackoverflow.com/users/2135548/mandar"}, "edited": false, "score": 0, "creation_date": 1525880361, "post_id": 50254604, "comment_id": 87532268, "body": "@mozfox I tried this, but it tells me there&#39;s an unresolved symbol (the library function I&#39;m calling)"}, {"owner": {"reputation": 1120, "user_id": 4623418, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZIVAuvNP8WE/AAAAAAAAAAI/AAAAAAAAAEw/zzuok1S9_ZM/photo.jpg?sz=128", "display_name": "Bas in het Veld", "link": "https://stackoverflow.com/users/4623418/bas-in-het-veld"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1525880363, "post_id": 50254604, "comment_id": 87532271, "body": "@n.m. I want to delay load it. So I&#39;m manually loading it from code before it&#39;s used."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1525881041, "post_id": 50254604, "comment_id": 87532695, "body": "If you want to load it with LoadLibrary, you need to use GetProcAddress to get functions you want to call, rather than using function names directly in the code. And you should <i>not</i> link against the .dll or its .lib."}, {"owner": {"reputation": 918, "user_id": 2135548, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/fM5xR.png?s=128&g=1", "display_name": "Mandar", "link": "https://stackoverflow.com/users/2135548/mandar"}, "edited": false, "score": 1, "creation_date": 1525894527, "post_id": 50254604, "comment_id": 87539677, "body": "check <a href=\"https://stackoverflow.com/a/13265148/2135548\">stackoverflow.com/a/13265148/2135548</a>"}, {"owner": {"reputation": 1120, "user_id": 4623418, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZIVAuvNP8WE/AAAAAAAAAAI/AAAAAAAAAEw/zzuok1S9_ZM/photo.jpg?sz=128", "display_name": "Bas in het Veld", "link": "https://stackoverflow.com/users/4623418/bas-in-het-veld"}, "reply_to_user": {"reputation": 918, "user_id": 2135548, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/fM5xR.png?s=128&g=1", "display_name": "Mandar", "link": "https://stackoverflow.com/users/2135548/mandar"}, "edited": false, "score": 0, "creation_date": 1525901063, "post_id": 50254604, "comment_id": 87542644, "body": "@Mozfox Will try that tomorrow, thanks very much"}, {"owner": {"reputation": 1120, "user_id": 4623418, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZIVAuvNP8WE/AAAAAAAAAAI/AAAAAAAAAEw/zzuok1S9_ZM/photo.jpg?sz=128", "display_name": "Bas in het Veld", "link": "https://stackoverflow.com/users/4623418/bas-in-het-veld"}, "edited": false, "score": 0, "creation_date": 1526047965, "post_id": 50254604, "comment_id": 87604880, "body": "Figured it all out, thanks for the feedback! I ended up removing the lib files and only loading the DLLs, and calling them using GetProcAddress, not the header files."}], "owner": {"reputation": 1120, "user_id": 4623418, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZIVAuvNP8WE/AAAAAAAAAAI/AAAAAAAAAEw/zzuok1S9_ZM/photo.jpg?sz=128", "display_name": "Bas in het Veld", "link": "https://stackoverflow.com/users/4623418/bas-in-het-veld"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1525872435, "creation_date": 1525872435, "question_id": 50254604, "link": "https://stackoverflow.com/questions/50254604/delay-loading-a-c-libary-in-c-code", "title": "Delay-loading a C libary in C++ code", "body": "<p>I'm currently trying to load the ffmpeg library (in C) into my C++ project. The library consists of headers, .lib files and .dll files, all of which I loaded and used successfully.\nHowever, it is strongly desirable for our project to have these dll files loaded in delayed, and this is where I'm failing.</p>\n\n<p>What it boils down to is this:</p>\n\n<ul>\n<li>When I build the project without referring to any of the library's dll functions, it runs correctly and I see (by my logs) that all dlls are correctly loaded where I'm explicitly getting their DLL handle.</li>\n<li>When I build the project and include function calls to the dll, the executable simple fails to load because it's missing 'xx.dll'. This is before the function call is done. IE: Simply by having a dll function call in my code, it seems the program tries to load it when starting.\n\n<ul>\n<li>When I manually add the dlls next to my program's executable, it runs fine in both scenarios, but it is not desirable to have them next to my executable.</li>\n</ul></li>\n</ul>\n\n<p>Is there something obvious that I'm missing or doing wrong?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["c", "logic"], "answers": [{"tags": [], "owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "is_accepted": false, "score": 1, "last_activity_date": 1525871165, "creation_date": 1525871165, "answer_id": 50254164, "question_id": 50254094, "link": "https://stackoverflow.com/questions/50254094/looping-wont-stop-when-reading-user-input/50254164#50254164", "title": "Looping won&#39;t stop when reading user input", "body": "<p>Besides dbush's answer which is correct:</p>\n\n<ul>\n<li><code>char next = \"\";</code> is wrong, it should be <code>char next;</code></li>\n<li>Don't use <code>scanf</code> but use only <code>getchar</code>, <code>scanf</code> is full of pitfalls.</li>\n</ul>\n\n<p>Replace this:</p>\n\n<pre><code>char next;\n...\nscanf(\"%c\", &amp;next);\ngetchar();\n</code></pre>\n\n<p>with this:</p>\n\n<pre><code>int next;\n...\nnext = getchar();\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 49, "user_id": 7835898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49d4036860647f98e156f6fd2b896170?s=128&d=identicon&r=PG&f=1", "display_name": "Wang Liangwei", "link": "https://stackoverflow.com/users/7835898/wang-liangwei"}, "edited": false, "score": 0, "creation_date": 1525877941, "post_id": 50254181, "comment_id": 87530662, "body": "thank man but I m still facing another problem. when I enter n it will loop to the else statement 1st  before close. i don&#39;t have any idea for this. the program will read step by step.so how can i solve it?"}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "reply_to_user": {"reputation": 49, "user_id": 7835898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49d4036860647f98e156f6fd2b896170?s=128&d=identicon&r=PG&f=1", "display_name": "Wang Liangwei", "link": "https://stackoverflow.com/users/7835898/wang-liangwei"}, "edited": false, "score": 1, "creation_date": 1525878080, "post_id": 50254181, "comment_id": 87530757, "body": "@WangLiangwei You need to add an additional check to see if the result is <code>&#39;n&#39;</code> or <code>&#39;N&#39;</code> and only prompt again if it&#39;s not."}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "reply_to_user": {"reputation": 49, "user_id": 7835898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49d4036860647f98e156f6fd2b896170?s=128&d=identicon&r=PG&f=1", "display_name": "Wang Liangwei", "link": "https://stackoverflow.com/users/7835898/wang-liangwei"}, "edited": false, "score": 0, "creation_date": 1525878859, "post_id": 50254181, "comment_id": 87531278, "body": "@WangLiangwei Glad I could help.  Feel free to <a href=\"https://stackoverflow.com/help/accepted-answer\">accept this answer</a> if you found it useful."}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 4, "last_activity_date": 1525871205, "creation_date": 1525871205, "answer_id": 50254181, "question_id": 50254094, "link": "https://stackoverflow.com/questions/50254094/looping-wont-stop-when-reading-user-input/50254181#50254181", "title": "Looping won&#39;t stop when reading user input", "body": "<p>The conditional <code>(next !='n'|| next!='N')</code> is always true.</p>\n\n<p>If <code>next</code> is <code>'n'</code> then <code>next!='N'</code> is true making the whole expression true.  Similarly, if <code>next</code> is <code>'N'</code> then <code>next!='n'</code> is true again making the whole expression true.</p>\n\n<p>What you want here is to use a logical AND <code>&amp;&amp;</code>:</p>\n\n<pre><code>} while (next !='n' &amp;&amp; next!='N')\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 469, "user_id": 7081290, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/114c42fd8af25d5012ec79f7f82f03f2?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron Pool", "link": "https://stackoverflow.com/users/7081290/aaron-pool"}, "is_accepted": false, "score": 2, "last_activity_date": 1525871340, "creation_date": 1525871340, "answer_id": 50254222, "question_id": 50254094, "link": "https://stackoverflow.com/questions/50254094/looping-wont-stop-when-reading-user-input/50254222#50254222", "title": "Looping won&#39;t stop when reading user input", "body": "<p>Your while conditional will always evaluate to true. The input character will always be either NOT 'N' or NOT 'n'. Because it's only a single character, so it will always not be one of the two. You need you need to instead ensure that it's NEITHER of them. This is a logical AND check, rather than and OR check. So, instead, change that conditional to an AND, a.k.a <code>next !== 'n' &amp;&amp; next !== 'N'</code>, or, if you find using OR makes more sense, the following conditional is equivalent to the AND statement, through use of Boolean logic transformations <code>!(next == 'n' || next == 'N')</code>.</p>\n\n<p>Cheers!</p>\n"}, {"tags": [], "owner": {"reputation": 35, "user_id": 9561661, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1dd94e2578e5249b3f4509973e082fec?s=128&d=identicon&r=PG&f=1", "display_name": "\u79e6\u65f6\u660e\u6708", "link": "https://stackoverflow.com/users/9561661/%e7%a7%a6%e6%97%b6%e6%98%8e%e6%9c%88"}, "is_accepted": false, "score": 0, "last_activity_date": 1525871793, "creation_date": 1525871793, "answer_id": 50254384, "question_id": 50254094, "link": "https://stackoverflow.com/questions/50254094/looping-wont-stop-when-reading-user-input/50254384#50254384", "title": "Looping won&#39;t stop when reading user input", "body": "<pre><code>while (next !='n' || next!='N') is always true.\n</code></pre>\n\n<p>You can simply change it like this:</p>\n\n<pre><code>while (next !='n')\n</code></pre>\n\n<p>Then you input <code>n</code>, it stopped.</p>\n"}], "owner": {"reputation": 49, "user_id": 7835898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49d4036860647f98e156f6fd2b896170?s=128&d=identicon&r=PG&f=1", "display_name": "Wang Liangwei", "link": "https://stackoverflow.com/users/7835898/wang-liangwei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 50254181, "answer_count": 4, "score": 3, "last_activity_date": 1525871826, "creation_date": 1525870918, "last_edit_date": 1525871826, "question_id": 50254094, "link": "https://stackoverflow.com/questions/50254094/looping-wont-stop-when-reading-user-input", "title": "Looping won&#39;t stop when reading user input", "body": "<p>This code cannot stop looping even when I enter n or N.  </p>\n\n<p>What is causing this?</p>\n\n<pre><code>    char next = \"\";\n\n    printf(\"Do u want continue\\n\");\n    scanf(\"%c\", &amp;next);\n    getchar();\n    do\n    {\n        if (next=='y' ||next=='Y')\n        {\n            selection();\n        }\n        else\n        {\n            printf(\"invalid Please Enter again\");\n            scanf(\"%c\", &amp;next);\n        }\n    } while (next !='n'|| next!='N')\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 3, "creation_date": 1525870704, "post_id": 50253975, "comment_id": 87525320, "body": "That book is probably just old. Either that or the author didn&#39;t bother keeping up with the times, which reflects poorly on them. Either way, try to get a better book."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1525870769, "post_id": 50253975, "comment_id": 87525367, "body": "Short, simplified answer: anything but <code>int main (void)</code> is incorrect. <code>int main()</code> is obsolete style (will compile but not recommended) and <code>main()</code> is withdrawn obsolete style (will not compile). For details check the linked duplicate."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1525871054, "post_id": 50253975, "comment_id": 87525610, "body": "That&#39;s a little restrictive, @Lundin.  Of course <code>int main(int argc, char *argv[])</code> and equivalents are also explicitly allowed by the standard (for hosted implementations), and all implementations are explicitly permitted to support other implementation-defined signatures, with some common ones in fact doing so."}, {"owner": {"reputation": 1, "user_id": 9764864, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Mspdo7VEn6Y/AAAAAAAAAAI/AAAAAAAAEGY/mxLn3CBv0hY/photo.jpg?sz=128", "display_name": "Rayo Grg", "link": "https://stackoverflow.com/users/9764864/rayo-grg"}, "reply_to_user": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1525871095, "post_id": 50253975, "comment_id": 87525635, "body": "@StoryTeller can you please recommend the best book?"}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1525871257, "post_id": 50253975, "comment_id": 87525729, "body": "It&#39;s been a while since I read an introductory book on C. So I can&#39;t really recommend anything. We used to have a dedicated FAQ on SO about this very topic, but it has since fallen into disrepair, and should probably not be consulted."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1525872255, "post_id": 50253975, "comment_id": 87526434, "body": "@JohnBollinger Hence &quot;simplified answer&quot; /--/ &quot;For details check the linked duplicate&quot;."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1525872551, "post_id": 50253975, "comment_id": 87526663, "body": "@StoryTeller The C book recommendation list was deleted as per <a href=\"https://meta.stackoverflow.com/questions/355588/the-c-book-list-has-gone-haywire-what-to-do-with-it\">this meta</a>. We couldn&#39;t come up with a way to repair it and keep it actively maintained, so the community consensus was to delete it."}], "owner": {"reputation": 1, "user_id": 9764864, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Mspdo7VEn6Y/AAAAAAAAAAI/AAAAAAAAEGY/mxLn3CBv0hY/photo.jpg?sz=128", "display_name": "Rayo Grg", "link": "https://stackoverflow.com/users/9764864/rayo-grg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "closed_date": 1525870708, "answer_count": 0, "score": 0, "last_activity_date": 1525870560, "creation_date": 1525870560, "question_id": 50253975, "link": "https://stackoverflow.com/questions/50253975/int-main-or-just-main", "closed_reason": "Duplicate", "title": "Int main() or just main()", "body": "<p>I am new to programming. Just have a quick question. What a difference between int main() and just a main(). Because in my book example, the author didn\u2019t write int in a program and when I wrote that program in a codeblock. I was asked to put int main() and program ran. Thanks</p>\n"}, {"tags": ["java", "c", "sockets", "server", "client"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1525871490, "post_id": 50253920, "comment_id": 87525886, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/11909336/knowing-how-to-detect-a-disconnection-when-reading-socket-data-inputstream\">Knowing How to Detect a Disconnection when Reading Socket Data (InputStream)</a>"}, {"owner": {"reputation": 2008, "user_id": 4308639, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNxVX.jpg?s=128&g=1", "display_name": "Ruslan Akhundov", "link": "https://stackoverflow.com/users/4308639/ruslan-akhundov"}, "edited": false, "score": 0, "creation_date": 1525871585, "post_id": 50253920, "comment_id": 87525959, "body": "how is your <code>serverSocket</code> and <code>readSocket</code> configured?"}], "answers": [{"comments": [{"owner": {"reputation": 2008, "user_id": 4308639, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNxVX.jpg?s=128&g=1", "display_name": "Ruslan Akhundov", "link": "https://stackoverflow.com/users/4308639/ruslan-akhundov"}, "edited": false, "score": 0, "creation_date": 1525875630, "post_id": 50254424, "comment_id": 87528958, "body": "but it doesn&#39;t solve initial problem with reconnection. if you have a requirement, that you always have just one connection, its completely ok to do it in the same thread."}], "tags": [], "owner": {"reputation": 296, "user_id": 4932738, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/16e3461a74f7815ddef4a4a32594e8cc?s=128&d=identicon&r=PG", "display_name": "Gaulthier", "link": "https://stackoverflow.com/users/4932738/gaulthier"}, "is_accepted": false, "score": 1, "last_activity_date": 1525871917, "creation_date": 1525871917, "answer_id": 50254424, "question_id": 50253920, "link": "https://stackoverflow.com/questions/50253920/socket-programming-client-disconnection-keeps-server-hanging/50254424#50254424", "title": "Socket Programming : Client Disconnection keeps server hanging", "body": "<p>Try to modify your server logic by using concurrency to manage each request. In this way, server will be able to handle each client separately in a thread. Reading and writing data must be performed in the related thread. A pool thread paradigm is often used to avoid thread overhead<a href=\"https://stackoverflow.com/questions/3286626/what-is-the-use-of-a-thread-pool-in-java\">[1]</a>.</p>\n\n<p>For example: </p>\n\n<pre><code>ExecutorService threadPool = Executors.newFixedThreadPool(n);\nServerSocket serverSocket = null;\n\n//...\n\nwhile(!isStopped()){\n   Socket clientSocket = null;\n   try {\n       clientSocket = this.serverSocket.accept();\n       threadPool.execute(new WorkerRunnable(clientSocket));\n       // Process data in the WorkerRunnable class\n   } catch (IOException e) {\n       if(isStopped()) {\n           System.err.println(\"Server Stopped.\") ;\n           break;\n       }\n       throw new RuntimeException(\"Error accepting client connection\", e);\n   } \n}\n</code></pre>\n\n<p>A well designed example can be found here: <a href=\"http://tutorials.jenkov.com/java-multithreaded-servers/thread-pooled-server.html\" rel=\"nofollow noreferrer\">http://tutorials.jenkov.com/java-multithreaded-servers/thread-pooled-server.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 2008, "user_id": 4308639, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNxVX.jpg?s=128&g=1", "display_name": "Ruslan Akhundov", "link": "https://stackoverflow.com/users/4308639/ruslan-akhundov"}, "is_accepted": true, "score": 1, "last_activity_date": 1525874112, "creation_date": 1525874112, "answer_id": 50255198, "question_id": 50253920, "link": "https://stackoverflow.com/questions/50253920/socket-programming-client-disconnection-keeps-server-hanging/50255198#50255198", "title": "Socket Programming : Client Disconnection keeps server hanging", "body": "<p>You should use </p>\n\n<pre><code>   shutdown(socket_fd, SHUT_WR);\n</code></pre>\n\n<p>instead of <code>close(socket_fd)</code> in order to properly close socket.</p>\n\n<p>If you use SHUT_WR, a FIN packet will be sent to another side to inform them we don't have more data to send.</p>\n"}], "owner": {"reputation": 7286, "user_id": 1014830, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ca45c857a2784ae22f54acf3d0d94744?s=128&d=identicon&r=PG&f=1", "display_name": "dharam", "link": "https://stackoverflow.com/users/1014830/dharam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 50255198, "answer_count": 2, "score": 1, "last_activity_date": 1525874112, "creation_date": 1525870410, "question_id": 50253920, "link": "https://stackoverflow.com/questions/50253920/socket-programming-client-disconnection-keeps-server-hanging", "title": "Socket Programming : Client Disconnection keeps server hanging", "body": "<p>I am trying to build a sample TCP Forwarder. Here is the functionality in brief:</p>\n\n<ol>\n<li>The forwarder will listen at a given port.</li>\n<li>It contains a map of clients to servers</li>\n<li>Clients will connect to the forwarder and the forwarder will lookup the map and create a 2-way-forwarding-connection.</li>\n<li>To achieve this, it creates two threads per client.</li>\n<li>Thread 1: reads from the client and writes to the target server</li>\n<li>Thread 2: reads from the target server and write to the client.</li>\n</ol>\n\n<p>All this is written in C. \nThe Client and Target servers can be written in any language, right now its Java.</p>\n\n<p>When I run a client for the first time, it works as expected. However, if I kill the client and restart it, the server never receives the new connection.</p>\n\n<p>Here is my server code which I suspect is fault. </p>\n\n<pre><code>Socket clientSocket = serverSocket.accept();\nInputStream inputStream = clientSocket.getInputStream();\nOutputStream outputStream = clientSocket.getOutputStream();\n\nwhile (true) {\n    byte[] bArray = new byte[2048];\n    try {\n        System.out.println(String.format(\"SERVER:%s: Attempting to read\", this.name));\n        inputStream.read(bArray);\n        System.out.println(String.format(\"SERVER:%s: Received %s\", this.name, new String(bArray)));\n        byte[] bytes = (name + \":\" + counter).getBytes();\n        counter++;\n        outputStream.write(bytes);\n        System.out.println(String.format(\"SERVER:%s: Sent %s\", this.name, new String(bytes)));\n    } catch (IOException e) {\n        System.out.println(String.format(\"SERVER:%s: Client Disconnected \", this.name));\n        clientSocket = serverSocket.accept();\n        inputStream = clientSocket.getInputStream();\n    }\n}\n</code></pre>\n\n<p>In the C program, I detect the disconnection and close the socket as shown below:</p>\n\n<pre><code>LOGINFO(\"Reading from Client Socket.\");\niResult = read(readSocket, buff, recvbuflen);\nif (iResult &lt;= 0) {\n    LOGERROR(\"Receiving failed\");\n    close(readSocket);          \n    break;\n}\n</code></pre>\n"}, {"tags": ["c", "arrays", "multidimensional-array", "malloc", "c99"], "answers": [{"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1525871384, "post_id": 50254175, "comment_id": 87525819, "body": "There may be various reasons why heap allocation is needed though. For example, in most OS you should avoid allocating large objects on the stack, to prevent stack overflow. That being said, your answer doesn&#39;t really explain what the code in the question does."}, {"owner": {"reputation": 458, "user_id": 3024970, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c357e631e917d3aaf4733e6b68c41f55?s=128&d=identicon&r=PG", "display_name": "dieortin", "link": "https://stackoverflow.com/users/3024970/dieortin"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525871577, "post_id": 50254175, "comment_id": 87525954, "body": "@Lundin I think that&#39;s not the issue was having though. It appeared to me that he was just trying to access a multi-dimensional array without doing pointer arithmetic, which is perfectly possible with both stack and heap allocated arrays."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1525872486, "post_id": 50254175, "comment_id": 87526616, "body": "This answer misses the point. The code in the question was only an example. To be clearer, it should have taken the array size from some dynamic value instead of a constant defined with the preprocessor. But the intent was to address situations where the memory is dynamically allocated and the size is not known at compile time. Additionally, it is not strictly true that C works with \u201cmemory address offsets.\u201d The C standard defines behavior with an abstract mdoel, and the implementation may use other means of accomplishing the required results."}, {"owner": {"reputation": 458, "user_id": 3024970, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c357e631e917d3aaf4733e6b68c41f55?s=128&d=identicon&r=PG", "display_name": "dieortin", "link": "https://stackoverflow.com/users/3024970/dieortin"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1525873742, "post_id": 50254175, "comment_id": 87527579, "body": "@EricPostpischil you&#39;re right, I was missing the point. I edited my question to better address it. You&#39;re wrong about the address offset thing though, pointers are by definition references to a memory address, and the C standard definers behavior for the subscript operator like this: &quot;The definition of the subscript operator [] is that E1[E2] is identical to (*((E1)+(E2))).&quot;"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525873994, "post_id": 50254175, "comment_id": 87527791, "body": "@dieortin ...where the result of *(E1 + E2) is a de-referenced pointer, not an address. If either E1 or E2 was an address, the code would obviously break, it it would then need to do arithmetic on bytes rather than pointed-at types."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1525874664, "post_id": 50254175, "comment_id": 87528296, "body": "@dieortin: The C standard defines a pointer type to be a reference to an entity of the referenced type, not a memory address: \u201cA pointer type describes an object whose value provides a reference to an entity of the referenced type.\u201d (C 2011 N1570 6.2.5 20.) You have likely been taught about pointers using memory addresses as examples, but a flat memory address space is just one possible implementation of the abstraction defined by the C standard. There are others."}], "tags": [], "owner": {"reputation": 458, "user_id": 3024970, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c357e631e917d3aaf4733e6b68c41f55?s=128&d=identicon&r=PG", "display_name": "dieortin", "link": "https://stackoverflow.com/users/3024970/dieortin"}, "is_accepted": false, "score": 0, "last_activity_date": 1525878253, "last_edit_date": 1525878253, "creation_date": 1525871194, "answer_id": 50254175, "question_id": 50253843, "link": "https://stackoverflow.com/questions/50253843/how-does-prtnn-work-when-dealing-with-heap-allocation-memory/50254175#50254175", "title": "How does (*prt)[N][N] work when dealing with heap allocation memory?", "body": "<p>What <code>int (*a)[SIZE][SIZE] = malloc (sizeof (int) * SIZE * SIZE);</code> does is declaring a pointer to a two-dimensional array of integers. This would only be useful when you purposely want to allocate the space in the heap instead of in the stack (for example, if the dimensions of the array are unknown at compile time) You would then dereference the pointer and access it as you would with a normal two-dimensional array. </p>\n\n<p>You could skip the dereferencing step by declaring your variable as an array of pointers, each one of them pointing to a standard array of integers <code>int *a[SIZE]</code>, or even as <code>int **a</code>. In both cases you could access any value using bracket notation <code>a[x][y]</code> without needing to dereference <code>a</code> before.</p>\n\n<p>If you know the dimensions of the array prior at compilation time, and don't need to allocate it in the heap, you can just declare the array like this:</p>\n\n<pre><code>int a[SIZE][SIZE];\n</code></pre>\n\n<p>which is both shorter and more efficient as it allocates the space in the stack.</p>\n\n<p>You can always access an array using <code>[][]</code>. <s>You have to keep in mind that everything in C works with memory address offsets. When you have an integer array declared as <code>int a[4]</code> and you access it with square brackets like this <code>a[3]</code> you're telling the processor to take the memory address of <code>a</code> and apply an offset of <code>3 * sizeof(int)</code>. You could access the same element by using <code>*(&amp;a + 3)</code>, or even with <code>3[a]</code>, as taking the address and adding the offset is the same as taking the offset and adding the address.</p>\n\n<p>So when you use <code>a[2][3]</code>, the compiler is doing exactly the same as above, only with more dimensions. So you don't need to do <code>a[x * SIZE + y]</code> because that's exactly what the compiler is doing for you when you do <code>a[x][y]</code>.</s></p>\n\n<p><b>EDIT: as some pointed out in the comments, actually pointers don't necessarily store a memory reference, altough that's definitely the most common implementation.</b></p>\n\n<p>I hope my explanation was clear.</p>\n"}, {"comments": [{"owner": {"reputation": 458, "user_id": 3024970, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c357e631e917d3aaf4733e6b68c41f55?s=128&d=identicon&r=PG", "display_name": "dieortin", "link": "https://stackoverflow.com/users/3024970/dieortin"}, "edited": false, "score": 0, "creation_date": 1525871727, "post_id": 50254185, "comment_id": 87526053, "body": "Actually there&#39;s no such thing as an &quot;array pointer&quot;. All pointers are just memory addresses, with a type that lets you do some things like work with indexes instead of doing pointer arithmetic by hand."}, {"owner": {"reputation": 458, "user_id": 3024970, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c357e631e917d3aaf4733e6b68c41f55?s=128&d=identicon&r=PG", "display_name": "dieortin", "link": "https://stackoverflow.com/users/3024970/dieortin"}, "edited": false, "score": 0, "creation_date": 1525871790, "post_id": 50254185, "comment_id": 87526102, "body": "Also, there&#39;s no way to &quot;point to the whole 2D array&quot;, as again pointers are just memory addresses. The closest thing to doing that is just pointing to the first element, which C does."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 458, "user_id": 3024970, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c357e631e917d3aaf4733e6b68c41f55?s=128&d=identicon&r=PG", "display_name": "dieortin", "link": "https://stackoverflow.com/users/3024970/dieortin"}, "edited": false, "score": 0, "creation_date": 1525873796, "post_id": 50254185, "comment_id": 87527625, "body": "@dieortin Rather, there is no such thing as memory addresses in the C language, the standard lacks that concept. If you scroll down in the linked answer you&#39;ll find an example of how to do arithmetic with array pointers. You can think of an array pointer as pointing at the whole object, since C disallows code such as <code>int (*a)[1]; int (*b)[2] = a;</code>."}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 0, "last_activity_date": 1525871538, "last_edit_date": 1525871538, "creation_date": 1525871213, "answer_id": 50254185, "question_id": 50253843, "link": "https://stackoverflow.com/questions/50253843/how-does-prtnn-work-when-dealing-with-heap-allocation-memory/50254185#50254185", "title": "How does (*prt)[N][N] work when dealing with heap allocation memory?", "body": "<p><code>int (*a)[SIZE][SIZE]</code> is an <em>array pointer</em> to an array of type <code>int[SIZE][SIZE]</code>. This is a special kind of pointer that is used to point at whole arrays, but otherwise works like any other pointer. So when you write <code>(*a)[i][j]</code> you say \"give me the contents of the pointer (the 2D array), then in those contents give me item number [i][j]\".</p>\n\n<p>But since array pointers behave like other pointers, you can use it point to the first element instead of the whole 2D array. (Just like you can use <code>int*</code> to point at the first item of an <code>int[n]</code> array.) This is done using the trick of omitting the left-most dimension: <code>int (*a)[SIZE] = ...</code>. This now points to the first 1D array in the array of arrays. And now you can use it as <code>a[i][j]</code> instead, which is far more readable and convenient.</p>\n\n<p>Array pointers, the above trick, and how to use them to dynamically allocate 2D arrays as one single chunk of memory is all addressed in my answer to <a href=\"https://stackoverflow.com/questions/42094465/correctly-allocating-multi-dimensional-arrays\">Correctly allocating multi-dimensional arrays</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525874141, "post_id": 50254338, "comment_id": 87527918, "body": "Actually I would say that <code>int (*a)[SIZE][SIZE]</code> is the most correct declaration, but it is just not very practical to use."}], "tags": [], "owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "is_accepted": false, "score": 1, "last_activity_date": 1525871680, "creation_date": 1525871680, "answer_id": 50254338, "question_id": 50253843, "link": "https://stackoverflow.com/questions/50253843/how-does-prtnn-work-when-dealing-with-heap-allocation-memory/50254338#50254338", "title": "How does (*prt)[N][N] work when dealing with heap allocation memory?", "body": "<p>It is not wrong but not the more usual (and idiomatic way). To declare a dynamic array of size N, you use: <code>int *arr = malloc(N * sizeof(int));</code>. In fact this declares <code>arr</code> as <em>a pointer to the first element of an array of N int</em>. A 2D array is an array of arrays so to declare an 2D array N*N, the more common way is :</p>\n\n<pre><code>int (*arr)[N] = malloc(N * N * sizeof(int));\n</code></pre>\n\n<p>This actually declares <code>arr</code> as a pointer to the first element of N arrays of N int. You can then normally use <code>arr[i][j]</code>.</p>\n\n<p>So what is that amazing <code>int (*a)[SIZE][SIZE] = malloc (sizeof (int) * SIZE * SIZE);</code>?</p>\n\n<p>You declare arr as a pointer to the first (and single) element of an array of 2D arrays NxN of integers. The good news is that the declaration is explicit for the size of all dimensions, but the downside is that you must consistently dereference it: <code>(*arr)[i][j]</code> which is not different <em>per definition of the <code>[]</code> operator in C</em> from <code>arr[0][i][j]</code>.</p>\n\n<p>It is nothing more than my own opinion, but I strongly urge you to stick to the first method. That first and single element trick is likely to disturb any future reader or maintainer of your code because it is not idiomatic.</p>\n"}, {"comments": [{"owner": {"reputation": 159, "user_id": 1203078, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebc901972cf6e999e5fad31c295b2279?s=128&d=identicon&r=PG", "display_name": "Hans", "link": "https://stackoverflow.com/users/1203078/hans"}, "edited": false, "score": 0, "creation_date": 1525877910, "post_id": 50255720, "comment_id": 87530643, "body": "thanks for that, this is very clear answer - by changing my type from <code>T [M][N]</code> to <code>T [M]</code> and allocating with <code>sizeof (*arr)</code> I no longer need to dereference the pointer - really makes the code a lot more understandable/neat."}], "tags": [], "owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "is_accepted": true, "score": 1, "last_activity_date": 1525882778, "last_edit_date": 1525882778, "creation_date": 1525875601, "answer_id": 50255720, "question_id": 50253843, "link": "https://stackoverflow.com/questions/50253843/how-does-prtnn-work-when-dealing-with-heap-allocation-memory/50255720#50255720", "title": "How does (*prt)[N][N] work when dealing with heap allocation memory?", "body": "<pre><code>int (*a)[SIZE][SIZE]\n</code></pre>\n\n<p>declares <code>a</code> as a pointer to a <code>SIZE</code> by <code>SIZE</code> array of <code>int</code> - assuming <code>SIZE == 3</code>, you get something like this:</p>\n\n<pre><code>   +---+          +---+---+---+\na: |   | -------&gt; |   |   |   |\n   +---+          +---+---+---+\n                  |   |   |   |\n                  +---+---+---+\n                  |   |   |   |\n                  +---+---+---+\n</code></pre>\n\n<p>(actually, layout would be strictly linear, but we'll go with this representation for now).  </p>\n\n<p>To access any element of the pointed-to array, we'd write <code>(*a)[i][j]</code> - we have to dereference <code>a</code> explicitly, since we don't want to index into <code>a</code>, we want to index into what <code>a</code> <em>points to</em>.  </p>\n\n<p>Remember that <code>a[i]</code> is defined as <code>*(a + i)</code> - given an address <code>a</code>, offset <code>i</code> elements (not bytes!) from that address and deference the result.  Thus, <code>(*a)[i][j]</code> is equivalent to <code>a[0][i][j]</code>.  </p>\n\n<p>Now, if <code>a</code> points to a 3x3 array of <code>int</code>, then <code>a + 1</code> points to the <em>next 3x3 array</em> of <code>int</code>:</p>\n\n<pre><code>   +---+          +---+---+---+\na: |   | -------&gt; |   |   |   |\n   +---+          +---+---+---+\n                  |   |   |   |\n                  +---+---+---+\n                  |   |   |   |\n                  +---+---+---+\na + 1: ---------&gt; |   |   |   |\n                  +---+---+---+\n                  |   |   |   |\n                  +---+---+---+\n                  |   |   |   |\n                  +---+---+---+\n</code></pre>\n\n<p>which we would access as <code>(*(a + 1))[i][j]</code>, or simply <code>a[1][i][j]</code>.</p>\n\n<p>Now, why use a pointer to an array in the first place?  In this case we're dynamically allocating the array, which we would do if a) we didn't know how many <code>SIZExSIZE</code> arrays we'd need until runtime, or b) if the resulting array would be too large to allocate as an <code>auto</code> variable, or c) if we want to extend or shrink the number of <code>SIZExSIZE</code> arrays as necessary.</p>\n\n<p>How does this method of allocating a multidimensional array work?  Let's start by allocating an <code>N</code>-element array of <code>T</code>:</p>\n\n<pre><code>T *arr = malloc( sizeof *arr * N );\n</code></pre>\n\n<p><code>sizeof *arr</code> is equivalent to <code>sizeof (T)</code>, so we're setting aside space for <code>N</code> objects of type <code>T</code>.  </p>\n\n<p>Now let's replace <code>T</code> with an array type, <code>R [M]</code>:</p>\n\n<pre><code>R (*arr)[M] = malloc( sizeof *arr * N );\n</code></pre>\n\n<p><code>sizeof *arr</code> is equivalent to <code>sizeof (R [M])</code>, so we're setting aside space for <code>N</code> objects of type <code>R [M]</code> - IOW, <code>N</code> <code>M</code>-element arrays of <code>R</code>.  We've dynamically created the equivalent of <code>R a[M][N]</code>.  </p>\n\n<p>We could also have written this as</p>\n\n<pre><code>R (*arr)[M] = malloc( sizeof (R) * M * N );\n</code></pre>\n\n<p>although I prefer using <code>sizeof *arr</code>; you'll see why in a second.</p>\n\n<p>Now, we can replace <code>R</code> with <em>yet another</em> array type, <code>S [L]</code>:</p>\n\n<pre><code>S (*arr)[L][M] = malloc( sizeof *arr * N );\n</code></pre>\n\n<p><code>sizeof *arr</code> is equivalent to <code>sizeof (S [L][M])</code>, so we're allocating enough space for <code>N</code> objects of type <code>S [L][M]</code>, or <code>N</code> <code>L</code> by <code>M</code> arrays of <code>S</code>.  We've dynamically created the equivalent of <code>S arr[L][M][N]</code>.  </p>\n\n<p>The semantics for dynamically allocating 1D, 2D, and 3D arrays are <em>exactly the same</em> - all that's changed is the type. By using <code>sizeof *arr</code> each time, I only need to track how many elements I need of that type.  </p>\n"}], "owner": {"reputation": 159, "user_id": 1203078, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebc901972cf6e999e5fad31c295b2279?s=128&d=identicon&r=PG", "display_name": "Hans", "link": "https://stackoverflow.com/users/1203078/hans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 1, "accepted_answer_id": 50255720, "answer_count": 4, "score": 2, "last_activity_date": 1525882778, "creation_date": 1525870115, "last_edit_date": 1525878465, "question_id": 50253843, "link": "https://stackoverflow.com/questions/50253843/how-does-prtnn-work-when-dealing-with-heap-allocation-memory", "title": "How does (*prt)[N][N] work when dealing with heap allocation memory?", "body": "<p>Today a colleague at work showed me a way of declaring a 2D array in such a way that I can allocate it linearly but still use 2D square bracket (<code>[][]</code>) notation to access elements.</p>\n\n<p>For example:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define SIZE 2\n\nint main () {\n  int (*a)[SIZE][SIZE] = malloc (sizeof (int) * SIZE * SIZE);\n\n  for (int i = 0; i &lt; SIZE; i++) {\n    for (int j = 0; j &lt; SIZE; j++) {\n      (*a)[i][j] = 0;\n    }\n  }\n\n  (*a)[0][1] = 100;\n\n  /* should yield:\n   *   0\n   *   100\n   *   0\n   *   0\n   */\n  for (int i = 0; i &lt; SIZE; i++) {\n    for (int j = 0; j &lt; SIZE; j++) {\n      printf (\"%d\\n\", (*a)[i][j]);\n    }\n  }\n\n  free (a);\n\n  return EXIT_SUCCESS;\n}\n</code></pre>\n\n<p>This is in contrast to computing the index and then perform pointer arthimetic (e.g. <code>*(a + (x * SIZE + y))</code> or more tersly <code>a[x * SIZE + y]</code>) to access an element.</p>\n\n<p>The critical part is the shape declaration of the pointer <code>x</code> (e.g. <code>(*x)[][]</code>), which seems to encode this information as a type for the value that <code>x</code> points to.</p>\n\n<p>Beyond this though I do not understand how this works. What does this notation exactly doing? Is it syntactic sugar? It looks symilar to dynamic stack allocation for arrays (see <a href=\"https://stackoverflow.com/q/737240/1203078\">Array size at run time without dynamic allocation is allowed?</a> as one example of this), but clearly this allocation is happening on the heap. </p>\n\n<p>I've looked for more information about this notation/declaration of the pointer but can't find much other than the term <em>element type</em> coming up - but I'm not certain that this is related.</p>\n\n<p>EDIT #1:</p>\n\n<p>I should have mentioned this question is in the context of using the heap, and not the stack. I'm aware of stack based dynamic allocation of arrays, but the work I'm doing specifically looks at dynamic memory allocations.</p>\n"}, {"tags": ["c", "arrays", "if-statement", "while-loop"], "answers": [{"comments": [{"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1525869444, "post_id": 50253524, "comment_id": 87524366, "body": "This fixed it, but can you explain to me why <code>(sentence_entered[i + 1] != &#39; &#39; &amp;&amp;         sentence_entered[i + 1] != &#39;\\n&#39;)</code> has &amp;&amp; instead of ||? Because a single space in the array can&#39;t be both a space and a line break at the same time? Thats why I did or?  My logic: The array [i] is a space or an line break. Also check if the [i + 1] is a space OR a line break. i + 1 cannot be both a space and a line break?"}, {"owner": {"reputation": 386, "user_id": 8216351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1924a6bd80575731b3bfe903c853b7ac?s=128&d=identicon&r=PG&f=1", "display_name": "iamJP", "link": "https://stackoverflow.com/users/8216351/iamjp"}, "edited": false, "score": 0, "creation_date": 1525869586, "post_id": 50253524, "comment_id": 87524472, "body": "The first part  (sentence_entered[i] == &#39; &#39; ||         sentence_entered[i] == &#39;\\n&#39;)  is checking for white space.  The second part is checking for not white space (sentence_entered[i + 1] != &#39; &#39; &amp;&amp;         sentence_entered[i + 1] != &#39;\\n&#39;)"}, {"owner": {"reputation": 75299, "user_id": 139746, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/BhJLC.png?s=128&g=1", "display_name": "Pascal Cuoq", "link": "https://stackoverflow.com/users/139746/pascal-cuoq"}, "reply_to_user": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1525869608, "post_id": 50253524, "comment_id": 87524492, "body": "@Zoey You&#39;ve got it, I think. For the current character not to be part of a word, it must be a space <b>or</b> it must be a newline. For the next character to be part of a word, it must not be a space <b>and</b> it must not be a newline."}, {"owner": {"reputation": 386, "user_id": 8216351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1924a6bd80575731b3bfe903c853b7ac?s=128&d=identicon&r=PG&f=1", "display_name": "iamJP", "link": "https://stackoverflow.com/users/8216351/iamjp"}, "edited": false, "score": 0, "creation_date": 1525869646, "post_id": 50253524, "comment_id": 87524525, "body": "Consider using the &#39;isspace&#39; function instead.  This code will not work for all whitespace characters."}, {"owner": {"reputation": 75299, "user_id": 139746, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/BhJLC.png?s=128&g=1", "display_name": "Pascal Cuoq", "link": "https://stackoverflow.com/users/139746/pascal-cuoq"}, "reply_to_user": {"reputation": 386, "user_id": 8216351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1924a6bd80575731b3bfe903c853b7ac?s=128&d=identicon&r=PG&f=1", "display_name": "iamJP", "link": "https://stackoverflow.com/users/8216351/iamjp"}, "edited": false, "score": 0, "creation_date": 1525869788, "post_id": 50253524, "comment_id": 87524630, "body": "@iamJP I only explained what I thought the OP needed to know. I don&#39;t think that telling them about <code>isspace</code> would unpuzzle them given the question, but if you think it would, you should post it as a comment on the question."}, {"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1525869830, "post_id": 50253524, "comment_id": 87524665, "body": "Thanks guys, I get it now"}, {"owner": {"reputation": 75299, "user_id": 139746, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/BhJLC.png?s=128&g=1", "display_name": "Pascal Cuoq", "link": "https://stackoverflow.com/users/139746/pascal-cuoq"}, "reply_to_user": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1525869928, "post_id": 50253524, "comment_id": 87524747, "body": "@ZoeyMalkov please do not assume that users of the site are \u201cguys\u201d"}], "tags": [], "owner": {"reputation": 75299, "user_id": 139746, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/BhJLC.png?s=128&g=1", "display_name": "Pascal Cuoq", "link": "https://stackoverflow.com/users/139746/pascal-cuoq"}, "is_accepted": false, "score": 5, "last_activity_date": 1525869137, "creation_date": 1525869137, "answer_id": 50253524, "question_id": 50253437, "link": "https://stackoverflow.com/questions/50253437/how-do-i-count-the-number-of-words-if-the-user-enters-multiple-lines-spaces/50253524#50253524", "title": "How do I count the number of words if the user enters multiple lines/spaces?", "body": "<p>The negation of <code>a || b</code> is <code>!a &amp;&amp; !b</code>.</p>\n\n<p>Your condition should read:</p>\n\n<pre><code>       (sentence_entered[i] == ' ' ||\n        sentence_entered[i] == '\\n') &amp;&amp;\n        (sentence_entered[i + 1] != ' ' &amp;&amp;\n        sentence_entered[i + 1] != '\\n')\n</code></pre>\n"}], "owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525869137, "creation_date": 1525868840, "question_id": 50253437, "link": "https://stackoverflow.com/questions/50253437/how-do-i-count-the-number-of-words-if-the-user-enters-multiple-lines-spaces", "title": "How do I count the number of words if the user enters multiple lines/spaces?", "body": "<p>I have a char array, which contains what the user has inputted. How would I count the words?\nThe user in permitted to to do something crazy like:</p>\n\n<pre><code>hello this\n               is a test\n   how are\nyou today?\n</code></pre>\n\n<p>So the number of words here should be 9 but my program tells me 23. Why is this not working? Its counting the spaces, but I have taken that into account with <code>sentence_entered[i + 1] != ' '</code></p>\n\n<p>My code:</p>\n\n<pre><code>int i = 0;    \nwhile (sentence_entered[i] != '\\0') {\n\n        if (\n            (sentence_entered[i] == ' ' ||\n            sentence_entered[i] == '\\n') &amp;&amp;\n            (sentence_entered[i + 1] != ' ' ||\n            sentence_entered[i + 1] != '\\n')\n           ) {\n            words += 1;\n    }\ni++\n}\n</code></pre>\n"}, {"tags": ["c", "memory", "ansi"], "comments": [{"owner": {"reputation": 1352, "user_id": 2198121, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa303bed01349a6f8f42a872322c7eb2?s=128&d=identicon&r=PG", "display_name": "NuPagadi", "link": "https://stackoverflow.com/users/2198121/nupagadi"}, "edited": false, "score": 1, "creation_date": 1525867587, "post_id": 50252960, "comment_id": 87523081, "body": "You need <code>realloc</code>."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1525868279, "post_id": 50252960, "comment_id": 87523548, "body": "You read (initialize) <code>ch</code> with <code>scanf()</code>; you (ab)use <code>amount</code> (which is uninitialized) in the call to <code>malloc()</code>.  This is not a recipe for happiness."}, {"owner": {"reputation": 7, "user_id": 9537253, "user_type": "registered", "profile_image": "https://graph.facebook.com/2067559230194229/picture?type=large", "display_name": "Nick Gr", "link": "https://stackoverflow.com/users/9537253/nick-gr"}, "edited": false, "score": 0, "creation_date": 1525868374, "post_id": 50252960, "comment_id": 87523620, "body": "so any better idea ?"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 1, "creation_date": 1525868600, "post_id": 50252960, "comment_id": 87523796, "body": "Probably <code>scanf(&quot;%d&quot;, &amp;ch);</code> -&gt; <code>scanf(&quot;%d&quot;, &amp;amount);</code>"}, {"owner": {"reputation": 7, "user_id": 9537253, "user_type": "registered", "profile_image": "https://graph.facebook.com/2067559230194229/picture?type=large", "display_name": "Nick Gr", "link": "https://stackoverflow.com/users/9537253/nick-gr"}, "edited": false, "score": 0, "creation_date": 1525868953, "post_id": 50252960, "comment_id": 87524044, "body": "ohh that is what you mean, ignore it the ch variable is something that i will need later, nothing to do with the amount viariable"}], "owner": {"reputation": 7, "user_id": 9537253, "user_type": "registered", "profile_image": "https://graph.facebook.com/2067559230194229/picture?type=large", "display_name": "Nick Gr", "link": "https://stackoverflow.com/users/9537253/nick-gr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "closed_date": 1525868651, "answer_count": 0, "score": 0, "last_activity_date": 1525868015, "creation_date": 1525867521, "last_edit_date": 1525868015, "question_id": 50252960, "link": "https://stackoverflow.com/questions/50252960/how-to-change-the-size-of-an-array-while-the-program-is-running-in-c", "closed_reason": "Duplicate", "title": "How to change the size of an array while the program is running in C", "body": "<p>Ok so, I am trying to make a program where i list an amount of students. Here you can see I ask the amount of students from the user and I use malloc to allocate the array size.</p>\n\n<pre><code>typedef struct{\n    char name[MAXSTRING];\n    int id;\n} student;\n\nint main()\n{\n    student *array;\n    int ch, amount;\n\n    printf(\"Give the amount of students\\n\");\n    scanf(\"%d\", &amp;ch);\n\n    array = (student*) malloc(amount*sizeof(student));\n\n    //Some code, also includes free() for allocated memory\n    return 0;\n}\n</code></pre>\n\n<p>Now lets say the user types in \"100\" but then he lists 100 students but then he wants to list 5 more. What i can do to allocate that extra 5 students. Also how to make it so every time he goes over the limit i can allocate again and again.</p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["c", "arrays", "while-loop", "char", "scanf"], "comments": [{"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1525866583, "post_id": 50252580, "comment_id": 87522511, "body": "@IanAbbott Yea, that seems to fix it. Thanks"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 1, "creation_date": 1525866901, "post_id": 50252580, "comment_id": 87522670, "body": "Depending on how you use <code>user_input</code> in the remainder of your program, you might need to add a null terminator to it when the loop terminates."}], "answers": [{"tags": [], "owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "is_accepted": false, "score": 2, "last_activity_date": 1525869455, "creation_date": 1525869455, "answer_id": 50253638, "question_id": 50252580, "link": "https://stackoverflow.com/questions/50252580/how-do-i-read-user-input-across-multiple-lines-spaces-etc/50253638#50253638", "title": "How do I read user input across multiple lines, spaces etc?", "body": "<p>Your code is ok. The following program:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    char user_input[1000];\n    int i = 0;\n    while (scanf(\"%c\", &amp;user_input[i]) == 1) {\n        i++;\n    }\n    user_input[i] = '\\0';\n    printf(\"%d\\n\", i);\n    printf(\"%s\", user_input);\n    return 0;\n}\n</code></pre>\n\n<p>Produced with your input the following:</p>\n\n<pre><code>42\nHello this\n  is\n     a test123 234     !!!\n</code></pre>\n\n<p>However <code>scanf</code> is generally used to <code>scan formatted</code> input. I would advise to read one character at a time using <code>getchar()</code> or <code>fgets()</code></p>\n\n<pre><code>int main(void) {\n   char user_input[1000];\n   int i = 0;\n   int temp;\n   while ((temp = getchar()) != EOF) {\n        user_input[++i] = temp;\n   }\n   user_input[i] = '\\0';\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 461, "user_id": 5872574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44adbaa7965d31c58d087bbd25386317?s=128&d=identicon&r=PG", "display_name": "rel", "link": "https://stackoverflow.com/users/5872574/rel"}, "is_accepted": false, "score": 0, "last_activity_date": 1525871072, "creation_date": 1525871072, "answer_id": 50254138, "question_id": 50252580, "link": "https://stackoverflow.com/questions/50252580/how-do-i-read-user-input-across-multiple-lines-spaces-etc/50254138#50254138", "title": "How do I read user input across multiple lines, spaces etc?", "body": "<p>To have more control over the user input, you could read the user input character by character with <a href=\"https://linux.die.net/man/3/getchar\" rel=\"nofollow noreferrer\">getchar()</a>, it will return EOF when the user enters CTRL-D, usually. After that, the string can be parsed to extract the entered fractions and the like.</p>\n\n<p>If you you'd still like to use something like scanf(), you might consider to replace it with a call to <a href=\"https://linux.die.net/man/3/fgets\" rel=\"nofollow noreferrer\">fgets()</a>, to prevent buffer overflows. <a href=\"https://en.wikipedia.org/wiki/Scanf_format_string#Usage\" rel=\"nofollow noreferrer\">Or use scanf() with an appropriate formatting string</a> (<em>with a specified maximum number of characters</em>).</p>\n\n<pre><code>    /* gcc -o test_getchar test_getchar.c  &amp;&amp; ./test_getchar */\n\n    #include &lt;stdio.h&gt;\n\n    int main()\n    {\n        char user_input[1000] = {0};\n        int i = 0;\n        char c;\n        while ((c = getchar()) != EOF) {\n            /* do something with c here... */\n            user_input[i] = c;\n            ++i;\n            if (i &gt;= sizeof(user_input)-1)\n                break;\n        }\n        user_input[i] = 0;\n        printf(\"user input: %s\\r\\n\", user_input);\n        return 0;\n    }\n</code></pre>\n"}], "owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1525871072, "creation_date": 1525866246, "last_edit_date": 1525868090, "question_id": 50252580, "link": "https://stackoverflow.com/questions/50252580/how-do-i-read-user-input-across-multiple-lines-spaces-etc", "title": "How do I read user input across multiple lines, spaces etc?", "body": "<p>I am trying to scan in some user input, but when I run the program, all I get is a bunch of 3/4 fractions.</p>\n\n<p>I need to be able to scan in characters, spaces and break lines. If a user enters something like:</p>\n\n<pre><code>Hello this\n  is\n     a test123 234     !!!\n</code></pre>\n\n<p>Once they are done entering what they want to enter, they will press CTRL+D, and that is how I will know to stop reading what they are saying.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>char user_input[1000];\nint i = 0;\n    while (scanf(\"%c\", &amp;user_input[i]) == 1) {\n        i++;\n}\n</code></pre>\n"}, {"tags": ["c", "mpfr"], "answers": [{"tags": [], "owner": {"reputation": 2956, "user_id": 2207924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d97be4271939adcd1eec201cd777f57?s=128&d=identicon&r=PG", "display_name": "JeffUK", "link": "https://stackoverflow.com/users/2207924/jeffuk"}, "is_accepted": false, "score": 0, "last_activity_date": 1525868201, "creation_date": 1525868201, "answer_id": 50253212, "question_id": 50252561, "link": "https://stackoverflow.com/questions/50252561/mpfr-set-str-dont-give-good-value/50253212#50253212", "title": "mpfr_set_str don&#39;t give good value", "body": "<p>All three of those mpfr_printf statements are equivalent. (I assume you got them <a href=\"http://cs.swan.ac.uk/~csoliver/ok-sat-library/internet_html/doc/doc/Mpfr/3.0.0/mpfr.html/Formatted-Output-Functions.htm\" rel=\"nofollow noreferrer\">from here</a> )</p>\n\n<pre><code>mpfr_printf( \"%.0RF\\n\", x );\n</code></pre>\n\n<p>Rounds to the nearest value (default)</p>\n\n<pre><code>mpfr_printf( \"%.0RNf\\n\", x );\n</code></pre>\n\n<p>Rounds to nearest (because \"RN\")</p>\n\n<pre><code>mpfr_printf( \"%.0R*f\\n\", MPFR_RNDN, x );\n</code></pre>\n\n<p>Rounds to nearest (because \"MPFR_RNDN\")</p>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 9764250, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-dSpBGGlB7Js/AAAAAAAAAAI/AAAAAAAAAAc/NmgTQefc2tk/photo.jpg?sz=128", "display_name": "Akram Metallaoui", "link": "https://stackoverflow.com/users/9764250/akram-metallaoui"}, "edited": false, "score": 0, "creation_date": 1525875893, "post_id": 50253335, "comment_id": 87529134, "body": "thank you very much it helped me, I used mpz_sizeinbase (my_mpz, 2) to determine the number of bits to put in mpfr-init2 ()...  I use big numbers as &quot;unsigned long long int&quot; ; I wanted to know if there was not another way to determine the number of bits, please?"}], "tags": [], "owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "is_accepted": false, "score": 0, "last_activity_date": 1525868559, "creation_date": 1525868559, "answer_id": 50253335, "question_id": 50252561, "link": "https://stackoverflow.com/questions/50252561/mpfr-set-str-dont-give-good-value/50253335#50253335", "title": "mpfr_set_str don&#39;t give good value", "body": "<p>From <a href=\"http://www.mpfr.org/mpfr-current/mpfr.html\" rel=\"nofollow noreferrer\">GNU MPFR 4.0.1</a>:</p>\n\n<pre><code> A floating-point number, or float for short, is an arbitrary precision\n significand (also called mantissa) with a **limited** precision exponent.\n The C data type for such objects is mpfr_t\n ....\n The precision is the **number of bits used to represent the significand**\n of a floating-point number;...\n</code></pre>\n\n<p>The 'mpfr' numbers are represented as float and have precision. You may read about floating number precision (the number of bits in the significant) on <a href=\"https://en.wikipedia.org/wiki/Floating-point_arithmetic\" rel=\"nofollow noreferrer\">wiki</a>.</p>\n\n<p>Each mpfr must be initialized with a precision by user. <code>mpfr_init</code> initialized number with a default precision. From manual: <code>The default precision is set to 53 bits initially</code>.\nUse <code>mpfr_init2</code> function to set the precision (try to use it always). The following will run as expected, however you may run out of memory:</p>\n\n<pre><code>int main()\n{\n    mpfr_t x;\n    mpfr_init2(x, 200);\n    mpfr_set_str( x, \"213598703592091008239502270499962879705109534182641740644\", 10, MPFR_RNDN);\n    mpfr_printf( \"%.0RF\\n\", x );\n    mpfr_printf( \"%.0RNf\\n\", x );\n    mpfr_printf( \"%.0R*f\\n\", MPFR_RNDN, x );\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9764250, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-dSpBGGlB7Js/AAAAAAAAAAI/AAAAAAAAAAc/NmgTQefc2tk/photo.jpg?sz=128", "display_name": "Akram Metallaoui", "link": "https://stackoverflow.com/users/9764250/akram-metallaoui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 163, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1525868559, "creation_date": 1525866190, "last_edit_date": 1525867449, "question_id": 50252561, "link": "https://stackoverflow.com/questions/50252561/mpfr-set-str-dont-give-good-value", "title": "mpfr_set_str don&#39;t give good value", "body": "<p>For a project in C, I try to use the <a href=\"http://www.mpfr.org/\" rel=\"nofollow noreferrer\">GNU MPFR Library</a>.</p>\n\n<p>But I don't understand the functioning of the <em>mpfr_printf</em> function.</p>\n\n<p>For exemple for the code :</p>\n\n<pre><code>mpfr_t x;\nmpfr_init( x );\nmpfr_set_str( x, \"213598703592091008239502270499962879705109534182641740644\", 10, MPFR_RNDN);\nmpfr_printf( \"%.0RF\\n\", x );\nmpfr_printf( \"%.0RNf\\n\", x );\nmpfr_printf( \"%.0R*f\\n\", MPFR_RNDN, x );\n</code></pre>\n\n<p>Show for all <em>mpfr_printf</em> the value <strong>213598703592090993136552875701722213572989498633163374592</strong></p>\n\n<p>It's clearly not the same value... but I don't know why?</p>\n\n<p>I can't use the <a href=\"https://gmplib.org/\" rel=\"nofollow noreferrer\">The GNU Multiple Precision Arithmetic Library</a> because I need the function of MPFR like \"log\" and \"exp\".</p>\n\n<p>I have also try differents <em>Rounding Modes</em> in place of \"MPFR_RNDN\" but none works.</p>\n"}, {"tags": ["c", "x86", "intel", "sse", "simd"], "comments": [{"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 2, "creation_date": 1525877588, "post_id": 50252560, "comment_id": 87530429, "body": "What do you do with <code>sign</code> after that?  Are you sure you need 2&#39;s complement integer <code>-1</code> / <code>+1</code> instead of <code>-1</code> / 0 or something else?  Also, does <code>x&lt;0</code> need to be a correct IEEE compare that treats <code>x = -0.0</code> or <code>x = -NaN</code> as not <code>&lt;0.0</code>?  If so you need <code>_mm_cmplt_ps</code> instead of Paul R&#39;s sign-bit extraction.  But if not, Paul&#39;s answer looks like a good way to get exactly what you asked for, but you could maybe simplify it depending on what you do next."}], "answers": [{"comments": [{"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1525877801, "post_id": 50255331, "comment_id": 87530572, "body": "If the OP can use an integer <code>0</code> / <code>-1</code> result, an integer <code>pcmpgtd</code> against zero could test the sign bit, as an alternative to right shifting.  Or SSE4.1 <code>blendps</code> to select between integer +1 / -1 bit patterns, but that has extra bypass latency on Intel CPUs and is 2 uops for port5 on Haswell so can bottleneck the shuffle port."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1525877997, "post_id": 50255331, "comment_id": 87530700, "body": "You can avoid the <code>and</code>:  Use <code>srai</code> on the FP bit pattern directly, then set the low bit with <code>_mm_or_si128</code> instead of <code>_mm_add_epi32</code>.  That leaves the upper 31 bits as copies of the FP sign bit.  (Note that you&#39;re assuming that it&#39;s ok to treat <code>-0.0</code> and <code>-NaN</code> as less than <code>+0.0</code> in the OP&#39;s code, so looking at just the sign bit isn&#39;t the same as an FP compare.)"}, {"owner": {"reputation": 195333, "user_id": 253056, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1977cbe0ac5ffec4f6ee5ee24363988a?s=128&d=identicon&r=PG", "display_name": "Paul R", "link": "https://stackoverflow.com/users/253056/paul-r"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1525879308, "post_id": 50255331, "comment_id": 87531591, "body": "@PeterCordes: yes, all good points - at the back of my mind I was thinking that the OP might actually be able to just work with the sign bits rather than wasting time generating +1/-1 values, hence the &quot;if needed&quot; in the comment. I should have made a note of this in the question though - I&#39;ll do that shortly. If the OP definitely needs +1/-1 for the sign though then I like your idea of srai-ing the float directly."}], "tags": [], "owner": {"reputation": 195333, "user_id": 253056, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1977cbe0ac5ffec4f6ee5ee24363988a?s=128&d=identicon&r=PG", "display_name": "Paul R", "link": "https://stackoverflow.com/users/253056/paul-r"}, "is_accepted": false, "score": 2, "last_activity_date": 1525879380, "last_edit_date": 1525879380, "creation_date": 1525874434, "answer_id": 50255331, "question_id": 50252560, "link": "https://stackoverflow.com/questions/50252560/transform-comparison-routine-to-intel-simd/50255331#50255331", "title": "Transform comparison routine to Intel SIMD", "body": "<p>Assuming your input values are in a vector <code>__m128 v</code>:</p>\n\n<pre><code>__m128 vmask = _mm_set1_ps(-0.0f);      // create sign bit mask\n__m128 vsign = _mm_and_ps(v, vmask);    // create vector of sign bits (MSB)\n__m128i vsigni = _mm_add_epi32(_mm_srai_epi32((__m128i)vsign, 30), _mm_set1_epi32(1));\n                                        // convert sign bits to integer +1/-1 (if needed (*))\nv = _mm_andnot_ps(vmask, v);            // clear sign bits in v (i.e. v = fabsf(v))\n</code></pre>\n\n<p>(*) rather than wasting cycles generating +1/-1 for the sign, consider whether you could just work with the sign bits directly, and omit this step.</p>\n"}, {"comments": [{"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1525896013, "post_id": 50259499, "comment_id": 87540361, "body": "<code>-NaN</code> is another exception where this behaves differently from the code in the question, assuming <code>x &lt; 0</code> is an IEEE compare.  But yes, nice idea if it turns out the OP really does need +1 / -1 and can&#39;t just sum compare results and correct for the offset at the end or something."}], "tags": [], "owner": {"reputation": 15724, "user_id": 1716339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/835fc3719b0118c68c4d202b3e5cbf18?s=128&d=identicon&r=PG", "display_name": "Aki Suihkonen", "link": "https://stackoverflow.com/users/1716339/aki-suihkonen"}, "is_accepted": false, "score": 3, "last_activity_date": 1525931142, "last_edit_date": 1525931142, "creation_date": 1525888866, "answer_id": 50259499, "question_id": 50252560, "link": "https://stackoverflow.com/questions/50252560/transform-comparison-routine-to-intel-simd/50259499#50259499", "title": "Transform comparison routine to Intel SIMD", "body": "<p>With one small exception (x==+0.0f), you can generate the integer mask using the instruction <code>sign</code>:</p>\n\n<pre><code>_mm_sign_epi32(_mm_set1_epi32(1), x)\n</code></pre>\n\n<p>This will negate 1, if x&lt;0, but produces the sign==0 when x==0.</p>\n\n<p>If 0 is not allowed, x can be made nonzero by oring with <code>0&lt;mask&lt;0x80000000</code>.</p>\n\n<pre><code>auto s=_mm_set1_epi32(1);\nauto y=_mm_or_si128(x, s); // fix for x==0\ns=_mm_sign_epi32(s, y);\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 9749768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1279c6fa2aeb3bd62b8e7b3649d1b8b?s=128&d=identicon&r=PG&f=1", "display_name": "A.SDR", "link": "https://stackoverflow.com/users/9749768/a-sdr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1525931142, "creation_date": 1525866190, "last_edit_date": 1525874454, "question_id": 50252560, "link": "https://stackoverflow.com/questions/50252560/transform-comparison-routine-to-intel-simd", "title": "Transform comparison routine to Intel SIMD", "body": "<p>I have a routine where is should test if a float number is less than zero or not.  If yes I should store the sign and I get it is absolute values.</p>\n\n<pre><code>int sign = 1;\nif (x &lt; 0)\n{\n    sign = -1;\n}\nx = fabs(x);\n</code></pre>\n\n<p>I looked into Intel SIMD intrinsics and I found this instruction <code>dst = _mm_cmplt_ps(a,b)</code> that generate a vector containing (0xffffffff for true) or (0 for false) but I am stuck there; how can I know which element of the <code>dst</code> vector is negative or not to build the <code>sign_vector</code>. </p>\n"}, {"tags": ["c", "algorithm", "sorting"], "comments": [{"owner": {"reputation": 1352, "user_id": 2198121, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa303bed01349a6f8f42a872322c7eb2?s=128&d=identicon&r=PG", "display_name": "NuPagadi", "link": "https://stackoverflow.com/users/2198121/nupagadi"}, "edited": false, "score": 0, "creation_date": 1525867010, "post_id": 50252557, "comment_id": 87522737, "body": "Consider adding <code>c</code> tag."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525869024, "post_id": 50252557, "comment_id": 87524089, "body": "Why are you using <code>**</code> for the parameters? It is only needed in the push function."}], "answers": [{"tags": [], "owner": {"reputation": 1352, "user_id": 2198121, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa303bed01349a6f8f42a872322c7eb2?s=128&d=identicon&r=PG", "display_name": "NuPagadi", "link": "https://stackoverflow.com/users/2198121/nupagadi"}, "is_accepted": true, "score": 3, "last_activity_date": 1525866859, "creation_date": 1525866859, "answer_id": 50252740, "question_id": 50252557, "link": "https://stackoverflow.com/questions/50252557/sorting-list-in-ascending-and-descending-order/50252740#50252740", "title": "Sorting list in ascending and descending order", "body": "<p>You need to provide comparator functions. You can pass it to sorting function as function pointers, and use them instead of built-in operation.</p>\n\n<p>Like this:</p>\n\n<pre><code>int less(int lh, int rh)\n{\n    return lh &lt; rh;\n}\n\nint greater(int lh, int rh)\n{\n    return !less(lh, rh);\n}\n\nvoid sort(struct iorb **h, bool (*comp)(int, int))\n{\nint a;\n\nstruct iorb *temp1;\nstruct iorb *temp2;\n\nfor(temp1=*h;temp1!=NULL;temp1=temp1-&gt;link)\n  {\n    for(temp2=temp1-&gt;link;temp2!=NULL;temp2=temp2-&gt;link)\n      { \n        if(comp(temp2-&gt;base_pri, temp1-&gt;base_pri))  // Using a comparator.\n          {\n            a = temp1-&gt;base_pri;\n            temp1-&gt;base_pri = temp2-&gt;base_pri;\n            temp2-&gt;base_pri = a;\n          }\n       }\n   }\n}\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>sort(&amp;head, less);\n</code></pre>\n\n<p>or</p>\n\n<pre><code>sort(&amp;head, greater);\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 9762936, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Jarrad Geyer", "link": "https://stackoverflow.com/users/9762936/jarrad-geyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 50252740, "answer_count": 1, "score": 2, "last_activity_date": 1525868090, "creation_date": 1525866172, "last_edit_date": 1525868090, "question_id": 50252557, "link": "https://stackoverflow.com/questions/50252557/sorting-list-in-ascending-and-descending-order", "title": "Sorting list in ascending and descending order", "body": "<p>I need to sort a list either in ascending or descending order according to the preference order computed by whatever function is passed as its second argument. </p>\n\n<p>Pretty much the algorithm finds the minimum value, swaps it with the value in the first position or the last position depending on the calculation by the function passed as its 2nd argument of sort list( ) function call. </p>\n\n<p>Here is my code I just don't know how to implement a function passing for it to go ascending or descending. Mine only goes one way:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\ntypedef struct iorb {\nint base_pri;\nstruct iorb *link;\nchar filler[100];\n} IORB;\n\nint push(struct iorb **h, int x)\n{\nstruct iorb *temp = (struct iorb*)malloc(sizeof(struct iorb));\ntemp-&gt;base_pri = x;\ntemp-&gt;link = *h;\n*h = temp;\nreturn 0;\n}\n\nvoid print(struct iorb *head)\n{\nstruct iorb *temp = head;\nwhile(temp != NULL)\n{\n    printf(\"%d \",temp-&gt;base_pri);\n    temp = temp-&gt;link;\n}\nprintf(\"\\n\");\n}\n\nvoid sort(struct iorb **h)\n{\nint a;\n\nstruct iorb *temp1;\nstruct iorb *temp2;\n\nfor(temp1=*h;temp1!=NULL;temp1=temp1-&gt;link)\n  {\n    for(temp2=temp1-&gt;link;temp2!=NULL;temp2=temp2-&gt;link)\n      { \n        if(temp2-&gt;base_pri &lt; temp1-&gt;base_pri)\n          {\n            a = temp1-&gt;base_pri;\n            temp1-&gt;base_pri = temp2-&gt;base_pri;\n            temp2-&gt;base_pri = a;\n          }\n       }\n   }\n}\n\nint main()\n{\nstruct iorb * head = NULL;\npush(&amp;head,5);\npush(&amp;head,4);\npush(&amp;head,6);\npush(&amp;head,2);\npush(&amp;head,9);\nprintf(\"List is : \");\nprint(head);\nsort(&amp;head);\nprintf(\"after sorting list is : \");\nprint(head);\nreturn 0;\n}\n</code></pre>\n"}, {"tags": ["c", "time", "real-time", "numeric"], "comments": [{"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1525865856, "post_id": 50252413, "comment_id": 87522048, "body": "Note: line-comments in C start with <code>&#47;&#47;</code>, not with `\\\\`"}, {"owner": {"reputation": 111, "user_id": 9764241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e70d62b5d916a93465cbf82003a09ba4?s=128&d=identicon&r=PG&f=1", "display_name": "FaresGargouri", "link": "https://stackoverflow.com/users/9764241/faresgargouri"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1525866052, "post_id": 50252413, "comment_id": 87522195, "body": "Thanks. I corrected it"}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1525866107, "post_id": 50252413, "comment_id": 87522237, "body": "Check the granularity of the clock. It something like 18 milliseconds (and modern processors are a lot faster, taking onto account both compiler optimizations and cpu optimizations)."}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1525866264, "post_id": 50252413, "comment_id": 87522343, "body": "Conclusion: you can&#39;t accurately measure it. Better use big-O analysis to optimize your algorithm and use parallellism."}], "answers": [{"comments": [{"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 1, "creation_date": 1525867444, "post_id": 50252718, "comment_id": 87523013, "body": "Or possibly <a href=\"https://linux.die.net/man/3/clock_gettime\" rel=\"nofollow noreferrer\">clock_gettime</a> with the clock source set to <code>CLOCK_MONOTONIC</code> could be used."}, {"owner": {"reputation": 111, "user_id": 9764241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e70d62b5d916a93465cbf82003a09ba4?s=128&d=identicon&r=PG&f=1", "display_name": "FaresGargouri", "link": "https://stackoverflow.com/users/9764241/faresgargouri"}, "edited": false, "score": 0, "creation_date": 1525874542, "post_id": 50252718, "comment_id": 87528217, "body": "clock_gettime seems to be what I am looking for, thanks"}], "tags": [], "owner": {"reputation": 54765, "user_id": 309412, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e9739ec5574d9977b522d1c80fb8de84?s=128&d=identicon&r=PG", "display_name": "Lie Ryan", "link": "https://stackoverflow.com/users/309412/lie-ryan"}, "is_accepted": false, "score": 0, "last_activity_date": 1525868487, "last_edit_date": 1525868487, "creation_date": 1525866801, "answer_id": 50252718, "question_id": 50252413, "link": "https://stackoverflow.com/questions/50252413/how-to-measure-time-in-c-for-the-purposes-of-real-time-numerical-integration/50252718#50252718", "title": "How to measure time in c for the purposes of real-time numerical integration?", "body": "<blockquote>\n  <p>Does anyone why this is happening?</p>\n</blockquote>\n\n<p><a href=\"http://www.cplusplus.com/reference/ctime/clock/\" rel=\"nofollow noreferrer\">clock</a> measures CPU time, which is the amount of time slices/clock ticks that the CPU spent on your process. This is useful when you do microbenchmarking as you often don't want to measure time that the CPU actually spent on other processes in a microbenchmark, but it's not useful when you want to measure how much time actually passes between events. </p>\n\n<p>Instead, you should use <a href=\"http://www.cplusplus.com/reference/ctime/time/\" rel=\"nofollow noreferrer\">time</a> or <a href=\"http://man7.org/linux/man-pages/man2/gettimeofday.2.html\" rel=\"nofollow noreferrer\">gettimeofday</a> to measure wall clock time.</p>\n"}, {"tags": [], "owner": {"reputation": 111, "user_id": 9764241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e70d62b5d916a93465cbf82003a09ba4?s=128&d=identicon&r=PG&f=1", "display_name": "FaresGargouri", "link": "https://stackoverflow.com/users/9764241/faresgargouri"}, "is_accepted": true, "score": 3, "last_activity_date": 1528714429, "last_edit_date": 1528714429, "creation_date": 1528712341, "answer_id": 50795455, "question_id": 50252413, "link": "https://stackoverflow.com/questions/50252413/how-to-measure-time-in-c-for-the-purposes-of-real-time-numerical-integration/50795455#50795455", "title": "How to measure time in c for the purposes of real-time numerical integration?", "body": "<p>UPDATE: As it turns out, <code>clock()</code> is not suitable for real-time numerical calculation, as it only accounts for the time used on the processor. I solved the problem by using the <code>clock_gettime()</code> function defined in <code>&lt;time.h&gt;</code>. This returns the global time with a nanosecond resolution (of course, this comes with a certain error which is dependent on your clock resolution, but is is about the best thing out there).</p>\n\n<p>The answer was surprisingly hard to find, so thanks to <a href=\"https://stackoverflow.com/users/5264491/ian-abbott\">Ian Abbott</a>  for the very useful help</p>\n"}], "owner": {"reputation": 111, "user_id": 9764241, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e70d62b5d916a93465cbf82003a09ba4?s=128&d=identicon&r=PG&f=1", "display_name": "FaresGargouri", "link": "https://stackoverflow.com/users/9764241/faresgargouri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 2, "accepted_answer_id": 50795455, "answer_count": 2, "score": 1, "last_activity_date": 1528714429, "creation_date": 1525865734, "last_edit_date": 1528712824, "question_id": 50252413, "link": "https://stackoverflow.com/questions/50252413/how-to-measure-time-in-c-for-the-purposes-of-real-time-numerical-integration", "title": "How to measure time in c for the purposes of real-time numerical integration?", "body": "<p>I have trying to write c code where some numerical calculations containing time derivatives need to be performed in a real-time dynamic system setting. For this purpose, I need the most accurate time assessment possible from one cycle to the next in a variable called \"dt\":</p>\n\n<pre><code>static clock_t prev_time;\nprev_time = clock();\nwhile(1){\n    clock_t current_time = clock();\n    //do something\n    double dt = (double)(current_time - prev_time)/CLOCKS_PER_SEC;\nprev_time = current_time;\n}\n</code></pre>\n\n<p>However, when I test this code by integrating (continuously adding) <code>dt</code>, i.e</p>\n\n<pre><code>static double elapsed_time = 0;\n//the above-mentioned declaration and initialization in done here\nwhile(1){\n   //the above-mentioned code is executed here\n   elapsed_time += dt;\n   printf(\"elapsed_time : %lf\\n\", elapsed_time);\n}\n</code></pre>\n\n<p>I obtain results that are significantly lower than reality, by a factor that is constant at runtime, but seems to vary when I edit unrelated parts of the code (it ranges between 1/10 and about half the actual time).</p>\n\n<p>My current guess is that <code>clock()</code> doesn't account for time required for memory access (at several points throughout the code, I open an external textfile and save data in it for diagnosis purposes). </p>\n\n<p>But I am not sure if this is the case.\nAlso, I couldn't find any other way to accurately measure time.</p>\n\n<p>Does anyone why this is happening?</p>\n\n<p>EDIT: the code is compiled and executed on a raspberry pi 3, and is used to implement a feedback controler</p>\n"}, {"tags": ["c", "struct", "teensy"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2371524"}, "edited": false, "score": 2, "creation_date": 1525865216, "post_id": 50252165, "comment_id": 87521603, "body": "first of all, that&#39;s not a <code>struct</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2371524"}, "edited": false, "score": 0, "creation_date": 1525865303, "post_id": 50252165, "comment_id": 87521661, "body": "and your <code>lcd_display_mode_t</code> is just a <b>type</b>, not a variable ..."}, {"owner": {"reputation": 17713, "user_id": 226648, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/3196df423fd95dc4fce7dfadb8ec9953?s=128&d=identicon&r=PG", "display_name": "el.pescado", "link": "https://stackoverflow.com/users/226648/el-pescado"}, "edited": false, "score": 2, "creation_date": 1525865386, "post_id": 50252165, "comment_id": 87521723, "body": "Reading a good book about C should make things clearer."}], "answers": [{"comments": [{"owner": {"reputation": 432, "user_id": 8068536, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1eafb1d91ea01feb319f8f969058056d?s=128&d=identicon&r=PG&f=1", "display_name": "david_10001", "link": "https://stackoverflow.com/users/8068536/david-10001"}, "edited": false, "score": 0, "creation_date": 1525870473, "post_id": 50252262, "comment_id": 87525152, "body": "So if I had to put an if statement in there like I have done above, what would it look like? i.e. if this switch is on, then this mode is x..."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 432, "user_id": 8068536, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1eafb1d91ea01feb319f8f969058056d?s=128&d=identicon&r=PG&f=1", "display_name": "david_10001", "link": "https://stackoverflow.com/users/8068536/david-10001"}, "edited": false, "score": 0, "creation_date": 1525870682, "post_id": 50252262, "comment_id": 87525305, "body": "@david_10001 You use it like any other variable."}, {"owner": {"reputation": 432, "user_id": 8068536, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1eafb1d91ea01feb319f8f969058056d?s=128&d=identicon&r=PG&f=1", "display_name": "david_10001", "link": "https://stackoverflow.com/users/8068536/david-10001"}, "edited": false, "score": 0, "creation_date": 1525870827, "post_id": 50252262, "comment_id": 87525418, "body": "Ohh I think I get it. So I declare it like you have, with mode being the variable? And then treat that as any other variable in my if statement? You&#39;re right, the way they have stored the data s a bit confusing"}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 3, "last_activity_date": 1525865296, "creation_date": 1525865296, "answer_id": 50252262, "question_id": 50252165, "link": "https://stackoverflow.com/questions/50252165/how-do-i-use-enumerate-type-structs-in-c/50252262#50252262", "title": "How do I use enumerate type structs in C?", "body": "<p>An enum is not a struct. Using enums for storing binary data is a bad idea. One gets all kinds of weird side effects such as the type used being a signed int - which in turn is entirely unsuitable for the kind of hardware-related programming it will be used for. In addition, binary literals are not even standard C.</p>\n\n<p>Note that the typedef makes <code>lcd_display_mode_t</code> a type, not a variable. Whoever wrote the code was a bit confused, it would be sufficient to just write <code>typedef enum { ... } lcd_display_mode_t;</code>.</p>\n\n<p>They intended you to use the code like this:</p>\n\n<pre><code>lcd_display_mode_t mode;\n...\nmode = lcd_display_all_off;\n</code></pre>\n"}], "owner": {"reputation": 432, "user_id": 8068536, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1eafb1d91ea01feb319f8f969058056d?s=128&d=identicon&r=PG&f=1", "display_name": "david_10001", "link": "https://stackoverflow.com/users/8068536/david-10001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525865296, "creation_date": 1525864939, "question_id": 50252165, "link": "https://stackoverflow.com/questions/50252165/how-do-i-use-enumerate-type-structs-in-c", "title": "How do I use enumerate type structs in C?", "body": "<p>I am trying to set a Nokia LCD screen to turn all pixels off, all pixels on, inverse mode on and normal mode on, depending on which button the user pushes. I have all the code complete apart for setting the mode of the LCD screen. This is because they are displayed as enumerated type structs and I am not familiar with either concepts. The struct is:</p>\n\n<pre><code>typedef enum lcd_display_mode_t {\n    lcd_display_all_off = 0b000,\n    lcd_display_all_on  = 0b001,\n    lcd_display_normal  = 0b100,\n    lcd_display_inverse = 0b101,\n} lcd_display_mode_t;\n</code></pre>\n\n<p>My best guess is that, being a enumerate type, I would simply have to type:</p>\n\n<pre><code>if SWITCH X IS ON{\n    lcd_display_mode_t = 0;\n}\n</code></pre>\n\n<p>Which would set the display mode to lcd_display_all_off. Is this the correct use of structs in this context? If not, what would I type to set the display modes?</p>\n"}, {"tags": ["c", "embedded", "fatfs"], "comments": [{"owner": {"reputation": 7449, "user_id": 3811887, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/88dcea89bc4be8736da3b890f368a788?s=128&d=identicon&r=PG&f=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/3811887/andy"}, "edited": false, "score": 1, "creation_date": 1525864010, "post_id": 50251741, "comment_id": 87520756, "body": "<code>f_write</code> is a function from which library? How do you know what&#39;s the bottleneck? Does this board run a GNU/Linux kernel? What is the filesystem?"}, {"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1525864293, "post_id": 50251741, "comment_id": 87520944, "body": "Most likely this is FatFS library (for FAT32 filesystem), and on freestanding environment (no linux or similar)."}, {"owner": {"reputation": 119, "user_id": 9764257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/570f861aaa0062bd99c5e42a33115600?s=128&d=identicon&r=PG&f=1", "display_name": "John Dign", "link": "https://stackoverflow.com/users/9764257/john-dign"}, "edited": false, "score": 0, "creation_date": 1525864615, "post_id": 50251741, "comment_id": 87521178, "body": "Yes im using fatfs library and FreeRTOS . Its in different tasks, and for the sampling of data on 200 hz the queue for the task to write data on the sd card is getting full"}], "answers": [{"tags": [], "owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "is_accepted": true, "score": 0, "last_activity_date": 1525865020, "creation_date": 1525865020, "answer_id": 50252190, "question_id": 50251741, "link": "https://stackoverflow.com/questions/50251741/write-to-file-in-binary-on-a-microcontroller/50252190#50252190", "title": "Write to file in binary on a microcontroller", "body": "<p>In the most simplest form you just dump the data as is:</p>\n\n<pre><code>float data = ...\nfwrite(&amp;file, &amp;data, sizeof data, &amp;written);\n</code></pre>\n\n<p>This of course doesn't handle endianness gracefully, and doesn't have any structure (you might want to look at more sophisticated formats for that, like CBOR).</p>\n\n<p>If I remember correctly, FatFS already does some buffering behind the scenes, but it could also be faster to <code>memcpy</code> all data to temporary buffer first and then write that. You need to experiment, if speed is your top priority.</p>\n"}], "owner": {"reputation": 119, "user_id": 9764257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/570f861aaa0062bd99c5e42a33115600?s=128&d=identicon&r=PG&f=1", "display_name": "John Dign", "link": "https://stackoverflow.com/users/9764257/john-dign"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 436, "favorite_count": 0, "accepted_answer_id": 50252190, "answer_count": 1, "score": -2, "last_activity_date": 1525865388, "creation_date": 1525863543, "last_edit_date": 1525865388, "question_id": 50251741, "link": "https://stackoverflow.com/questions/50251741/write-to-file-in-binary-on-a-microcontroller", "title": "Write to file in binary on a microcontroller", "body": "<p>I'm using a STM32476 Nucleo board, and right now I write some data from sensors in a readable file, but it's way too slow. To show some code of what I'm doing now:</p>\n\n<pre><code>static char buffer[LINE_MAX];\nchar* p = buffer;\np += sprintf(p, \"%f,%f,%f,\", s.ax.val, s.ay.val, s.az.val);\np += sprintf(p, \"%f,%f,%f,\", s.gx.val, s.gy.val, s.gz.val);\np += sprintf(p, \" %f\"DEGREE_UTF8\"C\\r\\n\", s.temperature);\n\nint ret;\n\nunsigned bytes_written=0;\nif ((ret = f_write(&amp;USERFile, buffer, length, &amp;bytes_written)) != FR_OK || bytes_written != length) {\n    hang(\"write failed: %d (written = %u)\", ret, bytes_written);\n}\n</code></pre>\n\n<p>How could I change this to write in binary instead?</p>\n"}, {"tags": ["c", "atmega", "temperature", "adc", "volt"], "comments": [{"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1525863909, "post_id": 50251691, "comment_id": 87520695, "body": "Is there a particular reason you use <code>int</code> for the temperatures and not <code>double</code>?"}, {"owner": {"reputation": 1, "user_id": 9764258, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-oOLO5UG4QuQ/AAAAAAAAAAI/AAAAAAAAABA/C3r1jblQRPI/photo.jpg?sz=128", "display_name": "Mind Map", "link": "https://stackoverflow.com/users/9764258/mind-map"}, "reply_to_user": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1525864024, "post_id": 50251691, "comment_id": 87520765, "body": "No, should I use double?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 1, "creation_date": 1525864046, "post_id": 50251691, "comment_id": 87520781, "body": "@ArndtJonasson Yes there is a very sound reason, namely that this is a sluggish 8 bit MCU without FPU. It is not a PC. Using <code>double</code> would be horrible."}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 1, "creation_date": 1525864133, "post_id": 50251691, "comment_id": 87520834, "body": "So how will it compute .../1.22?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525864156, "post_id": 50251691, "comment_id": 87520853, "body": "Turns <i>what</i> temperature into voltage? All you seem to have is an ADC read, which is also a voltage. What this corresponds to depends on what sensor you have."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1525864288, "post_id": 50251691, "comment_id": 87520941, "body": "@ArndtJonasson Through elementary school math. x / 1.22 =  x*100*(how many decimals you need) / 122. Floating point is never used on low end embedded systems. If you don&#39;t know jack about such systems, then you should refrain from misleading the OP."}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1525864325, "post_id": 50251691, "comment_id": 87520960, "body": "You mean the compiler produces such code in the absence of an FPU? Fine then, but maybe all the conversion should be done explicitly that way, because you lose precision unnecessarily in the first step."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1525864392, "post_id": 50251691, "comment_id": 87521003, "body": "@ArndtJonasson No, you have to do it with fixed point math. Any floating point equation can be implemented in fixed point integer math, it is just a matter of how many decimals you need."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525864472, "post_id": 50251691, "comment_id": 87521062, "body": "If you use floating point types in the absence of a FPU, the compiler will pull in a software library and produce horribly ineffective code, which could have been avoided by not using floating point in the first place. This is beginner-level knowledge for embedded systems."}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1525864577, "post_id": 50251691, "comment_id": 87521152, "body": "This is a beginner-level question, isn&#39;t it?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525864800, "post_id": 50251691, "comment_id": 87521322, "body": "Well... this is one of multiple reasons why beginners should absolutely <i>not</i> program 8-bit MCUs as their first embedded project. They are multiple times harder to program in C than lets say a Cortex M4."}, {"owner": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525869916, "post_id": 50251691, "comment_id": 87524734, "body": "@Lundin Disagree, 8-Bit MCUs are great for beginners, so it easer to understand what the CPU is really doing. Easy to learn about buses, bits, addresses, interrupts ...  Changing a formula that you do not need floating point is a simple math problem."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "edited": false, "score": 0, "creation_date": 1525870561, "post_id": 50251691, "comment_id": 87525220, "body": "@12431234123412341234123 Beginners shouldn&#39;t deal with things like 16 bit int implicit type promotion pitfalls, extended addressing modes, manual optimization to smaller types etc. In addition, all 8-bitters on the market have their own personal shortcomings: PIC stack depth, AVR Harvard issues, the whole 8051 core etc. And then of course they all have one thing in common: being horribly slow and code inefficient. 8-bit = head ache, period. The only reason to use them in the year 2018 is because you need to maintain old stuff."}, {"owner": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525871025, "post_id": 50251691, "comment_id": 87525581, "body": "@Lundin Do you know any 32 or 16 bit MCU with a tiny package, such as SOT323? The smallest 32 Bit MCU is still really big. And why waste 32 Bit when you only control 3 GPIOs?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "edited": false, "score": 0, "creation_date": 1525871722, "post_id": 50251691, "comment_id": 87526052, "body": "@12431234123412341234123 <a href=\"https://electronics.stackexchange.com/questions/17612/arm-controllers-in-small-packages\" title=\"arm controllers in small packages\">electronics.stackexchange.com/questions/17612/&hellip;</a>. What do you mean &quot;waste 32 bit&quot;? And overall it sounds like you are rather looking for PLD logic and not a MCU..."}, {"owner": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525871782, "post_id": 50251691, "comment_id": 87526094, "body": "@Lundin A beginner should learn how a CPU works, and how to write very simple Programs. It does not matter if it is slow any that there is very little RAM. Beginners should learn that a <code>int</code> has a limit (and how it affects the preprocessor), 32 bit <code>int</code>also has a limit and that there are different architectures (a x86 architecture is much much complexer than any 8-bit architecture)."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "edited": false, "score": 0, "creation_date": 1525872002, "post_id": 50251691, "comment_id": 87526247, "body": "@12431234123412341234123 No, beginners shouldn&#39;t need to know why code like <code>uint8_t u8; ... uint16_t u16 = u8 &lt;&lt; 15;</code> might occasionally crash their whole program. They should be able to write code like that with no care."}, {"owner": {"reputation": 1588, "user_id": 6082851, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b14f3cd864bc266a401eca07b4153602?s=128&d=identicon&r=PG", "display_name": "12431234123412341234123", "link": "https://stackoverflow.com/users/6082851/12431234123412341234123"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525872290, "post_id": 50251691, "comment_id": 87526461, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/170694/discussion-between-12431234123412341234123-and-lundin\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 10413475, "user_type": "registered", "profile_image": "https://graph.facebook.com/10212457769938865/picture?type=large", "display_name": "Jeff Verive", "link": "https://stackoverflow.com/users/10413475/jeff-verive"}, "is_accepted": false, "score": 0, "last_activity_date": 1538251138, "creation_date": 1538251138, "answer_id": 52572058, "question_id": 50251691, "link": "https://stackoverflow.com/questions/50251691/transform-temperature-into-voltage-in-avr-studio/52572058#52572058", "title": "Transform Temperature into Voltage in AVR studio", "body": "<p>At the risk of overstating the obvious, it seems to me that there are two basic operations here:</p>\n\n<p>1) obtain temperature \n2) generate an output voltage </p>\n\n<p>It appears that the OP isn\u2019t so much hung up on numeric representation as in actually producing an analog voltage that is a function of the temperature acquired in step 1. This isn\u2019t surprising, since most microcontrollers (328P included) don\u2019t have analog outputs. But PWM outputs are available on the 328P, so it\u2019s very common to simply integrate the PWM output so as to get the desired result in Step 2.</p>\n"}], "owner": {"reputation": 1, "user_id": 9764258, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-oOLO5UG4QuQ/AAAAAAAAAAI/AAAAAAAAABA/C3r1jblQRPI/photo.jpg?sz=128", "display_name": "Mind Map", "link": "https://stackoverflow.com/users/9764258/mind-map"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1538251138, "creation_date": 1525863398, "last_edit_date": 1525863828, "question_id": 50251691, "link": "https://stackoverflow.com/questions/50251691/transform-temperature-into-voltage-in-avr-studio", "title": "Transform Temperature into Voltage in AVR studio", "body": "<p>I have to write a program in C, using ATmega 328p, which turns the temperature into voltage.</p>\n\n<p>So far I have done this:</p>\n\n<pre><code>#include &lt;avr/io.h&gt;\nunsigned int Ctemp;\nunsigned int Ftemp;\n\nint main(void)\n{\n\nADMUX = (1&lt;&lt;REFS1) | (1&lt;&lt;REFS0) | (0&lt;&lt;ADLAR) | (1&lt;&lt;MUX3) | (0&lt;&lt;MUX2) | (0&lt;&lt;MUX1) | (0&lt;&lt;MUX0);\n\nADCSRA = (1&lt;&lt;ADPS2) | (1&lt;&lt;ADPS1) | (1&lt;&lt;ADEN);\n\nADCSRA |= (1&lt;&lt;ADSC);\n\nwhile ((ADCSRA &amp; (1&lt;&lt;ADSC)) != 0);\n\nwhile(1)\n{\n    ADCSRA |= (1&lt;&lt;ADSC);\n\n    while ((ADCSRA &amp; (1&lt;&lt;ADSC)) != 0);\n\n    Ctemp = (ADC - 247)/1.22;\n    Ftemp = (Ctemp * 1.8) + 32;\n}\n\nreturn 1;\n}\n</code></pre>\n\n<p>Can you help me to complete the conversion part?</p>\n"}, {"tags": ["c", "assembly", "gdb"], "comments": [{"owner": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 0, "creation_date": 1525864163, "post_id": 50251637, "comment_id": 87520859, "body": "<code>ebp</code> is pretty much irrelevant (optimized code doesn&#39;t even use it). It&#39;s the difference between <code>esp</code> on entry and its lowest value in the function."}], "answers": [{"tags": [], "owner": {"reputation": 4522, "user_id": 5157478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bBcym.png?s=128&g=1", "display_name": "Frankie_C", "link": "https://stackoverflow.com/users/5157478/frankie-c"}, "is_accepted": false, "score": 0, "last_activity_date": 1525881317, "last_edit_date": 1525881317, "creation_date": 1525865037, "answer_id": 50252197, "question_id": 50251637, "link": "https://stackoverflow.com/questions/50251637/how-to-calculate-the-stack-frame-in-assembly-within-gdb/50252197#50252197", "title": "How to calculate the stack frame in assembly within gdb?", "body": "<p>No you can't.</p>\n\n<p>A stack frame extends from the point where the first parameter is pushed onto the stack up to the last modification of the stack due to any action or instruction. I.e. allocating space for a dynamic variable using <code>alloca()</code> or pushing a register, or simply storing a register in preallocated stack position. </p>\n\n<p>Actual compiler technology is so advanced that even the standard functions prologues and epilogues can be modified for the most aggressive optimization, making even more complex the frame unwinding.</p>\n\n<p>Acting only on the base frame, that in the case of a 32bits X86 code corresponds to the value stored in the <code>%ebp</code> register, isn't enough.</p>\n\n<p>Most recent evolution, as also @Jester said, demonstrated that even <code>%ebp</code> isn't necessary for exceptions stack unwind, and aggressive optimization switches in compilers, as <code>-fomit-frame-pointer</code> in GCC, doesn't save it on stack anymore (see <code>libunwind</code> below).</p>\n\n<p>To access the previous frame, starting from the base frame address hold in <code>%ebp</code>, you need the stack width of the stack frame for the relative function, inclusive of all stack operations.</p>\n\n<p>This information is normally stored in a specific section of the executable, generally using a list of records about stack operations. The sections are:</p>\n\n<ol>\n<li><code>.pdata</code> for Microsoft PE executables</li>\n<li><code>.eh_frame</code> and <code>.eh_frame_hdr</code> for ELF format (Linux).</li>\n</ol>\n\n<p>Depending on which OS you want to work on you can get more info starting from <a href=\"https://www-user.tu-chemnitz.de/~heha/viewchm.php/hs/Win32SEH.chm/Win32SEH.htm\" rel=\"nofollow noreferrer\">https://www-user.tu-chemnitz.de/~heha/viewchm.php/hs/Win32SEH.chm/Win32SEH.htm</a> for Microsoft executables.</p>\n\n<p>For Linux based system you can start to look here <a href=\"https://gnu.wildebeest.org/blog/mjw/2007/08/23/stack-unwinding/\" rel=\"nofollow noreferrer\">https://gnu.wildebeest.org/blog/mjw/2007/08/23/stack-unwinding/</a> and eventually have an in deep reading about the DWARF debugger <a href=\"http://wiki.dwarfstd.org/index.php?title=Special:SpecialPages\" rel=\"nofollow noreferrer\">http://wiki.dwarfstd.org/index.php?title=Special:SpecialPages</a>, and the <a href=\"https://www.nongnu.org/libunwind/\" rel=\"nofollow noreferrer\">https://www.nongnu.org/libunwind/</a> for a technically detailed immersion.</p>\n"}, {"tags": [], "owner": {"reputation": 2999, "user_id": 7520531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0107497596782a18d4a853214a883546?s=128&d=identicon&r=PG&f=1", "display_name": "Jose", "link": "https://stackoverflow.com/users/7520531/jose"}, "is_accepted": false, "score": 0, "last_activity_date": 1525872295, "creation_date": 1525872295, "answer_id": 50254553, "question_id": 50251637, "link": "https://stackoverflow.com/questions/50251637/how-to-calculate-the-stack-frame-in-assembly-within-gdb/50254553#50254553", "title": "How to calculate the stack frame in assembly within gdb?", "body": "<p>In an ideal world, the local variables will be located with a constant offset from the EBP, so you could figure out the size of the stack frame. However, the compiler and optimisations are too important, and one of the scenarios could be that EBP is used as GPR (<a href=\"https://stackoverflow.com/questions/14666665/trying-to-understand-gcc-option-fomit-frame-pointer\">Trying to understand gcc option -fomit-frame-pointer</a>). Could be a static analysis a nice solution?</p>\n"}], "owner": {"reputation": 11, "user_id": 9764105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0fee299840c4e43d0b7d1685e3fcb6b?s=128&d=identicon&r=PG&f=1", "display_name": "zzoorrii", "link": "https://stackoverflow.com/users/9764105/zzoorrii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 842, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1525881317, "creation_date": 1525863203, "last_edit_date": 1525863760, "question_id": 50251637, "link": "https://stackoverflow.com/questions/50251637/how-to-calculate-the-stack-frame-in-assembly-within-gdb", "title": "How to calculate the stack frame in assembly within gdb?", "body": "<p>I'm trying to explore the debugging of an assembly code (x86, 32bit, C source code). </p>\n\n<p>I would like to understand how can I calculate the actual size of the stack frame of particular function in my assembly code, while using the gdb. </p>\n\n<p>Is the size of the frame, the absolute difference between the <code>%esp</code> and <code>%ebp</code>, summed with every value that affects on the <code>%esp</code>, before everything is poped up?</p>\n\n<pre><code>pushl   %ebp\nmovl    %esp, %ebp\nsubl    $24, %esp\nsubl    $48, 8(%ebp)\n</code></pre>\n\n<p>Software: GNU gdb (Debian 7.12-6) 7.12.0.20161007-git</p>\n\n<pre><code>gcc -m32 -fno-asynchronous-unwind-tables -fno-pic -S main.c\ngcc -c -m32 main.s -o main.out\ngcc -g -m32 main.s -o main.out\ngcc -m32 -g -o main main.s\nas -a main.s\n</code></pre>\n\n<p>I would be thankful, if someone can help me. </p>\n"}, {"tags": ["c", "struct", "structure"], "comments": [{"owner": {"reputation": 4586, "user_id": 1507014, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ca563ac151770f5ae24c741970401c81?s=128&d=identicon&r=PG", "display_name": "Bentoy13", "link": "https://stackoverflow.com/users/1507014/bentoy13"}, "edited": false, "score": 0, "creation_date": 1525864352, "post_id": 50251617, "comment_id": 87520974, "body": "in <code>rrandom</code>, your loop <code>for (i=0; i&lt;1;i++)</code> runs only on the first element. I think the indexes in the loop are messed up according what you want to do."}], "answers": [{"tags": [], "owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "is_accepted": true, "score": 1, "last_activity_date": 1525864443, "creation_date": 1525864443, "answer_id": 50252015, "question_id": 50251617, "link": "https://stackoverflow.com/questions/50251617/how-to-append-elements-without-overwriting-in-struct-in-c/50252015#50252015", "title": "How to append elements without overwriting in struct in c", "body": "<p>You should pass the address of the resulting struct in <code>rrandom</code>:</p>\n\n<pre><code>void rrandom(org select[size], struct buff &amp;bf){\n  int j,r=0;\n  r = (rand() % (4 - 0)) + 0;\n  for( j=0;j&lt;4;j++){ \n    bf-&gt;bid[j]= select[r].id[j] ;\n    strcpy(bf-&gt;bname[j], select[r].name[j]);\n  }\n  for(int j=0;j&lt;4;j++){ \n    printf(\"bname %s  bid = %d \\n\", bf-&gt;bname[j], bf-&gt;bid[j]);\n  }\n}\n</code></pre>\n\n<p>You can then use it in your main by replacing your <code>rresult</code> calls with:</p>\n\n<pre><code>rrandom(select, buf);\nrrandom(select, buf + 1);\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 3420756, "user_type": "registered", "accept_rate": 17, "profile_image": "https://graph.facebook.com/100007914550911/picture?type=large", "display_name": "rose", "link": "https://stackoverflow.com/users/3420756/rose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 2, "accepted_answer_id": 50252015, "answer_count": 1, "score": 1, "last_activity_date": 1526028999, "creation_date": 1525863131, "last_edit_date": 1526028999, "question_id": 50251617, "link": "https://stackoverflow.com/questions/50251617/how-to-append-elements-without-overwriting-in-struct-in-c", "title": "How to append elements without overwriting in struct in c", "body": "<p>I'm trying to call <code>rrandom</code> to choose one random id and name and put it in <code>buff struct</code>, and second time calling <code>rrandom</code> to choose new random value and putting it also in <code>buff struct</code> as a second item. </p>\n\n<p>How can assign the second value to <code>buff</code> struct without deleting the first item ?</p>\n\n<pre><code>#include &lt;stdio.h&gt;    \n#include &lt;stdlib.h&gt;   \n#include &lt;string.h&gt;  \n#define size 4\n\ntypedef struct Org                  \n{\n   int  id[4]; \n   char name[4][7];  \n}org;\n\nvoid rrandom(org select[size], ???){\nint i,j,r=0;\nfor (i=0; i&lt;1;i++){\n   r = (rand() % (4 - 0)) + 0;\n  for( j=0;j&lt;4;j++){ \n    buf[i].id[j]= select[r].id[j] ;\n    strcpy(buf[i].name[j], select[r].name[j]);\n\n  }}\nfor ( int i=0; i&lt;2 ;i++){\n\n   for(int j=0;j&lt;4;j++){ \n   printf(\"bname %s  bid = %d \\n\", buf[i].name[j], buf[i].id[j]);\n\n }}\n}\nvoid main(  )\n{\nint i,j;\n\norg select[size]; \norg buf[2];\n\nsprintf(select[0].name[0],\"1ello1\");\nsprintf(select[0].name[1],\"1ello2\");\nsprintf(select[0].name[2],\"1ello3\");\nsprintf(select[0].name[3],\"1ello4\");\nsprintf(select[1].name[0],\"2ello1\");\nsprintf(select[1].name[1],\"2ello2\");\nsprintf(select[1].name[2],\"2ello3\");\nsprintf(select[1].name[3],\"2ello4\");\nsprintf(select[2].name[0],\"3ello1\");\nsprintf(select[2].name[1],\"3ello2\");\nsprintf(select[2].name[2],\"3ello3\");\nsprintf(select[2].name[3],\"3ello4\");\nsprintf(select[3].name[0],\"4ello1\");\nsprintf(select[3].name[1],\"4ello2\");\nsprintf(select[3].name[2],\"4ello3\");\nsprintf(select[3].name[3],\"4ello4\");\nsprintf(select[4].name[0],\"5ello1\");\nsprintf(select[4].name[1],\"5ello2\");\nsprintf(select[4].name[2],\"5ello3\");\nsprintf(select[4].name[3],\"5ello4\");\nprintf(\" Initial id :\\n\");\nfor(i=0;i&lt;4 ;i++)                         \n{\n    for(j=0;j&lt; 4;j++)                       \n    { \n         select[i].id[j]= j;        \n}    }\nrrandom(select,???);\nrrandom(select,???);\nfor ( int i=0; i&lt;2 ;i++){   \n   for(int j=0;j&lt;4;j++){ \n   printf(\"from main bname %s  bid = %d \", buf[i].name[j], \n    buf[i].id[j]);}\n    printf(\"\\n\\n\");\n } \n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525863188, "post_id": 50251328, "comment_id": 87520276, "body": "I don&#39;t understand this question. What is &quot;length&quot;? Why is it 7 when there are 8 data bits? What do you mean &quot;extract the data with start bit 46&quot;? How can a bit have any other value than 0 or 1? There is no sequence in the data provided which is 46 or 0x2E."}, {"owner": {"reputation": 143, "user_id": 8540390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3d8fc1dec42ea6332e7ab53e73102b4?s=128&d=identicon&r=PG", "display_name": "user8540390", "link": "https://stackoverflow.com/users/8540390/user8540390"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525863354, "post_id": 50251328, "comment_id": 87520359, "body": "i meant 8 bytes i.e.,64 bits of data"}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 8540390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3d8fc1dec42ea6332e7ab53e73102b4?s=128&d=identicon&r=PG", "display_name": "user8540390", "link": "https://stackoverflow.com/users/8540390/user8540390"}, "edited": false, "score": 0, "creation_date": 1525865890, "post_id": 50252042, "comment_id": 87522078, "body": "<code>mask = (1u &lt;&lt; ((length &amp; (UINT16_WIDTH - 1)) - 1u);</code> Is it right?"}, {"owner": {"reputation": 827, "user_id": 7383242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c65444c41048c45464ae10a9cafa0c41?s=128&d=identicon&r=PG&f=1", "display_name": "medalib", "link": "https://stackoverflow.com/users/7383242/medalib"}, "reply_to_user": {"reputation": 143, "user_id": 8540390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3d8fc1dec42ea6332e7ab53e73102b4?s=128&d=identicon&r=PG", "display_name": "user8540390", "link": "https://stackoverflow.com/users/8540390/user8540390"}, "edited": false, "score": 0, "creation_date": 1525868843, "post_id": 50252042, "comment_id": 87523972, "body": "@user8540390, thanks for the note, I forgot some parentheses :)."}], "tags": [], "owner": {"reputation": 827, "user_id": 7383242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c65444c41048c45464ae10a9cafa0c41?s=128&d=identicon&r=PG&f=1", "display_name": "medalib", "link": "https://stackoverflow.com/users/7383242/medalib"}, "is_accepted": true, "score": 1, "last_activity_date": 1525868951, "last_edit_date": 1525868951, "creation_date": 1525864523, "answer_id": 50252042, "question_id": 50251328, "link": "https://stackoverflow.com/questions/50251328/extract-data-from-the-frame-using-c/50252042#50252042", "title": "Extract data from the frame using C", "body": "<p>Your problem here, is the way in which you set your mask:</p>\n\n<pre><code>for(i=0;i&lt;16;i++)\n{\n    if(length == i)\n    mask|=(1&lt;&lt;i); /* BTW, mask is not initialized */\n}\n</code></pre>\n\n<p>is simply equivalent to:</p>\n\n<pre><code>mask |= (1 &lt;&lt; length);\n</code></pre>\n\n<p>which will set only one bit in you mask. So either you substruct one from <code>mask</code> after the <code>for</code>, or you set it directly:</p>\n\n<pre><code>#define UINT16_WIDTH 16\nmask = (1u &lt;&lt; (length &amp; (UINT16_WIDTH - 1))) - 1u;\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 8540390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3d8fc1dec42ea6332e7ab53e73102b4?s=128&d=identicon&r=PG", "display_name": "user8540390", "link": "https://stackoverflow.com/users/8540390/user8540390"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 1, "accepted_answer_id": 50252042, "answer_count": 1, "score": 0, "last_activity_date": 1525868951, "creation_date": 1525862220, "question_id": 50251328, "link": "https://stackoverflow.com/questions/50251328/extract-data-from-the-frame-using-c", "title": "Extract data from the frame using C", "body": "<p>I have a function as follows:</p>\n\n<pre><code>union u_t\n{\n  uint16_t u16;\n  uint8_t u8[2];\n};\n\nuint16_t Frame2Data(uint8_t *data,uint8_t startBit,uint16_t length)\n{\n  uint16_t mask;\n  uint8_t start;\n  uint8_t firstByte,offset;\n  uint8_t numShift;\n  union u_t ut;\n\n  for(i=0;i&lt;16;i++)\n  {\n    if(length == i)\n    mask|=(1&lt;&lt;i);\n  }\n\n  firstByte = startBit / 8;\n  offset = (firstByte+2) * 8;\n  start = startBit + length;\n  numShift = offset - start;\n  ut.u8[1] = data[firstByte];\n  ut.u8[0] = data[firstByte+1];\n  return (ut.u16 &gt;&gt; numShift) &amp; mask;\n}\n</code></pre>\n\n<p>The start bit is 46 and length is 7 and the data in 8 bytes is <code>0x00 0x09 0x03 0x84 0x03 0x70 0x02 0xA8</code> has to be passed. I have to extract the data with start bit 46 and upto a length of 7 bits and find out its value. I have a doubt with numbershift and is my function working correctly? It would be great if someone confirms this.Thanks in advance.</p>\n"}, {"tags": ["c", "signals", "fork", "posix", "signal-handling"], "comments": [{"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1525865412, "post_id": 50251285, "comment_id": 87521740, "body": "Why not arrange for only the main process to do anything when it receives the signal?"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1525867844, "post_id": 50251285, "comment_id": 87523237, "body": "Note that <code>sem_unlink()</code>, <code>shm_unlink()</code>, <code>exit()</code>, and <code>printf()</code> are all not async-signal-safe functions and can not be safely called from within a signal handler.  Per <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/V2_chap02.html#tag_15_04\" rel=\"nofollow noreferrer\"><b>2.4 Signal Concepts</b></a> of the POSIX standard: &quot;Any function not in the above table may be unsafe with respect to signals. ... when a signal interrupts an unsafe function or equivalent ... and the signal-catching function calls an unsafe function, the behavior is undefined.&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 369, "user_id": 7400340, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a6380568a3888fda9ed87f3e4f13ea4?s=128&d=identicon&r=PG&f=1", "display_name": "sdobak", "link": "https://stackoverflow.com/users/7400340/sdobak"}, "is_accepted": false, "score": 1, "last_activity_date": 1525865706, "creation_date": 1525865706, "answer_id": 50252401, "question_id": 50251285, "link": "https://stackoverflow.com/questions/50251285/how-to-make-signal-handler-only-run-it-once-and-terminate-all-processes/50252401#50252401", "title": "How to make signal handler only run it once and terminate all processes?", "body": "<p>When you fork a new process then the newly forked child will inherit the signal handlers of the parent. So in your case both the parent and the child process will have the same signal handlers and when a signal is received both of them will run.</p>\n\n<p>To fix this, you can register signal handlers after fork, only in the parent process or you can block the signals in the child process by using <code>sigprocmask</code></p>\n"}], "owner": {"reputation": 33, "user_id": 9506859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cca0d328a537c4b6a5d4868697fe42c0?s=128&d=identicon&r=PG&f=1", "display_name": "itsfreeandtakesminute", "link": "https://stackoverflow.com/users/9506859/itsfreeandtakesminute"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525865706, "creation_date": 1525862107, "question_id": 50251285, "link": "https://stackoverflow.com/questions/50251285/how-to-make-signal-handler-only-run-it-once-and-terminate-all-processes", "title": "How to make signal handler only run it once and terminate all processes?", "body": "<p>I have N child process and a parent process. \nI have signal handler which in below code code.</p>\n\n<pre><code>void unlink_semaphores(){\n\nsem_unlink(SEM_NAME1) &lt; 0;\n   // perror(\"sem_unlink(3) failed\");\n\nsem_unlink(SEM_NAME2) &lt; 0;\n    //perror(\"sem_unlink(3) failed\");\nsem_unlink(SEM_NAME3) &lt; 0;\n   // perror(\"sem_unlink(3) failed\");\nsem_unlink(SEM_NAME4) &lt; 0;\n   // perror(\"sem_unlink(3) failed\");\nsem_unlink(SEM_NAME5) &lt; 0;\n    //perror(\"sem_unlink(3) failed\");\nsem_unlink(SEM_NAME6) &lt; 0;\n    //perror(\"sem_unlink(3) failed\");\n\nsem_unlink(SEM_NAME7) &lt; 0;\n    //perror(\"sem_unlink(3) failed\");\nif (shm_unlink(SHMOBJ_PATH1) != 0) {\n   // perror(\"In shm_unlink() of buffer 1\");\n    exit(1);\n}\n}\nvoid sinyal_handler(int signo)\n\n{\n\nif (signo == SIGINT || signo == SIGTERM) {\n    if(signo == SIGINT) printf(\"received Ctrl+C\\n\");\n    if(signo == SIGTERM) printf(\"received SIGTERM \\n\");\n\n    printf(\"closing semaphores and giving shared maps...\\n\");\n    unlink_semaphores();\n    _exit(EXIT_FAILURE);\n}\n</code></pre>\n\n<p>}</p>\n\n<p>in Main program before forking i set signal handlers.</p>\n\n<pre><code>signal(SIGINT,&amp;sinyal_handler);\nsignal(SIGTERM,&amp;sinyal_handler);\n</code></pre>\n\n<p>and child processes never goes outside of While(1) loop until CTRL+C comes to program and signal handler kills it with closing linked semaphores etc.</p>\n\n<pre><code>for (i = 0; i &lt; PROCESS_N; i++) {\n        if (fork() == 0) {\n            // do the job specific to the child process\n            //random shared variable -&gt; ra\n\n            while(1){ .. code-&gt;\n</code></pre>\n\n<p>Problem is when i press CTRL + C program calls signal handlers multiple times and print info, try to unlink files multiple times.</p>\n\n<p>How to fix this?</p>\n"}, {"tags": ["c++", "c", "char"], "comments": [{"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 4, "creation_date": 1525862150, "post_id": 50251266, "comment_id": 87519625, "body": "What &quot;fails&quot;? Please include the verbatim error message and even better: show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}, {"owner": {"reputation": 4074, "user_id": 808101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb24053e79c428dad4e874daa4da0cb?s=128&d=identicon&r=PG", "display_name": "benjarobin", "link": "https://stackoverflow.com/users/808101/benjarobin"}, "edited": false, "score": 1, "creation_date": 1525862192, "post_id": 50251266, "comment_id": 87519653, "body": "binnMode pointed data should be const: <code>const char * binnMode</code>"}, {"owner": {"reputation": 144568, "user_id": 3309790, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7d1c7e499132b9945b412ac79d0e22f7?s=128&d=identicon&r=PG&f=1", "display_name": "songyuanyao", "link": "https://stackoverflow.com/users/3309790/songyuanyao"}, "edited": false, "score": 1, "creation_date": 1525862193, "post_id": 50251266, "comment_id": 87519654, "body": "<code>const char * binnMode;</code> ?"}], "answers": [{"comments": [{"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 3, "creation_date": 1525862386, "post_id": 50251315, "comment_id": 87519777, "body": "<i>&quot;don&#39;t know where you heard it was a <code>char[]</code>&quot;</i> - It is in C to this day. But modifying it is UB. Quite silly, really."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1525862600, "post_id": 50251315, "comment_id": 87519921, "body": "@StoryTeller: I quote: <i>&quot;the C-literal is defined as <code>char str[]</code> (C++11)&quot;</i>"}, {"owner": {"reputation": 6463, "user_id": 6387170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d425edf9cc20e61c8cc3be162915f06?s=128&d=identicon&r=PG&f=1", "display_name": "UKMonkey", "link": "https://stackoverflow.com/users/6387170/ukmonkey"}, "edited": false, "score": 0, "creation_date": 1525862905, "post_id": 50251315, "comment_id": 87520110, "body": "I&#39;m pretty sure strings in tapestries were immutable before the Bayeux tapestry ...."}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1525862961, "post_id": 50251315, "comment_id": 87520143, "body": "To be frank, that complete sentence is wrought with confusion on the OP&#39;s part. The double tagging is what led me to believe the OP is thinking of C here. Wasn&#39;t a critique of your answer :)"}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1525863448, "post_id": 50251315, "comment_id": 87520415, "body": "Total OT-pedantry - &quot;AD&quot; should <i>precede</i> the year number (<b>A.D. 1066</b>), not follow it as &quot;BC&quot; does."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1525863915, "post_id": 50251315, "comment_id": 87520701, "body": "@TobySpeight: You&#39;re right"}], "tags": [], "owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "is_accepted": false, "score": 6, "last_activity_date": 1525863943, "last_edit_date": 1525863943, "creation_date": 1525862190, "answer_id": 50251315, "question_id": 50251266, "link": "https://stackoverflow.com/questions/50251266/c-copy-string-literal-from-c/50251315#50251315", "title": "c++ copy string literal (from C)", "body": "<p>Notice that the parameter is <code>const char*</code>, not <code>char*</code>.</p>\n\n<p>That's convenient because it's also what <code>binnMode</code> needs to be.</p>\n\n<p>String literals are immutable, and (in C++) <code>const</code>. Yours is a <code>const char[&lt;length+1&gt;]</code> (don't know where you heard it was a <code>char[]</code>) which decays nicely to a <code>const char*</code>.</p>\n"}], "owner": {"reputation": 2714, "user_id": 843458, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/e600bfa3509ddea2d693514cbe11bbdb?s=128&d=identicon&r=PG", "display_name": "Matthias Pospiech", "link": "https://stackoverflow.com/users/843458/matthias-pospiech"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "closed_date": 1525865313, "answer_count": 1, "score": 0, "last_activity_date": 1525863943, "creation_date": 1525862045, "question_id": 50251266, "link": "https://stackoverflow.com/questions/50251266/c-copy-string-literal-from-c", "closed_reason": "Not suitable for this site", "title": "c++ copy string literal (from C)", "body": "<p>I want to save a C String to a C++ Variable. This shall than be passed to the C-API function.</p>\n\n<p>The string is defined in the C-API\nas</p>\n\n<pre><code>#define  XI_PRM_BINNING_HORIZONTAL_MODE         \"binning_horizontal_mode\"\n</code></pre>\n\n<p>I want to select the string in a switch</p>\n\n<pre><code>char * binnMode;\n...\nbinnMode = XI_PRM_BINNING_HORIZONTAL_MODE;\n</code></pre>\n\n<p>But that fails because the C-literal is defined as <code>char str[]</code> (C++11)</p>\n\n<p>I want to pass the string to a function that expects</p>\n\n<pre><code>xiSetParamInt(IN HANDLE hDevice, const char* prm, const int val)\n</code></pre>\n\n<p>How do I need to define <code>binnMode</code> in order to get this working?</p>\n"}, {"tags": ["c", "linux", "makefile", "compilation", "openwrt"], "answers": [{"tags": [], "owner": {"reputation": 1047, "user_id": 8507637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dNzYc.png?s=128&g=1", "display_name": "rage", "link": "https://stackoverflow.com/users/8507637/rage"}, "is_accepted": false, "score": 1, "last_activity_date": 1526050787, "creation_date": 1526050787, "answer_id": 50295117, "question_id": 50251144, "link": "https://stackoverflow.com/questions/50251144/how-to-cause-build-system-to-fail-compilation-in-case-patch-fail-to-apply/50295117#50295117", "title": "How to cause build system to fail compilation in case patch fail to apply", "body": "<p>According to the <a href=\"https://openwrt.org/docs/guide-developer/build-system/use-buildsystem\" rel=\"nofollow noreferrer\">documentation</a>, the easiest way to spot build failures would be to run <code>make V=s 2&gt;&amp;1 | tee build.log | grep -i '[^_-\"a-z]error[^_-.a-z]'</code>.</p>\n\n<p>If you know you are having issues with a specific package, I would specifically build those packages via <code>make package/&lt;pkgname&gt;/compile V=s</code> and see where it is failing.</p>\n\n<p>Also, I would try testing the image out in <a href=\"https://openwrt.org/docs/guide-user/virtualization/qemu\" rel=\"nofollow noreferrer\">qemu</a> before flashing a real device. That way you can verify your build.</p>\n"}], "owner": {"reputation": 735, "user_id": 2568434, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/2aDtk.jpg?s=128&g=1", "display_name": "dear_tzvi", "link": "https://stackoverflow.com/users/2568434/dear-tzvi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1526050787, "creation_date": 1525861707, "last_edit_date": 1525936214, "question_id": 50251144, "link": "https://stackoverflow.com/questions/50251144/how-to-cause-build-system-to-fail-compilation-in-case-patch-fail-to-apply", "title": "How to cause build system to fail compilation in case patch fail to apply", "body": "<p>I'm using an OpenWRT environment for code development.</p>\n\n<p>Now, OpenWRT build works by first fetching a package from remote repository, extract it and later apply local patches on top of that code.</p>\n\n<p>What I've noticed is that in case the patch fails to apply, the build itself not always fail, and that creates problems from entire system perspective.</p>\n\n<p>I'm looking for a way to define that in case a patch is fail to apply, the entire build will fail.</p>\n\n<p>Thank you all in advance!</p>\n"}, {"tags": ["c", "matrix"], "comments": [{"owner": {"reputation": 8116, "user_id": 909655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70d8d9d24942b0fe339ecedeb2c4c5e7?s=128&d=identicon&r=PG", "display_name": "Mats", "link": "https://stackoverflow.com/users/909655/mats"}, "edited": false, "score": 1, "creation_date": 1525864887, "post_id": 50251041, "comment_id": 87521380, "body": "I think you expect the <code>,</code> in C to do something different from what it actually does. Please consider reading <a href=\"https://stackoverflow.com/questions/52550/what-does-the-comma-operator-do\" title=\"what does the comma operator do\">stackoverflow.com/questions/52550/&hellip;</a>"}, {"owner": {"reputation": 1405, "user_id": 1764528, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e6da340d12df3f5e4c7a53681a9ac91e?s=128&d=identicon&r=PG", "display_name": "DollarAkshay", "link": "https://stackoverflow.com/users/1764528/dollarakshay"}, "edited": false, "score": 0, "creation_date": 1525876995, "post_id": 50251041, "comment_id": 87530025, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/12311869/fast-matrix-exponentiation\">Fast Matrix Exponentiation</a>"}], "owner": {"reputation": 11, "user_id": 9671976, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-pp8sQUXkgks/AAAAAAAAAAI/AAAAAAAAAaM/d1GDM-GT3KI/photo.jpg?sz=128", "display_name": "AverageMarcin", "link": "https://stackoverflow.com/users/9671976/averagemarcin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 191, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1525861784, "creation_date": 1525861392, "last_edit_date": 1525861784, "question_id": 50251041, "link": "https://stackoverflow.com/questions/50251041/how-to-rise-to-the-nth-power-a-2x2-matrix", "title": "How to rise to the nth power A (2x2) matrix?", "body": "<p>I'm trying to rise to the nth power the (2x2) matrix in O(log_2(n)) operations. \nMatrix is defined as follows: </p>\n\n<p>A=   [y1 = 1 y2 = 2]\n        [y3 = 1 y4 = 0] </p>\n\n<p>I think I have some errors in my method of doing it. Any suggestions on how I can perform this operation?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint fnct(int n)\n{\n    int y1 = 1, y2 = 1, y3 = 1, y4 = 0; //entries of the A matrix \n    int z1, z2, z3, z4; //entries of the auxiliary matrix\n\n                        // if n==0 return matrix it-self\n    if (n == 0)\n    {\n        y1 = 1;\n        y2 = 0;\n        y3 = 1;\n        y4 = 1;\n        return y1, y2, y3, y4;\n    }\n    // if n mod 2 == 0 set y1,y2,y3,y4 to the fnct(n/2)\n    if ((n % 2) == 0)\n    {\n        y1, y2, y3, y4 = fnct(n / 2);\n        z1 = y1 * y2 + y2 * y3;\n        z2 = y1 * y2 + y2 * y4;\n        z3 = y3 * y1 + y4 * y3;\n        z4 = y3 * y2 + y4 * y4;\n        return z1, z2, z3, z4;\n    }\n\n    else if ((n % 2) == 1)\n    {\n        y1, y2, y3, y4 = fnct(n / 2);\n        z1 = y1 * y1 + y2 * y3;\n        z2 = y1 * y2 + y2 * y1;\n        z3 = y3 * y1 + y4 * y3;\n        z4 = y3 * y2 + y4 * y4;\n\n        y1 = z1 + z3;\n        y2 = z2 + z4;\n        y3 = z1;\n        y4 = z2;\n        return z1, z2, z3, z4;\n    }\n\n    //return of the end of the function \n    return y1, y2, y3, y4;\n}\n\nint main()\n{\n    int n;\n    printf(\"Enter n\\n\");\n    scanf(\"%d\", &amp;n);\n    printf(\"%d\\n\", fnct(n));\n}\n</code></pre>\n"}, {"tags": ["c", "ocaml", "frama-c"], "answers": [{"comments": [{"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 1, "creation_date": 1525963692, "post_id": 50275577, "comment_id": 87567891, "body": "Even though the original&#39;s code is badly indented, this does not answer the question, which is about programmatically locating statements in an AST."}, {"owner": {"reputation": 3212, "user_id": 1295435, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf39389382759c77d2ffc06815de574f?s=128&d=identicon&r=PG&f=1", "display_name": "byako", "link": "https://stackoverflow.com/users/1295435/byako"}, "edited": false, "score": 1, "creation_date": 1525982133, "post_id": 50275577, "comment_id": 87577717, "body": "AST is abstract syntax tree."}], "tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": false, "score": -1, "last_activity_date": 1525963365, "creation_date": 1525963365, "answer_id": 50275577, "question_id": 50250814, "link": "https://stackoverflow.com/questions/50250814/frama-c-find-location-of-loop-end/50275577#50275577", "title": "Frama-C: find location of loop end", "body": "<p>to determine when loops start/stop use consistent indentation.</p>\n\n<ol>\n<li>indent after every opening brace '{'</li>\n<li>unindent before every closing brace '}'</li>\n<li>suggest each indent level be 4 spaces.</li>\n</ol>\n\n<p>Applying the above criteria to the posted code results in:</p>\n\n<pre><code>void kernel(int ni, int nj, int nk, float alpha, float *tmp, float *A, float *B)\n{\n    int i, j, k;\n\n    for (i = 0; i &lt; ni; i++)\n    {\n        for (j = 0; j &lt; nj; j++)\n        {\n            tmp[i * nj + j] = 0.0f;\n\n            for (k = 0; k &lt; nk; ++k)\n            {\n                tmp[i * nj + j] += alpha * A[i * nk + k] * B[k * nj + j];\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>which is very easy to see where each loop starts and stops</p>\n"}, {"comments": [{"owner": {"reputation": 79, "user_id": 7593365, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/23e98eb6b35fb1951cd7133e4dc91883?s=128&d=identicon&r=PG&f=1", "display_name": "R. Fomba", "link": "https://stackoverflow.com/users/7593365/r-fomba"}, "edited": false, "score": 0, "creation_date": 1525985924, "post_id": 50280827, "comment_id": 87579380, "body": "I searched break statements (unsing a <code>vstmt_aux</code>) either with <code>|Break(loc)</code> or by iterating on loop successors list or with <code>Stmts_graph.get_all_stmt_last_stmts</code>. But in all case, the location (obtaining with <code>(fst loc).Lexing.pos_lnum</code>) what Frama-C gives me correspond to the same location as the beginning of the loop (ie the line where the <code>for(i=0; ...)</code> statement is located) which is not the information I wish to have, I would like to be able to determine where my loop ends."}, {"owner": {"reputation": 3212, "user_id": 1295435, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf39389382759c77d2ffc06815de574f?s=128&d=identicon&r=PG&f=1", "display_name": "byako", "link": "https://stackoverflow.com/users/1295435/byako"}, "reply_to_user": {"reputation": 79, "user_id": 7593365, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/23e98eb6b35fb1951cd7133e4dc91883?s=128&d=identicon&r=PG&f=1", "display_name": "R. Fomba", "link": "https://stackoverflow.com/users/7593365/r-fomba"}, "edited": false, "score": 0, "creation_date": 1525994610, "post_id": 50280827, "comment_id": 87582110, "body": "I was suggesting to use the <i>2nd</i> component, i.e. <code>snd loc</code>, and on the location of the loop itself."}, {"owner": {"reputation": 79, "user_id": 7593365, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/23e98eb6b35fb1951cd7133e4dc91883?s=128&d=identicon&r=PG&f=1", "display_name": "R. Fomba", "link": "https://stackoverflow.com/users/7593365/r-fomba"}, "edited": false, "score": 0, "creation_date": 1526030452, "post_id": 50280827, "comment_id": 87594072, "body": "Thank, indeed the second component of the loop location itself corresponds to the location of loop end."}], "tags": [], "owner": {"reputation": 3212, "user_id": 1295435, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf39389382759c77d2ffc06815de574f?s=128&d=identicon&r=PG&f=1", "display_name": "byako", "link": "https://stackoverflow.com/users/1295435/byako"}, "is_accepted": true, "score": 5, "last_activity_date": 1525983050, "creation_date": 1525983050, "answer_id": 50280827, "question_id": 50250814, "link": "https://stackoverflow.com/questions/50250814/frama-c-find-location-of-loop-end/50280827#50280827", "title": "Frama-C: find location of loop end", "body": "<p>In Frama-C, there is no such thing as a statement which would correspond to the closing <code>}</code> in your code. Only statements that may have an observable effect (either on the memory, or on the control-flow) exist; the only exception is <code>Skip</code>, but Frama-C avoids generating those.</p>\n\n<ul>\n<li><p>if you are looking for the <em>line number</em> of the <code>}</code>, as extracted from the AST, you may look at the second component of the locations that are attached to each statement. As can be seen in <code>Cil_types</code>, locations are pairs of <code>Lexing.position</code>, and the second one represents the end of the instruction. However Frama-C makes little effort to have an accurate information for this component, as it is never displayed</p></li>\n<li><p>if you are looking for the AST statements that exit the loop, look for those that are inside the loop, and whose successor (<code>.succs</code> field) are outside. This particular edge will correspond more or less to your <code>}</code>. In the loop of your example, you should find the <code>break</code> statement which is created to handle the exit condition.</p></li>\n</ul>\n"}], "owner": {"reputation": 79, "user_id": 7593365, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/23e98eb6b35fb1951cd7133e4dc91883?s=128&d=identicon&r=PG&f=1", "display_name": "R. Fomba", "link": "https://stackoverflow.com/users/7593365/r-fomba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 50280827, "answer_count": 2, "score": 1, "last_activity_date": 1525983050, "creation_date": 1525860760, "question_id": 50250814, "link": "https://stackoverflow.com/questions/50250814/frama-c-find-location-of-loop-end", "title": "Frama-C: find location of loop end", "body": "<p>In the following example code:</p>\n\n<pre><code>void kernel(int ni, int nj, int nk, float alpha, float *tmp, float *A, float *B) {\nint i, j, k;\n  for (i = 0; i &lt; ni; i++) {\n    for (j = 0; j &lt; nj; j++) {\n      tmp[i * nj + j] = 0.0f;\n      for (k = 0; k &lt; nk; ++k) {\n        tmp[i * nj + j] += alpha * A[i * nk + k] * B[k * nj + j];\n      }\n    }\n}\n}\n</code></pre>\n\n<p>I tried to get the location of <code>}</code> (which marks the end of each loop) without success. </p>\n\n<ul>\n<li>For example, for the first loop, I looked into <code>stmt.preds</code> list and found just <code>i = 0;</code> and <code>i++</code>. The <code>stmt.succs</code> list contain only the <code>if</code> test on <code>i &lt; ni</code>.</li>\n<li><code>}</code> do not corresponds to any kind of stmt or Instr and does not exist in <code>stmt.bstmts</code> list.</li>\n<li>Using functions in <code>Stmts_graph</code> like <code>get_all_stmt_last_stmts</code> (which give me a <code>break</code> statement and this <code>break</code> statement has the same location as the loop) don't solve the problem.</li>\n</ul>\n\n<p>How can I get the location of my loop end (here <code>}</code>). Thanks.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1525860616, "post_id": 50250738, "comment_id": 87518691, "body": "C or Javascript? The code you posted isn&#39;t C, yet you mention C in the title and tagged it with C."}, {"owner": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 2, "creation_date": 1525860868, "post_id": 50250738, "comment_id": 87518843, "body": "@AndrewHenle The code is an example (in Javascript) of the functionality the OP is describing, and wants to achieve in C. There&#39;s nothing wrong with that, I would hope."}, {"owner": {"reputation": 4593, "user_id": 105104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b23920ac852e946b333d3f9d0d95c1?s=128&d=identicon&r=PG", "display_name": "dvhh", "link": "https://stackoverflow.com/users/105104/dvhh"}, "edited": false, "score": 0, "creation_date": 1525860994, "post_id": 50250738, "comment_id": 87518906, "body": "Not in the form you describe, c does not have lamdba function like c++, although gcc does have nested functionality, I do not think it would work like you desire."}, {"owner": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "edited": false, "score": 0, "creation_date": 1525861131, "post_id": 50250738, "comment_id": 87518974, "body": "Are the values of the unchanging parameters known at compile time (as in your example), or are they runtime values?"}, {"owner": {"reputation": 1439, "user_id": 7396613, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ea7490a33ebc405a244013b37af249ec?s=128&d=identicon&r=PG&f=1", "display_name": "M.K", "link": "https://stackoverflow.com/users/7396613/m-k"}, "edited": false, "score": 0, "creation_date": 1525861192, "post_id": 50250738, "comment_id": 87519018, "body": "Why dont you do the calculations the 1st time, save those results if you know in advanced you are going to use them, and instead of calculate again. It is similar to fibonacci recursive somehow"}, {"owner": {"reputation": 705, "user_id": 2824661, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7c729d449a2941cd090ba3be630399db?s=128&d=identicon&r=PG", "display_name": "jugglingcats", "link": "https://stackoverflow.com/users/2824661/jugglingcats"}, "reply_to_user": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "edited": false, "score": 0, "creation_date": 1525862233, "post_id": 50250738, "comment_id": 87519677, "body": "@Angew, the unchanging parameters are not known at compile time. In our case they are parameters for a numeric solve."}, {"owner": {"reputation": 705, "user_id": 2824661, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7c729d449a2941cd090ba3be630399db?s=128&d=identicon&r=PG", "display_name": "jugglingcats", "link": "https://stackoverflow.com/users/2824661/jugglingcats"}, "reply_to_user": {"reputation": 4593, "user_id": 105104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b23920ac852e946b333d3f9d0d95c1?s=128&d=identicon&r=PG", "display_name": "dvhh", "link": "https://stackoverflow.com/users/105104/dvhh"}, "edited": false, "score": 0, "creation_date": 1525862279, "post_id": 50250738, "comment_id": 87519705, "body": "@dvhh, I am looking at nested functions in gcc but you are not supposed to return a nested function"}, {"owner": {"reputation": 705, "user_id": 2824661, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7c729d449a2941cd090ba3be630399db?s=128&d=identicon&r=PG", "display_name": "jugglingcats", "link": "https://stackoverflow.com/users/2824661/jugglingcats"}, "reply_to_user": {"reputation": 1439, "user_id": 7396613, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ea7490a33ebc405a244013b37af249ec?s=128&d=identicon&r=PG&f=1", "display_name": "M.K", "link": "https://stackoverflow.com/users/7396613/m-k"}, "edited": false, "score": 0, "creation_date": 1525862343, "post_id": 50250738, "comment_id": 87519744, "body": "@M.K that is a possibility but we are using many, many complex equations generated by Mathematica and to optimise by hand would be a big, error prone job"}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1525948820, "post_id": 50250738, "comment_id": 87559158, "body": "@jugglingcats: If these equations are on the reals (and you plan on using floating point math in C to approximate them); and since you are on Mathematica (which you can script); I would suggest optimizing them (fold the known constants and get the simplest exact representation) in Mathematica itself and then copying the resulting optimized (but <i>exact</i>) equations. Even more, it should be possible to get Mathematica to numerically approximate all the constants to a precision better than that <code>double</code> before copying them to the C code. [...]"}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1525949312, "post_id": 50250738, "comment_id": 87559428, "body": "[...] Even then, be very careful with the results; specially if you are aiming for performance and end up enabling &quot;unsafe&quot; floating point optimizations -- dealing with different optimizer decisions for different versions of the software when dealing with floating point issues can quickly become a nightmare. Aim to keep a pretty good battery of tests with known good results up to some defined precision you care about (possibly automatically generated from Mathematica)."}, {"owner": {"reputation": 705, "user_id": 2824661, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7c729d449a2941cd090ba3be630399db?s=128&d=identicon&r=PG", "display_name": "jugglingcats", "link": "https://stackoverflow.com/users/2824661/jugglingcats"}, "reply_to_user": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1525955694, "post_id": 50250738, "comment_id": 87562919, "body": "@Acorn, you comments are helpful thanks. I was starting to think along these lines where we take the Mathematica equations and replace parts of equations with values that can be pre-calculated (but still pre-calculated at runtime). You mention &quot;fold the known constants&quot;. Is there a function for this in Mathematica? I might post a question there...!"}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1525960465, "post_id": 50250738, "comment_id": 87565797, "body": "@jugglingcats: I am no expert on Mathematica, but applying <code>FullSimplify</code> after providing Mathematica with the proper constants/substitutions/assumptions should work. Then, for numeric approximations up to some precision, you can use <code>N</code>. There is also the topic about formulating the results as numerically stable expressions (for floating point math), etc."}], "answers": [{"comments": [{"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1525862407, "post_id": 50250960, "comment_id": 87519787, "body": "In most cases there is no need to use those non-standard attributes, since compilers can typically prove whether a function is pure/const. Normally, they are only used for cases where the compiler cannot prove it themselves (and the performance is critical)."}, {"owner": {"reputation": 352, "user_id": 3473433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa87ec32236bf2a31994b1067e633067?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioperez", "link": "https://stackoverflow.com/users/3473433/eugenioperez"}, "reply_to_user": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1525864846, "post_id": 50250960, "comment_id": 87521351, "body": "The key is <i>in most cases</i>. For example, if you do not enable lto, and function definition and usage are in different files, it can&#39;t be applied. Same if they are in a shared library. Putting these attributes in the function declaration can save you a few ops. As always, benchmark before apply performance changes!"}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1525889009, "post_id": 50250960, "comment_id": 87536897, "body": "If you are in a situation where marking functions pure/const is noticeable in your measurements, but you are not allowing IPOs, then you are already losing much more performance just by that. Instead of working on marking functions manually, start spending time on enabling LTO or unity builds, and you will gain more performance and avoid the extra work and maintenance burden of marking functions manually."}, {"owner": {"reputation": 352, "user_id": 3473433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa87ec32236bf2a31994b1067e633067?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioperez", "link": "https://stackoverflow.com/users/3473433/eugenioperez"}, "reply_to_user": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1525938120, "post_id": 50250960, "comment_id": 87553574, "body": "I agree with that point but, following that lead, we are getting farther from the original question, IMHO. There is a lot of circumstances that can&#39;t be solved with lto (shared libraries, for example), and we don&#39;t know what is the asker situation beyond that he wants to signal the compiler that the function is const/pure, overriding the better or worse guessing the compiler can do."}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1525948160, "post_id": 50250960, "comment_id": 87558802, "body": "Don&#39;t get me wrong, I agree that marking functions pure/const can help the optimizer a lot in a case like this (specially if the equations OP refers to are functions calling all one another). However, since OP is specifically mentioning that the concern is optimizations regarding calling the functions with a set of known parameters at compile-time, it seems that pureness is not the big deal here -- but rather folding the constants and inlining."}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1525949465, "post_id": 50250960, "comment_id": 87559508, "body": "Actually, your comment regarding the floating point math can be a big deal here -- since OP is talking about Mathematica in the comments of the question, there is a good chance the equations are indeed using reals. Thanks, I commented a bit on that there as well."}], "tags": [], "owner": {"reputation": 352, "user_id": 3473433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa87ec32236bf2a31994b1067e633067?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioperez", "link": "https://stackoverflow.com/users/3473433/eugenioperez"}, "is_accepted": false, "score": 1, "last_activity_date": 1525861536, "last_edit_date": 1525861536, "creation_date": 1525861177, "answer_id": 50250960, "question_id": 50250738, "link": "https://stackoverflow.com/questions/50250738/how-to-optimise-repeated-c-function-call-where-most-args-dont-change/50250960#50250960", "title": "How to optimise repeated C function call where most args don&#39;t change", "body": "<p>You can check the <code>pure</code> and <code>const</code> attributes in GCC (<a href=\"https://gcc.gnu.org/onlinedocs/gcc/Common-Function-Attributes.html#Common-Function-Attributes\" rel=\"nofollow noreferrer\">https://gcc.gnu.org/onlinedocs/gcc/Common-Function-Attributes.html#Common-Function-Attributes</a>). Also, I would check <code>__builtin_constant_p</code> in <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Other-Builtins.html\" rel=\"nofollow noreferrer\">https://gcc.gnu.org/onlinedocs/gcc/Other-Builtins.html</a>.</p>\n\n<p>Some of these attributes can be suggested by GCC using <code>-Wsuggest-attribute</code> warning.</p>\n\n<p>Take care because if you mark a function with that attributes, the compiler will assume that behavior and will not make questions: for example, if you say that a function is pure and it is not, the return value for given parameters will be reused no matter if the function is pure or not!</p>\n\n<p>Also, note that some of these optimizations will be done by the compiler even if you don't set that functions pure/const. The only way to truly know that compiler optimizations are, as far as I know, to look in the generated assembler.</p>\n\n<p>AS a side note, you can also check if you can apply -ffast-math, but be careful because the code behaves very differently. See <a href=\"https://gcc.gnu.org/wiki/FloatingPointMath\" rel=\"nofollow noreferrer\">https://gcc.gnu.org/wiki/FloatingPointMath</a></p>\n"}, {"tags": [], "owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "is_accepted": false, "score": 1, "last_activity_date": 1525862075, "last_edit_date": 1525862075, "creation_date": 1525861208, "answer_id": 50250969, "question_id": 50250738, "link": "https://stackoverflow.com/questions/50250738/how-to-optimise-repeated-c-function-call-where-most-args-dont-change/50250969#50250969", "title": "How to optimise repeated C function call where most args don&#39;t change", "body": "<blockquote>\n  <p>I'm wondering if there is a pattern in C that allows the compiler to optimise and avoid repeated calculations involving the unchanging args.</p>\n</blockquote>\n\n<p>In general, you do not need to change your code nor write anything special to achieve good performance in these cases. The reason is that optimizing compilers (including popular compilers for C) will perform <a href=\"https://en.wikipedia.org/wiki/Common_subexpression_elimination\" rel=\"nofollow noreferrer\">Common Subexpression Elimination</a> (CSE), <a href=\"https://en.wikipedia.org/wiki/Inline_expansion\" rel=\"nofollow noreferrer\">inlining</a>, <a href=\"https://en.wikipedia.org/wiki/Constant_folding\" rel=\"nofollow noreferrer\">constant propagation and folding</a>, <a href=\"https://en.wikipedia.org/wiki/Loop-invariant_code_motion\" rel=\"nofollow noreferrer\">hoisting</a> and other optimizations that are critical to achieve good performance for this typical scenario.</p>\n\n<p>In particular, calling a function with constant arguments is something that any reasonably good optimizer will handle just fine. They will also factor out of a loop whatever they can prove does not change between iterations.</p>\n\n<p>Of course, the compiler needs to have all the require information available (e.g. in the same translation unit or by taking advantage of <a href=\"https://en.wikipedia.org/wiki/Interprocedural_optimization\" rel=\"nofollow noreferrer\">WPO/LTO</a>) and you need to avoid anything that prevents optimizations to take place.</p>\n\n<p>In general, try to keep your code as simple as possible and take a look at the assembly or intermediate outputs of your compiler to be sure that things were able to be optimized properly.</p>\n\n<p>If, nevertheless, you notice that your compiler is not being able to optimize what you would expect it should be able to, analyze why and try to remove whatever is preventing the optimization. In the worst case, you will have to change your code to do it yourself; but don't embark on a quest of reorganizing your code without proper information beforehand. This is similar as the general principle as avoiding optimizations without profiling first.</p>\n"}, {"tags": [], "owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "is_accepted": false, "score": 1, "last_activity_date": 1525861415, "creation_date": 1525861415, "answer_id": 50251048, "question_id": 50250738, "link": "https://stackoverflow.com/questions/50250738/how-to-optimise-repeated-c-function-call-where-most-args-dont-change/50251048#50251048", "title": "How to optimise repeated C function call where most args don&#39;t change", "body": "<p>The normal C way would be to split the dynamic and static part:</p>\n\n<pre><code>int f1(int s1, int s2, int s3) {\n    return (s1 * s1 + s2 / s3 - s1 / s3);\n}\n\nint f2(int s, int dyn) {\n    return s * dyn;\n}\n\nint s = f1(5, 7, 9);\nfor(int n=0; n&lt;100000; n++) {\n    int r = f2(s, n);\n    ...\n}\n</code></pre>\n\n<p>If you have to do same operations on multiple functions, meta-programming through macros may come handy.</p>\n"}], "owner": {"reputation": 705, "user_id": 2824661, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7c729d449a2941cd090ba3be630399db?s=128&d=identicon&r=PG", "display_name": "jugglingcats", "link": "https://stackoverflow.com/users/2824661/jugglingcats"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1525862075, "creation_date": 1525860545, "question_id": 50250738, "link": "https://stackoverflow.com/questions/50250738/how-to-optimise-repeated-c-function-call-where-most-args-dont-change", "title": "How to optimise repeated C function call where most args don&#39;t change", "body": "<p>We have a function that will be called many 1000s of times. Between each invocation most of the arguments won't change, and we know in advance which will/won't change.</p>\n\n<p>I'm wondering if there is a pattern in C that allows the compiler to optimise and avoid repeated calculations involving the unchanging args. It's somewhat related to closures. The pattern in Javascript would be expressed as:</p>\n\n<pre><code>function factory(s1, s2, s3) {\n  return function(dyn1) {\n    // first part of this can be pre-calculated\n    return (s1 * s1 + s2 / s3 - s1 / s3) * dyn1;\n  }\n}\n\nconst fn=factory(5, 7, 9);\nfor ( let n=0; n&lt; 100000; n++ ) {\n  const r=fn(n);\n}\n</code></pre>\n\n<p>Note: I am not claiming that a Javascript interpreter will optimise this, but hopefully the above demonstrates the scenario and potential for optimisation.</p>\n\n<p>In practice we have 100's of equations each with complex maths expressions involving 10+ vars and 20+ operations. To optimise by hand would be painful!</p>\n\n<p>Interested to know if there is a good way to approach this.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["c", "ssl", "openssl", "libressl", "session-cache"], "answers": [{"tags": [], "owner": {"reputation": 3794, "user_id": 7256714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adeb98b0e8995d8576ad5f66c0f982e5?s=128&d=identicon&r=PG&f=1", "display_name": "Pras", "link": "https://stackoverflow.com/users/7256714/pras"}, "is_accepted": false, "score": 0, "last_activity_date": 1525862199, "creation_date": 1525862199, "answer_id": 50251319, "question_id": 50250491, "link": "https://stackoverflow.com/questions/50250491/does-cached-ssl-session-hold-previous-x-509-certificate-info/50251319#50251319", "title": "Does cached SSL session hold previous X.509 certificate info?", "body": "<p>If you see openssl code you will find this comment, in declaration of <code>SSL_SESSION</code>, it says:</p>\n\n<pre><code>/* This is the cert for the other end.\n * On clients, it will be the same as sess_cert-&gt;peer_key-&gt;x509\n * (the latter is not enough as sess_cert is not retained\n * in the external representation of sessions, see ssl_asn1.c). */\nX509 *peer;\n</code></pre>\n\n<p>I would assume it indicates for clients, peer certificate is not retained when converted to external representation ie when  SSL_SESSION is serialised peer certificated will be lost</p>\n"}], "owner": {"reputation": 1173, "user_id": 380676, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb3c5698806b37924982969f6acedf7?s=128&d=identicon&r=PG", "display_name": "Chul-Woong Yang", "link": "https://stackoverflow.com/users/380676/chul-woong-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1525862199, "creation_date": 1525859814, "last_edit_date": 1525860154, "question_id": 50250491, "link": "https://stackoverflow.com/questions/50250491/does-cached-ssl-session-hold-previous-x-509-certificate-info", "title": "Does cached SSL session hold previous X.509 certificate info?", "body": "<p>When we re-use previously saved <code>SSL_SESSION</code>,\ndoes the reused SSL session have orignal X.509 peer certificate?</p>\n\n<p>My code crashes very infrequently and investigation showed that\nthe SSL session is reused and the some fields of peer cert(<code>certinfo-&gt;key-&gt;pkey</code>) are messed up.</p>\n\n<ul>\n<li><p>1st Handshake from CLT to SVR.</p>\n\n<p>SVR sends X.509 certificate to CLT and CLT stores the cert.\nWe can get the cert using <code>SSL_get_peer_certificate()</code>.\nCLT saves the <code>SSL_SESSION</code> with <code>SSL_get1_session()</code>.</p></li>\n<li><p>2nd Handshake from CLT to SVR.</p>\n\n<p>This time CLT offers saved <code>SSL_SESSION</code> with <code>SSL_set_session()</code>\nand abbreviated handshake occured.\nWhen CLT calls <code>SSL_get_peer_certificate()</code>, can CLT get the original \nX.509 cert?</p></li>\n</ul>\n\n<p>It seems that coupling with <code>SSL_SESSION</code> and included peer X.509 cert is loose. Should we save X.509 peer cert with upping refcnt explicitly, in addition to calling <code>SSL_get1_session</code> just, to properly use <code>SSL_get_peer_certificate()</code> on reused <code>SSL_SESSION</code>?</p>\n\n<p>I use LibreSSL and OpenSSL on Linux.</p>\n\n<p>Any comments would be appreciated deeply.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "edited": false, "score": 2, "creation_date": 1525859841, "post_id": 50250450, "comment_id": 87518144, "body": "Maybe <a href=\"https://stackoverflow.com/questions/2693776/removing-trailing-newline-character-from-fgets-input\">this will help you</a>. check the bounty-awarded answer."}, {"owner": {"reputation": 4593, "user_id": 105104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b23920ac852e946b333d3f9d0d95c1?s=128&d=identicon&r=PG", "display_name": "dvhh", "link": "https://stackoverflow.com/users/105104/dvhh"}, "edited": false, "score": 1, "creation_date": 1525859850, "post_id": 50250450, "comment_id": 87518155, "body": "unfortunately there is little way to cover all the unknow exotic OS ( those designed by some obscur raving maniac ). You should probably only limit your scope to well established OS first."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 3, "creation_date": 1525860131, "post_id": 50250450, "comment_id": 87518360, "body": "<i>Is there any other character added by any other OS? We need to handle that.</i>  Why?  The C standard has a clearly-defined &quot;text&quot; mode for streams that translates all newlines into <code>\\n</code> characters,"}, {"owner": {"reputation": 546, "user_id": 9721071, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u043c\u0430\u043b\u0438\u043d \u0447\u0435\u043a\u0443\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/9721071/%d0%bc%d0%b0%d0%bb%d0%b8%d0%bd-%d1%87%d0%b5%d0%ba%d1%83%d1%80%d0%be%d0%b2"}, "edited": false, "score": 0, "creation_date": 1525860255, "post_id": 50250450, "comment_id": 87518432, "body": "Your problem is that you are reading it as a binary file. If you read or write it as text file then you don&#39;t care how the OS interprets the &#39;\\n&#39;."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1525860340, "post_id": 50250450, "comment_id": 87518505, "body": "And good luck replacing the OS-supplied record (line) boundaries with NULs on a <a href=\"https://www.ibm.com/support/knowledgecenter/zosbasics/com.ibm.zos.zconcepts/zconcepts_159.htm\" rel=\"nofollow noreferrer\"><code>RECFM=VB</code> dataset on IBM&#39;s MVS/OS</a>."}, {"owner": {"reputation": 7, "user_id": 9763904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8a930e1d0ca7f7aed48d752c3109536?s=128&d=identicon&r=PG&f=1", "display_name": "Sateesh", "link": "https://stackoverflow.com/users/9763904/sateesh"}, "edited": false, "score": 0, "creation_date": 1525865805, "post_id": 50250450, "comment_id": 87522015, "body": "hi i updated code to read ytext mode but problem does not go"}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "edited": false, "score": 0, "creation_date": 1525865921, "post_id": 50250450, "comment_id": 87522109, "body": "The so-called &quot;universal newline&quot; set (see e.g. the Wikipedia article on <a href=\"https://en.wikipedia.org/wiki/Newline\" rel=\"nofollow noreferrer\">newlines</a>) is pretty much <code>\\r\\n</code>, <code>\\n\\r</code>, <code>\\r</code>, and <code>\\n</code>. The others use non-ASCII/UTF-8 -compatible character sets, and will have to be converted anyway."}], "answers": [{"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525866771, "post_id": 50252414, "comment_id": 87522602, "body": "Any reason why you can&#39;t simply do <code>bool new_line = false;  if(isspace(ch)) {   while(ch == &#39;\\n&#39; || ch == &#39;\\r&#39;)   {     new_line = true;     ch = fgetc(in);   } }</code> ?"}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525869370, "post_id": 50252414, "comment_id": 87524317, "body": "@Lundin: That would skip (consume) empty lines, too."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525869787, "post_id": 50252414, "comment_id": 87524628, "body": "Not if you check the provided bool variable."}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525876532, "post_id": 50252414, "comment_id": 87529652, "body": "@Lundin: The loop <code>while (ch==&#39;\\n&#39; || ch==&#39;\\r&#39;) { new_line=true; ch=fgetc(in); }</code> most definitely consumes empty lines. That is why I didn&#39;t use it. As written, the code in my answer works fine even with line-buffered interactive input, and does not skip empty lines. It&#39;s only downside is that it consumes the newlines without telling the caller exactly what kind of newline there was."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1530116731, "post_id": 50252414, "comment_id": 89124807, "body": "&quot;function works much like ... getline()&quot; has additional differences: It can set <code>errno = 0</code> - most unexpected.  It leaves the end-of-line character in the stream.  It returns -1 if the last line is an empty line."}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1530118175, "post_id": 50252414, "comment_id": 89125532, "body": "@chux: I added explicit mentions of <code>errno</code> and newline character behaviour. However, it does not return -1 if the last line is empty, unless the entire stream was empty. (When you read a line, the newline is left in the stream. The next call consumes it. If there is no further data, the previous line was the last line in the file. If there is data but no newline, this call will return the data, and next call -1. If there is data and a newline, this call will return the data, next call will consume the newline and return -1.)"}, {"owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "edited": false, "score": 0, "creation_date": 1530118239, "post_id": 50252414, "comment_id": 89125566, "body": "The weird newline behaviour is necessary for handling universal newlines but still treat line-buffered interactive input sanely."}], "tags": [], "owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "is_accepted": false, "score": 0, "last_activity_date": 1530117574, "last_edit_date": 1530117574, "creation_date": 1525865735, "answer_id": 50252414, "question_id": 50250450, "link": "https://stackoverflow.com/questions/50250450/what-are-the-possible-new-line-characters-in-different-os/50252414#50252414", "title": "what are the possible new line characters in different OS", "body": "<p>There are three relatively common newline conventions: <code>\\r\\n</code>, <code>\\n</code>, and <code>\\r</code>, and a fourth one that can occur when an editor gets confused about the newline convention, <code>\\n\\r</code>.  If an approach supports <em>universal newlines</em>, it supports all four simultaneously, even if fixed.</p>\n\n<p>Reading files line by line with universal newline support is easy. The only problem is that interactive input from line-buffered sources looks like it is read one line late. To avoid that, one can read lines into a dynamic buffer up to, but not including the newline; and consume the newline when reading the next line. For example:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;stdio.h&gt;\n\nssize_t  getline_universal(char **dataptr, size_t *sizeptr, FILE *in)\n{\n    char   *data = NULL;\n    size_t  size = 0;\n    size_t  used = 0;\n    int     c;\n\n    if (!dataptr || !sizeptr || !in) {\n        errno = EINVAL;\n        return -1;\n    }\n\n    if (*sizeptr) {\n        data = *dataptr;\n        size = *sizeptr;\n    } else {\n        *dataptr = data;\n        *sizeptr = size;\n    }\n\n    /* Ensure there are at least 2 chars available. */\n    if (size &lt; 2) {\n        size = 2;\n        data = malloc(size);\n        if (!data) {\n            errno = ENOMEM;\n            return -1;\n        }\n        *dataptr = data;\n        *sizeptr = size;\n    }\n\n    /* Consume leading newline. */\n    c = fgetc(in);\n    if (c == '\\n') {\n        c = fgetc(in);\n        if (c == '\\r')\n            c = fgetc(in);\n    } else\n    if (c == '\\r') {\n        c = fgetc(in);\n        if (c == '\\n')\n            c = fgetc(in);\n    }\n\n    /* No more data? */\n    if (c == EOF) {\n        data[used] = '\\0';\n        errno = 0;\n        return -1;\n    }\n\n    while (c != '\\n' &amp;&amp; c != '\\r' &amp;&amp; c != EOF) {\n\n        if (used + 1 &gt;= size) {\n            if (used &lt; 7)\n                size = 8;\n            else\n            if (used &lt; 1048576)\n                size = (3 * used) / 2;\n            else\n                size = (used | 1048575) + 1048577;\n\n            data = realloc(data, size);\n            if (!data) {\n                errno = ENOMEM;\n                return -1;\n            }\n\n            *dataptr = data;\n            *sizeptr = size;\n        }\n\n        data[used++] = c;\n        c = fgetc(in);\n    }\n\n    /* Terminate line. We know used &lt; size. */\n    data[used] = '\\0';\n\n    /* Do not consume the newline separator. */\n    if (c != EOF)\n        ungetc(c, in);\n\n    /* Done. */\n    errno = 0;\n    return used;\n}\n</code></pre>\n\n<p>The above function works much like POSIX.1-2008 <a href=\"http://man7.org/linux/man-pages/man3/getline.3.html\" rel=\"nofollow noreferrer\"><code>getline()</code></a>, except that it supports all four newline conventions (even mixed), and that it omits the newline from the line read. (That is, the newline is not included in either the return value or the dynamically allocated buffer. The newline is left in the stream, and consumed by the next <code>getline_universal()</code> operation.)</p>\n\n<p>Unlike standard functions, <code>getline_universal()</code> always sets <code>errno</code>: to zero if successful, and nonzero otherwise.  If you don't like the behaviour, feel free to change that.</p>\n\n<p>As an use case example:</p>\n\n<pre><code>int main(void)\n{\n    unsigned long  linenum = 0u;\n    char          *line_buf = NULL;\n    size_t         line_max = 0;\n    ssize_t        line_len;\n\n    while (1) {\n        line_len = getline_universal(&amp;line_buf, &amp;line_max, stdin);\n        if (line_len &lt; 0)\n            break;\n\n        linenum++;\n\n        printf(\"%lu: \\\"%s\\\" (%zd chars)\\n\", linenum, line_buf, line_len);\n        fflush(stdout);\n    }\n\n    if (errno) {\n        fprintf(stderr, \"Error reading from standard input: %s.\\n\", strerror(errno));\n        return EXIT_FAILURE;\n    }\n\n    /* Not necessary before exiting, but here's how to\n       safely discard the line buffer: */\n    free(line_buf);\n    line_buf = NULL;\n    line_max = 0;\n    line_len = 0;\n\n    return EXIT_SUCCESS;\n}\n</code></pre>\n\n<p>Note that because <code>free(NULL)</code> is safe, you can discard the buffer (using <code>free(line_buf); line_buf = NULL; line_max = 0;</code>) before any call to <code>getline_universal(&amp;line_buf, &amp;line_max, stream)</code>.</p>\n"}], "owner": {"reputation": 7, "user_id": 9763904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8a930e1d0ca7f7aed48d752c3109536?s=128&d=identicon&r=PG&f=1", "display_name": "Sateesh", "link": "https://stackoverflow.com/users/9763904/sateesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 216, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1530117574, "creation_date": 1525859656, "last_edit_date": 1525868599, "question_id": 50250450, "link": "https://stackoverflow.com/questions/50250450/what-are-the-possible-new-line-characters-in-different-os", "title": "what are the possible new line characters in different OS", "body": "<p>We have a code that reads files line by line and each line is stored as a string. The problem is that Linux adds '\\n' at the end of line; windows adds '\\r\\n' and ios adds '\\r'at the end of the line. We want to replace all these special characters by '\\0' so that we get our string.</p>\n\n<p>Is there any other character added by any other OS? We need to handle that.</p>\n\n<p>In response to comments below, i tried using text file mode</p>\n\n<pre><code>file = fopen ( filename, \"rt\" );\nwhile(fgets ( buf, sizeof buf, buf ) != NULL)\n{\n    (*properties)-&gt;url= (char *) malloc(strlen(buf)+1);\n    strcpy( (*properties)-&gt;url, buf);\n/////...................more code\n\n}\n\n//line x--&gt;\nstrncpy(url,properties-&gt;url,strlen(properties-&gt;url));\n</code></pre>\n\n<p>at line x, gdb prints\n\"<a href=\"https://example.com/file\" rel=\"nofollow noreferrer\">https://example.com/file</a>\\r\\n\\0\" for properties->url</p>\n\n<p>where my url is \"<a href=\"https://example.com/file\" rel=\"nofollow noreferrer\">https://example.com/file</a>\"</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 1, "creation_date": 1525858777, "post_id": 50249998, "comment_id": 87517475, "body": "Run the code in a debugger if you don\u2019t see the problem. Go line by line. See what it does. Also please indent code properly always, it helps seeing things better. Think about the code. When can you get to the printf clause?"}, {"owner": {"reputation": 11, "user_id": 9274835, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-StixgcO26bA/AAAAAAAAAAI/AAAAAAAAAEw/IcqDvU2CiRY/photo.jpg?sz=128", "display_name": "Rishi Srivastava", "link": "https://stackoverflow.com/users/9274835/rishi-srivastava"}, "reply_to_user": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 0, "creation_date": 1525858913, "post_id": 50249998, "comment_id": 87517578, "body": "means ? what should i do. i am new in programming . please teach me sir."}, {"owner": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 0, "creation_date": 1525858969, "post_id": 50249998, "comment_id": 87517611, "body": "Start your debugger. Click on a button that takes you to debug mode. Step forward. Continue stepping and see what your code does."}, {"owner": {"reputation": 11, "user_id": 9274835, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-StixgcO26bA/AAAAAAAAAAI/AAAAAAAAAEw/IcqDvU2CiRY/photo.jpg?sz=128", "display_name": "Rishi Srivastava", "link": "https://stackoverflow.com/users/9274835/rishi-srivastava"}, "reply_to_user": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 0, "creation_date": 1525859060, "post_id": 50249998, "comment_id": 87517662, "body": "i am using ubuntu . how to stART  debugger"}, {"owner": {"reputation": 546, "user_id": 9721071, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u043c\u0430\u043b\u0438\u043d \u0447\u0435\u043a\u0443\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/9721071/%d0%bc%d0%b0%d0%bb%d0%b8%d0%bd-%d1%87%d0%b5%d0%ba%d1%83%d1%80%d0%be%d0%b2"}, "edited": false, "score": 0, "creation_date": 1525859729, "post_id": 50249998, "comment_id": 87518071, "body": "You might want to read this introduction tutorial to GCC and how to use the debugger <a href=\"http://www.network-theory.co.uk/docs/gccintro/\" rel=\"nofollow noreferrer\">network-theory.co.uk/docs/gccintro</a>. In two minutes you will know how to debug your program with the debugger."}], "answers": [{"comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1525861484, "post_id": 50250575, "comment_id": 87519225, "body": "This code is naughty: no error check on <code>scanf</code>, running <code>i</code> to <code>n</code>, prefer <code>if (n % i)</code>?"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "reply_to_user": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1525861578, "post_id": 50250575, "comment_id": 87519284, "body": "@Bathsheba - hair splitting - the question is not about the sprintf. it is only the slightly modified OPs code"}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 1, "creation_date": 1525861606, "post_id": 50250575, "comment_id": 87519297, "body": "I disagree. Not checking the return value of <code>scanf</code> is reprehensible."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "reply_to_user": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1525861693, "post_id": 50250575, "comment_id": 87519339, "body": "@Bathsheba I disagree. If you disagree - write your own answer"}], "tags": [], "owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "is_accepted": false, "score": 2, "last_activity_date": 1525861346, "last_edit_date": 1525861346, "creation_date": 1525860039, "answer_id": 50250575, "question_id": 50249998, "link": "https://stackoverflow.com/questions/50249998/unable-to-find-prime-number-using-continue-control-flow/50250575#50250575", "title": "unable to find Prime number using Continue control flow", "body": "<p>Can you spot the difference? </p>\n\n<pre><code>int main(void)\n{\n  int n,i;\n  scanf(\"%d\",&amp;n);\n  for(i=2;i&lt;n;i++)\n  {\n    if(n%i!=0)\n    {\n      continue;\n    }\n    else\n    {\n      printf(\"not prime\\n\");\n      return 0;\n    }\n  }\nprintf(\"prime\\n\");\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9274835, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-StixgcO26bA/AAAAAAAAAAI/AAAAAAAAAEw/IcqDvU2CiRY/photo.jpg?sz=128", "display_name": "Rishi Srivastava", "link": "https://stackoverflow.com/users/9274835/rishi-srivastava"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 26, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525861346, "creation_date": 1525858338, "last_edit_date": 1525858879, "question_id": 50249998, "link": "https://stackoverflow.com/questions/50249998/unable-to-find-prime-number-using-continue-control-flow", "title": "unable to find Prime number using Continue control flow", "body": "<p>i wrote continue which brings back control to iteration and until the remainder is not zero so output should be printed. but it is not . why ? </p>\n\n<pre><code>#include&lt;stdio.h&gt;\n\nmain()\n{\n  int n,i;\n  scanf(\"%d\",&amp;n);\n  for(i=2;i&lt;n;i++)\n  {\n    if(n%i!=0)\n    {\n      continue;\n      printf(\"prime\\n\");\n    }\n  }\n}\n</code></pre>\n"}, {"tags": ["c", "list"], "comments": [{"owner": {"reputation": 546, "user_id": 9721071, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u043c\u0430\u043b\u0438\u043d \u0447\u0435\u043a\u0443\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/9721071/%d0%bc%d0%b0%d0%bb%d0%b8%d0%bd-%d1%87%d0%b5%d0%ba%d1%83%d1%80%d0%be%d0%b2"}, "edited": false, "score": 0, "creation_date": 1525857872, "post_id": 50249765, "comment_id": 87516915, "body": "By first Node you mean the first Node that was added to the list or the last? (because if you are adding to the end, then the first added Node will actually be the last when traversing the list)"}, {"owner": {"reputation": 1648, "user_id": 4620387, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/8e3a06c1e1f8e1b1b4e3c8a6651be2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Sam12", "link": "https://stackoverflow.com/users/4620387/sam12"}, "reply_to_user": {"reputation": 546, "user_id": 9721071, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u043c\u0430\u043b\u0438\u043d \u0447\u0435\u043a\u0443\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/9721071/%d0%bc%d0%b0%d0%bb%d0%b8%d0%bd-%d1%87%d0%b5%d0%ba%d1%83%d1%80%d0%be%d0%b2"}, "edited": false, "score": 0, "creation_date": 1525858241, "post_id": 50249765, "comment_id": 87517154, "body": "The first one added to the list"}, {"owner": {"reputation": 2788, "user_id": 1673320, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/0s6YJ.jpg?s=128&g=1", "display_name": "itachi", "link": "https://stackoverflow.com/users/1673320/itachi"}, "edited": false, "score": 1, "creation_date": 1525858466, "post_id": 50249765, "comment_id": 87517288, "body": "If you are going to implement a typical singly linked list, your should store your&#39;s list head somewhere (assuming your list list grows towards the tail). You can also store the tail so you don&#39;t have to iterate over the whole list every time you want to delete something from the end."}, {"owner": {"reputation": 1648, "user_id": 4620387, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/8e3a06c1e1f8e1b1b4e3c8a6651be2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Sam12", "link": "https://stackoverflow.com/users/4620387/sam12"}, "edited": false, "score": 0, "creation_date": 1525858693, "post_id": 50249765, "comment_id": 87517434, "body": "How can I store the head in the struct?"}, {"owner": {"reputation": 546, "user_id": 9721071, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u043c\u0430\u043b\u0438\u043d \u0447\u0435\u043a\u0443\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/9721071/%d0%bc%d0%b0%d0%bb%d0%b8%d0%bd-%d1%87%d0%b5%d0%ba%d1%83%d1%80%d0%be%d0%b2"}, "edited": false, "score": 1, "creation_date": 1525858859, "post_id": 50249765, "comment_id": 87517543, "body": "You have a pointer variable somewhere that points to the head of the list(this pointer is not part of the structure itself)."}, {"owner": {"reputation": 1648, "user_id": 4620387, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/8e3a06c1e1f8e1b1b4e3c8a6651be2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Sam12", "link": "https://stackoverflow.com/users/4620387/sam12"}, "edited": false, "score": 0, "creation_date": 1525858931, "post_id": 50249765, "comment_id": 87517594, "body": "So how do I do the function getFirst? which is in the structure itself."}, {"owner": {"reputation": 546, "user_id": 9721071, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u043c\u0430\u043b\u0438\u043d \u0447\u0435\u043a\u0443\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/9721071/%d0%bc%d0%b0%d0%bb%d0%b8%d0%bd-%d1%87%d0%b5%d0%ba%d1%83%d1%80%d0%be%d0%b2"}, "edited": false, "score": 1, "creation_date": 1525859054, "post_id": 50249765, "comment_id": 87517658, "body": "If Itachi&#39;s comment didn&#39;t help you at all, then I suggest you to read more on how to implement linked lists in C. We could give you an example implementation, but that&#39;s not the point."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 1, "creation_date": 1525859353, "post_id": 50249765, "comment_id": 87517852, "body": "Not directly related, but hiding pointer types with typedefs is a bad idea, I suppose you have a <code>typedef struct Map_t *Map;</code> somewhere. <code>struct Map_t *next;</code> instead <code>Map next;</code> would me so much clearer."}, {"owner": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "edited": false, "score": 1, "creation_date": 1525859693, "post_id": 50249765, "comment_id": 87518045, "body": "Your question is not very comprehensible. What do you mean by return the first node in the list? The first node in the list is the one pointed to by the head. Why is that difficult to return, and why would you even be asked to return it?!"}], "answers": [{"tags": [], "owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "is_accepted": false, "score": 0, "last_activity_date": 1525860265, "creation_date": 1525860265, "answer_id": 50250651, "question_id": 50249765, "link": "https://stackoverflow.com/questions/50249765/returning-the-first-node-in-a-list/50250651#50250651", "title": "Returning the first node in a list", "body": "<p>You provide very little information.</p>\n\n<p>I guess you need something like this:</p>\n\n<pre><code>struct List\n{\n  struct Map_t *head;\n  struct Map_t *tail;\n};\n\nstruct Map_t {\n  struct Map_t *next;\n  MapDataElement currentData;\n  MapKeyElement currentKey;\n};\n\n// Initialize list for first use\nvoid InitializeList(struct List *l)\n{\n  l-&gt;head = l-&gt;tail = NULL;\n}\n\n// add new data/key pair to list\nvoid AddToList(struct List *l, MapDataElement data, MapKeyElement key)\n{\n  struct Map_t *newnode = malloc(sizeof(*newnode));\n  newnode-&gt;currentData = data;\n  newnode-&gt;currentKey = key;\n  newnode-&gt;next = NULL;\n\n  if (l-&gt;head == NULL)\n  {\n    // special case when list is empty\n    l-&gt;head = l-&gt;tail = newnode;\n  }\n  else\n  {\n    // list is non empty\n    l-&gt;tail-&gt;next = newnode;  // append new node to tail\n    l-&gt;tail = newnode;        // tail becomes newnode\n  }\n}\n\n\nint main()\n{\n  struct List mylist;         // your list\n                              // the head of the list is stored permanently\n                              // in mylist.head\n  InitializeList(&amp;mylist);\n\n  MapDataElement data = ...;  // get data from somewhere\n  MapKeyElement key = ...;    // get key from somewhere\n  AddToList(&amp;mylist, data, key);\n  ...\n}\n</code></pre>\n\n<p>As already stated in a comment: the head of the list is stored permanently <code>mylist.head</code>.</p>\n\n<p>Disclaimer: this is untested and incomplete code. No error checking is done for brevity.</p>\n"}], "owner": {"reputation": 1648, "user_id": 4620387, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/8e3a06c1e1f8e1b1b4e3c8a6651be2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Sam12", "link": "https://stackoverflow.com/users/4620387/sam12"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525860265, "creation_date": 1525857596, "question_id": 50249765, "link": "https://stackoverflow.com/questions/50249765/returning-the-first-node-in-a-list", "title": "Returning the first node in a list", "body": "<p>I'm asked to return the first Node in a list, in a given generic struct, but I'm having trouble to figure out the most efficient way to do so.</p>\n\n<p>Is doing a previous pointer (besides next) is the only way?</p>\n\n<pre><code>struct Map_t {\n    Map next;\n    MapDataElement currentData;\n    MapKeyElement currentKey;\n};\n</code></pre>\n"}, {"tags": ["c", "compiler-errors", "contiki", "cooja"], "comments": [{"owner": {"reputation": 18942, "user_id": 894328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3db17c5296335f63e856be44aa821bf6?s=128&d=identicon&r=PG", "display_name": "Ahmed Masud", "link": "https://stackoverflow.com/users/894328/ahmed-masud"}, "edited": false, "score": 0, "creation_date": 1525854826, "post_id": 50248614, "comment_id": 87515037, "body": "you&#39;re missing the <code>main</code> if it&#39;s a program, or another function if you&#39;re supposed to just create a function.  I think you should study C programming before attempting this."}, {"owner": {"reputation": 33, "user_id": 8599960, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BOGTg.png?s=128&g=1", "display_name": "WeinoJay", "link": "https://stackoverflow.com/users/8599960/weinojay"}, "reply_to_user": {"reputation": 18942, "user_id": 894328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3db17c5296335f63e856be44aa821bf6?s=128&d=identicon&r=PG", "display_name": "Ahmed Masud", "link": "https://stackoverflow.com/users/894328/ahmed-masud"}, "edited": false, "score": 0, "creation_date": 1525855627, "post_id": 50248614, "comment_id": 87515502, "body": "I did some programs before at school on Instant-Contiki too and I had not to put the     main function and I didn&#39;t get any errors..."}, {"owner": {"reputation": 18942, "user_id": 894328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3db17c5296335f63e856be44aa821bf6?s=128&d=identicon&r=PG", "display_name": "Ahmed Masud", "link": "https://stackoverflow.com/users/894328/ahmed-masud"}, "edited": false, "score": 0, "creation_date": 1525980475, "post_id": 50248614, "comment_id": 87576934, "body": "okay then there is something incorrect about your Makefile"}, {"owner": {"reputation": 33, "user_id": 8599960, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BOGTg.png?s=128&g=1", "display_name": "WeinoJay", "link": "https://stackoverflow.com/users/8599960/weinojay"}, "reply_to_user": {"reputation": 18942, "user_id": 894328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3db17c5296335f63e856be44aa821bf6?s=128&d=identicon&r=PG", "display_name": "Ahmed Masud", "link": "https://stackoverflow.com/users/894328/ahmed-masud"}, "edited": false, "score": 0, "creation_date": 1526022950, "post_id": 50248614, "comment_id": 87589894, "body": "Hi, I figured out days ago, please look the answer I gave to @Fabrice Derepas. Thanks !"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 8599960, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BOGTg.png?s=128&g=1", "display_name": "WeinoJay", "link": "https://stackoverflow.com/users/8599960/weinojay"}, "edited": false, "score": 0, "creation_date": 1525856405, "post_id": 50248851, "comment_id": 87515994, "body": "Ok, but even when I put the <code>main()</code> declaration I get some errors."}, {"owner": {"reputation": 33, "user_id": 8599960, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BOGTg.png?s=128&g=1", "display_name": "WeinoJay", "link": "https://stackoverflow.com/users/8599960/weinojay"}, "edited": false, "score": 0, "creation_date": 1525856891, "post_id": 50248851, "comment_id": 87516284, "body": "The two first line are the same but others appeared like : <code>code.c: In function &#39;process_thread_blink_LED&#39;:   code.c:22:12: error: &#39;main&#39; is normally a non-static function  code.c: In function &#39;main&#39;:  code.c:26:17: error: case label not within a switch statement  cc1: all warnings treated as errors </code>"}, {"owner": {"reputation": 33, "user_id": 8599960, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BOGTg.png?s=128&g=1", "display_name": "WeinoJay", "link": "https://stackoverflow.com/users/8599960/weinojay"}, "edited": false, "score": 0, "creation_date": 1525857439, "post_id": 50248851, "comment_id": 87516619, "body": "Sorry for the edit, it&#39;s only possible to edit for 5 min and it&#39;s impossible for me to copy the errors from Cooja compiler so I have to write them."}, {"owner": {"reputation": 33, "user_id": 8599960, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BOGTg.png?s=128&g=1", "display_name": "WeinoJay", "link": "https://stackoverflow.com/users/8599960/weinojay"}, "edited": false, "score": 0, "creation_date": 1525858877, "post_id": 50248851, "comment_id": 87517552, "body": "I figured out how to do. Just need to put the <code>etimer_set(&amp;et, PERIOD);</code> line before the <code>while(1)</code> loop and also include <code>#include &quot;sys&#47;etimer.h&quot;</code>. Thanks!"}], "tags": [], "owner": {"reputation": 87, "user_id": 9557323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7b5f2162e8f969ce9d2e7a75f995e6d?s=128&d=identicon&r=PG&f=1", "display_name": "Fabrice Derepas", "link": "https://stackoverflow.com/users/9557323/fabrice-derepas"}, "is_accepted": false, "score": 0, "last_activity_date": 1525854728, "creation_date": 1525854728, "answer_id": 50248851, "question_id": 50248614, "link": "https://stackoverflow.com/questions/50248614/cooja-expected-declaraton-specifiers-in-c/50248851#50248851", "title": "Cooja - Expected declaraton specifiers in C", "body": "<p>The instruction <code>etimer_set(&amp;et, PERIOD);</code> calls the function <code>etimer_set</code>. The compiler complains because it expects a declaration. You can not directly invoque an instruction like the one you wrote. For instance here is the declaration of function <code>main</code> calling <code>etimer_set</code>:</p>\n\n<pre><code>int main () {\n  etimer_set(&amp;et, PERIOD);\n  return 0;*\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 8599960, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BOGTg.png?s=128&g=1", "display_name": "WeinoJay", "link": "https://stackoverflow.com/users/8599960/weinojay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 123, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1525854728, "creation_date": 1525853852, "question_id": 50248614, "link": "https://stackoverflow.com/questions/50248614/cooja-expected-declaraton-specifiers-in-c", "title": "Cooja - Expected declaraton specifiers in C", "body": "<p>I'm currently working on project based on Contiki-NG and Cooja and I'm trying to implement my C code on the Sky mote in the network simulator Cooja but I got the following error : </p>\n\n<pre><code>code.c:5:12: error: expected declaration specifiers or '...' before '&amp;' token\ncode.c:5:17: error: expected declaration specifiers or '...' before numeric constant\n../../Makefile.include:347:recipe for target 'code.c' failed\nmake: *** [code.o] Error 1\nProcess returned error code 2\n</code></pre>\n\n<p>I've tried to find a solution on other posts but I didn't found any answers. Here is my c program below :</p>\n\n<pre><code>#include \"contiki.h\"\n#include &lt;stdio.h&gt;\n#define PERIOD CLOCK_SECOND*2\nstatic struct etimer et;   // Define the timer\netimer_set(&amp;et, PERIOD);   // Set the timer\n\n/* Definition of the processes (actually a protothread) */\n   PROCESS(blink_LED, \"blink_LED\");\n\n/* Load this process at boot */\n   AUTOSTART_PROCESSES(&amp;blink_LED);\n\n/* The process */\n   PROCESS_THREAD(blink_LED,ev,data)\n   {\n    /* Application starts */\n       PROCESS_BEGIN();\n\n    /* Main loop of the application */\n       while(1){\n                etimer_set(&amp;et, PERIOD);\n                PROCESS_WAIT_EVENT();\n                printf(\"Event executed \\n\");\n\n                if(etimer_expired(&amp;et)){\n                   printf(\"Timer RESET \\n\");    \n                   etimer_reset(&amp;et);\n                }   \n\n       }\n    /* End of the process */\n      PROCESS_END();\n}\n</code></pre>\n\n<p>The error seems to be coming from this line :</p>\n\n<pre><code>etimer_set(&amp;et, PERIOD);   // Set the timer\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["c", "memory", "alignment", "padding"], "answers": [{"tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": false, "score": 0, "last_activity_date": 1525867844, "creation_date": 1525867844, "answer_id": 50253070, "question_id": 50248513, "link": "https://stackoverflow.com/questions/50248513/c-forcing-alignment-with-alignas-specifier-why-memory-padding/50253070#50253070", "title": "C - Forcing alignment with _Alignas specifier - why memory padding?", "body": "<p>Stacks commonly grow downward. There is no essential reason for this; it is largely simply the result of historical development. A region of memory is allocated for the stack, the stack pointer is set to point to the high end of it, and the main routine of the program is started. As the program needs more stack space, it decreases the stack pointer.</p>\n\n<p>What appears to be happening in your example is that the compiler is assigning space for objects in the order it encounters them. <code>dx</code> is seen first, so it is assigned the next available space on the stack, <code>0x28ff13</code>. Then <code>ca</code> is seen, and it is assigned <code>0x28ff12</code>. We see that, as the stack grows, it proceeds from higher addresses (where it started) to lower addresses.</p>\n\n<p>When the compiler gets to <code>cz</code>, for which you have requested eight-byte alignment, the compiler jumps to the next multiple of eight (still in the downward direction), which is <code>0x28ff08</code>.</p>\n\n<p>Certainly the compiler could have looked at the whole situation (instead of looking at each object one at a time) and put <code>cz</code> at <code>0x28ff10</code> and put the other objects around it, using less stack space. If you compile with optimization enabled, the compiler might do that. On the other hand, the compiler might have a requirement on your platform to keep the stack pointer aligned to eight bytes (or more), so rearranging these particular objects would not have saved any stack space anyway.</p>\n\n<p>There are no rules in the C standard about this. The compiler is free to arrange its stack as it chooses.</p>\n"}], "owner": {"reputation": 457, "user_id": 8370202, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/25918f1d68b4bdb55f7afdd7673ef2e6?s=128&d=identicon&r=PG&f=1", "display_name": "AlexQualcosa", "link": "https://stackoverflow.com/users/8370202/alexqualcosa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525867844, "creation_date": 1525853469, "question_id": 50248513, "link": "https://stackoverflow.com/questions/50248513/c-forcing-alignment-with-alignas-specifier-why-memory-padding", "title": "C - Forcing alignment with _Alignas specifier - why memory padding?", "body": "<p>I have a few questions about memory alignment in C language and how memory is allocated after forcing a variable to be aligned to a certain number of bytes using the _Alignas specifier.</p>\n\n<p>This code shows in output the memory addresses of each declared variable:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(void)\n{\n       unsigned char dx = 1;\n       unsigned char ca  = 1;\n       unsigned char cx  = 1;\n       unsigned char dz = 1;\n       unsigned char cb = 1;\n       unsigned char _Alignas(double)  cz = 1;\n\n       char * p_begin = (char *) &amp;cz;\n       char * p_end = (char * ) &amp;dx + sizeof(dx);\n\n       printf(\"Addresses   Value\\n\");\n       for (char * p = p_begin; p &lt; p_end; p++)\n       {\n              printf(\"%9p   %6X\", p, 0xff &amp; *p);\n\n              if (p == (char *) &amp; dx) printf(\" &lt;- dx\\n\");\n              else if (p == (char *) &amp; ca) printf(\" &lt;- ca\\n\");\n              else if (p == (char *) &amp; cx) printf(\" &lt;- cx\\n\");\n              else if (p == (char *) &amp; dz) printf(\" &lt;- dz\\n\");\n              else if (p == (char *) &amp; cb) printf(\" &lt;- cb\\n\");\n              else if (p == (char *) &amp; cz) printf(\" &lt;- cz\\n\");\n              else printf(\"\\n\");\n       }\n\n       return 0;\n}\n</code></pre>\n\n<p>On my computer the output is as follows:</p>\n\n<pre><code>Addresses   Value\n   28ff08        1 &lt;- cz\n   28ff09       FF\n   28ff0a       28\n   28ff0b        0\n   28ff0c       CE\n   28ff0d       2A\n   28ff0e       40\n   28ff0f        1 &lt;- cb\n   28ff10        1 &lt;- dz\n   28ff11        1 &lt;- cx\n   28ff12        1 &lt;- ca\n   28ff13        1 &lt;- dx\n\nProcess returned 0 (0x0)   execution time : 0.016 s\nPress any key to continue.\n</code></pre>\n\n<p>The only behavior I would have expected to see after forcing the <code>cz</code> variable alignment on 8 bytes is that<code>cz</code> was allocated to an address whose value is multiple of 8, I would not have expected to see follow <code>cz</code> from the padding. How come this behavior?\nAlso I expected that the number of bytes corresponding to the padding combined with the data size of 1 byte would result in 8, instead the padding occupies 6 bytes for which reason?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 4593, "user_id": 105104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b23920ac852e946b333d3f9d0d95c1?s=128&d=identicon&r=PG", "display_name": "dvhh", "link": "https://stackoverflow.com/users/105104/dvhh"}, "edited": false, "score": 1, "creation_date": 1525853390, "post_id": 50248382, "comment_id": 87514260, "body": "The code is very hard to follow, why do you return a pointer to a pointer to <code>EXPO</code> ? also EXPO look like a linked list but you use an array of EXPO instead. You might need to clean up your code a little bit. Also check return values of <code>fopen</code> <code>malloc</code> <code>fgets</code> <code>sscanf</code> ( I am probably mmissing a few )"}, {"owner": {"reputation": 3, "user_id": 9763236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f3990b63b74288977b1105bc3776195?s=128&d=identicon&r=PG&f=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/9763236/dan"}, "reply_to_user": {"reputation": 4593, "user_id": 105104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b23920ac852e946b333d3f9d0d95c1?s=128&d=identicon&r=PG", "display_name": "dvhh", "link": "https://stackoverflow.com/users/105104/dvhh"}, "edited": false, "score": 0, "creation_date": 1525854388, "post_id": 50248382, "comment_id": 87514778, "body": "My apologies, I&#39;ve never written a program that requires anything complicated until now. The way I have it is the only way I understand C code at the moment. One of the requirements for the project is that I need to use a function to read the numbers from the file, but I don&#39;t know how to get them into the main function."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1525854601, "post_id": 50248382, "comment_id": 87514913, "body": "You can&#39;t return pointers pointing at local objects and that&#39;s that."}, {"owner": {"reputation": 4593, "user_id": 105104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b23920ac852e946b333d3f9d0d95c1?s=128&d=identicon&r=PG", "display_name": "dvhh", "link": "https://stackoverflow.com/users/105104/dvhh"}, "edited": false, "score": 0, "creation_date": 1525855700, "post_id": 50248382, "comment_id": 87515547, "body": "from what I understood from your code, <a href=\"https://pastebin.com/bV6pPtf1\" rel=\"nofollow noreferrer\">I tried to simplify it</a>"}], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1525859932, "post_id": 50250464, "comment_id": 87518214, "body": "&quot;Surely it is possible to return an array of structs from a function. It works by returning a pointer&quot; =&gt; soooo not an array, sooo it&#39;s not possible ;) Never say or vaguely say pointer == array, this is deeply wrong specially to a new coder. <code>struct array_s *ret = malloc(sizeof(struct array_s), 5);</code> this is not an array, but a contigus sequence of the same element. and by the way, this doesn&#39;t compile ;) you confuse with <code>calloc()</code>; <code>malloc(string_size);</code> and <code>malloc(string_size);</code> forget to count the nul terminate byte..."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1525860539, "post_id": 50250464, "comment_id": 87518638, "body": "Why not, let us argue a bit ;) From <a href=\"http://en.cppreference.com/w/c/language/array\" rel=\"nofollow noreferrer\">array</a> <code>Array is a type consisting of a contiguously allocated nonempty sequence of objects with a particular element type.</code>. Your point is correct, I return a pointer to contiguously allocated sequence of objects and not these objects them self. I can point out, that there are no arrays in C, only pointers. My intention was to show how it is done in &quot;real&quot; code. What if i wrap 5 arrays in a <code>struct ret_s { struct array_s a[5]; };</code> and return this struct, does this count as returning an array?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1525860759, "post_id": 50250464, "comment_id": 87518770, "body": "This count as returning a structure, not an array. And array exist in C, you give the proof yourself with your link, but &quot;Array is a type consisting of a contiguously allocated nonempty sequence of objects with a particular element type.&quot; A =&gt; B, but common error is to suppose that B =&gt; A. a type consisting of a contiguously allocated nonempty sequence of objects with a particular element type is not always an array ;) (note that even C standard confuse array and pointer sometime...)"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1525861048, "post_id": 50250464, "comment_id": 87518931, "body": "I would return a structure that contains that array... Anyway, I guess you are right, I will edit the answer and thank you for your comment."}, {"owner": {"reputation": 3, "user_id": 9763236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f3990b63b74288977b1105bc3776195?s=128&d=identicon&r=PG&f=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/9763236/dan"}, "edited": false, "score": 0, "creation_date": 1525911496, "post_id": 50250464, "comment_id": 87545558, "body": "Thank you for your help! I am still struggling to understand everything, but I did change my ex_arrays to static, which seems to be working. I tried this first because it seemed the simplest solution, if I encounter any problems I will try to allocate space the way you suggested."}], "tags": [], "owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "is_accepted": true, "score": 0, "last_activity_date": 1525861819, "last_edit_date": 1525861819, "creation_date": 1525859733, "answer_id": 50250464, "question_id": 50248382, "link": "https://stackoverflow.com/questions/50248382/is-it-possible-to-return-a-struct-array-from-a-function/50250464#50250464", "title": "Is it possible to return a struct array from a function?", "body": "<p>No, you can't return an array of structs from a function. From <a href=\"http://en.cppreference.com/w/c/language/function_declaration\" rel=\"nofollow noreferrer\">function declaration</a>:</p>\n\n<pre><code>In the declaration grammar of a function declaration, the type-specifier \nsequence, possibly modified by the declaration, designates the return type \n(which may be any type other than array or function type)...\n</code></pre>\n\n<p>The return type returned by a function can't be an array, so you can't return an array from a function.<br>\nThe common way around this, is to return a pointer to the first array element:</p>\n\n<pre><code>struct arr_s {\n    int arr_member;\n};\n\nstruct arr_s *function_that_returns_array_of_5_ints(void) {\n    static struct arr_s array[5] = {1,2,3,4,5};\n    return arr; // 'Array to pointer conversion'\n}\n\nvoid some_function(void) {\n    struct arr_s *arr = function_that_returns_array_of_5_ints();\n    printf(\"%d\\n\", arr[3].arr_member);\n}\n</code></pre>\n\n<p>The way <code>arr[3].arr_member</code> works is because <code>arr[3]</code> translates to <code>*(arr + 3)</code> and because of <a href=\"http://en.cppreference.com/w/c/language/operator_arithmetic\" rel=\"nofollow noreferrer\">pointer arithmetic</a>:</p>\n\n<pre><code>- If the pointer P points at an element of an array with index I, then\n  - P+N and N+P are pointers that point at an element of the same array with index I+N\n</code></pre>\n\n<p>Now, to your code, look at this fragments, I've added some comments:</p>\n\n<pre><code>// ptr_array is declared in main and passed to this function,\n// so it's storage duration is longer then this function\nEXPO** input_poly(EXPO *ptr_array[], FILE *finput)\n{\n    ...\n    // these variables are placed on stack, they have automatic storage duration\n    EXPO ex_array1[(sizeof(string1)/2)];\n    EXPO ex_array2[(sizeof(string2)/2)];\n    ....\n    ptr1=ex_array1;\n    ptr2=ex_array2;\n    ptr_array[0]=ptr1; // = ex_array1\n    ptr_array[1]=ptr2; // = ex_array2\n    ...\n    return ptr_array; // the variables ex_array1 and ex_array2 stop existing here,\n    // yet you return pointers to them in ptr_array[0] and ptr_array[1].\n    // the memory allocated for ex_arrays does not exists after return\n}\n</code></pre>\n\n<p><code>ex_array1</code> and <code>ex_array2</code> are variables with <a href=\"http://en.cppreference.com/w/c/language/storage_duration\" rel=\"nofollow noreferrer\">atomatic storage duration</a>. What that means, is:</p>\n\n<pre><code>automatic storage duration. The storage is allocated when the block \nin which the object was declared is entered and deallocated when it \nis exited by any means (goto, return, reaching the end).\n</code></pre>\n\n<p>(They are not VLAs because <code>(sizeof(string1)/2)</code> is a constant expression. Anyway, the following still would hold true). As the memory allocated for variables <code>ex_array1</code> and <code>ex_array2</code> cease to exist after returning from <code>input_poly</code> function, you return a pointer to nonexistent memory (storage which has been deallocated), you can't no longer access ex_arrays.<br>\nAlso pay attention to the <a href=\"http://en.cppreference.com/w/c/language/sizeof\" rel=\"nofollow noreferrer\">sizeof</a> operator. <code>sizeof(expo_string)</code> is equal to <code>sizeof(char[60])</code> is equal to 60. But <code>sizeof(string1)</code> is equal to <code>sizeof(char*)</code>, so on 64-bit machine may be equal to 8 (may be not, this is machine dependent), so actually in place <code>EXPO ex_array1[(sizeof(string1)/2)];</code> you are actually doing <code>EXPO ex_array1[4];</code> and also <code>string_size = 4;</code>, probably that wasn't the intent.<br>\nThe solution is to use malloc or to declare ex_arrays with static storage duration, either declare them 'globally' outside <code>input_poly</code> function or use <code>static</code> keyword. I think, the best you can do is:</p>\n\n<pre><code>  EXPO *ex_array1 = malloc(sizeof(string1)/2);\n  EXPO *ex_array2 = malloc(sizeof(string2)/2);\n</code></pre>\n\n<p>or i can guess you really wanted to do smth like:</p>\n\n<pre><code>  string_size = strlen(string1)/2; // get string length in string1 and divide by 2\n  EXPO *ex_array1 = malloc(string_size);\n  EXPO *ex_array2 = malloc(string_size);\n</code></pre>\n\n<p>That way the memory allocated for ex_arrays will survive after the function returns, that way you can still access it in other functions.</p>\n"}], "owner": {"reputation": 3, "user_id": 9763236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f3990b63b74288977b1105bc3776195?s=128&d=identicon&r=PG&f=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/9763236/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 50250464, "answer_count": 1, "score": 0, "last_activity_date": 1525861819, "creation_date": 1525852939, "question_id": 50248382, "link": "https://stackoverflow.com/questions/50248382/is-it-possible-to-return-a-struct-array-from-a-function", "title": "Is it possible to return a struct array from a function?", "body": "<p>This is my first real coding class and I may be going the wrong way here, but for a project in C programming class I need to write a function to read in various numbers from a file and separate them into categories: coefficients and exponentials. I think I have that part done already, however to use the contents of the numbers I have read I'm attempting to pass an array of struct from a function to the main so I can use the contents. The code below is what I have now, and it does not give me any errors, however when I access the array in the main function, it is empty except for the first value. Is there something I can change to make this work? Or a better way of going about this? </p>\n\n<p>Any help is appreciated</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\ntypedef struct exponential\n{\n    float coef;\n    int expo;\n    struct exponential *ptr_exp;\n}EXPO;\n\nEXPO** input_poly(EXPO *ex_array[], FILE *finput);\n\nint main()\n{\n    FILE *finput;\n    finput=fopen(\"cp7_in.txt\",\"r\");\n    EXPO *ptr_array[2];\n    EXPO **ptr, *ptr1, *ptr2, **ptraddress;\n    ptr=(input_poly(ptr_array, finput));\n}\n\n\nEXPO** input_poly(EXPO *ptr_array[], FILE *finput)\n{\n    int count, string_size, offset1, offset2, offset3, offset4;\n    char expo_string[64];\n    char *expo_ptr, *string1, *string2;\n    EXPO *ptr1, *ptr2;\n    string1=(char*)malloc(sizeof(expo_string)+1);\n    string2=(char*)malloc(sizeof(expo_string)+1);\n    for(count=0;(fgets(expo_string,64,finput)&gt;0)&amp;&amp;(count&lt;2);count++)\n    {\n        if(count==0)\n        {\n            strcpy(string1,expo_string);\n        }\n        if(count==1)\n        {\n            strcpy(string2,expo_string);\n        }\n    }\n    EXPO ex_array1[(sizeof(string1)/2)];\n    EXPO ex_array2[(sizeof(string2)/2)];\n    count=0;\n    string_size=(sizeof(string1)/2);\n    offset1=0;\n    offset2=0;\n    offset3=0;\n    offset4=0;\n    while(count&lt;string_size)\n    {\n        sscanf((string1+offset2),\"%e %d %n\",&amp;(ex_array1[count]).coef,&amp;(ex_array1[count]).expo,&amp;offset1);\n        sscanf((string2+offset4),\"%e %d %n\",&amp;(ex_array2[count]).coef,&amp;(ex_array2[count]).expo,&amp;offset3);\n        (ex_array1[count]).ptr_exp=&amp;(ex_array1[count+1]);\n        (ex_array2[count]).ptr_exp=&amp;(ex_array2[count+1]);\n        count++;\n        offset2+=offset1;\n        offset4+=offset3;\n    }\n    ptr1=ex_array1;\n    ptr2=ex_array2;\n    ptr_array[0]=ptr1;\n    ptr_array[1]=ptr2;\n    free(string1);\n    free(string2);\n    return ptr_array;\n }\n</code></pre>\n"}, {"tags": ["c", "debugging", "ubuntu-16.04", "valgrind"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1525854306, "post_id": 50248365, "comment_id": 87514735, "body": "Are you really running the program you think you&#39;re running? Is your current directory <code>&#47;tmp</code>? What if you just do e.g. <code>valgrind .&#47;a.out</code> what happens then?"}, {"owner": {"reputation": 789, "user_id": 7868795, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/471c6f01b994a5aadf85dc6cfec40fc4?s=128&d=identicon&r=PG", "display_name": "Ra&#39;Jiska", "link": "https://stackoverflow.com/users/7868795/rajiska"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1525854502, "post_id": 50248365, "comment_id": 87514850, "body": "Unfortunately yes. Valgrind confirms the path of the file. File not found when running with <code>.&#47;a.out</code>. I even tried setting the <code>-o</code> file of GCC to set the name to something else and calling valgrind over it, same issue."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1525854967, "post_id": 50248365, "comment_id": 87515106, "body": "If you do <code>gcc a.c -g</code> and followed by <code>valgrind .&#47;a.out</code> and getting the error message that Valgrind can&#39;t find your program is highly suspect. Please edit your question to include the <i>exact</i> commands you use to build and run Valgrind, including the path you&#39;re doing this in."}, {"owner": {"reputation": 789, "user_id": 7868795, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/471c6f01b994a5aadf85dc6cfec40fc4?s=128&d=identicon&r=PG", "display_name": "Ra&#39;Jiska", "link": "https://stackoverflow.com/users/7868795/rajiska"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1525856126, "post_id": 50248365, "comment_id": 87515825, "body": "@Someprogrammerdude That&#39;s effectively suspect. Just edited the command with the full output. Some weeks ago I had the full Ubuntu desktop that went away and had to redownload all the Ubuntu base packages. Maybe valgrind / gcc requires some other packages which I did not redownload ?"}, {"owner": {"reputation": 789, "user_id": 7868795, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/471c6f01b994a5aadf85dc6cfec40fc4?s=128&d=identicon&r=PG", "display_name": "Ra&#39;Jiska", "link": "https://stackoverflow.com/users/7868795/rajiska"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1525874733, "post_id": 50248365, "comment_id": 87528346, "body": "Just added a few details, it doesn&#39;t seem to come from GCC nor Valgrind themselves. But something must be happening while it&#39;s compiling."}, {"owner": {"reputation": 789, "user_id": 7868795, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/471c6f01b994a5aadf85dc6cfec40fc4?s=128&d=identicon&r=PG", "display_name": "Ra&#39;Jiska", "link": "https://stackoverflow.com/users/7868795/rajiska"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1528875342, "post_id": 50248365, "comment_id": 88667210, "body": "@Someprogrammerdude Just for the record, solution found ;)"}], "answers": [{"comments": [{"owner": {"reputation": 789, "user_id": 7868795, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/471c6f01b994a5aadf85dc6cfec40fc4?s=128&d=identicon&r=PG", "display_name": "Ra&#39;Jiska", "link": "https://stackoverflow.com/users/7868795/rajiska"}, "edited": false, "score": 0, "creation_date": 1525877185, "post_id": 50255807, "comment_id": 87530160, "body": "I&#39;ve tried out with clang, it seems to work correctly. However when I work with GCC, Valgrind reports a &quot;ELF section outside all mapped regions&quot; error."}], "tags": [], "owner": {"reputation": 5012, "user_id": 2416647, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f471b80868ae9c93d0903127ed27e2f9?s=128&d=identicon&r=PG", "display_name": "schorsch312", "link": "https://stackoverflow.com/users/2416647/schorsch312"}, "is_accepted": false, "score": 0, "last_activity_date": 1525875905, "creation_date": 1525875905, "answer_id": 50255807, "question_id": 50248365, "link": "https://stackoverflow.com/questions/50248365/valgrind-doesnt-see-lines-in-g-file/50255807#50255807", "title": "Valgrind doesn&#39;t see lines in -g file", "body": "<p>I use RedHat6 and valgrind 3.9.0.\nI have tested the following compilers. With all compiler I used the debug flag <code>-g</code></p>\n\n<p><strong>clang 4.0</strong>  </p>\n\n<pre><code>==8862== Invalid read of size 1\n==8862==    at 0x4A09097: strcpy (in /opt/rh/devtoolset-2/root/usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)\n==8862==    by 0x400566: main (valg.c:10)\n==8862==  Address 0x0 is not stack'd, malloc'd or (recently) free'd\n</code></pre>\n\n<p><strong>intel icc 15.0.3</strong> </p>\n\n<pre><code>==8250== Invalid read of size 1\n==8250==    at 0x4A09097: strcpy (in /opt/rh/devtoolset-2/root/usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)\n==8250==    by 0x4005D2: main (valg.c:10)\n==8250==  Address 0x0 is not stack'd, malloc'd or (recently) free'd\n</code></pre>\n\n<p><strong>gcc 4.8.2</strong> </p>\n\n<pre><code>==8862== Invalid read of size 1\n==8862==    at 0x4A09097: strcpy (in /opt/rh/devtoolset-2/root/usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)\n==8862==    by 0x400566: main (valg.c:10)\n==8862==  Address 0x0 is not stack'd, malloc'd or (recently) free'd\n</code></pre>\n\n<p>All of them show the correct <code>Invalid read of size 1</code>.\nA proper <code>signal 11</code> is thrown, when executing the program.</p>\n\n<p>It is not important, if you use <code>-v</code> or <code>--leak-check=full</code>.</p>\n\n<p>I know that this is not an answer, but it was too long for a comment.</p>\n"}, {"tags": [], "owner": {"reputation": 789, "user_id": 7868795, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/471c6f01b994a5aadf85dc6cfec40fc4?s=128&d=identicon&r=PG", "display_name": "Ra&#39;Jiska", "link": "https://stackoverflow.com/users/7868795/rajiska"}, "is_accepted": true, "score": 0, "last_activity_date": 1528875312, "last_edit_date": 1528875312, "creation_date": 1525884438, "answer_id": 50258381, "question_id": 50248365, "link": "https://stackoverflow.com/questions/50248365/valgrind-doesnt-see-lines-in-g-file/50258381#50258381", "title": "Valgrind doesn&#39;t see lines in -g file", "body": "<p>Problem Fixed</p>\n\n<p>After testing the compilation with a different user, valgrind was able to detect the lines and functions the issues were appearing at. It took me no long after to figure out the issue came from my <code>~/.profile</code> file where I edited my <code>$PATH</code> to give the precedence to a local architecture present in my <code>$HOME</code> directory. GCC must have been fetching some of its libraries from there which resulted in debug symbols not being fully generated.</p>\n\n<p>Fixed it all by editing the <code>$PATH</code> variable back to the way it used to.</p>\n\n<p>EDIT:</p>\n\n<p>I finally found out the exact reason why it did not work. Basically as a temp fix I was simply setting in my <code>$PATH</code> my local-user bin folder where I compiled many system binaries for them to be up to date.</p>\n\n<p>The binary <code>ld</code> (2.30.51.20180501) was causing the issue. Removing it from my <code>$PATH</code> allowed my valgrind to work as intended again.</p>\n"}], "owner": {"reputation": 789, "user_id": 7868795, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/471c6f01b994a5aadf85dc6cfec40fc4?s=128&d=identicon&r=PG", "display_name": "Ra&#39;Jiska", "link": "https://stackoverflow.com/users/7868795/rajiska"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3287, "favorite_count": 0, "accepted_answer_id": 50258381, "answer_count": 2, "score": 3, "last_activity_date": 1528875312, "creation_date": 1525852869, "last_edit_date": 1525875829, "question_id": 50248365, "link": "https://stackoverflow.com/questions/50248365/valgrind-doesnt-see-lines-in-g-file", "title": "Valgrind doesn&#39;t see lines in -g file", "body": "<p>My valgrind for some reason doesn't happen to print the line number and the file the error happens at. This happens in a Linux Ubuntu 16.04.4 distro.</p>\n\n<p>Here is how I have tested it:</p>\n\n<p>/tmp/a.c:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;unistd.h&gt;\n\nint main(int argc, char **argv)\n{\n    char *buf = malloc(10);\n\n    strcpy(buf, argv[1]);\n    return 0;\n}\n</code></pre>\n\n<p>I executed it all with the following command: <code>cd /tmp &amp;&amp; gcc a.c -o hello -fno-stack-protector -fno-builtin -g &amp;&amp; valgrind ./hello</code></p>\n\n<pre><code>$ cd /tmp &amp;&amp; gcc a.c -o hello -fno-stack-protector -fno-builtin -g &amp;&amp; valgrind ./hello ./hello\n==23422== Memcheck, a memory error detector\n==23422== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.\n==23422== Using Valgrind-3.11.0 and LibVEX; rerun with -h for copyright info\n==23422== Command: ./hello\n==23422== \n==23422== Invalid read of size 1\n==23422==    at 0x4C31047: strcpy (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==23422==    by 0x40119C: ??? (in /tmp/hello)\n==23422==    by 0x4E5A82F: (below main) (libc-start.c:291)\n==23422==  Address 0x0 is not stack'd, malloc'd or (recently) free'd\n==23422== \n==23422== \n==23422== Process terminating with default action of signal 11 (SIGSEGV)\n==23422==  Access not within mapped region at address 0x0\n==23422==    at 0x4C31047: strcpy (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==23422==    by 0x40119C: ??? (in /tmp/hello)\n==23422==    by 0x4E5A82F: (below main) (libc-start.c:291)\n==23422==  If you believe this happened as a result of a stack\n==23422==  overflow in your program's main thread (unlikely but\n==23422==  possible), you can try to increase the size of the\n==23422==  main thread stack using the --main-stacksize= flag.\n==23422==  The main thread stack size used in this run was 8388608.\n==23422== \n==23422== HEAP SUMMARY:\n==23422==     in use at exit: 10 bytes in 1 blocks\n==23422==   total heap usage: 1 allocs, 0 frees, 10 bytes allocated\n==23422== \n==23422== LEAK SUMMARY:\n==23422==    definitely lost: 0 bytes in 0 blocks\n==23422==    indirectly lost: 0 bytes in 0 blocks\n==23422==      possibly lost: 0 bytes in 0 blocks\n==23422==    still reachable: 10 bytes in 1 blocks\n==23422==         suppressed: 0 bytes in 0 blocks\n==23422== Rerun with --leak-check=full to see details of leaked memory\n==23422== \n==23422== For counts of detected and suppressed errors, rerun with: -v\n==23422== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)\nSegmentation fault (core dumped)\n</code></pre>\n\n<p>GCC Version: <code>gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.9)</code>\nValgrind Version: <code>valgrind-3.11.0</code></p>\n\n<p>I also tried downloading and compiling the latest valgrind version (<code>valgrind-3.13.0</code>) but ended with the same issue.</p>\n\n<p>EDIT:</p>\n\n<p>Output with full logs:</p>\n\n<pre><code>$ valgrind -v --leak-check=full /tmp/a.out\n==17717== Memcheck, a memory error detector\n==17717== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.\n==17717== Using Valgrind-3.11.0 and LibVEX; rerun with -h for copyright info\n==17717== Command: /tmp/a.out\n==17717== \n--17717-- Valgrind options:\n--17717--    -v\n--17717--    --leak-check=full\n--17717-- Contents of /proc/version:\n--17717--   Linux version 4.4.0-119-generic (buildd@lcy01-amd64-013) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.9) ) #143-Ubuntu SMP Mon Apr 2 16:08:24 UTC 2018\n--17717-- \n--17717-- Arch and hwcaps: AMD64, LittleEndian, amd64-cx16-rdtscp-sse3-avx\n--17717-- Page sizes: currently 4096, max supported 4096\n--17717-- Valgrind library directory: /usr/lib/valgrind\n--17717-- Reading syms from /tmp/a.out\n--17717-- ELF section outside all mapped regions\n--17717-- Reading syms from /lib/x86_64-linux-gnu/ld-2.23.so\n--17717--   Considering /lib/x86_64-linux-gnu/ld-2.23.so ..\n--17717--   .. CRC mismatch (computed aa979a42 wanted 9019bbb7)\n--17717--   Considering /usr/lib/debug/lib/x86_64-linux-gnu/ld-2.23.so ..\n--17717--   .. CRC is valid\n--17717-- Reading syms from /usr/lib/valgrind/memcheck-amd64-linux\n--17717--   Considering /usr/lib/valgrind/memcheck-amd64-linux ..\n--17717--   .. CRC mismatch (computed eea41ea9 wanted 2009db78)\n--17717--    object doesn't have a symbol table\n--17717--    object doesn't have a dynamic symbol table\n--17717-- Scheduler: using generic scheduler lock implementation.\n--17717-- Reading suppressions file: /usr/lib/valgrind/default.supp\n==17717== embedded gdbserver: reading from /tmp/vgdb-pipe-from-vgdb-to-17717-by-rajiska-on-???\n==17717== embedded gdbserver: writing to   /tmp/vgdb-pipe-to-vgdb-from-17717-by-rajiska-on-???\n==17717== embedded gdbserver: shared mem   /tmp/vgdb-pipe-shared-mem-vgdb-17717-by-rajiska-on-???\n==17717== \n==17717== TO CONTROL THIS PROCESS USING vgdb (which you probably\n==17717== don't want to do, unless you know exactly what you're doing,\n==17717== or are doing some strange experiment):\n==17717==   /usr/lib/valgrind/../../bin/vgdb --pid=17717 ...command...\n==17717== \n==17717== TO DEBUG THIS PROCESS USING GDB: start GDB like this\n==17717==   /path/to/gdb /tmp/a.out\n==17717== and then give GDB the following command\n==17717==   target remote | /usr/lib/valgrind/../../bin/vgdb --pid=17717\n==17717== --pid is optional if only one valgrind process is running\n==17717== \n--17717-- REDIR: 0x401cfd0 (ld-linux-x86-64.so.2:strlen) redirected to 0x3809e181 (???)\n--17717-- Reading syms from /usr/lib/valgrind/vgpreload_core-amd64-linux.so\n--17717--   Considering /usr/lib/valgrind/vgpreload_core-amd64-linux.so ..\n--17717--   .. CRC mismatch (computed 2567ccf6 wanted 49420590)\n--17717--    object doesn't have a symbol table\n--17717-- Reading syms from /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so\n--17717--   Considering /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so ..\n--17717--   .. CRC mismatch (computed 0e27c9a8 wanted ac585421)\n--17717--    object doesn't have a symbol table\n==17717== WARNING: new redirection conflicts with existing -- ignoring it\n--17717--     old: 0x0401cfd0 (strlen              ) R-&gt; (0000.0) 0x3809e181 ???\n--17717--     new: 0x0401cfd0 (strlen              ) R-&gt; (2007.0) 0x04c31020 strlen\n--17717-- REDIR: 0x401b920 (ld-linux-x86-64.so.2:index) redirected to 0x4c30bc0 (index)\n--17717-- REDIR: 0x401bb40 (ld-linux-x86-64.so.2:strcmp) redirected to 0x4c320d0 (strcmp)\n--17717-- REDIR: 0x401dd30 (ld-linux-x86-64.so.2:mempcpy) redirected to 0x4c35270 (mempcpy)\n--17717-- Reading syms from /lib/x86_64-linux-gnu/libc-2.23.so\n--17717--   Considering /lib/x86_64-linux-gnu/libc-2.23.so ..\n--17717--   .. CRC mismatch (computed 7a8ee3e4 wanted a5190ac4)\n--17717--   Considering /usr/lib/debug/lib/x86_64-linux-gnu/libc-2.23.so ..\n--17717--   .. CRC is valid\n--17717-- REDIR: 0x4ec9a00 (libc.so.6:strcasecmp) redirected to 0x4a286f0 (_vgnU_ifunc_wrapper)\n--17717-- REDIR: 0x4ec5280 (libc.so.6:strcspn) redirected to 0x4a286f0 (_vgnU_ifunc_wrapper)\n--17717-- REDIR: 0x4ecbcf0 (libc.so.6:strncasecmp) redirected to 0x4a286f0 (_vgnU_ifunc_wrapper)\n--17717-- REDIR: 0x4ec76f0 (libc.so.6:strpbrk) redirected to 0x4a286f0 (_vgnU_ifunc_wrapper)\n--17717-- REDIR: 0x4ec7a80 (libc.so.6:strspn) redirected to 0x4a286f0 (_vgnU_ifunc_wrapper)\n--17717-- REDIR: 0x4ec914b (libc.so.6:memcpy@GLIBC_2.2.5) redirected to 0x4a286f0 (_vgnU_ifunc_wrapper)\n--17717-- REDIR: 0x4ec7400 (libc.so.6:rindex) redirected to 0x4c308a0 (rindex)\n--17717-- REDIR: 0x4ebe130 (libc.so.6:malloc) redirected to 0x4c2db20 (malloc)\n--17717-- REDIR: 0x4ec5160 (libc.so.6:strcpy) redirected to 0x4a286f0 (_vgnU_ifunc_wrapper)\n--17717-- REDIR: 0x4edf9d0 (libc.so.6:__strcpy_sse2_unaligned) redirected to 0x4c31040 (strcpy)\n==17717== Invalid read of size 1\n==17717==    at 0x4C31047: strcpy (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==17717==    by 0x40119C: ??? (in /tmp/a.out)\n==17717==    by 0x4E5A82F: (below main) (libc-start.c:291)\n==17717==  Address 0x0 is not stack'd, malloc'd or (recently) free'd\n==17717== \n==17717== \n==17717== Process terminating with default action of signal 11 (SIGSEGV)\n==17717==  Access not within mapped region at address 0x0\n==17717==    at 0x4C31047: strcpy (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==17717==    by 0x40119C: ??? (in /tmp/a.out)\n==17717==    by 0x4E5A82F: (below main) (libc-start.c:291)\n==17717==  If you believe this happened as a result of a stack\n==17717==  overflow in your program's main thread (unlikely but\n==17717==  possible), you can try to increase the size of the\n==17717==  main thread stack using the --main-stacksize= flag.\n==17717==  The main thread stack size used in this run was 8388608.\n--17717-- REDIR: 0x4ebe4f0 (libc.so.6:free) redirected to 0x4c2ed80 (free)\n==17717== \n==17717== HEAP SUMMARY:\n==17717==     in use at exit: 10 bytes in 1 blocks\n==17717==   total heap usage: 1 allocs, 0 frees, 10 bytes allocated\n==17717== \n==17717== Searching for pointers to 1 not-freed blocks\n==17717== Checked 62,704 bytes\n==17717== \n==17717== LEAK SUMMARY:\n==17717==    definitely lost: 0 bytes in 0 blocks\n==17717==    indirectly lost: 0 bytes in 0 blocks\n==17717==      possibly lost: 0 bytes in 0 blocks\n==17717==    still reachable: 10 bytes in 1 blocks\n==17717==         suppressed: 0 bytes in 0 blocks\n==17717== Reachable blocks (those to which a pointer was found) are not shown.\n==17717== To see them, rerun with: --leak-check=full --show-leak-kinds=all\n==17717== \n==17717== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)\n==17717== \n==17717== 1 errors in context 1 of 1:\n==17717== Invalid read of size 1\n==17717==    at 0x4C31047: strcpy (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==17717==    by 0x40119C: ??? (in /tmp/a.out)\n==17717==    by 0x4E5A82F: (below main) (libc-start.c:291)\n==17717==  Address 0x0 is not stack'd, malloc'd or (recently) free'd\n==17717== \n==17717== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)\nSegmentation fault (core dumped)\n</code></pre>\n\n<p>EDIT 2: After testing a binary compiled on my system under a Docker system, it appears the issue is the same which leads to think the problem is on the binary itself. Compiling with the GCC of the Docker system works fine with valgrind.</p>\n\n<p>EDIT 3: Just compiled the latest GCC version (8.1.0) and tried compiling the program with it: same issue. Furthermore you may want to note that valgrind can't resolve the function the issue happens in, even though the executable is not striped.</p>\n\n<p>Also, in the <code>valgrind -v</code> command, we can see the note <code>ELF section outside all mapped regions</code> while reading the symbols of the executable.</p>\n\n<p>I'm kinda lost there, it looks like it doesn't come from either GCC or Valgrind. Maybe some kind of system configuration ?</p>\n"}, {"tags": ["c", "eof"], "comments": [{"owner": {"reputation": 915, "user_id": 3254536, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c4d61200a78c3d51c929553f2a3c5de8?s=128&d=identicon&r=PG&f=1", "display_name": "Neijwiert", "link": "https://stackoverflow.com/users/3254536/neijwiert"}, "edited": false, "score": 0, "creation_date": 1525851073, "post_id": 50247788, "comment_id": 87512924, "body": "Wrap it in a loop where the exit condition could be something like a key press, usually escape. Edit: And what @Someprogrammerdude is saying below. Didn&#39;t properly read the code and missed that."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 4, "creation_date": 1525851095, "post_id": 50247788, "comment_id": 87512938, "body": "Command line arguments passed through <code>argc</code> and <code>argv</code> are the arguments to the actual command. It&#39;s not input you read &quot;interactively&quot;."}, {"owner": {"reputation": 652, "user_id": 9347417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4eade3369e9b12786525484f752e6ed?s=128&d=identicon&r=PG&f=1", "display_name": "TheEngineer", "link": "https://stackoverflow.com/users/9347417/theengineer"}, "edited": false, "score": 0, "creation_date": 1525857692, "post_id": 50247788, "comment_id": 87516795, "body": "you need a forever loop like &#39;while(true)&#39; and in the loop keep checking if there is data and read them &#39;scanf(&quot;%c&quot;,&amp;char)&#39;"}], "answers": [{"tags": [], "owner": {"reputation": 66, "user_id": 9765476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bc6c1d9aca1f0f4767c82086f04b4b9?s=128&d=identicon&r=PG&f=1", "display_name": "Robin M.", "link": "https://stackoverflow.com/users/9765476/robin-m"}, "is_accepted": true, "score": 0, "last_activity_date": 1525877454, "creation_date": 1525877454, "answer_id": 50256310, "question_id": 50247788, "link": "https://stackoverflow.com/questions/50247788/how-to-make-interactive-cmd-interface/50256310#50256310", "title": "How to make interactive cmd interface?", "body": "<p>If you want make an interactive interface you should follow a few steps.</p>\n\n<p>1 - Get the key press by the user like</p>\n\n<pre><code>keypress = getch();\n</code></pre>\n\n<p>2 - Switch case the key pressed like</p>\n\n<pre><code>switch(keypress)\n{\n    case 'a' :\n       // Do somethink...\n    case 'b' :\n       // Do somethink\n    default :\n       break;\n}\n</code></pre>\n\n<p>3 - Now put this in while loop like</p>\n\n<pre><code>do\n{\n    keypress = getch();\n    switch(keypress)\n    {\n        case 'a' :\n          // Do somethink...\n        case 'b' :\n          // Do somethink\n        default :\n          break;\n}\nwhile(keypress != 'q')\n// quit program...\n</code></pre>\n\n<p>Thanks,\nRobin.</p>\n"}], "owner": {"reputation": 131, "user_id": 9547974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9eb5b67fee7c96c441b3b8f869d6a3ea?s=128&d=identicon&r=PG&f=1", "display_name": "Milo", "link": "https://stackoverflow.com/users/9547974/milo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 50256310, "answer_count": 1, "score": 0, "last_activity_date": 1525877454, "creation_date": 1525850891, "last_edit_date": 1525851386, "question_id": 50247788, "link": "https://stackoverflow.com/questions/50247788/how-to-make-interactive-cmd-interface", "title": "How to make interactive cmd interface?", "body": "<p>I was tasked with making an interactive cmd interface in C.\nI need to manage a data base of students, and have 3 commands which are : add,remove,print.\nI cant get the interactive platform right, I need achieve the following : each time I enter a command, it executes and then waits for new command without exiting, so the linked list won't get deleted of the memory, so far Im stuck here : </p>\n\n<pre><code>int main(int argc,char *argv[])\n{\n    char input[MAX];\n    int c;\n    if(argc == 1)\n    {\n        printf(\"no values were entered\");\n        exit(0);\n    }\n\n    while(--argc&gt;0 )\n    {\n        ++argv;\n        {\n            strcpy(input,*argv);\n            if((*++argv) )\n            {\n                printf(\"\\nmain(): too much args\\nexit(0)\\n\");\n                exit(0);\n            }\n        }\n    }\n\n    {\n        if (strcmp(input,\"add\") == 0)\n            /*do something*/;\n        else if(strcmp(input,\"print\") == 0)\n            /*do something*/\n        else if(strcmp(input,\"remove\") == 0)\n            /*do something*/\n        else\n            printf(\"no command was found\\n\");\n    }\n    return 0;\n}\n</code></pre>\n\n<p>Now, this does get my input and do what it is supposed to do, but I cant get my head around on how to make it return and wait for more commands without exiting the program.\nThanks for all information and help in advance!</p>\n"}, {"tags": ["c++", "c", "multithreading", "pthreads", "mutex"], "comments": [{"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1525849785, "post_id": 50247371, "comment_id": 87512219, "body": "The C standard doesn&#39;t define a <code>sleep</code> function, and I believe the Posix <code>sleep</code> function takes seconds as the argument."}, {"owner": {"reputation": 35, "user_id": 9666826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9839862a5e0825ce306f54eeb0deee6b?s=128&d=identicon&r=PG&f=1", "display_name": "JDoe4444", "link": "https://stackoverflow.com/users/9666826/jdoe4444"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1525849917, "post_id": 50247371, "comment_id": 87512283, "body": "@user3386109 The sleep function is irreverent, just pretend the thread delays before hitting the mutex."}, {"owner": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "edited": false, "score": 0, "creation_date": 1525850203, "post_id": 50247371, "comment_id": 87512431, "body": "Getting beyond the potential error in sleep(). In the case of Windows native threads and native mutexes, generally the order of locks acquired is in the order of requests. In other environments, the order of locks granted may not be specified, and it&#39;s possible for the same thread to keep acquiring a lock, even when multiple threads are pending trying to get the lock. In some cases, this occurs because the thread doing a loop with unlock() lock() sequence is the currently actively running thread, so it acquires the mutex again and no context switch occurs."}, {"owner": {"reputation": 3794, "user_id": 7256714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adeb98b0e8995d8576ad5f66c0f982e5?s=128&d=identicon&r=PG&f=1", "display_name": "Pras", "link": "https://stackoverflow.com/users/7256714/pras"}, "edited": false, "score": 0, "creation_date": 1525850213, "post_id": 50247371, "comment_id": 87512434, "body": "Probably that much amount of time your system needs to start and schedule the new thread into execution"}, {"owner": {"reputation": 35, "user_id": 9666826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9839862a5e0825ce306f54eeb0deee6b?s=128&d=identicon&r=PG&f=1", "display_name": "JDoe4444", "link": "https://stackoverflow.com/users/9666826/jdoe4444"}, "reply_to_user": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "edited": false, "score": 0, "creation_date": 1525850288, "post_id": 50247371, "comment_id": 87512473, "body": "@rcgldr Okay, this makes sense. Do you know if the pthread_cond_wait() will fix my issue?"}, {"owner": {"reputation": 61304, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 1, "creation_date": 1525850334, "post_id": 50247371, "comment_id": 87512497, "body": "not really clear what is the issue. If thread 1 should finish before the main enters the loop, then why are you doing the calculations in a seperate thread?"}, {"owner": {"reputation": 35, "user_id": 9666826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9839862a5e0825ce306f54eeb0deee6b?s=128&d=identicon&r=PG&f=1", "display_name": "JDoe4444", "link": "https://stackoverflow.com/users/9666826/jdoe4444"}, "reply_to_user": {"reputation": 3794, "user_id": 7256714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adeb98b0e8995d8576ad5f66c0f982e5?s=128&d=identicon&r=PG&f=1", "display_name": "Pras", "link": "https://stackoverflow.com/users/7256714/pras"}, "edited": false, "score": 0, "creation_date": 1525850356, "post_id": 50247371, "comment_id": 87512513, "body": "@Pras, you and rcgldr said about the same thing which makes total sense, do you know if the pthread_cond_wait() will fix this issue?"}, {"owner": {"reputation": 1240, "user_id": 5317459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd9f6135b6a4aac6f1947ba02adabafc?s=128&d=identicon&r=PG&f=1", "display_name": "Sumit Jha", "link": "https://stackoverflow.com/users/5317459/sumit-jha"}, "edited": false, "score": 0, "creation_date": 1525850367, "post_id": 50247371, "comment_id": 87512517, "body": "If you want to sync threads use condition variable."}, {"owner": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "edited": false, "score": 0, "creation_date": 1525850545, "post_id": 50247371, "comment_id": 87512613, "body": "@JDoe4444 - I&#39;m not sure how pthreads are implemented in Windows. One option here is to use one mutex per thread, if the environment supports that. One semaphore per thread would make more sense, but some systems like Linux, don&#39;t have native support for semaphores, and some commercial multi-threaded or multi-processing applications install drivers to do the spinlocks in order to balance loads between threads or processes."}, {"owner": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "edited": false, "score": 0, "creation_date": 1525850799, "post_id": 50247371, "comment_id": 87512756, "body": "@JDoe4444 - Windows and some other operating systems use queues or the equivalent for requests for native resources (mutex, semaphore, ...), which guarantees some type of ordering. I don&#39;t know why Linux doesn&#39;t include such a feature."}, {"owner": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "edited": false, "score": 0, "creation_date": 1525851002, "post_id": 50247371, "comment_id": 87512876, "body": "@JDoe4444 - as suggested by Sumit Jha, you can use condition variables to emulate semaphores, but you have to deal with <a href=\"https://en.wikipedia.org/wiki/Spurious_wakeup\" rel=\"nofollow noreferrer\">spurious wakeups</a>, where thread is made runnable without the resource being ready."}, {"owner": {"reputation": 1247, "user_id": 9107647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a43594ef3d74c11a31be7f9d5ebddc0?s=128&d=identicon&r=PG&f=1", "display_name": "Humphrey Winnebago", "link": "https://stackoverflow.com/users/9107647/humphrey-winnebago"}, "edited": false, "score": 0, "creation_date": 1525939873, "post_id": 50247371, "comment_id": 87554389, "body": "@JDoe4444 Hey you should go ahead and ask a new question for your EDIT question. IMO it&#39;s a good question. You&#39;re basically asking how you to achieve fairness in pthreads. Please include information for what OS, what CPU, what compiler, and whether or not you are allowed to use the C++11 standard (or higher)"}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1525962854, "post_id": 50247371, "comment_id": 87567272, "body": "OT: In case <code>p.size()</code> is read/written by the other thread as well, the code might race and invoke UB as here <code>while(p.size() &gt; r.size())</code> the access to <code>p.size()</code> is <b>not</b> protected."}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 9666826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9839862a5e0825ce306f54eeb0deee6b?s=128&d=identicon&r=PG&f=1", "display_name": "JDoe4444", "link": "https://stackoverflow.com/users/9666826/jdoe4444"}, "edited": false, "score": 0, "creation_date": 1525850525, "post_id": 50247585, "comment_id": 87512602, "body": "Thank you so much, I didn&#39;t know that the OS would be running threads that quickly to skip over other threads. I need to use a conditional variable. Thank you and to the others in the comments who helped me out with this. Thank you."}, {"owner": {"reputation": 22874, "user_id": 3282056, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/IXonK.jpg?s=128&g=1", "display_name": "rcgldr", "link": "https://stackoverflow.com/users/3282056/rcgldr"}, "reply_to_user": {"reputation": 35, "user_id": 9666826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9839862a5e0825ce306f54eeb0deee6b?s=128&d=identicon&r=PG&f=1", "display_name": "JDoe4444", "link": "https://stackoverflow.com/users/9666826/jdoe4444"}, "edited": false, "score": 0, "creation_date": 1525851209, "post_id": 50247585, "comment_id": 87512999, "body": "@JDoe4444 - its&#39; an OS dependent issue. As commented above, in the case of Windows (and other operating systems) using native synchronization interface, internal queues (or the equivalent) are used to order requests, eliminating issues like this or having to deal with spurious wakeups. Quick relocking isn&#39;t an issue for these operating systems because of the queuing forcing context switches as needed to preserve the order of requests."}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "reply_to_user": {"reputation": 35, "user_id": 9666826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9839862a5e0825ce306f54eeb0deee6b?s=128&d=identicon&r=PG&f=1", "display_name": "JDoe4444", "link": "https://stackoverflow.com/users/9666826/jdoe4444"}, "edited": false, "score": 0, "creation_date": 1525872586, "post_id": 50247585, "comment_id": 87526695, "body": "@JDoe4444, you assumed that the mutex is implemented as a spin-lock, but that is not practical for a general-purpose mutex implementation running on a multi-tasking OS. If your <code>thread1</code> is blocked for any significant length of time then the OS will put it to sleep.  Then, when the main thread releases the mutex and immediately tries to lock it again, you&#39;ve got a race between a sleeping thread and one that is already in memory and running. Unless it&#39;s a so-called &quot;fair&quot; mutex, the already-running thread will always win that race."}], "tags": [], "owner": {"reputation": 1247, "user_id": 9107647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a43594ef3d74c11a31be7f9d5ebddc0?s=128&d=identicon&r=PG&f=1", "display_name": "Humphrey Winnebago", "link": "https://stackoverflow.com/users/9107647/humphrey-winnebago"}, "is_accepted": true, "score": 2, "last_activity_date": 1525850258, "creation_date": 1525850258, "answer_id": 50247585, "question_id": 50247371, "link": "https://stackoverflow.com/questions/50247371/why-doesnt-my-mutex-lock-before-my-other-thread-locks-it/50247585#50247585", "title": "Why doesn&#39;t my mutex lock before my other thread locks it?", "body": "<p>Your main thread is unlocking the mutex and then immediately locking it again. Try introducing a delay in your main loop (for testing purposes) to see if this is the issue.</p>\n\n<p>Check out the answer to this question:\n<a href=\"https://stackoverflow.com/questions/12685112/pthreads-thread-starvation-caused-by-quick-re-locking\">pthreads: thread starvation caused by quick re-locking</a></p>\n"}], "owner": {"reputation": 35, "user_id": 9666826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9839862a5e0825ce306f54eeb0deee6b?s=128&d=identicon&r=PG&f=1", "display_name": "JDoe4444", "link": "https://stackoverflow.com/users/9666826/jdoe4444"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1200, "favorite_count": 0, "accepted_answer_id": 50247585, "answer_count": 1, "score": 1, "last_activity_date": 1525850258, "creation_date": 1525849461, "last_edit_date": 1525849985, "question_id": 50247371, "link": "https://stackoverflow.com/questions/50247371/why-doesnt-my-mutex-lock-before-my-other-thread-locks-it", "title": "Why doesn&#39;t my mutex lock before my other thread locks it?", "body": "<p>I am running 1 thread created with pthreads and I'm using a mutex between the thread and my main thread. From what I understand, once a thread is ready to lock a mutex, it will spinlock until its able to lock. But I'm running into an issue where it doesn't spinlock. The pseudo code I have.</p>\n\n<p>Main thread:</p>\n\n<pre><code>//I create thread 1 on this line, then it enters the while loop\nwhile(p.size() &gt; r.size()){\n  pthread_mutex_lock(&amp;Mutex);\n  //calculations and decrease p.size()\n  pthread_mutex_unlock(&amp;Mutex);\n}\n</code></pre>\n\n<p>Thread 1:</p>\n\n<pre><code>//wait 500ms before hitting mutex\npthread_mutex_lock(&amp;Mutex);\n//calculations\npthread_mutex_unlock(&amp;Mutex);\n</code></pre>\n\n<p>The issue I'm running to is that the Thread 1 Mutex never locks until the main thread while loop exits. Thread 1 reaches the mutex lock before the main thread can finish the while loop.</p>\n\n<p>EDIT: If I had a delay of 10ms to the end of my while loop (after the mutex unlocks), then this fixes my problem. But how can I fix the problem without adding a delay of 10ms.</p>\n"}, {"tags": ["c", "uml", "sequence-diagram"], "comments": [{"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 0, "creation_date": 1525849484, "post_id": 50247215, "comment_id": 87512064, "body": "func_b will always be compiled it will just not be called. This is a normal if just that you make it dependent on a macro instead of a variable (for what ever reason) This looks like bad design, but maybe it is more complicated..."}, {"owner": {"reputation": 21, "user_id": 9762970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9734e694f892f3d28d77b2141bd6cf9f?s=128&d=identicon&r=PG&f=1", "display_name": "Noel Lee", "link": "https://stackoverflow.com/users/9762970/noel-lee"}, "reply_to_user": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 0, "creation_date": 1525849637, "post_id": 50247215, "comment_id": 87512142, "body": "Oh, Yes. funb_B will always be compiled but not called. I programmed kind of common code to use in every project, and the code can be configured by macro. so that I can spare time.."}, {"owner": {"reputation": 7686, "user_id": 2626313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/613888ad5bbd9ddba4bd81bbbfeb7a05?s=128&d=identicon&r=PG", "display_name": "xmojmr", "link": "https://stackoverflow.com/users/2626313/xmojmr"}, "edited": false, "score": 0, "creation_date": 1525850196, "post_id": 50247215, "comment_id": 87512429, "body": "See <a href=\"https://www.uml-diagrams.org/sequence-diagrams-combined-fragment.html#operator-opt\" rel=\"nofollow noreferrer\">uml-diagrams.org/&hellip;</a>"}, {"owner": {"reputation": 30989, "user_id": 3379653, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/f97JZ.png?s=128&g=1", "display_name": "qwerty_so", "link": "https://stackoverflow.com/users/3379653/qwerty-so"}, "reply_to_user": {"reputation": 7686, "user_id": 2626313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/613888ad5bbd9ddba4bd81bbbfeb7a05?s=128&d=identicon&r=PG", "display_name": "xmojmr", "link": "https://stackoverflow.com/users/2626313/xmojmr"}, "edited": false, "score": 0, "creation_date": 1525853211, "post_id": 50247215, "comment_id": 87514165, "body": "@xmojmr I thought about that, but this is no runtime condition. Actually it&#39;s a different object as tofro answered."}], "answers": [{"tags": [], "owner": {"reputation": 4888, "user_id": 5785362, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a786fd81952576dc07942023bf8830b?s=128&d=identicon&r=PG", "display_name": "tofro", "link": "https://stackoverflow.com/users/5785362/tofro"}, "is_accepted": false, "score": 1, "last_activity_date": 1525849644, "creation_date": 1525849644, "answer_id": 50247431, "question_id": 50247215, "link": "https://stackoverflow.com/questions/50247215/how-can-i-describe-a-sequence-diagram-message-which-could-be-disabled-or-enabled/50247431#50247431", "title": "How can I describe a sequence diagram message which could be disabled or enabled by pre-processor in a sequence diagram", "body": "<p>The conditional compilation actually builds <em>two different</em> programs with two different settings of your preprocessor switch.</p>\n\n<p>There is no foreseen way to be able to put two programs in one sequence diagram.</p>\n"}, {"tags": [], "owner": {"reputation": 30989, "user_id": 3379653, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/f97JZ.png?s=128&g=1", "display_name": "qwerty_so", "link": "https://stackoverflow.com/users/3379653/qwerty-so"}, "is_accepted": false, "score": 1, "last_activity_date": 1525853077, "creation_date": 1525853077, "answer_id": 50248419, "question_id": 50247215, "link": "https://stackoverflow.com/questions/50247215/how-can-i-describe-a-sequence-diagram-message-which-could-be-disabled-or-enabled/50248419#50248419", "title": "How can I describe a sequence diagram message which could be disabled or enabled by pre-processor in a sequence diagram", "body": "<p>Basically what @tofro answered. You can create 2 different SDs where one could look like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/iEsZj.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/iEsZj.png\" alt=\"enter image description here\"></a></p>\n\n<p>and the other just without the <code>func_B</code> call and an adapted note.</p>\n"}], "owner": {"reputation": 21, "user_id": 9762970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9734e694f892f3d28d77b2141bd6cf9f?s=128&d=identicon&r=PG&f=1", "display_name": "Noel Lee", "link": "https://stackoverflow.com/users/9762970/noel-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1525853077, "creation_date": 1525848903, "question_id": 50247215, "link": "https://stackoverflow.com/questions/50247215/how-can-i-describe-a-sequence-diagram-message-which-could-be-disabled-or-enabled", "title": "How can I describe a sequence diagram message which could be disabled or enabled by pre-processor in a sequence diagram", "body": "<p>I am currently drawing a sequence diagram for a module spec document.</p>\n\n<p>The reason I am considering is that I don't know how to describe conditional compile code in a sequence diagram.</p>\n\n<p>for example,</p>\n\n<pre><code>void func_A( void )\n{\n#if (A == Yes)\n    func_B();\n#endif\n}\n</code></pre>\n\n<p>in this code, func_B is compiled if A is Yes, but can not be compiled if A is No.</p>\n\n<p>How can I draw a sequence diagram with that kind of code?</p>\n"}, {"tags": ["c", "function"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1525847006, "post_id": 50246730, "comment_id": 87510884, "body": "Just initialize the variable to zero on definition?"}, {"owner": {"reputation": 2375, "user_id": 3985859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34af6d164c53c629e625c11a3d11bbcc?s=128&d=identicon&r=PG&f=1", "display_name": "Karsten Koop", "link": "https://stackoverflow.com/users/3985859/karsten-koop"}, "edited": false, "score": 4, "creation_date": 1525847076, "post_id": 50246730, "comment_id": 87510918, "body": "What happens when <code>osMutexWait()</code> does not return zero? -&gt; <code>word_value</code> will be used unitialized."}, {"owner": {"reputation": 14308, "user_id": 1989425, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/aGyIU.png?s=128&g=1", "display_name": "autistic", "link": "https://stackoverflow.com/users/1989425/autistic"}, "edited": false, "score": 1, "creation_date": 1525847463, "post_id": 50246730, "comment_id": 87511109, "body": "Since you haven&#39;t told us a thing about what you expect this code to do, we can&#39;t actually help you. The correct initialisation value hinges upon that logic which you have not explained to us. Additionally, the <code>mutex</code> tag is irrelevant here, as you could comment it out and still have the same problem you&#39;ve described."}, {"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 0, "creation_date": 1525847559, "post_id": 50246730, "comment_id": 87511133, "body": "If you know the reason for this message, can you explain it? If yes please explain why you can not initialize the variable."}, {"owner": {"reputation": 14308, "user_id": 1989425, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/aGyIU.png?s=128&g=1", "display_name": "autistic", "link": "https://stackoverflow.com/users/1989425/autistic"}, "edited": false, "score": 0, "creation_date": 1525847880, "post_id": 50246730, "comment_id": 87511272, "body": "If we search for the error you quote, <a href=\"https://stackoverflow.com/questions/20526053/c-warning-withdrawal-amt-may-be-used-uninitialized-in-this-function\">this question is a duplicate</a>..."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1525847895, "post_id": 50246730, "comment_id": 87511283, "body": "You should handle the case when <code>osMutexWait</code> returns something else than zero."}, {"owner": {"reputation": 1052, "user_id": 3698648, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/199b49d13342baa233c08aac5793ed4d?s=128&d=identicon&r=PG&f=1", "display_name": "ntshetty", "link": "https://stackoverflow.com/users/3698648/ntshetty"}, "edited": false, "score": 0, "creation_date": 1525848055, "post_id": 50246730, "comment_id": 87511359, "body": "Usually, the auto variables by default hold garbage, so it&#39;s better to initialize to <code>zero</code> or <code>specific value</code>"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1525848600, "post_id": 50246730, "comment_id": 87511638, "body": "What do you want to return if osMutexWait fails?"}, {"owner": {"reputation": 310760, "user_id": 12711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c330bdee507c95c603a93ca91d9145a9?s=128&d=identicon&r=PG", "display_name": "Michael Burr", "link": "https://stackoverflow.com/users/12711/michael-burr"}, "edited": false, "score": 0, "creation_date": 1525852393, "post_id": 50246730, "comment_id": 87513679, "body": "A couple notes unrelated to your specific question: <code>(*(m_BitsArray + word))</code> is written more idiomatically as <code>m_BitsArray[word]</code> and <code>if((word_value &amp; mask) &gt;&gt; index)</code> is equivalent to <code>if (word_value &amp; mask)</code>."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 2267, "user_id": 8242447, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M6884.gif?s=128&g=1", "display_name": "\u1e42\u0173\u1efb\u1ecbg\u01fb\u0148\u1ea1c\u1ec3\u01a1\u1eed\u1e69", "link": "https://stackoverflow.com/users/8242447/%e1%b9%82%c5%b3%e1%bb%bb%e1%bb%8bg%c7%bb%c5%88%e1%ba%a1c%e1%bb%83%c6%a1%e1%bb%ad%e1%b9%a9"}, "edited": false, "score": 0, "creation_date": 1525854835, "post_id": 50246730, "comment_id": 87515041, "body": "@Mulliganaceous The boolean type in C is <code>_Bool</code>, which can have values <code>1</code> or <code>0</code>. But if you like, you can use <code>stdbool.h</code> to enable the macros <code>bool</code>, <code>false</code> and <code>true</code>. Anything else is non-standard."}, {"owner": {"reputation": 569, "user_id": 6006544, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/dd1ce8be57e814c5564600bcfc5786e3?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/6006544/steve"}, "edited": false, "score": 0, "creation_date": 1525933123, "post_id": 50246730, "comment_id": 87551134, "body": "The problem is that I don&#39;t know what is the appropriate initialization value. This value will be used in case the mutex won&#39;t be released in prescribed time interval."}], "owner": {"reputation": 569, "user_id": 6006544, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/dd1ce8be57e814c5564600bcfc5786e3?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/6006544/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1525851595, "creation_date": 1525846945, "last_edit_date": 1525851595, "question_id": 50246730, "link": "https://stackoverflow.com/questions/50246730/initialization-of-local-variable-in-c-controlled-by-a-mutex", "title": "Initialization of local variable in C controlled by a mutex", "body": "<p>I have encountered a problem regarding initialization of local variable in C.\nThe code is following:</p>\n\n<pre><code>BOOL IsBitSet(uint32_t BitAddr)\n{\n    uint32_t word, index, mask, word_value;\n    BOOL retval = FALSE;\n\n    word   = GetWordValue(BitAddr);   // index of the logic word in bits array\n    index  = GetIndex(BitAddr, word); // index of the bit in logic word\n    mask = (1 &lt;&lt; index);              // mask for the bit\n\n\n    // get the logic word value\n    // osOK = 0x0\n    if(!osMutexWait(m_BitsArrayMutex, 100)){\n        word_value = (*(m_BitsArray + word));\n        osMutexRelease(m_BitsArrayMutex);\n    }\n\n    // test the bit\n    if((word_value &amp; mask) &gt;&gt; index){\n        retval = TRUE;\n    }else{\n        retval = FALSE;\n    }\n\n    return retval;\n}\n</code></pre>\n\n<p>The problem is that the compiler creates an error message </p>\n\n<blockquote>\n  <p>error: 'word_value' may be used uninitialized in this function\"</p>\n</blockquote>\n\n<p>I understand the reason of this\nerror message but I don't know how to resolve this issue. I don't know what \nshould be the correct initialization value for the local variable <code>word_value</code>.\nDoes anybody have any idea how to appropriately resolve this problem? </p>\n"}, {"tags": ["c", "recursion", "return", "return-value"], "comments": [{"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1525844527, "post_id": 50246195, "comment_id": 87509859, "body": "The function is specified to return something, but doesn&#39;t. Aren&#39;t you wondering how you can even get away with that? Regardless of the result?"}, {"owner": {"reputation": 1506, "user_id": 2730823, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/4623cbeb8c4522e734c2d1968ee894c0?s=128&d=identicon&r=PG", "display_name": "gandalf3", "link": "https://stackoverflow.com/users/2730823/gandalf3"}, "reply_to_user": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1525844544, "post_id": 50246195, "comment_id": 87509868, "body": "@StoryTeller Yes, that&#39;s exactly what I&#39;m wondering."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 4, "creation_date": 1525844551, "post_id": 50246195, "comment_id": 87509871, "body": "Trying to discuss behavior of <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\"><i>undefined behavior</i></a> is pointless."}, {"owner": {"reputation": 96743, "user_id": 2455888, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/MQu4W.png?s=128&g=1", "display_name": "haccks", "link": "https://stackoverflow.com/users/2455888/haccks"}, "edited": false, "score": 0, "creation_date": 1525844578, "post_id": 50246195, "comment_id": 87509884, "body": "Your compiler should raise a warning about this."}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1525844644, "post_id": 50246195, "comment_id": 87509913, "body": "This is highly relevant <a href=\"https://stackoverflow.com/questions/9936011/if-a-function-returns-no-value-with-a-valid-return-type-is-it-okay-to-for-the\" title=\"if a function returns no value with a valid return type is it okay to for the\">stackoverflow.com/questions/9936011/&hellip;</a>"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1525844656, "post_id": 50246195, "comment_id": 87509915, "body": "One of the many nasal demons being released by this could be that more or less accidentally the return value of the parent call happens to be the return value of the last child call, because/in spite of the lack or a <code>return</code>."}, {"owner": {"reputation": 1506, "user_id": 2730823, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/4623cbeb8c4522e734c2d1968ee894c0?s=128&d=identicon&r=PG", "display_name": "gandalf3", "link": "https://stackoverflow.com/users/2730823/gandalf3"}, "edited": false, "score": 0, "creation_date": 1525855067, "post_id": 50246195, "comment_id": 87515168, "body": "Also possibly a duplicate of <a href=\"https://stackoverflow.com/q/14753444/2730823\">stackoverflow.com/q/14753444/2730823</a>"}], "answers": [{"comments": [{"owner": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "edited": false, "score": 1, "creation_date": 1525844776, "post_id": 50246264, "comment_id": 87509961, "body": "The question didn&#39;t ask about C++."}, {"owner": {"reputation": 3856, "user_id": 4188894, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jj4yA.jpg?s=128&g=1", "display_name": "Gyapti Jain", "link": "https://stackoverflow.com/users/4188894/gyapti-jain"}, "reply_to_user": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "edited": false, "score": 1, "creation_date": 1525844797, "post_id": 50246264, "comment_id": 87509973, "body": "@aschepler it was tagged C/C++."}, {"owner": {"reputation": 1506, "user_id": 2730823, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/4623cbeb8c4522e734c2d1968ee894c0?s=128&d=identicon&r=PG", "display_name": "gandalf3", "link": "https://stackoverflow.com/users/2730823/gandalf3"}, "reply_to_user": {"reputation": 65594, "user_id": 459640, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/bc790307b3c4cdbd25f582d9067651f1?s=128&d=identicon&r=PG", "display_name": "aschepler", "link": "https://stackoverflow.com/users/459640/aschepler"}, "edited": false, "score": 0, "creation_date": 1525844902, "post_id": 50246264, "comment_id": 87510020, "body": "@aschepler Indeed, I wasn&#39;t sure if it being C or C++ would have any bearing on this (and it if it did, I would&#39;ve been interested in what exactly that bearing was)"}, {"owner": {"reputation": 3856, "user_id": 4188894, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jj4yA.jpg?s=128&g=1", "display_name": "Gyapti Jain", "link": "https://stackoverflow.com/users/4188894/gyapti-jain"}, "reply_to_user": {"reputation": 1506, "user_id": 2730823, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/4623cbeb8c4522e734c2d1968ee894c0?s=128&d=identicon&r=PG", "display_name": "gandalf3", "link": "https://stackoverflow.com/users/2730823/gandalf3"}, "edited": false, "score": 1, "creation_date": 1525845015, "post_id": 50246264, "comment_id": 87510067, "body": "@gandalf3 In C function returning by value may not return <b>as long as</b> caller doesn&#39;t use the return value. In C++, it doesn&#39;t matter whether caller is using the return value or not, the bahaviour is undefined if function did not return."}], "tags": [], "owner": {"reputation": 3856, "user_id": 4188894, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jj4yA.jpg?s=128&g=1", "display_name": "Gyapti Jain", "link": "https://stackoverflow.com/users/4188894/gyapti-jain"}, "is_accepted": true, "score": 5, "last_activity_date": 1525844781, "last_edit_date": 1525844781, "creation_date": 1525844629, "answer_id": 50246264, "question_id": 50246195, "link": "https://stackoverflow.com/questions/50246195/why-does-this-recursive-function-return-the-correct-value/50246264#50246264", "title": "Why does this recursive function return the correct value?", "body": "<p>For C section is 6.9.1 from N1256:</p>\n\n<blockquote>\n  <p>If the } that terminates a function is reached, and the value of the\n  function call is used by the caller, the behavior is undefined.</p>\n</blockquote>\n\n<p>So the behaviour of your program is <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined</a>. </p>\n\n<blockquote>\n  <p>Why does this work?</p>\n</blockquote>\n\n<p>There is a possibility that the target + compiler you are using doesn't tamper the register containing the return value from last (recursive) function call. C doesn't mandate this mechanism for returning value in specs.</p>\n\n<p>So, though it may sound sensible, this is not guaranteed.</p>\n"}], "owner": {"reputation": 1506, "user_id": 2730823, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/4623cbeb8c4522e734c2d1968ee894c0?s=128&d=identicon&r=PG", "display_name": "gandalf3", "link": "https://stackoverflow.com/users/2730823/gandalf3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "closed_date": 1525846681, "accepted_answer_id": 50246264, "answer_count": 1, "score": 4, "last_activity_date": 1525844781, "creation_date": 1525844292, "last_edit_date": 1525844497, "question_id": 50246195, "link": "https://stackoverflow.com/questions/50246195/why-does-this-recursive-function-return-the-correct-value", "closed_reason": "Duplicate", "title": "Why does this recursive function return the correct value?", "body": "<p>Running a recursive function such as this one (compiled in gcc 7.3.1):</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint arr[] = {5,1,2,6,7,3};\nint arraySize = 6;\n\nint recfind(int value, int index)\n{\n    if (arr[index] == value)\n        return 1;\n    if (index &gt;= arraySize)\n        return 0;\n    // return recfind(value, ++index);\n    recfind(value, ++index);\n }\n\nint main() {\n    printf(\"found 6? %d\\n\", recfind(6, 0));\n    printf(\"found 9? %d\\n\", recfind(9, 0));\n}\n</code></pre>\n\n<p>I get the following output:</p>\n\n<pre><code>found 6? 1\nfound 9? 0\n</code></pre>\n\n<p>Why does this work? Since the result of the recursive <code>recfind</code> call is not returned, how is the return value of higher-level calls chosen?</p>\n"}, {"tags": ["c++", "c", "sizeof"], "comments": [{"owner": {"reputation": 6951, "user_id": 3475381, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b6a1c5d19f4ae8c6a1dbf097487c96d7?s=128&d=identicon&r=PG&f=1", "display_name": "Gaurav Sehgal", "link": "https://stackoverflow.com/users/3475381/gaurav-sehgal"}, "edited": false, "score": 0, "creation_date": 1525843342, "post_id": 50245950, "comment_id": 87509424, "body": "<code>sizeof(*ptr);</code> is UB since <code>ptr</code> isn&#39;t pointing to a valid memory."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1525843361, "post_id": 50245950, "comment_id": 87509432, "body": "<code>sizeof</code> is not a function. It&#39;s a unary operator."}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "reply_to_user": {"reputation": 6951, "user_id": 3475381, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b6a1c5d19f4ae8c6a1dbf097487c96d7?s=128&d=identicon&r=PG&f=1", "display_name": "Gaurav Sehgal", "link": "https://stackoverflow.com/users/3475381/gaurav-sehgal"}, "edited": false, "score": 7, "creation_date": 1525843377, "post_id": 50245950, "comment_id": 87509444, "body": "@GauravSehgal - No, it&#39;s not UB."}, {"owner": {"reputation": 6951, "user_id": 3475381, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b6a1c5d19f4ae8c6a1dbf097487c96d7?s=128&d=identicon&r=PG&f=1", "display_name": "Gaurav Sehgal", "link": "https://stackoverflow.com/users/3475381/gaurav-sehgal"}, "reply_to_user": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1525843667, "post_id": 50245950, "comment_id": 87509548, "body": "@StoryTeller Thanks. Got it cleared from <a href=\"https://stackoverflow.com/questions/7721184/is-sizeofptr-undefined-behavior-when-pointing-to-invalid-memory\">here</a>."}], "answers": [{"tags": [], "owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "is_accepted": true, "score": 9, "last_activity_date": 1525843901, "last_edit_date": 1525843901, "creation_date": 1525843558, "answer_id": 50246075, "question_id": 50245950, "link": "https://stackoverflow.com/questions/50245950/does-sizeof-struct-pointer-give-you-the-value-of-structure/50246075#50246075", "title": "Does sizeof(* struct pointer) give you the value of structure", "body": "<blockquote>\n  <p>I tried this piece of code in C using gcc compiler and that gave me the size of the structure itself</p>\n</blockquote>\n\n<p>As it should. The argument to the unary <code>sizeof</code> operator can be either an expression or a parenthesized type name. All expressions in C have a type. And what <code>sizeof</code> is meant do is to look at the type the expression would evaluate to, and give the size of that type.</p>\n\n<p>Since <code>*ptr</code> is an expression of the type <code>struct sample</code>, the result should be the size of <code>struct sample</code>. It's also worth mentioning that generally the expression doesn't even need to be evaluated, the size can be determined statically (unless you are dealing with a VLA).</p>\n\n<p>You can rely on that behavior, because that's what the C standard specifies it should do. It will always give the size of the structure. You can't rely on the size being the same across compilers, but you can be sure of the behavior <code>sizeof</code> will have. </p>\n\n<p>Since your own example uses pointers, one place where this behavior can be useful is described in <a href=\"https://stackoverflow.com/questions/605845/do-i-cast-the-result-of-malloc\">\"Do I cast the result of malloc?\"</a>, where you'd feed <code>malloc</code> the size of the dereferenced pointer, instead of the type:</p>\n\n<pre><code>struct sample * ptr = malloc(sizeof *ptr);\n</code></pre>\n\n<p>The rationale being that you don't need to repeat the type name twice (thrice in C++, where you'd need a cast as well), helping you to avoid subtle mistakes that may come when refactoring.</p>\n"}], "owner": {"reputation": 29, "user_id": 6532092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54473de9a918a799d876bc7db76f1189?s=128&d=identicon&r=PG&f=1", "display_name": "Ajay", "link": "https://stackoverflow.com/users/6532092/ajay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1128, "favorite_count": 1, "accepted_answer_id": 50246075, "answer_count": 1, "score": 0, "last_activity_date": 1525843901, "creation_date": 1525842899, "last_edit_date": 1525843437, "question_id": 50245950, "link": "https://stackoverflow.com/questions/50245950/does-sizeof-struct-pointer-give-you-the-value-of-structure", "title": "Does sizeof(* struct pointer) give you the value of structure", "body": "<p>I have a structure like this\nWhat would be the output of sizeof function.</p>\n\n<pre><code>struct sample\n{\n    int a;\n    char b;\n};\n\nstruct sample obj;\nstruct sample * ptr;\n\nsizeof(*ptr);\n</code></pre>\n\n<p>I tried this piece of code in C using gcc compiler and that gave me the size of the structure itself.\nBut i'm doubtful whether this would yield the same result when tried with other C compilers and also with C++.</p>\n\n<p>Could you please help me on this.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["c", "linux", "segmentation-fault"], "comments": [{"owner": {"reputation": 695058, "user_id": 20862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2343ae368d3241278581ce6c87f62a25?s=128&d=identicon&r=PG", "display_name": "Ignacio Vazquez-Abrams", "link": "https://stackoverflow.com/users/20862/ignacio-vazquez-abrams"}, "edited": false, "score": 1, "creation_date": 1525840904, "post_id": 50245606, "comment_id": 87508679, "body": "You can&#39;t dereference a null pointer into anything meaningful."}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "reply_to_user": {"reputation": 695058, "user_id": 20862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2343ae368d3241278581ce6c87f62a25?s=128&d=identicon&r=PG", "display_name": "Ignacio Vazquez-Abrams", "link": "https://stackoverflow.com/users/20862/ignacio-vazquez-abrams"}, "edited": false, "score": 1, "creation_date": 1526216717, "post_id": 50245606, "comment_id": 87648616, "body": "@IgnacioVazquez-Abrams: Which null pointer?"}, {"owner": {"reputation": 652, "user_id": 9347417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4eade3369e9b12786525484f752e6ed?s=128&d=identicon&r=PG&f=1", "display_name": "TheEngineer", "link": "https://stackoverflow.com/users/9347417/theengineer"}, "reply_to_user": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1529212516, "post_id": 50245606, "comment_id": 88787982, "body": "@alk I believe he meant the &quot;uninitialized pointer&quot; =&gt; char *buffer;"}], "answers": [{"comments": [{"owner": {"reputation": 652, "user_id": 9347417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4eade3369e9b12786525484f752e6ed?s=128&d=identicon&r=PG&f=1", "display_name": "TheEngineer", "link": "https://stackoverflow.com/users/9347417/theengineer"}, "edited": false, "score": 0, "creation_date": 1525842144, "post_id": 50245681, "comment_id": 87509055, "body": "thank you. So in order to fix the problem, should I just initialize it to something(null for example)?"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "reply_to_user": {"reputation": 652, "user_id": 9347417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4eade3369e9b12786525484f752e6ed?s=128&d=identicon&r=PG&f=1", "display_name": "TheEngineer", "link": "https://stackoverflow.com/users/9347417/theengineer"}, "edited": false, "score": 0, "creation_date": 1525846762, "post_id": 50245681, "comment_id": 87510792, "body": "@TheEngineer maybe you should initialize it to NULL, but more important: you never should dereference un uninitialized pointer (neither a NULL pointer BTW)."}, {"owner": {"reputation": 1151, "user_id": 3251114, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1962b0fb57738c0e07ec47c38ef64cd3?s=128&d=identicon&r=PG&f=1", "display_name": "andypea", "link": "https://stackoverflow.com/users/3251114/andypea"}, "edited": false, "score": 0, "creation_date": 1525848490, "post_id": 50245681, "comment_id": 87511574, "body": "<code>buffer = 0</code> of <code>buffer = NULL</code> would be both make sense. However, you must ensure that you do not dereference them elsewhere in your program."}], "tags": [], "owner": {"reputation": 1151, "user_id": 3251114, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1962b0fb57738c0e07ec47c38ef64cd3?s=128&d=identicon&r=PG&f=1", "display_name": "andypea", "link": "https://stackoverflow.com/users/3251114/andypea"}, "is_accepted": true, "score": 6, "last_activity_date": 1525848867, "last_edit_date": 1525848867, "creation_date": 1525841118, "answer_id": 50245681, "question_id": 50245606, "link": "https://stackoverflow.com/questions/50245606/making-char-pointer-pointing-to-null-causes-segmentation-fault/50245681#50245681", "title": "making char pointer pointing to null causes segmentation fault", "body": "<p>The final line of your function, <code>*buffer = 0</code>, is attempting to set the value referred to by the pointer <code>buffer</code>.</p>\n\n<p>As <code>buffer</code> has never been initialised and therefore contains and an indeterminate value, dereferencing <code>buffer</code> is very likely to cause a segfault.</p>\n\n<p>For most projects you should never write argument parsing code yourself. There are many robust and efficient libraries that will do a much better job than you (or I) could. As you are writing C on Linux <a href=\"https://www.gnu.org/software/libc/manual/html_node/Parsing-Program-Arguments.html#Parsing-Program-Arguments\" rel=\"nofollow noreferrer\">GNU getopt</a> is a good option.</p>\n"}, {"tags": [], "owner": {"reputation": 1602, "user_id": 6023771, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/67e7bfd227dd05ce79a8e4a4f18f37c2?s=128&d=identicon&r=PG&f=1", "display_name": "zee", "link": "https://stackoverflow.com/users/6023771/zee"}, "is_accepted": false, "score": 1, "last_activity_date": 1525845086, "creation_date": 1525845086, "answer_id": 50246350, "question_id": 50245606, "link": "https://stackoverflow.com/questions/50245606/making-char-pointer-pointing-to-null-causes-segmentation-fault/50246350#50246350", "title": "making char pointer pointing to null causes segmentation fault", "body": "<p>if you go through your program line by line you'll see that if the user doesn't pass any arguments then buffer is just a random value. As another comment said you need to initialize it. In your case I don't think you literally want to put the value <code>0</code> in the memory address that buffer points to. Here is code that shows how to handle arguments</p>\n\n<pre><code>int main(int argc, char **argv){\n    char *buffer = NULL;\n    if(argc &gt; 1){\n        buffer = argv[1];\n    }\n    else{\n        buffer = malloc(1024);\n        puts(\"please enter an argument\");\n        fgets(buffer, 1024, stdin);\n        //do stuff with buffer\n        free(buffer)\n    }\n    return 0;\n}\n</code></pre>\n\n<p>in the code above the program checks if any arguments were passed to the program, if no arguments were passed then the program allocated 1024 bytes and points buffer to that memory location and then asks the user for input. From this point you can do what ever you want with buffer.</p>\n"}, {"tags": [], "owner": {"reputation": 1049, "user_id": 6633483, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/rWKTg.jpg?s=128&g=1", "display_name": "Vijay S B", "link": "https://stackoverflow.com/users/6633483/vijay-s-b"}, "is_accepted": false, "score": 0, "last_activity_date": 1525937680, "creation_date": 1525937680, "answer_id": 50267879, "question_id": 50245606, "link": "https://stackoverflow.com/questions/50245606/making-char-pointer-pointing-to-null-causes-segmentation-fault/50267879#50267879", "title": "making char pointer pointing to null causes segmentation fault", "body": "<p><code>buffer</code> character pointer is not initialised. Since <code>buffer</code> is declared with auto storage class it will have a garbage value. You are trying to access a uninitialized pointer which is a memory access exception hence it gave a seg fault. Before accessing <code>buffer</code> allocate a memory using calloc or malloc. </p>\n"}], "owner": {"reputation": 652, "user_id": 9347417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4eade3369e9b12786525484f752e6ed?s=128&d=identicon&r=PG&f=1", "display_name": "TheEngineer", "link": "https://stackoverflow.com/users/9347417/theengineer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 454, "favorite_count": 0, "accepted_answer_id": 50245681, "answer_count": 3, "score": 1, "last_activity_date": 1525937680, "creation_date": 1525840652, "question_id": 50245606, "link": "https://stackoverflow.com/questions/50245606/making-char-pointer-pointing-to-null-causes-segmentation-fault", "title": "making char pointer pointing to null causes segmentation fault", "body": "<p>in linux, I am trying the below code which is causing segmentation fault error:</p>\n\n<pre><code>int main(int arg_count,char *args[]){  \n    char *buffer;\n    if(arg_count&gt;1)\n      buffer = args[1];\n    else \n      *buffer = 0;\n }\n</code></pre>\n\n<p>I know that pointers point to read only part of the memory, so I changed my first try <code>buffer[0]=0;</code> to above. But I don't understand why this one is not working either?!</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1525840377, "post_id": 50245525, "comment_id": 87508553, "body": "What makes you think it is not right? Crash? Hang? Misbehaviour? Compiler errror?"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 2, "creation_date": 1525840671, "post_id": 50245525, "comment_id": 87508611, "body": "I formatted and indented your program for you. Look at it. I think the problems are obvious now. Or maybe not, did you double check that the code you show here is identical to the code you have? Please copy paste instead of typing again. I cannot believe that this code even compiles. What are the errors your compiler tells you? Did you copmile strictly, e.g. at least with <code>gcc -Wall</code>? Please edit the code until it at least compiles without errors. Better without errors and warnings. Ideally without errors or strict warnings."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1525840921, "post_id": 50245525, "comment_id": 87508685, "body": "The code after your edit still looks like: broken snytax for <code>if-else</code>, <code>do-while</code> and <code>main</code>. Also the newly added <code>for</code> loop does not have an effect. Would you like to base your code on working example from tutorials? Start with a HelloWorld. Add in a correct <code>do-while</code>. Insert a working <code>if-else</code>. Insert a working <code>for</code>. Add to place the code you want."}, {"owner": {"reputation": 11, "user_id": 9274835, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-StixgcO26bA/AAAAAAAAAAI/AAAAAAAAAEw/IcqDvU2CiRY/photo.jpg?sz=128", "display_name": "Rishi Srivastava", "link": "https://stackoverflow.com/users/9274835/rishi-srivastava"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1525841341, "post_id": 50245525, "comment_id": 87508796, "body": "so would you tell me the correct code sir. i am newbie in programming"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1525841650, "post_id": 50245525, "comment_id": 87508891, "body": "I provided the syntax elements, which you really should have picked up from a tutorial or book. Now the actual problem of your code is the question. What is not working? You did not ask a question here about the syntax of random constructs, instead you are trying to achieve a certain behaviour, aren&#39;t you? Talk about that, after you edited your code to actually be what you have at your place. Make a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. Double check that the code you post here acts as the one at home."}, {"owner": {"reputation": 11, "user_id": 9274835, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-StixgcO26bA/AAAAAAAAAAI/AAAAAAAAAEw/IcqDvU2CiRY/photo.jpg?sz=128", "display_name": "Rishi Srivastava", "link": "https://stackoverflow.com/users/9274835/rishi-srivastava"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1525841756, "post_id": 50245525, "comment_id": 87508927, "body": "there was no any syntax misstake when i compiled"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1525841828, "post_id": 50245525, "comment_id": 87508948, "body": "Which means that the code you compiled is very different from the one you show here. Please make sure they are identical. Do not type again. Copy paste after turning the code you compile into a MCVE and compiled again."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1525841872, "post_id": 50245525, "comment_id": 87508970, "body": "What makes you think it is not right? Crash? Hang? Misbehaviour? Compiler errror?"}, {"owner": {"reputation": 11, "user_id": 9274835, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-StixgcO26bA/AAAAAAAAAAI/AAAAAAAAAEw/IcqDvU2CiRY/photo.jpg?sz=128", "display_name": "Rishi Srivastava", "link": "https://stackoverflow.com/users/9274835/rishi-srivastava"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1525842126, "post_id": 50245525, "comment_id": 87509045, "body": "i wrote the same code which is written here but the problem is program should read only integer until user enter negative integer or number of positive integer reaches up to 15"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1525842294, "post_id": 50245525, "comment_id": 87509107, "body": "If the code you show here is identical to the code you compile  successfully at home, then you have a - lets say - extremly interesting compiler. Please double check that the code here and at home are identical and also please double check that you really compile the code you are looking at and not accidentally any other code in your file system."}, {"owner": {"reputation": 11, "user_id": 9274835, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-StixgcO26bA/AAAAAAAAAAI/AAAAAAAAAEw/IcqDvU2CiRY/photo.jpg?sz=128", "display_name": "Rishi Srivastava", "link": "https://stackoverflow.com/users/9274835/rishi-srivastava"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1525842609, "post_id": 50245525, "comment_id": 87509200, "body": "i wrote for(count=0;count&lt;15;count++); when i use ; for is supposed to end . there is no need of { and }. same happens with else statement . so my syntax was right."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1525842641, "post_id": 50245525, "comment_id": 87509215, "body": "That is at least correct syntax, but it does not do anything."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1525842649, "post_id": 50245525, "comment_id": 87509220, "body": "What makes you think it is not right? Crash? Hang? Misbehaviour? Compiler errror?"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1525842725, "post_id": 50245525, "comment_id": 87509245, "body": "Please take the <a href=\"https://stackoverflow.com/tour\">tour</a> again, read <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a> and study and apply the concept of making a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. Also have a look at this checklist: <a href=\"https://codeblog.jonskeet.uk/2012/11/24/stack-overflow-question-checklist/\" rel=\"nofollow noreferrer\">codeblog.jonskeet.uk/2012/11/24/&hellip;</a>"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1525842913, "post_id": 50245525, "comment_id": 87509302, "body": "Alternatively, if you code is as short as what you showed here, <a href=\"https://stackoverflow.com/posts/50245525/edit\">edit</a> your question, delete the code which is there, copy the code you compile at home and paste it again. I will even take care of correct formatting for you."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1525844155, "post_id": 50245525, "comment_id": 87509729, "body": "The shown code cannot be compiled without errors, at least for the misplaced <code>else;</code> and the botched loop condition. It also contains an endless loop and a useless loop and (most harmless of all) you seem to have forgotten the last closing <code>}</code>.  I pay your dinner for a year (if you come here) if that code is actually compiled without errors. Please, please double check that the shown code is identical to the code you compile successfully."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1525943850, "post_id": 50245525, "comment_id": 87556324, "body": "Do you still need help with this? If not please make an answer which shows the solution to your problem. If yes please explain the remaining problem. Have a look here <a href=\"https://stackoverflow.com/help/someone-answers\">stackoverflow.com/help/someone-answers</a>"}], "answers": [{"tags": [], "owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "is_accepted": false, "score": 0, "last_activity_date": 1525843171, "last_edit_date": 1525843171, "creation_date": 1525841253, "answer_id": 50245693, "question_id": 50245525, "link": "https://stackoverflow.com/questions/50245525/read-integer-untill-user-reaches-negative-integer-or-numbers-of-integer-reaches/50245693#50245693", "title": "Read integer untill user reaches negative integer or numbers of integer reaches upto 15", "body": "<p>Please use building blocks of correct syntax:</p>\n\n<p>main:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint main(void)\n{ \n    /* other code */\n    return 0;\n}\n</code></pre>\n\n<p>do-while:</p>\n\n<pre><code>do\n{\n    /* other code */\n} while(count&gt;=0);\n</code></pre>\n\n<p>if:</p>\n\n<pre><code>if(a&gt;0 )\n{\n    /* code if true */\n} else\n{\n    /* code if false */\n}\n</code></pre>\n\n<p>for:</p>\n\n<pre><code>for(a=0;a&lt;15;a++)\n{\n    /* repeated code */\n}\n</code></pre>\n\n<p>For getting input right, please read:  </p>\n\n<p><a href=\"http://sekrit.de/webdocs/c/beginners-guide-away-from-scanf.html\" rel=\"nofollow noreferrer\">http://sekrit.de/webdocs/c/beginners-guide-away-from-scanf.html</a><br>\n<a href=\"https://stackoverflow.com/questions/35178520/how-to-read-parse-input-in-c-the-faq\">How to read / parse input in C? The FAQ</a></p>\n\n<p>When the syntax is right and the input is done correctly, then we can discuss the behaviour of your code; which I think is what you are actually asking about.   Though what you are describing might already be solved/achieved once you spend some work on how to get input properly, based on the links above.</p>\n"}], "owner": {"reputation": 11, "user_id": 9274835, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-StixgcO26bA/AAAAAAAAAAI/AAAAAAAAAEw/IcqDvU2CiRY/photo.jpg?sz=128", "display_name": "Rishi Srivastava", "link": "https://stackoverflow.com/users/9274835/rishi-srivastava"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525843171, "creation_date": 1525840158, "last_edit_date": 1525841440, "question_id": 50245525, "link": "https://stackoverflow.com/questions/50245525/read-integer-untill-user-reaches-negative-integer-or-numbers-of-integer-reaches", "title": "Read integer untill user reaches negative integer or numbers of integer reaches upto 15", "body": "<p>i wrote following program but it is not right. would you please assist me where i went wrong?</p>\n\n<pre><code>#include&lt;stdio.h&gt;\nvoid main()\n{ \n    int count=0,a;\n    do\n    {\n       scanf(\"%d\",&amp;a);\n       if(a&gt;0 )\n       {\n         for(count=0;count&lt;15;count++);\n           else;\n       }\n       while(int&gt;=0);\n    }\n</code></pre>\n\n<p>So would you tell me the correct code?</p>\n"}, {"tags": ["c", "linux", "unix", "posix"], "comments": [{"owner": {"reputation": 695058, "user_id": 20862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2343ae368d3241278581ce6c87f62a25?s=128&d=identicon&r=PG", "display_name": "Ignacio Vazquez-Abrams", "link": "https://stackoverflow.com/users/20862/ignacio-vazquez-abrams"}, "edited": false, "score": 2, "creation_date": 1525839052, "post_id": 50245373, "comment_id": 87508233, "body": "Not according to POSIX/SUS."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1525839418, "post_id": 50245373, "comment_id": 87508316, "body": "<code>if (clock_gettime (CLOCK_MONOTONIC, &amp;time) == -1) perror (&quot;clock_gettime&quot;);</code> ??"}], "answers": [{"comments": [{"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 1, "creation_date": 1525872693, "post_id": 50245437, "comment_id": 87526789, "body": "All of the <code>_POSIX_</code> macros have really complicated semantics.  Quoting <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/unistd.h.html\" rel=\"nofollow noreferrer\">pubs.opengroup.org/onlinepubs/9699919799/basedefs/unistd.h.h&zwnj;&#8203;tml</a> : &quot;If a symbolic constant is not defined or is defined with the value -1, the option is not supported for compilation. If it is defined with a value greater than zero, the option shall always be supported when the application is executed. If it is defined with the value zero, the option shall be supported for compilation and might or might not be supported at runtime.&quot;  So you have to do a three-way #if and you might still need a runtime test."}], "tags": [], "owner": {"reputation": 826, "user_id": 1402389, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/599c4eaaff0f5d2c3fe5feca6560173b?s=128&d=identicon&r=PG", "display_name": "FBergo", "link": "https://stackoverflow.com/users/1402389/fbergo"}, "is_accepted": false, "score": 2, "last_activity_date": 1525931779, "last_edit_date": 1525931779, "creation_date": 1525839426, "answer_id": 50245437, "question_id": 50245373, "link": "https://stackoverflow.com/questions/50245373/how-to-check-if-the-system-supports-monotonic-clock/50245437#50245437", "title": "How to check if the system supports &quot;Monotonic Clock&quot;?", "body": "<p>POSIX only requires that <code>CLOCK_REALTIME</code> be present, other clocks are optional.</p>\n\n<p>If the monotonic clock is available, the macro <code>_POSIX_MONOTONIC_CLOCK</code> will be defined in <code>unistd.h</code> (according to the <strong>Availability</strong> section of the <a href=\"https://linux.die.net/man/3/clock_gettime\" rel=\"nofollow noreferrer\">man page</a>)</p>\n"}, {"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1525857593, "post_id": 50245503, "comment_id": 87516722, "body": "&quot;Personally, though, I would just use CLOCK_MONOTONIC unconditionally unless and until someone complained.&quot;, something that don&#39;t implement it don&#39;t deserve our program ;)"}, {"owner": {"reputation": 14947, "user_id": 900078, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/83stK.jpg?s=128&g=1", "display_name": "pynexj", "link": "https://stackoverflow.com/users/900078/pynexj"}, "edited": false, "score": 0, "creation_date": 1525877615, "post_id": 50245503, "comment_id": 87530451, "body": "see my answer to see the interesting result on macOS."}], "tags": [], "owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "is_accepted": true, "score": 6, "last_activity_date": 1525875068, "last_edit_date": 1525875068, "creation_date": 1525839981, "answer_id": 50245503, "question_id": 50245373, "link": "https://stackoverflow.com/questions/50245373/how-to-check-if-the-system-supports-monotonic-clock/50245503#50245503", "title": "How to check if the system supports &quot;Monotonic Clock&quot;?", "body": "<p>Per the letter of POSIX, you may in fact need a runtime test even if the constant <code>CLOCK_MONOTONIC</code> is defined.  The official way to handle this is with the <code>_POSIX_MONOTONIC_CLOCK</code> \"feature-test macro\", but those macros have really complicated semantics: quoting <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/unistd.h.html\" rel=\"noreferrer\">http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/unistd.h.html</a> ,</p>\n\n<blockquote>\n  <p>If a symbolic constant is not defined or is defined with the value -1, the option is not supported for compilation. If it is defined with a value greater than zero, the option shall always be supported when the application is executed. If it is defined with the value zero, the option shall be supported for compilation and might or might not be supported at runtime.</p>\n</blockquote>\n\n<p>Translating that three-way distinction into code would give you something like this:</p>\n\n<pre><code>#if !defined _POSIX_MONOTONIC_CLOCK || _POSIX_MONOTONIC_CLOCK &lt; 0\n    clock_gettime(CLOCK_REALTIME, &amp;spec);\n#elif _POSIX_MONOTONIC_CLOCK &gt; 0\n    clock_gettime(CLOCK_MONOTONIC, &amp;spec);\n#else\n    if (clock_gettime(CLOCK_MONOTONIC, &amp;spec))\n        clock_gettime(CLOCK_REALTIME, &amp;spec));\n#endif\n</code></pre>\n\n<p>But it's simpler and more readable if you just always do the runtime test when CLOCK_MONOTONIC itself is defined:</p>\n\n<pre><code>#ifdef CLOCK_MONOTONIC\n    if (clock_gettime(CLOCK_MONOTONIC, &amp;spec))\n#endif\n        clock_gettime(CLOCK_REALTIME, &amp;spec);\n</code></pre>\n\n<p>This increases the size of your code by some trivial amount on current-generation OSes that do support <code>CLOCK_MONOTONIC</code>, but the readability benefits are worth it in my opinion.</p>\n\n<p>There is also a pretty strong argument for using <code>CLOCK_MONOTONIC</code> unconditionally; you're more likely to find an OS that doesn't support <code>clock_gettime</code> at all (e.g. MacOS X still doesn't have it as far as I know)  than an OS that has <code>clock_gettime</code> but not <code>CLOCK_MONOTONIC</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 0, "creation_date": 1525879083, "post_id": 50256242, "comment_id": 87531427, "body": "I&#39;m pleasantly surprised to learn that OSX 10.13 does have clock_gettime and CLOCK_MONOTONIC.  The associated <code>_POSIX_</code> and <code>_SC_</code> tests saying it doesn&#39;t, that&#39;s a plain old bug."}], "tags": [], "owner": {"reputation": 14947, "user_id": 900078, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/83stK.jpg?s=128&g=1", "display_name": "pynexj", "link": "https://stackoverflow.com/users/900078/pynexj"}, "is_accepted": false, "score": 2, "last_activity_date": 1536290810, "last_edit_date": 1536290810, "creation_date": 1525877279, "answer_id": 50256242, "question_id": 50245373, "link": "https://stackoverflow.com/questions/50245373/how-to-check-if-the-system-supports-monotonic-clock/50256242#50256242", "title": "How to check if the system supports &quot;Monotonic Clock&quot;?", "body": "<p>As shown in @zwol's answer, things really get a bit complicated and interesing --</p>\n\n<p>See the following simple program (<code>foo.c</code>):</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;time.h&gt;\n\nint\nmain()\n{\n    struct timespec spec;\n\n    printf(\"_POSIX_MONOTONIC_CLOCK         = %d\\n\",\n           (int)_POSIX_MONOTONIC_CLOCK);\n    printf(\"sysconf(_SC_MONOTONIC_CLOCK)   = %ld\\n\",\n           sysconf(_SC_MONOTONIC_CLOCK) );\n    printf(\"clock_gettime(CLOCK_MONOTONIC) = %d\\n\",\n           clock_gettime(CLOCK_MONOTONIC, &amp; spec) );\n\n    return 0;\n}\n</code></pre>\n\n<p>On Linux (Debian 9, x86_64):</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[STEP 101] # uname -a\nLinux debian9 4.9.0-6-amd64 #1 SMP Debian 4.9.88-1 (2018-04-29) x86_64 GNU/Linux\n[STEP 102] # gcc foo.c &amp;&amp; ./a.out\n_POSIX_MONOTONIC_CLOCK         = 0\nsysconf(_SC_MONOTONIC_CLOCK)   = 200809\nclock_gettime(CLOCK_MONOTONIC) = 0\n[STEP 103] #\n</code></pre>\n\n<p>On macOS (10.13, High Sierra):</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[STEP 201] $ uname -a\nDarwin macbook.home 17.5.0 Darwin Kernel Version 17.5.0: Fri Apr 13 19:32:32 PDT 2018; root:xnu-4570.51.2~1/RELEASE_X86_64 x86_64\n[STEP 202] $ cc foo.c &amp;&amp; ./a.out\n_POSIX_MONOTONIC_CLOCK         = -1\nsysconf(_SC_MONOTONIC_CLOCK)   = -1\nclock_gettime(CLOCK_MONOTONIC) = 0\n[STEP 203] $\n</code></pre>\n\n<p>On FreeBSD (11.1, x86_64):</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[STEP 301] # uname -a\nFreeBSD freebsd 11.1-RELEASE FreeBSD 11.1-RELEASE #0 r321309: Fri Jul 21 02:08:28 UTC 2017     root@releng2.nyi.freebsd.org:/usr/obj/usr/src/sys/GENERIC  amd64\n[STEP 302] # cc foo.c &amp;&amp; ./a.out \n_POSIX_MONOTONIC_CLOCK         = 200112\nsysconf(_SC_MONOTONIC_CLOCK)   = 200112\nclock_gettime(CLOCK_MONOTONIC) = 0\n[STEP 303] #\n</code></pre>\n\n<p>The result on macOS really surprised me. <code>sysconf()</code> returns <code>-1</code> but <code>clock_gettime(CLOCK_MONOTONIC)</code> succeeds! Not sure if this indicate macOS is not POSIX compliant. Anyway it proves <strong>runtime checking with <code>sysconf()</code> is not reliable!</strong></p>\n\n<p>Finally I'm going with this:</p>\n\n<pre><code>int\nClock_gettime(struct timespec * spec)\n{\n    static bool firstime = true;\n    static clockid_t clock = CLOCK_REALTIME;\n\n    if (firstime) {\n        firstime = false;\n#ifdef CLOCK_MONOTONIC\n        if (clock_gettime(CLOCK_MONOTONIC, spec) == 0) {\n            clock = CLOCK_MONOTONIC;\n            return 0;\n        }\n#endif\n    }\n\n    return clock_gettime(clock, spec);\n}\n</code></pre>\n"}], "owner": {"reputation": 14947, "user_id": 900078, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/83stK.jpg?s=128&g=1", "display_name": "pynexj", "link": "https://stackoverflow.com/users/900078/pynexj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1495, "favorite_count": 1, "accepted_answer_id": 50245503, "answer_count": 3, "score": 6, "last_activity_date": 1536290810, "creation_date": 1525838954, "last_edit_date": 1525925012, "question_id": 50245373, "link": "https://stackoverflow.com/questions/50245373/how-to-check-if-the-system-supports-monotonic-clock", "title": "How to check if the system supports &quot;Monotonic Clock&quot;?", "body": "<p>I need to handle timeout scenarios in code and want to use <code>clock_gettime(CLOCK_MONOTONIC)</code> if the system supports Monotonic Clock.</p>\n\n<pre><code>#ifdef CLOCK_MONOTONIC\n    clock_gettime(CLOCK_MONOTONIC, &amp; spec);\n#else\n    clock_gettime(CLOCK_REALTIME,  &amp; spec);\n#endif\n</code></pre>\n\n<p>I'm not sure if this is enough. That's to say, is it possible that the system defines <code>CLOCK_MONOTONIC</code> by it does not really support monotonic clock? Or what's the reliable way to check if monotonic clock is supported?</p>\n"}, {"tags": ["c", "clang", "objective-c-blocks"], "comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 15800, "user_id": 1274314, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/gSYsp.jpg?s=128&g=1", "display_name": "TypeIA", "link": "https://stackoverflow.com/users/1274314/typeia"}, "edited": false, "score": 0, "creation_date": 1525838816, "post_id": 50245274, "comment_id": 87508173, "body": "@TypeIA it is &quot;C&quot;"}, {"owner": {"reputation": 15800, "user_id": 1274314, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/gSYsp.jpg?s=128&g=1", "display_name": "TypeIA", "link": "https://stackoverflow.com/users/1274314/typeia"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1525838881, "post_id": 50245274, "comment_id": 87508180, "body": "@AnttiHaapala All right, maybe I&#39;m about to learn something... what&#39;s up with the carets?"}, {"owner": {"reputation": 449, "user_id": 3261968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75a63f78de31a66bbead94b35edd3a1?s=128&d=identicon&r=PG&f=1", "display_name": "SultanLegend", "link": "https://stackoverflow.com/users/3261968/sultanlegend"}, "edited": false, "score": 0, "creation_date": 1525838905, "post_id": 50245274, "comment_id": 87508188, "body": "I think it is only technically &quot;C&quot;. Blocks are a feature of clang <a href=\"https://clang.llvm.org/docs/BlockLanguageSpec.html\" rel=\"nofollow noreferrer\">clang.llvm.org/docs/BlockLanguageSpec.html</a> I am trying to learn to use them because I like high order functions."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 15800, "user_id": 1274314, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/gSYsp.jpg?s=128&g=1", "display_name": "TypeIA", "link": "https://stackoverflow.com/users/1274314/typeia"}, "edited": false, "score": 0, "creation_date": 1525838907, "post_id": 50245274, "comment_id": 87508189, "body": "@TypeIA they&#39;re a Clang extension for blocks"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1525838959, "post_id": 50245274, "comment_id": 87508198, "body": "In any case, <code>func</code> is a name that perhaps shouldn&#39;t be there."}, {"owner": {"reputation": 449, "user_id": 3261968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75a63f78de31a66bbead94b35edd3a1?s=128&d=identicon&r=PG&f=1", "display_name": "SultanLegend", "link": "https://stackoverflow.com/users/3261968/sultanlegend"}, "reply_to_user": {"reputation": 15800, "user_id": 1274314, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/gSYsp.jpg?s=128&g=1", "display_name": "TypeIA", "link": "https://stackoverflow.com/users/1274314/typeia"}, "edited": false, "score": 0, "creation_date": 1525838973, "post_id": 50245274, "comment_id": 87508202, "body": "@TypeIA I believe the ^ (carets) denote a block pointer instead of a function pointer. I thought they would have the same syntax."}, {"owner": {"reputation": 449, "user_id": 3261968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75a63f78de31a66bbead94b35edd3a1?s=128&d=identicon&r=PG&f=1", "display_name": "SultanLegend", "link": "https://stackoverflow.com/users/3261968/sultanlegend"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1525839033, "post_id": 50245274, "comment_id": 87508222, "body": "@AnttiHaapala I was trying to use <code>func</code> as the parameter name. The parameter is suppose to be a function pointer. I am struggling with the syntax."}, {"owner": {"reputation": 15800, "user_id": 1274314, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/gSYsp.jpg?s=128&g=1", "display_name": "TypeIA", "link": "https://stackoverflow.com/users/1274314/typeia"}, "edited": false, "score": 0, "creation_date": 1525839038, "post_id": 50245274, "comment_id": 87508225, "body": "I see, thanks for the lesson. I&#39;d not come across that feature of clang. I suppose the tags are perfect then."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1525839675, "post_id": 50245274, "comment_id": 87508371, "body": "You&#39;ve declared a block that takes an <code>int</code> and a <code>char **</code> and returns an <code>int</code>. And then you&#39;ve initialized it with mush. Which is to say that I&#39;m as confused as the compiler. What are you actually trying to accomplish?"}, {"owner": {"reputation": 449, "user_id": 3261968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75a63f78de31a66bbead94b35edd3a1?s=128&d=identicon&r=PG&f=1", "display_name": "SultanLegend", "link": "https://stackoverflow.com/users/3261968/sultanlegend"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1525839867, "post_id": 50245274, "comment_id": 87508414, "body": "@user3386109 I am trying to make an auto block wrapper for functions with the type signature (int, char**).   I want a call to f2b(a_function) to return a block that just calls a_function with the parameters passed to it."}, {"owner": {"reputation": 449, "user_id": 3261968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75a63f78de31a66bbead94b35edd3a1?s=128&d=identicon&r=PG&f=1", "display_name": "SultanLegend", "link": "https://stackoverflow.com/users/3261968/sultanlegend"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1525840092, "post_id": 50245274, "comment_id": 87508480, "body": "@user3386109 I meant to make a block that takes a function that takes an <code>int</code> and a <code>char **</code>"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1525840914, "post_id": 50245274, "comment_id": 87508682, "body": "@SultanLegend I took my best guess, and posted an answer."}, {"owner": {"reputation": 449, "user_id": 3261968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75a63f78de31a66bbead94b35edd3a1?s=128&d=identicon&r=PG&f=1", "display_name": "SultanLegend", "link": "https://stackoverflow.com/users/3261968/sultanlegend"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1525891540, "post_id": 50245274, "comment_id": 87538201, "body": "@AnttiHaapala I don&#39;t know Objective-c, does the objective-c-blocks belong on this question? Is it that the code is valid objective-c or that this code uses capabilities that came directly from objective-c?"}, {"owner": {"reputation": 109950, "user_id": 86989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd262de5d82a235eeb64f71e4058198?s=128&d=identicon&r=PG", "display_name": "newacct", "link": "https://stackoverflow.com/users/86989/newacct"}, "edited": false, "score": 0, "creation_date": 1527529089, "post_id": 50245274, "comment_id": 88152161, "body": "@SultanLegend: Blocks is a Clang feature that is almost entirely used in Objective-C, as an anonymous function and closure syntax for that language, and is used extensively in the Apple iOS and macOS APIs. Technically, Blocks are available in pure C too, when using Clang, but rarely does anyone use it in C. The term &quot;Blocks&quot; is ambiguous by itself, as the C syntax of using braces to group statements together can also be called &quot;blocks&quot;, so &quot;objective-c-blocks&quot; is the best tag for this feature, even though it is technically available in pure C"}], "answers": [{"tags": [], "owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "is_accepted": true, "score": 2, "last_activity_date": 1525903932, "last_edit_date": 1525903932, "creation_date": 1525840734, "answer_id": 50245619, "question_id": 50245274, "link": "https://stackoverflow.com/questions/50245274/block-signature-for-block-that-takes-a-function-pointer-and-returns-a-block/50245619#50245619", "title": "Block signature for block that takes a function pointer and returns a block", "body": "<p>The key is the <code>Block_copy</code> function from <code>&lt;Block.h&gt;</code><sup>1</sup>. That puts a copy of a block on the heap, which allows the block to be returned.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;Block.h&gt;\n\ntypedef int (^block_t)(int, char **);\ntypedef int (*func_t)(int, char **);\n\nblock_t (^createBlock)(func_t func) = ^(func_t func)\n{\n    return Block_copy( ^(int argc, char **argv) { return func(argc, argv); } );\n};\n\nint showFirst(int argc, char *argv[])\n{\n    printf(\"%s\\n\", argv[0]);\n    return argc;\n}\n\nint main(void)\n{\n    int argc = 3;\n    char *argv[] = {\"hello\", \"world\", NULL};\n\n    block_t block1 = createBlock(showFirst);\n    int count = block1(argc, argv);\n    printf(\"count=%d\\n\", count);\n    Block_release(block1);\n}\n</code></pre>\n\n<p><code>createBlock</code> takes a function pointer as its argument, and returns a block with the signature <code>int (^block)(int, char **)</code>. </p>\n\n<p><code>showFirst</code> is just one possible implementation of the function that can be passed to <code>createBlock</code>. It displays the first string in the <code>argv</code> array and returns the value in <code>argc</code>.</p>\n\n<p>The <code>main</code> function creates a block from the <code>showfirst</code> function. It then invokes the block, prints the returned value, and releases the block.</p>\n\n<p>The output from the code is:</p>\n\n<blockquote>\n  <p>hello<br>\n  count=3</p>\n</blockquote>\n\n<hr>\n\n<p><sup>1</sup> I was not aware of <code>&lt;Block.h&gt;</code> until reading OP's answer.</p>\n"}, {"tags": [], "owner": {"reputation": 449, "user_id": 3261968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75a63f78de31a66bbead94b35edd3a1?s=128&d=identicon&r=PG&f=1", "display_name": "SultanLegend", "link": "https://stackoverflow.com/users/3261968/sultanlegend"}, "is_accepted": false, "score": 1, "last_activity_date": 1525891148, "last_edit_date": 1525891148, "creation_date": 1525842789, "answer_id": 50245927, "question_id": 50245274, "link": "https://stackoverflow.com/questions/50245274/block-signature-for-block-that-takes-a-function-pointer-and-returns-a-block/50245927#50245927", "title": "Block signature for block that takes a function pointer and returns a block", "body": "<p><a href=\"http://thirdcog.eu/pwcblocks/\" rel=\"nofollow noreferrer\">http://thirdcog.eu/pwcblocks/</a> helped a lot.</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;Block.h&gt;\n\nint fake_main(int argc, char** words)\n{\n  printf(\"%s\\n\", (char*)words);\n  return argc;\n}\n\nint main(int argc, char* argv[])\n{\n  typedef int(*main_type_func)(int, char**);\n  typedef int(^main_type)(int, char**);\n  typedef main_type(^f2b_type)(main_type_func);\n\n  f2b_type f2b = ^ (main_type_func func)\n    {\n      return Block_copy(^ (int apple, char** ban)\n      {\n        return func(apple, ban);\n      });\n    };\n\n  printf(\"%d\\n\", f2b(fake_main)(1, \"words worked\"));\n}\n</code></pre>\n\n<p>This is a minimum example of accomplishing the goals I outlined in the question.</p>\n\n<p>The trick is the typedefs. Simplify the type signature by creating typedefs to help. I recommend that you use these whenever you want to accept and/or return a function pointer/block pointer.</p>\n\n<p>Block_copy() moves the block from the stack into the heap.</p>\n\n<p>It would be more correct to save the block pointer returned from</p>\n\n<pre><code>f2b(fake_main)\n</code></pre>\n\n<p>Then after use call</p>\n\n<pre><code>Block_release()\n</code></pre>\n\n<p>On it.</p>\n"}, {"tags": [], "owner": {"reputation": 109950, "user_id": 86989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd262de5d82a235eeb64f71e4058198?s=128&d=identicon&r=PG", "display_name": "newacct", "link": "https://stackoverflow.com/users/86989/newacct"}, "is_accepted": false, "score": 1, "last_activity_date": 1527528023, "last_edit_date": 1527528023, "creation_date": 1527459281, "answer_id": 50556988, "question_id": 50245274, "link": "https://stackoverflow.com/questions/50245274/block-signature-for-block-that-takes-a-function-pointer-and-returns-a-block/50556988#50556988", "title": "Block signature for block that takes a function pointer and returns a block", "body": "<p>Your type syntax is incorrect. Based on your usage, I'm guessing you are declaring <code>f2b</code> to be a pointer to a block, which takes a pointer to a function that takes an <code>int</code> and a <code>char **</code> and returns an <code>int</code>, and the block returns another block that takes an <code>int</code> and a <code>char **</code> and returns an <code>int</code>.</p>\n\n<p>The proper syntax for that declaration would be:</p>\n\n<pre><code>int (^(^f2b)(int (*) (int, char **)))(int, char **)\n</code></pre>\n\n<p>The syntax for more complicated C types is often counter-intuitive, especially in cases of multiple levels of functions and arrays.</p>\n\n<p>The ever-useful cdecl.org website supports blocks: <a href=\"https://cdecl.org/?q=declare+f2b+as+block%28pointer+to+function%28int%2C+pointer+to+pointer+to+char%29+returning+int%29+returning+block%28int%2C+pointer+to+pointer+to+char%29+returning+int\" rel=\"nofollow noreferrer\">declare f2b as block(pointer to function(int, pointer to pointer to char) returning int) returning block(int, pointer to pointer to char) returning int</a> (they say \"block\" whereas I say \"pointer to block\")</p>\n\n<p>Your block definition written out using full block literal syntax (including return types) would be something like this (remembering to copy the block in order to return it):</p>\n\n<pre><code>int (^(^f2b)(int (*) (int, char **)))(int, char **) =\n^int (^(int (*func)(int, char **)))(int, char **) {\n    return Block_copy(^int (int argc, char **argv) {\n        return func(argc, argv);\n    });\n};\n</code></pre>\n\n<p>Return types may be omitted in block literals, so it could be written like:</p>\n\n<pre><code>int (^(^f2b)(int (*) (int, char **)))(int, char **) =\n^(int (*func)(int, char **)) {\n    return Block_copy(^(int argc, char **argv) {\n        return func(argc, argv);\n    });\n};\n</code></pre>\n"}], "owner": {"reputation": 449, "user_id": 3261968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75a63f78de31a66bbead94b35edd3a1?s=128&d=identicon&r=PG&f=1", "display_name": "SultanLegend", "link": "https://stackoverflow.com/users/3261968/sultanlegend"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "accepted_answer_id": 50245619, "answer_count": 3, "score": 1, "last_activity_date": 1527528023, "creation_date": 1525837988, "last_edit_date": 1525845149, "question_id": 50245274, "link": "https://stackoverflow.com/questions/50245274/block-signature-for-block-that-takes-a-function-pointer-and-returns-a-block", "title": "Block signature for block that takes a function pointer and returns a block", "body": "<p>I am using clang on linux.\nWhat is the correct way to format this block?</p>\n\n<pre><code>(int ^(int, char**)) (^f2b)(int, char**) = (int ^(int, char**)) ((int (*func)(int, char**)))\n{\n  return int ^(int argc, char** argv){ func(argc, argv)};\n};\n</code></pre>\n\n<p>I am getting an error</p>\n\n<p><code>error: type-id cannot have a name\nint (^f2b)(int, char**) = (int ^(int, char**)) ((int (*func)(int, char**)))</code></p>\n\n<p>The error underlines (*func).</p>\n\n<p>I am trying to create a block that takes in a function pointer named func as a parameter and returns a block that calls that func using the arguments it is passed.</p>\n"}, {"tags": ["c", "visual-studio-code", "windows-subsystem-for-linux"], "answers": [{"comments": [{"owner": {"reputation": 445, "user_id": 4717826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c83f029beec5b4aabaa10385395649cf?s=128&d=identicon&r=PG&f=1", "display_name": "Davo", "link": "https://stackoverflow.com/users/4717826/davo"}, "edited": false, "score": 0, "creation_date": 1551221276, "post_id": 50244779, "comment_id": 96559727, "body": "Thank you :) do you happen to know what&#39;s the easiest way to configure the <code>launch.json</code> for debugging?"}], "tags": [], "owner": {"reputation": 1249, "user_id": 3199109, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2ea70f0c2a432ffbb9e5875039645b39?s=128&d=identicon&r=PG&f=1", "display_name": "loganhuskins", "link": "https://stackoverflow.com/users/3199109/loganhuskins"}, "is_accepted": false, "score": 8, "last_activity_date": 1548338830, "last_edit_date": 1548338830, "creation_date": 1525833795, "answer_id": 50244779, "question_id": 50244620, "link": "https://stackoverflow.com/questions/50244620/c-c-in-vs-code-with-linux-subsystem-for-windows/50244779#50244779", "title": "C\\C++ in VS Code with Linux Subsystem For Windows", "body": "<p>Figured it out thanks to <a href=\"https://github.com/Microsoft/vscode-cpptools/issues/1041#issuecomment-330885162\" rel=\"noreferrer\">this</a> comment on a Github issue.</p>\n\n<p>I took the command they recommended and edited it to use C and not C++ and ran it in WSL:</p>\n\n<pre><code>gcc -v -E -x c -\n</code></pre>\n\n<p>It listed where all gcc was looking for C libs, among other things. I copied that list and put the individual paths in the \"includePath\" and \"path\" arrays. Here is my updated c_cpp_properties.json file:</p>\n\n<pre><code>{\n  \"configurations\": [\n    {\n      \"name\": \"WSL\",\n      \"intelliSenseMode\": \"clang-x64\",\n      \"compilerPath\": \"/usr/bin/gcc\",\n      \"includePath\": [\n        \"${workspaceFolder}\",\n        \"/usr/include/x86_64-linux-gnu/5/include\",\n        \"/usr/local/include\",\n        \"/usr/include/x86_64-linux-gnu/5/include-fixed\",\n        \"/usr/include/x86_64-linux-gnu\",\n        \"/usr/include\"\n      ],\n      \"defines\": [],\n      \"browse\": {\n        \"path\": [\n          \"${workspaceFolder}\",\n          \"/usr/include/x86_64-linux-gnu/5/include\",\n          \"/usr/local/include\",\n          \"/usr/include/x86_64-linux-gnu/5/include-fixed\",\n          \"/usr/include/x86_64-linux-gnu\",\n          \"/usr/include\"\n        ],\n        \"limitSymbolsToIncludedHeaders\": true,\n        \"databaseFilename\": \"\"\n      },\n      \"cStandard\": \"c11\",\n      \"cppStandard\": \"c++17\"\n    }\n  ],\n  \"version\": 4\n}\n</code></pre>\n\n<p>Hope this helps someone.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 13393351, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-48WYkonpRTs/AAAAAAAAAAI/AAAAAAAAAAA/AAKWJJMVXbsP7h3MB9oVIs1UhEMGaSJSgg/photo.jpg?sz=128", "display_name": "William Meredith", "link": "https://stackoverflow.com/users/13393351/william-meredith"}, "is_accepted": false, "score": -1, "last_activity_date": 1587666835, "creation_date": 1587666835, "answer_id": 61394538, "question_id": 50244620, "link": "https://stackoverflow.com/questions/50244620/c-c-in-vs-code-with-linux-subsystem-for-windows/61394538#61394538", "title": "C\\C++ in VS Code with Linux Subsystem For Windows", "body": "<p>I am new to C++ but the way I fixed this issue was to find all of my possible include paths by searching for stddef.h on my machine and then adding these to my includePath in VS code. These are the paths that were added:</p>\n\n<p>C:\\Cygwin\\lib\\gcc\\x86_64-pc-cygwin\\9.3.0\\include</p>\n\n<p>C:\\Cygwin\\lib\\gcc\\i686-w64-mingw32\\9.2.0\\include</p>\n\n<p>C:\\Cygwin\\lib\\gcc\\x86_64-w64-mingw32\\9.2.0\\include</p>\n\n<p>C:\\Cygwin\\usr\\i686-w64-mingw32\\sys-root\\mingw\\include</p>\n\n<p>C:\\Cygwin\\usr\\x86_64-w64-mingw32\\sys-root\\mingw\\include</p>\n\n<p>C:\\Cygwin\\usr\\include\\c++\\v1</p>\n\n<p>C:\\Cygwin\\lib\\gcc\\i686-pc-cygwin\\6.4.0\\include</p>\n\n<p>C:\\Cygwin\\lib\\gcc\\i586-pc-msdosdjgpp\\5.4.0\\include</p>\n\n<p>C:\\Cygwin\\lib\\gcc\\i586-pc-msdosdjgpp\\5.4.0\\include-fixed</p>\n\n<p>C:\\Cygwin\\usr\\i586-pc-msdosdjgpp\\sys-include</p>\n\n<p>C:\\Cygwin\\lib\\clang\\8.0.1\\include</p>\n\n<p>C:\\Cygwin\\lib\\clang\\8.0.1\\include</p>\n"}], "owner": {"reputation": 1249, "user_id": 3199109, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2ea70f0c2a432ffbb9e5875039645b39?s=128&d=identicon&r=PG&f=1", "display_name": "loganhuskins", "link": "https://stackoverflow.com/users/3199109/loganhuskins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5351, "favorite_count": 1, "answer_count": 2, "score": 8, "last_activity_date": 1587666835, "creation_date": 1525832391, "last_edit_date": 1525833551, "question_id": 50244620, "link": "https://stackoverflow.com/questions/50244620/c-c-in-vs-code-with-linux-subsystem-for-windows", "title": "C\\C++ in VS Code with Linux Subsystem For Windows", "body": "<p>I am having issues getting my \"includes\" to work in my editor in VS Code on Windows 10 build 17134 using Linux Subsystem for Windows. I have the C/C++ extension installed and can run my application using the launch.json information outlined in the documentation <a href=\"https://github.com/Microsoft/vscode-cpptools/blob/master/Documentation/Debugger/gdb/Windows%20Subsystem%20for%20Linux.md\" rel=\"noreferrer\">here</a>.</p>\n\n<p>In their documentation <a href=\"https://github.com/Microsoft/vscode-cpptools/blob/master/Documentation/LanguageServer/Windows%20Subsystem%20for%20Linux.md\" rel=\"noreferrer\">here</a>, Microsoft outlines how to set up a c_cpp_properties.json to get around this issue, but it has not advanced me much. Currently, I am getting an error under my \"includes\" line which says:</p>\n\n<p><code>#include errors detected. Please update your includePath. IntelliSense features for this translation unit (C:\\Users\\Username\\Source\\c-lang\\hello.c) will be provided by the Tag Parser.\ncannot open source file \"stdio.h\"</code></p>\n\n<p>My c_cpp_properties.json:</p>\n\n<pre><code>{\n    \"configurations\": [\n         {\n             \"name\": \"WSL\",\n             \"intelliSenseMode\": \"clang-x64\",\n             \"compilerPath\": \"/usr/bin/gcc\",\n             \"includePath\": [\n                 \"${workspaceFolder}\",\n                 \"/usr/include/\"\n             ],\n             \"defines\": [],\n             \"browse\": {\n                 \"path\": [\n                     \"${workspaceFolder}\",\n                     \"/usr/include\"\n                 ],\n                 \"limitSymbolsToIncludedHeaders\": true,\n                 \"databaseFilename\": \"\",\n             },\n             \"cStandard\": \"c11\",\n             \"cppStandard\": \"c++17\"\n         }\n\n    ],\n    \"version\": 4\n}\n</code></pre>\n"}, {"tags": ["c", "multiprocessing"], "comments": [{"owner": {"reputation": 1471, "user_id": 6218471, "user_type": "registered", "accept_rate": 13, "profile_image": "https://www.gravatar.com/avatar/3f00ee8a3891494a2b1eef90d5348764?s=128&d=identicon&r=PG&f=1", "display_name": "Max Paython", "link": "https://stackoverflow.com/users/6218471/max-paython"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1525835411, "post_id": 50244579, "comment_id": 87507392, "body": "@Someprogrammerdude What do you mean by definitive bug ?"}, {"owner": {"reputation": 3794, "user_id": 7256714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adeb98b0e8995d8576ad5f66c0f982e5?s=128&d=identicon&r=PG&f=1", "display_name": "Pras", "link": "https://stackoverflow.com/users/7256714/pras"}, "edited": false, "score": 0, "creation_date": 1525835922, "post_id": 50244579, "comment_id": 87507481, "body": "You can try reseting errno at end of loop and check at start of loop to see you get anything when your loop reads beyond 6"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1525836551, "post_id": 50244579, "comment_id": 87507592, "body": "<a href=\"https://gist.github.com/pileon/9441a2b15ea498191715cda13c966ca1\" rel=\"nofollow noreferrer\">This simple program</a> replicates your behavior. <i>However</i>, if I uncomment the line with <code>fclose</code> it will work fine. Unless you need the file after the loop, you could &quot;fix&quot; your problem simply by closing it."}, {"owner": {"reputation": 1471, "user_id": 6218471, "user_type": "registered", "accept_rate": 13, "profile_image": "https://www.gravatar.com/avatar/3f00ee8a3891494a2b1eef90d5348764?s=128&d=identicon&r=PG&f=1", "display_name": "Max Paython", "link": "https://stackoverflow.com/users/6218471/max-paython"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1525837045, "post_id": 50244579, "comment_id": 87507706, "body": "@Someprogrammerdude why do you think closing it early(in the child process) fixes it ?"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 1, "creation_date": 1525837871, "post_id": 50244579, "comment_id": 87507923, "body": "To address your second theory directly: A child process with a file handle pointing at the same kernelspace structure exiting <b>does not</b> cause any kind of undesired/unusual/&amp;c. behavior."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 2, "creation_date": 1525838141, "post_id": 50244579, "comment_id": 87507994, "body": "@CharlesDuffy: until last week, I&#39;d have agreed with you.  However, see <a href=\"https://stackoverflow.com/questions/50110992/why-does-forking-my-process-cause-the-file-to-be-read-infinitely/50112169#50112169\">Why does forking my process cause the file to be read infinitely?</a>, which shows the the GNU C Library on Linux behaves peculiarly."}, {"owner": {"reputation": 1471, "user_id": 6218471, "user_type": "registered", "accept_rate": 13, "profile_image": "https://www.gravatar.com/avatar/3f00ee8a3891494a2b1eef90d5348764?s=128&d=identicon&r=PG&f=1", "display_name": "Max Paython", "link": "https://stackoverflow.com/users/6218471/max-paython"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1525838708, "post_id": 50244579, "comment_id": 87508153, "body": "@JonathanLeffler Please note that I too tested this C code in a Ubuntu 16.04 LTS in a VMWare system."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1525839115, "post_id": 50244579, "comment_id": 87508248, "body": "I think that this is really a duplicate of the cross-referenced question.  Does anyone see a reason not to close it as a duplicate?"}, {"owner": {"reputation": 454, "user_id": 8335309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/537ed45987ea630aef96d5d859bee820?s=128&d=identicon&r=PG&f=1", "display_name": "ImprobabilityCast", "link": "https://stackoverflow.com/users/8335309/improbabilitycast"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1525840312, "post_id": 50244579, "comment_id": 87508538, "body": "@JonathanLeffler I agree that it seems to be the same root problem as the other question. But if the OP doesn&#39;t think it answers his question, then I think the question should remain open."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1525840453, "post_id": 50244579, "comment_id": 87508568, "body": "If glibc did that unconditionally/regularly, this would be a well-known issue rather than a (rather astonishing) niche one. Curious as to the trigger."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1525846696, "post_id": 50244579, "comment_id": 87510760, "body": "@CharlesDuffy: I&#39;ve created GLIBC Bug 23151 (see update to my answer for URL)."}, {"owner": {"reputation": 4100, "user_id": 972499, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f0f65f88aac6e2a6d19e92950194955b?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/972499/jordan"}, "edited": false, "score": 0, "creation_date": 1525851393, "post_id": 50244579, "comment_id": 87513127, "body": "Have you tried using protection?"}], "answers": [{"comments": [{"owner": {"reputation": 454, "user_id": 8335309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/537ed45987ea630aef96d5d859bee820?s=128&d=identicon&r=PG&f=1", "display_name": "ImprobabilityCast", "link": "https://stackoverflow.com/users/8335309/improbabilitycast"}, "edited": false, "score": 1, "creation_date": 1525837437, "post_id": 50245116, "comment_id": 87507815, "body": "How does this relate to the while loop with the file I/O?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1525837967, "post_id": 50245116, "comment_id": 87507946, "body": "The loop in the code have a <code>break</code> in the child process. The child processes will not themselves call <code>fork</code> and create new processes."}, {"owner": {"reputation": 188, "user_id": 3986233, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/QKTYX.jpg?s=128&g=1", "display_name": "Master James", "link": "https://stackoverflow.com/users/3986233/master-james"}, "edited": false, "score": 0, "creation_date": 1525840243, "post_id": 50245116, "comment_id": 87508516, "body": "I&#39;ve added some details. I don&#39;t think that it will help. ;)"}, {"owner": {"reputation": 454, "user_id": 8335309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/537ed45987ea630aef96d5d859bee820?s=128&d=identicon&r=PG&f=1", "display_name": "ImprobabilityCast", "link": "https://stackoverflow.com/users/8335309/improbabilitycast"}, "edited": false, "score": 0, "creation_date": 1525841321, "post_id": 50245116, "comment_id": 87508789, "body": "What does all this parent-child stuff have to do with the loopy file I/O?"}], "tags": [], "owner": {"reputation": 188, "user_id": 3986233, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/QKTYX.jpg?s=128&g=1", "display_name": "Master James", "link": "https://stackoverflow.com/users/3986233/master-james"}, "is_accepted": false, "score": -1, "last_activity_date": 1525839992, "last_edit_date": 1525839992, "creation_date": 1525836711, "answer_id": 50245116, "question_id": 50244579, "link": "https://stackoverflow.com/questions/50244579/unwanted-child-processes-being-created-while-file-reading/50245116#50245116", "title": "Unwanted child processes being created while file reading", "body": "<p>Number of times reading every character in a text file is equal to number of process created. Total Number of Processes = 2n where n is number of fork system calls. So here n = 3, 2^3 = 8</p>\n\n<p>Let us put some label names for the three lines:</p>\n\n<pre><code>fork ();   // Line 1\nfork ();   // Line 2\nfork ();   // Line 3\n\n      L1       // There will be 1 child process \n   /     \\     // created by line 1.\n  L2      L2    // There will be 2 child processes\n /  \\    /  \\   //  created by line 2\nL3  L3  L3  L3  // There will be 4 child processes \n            // created by line 3\n</code></pre>\n\n<p>Example:  </p>\n\n<pre><code>int main()\n{\nfork();\nfork();\nfork();\nprintf(\"Gwapo ko\\n\");\nreturn 0;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Gwapo ko\nGwapo ko\nGwapo ko\nGwapo ko\nGwapo ko\nGwapo ko\nGwapo ko\nGwapo ko\n</code></pre>\n\n<p>Check this another example:</p>\n\n<pre><code>void forkexample() \n{\n// child process because return value zero\nif (fork()==0)\n    printf(\"Hello from Child!\\n\");\n\n// parent process because return value non-zero.\nelse    \n    printf(\"Hello from Parent!\\n\"); \n}\nint main()\n{ \nforkexample();\nreturn 0; \n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>1.\nHello from Child!\nHello from Parent!\n     (or)\n2.\nHello from Parent!\nHello from Child!\n</code></pre>\n\n<p>A child process is created, fork() returns 0 in the child process and positive integer to the parent process.\nHere, two outputs are possible because parent process and child process are running concurrently. So we don\u2019t know if OS first give control to which process a parent process or a child process will be closed.</p>\n\n<p>Important: Parent process and child process are running same program, but it does not mean they are identical. OS allocate different data and state for these two processes and also control flow of these processes can be different .</p>\n\n<p>Theory: It might be that the closed process is a child process and not the parent process, leaving the parent process and other child processes.</p>\n"}, {"comments": [{"owner": {"reputation": 1471, "user_id": 6218471, "user_type": "registered", "accept_rate": 13, "profile_image": "https://www.gravatar.com/avatar/3f00ee8a3891494a2b1eef90d5348764?s=128&d=identicon&r=PG&f=1", "display_name": "Max Paython", "link": "https://stackoverflow.com/users/6218471/max-paython"}, "edited": false, "score": 0, "creation_date": 1525840650, "post_id": 50245276, "comment_id": 87508606, "body": "I think this pretty much answers the question. However, it would be nice to find the root of the problem, maybe help fixing it, preventing this weird effect in the first place."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 1471, "user_id": 6218471, "user_type": "registered", "accept_rate": 13, "profile_image": "https://www.gravatar.com/avatar/3f00ee8a3891494a2b1eef90d5348764?s=128&d=identicon&r=PG&f=1", "display_name": "Max Paython", "link": "https://stackoverflow.com/users/6218471/max-paython"}, "edited": false, "score": 1, "creation_date": 1525841155, "post_id": 50245276, "comment_id": 87508740, "body": "I guess the simplest thing to do is to create a bug against the GNU C Library using your code and/or the code in the other Q&amp;A.  In theory, we should verify against the bug lists that this is a new bug, but it is tempting just to enter the bug anyway.  The bug report could sensibly cross-reference both questions on SO, but should include the code of at least one of the programs that illustrates the problem."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 1471, "user_id": 6218471, "user_type": "registered", "accept_rate": 13, "profile_image": "https://www.gravatar.com/avatar/3f00ee8a3891494a2b1eef90d5348764?s=128&d=identicon&r=PG&f=1", "display_name": "Max Paython", "link": "https://stackoverflow.com/users/6218471/max-paython"}, "edited": false, "score": 1, "creation_date": 1525879489, "post_id": 50245276, "comment_id": 87531714, "body": "Bug 23151 has been rejected as invalid.  I&#39;ve put the discussion and explanation of what that is about in the <a href=\"https://stackoverflow.com/questions/50110992/\">other question</a> and closed this as a duplicate of that.  It&#39;s all a set of non-obvious consequences.  In this code, you should probably do <code>fflush(file)</code> or <code>fflush(NULL)</code> before the <code>fork()</code>."}], "tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": true, "score": 12, "last_activity_date": 1525879317, "last_edit_date": 1525879317, "creation_date": 1525838003, "answer_id": 50245276, "question_id": 50244579, "link": "https://stackoverflow.com/questions/50244579/unwanted-child-processes-being-created-while-file-reading/50245276#50245276", "title": "Unwanted child processes being created while file reading", "body": "<p>When the first process reads the first number, it actually reads the whole line into memory.  The process forks.</p>\n\n<p>The child process breaks the loop; what happens next is not specified, but it probably exits. The parent process now reads the second number and forks again. Again, the child exits and the parent reads the third number, forks, etc.</p>\n\n<p>After the sixth number is read and the sixth child exits, the parent goes to read another buffer from the file.  On Linux (or, more precisely, with the GNU C Library), you then get some weird effects.  See the discussion in <a href=\"https://stackoverflow.com/questions/50110992/why-does-forking-my-process-cause-the-file-to-be-read-infinitely/50112169#50112169\">Why does forking my process cause the file to be read infinitely?</a> to see the details.  However, the children exiting adjust the read position of the file descriptor back to the start, so the parent can read more data again.</p>\n\n<p>My answer to the other question shows that if the child processes close the file before exiting, this behaviour does not occur.  (It shouldn't occur anyway, but it does, empirically.)</p>\n\n<hr>\n\n<h3>GLIBC Bug 23151</h3>\n\n<p>GLIBC <a href=\"https://sourceware.org/bugzilla/show_bug.cgi?id=23151\" rel=\"nofollow noreferrer\">Bug 23151</a> - A forked process with unclosed file does lseek before exit and can cause infinite loop in parent I/O.</p>\n\n<p>The bug was created 2019-05-08 US/Pacific, and was closed as INVALID by 2018-05-09.  The reason given was:</p>\n\n<blockquote>\n  <p>Please read\n  <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/V2_chap02.html#tag_15_05_01\" rel=\"nofollow noreferrer\">http://pubs.opengroup.org/onlinepubs/9699919799/functions/V2_chap02.html#tag_15_05_01</a>,\n  especially this paragraph:</p>\n  \n  <p>Note that after a <code>fork()</code>, two handles exist where one existed before. [\u2026]</p>\n</blockquote>\n\n<p>Please see <a href=\"https://stackoverflow.com/questions/50110992/why-does-forking-my-process-cause-the-file-to-be-read-infinitely/50112169#50112169\">Why does forking my process cause the file to be read infinitely?</a> for an extensive discussion of this.</p>\n"}], "owner": {"reputation": 1471, "user_id": 6218471, "user_type": "registered", "accept_rate": 13, "profile_image": "https://www.gravatar.com/avatar/3f00ee8a3891494a2b1eef90d5348764?s=128&d=identicon&r=PG&f=1", "display_name": "Max Paython", "link": "https://stackoverflow.com/users/6218471/max-paython"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 357, "favorite_count": 0, "closed_date": 1525879347, "accepted_answer_id": 50245276, "answer_count": 2, "score": 11, "last_activity_date": 1525879317, "creation_date": 1525832016, "last_edit_date": 1525832439, "question_id": 50244579, "link": "https://stackoverflow.com/questions/50244579/unwanted-child-processes-being-created-while-file-reading", "closed_reason": "Duplicate", "title": "Unwanted child processes being created while file reading", "body": "<p>I am creating a multi process program. When I tried to call fork() in a for loop using <code>if(f == 0) break;</code>. I got the desired number of child processes. </p>\n\n<p>However now, I am dealing with an input file, and the desired number of processes is not known initially. Here is the smallest possible example of my code.</p>\n\n<pre><code>FILE* file = fopen(\"sample_input.txt\", \"r\");\nwhile(fscanf(file, \"%d\", &amp;order) == 1){      \n    f = fork();\n    if(f == 0){\n        break;\n    } \n}\n</code></pre>\n\n<p>example <code>sample_input.txt</code>:</p>\n\n<pre><code>5 2 8 1 4 2\n</code></pre>\n\n<p>Now thousands of child processes are being created (I want 6, the number of integers in the file), what could be the reason ? Is it something to do with the file pointer ?</p>\n\n<p><strong>Edit:</strong> I did some debugging with console outputs, the child processes are indeed breaking out of the loop. However the parent keeps reading a small file over and over. If I remove <code>fork()</code>, the loop executes 6 times as intended.</p>\n\n<p><strong>Edit2:</strong> I have a theory, I can't prove it maybe you can help me. It could be the situation that the file pointer is shared between processes, when a child exits, it closes the file and when the parent tries to read again, it just starts from the beginning (or some other weird behavior). Could it be the case ?</p>\n"}, {"tags": ["c", "segmentation-fault"], "comments": [{"owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 1, "creation_date": 1525830438, "post_id": 50244349, "comment_id": 87506398, "body": "People are more likely to look/help with proper code indenting. Also, you&#39;ve interspersed your commentary with the code. The trailing part of your code is <i>outside</i> the code block which is why it comes up yellow [as in a quoted passage], which is kicked off by a <code>&gt;</code> outside of a code block."}, {"owner": {"reputation": 937, "user_id": 9242445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2IaxD.jpg?s=128&g=1", "display_name": "Marker", "link": "https://stackoverflow.com/users/9242445/marker"}, "edited": false, "score": 1, "creation_date": 1525831141, "post_id": 50244349, "comment_id": 87506544, "body": "In main, you are passing i to concat().  First i is an int, not an int*, Second since i is initialized to 0, you are passing a null pointer.  So (*i)++ with a null pointer would generate a seg fault."}, {"owner": {"reputation": 11, "user_id": 9761902, "user_type": "registered", "profile_image": "https://graph.facebook.com/1923824994295007/picture?type=large", "display_name": "Michael Innamorato", "link": "https://stackoverflow.com/users/9761902/michael-innamorato"}, "edited": false, "score": 0, "creation_date": 1525831358, "post_id": 50244349, "comment_id": 87506589, "body": "I don&#39;t really know c at all i&#39;m learning so can you show me in the code with comments"}, {"owner": {"reputation": 11, "user_id": 9761902, "user_type": "registered", "profile_image": "https://graph.facebook.com/1923824994295007/picture?type=large", "display_name": "Michael Innamorato", "link": "https://stackoverflow.com/users/9761902/michael-innamorato"}, "edited": false, "score": 0, "creation_date": 1525831548, "post_id": 50244349, "comment_id": 87506613, "body": "I don&#39;t have to allocate memory using malloc to create memory for the pointer to hold the char"}, {"owner": {"reputation": 937, "user_id": 9242445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2IaxD.jpg?s=128&g=1", "display_name": "Marker", "link": "https://stackoverflow.com/users/9242445/marker"}, "edited": false, "score": 1, "creation_date": 1525831602, "post_id": 50244349, "comment_id": 87506621, "body": "Try changing this line &quot;if(concat(argv[j], longstring, &amp;i)) return 1;&quot; in main().  The &amp;i will pass the address of i to concat()"}, {"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 0, "creation_date": 1525847337, "post_id": 50244349, "comment_id": 87511043, "body": "I formated your question, but your line number is and was not helpful please replace the line number with a citation of the line so it is clear what you are referencing"}], "answers": [{"tags": [], "owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "is_accepted": false, "score": 1, "last_activity_date": 1525831492, "creation_date": 1525831492, "answer_id": 50244509, "question_id": 50244349, "link": "https://stackoverflow.com/questions/50244349/cant-find-and-fix-my-seg-fault-error/50244509#50244509", "title": "Can&#39;t find and fix my seg fault error", "body": "<p>The main problem that is causing the crash is in your for loop:</p>\n\n<pre><code>for(j = 1; j &lt;= argc; j++){\n    if(concat(argv[j], longstring, i)) return 1;\n}\n</code></pre>\n\n<p>Since concat's third parameter is an int *, you need to pass a pointer to i.  Also, you are iterating through the loop one too many times.  If argc is 2, then the program name is in argv[0], and your argument is in argv[1].  So, change the loop to this:</p>\n\n<pre><code>for(j = 1; j &lt; argc; j++) {\n    if (concat(argv[j], longstring, &amp;i))\n        return 1;\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9761902, "user_type": "registered", "profile_image": "https://graph.facebook.com/1923824994295007/picture?type=large", "display_name": "Michael Innamorato", "link": "https://stackoverflow.com/users/9761902/michael-innamorato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525855205, "creation_date": 1525830055, "last_edit_date": 1525855205, "question_id": 50244349, "link": "https://stackoverflow.com/questions/50244349/cant-find-and-fix-my-seg-fault-error", "title": "Can&#39;t find and fix my seg fault error", "body": "<blockquote>\n  <p>\"*Program received signal SIGSEGV, Segmentation fault.<br>\n  0x000000000040073b in concat (nextstr=0x7fffffffee66 \"the\",<br>\n    longstr=0x7fffffffe750 \"\", i=0x0) at main.c:24<br>\n  24  printf(\"%c -> %c\\n\", nextstr[j], longstr[*i]);<br>\n  (gdb)\"</p>\n</blockquote>\n\n<pre><code>// define max for command line\n#define MAX_CHARS 1000\n#include &lt;stdio.h&gt;\nint concat(char[], char[], int *);\nvoid printreverse(char[], int);\n\nint main(int argc, char *argv[])\n{\n    char longstring[MAX_CHARS] = { '\\0' };\n    int i = 0, j;\n\n    if (argc &lt; 2)\n    {\n        printf(\"%s requires command-line args\\n\", argv[0]);\n        return 1;\n    }\n\n    for (j = 1; j &lt;= argc; j++)\n    {\n        if (concat(argv[j], longstring, i))\n            return 1;\n    }\n\n    i--;\n    longstring[i] = '\\0';    //delete trailing space\n    printf(\"%s\\n\", longstring);\n}\n\nint concat(char nextstr[], char longstr[], int *i)\n{\n    int j = 0;\n\n    while (nextstr[j] != '\\0')\n    {\n        printf(\"%c -&gt; %c\\n\", nextstr[j], longstr[*i]);\n        longstr[*i] = nextstr[j];\n\n        (*i)++;\n        j++;\n\n        if (*i &gt; MAX_CHARS)\n        {\n            printf(\"Error: Input is too long!\\n\");\n            return 1;\n        }\n    }\n\n    if (j &gt; 0)\n    {\n        if ((*i) + 2 &gt; MAX_CHARS)\n        {\n            printf(\"Error: Input is too long!\\n\");\n            return 1;\n        }\n\n        longstr[*i] = ' ';\n        longstr[(*i) + 1] = '\\0';\n        (*i)++;\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>Pointer error most likely</p>\n\n<blockquote>\n  <p>\"This takes a command line argument is checks the length but there's a seg fault\"</p>\n</blockquote>\n\n<p>I think the error is on line 33\nbut I can't figure out how to fix it   </p>\n"}, {"tags": ["c", "arrays", "gnu", "c99"], "comments": [{"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1525833028, "post_id": 50244345, "comment_id": 87506880, "body": "Hypothesis: This statement is obsolete, the compiler now largely ignores <code>register</code>, and it generates working code even though the C standard might not require it."}], "answers": [{"comments": [{"owner": {"reputation": 648, "user_id": 5694959, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TN18H3fTni4/AAAAAAAAAAI/AAAAAAAAAA8/HH8MErbPvAI/photo.jpg?sz=128", "display_name": "Monk", "link": "https://stackoverflow.com/users/5694959/monk"}, "edited": false, "score": 0, "creation_date": 1525839698, "post_id": 50245119, "comment_id": 87508378, "body": "yes!!! i was working on mac and it didn&#39;t throw any error. However, when it tried on another system it did report same for me as well.gcc --version gcc (GCC) 4.8.5"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 648, "user_id": 5694959, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TN18H3fTni4/AAAAAAAAAAI/AAAAAAAAAA8/HH8MErbPvAI/photo.jpg?sz=128", "display_name": "Monk", "link": "https://stackoverflow.com/users/5694959/monk"}, "edited": false, "score": 0, "creation_date": 1525839743, "post_id": 50245119, "comment_id": 87508389, "body": "Funny \u2013 I was testing on a Mac too, but using &#39;real&#39; GCC, not Clang disguised as GCC."}], "tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": true, "score": 1, "last_activity_date": 1525836721, "creation_date": 1525836721, "answer_id": 50245119, "question_id": 50244345, "link": "https://stackoverflow.com/questions/50244345/subscript-an-array-having-the-register-storage-class/50245119#50245119", "title": "subscript an array having the register storage class", "body": "<p>GCC 8.1 yields:</p>\n\n<pre><code>$ gcc rega89.c\nrega89.c: In function \u2018main\u2019:\nrega89.c:7:9: error: address of register variable \u2018arr\u2019 requested\n         printf(\"arr[9] %d\\n\", *((arr) + 9)); // working fine\n         ^~~~~~\n$\n</code></pre>\n\n<p>That's without any extra options.  In fact, even GCC 4.8.1 complains with no options.  (GCC 8.1 defaults to C11; GCC 4.8.1 defaults to C90; specifying <code>-std=c99</code> or <code>-std=gnu99</code> makes no difference.)</p>\n\n<p>So, if you are using GCC, you must be using an older version of GCC than 4.8.1.  Or you are using some other compiler that is not as standard-compliant as GCC is.</p>\n"}], "owner": {"reputation": 648, "user_id": 5694959, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TN18H3fTni4/AAAAAAAAAAI/AAAAAAAAAA8/HH8MErbPvAI/photo.jpg?sz=128", "display_name": "Monk", "link": "https://stackoverflow.com/users/5694959/monk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 50245119, "answer_count": 1, "score": 2, "last_activity_date": 1525836721, "creation_date": 1525830018, "last_edit_date": 1525836451, "question_id": 50244345, "link": "https://stackoverflow.com/questions/50244345/subscript-an-array-having-the-register-storage-class", "title": "subscript an array having the register storage class", "body": "<p>In GNU c99 manual:</p>\n\n<blockquote>\n  <p>3.13 Array Subscripts</p>\n  \n  <p>You can access array elements by specifying the name of the array, and\n  the array subscript (or index, or element number) enclosed in\n  brackets. Here is an example, supposing an integer array called\n  my_array:</p>\n\n<pre><code>my_array[0] = 5;\n</code></pre>\n  \n  <p>The array subscript expression A[i] is defined as\n  being identical to the expression (*((A)+(i))). This means that many\n  uses of an array name are equivalent to a pointer expression. <strong>It also</strong>\n  <strong>means that you cannot subscript an array having the register storage</strong>\n  <strong>class</strong>.</p>\n</blockquote>\n\n<p>I have tried below things and it is working fine for me.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n        register int arr[10] = {1, [9] = 6};\n\n        printf(\"arr[9] %d\\n\", *((arr) + 9)); // working fine\n        printf(\"arr[9] %d\\n\", arr[9]); //working fine\n        return 0;\n}\n</code></pre>\n\n<p>Can somebody please explain what is meant by statement in bold letters? Or I tried wrong to validate it.</p>\n"}, {"tags": ["c", "tree"], "answers": [{"comments": [{"owner": {"reputation": 93, "user_id": 9142951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1dcc29f1cb510c7b1d310eed47d7f618?s=128&d=identicon&r=PG&f=1", "display_name": "Real", "link": "https://stackoverflow.com/users/9142951/real"}, "edited": false, "score": 0, "creation_date": 1525830181, "post_id": 50244326, "comment_id": 87506355, "body": "Now that should do the trick. Maybe i should add a pointer to parent to the structure to make it a bit easier."}, {"owner": {"reputation": 1071, "user_id": 7773444, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-BR1uHOYfpe8/AAAAAAAAAAI/AAAAAAAAAAo/5bptj5FARWo/photo.jpg=k-s128", "display_name": "Michael", "link": "https://stackoverflow.com/users/7773444/michael"}, "edited": false, "score": 0, "creation_date": 1537847281, "post_id": 50244326, "comment_id": 91921318, "body": "What you mean by <code>parent-&gt;child=delete(parent-&gt;child);</code>? The deleted node can be either a direct child of someone or a sibling of his brother, so we may need handle different cases right?"}], "tags": [], "owner": {"reputation": 4593, "user_id": 105104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02b23920ac852e946b333d3f9d0d95c1?s=128&d=identicon&r=PG", "display_name": "dvhh", "link": "https://stackoverflow.com/users/105104/dvhh"}, "is_accepted": true, "score": 1, "last_activity_date": 1525829859, "creation_date": 1525829859, "answer_id": 50244326, "question_id": 50244242, "link": "https://stackoverflow.com/questions/50244242/deleting-a-full-branch-from-n-ary-tree/50244326#50244326", "title": "Deleting a full branch from n-ary tree", "body": "<p>considering you want to keep the sibling and not remove it</p>\n\n<pre><code>tree delete_branch(tree node) {\n    tree new_child=NULL;\n    if(node != NULL) {\n        while(node-&gt;child!=NULL) { //the child will keep being replaced by his sibling\n            node-&gt;child=delete_branch(node-&gt;child); // replace the child by his sibling until there is none\n        }\n        new_child=node-&gt;sibling; // before freeing the child keep his the pointer to his sibling \n        free(node);\n    }\n    return new_child; // the sibling will replace the deleted child in the parent reference\n}\n</code></pre>\n\n<p>And when removing the child;</p>\n\n<pre><code>parent-&gt;child=delete(parent-&gt;child);\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 9142951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1dcc29f1cb510c7b1d310eed47d7f618?s=128&d=identicon&r=PG&f=1", "display_name": "Real", "link": "https://stackoverflow.com/users/9142951/real"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 394, "favorite_count": 0, "accepted_answer_id": 50244326, "answer_count": 1, "score": 1, "last_activity_date": 1525829859, "creation_date": 1525829083, "last_edit_date": 1525829568, "question_id": 50244242, "link": "https://stackoverflow.com/questions/50244242/deleting-a-full-branch-from-n-ary-tree", "title": "Deleting a full branch from n-ary tree", "body": "<p>I want to make a function capable of being able to delete a branch (or even the whole tree). The structure of the tree is the following:</p>\n\n<pre><code>typedef struct node {\n    char data;\n    struct node *child;\n    struct node *sibling;\n}*tree;\n</code></pre>\n\n<p>I made a function that is able to find a given data in the tree and then return the address of that node and then remove it. Lets say i want to delete the node that has <code>B</code> in the data, it should delete all it's children and the node itself, then i should be left with the following tree:</p>\n\n<pre><code>      R                        R     \n      |                        |     \n      B _ C _ D      --&gt;&gt;      C _ D              \n      |       |                    | \n      E _ F   G                    G \n</code></pre>\n\n<p>I have the following function, but it's only useful for deleting the entire tree, if i use it for deleting branches i will be left with pointers pointing to memory that was already freed.</p>\n\n<pre><code>void delete_branch(tree node){\n    if(node != NULL)\n    {\n        delete_branch(node-&gt;child);\n        delete_branch(node-&gt;sibling);\n        free(node);\n    }\n}\n</code></pre>\n\n<p>I know what the problem is, i just have to update the pointers so they point to correct positions again, but i can't wrap my head around how to do it with recursive functions involved. If more info is needed feel free to ask.     </p>\n"}, {"tags": ["c", "arrays"], "comments": [{"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 2, "creation_date": 1525829120, "post_id": 50244223, "comment_id": 87506144, "body": "probably indexing out of bounds ... use your debugger or add print statments and make sure your indices <code>a</code> and <code>a+1</code> are on the range 0 to 19 and the indices <code>vec[a]</code> and <code>vect[a+1]</code> are on the ranges 0 to LINES-1 and 0 to COLUMNS-1 respectively"}, {"owner": {"reputation": 74843, "user_id": 2988730, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/ZOX7t.jpg?s=128&g=1", "display_name": "Mad Physicist", "link": "https://stackoverflow.com/users/2988730/mad-physicist"}, "edited": false, "score": 4, "creation_date": 1525829590, "post_id": 50244223, "comment_id": 87506254, "body": "Would be necessary to see your code, particularly where things are allocated and declared. You being a self proclaimed rookie automatically casts suspicion on your verbal descriptions."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1525835571, "post_id": 50244223, "comment_id": 87507420, "body": "In <code>mat[vet[a]][vet[a+1]];</code> if <code>vet</code> holds row references, then <code>mat[vet[a]][..]</code> makes sense (so long as all entries in <code>vet[a]</code> are valid row numbers for <code>mat</code>)... However, <code>mat[..][vet[a+1]]</code> makes little or no sense on the surface. (if it is a square matrix -- possibly). We can&#39;t read minds, or see your screen from here, so you need to post <a href=\"http://stackoverflow.com/help/mcve\"><b>A Minimal, Complete, and Verifiable Example (MCVE)</b></a> for further help."}], "answers": [{"comments": [{"owner": {"reputation": 74843, "user_id": 2988730, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/ZOX7t.jpg?s=128&g=1", "display_name": "Mad Physicist", "link": "https://stackoverflow.com/users/2988730/mad-physicist"}, "edited": false, "score": 1, "creation_date": 1525830523, "post_id": 50244388, "comment_id": 87506425, "body": "While good general advice, you have no way of knowing if this is an adequate answer."}, {"owner": {"reputation": 337, "user_id": 9732950, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-UYdJoUSpwEQ/AAAAAAAAAAI/AAAAAAAAAPM/ArxE5MM0HRE/photo.jpg?sz=128", "display_name": "Jeffry Evan", "link": "https://stackoverflow.com/users/9732950/jeffry-evan"}, "reply_to_user": {"reputation": 74843, "user_id": 2988730, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/ZOX7t.jpg?s=128&g=1", "display_name": "Mad Physicist", "link": "https://stackoverflow.com/users/2988730/mad-physicist"}, "edited": false, "score": 1, "creation_date": 1525831990, "post_id": 50244388, "comment_id": 87506690, "body": "@MadPhysicist which is why i said that need to see the full code to make sure that is the root cause. with the current information where op think that the matrix index causing the crash, this is the potential answer"}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "reply_to_user": {"reputation": 3852, "user_id": 5321363, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10153640801268875/picture?type=large", "display_name": "Rann Lifshitz", "link": "https://stackoverflow.com/users/5321363/rann-lifshitz"}, "edited": false, "score": 1, "creation_date": 1525838512, "post_id": 50244388, "comment_id": 87508091, "body": "@RannLifshitz because the question didn&#39;t contain a MCVE, it&#39;s a poor question and cannot be answered without a large amount of speculation. Hopefully it is clear why people suggest to not answer the question until the author has modified it to meet the posting guidelines for the site"}], "tags": [], "owner": {"reputation": 337, "user_id": 9732950, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-UYdJoUSpwEQ/AAAAAAAAAAI/AAAAAAAAAPM/ArxE5MM0HRE/photo.jpg?sz=128", "display_name": "Jeffry Evan", "link": "https://stackoverflow.com/users/9732950/jeffry-evan"}, "is_accepted": false, "score": -2, "last_activity_date": 1525861709, "last_edit_date": 1525861709, "creation_date": 1525830319, "answer_id": 50244388, "question_id": 50244223, "link": "https://stackoverflow.com/questions/50244223/matrix-position-accessing-in-c/50244388#50244388", "title": "Matrix position accessing in c", "body": "<p>Debug your code and make sure that <code>0 &lt;= a &lt;= 18</code>.\nThen for each value stored in your <code>vet</code> matrix (<code>vet[0] .. vet[19]</code>), make sure it's not greater than <code>LINES</code> and <code>COLUMNS</code>.</p>\n\n<p>Need to see your full code to make sure no other lines of code other than the matrix index issue that causing the crash.</p>\n"}], "owner": {"reputation": 11, "user_id": 9761851, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10f2b5b48c676b53a3832031c1cdc6e1?s=128&d=identicon&r=PG&f=1", "display_name": "Alexandre Mendes", "link": "https://stackoverflow.com/users/9761851/alexandre-mendes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525861709, "creation_date": 1525828866, "last_edit_date": 1525836854, "question_id": 50244223, "link": "https://stackoverflow.com/questions/50244223/matrix-position-accessing-in-c", "title": "Matrix position accessing in c", "body": "<p>I am stuck on how to index a matrix in c (codeblocks) using an array.</p>\n\n<p>I have an array <code>vet[20]</code> in which I save one int number in each position, which correspond to a line index and a column index of a matrix, <code>mat[LINES][COLUMNS]</code>, and I need to use that position inside the array to directly go to my matrix in the positions saved inside the array.</p>\n\n<p>I have tried the following: </p>\n\n<pre><code>mat[vet[a]][vet[a+1]];\n</code></pre>\n\n<p>The code line above has caused my application to crash. Any tips on how to solve this problem? </p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["c", "struct", "copy", "constants"], "comments": [{"owner": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "edited": false, "score": 0, "creation_date": 1525828672, "post_id": 50244162, "comment_id": 87506055, "body": "<code>memcpy()</code> is the appropriate, efficient way to do this."}], "answers": [{"tags": [], "owner": {"reputation": 461, "user_id": 5872574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44adbaa7965d31c58d087bbd25386317?s=128&d=identicon&r=PG", "display_name": "rel", "link": "https://stackoverflow.com/users/5872574/rel"}, "is_accepted": false, "score": 0, "last_activity_date": 1527012904, "last_edit_date": 1527012904, "creation_date": 1525829830, "answer_id": 50244323, "question_id": 50244162, "link": "https://stackoverflow.com/questions/50244162/copy-const-struct-in-flash-to-normal-struct-in-ram/50244323#50244323", "title": "Copy const struct in flash to &quot;normal&quot; struct in RAM", "body": "<p>A type cast like this should resolve the compiler error:</p>\n\n<pre><code>ModBusIDReg = (my_reg)const_ModBusIDReg;\n</code></pre>\n\n<p>Or you could use <a href=\"https://linux.die.net/man/3/memcpy\" rel=\"nofollow noreferrer\">memcpy()</a>:</p>\n\n<pre><code>memcpy(&amp;ModBusIDReg, &amp;const_ModBusIDReg, sizeof(my_reg));\n</code></pre>\n\n<p>(Sidenote at using memcpy(): In some cases, memory alignment might be an issue. But I'm no c expert. Using <a href=\"https://gcc.gnu.org/onlinedocs/gcc-3.3/gcc/Type-Attributes.html\" rel=\"nofollow noreferrer\">compiler-specific attributes</a> like <em>packed</em> in the case of GCC might help, when you define the struct, depending on the platform, compiler, variable types used.)</p>\n\n<p>You can also copy the members of the struct individually in a custom copy function, and initialize the unused parts if there are any. This would be clean, and very clear/explicit, and similar to a copy constructor / assignment operator used in C++ (deep copies are handled properly).</p>\n\n<hr>\n\n<p>edit:\nSince I can't add a comment above after your last edit, I add the comment here:</p>\n\n<blockquote>\n  <p>./Source/functions.c:609:16: error: 'my_reg' undeclared (first use in\n  this function) ModBusIDReg = (my_reg)const_ModBusIDReg;</p>\n</blockquote>\n\n<p>In C you can use <em>typedef</em> in your struct type declartions, in order to avoid repeating the <em>struct</em> keyword throughout your code (explained in detail over <a href=\"https://stackoverflow.com/questions/612328/difference-between-struct-and-typedef-struct-in-c\">here</a> or <a href=\"http://en.cppreference.com/w/c/language/struct\" rel=\"nofollow noreferrer\">there</a>):</p>\n\n<pre><code>typedef struct { ... } foo;\nfoo x;\n</code></pre>\n\n<p>Here an example illustrating the mentioned ideas from above:</p>\n\n<pre><code>/* gcc -Wall -o copy_test copy_test.c &amp;&amp; ./copy_test */\n\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\ntypedef struct {\n    int var;\n} my_struct;\n\nint my_copy_func(my_struct *dst, const my_struct *src)\n{\n    if (!dst || !src)\n        return -1;\n    dst-&gt;var = src-&gt;var;\n    return 0;\n}\n\nint main()\n{\n    const my_struct a = { .var = 42 };\n    my_struct b, c, d;\n    c = (my_struct)a;\n    memcpy(&amp;b, &amp;a, sizeof(b));\n    my_copy_func(&amp;d, &amp;a);\n    printf(\"b.var = %d\\r\\n\", b.var);\n    printf(\"c.var = %d\\r\\n\", c.var);\n    printf(\"d.var = %d\\r\\n\", d.var);\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 9711590, "user_type": "registered", "profile_image": "https://graph.facebook.com/2082958171733073/picture?type=large", "display_name": "Gregory Helton", "link": "https://stackoverflow.com/users/9711590/gregory-helton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 267, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1527012904, "creation_date": 1525828219, "last_edit_date": 1525879930, "question_id": 50244162, "link": "https://stackoverflow.com/questions/50244162/copy-const-struct-in-flash-to-normal-struct-in-ram", "title": "Copy const struct in flash to &quot;normal&quot; struct in RAM", "body": "<p>Here is what I have, and there is still a problem - the compiler doesn't recognize the \"my_reg\" structure type.</p>\n\n<p>../Source/functions.c:609:16: error: 'my_reg' undeclared (first use in this function)\n ModBusIDReg = (my_reg)const_ModBusIDReg;</p>\n\n<pre><code>// define structure in flash with constants\n\nstruct\n{\n  const unsigned char Reg00[32];\n  const unsigned char Reg01[32];\n  const unsigned char Reg02[32];\n  const unsigned short Reg03;\n  const unsigned short Reg04;\n} const_ModBusIDReg =\n{\n  \"My String 1\" ,\n  \"My String 2\" ,\n  \"My String 3\" ,\n   0 ,\n   0\n};\n\n\n// define structure in RAM, tag name \"my_reg\"\n\nstruct my_reg\n{\n  unsigned char Reg00[32];\n  unsigned char Reg01[32];\n  unsigned char Reg02[32];\n  unsigned short Reg03;\n  unsigned short Reg04;\n} ModBusIDReg;\n\n\n// This statement is located in InitSys function.\n// Both of the files where the structures were\n// defined are included at the top of the file \n// where InitSys function resides.\n// Make a copy of const_ModBusIDReg from\n// flash into ModBusIDReg in RAM.\n\n\nModBusIDReg = (my_reg)const_ModBusIDReg;\n</code></pre>\n\n<p>Any ideas on how to do the direct assignment ?</p>\n"}, {"tags": ["c", "stm32", "freertos"], "comments": [{"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1525864335, "post_id": 50243996, "comment_id": 87520968, "body": "I would say - if you do not understand how the priority system works, better do not touch it in such a complex environment as RTOS.  First learn how it works in the bare metal environment, consider why you want to change it and when you become the NVIC master tune the RTOS. I would suggest to use the CMSIS functions instead"}], "answers": [{"comments": [{"owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "edited": false, "score": 0, "creation_date": 1525881254, "post_id": 50252176, "comment_id": 87532827, "body": "Thanks for this answer. Ok, so <code>configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY</code> is describing an <b>NVIC priority then, correct</b>--even though it&#39;s inside FreeRTOSConfig.h? And a FreeRTOS (task) priority would be what you pass in when you call <code>xTaskCreate(taskFunction, &quot;Task Name&quot;, configMINIMAL_STACK_SIZE * 5, NULL, tskIDLE_PRIORITY + 1, NULL)</code>, for instance, where the FreeRTOS task priority in this example is 1 higher than the idle task."}, {"owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "edited": false, "score": 0, "creation_date": 1525881576, "post_id": 50252176, "comment_id": 87533016, "body": "So, to confirm: <code>configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY</code> is a limit on NVIC priorities (which are passed to <code>HAL_NVIC_SetPriority()</code>) and the FreeRTOS priorities are used in <code>xTaskCreate()</code>, <code>uxTaskPriorityGet()</code>, <code>vTaskPrioritySet()</code>, etc, correct? This is the distinction you refer to when you say not to confuse the two?"}, {"owner": {"reputation": 1473, "user_id": 6517894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0511b1daef16fed51233f70c4370dafc?s=128&d=identicon&r=PG&f=1", "display_name": "Realtime Rik", "link": "https://stackoverflow.com/users/6517894/realtime-rik"}, "reply_to_user": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "edited": false, "score": 1, "creation_date": 1525935545, "post_id": 50252176, "comment_id": 87552350, "body": "Yes. The MAX SYSCALL PRIORITY is the maximum NVIC priority of an interrupt that can make call into the system (API). The reason for this is that the RTOS uses higher priority interrupts which should not be interrupted by calls into the RTOS as they would corrupt the RTOS data. As you say Task Priorities are used by xTaskCreate, where 0 is lowest priority task."}], "tags": [], "owner": {"reputation": 1473, "user_id": 6517894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0511b1daef16fed51233f70c4370dafc?s=128&d=identicon&r=PG&f=1", "display_name": "Realtime Rik", "link": "https://stackoverflow.com/users/6517894/realtime-rik"}, "is_accepted": false, "score": 2, "last_activity_date": 1525864964, "creation_date": 1525864964, "answer_id": 50252176, "question_id": 50243996, "link": "https://stackoverflow.com/questions/50243996/what-are-valid-values-of-hal-nvic-setpriority-when-using-stm32-and-freertos/50252176#50252176", "title": "What are valid values of `HAL_NVIC_SetPriority()` when using STM32 and FreeRTOS?", "body": "<p>Firstly do not confuse FreeRTOS task priorities with NVIC priorities. They are entirely different.</p>\n\n<p>In the above example you can use interrupt priorities of 5 to 15 for your interrupts if they make FreeRTOS API calls. If they do not make FreeRTOS API calls then you can use interrupts of any priority from 0 to 15.</p>\n\n<p>Don't worry about the shifting as it is all handled for you, but the reason is the top 4 bits of the priority registers are used (note some processors use a different number of priority bits).</p>\n"}], "owner": {"reputation": 11050, "user_id": 4561887, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1ecb6a74fca21551bd8157504ad47faf?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Staples", "link": "https://stackoverflow.com/users/4561887/gabriel-staples"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6584, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1551105397, "creation_date": 1525826701, "last_edit_date": 1551105397, "question_id": 50243996, "link": "https://stackoverflow.com/questions/50243996/what-are-valid-values-of-hal-nvic-setpriority-when-using-stm32-and-freertos", "title": "What are valid values of `HAL_NVIC_SetPriority()` when using STM32 and FreeRTOS?", "body": "<p>After a rather difficult process of learning some things about interrupt priority, I am still a bit stuck trying to understand what values I am allowed to call for <code>HAL_NVIC_SetPriority()</code> on the <code>SysTick_IRQn</code> (which is the ISR calling the FreeRTOS scheduler every 1 ms). </p>\n\n<h1>TLDR;</h1>\n\n<p>Part of me thinks that anything between <code>HAL_NVIC_SetPriority(SysTick_IRQn, 15 ,0U)</code> (lowest priority possible) and <code>HAL_NVIC_SetPriority(SysTick_IRQn, 10 ,0U)</code> (a bit higher) are allowed, and part of me thinks that anything between <code>HAL_NVIC_SetPriority(SysTick_IRQn, 15 ,0U)</code> (lowest priority possible) and <code>HAL_NVIC_SetPriority(SysTick_IRQn, 5 ,0U)</code> (quite a bit higher) is allowed. This is assuming that <code>configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY</code> in FreeRTOSConfig.h is set to 5. The confusion lies in the fact that in FreeRTOS, higher numbers are higher priority, but in STM32, higher numbers are <em>lower</em> priority, and the documentation is pretty challenging to understand. </p>\n\n<hr>\n\n<h1>Details:</h1>\n\n<p>To prove I've made a valiant effort, and to help you help me fill in the blanks, here's my current understanding. I'm going to write a description of what I know to be true in such a way that it looks like <em>I</em> am teaching <em>you</em>, even though I'm seeking the answer to my above question, as well as  <strong>correction</strong>, <strong>confirmation</strong>, or <strong>additional insight</strong> as you see fit.</p>\n\n<p>Though this probably applies to many of the STM32 microcontrollers or families, let's discuss it in terms of the <a href=\"http://www.st.com/en/microcontrollers/stm32f207zg.html\" rel=\"nofollow noreferrer\">STM32F207ZG</a> in particular. </p>\n\n<p>Note: <a href=\"http://www.st.com/en/embedded-software/stm32cubef2.html#getsoftware-scroll\" rel=\"nofollow noreferrer\">STM32CubeF2 download is here</a>.</p>\n\n<h2>My understanding:</h2>\n\n<p>If you look at a standard <strong>FreeRTOSConfig.h</strong> file (ex: STM32Cube_FW_F2_V1.7.0/Projects/STM322xG_EVAL/Applications/FreeRTOS/FreeRTOS_ThreadCreation/Inc/FreeRTOSConfig.h) you'll see the following:</p>\n\n<pre><code>/* Cortex-M specific definitions. */\n#ifdef __NVIC_PRIO_BITS\n    /* __BVIC_PRIO_BITS will be specified when CMSIS is being used. */\n    #define configPRIO_BITS             __NVIC_PRIO_BITS\n#else\n    #define configPRIO_BITS             4        /* 15 priority levels */\n#endif\n\n/* The lowest interrupt priority that can be used in a call to a \"set priority\"\nfunction. */\n#define configLIBRARY_LOWEST_INTERRUPT_PRIORITY         0xf\n\n/* The highest interrupt priority that can be used by any interrupt service\nroutine that makes calls to interrupt safe FreeRTOS API functions.  DO NOT CALL\nINTERRUPT SAFE FREERTOS API FUNCTIONS FROM ANY INTERRUPT THAT HAS A HIGHER\nPRIORITY THAN THIS! (higher priorities are lower numeric values. */\n#define configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY    5\n\n/* Interrupt priorities used by the kernel port layer itself.  These are generic\nto all Cortex-M ports, and do not rely on any particular library functions. */\n#define configKERNEL_INTERRUPT_PRIORITY         ( configLIBRARY_LOWEST_INTERRUPT_PRIORITY &lt;&lt; (8 - configPRIO_BITS) )\n/* !!!! configMAX_SYSCALL_INTERRUPT_PRIORITY must not be set to zero !!!!\nSee http://www.FreeRTOS.org/RTOS-Cortex-M3-M4.html. */\n#define configMAX_SYSCALL_INTERRUPT_PRIORITY    ( configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY &lt;&lt; (8 - configPRIO_BITS) )\n</code></pre>\n\n<p><code>__NVIC_PRIO_BITS</code> is defined in <em>STM32Cube_FW_F2_V1.7.0/Drivers/CMSIS/Device/ST/STM32F2xx/Include/stm32f217xx.h</em> as <code>4U</code> since \"STM32F2XX uses 4 Bits for the Priority Levels\". </p>\n\n<p>First off, this is interesting because it means that only 4 of the available 8 priority bits are actually used! The STM32 HAL library call <code>HAL_NVIC_SetPriority()</code> has a header that looks as follows, and seems to indicate you have 8 bits to set (<code>PreemptPriority</code> from 0 to 15 and <code>SubPriority</code> from 0 to 15), but really you don't--you only have 4 bits to set.</p>\n\n<pre><code>/**\n  * @brief  Sets the priority of an interrupt.\n  * @param  IRQn: External interrupt number.\n  *         This parameter can be an enumerator of IRQn_Type enumeration\n  *         (For the complete STM32 Devices IRQ Channels list, please refer to the appropriate CMSIS device file (stm32f2xxxx.h))\n  * @param  PreemptPriority: The preemption priority for the IRQn channel.\n  *         This parameter can be a value between 0 and 15\n  *         A lower priority value indicates a higher priority \n  * @param  SubPriority: the subpriority level for the IRQ channel.\n  *         This parameter can be a value between 0 and 15\n  *         A lower priority value indicates a higher priority.          \n  * @retval None\n  */\nvoid HAL_NVIC_SetPriority(IRQn_Type IRQn, uint32_t PreemptPriority, uint32_t SubPriority)\n{ \n</code></pre>\n\n<p>So, you only have 4 bits to set, but it turns out you can decide how many are <code>PreemptPriority</code> bits and how many are <code>SubPriority</code> bits, as follows:</p>\n\n<p><code>HAL_NVIC_SetPriorityGrouping()</code> from <a href=\"http://www.st.com/content/ccc/resource/technical/document/user_manual/56/32/53/cb/69/86/49/0e/DM00223149.pdf/files/DM00223149.pdf/jcr:content/translations/en.DM00223149.pdf\" rel=\"nofollow noreferrer\">UM1940</a>, 9.2.4, p124/1371.\n<a href=\"https://i.stack.imgur.com/5szUf.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5szUf.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://www.freertos.org/RTOS-Cortex-M3-M4.html\" rel=\"nofollow noreferrer\">FreeRTOS says in their documentation</a>:</p>\n\n<blockquote>\n  <p>If you are using an STM32 with the STM32 driver library then ensure all the priority bits are assigned to be preempt priority bits by calling NVIC_PriorityGroupConfig( NVIC_PriorityGroup_4 ); before the RTOS is started.</p>\n</blockquote>\n\n<p>So, one of the very first things you should do in your code (at least before starting the FreeRTOS scheduler via <code>osKernelStart()</code> or <code>vTaskStartScheduler()</code> is:</p>\n\n<pre><code>/* Set Interrupt Group Priority */\nHAL_NVIC_SetPriorityGrouping(NVIC_PRIORITYGROUP_4);\n</code></pre>\n\n<p>This configures all 4 of your priority bits to be <code>PreemptPriority</code> bits and none to be <code>SubPriority</code> bits. This means any calls to the <code>HAL_NVIC_SetPriority(IRQn_Type IRQn, uint32_t PreemptPriority, uint32_t SubPriority)</code> function will now <em>always use 0 as the right-most parameter.</em></p>\n\n<p>You should then essentially call (note: this is called via <code>HAL_InitTick()</code>:</p>\n\n<pre><code>/*Configure the SysTick IRQ priority */\nHAL_NVIC_SetPriority(SysTick_IRQn, 15 ,0U);\n</code></pre>\n\n<p>where <code>15</code> is the SysTick tick priority. Since we have all 4 bits available, this gives us a priority range of 0 to 15, with 15 being the <em>lowest</em> interrupt priority and 0 being the <em>highest</em> priority. </p>\n\n<p>Well, why are we setting SysTick to the <em>lowest</em> priority? Answer: because this is a good practice for the FreeRTOS scheduler, which the SysTick interrupt calls. As a matter of fact, giving it too high a priority will break FreeRTOS, according to their own documentation. Let's try to figure that out.</p>\n\n<p>We know that our interrupt options now are 0 to 15 for the <code>PreemptPriority</code> setting, but it's even narrower than that: we can only set our PreemptPriority for the SysTick interrupt to be <strong>10 to 15</strong> (I think--I need some help here). Why 10 to 15? Well, the <a href=\"https://www.freertos.org/RTOS-Cortex-M3-M4.html\" rel=\"nofollow noreferrer\">FreeRTOS documentation</a> (albeit this is super confusing) even expressly states:</p>\n\n<blockquote>\n  <p>FreeRTOS functions that end in \"FromISR\" are interrupt safe, but even these functions cannot be called from interrupts that have a logical priority above [ie: numerically lower] the priority defined by configMAX_SYSCALL_INTERRUPT_PRIORITY (configMAX_SYSCALL_INTERRUPT_PRIORITY is defined in the FreeRTOSConfig.h header file). Therefore, any interrupt service routine that uses an RTOS API function must have its priority manually set to a value that is numerically equal to or greater than the configMAX_SYSCALL_INTERRUPT_PRIORITY setting. This ensures the interrupt's logical priority is equal to or less than the configMAX_SYSCALL_INTERRUPT_PRIORITY setting.</p>\n</blockquote>\n\n<p>Now, refer back to <strong>FreeRTOSConfig.h</strong> at the top of this page. We know <code>__NVIC_PRIO_BITS</code> is 4 and we see that:</p>\n\n<p><code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> is <code>(configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY &lt;&lt; (8 - configPRIO_BITS))</code>, which means it is <code>5 &lt;&lt; (8 - 4) = decimal 80 = 0b01010000</code>. </p>\n\n<p>The FreeRTOS documentation offers some valuable insight into why the left-shift (see the section titled \"Cortex-M Internal Priority Representation\"), but I can't discern beyond that. </p>\n\n<p>So now making some educated guesses and knowing our priority options are 0 to 15 with 0 being highest and 15 being lowest, and knowing that configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY is 5, we maybe are allowed to use 15 - 5 = 10 as highest priority and 15 as lowest, or maybe 5 to 15 is ok but 0 to 4 is off-limits? I don't know...I'm confused...</p>\n"}, {"tags": ["c", "linux", "sockets", "tcp", "tcp-ip"], "comments": [{"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 1, "creation_date": 1525826346, "post_id": 50243897, "comment_id": 87505623, "body": "for ease of readability and understanding: 1) consistently indent the code.  Indent after EVERY opening brace.  Unindent before every closing brace. Suggest each indent level be 4 spaces."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 2, "creation_date": 1525826428, "post_id": 50243897, "comment_id": 87505639, "body": "regarding: <code>printf(&quot;strlen(server_reply): %d\\n&quot;, (int)strlen(server_reply));</code>  do not use <code>strlen()</code> on data read from a server, because there can be embedded NUL bytes.  Instead use the value (if above 0) returned from the call to <code>recv()</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 1, "creation_date": 1525826557, "post_id": 50243897, "comment_id": 87505667, "body": "regarding: <code>printf(&quot;Reply: %s\\n&quot;, server_reply);</code>  this will only work if the message received from the server does not contain any NUL bytes   better to have a loop that calls <code>putc()</code> for each character in the received message"}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 3, "creation_date": 1525826708, "post_id": 50243897, "comment_id": 87505689, "body": "<code>strlen(server_reply)</code> is irrelevant. You don&#39;t know whether there is a trailing null at all. There could be no nulls at all, or several,including.one right at the beginning. To print the reply properly and see whether a problem exists at all, use <code>printf(&quot;%.*s\\n&quot;, read_result, server_reply)</code>. No need for a loop @user3629249"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1525826884, "post_id": 50243897, "comment_id": 87505721, "body": "when compiling, enable the warnings, then fix those warnings.  ( for <code>gcc</code>, at a minimum use: <code>-Wall -Wextra -Wconversion -pedantic -std=gnu11</code> )"}, {"owner": {"reputation": 23069, "user_id": 156811, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/380335e95e6be9740e56b64d667279b3?s=128&d=identicon&r=PG", "display_name": "Havenard", "link": "https://stackoverflow.com/users/156811/havenard"}, "edited": false, "score": 0, "creation_date": 1525826894, "post_id": 50243897, "comment_id": 87505726, "body": "Mind <code>strlen()</code> simply tells you the index of the first null byte, it is designed to be used in valid C strings and is not binary safe. If whatever the server is sending you starts with a <code>\\0</code>, <code>strlen()</code> will return 0, but it does not mean the server didn&#39;t send you anything."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 1, "creation_date": 1525834075, "post_id": 50243897, "comment_id": 87507095, "body": "@EJP: <code>%.*s</code> will stop at the first NUL because it prints a maximum of <code>read_result</code> bytes."}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 7314877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/278791757911e2e5280b61fc987dfb46?s=128&d=identicon&r=PG&f=1", "display_name": "ctanakul", "link": "https://stackoverflow.com/users/7314877/ctanakul"}, "edited": false, "score": 0, "creation_date": 1525827693, "post_id": 50244031, "comment_id": 87505854, "body": "Thank you so much,  So I added a loop of reading each character and the reply is shown now."}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "reply_to_user": {"reputation": 141, "user_id": 7314877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/278791757911e2e5280b61fc987dfb46?s=128&d=identicon&r=PG&f=1", "display_name": "ctanakul", "link": "https://stackoverflow.com/users/7314877/ctanakul"}, "edited": false, "score": 1, "creation_date": 1525827873, "post_id": 50244031, "comment_id": 87505899, "body": "You don&#39;t need to read a byte at a time, but while the total transfer count is less than expected you need to advance the pointer and decrement the length parameter and re-read. Reading one byte at a time is extremely inefficient."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1525971624, "post_id": 50244031, "comment_id": 87572558, "body": "If <code>server_reply</code> starts with a NUL byte, <code>printf(&quot;%.*s\\n&quot;, read_result, server_reply);</code> will only print a newline."}], "tags": [], "owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "is_accepted": true, "score": 2, "last_activity_date": 1525827445, "last_edit_date": 1525827445, "creation_date": 1525827035, "answer_id": 50244031, "question_id": 50243897, "link": "https://stackoverflow.com/questions/50243897/read-recv-successfully-but-buffer-is-unchanged-and-empty/50244031#50244031", "title": "read()/recv() successfully but buffer is unchanged and empty", "body": "<p>There is no evidence here of a problem, only bad code. If <code>recv()</code> returned 1088 it certainly transferred 1088 bytes into the buffer. Clearly the data received starts with a null byte. To print it correctly, use </p>\n\n<pre><code>printf(\"%.*s\\n\", read_result, server_reply);\n</code></pre>\n\n<p>NB:</p>\n\n<ol>\n<li><p>'The expected size of bytes from reply is 1108, which is correct'. No it isn't. There is no 'expected size'. TCP is a streaming protocol. If <code>recv()</code> returns a positive number, the byte count transferred can be anything from 1 upwards to the buffer length supplied. You have to code a <em>loop</em> to be sure of getting exactly <em>N</em> bytes.</p></li>\n<li><p>Before assuming it is positive, you must also check <code>read_result</code> for zero, which indicates that the peer has disconnected. Do not omit this step.</p></li>\n<li><p><code>strlen(server_reply)</code> is irrelevant. You don't know whether there is a trailing null at all. There could be no nulls at all, or several, including, as in this case, one right at the beginning. </p></li>\n</ol>\n"}], "owner": {"reputation": 141, "user_id": 7314877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/278791757911e2e5280b61fc987dfb46?s=128&d=identicon&r=PG&f=1", "display_name": "ctanakul", "link": "https://stackoverflow.com/users/7314877/ctanakul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1006, "favorite_count": 0, "accepted_answer_id": 50244031, "answer_count": 1, "score": 0, "last_activity_date": 1525827445, "creation_date": 1525825647, "last_edit_date": 1525827402, "question_id": 50243897, "link": "https://stackoverflow.com/questions/50243897/read-recv-successfully-but-buffer-is-unchanged-and-empty", "title": "read()/recv() successfully but buffer is unchanged and empty", "body": "<p>I am writing a client to read the data sent back from a server over socket under TCP with c script on LINUX.</p>\n\n<p>The server is running forever and I validate if I can get the reply with <code>netcat localhost [PORT_NUMBER]</code> already. The server is in LISTEN state when checking with <code>netstat -nap</code></p>\n\n<p>The recv() function returns expected number of bytes, but buffer becomes empty and strlen(buffer) is 0. I also try changing to read() which I did not expect a different result, and the same problem was shown.</p>\n\n<p>This is the code.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt; //strlen\n#include &lt;sys/socket.h&gt;\n#include &lt;arpa/inet.h&gt; //inet_addr\n#include &lt;unistd.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(int argc, char *argv[])\n{\n    int socket_desc, msg_rep_size = 1200, msg_size = 100;\n    struct sockaddr_in server;\n    char message[msg_size], server_reply[msg_rep_size];\n\n    //Create socket\n    socket_desc = socket(AF_INET, SOCK_STREAM, 0);\n    if (socket_desc == -1)\n    {\n        printf(\"Could not create socket\");\n    }\n\n    server.sin_addr.s_addr = inet_addr(\"0.0.0.0\");\n    server.sin_family = AF_INET;\n    server.sin_port = htons(31114); // PORT_NUMBER\n\n    //Connect to remote server\n    if (connect(socket_desc, (struct sockaddr *)&amp;server, sizeof(server)) &lt; 0)\n    {\n        printf(\"connect error\");\n        return 1;\n    }\n    printf(\"Connected\");\n\n\n    while (1)\n    { \n    // send some data\n    bzero(message, msg_size);\n    strncpy(message, \"REQUEST\\n\", msg_size);\n\n    if (send(socket_desc, message, msg_size, 0) &lt; 0)\n    {\n        printf(\"Send failed\");\n        return 1;\n    }\n    printf(\"Data Send\\n\");\n\n    // Receive a reply from the server\n    bzero(server_reply, msg_rep_size);\n    int read_result = recv(socket_desc, server_reply, msg_rep_size, 0); \n\n    if (read_result &lt; 0)\n    {\n        printf(\"Receive failed\\n\");\n        return 1;\n    }\n    else\n    {\n        printf(\"Reply received\\n\");\n        printf(\"read_result: %d\\n\", read_result);\n        printf(\"strlen(server_reply): %d\\n\", (int)strlen(server_reply));\n        printf(\"Reply: %s\\n\", server_reply);\n    }\n    usleep(8);\n}\n\nreturn 0;\n}\n</code></pre>\n\n<p>The printed result in bash is </p>\n\n<pre><code>Data send\nReply received\nread_result: 1108 \nstrlen(server_reply): 0\nReply:\n</code></pre>\n\n<p>The same result is shown if I change from</p>\n\n<pre><code>int read_result = recv(socket_desc, server_reply, msg_rep_size, 0); \n</code></pre>\n\n<p>to</p>\n\n<pre><code>int read_result = read(socket_desc, server_reply, msg_rep_size);\n</code></pre>\n\n<p>Thank you for your help. I am new to socket programming and could not track what is going on.</p>\n\n<p>PS. The expected size of bytes from reply is 1108, which is correct. I intended to put maximum size as 1200 to confirm that correct number of byte is received.</p>\n\n<p>PS2. Please feel free to also comment on the coding style of low-level c as well.  </p>\n"}]