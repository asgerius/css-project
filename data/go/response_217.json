[{"tags": ["docker", "go", "raspberry-pi", "arm", "raspbian"], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 4135235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d54c8e4c419dd046bab5e8f0d8139de2?s=128&d=identicon&r=PG&f=1", "display_name": "Carnifex", "link": "https://stackoverflow.com/users/4135235/carnifex"}, "edited": false, "score": 0, "creation_date": 1551979627, "post_id": 55042459, "comment_id": 96849222, "body": "Thank you very much for trying this at your own system. I tried it, again, with your remarks. I added the shebang and checked the permissions, but I still do get the same error. Now I&#39;m looking for differences between your and my situation. I can only think of something ARCH or OS related. Some info: <code>Linux raspberrypi 4.14.71-v7+ #1145 SMP Fri Sep 21 15:38:35 BST 2018 armv7l GNU&#47;Linux</code>"}], "tags": [], "owner": {"reputation": 99, "user_id": 6172092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bd310f2c921ed8e0e8a5e8447c3ca7a?s=128&d=identicon&r=PG", "display_name": "SubXaero", "link": "https://stackoverflow.com/users/6172092/subxaero"}, "is_accepted": false, "score": 1, "last_activity_date": 1551957194, "creation_date": 1551957194, "answer_id": 55042459, "question_id": 55033901, "link": "https://stackoverflow.com/questions/55033901/docker-entrypoint-sh-results-in-not-found-for-arm-image-with-golang/55042459#55042459", "title": "Docker-entrypoint.sh results in &quot;not found&quot; for ARM image with golang", "body": "<p>I copied this Dockerfile and start script verbatim and it builds and runs perfectly for me. I get </p>\n\n<p><code>Config file not present at the given location:  /config/config.json give correct file location using --config parameter</code> </p>\n\n<p>because I don't have access to the config file you're using. But the fact I get that message means that StatusOk is running. So I don't know what to suggest.</p>\n\n<p>The only difference I made was to add a shebang <code>#!/bin/sh</code> to the start of the <code>docker-entrypoint.sh</code> file, and ensure it has execute permission, by running <code>ls -al</code>, and if it doesn't have <code>x</code> in the permissions, running <code>chmod +rwx</code>. Don't know if that made any difference as to how the script tried to access <code>/go/bin/StatusOk</code>. </p>\n\n<p><a href=\"https://i.stack.imgur.com/8S2Rp.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/8S2Rp.png\" alt=\"enter image description here\"></a></p>\n\n<p>Full <code>docker-entrypoint.sh</code> contents:</p>\n\n<pre><code>#!/bin/sh\n/go/bin/StatusOk --config /config/config.json\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 4135235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d54c8e4c419dd046bab5e8f0d8139de2?s=128&d=identicon&r=PG&f=1", "display_name": "Carnifex", "link": "https://stackoverflow.com/users/4135235/carnifex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1551957194, "creation_date": 1551915583, "question_id": 55033901, "link": "https://stackoverflow.com/questions/55033901/docker-entrypoint-sh-results-in-not-found-for-arm-image-with-golang", "title": "Docker-entrypoint.sh results in &quot;not found&quot; for ARM image with golang", "body": "<p>My problem is that I get an error when running my container on an ARM arch system(RaspberryPI with Raspbian). Image was built on that same Raspberry. </p>\n\n<p>This is my <code>dockerfile</code>:</p>\n\n<pre><code>FROM arm32v7/golang\n\nCOPY qemu-arm-static /usr/bin\n\nENV STATUSOK_VERSION 0.1.1\n\nRUN apt-get update \\\n    &amp;&amp; apt-get install -y unzip \\\n    &amp;&amp; wget https://github.com/sanathp/statusok/releases/download/$STATUSOK_VERSION/statusok_linux.zip \\\n    &amp;&amp; unzip statusok_linux.zip \\\n    &amp;&amp; mv ./statusok_linux/statusok /go/bin/StatusOk \\\n    &amp;&amp; rm -rf ./statusok_linux* \\\n    &amp;&amp; apt-get remove -y unzip git \\\n    &amp;&amp; apt-get autoremove -y \\\n    &amp;&amp; apt-get clean \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\nVOLUME /config\nCOPY ./docker-entrypoint.sh /docker-entrypoint.sh\nENTRYPOINT /docker-entrypoint.sh\n</code></pre>\n\n<p>I'm able to succesfully build this on a RaspberryPI running Raspbian:</p>\n\n<pre><code>root@raspberrypi:~/armstatusok# docker build . -t armstatusok\nSending build context to Docker daemon  6.656kB\nStep 1/7 : FROM arm32v7/golang\n ---&gt; 8bbfdfd01a06\nStep 2/7 : COPY qemu-arm-static /usr/bin\n ---&gt; Using cache\n ---&gt; 2572fd1e03a0\nStep 3/7 : ENV STATUSOK_VERSION 0.1.1\n ---&gt; Using cache\n ---&gt; 25d39a4c6eb5\nStep 4/7 : RUN apt-get update     &amp;&amp; apt-get install -y unzip     &amp;&amp; wget https://github.com/sanathp/statusok/releases/download/$STATUSOK_VERSION/statusok_linux.zip     &amp;&amp; unzip statusok_linux.zip     &amp;&amp; mv ./statusok_linux/statusok /go/bin/StatusOk     &amp;&amp; rm -rf ./statusok_linux*     &amp;&amp; apt-get remove -y unzip git     &amp;&amp; apt-get autoremove -y     &amp;&amp; apt-get clean     &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n ---&gt; Using cache\n ---&gt; bfb1cfa9a985\nStep 5/7 : VOLUME /config\n ---&gt; Using cache\n ---&gt; 3bfbce28329b\nStep 6/7 : COPY ./docker-entrypoint.sh /docker-entrypoint.sh\n ---&gt; Using cache\n ---&gt; a1795ca4f40c\nStep 7/7 : ENTRYPOINT /docker-entrypoint.sh\n ---&gt; Using cache\n ---&gt; d0ce74911ba3\nSuccessfully built d0ce74911ba3\nSuccessfully tagged armstatusok:latest\n</code></pre>\n\n<p>Next step is to run it, and where I get into trouble:</p>\n\n<pre><code>root@raspberrypi:~/armstatusok# docker run --name=armstatusok -v $PWD:/config armstatusok\n/docker-entrypoint.sh: 1: /docker-entrypoint.sh: /go/bin/StatusOk: not found\n</code></pre>\n\n<p>I went into the container commenting line one of the <code>docker-entrypoint.sh</code> and checked if <code>/go/bin/StatusOk</code> was actually there, and it was.</p>\n\n<p>My <code>docker-entrypoint.sh</code>:</p>\n\n<pre><code>root@raspberrypi:~/armstatusok# cat docker-entrypoint.sh\n/go/bin/StatusOk --config /config/config.json\n</code></pre>\n\n<p>Now my question is, does anybody have a clue where to start? I also tested this dockerfile on x86 arch, and there it worked. I only changed the FROM line to the x86 flavour and removed the <code>COPY qemu-arm-static /usr/bin</code> since that line is there to make it work on ARM arch, according to documentation.</p>\n"}, {"tags": ["go", "github"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 5, "creation_date": 1551916585, "post_id": 55033890, "comment_id": 96820529, "body": "Create a repo on Github for each of the directories. Github shows instructions for the next steps after you create the repo.  The process for creating a repo containing Go code is the same as the process for a repo containing code written in any language."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1551968584, "post_id": 55033890, "comment_id": 96842455, "body": "&quot;Commiting stuff written in Go on github is kinda confusing to me&quot; - then forget it&#39;s written in Go, because it&#39;s irrelevant. It&#39;s just files. Create a repo and commit the files."}], "answers": [{"tags": [], "owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "is_accepted": true, "score": 5, "last_activity_date": 1551940854, "last_edit_date": 1551940854, "creation_date": 1551916690, "answer_id": 55034037, "question_id": 55033890, "link": "https://stackoverflow.com/questions/55033890/upload-go-project-to-github-repository/55034037#55034037", "title": "Upload Go project to GitHub Repository", "body": "<p>This is done the same way that you would initialize and commit a new repository regardless of the language.</p>\n\n<p>Go just makes it a little easier to find your other Go projects thanks to the $GOPATH and the standards of the language. Simple example below.</p>\n\n<p><em>Within project 1:</em></p>\n\n<pre><code>$ cd ~/go/src/github.com/StefanCepa/projectOne/\n$ git init\n$ git add .\n$ git commit -m 'init'\n$ git remote add origin https://github.com/StefanCepa/projectOne.git\n$ git push -u origin master\n</code></pre>\n\n<p><em>Within project 2:</em> </p>\n\n<p>*same process as above</p>\n"}], "owner": {"reputation": 905, "user_id": 8560600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-zQ0B8tCv38k/AAAAAAAAAAI/AAAAAAAAAAw/bWWd0qZVS8I/photo.jpg?sz=128", "display_name": "Stefan Radonjic", "link": "https://stackoverflow.com/users/8560600/stefan-radonjic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 748, "favorite_count": 0, "accepted_answer_id": 55034037, "answer_count": 1, "score": -4, "last_activity_date": 1551940854, "creation_date": 1551915498, "last_edit_date": 1551940822, "question_id": 55033890, "link": "https://stackoverflow.com/questions/55033890/upload-go-project-to-github-repository", "title": "Upload Go project to GitHub Repository", "body": "<p>How can i successfully upload my Go project to existing github repository? Here is how my <strong>$GOPATH</strong> looks like: <code>/home/user/go</code>.</p>\n\n<p>There I have created the following directories: <strong><code>src/github.com/StefanCepa/</code></strong> . And inside that directory I have 2x directories which represent two different projects. I would like each of those projects to be posted on seperate github repository.</p>\n\n<p>Any ideas how can I do that? Commiting stuff written in Go on github is kinda confusing to me.</p>\n"}, {"tags": ["go", "kubernetes", "flannel", "flanneld"], "answers": [{"tags": [], "owner": {"reputation": 302, "user_id": 5419381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85b8d3139ea6cba07653808bd4f83e5e?s=128&d=identicon&r=PG&f=1", "display_name": "duct_tape_coder", "link": "https://stackoverflow.com/users/5419381/duct-tape-coder"}, "is_accepted": true, "score": 1, "last_activity_date": 1552058238, "creation_date": 1552058238, "answer_id": 55066135, "question_id": 55032935, "link": "https://stackoverflow.com/questions/55032935/flanneld-error-registering-network-cannot-finding-network-with-management-ip/55066135#55066135", "title": "Flanneld: error registering network: cannot finding network with management IP", "body": "<p>Apparently I didn't read the requirements closely enough. Flannel VXLAN on Windows isn't supported until Kubernetes 1.14 which will release March 25.</p>\n\n<pre><code>Overlay networking: use Flannel in vxlan mode to configure a virtual overlay network\n\n-     requires either Windows Server 2019 with KB4482887 installed or Windows Server vNext Insider Preview Build 18317+\n-     requires Kubernetes v1.14 (or above) with WinOverlay feature gate enabled\n-     requires Flannel v0.11.0 (or above)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16928, "user_id": 1047788, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/xA1rW.png?s=128&g=1", "display_name": "user7610", "link": "https://stackoverflow.com/users/1047788/user7610"}, "is_accepted": false, "score": 0, "last_activity_date": 1583572017, "creation_date": 1583572017, "answer_id": 60575986, "question_id": 55032935, "link": "https://stackoverflow.com/questions/55032935/flanneld-error-registering-network-cannot-finding-network-with-management-ip/60575986#60575986", "title": "Flanneld: error registering network: cannot finding network with management IP", "body": "<p>When specifying parameters for <code>./start.ps1</code></p>\n\n<pre><code>.\\start.ps1 -ManagementIP 10.0.xxx.xxx [...]\n</code></pre>\n\n<p>I put there IP of Kubernetes API server, instead of IP of the new Windows node, as <code>-ManagementIP</code>.</p>\n\n<p>Reruning <code>start.ps1</code> with correct value resolved my problem.</p>\n"}], "owner": {"reputation": 302, "user_id": 5419381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85b8d3139ea6cba07653808bd4f83e5e?s=128&d=identicon&r=PG&f=1", "display_name": "duct_tape_coder", "link": "https://stackoverflow.com/users/5419381/duct-tape-coder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 478, "favorite_count": 0, "accepted_answer_id": 55066135, "answer_count": 2, "score": 1, "last_activity_date": 1583572017, "creation_date": 1551910049, "question_id": 55032935, "link": "https://stackoverflow.com/questions/55032935/flanneld-error-registering-network-cannot-finding-network-with-management-ip", "title": "Flanneld: error registering network: cannot finding network with management IP", "body": "<p>I'm setting up a mixed-mode kubernetes cluster (CentOS7 master, WS2019 worker) using Flannel in overlay (VXLAN) mode. I've gotten through the <a href=\"https://docs.microsoft.com/en-us/virtualization/windowscontainers/kubernetes/joining-windows-workers?tabs=ManagementIP\" rel=\"nofollow noreferrer\">Microsoft Kubernetes for Windows Instructions</a> but when I kick off start.ps1 I'm stuck in the \"Waiting for the Network to be created\" loop referenced <a href=\"https://docs.microsoft.com/en-us/virtualization/windowscontainers/kubernetes/common-problems#after-launching-startps1-flanneld-is-stuck-in-waiting-for-the-network-to-be-created\" rel=\"nofollow noreferrer\">here</a>. Launching flanneld directly per their instructions, I get the following error:</p>\n\n<blockquote>\n  <p>E0306 16:43:21.218797     2576 main.go:289] Error registering network: Cannot find network with Management IP [IPAddrofWorkerNIC].</p>\n</blockquote>\n\n<p>The IP referenced is the main IP of the worker on the \"Ethernet\" NIC as called per the <code>--iface</code> argument to flanneld.</p>\n\n<p>The master and worker are both Hyper-v VMs off of a Win10 1809 box with MAC spoofing enabled. I confirmed that 6433/tcp, 10250/tcp, 4096/udp, and 4789/udp are opened in firewalld of the master. I also tried again after disabling firewalld, with no change, so I don't think the issue is on the master side.</p>\n\n<p>I tried digging through the <a href=\"https://github.com/coreos/flannel/blob/master/main.go\" rel=\"nofollow noreferrer\">flanneld Go code</a> at the referenced line 289 for clues but I'm not familiar with Go and had to concede defeat.</p>\n\n<p>Any ideas why I would be getting this error?</p>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 2, "creation_date": 1551907489, "post_id": 55032294, "comment_id": 96817307, "body": "It&#39;s just not possible.  There is an interesting discussion about it when it was proposed to change the language to allow it but the proposal got rejected (I still hold out hope for Go 2!) <a href=\"https://github.com/golang/go/issues/12754\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/12754</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1551907922, "post_id": 55032294, "comment_id": 96817488, "body": "The posted code isn&#39;t violating interface rules, it&#39;s violating basic type safety. The function signature states it returns a <code>*S1</code>, then tries to return a <code>*S0</code> instead. The interfaces defined are irrelevant."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1551913718, "post_id": 55032294, "comment_id": 96819740, "body": "i agree with Adrian. the example code is plainly wrong. apart, from S1 point of view, it is forbidden to return S0, as fn1 explicitly defines that it returns an S1, that is a well defined struct."}, {"owner": {"reputation": 3818, "user_id": 420597, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/7d09a2e03dd37d6c27f2bdfaec5b3917?s=128&d=identicon&r=PG", "display_name": "transistor09", "link": "https://stackoverflow.com/users/420597/transistor09"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551968286, "post_id": 55032294, "comment_id": 96842254, "body": "@Adrian that was not intentional; fixed now."}], "owner": {"reputation": 3818, "user_id": 420597, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/7d09a2e03dd37d6c27f2bdfaec5b3917?s=128&d=identicon&r=PG", "display_name": "transistor09", "link": "https://stackoverflow.com/users/420597/transistor09"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1552502844, "creation_date": 1551907086, "last_edit_date": 1552502844, "question_id": 55032294, "link": "https://stackoverflow.com/questions/55032294/how-work-around-type-systems-shallow-interface-matching-covariant-result-type", "title": "How work around type system&#39;s shallow interface matching? (covariant result types)", "body": "<p>The delightful golang's interface matching seems to only go one layer deep. It matches the concrete structs (or their pointers) to interfaces as they are presented, but, if they are wrapped in anything, matching fails.</p>\n\n<p>This also affects channels: the types of values they pass are not eligible for interface compatibility checks.</p>\n\n<p>Minimal illustration:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type I0 interface{ fn0() }\ntype I1 interface{ fn1() I0 }\n\ntype S0 struct{}\n\nfunc (s *S0) fn0() {}\n\ntype S1 struct{}\n\nfunc (s *S1) fn1() *S0 { return &amp;S0{} }\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/mD-RIDUg2Iy\" rel=\"nofollow noreferrer\">View in playground</a></p>\n\n<p>Now in this trivial example it's possible to just adapt <code>S1</code>'s <code>fn1</code> return type, but I'd like to later use a type switch to recover original type <em>without</em> invoking the function.</p>\n\n<hr>\n\n<p>The function case is mentioned in Go's FAQ as <a href=\"https://golang.org/doc/faq#covariant_types\" rel=\"nofollow noreferrer\">covariant result types</a>.</p>\n"}, {"tags": ["angular", "go", "nginx", "cors"], "answers": [{"comments": [{"owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "edited": false, "score": 0, "creation_date": 1551947696, "post_id": 55038236, "comment_id": 96829566, "body": "Thanks, but it didn&#39;t work either."}, {"owner": {"reputation": 2442, "user_id": 2988776, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/LQEd5.png?s=128&g=1", "display_name": "Ravinder Payal", "link": "https://stackoverflow.com/users/2988776/ravinder-payal"}, "reply_to_user": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "edited": false, "score": 0, "creation_date": 1551947821, "post_id": 55038236, "comment_id": 96829632, "body": "I might be doing an additional request with a different method as well, try with the wildcard (<i>) res.Header().Set(&quot;Access-Control-Allow-Methods&quot;, &quot;</i>&quot;)"}, {"owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "edited": false, "score": 0, "creation_date": 1551949736, "post_id": 55038236, "comment_id": 96830797, "body": "You mean to set a wildcard like &quot;*&quot; or leave it empty as &quot;&quot;? I tried wildcard in both Golang code and Nginx but the problem remains."}, {"owner": {"reputation": 2442, "user_id": 2988776, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/LQEd5.png?s=128&g=1", "display_name": "Ravinder Payal", "link": "https://stackoverflow.com/users/2988776/ravinder-payal"}, "reply_to_user": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "edited": false, "score": 1, "creation_date": 1551950678, "post_id": 55038236, "comment_id": 96831379, "body": "I meant *, but if it&#39;s still not working then there&#39;s some other problem. Check in network monitor if the set headers are appearing or not in request."}, {"owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "edited": false, "score": 0, "creation_date": 1552339041, "post_id": 55038236, "comment_id": 96963885, "body": "Following your suggestion, I spent the last few days learning tcpdump to do so and, long story short, the mistake is a dumb one. I&#39;d set the front end to communicate with localhost. Obviously, that meant whichever client browser using the front end would be looking for it on its own local machine. So, thank you."}], "tags": [], "owner": {"reputation": 2442, "user_id": 2988776, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/LQEd5.png?s=128&g=1", "display_name": "Ravinder Payal", "link": "https://stackoverflow.com/users/2988776/ravinder-payal"}, "is_accepted": false, "score": 1, "last_activity_date": 1551943658, "creation_date": 1551943658, "answer_id": 55038236, "question_id": 55031745, "link": "https://stackoverflow.com/questions/55031745/cors-request-did-not-succeed-despite-enabling-it-for-nginx-angular-http-serve/55038236#55038236", "title": "&quot;CORS request did not succeed&quot; despite enabling it for Nginx, angular-http-server, and Golang", "body": "<pre><code>    func anteroom(res http.ResponseWriter, req *http.Request) {\n    res.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    res.Header().Set(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\")\n    res.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")\n    res.Header().Set(\"Content-Type\", \"application/json\")\n...\n}\n\nfunc main() {\n    ...\n    # Using Gorilla mux router.\n    router := mux.NewRouter()\n    router.HandleFunc(\"/anteroom\", anteroom).Methods(\"POST\", \"OPTIONS\")\n}\n</code></pre>\n\n<p>GET method is missing in the code.</p>\n\n<p>Change this line     <code>res.Header().Set(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\")</code> to <code>res.Header().Set(\"Access-Control-Allow-Methods\", \"GET, POST, OPTIONS\")</code></p>\n"}, {"tags": [], "owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "is_accepted": true, "score": 2, "last_activity_date": 1552342639, "creation_date": 1552342639, "answer_id": 55111247, "question_id": 55031745, "link": "https://stackoverflow.com/questions/55031745/cors-request-did-not-succeed-despite-enabling-it-for-nginx-angular-http-serve/55111247#55111247", "title": "&quot;CORS request did not succeed&quot; despite enabling it for Nginx, angular-http-server, and Golang", "body": "<p>Thanks to Ravinder Payal, I used tcpdump to look at the headers going back and forth. To cut a very long story short, at some point it made me realise that I'd set the front end to communicate with \"localhost\". Obviously, that meant whichever client browser using the front end would be looking for it on its own local machine. </p>\n\n<p>To solve this, I set up separate <a href=\"https://github.com/angular/angular-cli/wiki/stories-application-environments\" rel=\"nofollow noreferrer\">application environments</a> for my angular front end. This allows the front end to communicate with localhost in staging and with my back end domain in production.</p>\n"}], "owner": {"reputation": 525, "user_id": 1291530, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/syHq5.png?s=128&g=1", "display_name": "nusantara", "link": "https://stackoverflow.com/users/1291530/nusantara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2986, "favorite_count": 0, "closed_date": 1552399433, "accepted_answer_id": 55111247, "answer_count": 2, "score": 0, "last_activity_date": 1552342639, "creation_date": 1551904562, "last_edit_date": 1551943372, "question_id": 55031745, "link": "https://stackoverflow.com/questions/55031745/cors-request-did-not-succeed-despite-enabling-it-for-nginx-angular-http-serve", "closed_reason": "Not suitable for this site", "title": "&quot;CORS request did not succeed&quot; despite enabling it for Nginx, angular-http-server, and Golang", "body": "<p>I've enabled CORS successfully in development. My Golang back end communicates well with my Angular front end on my local machine. However, I can't figure out how to enable CORS in production (Ubuntu on DigitalOcean). I get this on Firefox:</p>\n\n<p>\"Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at <a href=\"http://localhost:12345/anteroom\" rel=\"nofollow noreferrer\">http://localhost:12345/anteroom</a>. (Reason: CORS request did not succeed).\"</p>\n\n<p>I'm running the Golang back end with a systemd unit and serving it at localhost:12345.</p>\n\n<p>I'm running the Angular front end as a build (built with <code>--prod</code> flag) using PM2 with angular-http-server, and serving it out of port 8080. This port is behind a firewall. I use Nginx to handle HTTPS traffic for this front end. It listens on port 80 and passes (<code>proxy_pass</code>) requests to it at port 8080. The landing page (which requires only a GET request) loads ok in the browser, so this setup seems feasible.</p>\n\n<p>The versions I'm working with: Ubuntu 16.04, PM2 3.3.1, Angular CLI 7.3.4, angular-http-server 1.8.1.</p>\n\n<p>The problem happens when the front end tries to POST JSON data to the back end (localhost:12345/anteroom, as seen in the message above).</p>\n\n<p>I've read that CORS is a server-side issue. So, I've tried enabling it wherever I've a server, that is, in the back end, Nginx, and angular-http-server.</p>\n\n<p>It's enabled in my Golang code:</p>\n\n<pre><code>func anteroom(res http.ResponseWriter, req *http.Request) {\n    res.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    res.Header().Set(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\")\n    res.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")\n    res.Header().Set(\"Content-Type\", \"application/json\")\n...\n}\n\nfunc main() {\n    ...\n    # Using Gorilla mux router.\n    router := mux.NewRouter()\n    router.HandleFunc(\"/anteroom\", anteroom).Methods(\"POST\", \"OPTIONS\")\n}\n</code></pre>\n\n<p>This successfully enables CORS in development, where serving Golang is just opening its built binary and Angular is served with <code>ng serve</code>.</p>\n\n<p>The above isn't enough in production. So, I've tried enabling it with angular-http-server. Note the <code>--cors</code> flag at the end:</p>\n\n<pre><code>pm2 start $(which angular-http-server) --name app -- --path /PATH/TO/DIST -p 8080 --cors\n</code></pre>\n\n<p>I've also tried enabling it in the Nginx file pertaining to the Angular front end build (adapted from <a href=\"https://enable-cors.org/server_nginx.html\" rel=\"nofollow noreferrer\">here</a>):</p>\n\n<pre><code>location / {\nif ($request_method = 'OPTIONS') {\n        add_header 'Access-Control-Allow-Origin' '*';\n        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';\n        add_header 'Access-Control-Allow-Headers' 'Content-Type';\n        add_header 'Content-Type' 'application/json';\n        return 204;\n     }\n\n     if ($request_method = 'POST') {\n        add_header 'Access-Control-Allow-Origin' '*';\n        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';\n        add_header 'Access-Control-Allow-Headers' 'Content-Type';\n        add_header 'Content-Type' 'application/json';\n     }\n\n     if ($request_method = 'GET') {\n        add_header 'Access-Control-Allow-Origin' '*';\n        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';\n        add_header 'Access-Control-Allow-Headers' 'Content-Type';\n     }\nproxy_pass http://localhost:8080;\n}\n}\n</code></pre>\n\n<p>I've looked at the documentation for PM2, angular-http-server, Nginx, and a bunch of other things and I don't know what I'm missing. Let me know? Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1551904126, "post_id": 55031631, "comment_id": 96815907, "body": "I&#39;m sure there&#39;s no standard function for this. But which function you should use depends a lot on where you&#39;re reading the input (on the console? through a GUI?). Creating such a function should be a trivial task."}, {"owner": {"reputation": 121, "user_id": 9189479, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5dd31c32cd9afefcafe62fcb009f22e4?s=128&d=identicon&r=PG&f=1", "display_name": "jberthia", "link": "https://stackoverflow.com/users/9189479/jberthia"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1551904255, "post_id": 55031631, "comment_id": 96815955, "body": "It will be through the console only.  The GUI is not involved.  I am new to golang, so any help you can give would be greatly appreciated."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1551904350, "post_id": 55031631, "comment_id": 96816000, "body": "Well then, whatever function you wrote to echo back the password... just modify it to echo back a * char instead."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1551904489, "post_id": 55031631, "comment_id": 96816060, "body": "I would probably just use <a href=\"https://godoc.org/golang.org/x/crypto/ssh/terminal#ReadPassword\" rel=\"nofollow noreferrer\"><code>x&#47;crypto&#47;ssh&#47;terminal.ReadPassword</code></a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1551904498, "post_id": 55031631, "comment_id": 96816064, "body": "@Flimzy console echos what&#39;s typed by default. You have to turn echo off."}, {"owner": {"reputation": 121, "user_id": 9189479, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5dd31c32cd9afefcafe62fcb009f22e4?s=128&d=identicon&r=PG&f=1", "display_name": "jberthia", "link": "https://stackoverflow.com/users/9189479/jberthia"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1551904941, "post_id": 55031631, "comment_id": 96816250, "body": "@Tim  From what I see about ReadPassword, it returns things without a local echo.  So, I am assuming this will not return anything when I type the password.  Is there a way to modify this so that it will show some output?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551940377, "post_id": 55031631, "comment_id": 96826346, "body": "@Adrian: That depends how you&#39;re reading data from the console."}], "answers": [{"tags": [], "owner": {"reputation": 322, "user_id": 9183891, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec5cdaa8b1c8cc83f9617d5864a412f8?s=128&d=identicon&r=PG&f=1", "display_name": "Piko Monde", "link": "https://stackoverflow.com/users/9183891/piko-monde"}, "is_accepted": false, "score": 2, "last_activity_date": 1551911363, "last_edit_date": 1551911363, "creation_date": 1551910988, "answer_id": 55033127, "question_id": 55031631, "link": "https://stackoverflow.com/questions/55031631/is-there-a-golang-function-to-populate-special-characters-when-typing-a-password/55033127#55033127", "title": "Is there a golang function to populate special characters when typing a password?", "body": "<p>Take a look at <a href=\"https://stackoverflow.com/a/32768479\">this</a>.</p>\n\n<p>I know, it might not answer your question. But, this is an alternative to the answer. Instead of using <code>*********</code> to mask the password, actually it will use the standard \"blank\" password masking on the terminal.</p>\n\n<p>Here is the screenshot of the program when executed:\n<a href=\"https://i.stack.imgur.com/IGuBo.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/IGuBo.png\" alt=\"Screenshot of running program\"></a></p>\n\n<p>You can see at the <code>Enter Password:</code> part, that it is blank instead of asterisks <code>*********</code> or other symbols.</p>\n"}], "owner": {"reputation": 121, "user_id": 9189479, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5dd31c32cd9afefcafe62fcb009f22e4?s=128&d=identicon&r=PG&f=1", "display_name": "jberthia", "link": "https://stackoverflow.com/users/9189479/jberthia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1551911363, "creation_date": 1551903993, "last_edit_date": 1551904081, "question_id": 55031631, "link": "https://stackoverflow.com/questions/55031631/is-there-a-golang-function-to-populate-special-characters-when-typing-a-password", "title": "Is there a golang function to populate special characters when typing a password?", "body": "<p>I would like to know if there is a way in Go to populate a password output with special characters when you are typing the password.</p>\n\n<p>For example, I want to type the word \"password\" in the password field when it prompts me for the password.  I want the output on the screen to look like this:</p>\n\n<pre><code>Enter Password: ********\n</code></pre>\n\n<p>Where the \"********\" are the characters of \"password\".  Does GOLANG have something that will allow me to do this?</p>\n"}, {"tags": ["session", "go", "cookies", "error-handling", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1551916965, "post_id": 55031636, "comment_id": 96820622, "body": "Odd the package would have an exported error <code>securecookie.ErrMacInvalid</code> that is so hard to check. Not sure what problem the  <code>MultiError</code> type is trying to solve, as it just seems to complicate client code. Even the Cause() method seems to admit how useless it is."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 3, "last_activity_date": 1551904003, "creation_date": 1551904003, "answer_id": 55031636, "question_id": 55031499, "link": "https://stackoverflow.com/questions/55031499/detecting-specific-error-from-multi-error-type/55031636#55031636", "title": "Detecting specific error from multi-error type", "body": "<blockquote>\n  <p>is there an easier way?</p>\n</blockquote>\n\n<p>No. Sorry.</p>\n"}], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 55031636, "answer_count": 1, "score": 2, "last_activity_date": 1551904003, "creation_date": 1551903358, "question_id": 55031499, "link": "https://stackoverflow.com/questions/55031499/detecting-specific-error-from-multi-error-type", "title": "Detecting specific error from multi-error type", "body": "<p>Trying to differentiate from a bad user-cookie error vs. an internal error using <code>gorilla/sessions</code> e.g.</p>\n\n<pre><code>import \"github.com/gorilla/sessions\"\n\nsess, err := store.Get(r, sessName)\nif err != nil {\n    // either user error (bad-cookie i.e. invalid HMAC)\n    //      http.Error(w, \"not authenticated\", http.StatusUnauthorized)\n\n    // or server error (FileSystemStore i/o)\n    //      http.Error(w, \"internal error\", http.StatusInternalServerError)\n    return\n}\n</code></pre>\n\n<p>The underlying <code>securecookie</code> package has an exported error <code>ErrMacInvalid</code> for bad user cookies. So ordinarily one would just check for this specific error, but this does <strong>not</strong> work:</p>\n\n<pre><code>import \"github.com/gorilla/securecookie\"\n\nif err == securecookie.ErrMacInvalid {\n    // bad user-cookie\n} else if err != nil {\n    // otherwise internal error\n}\n</code></pre>\n\n<p>The reason it does not work - using say <code>securecookie.NewCookieStore()</code> as a session store - is it will return a error of type <a href=\"https://github.com/gorilla/securecookie/blob/master/securecookie.go#L605\" rel=\"nofollow noreferrer\">securecookie.MultiError</a> \n (a <code>[]error</code> type) with the <code>securecookie.ErrMacInvalid</code> value listed within the error slice.</p>\n\n<p>Trying something like this seems very convoluted:</p>\n\n<pre><code>if e2, ok := err.(securecookie.MultiError); ok &amp;&amp; len(e2) &gt; 0 &amp;&amp; e2[0] == securecookie.ErrMacInvalid { {\n    // bad user-cookie\n} else if err != nil {\n    // otherwise internal error\n}\n</code></pre>\n\n<p>is there an easier way?</p>\n"}, {"tags": ["go", "dns", "spf", "domain-record"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1551900118, "post_id": 55030681, "comment_id": 96813805, "body": "Title talks about looking for an &quot;efficient&quot; way to get TXT records but the body doesn&#39;t seem to have anything to do with efficiency of the  operation - can you clarify?"}, {"owner": {"reputation": 2052, "user_id": 5841297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e504d8fcbf8a9f2babac46fa5d281d7c?s=128&d=identicon&r=PG&f=1", "display_name": "Maruthi Adithya", "link": "https://stackoverflow.com/users/5841297/maruthi-adithya"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551900526, "post_id": 55030681, "comment_id": 96814032, "body": "@Adrian Thanks, since I am getting a timeout for many input cases, I want to know the best way to achieve my output without getting these timeout exceptions. Sorry, I have modified the question title correctly"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1551901187, "post_id": 55030681, "comment_id": 96814388, "body": "Set a longer timeout in resolv.conf."}, {"owner": {"reputation": 2052, "user_id": 5841297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e504d8fcbf8a9f2babac46fa5d281d7c?s=128&d=identicon&r=PG&f=1", "display_name": "Maruthi Adithya", "link": "https://stackoverflow.com/users/5841297/maruthi-adithya"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551925765, "post_id": 55030681, "comment_id": 96822599, "body": "@ThunderCat, I have updated my question, kindly take a look at it"}], "answers": [{"tags": [], "owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "is_accepted": false, "score": 2, "last_activity_date": 1551986676, "last_edit_date": 1551986676, "creation_date": 1551901338, "answer_id": 55031030, "question_id": 55030681, "link": "https://stackoverflow.com/questions/55030681/extracting-all-the-txt-records-of-a-particular-domain/55031030#55031030", "title": "Extracting all the TXT Records of a particular Domain", "body": "<p>It is likely that your recursive resolver is misconfigured or just broken.  It probably does not handle EDNS correctly, or does not process TCP queries at all.  (Some client virtualization solutions have built-in DNS forwarders with these problems.)</p>\n\n<p>The reason why TCP is needed is that the response size is larger than 512 bytes:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ dig +ignore +bufsize=512 geckoboard.com txt\n\n; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Debian &lt;&lt;&gt;&gt; +ignore +bufsize=512 geckoboard.com txt\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 60761\n;; flags: qr tc rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1200\n;; QUESTION SECTION:\n;geckoboard.com.            IN  TXT\n\n;; Query time: 0 msec\n;; SERVER: 127.0.0.1#53(127.0.0.1)\n;; WHEN: Wed Mar 06 20:39:31 CET 2019\n;; MSG SIZE  rcvd: 43\n</code></pre>\n\n<p>The <code>tc</code> flag means that the client is supposed to retry over TCP.  (Normally, <code>dig</code> will do this automatically, but the <code>+ignore</code> flag suppresses this.)</p>\n\n<p>This appears to fail in your environment.  It is also possible that the recursive resolver itself cannot obtain the data from the global DNS.  The fact that the <code>dig</code> query results in a timeout and not a response with <code>tc</code> suggests the latter.  Further debugging requires packet captures.</p>\n"}, {"tags": [], "owner": {"reputation": 2052, "user_id": 5841297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e504d8fcbf8a9f2babac46fa5d281d7c?s=128&d=identicon&r=PG&f=1", "display_name": "Maruthi Adithya", "link": "https://stackoverflow.com/users/5841297/maruthi-adithya"}, "is_accepted": true, "score": 0, "last_activity_date": 1552028612, "creation_date": 1552028612, "answer_id": 55058280, "question_id": 55030681, "link": "https://stackoverflow.com/questions/55030681/extracting-all-the-txt-records-of-a-particular-domain/55058280#55058280", "title": "Extracting all the TXT Records of a particular Domain", "body": "<p>Thanks, @Florian Weimer for your help. I have got this working with a small extension your <code>dig</code> command.</p>\n\n<pre><code>$ dig @8.8.8.8 +ignore +short +bufsize=1024 geckoboard.com txt\n\"MS=ms20890953\"\n\"facebook-domain-verification=uh1r0ebrc3sig0h2za0djoj4mhkn3g\"\n\"google-site-verification=I6OUOqinHxPNuD8YBb3-c8GQA7YkbeHdx0xwUeeGLqI\"\n\"google-site-verification=PWaSMmjvCe_daQC2-b7cZ9UW4rFt6Y8ZWQ7YoRbhMDw\"\n\"google-site-verification=lSxvRgW-oP91yihSZ1kNv57EfgT97tmErxAjv5HFi2Q\"\n\"spf2.0/pra include:spf.recurly.com ~all\"\n\"status-page-domain-verification=8963fbq9nrjx\"\n\"v=spf1 include:_spf.google.com include:sendgrid.net include:spf.recurly.com include:mail.zendesk.com include:servers.mcsv.net ~all\"\n</code></pre>\n\n<p>My Golang code for the same is: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n)\n\nfunc main() {\n    out, err := exec.Command(\"bash\", \"-c\", \"dig @8.8.8.8 +ignore +short +bufsize=1024 geckoboard.com txt\").Output()\n    s := string(out[:])\n\n    if err != nil {\n        fmt.Println(\"Unexpected Error Occured \", err)\n    }\n    fmt.Printf(s)\n}\n</code></pre>\n"}], "owner": {"reputation": 2052, "user_id": 5841297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e504d8fcbf8a9f2babac46fa5d281d7c?s=128&d=identicon&r=PG&f=1", "display_name": "Maruthi Adithya", "link": "https://stackoverflow.com/users/5841297/maruthi-adithya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "accepted_answer_id": 55058280, "answer_count": 2, "score": 1, "last_activity_date": 1552028612, "creation_date": 1551900013, "last_edit_date": 1551935435, "question_id": 55030681, "link": "https://stackoverflow.com/questions/55030681/extracting-all-the-txt-records-of-a-particular-domain", "title": "Extracting all the TXT Records of a particular Domain", "body": "<p>I want to extract the TXT Records of a particular domain in Go. I looked at a bunch of blogs and tried the following code:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"net\"\n)\n\nfunc main() {\n        txts, err := net.LookupTXT(\"google.com\")\n        if err != nil {\n                panic(err)\n        }\n        if len(txts) == 0 {\n                fmt.Printf(\"no record\")\n        }\n        for _, txt := range txts {\n                fmt.Printf(\"%s\\n\", txt)\n        }\n\n}\n</code></pre>\n\n<p>When I execute this program, I get the following output.</p>\n\n<pre><code>docusign=05958488-4752-4ef2-95eb-aa7ba8a3bd0e\nfacebook-domain-verification=22rm551cu4k0ab0bxsw536tlds4h95\nglobalsign-smime-dv=CDYX+XFHUw2wml6/Gb8+59BsH31KzUr6c1l2BPvqKX8=\nv=spf1 include:_spf.google.com ~all\n</code></pre>\n\n<p>This is working according to my requirement as I follow <a href=\"https://www.kitterman.com/spf/validate.html\" rel=\"nofollow noreferrer\">https://www.kitterman.com/spf/validate.html</a> to validate if I am getting the correct output.</p>\n\n<p>Now, whenever I change my Input Domain to <strong>geckoboard.com</strong> (say), I get the following error:</p>\n\n<pre><code>panic: lookup geckoboard.com on 127.0.0.53:53: read udp 127.0.0.1:38440-&gt;127.0.0.53:53: i/o timeout   \ngoroutine 1 [running]: \nmain.main()     \n          /home/maruthi/emailheader.go:11\n+0x190 exit status 2\n</code></pre>\n\n<p>I get the fact that this is a Timeout Exception. However, when I run the same query on <a href=\"https://www.kitterman.com/spf/validate.html\" rel=\"nofollow noreferrer\">https://www.kitterman.com/spf/validate.html</a>, I get the expected result within a fraction of seconds. </p>\n\n<p>Is there any better way for extracting TXT Records other than using <code>net.LookupTXT(\"google.com\")</code>?  If not, can someone suggest me a good retry mechanism for the same code with a higher timeout value?</p>\n\n<p><strong>Update 1:</strong> Tried the answer provided by @Florian Weimer but still getting a timeout.</p>\n\n<pre><code>$ dig +ignore +bufsize=512 geckoboard.com txt\n; &lt;&lt;&gt;&gt; DiG 9.11.3-1ubuntu1.5-Ubuntu &lt;&lt;&gt;&gt; +ignore +bufsize=512 geckoboard.com txt\n;; global options: +cmd\n;; connection timed out; no servers could be reached\n</code></pre>\n\n<p><strong>Update 2:</strong> As suggested by @ThunderCat, I set the timeout to a much higher value. I added <code>options timeout:30</code> in resolver.conf . Both queries, the <code>dig</code> and my program run for a period over 30 seconds before getting a timeout.</p>\n"}, {"tags": ["object", "go", "struct", "types", "assertion"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551897912, "post_id": 55030125, "comment_id": 96812828, "body": "You mean like <a href=\"https://stackoverflow.com/questions/36091801/avoid-using-type-assertions-in-the-branches-of-a-type-switch\" title=\"avoid using type assertions in the branches of a type switch\">stackoverflow.com/questions/36091801/&hellip;</a>?"}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551897989, "post_id": 55030125, "comment_id": 96812859, "body": "No - I don&#39;t want a switch statement at all - it seems unnecessary."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1551898087, "post_id": 55030125, "comment_id": 96812895, "body": "Sorry, I don&#39;t understand. That&#39;s the point of a &quot;type switch&quot;, it is to conditionally assert over multiple possible types. You can get rid of the switch, or get rid of the individual assertions, but not both."}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551898389, "post_id": 55030125, "comment_id": 96813018, "body": "Hmm...well I want to grab the field <i>and the type</i> at once. It seems insane that I can&#39;t do that. Why can&#39;t I do that?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551898677, "post_id": 55030125, "comment_id": 96813142, "body": "Sorry, I&#39;m still not following. <code>subItem</code> is a reflected value, and you can inspect the type as a <code>reflect.Type</code>, but that isn&#39;t a real type, and can only be used within reflection. Your example here however doesn&#39;t even need type assertions, because you&#39;re doing the same thing regardless of type, you can just put <code>subItem.Interface()</code> in <code>bson.D</code>."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1551898804, "post_id": 55030125, "comment_id": 96813201, "body": "I was about to say that, given the example code, dont type switch at all (<a href=\"https://godoc.org/labix.org/v2/mgo/bson#DocElem\" rel=\"nofollow noreferrer\">godoc.org/labix.org/v2/mgo/bson#DocElem</a>). for general case, a switch seems ok for this particular situation about basic types."}], "answers": [{"comments": [{"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1551899383, "post_id": 55030385, "comment_id": 96813463, "body": "Sorry guys I got myself confused. I&#39;m still not totally used to strictly typed languages. Thanks for the replies."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1551899127, "last_edit_date": 1551899127, "creation_date": 1551898822, "answer_id": 55030385, "question_id": 55030125, "link": "https://stackoverflow.com/questions/55030125/type-assertion-non-parsimonious/55030385#55030385", "title": "Type Assertion Non Parsimonious", "body": "<p>I don't understand your question exactly, but what you're doing can be easily shortened without affecting functionality:</p>\n\n<pre><code>    reflectItem := reflect.ValueOf(dataStruct)\n    subItem := reflectItem.FieldByName(subItemKey)\n    switch subItemVal := subItem.(type) {\n        case string:\n            searchData = bson.D{{\"data.\" + \n              strings.ToLower(subItemKey), subItemVal}}\n        case int64:\n            searchData = bson.D{{\"data.\" + \n              strings.ToLower(subItemKey), subItemVal}}\n    }\n</code></pre>\n\n<p>But beyond that, I don't think a type assertion is necessary in your case <em>at all</em>.  This should also work:</p>\n\n<pre><code>    reflectItem := reflect.ValueOf(dataStruct)\n    subItem := reflectItem.FieldByName(subItemKey)\n    searchData = bson.D{{\"data.\"+strings.ToLower(subItemKey), subItem.Interface())\n</code></pre>\n"}], "owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "closed_date": 1551899663, "accepted_answer_id": 55030385, "answer_count": 1, "score": -3, "last_activity_date": 1551899127, "creation_date": 1551897831, "last_edit_date": 1551898589, "question_id": 55030125, "link": "https://stackoverflow.com/questions/55030125/type-assertion-non-parsimonious", "closed_reason": "Duplicate", "title": "Type Assertion Non Parsimonious", "body": "<p>I have the following, which works:</p>\n\n<pre><code>        reflectItem := reflect.ValueOf(dataStruct)\n        subItem := reflectItem.FieldByName(subItemKey)\n        switch subItem.Interface().(type) {\n            case string:\n                subItemVal := subItem.Interface().(string)\n                searchData = bson.D{{\"data.\" + \n                  strings.ToLower(subItemKey), subItemVal}}\n            case int64:\n                subItemVal := subItem.Interface().(int64)\n                searchData = bson.D{{\"data.\" + \n                  strings.ToLower(subItemKey), subItemVal}}\n        }\n</code></pre>\n\n<p>The issue is that this seems very non-parsimonious. I would very much like to simply get the type of <code>subItem</code> without having a switch statement that simply asserts back its own type after finding the field by name. I'm not sure how to back this out however. Ideas?</p>\n"}, {"tags": ["json", "go", "go-reflect"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1551894869, "post_id": 55029335, "comment_id": 96811425, "body": "<code>encoding&#47;json</code> does not offer this."}, {"owner": {"reputation": 1761, "user_id": 4813600, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/D3xtB.jpg?s=128&g=1", "display_name": "alamin", "link": "https://stackoverflow.com/users/4813600/alamin"}, "edited": false, "score": 0, "creation_date": 1551897738, "post_id": 55029335, "comment_id": 96812750, "body": "there might be another way, if you encode the struct into json again, then compare the two json, you will get difference. you can use <code>https:&#47;&#47;github.com&#47;yudai&#47;gojsondiff</code>"}, {"owner": {"reputation": 2009, "user_id": 518469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d25f5f2f0ff49caee819e3e1805cb436?s=128&d=identicon&r=PG&f=1", "display_name": "yname", "link": "https://stackoverflow.com/users/518469/yname"}, "reply_to_user": {"reputation": 1761, "user_id": 4813600, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/D3xtB.jpg?s=128&g=1", "display_name": "alamin", "link": "https://stackoverflow.com/users/4813600/alamin"}, "edited": false, "score": 1, "creation_date": 1551940574, "post_id": 55029335, "comment_id": 96826402, "body": "@Md.AlaminMahamud right, I also thought about that, but then we will have json like <code>{&quot;one&quot;: &quot;one&quot;, &quot;two&quot;: &quot;two&quot;}</code> and it would be deserialized as struct and then back as <code>{&quot;two&quot;:&quot;two&quot;, &quot;one&quot;: &quot;one&quot;}</code>. There would be diff, but it would be not helpful"}], "answers": [{"tags": [], "owner": {"reputation": 2009, "user_id": 518469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d25f5f2f0ff49caee819e3e1805cb436?s=128&d=identicon&r=PG&f=1", "display_name": "yname", "link": "https://stackoverflow.com/users/518469/yname"}, "is_accepted": false, "score": 0, "last_activity_date": 1552466244, "creation_date": 1552466244, "answer_id": 55137468, "question_id": 55029335, "link": "https://stackoverflow.com/questions/55029335/how-to-list-unknown-fields-after-json-parsing/55137468#55137468", "title": "How to list unknown fields after json parsing", "body": "<p>Not sure if that is the best way but what I did is:</p>\n\n<ol>\n<li><p>If current-level type is map:</p>\n\n<ol>\n<li>Check that all map keys are known.\n\n<ul>\n<li>It could be either if keys are struct field names or map keys.</li>\n<li>If not known - add to list of unknown fields</li>\n</ul></li>\n<li>Repeat recursively for value that corresponds to each key</li>\n</ol></li>\n<li><p>If current level type is array:</p>\n\n<ol>\n<li>Run recursively for each element</li>\n</ol></li>\n</ol>\n\n<p>Code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// ValidateUnknownFields checks that provided json\n// matches provided struct. If that is not the case\n// list of unknown fields is returned.\nfunc ValidateUnknownFields(jsn []byte, strct interface{}) ([]string, error) {\n    var obj interface{}\n    err := json.Unmarshal(jsn, &amp;obj)\n    if err != nil {\n        return nil, fmt.Errorf(\"error while unmarshaling json: %v\", err)\n    }\n    return checkUnknownFields(\"\", obj, reflect.ValueOf(strct)), nil\n}\n\nfunc checkUnknownFields(keyPref string, jsn interface{}, strct reflect.Value) []string {\n    var uf []string\n    switch concreteVal := jsn.(type) {\n    case map[string]interface{}:\n        // Iterate over map and check every value\n        for field, val := range concreteVal {\n            fullKey := fmt.Sprintf(\"%s.%s\", keyPref, field)\n            subStrct := getSubStruct(field, strct)\n            if !subStrct.IsValid() {\n                uf = append(uf, fullKey[1:])\n            } else {\n                subUf := checkUnknownFields(fullKey, val, subStrct)\n                uf = append(uf, subUf...)\n            }\n        }\n    case []interface{}:\n        for i, val := range concreteVal {\n            fullKey := fmt.Sprintf(\"%s[%v]\", keyPref, i)\n            subStrct := strct.Index(i)\n            uf = append(uf, checkUnknownFields(fullKey, val, subStrct)...)\n        }\n    }\n    return uf\n}\n</code></pre>\n\n<p>Full version: <a href=\"https://github.com/yb172/json-unknown/blob/master/validator.go\" rel=\"nofollow noreferrer\">https://github.com/yb172/json-unknown/blob/master/validator.go</a></p>\n"}], "owner": {"reputation": 2009, "user_id": 518469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d25f5f2f0ff49caee819e3e1805cb436?s=128&d=identicon&r=PG&f=1", "display_name": "yname", "link": "https://stackoverflow.com/users/518469/yname"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1552466244, "creation_date": 1551894640, "last_edit_date": 1551894771, "question_id": 55029335, "link": "https://stackoverflow.com/questions/55029335/how-to-list-unknown-fields-after-json-parsing", "title": "How to list unknown fields after json parsing", "body": "<p>Imagine we have following Go structs:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Config struct {\n    Name   string  `json:\"name,omitempty\"`\n    Params []Param `json:\"params,omitempty\"`\n}\n\ntype Param struct {\n    Name  string `json:\"name,omitempty\"`\n    Value string `json:\"value,omitempty\"`\n}\n</code></pre>\n\n<p>and following json:</p>\n\n<pre><code>{\n    \"name\": \"parabolic\",\n    \"subdir\": \"pb\",\n    \"params\": [{\n        \"name\": \"input\",\n        \"value\": \"in.csv\"\n    }, {\n        \"name\": \"output\",\n        \"value\": \"out.csv\",\n        \"tune\": \"fine\"\n    }]\n}\n</code></pre>\n\n<p>and we do unmarshalling:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>cfg := Config{}\nif err := json.Unmarshal([]byte(cfgString), &amp;cfg); err != nil {\n    log.Fatalf(\"Error unmarshalling json: %v\", err)\n}\nfmt.Println(cfg)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/HZgo0jxbQrp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HZgo0jxbQrp</a></p>\n\n<p>Output would be <code>{parabolic [{input in.csv} {output out.csv}]}</code> which makes sense - unknown fields were ignored.</p>\n\n<p>Question: how to find out which fields were ignored? </p>\n\n<p>I.e. <code>getIgnoredFields(cfg, cfgString)</code> would return <code>[\"subdir\", \"params[1].tune\"]</code></p>\n\n<p>(There is a <a href=\"https://godoc.org/encoding/json#Decoder.DisallowUnknownFields\" rel=\"nofollow noreferrer\"><code>DisallowUnknownFields</code></a> option but it's different: this option would result <code>Unmarshal</code> in error while question is how to still parse json without errors and find out which fields were ignored)</p>\n"}, {"tags": ["algorithm", "go", "pattern-matching", "yaml"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1551892026, "post_id": 55028559, "comment_id": 96809721, "body": "Consider running <code>go fmt</code> on your code before posting. Using the same standard formatting as the rest of the community makes it easier for people to read your code and offer help."}, {"owner": {"reputation": 36328, "user_id": 5483526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec50563f80bacd2a7fed69bd31d0c810?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Timmermans", "link": "https://stackoverflow.com/users/5483526/matt-timmermans"}, "edited": false, "score": 2, "creation_date": 1551898396, "post_id": 55028559, "comment_id": 96813019, "body": "Your question seems to be missing important information -- something about a torch, maybe?"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1551903051, "last_edit_date": 1551903051, "creation_date": 1551899301, "answer_id": 55030494, "question_id": 55028559, "link": "https://stackoverflow.com/questions/55028559/bridge-and-torch-problem-for-n-people-with-go/55030494#55030494", "title": "Bridge and Torch Problem for &#39;n&#39; people with Go", "body": "<blockquote>\n  <p>Problem: Given an array of positive distinct integer denoting the\n  crossing time of \u2018n\u2019 people. These \u2018n\u2019 people are standing at one side\n  of bridge. Bridge can hold at max two people at a time. When two\n  people cross the bridge, they must move at the slower person\u2019s pace.\n  Find the minimum total time in which all persons can cross the bridge.</p>\n\n<pre><code>person:\n  person_1: 2\n  person_2: 1\n  person_3: 5\n  person_4: 8\n  person_5: 9\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>Your algorithm looks complicated.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\nfunc minCrossingTime(people []int) int {\n    sort.Slice(people, func(i, j int) bool {\n        return people[i] &gt; people[j]\n    })\n    min := 0\n    for i := 0; i &lt; len(people); i += 2 {\n        min += people[i]\n    }\n    return min\n}\n\nfunc main() {\n    people := []int{2, 1, 5, 8, 9}\n    fmt.Println(len(people), people)\n    crossingTime := minCrossingTime(people)\n    fmt.Println(len(people), people)\n    fmt.Println(crossingTime)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/pXdGcinwxr-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pXdGcinwxr-</a></p>\n\n<p>Output:</p>\n\n<pre><code>5 [2 1 5 8 9]\n5 [9 8 5 2 1]\n15\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 17, "user_id": 10728945, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_nneU7XXVtk/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jcVqwiuj6MGex1LQI4sfBDgOebsQ/mo/photo.jpg?sz=128", "display_name": "Hemant Kumar", "link": "https://stackoverflow.com/users/10728945/hemant-kumar"}, "edited": false, "score": 0, "creation_date": 1551931487, "post_id": 55032514, "comment_id": 96823876, "body": "Thanks a lot mate for your help. Can you please walk me thorugh the logic as it seems it is a graph theory in place. I would certainly appreciate your help on this."}, {"owner": {"reputation": 6415, "user_id": 6792743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dc0a5e4d9ff9645a9deca067ced1d60?s=128&d=identicon&r=PG&f=1", "display_name": "perl", "link": "https://stackoverflow.com/users/6792743/perl"}, "reply_to_user": {"reputation": 17, "user_id": 10728945, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_nneU7XXVtk/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jcVqwiuj6MGex1LQI4sfBDgOebsQ/mo/photo.jpg?sz=128", "display_name": "Hemant Kumar", "link": "https://stackoverflow.com/users/10728945/hemant-kumar"}, "edited": false, "score": 0, "creation_date": 1551950396, "post_id": 55032514, "comment_id": 96831190, "body": "Updated the answer with the description of the logic + added some interesting references in the &quot;extras&quot; part of the answer"}, {"owner": {"reputation": 17, "user_id": 10728945, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_nneU7XXVtk/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jcVqwiuj6MGex1LQI4sfBDgOebsQ/mo/photo.jpg?sz=128", "display_name": "Hemant Kumar", "link": "https://stackoverflow.com/users/10728945/hemant-kumar"}, "edited": false, "score": 1, "creation_date": 1551956969, "post_id": 55032514, "comment_id": 96835452, "body": "Thanks a lot mate. Really appreciate your help on this."}], "tags": [], "owner": {"reputation": 6415, "user_id": 6792743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dc0a5e4d9ff9645a9deca067ced1d60?s=128&d=identicon&r=PG&f=1", "display_name": "perl", "link": "https://stackoverflow.com/users/6792743/perl"}, "is_accepted": true, "score": 1, "last_activity_date": 1551950216, "last_edit_date": 1551950216, "creation_date": 1551908055, "answer_id": 55032514, "question_id": 55028559, "link": "https://stackoverflow.com/questions/55028559/bridge-and-torch-problem-for-n-people-with-go/55032514#55032514", "title": "Bridge and Torch Problem for &#39;n&#39; people with Go", "body": "<p>I think the original problem is a bit more interesting than the one stated (yes, there has to be a Torch in the \"Bridge and Torch\" problem!).</p>\n\n<p>Based on the Wikipedia description, for example,</p>\n\n<blockquote>\n  <p>Four people come to a river in the night. There is a narrow bridge, but it can only hold two people at a time. They have one torch and, because it's night, the torch has to be used when crossing the bridge. Person A can cross the bridge in 1 minute, B in 2 minutes, C in 5 minutes, and D in 8 minutes. When two people cross the bridge together, they must move at the slower person's pace. The question is, can they all get across the bridge if the torch lasts only 15 minutes?</p>\n</blockquote>\n\n<p>In our case, of course, there are N people instead of just four, and it takes them variable amount of time to cross the bridge, but the rest of the story is the same.</p>\n\n<p>Here's the implementation:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"sort\"\n)\n\nfunc minCrossingTime(x []int) int {\n    if len(x) == 1 {\n        return x[0]\n    }\n\n    sort.Ints(x)\n\n    t := 0\n    a, b := x[0], x[1]\n    x = x[2:]\n\n    for len(x) &gt;= 2 {\n        n := len(x)\n        c, d := x[n-2], x[n-1]\n        x = x[:n-2]\n\n        t1 := 2*b + a + d\n        t2 := d + c + 2*a\n        if t1 &lt; t2 {\n            t += t1\n        } else {\n            t += t2\n        }\n    }\n\n    if len(x) == 1 {\n        c := x[0]\n        t += a + b + c\n    } else {\n        t += b\n    }\n    return t\n}\n\nfunc main() {\n    x1 := []int{1, 2, 5, 8}\n    fmt.Printf(\"x = %x, time = %d\\n\", x1, minCrossingTime(x1))\n    x2 := []int{3, 8, 1, 6, 2, 9}\n    fmt.Printf(\"x = %x, time = %d\\n\", x2, minCrossingTime(x2))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>x = [1 2 5 8], time = 15\nx = [1 2 3 6 8 9], time = 27\n</code></pre>\n\n<p>Note: the first example [1 2 5 8] is straight from the Wikipedia, so the answer is yes, they can cross in 15 minutes</p>\n\n<p><strong>Key idea:</strong></p>\n\n<p>Definitions:</p>\n\n<ul>\n<li>Let X = [X1,X2,...,XN] be the sorted array of crossing times with X1 being the fastest and XN the slowest</li>\n<li>Let's denote as {XI,XJ} crossing by the pair of people XI and XJ, and {XK} crossing by one person XK, with +{...} indicating the crossing in the desired direction and -{...} in the opposite direction</li>\n</ul>\n\n<p>Logic:</p>\n\n<ol>\n<li><p>If N &lt; 4 the problem is trivial:</p>\n\n<ul>\n<li>N = 1 => t = X1 (+{X1})</li>\n<li>N = 2 => t = X2 (+{X1,X2})</li>\n<li>N = 3 => t = X1 + X2 + X3 (+{X1,X2} -{X1} + {X1,X3})</li>\n</ul></li>\n<li><p>If N >= 4 consider the following problem: how to make two slowest people (and only them) cross the bridge and have the torch brought back in minimal time. There are two \"good\" ways to do it, with times\n<code>t1 = X1 + 2*X2 + XN</code> (+{X1,X2} -{X1} +{X[N-1],XN} -{X2}) and \n<code>t2 = 2*X1 + X[N-1] + XN</code> (+{X1,X[N-1]} -{X1} +{X1,XN} -{X1}), so we choose the best (minimum) out of these two</p></li>\n<li>Now the two slowest have crossed the bridge, and the torch is on the same side where it started, so we are left with the original problem for X' = [X1, X2, ..., X[N-2]], which can be solved iteratively by applying the same logic and summing up the crossing times</li>\n</ol>\n\n<p><strong>Extras:</strong></p>\n\n<ol>\n<li>For mathematical proof and more context see e.g. <a href=\"https://page.mi.fu-berlin.de/rote/Papers/pdf/Crossing+the+bridge+at+night.pdf\" rel=\"nofollow noreferrer\">https://page.mi.fu-berlin.de/rote/Papers/pdf/Crossing+the+bridge+at+night.pdf</a></li>\n<li>Code golf solutions in different programming languages: <a href=\"https://codegolf.stackexchange.com/questions/75615/the-bridge-and-torch-problem\">https://codegolf.stackexchange.com/questions/75615/the-bridge-and-torch-problem</a></li>\n</ol>\n"}], "owner": {"reputation": 17, "user_id": 10728945, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_nneU7XXVtk/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jcVqwiuj6MGex1LQI4sfBDgOebsQ/mo/photo.jpg?sz=128", "display_name": "Hemant Kumar", "link": "https://stackoverflow.com/users/10728945/hemant-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 736, "favorite_count": 2, "closed_date": 1551940766, "accepted_answer_id": 55032514, "answer_count": 2, "score": -3, "last_activity_date": 1551950216, "creation_date": 1551891958, "last_edit_date": 1551900238, "question_id": 55028559, "link": "https://stackoverflow.com/questions/55028559/bridge-and-torch-problem-for-n-people-with-go", "closed_reason": "Not suitable for this site", "title": "Bridge and Torch Problem for &#39;n&#39; people with Go", "body": "<p>Problem: Given an array of positive distinct integer denoting the crossing time of \u2018n\u2019 people. These \u2018n\u2019 people are standing at one side of bridge. Bridge can hold at max two people at a time. When two people cross the bridge, they must move at the slower person\u2019s pace. Find the minimum total time in which all persons can cross the bridge. </p>\n\n<p>I am not able to find the pattern as of how to scale this for 'n' people. But somehow I managed to find the case with 4 people. Can someone help me with this. I am new to Golang and I am stuck with this problem. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n    \"sort\"\n\n    \"gopkg.in/yaml.v2\"\n)\n\ntype conf struct {\n    Person []map[string]float32 `yaml:\"person\"`\n}\n\nfunc (c *conf) getConf() *conf {\n    filename := os.Args[1]                     // Taking file input\n    yamlFile, err := ioutil.ReadFile(filename) // Yaml parse\n    if err != nil {\n        log.Printf(\"yamlFile.Get err   #%v \", err)\n    }\n    err = yaml.Unmarshal(yamlFile, c)\n    if err != nil {\n        log.Fatalf(\"Unmarshal: %v\", err)\n    }\n    return c\n}\n\nfunc main() {\n    var c conf  // Object of struct conf\n    c.getConf() // calling getConf function\n    // Sorting the current conf map\n    n := map[float32][]string{} // Map to store current conf map\n    var a []float32             // Store values from conf map\n    for k, v := range c.Person {\n        v := float32(v)\n        fmt.Println(k, v)\n        n[v] = append(n[v], k)\n    }\n    for k := range n {\n        a = append(a, k)\n    }\n    // Converting float32 as float64 in order to sort the values in conf map\n    float32AsFloat64Values := make([]float64, len(a))\n    for i, val := range a {\n        float32AsFloat64Values[i] = float64(val)\n    }\n    sort.Float64s(float32AsFloat64Values)\n    for i, val := range float32AsFloat64Values {\n        a[i] = float32(val)\n    }\n    var time float32\n    fmt.Printf(\"\\n%v\\n\", a)\n    for _, k := range a {\n        min1 := a[0]\n        min2 := a[1]\n        min3 := a[2]\n        for _, s := range n[k] {\n            //Debug:\n            fmt.Printf(\"%s, %g\\n\", s, k)\n            if len(a) &gt; 3 {\n                time = (3 * min2) + min1 + a[3] //Formula for minimum time in case of 4 people\n            } else if len(a) == 3 {\n                time = min1 + min2 + min3\n            } else {\n                fmt.Println(\"Enter valid arguments in config.yaml\")\n            }\n        }\n    }\n    fmt.Printf(\"Minimum time taken to cross the bridge is:\\t%g\\n\", time)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/ObTVA8gk0mg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ObTVA8gk0mg</a></p>\n\n<p>Config.yaml is:</p>\n\n<pre><code>person:\n  person_1: 2\n  person_2: 1\n  person_3: 5\n  person_4: 8\n  person_5: 9\n</code></pre>\n\n<p>One could run this as: 'go run main.go config.yaml'.\nMy scenario is that there could be 4,5 or 'n' number of people given in this yaml. Then what would be the minimum time for them to cross the bridge given the constraints.</p>\n"}, {"tags": ["go", "replace", "slice", "replaceall"], "answers": [{"comments": [{"owner": {"reputation": 371, "user_id": 9636618, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-uDHdTyf4h8U/AAAAAAAAAAI/AAAAAAAAMWc/JkSCEVBJp6w/photo.jpg?sz=128", "display_name": "Sepehr", "link": "https://stackoverflow.com/users/9636618/sepehr"}, "edited": false, "score": 0, "creation_date": 1596448041, "post_id": 55026692, "comment_id": 111804365, "body": "Thanks a lot :)) save my time :)) I updated go version on ubuntu using this solution <a href=\"https://askubuntu.com/a/755392/1047440\">askubuntu.com/a/755392/1047440</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 8, "last_activity_date": 1551886206, "creation_date": 1551886206, "answer_id": 55026692, "question_id": 55026604, "link": "https://stackoverflow.com/questions/55026604/reference-to-undefined-identifier-bytes-replaceall/55026692#55026692", "title": "Reference to undefined identifier bytes.ReplaceAll", "body": "<p>The <a href=\"https://golang.org/pkg/bytes/\" rel=\"noreferrer\"><code>bytes</code></a> package is part of the standard library, so it is unlikely that you don't have it if you have the <code>go</code> tool available to you.</p>\n\n<p>But do note that <a href=\"https://golang.org/pkg/bytes/#ReplaceAll\" rel=\"noreferrer\"><code>bytes.ReplaceAll()</code></a> was added in <a href=\"https://golang.org/doc/go1.12#bytes\" rel=\"noreferrer\">Go 1.12</a>, so if you have an older Go SDK, this function will not be available to you.</p>\n\n<p>Execute <code>go version</code> to find out. Get the latest Go from the official site: <a href=\"https://golang.org/dl/\" rel=\"noreferrer\">https://golang.org/dl/</a></p>\n"}, {"tags": [], "owner": {"reputation": 2598, "user_id": 1084004, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/BrE6N.jpg?s=128&g=1", "display_name": "mikeapr4", "link": "https://stackoverflow.com/users/1084004/mikeapr4"}, "is_accepted": false, "score": 0, "last_activity_date": 1560875002, "creation_date": 1560875002, "answer_id": 56653372, "question_id": 55026604, "link": "https://stackoverflow.com/questions/55026604/reference-to-undefined-identifier-bytes-replaceall/56653372#56653372", "title": "Reference to undefined identifier bytes.ReplaceAll", "body": "<p>Further to icza's <a href=\"https://stackoverflow.com/a/55026692/1084004\">answer</a>,</p>\n\n<p>For the benefit of Go versions prior to <code>1.12</code>, the following are equivalent:</p>\n\n<pre><code>bytes.ReplaceAll(a, b, c)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>bytes.Replace(a, b, c, -1)\n</code></pre>\n\n<p>See the implementation of <a href=\"https://golang.org/src/bytes/bytes.go?s=21812:21854#L791\" rel=\"nofollow noreferrer\"><code>ReplaceAll</code></a></p>\n"}], "owner": {"reputation": 114, "user_id": 5866079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/409d93b812136096b5596d95ea8cb327?s=128&d=identicon&r=PG&f=1", "display_name": "Minory", "link": "https://stackoverflow.com/users/5866079/minory"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1228, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1560875002, "creation_date": 1551885951, "last_edit_date": 1551887837, "question_id": 55026604, "link": "https://stackoverflow.com/questions/55026604/reference-to-undefined-identifier-bytes-replaceall", "title": "Reference to undefined identifier bytes.ReplaceAll", "body": "<p>I am trying to build a simple webserver. I want to replace all <code>\\n</code> with <code>&lt;br&gt;</code>.\nI wanted to use <code>bytes</code> for this, because my page body is stored as an <code>[]byte</code>.</p>\n\n<p>I use <code>bytes.ReplaceAll()</code> for this. But it keeps saying that it's a reference to undefined identifier.</p>\n\n<p>Can someone tell me why? I tried the exact same line within an online Compiler and it worked just fine. Do I miss the library?</p>\n\n<p>See my code below:</p>\n\n<pre><code>import (\n    \"bytes\"\n    \"html/template\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"regexp\"\n)\n\ntype Page struct {\n    Title string\n    Body  []byte\n}\n\nfunc editHandler(w http.ResponseWriter, r *http.Request, title string) {\n    p, err := loadPage(title)\n    if err != nil {\n        p = &amp;Page{Title: title}\n    }\n    // THE LINE THAT CAUSES TROUBLE\n    p.Body = bytes.ReplaceAll(p.Body, []byte(\"\\n\"), []byte(\"&lt;br&gt;\"))\n\n    renderTemplate(w, \"edit\", p)\n}\n</code></pre>\n"}, {"tags": ["performance", "http", "go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1551899568, "post_id": 55026118, "comment_id": 96813559, "body": "usually related to the system configuration (see ulimit and options like that). best to put a rate limiter on your app, anyways."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551904131, "post_id": 55026118, "comment_id": 96815909, "body": "See <a href=\"https://stackoverflow.com/questions/31174076/go-http-server-testing-ab-vs-wrk-so-much-difference-in-result#answer-31174285\" title=\"go http server testing ab vs wrk so much difference in result%23answer 31174285\">stackoverflow.com/questions/31174076/&hellip;</a>"}, {"owner": {"reputation": 75, "user_id": 11137649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dea0abed933ea2a245eaf6c47bffd4dc?s=128&d=identicon&r=PG&f=1", "display_name": "antonof", "link": "https://stackoverflow.com/users/11137649/antonof"}, "edited": false, "score": 0, "creation_date": 1551906629, "post_id": 55026118, "comment_id": 96816954, "body": "Hi   Thanks for your reply but unfortunately it is not helping me. I am totally new on golang so I have no idea what do you mean with a rate limiter. Rate limiter of what? sockets open when the http.get connection? Amount of concurrent connections?  By the way, I have a similar program written in Java and it works perfectly without any rate setting (but is far slower than my go program)."}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 11137649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dea0abed933ea2a245eaf6c47bffd4dc?s=128&d=identicon&r=PG&f=1", "display_name": "antonof", "link": "https://stackoverflow.com/users/11137649/antonof"}, "edited": false, "score": 0, "creation_date": 1551944048, "post_id": 55032943, "comment_id": 96827833, "body": "Hi Patrick  Yes, I am using macOS but the one that hangs is my go program, not ab tool."}], "tags": [], "owner": {"reputation": 31, "user_id": 9105629, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-56tR8LKT45A/AAAAAAAAAAI/AAAAAAAAAA0/Rr10yiHLES4/photo.jpg?sz=128", "display_name": "Patrick Vollebregt", "link": "https://stackoverflow.com/users/9105629/patrick-vollebregt"}, "is_accepted": false, "score": 1, "last_activity_date": 1551911909, "last_edit_date": 1551911909, "creation_date": 1551910083, "answer_id": 55032943, "question_id": 55026118, "link": "https://stackoverflow.com/questions/55026118/simple-golang-http-rest-service-hangs-under-load/55032943#55032943", "title": "Simple golang http rest service hangs under load", "body": "<p>Do you happen to use OSX? I understand that ab is broken on OSX. </p>\n\n<p>Another thing you could try is to use -k to use the keep alive flag, but that may not be something that you want. </p>\n\n<p>50000 is also close to the maximum number of sockets on an interface, so maybe your sockets are exhausted. Sockets are not directly reusable, because they will be in TIME_WAIT state for a minute or two. Exact value can vary per OS and configuration. </p>\n\n<p>However, the code looks fine too me.</p>\n\n<p>The following code worked fine for me: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/gorilla/mux\"\n    \"log\"\n    \"net/http\"\n)\n\n\nfunc Echo(w http.ResponseWriter, r *http.Request) {\n    v := mux.Vars(r)\n\n    fmt.Fprintf(w, \"Echo %v\", v[\"message\"])\n}\n\n\nfunc main() {\n\n    router := mux.NewRouter() //.StrictSlash(true)\n    router.HandleFunc(\"/echo/{message}\", Echo).Methods(\"GET\")\n\n    log.Println(\"Running server....\")\n\n    log.Fatal(http.ListenAndServe(\"localhost:8080\", router))\n}\n</code></pre>\n\n<p>And gives the following results:</p>\n\n<pre><code>ab -c 500 -n 50000 localhost:8080/echo/foobar\nThis is ApacheBench, Version 2.3 &lt;$Revision: 1807734 $&gt;\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking localhost (be patient)\nCompleted 5000 requests\nCompleted 10000 requests\nCompleted 15000 requests\nCompleted 20000 requests\nCompleted 25000 requests\nCompleted 30000 requests\nCompleted 35000 requests\nCompleted 40000 requests\nCompleted 45000 requests\nCompleted 50000 requests\nFinished 50000 requests\n\n\nServer Software:        \nServer Hostname:        localhost\nServer Port:            8080\n\nDocument Path:          /echo/foobar\nDocument Length:        12 bytes\n\nConcurrency Level:      500\nTime taken for tests:   2.471 seconds\nComplete requests:      50000\nFailed requests:        0\nTotal transferred:      6450000 bytes\nHTML transferred:       600000 bytes\nRequests per second:    20233.39 [#/sec] (mean)\nTime per request:       24.712 [ms] (mean)\nTime per request:       0.049 [ms] (mean, across all concurrent requests)\nTransfer rate:          2548.93 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0   18 122.8      3    1034\nProcessing:     0    5  14.9      4     225\nWaiting:        0    4  14.7      3     222\nTotal:          1   24 132.7      6    1245\n\nPercentage of the requests served within a certain time (ms)\n  50%      6\n  66%      7\n  75%      7\n  80%      7\n  90%     12\n  95%     20\n  98%     30\n  99%   1040\n 100%   1245 (longest request)\n</code></pre>\n\n<p>This is executed on Ubuntu 18.04.</p>\n"}], "owner": {"reputation": 75, "user_id": 11137649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dea0abed933ea2a245eaf6c47bffd4dc?s=128&d=identicon&r=PG&f=1", "display_name": "antonof", "link": "https://stackoverflow.com/users/11137649/antonof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 584, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1552119332, "creation_date": 1551884459, "last_edit_date": 1552119332, "question_id": 55026118, "link": "https://stackoverflow.com/questions/55026118/simple-golang-http-rest-service-hangs-under-load", "title": "Simple golang http rest service hangs under load", "body": "<p>I am trying to test how golang can handle big loads to compare it with our current applications made with Java.</p>\n\n<p>What I did is a simple echo rest service like that (I am adding just the important parts of my code):</p>\n\n<pre><code>// Return default message for root routing\nfunc Index(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello, %q\", html.EscapeString(r.URL.Path))\n}\n\n// Main function\nfunc main() {\n\n    router := mux.NewRouter() //.StrictSlash(true)\n    router.HandleFunc(\"/\", Index).Methods(\"GET\")\n    router.HandleFunc(\"/echo/{message}\", echoHandler(calledServiceURL)).Methods(\"GET\")\n\n    log.Println(\"Running server....\")\n\n    log.Fatal(http.ListenAndServe(port, router))\n}\n</code></pre>\n\n<p>I did a test by using ab tool and it worked well with -c 500 -n 500 but when I tried to test with a big load like this </p>\n\n<pre><code>ab -c 500 -n 50000 http://localhost:9596/echo/javier\n</code></pre>\n\n<p>The process works well for a couple of seconds but then seems it close the tcp connection as I receive the following error:</p>\n\n<pre><code>Benchmarking localhost (be patient)\napr_socket_recv: Connection reset by peer (54)\nTotal of 501 requests completed\n</code></pre>\n\n<p>Is is due to a OS limitations that my test reached or is it the limit that my golang app could handle?</p>\n\n<p>Is there a better way to process requests and then avoid the program to close connections? (queue requests or something like that).</p>\n\n<p>Thanks in advance\nJ</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1551884403, "creation_date": 1551884403, "answer_id": 55026100, "question_id": 55025938, "link": "https://stackoverflow.com/questions/55025938/go-pass-dynamic-parameter-to-a-function/55026100#55026100", "title": "Go pass dynamic parameter to a function", "body": "<p>One option is to move the common part to another function, e.g. <code>get()</code>, and change <code>getA()</code> and <code>getB()</code> to call this <code>get()</code>:</p>\n\n<pre><code>func getB(m *m.TSR, bl string) string {\n    runParams, exist := m.BuildParams.Before[bl]\n    return get(runParams, exist)\n}\n\nfunc getB(m *m.TSR, bl string) string {\n    runParams, exist := m.BuildParams.After[bl]\n    return get(runParams, exist)\n}\n\nfunc get(runParams interface{}, exists bool) string {\n    if exist {\n        runParamsMap, ok := runParams.(map[interface{}]interface{})\n        if ok {\n            run, ok := runParamsMap[\"builder\"]\n            if ok {\n                return run.(string)\n            }\n        }\n    }\n    return \"\"\n}\n</code></pre>\n\n<p>If <code>m.BuildParams.Before</code> and <code>m.BuildParams.After</code> are of the same type (be it <code>commonType</code>), you can do better:</p>\n\n<pre><code>func getA(m *m.TSR, bl string) string {\n    return get(m.BuildParams.Before, bl)\n}\n\nfunc getB(m *m.TSR, bl string) string {\n    return get(m.BuildParams.After, bl)\n}\n</code></pre>\n\n<p>And only the first line changes in <code>get()</code>:</p>\n\n<pre><code>func get(common commonType, bl string) string {\n    runParams, exist := common[bl]\n    // rest is same\n}\n</code></pre>\n"}], "owner": {"reputation": 351, "user_id": 10816571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45aa02b808aa538cdaa37ed33a8557e9?s=128&d=identicon&r=PG&f=1", "display_name": "Rayn D", "link": "https://stackoverflow.com/users/10816571/rayn-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 290, "favorite_count": 1, "accepted_answer_id": 55026100, "answer_count": 1, "score": 1, "last_activity_date": 1551884403, "creation_date": 1551883986, "question_id": 55025938, "link": "https://stackoverflow.com/questions/55025938/go-pass-dynamic-parameter-to-a-function", "title": "Go pass dynamic parameter to a function", "body": "<p>I\u2019ve a function which should do something like this</p>\n\n<pre><code>\nfunc getA(m *m.TSR, bl string) string {\n    runParams, exist := m.BuildParams.Before[bl]\n    if exist {\n        runParamsMap, ok := runParams.(map[interface{}]interface{})\n        if ok {\n            run, ok := runParamsMap[\"builder\"]\n            if ok {\n                return run.(string)\n            }\n        }\n    }\n    return \"\"\n}\n\n\nfunc getB(m *m.TSR, bl string) string {\n    runParams, exist := m.BuildParams.After[bl]\n    if exist {\n        runParamsMap, ok := runParams.(map[interface{}]interface{})\n        if ok {\n            run, ok := runParamsMap[\"builder\"]\n            if ok {\n                return run.(string)\n            }\n        }\n    }\n    return \"\"\n}\n\n</code></pre>\n\n<p>Both function are <strong>working as expected</strong> , but I wonder if there is a way to use just only <strong>one function</strong> that handle the same ?\nThe only difference is the Before &amp; After</p>\n\n<pre><code>m.BuildParams.Before[bl]\n\nm.BuildParams.After[bl]\n</code></pre>\n\n<p>All the reset is exactly the same, any idea how to combine them <strong>without</strong> removing the those line outside the function \u2026.</p>\n\n<p>maybe with additional parameter ....</p>\n"}, {"tags": ["firebase", "go", "firebase-admin"], "comments": [{"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 0, "creation_date": 1551882440, "post_id": 55025369, "comment_id": 96803637, "body": "Does <i>node</i> refer to <code>item</code> instance here?"}, {"owner": {"reputation": 5314, "user_id": 5190886, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YLo4CPWOOeA/AAAAAAAAAAI/AAAAAAAAAAA/NEX8mDWN_F0/photo.jpg?sz=128", "display_name": "Hiranya Jayathilaka", "link": "https://stackoverflow.com/users/5190886/hiranya-jayathilaka"}, "edited": false, "score": 0, "creation_date": 1551919051, "post_id": 55025369, "comment_id": 96821108, "body": "Perhaps unmarshal the reference to a map and see if the map comes out empty?"}, {"owner": {"reputation": 11, "user_id": 1182910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4431b595c575458e4437872df4d0e16?s=128&d=identicon&r=PG", "display_name": "rumori", "link": "https://stackoverflow.com/users/1182910/rumori"}, "reply_to_user": {"reputation": 5314, "user_id": 5190886, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YLo4CPWOOeA/AAAAAAAAAAI/AAAAAAAAAAA/NEX8mDWN_F0/photo.jpg?sz=128", "display_name": "Hiranya Jayathilaka", "link": "https://stackoverflow.com/users/5190886/hiranya-jayathilaka"}, "edited": false, "score": 0, "creation_date": 1551975038, "post_id": 55025369, "comment_id": 96846591, "body": "@HiranyaJayathilaka thanks for the reply. In the current workaround I&#39;m checking the <code>title</code> property of <code>item</code> to see if it contains a valid string, but there should be an easier way to do this. I&#39;m quite shocked that the official documentation doesn&#39;t give any hint, it seems such a common thing to do."}, {"owner": {"reputation": 5314, "user_id": 5190886, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YLo4CPWOOeA/AAAAAAAAAAI/AAAAAAAAAAA/NEX8mDWN_F0/photo.jpg?sz=128", "display_name": "Hiranya Jayathilaka", "link": "https://stackoverflow.com/users/5190886/hiranya-jayathilaka"}, "edited": false, "score": 0, "creation_date": 1551996419, "post_id": 55025369, "comment_id": 96856797, "body": "RTDB returns <code>null</code> when queried on a non-existing path. And Go will silently unmarshal <code>null</code> to any variable you specify. I think for most applications, unmarshaling to a <code>map</code> or an <code>interface{}</code> followed by a nil check is good enough to detect non-existence. If you need something more advanced, perhaps look into implementing a custom unmarshaller (I&#39;ll add an example shortly)."}], "answers": [{"tags": [], "owner": {"reputation": 5314, "user_id": 5190886, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YLo4CPWOOeA/AAAAAAAAAAI/AAAAAAAAAAA/NEX8mDWN_F0/photo.jpg?sz=128", "display_name": "Hiranya Jayathilaka", "link": "https://stackoverflow.com/users/5190886/hiranya-jayathilaka"}, "is_accepted": false, "score": 0, "last_activity_date": 1551997181, "creation_date": 1551997181, "answer_id": 55053716, "question_id": 55025369, "link": "https://stackoverflow.com/questions/55025369/how-to-detect-an-empty-result-with-go-firebase-admin-sdk-when-data-at-the-path-d/55053716#55053716", "title": "How to detect an empty result with Go Firebase-Admin SDK when data at the path doesn&#39;t exists", "body": "<p>Here's one way to solve this problem:</p>\n\n<pre><code>type NullableItem struct {\n    Item struct {\n        Title string `json:\"title\"`\n    }\n    IsNull bool\n}\n\nfunc (i *NullableItem) UnmarshalJSON(b []byte) error {\n    if string(b) == \"null\" {\n        i.IsNull = true\n        return nil\n    }\n\n    return json.Unmarshal(b, &amp;i.Item)\n}\n\nfunc TestGetNonExisting(t *testing.T) {\n    var i NullableItem\n    r := client.NewRef(\"items/non_existing\")\n    if err := r.Get(context.Background(), &amp;i); err != nil {\n        t.Fatal(err)\n    }\n    if !i.IsNull {\n        t.Errorf(\"Get() = %v; want IsNull = true\", i)\n    }\n}\n</code></pre>\n\n<p>As a best practice you should also implement <code>MarshalJSON()</code> function.</p>\n"}], "owner": {"reputation": 11, "user_id": 1182910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4431b595c575458e4437872df4d0e16?s=128&d=identicon&r=PG", "display_name": "rumori", "link": "https://stackoverflow.com/users/1182910/rumori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1551997181, "creation_date": 1551882276, "last_edit_date": 1551889719, "question_id": 55025369, "link": "https://stackoverflow.com/questions/55025369/how-to-detect-an-empty-result-with-go-firebase-admin-sdk-when-data-at-the-path-d", "title": "How to detect an empty result with Go Firebase-Admin SDK when data at the path doesn&#39;t exists", "body": "<p>I'm using the following code to get an object from a Firebase realtime database.</p>\n\n<pre><code>type Item struct {\n    title string `json:\"title\"`\n}\nvar item Item\nif err := db.NewRef(\"/items/itemid\").Get(ctx, &amp;item); err != nil {\n    log.Infof(ctx, \"An error occured %v\", err.Error())\n}\nlog.Infof(ctx, \"Item %v\", item)\n</code></pre>\n\n<p>If no data exists at the given path in the realtime database the SDK will not return an error, instead I will end up with an empty struct in the variable <code>item</code>.</p>\n\n<p>What would be the cleanest/most readable way to detect that the data at the path is not there?</p>\n\n<p>I've searched for hours but couldn't find a clear cut answer to this question.</p>\n"}, {"tags": ["go", "base64", "certificate", "tls1.2", "p12"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1551879575, "post_id": 55023564, "comment_id": 96801884, "body": "have you verified the file is indeed a PKCS#12 container, and not, say, its base64 encoding or whatever? You may start with, say, <code>openssl pkcs12 -in yourfile.p12 -noout -info</code>"}], "answers": [{"tags": [], "owner": {"reputation": 2790, "user_id": 12679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0906e409c3cef317eba42c3687d6e871?s=128&d=identicon&r=PG", "display_name": "Daniel Fisher  lennybacon", "link": "https://stackoverflow.com/users/12679/daniel-fisher-lennybacon"}, "is_accepted": false, "score": 1, "last_activity_date": 1557695456, "creation_date": 1557695456, "answer_id": 56103535, "question_id": 55023564, "link": "https://stackoverflow.com/questions/55023564/how-to-convert-a-base64-encoded-p12-to-tls-certificate/56103535#56103535", "title": "How to convert a base64 encoded p12 to tls.Certificate", "body": "<p>PKCS#12 (also knows as PFX) is encoded in ASN.1 (abstract syntax notation) and uses DER (distinguished encoding rules). ASN.1 is written as TLV (type, length and value). The value can be defined or as in your case indefinite, which just means that the length is not explicitly specified. A lot of encoders and decoders do NOT support indefinite lengths. For instance before Windows 10 indefinite lengths wasn't supported by the Microsoft crypto APIs.</p>\n\n<p>What's to do? There are a few options:\n- Convert the PFX (maybe using openSSL) to get a PKCS#12 with defined lengths\n- Try another library to read the PKCS#12 that supports indefinite lengths.</p>\n"}], "owner": {"reputation": 705, "user_id": 637794, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/b7cb728a98ea17d32a6b12d2affebd13?s=128&d=identicon&r=PG", "display_name": "Sammy", "link": "https://stackoverflow.com/users/637794/sammy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2388, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557695456, "creation_date": 1551876661, "question_id": 55023564, "link": "https://stackoverflow.com/questions/55023564/how-to-convert-a-base64-encoded-p12-to-tls-certificate", "title": "How to convert a base64 encoded p12 to tls.Certificate", "body": "<p>I have a generated base64 .p12 file to authenticate to a service and my resty client expects to receive a tls.Certificate.</p>\n\n<p>However, pkcs12.Decode always fail with \": asn1: syntax error: indefinite length found (not DER)\"</p>\n\n<p>Does it mean that I need to convert my base64 encoded .p12 file into a der formatted file? Or what else am I supposed to do to send the certificate to the server?</p>\n\n<pre><code>data, _ := ioutil.ReadFile(\"/PathTo/certificate.p12\")\n\nprivateKey, certificate, _ := pkcs12.Decode(data, \"abc123\")//password=abc123\n\ntlsCertificate := tls.Certificate{\n    Certificate: [][]byte{cert.Raw},\n    PrivateKey:  privateKey,\n    Leaf:        cert,\n}\n//...\nresty.SetCertificates(tlsCertificate)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 472524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7888788f685177f569692a45ed049ca?s=128&d=identicon&r=PG", "display_name": "PaulB", "link": "https://stackoverflow.com/users/472524/paulb"}, "is_accepted": false, "score": -1, "last_activity_date": 1581429129, "creation_date": 1581429129, "answer_id": 60170429, "question_id": 55023485, "link": "https://stackoverflow.com/questions/55023485/go-build-buildmode-c-shared-compiled-dll-how-to-hide-the-exported-goruntime/60170429#60170429", "title": "&quot;go build -buildmode=c-shared&quot; compiled dll, how to hide the exported goruntime function?", "body": "<p><a href=\"https://github.com/golang/go/issues/30674\" rel=\"nofollow noreferrer\" title=\"cmd/link: -buildmode=c-shared exports many functions, not just //export functions\">An issue</a> has now been raised on this exact problem.</p>\n"}], "owner": {"reputation": 33, "user_id": 4858506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vxjozRQpiZw/AAAAAAAAAAI/AAAAAAAAIbE/JFqvHJXix5w/photo.jpg?sz=128", "display_name": "JunLe Meng", "link": "https://stackoverflow.com/users/4858506/junle-meng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1142, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1581429129, "creation_date": 1551876406, "question_id": 55023485, "link": "https://stackoverflow.com/questions/55023485/go-build-buildmode-c-shared-compiled-dll-how-to-hide-the-exported-goruntime", "title": "&quot;go build -buildmode=c-shared&quot; compiled dll, how to hide the exported goruntime function?", "body": "<p>Use dumpbin view export functions, I found a lot of goruntime functions export, hoping to hide them.</p>\n\n<p>example:</p>\n\n<pre><code>\n// file hello.go\npackage main\n\n// //Needed for build\nimport \"C\"\n\nimport (\n    \"fmt\"\n)\n\n//export SayHello\nfunc SayHello(name string) {\n    fmt.Printf(\"func in Golang SayHello says: Hello, %s!\\n\", name)\n}\n\n//export SayHelloByte\nfunc SayHelloByte(name []byte) {\n    fmt.Printf(\"func in Golang SayHelloByte says: Hello, %s!\\n\", string(name))\n}\n\n//export SayBye\nfunc SayBye() {\n    fmt.Println(\"func in Golang SayBye says: Bye!\")\n}\n\nfunc main() {\n    // We need the main function to make possible\n    // CGO compiler to compile the package as C shared library\n}\n</code></pre>\n\n<pre><code>&gt;go build -buildmode=c-shared -o libhello.dll hello.go\n&gt;dumpbin -exports libhello.dll\nMicrosoft (R) COFF/PE Dumper Version 14.00.24215.1\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\n\nDump of file libhello.dll\n\nFile Type: DLL\n\n  Section contains the following exports for libhello.dll\n\n    00000000 characteristics\n    5C7FB64A time date stamp Wed Mar  6 20:00:10 2019\n        0.00 version\n           1 ordinal base\n        3320 number of functions\n        3320 number of names\n\n    ordinal hint RVA      name\n\n          1    0 00092F50 SayBye\n          2    1 00092EA0 SayHello\n          3    2 00092EF0 SayHelloByte\n          4    3 00093240 _cgo_get_context_function\n          5    4 000A1A68 _cgo_init\n          6    5 000930E0 _cgo_is_runtime_initialized\n          7    6 00093020 _cgo_maybe_run_preinit\n          8    7 000A1A70 _cgo_notify_runtime_init_done\n          9    8 00058970 _cgo_panic\n         10    9 00092FC0 _cgo_preinit_init\n         11    A 00092F90 _cgo_release_context\n         12    B 000A1A78 _cgo_sys_thread_create\n         13    C 00093330 _cgo_sys_thread_start\n         14    D 000A1A80 _cgo_thread_start\n         15    E 00052090 _cgo_topofstack\n         16    F 00093110 _cgo_wait_runtime_init_done\n         17   10 0016E070 _cgo_yield\n         18   11 00092D20 _cgoexp_fd8bec644a00_SayBye\n         19   12 00092AA0 _cgoexp_fd8bec644a00_SayHello\n         20   13 00092BD0 _cgoexp_fd8bec644a00_SayHelloByte\n         21   14 000538A0 _rt0_amd64_windows_lib\n         22   15 000A1A40 _rt0_amd64_windows_lib.ptr\n         23   16 00053900 _rt0_amd64_windows_lib_go\n         24   17 000589C0 crosscall2\n         25   18 00093380 crosscall_amd64\n         26   19 0005B450 errors.(*errorString).Error\n         27   1A 0005B3C0 errors.New\n         28   1B 0008A230 fmt.(*buffer).WriteRune\n         29   1C 000884A0 fmt.(*fmt).fmtBoolean\n         30   1D 00089030 fmt.(*fmt).fmtBs\n         31   1E 00089870 fmt.(*fmt).fmtC\n         32   1F 00089A40 fmt.(*fmt).fmtFloat\n         33   20 000888B0 fmt.(*fmt).fmtInteger\n         34   21 00089660 fmt.(*fmt).fmtQ\n         35   22 00089930 fmt.(*fmt).fmtQc\n         36   23 00088FB0 fmt.(*fmt).fmtS\n         37   24 000890C0 fmt.(*fmt).fmtSbx\n         38   25 00088530 fmt.(*fmt).fmtUnicode\n         39   26 00087DF0 fmt.(*fmt).pad\n         40   27 00088150 fmt.(*fmt).padString\n         41   28 00088E70 fmt.(*fmt).truncate\n         42   29 00088D80 fmt.(*fmt).truncateString\n         43   2A 00087C60 fmt.(*fmt).writePadding\n         44   2B 0008A620 fmt.(*pp).Flag\n         45   2C 0008A600 fmt.(*pp).Precision\n         46   2D 0008A5E0 fmt.(*pp).Width\n         47   2E 0008A6B0 fmt.(*pp).Write\n         48   2F 00091000 fmt.(*pp).argNumber\n         49   30 00091120 fmt.(*pp).badArgNum\n         50   31 0008AEF0 fmt.(*pp).badVerb\n         51   32 0008CDB0 fmt.(*pp).catchPanic\n         52   33 00091440 fmt.(*pp).doPrintf\n         53   34 000925A0 fmt.(*pp).doPrintln\n\n...\n\n</code></pre>\n\n<p>I want to export only the SayHello, SayHelloByte, SayBye functions instead of exporting the goruntime function.</p>\n\n<p>What should I do? I searched for a few hours and didn't find a way to get golang.</p>\n\n<p>thank you very much.</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1551875384, "post_id": 55023060, "comment_id": 96799485, "body": "What have you tried? Include your code. What problems did you encounter?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 3, "creation_date": 1551878164, "post_id": 55023060, "comment_id": 96801039, "body": "&quot;seconds of day (1 - 86400).&quot; During the transition to and from daylight saving time there are more or less than 86,400 seconds in a day."}], "answers": [{"comments": [{"owner": {"reputation": 665, "user_id": 533237, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2c53d96de85a46700cefb0f6da8a2275?s=128&d=identicon&r=PG&f=1", "display_name": "yodhevauhe", "link": "https://stackoverflow.com/users/533237/yodhevauhe"}, "edited": false, "score": 0, "creation_date": 1551878532, "post_id": 55024090, "comment_id": 96801271, "body": "I was thinking of more complex way time.Now().Unix() - yesterdayMidNight.Unix()"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1551879091, "post_id": 55024090, "comment_id": 96801609, "body": "This doesn&#39;t work on days when daylight saving happens. Also, <code>Time.Truncate()</code> operates on time as an absolute duration since the zero time, so it may also return incorrect result."}, {"owner": {"reputation": 6415, "user_id": 6792743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dc0a5e4d9ff9645a9deca067ced1d60?s=128&d=identicon&r=PG&f=1", "display_name": "perl", "link": "https://stackoverflow.com/users/6792743/perl"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1551879566, "post_id": 55024090, "comment_id": 96801875, "body": "@icza: interesting point, can you share some examples when it fails?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1551879610, "post_id": 55024090, "comment_id": 96801906, "body": "Read the doc of <a href=\"https://golang.org/pkg/time/#Time.Truncate\" rel=\"nofollow noreferrer\"><code>Time.Truncate()</code></a>. Here&#39;s an example: <a href=\"https://play.golang.org/p/hAfBrYWNeZ\" rel=\"nofollow noreferrer\">play.golang.org/p/hAfBrYWNeZ</a>"}, {"owner": {"reputation": 6415, "user_id": 6792743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dc0a5e4d9ff9645a9deca067ced1d60?s=128&d=identicon&r=PG&f=1", "display_name": "perl", "link": "https://stackoverflow.com/users/6792743/perl"}, "edited": false, "score": 0, "creation_date": 1551880418, "post_id": 55024090, "comment_id": 96802406, "body": "Thanks, that&#39;s interesting, I removed that option from my answer"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1551880470, "post_id": 55024090, "comment_id": 96802447, "body": "The one option you have still gives invalid results on days when daylight saving time happens."}, {"owner": {"reputation": 6415, "user_id": 6792743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dc0a5e4d9ff9645a9deca067ced1d60?s=128&d=identicon&r=PG&f=1", "display_name": "perl", "link": "https://stackoverflow.com/users/6792743/perl"}, "reply_to_user": {"reputation": 665, "user_id": 533237, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2c53d96de85a46700cefb0f6da8a2275?s=128&d=identicon&r=PG&f=1", "display_name": "yodhevauhe", "link": "https://stackoverflow.com/users/533237/yodhevauhe"}, "edited": false, "score": 0, "creation_date": 1551881945, "post_id": 55024090, "comment_id": 96803331, "body": "I suppose it depends on the definition. @yodhevauhe asked for a function that returns (1 - 86400), so that seems to be just (60*60*h + 60*m + s) [technically, +1 also, but I&#39;ll skip that]. Your function is correct if we need &quot;seconds since midnight&quot;, but that&#39;s not necessarily within the (1 - 86400) range, e.g. in your example with Central European time t := time.Date(2018, 10, 28, 23, 59, 59, 0, loc) would return 89999"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1551882454, "post_id": 55024090, "comment_id": 96803643, "body": "@perl Exactly my point. If the clock is turned back, on that day there is more than 86400 seconds. So reporting more is the correct answer."}, {"owner": {"reputation": 6415, "user_id": 6792743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dc0a5e4d9ff9645a9deca067ced1d60?s=128&d=identicon&r=PG&f=1", "display_name": "perl", "link": "https://stackoverflow.com/users/6792743/perl"}, "edited": false, "score": 0, "creation_date": 1551882534, "post_id": 55024090, "comment_id": 96803690, "body": "Yes, if you define it as &quot;seconds since midnight&quot;, while the question was &quot;How to get seconds of day (1 - 86400) in Go?&quot;"}, {"owner": {"reputation": 6415, "user_id": 6792743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dc0a5e4d9ff9645a9deca067ced1d60?s=128&d=identicon&r=PG&f=1", "display_name": "perl", "link": "https://stackoverflow.com/users/6792743/perl"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1551883145, "post_id": 55024090, "comment_id": 96804103, "body": "@icza: I have added a comment to my answer to clarify the point, and referred to your answer for the &quot;seconds since midnight&quot; version"}], "tags": [], "owner": {"reputation": 6415, "user_id": 6792743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dc0a5e4d9ff9645a9deca067ced1d60?s=128&d=identicon&r=PG&f=1", "display_name": "perl", "link": "https://stackoverflow.com/users/6792743/perl"}, "is_accepted": true, "score": 1, "last_activity_date": 1551888535, "last_edit_date": 1551888535, "creation_date": 1551878392, "answer_id": 55024090, "question_id": 55023060, "link": "https://stackoverflow.com/questions/55023060/how-to-get-the-seconds-of-day/55024090#55024090", "title": "How to get the seconds of day", "body": "<p><strong>Note:</strong>\nThis function returns the nominal number of seconds of day in the (0 - 86399) range. If you're looking for the \"number of seconds elapsed since midnight\", which may not be in (0 - 86399) range due to daylight saving time, please see @icza's answer.</p>\n\n<p><strong>Update:</strong>\nPlease note also that the question refers to Joda Time implementation, which, according to <a href=\"https://stackoverflow.com/questions/37937961/joda-time-getsecondofday-on-dst-switch-day\">Joda Time getSecondOfDay on DST switch day</a>, seems to correspond to the nominal number of seconds implementation (as in my answer below) as opposed to the \"number of seconds elapsed since midnight\" (as in @icza's answer).</p>\n\n<pre><code>package main \n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc getSecondOfDay(t time.Time) int {\n    return 60*60*t.Hour() + 60*t.Minute() + t.Second()\n}\n\nfunc main() {\n    t := time.Now()\n    fmt.Println(getSecondOfDay(t))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1551882947, "last_edit_date": 1551882947, "creation_date": 1551878972, "answer_id": 55024274, "question_id": 55023060, "link": "https://stackoverflow.com/questions/55023060/how-to-get-the-seconds-of-day/55024274#55024274", "title": "How to get the seconds of day", "body": "<p>If we define \"seconds of day\" as the \"elapsed seconds since midnight\", then to get correct result even on days when <a href=\"https://en.wikipedia.org/wiki/Daylight_saving_time\" rel=\"nofollow noreferrer\">daylight saving time</a> happens we should subtract the time representing midnight from the given time. For that, we may use <a href=\"https://golang.org/pkg/time/#Time.Sub\" rel=\"nofollow noreferrer\"><code>Time.Sub()</code></a>.</p>\n\n<pre><code>func daySeconds(t time.Time) int {\n    year, month, day := t.Date()\n    t2 := time.Date(year, month, day, 0, 0, 0, 0, t.Location())\n    return int(t.Sub(t2).Seconds())\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>for _, t := range []time.Time{\n    time.Date(2019, 1, 1, 0, 0, 30, 0, time.UTC),\n    time.Date(2019, 1, 1, 0, 1, 30, 0, time.UTC),\n    time.Date(2019, 1, 1, 0, 12, 30, 0, time.UTC),\n    time.Date(2019, 1, 1, 12, 12, 30, 0, time.UTC),\n} {\n    fmt.Println(daySeconds(t))\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/wDCZBOOAqaX\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>30\n90\n750\n43950\n</code></pre>\n\n<p>Let's see how this function gives correct result when daylight saving time happens. In Hungary, 25 March 2018 is a day when the clock was turned forward 1 hour at <code>02:00:00</code>, from <code>2 am</code> to <code>3 am</code>.</p>\n\n<pre><code>loc, err := time.LoadLocation(\"CET\")\nif err != nil {\n    fmt.Println(err)\n    return\n}\n\nt := time.Date(2018, 3, 25, 0, 0, 30, 0, loc)\nfmt.Println(t)\nfmt.Println(daySeconds(t))\n\nt = t.Add(2 * time.Hour)\nfmt.Println(t)\nfmt.Println(daySeconds(t))\n</code></pre>\n\n<p>This outputs (try it on the <a href=\"https://play.golang.org/p/_3dlFTBw3su\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>2018-03-25 00:00:30 +0100 CET\n30\n2018-03-25 03:00:30 +0200 CEST\n7230\n</code></pre>\n\n<p>We print the <code>daySeconds</code> of a time being 30 seconds after midnight, which is <code>30</code> of course. Then we add 2 hours to the time (2 hours = 2*3600 seconds = 7200), and the <code>daySeconds</code> of this new time will be properly <code>7200 + 30 = 7230</code>, even though the time changed 3 hours.</p>\n"}], "owner": {"reputation": 665, "user_id": 533237, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2c53d96de85a46700cefb0f6da8a2275?s=128&d=identicon&r=PG&f=1", "display_name": "yodhevauhe", "link": "https://stackoverflow.com/users/533237/yodhevauhe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1277, "favorite_count": 0, "closed_date": 1551883785, "accepted_answer_id": 55024090, "answer_count": 2, "score": -6, "last_activity_date": 1551946291, "creation_date": 1551875028, "last_edit_date": 1551946291, "question_id": 55023060, "link": "https://stackoverflow.com/questions/55023060/how-to-get-the-seconds-of-day", "closed_reason": "Needs details or clarity", "title": "How to get the seconds of day", "body": "<p>How to get seconds of day (1 - 86400) in Go?</p>\n\n<p>Just like <a href=\"http://joda-time.sourceforge.net/apidocs/org/joda/time/base/AbstractDateTime.html#getSecondOfDay()\" rel=\"nofollow noreferrer\">http://joda-time.sourceforge.net/apidocs/org/joda/time/base/AbstractDateTime.html#getSecondOfDay()</a></p>\n\n<p>Update/Clarifications</p>\n\n<ul>\n<li>Wanted equivalent of the joda/SecondOfDay in golang</li>\n<li>Expected to start at 0 and 86400 at end of the day</li>\n<li>Required when rewriting in golang a java opensource function which in turn is using joda/secondOfDay</li>\n<li>Googled '24 hour to seconds' to get 86400</li>\n<li>While asking question I could only think of now.Unix()-yesterdayMidnight.Unix() and the simple accepted answer didn't come to my mind</li>\n<li>Obviously didn't think about Daylight Saving</li>\n<li>Wanted to see if there is some built in function or popular/standard library</li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "edited": false, "score": 1, "creation_date": 1551873607, "post_id": 55022458, "comment_id": 96798466, "body": "The above example works perfectly for me on Go Playground <a href=\"https://play.golang.org/p/fnCJ81C6nSK\" rel=\"nofollow noreferrer\">play.golang.org/p/fnCJ81C6nSK</a>. What are you planning to acheive?"}], "answers": [{"comments": [{"owner": {"reputation": 3738, "user_id": 1392189, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/049239f7f0deb84f0775853a9cb401c7?s=128&d=identicon&r=PG", "display_name": "Rollie", "link": "https://stackoverflow.com/users/1392189/rollie"}, "edited": false, "score": 0, "creation_date": 1551875587, "post_id": 55023018, "comment_id": 96799596, "body": "That&#39;s a reasonable idea. Is it not possible to do something like <code>void foo(Customer * pCust) { *pCust = cachedValue; }</code> (the C equivilent) in Go?"}], "tags": [], "owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "is_accepted": false, "score": 1, "last_activity_date": 1551875212, "last_edit_date": 1551875212, "creation_date": 1551874866, "answer_id": 55023018, "question_id": 55022458, "link": "https://stackoverflow.com/questions/55022458/how-can-a-method-take-an-output-parameter-of-an-interface-type/55023018#55023018", "title": "How can a method take an output parameter of an interface type?", "body": "<p>You can use reflection to set the passed interface.\nEven when a struct reference is passed as interface, the underlying type info is not lost and we can use reflection.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Savable interface {}\n\ntype Customer struct {\n    Name string\n} \n\nfunc GetSaved(id string, s Savable) {\n    cached := Customer{ Name: id }\n    c1 := reflect.ValueOf(cached)\n    reflect.ValueOf(s).Elem().Set(c1)\n}\n\nfunc main() {\n  c := Customer{}\n  fmt.Printf(\"Before: %v\\n\", c)\n  GetSaved(\"bob\", &amp;c)\n  fmt.Printf(\"After: %v\\n\", c)\n}\n</code></pre>\n\n<p>Here is the running <a href=\"https://play.golang.org/p/U32GZyvflhI\" rel=\"nofollow noreferrer\">link</a></p>\n"}, {"tags": [], "owner": {"reputation": 24, "user_id": 11159283, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-V1TuRwY8Uw0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rehgPhuJlgff0QlsPjvA68Qg31cVw/mo/photo.jpg?sz=128", "display_name": "Krithic P", "link": "https://stackoverflow.com/users/11159283/krithic-p"}, "is_accepted": true, "score": 0, "last_activity_date": 1551875589, "creation_date": 1551875589, "answer_id": 55023208, "question_id": 55022458, "link": "https://stackoverflow.com/questions/55022458/how-can-a-method-take-an-output-parameter-of-an-interface-type/55023208#55023208", "title": "How can a method take an output parameter of an interface type?", "body": "<p>This works I converted it to bytes and Unmarshaled it back into your structure. Hope this helps. :)\n    package main</p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Savable interface{}\ntype Customer struct {\n    Name string\n} // satisfies 'Savable'\n\nfunc GetSaved(id string, s Savable) {\n    // somehow get a reference to the object from cache\n    cached := Customer{Name: \"Bob\"}\n    byt, _ := json.Marshal(cached)\n\n    _ = json.Unmarshal(byt, &amp;s)\n\n}\n\nfunc main() {\n    c := Customer{}\n    GetSaved(\"bob\", &amp;c)\n    fmt.Println(c)\n}\n</code></pre>\n\n<p>Run link: <a href=\"https://play.golang.org/p/NrBRcRmXRVZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/NrBRcRmXRVZ</a></p>\n"}], "owner": {"reputation": 3738, "user_id": 1392189, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/049239f7f0deb84f0775853a9cb401c7?s=128&d=identicon&r=PG", "display_name": "Rollie", "link": "https://stackoverflow.com/users/1392189/rollie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "closed_date": 1551876052, "accepted_answer_id": 55023208, "answer_count": 2, "score": 1, "last_activity_date": 1551875589, "creation_date": 1551873071, "last_edit_date": 1551873783, "question_id": 55022458, "link": "https://stackoverflow.com/questions/55022458/how-can-a-method-take-an-output-parameter-of-an-interface-type", "closed_reason": "Duplicate", "title": "How can a method take an output parameter of an interface type?", "body": "<p>Given:</p>\n\n<pre><code>type Savable interface {}\ntype Customer struct {} // satisfies 'Savable'\n\nfunc GetSaved(id string, s Savable) {\n  // somehow get a reference to the object from cache\n  s = cachedObject \n  // alternately, something like:\n  // json.Unmarshal(jsonFromDisk, &amp;s)\n}\n\nfunc Foo() {\n  c := Customer{}\n  GetSaved(\"bob\", &amp;c)\n}\n</code></pre>\n\n<p>Trying a few configurations, I either get compilation errors related to \"Expects *Savable, found *Customer\", or the <code>GetSaved</code> function doesn't actually change what I want to be the 'output variable'. Is this doable, and I'm just not getting the right mix of interface/pointers/etc? Or is this not possible for some reason?</p>\n\n<p>Edit: A <a href=\"https://play.golang.org/p/XaorjumFCnY\" rel=\"nofollow noreferrer\">working example</a> illustrating the problem.</p>\n"}, {"tags": ["json", "http", "go", "go-templates"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1551870056, "post_id": 55021403, "comment_id": 96796314, "body": "Why not serialise to JSON properly? What is the reason to manually craft it from pieces?"}], "answers": [{"comments": [{"owner": {"reputation": 173, "user_id": 10337607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dd31955c5c59d36f62ff54efdc64f49?s=128&d=identicon&r=PG&f=1", "display_name": "George Livanoss", "link": "https://stackoverflow.com/users/10337607/george-livanoss"}, "edited": false, "score": 0, "creation_date": 1551872720, "post_id": 55021498, "comment_id": 96797910, "body": "thanks, i definitively should do this way. the application is a very simple apl that was not meant to return json at the beginning, just a raw text"}, {"owner": {"reputation": 1975, "user_id": 12341099, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GkJhc.png?s=128&g=1", "display_name": "Yadu", "link": "https://stackoverflow.com/users/12341099/yadu"}, "edited": false, "score": 0, "creation_date": 1596538225, "post_id": 55021498, "comment_id": 111836644, "body": "is it okay to <code>json.NewEncoder(w)</code> for every new request?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1551871129, "last_edit_date": 1551871129, "creation_date": 1551870076, "answer_id": 55021498, "question_id": 55021403, "link": "https://stackoverflow.com/questions/55021403/ouput-json-to-http-responsewriter-with-template/55021498#55021498", "title": "Ouput json to http.ResponseWriter with template", "body": "<p>You shouldn't use Go's template engine (neither <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\"><code>text/template</code></a> nor <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\"><code>html/template</code></a>) to generate JSON output, as the template engine has no knowledge of JSON syntax and rules (escaping).</p>\n\n<p>Instead use the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>encoding/json</code></a> package to generate JSON. You may use <a href=\"https://golang.org/pkg/encoding/json/#Encoder\" rel=\"nofollow noreferrer\"><code>json.Encoder</code></a> to write / stream the response directly to an <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\"><code>io.Writer</code></a>, such as <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow noreferrer\"><code>http.ResponseWriter</code></a>.</p>\n\n<p>Example:</p>\n\n<pre><code>type Output struct {\n    Resources []string `json:\"resources\"`\n}\n\nobj := Output{\n    Resources: []string{\"r1\", \"r2\"},\n}\n\nenc := json.NewEncoder(w)\n\nif err := enc.Encode(obj); err != nil {\n    // Handle error\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>Outputs (try it on the <a href=\"https://play.golang.org/p/JX3JNCMZUxq\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{\"resources\":[\"r1\",\"r2\"]}\n</code></pre>\n"}], "owner": {"reputation": 173, "user_id": 10337607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dd31955c5c59d36f62ff54efdc64f49?s=128&d=identicon&r=PG&f=1", "display_name": "George Livanoss", "link": "https://stackoverflow.com/users/10337607/george-livanoss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 389, "favorite_count": 0, "accepted_answer_id": 55021498, "answer_count": 1, "score": 0, "last_activity_date": 1551874421, "creation_date": 1551869818, "last_edit_date": 1551874421, "question_id": 55021403, "link": "https://stackoverflow.com/questions/55021403/ouput-json-to-http-responsewriter-with-template", "title": "Ouput json to http.ResponseWriter with template", "body": "<p>i've this template: </p>\n\n<pre><code>var ListTemplate = `\n{\n    \"resources\": [\n        {{ StringsJoin . \", \" }}\n    ]\n  }\n`\n</code></pre>\n\n<p>rendered with:</p>\n\n<pre><code>JoinFunc := template.FuncMap{\"StringsJoin\": strings.Join}\ntmpl := template.Must(template.New(\"\").Funcs(JoinFunc).Parse(ListTemplate))\n</code></pre>\n\n<p>if i send it to a http.ResponseWriter the output text is escaped. </p>\n\n<pre><code>var list []string\ntmpl.Execute(w, list)\n</code></pre>\n\n<p>how can i write a json this way?</p>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1551869274, "post_id": 55021144, "comment_id": 96795842, "body": "Duplicate. You must type assert the interface{} to"}], "answers": [{"tags": [], "owner": {"reputation": 75, "user_id": 2475128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be305db1ca83aa3c4ef9a0d815756cc3?s=128&d=identicon&r=PG", "display_name": "e.nikolov", "link": "https://stackoverflow.com/users/2475128/e-nikolov"}, "is_accepted": true, "score": 1, "last_activity_date": 1551879414, "last_edit_date": 1551879414, "creation_date": 1551877836, "answer_id": 55023923, "question_id": 55021144, "link": "https://stackoverflow.com/questions/55021144/how-to-parse-yaml-and-get-value-for-interface-deep-structue/55023923#55023923", "title": "How to parse yaml and get value for interface- deep structue", "body": "<blockquote>\n  <p>what I've tried is this which works but what happens if the run value is empty or no entry at all,this will cause a dump how can I overcome this ?</p>\n</blockquote>\n\n<p>You can do </p>\n\n<pre><code>runParams, ok := runners.BuildParams.BeforeExec[\"run-parameters\"]\n\nif !ok {\n    // handle lack of \"run-parameters\" in BeforeExec\n}\n\nrunParamsMap, ok := runParams.(map[interface{}]interface{})\n\nif !ok {\n    // handle \"run-parameters\" not being a map\n}\n\nrun, ok := runParamsMap[\"run\"]\n\nif !ok {\n    // handle lack of \"run\" inside \"run-parameters\"\n}\n\nrunStr, ok := run.(string)\n\nif !ok {\n    // handle \"run\" not being a string\n}\n\nfmt.Println(\"run: \", runStr)\n</code></pre>\n\n<p>This is quite verbose so you could use something like <a href=\"https://github.com/jmoiron/jsonq\" rel=\"nofollow noreferrer\">https://github.com/jmoiron/jsonq</a>, where you can specify a \"path\" to the desired value nested inside several levels of maps. Despite the \"json\" in the name, this library works with map[string]interface{} and not json files. But note that the library you use for yaml unmarshalling results in <code>map[interface{}]interface{}</code> instead of <code>map[string]interface{}</code> and you will have to use a different one in order for it to work with jsonq.</p>\n\n<pre><code>run, err := jsonq.NewQuery(runners.BuildParams.BeforeExec).String(\"run-parameters\", \"run\")\n\nif err != nil {\n    // handle all possible errors in one place\n}\n\nfmt.Println(\"run: \", run)\n</code></pre>\n"}], "owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 1, "accepted_answer_id": 55023923, "answer_count": 1, "score": 1, "last_activity_date": 1551879414, "creation_date": 1551869040, "last_edit_date": 1551874455, "question_id": 55021144, "link": "https://stackoverflow.com/questions/55021144/how-to-parse-yaml-and-get-value-for-interface-deep-structue", "title": "How to parse yaml and get value for interface- deep structue", "body": "<p>I'm trying to parse this yaml and I want to get the <code>values</code> of the <code>run</code> entry (test1 or test2) without success, here is my working example.</p>\n\n<p>im a bit get lost with the map inside map :( ,\nthis is given yaml which I couldent change ...</p>\n\n<p>any idea how could I got those values </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"gopkg.in/yaml.v2\"\n)\n\nvar runContent = []byte(`\nversion: \"3.2\"\n\nrun-parameters:\n  before:\n    run-parameters:\n      run: test1\n\n  after:\n    run-parameters:\n      run: test2\n\n`)\n\ntype FTD struct {\n    Version     string     `yaml:\"version,omitempty\"`\n    BuildParams *RunParams `yaml:\"run-parameters,omitempty\"`\n}\n\ntype RunParams struct {\n    BeforeExec map[string]interface{} `yaml:\"before,omitempty\"`\n    AfterExec map[string]interface{} `yaml:\"after,omitempty\"`\n}\n\nfunc main() {\n    runners := &amp;FTD{}\n    // parse mta yaml\n    err := yaml.Unmarshal(runContent, runners)\n    if err != nil {\n        log.Fatalf(\"Error : %v\", err)\n    }\n    for k, v := range runners.BuildParams.BeforeExec {\n        fmt.Println(k, v.(interface{}))\n    }\n}\n</code></pre>\n\n<p>This is working example\n<a href=\"https://play.golang.org/p/qTqUJy3md0c\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qTqUJy3md0c</a></p>\n\n<p>also I've tried with </p>\n\n<p>this is working</p>\n\n<pre><code>run := runners.BuildParams.BeforeExec[\"run-parameters\"].(map[interface{}]interface{})[\"run\"]\n     fmt.Println(\"run: \", run)\n</code></pre>\n\n<p>what I've tried is this which works but what happens if the <code>run</code> value is empty or no entry at all,<strong>this will cause a dump</strong>  how can I overcome this ? </p>\n"}, {"tags": ["file", "go", "encode"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1551863154, "post_id": 55019192, "comment_id": 96792018, "body": "It&#39;s not clear what you want to create and how you want to use it. In general, you can just use an in-memory buffer, be it a simple <code>[]byte</code> or a <code>bytes.Buffer</code> which implements <code>io.Reader</code> and <code>io.Writer</code>, so you can use it to read and write just like a file."}, {"owner": {"reputation": 182, "user_id": 4643176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9127b4dc7cb1bc1d227633311911899e?s=128&d=identicon&r=PG&f=1", "display_name": "Vinay", "link": "https://stackoverflow.com/users/4643176/vinay"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1551863694, "post_id": 55019192, "comment_id": 96792333, "body": "Actually I have scenario like <code>test cases</code>, where I need a dummy encoded bytes of File(but don&#39;t want to create it) and need to check with other data. Otherwise I have to create a file and then perform the operation, but I don&#39;t have definite scenario to delete it(though I can&#39;t keep it )"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1551864175, "post_id": 55019192, "comment_id": 96792610, "body": "You should change the use cases to not rely on the concrete <code>os.File</code> type but use interfaces instead (<code>io.Reader</code>, <code>io.Writer</code> and similar). That way no matter if you pass a <code>*bytes.Buffer</code> or an <code>*os.File</code>, it will work with both."}, {"owner": {"reputation": 182, "user_id": 4643176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9127b4dc7cb1bc1d227633311911899e?s=128&d=identicon&r=PG&f=1", "display_name": "Vinay", "link": "https://stackoverflow.com/users/4643176/vinay"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1551866884, "post_id": 55019192, "comment_id": 96794286, "body": "@icza You wants me to change the functionality?  Considered it as test cases then how we can generate the bytes of virtual file?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1551867717, "last_edit_date": 1551867717, "creation_date": 1551867317, "answer_id": 55020589, "question_id": 55019192, "link": "https://stackoverflow.com/questions/55019192/need-to-generate-runtime-binary-encoded-file-in-golang/55020589#55020589", "title": "Need to generate runtime binary encoded file in golang", "body": "<p>A better practice is to not rely on concrete types (e.g. <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>os.File</code></a>), but use interfaces instead that describe the functionality you want to use the file for.</p>\n\n<p>E.g. if you have a function that takes a file because it wants to read from it, use <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a> instead:</p>\n\n<pre><code>func process(r io.Reader) error {\n    // ...\n}\n</code></pre>\n\n<p>Similarly, if you want to write to the file, use <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\"><code>io.Writer</code></a>, or if you want to do  both, use <a href=\"https://golang.org/pkg/io/#ReadWriter\" rel=\"nofollow noreferrer\"><code>io.ReadWriter</code></a> or <a href=\"https://golang.org/pkg/io/#ReadWriteCloser\" rel=\"nofollow noreferrer\"><code>io.ReadWriteCloser</code></a>. You may pass an <code>*os.File</code> value to these functions, because <code>*os.File</code> implements those interfaces.</p>\n\n<p>The benefit of this is that you can call these functions with any values that implement the interface. If you want to test these functions, you may pass an in-memory <a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"nofollow noreferrer\"><code>bytes.Buffer</code></a> which implements <code>io.Reader</code> and <code>io.Writer</code>, and whose content you can construct manually, at runtime, for example:</p>\n\n<pre><code>buf := &amp;bytes.Buffer{}\nbuf.Write([]byte{1, 2, 3})\nbuf.WriteString(\"Hello\")\n</code></pre>\n\n<p>Here <code>buf</code> will contain the bytes <code>1</code>, <code>2</code>, <code>3</code> and the string <code>\"Hello\"</code>. After that you may pass <code>buf</code> where a reader or writer is needed, e.g.:</p>\n\n<pre><code>process(buf)\n</code></pre>\n\n<p>See similar / related questions and examples:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/46365221/fill-os-stdin-for-function-that-reads-from-it/46365584#46365584\">Fill os.Stdin for function that reads from it</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/43912124/example-code-for-testing-the-filesystem-in-golang/43914455#43914455\">Example code for testing the filesystem in Golang</a></p>\n"}], "owner": {"reputation": 182, "user_id": 4643176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9127b4dc7cb1bc1d227633311911899e?s=128&d=identicon&r=PG&f=1", "display_name": "Vinay", "link": "https://stackoverflow.com/users/4643176/vinay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1551867717, "creation_date": 1551863028, "question_id": 55019192, "link": "https://stackoverflow.com/questions/55019192/need-to-generate-runtime-binary-encoded-file-in-golang", "title": "Need to generate runtime binary encoded file in golang", "body": "<p>I am working on the project in which I need to generate a file as binary encoded(bytes). Thing is that, I don't want to store the file but just need the encoded data to verify with some test data.</p>\n\n<p>Here is the sample code I have <a href=\"https://play.golang.org/p/FKA_9fT3Nvv\" rel=\"nofollow noreferrer\">zip file</a></p>\n\n<p>Above example is for <code>zip</code> but I am not restricted to use <code>zip</code> or any file type. And here we need to have stored file to read but I don't want to store and delete the file later.</p>\n\n<p>I know it has not much efforts to ask for the help, but as an newbie, I come to that only.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["api", "go"], "comments": [{"owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "edited": false, "score": 0, "creation_date": 1551862304, "post_id": 55018899, "comment_id": 96791564, "body": "is protoc in PATH?"}, {"owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "reply_to_user": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "edited": false, "score": 0, "creation_date": 1551862355, "post_id": 55018899, "comment_id": 96791592, "body": "Do you mean in my Environment Variables? @SauravPrakash"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1551862406, "post_id": 55018899, "comment_id": 96791623, "body": "Gotta love a library that doesn&#39;t know the difference between &quot;then&quot; and &quot;than&quot; :P"}, {"owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "edited": false, "score": 0, "creation_date": 1551862520, "post_id": 55018899, "comment_id": 96791682, "body": "yes, is <code>protoc</code> in your PATH env var?"}, {"owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "reply_to_user": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "edited": false, "score": 0, "creation_date": 1551862555, "post_id": 55018899, "comment_id": 96791699, "body": "@SauravPrakash no I downloaded it but didn&#39;t add in my PATH."}], "answers": [{"tags": [], "owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "is_accepted": true, "score": 2, "last_activity_date": 1551862661, "creation_date": 1551862661, "answer_id": 55019066, "question_id": 55018899, "link": "https://stackoverflow.com/questions/55018899/gokit-and-generating-microservices-install-protoc-error/55019066#55019066", "title": "GoKit and generating microservices install protoc error", "body": "<p>From the <a href=\"https://github.com/go-kit/kit/tree/master/transport/grpc\" rel=\"nofollow noreferrer\">go-kit source</a>:</p>\n\n<blockquote>\n  <p>Using gRPC and go-kit together is very simple.</p>\n  \n  <p>First, define your service using protobuf3. This is explained in gRPC documentation. See add.proto for an example. Make sure the proto definition\n  matches your service's go-kit (interface) definition.</p>\n  \n  <p>Next, get the protoc compiler.</p>\n  \n  <p>You can download pre-compiled binaries from the protobuf release page. You will unzip a folder called protoc3 with a subdirectory bin containing an executable. Move that executable somewhere in your $PATH and you're good to go!</p>\n</blockquote>\n\n<p>So just make sure protoc is in your PATH env var.</p>\n"}], "owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 55019066, "answer_count": 1, "score": 0, "last_activity_date": 1551862661, "creation_date": 1551862102, "question_id": 55018899, "link": "https://stackoverflow.com/questions/55018899/gokit-and-generating-microservices-install-protoc-error", "title": "GoKit and generating microservices install protoc error", "body": "<p>The error shows me this</p>\n\n<blockquote>\n  <ol>\n  <li>I already downloaded those packages. </li>\n  <li>still show me the error Please install protoc first and than rerun the command</li>\n  </ol>\n</blockquote>\n\n<pre><code>$ kit generate service notifactor -t grpc --dmw\ntime=\"2019-03-06T16:35:29+08:00\" level=error msg=\"Please install protoc first and than rerun the command\"\ntime=\"2019-03-06T16:35:29+08:00\" level=info msg=\"Install proto3.\\nhttps://github.com/google/protobuf/releases\\nUpdate protoc Go bindings via\\n&gt; go get -u github.com/golang/protobuf/proto\\n&gt; go get -u github.com/golang/protobuf/protoc-gen-go\\n\\nSee also\\nhttps://github.com/grpc/grpc-go/tree/master/examples\"\n</code></pre>\n"}, {"tags": ["go", "memory-leaks"], "answers": [{"tags": [], "owner": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "is_accepted": false, "score": 0, "last_activity_date": 1551862487, "last_edit_date": 1551862487, "creation_date": 1551862107, "answer_id": 55018900, "question_id": 55018611, "link": "https://stackoverflow.com/questions/55018611/does-go-gc-keep-whole-objects-in-memory-while-interior-pointer-to-one-field-rem/55018900#55018900", "title": "Does go GC keep whole objects in memory, while interior pointer to one field remains? Can this cause memory leaks?", "body": "<p>Looking at profiler, it seems to indeed be a memory leak (go1.11.5 darwin/amd64)</p>\n\n<hr>\n\n<p>Let's look at profiler.</p>\n\n<p>I found <a href=\"https://play.golang.org/p/CHd8wCf5oP\" rel=\"nofollow noreferrer\">an online example for debugging memory</a>. By adapting to my example, I did this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"runtime\"\n    \"runtime/debug\"\n    \"runtime/pprof\"\n)\n\nconst aLot = 5000000\n\nfunc getInteriorPointer() *int {\n    type bigStruct struct {\n        someBigThing [aLot]int\n        smallThing   int\n    }\n    b := bigStruct{smallThing: 3}\n    return &amp;b.smallThing\n}\n\nfunc main() {\n    p := getInteriorPointer()\n    runtime.GC()\n    debug.FreeOSMemory()\n    fmem, _ := os.Create(\"prof.prof\")\n    pprof.WriteHeapProfile(fmem)\n\n    // keep using p in the rest of the app,\n    // never using someBigThing from the struct\n    fmt.Println(*p)\n}\n</code></pre>\n\n<p>Now I run <code>go tool pprof prof.prof</code> and <code>list main</code></p>\n\n<pre><code>ROUTINE ======================== main.getInteriorPointer in /Users/karel/exp/exp.go\n   38.15MB    38.15MB (flat, cum)   100% of Total\n         .          .     13:func getInteriorPointer() *int {\n         .          .     14:   type bigStruct struct {\n         .          .     15:           someBigThing [aLot]int\n         .          .     16:           smallThing   int\n         .          .     17:   }\n   38.15MB    38.15MB     18:   b := bigStruct{smallThing: 3}\n         .          .     19:   return &amp;b.smallThing\n         .          .     20:}\n         .          .     21:\n         .          .     22:func main() {\n         .          .     23:   p := getInteriorPointer()\nROUTINE ======================== main.main in /Users/karel/exp/exp.go\n         0    38.15MB (flat, cum)   100% of Total\n         .          .     18:   b := bigStruct{smallThing: 3}\n         .          .     19:   return &amp;b.smallThing\n         .          .     20:}\n         .          .     21:\n         .          .     22:func main() {\n         .    38.15MB     23:   p := getInteriorPointer()\n         .          .     24:   runtime.GC()\n         .          .     25:   debug.FreeOSMemory()\n         .          .     26:   fmem, _ := os.Create(\"prof.prof\")\n         .          .     27:   pprof.WriteHeapProfile(fmem)\n         .          .     28:\n</code></pre>\n\n<p>It seems garbage collector indeed doesn't remove the unnecessary object from memory. <em>If</em> I understand the format correctly. (I might not, since there is almost no documentation.)</p>\n"}, {"comments": [{"owner": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "edited": false, "score": 0, "creation_date": 1551862747, "post_id": 55019074, "comment_id": 96791811, "body": "I knew about this slice issue, but I didn&#39;t know it&#39;s an issue with interior pointers in general. :)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1551882777, "post_id": 55019074, "comment_id": 96803842, "body": "Note, however, that a pointer to a struct field is pretty rare, and this &quot;leak&quot; would not apply to cases where e.g. you return a field of a struct, and the field is of a pointer type (because the pointer would be copied and the memory referenced by it is independent of the struct allocation)."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1551862787, "last_edit_date": 1551862787, "creation_date": 1551862692, "answer_id": 55019074, "question_id": 55018611, "link": "https://stackoverflow.com/questions/55018611/does-go-gc-keep-whole-objects-in-memory-while-interior-pointer-to-one-field-rem/55019074#55019074", "title": "Does go GC keep whole objects in memory, while interior pointer to one field remains? Can this cause memory leaks?", "body": "<p>Yes. Memory will be kept until there is no longer any reference to any part of the allocation. </p>\n\n<p>The usual example is given in slice tricks</p>\n\n<blockquote>\n  <p><a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"nofollow noreferrer\">SliceTricks</a></p>\n  \n  <p>Delete without preserving order</p>\n\n<pre><code>a[i] = a[len(a)-1] \na = a[:len(a)-1]\n</code></pre>\n  \n  <p>NOTE If the type of the element is a pointer or a struct with pointer\n  fields, which need to be garbage collected, the above implementations\n  of Cut and Delete have a potential memory leak problem: some elements\n  with values are still referenced by slice a and thus can not be\n  collected.</p>\n</blockquote>\n"}], "owner": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "accepted_answer_id": 55019074, "answer_count": 2, "score": 1, "last_activity_date": 1551862787, "creation_date": 1551860983, "question_id": 55018611, "link": "https://stackoverflow.com/questions/55018611/does-go-gc-keep-whole-objects-in-memory-while-interior-pointer-to-one-field-rem", "title": "Does go GC keep whole objects in memory, while interior pointer to one field remains? Can this cause memory leaks?", "body": "<p>Does go's GC keep whole objects in memory, while interior pointer to a field remains? </p>\n\n<p>Can this cause memory leaks, in a code like this? Or is go's GC \"smart enough\" to notice that the rest of the object is no longer needed and clear it from memory?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nconst aLot = 500000000\n\nfunc getInteriorPointer() *int {\n    type bigStruct struct {\n        someBigThing [aLot]int\n        smallThing   int\n    }\n    b := bigStruct{smallThing: 3}\n    return &amp;b.smallThing\n}\n\nfunc main() {\n    p := getInteriorPointer()\n    // keep using p in the rest of the app, \n    // never using someBigThing from the struct\n    fmt.Println(*p)\n}\n\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 1, "creation_date": 1551861416, "post_id": 55017663, "comment_id": 96791075, "body": "Do you mean to preload the <code>Color</code> struct? If yes did you try to query it like that <code>GormDB.Preload(&#39;Color&#39;).Where(userStruct).Find(&amp;results)</code>"}, {"owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "reply_to_user": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 1, "creation_date": 1551862555, "post_id": 55017663, "comment_id": 96791702, "body": "@ttomalak thank you, can you write it as an answer?"}], "answers": [{"tags": [], "owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "is_accepted": true, "score": 1, "last_activity_date": 1551862714, "creation_date": 1551862714, "answer_id": 55019079, "question_id": 55017663, "link": "https://stackoverflow.com/questions/55017663/query-with-has-one-association-one-to-one/55019079#55019079", "title": "Query with &#39;has one&#39; association (one-to-one)", "body": "<p>Do you mean to preload the Color struct? If yes did you try to query it like that </p>\n\n<pre><code>GormDB.Preload('Color').Where(userStruct).Find(&amp;results)\n</code></pre>\n"}], "owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 55019079, "answer_count": 1, "score": 1, "last_activity_date": 1551862714, "creation_date": 1551856952, "last_edit_date": 1551859584, "question_id": 55017663, "link": "https://stackoverflow.com/questions/55017663/query-with-has-one-association-one-to-one", "title": "Query with &#39;has one&#39; association (one-to-one)", "body": "<p>I'm playing a bit with Gorm while I'm trying to decide which ORM library fit the most for my needs.</p>\n\n<p>Important to mention that I'm currently working with Sqlite.</p>\n\n<p>Following the guide I created two structs:</p>\n\n<pre><code>  type Color struct {\n    gorm.Model\n    UserID uint\n    Name   string\n}\n\n//User struct define a basic user model\ntype User struct {\n    gorm.Model\n    Username     string\n    Email        string\n    FirstName    string\n    LastName     string\n    Password     string\n    CreationDate time.Time\n    DOB          time.Time\n    IgnoreMe     int   `gorm:\"-\"` // Ignore this field\n    Color        Color `gorm:\"foreignkey:ColorRefer\"`\n    ColorRefer   uint\n}\n</code></pre>\n\n<p>when I'm creating a DB with </p>\n\n<pre><code>func CreateTables() {\nuser := dm.User{}\ncolor := dm.Color{}\nGormDB.CreateTable(&amp;color)\nGormDB.CreateTable(&amp;user)\nGormDB.Model(&amp;user).AddForeignKey(\"ColorRefer\", \"colors(id)\", \"CASCADE\", \"CASCADE\")\n</code></pre>\n\n<p>}</p>\n\n<p>or with:</p>\n\n<pre><code>func CreateTables() {\n    GormDB.AutoMigrate(&amp;dm.User{},&amp;dm.Color{})\n}\n</code></pre>\n\n<p>Sadly it's not working as I would of expect and create the foreign key automatically, but it's works when I do it manually.</p>\n\n<p>My main problem is when I'm trying to query Users </p>\n\n<pre><code>//QueryByStructExample query users table by the struct non-zero (non-default) fields.\n    func QueryByStructExample(userStruct dm.User) []dm.User {\n        var results []dm.User\n        GormDB.Where(userStruct).Find(&amp;results)\n        return results\n    }\n</code></pre>\n\n<p>I created the following function in a try to query users by email <strong>with the color property which is my color struct</strong> and I tried to play with a lot with the Model,Related and the Association functions, and nothing seems to work and (I'm avoiding to use join by purpose).\nThe end result is that it query my User but without the color (only with the ID in my colorRefer) </p>\n\n<p>any suggestion?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1551856660, "post_id": 55017546, "comment_id": 96788698, "body": "<code>0xRR</code> is not a number literal in any programming language."}, {"owner": {"reputation": 478, "user_id": 3491376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lh2OC.png?s=128&g=1", "display_name": "Deadooshka", "link": "https://stackoverflow.com/users/3491376/deadooshka"}, "edited": false, "score": 0, "creation_date": 1551857121, "post_id": 55017546, "comment_id": 96788892, "body": "<a href=\"https://golang.org/pkg/image/color/#RGBA\" rel=\"nofollow noreferrer\">golang.org/pkg/image/color/#RGBA</a>"}, {"owner": {"reputation": 73, "user_id": 6648469, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-kcI_XDTGG3E/AAAAAAAAAAI/AAAAAAAAANU/6EXj3Az6aJ4/photo.jpg?sz=128", "display_name": "Mayank Gupta", "link": "https://stackoverflow.com/users/6648469/mayank-gupta"}, "edited": false, "score": 0, "creation_date": 1551961348, "post_id": 55017546, "comment_id": 96838100, "body": "I thought color.RGBA takes hexadecimal values. Beginner mistakes."}, {"owner": {"reputation": 18503, "user_id": 26702, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Eciao.jpg?s=128&g=1", "display_name": "Telemachus", "link": "https://stackoverflow.com/users/26702/telemachus"}, "edited": false, "score": 0, "creation_date": 1613832019, "post_id": 55017546, "comment_id": 117200487, "body": "For future Googlers, the problem here is a misunderstanding of Exercise 1.5 of <i>The Go Programming Language</i> by Donovan and Kernighan. They say &quot;Change the Lissajous program\u2019s color palette to green on black, for added authenticity. To create the web color #RRGGBB, use color.RGBA{0xRR, 0xGG, 0xBB, 0xff}, where each pair of hexadecimal digits represents the intensity of the red, green, or blue component of the pixel&quot; (15). <a href=\"http://www.gopl.io/\" rel=\"nofollow noreferrer\">gopl.io</a>"}, {"owner": {"reputation": 18503, "user_id": 26702, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Eciao.jpg?s=128&g=1", "display_name": "Telemachus", "link": "https://stackoverflow.com/users/26702/telemachus"}, "edited": false, "score": 0, "creation_date": 1613832309, "post_id": 55017546, "comment_id": 117200565, "body": "To get the effect that Donovan and Kernighan want, this should work for green: <code>color.RGBA{0x00, 0xFF, 0x00, 0xFF}</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": true, "score": 4, "last_activity_date": 1551861876, "last_edit_date": 1551861876, "creation_date": 1551857478, "answer_id": 55017769, "question_id": 55017546, "link": "https://stackoverflow.com/questions/55017546/when-creating-a-new-color-using-color-rgba-struct-type-in-go-i-am-getting-error/55017769#55017769", "title": "When creating a new color using color.RGBA struct type in Go, I am getting error saying that the integer is malformed", "body": "<p>Invalid value 0xRR, 0XGG in Original code. Not a number literal.</p>\n\n<p>example is </p>\n\n<pre><code>palette := []color.Color{color.RGBA{255, 0, 0, 255}, color.Black}\n</code></pre>\n\n<p>color.RGBA type has uint8. so has valid values 0 &lt;= C &lt;= A. </p>\n\n<p><a href=\"http://golang.org/pkg/image/color/#RGBA\" rel=\"nofollow noreferrer\">golang.org/pkg/image/color/#RGBA</a></p>\n"}], "owner": {"reputation": 73, "user_id": 6648469, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-kcI_XDTGG3E/AAAAAAAAAAI/AAAAAAAAANU/6EXj3Az6aJ4/photo.jpg?sz=128", "display_name": "Mayank Gupta", "link": "https://stackoverflow.com/users/6648469/mayank-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "accepted_answer_id": 55017769, "answer_count": 1, "score": 1, "last_activity_date": 1551861876, "creation_date": 1551856423, "question_id": 55017546, "link": "https://stackoverflow.com/questions/55017546/when-creating-a-new-color-using-color-rgba-struct-type-in-go-i-am-getting-error", "title": "When creating a new color using color.RGBA struct type in Go, I am getting error saying that the integer is malformed", "body": "<p>I am trying to create a color pallete using </p>\n\n<pre><code>var palette = []color.Color{color.RGBA{0xRR, 0xGG, 0xBB, 0xff},color.Black}\n</code></pre>\n\n<p>but I am getting this error:</p>\n\n<pre><code>./lissajous.go:13:40: malformed integer constant: 0x\n./lissajous.go:13:42: malformed hex constant\n./lissajous.go:13:42: syntax error: unexpected RR, expecting comma or }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1551855330, "post_id": 55015491, "comment_id": 96788127, "body": "That&#39;s because a URL is not a filename."}, {"owner": {"reputation": 3221, "user_id": 830230, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/YMFTp.jpg?s=128&g=1", "display_name": "Naguib Ihab", "link": "https://stackoverflow.com/users/830230/naguib-ihab"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1551862798, "post_id": 55015491, "comment_id": 96791836, "body": "@Flimzy It&#39;s a path to a file (noticed the .pdf in the end?), in PHP <code>readfile</code> is used to read a file from a url"}, {"owner": {"reputation": 3221, "user_id": 830230, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/YMFTp.jpg?s=128&g=1", "display_name": "Naguib Ihab", "link": "https://stackoverflow.com/users/830230/naguib-ihab"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1551862954, "post_id": 55015491, "comment_id": 96791921, "body": "@Flimzy Yeah but you&#39;re expecting me to figure out that from the function call, I&#39;m pointing out that it&#39;s not that obvious in other languages and I didn&#39;t expect it to be obvious in go"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1551863055, "post_id": 55015491, "comment_id": 96791968, "body": "No. I would expect you to figure that out from the <a href=\"https://golang.org/pkg/io/ioutil/#ReadFile\" rel=\"nofollow noreferrer\">documentation</a>."}, {"owner": {"reputation": 3221, "user_id": 830230, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/YMFTp.jpg?s=128&g=1", "display_name": "Naguib Ihab", "link": "https://stackoverflow.com/users/830230/naguib-ihab"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1551863112, "post_id": 55015491, "comment_id": 96791994, "body": "Again as I wrote in my first comment, that is a path to a file. If you open it, it will download the file..."}], "answers": [{"tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": true, "score": 1, "last_activity_date": 1551847111, "creation_date": 1551847111, "answer_id": 55015672, "question_id": 55015491, "link": "https://stackoverflow.com/questions/55015491/cant-find-a-public-file-from-url-in-go/55015672#55015672", "title": "Can&#39;t find a public file from url in go", "body": "<p>ioutil.ReadFile() does not support http.</p>\n\n<p>If you look at the source code(<a href=\"https://golang.org/src/io/ioutil/ioutil.go?s=1503:1549#L42\" rel=\"nofollow noreferrer\">https://golang.org/src/io/ioutil/ioutil.go?s=1503:1549#L42</a>), open the file using os.Open.</p>\n\n<p>I think I can do this coding.</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc main() {\n\n    fileUrl := \"http://www.pdf995.com/samples/pdf.pdf\"\n\n    if err := DownloadFile(\"example.pdf\", fileUrl); err != nil {\n        panic(err)\n    }\n}\n\nfunc DownloadFile(filepath string, url string) error {\n\n    // Get the data\n    resp, err := http.Get(url)\n    if err != nil {\n        return err\n    }\n    defer resp.Body.Close()\n\n    // Create the file\n    out, err := os.Create(filepath)\n    if err != nil {\n        return err\n    }\n    defer out.Close()\n\n    // Write the body to file\n    _, err = io.Copy(out, resp.Body)\n    return err\n}\n</code></pre>\n\n<p>but, go playgound not protocol(<a href=\"https://stackoverflow.com/questions/44727653/go-error-dial-tcp-protocol-not-available\">go error dial tcp: Protocol not available</a>).</p>\n\n<p>so, You have to do it PC.</p>\n"}], "owner": {"reputation": 3221, "user_id": 830230, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/YMFTp.jpg?s=128&g=1", "display_name": "Naguib Ihab", "link": "https://stackoverflow.com/users/830230/naguib-ihab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 0, "accepted_answer_id": 55015672, "answer_count": 1, "score": -3, "last_activity_date": 1551847111, "creation_date": 1551845855, "question_id": 55015491, "link": "https://stackoverflow.com/questions/55015491/cant-find-a-public-file-from-url-in-go", "title": "Can&#39;t find a public file from url in go", "body": "<p>I am trying to get the content of a publicly available file using <code>ioutil.ReadFile()</code> but it doesn't find the file: <code>panic: open http://www.pdf995.com/samples/pdf.pdf: No such file or directory\n</code></p>\n\n<p>Here's my code:</p>\n\n<pre><code>// Reading and writing files are basic tasks needed for\n// many Go programs. First we'll look at some examples of\n// reading files.\n\npackage main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n)\n\n// Reading files requires checking most calls for errors.\n// This helper will streamline our error checks below.\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\n\nfunc main() {\n    fileInUrl, err := ioutil.ReadFile(\"http://www.pdf995.com/samples/pdf.pdf\")\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"HERE --- fileInUrl: %+v\", fileInUrl)\n}\n</code></pre>\n\n<p>Here's a go playground example</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1192, "user_id": 1213186, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d9eabf15c471c4eb5158034e943711ce?s=128&d=identicon&r=PG", "display_name": "ddibiase", "link": "https://stackoverflow.com/users/1213186/ddibiase"}, "edited": false, "score": 0, "creation_date": 1551843918, "post_id": 55015033, "comment_id": 96784618, "body": "That was actually as easy as I thought it would be. Thanks a bunch."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1551843161, "last_edit_date": 1551843161, "creation_date": 1551842660, "answer_id": 55015033, "question_id": 55014907, "link": "https://stackoverflow.com/questions/55014907/golang-handling-situations-that-would-require-generic-types/55015033#55015033", "title": "Golang - Handling situations that would require generic types", "body": "<p>Use type <code>interface{}</code> for the message argument and Message field:</p>\n\n<pre><code>func sendError(code string, message interface{}, trace error, status int) (Response) {\n  body, err := json.Marshal(&amp;struct{\n    Code    string      `json:\"Code\"`\n    Message interface{} `json:\"Message\"`\n  }{\n    Code: code,\n    Message: message,\n  })\n  fmt.Println(trace)\n  if err != nil {\n    panic(\"Issue parsing an error msg?\")\n  }\n  return Response{\n    Body: string(body),\n    StatusCode: status,\n    Headers: map[string]string{\n      \"Content-Type\": \"application/json\",\n    },\n  }\n}\n</code></pre>\n\n<p>With this change, the application can call the function with a <code>string</code> or any other value that can be marshaled to JSON. For example, call it like this:'</p>\n\n<pre><code>err := account.Validate()\nif err != nil {\n  fmt.Println(err)\n  return sendError(\"VALIDATION_ERROR\", err, err, 400), nil\n}\n</code></pre>\n\n<p>(This snippet assumes that err marshals to JSON in a suitable way.  Based on info in the question, it looks like it does).</p>\n"}], "owner": {"reputation": 1192, "user_id": 1213186, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d9eabf15c471c4eb5158034e943711ce?s=128&d=identicon&r=PG", "display_name": "ddibiase", "link": "https://stackoverflow.com/users/1213186/ddibiase"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 55015033, "answer_count": 1, "score": 0, "last_activity_date": 1551881205, "creation_date": 1551841657, "last_edit_date": 1551881205, "question_id": 55014907, "link": "https://stackoverflow.com/questions/55014907/golang-handling-situations-that-would-require-generic-types", "title": "Golang - Handling situations that would require generic types", "body": "<p>I wrote a sendError handler for my API that will accept a string and return a response to my HTTP server. Here's the function:</p>\n\n<pre><code>func sendError(code string, message string, trace error, status int) (Response) {\n  body, err := json.Marshal(&amp;struct{\n    Code    string `json:\"Code\"`\n    Message string `json:\"Message\"`\n  }{\n    Code: code,\n    Message: message,\n  })\n  fmt.Println(trace)\n  if err != nil {\n    panic(\"Issue parsing an error msg?\")\n  }\n  return Response{\n    Body: string(body),\n    StatusCode: status,\n    Headers: map[string]string{\n      \"Content-Type\": \"application/json\",\n    },\n  }\n}\n</code></pre>\n\n<p>Pretty simple, right? However recently I've had to return more advanced message types. Basically a hashmap (or dictionary) of validation errors from my support library (<a href=\"https://godoc.org/github.com/go-ozzo/ozzo-validation#ValidateStruct\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/go-ozzo/ozzo-validation#ValidateStruct</a>). What I'm currently doing is:</p>\n\n<pre><code>err := account.Validate()\nif err != nil {\n  fmt.Println(err)\n  message, err := json.Marshal(err)\n  return sendError(\n    \"VALIDATION_ERROR\", string(message), err, 400,\n  ), nil\n}\n</code></pre>\n\n<p>However, as you can tell that will basically return a response similar to:</p>\n\n<pre><code>{\n    \"Code\": \"VALIDATION_ERROR\",\n    \"Message\": \"{\\\"Email\\\":\\\"must be a valid email address\\\"}\"\n}\n</code></pre>\n\n<p>The JSON that is marshaled is obviously serialized into the Message property in the response. I could easily add another parameter to handle a situation where a dictionary would be accepted and simply extend the error response to have the additional field (so it's all marshalled nearly). To make my sendError function more ergonomic and also to see if generics like this are possible. I'd like to change message to be a generic value ie. <code>interface{}</code> and on a conditional check decide to handle the dictionary or the string versions of the responses.</p>\n\n<p>What would be the best/most appropriate approach in this situation?</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "edited": false, "score": 0, "creation_date": 1551899848, "post_id": 55014220, "comment_id": 96813683, "body": "Just what I was looking for, thanks. I shouldn&#39;t have to worry about the top level value being anything else in my usecase, as they would all be invalid anyways."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 9, "last_activity_date": 1551890994, "last_edit_date": 1551890994, "creation_date": 1551836417, "answer_id": 55014220, "question_id": 55014001, "link": "https://stackoverflow.com/questions/55014001/check-if-json-is-object-or-array/55014220#55014220", "title": "Check if JSON is Object or Array", "body": "<p>Use the following the following to detect if JSON text in the <code>[]byte</code> value <code>data</code> is an array or object:</p>\n\n<pre><code> // Get slice of data with optional leading whitespace removed.\n // See RFC 7159, Section 2 for the definition of JSON whitespace.\n x := bytes.TrimLeft(data, \" \\t\\r\\n\")\n\n isArray := len(x) &gt; 0 &amp;&amp; x[0] == '['\n isObject := len(x) &gt; 0 &amp;&amp; x[0] == '{'\n</code></pre>\n\n<p>This snippet of code handles optional leading whitespace and is more efficient than unmarshalling the entire value.</p>\n\n<p>Because the top-level value in JSON can also be a  number, string, boolean or nil, it's possible that <code>isArray</code> and <code>isObject</code> both evaluate to false. The values <code>isArray</code> and <code>isObject</code> can also evaluate to false when the JSON is invalid. </p>\n"}, {"comments": [{"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1551848779, "post_id": 55014977, "comment_id": 96785811, "body": "I feel this is the best answer since the json is validated and it&#39;s simple and concise."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1551856201, "post_id": 55014977, "comment_id": 96788486, "body": "This is very inefficient."}, {"owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "edited": false, "score": 0, "creation_date": 1551899673, "post_id": 55014977, "comment_id": 96813601, "body": "That&#39;s what I thought about doing first, but it definitely is less efficient, especially given the use of reflection inside <code>Unmarshal</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "edited": false, "score": 1, "creation_date": 1551919027, "post_id": 55014977, "comment_id": 96821101, "body": "@robbieperry22 It is inefficient, but Unmarshal does not use reflection when unmarhsalling to <code>interface{}</code>."}], "tags": [], "owner": {"reputation": 49, "user_id": 11157421, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/bdc4dd1a97f7ff608e95942709e5f9ee?s=128&d=identicon&r=PG", "display_name": "user11157421", "link": "https://stackoverflow.com/users/11157421/user11157421"}, "is_accepted": false, "score": 4, "last_activity_date": 1551842263, "creation_date": 1551842263, "answer_id": 55014977, "question_id": 55014001, "link": "https://stackoverflow.com/questions/55014001/check-if-json-is-object-or-array/55014977#55014977", "title": "Check if JSON is Object or Array", "body": "<p>Use a type switch to determine the type.  This is similar to Xay's answer, but simpler:</p>\n\n<pre><code>var v interface{}\nif err := json.Unmarshal(data, &amp;v); err != nil {\n    // handle error\n}\nswitch v := v.(type) {\ncase []interface{}:\n    // it's an array\ncase map[string]interface{}:\n    // it's an object\ndefault:\n    // it's something else\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 4, "last_activity_date": 1608973147, "last_edit_date": 1608973147, "creation_date": 1551856146, "answer_id": 55017470, "question_id": 55014001, "link": "https://stackoverflow.com/questions/55014001/check-if-json-is-object-or-array/55017470#55017470", "title": "Check if JSON is Object or Array", "body": "<p>Do step-by-step parsing of your JSON, using <a href=\"https://golang.org/pkg/encoding/json/#Decoder\" rel=\"nofollow noreferrer\"><code>json.Decoder</code></a>. This has the advantage over the other answers of:</p>\n<ol>\n<li>Being more efficient than decoding the entire value</li>\n<li>Using the official JSON parsing rules, and generating standard errors if you get invalid input.</li>\n</ol>\n<p>Note, this code isn't tested, but should be enough to give you the idea. It can also be easily expanded to check for numbers, booleans, or strings, if desired.</p>\n<pre><code>func jsonType(in io.Reader) (string, error) {\n    dec := json.NewDecoder(in)\n    // Get just the first valid JSON token from input\n    t, err := dec.Token()\n    if err != nil {\n        return &quot;&quot;, err\n    }\n    if d, ok := t.(json.Delim); ok {\n        // The first token is a delimiter, so this is an array or an object\n        switch (d) {\n        case &quot;[&quot;:\n            return &quot;array&quot;, nil\n        case &quot;{&quot;:\n            return &quot;object&quot;, nil\n        default: // ] or }\n            return nil, errors.New(&quot;Unexpected delimiter&quot;)\n        }\n    }\n    return nil, errors.New(&quot;Input does not represent a JSON object or array&quot;)\n}\n</code></pre>\n<p>Note that this <em>consumed</em> the first few bytes of <code>in</code>. It is an exercise for the reader to make a copy, if necessary. If you're trying to read from a byte slice (<code>[]byte</code>), convert it to a reader first:</p>\n<pre><code>t, err := jsonType(bytes.NewReader(myValue))\n</code></pre>\n"}], "owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2629, "favorite_count": 0, "accepted_answer_id": 55014220, "answer_count": 3, "score": 6, "last_activity_date": 1608973147, "creation_date": 1551834593, "last_edit_date": 1551858231, "question_id": 55014001, "link": "https://stackoverflow.com/questions/55014001/check-if-json-is-object-or-array", "title": "Check if JSON is Object or Array", "body": "<p>Is there a simple way in Go to check whether given JSON is either an Object <code>{}</code> or array <code>[]</code>?</p>\n\n<p>The first thing that comes to mind is to <code>json.Unmarshal()</code> into an interface, and then see if it becomes a map, or a slice of maps. But that seems quite inefficient.</p>\n\n<p>Could I just check if the first byte is a <code>{</code> or a <code>[</code>? Or is there a better way of doing this that already exists.</p>\n"}, {"tags": ["performance", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1551816631, "post_id": 55010716, "comment_id": 96776354, "body": "<code>scanner.Text</code> requires a string conversion, so using <code>scanner.Bytes</code> instead and <code>bytes.Contains</code> instead of <code>string.Contains</code> might be faster. <code>fmt.Println</code> is also not the fastest, and as written involves doing the string conversion a second time. But generally speaking you should profile the code to find where you&#39;re losing speed."}, {"owner": {"reputation": 3062, "user_id": 555983, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d865de3bd3b3bee2806d92e08dd91205?s=128&d=identicon&r=PG", "display_name": "Nenad", "link": "https://stackoverflow.com/users/555983/nenad"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551816994, "post_id": 55010716, "comment_id": 96776535, "body": "removing the string conversions also doesn&#39;t help. if I have only a line counter <code>counter := 0  \tfor scanner.Scan() { \t\tcounter++ \t} </code> it doesn&#39;t get faster, only a little bit. So it seems that the bootle neck is scanner.Scan() but don&#39;t know how to improve this."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1551817295, "post_id": 55010716, "comment_id": 96776648, "body": "Have you tried setting a larger buffer? There&#39;s also no timing information in the code here, how are you running your program?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551821001, "post_id": 55010716, "comment_id": 96778356, "body": "Just to confirm, are you timing a built executable or are you timing <code>go run</code>?"}, {"owner": {"reputation": 3062, "user_id": 555983, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d865de3bd3b3bee2806d92e08dd91205?s=128&d=identicon&r=PG", "display_name": "Nenad", "link": "https://stackoverflow.com/users/555983/nenad"}, "edited": false, "score": 0, "creation_date": 1551821072, "post_id": 55010716, "comment_id": 96778385, "body": "time ./programname which gives <code>.&#47;programname  2.53s user 0.49s system 99% cpu 3.025 total</code>"}, {"owner": {"reputation": 423, "user_id": 8206705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1be032ba68741f45a5abf1c2c9df8b53?s=128&d=identicon&r=PG&f=1", "display_name": "H. Ross", "link": "https://stackoverflow.com/users/8206705/h-ross"}, "edited": false, "score": 0, "creation_date": 1551826055, "post_id": 55010716, "comment_id": 96780347, "body": "I have edited my answer to give a short run-time program that will match entire lines."}], "answers": [{"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1551818277, "post_id": 55011032, "comment_id": 96777087, "body": "Scanner is still running unparallelized and it&#39;s the slow part, it seems."}, {"owner": {"reputation": 4554, "user_id": 192221, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/38504ff52422b72b239a7b05ef0ccaae?s=128&d=identicon&r=PG", "display_name": "kristianp", "link": "https://stackoverflow.com/users/192221/kristianp"}, "edited": false, "score": 0, "creation_date": 1587963265, "post_id": 55011032, "comment_id": 108705948, "body": "I tried this, it was much slower than the original with 8 workers, 85 sec vs 2.2s for the original.  The scheduling overhead and copying to the buffer was greater than the processing done.  There&#39;s also a bug!  It should be <code>fmt.Println(text)</code>, not <code>fmt.Println(scanner.Text())</code>, otherwise it prints a different line to the one matched."}], "tags": [], "owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "is_accepted": false, "score": -3, "last_activity_date": 1551817691, "creation_date": 1551817691, "answer_id": 55011032, "question_id": 55010716, "link": "https://stackoverflow.com/questions/55010716/how-to-improve-the-speed-of-reading-a-large-file-line-by-line-in-go/55011032#55011032", "title": "How to improve the speed of reading a large file line by line in Go", "body": "<p>You might try using goroutines to process multiple lines in parallel:</p>\n\n<pre><code>lines := make(chan string, numWorkers * 2) // give the channel enough room to put lots of things in so the reader isn't blocked\n\ngo func(scanner *bufio.Scanner, out &lt;-chan string) {\n  for scanner.Scan() {\n    out &lt;- scanner.Text()\n  }\n  close(out)\n}(scanner, lines)\n\nvar wg sync.WaitGroup\nwg.Add(numWorkers)\n\nfor i := 0; i &lt; numWorkers; i++ {\n  go func(in chan&lt;- string) {\n    defer wg.Done()\n    for text := range in {\n      if strings.Contains(text, \"Iforgotmypassword\") {\n        fmt.Println(scanner.Text())\n      }\n    }\n  }(lines)\n}\n\nwg.Wait()\n</code></pre>\n\n<p>I'm not sure how much this will really speed things up as it depends on what kind of hardware you have available; it sounds like you're looking for a more than 5x speed improvement, so you might notice if you're running something that can support 8 parallel worker threads. Feel free to use <em>lots</em> of worker-goroutines. Good luck.</p>\n"}, {"comments": [{"owner": {"reputation": 3062, "user_id": 555983, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d865de3bd3b3bee2806d92e08dd91205?s=128&d=identicon&r=PG", "display_name": "Nenad", "link": "https://stackoverflow.com/users/555983/nenad"}, "edited": false, "score": 0, "creation_date": 1551822411, "post_id": 55012078, "comment_id": 96778946, "body": "This really does speed it up <code>.&#47;speed  0.35s user 0.49s system 99% cpu 0.845 total</code> a lot, but what I&#39;m trying to understand is where is the bootle neck when going line by line"}, {"owner": {"reputation": 3062, "user_id": 555983, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d865de3bd3b3bee2806d92e08dd91205?s=128&d=identicon&r=PG", "display_name": "Nenad", "link": "https://stackoverflow.com/users/555983/nenad"}, "edited": false, "score": 0, "creation_date": 1551823964, "post_id": 55012078, "comment_id": 96779544, "body": "Thanks for the exhaustive answer. Following this logic increasing the buffer to 1GB would make it equally fast, since everything would be in memory, but this doesn\u2019t seem to be the case. It still runs slower"}], "tags": [], "owner": {"reputation": 423, "user_id": 8206705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1be032ba68741f45a5abf1c2c9df8b53?s=128&d=identicon&r=PG&f=1", "display_name": "H. Ross", "link": "https://stackoverflow.com/users/8206705/h-ross"}, "is_accepted": true, "score": 3, "last_activity_date": 1551825798, "last_edit_date": 1551825798, "creation_date": 1551822193, "answer_id": 55012078, "question_id": 55010716, "link": "https://stackoverflow.com/questions/55010716/how-to-improve-the-speed-of-reading-a-large-file-line-by-line-in-go/55012078#55012078", "title": "How to improve the speed of reading a large file line by line in Go", "body": "<p><strong>LAST EDIT</strong></p>\n\n<p>This is a \"line-by-line\" solution to the problem that takes trivial time, it prints the entire matching line.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n    dat, _ := ioutil.ReadFile(\"./jumble.txt\")\n    i := bytes.Index(dat, []byte(\"Iforgotmypassword\"))\n    if i != -1 {\n        var x int\n        var y int\n        for x = i; x &gt; 0; x-- {\n            if dat[x] == byte('\\n') {\n                break\n            }\n        }\n        for y = i; y &lt; len(dat); y++ {\n            if dat[y] == byte('\\n') {\n                break\n            }\n        }\n        fmt.Println(string(dat[x : y+1]))\n    }\n}\n</code></pre>\n\n<pre><code>real    0m0.421s\nuser    0m0.068s\nsys     0m0.352s\n</code></pre>\n\n<hr>\n\n<p><strong>ORIGINAL ANSWER</strong></p>\n\n<p>If you just need to see if the string is in a file, why not use regex?</p>\n\n<p>Note: I kept the data as a byte array instead of converting to string. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"regexp\"\n)\n\nvar regex = regexp.MustCompile(`Ilostmypassword`)\n\nfunc main() {\n    dat, _ := ioutil.ReadFile(\"./jumble.txt\")\n    if regex.Match(dat) {\n        fmt.Println(\"Yes\")\n    }\n}\n</code></pre>\n\n<p><code>jumble.txt</code> is a 859 MB of jumbled text with newlines included.</p>\n\n<p>Running with <code>time ./code</code> I get:</p>\n\n<pre><code>real    0m0.405s\nuser    0m0.064s\nsys     0m0.340s\n</code></pre>\n\n<p><strike>\nTo try and answer your comment, I don't think the bottleneck is inherently coming from searching line by line, Golang uses an efficient algorithm for searching strings/runes.</p>\n\n<p>I think the bottleneck comes from the IO reads, when the program reads from the file, it is normally not first in line in the queue of reading, therefore, the program must wait until it can read in order to start actually comparing.  Thus, when you are reading in over and over, you are being forced to wait for your turn in IO.</p>\n\n<p>To give you some math, if your buffer size is 64 * 1024 (or 65535 bytes), and your file is 1 GB.  Dividing 1 GB / 65535 bytes is 15249 reads needed to check the entire file.  Where as in my method, I read the entire file \"at once\" and check against that constructed array.\n</strike></p>\n\n<p>Another thing I can think of is just the utter amount of loops needed to move through the file and the time needed for each loop:</p>\n\n<p>Given the following code:</p>\n\n<pre><code>dat, _ := ioutil.ReadFile(\"./jumble.txt\")\nsdat := bytes.Split(dat, []byte{'\\n'})\nfor _, l := range sdat {\n    if bytes.Equal([]byte(\"Iforgotmypassword\"), l) {\n        fmt.Println(\"Yes\")\n    }\n}\n</code></pre>\n\n<p>I calculated that each loop takes on average 32 nanoseconds, the string Iforgotmypassword was on line 100000000 in my file, thus the execution time for this loop was roughly 32 nanoseconds * 100000000 ~= 3.2 seconds.</p>\n"}, {"comments": [{"owner": {"reputation": 3062, "user_id": 555983, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d865de3bd3b3bee2806d92e08dd91205?s=128&d=identicon&r=PG", "display_name": "Nenad", "link": "https://stackoverflow.com/users/555983/nenad"}, "edited": false, "score": 0, "creation_date": 1551822785, "post_id": 55012140, "comment_id": 96779088, "body": "This is indeed fast and works, but I still don&#39;t understand why the line by line solution fails"}, {"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1551830866, "post_id": 55012140, "comment_id": 96781690, "body": "A line-by-line solution needs to check each byte once to see if it&#39;s a newline, break those bytes into chunks based on where the newlines are, and then check those chunks again against the string you&#39;re looking for. Since you&#39;ll consider any line to match if it <i>contains</i> the string you want, it&#39;s fine to just iterate once through the file, treating the whole thing like one big byte sequence."}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 1, "last_activity_date": 1551822549, "creation_date": 1551822549, "answer_id": 55012140, "question_id": 55010716, "link": "https://stackoverflow.com/questions/55010716/how-to-improve-the-speed-of-reading-a-large-file-line-by-line-in-go/55012140#55012140", "title": "How to improve the speed of reading a large file line by line in Go", "body": "<p>Using my own 700MB test file with your original, time was just over 7 seconds</p>\n\n<p>With grep it was 0.49 seconds</p>\n\n<p>With this program (which doesn't print out the line, it just says yes)\n0.082 seconds</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n)\n\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\nfunc main() {\n    find := []byte(os.Args[1])\n    dat, err := ioutil.ReadFile(\"crackstation-human-only.txt\")\n    check(err)\n    if bytes.Contains(dat, find) {\n        fmt.Print(\"yes\")\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4554, "user_id": 192221, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/38504ff52422b72b239a7b05ef0ccaae?s=128&d=identicon&r=PG", "display_name": "kristianp", "link": "https://stackoverflow.com/users/192221/kristianp"}, "is_accepted": false, "score": 1, "last_activity_date": 1588036070, "last_edit_date": 1588036070, "creation_date": 1587962287, "answer_id": 61451816, "question_id": 55010716, "link": "https://stackoverflow.com/questions/55010716/how-to-improve-the-speed-of-reading-a-large-file-line-by-line-in-go/61451816#61451816", "title": "How to improve the speed of reading a large file line by line in Go", "body": "<p>H. Ross' answer is awesome, but it reads the whole file into memory, which may not be feasible if your file is too big.  If you still want to scan line-by-line, perhaps if you're searching for multiple items, I found that using scanner.Bytes() instead of scanner.Text() improves speed slightly on my machine, from 2.244s for the original question, to 1.608s.  bufio's scanner.Bytes() method doesn't allocate any additional memory, whereas Text() creates a string from its buffer.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"bytes\"\n)\n\n// uses scanner.Bytes to avoid allocation.\nfunc main() {\n    f, err := os.Open(\"./crackstation-human-only.txt\")\n\n    scanner := bufio.NewScanner(f)\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n\n    toFind := []byte(\"Iforgotmypassword\")\n\n    for scanner.Scan() {\n        if bytes.Contains(scanner.Bytes(), toFind) {\n            fmt.Println(scanner.Text())\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3062, "user_id": 555983, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d865de3bd3b3bee2806d92e08dd91205?s=128&d=identicon&r=PG", "display_name": "Nenad", "link": "https://stackoverflow.com/users/555983/nenad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2386, "favorite_count": 1, "accepted_answer_id": 55012078, "answer_count": 4, "score": 2, "last_activity_date": 1588036070, "creation_date": 1551816391, "last_edit_date": 1551822914, "question_id": 55010716, "link": "https://stackoverflow.com/questions/55010716/how-to-improve-the-speed-of-reading-a-large-file-line-by-line-in-go", "title": "How to improve the speed of reading a large file line by line in Go", "body": "<p>I'm trying to figure out the most fastest way of reading a large file line by line and checking if the line contains a string. The file I'm testing on is about 680mb large</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    package main\n\n    import (\n        \"bufio\"\n        \"fmt\"\n        \"os\"\n        \"strings\"\n    )\n\n    func main() {\n        f, err := os.Open(\"./crackstation-human-only.txt\")\n\n        scanner := bufio.NewScanner(f)\n        if err != nil {\n            panic(err)\n        }\n        defer f.Close()\n\n        for scanner.Scan() {\n            if strings.Contains(scanner.Text(), \"Iforgotmypassword\") {\n                fmt.Println(scanner.Text())\n            }\n        }\n    }\n</code></pre>\n\n<p>After building the program and timing it on my machine it runs over 3 seconds\n<code>./speed  3.13s user 1.25s system 122% cpu 3.563 total</code></p>\n\n<p>After increasing the buffer</p>\n\n<pre><code>buf := make([]byte, 64*1024)\nscanner.Buffer(buf, bufio.MaxScanTokenSize)\n</code></pre>\n\n<p>It gets a little better\n<code>./speed  2.47s user 0.25s system 104% cpu 2.609 total</code></p>\n\n<p>I know it can get better because other tools mange to do it under a second without any kind of indexing. What seems to be the bottleneck with this approach?</p>\n\n<p><code>0.33s user 0.14s system 94% cpu 0.501 total</code></p>\n"}, {"tags": ["go", "oauth", "oauth-2.0", "godoc"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1551815671, "creation_date": 1551815671, "answer_id": 55010549, "question_id": 55010207, "link": "https://stackoverflow.com/questions/55010207/how-to-properly-read-errors-from-golang-oauth2/55010549#55010549", "title": "How to properly read errors from golang oauth2", "body": "<p>The expression:</p>\n\n<pre><code>(*RetrieveError)(rErr)\n</code></pre>\n\n<p>converts the<code>rErr</code>'s type from <code>*internal.RetrieveError</code> to <code>*RetrieveError</code>. And since <code>RetrieveError</code> is declared in the <code>oauth2</code> package, you can <em>type assert</em> the error you receive to <a href=\"https://github.com/golang/oauth2/blob/80673b4a4bfc6c2c58a0b44cf9106913fe293994/token.go#L169\" rel=\"nofollow noreferrer\"><code>*oauth2.RetrieveError</code></a> to get the details. The details are contained in that type's Body field as a slice of bytes.</p>\n\n<p>Since a slice of bytes is not the best format to be inspected and in your case it seems like the bytes contain a json object you can make your life easier by predefining a type into which you can unmarshal those details.</p>\n\n<p>That is:</p>\n\n<pre><code>type ErrorDetails struct {\n    Error            string `json:\"error\"`\n    ErrorDescription string `json:\"error_description\"`\n}\n\ntoken, err := googleOauthConfig.Exchange(context.Background(), code)\nif err != nil {\n    fmt.Fprintf(w, \"Err: %+v\", err)\n\n    if rErr, ok := err.(*oauth2.RetrieveError); ok {\n        details := new(ErrorDetails)\n        if err := json.Unmarshal(rErr.Body, details); err != nil {\n            panic(err)\n        }\n\n        fmt.Println(details.Error, details.ErrorDescription)\n    }        \n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5544754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed049ae046807adbefbb62664576b6b6?s=128&d=identicon&r=PG&f=1", "display_name": "chaegumi", "link": "https://stackoverflow.com/users/5544754/chaegumi"}, "is_accepted": false, "score": 0, "last_activity_date": 1562140400, "creation_date": 1562140400, "answer_id": 56865423, "question_id": 55010207, "link": "https://stackoverflow.com/questions/55010207/how-to-properly-read-errors-from-golang-oauth2/56865423#56865423", "title": "How to properly read errors from golang oauth2", "body": "<p>Can do like this.</p>\n\n<pre><code>\narr := strings.Split(err.Error(), \"\\n\")\n        str := strings.Replace(arr[1], \"Response: \", \"\", 1)\n        var details ErrorDetails\n        var json = jsoniter.ConfigCompatibleWithStandardLibrary\n\n        err := json.Unmarshal([]byte(str), &amp;details)\n        if err == nil {\n            beego.Debug(details.Error)\n            beego.Debug(details.ErrorDescription)\n        }\n\n</code></pre>\n"}], "owner": {"reputation": 458, "user_id": 3066874, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/M5PLK.png?s=128&g=1", "display_name": "Chemdream", "link": "https://stackoverflow.com/users/3066874/chemdream"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 55010549, "answer_count": 2, "score": 1, "last_activity_date": 1562140400, "creation_date": 1551814282, "question_id": 55010207, "link": "https://stackoverflow.com/questions/55010207/how-to-properly-read-errors-from-golang-oauth2", "title": "How to properly read errors from golang oauth2", "body": "<pre><code>token, err := googleOauthConfig.Exchange(context.Background(), code)\nif err != nil {\n fmt.Fprintf(w, \"Err: %+v\", err)\n}\n</code></pre>\n\n<p>The output of the fprintf is:</p>\n\n<pre><code>Err: oauth2: cannot fetch token: 401 Unauthorized\nResponse: {\"error\":\"code_already_used\",\"error_description\":\"code_already_used\"}\n</code></pre>\n\n<p>I want to check if \"error\" = \"code_already_used\". For the life of me, I can't sort out how.</p>\n\n<p><strong>How do I check/return/read \"error\" or \"error_description\" of err?</strong></p>\n\n<p>I've looked at the oauth2 code and it's a bit above me.</p>\n\n<pre><code>// retrieveToken takes a *Config and uses that to retrieve an *internal.Token.\n// This token is then mapped from *internal.Token into an *oauth2.Token which is returned along\n// with an error..\nfunc retrieveToken(ctx context.Context, c *Config, v url.Values) (*Token, error) {\n    tk, err := internal.RetrieveToken(ctx, c.ClientID, c.ClientSecret, c.Endpoint.TokenURL, v)\n    if err != nil {\n        if rErr, ok := err.(*internal.RetrieveError); ok {\n            return nil, (*RetrieveError)(rErr)\n        }\n        return nil, err\n    }\n    return tokenFromInternal(tk), nil\n}\n</code></pre>\n\n<p>How guess I'm trying to see the (*RetrieveError) part. Right?</p>\n\n<p>THANK YOU!</p>\n"}, {"tags": ["go", "libphonenumber"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1551813694, "post_id": 55010028, "comment_id": 96775069, "body": "You&#39;re not writing syntactically valid Go."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1551813848, "post_id": 55010028, "comment_id": 96775128, "body": "Most basic syntax questions are answered within the <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">Tour of Go</a> which only takes a few minutes to finish."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1551813880, "post_id": 55010028, "comment_id": 96775140, "body": "It looks like this is a machine-generated port of a Java library, complete with Java examples. This is why it&#39;s not working--you&#39;re trying to write Java in Go."}, {"owner": {"reputation": 135, "user_id": 6746717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Y_vxMHCybSk/AAAAAAAAAAI/AAAAAAAAAFU/2oZypfKPxSU/photo.jpg?sz=128", "display_name": "Ilie Soltanici", "link": "https://stackoverflow.com/users/6746717/ilie-soltanici"}, "edited": false, "score": 0, "creation_date": 1551814481, "post_id": 55010028, "comment_id": 96775413, "body": "I understand that the syntax is not valid for golang, but this is what i found in library documentation: <a href=\"https://godoc.org/github.com/nyaruka/phonenumbers\" rel=\"nofollow noreferrer\">godoc.org/github.com/nyaruka/phonenumbers</a>, i&#39;m just beginner in golang that&#39;s why i was thinking that maybe i&#39;m missing something."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1551814528, "post_id": 55010028, "comment_id": 96775439, "body": "So what is your question? You seem to be asking why that code doesn&#39;t work."}], "answers": [{"tags": [], "owner": {"reputation": 135, "user_id": 6746717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Y_vxMHCybSk/AAAAAAAAAAI/AAAAAAAAAFU/2oZypfKPxSU/photo.jpg?sz=128", "display_name": "Ilie Soltanici", "link": "https://stackoverflow.com/users/6746717/ilie-soltanici"}, "is_accepted": true, "score": 2, "last_activity_date": 1551816571, "creation_date": 1551816571, "answer_id": 55010766, "question_id": 55010028, "link": "https://stackoverflow.com/questions/55010028/golang-libphonenumber/55010766#55010766", "title": "Golang libphonenumber", "body": "<p>The answer which I was looking is how to get the country code by passing the phone number only, this is the solution which is working perfectly.</p>\n\n<pre><code>num, err := phonenumbers.Parse(\"+123456789\", \"\")\n\nif err != nil {\n    fmt.Println(err.Error())\n}\n\nregionNumber := phonenumbers.GetRegionCodeForNumber(num)\ncountryCode := phonenumbers.GetCountryCodeForRegion(regionNumber)\nfmt.Println(countryCode)\n</code></pre>\n\n<p>Thank you Yacacov for the hint ;)</p>\n"}], "owner": {"reputation": 135, "user_id": 6746717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Y_vxMHCybSk/AAAAAAAAAAI/AAAAAAAAAFU/2oZypfKPxSU/photo.jpg?sz=128", "display_name": "Ilie Soltanici", "link": "https://stackoverflow.com/users/6746717/ilie-soltanici"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1689, "favorite_count": 1, "closed_date": 1551819881, "accepted_answer_id": 55010766, "answer_count": 1, "score": -7, "last_activity_date": 1551816622, "creation_date": 1551813558, "last_edit_date": 1551816622, "question_id": 55010028, "link": "https://stackoverflow.com/questions/55010028/golang-libphonenumber", "closed_reason": "Not suitable for this site", "title": "Golang libphonenumber", "body": "<p>How can I get the country code number by passing the number in golang by using this library:\n<a href=\"https://godoc.org/github.com/nyaruka/phonenumbers\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/nyaruka/phonenumbers</a>?</p>\n"}, {"tags": ["go", "google-api"], "answers": [{"tags": [], "owner": {"reputation": 1136, "user_id": 797369, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6a84e973e72f2d972dd1498c1604ffee?s=128&d=identicon&r=PG", "display_name": "Vetras", "link": "https://stackoverflow.com/users/797369/vetras"}, "is_accepted": false, "score": 0, "last_activity_date": 1551812438, "last_edit_date": 1551812438, "creation_date": 1551812089, "answer_id": 55009677, "question_id": 55009409, "link": "https://stackoverflow.com/questions/55009409/how-can-i-let-others-read-and-edit-a-google-sheet-not-shared-with-them-using-g/55009677#55009677", "title": "How can I let others read and edit a google sheet (not shared with them) using googleapi, without them having to download credential?", "body": "<p>What i think you need is to integrate your go app with Oauth protocol.\nMore specifically, with the Google provider.</p>\n\n<p>This is mainly 3 steps:</p>\n\n<ol>\n<li><p>add the oauth client to your application</p>\n\n<p>something like this: <a href=\"https://github.com/golang/oauth2\" rel=\"nofollow noreferrer\">https://github.com/golang/oauth2</a></p>\n\n<p>See their docs on how to do it.</p></li>\n<li><p>go to google dev documentation and see how to integrate google auth flow into the client: <a href=\"https://developers.google.com/identity/protocols/OAuth2\" rel=\"nofollow noreferrer\">https://developers.google.com/identity/protocols/OAuth2</a></p>\n\n<p>I'm not sure if google has something more specific for google drive integration and/or go-lang client in particular. Please do some searching.</p></li>\n<li><p>make the glue code on your go app so that the user can interact with this (the login button (or command, if it is terminal based), error messages, logout, etc)</p></li>\n</ol>\n\n<p>More questions will appear when you start to do this, however it is a great example to learn Oauth as well.</p>\n\n<p>General guidelines:</p>\n\n<ul>\n<li>https all the queries or oauth is basically useless</li>\n<li>oatuh has many auth-flows and you must choose which one(s) you support. use whatever google documentation recommends for m2m scenario (machine 2 machine)</li>\n<li>log errors so that your friends can send you a log file for you to debug issues</li>\n<li>maybe set some feature flag so that you can simply disable this feature to run/test localhost ? maybe useful? you decide. </li>\n</ul>\n"}], "owner": {"reputation": 1, "user_id": 11155682, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-pIPiDftTp8o/AAAAAAAAAAI/AAAAAAAABpw/kV_G-zbQ6yc/photo.jpg?sz=128", "display_name": "Zyztem", "link": "https://stackoverflow.com/users/11155682/zyztem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1551812438, "creation_date": 1551810935, "question_id": 55009409, "link": "https://stackoverflow.com/questions/55009409/how-can-i-let-others-read-and-edit-a-google-sheet-not-shared-with-them-using-g", "title": "How can I let others read and edit a google sheet (not shared with them) using googleapi, without them having to download credential?", "body": "<p>I am a beginner trying out api for fun.</p>\n\n<p>The problem is, lets say, I want to write a simple windows program with golang to let my friends read and edit one of the sheets saved on my google drive. How can I do this without having them download a credential file?</p>\n\n<p>What I want it to do is simply redirect them to the Oauth Page right away, and if their email address is one recognized by the app it will grant them access to that google sheet.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1551811894, "post_id": 55007810, "comment_id": 96774255, "body": "You&#39;re setting the <code>FPApiResponse</code> value as the <code>Body</code> and <code>Head</code> of the <code>FPApiSuccess</code> value. Both of those two structs expect a head+body json object. So for it to unmarshal into these values the json you receive would have to actually be a nested version of the one you&#39;re expecting, ie <a href=\"https://play.golang.com/p/J7kmSEspguO\" rel=\"nofollow noreferrer\">play.golang.com/p/J7kmSEspguO</a>"}, {"owner": {"reputation": 4986, "user_id": 4763988, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/99abed3bcb05d0b736fa03034ba5aadd?s=128&d=identicon&r=PG&f=1", "display_name": "Kannaj", "link": "https://stackoverflow.com/users/4763988/kannaj"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1551814157, "post_id": 55007810, "comment_id": 96775267, "body": "@mkopriva - you&#39;re right , i split the structs into 2 (head and body) and sending them both like so <code>responseData := FPApiSuccess{Head: headResponse, Body: bodyResponse}</code> - this seemed to do the trick"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 3, "creation_date": 1551814653, "post_id": 55007810, "comment_id": 96775491, "body": "@Kannaj: Just a tip, given that you&#39;re new to golang: avoid using the <code>interface{}</code> type too much. Consider it a necessary evil, if nothing else. <code>interface{}</code> is good for some things, but the moment you <i>know</i> what data you&#39;re dealing with, use a specific type instead"}, {"owner": {"reputation": 4986, "user_id": 4763988, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/99abed3bcb05d0b736fa03034ba5aadd?s=128&d=identicon&r=PG&f=1", "display_name": "Kannaj", "link": "https://stackoverflow.com/users/4763988/kannaj"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1551816441, "post_id": 55007810, "comment_id": 96776263, "body": "@EliasVanOotegem - understood , thank you. I can already forsee the pain it would cause :)"}], "owner": {"reputation": 4986, "user_id": 4763988, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/99abed3bcb05d0b736fa03034ba5aadd?s=128&d=identicon&r=PG&f=1", "display_name": "Kannaj", "link": "https://stackoverflow.com/users/4763988/kannaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1106, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1559047938, "creation_date": 1551804666, "last_edit_date": 1559047938, "question_id": 55007810, "link": "https://stackoverflow.com/questions/55007810/managing-multiple-return-types-in-golang", "title": "Managing multiple return types in Golang", "body": "<p>I'm a bit new to Go and I'm having trouble converting a response object from an API call into different structures based on the request type</p>\n\n<p>Essentially, I have one func which sends out a request</p>\n\n<pre><code>func (fpc *FPClient) request(path string, method string, params interface{}, Token string, response interface{}) *dto.AppError {\n    client := &amp;http.Client{\n        Timeout: time.Second * 15,\n    }\n    requestBody, err := json.Marshal(params)\n    if err != nil {\n         //\n    }\n\n    req, _ := http.NewRequest(method, path, bytes.NewBuffer(requestBody))\n    req.Header.Set(\"Content-Type\", \"application/json\")\n    req.Header.Set(\"Cookie\", fmt.Sprintf(\"cookie=%s;\", Token))\n    req.SetBasicAuth(fpc.username, fpc.password)\n    resp, err := client.Do(req)\n\n    if err != nil {\n        // \n    }\n    body, err := ioutil.ReadAll(resp.Body)\n\n    if err != nil {\n       //\n    }\n    if FPErr := fpc.processErrors(resp, body); FPerr != nil {\n        return FPErr\n    }\n\n    responseData := FPApiSuccess{Head: response, Body: response}\n    if err := json.Unmarshal(body, &amp;responseData); err != nil {\n       //\n    }\n    fmt.Printf(\"\\n\\n client Response : \\n %+v \\n\", responseData.Body)\n    return nil\n}\n</code></pre>\n\n<p>The struct for <code>FPApiSuccess</code> is:</p>\n\n<pre><code>type FPApiSuccess struct {\n    Body interface{} `json:\"body\"`\n    Head interface{} `json:\"head\"`\n}\n</code></pre>\n\n<p>Right now, there are 2 calling functions and the API response expected is a bit different for both</p>\n\n<p>Both API responses have the below structure </p>\n\n<pre><code>{\n    \"head\": {},\n    \"body\": {}\n}\n</code></pre>\n\n<p>However, the nested details in each key is different based on the API used.</p>\n\n<p>I want to capture the <code>head</code> and <code>body</code> keys in a struct argument I give and send it back to the calling function. The <code>response</code> argument in the <code>request</code> function is a different struct type based on the calling function.</p>\n\n<p>I'm unable to get this to work - I'm only getting back a blank struct from the <code>request</code> function. This is the <code>fmt.PrintF</code> log</p>\n\n<pre><code> client Response : \n &amp;{Body:{BOrderID:0 CC: Exch: EOID: Type: Local:0 Message: } Head:{ResponseCode: Status: StatusDescription:}} \n</code></pre>\n\n<p>This is an empty struct - ideally, it should be populated with the values retrieved from the API.</p>\n\n<p>For reference, heres the struct passed as an argument as <code>response</code> in the request function:</p>\n\n<pre><code>   type FPApiResponse struct {\n        Body FPBodyResponse `json:\"body\"`\n        Head FPHeadResponse `json:\"head\"`\n    }\n\n    type FPHeadResponse struct {\n        ResponseCode      string `json:\"responseCode\"`\n        Status            string `json:\"status\"`\n        StatusDescription string `json:\"statusDescription\"`\n    }\n\n    type FPBodyResponse struct {\n        BOrderID   int    `json:\"BOrderID\"`\n        CC      string `json:\"CC\"`\n        Exch            string `json:\"Exch\"`\n        EOID     string `json:\"EOID\"`\n        Type        string `json:\"Type\"`\n        Local    int    `json:\"Local\"`\n        Message         string `json:\"Message\"`\n    }\n</code></pre>\n\n<h2>Update</h2>\n\n<p>So I did this; instead of</p>\n\n<pre><code>responseData := FPApiSuccess{Head: response, Body: response}\n</code></pre>\n\n<p>I did this</p>\n\n<pre><code>responseData := fivePaisaApiSuccess{}\n</code></pre>\n\n<p>So now, I get the below in console</p>\n\n<pre><code> Client Response : \n {Body:map[BOrderID:0 CC:52715111 Type:D Local:0 Message:Invalid Session ] Head:map[responseCode:5POrdReq status:0 statusDescription:Success]} \n</code></pre>\n\n<p>So essentially, this works, but the calling function doesn't seem to get the proper response:</p>\n\n<p>Here's the calling function</p>\n\n<pre><code>func (fpc *FPClient) PlaceOrder(orderParams dto.OrderBodyParams, variety string, Token string) (string, *dto.AppError) {\n    var result FPApiResponse\n\n    headParams := dto.FFPOrderHeadParams{\n      //\n    }\n    FPOrderParams := dto.FPOrderParams{\n       //\n    }\n    FPErr := fpc.request(FPURL+FPPlaceOrder, http.MethodPost, FPOrderParams, brokerAccessToken, &amp;result)\n    if FPErr != nil {\n        return \"\", FPErr\n    }\n    fmt.Printf(\"\\n\\n Client result : \\n %+v \\n\", result)\n    if result.Head.Status != \"0\" {\n       //\n    }\n\n    if result.Body.Status != 0 {\n      //\n    }\n    return strconv.Itoa(result.Body.Broker), nil\n}\n</code></pre>\n\n<p>The <code>result</code> value is blank:</p>\n\n<pre><code> {Body:{BOId:0 CC: Exch: Type: Local:0 Message: Status:0} Head:{ResponseCode: Status: StatusDescription:}}\n</code></pre>\n\n<p>I don't understand, this pointer is getting populated in the request function</p>\n\n<p>Here's the struct I'm passing to the request:</p>\n\n<pre><code>type FPApiResponse struct {\n    Body FPBodyResponse `json:\"body\"`\n    Head FPHeadResponse `json:\"head\"`\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 1, "creation_date": 1551800720, "post_id": 55006537, "comment_id": 96768278, "body": "go has the json package wich deals with json"}, {"owner": {"reputation": 49, "user_id": 10902456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4ada65b0e620d80482863a71d48da40?s=128&d=identicon&r=PG&f=1", "display_name": "shtb2708", "link": "https://stackoverflow.com/users/10902456/shtb2708"}, "reply_to_user": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1551801197, "post_id": 55006537, "comment_id": 96768620, "body": "@Pizzalord can you be more precise please ?"}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1551801310, "post_id": 55006537, "comment_id": 96768685, "body": "just google golang json the package and its documentation will be the first result. i do not know how you did not find it"}, {"owner": {"reputation": 49, "user_id": 10902456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4ada65b0e620d80482863a71d48da40?s=128&d=identicon&r=PG&f=1", "display_name": "shtb2708", "link": "https://stackoverflow.com/users/10902456/shtb2708"}, "reply_to_user": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1551801582, "post_id": 55006537, "comment_id": 96768838, "body": "I found this doc, but If I asked the question here with details, it&#39;s I need help to understand what I missed in this information @Pizzalord"}], "answers": [{"tags": [], "owner": {"reputation": 99, "user_id": 6172092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bd310f2c921ed8e0e8a5e8447c3ca7a?s=128&d=identicon&r=PG", "display_name": "SubXaero", "link": "https://stackoverflow.com/users/6172092/subxaero"}, "is_accepted": true, "score": 1, "last_activity_date": 1551802018, "creation_date": 1551802018, "answer_id": 55006979, "question_id": 55006537, "link": "https://stackoverflow.com/questions/55006537/how-we-can-read-a-json-file-with-go-programming-language/55006979#55006979", "title": "How we can read a JSON file with Go Programming Language?", "body": "<p>Presuming that the file contains dynamic and unknown keys and values, and you cannot model them in your application. Then you can do something like:</p>\n\n<pre><code>\nfunc main() {\n    if os.Args[1] == \"update-json-from-json\" {\n        ...\n        jsonFile := readInput()\n\n        var jsonKeys interface{}\n        err := json.Unmarshal(jsonFile, &amp;jsonKeys)\n        functions.Check(err)\n\n\n        ...\n    }\n}\n</code></pre>\n\n<p>to load the contents into the <code>empty interface</code>, and then use the go reflection library (<a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/reflect/</a>) to iterate over the fields, find their names and values and update them according to your needs.</p>\n\n<p>The alternative is to Unmarshal into a <code>map[string]string</code>, but that won't cope very well with nested JSON, whereas this might (but I haven't tested it).</p>\n"}], "owner": {"reputation": 49, "user_id": 10902456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4ada65b0e620d80482863a71d48da40?s=128&d=identicon&r=PG&f=1", "display_name": "shtb2708", "link": "https://stackoverflow.com/users/10902456/shtb2708"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "accepted_answer_id": 55006979, "answer_count": 1, "score": 0, "last_activity_date": 1551802018, "creation_date": 1551800622, "question_id": 55006537, "link": "https://stackoverflow.com/questions/55006537/how-we-can-read-a-json-file-with-go-programming-language", "title": "How we can read a JSON file with Go Programming Language?", "body": "<p>I'm working on a translation project on my Angular app. I already create all the different keys for that. I try now to use Go Programming Language to add some functionalities in my translation, to work quickly after.</p>\n\n<p>I try to code a function in Go Programming Language in order to read an input user on the command line. I need to read this input file in order to know if there is missing key inside. This input user must be a JSON file. I have a problem with this function, is blocked at <code>functions.Check(err)</code>, in order to debug my function I displayed the different variable with <code>fmt.Printf(variable to display)</code>.\nI call this function <code>readInput()</code> in my main function.</p>\n\n<p>The <code>readInput()</code> function is the following : </p>\n\n<pre><code>    // this function is used to read the user's input on the command line\nfunc readInput() string {\n    // we create a reader\n    reader := bufio.NewReader(os.Stdin)\n    // we read the user's input\n    answer, err := reader.ReadString('\\n')\n    // we check if any errors have occured while reading\n    functions.Check(err)\n    // we trim the \"\\n\" from the answer to only keep the string input by the user\n    answer = strings.Trim(answer, \"\\n\")\n    return answer\n}\n</code></pre>\n\n<p>In my main function I call <code>readInput()</code> for a specific command I created. This command line is usefull to update a JSON file and add a missing key automatically.</p>\n\n<p>My <code>func main</code> is :</p>\n\n<pre><code>      func main() { \n        if os.Args[1] == \"update-json-from-json\" {\n\n    fmt.Printf(\"please enter the name of the json file that will be used to \n    update the json file:\") \n    jsonFile := readInput()\n\n    fmt.Printf(\"please enter the ISO code of the locale for which you want to update the json file: \")\n            // we read the user's input\n            locale := readInput()\n            // we launch the script\n            scripts.AddMissingKeysToJsonFromJson(jsonFile, locale)\n        }\n</code></pre>\n\n<p>I can give you the command line I use for this code <code>go run mis-t.go update-json-from-json</code></p>\n\n<p>Do you what I'm missing in my code please ?</p>\n"}, {"tags": ["go", "redis", "cluster-computing"], "comments": [{"owner": {"reputation": 3571, "user_id": 509710, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/26657e1c0499c82de77884bfce4fe41b?s=128&d=identicon&r=PG", "display_name": "TheDude", "link": "https://stackoverflow.com/users/509710/thedude"}, "edited": false, "score": 0, "creation_date": 1551800494, "post_id": 55006221, "comment_id": 96768114, "body": "I would imagine since its the current servers time, you would get the time of the machine in the cluster the command hits"}, {"owner": {"reputation": 53, "user_id": 5497296, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GnyH5.pngs?s=128&g=1", "display_name": "AmirSo", "link": "https://stackoverflow.com/users/5497296/amirso"}, "reply_to_user": {"reputation": 3571, "user_id": 509710, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/26657e1c0499c82de77884bfce4fe41b?s=128&d=identicon&r=PG", "display_name": "TheDude", "link": "https://stackoverflow.com/users/509710/thedude"}, "edited": false, "score": 0, "creation_date": 1551800670, "post_id": 55006221, "comment_id": 96768243, "body": "Which server? I have 20 master nodes and other ..."}, {"owner": {"reputation": 365, "user_id": 1416660, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XXT2N.jpg?s=128&g=1", "display_name": "ganapathydselva", "link": "https://stackoverflow.com/users/1416660/ganapathydselva"}, "edited": false, "score": 0, "creation_date": 1551821678, "post_id": 55006221, "comment_id": 96778622, "body": "do u have separate time zone for each node?"}, {"owner": {"reputation": 53, "user_id": 5497296, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GnyH5.pngs?s=128&g=1", "display_name": "AmirSo", "link": "https://stackoverflow.com/users/5497296/amirso"}, "edited": false, "score": 0, "creation_date": 1551857554, "post_id": 55006221, "comment_id": 96789100, "body": "No, same time zone, But It&#39;s important that the time difference is less than 10ms"}], "answers": [{"tags": [], "owner": {"reputation": 53, "user_id": 5497296, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GnyH5.pngs?s=128&g=1", "display_name": "AmirSo", "link": "https://stackoverflow.com/users/5497296/amirso"}, "is_accepted": true, "score": 0, "last_activity_date": 1605985738, "last_edit_date": 1605985738, "creation_date": 1551857797, "answer_id": 55017849, "question_id": 55006221, "link": "https://stackoverflow.com/questions/55006221/redis-time-command-in-cluster-mode/55017849#55017849", "title": "Redis `TIME` Command in Cluster Mode", "body": "<p>I found the answer, I need to use synchronize time between servers and I thought to use <code>Redis **TIME** Command</code>, but now after some research, I think NTP can resolve my problem.</p>\n<blockquote>\n<p>A time difference of less than 128ms between server and client is\nrequired to maintain NTP synchronization. The typical accuracy on the\nInternet ranges from about 5ms to 100ms, possibly varying with network\ndelays</p>\n</blockquote>\n"}], "owner": {"reputation": 53, "user_id": 5497296, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GnyH5.pngs?s=128&g=1", "display_name": "AmirSo", "link": "https://stackoverflow.com/users/5497296/amirso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 55017849, "answer_count": 1, "score": 1, "last_activity_date": 1605985738, "creation_date": 1551799645, "question_id": 55006221, "link": "https://stackoverflow.com/questions/55006221/redis-time-command-in-cluster-mode", "title": "Redis `TIME` Command in Cluster Mode", "body": "<p>I need to use <code>TIME Command</code> in Redis, but I\u2019m in the Cluster mode. Now my question is that, what is the source of the Time which I get from the system\u2019s response in Cluster mode ?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "struct", "lua", "cgo", "panic"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551802956, "post_id": 55006117, "comment_id": 96769621, "body": "I believe the error is referring to <code>myvar</code> itself, which is allocated on the Go heap, therefor <code>&amp;myvar</code> is a go pointer which is candidate for garbage collection.  If there is no other Go code referencing the <code>myvar</code> value, the you can&#39;t guarantee the memory we remain allocated. (however unlikely garbage collection of the global value is, the cgo checks always err on the side of caution)"}, {"owner": {"reputation": 1, "user_id": 6256469, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2zfIC.png?s=128&g=1", "display_name": "Lionel", "link": "https://stackoverflow.com/users/6256469/lionel"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551811014, "post_id": 55006117, "comment_id": 96773830, "body": "That was my first thought, but same code actually works if I remove char* mystring (or any pointer) from the struct. It seems I can workaround by allocating the struct myself with C.malloc, but then I&#39;ve to manually compute the size of the struct."}], "owner": {"reputation": 1, "user_id": 6256469, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2zfIC.png?s=128&g=1", "display_name": "Lionel", "link": "https://stackoverflow.com/users/6256469/lionel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 304, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1551799312, "creation_date": 1551799312, "question_id": 55006117, "link": "https://stackoverflow.com/questions/55006117/cgo-panic-when-return-pointer-to-c-struct-that-contains-a-pointer", "title": "cgo panic when return pointer to C struct that contains a pointer", "body": "<p>I'm trying to build a small library written on Go for use with luajit. I can properly get what I want, until the struct which I return a pointer to contains pointers itself.</p>\n\n<p>Go source:</p>\n\n<pre><code>package main\n//typedef struct {\n//  int     myint;\n//  double  mydouble;\n//  char*   mystring;\n//} mystruct;\nimport \"C\"\nimport \"fmt\"\nvar myvar  C.mystruct\n//export Init\nfunc Init() {\n    myvar.myint     = 1\n    myvar.mydouble  = 2.0\n    myvar.mystring  = C.CString(\"three\")\n    fmt.Println(\"myvar in go  : \", myvar.myint, myvar.mydouble, myvar.mystring)\n}\n//export GetVar\nfunc GetVar() *C.mystruct {\n    return &amp;myvar\n}\nfunc main () {}\n</code></pre>\n\n<p>Lua source:</p>\n\n<pre><code>#! /usr/bin/luajit\nlocal ffi   = require(\"ffi\")\nlocal go    = ffi.load(\"./golua.lib\")\nffi.cdef[[\ntypedef struct {\n    int     myint;\n    double  mydouble;\n    char*   mystring;\n} mystruct;\nextern void Init();\nextern mystruct* GetVar();\n]]\ngo.Init()\nlocal var = go.GetVar()\nprint(\"myvar in lua : \", var.myint, var.mydouble, ffi.string(var.mystring))\n</code></pre>\n\n<p>Got this at runtime:</p>\n\n<pre><code>lionel@pc-lionel:~/go/src/tests/lua$ go build -buildmode=c-shared -o golua.lib *.go\nlionel@pc-lionel:~/go/src/tests/lua$ ./gotest.lua \nmyvar in go  :  1 2 0x55c17f41c360\npanic: runtime error: cgo result has Go pointer\n\ngoroutine 17 [running, locked to thread]:\nmain._cgoexpwrap_86693eaa8e33_GetVar.func1(0xc420056ea8)\n    _cgo_gotypes.go:95 +0x3c\nmain._cgoexpwrap_86693eaa8e33_GetVar(0x7ff15cccac60)\n    _cgo_gotypes.go:97 +0x5b\nAbandon (core dumped)\n</code></pre>\n\n<p>Note that the type of pointer does not matter, could be int* or whatever, it panics same way. I've also tried with GetVar returning an unsafe.Pointer instead with exact same result. In the example above I do not even need to assign a C.CString to mystring, cgo panics anyway.</p>\n\n<p>For the purpose of my project, those C structures do not need to be modified on the lua side, especially not the strings, but need to be natively accessed for performance reasons.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1551798977, "post_id": 55005956, "comment_id": 96767151, "body": "This kind of microbenchmark tells you practically nothing of value."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1551801510, "post_id": 55005956, "comment_id": 96768792, "body": "If I interpret the output of <code>go tool objdump</code> correctly (on Go 1.12 on amd64), the functions with local variables simply repeatedly increment a CPU register while the last function (unsurprisingly) requires some kind of memory access (or perhaps its just some kind of dereferencing; anyway, nothing beats a CPU register). But as Adrian mentioned, this benchmark is pointless. Benchmark code that does something useful. Time spent accessing variables is almost certainly dwarfed by everything else that&#39;s going on."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1551803882, "post_id": 55005956, "comment_id": 96770166, "body": "Go doesn&#39;t have global variables."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1551801193, "post_id": 55006520, "comment_id": 96768618, "body": "That&#39;s not it in this case. I see about the same results with a <code>b.Log(x)</code> at the end of each benchmark."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1551801466, "post_id": 55006520, "comment_id": 96768761, "body": "@Peter to see what the compiler does: Inspect the generated assembly."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1551801542, "post_id": 55006520, "comment_id": 96768811, "body": "I did. It has looping structures in all of the functions. See my comment on the question."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1551800577, "creation_date": 1551800577, "answer_id": 55006520, "question_id": 55005956, "link": "https://stackoverflow.com/questions/55005956/golang-global-variable-access-is-slow-in-benchmark-test/55006520#55006520", "title": "golang global variable access is slow in benchmark test", "body": "<blockquote>\n  <p>I wonder why this is happening.</p>\n</blockquote>\n\n<p>The compiler optimizes away your whole code. 300ps per op means a only a noop was \"executed\".</p>\n"}], "owner": {"reputation": 9643, "user_id": 1925083, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/C3khW.jpg?s=128&g=1", "display_name": "cizixs", "link": "https://stackoverflow.com/users/1925083/cizixs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1551800577, "creation_date": 1551798819, "question_id": 55005956, "link": "https://stackoverflow.com/questions/55005956/golang-global-variable-access-is-slow-in-benchmark-test", "title": "golang global variable access is slow in benchmark test", "body": "<p>Here is a simple golang benchmark test, it runs <code>x++</code> in three different ways:</p>\n\n<ol>\n<li>in a simple for loop with x declared inside function</li>\n<li>in a nested loop with x declared inside function</li>\n<li>in a nested loop with x declared as <strong>global variable</strong></li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"testing\"\n)\n\nvar x = 0\n\nfunc BenchmarkLoop(b *testing.B) {\n    x := 0\n    for n := 0; n &lt; b.N; n++ {\n        x++\n    }\n}\n\nfunc BenchmarkDoubleLoop(b *testing.B) {\n    x := 0\n    for n := 0; n &lt; b.N/1000; n++ {\n        for m := 0; m &lt; 1000; m++ {\n            x++\n        }\n    }\n}\n\nfunc BenchmarkDoubleLoopGlobalVariable(b *testing.B) {\n    for n := 0; n &lt; b.N/1000; n++ {\n        for m := 0; m &lt; 1000; m++ {\n            x++\n        }\n    }\n}\n\n</code></pre>\n\n<p>And the result is as following:</p>\n\n<pre><code>$ go test -bench=.\n\nBenchmarkLoop-8                         2000000000               0.32 ns/op\nBenchmarkDoubleLoop-8                   2000000000               0.34 ns/op\nBenchmarkDoubleLoopGlobalVariable-8     2000000000               2.00 ns/op\nPASS\nok      github.com/cizixs/playground/loop-perf  5.597s\n</code></pre>\n\n<p>Obviously, the first and second methods have similar performance, while the third function is much slower(about 6x times slow).</p>\n\n<p>And I wonder why this is happening, is there a way to improve performance of global variable access?</p>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 6486, "user_id": 1116230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55a894894150db28d6641f0c57e48bac?s=128&d=identicon&r=PG", "display_name": "Nico Haase", "link": "https://stackoverflow.com/users/1116230/nico-haase"}, "edited": false, "score": 2, "creation_date": 1551795558, "post_id": 55004869, "comment_id": 96764901, "body": "What do you mean by &quot;I got error&quot; - is there any error message given that you could share?"}, {"owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "reply_to_user": {"reputation": 6486, "user_id": 1116230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55a894894150db28d6641f0c57e48bac?s=128&d=identicon&r=PG", "display_name": "Nico Haase", "link": "https://stackoverflow.com/users/1116230/nico-haase"}, "edited": false, "score": 0, "creation_date": 1551795728, "post_id": 55004869, "comment_id": 96765012, "body": "@NicoHaase - sure, please see my update"}, {"owner": {"reputation": 15415, "user_id": 982257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pRf2i.jpg?s=128&g=1", "display_name": "Iguananaut", "link": "https://stackoverflow.com/users/982257/iguananaut"}, "edited": false, "score": 2, "creation_date": 1551795772, "post_id": 55004869, "comment_id": 96765038, "body": "Your YAML example does not look like valid YAML in the first place."}, {"owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "reply_to_user": {"reputation": 15415, "user_id": 982257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pRf2i.jpg?s=128&g=1", "display_name": "Iguananaut", "link": "https://stackoverflow.com/users/982257/iguananaut"}, "edited": false, "score": 0, "creation_date": 1551795990, "post_id": 55004869, "comment_id": 96765172, "body": "@Iguananaut - please see my update"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551796076, "post_id": 55004869, "comment_id": 96765221, "body": "The <code>build</code> field of your <code>root</code> struct is unexported and cannot be unmarshaled into."}, {"owner": {"reputation": 15415, "user_id": 982257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pRf2i.jpg?s=128&g=1", "display_name": "Iguananaut", "link": "https://stackoverflow.com/users/982257/iguananaut"}, "edited": false, "score": 0, "creation_date": 1551796470, "post_id": 55004869, "comment_id": 96765486, "body": "@NinaS I&#39;m not sure that YAML validator looks correct.  I&#39;ve spent a lot of time with YAML and I&#39;ve never seen anything like what you wrote, though I could be wrong. But it&#39;s really unclear what your data structure is intended to be here.  <code>before: test1</code> indicates a map with key <code>before</code> and value of the string <code>test1</code>.  Then under that you start a new data structure (an omap maybe) but it&#39;s not clear what parent structure it belongs to."}, {"owner": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 1, "creation_date": 1551798719, "post_id": 55004869, "comment_id": 96766978, "body": "Don&#39;t ever use the &quot;validator&quot; at codebeautify.com, it accepts some invalid YAML, and reject some perfectly fine YAML."}], "answers": [{"tags": [], "owner": {"reputation": 2139, "user_id": 208769, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7678cf457f3bcd08972a960104761cf9?s=128&d=identicon&r=PG", "display_name": "user208769", "link": "https://stackoverflow.com/users/208769/user208769"}, "is_accepted": true, "score": 2, "last_activity_date": 1551796236, "creation_date": 1551796236, "answer_id": 55005135, "question_id": 55004869, "link": "https://stackoverflow.com/questions/55004869/parse-yaml-with-keys-provide-errors/55005135#55005135", "title": "Parse yaml with keys provide errors", "body": "<p>That sounds correct - the YAML is invalid. Did you mean something like this?</p>\n\n<pre><code>Build-t:\n before:\n   test1:\n     - value: dddd\n     - bbb: zzzz\n\n after:\n   test2:\n     - value: bbb\n     - aaa: aaaa\n</code></pre>\n\n<p>Remember that the whitespace is important, and it's a key-value structure - so your values can either be strings, or substructures - not both.</p>\n\n<p>Also, that yaml validator... I can't seem to make it declare anything as invalid!</p>\n"}], "owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 1, "accepted_answer_id": 55005135, "answer_count": 1, "score": -2, "last_activity_date": 1551796236, "creation_date": 1551795390, "last_edit_date": 1551795962, "question_id": 55004869, "link": "https://stackoverflow.com/questions/55004869/parse-yaml-with-keys-provide-errors", "title": "Parse yaml with keys provide errors", "body": "<p>I\u2019ve the following yaml which I need to parse,\nI\u2019ve tried with the following </p>\n\n<pre><code>\nBuild-t:\n  before: test1\n    - value : dddd \n       -  bbb: zzzz\n\n  after: test2\n     - value: bbb\n        - aaa: aaaa\n\n\n</code></pre>\n\n<p>I\u2019ve tried with the following:</p>\n\n<pre><code>type root struct{\n build type Build `yaml:\"Build-t,omitempty\"`\n} \n\n\ntype Build struct {\n    Before map[string]interface{} `yaml:\"before,omitempty\"`\n    After map[string]interface{} `yaml:\"after,omitempty\"`\n }\n</code></pre>\n\n<p>Now when I parse it I got error,</p>\n\n<p>What I need is to get the values from the object <code>before</code> and <code>after</code> which are hardcoded value in the yaml\nAnd all the others value under it are dynmically can be added therefor I put it as <code>interface</code></p>\n\n<p>btw, if I change the root to this its working and I see all the fields under the <code>Build-t</code> but the <code>before and after</code> are like keys ...</p>\n\n<pre><code>type root struct{\n build type map[string]interface{} `yaml:\"Build-t,omitempty\"`\n} \n</code></pre>\n\n<p>the error is:</p>\n\n<pre><code>line 6: cannot unmarshal !!str `test1` into map[string]interface {}\n        line 7: cannot unmarshal !!str `test2` into map[string]interface {}\n</code></pre>\n\n<p>see the yaml valid here\n<a href=\"https://codebeautify.org/yaml-validator/cb705458\" rel=\"nofollow noreferrer\">https://codebeautify.org/yaml-validator/cb705458</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 1, "creation_date": 1551794079, "post_id": 55004106, "comment_id": 96764026, "body": "I&#39;ve voted for closing this question mainly because there are several ways to achieve what you want to do. I highly recommend you to read something about pub/sub system"}, {"owner": {"reputation": 1278, "user_id": 2036231, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/nYM74.png?s=128&g=1", "display_name": "Jose Bagatelli", "link": "https://stackoverflow.com/users/2036231/jose-bagatelli"}, "reply_to_user": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 0, "creation_date": 1551803553, "post_id": 55004106, "comment_id": 96769982, "body": "Your question is too broad for a simple answer. As @Tinwor mentioned above you might want to take a look at the pubsubhub protocol which is designed for this exact purpose. Your code as is is just a simple web service over http and you&#39;re likely to hit a dead end trying to find a solution this way."}], "owner": {"reputation": 63, "user_id": 11154131, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Df9Cd5m8YbU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3t3aLeqiZQsvHjhZOsFrB-0dzvg/mo/photo.jpg?sz=128", "display_name": "Abraham", "link": "https://stackoverflow.com/users/11154131/abraham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 463, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1551860338, "creation_date": 1551792831, "last_edit_date": 1551860338, "question_id": 55004106, "link": "https://stackoverflow.com/questions/55004106/golang-how-to-create-callback-notification", "title": "Golang - How to create callback notification", "body": "<p>I am trying to implement a case where a client sends a POST request to subscribe to some service to a server.</p>\n\n<p>The server has to respond with the subscription data, however after some time if there is a change in the subscription information in the server, the server has to send a notification to the client about the changes using the \"nfStatusNotificationUri\" in the request body (\"nfStatusNotificationUri\" in the JSON \ndata below).</p>\n\n<p>I do not know how to do this. </p>\n\n<p>I have implemented the POST subscription part but have no idea how to implement the notification part.</p>\n\n<p>Can anyone help me or give me some guidance on<code>enter code here</code> how to do this. </p>\n\n<p>This what I have done so far:</p>\n\n<p>// server\n// functions</p>\n\n<pre><code>func (m *NfInstanceDataAccess) Insertsub(nfinstancesub Subscriptions) error {\n    err := db.C(COLLECTION).Insert(&amp;nfinstancesub)\n    return err\n}\n\nfunc CreateNewSubscriptionPost(w http.ResponseWriter, r *http.Request) {\n    var nfinstancesub Subscriptions\n    id := uuid.New()\n    subscriptionID := id.String()\n\n    if r.Header.Get(\"Accept\") != \"application/json\" {\n        WriteError(w, ErrNotAcceptable)\n        return\n    }\n    if err := json.NewDecoder(r.Body).Decode(&amp;nfinstancesub); err != nil {\n        respondWithError(w, http.StatusBadRequest, \"Invalid request payload\")\n        return\n    }\n    nfinstancesub.ID = bson.NewObjectId()\n    nfinstancesub.SubscriptionID = subscriptionID\n    if err := da.Insertsub(nfinstancesub); err != nil {\n        respondWithError(w, http.StatusInternalServerError, err.Error())\n        return\n    }\n    w.Header().Set(\"Response-Code\", \"201\")\n    w.Header().Set(\"Response-Desc\", \"Success\")\n    w.Header().Set(\"Cache-Control\", \"max-age=2592000\") // 30 days\n    respondWithJson(w, http.StatusCreated, nfinstancesub)\n}\n</code></pre>\n\n<p>// Main function</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/nnrf-nfm/v1/subscriptions, CreateNewSubscriptionPost)\n\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>The JSON data to request subscription including the notification uri \"nfStatusNotificationUri\" field.\nAm using mongodb to store this JSON data request is sent.</p>\n\n<pre><code>{\n  \"nfStatusNotificationUri\": \"string\",\n  \"subscriptionID\": \"3fa85f64-5717-4562-b3fc-2c963f66afa6\",\n  \"validityTime\": \"2019-02-11T09:45:52.015Z\",\n  \"reqNotifEvents\": [\n    \"NF_REGISTERED\",\n    \"string\"\n  ],\n  \"plmnId\": {\n    \"mcc\": \"string\",\n    \"mnc\": \"string\"\n  },\n  \"notifCondition\": {\n    \"monitoredAttributes\": [\n      \"string\"\n    ],\n    \"unmonitoredAttributes\": [\n      \"string\"\n    ]\n  },\n  \"reqNfFqdn\": \"string\"\n}\n</code></pre>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1551789603, "post_id": 55002924, "comment_id": 96761308, "body": "What are you trying to build?  What have you done so far?  (For ordinary use and just talking to an existing container, you don&#39;t actually need the container ID; if your process could access the container ID it would have unrestricted access over the host.)"}, {"owner": {"reputation": 1278, "user_id": 2036231, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/nYM74.png?s=128&g=1", "display_name": "Jose Bagatelli", "link": "https://stackoverflow.com/users/2036231/jose-bagatelli"}, "edited": false, "score": 0, "creation_date": 1551790223, "post_id": 55002924, "comment_id": 96761678, "body": "I assume English is not your first language (neither is mine) and might be a bit hard to fully express the problem you have at hand, but try to elaborate your question a bit more. It&#39;s hard to understand what you&#39;re actually trying to do by the way your question is phrased. Help us understand what you&#39;re trying achieve and you sure will get the help you need."}, {"owner": {"reputation": 8517, "user_id": 2336650, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/lpq4b.jpg?s=128&g=1", "display_name": "Mostafa Hussein", "link": "https://stackoverflow.com/users/2336650/mostafa-hussein"}, "edited": false, "score": 0, "creation_date": 1551796561, "post_id": 55002924, "comment_id": 96765544, "body": "There are examples in here with extra details <a href=\"https://docs.docker.com/develop/sdk/examples/\" rel=\"nofollow noreferrer\">docs.docker.com/develop/sdk/examples</a>"}, {"owner": {"reputation": 8517, "user_id": 2336650, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/lpq4b.jpg?s=128&g=1", "display_name": "Mostafa Hussein", "link": "https://stackoverflow.com/users/2336650/mostafa-hussein"}, "edited": false, "score": 0, "creation_date": 1551796675, "post_id": 55002924, "comment_id": 96765605, "body": "Another example can be found in this question <a href=\"https://stackoverflow.com/questions/51849954/programmatically-check-if-docker-container-process-ended-with-non-zero-status\">Programmatically check if Docker container process ended with non-zero status</a>"}], "answers": [{"comments": [{"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 1, "creation_date": 1551796392, "post_id": 55004760, "comment_id": 96765424, "body": "link only answers are in general frowned upon on stack overflow, could you give a small code example."}], "tags": [], "owner": {"reputation": 1054, "user_id": 5225183, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-R8Nybos5LAs/AAAAAAAAAAI/AAAAAAAAETs/Oxg4jC-EzCU/photo.jpg?sz=128", "display_name": "Hernan Garcia", "link": "https://stackoverflow.com/users/5225183/hernan-garcia"}, "is_accepted": true, "score": 1, "last_activity_date": 1582389407, "last_edit_date": 1582389407, "creation_date": 1551795035, "answer_id": 55004760, "question_id": 55002924, "link": "https://stackoverflow.com/questions/55002924/how-to-get-container-id-by-golang/55004760#55004760", "title": "How to get container ID by golang", "body": "<p>You can use docker/client<br>\n<a href=\"https://godoc.org/github.com/docker/docker/client\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/docker/docker/client</a></p>\n\n<p>Example code:   </p>\n\n<pre><code># listcontainers.go\n\npackage main\n\nimport (\n    \"context\"\n    \"fmt\"\n\n    \"github.com/docker/docker/api/types\"\n    \"github.com/docker/docker/client\"\n)\n\nfunc main() {\n    cli, err := client.NewClientWithOpts(client.FromEnv)\n    if err != nil {\n        panic(err)\n    }\n\n    containers, err := cli.ContainerList(context.Background(), types.ContainerListOptions{})\n    if err != nil {\n        panic(err)\n    }\n\n    for _, container := range containers {\n        fmt.Printf(\"%s %s\\n\", container.ID[:10], container.Image)\n    }\n}\n</code></pre>\n\n<p>Then execute it like this</p>\n\n<pre><code>DOCKER_API_VERSION=1.35 go run listcontainers.go\n</code></pre>\n\n<p>More about docker engine SDKs and API<br>\n<a href=\"https://docs.docker.com/develop/sdk/\" rel=\"nofollow noreferrer\">https://docs.docker.com/develop/sdk/</a></p>\n"}], "owner": {"reputation": 33, "user_id": 10694513, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2zgV-hPHsr4/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-gaR9gSn3m4NAq3ZfDhA4QwQHYhBw/mo/photo.jpg?sz=128", "display_name": "zihuai li", "link": "https://stackoverflow.com/users/10694513/zihuai-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1301, "favorite_count": 0, "accepted_answer_id": 55004760, "answer_count": 1, "score": 1, "last_activity_date": 1582389407, "creation_date": 1551789168, "question_id": 55002924, "link": "https://stackoverflow.com/questions/55002924/how-to-get-container-id-by-golang", "title": "How to get container ID by golang", "body": "<p>I use golang to develop application . I want get container  in application.I hava tired by shell.But I want to get container by go. thanks</p>\n"}, {"tags": ["go", "aws-lambda", "dynamodb-queries", "amazon-dynamodb-index"], "answers": [{"tags": [], "owner": {"reputation": 441, "user_id": 2967920, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f5aa8bb3e35b31d8d34a9d2fcce48565?s=128&d=identicon&r=PG&f=1", "display_name": "user2967920", "link": "https://stackoverflow.com/users/2967920/user2967920"}, "is_accepted": true, "score": 0, "last_activity_date": 1551948960, "creation_date": 1551948960, "answer_id": 55039668, "question_id": 55002146, "link": "https://stackoverflow.com/questions/55002146/executing-dynamodb-queries-in-parallel-batchgetitems-for-global-secondary-index/55039668#55039668", "title": "Executing DynamoDB queries in parallel (BatchGetItems for Global Secondary Index)", "body": "<p>According to <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/go-programming-model-handler-types.html\" rel=\"nofollow noreferrer\">documentation</a>, global variables are independent of your Lambda function's handler code. This was causing the buffer to build up over time.</p>\n\n<p>Rectified reference pasted below.</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"os\"\n    \"sync\"\n\n    \"github.com/aws/aws-lambda-go/lambda\"\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/dynamodb\"\n    \"github.com/aws/aws-sdk-go/service/dynamodb/dynamodbattribute\"\n)\n\nfunc exitWithError(err error) {\n    fmt.Fprintln(os.Stderr, err)\n    os.Exit(1)\n}\n\n//HandleRequest : Lambda entry point\nfunc HandleRequest(ctx context.Context, data LambdaInputJSON) ([]interface{}, error) {\n    output := DynamoDBBatchGetRecords(data)\n    return output, nil\n}\n\nfunc main() {\n    lambda.Start(HandleRequest)\n}\n\nfunc DynamoDBBatchGetRecords(a LambdaInputJSON) []interface{} {\n    var dataOut []interface{}\n    var wg = &amp;sync.WaitGroup{}\n    var mtx = &amp;sync.Mutex{}\n\n    iterations := len(a.Ids)\n    wg.Add(iterations)\n    for i := 0; i &lt; i; i++ {\n        go func(i int) {\n            defer wg.Done()\n            var outputData []interface{}\n            sess, err := session.NewSession(&amp;aws.Config{\n                Region: aws.String(\"aws-region\"),\n            })\n            if err != nil {\n                exitWithError(fmt.Errorf(\"failed to make Query API call, %v\", err))\n            }\n            ddb := dynamodb.New(sess)\n            queryInput := &amp;dynamodb.QueryInput{\n                Limit:            aws.Int64(1),\n                TableName:        aws.String(\"table\"),\n                IndexName:        aws.String(\"index\"),\n                ScanIndexForward: aws.Bool(false),\n                ConsistentRead: aws.Bool(false),\n                KeyConditions: map[string]*dynamodb.Condition{\n                    \"index-column\": {\n                        ComparisonOperator: aws.String(\"EQ\"),\n                        AttributeValueList: []*dynamodb.AttributeValue{\n                            {\n                                S: aws.String(a.Ids[i]),\n                            },\n                        },\n                    },\n                },\n            }\n            output, err := ddb.Query(queryInput)\n\n            if err != nil {\n                exitWithError(fmt.Errorf(\"E1 failed to make Query API call, %v\", err))\n            }\n            err = dynamodbattribute.UnmarshalListOfMaps(output.Items, &amp;outputData)\n            if err != nil {\n                exitWithError(fmt.Errorf(\"E2 failed to unmarshal Query result items, %v\", err))\n            }\n\n            mtx.Lock()\n            dataOut = append(dataOut, outputData[0])\n            mtx.Unlock()\n\n        }(i)\n    }\n    wg.Wait()\n    return dataOut\n}\n</code></pre>\n"}], "owner": {"reputation": 441, "user_id": 2967920, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f5aa8bb3e35b31d8d34a9d2fcce48565?s=128&d=identicon&r=PG&f=1", "display_name": "user2967920", "link": "https://stackoverflow.com/users/2967920/user2967920"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2189, "favorite_count": 0, "accepted_answer_id": 55039668, "answer_count": 1, "score": 1, "last_activity_date": 1552110580, "creation_date": 1551786439, "last_edit_date": 1552110580, "question_id": 55002146, "link": "https://stackoverflow.com/questions/55002146/executing-dynamodb-queries-in-parallel-batchgetitems-for-global-secondary-index", "title": "Executing DynamoDB queries in parallel (BatchGetItems for Global Secondary Index)", "body": "<p>The idea here is run multiple DynamoDB queries in parallel as the query is run over a GSI. As of now BatchGetItems <a href=\"https://forums.aws.amazon.com/thread.jspa?messageID=600936\" rel=\"nofollow noreferrer\">doesn't support querying over Indexes</a> and the recommended approach is to Query the data in parallel.  I'm using go routines with wg to take care of the executions of the routines in parallel. </p>\n\n<p>The input to the function is an array of strings with an ID, the outputs are the attributes of the Ids. </p>\n\n<p>When the function is run locally, there is no issue, however, when the function is run on AWS-Lambda, the returned data keeps growing;</p>\n\n<p>ie; Input 2 items should output 2 items. If the function is tested on AWS-Lambda, </p>\n\n<ul>\n<li>1st time the function returns 2 item</li>\n<li>2nd time it returns 4 items (same items are repeated 2 times)</li>\n<li>3rd time it returns 6 items (same items are repeated 4 times)</li>\n</ul>\n\n<p>and so on. Here is a snippet of the code. Is there something not handled correctly that's having the lambda output the extra set of data every-time the lambda is run? </p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"os\"\n    \"sync\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/dynamodb\"\n    \"github.com/aws/aws-sdk-go/service/dynamodb/dynamodbattribute\"\n)\n\n//Final Output Interface\nvar bulkOutput []interface{}\n\nfunc exitWithError(err error) {\n    fmt.Fprintln(os.Stderr, err)\n    os.Exit(1)\n}\n\n//LambdaInputJSON input for the lambda handler\ntype LambdaInputJSON struct {\n    Ids      []string `json:\"ids,omitempty\"`\n}\n\n//HandleRequest : Lambda entry point\nfunc HandleRequest(ctx context.Context, data LambdaInputJSON) ([]interface{}, error) {\n    return DynamoDBBatchGetRecords(data), nil\n}\n\nfunc main() {\n    lambda.Start(HandleRequest)\n}\n\nfunc DynamoDBBatchGetRecords(a LambdaInputJSON) []interface{} {\n\n    var wg sync.WaitGroup\n    var mutex = &amp;sync.Mutex{}\n\n    iterations := len(a.Ids)\n    wg.Add(iterations)\n    for i := 0; i &lt; iterations; i++ {\n        go QueryOutput(a.Ids[i], &amp;wg, mutex)\n    }\n\n    wg.Wait()\n    return bulkOutput\n\n}\n\n//QueryOutput GoRoutine\nfunc QueryOutput(data string, wg *sync.WaitGroup, mtx *sync.Mutex) {\n    var outputData []interface{}\n    defer wg.Done()\n    sess, err := session.NewSession(&amp;aws.Config{\n        Region: aws.String(\"aws-region\"),\n    })\n    if err != nil {\n        exitWithError(fmt.Errorf(\"failed to make Query API call, %v\", err))\n    }\n    ddb := dynamodb.New(sess)\n    queryInput := &amp;dynamodb.QueryInput{\n        Limit:                aws.Int64(1),\n        TableName:            aws.String(\"table-name\"),\n        IndexName:            aws.String(\"gsi-index\"),\n        ScanIndexForward:     aws.Bool(false),\n        ConsistentRead:       aws.Bool(false),\n        KeyConditions: map[string]*dynamodb.Condition{\n            \"column_name\": {\n                ComparisonOperator: aws.String(\"EQ\"),\n                AttributeValueList: []*dynamodb.AttributeValue{\n                    {\n                        S: aws.String(data),\n                    },\n                },\n            },\n        },\n    }\n    output, err := ddb.Query(queryInput)\n    if err != nil {\n        exitWithError(fmt.Errorf(\"Failed to make Query API call, %v\", err))\n    }\n    err = dynamodbattribute.UnmarshalListOfMaps(output.Items, &amp;outputData)\n    if err != nil {\n        exitWithError(fmt.Errorf(\"Failed to unmarshal Query result items, %v\", err))\n    }\n    mtx.Lock()\n    bulkOutput = append(bulkOutput, outputData)\n    mtx.Unlock()\n}\n</code></pre>\n"}, {"tags": ["tensorflow", "go", "imagenet"], "answers": [{"comments": [{"owner": {"reputation": 905, "user_id": 8560600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-zQ0B8tCv38k/AAAAAAAAAAI/AAAAAAAAAAw/bWWd0qZVS8I/photo.jpg?sz=128", "display_name": "Stefan Radonjic", "link": "https://stackoverflow.com/users/8560600/stefan-radonjic"}, "edited": false, "score": 1, "creation_date": 1551787836, "post_id": 55002410, "comment_id": 96760342, "body": "Thank you so much for your help!"}, {"owner": {"reputation": 126, "user_id": 8742334, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EB6Hz.jpg?s=128&g=1", "display_name": "YoungChul", "link": "https://stackoverflow.com/users/8742334/youngchul"}, "reply_to_user": {"reputation": 905, "user_id": 8560600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-zQ0B8tCv38k/AAAAAAAAAAI/AAAAAAAAAAw/bWWd0qZVS8I/photo.jpg?sz=128", "display_name": "Stefan Radonjic", "link": "https://stackoverflow.com/users/8560600/stefan-radonjic"}, "edited": false, "score": 1, "creation_date": 1551788128, "post_id": 55002410, "comment_id": 96760502, "body": "You&#39;re welcome!  If you haven&#39;t tried it before, you might want to look at Google Codelab&#39;s Tutorial, it&#39;s really easy to follow:  <a href=\"https://codelabs.developers.google.com/codelabs/tensorflow-for-poets/#0\" rel=\"nofollow noreferrer\">codelabs.developers.google.com/codelabs/tensorflow-for-poets&zwnj;&#8203;/#0</a>"}], "tags": [], "owner": {"reputation": 126, "user_id": 8742334, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EB6Hz.jpg?s=128&g=1", "display_name": "YoungChul", "link": "https://stackoverflow.com/users/8742334/youngchul"}, "is_accepted": true, "score": 2, "last_activity_date": 1551787307, "creation_date": 1551787307, "answer_id": 55002410, "question_id": 55001855, "link": "https://stackoverflow.com/questions/55001855/loaded-mobilenet-model-giving-wrong-predictions/55002410#55002410", "title": "Loaded MobileNet model giving wrong predictions", "body": "<p>AFAIK MobileNet from the Tensorflow Model Zoo is trained on ILSVRC-2012-CLS, which has 1,000 classes including Giant Panda and Red Panda.</p>\n\n<p>However as MobileNet is not 100% accurate, you might experience varying results depending on the input image you provide. Make sure to make it is tightly cropped around the Panda, and try various images, as some might return incorrect labels as even the best MobileNets V2 models have an accuracy around 70% on the ImageNet dataset.</p>\n\n<p>If you want to be able to classify pandas more precisely, I'd suggest retrain your MobileNet model with a Panda dataset. There are plenty of available examples on how to do this, I have linked a couple below using the MobileNets architecture and Tensorflow as Framework. </p>\n\n<p><a href=\"https://www.tensorflow.org/hub/tutorials/image_retraining\" rel=\"nofollow noreferrer\">https://www.tensorflow.org/hub/tutorials/image_retraining</a></p>\n\n<p><a href=\"https://hackernoon.com/creating-insanely-fast-image-classifiers-with-mobilenet-in-tensorflow-f030ce0a2991\" rel=\"nofollow noreferrer\">https://hackernoon.com/creating-insanely-fast-image-classifiers-with-mobilenet-in-tensorflow-f030ce0a2991</a></p>\n\n<p><a href=\"https://medium.com/@sumit.arora/training-a-neural-network-using-mobilenets-in-tensorflow-for-image-classification-on-android-14f2792f64c1\" rel=\"nofollow noreferrer\">https://medium.com/@sumit.arora/training-a-neural-network-using-mobilenets-in-tensorflow-for-image-classification-on-android-14f2792f64c1</a></p>\n"}], "owner": {"reputation": 905, "user_id": 8560600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-zQ0B8tCv38k/AAAAAAAAAAI/AAAAAAAAAAw/bWWd0qZVS8I/photo.jpg?sz=128", "display_name": "Stefan Radonjic", "link": "https://stackoverflow.com/users/8560600/stefan-radonjic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 783, "favorite_count": 0, "accepted_answer_id": 55002410, "answer_count": 1, "score": 1, "last_activity_date": 1551787307, "creation_date": 1551785571, "question_id": 55001855, "link": "https://stackoverflow.com/questions/55001855/loaded-mobilenet-model-giving-wrong-predictions", "title": "Loaded MobileNet model giving wrong predictions", "body": "<p>I am trying to load <strong><em>mobilenet_v2_1.4_224</em></strong> (link: <a href=\"https://github.com/tensorflow/models/tree/master/research/slim/nets/mobilenet\" rel=\"nofollow noreferrer\">https://github.com/tensorflow/models/tree/master/research/slim/nets/mobilenet</a>) which was trained in <strong>TensorFlow</strong>, and serve it in <strong>GoLang</strong>.</p>\n\n<p>Thing is when I try to make a prediction of image with a panda, I get the wrong prediction. My guess is I downloaded wrong imagenet label file. On which imagenet dataset was network i mentioned above trained on?</p>\n"}, {"tags": ["pointers", "go", "struct", "interface"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1551786716, "creation_date": 1551786716, "answer_id": 55002229, "question_id": 55001525, "link": "https://stackoverflow.com/questions/55001525/how-to-convert-interface-to-struct/55002229#55002229", "title": "How to convert interface to struct", "body": "<p>You should hardly ever use pointer to interface. My advice is to never use it, when you'll need it, you'll know.</p>\n\n<p>Instead if you need a pointer to something (so you can have the same pointer at multiple places, and so modifying the pointed value somewhere, it will have effect on the others), \"wrap the pointer\" in the interface value.</p>\n\n<p>So first modify the <code>items</code> field so that it stores <code>interface{}</code> values instead of pointers:</p>\n\n<pre><code>items map[string]interface{}\n</code></pre>\n\n<p>This means no restriction: you can pass and store pointers, that's not a problem.</p>\n\n<p>Next modify <code>Get()</code> to return <code>interface{}</code>:</p>\n\n<pre><code>func (cls *Container) Get(value string) interface{}{\n    return cls.items[value]\n}\n</code></pre>\n\n<p>And also in <code>Put()</code>, don't take the address of an <code>interface{}</code>:</p>\n\n<pre><code>func (cls *Container) Put(value string, a int64) {\n    res := cls.GetMysql(value, a)\n    cls.items[value] = res\n}\n</code></pre>\n\n<p>And you have to type-assert <code>*Member</code> from the values returned by <code>Get()</code>.</p>\n\n<p>And now testing it:</p>\n\n<pre><code>c := Container{outerType: Member{}}\nc.items = make(map[string]interface{})\nc.Put(\"Jack\", 500)\nres := c.Get(\"Jack\")\nfmt.Println(res)\nm := res.(*Member) // Here is the problem. How to convert ?\nfmt.Println(m)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/fJ3bvW4DyUk\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&amp;{0 Jack 500 0}\n&amp;{0 Jack 500 0}\n</code></pre>\n\n<p>Now if you would modify a field of <code>m</code>:</p>\n\n<pre><code>m.Credit = 11\n</code></pre>\n\n<p>And then get the value form the cache:</p>\n\n<pre><code>fmt.Println(c.Get(\"Jack\"))\n</code></pre>\n\n<p>We'll see the modified value, even though we did not call <code>Put()</code> (try it on the <a href=\"https://play.golang.org/p/jUX9rj2omZ3\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&amp;{0 Jack 11 0}\n</code></pre>\n"}], "owner": {"reputation": 1236, "user_id": 2729461, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/nq1S2.jpg?s=128&g=1", "display_name": "irmorteza", "link": "https://stackoverflow.com/users/2729461/irmorteza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 1, "accepted_answer_id": 55002229, "answer_count": 1, "score": -1, "last_activity_date": 1551787215, "creation_date": 1551784442, "last_edit_date": 1551787215, "question_id": 55001525, "link": "https://stackoverflow.com/questions/55001525/how-to-convert-interface-to-struct", "title": "How to convert interface to struct", "body": "<p>Here is the simplified code of a cache. Suppose <code>Container</code> placed in a package, so it don't know about <code>Member</code>.\nWhile I wanna store instances of Member in Container, So I store an empty instance of Member in Container as <code>outerType</code>. \nIn the <code>Container-&gt;GetMysql</code>, I fill a new variable by test values (but, in real world, It fill by data of database, dynamically).\nthen in the function <code>Put</code>, I store data in items as Cache for next uses. In the <code>Get</code> I get the data stored in the items.\nBefore this every thing is fine. My problem is where i want to convert result of Get to type of Member <code>m = res.(Member)</code> . How Can I convert it to an instance of Member \nI found many question about this subject, but none of them solved my problem</p>\n\n<p>For more detail: I want the <code>Get</code> return data with its pointer of where it stored in items. So if I get some variable of same member, an change in one are shown in others</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Member struct {\n    Id     int\n    Name   string\n    Credit int\n    Age    int\n}\n\ntype Container struct {\n    outerType interface{}\n    items     map[string]*interface{}\n}\n\nfunc (cls *Container)GetMysql(s string, a int64) interface{}{\n    obj := reflect.New(reflect.TypeOf(cls.outerType))\n    elem := obj.Elem()\n    //elem := reflect.ValueOf(o).Elem()\n    if elem.Kind() == reflect.Struct {\n        f := elem.FieldByName(\"Name\")\n        f.SetString(s)\n        f = elem.FieldByName(\"Credit\")\n        f.SetInt(a)\n    }\n    return obj.Interface()\n}\n\nfunc (cls *Container)Get(value string) *interface{}{\n    return cls.items[value]\n}\n\nfunc (cls *Container)Put(value string, a int64) {\n    res := cls.GetMysql(value, a)\n    cls.items[value] = &amp;res\n}\n\nfunc main() {\n    c := Container{outerType:Member{}}\n    c.items = make(map[string]*interface{})\n    c.Put(\"Jack\", 500)\n    res := c.Get(\"Jack\")\n    fmt.Println(*res)\n    m := &amp;Member{}\n    m = res.(Member) // Here is the problem. How to convert ?\n    fmt.Println(m)\n}\n</code></pre>\n"}, {"tags": ["go", "github"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1551781782, "post_id": 55000653, "comment_id": 96756705, "body": "It&#39;s impossible to tell you how to fix your errors if you don&#39;t tell us what the errors are, or show us the code."}, {"owner": {"reputation": 11, "user_id": 10391366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cd7901a5039a94db90b814ca5bb783d?s=128&d=identicon&r=PG&f=1", "display_name": "Supriya ghadge", "link": "https://stackoverflow.com/users/10391366/supriya-ghadge"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1551782809, "post_id": 55000653, "comment_id": 96757311, "body": "@Flimzy i have edited the question. please check"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1551787217, "post_id": 55000653, "comment_id": 96759971, "body": "You Go installation seems to be broken. Install from official source according to official installation instructions and test your installation first."}, {"owner": {"reputation": 11, "user_id": 10391366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cd7901a5039a94db90b814ca5bb783d?s=128&d=identicon&r=PG&f=1", "display_name": "Supriya ghadge", "link": "https://stackoverflow.com/users/10391366/supriya-ghadge"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1551878547, "post_id": 55000653, "comment_id": 96801279, "body": "@Volker yes, i have installed from official source"}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1551788960, "post_id": 55002517, "comment_id": 96760952, "body": "That&#39;s useless if they want to make changes to the code."}, {"owner": {"reputation": 258, "user_id": 2969272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc136055ef3028847d419f129f409d?s=128&d=identicon&r=PG", "display_name": "antham", "link": "https://stackoverflow.com/users/2969272/antham"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1551790639, "post_id": 55002517, "comment_id": 96761910, "body": "Yes, but the purpose is not defined in the question so it&#39;s just in case it&#39;s only for testing the app."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1551790880, "post_id": 55002517, "comment_id": 96762068, "body": "It specifically says &quot;when I edited the code and run, many errors occured&quot;."}], "tags": [], "owner": {"reputation": 258, "user_id": 2969272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc136055ef3028847d419f129f409d?s=128&d=identicon&r=PG", "display_name": "antham", "link": "https://stackoverflow.com/users/2969272/antham"}, "is_accepted": false, "score": -1, "last_activity_date": 1551787725, "creation_date": 1551787725, "answer_id": 55002517, "question_id": 55000653, "link": "https://stackoverflow.com/questions/55000653/how-to-run-golang-project-downloaded-from-github/55002517#55002517", "title": "how to run golang project downloaded from github", "body": "<p>You can check the release page, you have an executable ready to use : <a href=\"https://github.com/securitywithoutborders/hardentools/releases\" rel=\"nofollow noreferrer\">https://github.com/securitywithoutborders/hardentools/releases</a> </p>\n"}], "owner": {"reputation": 11, "user_id": 10391366, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cd7901a5039a94db90b814ca5bb783d?s=128&d=identicon&r=PG&f=1", "display_name": "Supriya ghadge", "link": "https://stackoverflow.com/users/10391366/supriya-ghadge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 274, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1551787725, "creation_date": 1551781728, "last_edit_date": 1551782739, "question_id": 55000653, "link": "https://stackoverflow.com/questions/55000653/how-to-run-golang-project-downloaded-from-github", "title": "how to run golang project downloaded from github", "body": "<p>i have downloaded a project from github for some testing. the code is in go language. when i edited the code and run , many errors occoured.\nI have tried to run project using D:\\go>go run demo command. \nhow should i run the project?      </p>\n\n<p>here are the errors:      </p>\n\n<pre><code>D:\\go&gt;go run hardentools-master\nbin\\src\\hardentools-master\\powershell.go:20:2: cannot find package \"errors\" in any of:\n        D:\\go\\bin\\src\\errors (from $GOROOT)\n        C:\\Users\\admin\\go\\src\\errors (from $GOPATH)\nbin\\src\\hardentools-master\\gui.go:20:2: cannot find package \"flag\" in any of:\n        D:\\go\\bin\\src\\flag (from $GOROOT)\n        C:\\Users\\admin\\go\\src\\flag (from $GOPATH)\nbin\\src\\hardentools-master\\adobe.go:20:2: cannot find package \"fmt\" in any of:\n        D:\\go\\bin\\src\\fmt (from $GOROOT)\n        C:\\Users\\admin\\go\\src\\fmt (from $GOPATH)\nbin\\src\\hardentools-master\\gui.go:26:2: cannot find package \"github.com/lxn/walk\" in any of:\n        D:\\go\\bin\\src\\github.com\\lxn\\walk (from $GOROOT)\n        C:\\Users\\admin\\go\\src\\github.com\\lxn\\walk (from $GOPATH)\nbin\\src\\hardentools-master\\gui.go:27:2: cannot find package \"github.com/lxn/walk/declarative\" in any of:\n        D:\\go\\bin\\src\\github.com\\lxn\\walk\\declarative (from $GOROOT)\n        C:\\Users\\admin\\go\\src\\github.com\\lxn\\walk\\declarative (from $GOPATH)\nbin\\src\\hardentools-master\\adobe.go:22:2: cannot find package \"golang.org/x/sys/windows/registry\" in any of:\n        D:\\go\\bin\\src\\golang.org\\x\\sys\\windows\\registry (from $GOROOT)\n        C:\\Users\\admin\\go\\src\\golang.org\\x\\sys\\windows\\registry (from $GOPATH)\nbin\\src\\hardentools-master\\main.go:73:2: cannot find package \"io\" in any of:\n        D:\\go\\bin\\src\\io (from $GOROOT)\n        C:\\Users\\admin\\go\\src\\io (from $GOPATH)\nbin\\src\\hardentools-master\\gui.go:22:2: cannot find package \"io/ioutil\" in any of:\n        D:\\go\\bin\\src\\io\\ioutil (from $GOROOT)\n        C:\\Users\\admin\\go\\src\\io\\ioutil (from $GOPATH)\nbin\\src\\hardentools-master\\main.go:74:2: cannot find package \"log\" in any of:\n        D:\\go\\bin\\src\\log (from $GOROOT)\n        C:\\Users\\admin\\go\\src\\log (from $GOPATH)\nbin\\src\\hardentools-master\\gui.go:23:2: cannot find package \"os\" in any of:\n        D:\\go\\bin\\src\\os (from $GOROOT)\n        C:\\Users\\admin\\go\\src\\os (from $GOPATH)         \n</code></pre>\n"}, {"tags": ["go", "type-conversion", "operator-keyword"], "comments": [{"owner": {"reputation": 318, "user_id": 4554300, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYaxW.png?s=128&g=1", "display_name": "Web Steps", "link": "https://stackoverflow.com/users/4554300/web-steps"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1551789458, "post_id": 54998543, "comment_id": 96761229, "body": "I corrected it in the example"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1551789685, "post_id": 54998543, "comment_id": 96761353, "body": "In this case, the answer is &quot;because sign bit&quot;. I can&#39;t quote the spec at the moment, but apparently this conversion is done by discarding the higher byte and interpreting the rest as a signed 8-bit int. Signed integers have a thing called sign bit. If this bit is 1, the number is negative."}, {"owner": {"reputation": 318, "user_id": 4554300, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYaxW.png?s=128&g=1", "display_name": "Web Steps", "link": "https://stackoverflow.com/users/4554300/web-steps"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1551791118, "post_id": 54998543, "comment_id": 96762211, "body": "very helpful info. it may help me get it. So 4336 in binary is 1000011110000 and 16 is 10000. -16 is 110000? does sign reserve 2 bits, so what left of int8 is 6 bits and it result in truncating the number 1000011110000 to 10000 (which is 16)?"}], "answers": [{"comments": [{"owner": {"reputation": 318, "user_id": 4554300, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYaxW.png?s=128&g=1", "display_name": "Web Steps", "link": "https://stackoverflow.com/users/4554300/web-steps"}, "edited": false, "score": 0, "creation_date": 1551777218, "post_id": 54998695, "comment_id": 96754023, "body": "Thank for the details. But on google play ground if it typed fmt.Println(1&lt;&lt;33) it gives overflow error for int. But fmt.Println(1 &lt;&lt; s) return 0. I can do fmt.Println(int32(1)&lt;&lt;33) or  fmt.Println(int32(1&lt;&lt;33)) it always return overflow error. Something im not able to understand"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 318, "user_id": 4554300, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYaxW.png?s=128&g=1", "display_name": "Web Steps", "link": "https://stackoverflow.com/users/4554300/web-steps"}, "edited": false, "score": 1, "creation_date": 1551777812, "post_id": 54998695, "comment_id": 96754332, "body": "@Salimd83 If you write <code>1 &lt;&lt; 33</code>, that is not the same, that is not a non-constant shift expression, which your quote applies to: <i>&quot;the left operand of a non-constant shift expression&quot;</i>. <code>1&lt;&lt;33</code> is a constant shift expression, which is evaluated at &quot;constant space&quot;, and the result would be converted to <code>int</code> which does not fit into a 32-bit <code>int</code>. It works with variables, because variables can overflow. Constants do not overflow."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1551793355, "last_edit_date": 1551793355, "creation_date": 1551775658, "answer_id": 54998695, "question_id": 54998543, "link": "https://stackoverflow.com/questions/54998543/gloang-shift-operator-conversion/54998695#54998695", "title": "Gloang shift operator conversion", "body": "<p>If you have this:</p>\n\n<pre><code>var s uint = 33\nfmt.Println(1 &lt;&lt; s)\n</code></pre>\n\n<p>Then the quoted part applies:</p>\n\n<blockquote>\n  <p>If the left operand of a non-constant shift expression is an untyped constant, it is first implicitly converted to the type it would assume if the shift expression were replaced by its left operand alone.</p>\n</blockquote>\n\n<p>Because <code>s</code> is not a constant (it's a variable), therefore <code>1 &gt;&gt; s</code> is a non-constant shift expression. And the left operand is <code>1</code> which is an untyped constant (e.g. <code>int(1)</code> would be a typed constant), so it is converted to a type that it would get if the expression would be simply <code>1</code> instead of <code>1 &lt;&lt; s</code>:</p>\n\n<pre><code>fmt.Println(1)\n</code></pre>\n\n<p>In the above, the untyped constant <code>1</code> would be converted to <code>int</code>, because that is its default type. Default type of constants is in <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">Spec: Constants:</a></p>\n\n<blockquote>\n  <p>An untyped constant has a <em>default type</em> which is the type to which the constant is implicitly converted in contexts where a typed value is required, for instance, in a <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">short variable declaration</a> such as <code>i := 0</code> where there is no explicit type. The default type of an untyped constant is <code>bool</code>, <code>rune</code>, <code>int</code>, <code>float64</code>, <code>complex128</code> or <code>string</code> respectively, depending on whether it is a boolean, rune, integer, floating-point, complex, or string constant.</p>\n</blockquote>\n\n<p>And the result of the above is architecture dependent. If <code>int</code> is 32 bits, it will be <code>0</code>. If <code>int</code> is 64 bits, it will be <code>8589934592</code> (because shifting a <code>1</code> bit 33 times will shift it out of a 32-bit <code>int</code> number).</p>\n\n<p>On the Go playground, size of <code>int</code> is 32 bits (4 bytes). See this example:</p>\n\n<pre><code>fmt.Println(\"int size:\", unsafe.Sizeof(int(0)))\n\nvar s uint = 33\n\nfmt.Println(1 &lt;&lt; s)\nfmt.Println(int32(1) &lt;&lt; s)\nfmt.Println(int64(1) &lt;&lt; s)\n</code></pre>\n\n<p>The above outputs (try it on the <a href=\"https://play.golang.org/p/jfZWEcZ0105\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>int size: 4\n0\n0\n8589934592\n</code></pre>\n\n<p>If I run the above app on my 64-bit computer, the output is:</p>\n\n<pre><code>int size: 8\n8589934592\n0\n8589934592\n</code></pre>\n\n<p>Also see <a href=\"https://blog.golang.org/constants\" rel=\"nofollow noreferrer\">The Go Blog: Constants</a> for how constants work in Go.</p>\n\n<p>Note that if you write <code>1 &lt;&lt; 33</code>, that is not the same, that is not a non-constant shift expression, which your quote applies to: <em>\"the left operand of a non-constant shift expression\"</em>. <code>1&lt;&lt;33</code> is a constant shift expression, which is evaluated at \"constant space\", and the result would be converted to <code>int</code> which does not fit into a 32-bit <code>int</code>, hence the compile-time error. It works with variables, because variables can overflow. Constants do not overflow:</p>\n\n<blockquote>\n  <p>Numeric constants represent exact values of arbitrary precision and do not overflow.</p>\n</blockquote>\n\n<p>See <a href=\"https://stackoverflow.com/questions/38982278/how-does-go-perform-arithmetic-on-constants/38982889#38982889\">How does Go perform arithmetic on constants?</a></p>\n\n<p><strong>Update:</strong></p>\n\n<p>Answering your addition: converting from <code>int16</code> to <code>int8</code> simply keeps the lowest 8 bits. And integers are represented using the <a href=\"https://en.wikipedia.org/wiki/Two%27s_complement\" rel=\"nofollow noreferrer\">2's complement</a> format, where the highest bit is <code>1</code> if the number is negative.</p>\n\n<p>This is detailed in <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">Spec: Conversions:</a></p>\n\n<blockquote>\n  <p>When converting between integer types, if the value is a signed integer, it is sign extended to implicit infinite precision; otherwise it is zero extended. <strong>It is then truncated to fit in the result type's size.</strong> For example, if <code>v := uint16(0x10F0)</code>, then <code>uint32(int8(v)) == 0xFFFFFFF0</code>. The conversion always yields a valid value; there is no indication of overflow.</p>\n</blockquote>\n\n<p>So when you convert a <code>int16</code> value to <code>int8</code>, if source number has a <code>1</code> in bit position 7 (8th bit), the result will be negative, even if the source wasn't negative. Similarly, if the source has <code>0</code> at bit position 7, the result will be positive, even if the source is negative.</p>\n\n<p>See this example:</p>\n\n<pre><code>for _, v := range []int16{4336, -129, 8079} {\n    fmt.Printf(\"Source    : %v\\n\", v)\n    fmt.Printf(\"Source hex: %4x\\n\", uint16(v))\n    fmt.Printf(\"Result hex: %4x\\n\", uint8(int8(v)))\n    fmt.Printf(\"Result    : %4v\\n\", uint8(int8(v)))\n    fmt.Println()\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/7Zjx2IVVc01\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Source    : 4336\nSource hex: 10f0\nResult hex:   f0\nResult    :  -16\n\nSource    : -129\nSource hex: ff7f\nResult hex:   7f\nResult    :  127\n\nSource    : 8079\nSource hex: 1f8f\nResult hex:   8f\nResult    : -113\n</code></pre>\n\n<p>See related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/50815512/when-casting-an-int64-to-uint64-is-the-sign-retained/50815961#50815961\">When casting an int64 to uint64, is the sign retained?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/49573389/format-printing-the-64bit-integer-1-as-hexadecimal-deviates-between-golang-and/49574308#49574308\">Format printing the 64bit integer -1 as hexadecimal deviates between golang and C</a></p>\n"}, {"tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": false, "score": 2, "last_activity_date": 1551775689, "creation_date": 1551775689, "answer_id": 54998714, "question_id": 54998543, "link": "https://stackoverflow.com/questions/54998543/gloang-shift-operator-conversion/54998714#54998714", "title": "Gloang shift operator conversion", "body": "<p>You're building and running the program in 32bit mode (go playground?). In it, int is 32-bit wide and behaves the same as int32.</p>\n"}], "owner": {"reputation": 318, "user_id": 4554300, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYaxW.png?s=128&g=1", "display_name": "Web Steps", "link": "https://stackoverflow.com/users/4554300/web-steps"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 54998695, "answer_count": 2, "score": 3, "last_activity_date": 1551793355, "creation_date": 1551775168, "last_edit_date": 1551789419, "question_id": 54998543, "link": "https://stackoverflow.com/questions/54998543/gloang-shift-operator-conversion", "title": "Gloang shift operator conversion", "body": "<p>I can not understand in golang how <code>1&lt;&lt;s</code> return <code>0</code> if <code>var s uint = 33</code>.\nBut <code>1&lt;&lt;33</code> return <code>8589934592</code>. \nHow a shift operator conversion end up with a value of 0.</p>\n\n<p>I'm reading the language specification and stuck in this section:\n<a href=\"https://golang.org/ref/spec#Operators\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Operators</a></p>\n\n<p>Specifically this paragraph from docs:</p>\n\n<blockquote>\n  <p>\"The right operand in a shift expression must have unsigned integer\n  type or be an untyped constant representable by a value of type uint.\n  <strong>If the left operand of a non-constant shift expression is an untyped\n  constant, it is first implicitly converted to the type it would assume\n  if the shift expression were replaced by its left operand alone</strong>.\"</p>\n</blockquote>\n\n<p>Some example from official Golang docs:</p>\n\n<pre><code>var s uint = 33\nvar i = 1&lt;&lt;s                  // 1 has type int\nvar j int32 = 1&lt;&lt;s            // 1 has type int32; j == 0\nvar k = uint64(1&lt;&lt;s)          // 1 has type uint64; k == 1&lt;&lt;33\n</code></pre>\n\n<p><strong>Update:</strong></p>\n\n<p>Another very related question, with an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\nv := int16(4336)\n    fmt.Println(int8(v))\n}\n</code></pre>\n\n<p>This program return <code>-16</code></p>\n\n<p>How does the number <code>4336</code> become <code>-16</code> in converting <code>int16</code> to <code>int8</code></p>\n"}, {"tags": ["csv", "http", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1551774361, "post_id": 54998251, "comment_id": 96752509, "body": "There is no fix fir this. You can serve a file with ServeFile in which case exactly that file is served and noting else or you can write our own response body e.g. via Fprintf in which case you cannot use Serve file. Dead simple. If you want to prefix the file content with some data you must implement this on your own."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1551775104, "post_id": 54998251, "comment_id": 96752874, "body": "As @Volker said: you can&#39;t mix <code>ServeFile()</code> and manual content writing. <code>ServeFile()</code> takes care of headers (e.g. <code>content-type</code>) which is not possible if you write some content prior (as that implicitly writes the headers)."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1551779469, "post_id": 54999671, "comment_id": 96755291, "body": "This makes Content-Length incorrect. Either add the length of the string written before the file or omit it."}, {"owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1551780173, "post_id": 54999671, "comment_id": 96755752, "body": "@Peter You&#39;re correct. I think for the sake of simplicity, I&#39;ll just omit it."}, {"owner": {"reputation": 51, "user_id": 7584660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e091105ff3374357463c48aa65380f5?s=128&d=identicon&r=PG&f=1", "display_name": "oguz zeyveli", "link": "https://stackoverflow.com/users/7584660/oguz-zeyveli"}, "edited": false, "score": 0, "creation_date": 1552908857, "post_id": 54999671, "comment_id": 97175760, "body": "1) I can not see &quot;Open&quot; func in <a href=\"https://golang.org/pkg/io/\" rel=\"nofollow noreferrer\">golang.org/pkg/io</a>  2) w.Header.Set(&quot;... must be  -&gt;  &quot;w.Header().Set(&quot;...  I am not sure this comment. I want see value of csv in browser page and automated download (its mean -&gt;If this endpoint is entered in the browser, write the data and download it directly&lt;-"}], "tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": false, "score": 0, "last_activity_date": 1551780149, "last_edit_date": 1551780149, "creation_date": 1551778794, "answer_id": 54999671, "question_id": 54998251, "link": "https://stackoverflow.com/questions/54998251/fprintf-with-servefile/54999671#54999671", "title": "Fprintf with Servefile", "body": "<p><code>http.ServeFile</code> adds <code>Content-Type</code> and <code>Content-Length</code> and writes the header. This must happen before you write to <code>http.ResponseWriter</code>.</p>\n\n<p>Your solution could be to avoid <code>http.ServeFile</code> and write the file manually with <code>io.Copy</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func example(w http.ResponseWriter, req *http.Request) {\n    // Write some headers.\n    w.Header.Set(\"Content-Type\", mime.TypeByExtension(filepath.Ext(name)))\n\n    // Write your content here.\n    fmt.Fprint(w, someContent)\n\n    // Write the file.\n    fileName := \"sample.csv\"\n    f, err := io.Open(fileName)\n    // check err\n    _, err = io.Copy(w, f)\n    // check err\n}\n</code></pre>\n\n<p>The downside of <code>io.Copy</code> is that it doesn't support Range requests (for resuming downloads, etc.)</p>\n"}], "owner": {"reputation": 51, "user_id": 7584660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e091105ff3374357463c48aa65380f5?s=128&d=identicon&r=PG&f=1", "display_name": "oguz zeyveli", "link": "https://stackoverflow.com/users/7584660/oguz-zeyveli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1551780149, "creation_date": 1551773985, "last_edit_date": 1551774980, "question_id": 54998251, "link": "https://stackoverflow.com/questions/54998251/fprintf-with-servefile", "title": "Fprintf with Servefile", "body": "<pre><code>func examp(w http.ResponseWriter, req *http.Request){\n    text:=\"hi\"\n    fmt.Fprintf(w,\"%d \\n\",text)\n\n    http.ServeFile(w, req, \"./sample.csv\")\n}\n</code></pre>\n\n<p>I can not use http.servefile with fmt.Fprintf, always use first one. I was tryed w.Header().add but nothing changed. How can i fix it ?</p>\n"}, {"tags": ["go", "concurrency", "deadlock", "channel", "goroutine"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1551774925, "post_id": 54998057, "comment_id": 96752777, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/51257837/fatal-error-all-goroutines-are-asleep-deadlock\">fatal error: all goroutines are asleep - deadlock</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1551774389, "last_edit_date": 1551774389, "creation_date": 1551774035, "answer_id": 54998258, "question_id": 54998057, "link": "https://stackoverflow.com/questions/54998057/why-are-all-goroutines-asleep/54998258#54998258", "title": "Why are all goroutines asleep?", "body": "<p>Your channel is unbuffered, so the first send on it will block until someone receives from it. But the code that would receive from it is after that, so this is an \"immediate\" deadlock.</p>\n\n<p>You could make it unbuffered like <code>ch := make(chan int, 1)</code>, so the send would not block, but then you have a single goroutine that has a <code>for range</code> over a channel. This loop only exits if the channel gets closed, but you never close it. And you only send a single value on it, so the loop is blocked, waiting on values that it can receive or the channel to get closed.</p>\n\n<p>You need another goroutine that closes the channel sometime. And inside the loop, you do not need to receive again from the channel, the loop construct already does that. <code>i</code> will be a value received from the channel.</p>\n\n<p>Working example that makes any sense:</p>\n\n<pre><code>func func1(n int) {\n    ch := make(chan int)\n    go func() {\n        for i := 0; i &lt; 5; i++ {\n            ch &lt;- i\n        }\n        close(ch)\n    }()\n    for i := range ch {\n        fmt.Println(i)\n    }\n}\n</code></pre>\n\n<p>This outputs (try it on the <a href=\"https://play.golang.org/p/VPMCSB291wL\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0\n1\n2\n3\n4\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 10108000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d07caaefccf18f5be2c23c99d8302b0?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/10108000/priyanka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1551775396, "creation_date": 1551773272, "last_edit_date": 1551775396, "question_id": 54998057, "link": "https://stackoverflow.com/questions/54998057/why-are-all-goroutines-asleep", "title": "Why are all goroutines asleep?", "body": "<p>Following is the code;</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    func1(1)\n}\n\nfunc func1(n int) {\n    ch := make(chan int)\n    ch &lt;- 1\n        for i := range ch {\n            fmt.Println(i)\n            fmt.Println(&lt;-ch)\n        }   \n}\n</code></pre>\n\n<p>When I try to execute this code, it throws the following error;</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\ngoroutine 1 [chan send]:\nmain.func1(0x1, 0x432070)\n    /tmp/sandbox451742015/main.go:11 +0x60\nmain.main()\n    /tmp/sandbox451742015/main.go:6 +0x20\n</code></pre>\n"}, {"tags": ["postgresql", "go", "hstore", "pq"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1551773604, "post_id": 54998054, "comment_id": 96752177, "body": "Have you tried <a href=\"https://godoc.org/github.com/lib/pq/hstore\" rel=\"nofollow noreferrer\">godoc.org/github.com/lib/pq/hstore</a>?"}, {"owner": {"reputation": 85, "user_id": 8214191, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd2c41221b470d82b32960b5b28278a9?s=128&d=identicon&r=PG&f=1", "display_name": "mlemboy", "link": "https://stackoverflow.com/users/8214191/mlemboy"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1551773748, "post_id": 54998054, "comment_id": 96752237, "body": "Yeah, I did take a look at it but how do I typecast my string map to it?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551774471, "post_id": 54998054, "comment_id": 96752567, "body": "You don&#39;t, because there&#39;s no type casting in Go. You&#39;ll have to write a function that creates an <code>hstore.Hstore</code> value from your map value. Alternatively you could declare a custom type that suits your needs better and then re-implement the <code>Scan</code> and <code>Value</code> methods from the <code>hstore</code> package."}], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 4381676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EdkrQ.png?s=128&g=1", "display_name": "rnicolas", "link": "https://stackoverflow.com/users/4381676/rnicolas"}, "is_accepted": false, "score": 3, "last_activity_date": 1552060058, "last_edit_date": 1552060058, "creation_date": 1552059726, "answer_id": 55066528, "question_id": 54998054, "link": "https://stackoverflow.com/questions/54998054/how-to-insert-a-hstore-object-using-lib-pq-to-postgres/55066528#55066528", "title": "How to insert a hstore object using lib/pq to postgres", "body": "<p><a href=\"https://github.com/lib/pq\" rel=\"nofollow noreferrer\">lib/pq</a> has support for <code>hstore</code>, as it stated <a href=\"https://stackoverflow.com/users/965900/mkopriva\">mkopriva</a> you can find information <a href=\"https://godoc.org/github.com/lib/pq/hstore\" rel=\"nofollow noreferrer\">here</a>. But it may need some clarification or better examples.</p>\n\n<p>First of all, <code>Hstore</code> in this driver is a struct that contains a map:</p>\n\n<pre><code>type Hstore struct {\n    Map map[string]sql.NullString\n}\n</code></pre>\n\n<p>So, if you want to use that map, you first need to initialize it:</p>\n\n<pre><code>h := hstore.Hstore{}\nh.Map = make(map[string]sql.NullString)\n</code></pre>\n\n<p>Then, you are able to use it, but taking in account that the map has the form of <code>[string]sql.NullString</code>, you'll need to cast your value field to be <code>sql.NullString</code> (a nullable string, default strings in golang are not nullable.) To do this you can write a function to do accomplish that job:</p>\n\n<pre><code>//ToNullString invalidates a sql.NullString if empty, validates if not empty\nfunc ToNullString(s string) sql.NullString {\n    return sql.NullString{String: s, Valid: s != \"\"}\n}\n</code></pre>\n\n<p>Now, you can do something like this:</p>\n\n<pre><code>data := hstore.Hstore{}\ndata.Map[\"data\"] = ToNullString(\"data\")\n\n_, err = db.Exec(`INSERT INTO table(id, my_field) VALUES ($1, $2)`, data, id)\n</code></pre>\n\n<p>Then you can update the value of your hstore performing this:</p>\n\n<pre><code>data.Map[\"data\"] = ToNullString(\"dat\")\n_, err := postgresConn.Exec(`UPDATE table SET my_field = my_field || $1 WHERE id = $2`, data, id)\n</code></pre>\n\n<p>Note that using update will update the map in Hstore, that means that if you just change the value part, it will update the value; but if you change the key and the value, it will add a new pair of (key, value) in your hstore instead of replacing the old ones.</p>\n\n<p>To clarify it a little bit, I put a sample code to test how it works, this code should work with your parameters, I've just changed <code>table</code> to <code>tabl</code> in order to respect postgreSQL keywords:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n\n    _ \"github.com/lib/pq\"\n    \"github.com/lib/pq/hstore\"\n)\n\n//ToNullString invalidates a sql.NullString if empty, validates if not empty\nfunc ToNullString(s string) sql.NullString {\n    return sql.NullString{String: s, Valid: s != \"\"}\n}\n\nfunc main() {\n    var err error //To handle different errors\n    postgresConn, _ := sql.Open(\"postgres\", os.Getenv(\"DB_CONN_URL\"))\n\n    data := hstore.Hstore{}\n    data.Map = make(map[string]sql.NullString)\n\n\n    //Inserting the first element with:\n    //id: \"024b54f2-a477-4715-984c-896bf0446dcf\"\n    //my_field :\"data =&gt; data\"\n    id := \"024b54f2-a477-4715-984c-896bf0446dcf\"\n    data.Map[\"data\"] = ToNullString(\"data\")\n    _, err = postgresConn.Exec(`INSERT INTO tabl(id, my_field) VALUES ($2, $1)`, data, id)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    //Adding a second field in hstore:\n    //id: \"024b54f2-a477-4715-984c-896bf0446dcf\"\n    //my_field :\"data =&gt; data\", \"data2 =&gt; more_data\"\n    data.Map[\"data2\"] = ToNullString(\"more_data\")\n    _, err = postgresConn.Exec(`UPDATE tabl SET my_field = my_field || $1 WHERE id = $2`, data, id)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    //Modifying the first value field:\n    //id: \"024b54f2-a477-4715-984c-896bf0446dcf\"\n    //my_field :\"data =&gt; value, data2 =&gt; more_data\"\n    data.Map[\"data\"] = ToNullString(\"value\")\n    _, err = postgresConn.Exec(`UPDATE tabl SET my_field = my_field || $1 WHERE id = $2`, data, id)\n    if err != nil {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<p>To get more information in order to work with <code>hstore</code> from a sql perspective, you can take a look <a href=\"http://www.postgresqltutorial.com/postgresql-hstore/\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>PD: Don't use <code>table</code> as a tablename because it's a <a href=\"https://www.postgresql.org/docs/11/sql-keywords-appendix.html\" rel=\"nofollow noreferrer\">reserved word</a>.</p>\n\n<p>PD2: I'm using postgresConn.Exec() function only for the demonstration, change it if you need prepared statements, more information when to use Exec() or Query() <a href=\"https://stackoverflow.com/questions/50664648/why-even-use-db-exec-or-prepared-statements-in-golang\">here</a>.</p>\n\n<p>PD3: When using a map, try to not use the same value for the key and the value.</p>\n"}], "owner": {"reputation": 85, "user_id": 8214191, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd2c41221b470d82b32960b5b28278a9?s=128&d=identicon&r=PG&f=1", "display_name": "mlemboy", "link": "https://stackoverflow.com/users/8214191/mlemboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1236, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1552060058, "creation_date": 1551773233, "question_id": 54998054, "link": "https://stackoverflow.com/questions/54998054/how-to-insert-a-hstore-object-using-lib-pq-to-postgres", "title": "How to insert a hstore object using lib/pq to postgres", "body": "<p>For this table,</p>\n\n<pre><code># \\d table\n                            Table \"public.table\"\n  Column   |            Type             | Collation | Nullable |      Default\n------------+-----------------------------+-----------+----------+--------------------\nid         | uuid                        |           | not null | uuid_generate_v4()\nmy_field   | hstore                      |           |          |\nIndexes:\n  \"table_pkey\" PRIMARY KEY, btree (id)\n</code></pre>\n\n<p>How do I update the my_field using <a href=\"https://github.com/lib/pq\" rel=\"nofollow noreferrer\">lib/pq</a>? I tried following,</p>\n\n<pre><code>package \"main\"\n\nimport (\n    \"os\"\n    \"database/sql\"\n  _ \"github.com/lib/pq\"\n)\n\nfunc main() {\n  postgresConn, _ := sql.Open(\"postgres\", os.Getenv(\"DB_CONN_URL\"))\n  id := \"024b54f2-a477-4715-984c-896bf0446dcf\"\n  data := map[string]string{\"data\": \"data\"}\n  postgresConn.QueryRow(\"UPDATE table SET my_field = $1 WHERE id = $2\", data, id)\n}\n</code></pre>\n\n<p>I'm not sure which other type can be used.</p>\n"}, {"tags": ["sql", "postgresql", "go"], "answers": [{"comments": [{"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551773503, "post_id": 54997976, "comment_id": 96752128, "body": "Hello! I also tried it. It don&#39;t work. My IDEA say such warning: <code>Possible resource leak, &#39;defer&#39; is called in a for loop</code>. As you can see in code I have such code: <code>rows.Scan(&amp;question.ID, &amp;question.Text, options)</code> Something wrong with 3rd argument. In console I see error like this: <code>sql: expected 2 destination arguments in Scan, not 3</code>. Do you have any ideas?"}, {"owner": {"reputation": 916, "user_id": 8047506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KS6Eg.jpg?s=128&g=1", "display_name": "Evgeny A. Mamonov", "link": "https://stackoverflow.com/users/8047506/evgeny-a-mamonov"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551773636, "post_id": 54997976, "comment_id": 96752189, "body": "place queries.Close() after for {}"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551773681, "post_id": 54997976, "comment_id": 96752207, "body": "I did it right now. The same incorrect result. I think problem is here  <code>rows.Scan(&amp;question.ID, &amp;question.Text, options)</code>. Any  ideas?"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551774121, "post_id": 54997976, "comment_id": 96752383, "body": "If I remove wrote like this: <code>rows.Scan(&amp;question.ID, &amp;question.Text)</code> it show me id and text correctly in JSON result but <code>options</code> field return <code>null</code>."}, {"owner": {"reputation": 916, "user_id": 8047506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KS6Eg.jpg?s=128&g=1", "display_name": "Evgeny A. Mamonov", "link": "https://stackoverflow.com/users/8047506/evgeny-a-mamonov"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551774351, "post_id": 54997976, "comment_id": 96752503, "body": "please, take a look in fixed answer, I changed queries scan"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551774773, "post_id": 54997976, "comment_id": 96752710, "body": "Can you check your code one more time? It seems to me that this part <code>question.options = append(question.options, option)</code> is not correct. Maybe syntax error. Any ideas?"}, {"owner": {"reputation": 916, "user_id": 8047506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KS6Eg.jpg?s=128&g=1", "display_name": "Evgeny A. Mamonov", "link": "https://stackoverflow.com/users/8047506/evgeny-a-mamonov"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551774944, "post_id": 54997976, "comment_id": 96752788, "body": "Sorry, should be: question.Options = append(question.Options, option)"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551775189, "post_id": 54997976, "comment_id": 96752925, "body": "It show me the same options to both question. In fact first question has 3 option and second question don&#39;t have any option."}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551775385, "post_id": 54997976, "comment_id": 96753020, "body": "It seems to me that <code>&amp;question.ID</code> variable inside SQL statement is syntactically wrong. What you think about that?"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551775695, "post_id": 54997976, "comment_id": 96753163, "body": "I changed it to <code>strconv.Itoa(question.ID)</code>. Now it works."}, {"owner": {"reputation": 916, "user_id": 8047506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KS6Eg.jpg?s=128&g=1", "display_name": "Evgeny A. Mamonov", "link": "https://stackoverflow.com/users/8047506/evgeny-a-mamonov"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551775703, "post_id": 54997976, "comment_id": 96753168, "body": "Fixed query, but I not 100% sure in query with part of <code>$1</code>"}], "tags": [], "owner": {"reputation": 916, "user_id": 8047506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KS6Eg.jpg?s=128&g=1", "display_name": "Evgeny A. Mamonov", "link": "https://stackoverflow.com/users/8047506/evgeny-a-mamonov"}, "is_accepted": true, "score": 1, "last_activity_date": 1551775599, "last_edit_date": 1551775599, "creation_date": 1551772902, "answer_id": 54997976, "question_id": 54997768, "link": "https://stackoverflow.com/questions/54997768/how-to-return-nested-json/54997976#54997976", "title": "How to return nested JSON?", "body": "<p>You should move <code>queries.Close()</code> to the end of loop, like this:</p>\n\n<pre><code>var GetQuestions = func(responseWriter http.ResponseWriter, request *http.Request) {\n    rows, _ := database.DBSQL.Query(\"SELECT * FROM questions;\")\n    defer rows.Close()\n\n    var questions []Question\n\n    for rows.Next() {\n        var question Question\n\n        if err := rows.Scan(&amp;question.ID, &amp;question.Text); err != nil {\n            log.Println(err)\n            continue\n        }\n\n        queries, _ := database.DBSQL.Query(`select options.id as option_id, options.text as option_text from questions_options inner join questions on questions_options.question_id = $1 inner join options on questions_options.option_id = options.id`, question.ID)\n\n        for queries.Next() {\n            var option Option\n            if err := queries.Scan(&amp;option.ID, &amp;option.Text); err != nil {\n                log.Println(err)\n            }\n            question.Options = append(question.Options, option)\n        }\n        queries.Close()\n\n        questions = append(questions, question)\n    }\n    utils.Response(responseWriter, http.StatusOK, questions)\n}\n</code></pre>\n"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 54997976, "answer_count": 1, "score": -2, "last_activity_date": 1551775599, "creation_date": 1551772101, "last_edit_date": 1551773895, "question_id": 54997768, "link": "https://stackoverflow.com/questions/54997768/how-to-return-nested-json", "title": "How to return nested JSON?", "body": "<p>I have 3 table in <strong>PostgreSQL</strong> database.</p>\n\n<p><strong>QUESTIONS</strong> table:</p>\n\n<pre><code>| id (int) | text (text)                          |\n|----------|--------------------------------------|\n| 1        | What is your favorite color?         |\n| 2        | What is your favorite football club? |\n</code></pre>\n\n<p><strong>OPTIONS</strong> table:</p>\n\n<pre><code>| id (int) | text (text) |\n|----------|-------------|\n| 1        | red         |\n| 2        | blue        |\n| 3        | grey        |\n| 4        | green       |\n| 5        | brown       |\n</code></pre>\n\n<p><strong>QUESTIONS_OPTIONS</strong> table:</p>\n\n<pre><code>| question_id (int) | option_id (int) |\n|-------------------|-----------------|\n| 1                 | 1               |\n| 1                 | 2               |\n| 1                 | 3               |\n| 1                 | 4               |\n| 1                 | 5               |\n</code></pre>\n\n<p>In Golang application I create such models:</p>\n\n<pre><code>type Option struct {\n    ID   int    `json:\"option_id\"`\n    Text string `json:\"option_text\"`\n}\n\ntype Question struct {\n    ID int `json:\"question_id\"`\n    Text string `json:\"question_text\"`\n    Options []Option `json:\"options\"`\n}\n</code></pre>\n\n<p>In controller I have such code:</p>\n\n<pre><code>var GetQuestions = func(responseWriter http.ResponseWriter, request *http.Request) {\n    rows, _ := database.DBSQL.Query(\"SELECT * FROM questions;\")\n    defer rows.Close()\n\n    var questions []Question\n\n    for rows.Next() {\n        var question Question\n        var options []Option\n\n        queries, _ := database.DBSQL.Query(`select options.id as option_id, options.text as option_text from questions_options inner join questions on questions_options.question_id = ` + &amp;question.ID + ` inner join options on questions_options.option_id = options.id`)\n        queries.Close()\n\n        for queries.Next() {\n            var option Option\n            if err := queries.Scan(&amp;option.ID, &amp;option.Text); err != nil {\n                log.Println(err)\n            }\n            options = append(options, option)\n        }\n\n        if err := rows.Scan(&amp;question.ID, &amp;question.Text, options); err != nil {  // service raise error in this line: sql: expected 2 destination arguments in Scan, not 3\n            log.Println(err)\n        }\n\n        questions = append(questions, question)\n    }\n    utils.Response(responseWriter, http.StatusOK, questions)\n}\n</code></pre>\n\n<p>When I try to make GET request to take all questions with all there options service such incorrect result:</p>\n\n<pre><code>[\n    {\n        \"question_id\": 0,\n        \"question_text\": \"\",\n        \"options\": null\n    },\n    {\n        \"question_id\": 0,\n        \"question_text\": \"\",\n        \"options\": null\n    }\n]\n</code></pre>\n\n<p>Where I make mistake?</p>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-functions"], "comments": [{"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 0, "creation_date": 1551772022, "post_id": 54997688, "comment_id": 96751493, "body": "Is the statement here is explanatory enough for not putting packages to be imported into <code>main</code> package: <a href=\"https://stackoverflow.com/a/44421114/4636715\">stackoverflow.com/a/44421114/4636715</a>"}, {"owner": {"reputation": 540, "user_id": 5157083, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-_SqRN5amKHc/AAAAAAAAAAI/AAAAAAAAABQ/0hNTUVEG-vQ/photo.jpg?sz=128", "display_name": "Dale King", "link": "https://stackoverflow.com/users/5157083/dale-king"}, "reply_to_user": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 0, "creation_date": 1551827120, "post_id": 54997688, "comment_id": 96780690, "body": "No, I understand that. The question is what&#39;s the best workflow for developing Cloud Functions on local"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 3772127, "user_type": "registered", "profile_image": "https://graph.facebook.com/548636949/picture?type=large", "display_name": "user3772127", "link": "https://stackoverflow.com/users/3772127/user3772127"}, "is_accepted": false, "score": 1, "last_activity_date": 1578690051, "creation_date": 1578690051, "answer_id": 59688943, "question_id": 54997688, "link": "https://stackoverflow.com/questions/54997688/workflow-for-google-cloud-functions-with-golang/59688943#59688943", "title": "Workflow for Google Cloud Functions with Golang", "body": "<p>I was able to create a <code>cli</code> folder in project's top level and then put <code>main.go</code> file using <code>package main</code> and <code>main()</code> function inside it. That allowed me to have separate file <code>cloud_functions.go</code> in root with different package name that has one or more google cloud functions in it. </p>\n"}], "owner": {"reputation": 540, "user_id": 5157083, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-_SqRN5amKHc/AAAAAAAAAAI/AAAAAAAAABQ/0hNTUVEG-vQ/photo.jpg?sz=128", "display_name": "Dale King", "link": "https://stackoverflow.com/users/5157083/dale-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 469, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1578690051, "creation_date": 1551771759, "last_edit_date": 1571914011, "question_id": 54997688, "link": "https://stackoverflow.com/questions/54997688/workflow-for-google-cloud-functions-with-golang", "title": "Workflow for Google Cloud Functions with Golang", "body": "<p>When developing a small Google Cloud Function in Go. I noticed it will throw an error if you have everything in your <code>package main</code> - eg. <code>import \"&lt;whatever&gt;\" is a program, not an importable package</code></p>\n\n<p>So the solution is switch it out to its own package, then deploy. If something goes wrong, throw it back into a package main and work on it locally, then switch it back. </p>\n\n<p>Is this the best workflow? The other option i see is possibly making the Cloud Function its own module and importing it into a main.go file. </p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 1187, "user_id": 10390273, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZnPo-zLAkpE/AAAAAAAAAAI/AAAAAAAAAQ0/eDv2tBJWBWM/photo.jpg?sz=128", "display_name": "ASHWIN RAJEEV", "link": "https://stackoverflow.com/users/10390273/ashwin-rajeev"}, "edited": false, "score": 0, "creation_date": 1551771500, "post_id": 54997127, "comment_id": 96751262, "body": "what is the package that u used for this web socket connection?"}, {"owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "reply_to_user": {"reputation": 1187, "user_id": 10390273, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZnPo-zLAkpE/AAAAAAAAAAI/AAAAAAAAAQ0/eDv2tBJWBWM/photo.jpg?sz=128", "display_name": "ASHWIN RAJEEV", "link": "https://stackoverflow.com/users/10390273/ashwin-rajeev"}, "edited": false, "score": 0, "creation_date": 1551780653, "post_id": 54997127, "comment_id": 96756031, "body": "@ASHWINRAJEEV &quot;golang.org/x/protobuf/proto&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1551772074, "last_edit_date": 1592644375, "creation_date": 1551771638, "answer_id": 54997663, "question_id": 54997127, "link": "https://stackoverflow.com/questions/54997127/how-does-a-websocket-client-know-a-message-has-been-read-completely/54997663#54997663", "title": "How does a WebSocket client know a message has been read completely?", "body": "<p>It looks like you are using the golang.org/x/net/websocket package. It's not possible to reliably detect message boundaries using that package's Read method.</p>\n<p>To fix, use <a href=\"https://godoc.org/golang.org/x/net/websocket#Message\" rel=\"nofollow noreferrer\">websocket.Message</a> to read messages.</p>\n<pre><code>var msg string\nerr := websocket.Message.Receive(ws, &amp;msg)\nif err != nil {\n  // handle error\n}\n// msg is the message\n</code></pre>\n<p>Note that the <a href=\"https://godoc.org/golang.org/x/net/websocket\" rel=\"nofollow noreferrer\">golang.org/x/net/websocket documentation</a> says:</p>\n<blockquote>\n<p>This package currently lacks some features found in an alternative and more actively maintained WebSocket package:</p>\n<p><a href=\"https://godoc.org/github.com/gorilla/websocket\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/gorilla/websocket</a></p>\n</blockquote>\n<p>The Gorilla <a href=\"https://godoc.org/github.com/gorilla/websocket\" rel=\"nofollow noreferrer\">documentation</a> and <a href=\"https://github.com/gorilla/websocket/tree/master/examples\" rel=\"nofollow noreferrer\">examples</a> show how to read messages.</p>\n"}], "owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 386, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1551772287, "creation_date": 1551769413, "last_edit_date": 1551772287, "question_id": 54997127, "link": "https://stackoverflow.com/questions/54997127/how-does-a-websocket-client-know-a-message-has-been-read-completely", "title": "How does a WebSocket client know a message has been read completely?", "body": "<p>I used do it like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    ...\n    ws, err := websocket.Dial(url, \"\", origin)\n    ...\n    var buffer = make([]byte, 512)\n    var rs = make([]byte, 0, 512)\nL:\n    for {\n        m, err := ws.Read(buffer)\n        if err != nil {\n            if err == io.EOF {\n                break L\n            }\n            fmt.Println(err.Error())\n            return\n        }\n        rs = append(rs, buffer[:m]...)\n        if m &lt; 512 {\n            break L\n        }\n    }\n</code></pre>\n\n<p>This has a bug: if the message's length is exactly 512 or 1024 or 2048... the loop never breaks; it will be stuck at <code>ws.Read()</code> and wait without throwing <code>io.EOF</code>. </p>\n\n<p>Afterwards I observed that <code>ws.Len()</code> is always longer than the messages's length by 4.</p>\n\n<p>I rewrote the code as:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    var buffer = make([]byte, 512)\n    var rs = make([]byte, 0, 512)\n    var sum = 0\nL:\n    for {\n        m, err := ws.Read(buffer)\n        if err != nil {\n            if err == io.EOF {\n                break L\n            }\n            fmt.Println(err.Error())\n            return\n        }\n        rs = append(rs, buffer[:m]...)\n        sum+=m\n        if sum &gt;= ws.Len()-4 {\n            break L\n        }\n    }\n</code></pre>\n\n<p>This way is okay.</p>\n\n<p>But the number <code>4</code> is a magic code.</p>\n\n<p>Is there a way to find the message's max length? </p>\n\n<p>Some friends suggest separating the message packet, but I think WebSocket should not consider packet stucking or separating.</p>\n\n<p>What is the most proper way for a WebSocket client to read a message?</p>\n"}, {"tags": ["postgresql", "go"], "answers": [{"tags": [], "owner": {"reputation": 13, "user_id": 3541181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4885e7a66179d142ec4a13d1f7175cb?s=128&d=identicon&r=PG&f=1", "display_name": "samirzach", "link": "https://stackoverflow.com/users/3541181/samirzach"}, "is_accepted": false, "score": 0, "last_activity_date": 1552541368, "last_edit_date": 1552541368, "creation_date": 1551944107, "answer_id": 55038363, "question_id": 54996599, "link": "https://stackoverflow.com/questions/54996599/generating-dto-structs-from-postgres-db-table-schemas-using-xo/55038363#55038363", "title": "Generating DTO structs from postgres DB table schemas using xo", "body": "<p>So from what I've found, the <code>xo</code> package's <a href=\"https://github.com/xo/xo/blob/master/loaders/postgres.go\" rel=\"nofollow noreferrer\">postgreSQL loader</a> uses \"public\" as the default schema, and in my DB, the schema named \"public\" only has the table named <code>schema_migrations</code> and a lot of stored procedures, thus resulting in the above set of appropriately generated code.</p>\n\n<p>On using <code>--schema &lt;correct_schema_name&gt;</code> where <code>&lt;correct_schema_name&gt;</code> is the schema for which the dto structs are to be generated, the correct code is generated.</p>\n\n<p>So, the correct command is : </p>\n\n<p><code>xo --verbose --schema &lt;correct_schema_name&gt; --suffix '.go' pgsql://myusername:mypass@localhost:myport/mydb?sslmode=disable -o internal/qo/models -p qo</code></p>\n\n<p>There are also a couple of settings in the <a href=\"https://github.com/xo/xo/blob/master/loaders/postgres.go\" rel=\"nofollow noreferrer\">gen.sh</a> file which have to be changed as well, such as the type information (specifically the default values) in order to generate the structs with the correct field types. </p>\n\n<p>For example, the default type for timestamps is <code>pq.NullTime</code> (<a href=\"https://github.com/lib/pq\" rel=\"nofollow noreferrer\">pq</a> is a Golang Driver for PostgreSQL), and is to be changed in the <code>gen.sh</code> file in order to set the proper default type.</p>\n"}], "owner": {"reputation": 13, "user_id": 3541181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4885e7a66179d142ec4a13d1f7175cb?s=128&d=identicon&r=PG&f=1", "display_name": "samirzach", "link": "https://stackoverflow.com/users/3541181/samirzach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 176, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1552541368, "creation_date": 1551766938, "last_edit_date": 1551767928, "question_id": 54996599, "link": "https://stackoverflow.com/questions/54996599/generating-dto-structs-from-postgres-db-table-schemas-using-xo", "title": "Generating DTO structs from postgres DB table schemas using xo", "body": "<p>I was just wondering if anyone has worked with <a href=\"https://github.com/xo/xo\" rel=\"nofollow noreferrer\">xo</a>. I have a Postgres DB, with a bunch of tables and stuff.</p>\n\n<p>I can't seem to generate DTO <code>struct</code>s from postgres table structures using <code>xo</code>. </p>\n\n<p>This builtin <code>xo</code> <a href=\"https://github.com/xo/xo/blob/master/templates/postgres.type.go.tpl\" rel=\"nofollow noreferrer\">template</a> seems to create a <code>struct</code>, and I believe <code>xo</code> uses the built-in templates by default, but all I get when I run</p>\n\n<p><code>xo --verbose --suffix '.go' pgsql://myusername:mypass@localhost:myport/mydb?sslmode=disable -o internal/qo/models -p qo</code> </p>\n\n<p>is a bunch of files which are compl etely unrelated to my project or the schemas in my DB. <a href=\"https://i.stack.imgur.com/y5gWh.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/y5gWh.png\" alt=\"Screenshot of one of the files and the entire list of generated files on the left\"></a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 9, "creation_date": 1551752206, "post_id": 54994329, "comment_id": 96745711, "body": "Why do you need to do the conversion?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1551768934, "post_id": 54994329, "comment_id": 96750121, "body": "Duplicate: <a href=\"https://stackoverflow.com/q/48459846/13860\">stackoverflow.com/q/48459846/13860</a>"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 8, "last_activity_date": 1551751966, "creation_date": 1551751966, "answer_id": 54994447, "question_id": 54994329, "link": "https://stackoverflow.com/questions/54994329/how-to-convert-cookie-to-cookie-in-golang/54994447#54994447", "title": "How to convert []*Cookie to []Cookie in Golang", "body": "<p>Go does not provide an automatic conversion from slice of pointers to values to a slice of values.</p>\n\n<p>Write a loop to do the conversion:</p>\n\n<pre><code>result := make([]Cookie, len(source))\nfor i := range result {\n    result[i] = *source[i]\n}\n</code></pre>\n"}], "owner": {"reputation": 165, "user_id": 9394149, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u6728\u6728\u7684\u6728\u5934", "link": "https://stackoverflow.com/users/9394149/%e6%9c%a8%e6%9c%a8%e7%9a%84%e6%9c%a8%e5%a4%b4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 54994447, "answer_count": 1, "score": 0, "last_activity_date": 1551768882, "creation_date": 1551750893, "last_edit_date": 1551768882, "question_id": 54994329, "link": "https://stackoverflow.com/questions/54994329/how-to-convert-cookie-to-cookie-in-golang", "title": "How to convert []*Cookie to []Cookie in Golang", "body": "<p>I have a []*Cookie array, but how to get []Cookie array? I tried to use the * symbol but there was a syntax error.</p>\n"}, {"tags": ["dictionary", "go", "sum"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551746691, "post_id": 54993543, "comment_id": 96744487, "body": "What is the key in the map <code>map[int]Record</code>, or is that unimportant?  What is the the key in the second map? Is it (year, type)?"}, {"owner": {"reputation": 199, "user_id": 1161712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/327027b3c0936d1ab3bd104a27e0f6db?s=128&d=identicon&r=PG", "display_name": "orestisf", "link": "https://stackoverflow.com/users/1161712/orestisf"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551746935, "post_id": 54993543, "comment_id": 96744539, "body": "The key in <code>map[int]Record</code> is just a counter (the Record entries come from an xml being parsed in an earler stage in the code), so it&#39;s not important. For the second map the key should be year, type (the <code>SumRecord</code> struct)."}], "answers": [{"tags": [], "owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "is_accepted": true, "score": 1, "last_activity_date": 1551750784, "creation_date": 1551750784, "answer_id": 54994312, "question_id": 54993543, "link": "https://stackoverflow.com/questions/54993543/how-to-count-number-of-occurrences-of-a-value-in-a-map-with-golang/54994312#54994312", "title": "How to count number of occurrences of a value in a map with Golang?", "body": "<p>Here's an alternative solution to the one provided by @ThunderCat.</p>\n\n<p>This creates a new mapping of a SumRecord to an integer, representing the sum of occurrences for that specific grouping of Type/Year.</p>\n\n<p>See full example <a href=\"https://play.golang.org/p/zQi2HQEwerG\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<pre><code>type Record struct {\n    UID  int\n    Type string\n    Year string\n}\n\ntype SumRecord struct {\n    Type string\n    Year string\n}\n\nm := make(map[int]Record)\n\n// e.g. [{\"1996\",\"non-fiction\"}:4], representing 4 occurrences of {\"1996\",\"non-fiction\"}\nsrMap := make(map[SumRecord]int)\n\n// add records\n\n// loop over records\nfor key := range m {\n    sr := SumRecord{\n        Type: m[key].Type,\n        Year: m[key].Year,\n    }\n    // creates new counter or increments existing pair counter by 1\n    srMap[sr] += 1\n}\n// print all mappings\nfmt.Println(srMap)\n\n// specific example\nfmt.Println(srMap[SumRecord{\n    Year: \"1996\",\n    Type: \"non-fiction\",\n}])\n</code></pre>\n"}], "owner": {"reputation": 199, "user_id": 1161712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/327027b3c0936d1ab3bd104a27e0f6db?s=128&d=identicon&r=PG", "display_name": "orestisf", "link": "https://stackoverflow.com/users/1161712/orestisf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1299, "favorite_count": 0, "accepted_answer_id": 54994312, "answer_count": 1, "score": 1, "last_activity_date": 1551751263, "creation_date": 1551744665, "last_edit_date": 1551747027, "question_id": 54993543, "link": "https://stackoverflow.com/questions/54993543/how-to-count-number-of-occurrences-of-a-value-in-a-map-with-golang", "title": "How to count number of occurrences of a value in a map with Golang?", "body": "<p>I have created a map with the following structure:</p>\n\n<pre><code>m := make(map[int]Record)\n</code></pre>\n\n<p>The Record is a struct as follows:</p>\n\n<pre><code>type Record struct {\n    UID  int\n    Type string\n    Year string\n}\n</code></pre>\n\n<p>The SumRecord struct is supposed to store information about the number of occurences of every given Type / Year Value in map m.</p>\n\n<pre><code>type SumRecord struct {\n    Sum  int\n    Type string\n    Year string\n}\n</code></pre>\n\n<p>The struct is supposed to hold information about book publication years, ie <code>{1, \"Type\": \"fiction\", \"Year\": 1996}, {2, \"Type\": \"non-fiction\", \"Year\": 1996}</code></p>\n\n<p>I am unsuccessfully trying to create a second map where I would store the sum of each publication type per year (similar to a SUM / GROUP BY in SQL). How can I achieve that with Go?</p>\n"}, {"tags": ["go", "antrl4"], "comments": [{"owner": {"reputation": 183, "user_id": 4309283, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zuAuzPeWLrM/AAAAAAAAAAI/AAAAAAAAAEU/iWaZHqnGbaw/photo.jpg?sz=128", "display_name": "Ian A. Mason", "link": "https://stackoverflow.com/users/4309283/ian-a-mason"}, "edited": false, "score": 0, "creation_date": 1551739217, "post_id": 54992660, "comment_id": 96742663, "body": "Another worry is that the official documentation  <a href=\"https://github.com/antlr/antlr4/blob/master/doc/go-target.md\" rel=\"nofollow noreferrer\">github.com/antlr/antlr4/blob/master/doc/go-target.md</a>  has not been updated in over two years."}, {"owner": {"reputation": 611, "user_id": 4281077, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3oOg40JdTy4/AAAAAAAAAAI/AAAAAAAAHNQ/jB3IczOZSFE/photo.jpg?sz=128", "display_name": "Karthik Nayak", "link": "https://stackoverflow.com/users/4281077/karthik-nayak"}, "edited": false, "score": 3, "creation_date": 1551739427, "post_id": 54992660, "comment_id": 96742736, "body": "Might be more useful to raise an issue with the same question"}, {"owner": {"reputation": 183, "user_id": 4309283, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zuAuzPeWLrM/AAAAAAAAAAI/AAAAAAAAAEU/iWaZHqnGbaw/photo.jpg?sz=128", "display_name": "Ian A. Mason", "link": "https://stackoverflow.com/users/4309283/ian-a-mason"}, "reply_to_user": {"reputation": 611, "user_id": 4281077, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3oOg40JdTy4/AAAAAAAAAAI/AAAAAAAAHNQ/jB3IczOZSFE/photo.jpg?sz=128", "display_name": "Karthik Nayak", "link": "https://stackoverflow.com/users/4281077/karthik-nayak"}, "edited": false, "score": 0, "creation_date": 1551739996, "post_id": 54992660, "comment_id": 96742921, "body": "@KarthikNayak, I thought of this, but when I tried I was sent here by the &quot;issue&quot; text."}, {"owner": {"reputation": 183, "user_id": 4309283, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zuAuzPeWLrM/AAAAAAAAAAI/AAAAAAAAAEU/iWaZHqnGbaw/photo.jpg?sz=128", "display_name": "Ian A. Mason", "link": "https://stackoverflow.com/users/4309283/ian-a-mason"}, "reply_to_user": {"reputation": 611, "user_id": 4281077, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3oOg40JdTy4/AAAAAAAAAAI/AAAAAAAAHNQ/jB3IczOZSFE/photo.jpg?sz=128", "display_name": "Karthik Nayak", "link": "https://stackoverflow.com/users/4281077/karthik-nayak"}, "edited": false, "score": 0, "creation_date": 1551881320, "post_id": 54992660, "comment_id": 96802972, "body": "OK so I succumbed <a href=\"https://github.com/antlr/antlr4/issues/2504\" rel=\"nofollow noreferrer\">github.com/antlr/antlr4/issues/2504</a>"}, {"owner": {"reputation": 183, "user_id": 4309283, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zuAuzPeWLrM/AAAAAAAAAAI/AAAAAAAAAEU/iWaZHqnGbaw/photo.jpg?sz=128", "display_name": "Ian A. Mason", "link": "https://stackoverflow.com/users/4309283/ian-a-mason"}, "reply_to_user": {"reputation": 611, "user_id": 4281077, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3oOg40JdTy4/AAAAAAAAAAI/AAAAAAAAHNQ/jB3IczOZSFE/photo.jpg?sz=128", "display_name": "Karthik Nayak", "link": "https://stackoverflow.com/users/4281077/karthik-nayak"}, "edited": false, "score": 0, "creation_date": 1551996338, "post_id": 54992660, "comment_id": 96856771, "body": "crickets over there too."}, {"owner": {"reputation": 611, "user_id": 4281077, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3oOg40JdTy4/AAAAAAAAAAI/AAAAAAAAHNQ/jB3IczOZSFE/photo.jpg?sz=128", "display_name": "Karthik Nayak", "link": "https://stackoverflow.com/users/4281077/karthik-nayak"}, "edited": false, "score": 0, "creation_date": 1552007531, "post_id": 54992660, "comment_id": 96859894, "body": "Not a good sign for using the library."}, {"owner": {"reputation": 3549, "user_id": 1089355, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e801d8674953ed0f2bac2d50de938c55?s=128&d=identicon&r=PG", "display_name": "R71", "link": "https://stackoverflow.com/users/1089355/r71"}, "edited": false, "score": 0, "creation_date": 1606575086, "post_id": 54992660, "comment_id": 115003852, "body": "a working solution has been given at <a href=\"https://stackoverflow.com/questions/65038949/how-to-write-a-antlr4-visitor\" title=\"how to write a antlr4 visitor\">stackoverflow.com/questions/65038949/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 127, "user_id": 3038863, "user_type": "registered", "profile_image": "https://graph.facebook.com/685535147/picture?type=large", "display_name": "Nikunj Yadav", "link": "https://stackoverflow.com/users/3038863/nikunj-yadav"}, "is_accepted": true, "score": 2, "last_activity_date": 1555580722, "creation_date": 1555580722, "answer_id": 55743367, "question_id": 54992660, "link": "https://stackoverflow.com/questions/54992660/is-antlr4s-golang-visitor-pattern-in-a-usable-state/55743367#55743367", "title": "Is antlr4&#39;s golang visitor pattern in a usable state?", "body": "<p>To people who don't click on the issue. The visitor pattern is usable. \nI wrote a sample app <a href=\"https://github.com/nikunjy/antlr-calc-go\" rel=\"nofollow noreferrer\">here</a> \nI don't think it is written the way I was supposed to but it does what I wanted it to do. More discussion can be found on the issue and if I learn something new I will change my code. </p>\n"}], "owner": {"reputation": 183, "user_id": 4309283, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zuAuzPeWLrM/AAAAAAAAAAI/AAAAAAAAAEU/iWaZHqnGbaw/photo.jpg?sz=128", "display_name": "Ian A. Mason", "link": "https://stackoverflow.com/users/4309283/ian-a-mason"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 0, "accepted_answer_id": 55743367, "answer_count": 1, "score": 0, "last_activity_date": 1555580722, "creation_date": 1551738967, "question_id": 54992660, "link": "https://stackoverflow.com/questions/54992660/is-antlr4s-golang-visitor-pattern-in-a-usable-state", "title": "Is antlr4&#39;s golang visitor pattern in a usable state?", "body": "<p>I see no working examples, and I see a few pull requests that remain open.\nI would like to avoid going down the garden path.</p>\n\n<p><a href=\"https://github.com/antlr/antlr4/pull/1807\" rel=\"nofollow noreferrer\">https://github.com/antlr/antlr4/pull/1807</a></p>\n\n<p><a href=\"https://github.com/antlr/antlr4/issues/1843\" rel=\"nofollow noreferrer\">https://github.com/antlr/antlr4/issues/1843</a></p>\n\n<p>There are also pull requests that make me think the golang target might be dead in the water.</p>\n\n<p><a href=\"https://github.com/antlr/antlr4/issues/2152\" rel=\"nofollow noreferrer\">https://github.com/antlr/antlr4/issues/2152</a></p>\n\n<p>So all I am really asking is should I steer clear of golang, or is the documentation just somewhere that google doesn't see :-)</p>\n"}, {"tags": ["email", "google-app-engine", "go", "quota"], "answers": [{"tags": [], "owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "is_accepted": true, "score": 1, "last_activity_date": 1551766342, "creation_date": 1551766342, "answer_id": 54996467, "question_id": 54992331, "link": "https://stackoverflow.com/questions/54992331/recipients-emailed-quota-reached-when-emailing-same-address-multiple-times/54996467#54996467", "title": "&quot;Recipients Emailed&quot; Quota Reached When Emailing Same Address Multiple Times", "body": "<p>Yes, this is how it's actually counted. The resource naming used is misleading.</p>\n\n<p>Note that the measurement units in the table are actually <code>messages</code> and <code>mails</code> not recipients/admins.</p>\n"}], "owner": {"reputation": 3588, "user_id": 157541, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/f71466071ebc4f8f582a0bb5c3efc1bf?s=128&d=identicon&r=PG", "display_name": "sissonb", "link": "https://stackoverflow.com/users/157541/sissonb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 54996467, "answer_count": 1, "score": 0, "last_activity_date": 1551766342, "creation_date": 1551737356, "question_id": 54992331, "link": "https://stackoverflow.com/questions/54992331/recipients-emailed-quota-reached-when-emailing-same-address-multiple-times", "title": "&quot;Recipients Emailed&quot; Quota Reached When Emailing Same Address Multiple Times", "body": "<p>I have written an application on Google App Engine that sends emails to a single address. The application reached it's \"Recipients Emailed\" quota limit during testing. Should the same email address be counted more than once for the \"Recipients Emailed\" quota?</p>\n\n<p>This is the code sending the emails. </p>\n\n<pre><code>import  \"google.golang.org/appengine/mail\"\n</code></pre>\n\n<p>-</p>\n\n<pre><code>msg := &amp;mail.Message{\n    Sender:   \"Order &lt;order@xxxxxxxxxxxx.appspotmail.com&gt;\",\n    To:       []string{\"Ben &lt;xxxxxxxxxxxx@gmail.com&gt;\"},\n    Subject:  \"Order Received\",\n    HTMLBody: htmlBody,\n}\nif err := mail.Send(ctx, msg); err != nil {\n    log.Errorf(ctx, \"Couldn't send email: %v\", err)\n}\n</code></pre>\n\n<p>My Quota Usage\n<a href=\"https://i.stack.imgur.com/X8H8v.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/X8H8v.png\" alt=\"My Quota Usage\"></a></p>\n\n<p><a href=\"https://cloud.google.com/appengine/quotas#Mail\" rel=\"nofollow noreferrer\">Google's API Quotas</a>\n<a href=\"https://i.stack.imgur.com/uxsqK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uxsqK.png\" alt=\"Google&#39;s API Quotas\"></a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551733704, "post_id": 54991346, "comment_id": 96740575, "body": "The documentation explains exactly how to execute a function at a specified time: <a href=\"https://godoc.org/github.com/robfig/cron\" rel=\"nofollow noreferrer\">godoc.org/github.com/robfig/cron</a>"}], "answers": [{"comments": [{"owner": {"reputation": 395, "user_id": 3891947, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/edSJ2.jpg?s=128&g=1", "display_name": "toantruong", "link": "https://stackoverflow.com/users/3891947/toantruong"}, "edited": false, "score": 0, "creation_date": 1577248354, "post_id": 54991686, "comment_id": 105128509, "body": "<code>0 5 * * * *</code> is for every 5 am of the day, not the way you comment in the code."}], "tags": [], "owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "is_accepted": true, "score": 0, "last_activity_date": 1577285204, "last_edit_date": 1577285204, "creation_date": 1551734196, "answer_id": 54991686, "question_id": 54991346, "link": "https://stackoverflow.com/questions/54991346/golang-crontab-execute-function-every-day-at-midnight/54991686#54991686", "title": "golang crontab execute function every day at midnight", "body": "<p>This can be done with the <a href=\"https://github.com/robfig/cron\" rel=\"nofollow noreferrer\">cron</a> library along with a few minor adjustments to your code.</p>\n\n<p>A few things:</p>\n\n<ol>\n<li>Locate your timezone of choice by finding it within a list from the timezone database, i.e. <a href=\"https://en.wikipedia.org/wiki/List_of_tz_database_time_zones\" rel=\"nofollow noreferrer\">here</a></li>\n<li>Load this timezone into the <code>time.LoadLocation</code> or utilize the <code>time.FixedZone</code> method if the <code>.LoadLocation</code> method does not work for you, see the <a href=\"https://golang.org/pkg/time/#LoadLocation\" rel=\"nofollow noreferrer\">time docs</a> for more info on the methods available</li>\n<li>Initialize a new instance of the Cron job runner using the custom location method <code>NewWithLocation</code>, see <a href=\"https://godoc.org/github.com/robfig/cron#NewWithLocation\" rel=\"nofollow noreferrer\">docs here</a></li>\n<li>Edit your first argument to <code>.AddFunc</code> method in order to add a more granular cron schedule, replacing the generic <code>@midnight</code> with a more specific <code>5 0 * * * *</code> representing <em>every day @ 12:05AM</em> or replace with whatever your desired cron execution time is at the new, custom location</li>\n</ol>\n\n<p>Full example below:</p>\n\n<pre><code>// pass in your specific zone name, using USA/LA as example\ncustomLocation := time.LoadLocation(\"America/Los_Angeles\")\n\n// initialize new cron job runner with custom location\ncronHandler := cron.NewWithLocation(customLocation)\n\n// the 0/24th hour and 5th minute of every day\ncronHandler.AddFunc(\"5 0 * * * *\", func() {\n    fmt.Println(\"crontab ping\")\n})\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 11150470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb6fac3b69c6be09c6820a2f49eeb226?s=128&d=identicon&r=PG&f=1", "display_name": "krakiun", "link": "https://stackoverflow.com/users/11150470/krakiun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 720, "favorite_count": 0, "accepted_answer_id": 54991686, "answer_count": 1, "score": -2, "last_activity_date": 1577285204, "creation_date": 1551732690, "question_id": 54991346, "link": "https://stackoverflow.com/questions/54991346/golang-crontab-execute-function-every-day-at-midnight", "title": "golang crontab execute function every day at midnight", "body": "<p>I want to execute function using this crontab library <code>https://github.com/robfig/cron</code> every day at 12:05PM. This is my current code :</p>\n\n<pre><code>cronHandler.AddFunc(\"@midnight\", func() {\nfmt.Println(\"crontab ping\")\n}\n</code></pre>\n\n<p>How i can execute my function using crontab every day at 03:00AM, time zone +2 ? My problem is current function use timezone of my server, and second problem this library not allow to specific specific hour when execute. How i can do this ?</p>\n"}, {"tags": ["go", "file-upload"], "comments": [{"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 1, "creation_date": 1551730202, "post_id": 54989828, "comment_id": 96739151, "body": "So... you have a multipart.Fileheader. First you try to use it as a byte stream (which it is not) and it fails. Then you try to use it as a file name (which it is not either) and it fails. What do you expect to happen?"}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1551730293, "post_id": 54989828, "comment_id": 96739172, "body": "<a href=\"https://golang.org/pkg/mime/multipart/#FileHeader\" rel=\"nofollow noreferrer\">golang.org/pkg/mime/multipart/#FileHeader</a>"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1551730579, "post_id": 54989828, "comment_id": 96739274, "body": "@MadWombat Bassically I don&#39;t know how to extract file bytes and save them. Otherwise I did not bother to ask the question."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551731009, "post_id": 54989828, "comment_id": 96739448, "body": "Call <a href=\"https://golang.org/pkg/mime/multipart/#FileHeader.Open\" rel=\"nofollow noreferrer\">FileHeader.Open</a> to get an io.Reader on uploaded file."}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551731122, "post_id": 54989828, "comment_id": 96739485, "body": "@ThunderCat please show me code. Can not make sense of the docs."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551731717, "post_id": 54989828, "comment_id": 96739733, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/15202448/go-formfile-for-multiple-files\">Go - formFile for multiple files</a>"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551731914, "post_id": 54989828, "comment_id": 96739808, "body": "@ThunderCat I&#39;ve already have that answer in my code. My problem is how to iterate and save the files."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551740851, "post_id": 54989828, "comment_id": 96743201, "body": "The question that I linked to shows how to call FileHeader.Open to get an io.Reader on the uploaded file.  You can io.Copy the reader to the destination file."}], "answers": [{"comments": [{"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1551732133, "post_id": 54991127, "comment_id": 96739910, "body": "Sounds good but have difficulty getting the file extension: at <code>ext = strings.ToLower(path.Ext(file.Filename))</code>"}, {"owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 0, "creation_date": 1551732928, "post_id": 54991127, "comment_id": 96740255, "body": "That code looks correct, but files uploaded through multipart don&#39;t necessarily have filenames attached, which is to say that file.Filename may be an empty string."}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1551786109, "post_id": 54991127, "comment_id": 96759298, "body": "So how can I extract the extension (provided that it exists)?"}], "tags": [], "owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "is_accepted": false, "score": 0, "last_activity_date": 1551733335, "last_edit_date": 1551733335, "creation_date": 1551731698, "answer_id": 54991127, "question_id": 54989828, "link": "https://stackoverflow.com/questions/54989828/cannot-post-multiple-files/54991127#54991127", "title": "Cannot post multiple files", "body": "<p>This is roughly how you do it.</p>\n\n<pre><code>fileHeaders := r.MultipartForm.File[\"files\"]\nvar fileNames []string\n\nfor _, fileHeader := range fileHeaders {\n    file, err := fileHeader.Open()\n    if err != nil {\n        return err\n    }\n    defer file.Close()\n\n    // Generate the destination filename randomly. Using even the passed\n    // extension is a security vulnerability unless you have a whitelist.\n    dest, err := ioutil.TempFile(\"/media/photos\", \"\")\n    if err != nil {\n        return err\n    }\n    defer dest.Close()\n\n    if _, err := io.Copy(dest, file); err != nil {\n        return err\n    }\n\n    fileNames = append(fileNames, dest.Name())\n}\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3956566"}, "edited": false, "score": 0, "creation_date": 1565233639, "post_id": 55008409, "comment_id": 101290626, "body": "what&#39;s your relationship to this user <a href=\"https://stackoverflow.com/users/11513919/grhn\">stackoverflow.com/users/11513919/grhn</a>?"}], "tags": [], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "is_accepted": true, "score": 0, "last_activity_date": 1551807947, "last_edit_date": 1551807947, "creation_date": 1551806828, "answer_id": 55008409, "question_id": 54989828, "link": "https://stackoverflow.com/questions/54989828/cannot-post-multiple-files/55008409#55008409", "title": "Cannot post multiple files", "body": "<p>Alright, thanks to <a href=\"http://sanatgersappa.blogspot.com/2013/03/handling-multiple-file-uploads-in-go.html\" rel=\"nofollow noreferrer\">this</a> great blog post, I found my answer and here it the complete solution for the record:</p>\n\n<pre><code>// PhotoCreatePOST saves multiple photo uploads\nfunc PhotoCreatePOST(w http.ResponseWriter, r *http.Request) {\n\n\n    err := r.ParseMultipartForm(100000)\n    if err != nil {\n        fmt.Println(\"error parsing multiplepart form\", err)\n        return\n    }\n\n    files := r.MultipartForm.File[\"files\"]\n\n    for i, _ := range files { //Iterate over multiple uploaded files\n\n        file, err := files[i].Open()\n        defer file.Close()\n        if err != nil {\n            fmt.Println(\"error opening file \", err)\n            return\n        }\n\n        ext := path.Ext(files[i].Filename)\n\n        //TODO: Verify extension is valid\n\n        filename := GetRandomString(10) + ext\n\n        //create destination file making sure the path is writeable.\n        dst, err := os.Create(\"media/photos/\" + filename)\n        defer dst.Close()\n        if err != nil {\n            fmt.Println(\"error creating destination \", err)\n            return\n        }\n\n        //copy the uploaded file to the destination file\n        if _, err := io.Copy(dst, file); err != nil {\n            fmt.Println(\"error copying file\", err)\n            return\n        }\n\n        fmt.Println(\"Image upload success: \", files[i].Filename)\n    }\n\n    fmt.Println(\"all are uploaded\")\n\n    PhotoCreateGET(w, r)\n    return \n\n}\n\n//Generate random filename (never trust user input!)\nvar letterRunes = []rune(\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123456789\")\n\n// GetString returns a random string\nfunc GetRandomString(n int) string {\n    rand.Seed(time.Now().UnixNano())\n    b := make([]rune, n)\n    for i := range b {\n        b[i] = letterRunes[rand.Intn(len(letterRunes))]\n    }\n    return string(b)\n}\n</code></pre>\n\n<p>And the upload form:</p>\n\n<pre><code>&lt;form method=\"post\" action=\"/create/photo\" enctype=\"multipart/form-data\"&gt;\n        &lt;input type=\"file\"  name=\"files\"  multiple&gt;\n        &lt;input type=\"hidden\" name=\"token\" value=\"{{.token}}\"&gt;\n        &lt;button title=\"submit\" type=\"submit\" &gt;Save &lt;/button&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>Voila. Hopefully it can save some time for others.            </p>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1154, "favorite_count": 0, "accepted_answer_id": 55008409, "answer_count": 2, "score": -4, "last_activity_date": 1565178208, "creation_date": 1551725945, "last_edit_date": 1565178208, "question_id": 54989828, "link": "https://stackoverflow.com/questions/54989828/cannot-post-multiple-files", "title": "Cannot post multiple files", "body": "<p>I know how to upload a single file but now I'm trying to upload multiple files in the same Go function. </p>\n\n<p>Here is my code:</p>\n\n<pre><code>func PhotoCreatePOST(w http.ResponseWriter, r  *http.Request) {\n    var err error\n\nr.ParseMultipartForm(32 &lt;&lt; 20) // 32MB is the default used by FormFile\nfhs := r.MultipartForm.File[\"files\"]\n\nvar fileNames []string\nvar filename string\nvar ext string\nfor _, file := range fhs { //Iterate over multiple uploaded files\n    if err != nil {\n        log.Fatal(err)\n    } else {\n        dir, err := os.Getwd()\n        if err != nil {\n            log.Fatal(err)\n        }\n        ext = strings.ToLower(path.Ext(file.Filename))\n\n        filename = path.Join(random.RandString(10) + ext)\n\n        destFolder := \"/media/photos\"\n        if _, err := os.Stat(destFolder); os.IsNotExist(err) {\n            os.Mkdir(destFolder, 0755)\n        }\n\n        //destination Path. The string which is Saving in DB\n        savePath := destFolder + \"/\" + filename\n\n        err = ioutil.WriteFile(savePath, file, 0777) //&lt;--Here is the problem\n        if err != nil {\n            log.Println(err)\n            io.WriteString(w, err.Error())\n            return\n        }\n\n    }\n}\n\n//Add file url to the slice\nfileNames = append(fileNames, filename)\n</code></pre>\n\n<p>}</p>\n\n<p>But I get this error:</p>\n\n<pre><code>cannot use file (type *multipart.FileHeader) as type []byte in argument to ioutil.WriteFile\n</code></pre>\n\n<p>I've tried to read the <code>file</code> into bytes like this:</p>\n\n<pre><code>b, err := ioutil.ReadFile(file) \n    if err != nil {\n        fmt.Print(err)\n    }\n</code></pre>\n\n<p>And save <code>b</code> instead of <code>file</code>. </p>\n\n<p>But then I get another error that </p>\n\n<pre><code>can not read *multipart.Fileheader as string \n</code></pre>\n\n<p>How can I fix this?</p>\n"}, {"tags": ["go", "amazon-redshift"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1551721571, "post_id": 54988764, "comment_id": 96735132, "body": "Postgres tables have a strictly-defined schema, why can&#39;t you map your colums to well-defined types?"}, {"owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551721848, "post_id": 54988764, "comment_id": 96735272, "body": "@Adrian because this service powers a web based SQL editor, which takes lots of SQL queries and returns JSON data. It&#39;s used for loads of different tables. Currently numbers are being converted to []uint8, which <code>json.Marshal</code> converts into base64 strings. So in the results, all numbers come back as base64!   It&#39;s not a typical service which is modelled and has structs, it&#39;s doing generic database jobs and returning results pretty much."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551722487, "post_id": 54988764, "comment_id": 96735581, "body": "Have you tried bigendian? At least it seems like that&#39;s what <code>lib&#47;pq</code> is using. <a href=\"https://github.com/lib/pq/search?q=endian&amp;unscoped_q=endian\" rel=\"nofollow noreferrer\">github.com/lib/pq/search?q=endian&amp;unscoped_q=endian</a>"}, {"owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1551722635, "post_id": 54988764, "comment_id": 96735651, "body": "@mkopriva BigEndian 16 gives me an integer back that&#39;s completely wrong, BigEndian 32 throw an out of range error"}, {"owner": {"reputation": 1073, "user_id": 4546002, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Vu4tnG7w3VI/AAAAAAAAAAI/AAAAAAAABj0/zsVwkswRAoA/photo.jpg?sz=128", "display_name": "Mark R.", "link": "https://stackoverflow.com/users/4546002/mark-r"}, "edited": false, "score": 1, "creation_date": 1551722863, "post_id": 54988764, "comment_id": 96735742, "body": "I think you might be interpreting a string ([]uint8 == []byte), actually. See <a href=\"https://play.golang.org/p/Rfpey2NPiI7\" rel=\"nofollow noreferrer\">play.golang.org/p/Rfpey2NPiI7</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551723028, "post_id": 54988764, "comment_id": 96735815, "body": "@EwanValentine I see, by &quot;numeric columns&quot; do you mean the arbitrary precision type <code>numeric</code>? Or an <code>integer</code> type, or <code>real</code>?"}, {"owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "reply_to_user": {"reputation": 1073, "user_id": 4546002, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Vu4tnG7w3VI/AAAAAAAAAAI/AAAAAAAABj0/zsVwkswRAoA/photo.jpg?sz=128", "display_name": "Mark R.", "link": "https://stackoverflow.com/users/4546002/mark-r"}, "edited": false, "score": 0, "creation_date": 1551723347, "post_id": 54988764, "comment_id": 96735977, "body": "@MarkR. that&#39;s absolutely correct, all I needed to do is convert it into string and I got the correct value, thank you so much, great spot! Post that as a separate comment and I&#39;ll accept that as the answer. Thanks to everyone else as well."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1551725065, "post_id": 54989241, "comment_id": 96736819, "body": "Answers are required to be complete, without following links. For this reason, I have copied the substance of your answer&#39;s code into the answer directly, to avoid your answer being deleted."}], "tags": [], "owner": {"reputation": 1073, "user_id": 4546002, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Vu4tnG7w3VI/AAAAAAAAAAI/AAAAAAAABj0/zsVwkswRAoA/photo.jpg?sz=128", "display_name": "Mark R.", "link": "https://stackoverflow.com/users/4546002/mark-r"}, "is_accepted": true, "score": 1, "last_activity_date": 1551725043, "last_edit_date": 1551725043, "creation_date": 1551723524, "answer_id": 54989241, "question_id": 54988764, "link": "https://stackoverflow.com/questions/54988764/redshift-returns-a-uint8-instead-of-an-integer-converting-between-them-return/54989241#54989241", "title": "Redshift returns a []uint8 instead of an integer, converting between them returns incorrect values", "body": "<p>I think you might be interpreting a string ([]uint8 == []byte), actually. See <a href=\"https://play.golang.org/p/Rfpey2NPiI7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Rfpey2NPiI7</a></p>\n\n<pre><code>originalValue := []uint8{0x32, 0x30, 0x30} // \"200\"\nbValue := []byte(originalValue) // byte is a uint8 anyway\nfmt.Printf(\"Converted to uint16: %d\\n\", binary.LittleEndian.Uint16(bValue))\nfmt.Printf(\"Actual value: %s\", string(bValue))\n</code></pre>\n\n<p>This has bitten me before when dealing with <code>pq</code> and some crypto code.</p>\n"}], "owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 54989241, "answer_count": 1, "score": 1, "last_activity_date": 1551751748, "creation_date": 1551721467, "last_edit_date": 1551751748, "question_id": 54988764, "link": "https://stackoverflow.com/questions/54988764/redshift-returns-a-uint8-instead-of-an-integer-converting-between-them-return", "title": "Redshift returns a []uint8 instead of an integer, converting between them returns incorrect values", "body": "<p>I have a service which takes a SQL Query, runs the query on Amazon Redshift, using the database/sql drivers. However, I can't convert the result to a struct, because the queries are big data tasks on various tables, not created within this service. So I have to return a 'loose' data structure. I'm parsing the data returned into JSON and storing it in S3.</p>\n\n<p>However, I'm having some odd issues with the data types returned. The queries, for numeric columns, return a map of uint8's instead of a numeric value. I understand that this is because the database driver can't have an opinion on what to convert it to because it could be imprecise. But I can't seem to be able to convert between []uint8 and an integer either. </p>\n\n<p>Here's my code that queries the database:</p>\n\n<pre><code>// Execute executes SQL commands\nfunc (r *Runner) Execute(query string, args ...interface{}) (types.Results, error) {\n    var results types.Results\n    rows, err := r.db.Query(query, args...)\n    if err != nil {\n        return results, err\n    }\n\n    columns, _ := rows.Columns()\n    colNum := len(columns)\n\n    values := make([]interface{}, colNum)\n    for i := range values {\n        var ii interface{}\n        values[i] = &amp;ii\n    }\n\n    for rows.Next() {\n        rows.Scan(values...)\n        result := make(types.Result)\n        for i, colName := range columns {\n            rawValue := *(values[i].(*interface{}))\n            if reflect.TypeOf(rawValue).String() == \"[]uint8\" {\n                byteVal := rawValue.([]byte)\n                val := Intfrombytes(byteVal)\n                log.Println(\"Converted:\", val)\n            }\n            result[colName] = rawValue\n        }\n        results = append(results, result)\n    }\n    return results, nil\n}\n</code></pre>\n\n<p>I created the following function to attempt to convert between <code>[]uint8</code> and <code>uint32</code>. </p>\n\n<pre><code>func Intfrombytes(bytes []uint8) uint16 {\n    bits := binary.LittleEndian.Uint16(bytes)\n    return bits\n}\n</code></pre>\n\n<p>However, if I insert <code>200</code> into that table, I get back <code>12339</code>. The approach feels pretty flaky, generally. I'm doubting my decision to use Go for this as I'm dealing with undefined, loose data structures.</p>\n\n<p>Is there a better approach to generic queries such as my example, or is there a way I can convert my numeric results into an integer? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1551721505, "post_id": 54988728, "comment_id": 96735102, "body": "Hard to tell why your code does this without seeing your code."}, {"owner": {"reputation": 51, "user_id": 10967256, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WmoAclaLd1A/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQN4T3K3MHcbtcjgIEJ2k5oGKGdS0Q/mo/photo.jpg?sz=128", "display_name": "Deniz Tohumcu", "link": "https://stackoverflow.com/users/10967256/deniz-tohumcu"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1551721591, "post_id": 54988728, "comment_id": 96735142, "body": "&#39;func prime_factors_mult(x []int)(y [][]int){// Problem 36 \tin :=[]int{0,0} \tvar k [][]int \tfor _,item := range x{ \t\ttok := 0 \t\tfor i:=0;i&lt;len(x);i++{ \t\t\tif item == x[i]{ \t\t\t\ttok++ \t\t\t} \t\t} \t\tin[0]=item \t\tin[1]=tok \t\tk=append(k,in) \t} \tfor _,item := range k{ \t\tfor i:=0;i&lt;len(k);i++{ \t\t\tif item[0] != k[i][0]{ \t\t\t\ty = append(y,item) \t\t\t} \t\t} \t} \treturn }&#39;"}], "answers": [{"tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": true, "score": 2, "last_activity_date": 1551721806, "creation_date": 1551721806, "answer_id": 54988837, "question_id": 54988728, "link": "https://stackoverflow.com/questions/54988728/why-does-my-append-function-change-every-member-of-my-slice-to-the-new-item-to-a/54988837#54988837", "title": "Why does my append function change every member of my slice to the new item to add?", "body": "<p>You create your <code>in</code> slice once and then modify it each time, so you add the exact same object to <code>k</code> each time.</p>\n\n<p>Append a <em>new</em> slice instead:</p>\n\n<pre><code>k=append(k,[]int{item, tok})\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 51, "user_id": 10967256, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WmoAclaLd1A/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQN4T3K3MHcbtcjgIEJ2k5oGKGdS0Q/mo/photo.jpg?sz=128", "display_name": "Deniz Tohumcu", "link": "https://stackoverflow.com/users/10967256/deniz-tohumcu"}, "edited": false, "score": 0, "creation_date": 1551724170, "post_id": 54989258, "comment_id": 96736367, "body": "thanx for the details :)"}], "tags": [], "owner": {"reputation": 31, "user_id": 3828931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55a8568ad85b00572d71adfe82f0318a?s=128&d=identicon&r=PG&f=1", "display_name": "Alon", "link": "https://stackoverflow.com/users/3828931/alon"}, "is_accepted": false, "score": 0, "last_activity_date": 1551723961, "last_edit_date": 1551723961, "creation_date": 1551723590, "answer_id": 54989258, "question_id": 54988728, "link": "https://stackoverflow.com/questions/54988728/why-does-my-append-function-change-every-member-of-my-slice-to-the-new-item-to-a/54989258#54989258", "title": "Why does my append function change every member of my slice to the new item to add?", "body": "<p>Range's syntax returns the index and a reference of the value each time. You choose to use the reference both times, and the value gets modified but you keep on appending the same address. That's why you're only getting the last value, the range loop keeps modifying it and you're left with the last value from the loop.</p>\n\n<p>approach 1:</p>\n\n<p>To avoid this, change your loops to be <code>for index := range k</code> instead of <code>for _,item := range k</code> use the index from your loop and append <code>k[index]</code> instead of item.</p>\n\n<p>approach 2: </p>\n\n<pre><code>for _, item range something {\n  item := item\n</code></pre>\n\n<p>If you want to keep your syntax as is, you can create a local variable inside the loop, using the variable you got from range. Add <code>item := item</code> in the first line of both your loop blocks. though it looks weird, this will allocate new <code>item</code> every time, and you will append and use <em>that</em> variable instead.</p>\n"}], "owner": {"reputation": 51, "user_id": 10967256, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WmoAclaLd1A/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQN4T3K3MHcbtcjgIEJ2k5oGKGdS0Q/mo/photo.jpg?sz=128", "display_name": "Deniz Tohumcu", "link": "https://stackoverflow.com/users/10967256/deniz-tohumcu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 54988837, "answer_count": 2, "score": 0, "last_activity_date": 1551723961, "creation_date": 1551721310, "last_edit_date": 1551721673, "question_id": 54988728, "link": "https://stackoverflow.com/questions/54988728/why-does-my-append-function-change-every-member-of-my-slice-to-the-new-item-to-a", "title": "Why does my append function change every member of my slice to the new item to add?", "body": "<p>I am making a simple prime factor function that can put a slice that is <code>[][]int</code> like</p>\n\n<pre><code>prime_factors_mult(315) =&gt; [[3,2],[5,1],[7,1]]\n</code></pre>\n\n<p>but instead of this result I get <code>[[7,1][7,1][7,1][7,1]]</code> which is afterwards reduced to a empty slice because they repeat them selfs. I tried to look at it with step by step and it changes all the values to the last append. What should I do to avoid this ?</p>\n\n<pre><code>func prime_factors_mult(x []int)(y [][]int){// Problem 36\n    in :=[]int{0,0}\n    var k [][]int\n    for _,item := range x{\n        tok := 0\n        for i:=0;i&lt;len(x);i++{\n            if item == x[i]{\n                tok++\n            }\n        }\n        in[0]=item\n        in[1]=tok\n        k=append(k,in)\n    }\n    for _,item := range k{\n        for i:=0;i&lt;len(k);i++{\n            if item[0] != k[i][0]{\n                y = append(y,item)\n            }\n        }\n    }\n    return\n}\n</code></pre>\n"}, {"tags": ["mysql", "go", "mariadb", "sqlx"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1551717544, "post_id": 54987539, "comment_id": 96733087, "body": "Presumably the protocol implementation is slightly different between the databases, and one transmits a byte array while the other sends an integer of some sort. Don&#39;t use the empty interface if you want type safety. The empty interface tells the driver &quot;do whatever works best, I don&#39;t care about the type&quot;."}, {"owner": {"reputation": 395, "user_id": 6055952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e33c8f1ffda4301a131c2055d2766c42?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Varga", "link": "https://stackoverflow.com/users/6055952/matthew-varga"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1551718278, "post_id": 54987539, "comment_id": 96733499, "body": "Thank you @Peter, I believe this was the issue. I have changed the type from <code>interface</code> to <code>*int</code> and my problems are resolved :)"}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1552556295, "post_id": 54987539, "comment_id": 97057436, "body": "<code>&lt;snide-remark&gt;</code>Another example of how 3rd party packages complicate access to MySQL<code>&lt;&#47;snide-remark&gt;</code>"}], "owner": {"reputation": 395, "user_id": 6055952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e33c8f1ffda4301a131c2055d2766c42?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Varga", "link": "https://stackoverflow.com/users/6055952/matthew-varga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1551717028, "creation_date": 1551717028, "question_id": 54987539, "link": "https://stackoverflow.com/questions/54987539/go-difference-in-mysql-and-mariadb-select-return-type", "title": "Go difference in MySQL and MariaDB SELECT return type", "body": "<p>When executing a <code>SELECT</code> query, and storing the results in a struct with a field of type <code>interface</code>, the resulting type differs between <code>int64</code> and <code>[]uint8</code> depending if the db I am using is a MySQL database, or MariaDB.</p>\n\n<p>This is related to a previous question that I had asked (and was answered) : <a href=\"https://stackoverflow.com/questions/54833794/go-sql-query-inconsistency\">Go SQL query inconsistency</a></p>\n\n<p>Given an interface as follows:</p>\n\n<pre><code>type Result struct {\n    Afield string      `db:\"A\"`\n    Bfield interface{} `db:\"B\"`\n    Cfield string      `db:\"C\"`\n    Dfield string      `db:\"D\"`\n}\n</code></pre>\n\n<p>And database table:</p>\n\n<pre><code>A : VARCHAR(50)\nB : INT\nC : VARCHAR(50)\nD : VARCHAR(50)\n</code></pre>\n\n<p>The query I would like to execute:</p>\n\n<blockquote>\n  <p>SELECT A, B, C, D FROM table WHERE A=\"a\"</p>\n</blockquote>\n\n<p>How it is being executed:</p>\n\n<pre><code>db.Get(&amp;result, `SELECT A, B, C, D FROM table WHERE A=?`, \"a\")\n</code></pre>\n\n<p><strong>The issue</strong></p>\n\n<p>If being executed on a MySQL database, the type of <code>Bfield</code> is <code>int64</code> (desired), However if being executed on MariaDB, the type is instead <code>[]uint8</code>. </p>\n\n<p><strong>Why is the type of Bfield different, depening on if the query is executed on a MySQL db or MariaDB?</strong></p>\n\n<p>Potentially useful info:</p>\n\n<p>db is of type: <code>*sqlx.DB</code>, then passed to function that executes the query, where db is type <code>Connection</code>.</p>\n\n<pre><code>// Connection is an interface for making queries.\ntype Connection interface {\n    Exec(query string, args ...interface{}) (sql.Result, error)\n    Get(dest interface{}, query string, args ...interface{}) error\n    Select(dest interface{}, query string, args ...interface{}) error\n}\n</code></pre>\n\n<p>I am using <a href=\"https://github.com/jmoiron/sqlx\" rel=\"nofollow noreferrer\">https://github.com/jmoiron/sqlx</a></p>\n"}, {"tags": ["go", "goquery"], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 2, "last_activity_date": 1551725109, "creation_date": 1551725109, "answer_id": 54989611, "question_id": 54986594, "link": "https://stackoverflow.com/questions/54986594/how-to-find-out-if-selector-is-at-first-or-last-position/54989611#54989611", "title": "How to find out if selector is at first or last position", "body": "<p>Most likely you'd have to write a function that returns the funciton you are using, so you get access to the original selections length, something like:</p>\n\n<pre><code>type iterator func(int, *goquery.Selection)\n\nfunc dumpElementFrom(s *goquery.Selection) iterator {\n    lastIndex := s.Size() - 1\n    return func(i int, sel *goquery.Selection) {\n        if i == lastIndex {\n            fmt.Println(\"Last Element\")\n        }\n        sel.Contents().Each(dumpElement)\n    }\n}\n\n\nfunc startRecursion(r io.Reader) error {\n    g, err := goquery.NewDocumentFromReader(r)\n    if err != nil {\n        return err\n    }\n\n    g.Find(\":root &gt; body\").Each(dumpElementFrom(g))\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 13244, "user_id": 317915, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/86d01c87cc6f22c8445661b72b6b0d78?s=128&d=identicon&r=PG", "display_name": "topskip", "link": "https://stackoverflow.com/users/317915/topskip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 0, "accepted_answer_id": 54989611, "answer_count": 1, "score": 0, "last_activity_date": 1551725109, "creation_date": 1551714012, "question_id": 54986594, "link": "https://stackoverflow.com/questions/54986594/how-to-find-out-if-selector-is-at-first-or-last-position", "title": "How to find out if selector is at first or last position", "body": "<p>I use <a href=\"https://github.com/PuerkitoBio/goquery\" rel=\"nofollow noreferrer\">goquery's</a> function <a href=\"https://godoc.org/github.com/PuerkitoBio/goquery#Selection.Each\" rel=\"nofollow noreferrer\"><code>.Each()</code></a> to recurse into the child elements. Is there a way to find out if this is the first (or last) child of a parent? I try to remove starting and trailing whitespace of HTML nodes. Checking for the first child is probably a matter of testing <code>i == 0</code>. But what about the last child element?</p>\n\n<p>This is my code so far:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"strings\"\n\n    \"github.com/PuerkitoBio/goquery\"\n)\n\n// recursive function\nfunc dumpElement(i int, sel *goquery.Selection) {\n    fmt.Println(\"dump Element - is this the first or last element? I don't know\")\n    sel.Contents().Each(dumpElement)\n}\n\nfunc startRecursion(r io.Reader) error {\n    g, err := goquery.NewDocumentFromReader(r)\n    if err != nil {\n        return err\n    }\n\n    g.Find(\":root &gt; body\").Each(dumpElement)\n    return nil\n}\n\nfunc main() {\n    doc := `&lt;!DOCTYPE html&gt;\n    &lt;html&gt;&lt;head&gt;&lt;title&gt;foo&lt;/title&gt;&lt;/head&gt;&lt;body&gt;\n    &lt;div class=\"bla\"&gt;foo &lt;b&gt; bar &lt;/b&gt; baz&lt;/div&gt;\n    &lt;/body&gt;&lt;/html&gt;`\n\n    if err := startRecursion(strings.NewReader(doc)); err != nil {\n        os.Exit(-1)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "load-balancing"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1551715276, "post_id": 54986485, "comment_id": 96731782, "body": "You mean weighted random in general? this might be helpful: <a href=\"https://stackoverflow.com/questions/39551985/weighted-random-in-golang\" title=\"weighted random in golang\">stackoverflow.com/questions/39551985/weighted-random-in-gola&zwnj;&#8203;ng</a>"}, {"owner": {"reputation": 532, "user_id": 454335, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KQvh0.jpg?s=128&g=1", "display_name": "vinni_f", "link": "https://stackoverflow.com/users/454335/vinni-f"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1551715950, "post_id": 54986485, "comment_id": 96732140, "body": "hum weighted yes but weighted based on the endpoint response time."}, {"owner": {"reputation": 1073, "user_id": 4546002, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Vu4tnG7w3VI/AAAAAAAAAAI/AAAAAAAABj0/zsVwkswRAoA/photo.jpg?sz=128", "display_name": "Mark R.", "link": "https://stackoverflow.com/users/4546002/mark-r"}, "edited": false, "score": 0, "creation_date": 1551720557, "post_id": 54986485, "comment_id": 96734679, "body": "@vinni_f you can use something like <a href=\"https://github.com/cxfcxf/weightedchoice/blob/master/weightedchoice.go\" rel=\"nofollow noreferrer\">github.com/cxfcxf/weightedchoice/blob/master/weightedchoice.&zwnj;&#8203;go</a> and re-normalize the weights based on your metrics once in a while"}], "answers": [{"comments": [{"owner": {"reputation": 532, "user_id": 454335, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KQvh0.jpg?s=128&g=1", "display_name": "vinni_f", "link": "https://stackoverflow.com/users/454335/vinni-f"}, "edited": false, "score": 0, "creation_date": 1551803947, "post_id": 54991667, "comment_id": 96770214, "body": "Thanks @leolara. Thanks a good structure to jump start me. I can&#39;t accept that as solution tho because it does not deal with updating the weight based on response time of the endpoint. Again, thanks, I really like your approach."}, {"owner": {"reputation": 49, "user_id": 11149211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d16a92cd94ba2cd8cd0613eda6f6c2c2?s=128&d=identicon&r=PG&f=1", "display_name": "leolara", "link": "https://stackoverflow.com/users/11149211/leolara"}, "reply_to_user": {"reputation": 532, "user_id": 454335, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KQvh0.jpg?s=128&g=1", "display_name": "vinni_f", "link": "https://stackoverflow.com/users/454335/vinni-f"}, "edited": false, "score": 0, "creation_date": 1551892588, "post_id": 54991667, "comment_id": 96810120, "body": "Well that is another part, you should just update every x minutes the weights depending on the avg response time. I wouldn&#39;t make it, monolitic: one responsibility is the weighted load balancing and another would be the updating of the weights based a metric"}, {"owner": {"reputation": 532, "user_id": 454335, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KQvh0.jpg?s=128&g=1", "display_name": "vinni_f", "link": "https://stackoverflow.com/users/454335/vinni-f"}, "edited": false, "score": 0, "creation_date": 1551899393, "post_id": 54991667, "comment_id": 96813468, "body": "Also, could you please update your answer to address the fact that you are not talking about updating the weight with the response time. Simply copy-pasting your previous comment into the answer and I&#39;ll accept it! thanks"}, {"owner": {"reputation": 49, "user_id": 11149211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d16a92cd94ba2cd8cd0613eda6f6c2c2?s=128&d=identicon&r=PG&f=1", "display_name": "leolara", "link": "https://stackoverflow.com/users/11149211/leolara"}, "reply_to_user": {"reputation": 532, "user_id": 454335, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KQvh0.jpg?s=128&g=1", "display_name": "vinni_f", "link": "https://stackoverflow.com/users/454335/vinni-f"}, "edited": false, "score": 0, "creation_date": 1551959084, "post_id": 54991667, "comment_id": 96836714, "body": "I added to the answer as requested. Cheers!"}], "tags": [], "owner": {"reputation": 49, "user_id": 11149211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d16a92cd94ba2cd8cd0613eda6f6c2c2?s=128&d=identicon&r=PG&f=1", "display_name": "leolara", "link": "https://stackoverflow.com/users/11149211/leolara"}, "is_accepted": true, "score": 0, "last_activity_date": 1551959044, "last_edit_date": 1551959044, "creation_date": 1551734084, "answer_id": 54991667, "question_id": 54986485, "link": "https://stackoverflow.com/questions/54986485/golang-client-side-load-balancer-when-not-serving-http/54991667#54991667", "title": "golang client side load balancer when not serving http", "body": "<p>There is a very simple algorithm for weighted random selection:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n)\n\ntype Endpoint struct {\n    URL    string\n    Weight int\n}\n\nfunc RandomWeightedSelector(endpoints []Endpoint) Endpoint {\n    // this first loop should be optimised so it only gets computed once\n    max := 0\n    for _, endpoint := range endpoints {\n        max = max + endpoint.Weight\n    }\n\n    r := rand.Intn(max)\n    for _, endpoint := range endpoints {\n        if r &lt; endpoint.Weight {\n            return endpoint\n        } else {\n            r = r - endpoint.Weight\n        }\n    }\n    // should never get to this point because r is smaller than max\n    return Endpoint{}\n}\n\nfunc main() {\n    endpoints := []Endpoint{\n        {Weight: 1, URL: \"https://web1.example.com\"},\n        {Weight: 2, URL: \"https://web2.example.com\"},\n    }\n\n    count1 := 0\n    count2 := 0\n\n    for i := 0; i &lt; 100; i++ {\n        switch RandomWeightedSelector(endpoints).URL {\n        case \"https://web1.example.com\":\n            count1++\n        case \"https://web2.example.com\":\n            count2++\n        }\n    }\n    fmt.Println(\"Times web1: \", count1)\n    fmt.Println(\"Times web2: \", count2)\n}\n</code></pre>\n\n<p>In can be optimized, this is the most naive. Definitely for production you should not calculate max every time, but apart from that, this basically is the solution.</p>\n\n<p>Here a more profesional and OO version, that does not recompute max everytime:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n)\n\ntype Endpoint struct {\n    URL    string\n    Weight int\n}\n\ntype RandomWeightedSelector struct {\n    max       int\n    endpoints []Endpoint\n}\n\nfunc (rws *RandomWeightedSelector) AddEndpoint(endpoint Endpoint) {\n    rws.endpoints = append(rws.endpoints, endpoint)\n    rws.max += endpoint.Weight\n}\n\nfunc (rws *RandomWeightedSelector) Select() Endpoint {\n    r := rand.Intn(rws.max)\n    for _, endpoint := range rws.endpoints {\n        if r &lt; endpoint.Weight {\n            return endpoint\n        } else {\n            r = r - endpoint.Weight\n        }\n    }\n    // should never get to this point because r is smaller than max\n    return Endpoint{}\n}\n\nfunc main() {\n    var rws RandomWeightedSelector\n    rws.AddEndpoint(Endpoint{Weight: 1, URL: \"https://web1.example.com\"})\n    rws.AddEndpoint(Endpoint{Weight: 2, URL: \"https://web2.example.com\"})\n\n    count1 := 0\n    count2 := 0\n\n    for i := 0; i &lt; 100; i++ {\n        switch rws.Select().URL {\n        case \"https://web1.example.com\":\n            count1++\n        case \"https://web2.example.com\":\n            count2++\n        }\n    }\n    fmt.Println(\"Times web1: \", count1)\n    fmt.Println(\"Times web2: \", count2)\n}\n</code></pre>\n\n<p>For the part of updating weights based on a metric like endpoint latency, I would create a different object that uses this metrics to update the weights in the RandomWeightedSelector object. I think to implement it all together would be against single responsibility.</p>\n"}], "owner": {"reputation": 532, "user_id": 454335, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/KQvh0.jpg?s=128&g=1", "display_name": "vinni_f", "link": "https://stackoverflow.com/users/454335/vinni-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 0, "accepted_answer_id": 54991667, "answer_count": 1, "score": 0, "last_activity_date": 1551959044, "creation_date": 1551713669, "question_id": 54986485, "link": "https://stackoverflow.com/questions/54986485/golang-client-side-load-balancer-when-not-serving-http", "title": "golang client side load balancer when not serving http", "body": "<p>As a <strong>golang n00b</strong>, I have a go program that reads messages into kafka, modifies them then post them to one of the http endpoints in a list. </p>\n\n<p>As of now we do some really basic round robin with random</p>\n\n<pre><code>cur := rand.Int() % len(httpEndpointList)\n</code></pre>\n\n<p>I'd like to improve that and add weight to the endpoints based on their response time or something similar.</p>\n\n<p>I've looked into libraries but all I seem to find are written to be used as middleware using http.Handle. For example see the <a href=\"https://godoc.org/github.com/vulcand/oxy/roundrobin\" rel=\"nofollow noreferrer\">oxy lib roundrobin</a></p>\n\n<p>I my case I do not serve http requests per say. </p>\n\n<p><strong>Any Ideas how could I accomplish that sort of more advanced client side load balancing in my golang program ?</strong></p>\n\n<p>I'd like to avoid to use yet another haproxy or similar in my environment.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1551710828, "post_id": 54985504, "comment_id": 96728996, "body": "please add a <a href=\"https://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1551710906, "post_id": 54985504, "comment_id": 96729044, "body": "<a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\"><code>net&#47;http</code></a> package has all you need."}], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 11149211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d16a92cd94ba2cd8cd0613eda6f6c2c2?s=128&d=identicon&r=PG&f=1", "display_name": "leolara", "link": "https://stackoverflow.com/users/11149211/leolara"}, "is_accepted": true, "score": 2, "last_activity_date": 1551740118, "last_edit_date": 1551740118, "creation_date": 1551716686, "answer_id": 54987416, "question_id": 54985504, "link": "https://stackoverflow.com/questions/54985504/golang-log-in-to-the-site-and-download-the-xls-file/54987416#54987416", "title": "Golang &quot;Log in to the site and download the xls file&quot;?", "body": "<p>I do not know VBA, but it seems to me what you are doing a HTTP POST with the credentials, and then you are doing a HTTP GET to obtain the file you are looking for. I guess the class you are using keeps the cookies from request to request and that is how the authentication works.</p>\n\n<p>Assuming that, in Go you would use the library <a href=\"https://golang.org/pkg/net/http/cookiejar/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/cookiejar/</a> to keep the cookies and <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/</a> to do the actual requests.</p>\n\n<p>You pass each time the same cookie jar.</p>\n\n<p>Something along these lines (not exact or checked):</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"net/http/cookiejar\"\n)\n\nfunc main() {\n    cookieJar, _ := cookiejar.New(nil)\n\n    client := &amp;http.Client{\n        Jar: cookieJar,\n    }\n\n    resp, err := http.PostForm(\"http://example.com/loginform\",\n        url.Values{\"login\": {\"sdiscor\"}, \"password\": {\"sdiscor\"}})\n    resp, err := client.Get(\"http://example.com/\")\n}\n\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11148783, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lKX147qZ32g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMn9syT9XE5t6XZfRxX-VEoVNflUQ/mo/photo.jpg?sz=128", "display_name": "Tagir Veliev", "link": "https://stackoverflow.com/users/11148783/tagir-veliev"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "closed_date": 1551719419, "accepted_answer_id": 54987416, "answer_count": 1, "score": -6, "last_activity_date": 1551770375, "creation_date": 1551710433, "last_edit_date": 1551770375, "question_id": 54985504, "link": "https://stackoverflow.com/questions/54985504/golang-log-in-to-the-site-and-download-the-xls-file", "closed_reason": "Needs more focus", "title": "Golang &quot;Log in to the site and download the xls file&quot;?", "body": "<p>Tell me how to use Golang to login to the site. Download xls file is obtained, but in order to have data in the Excel table, you need to log in to the site. The site is located on the company's server. If you can tell how to do it.</p>\n\n<p>For example, the VBA code that I use to do this.</p>\n\n<pre><code>Set oFields = CreateObject(\"Scripting.Dictionary\")\nWith oFields\n    .Add \"login\", \"sdiscor\"\n    .Add \"password\", \"sdiscor\"\nEnd With\nFor Each sName In oFields\n    oFields(sName) = sName &amp; \"=\" &amp; EncodeUriComponent(oFields(sName))\nNext\nsPayLoad = Join(oFields.Items(), \"&amp;\")\n\nWith CreateObject(\"MSXML2.XMLHTTP\")\n    .Open \"POST\", \"http://effect.gvc.oao.rzd/cgi_bin/effect_access.pl?\", False\n    .setRequestHeader \"Content-Type\", \"application/x-www-form-urlencoded\"\n    .setRequestHeader \"Content-Length\", LenB(sPayLoad)\n    .Send (sPayLoad)\n\n    Do While .readyState &lt;&gt; 4\n        DoEvents\n    Loop\n\n    webLink = \"http://effect.gvc.oao.rzd/effect/table/***&amp;LOGIN=&amp;PASSWORD=\"\n    vLocalFile = ThisWorkbook.Path &amp; \"\\SIS-Effect.xls\"\n\n    .Open \"GET\", webLink, True\n    .Send\n\n    Do While .readyState &lt;&gt; 4\n        DoEvents\n    Loop\n\n    oResp = .responseBody\n\n    vFF = FreeFile\n    If Dir(vLocalFile) &lt;&gt; \"\" Then Kill vLocalFile\n    Open vLocalFile For Binary As #vFF\n    Put #vFF, , oResp\n    Close #vFF\nEnd With\n</code></pre>\n\n<p>Thank leolara!!!\nFinal code</p>\n\n<pre><code>func main() {\nurlLogin := \"http://effect.gvc.oao.rzd/cgi_bin/effect_access.pl?\"\nurlDownload := \"http://effect.gvc.oao.rzd/effect/table/OZODO10U.XLS?DAT=2019.03.04&amp;LOGIN=&amp;PASSWORD=\"\n\ncookieJar, _ := cookiejar.New(nil)\n\nclient := &amp;http.Client{Jar: cookieJar,}\n\n_, err := client.PostForm(urlLogin,\n    url.Values{\"login\": {\"sdiscor\"}, \"password\": {\"sdiscor\"}})\nif err != nil {\n    fmt.Println(\"Error while downloading\", urlLogin, \"-\", err)\n    return\n}\n\nfileName := \"1.xls\"\nfmt.Println(\"Downloading\", urlDownload, \"to\", fileName)\noutput, err := os.Create(fileName)\nif err != nil {\n    fmt.Println(\"Error while creating\", fileName, \"-\", err)\n    return\n}\ndefer output.Close()\n\nresp, err := client.Get(urlDownload)\nif err != nil {\n    fmt.Println(\"Error while downloading\", urlDownload, \"-\", err)\n    return\n}\ndefer resp.Body.Close()\n\nn, err := io.Copy(output, resp.Body)\nif err != nil {\n    fmt.Println(\"Error while downloading\", urlDownload, \"-\", err)\n    return\n}\n\nfmt.Println(n, \"bytes downloaded.\")\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["go", "append"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 5, "creation_date": 1551708849, "post_id": 54984957, "comment_id": 96727767, "body": "Remove the space in <code>: =</code>"}, {"owner": {"reputation": 33, "user_id": 11148653, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-T8V5oYwpfp0/AAAAAAAAAAI/AAAAAAAAAN8/2nZwh58AUXk/photo.jpg?sz=128", "display_name": "\u0410\u043b\u0435\u043a\u0441\u0435\u0439 \u0410\u0432\u0435\u0440\u044c\u044f\u043d\u043e\u0432", "link": "https://stackoverflow.com/users/11148653/%d0%90%d0%bb%d0%b5%d0%ba%d1%81%d0%b5%d0%b9-%d0%90%d0%b2%d0%b5%d1%80%d1%8c%d1%8f%d0%bd%d0%be%d0%b2"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1551709308, "post_id": 54984957, "comment_id": 96728038, "body": "yeah! thats works! thanks"}], "answers": [{"tags": [], "owner": {"reputation": 396, "user_id": 8367913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69b0d901393376d9297c9d2342518eca?s=128&d=identicon&r=PG&f=1", "display_name": "donmichael", "link": "https://stackoverflow.com/users/8367913/donmichael"}, "is_accepted": true, "score": 1, "last_activity_date": 1551708873, "creation_date": 1551708873, "answer_id": 54985035, "question_id": 54984957, "link": "https://stackoverflow.com/questions/54984957/golang-append-syntax-error-missing-statement-after-label/54985035#54985035", "title": "golang append syntax error: missing statement after label", "body": "<p>There's syntax error mate. Should be <code>a := append(bs, b...)</code> mate.</p>\n"}], "owner": {"reputation": 33, "user_id": 11148653, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-T8V5oYwpfp0/AAAAAAAAAAI/AAAAAAAAAN8/2nZwh58AUXk/photo.jpg?sz=128", "display_name": "\u0410\u043b\u0435\u043a\u0441\u0435\u0439 \u0410\u0432\u0435\u0440\u044c\u044f\u043d\u043e\u0432", "link": "https://stackoverflow.com/users/11148653/%d0%90%d0%bb%d0%b5%d0%ba%d1%81%d0%b5%d0%b9-%d0%90%d0%b2%d0%b5%d1%80%d1%8c%d1%8f%d0%bd%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2094, "favorite_count": 0, "closed_date": 1551712435, "accepted_answer_id": 54985035, "answer_count": 1, "score": -3, "last_activity_date": 1551708873, "creation_date": 1551708561, "question_id": 54984957, "link": "https://stackoverflow.com/questions/54984957/golang-append-syntax-error-missing-statement-after-label", "closed_reason": "Not suitable for this site", "title": "golang append syntax error: missing statement after label", "body": "<pre><code>    fmt.Print(\"Text to send: \")\n    text, _ := readerConsole.ReadString('\\n')\n\n    sizen := (int)(unsafe.Sizeof(text))\n    fmt.Print(sizen)\n    var bs []byte\n    binary.BigEndian.PutUint32(bs, sizen)\n\n    b := []byte(text)\n    a: = append(bs, b...)\n</code></pre>\n\n<p>Go formatter says error\n\"syntax error: missing statement after label\" on append</p>\n"}, {"tags": ["json", "postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 3, "creation_date": 1551708887, "post_id": 54984956, "comment_id": 96727788, "body": "where is your attempt to solve the problem?"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "reply_to_user": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 0, "creation_date": 1551709220, "post_id": 54984956, "comment_id": 96727975, "body": "@Tinwor hello! First of all I need the right direction. How do you think is my models (struct) correct? Second, do I need struct to last my table? If my models are correct how I can use them in handler correctly to create nersed JSON response. Need some example if it possible."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1551710790, "post_id": 54984956, "comment_id": 96728965, "body": "If you marshal a nested structure, it will produce nested JSON. What is your question specifically?"}, {"owner": {"reputation": 1073, "user_id": 4546002, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Vu4tnG7w3VI/AAAAAAAAAAI/AAAAAAAABj0/zsVwkswRAoA/photo.jpg?sz=128", "display_name": "Mark R.", "link": "https://stackoverflow.com/users/4546002/mark-r"}, "edited": false, "score": 0, "creation_date": 1551720663, "post_id": 54984956, "comment_id": 96734725, "body": "Adding the relevant tags for <code>Questions</code>/<code>Options</code> and then marshalling the <code>Survey</code> should yield what you want"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551756474, "post_id": 54984956, "comment_id": 96746583, "body": "Hello guys! Ok, I fix my models (structs). What next?"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551764453, "post_id": 54984956, "comment_id": 96748496, "body": "It seems like I need to use <code>.Preload</code> method of <code>GORM</code> library. Right?"}], "answers": [{"comments": [{"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551756434, "post_id": 54988953, "comment_id": 96746577, "body": "Hello! Ok, but what would be next? As I understand I need to make SQL query to table <code>SURVEYS_QUESTIONS_OPTIONS</code>. Then wrap the result by marshalling, right? Really confused."}], "tags": [], "owner": {"reputation": 4197, "user_id": 1632346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c043a71ec4903a9a9e6a4de90c787fa1?s=128&d=identicon&r=PG", "display_name": "slomek", "link": "https://stackoverflow.com/users/1632346/slomek"}, "is_accepted": false, "score": 1, "last_activity_date": 1551722322, "creation_date": 1551722322, "answer_id": 54988953, "question_id": 54984956, "link": "https://stackoverflow.com/questions/54984956/how-to-make-nested-json-response-in-go/54988953#54988953", "title": "How to make nested JSON response in Go?", "body": "<p>I'm not sure abour GORM part, but with JSON you need to add struct tags on the nested objects as well:</p>\n\n<pre><code>type Survey struct {\n  ...\n  Questions []Question `json:\"questions\"`\n}\n\ntype Question struct {\n  ...\n  Options []Option `json:\"options\"`\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551756146, "post_id": 54989503, "comment_id": 96746513, "body": "Hello! I am interested in both solution. I am not sure that it is possible to make with GORM query, so it would be good to use marshalling."}], "tags": [], "owner": {"reputation": 31, "user_id": 3828931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55a8568ad85b00572d71adfe82f0318a?s=128&d=identicon&r=PG&f=1", "display_name": "Alon", "link": "https://stackoverflow.com/users/3828931/alon"}, "is_accepted": false, "score": 1, "last_activity_date": 1551724712, "creation_date": 1551724712, "answer_id": 54989503, "question_id": 54984956, "link": "https://stackoverflow.com/questions/54984956/how-to-make-nested-json-response-in-go/54989503#54989503", "title": "How to make nested JSON response in Go?", "body": "<p>We're missing some scope from your code, and so it's quite hard to point you in the right direction. Are you asking about querying GORM so you get <code>[]Survey</code>, or are you asking about marshalling <code>[]Survey</code>? Anyway, you should add the tag to Questions too, as slomek replied. </p>\n"}, {"tags": [], "owner": {"reputation": 2703, "user_id": 9551146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vH0OA.jpg?s=128&g=1", "display_name": "Narendranath Reddy", "link": "https://stackoverflow.com/users/9551146/narendranath-reddy"}, "is_accepted": false, "score": 0, "last_activity_date": 1566128115, "last_edit_date": 1566128115, "creation_date": 1565935017, "answer_id": 57519505, "question_id": 54984956, "link": "https://stackoverflow.com/questions/54984956/how-to-make-nested-json-response-in-go/57519505#57519505", "title": "How to make nested JSON response in Go?", "body": "<p>However, try this: \nTo fetch nested data in m2m relation</p>\n\n<pre><code>type Survey struct {\n  gorm.Model\n  SurveyID string       `gorm:\"primary_key\" json:\"survey_id\"`\n  SurveyName string     `gorm:\"not null\" json:\"survey_name\"`\n  Questions []*Question `gorm:\"many2many:survey_questions;\"`\n}\n\nsurveys := []*model.Survey{}\ndb := dbSession.Where(&amp;model.Survey{SurveyID: id}).Preload(\"Questions\").Find(&amp;surveys)\n</code></pre>\n"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 499, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1566130731, "creation_date": 1551708560, "last_edit_date": 1566130731, "question_id": 54984956, "link": "https://stackoverflow.com/questions/54984956/how-to-make-nested-json-response-in-go", "title": "How to make nested JSON response in Go?", "body": "<p>I am new in Go and need some help.</p>\n\n<p>In my PostgreSQL database I have 4 table. They called: <code>surveys</code>, <code>questions</code>, <code>options</code> and <code>surveys_questions_options</code>.</p>\n\n<p>They looks like this:</p>\n\n<p><code>surveys</code> table:</p>\n\n<pre><code>| survey_id (uuid4)                    | survey_name (varchar) |\n|--------------------------------------|-----------------------|\n| 0cf1cf18-d5fd-474e-a8be-754fbdc89720 | April                 |\n| b9fg55d9-n5fy-s7fe-s5bh-856fbdc89720 | May                   |\n</code></pre>\n\n<p><code>questions</code> table:</p>\n\n<pre><code>| question_id (int) | question_text (text)         |\n|-------------------|------------------------------|\n| 1                 | What is your favorite color? |\n</code></pre>\n\n<p><code>options</code> table:</p>\n\n<pre><code>| option_id (int)   | option_text (text) |\n|-------------------|--------------------|\n| 1                 | red                |\n| 2                 | blue               |\n| 3                 | grey               |\n| 4                 | green              |\n| 5                 | brown              |\n</code></pre>\n\n<p><code>surveys_questions_options</code> table combines data from all three previous tables:</p>\n\n<pre><code>| survey_id                            | question_id | option_id |\n|--------------------------------------|-------------|-----------|\n| 0cf1cf18-d5fd-474e-a8be-754fbdc89720 | 1           | 1         |\n| 0cf1cf18-d5fd-474e-a8be-754fbdc89720 | 1           | 2         |\n| 0cf1cf18-d5fd-474e-a8be-754fbdc89720 | 1           | 3         |\n| b9fg55d9-n5fy-s7fe-s5bh-856fbdc89720 | 1           | 3         |\n| b9fg55d9-n5fy-s7fe-s5bh-856fbdc89720 | 1           | 4         |\n| b9fg55d9-n5fy-s7fe-s5bh-856fbdc89720 | 1           | 5         |\n</code></pre>\n\n<p>How can I make nested JSON response in Go? I use GORM library. I want a JSON response like this:</p>\n\n<pre><code>[\n    {\n        \"survey_id\": \"0cf1cf18-d5fd-474e-a8be-754fbdc89720\",\n        \"survey_name\": \"April\",\n        \"questions\": [\n            {\n                \"question_id\": 1,\n                \"question_text\": \"What is your favorite color?\",\n                \"options\": [\n                    {\n                        \"option_id\": 1,\n                        \"option_text\": \"red\"\n                    },\n                    {\n                        \"option_id\": 2,\n                        \"option_text\": \"blue\"\n                    },\n                    {\n                        \"option_id\": 3,\n                        \"option_text\": \"grey\"\n                    },\n                ]\n            }\n        ]\n    },\n    {\n        \"survey_id\": \"b9fg55d9-n5fy-s7fe-s5bh-856fbdc89720\",\n        \"survey_name\": \"May\",\n        \"questions\": [\n            {\n                \"question_id\": 1,\n                \"question_text\": \"What is your favorite color?\",\n                \"options\": [\n                    {\n                        \"option_id\": 3,\n                        \"option_text\": \"grey\"\n                    },\n                    {\n                        \"option_id\": 4,\n                        \"option_text\": \"green\"\n                    },\n                    {\n                        \"option_id\": 5,\n                        \"option_text\": \"brown\"\n                    },\n                ]\n            }\n        ]\n    }\n]\n</code></pre>\n\n<p>My models looks like this:</p>\n\n<pre><code>type Survey struct {\n  SurveyID string `gorm:\"primary_key\" json:\"survey_id\"`\n  SurveyName string `gorm:\"not null\" json:\"survey_name\"`\n  Questions []Question \n}\n\ntype Question struct {\n  QuestionID int `gorm:\"primary_key\" json:\"question_id\"`\n  QuestionText string `gorm:\"not null;unique\" json:\"question_text\"`\n  Options []Option\n}\n\ntype Option struct {\n  OptionID   int    `gorm:\"primary_key\" json:\"option_id\"`\n  OptionText string `gorm:\"not null;unique\" json:\"option_text\"`\n}\n</code></pre>\n"}, {"tags": ["go", "protocol-buffers"], "answers": [{"tags": [], "owner": {"reputation": 145, "user_id": 3117565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dddb7750fcb817db6fa82bad406e938d?s=128&d=identicon&r=PG", "display_name": "sgraham", "link": "https://stackoverflow.com/users/3117565/sgraham"}, "is_accepted": false, "score": 0, "last_activity_date": 1551726474, "creation_date": 1551726474, "answer_id": 54989977, "question_id": 54983183, "link": "https://stackoverflow.com/questions/54983183/specify-base-package-in-protobuf-compilation-in-golang/54989977#54989977", "title": "Specify base package in protobuf compilation in golang", "body": "<p>you need to make your import in your proto a fully qualified path like in Go:</p>\n\n<p>instead of <code>import \"app2/messages.proto\";</code></p>\n\n<p>try <code>import \"github.com/user/protoapp/proto/app2/messages.proto\";</code></p>\n"}, {"tags": [], "owner": {"reputation": 444, "user_id": 7918749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r9BIg.jpg?s=128&g=1", "display_name": "Black_Dreams", "link": "https://stackoverflow.com/users/7918749/black-dreams"}, "is_accepted": false, "score": 0, "last_activity_date": 1551778410, "creation_date": 1551778410, "answer_id": 54999556, "question_id": 54983183, "link": "https://stackoverflow.com/questions/54983183/specify-base-package-in-protobuf-compilation-in-golang/54999556#54999556", "title": "Specify base package in protobuf compilation in golang", "body": "<p>Never specify the half path \"/app2/messages.proto\" it won't be work.</p>\n\n<ol>\n<li>Specify the full import name </li>\n</ol>\n\n<pre><code>import \"github.com/user/protoapp/proto/app2/messages.proto\";\n</code></pre>\n\n<p>and</p>\n\n<ol start=\"2\">\n<li>Do define with the package name</li>\n</ol>\n\n<pre><code>//if we does'nt add package we define it will show error\npackage messagedata;\n</code></pre>\n"}], "owner": {"reputation": 423, "user_id": 1338475, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03415ab76e1aeba98311a52268b71e50?s=128&d=identicon&r=PG", "display_name": "skeeph", "link": "https://stackoverflow.com/users/1338475/skeeph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1551778410, "creation_date": 1551702104, "question_id": 54983183, "link": "https://stackoverflow.com/questions/54983183/specify-base-package-in-protobuf-compilation-in-golang", "title": "Specify base package in protobuf compilation in golang", "body": "<p>I've got golang package <code>github.com/user/protoapp</code>, in this package I have folder <code>proto</code> containing protobuf files.</p>\n\n<pre><code>github.com/user/protoapp\n|-proto\n|-proto/app1\n|-proto/app2\n</code></pre>\n\n<p>proto files in <code>app1</code> and <code>app2</code> have corresponing packages <code>app1</code> and <code>app</code>;</p>\n\n<p>Proto file from <code>proto/app1</code> is importing file from <code>proto/app2</code> like <code>import \"app2/messages.proto\";</code> after compillation in <code>app1.pb.go</code> it becomes <code>import app2</code> and <code>protoapp</code> fails to compile. How do I make imports in <code>*.pb.go</code> files become <code>import \"github.com/user/protoapp/proto/app2\"</code> rather than <code>import \"app2\"</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 2, "creation_date": 1551702186, "post_id": 54983108, "comment_id": 96724153, "body": "Not only splitting takes a lot of memory, but you&#39;re reading the whole file into memory before this. You need to read the file in a streaming fashion. Using Reader&#39;s <a href=\"https://golang.org/pkg/bufio/#Reader.ReadRune\" rel=\"nofollow noreferrer\">ReadRune</a>, for example."}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1551716975, "post_id": 54983108, "comment_id": 96732739, "body": "It would be easier if you needed n bytes, not n symbols - then you could use a loop with <a href=\"https://golang.org/pkg/io/#ReadFull\" rel=\"nofollow noreferrer\">io.ReadFull</a> into a n-bytes slice. For your requirement of n runes, the easiest way is to use a loop with n calls of <a href=\"https://golang.org/pkg/bufio/#Reader.ReadRune\" rel=\"nofollow noreferrer\">bufio.ReadRune</a> as @SergioTulentsev suggested, not superoptimal for many n, but valid."}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1551717198, "post_id": 54983108, "comment_id": 96732882, "body": "By the way, a convenient way to avoid reading everything into memory while keeping the code short and clean, is to read chunks and put the result into a string channel, then the other goroutine can read channel via <code>for s := range channel</code> but memory allocation is keeping one chunk at a time."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 11147845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaefe28a888563b732e20773fe4afdc?s=128&d=identicon&r=PG&f=1", "display_name": "D. Stevenson", "link": "https://stackoverflow.com/users/11147845/d-stevenson"}, "edited": false, "score": 0, "creation_date": 1551714101, "post_id": 54983655, "comment_id": 96731008, "body": "Thank you a lot! But could you tell me the name of the method to read file incrementally? I want to read about it."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 51, "user_id": 11147845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaefe28a888563b732e20773fe4afdc?s=128&d=identicon&r=PG&f=1", "display_name": "D. Stevenson", "link": "https://stackoverflow.com/users/11147845/d-stevenson"}, "edited": false, "score": 0, "creation_date": 1551721413, "post_id": 54983655, "comment_id": 96735068, "body": "Use the File.Read method to read part of a file.  Do you need exactly N runes, or is it ok to read M bytes rounded to the nearest rune? What is the value of N?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1551705537, "last_edit_date": 1551705537, "creation_date": 1551703774, "answer_id": 54983655, "question_id": 54983108, "link": "https://stackoverflow.com/questions/54983108/how-to-read-large-file-by-blocks-with-n-length/54983655#54983655", "title": "How to read large file by blocks with n length", "body": "<p>Scan for <a href=\"https://godoc.org/unicode/utf8#RuneStart\" rel=\"nofollow noreferrer\">rune start</a> bytes and split based on that. This eliminates all allocations within the function except for the allocation of the result slice.</p>\n\n<pre><code>func SplitSubN(s string, n int) []string {\n    if len(s) == 0 {\n        return nil\n    }\n    m := 0\n    i := 0\n    j := 1\n    var result []string\n    for ; j &lt; len(s); j++ {\n        if utf8.RuneStart(s[j]) {\n            if (m+1)%n == 0 {\n                result = append(result, s[i:j])\n                i = j\n            }\n            m++\n        }\n    }\n    if j &gt; i {\n        result = append(result, s[i:j])\n    }\n    return result\n\n}\n</code></pre>\n\n<p>The API specified in the question requires that the application allocate memory when converting the []byte read from the file to a string. This allocation can be avoided by changing the function to work on bytes:</p>\n\n<pre><code>func SplitSubN(s []byte, n int) [][]byte {\n    if len(s) == 0 {\n        return nil\n    }\n    m := 0\n    i := 0\n    j := 1\n    var result [][]byte\n    for ; j &lt; len(s); j++ {\n        if utf8.RuneStart(s[j]) {\n            if (m+1)%n == 0 {\n                result = append(result, s[i:j])\n                i = j\n            }\n            m++\n        }\n    }\n    if j &gt; i {\n        result = append(result, s[i:j])\n    }\n    return result\n\n}\n</code></pre>\n\n<p>Both of these functions require that the application slurp the entire file into memory.  I assume that's OK because the function in the question does as well.  If you only need to process one chunk at a time, then the above code be be adapted to scan as the file is read incrementally.</p>\n"}, {"tags": [], "owner": {"reputation": 739, "user_id": 1065759, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Nkh6.jpg?s=128&g=1", "display_name": "Alexey Mukas", "link": "https://stackoverflow.com/users/1065759/alexey-mukas"}, "is_accepted": false, "score": 0, "last_activity_date": 1551741348, "last_edit_date": 1551741348, "creation_date": 1551736192, "answer_id": 54992073, "question_id": 54983108, "link": "https://stackoverflow.com/questions/54983108/how-to-read-large-file-by-blocks-with-n-length/54992073#54992073", "title": "How to read large file by blocks with n length", "body": "<p>Actually, the most interesting part is not parsing chunk itself but rather handling characters overlapping.</p>\n\n<p>For example, if you read from a file say in chunks of <code>N</code> bytes but last multi-byte char is read partially (the remainder will be read in the next iteration).</p>\n\n<p>Here is a solution that reads a text file by given chunks and handles characters overlapping in async manner:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"unicode/utf8\"\n)\n\nfunc main() {\n    data, err := ReadInChunks(\"testfile\", 1024*16)\n\n    competed := false\n    for ; !competed; {\n        select {\n        case next := &lt;-data:\n            if next == nil {\n                competed = true\n                break\n            }\n            fmt.Printf(string(next))\n        case e := &lt;-err:\n            if e != nil {\n                log.Fatalf(\"error: %s\", e)\n            }\n        }\n    }\n}\n\nfunc ReadInChunks(path string, readChunkSize int) (data chan []rune, err chan error) {\n    var readChanel = make(chan []rune)\n    var errorChanel = make(chan error)\n\n    onDone := func() {\n        close(readChanel)\n        close(errorChanel)\n    }\n\n    onError := func(err error) {\n        errorChanel &lt;- err\n        onDone()\n    }\n\n    go func() {\n        if _, err := os.Stat(path); os.IsNotExist(err) {\n            onError(fmt.Errorf(\"file [%s] does not exist\", path))\n            return\n        }\n\n        f, err := os.Open(path)\n        if err != nil {\n            onError(err)\n            return\n        }\n        defer f.Close()\n\n        readBuf := make([]byte, readChunkSize)\n        reminder := 0\n\n        for {\n            read, err := f.Read(readBuf[reminder:])\n            if err == io.EOF {\n                onDone()\n                return\n            }\n            if err != nil {\n                onError(err)\n            }\n\n            runes, parsed := runes(readBuf[:reminder+read])\n            if reminder = readChunkSize - parsed; reminder &gt; 0 {\n                copy(readBuf[:reminder], readBuf[readChunkSize-reminder:])\n            }\n\n            if len(runes) &gt; 0 {\n                readChanel &lt;- runes\n            }\n        }\n    }()\n\n    return readChanel, errorChanel\n}\n\nfunc runes(nextBuffer []byte) ([]rune, int) {\n    t := make([]rune, utf8.RuneCount(nextBuffer))\n    i := 0\n    var size = len(nextBuffer)\n    var read = 0\n    for len(nextBuffer) &gt; 0 {\n        r, l := utf8.DecodeRune(nextBuffer)\n        runeLen := utf8.RuneLen(r)\n        if read+runeLen &gt; size {\n            break\n        }\n        read += runeLen\n        t[i] = r\n        i++\n        nextBuffer = nextBuffer[l:]\n    }\n    return t[:i], read\n}\n</code></pre>\n\n<p>It can be greatly simplified if the file is ACSII. </p>\n\n<p>Alternativly, if you need to support unicode you can play aroud UTF-32 (which has fixed length) or UTF-16 (if you don't need to handle >2-bytes, you can treat it as fixed-size as well)</p>\n"}], "owner": {"reputation": 51, "user_id": 11147845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbaefe28a888563b732e20773fe4afdc?s=128&d=identicon&r=PG&f=1", "display_name": "D. Stevenson", "link": "https://stackoverflow.com/users/11147845/d-stevenson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1551741348, "creation_date": 1551701875, "last_edit_date": 1551705843, "question_id": 54983108, "link": "https://stackoverflow.com/questions/54983108/how-to-read-large-file-by-blocks-with-n-length", "title": "How to read large file by blocks with n length", "body": "<p>I want to read and split large text file (near 3GB) to blocks with n symbols length. I was trying to read file and split using runes, but it takes a lot of memory.    </p>\n\n<pre><code>func SplitSubN(s string, n int) []string {\n    sub := \"\"\n    subs := []string{}\n    runes := bytes.Runes([]byte(s))\n    l := len(runes)\n    for i, r := range runes {\n        sub = sub + string(r)\n        if (i+1)%n == 0 {\n            subs = append(subs, sub)\n            sub = \"\"\n        } else if (i + 1) == l {\n            subs = append(subs, sub)\n        }\n    }\n    return subs\n}\n</code></pre>\n\n<p>I suppose it can be done in smarter way, like a phased reading of blocks of a certain length from file, but I don't know how to do it correctly.</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1551717306, "post_id": 54982948, "comment_id": 96732936, "body": "Why downvoted? It&#39;s a valid question."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1551702336, "last_edit_date": 1551702336, "creation_date": 1551701954, "answer_id": 54983137, "question_id": 54982948, "link": "https://stackoverflow.com/questions/54982948/why-sync-mutex-exists/54983137#54983137", "title": "Why sync.Mutex exists?", "body": "<p>It's true that you could use a <a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"nofollow noreferrer\"><code>sync.RWMutex</code></a> whenever you need a <a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"nofollow noreferrer\"><code>sync.Mutex</code></a>.</p>\n\n<p>I think both exist because there are a lot of cases when a <code>sync.Mutex</code> is enough (you don't need read and write level locking), and the implementation of <code>sync.Mutex</code> is simpler: requires much less memory and is most likely faster.</p>\n\n<p><code>sync.Mutex</code> is just 8 bytes:</p>\n\n<pre><code>type Mutex struct {\n    state int32\n    sema  uint32\n}\n</code></pre>\n\n<p>While <code>sync.RWMutex</code> is 8 + 16 = 24 bytes (it includes a <code>sync.Mutex</code>):</p>\n\n<pre><code>type RWMutex struct {\n    w           Mutex  // held if there are pending writers\n    writerSem   uint32 // semaphore for writers to wait for completing readers\n    readerSem   uint32 // semaphore for readers to wait for completing writers\n    readerCount int32  // number of pending readers\n    readerWait  int32  // number of departing readers\n}\n</code></pre>\n\n<p>Yes, you could say 8 or 24 bytes should not matter. And it doesn't as long as you only have a few mutexes.</p>\n\n<p>But it's not uncommon to put the mutex into the struct it's ought to protect (either embed or a regular, named field). Now if you have a slice of these struct values, maybe even thousands of them, then yes, it will make a noticeable difference.</p>\n\n<p>Also, if you just need a mutex, <code>sync.Mutex</code> gives you less chance of misusing it (you can't accidentally call <code>RLock()</code> because it doesn't have that method).</p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1551774894, "post_id": 54993004, "comment_id": 96752762, "body": "<code>race</code> is not an object, it&#39;s a package. And <code>race.Enabled</code> is a constant, which will not have runtime overhead, as if the race detector is not enabled, those branches are &quot;compile-time dead&quot;."}, {"owner": {"reputation": 49, "user_id": 11149211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d16a92cd94ba2cd8cd0613eda6f6c2c2?s=128&d=identicon&r=PG&f=1", "display_name": "leolara", "link": "https://stackoverflow.com/users/11149211/leolara"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1551789341, "post_id": 54993004, "comment_id": 96761170, "body": "Ok, race will not cause overhead, but the other ones? Especially runtime_SemacquireMutex will?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1551790122, "post_id": 54993004, "comment_id": 96761619, "body": "Yes, the rest is most likely causing some overhead (as mentioned in my answer)."}], "tags": [], "owner": {"reputation": 49, "user_id": 11149211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d16a92cd94ba2cd8cd0613eda6f6c2c2?s=128&d=identicon&r=PG&f=1", "display_name": "leolara", "link": "https://stackoverflow.com/users/11149211/leolara"}, "is_accepted": false, "score": 0, "last_activity_date": 1551740891, "creation_date": 1551740891, "answer_id": 54993004, "question_id": 54982948, "link": "https://stackoverflow.com/questions/54982948/why-sync-mutex-exists/54993004#54993004", "title": "Why sync.Mutex exists?", "body": "<p>A part from taking more space as mentioned by @icza, it is also less efficient in terms of execution time.</p>\n\n<p>If we look at the source code of RWMutex.Lock:</p>\n\n<pre><code>// Lock locks rw for writing.\n// If the lock is already locked for reading or writing,\n// Lock blocks until the lock is available.\nfunc (rw *RWMutex) Lock() {\n    if race.Enabled {\n        _ = rw.w.state\n        race.Disable()\n    }\n    // First, resolve competition with other writers.\n    rw.w.Lock()\n    // Announce to readers there is a pending writer.\n    r := atomic.AddInt32(&amp;rw.readerCount, -rwmutexMaxReaders) + rwmutexMaxReaders\n    // Wait for active readers.\n    if r != 0 &amp;&amp; atomic.AddInt32(&amp;rw.readerWait, r) != 0 {\n        runtime_SemacquireMutex(&amp;rw.writerSem, false)\n    }\n    if race.Enabled {\n        race.Enable()\n        race.Acquire(unsafe.Pointer(&amp;rw.readerSem))\n        race.Acquire(unsafe.Pointer(&amp;rw.writerSem))\n    }\n}\n</code></pre>\n\n<p>We can see that it calls a Mutex.Lock, hence it takes the same time of Mutex.Lock plus all the other stuff that it does.</p>\n\n<p>We see a call to atomic.AddInt32, runtime_SemacquireMutex and other methods of the object <code>race</code>, this will have an overhead.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11148079"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 54983137, "answer_count": 2, "score": -3, "last_activity_date": 1551740891, "creation_date": 1551701305, "last_edit_date": 1551701613, "question_id": 54982948, "link": "https://stackoverflow.com/questions/54982948/why-sync-mutex-exists", "title": "Why sync.Mutex exists?", "body": "<p>Why <code>sync.Mutex</code> exists while we have <code>sync.RWMutex</code>? I can lock/unlock rw mutex. What is the main difference between them?</p>\n"}, {"tags": ["go", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 444, "user_id": 7918749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r9BIg.jpg?s=128&g=1", "display_name": "Black_Dreams", "link": "https://stackoverflow.com/users/7918749/black-dreams"}, "is_accepted": false, "score": 2, "last_activity_date": 1551700117, "creation_date": 1551700117, "answer_id": 54982634, "question_id": 54982527, "link": "https://stackoverflow.com/questions/54982527/how-to-use-golang-create-nest-json-array-object/54982634#54982634", "title": "How to use golang create nest json array object", "body": "<p>Just remove the array when you create the struct</p>\n\n<pre><code>type DataRecent struct {\n TransID   string   `json:\"transID\"`\n ProductID []string `json:\"productID\"`\n}\n</code></pre>\n\n<p>and do</p>\n\n<pre><code>var dataRecent []DataRecent\n</code></pre>\n\n<p>it will works for you.</p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 3828931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55a8568ad85b00572d71adfe82f0318a?s=128&d=identicon&r=PG&f=1", "display_name": "Alon", "link": "https://stackoverflow.com/users/3828931/alon"}, "is_accepted": false, "score": 0, "last_activity_date": 1551725738, "creation_date": 1551725738, "answer_id": 54989782, "question_id": 54982527, "link": "https://stackoverflow.com/questions/54982527/how-to-use-golang-create-nest-json-array-object/54989782#54989782", "title": "How to use golang create nest json array object", "body": "<p>looks like dataRecent isn't initialized. I suggest you use <code>dataRecent := DataRecent{}</code> instead of <code>var dataRecent DataRecent</code>.</p>\n\n<p>some other insights: \nI'm not sure if you've omitted the usage of <code>make</code> of the recent string array, or you're not aware you need to <code>make()</code> it. Anyway, arrays are values in Go, and if you're new to Go I strongly suggest you use slices instead. <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-slices-usage-and-internals</a></p>\n\n<p>Also, I'm not sure why you have to <code>panic()</code> in case you've found an error (in the words of Dave Cheney, <code>panic</code> means \"game over man\" - <a href=\"https://dave.cheney.net/tag/panic\" rel=\"nofollow noreferrer\">https://dave.cheney.net/tag/panic</a>)</p>\n"}], "owner": {"reputation": 45, "user_id": 8083793, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kzbYVuxKAXk/AAAAAAAAAAI/AAAAAAAAABc/xCRiSFWzIUI/photo.jpg?sz=128", "display_name": "Neung Kittipong", "link": "https://stackoverflow.com/users/8083793/neung-kittipong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1551725738, "creation_date": 1551699731, "question_id": 54982527, "link": "https://stackoverflow.com/questions/54982527/how-to-use-golang-create-nest-json-array-object", "title": "How to use golang create nest json array object", "body": "<p>I try to query database and use query result to create json like these</p>\n\n<p>[ {\"TransID\": \"Transaction ID1\",ProductID\": [\"ProID1\",\"ProID2\",\"ProID3\",\"ProID4\" ]},</p>\n\n<p>{\"TransID\": \"Transaction ID2\",\"ProductID\": [\"ProID5\",\"ProID6\" ]} ]</p>\n\n<p>so I create type struct from</p>\n\n<pre><code>type DataRecent []struct {\n TransID   string   `json:\"transID\"`\n ProductID []string `json:\"productID\"`}\n</code></pre>\n\n<p>and golang code is</p>\n\n<pre><code>var dataRecent DataRecent\nvar recent [5]string\nfor _, Trans := range recent {\n\n    if Trans != \"\" {\n        var TransID, ProductID string\n\n        selectTrans, err := db.Query(\"select transaction_id, product_id from detail where transaction_id = ?\", Trans)\n\n        var arr []string\n        for selectTrans.Next() {\n            if err != nil {\n                panic(err.Error())\n            }\n            errTrans := selectTrans.Scan(&amp;TransID, &amp;ProductID)\n            if errTrans != nil {\n                panic(errTrans.Error())\n            }\n            arr = append(arr, ProductID)\n        }\n    }\n        dataRecent.TransID = Trans\n        dataRecent.ProductID = arr\n\n}\n    c.JSON(http.StatusOK, gin.H{\"status\": \"success\", \"message\": \"Find transactions success\", \"recent_trans\": dataRecent})\n\n\ndefer db.Close()\n</code></pre>\n\n<p>but I can't build the code and got error</p>\n\n<blockquote>\n  <p>dataRecent.TransID undefined (type DataRecent has no field or method TransID)\n  dataRecent.ProductID undefined (type DataRecent has no field or method ProductID)</p>\n</blockquote>\n\n<p>I don't know what to do and stuck with these for a week. I am new programmer for golang. Help me pleae, Thank you</p>\n"}, {"tags": ["go", "ssh"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1551709034, "post_id": 54982050, "comment_id": 96727866, "body": "Assuming the snippet above is correct and you have the latest <code>x&#47;crypto&#47;ssh</code>, this is coming from <a href=\"https://github.com/golang/crypto/blob/master/ssh/keys.go#L991\" rel=\"nofollow noreferrer\">openssh private key parsing</a>. You can try to copy the relevant code and run through the same steps to see what you get, specifically why one of <code>kdfName</code> or <code>CipherName</code> is <code>none</code>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1551723389, "post_id": 54982050, "comment_id": 96736003, "body": "It seems I was mistaken: the snippet I linked to shows that openssh encrypted private keys are not supported."}, {"owner": {"reputation": 4284, "user_id": 180960, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/85e19e3e21a3e83c5973e27ccbdece57?s=128&d=identicon&r=PG", "display_name": "aliva", "link": "https://stackoverflow.com/users/180960/aliva"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1551723915, "post_id": 54982050, "comment_id": 96736241, "body": "thanks for update. I was in the middle of debugging <code>crypto</code> package and your update helped"}, {"owner": {"reputation": 4284, "user_id": 180960, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/85e19e3e21a3e83c5973e27ccbdece57?s=128&d=identicon&r=PG", "display_name": "aliva", "link": "https://stackoverflow.com/users/180960/aliva"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1551724752, "post_id": 54982050, "comment_id": 96736675, "body": "related issue: <a href=\"https://github.com/golang/go/issues/18692\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/18692</a>"}], "owner": {"reputation": 4284, "user_id": 180960, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/85e19e3e21a3e83c5973e27ccbdece57?s=128&d=identicon&r=PG", "display_name": "aliva", "link": "https://stackoverflow.com/users/180960/aliva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 905, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1551698613, "creation_date": 1551697919, "last_edit_date": 1551698613, "question_id": 54982050, "link": "https://stackoverflow.com/questions/54982050/parseprivatekeywithpassphrase-returns-ssh-cannot-decode-encrypted-private-keys", "title": "ParsePrivateKeyWithPassphrase returns ssh: cannot decode encrypted private keys", "body": "<p>here is my code snippet:</p>\n\n<pre><code>user, err := user.Current()\nkey, err := ioutil.ReadFile(fmt.Sprintf(\"%s/.ssh/id_rsa\", user.HomeDir))\nfmt.Println(string(key)) // prints valid data\nsigner, err := ssh.ParsePrivateKeyWithPassphrase(key, []byte(\"test\"))\nif err != nil {\n   // error happens here\n    log.Fatalf(\"unable to parse private key: %v\", err)\n}\n</code></pre>\n\n<p>ouput:</p>\n\n<pre><code>unable to parse private key: ssh: cannot decode encrypted private keys\n</code></pre>\n\n<p>and here is my id_rsa file:</p>\n\n<pre><code>-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABD5f5tjBE\nIeNkF+DmGNAQLaAAAAEAAAAAEAAAEXAAAAB3NzaC1yc2EAAAADAQABAAABAQDSHOjIEPNh\n9Qf0l7ILzAY5csC5fBrcykj8K49N6OLIofClwVxeeT9ucJAYz9um3QSnYBstxcozN+EG30\n7b7gPCGEDLZbB2bOeyU1Wda8wBm6Jy3V1xw6XDvdC4ZZJeGEjBKeY/5l/scAurfcjNo6rG\ndFNMyY8RAQb5XZEzvhzDJGebYH3ezMTf9zb2RXP8anud/qdAJMvm8uICSAg4gzI0C+fC8+\nt7SeE6BWLHUNKyBLXB2/b74oXJCIgYou1pBd2xol/lSM9rqSNanzn7yhj4s1+BTFlJaijH\n+xVxac3sbK9AfCPoq3zQA1W1QZQDghMMSd0OuQg6TR3w4X8rq3UBAAAD0FsXxxJuKOB9Pb\nzNrZ69tHKBsTirWNkLq/0MfNJlqNCRYArsq0PH2IWiioKp2mQgRwXwIfrM71LnpemXmS/F\nrtjJAabNifGfCT6v7BGM1OubFh+n3Y8ejSK8rPLh25m/KFwWABEwFkoXpSiY2e07Y8cf5i\nBmnMpSDlmgkWUipRlDZq1NvXYovAlFzlzmbAlC2utqjiA+D2V/Pc+rI0E/t/iS2LuW4Y5q\n7OfWxPynbQuKkt16cXVK1oXUOa7KJoy8+v7MJQRHP6Ipurrfn23DXyM+xXmMRBy9Ai+JI8\nffFh8DzCjL+AM88eHF13fwLMa1IXfvbJKsHk/SsoLq62EDinfvpTEUa/FmQLsiXpYKKm+r\nkTvvTmcCTch0C24Haa5UxKrqD7F7V9i3nLYP7ot9gOJ2XkLWczYvnZJRlIEFuNiObxKuTe\n3aUxWSQloVq8LwQR/N5fACH4nZmafk0JsXNq6ImBRwP0a7AxTZ6F9pAt57XjTYNAER6SBv\noHNxMnwxt31/kV+7SYs1OgburqBOYBDgtdjT4n2VlBtHjmiflxeychlr4G7zvR9hhK+fZl\nAoskIJNYqrHgBimlTYwzvy+fJr2DbTZFkuyQyhzFBAtNnV04YWufAnPl/r7fB4GrNdqksi\npxAHUWpJLY47q0GIAMwdMt8lEBcQ1okg+9PLOsXOZCjkOx1/dcaRmNKC9TEU/0tvgIDybL\nHVL15S/cZz19wNAt1Qvvx8LjNyq6xm0hbeRUldm8r0BQanK6Y6ReImnjwm9pojd7N/nPMt\nE/zf0whJgzVikqt95SbCkyaW9wkMOayjxrm6b6hhNthldAgcz/vGQKNd8gyvUmgauHHrMI\nNgbQL1N6dBY5rNF+SGPelEDNQu8n1l0sq0ln7BA3RiXVMff/FxgvV2b0DSTa4d7MfLm7Xi\nS/2Cn1Tzwi+90m62zU38KbQJLAhXrB0KumFcOM3Tmp2V+kdqu2E0F2AOTs1uzTOzBALXSd\nfThlLXxVS5VVrAbQajneVWRg741iHqFR+9tDRlOunjPfJ2v2PGqDyVEIVFsJ4d+mhzCM3z\nZ2KNv1gjiOn9bgyfKldE8xA2ee+sax6HIUSa2u54LpWAhgGtJjAaYA9tWabjdTaKIpiFo6\nDSIa39Kx7hkEjLstCN+OCzSGqiVw8RUsLcOMJi6gBzMTalgp8KeMkXwT2GUOvfFC1aHecJ\nF2vApS+VW331FWYxNYPCAKbJx8iaKUZ7Ca6whPqwyB7lvdtjmi+3vREu3m4yROwDkknivc\nSF7LrsG2766/Z09Cr+V7fT4yDP3EE=\n-----END OPENSSH PRIVATE KEY-----\n</code></pre>\n\n<p>Passphrase for key is <code>test</code> and I can verify it with <code>ssh-keygen -y</code></p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "edited": false, "score": 0, "creation_date": 1551726687, "post_id": 54981832, "comment_id": 96737609, "body": "Did you create those tables yourself, or is that the SQL generated by GORM?"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "reply_to_user": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "edited": false, "score": 1, "creation_date": 1551757599, "post_id": 54981832, "comment_id": 96746811, "body": "The tables are already created before me. I don&#39;t generate them by GORM. I found the problem. In struct of <code>Question</code> I changed like this <code>WidgetTypeID int </code>gorm:&quot;not null&quot; json:&quot;widget_type_id&quot;<code>. After that it works. But I don&#39;t know if it necessary this line: `WidgetType WidgetType `gorm:&quot;foreignkey:WidgetTypeID&quot;</code>"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 662, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1551733114, "creation_date": 1551697106, "last_edit_date": 1551733114, "question_id": 54981832, "link": "https://stackoverflow.com/questions/54981832/how-correctly-create-foreignkey-in-gorm-golang-application", "title": "How correctly create ForeignKey in GORM | Golang application?", "body": "<p>In <strong>PostgreSQL</strong> database I have 2 table:</p>\n\n<pre><code>CREATE TABLE WIDGET_TYPE(\n    WIDGET_TYPE_ID SERIAL PRIMARY KEY NOT NULL,\n    WIDGET_TYPE_NAME VARCHAR NOT NULL UNIQUE\n);\n\nCREATE TABLE QUESTION(\n    QUESTION_ID SERIAL PRIMARY KEY NOT NULL,\n    QUESTION_TEXT TEXT NOT NULL UNIQUE,\n    WIDGET_TYPE_ID INT NOT NULL,\n    FOREIGN KEY (WIDGET_TYPE_ID) REFERENCES WIDGET_TYPE (WIDGET_TYPE_ID)\n);\n</code></pre>\n\n<p>As you can see each question has only one widget type for offerend answers.</p>\n\n<p>After that step I am trying to design models in Golang application. I use GORM library for this task. I have problem when try to create new entry in <code>question</code> table. In the body of the POST request I send JSON object:</p>\n\n<pre><code>{\n    \"question_text\": \"NEW QUESTION TEXT HERE\",\n    \"widget_type_id\": 2\n}\n</code></pre>\n\n<p><strong>ERROR</strong>:</p>\n\n<pre><code>pq: insert or update on table \"question\" violates foreign key constraint \"question_widget_type_id_fkey\"\n</code></pre>\n\n<p><strong>models.go</strong>:</p>\n\n<pre><code>package models\n\ntype WidgetType struct {\n    WidgetTypeID   int    `gorm:\"primary_key\" json:\"widget_type_id\"`\n    WidgetTypeName string `gorm:\"not null;unique\" json:\"widget_type_name\"`\n}\n\nfunc (WidgetType) TableName() string {\n    return \"widget_type\"\n}\n\ntype Question struct {\n    QuestionID int `gorm:\"primary_key\" json:\"question_id\"`\n    QuestionText string `gorm:\"not null;unique\" json:\"question_text\"`\n    WidgetType WidgetType `gorm:\"foreignkey:WidgetTypeID\"`\n    WidgetTypeID uint\n}\n\nfunc (Question) TableName() string {\n    return \"question\"\n}\n</code></pre>\n\n<p><strong>handlers.go</strong>:</p>\n\n<pre><code>var CreateQuestion = func(responseWriter http.ResponseWriter, request *http.Request) {\n    question := models.Question{}\n    decoder := json.NewDecoder(request.Body)\n    if err := decoder.Decode(&amp;question); err != nil {\n        utils.ResponseWithError(responseWriter, http.StatusBadRequest, err.Error())\n        return\n    }\n    defer request.Body.Close()\n    if err := database.DBGORM.Save(&amp;question).Error; err != nil {\n        utils.ResponseWithError(responseWriter, http.StatusInternalServerError, err.Error())\n        return\n    }\n    utils.ResponseWithSuccess(responseWriter, http.StatusCreated, \"The new entry successfully created.\")\n}\n</code></pre>\n\n<p>Where I make mistake?</p>\n\n<p>I add built-in logger support of GORM. In console it show me next SQL statement:</p>\n\n<pre><code>INSERT INTO \"question\" (\"question_text\",\"widget_type_id\") VALUES ('NEW QUESTION TEXT HERE',0) RETURNING \"question\".\"question_id\"\n</code></pre>\n\n<p>As you can see <code>widget_type_id</code> value 0. WHY?</p>\n"}, {"tags": ["debugging", "go", "intellij-idea", "visual-studio-code"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1551688432, "post_id": 54979269, "comment_id": 96716848, "body": "The package should have a <code>main()</code> function."}, {"owner": {"reputation": 710, "user_id": 4418990, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JcDkAknqj0s/AAAAAAAAAAI/AAAAAAAAACI/gD8qrN7ARR8/photo.jpg?sz=128", "display_name": "Vrushali Raut", "link": "https://stackoverflow.com/users/4418990/vrushali-raut"}, "edited": false, "score": 0, "creation_date": 1551688896, "post_id": 54979269, "comment_id": 96717059, "body": "I was not able to find outflow of the project in IntelliJ so I tried to use goland. now I can see the whole flow and debug, compile my project."}, {"owner": {"reputation": 937, "user_id": 6038747, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c3ca458fc0209c61c2b9fb656ef1610d?s=128&d=identicon&r=PG&f=1", "display_name": "grpcMe", "link": "https://stackoverflow.com/users/6038747/grpcme"}, "reply_to_user": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1551689013, "post_id": 54979269, "comment_id": 96717109, "body": "@SimoEndre - yes, it should. But this is just a dummy project to show the issue of it not being able to find the &quot;Add&quot; function from the test file."}, {"owner": {"reputation": 937, "user_id": 6038747, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c3ca458fc0209c61c2b9fb656ef1610d?s=128&d=identicon&r=PG&f=1", "display_name": "grpcMe", "link": "https://stackoverflow.com/users/6038747/grpcme"}, "reply_to_user": {"reputation": 710, "user_id": 4418990, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JcDkAknqj0s/AAAAAAAAAAI/AAAAAAAAACI/gD8qrN7ARR8/photo.jpg?sz=128", "display_name": "Vrushali Raut", "link": "https://stackoverflow.com/users/4418990/vrushali-raut"}, "edited": false, "score": 0, "creation_date": 1551689055, "post_id": 54979269, "comment_id": 96717120, "body": "@VrushaliRaut - Goland is not an option, unfortunately. I have an Idea license, not a Goland one."}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1551699450, "post_id": 54979269, "comment_id": 96722754, "body": "why don&#39;t you use goland? that is the intellij ide that was made for go, i am not sure if the go plugin for intellij is up to date"}, {"owner": {"reputation": 937, "user_id": 6038747, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c3ca458fc0209c61c2b9fb656ef1610d?s=128&d=identicon&r=PG&f=1", "display_name": "grpcMe", "link": "https://stackoverflow.com/users/6038747/grpcme"}, "reply_to_user": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1551699736, "post_id": 54979269, "comment_id": 96722912, "body": "@Pizzalord because goland isn&#39;t included in the IntelliJ Ultimate license that I have. I checked with them and they said the Go plugin for IDEA is up-to-date with goland."}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1551700370, "post_id": 54979269, "comment_id": 96723232, "body": "strange because when i use goland your code work, but with intellij your code does not, this makes me think it might be a bug in the go plugin"}, {"owner": {"reputation": 937, "user_id": 6038747, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c3ca458fc0209c61c2b9fb656ef1610d?s=128&d=identicon&r=PG&f=1", "display_name": "grpcMe", "link": "https://stackoverflow.com/users/6038747/grpcme"}, "reply_to_user": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1551705265, "post_id": 54979269, "comment_id": 96725770, "body": "@Pizzalord that&#39;s strange - I downloaded the Goland trial to see if it works, but even with Goland I get the same issue. Did you have to change a setting somewhere to make it work with Goland?"}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1551707644, "post_id": 54979269, "comment_id": 96727103, "body": "@grpcMe i ran it from go/src/username/test/ which had both files"}, {"owner": {"reputation": 937, "user_id": 6038747, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c3ca458fc0209c61c2b9fb656ef1610d?s=128&d=identicon&r=PG&f=1", "display_name": "grpcMe", "link": "https://stackoverflow.com/users/6038747/grpcme"}, "reply_to_user": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1551710338, "post_id": 54979269, "comment_id": 96728686, "body": "@Pizzalord ahh ok, yes that makes sense. It does work when I&#39;m working in <code>$GOPATH</code>, but not when I&#39;m outside it."}], "answers": [{"comments": [{"owner": {"reputation": 937, "user_id": 6038747, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c3ca458fc0209c61c2b9fb656ef1610d?s=128&d=identicon&r=PG&f=1", "display_name": "grpcMe", "link": "https://stackoverflow.com/users/6038747/grpcme"}, "edited": false, "score": 0, "creation_date": 1551691367, "post_id": 54979936, "comment_id": 96718297, "body": "My project is not located in <code>$GOPATH</code>."}, {"owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "reply_to_user": {"reputation": 937, "user_id": 6038747, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c3ca458fc0209c61c2b9fb656ef1610d?s=128&d=identicon&r=PG&f=1", "display_name": "grpcMe", "link": "https://stackoverflow.com/users/6038747/grpcme"}, "edited": false, "score": 0, "creation_date": 1551691578, "post_id": 54979936, "comment_id": 96718406, "body": "must be project folder in $GOPATH. document is <a href=\"https://github.com/golang/go/wiki/SettingGOPATH\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/SettingGOPATH</a>"}, {"owner": {"reputation": 937, "user_id": 6038747, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c3ca458fc0209c61c2b9fb656ef1610d?s=128&d=identicon&r=PG&f=1", "display_name": "grpcMe", "link": "https://stackoverflow.com/users/6038747/grpcme"}, "edited": false, "score": 0, "creation_date": 1551692615, "post_id": 54979936, "comment_id": 96718982, "body": "My <code>$GOPATH</code> is set, but the project does not have to be in <code>$GOPATH</code>. If this was the issue, then VSCode wouldn&#39;t be working; nor would the command line...."}, {"owner": {"reputation": 509, "user_id": 5462132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42bf54b25a6c3789897fc4b008aeaac1?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Zolotov", "link": "https://stackoverflow.com/users/5462132/alexander-zolotov"}, "edited": false, "score": 0, "creation_date": 1551767862, "post_id": 54979936, "comment_id": 96749694, "body": "it is the GOPATH problem. As the package has no import path, GoLand supposes that it knows nothing about this package and do not compile all files around the given function. As I said in the issue (<a href=\"https://youtrack.jetbrains.com/issue/GO-7013\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issue/GO-7013</a>) we don&#39;t want to encourage users to use non-recommended project layout."}], "tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": false, "score": 1, "last_activity_date": 1551694788, "last_edit_date": 1551694788, "creation_date": 1551690684, "answer_id": 54979936, "question_id": 54979269, "link": "https://stackoverflow.com/questions/54979269/unable-to-debug-go-applications-in-intellij/54979936#54979936", "title": "Unable to debug Go applications in IntelliJ", "body": "<p>It may be <code>$GOPATH</code> is problem.</p>\n\n<p>Correct GOPATH Project.</p>\n\n<pre><code>$GOPATH/src/hello/main.go\n$GOPATH/src/hello/main_test.go\n</code></pre>\n\n<p>But Incorrect GOPATH Project.</p>\n\n<pre><code>/hello/main.go\n/hello/main_test.go\n</code></pre>\n"}], "owner": {"reputation": 937, "user_id": 6038747, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c3ca458fc0209c61c2b9fb656ef1610d?s=128&d=identicon&r=PG&f=1", "display_name": "grpcMe", "link": "https://stackoverflow.com/users/6038747/grpcme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 682, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1551694788, "creation_date": 1551688087, "question_id": 54979269, "link": "https://stackoverflow.com/questions/54979269/unable-to-debug-go-applications-in-intellij", "title": "Unable to debug Go applications in IntelliJ", "body": "<p>I am unable to run Go tests, in IntelliJ Idea, using the Green \"Play\" button in the IDE. </p>\n\n<p>The vast majority of my Go development is down outside of <code>$GOPATH</code>, but all my environment variables are set correctly so this has never been a problem. </p>\n\n<p>I created a dummy project, in my Desktop directory, with the following structure...</p>\n\n<pre><code>.\n\u251c\u2500\u2500 main.go\n\u251c\u2500\u2500 main_test.go\n</code></pre>\n\n<p><code>main.go</code>:</p>\n\n<pre><code>package main\n\nfunc Add(a, b int) int {\n    return a+b\n}\n</code></pre>\n\n<p><code>main_test.go</code></p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc TestAdd(t *testing.T) {\n    res := Add(1, 2)\n\n    if res != 3 {\n        t.Errorf(\"Fail\")\n    }\n}\n</code></pre>\n\n<p>I can run the test fine from the command line (<code>go test .</code>) and I can use VSCodes <code>run test</code> button in the IDE fine, but when I try the \"Play\" button in IntelliJ I get <code>./main_test.go:6:9: undefined: Add</code>.</p>\n\n<p>As per <a href=\"https://intellij-support.jetbrains.com/hc/en-us/community/posts/360003263520-Couple-of-problems-coming-from-VSCode\" rel=\"nofollow noreferrer\">this</a> IntelliJ Support Question, I've made sure my Go Test template is set to \"directory\" but I can't seem to get it to work as it recreates a new config every time set to the file. </p>\n\n<p>Any help appreciated...</p>\n\n<p><strong>edit 1:</strong> I have just moved over from VScode to IntelliJ, which is what I meant by my above statement of \"so this has never been a problem\". It has not worked in IntelliJ since I downloaded it a couple of days ago. </p>\n"}, {"tags": ["go", "server", "channel", "shutdown", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 4580, "user_id": 262748, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O0oj4.png?s=128&g=1", "display_name": "Benny Jobigan", "link": "https://stackoverflow.com/users/262748/benny-jobigan"}, "is_accepted": false, "score": 1, "last_activity_date": 1551686239, "creation_date": 1551686239, "answer_id": 54978843, "question_id": 54978683, "link": "https://stackoverflow.com/questions/54978683/how-to-gracefully-shutting-down-a-golang-server/54978843#54978843", "title": "How to gracefully shutting down a golang server?", "body": "<p>As of Go 1.8, net/http.Server has a function <code>Shutdown</code> which can be used to stop a server. Documentation and an example are available in the <a href=\"https://golang.org/pkg/net/http/#Server.Shutdown\" rel=\"nofollow noreferrer\">Go documentation</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": false, "score": 0, "last_activity_date": 1551691215, "creation_date": 1551691215, "answer_id": 54980077, "question_id": 54978683, "link": "https://stackoverflow.com/questions/54978683/how-to-gracefully-shutting-down-a-golang-server/54980077#54980077", "title": "How to gracefully shutting down a golang server?", "body": "<pre><code>package main\n\nimport (\n    \"context\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"os/signal\"\n)\n\nfunc main() {\n    var srv http.Server\n\n    idleConnsClosed := make(chan struct{})\n    go func() {\n        sigint := make(chan os.Signal, 1)\n        signal.Notify(sigint, os.Interrupt)\n        &lt;-sigint\n\n        // We received an interrupt signal, shut down.\n        if err := srv.Shutdown(context.Background()); err != nil {\n            // Error from closing listeners, or context timeout:\n            log.Printf(\"HTTP server Shutdown: %v\", err)\n        }\n        close(idleConnsClosed)\n    }()\n\n    if err := srv.ListenAndServe(); err != http.ErrServerClosed {\n        // Error starting or closing listener:\n        log.Printf(\"HTTP server ListenAndServe: %v\", err)\n    }\n\n    &lt;-idleConnsClosed\n}\n</code></pre>\n\n<p>document is <a href=\"https://golang.org/pkg/net/http/#Server.Shutdown\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Server.Shutdown</a>.</p>\n"}], "owner": {"reputation": 1187, "user_id": 10390273, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZnPo-zLAkpE/AAAAAAAAAAI/AAAAAAAAAQ0/eDv2tBJWBWM/photo.jpg?sz=128", "display_name": "ASHWIN RAJEEV", "link": "https://stackoverflow.com/users/10390273/ashwin-rajeev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2256, "favorite_count": 0, "closed_date": 1551692064, "answer_count": 2, "score": -1, "last_activity_date": 1551770986, "creation_date": 1551685527, "last_edit_date": 1551770986, "question_id": 54978683, "link": "https://stackoverflow.com/questions/54978683/how-to-gracefully-shutting-down-a-golang-server", "closed_reason": "Duplicate", "title": "How to gracefully shutting down a golang server?", "body": "<p>When building a custom server application it is better to be having a shutting down mechanism for ensuring all our running processes are stopped before the server down and it will also help in better in-memory management.</p>\n\n<p>How can we build such a mechanism with Golang and its powers? \nThere is already a ,<code>shutdown</code> function available in Golang my ibtension is to make developers think out of the box and create multiple\nmethods for do the same. It will help to make our golang community more better and stronger. Below I share one of my answer and hope you guys make more suggestions and answers..\ud83d\ude0a</p>\n"}, {"tags": ["json", "go", "dynamic"], "comments": [{"owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 2, "creation_date": 1551688461, "post_id": 54978456, "comment_id": 96716863, "body": "Look up maps and slices in Golang, then lookup <code>json.Unmarshal</code>"}, {"owner": {"reputation": 778, "user_id": 7411243, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QmcMbmJJxBI/AAAAAAAAAAI/AAAAAAAAA-w/mD__UQoiNiQ/photo.jpg?sz=128", "display_name": "banoth ravinder", "link": "https://stackoverflow.com/users/7411243/banoth-ravinder"}, "reply_to_user": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1551691405, "post_id": 54978456, "comment_id": 96718315, "body": "@Seaskyways can you give brief explanation with code As I&#39;m new to Golang"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551711628, "post_id": 54978456, "comment_id": 96729520, "body": "Most basic questions are answered within the <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">Tour of Go</a> which only takes a few minutes to finish."}], "answers": [{"comments": [{"owner": {"reputation": 778, "user_id": 7411243, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QmcMbmJJxBI/AAAAAAAAAAI/AAAAAAAAA-w/mD__UQoiNiQ/photo.jpg?sz=128", "display_name": "banoth ravinder", "link": "https://stackoverflow.com/users/7411243/banoth-ravinder"}, "edited": false, "score": 0, "creation_date": 1551692504, "post_id": 54980346, "comment_id": 96718918, "body": "This is no where related to the question. Please don&#39;t give uneven answers randomly."}], "tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": false, "score": -2, "last_activity_date": 1551692195, "creation_date": 1551692195, "answer_id": 54980346, "question_id": 54978456, "link": "https://stackoverflow.com/questions/54978456/how-to-make-dynamic-json/54980346#54980346", "title": "How to make dynamic JSON", "body": "<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\n//Member -\ntype Member struct {\n    Name   string\n    Age    int\n    Active bool\n}\n\nfunc main() {\n    // you data\n    mem := Member{\"Alex\", 10, true}\n\n    // JSON encoding\n    jsonBytes, err := json.Marshal(mem)\n    if err != nil {\n        panic(err)\n    }\n\n    // JSON to string for console\n    jsonString := string(jsonBytes)\n\n    fmt.Println(jsonString)\n}\n</code></pre>\n\n<p>and \"JSON and Go\" documents <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">https://blog.golang.org/json-and-go</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "is_accepted": false, "score": 1, "last_activity_date": 1610957263, "last_edit_date": 1610957263, "creation_date": 1551699120, "answer_id": 54982379, "question_id": 54978456, "link": "https://stackoverflow.com/questions/54978456/how-to-make-dynamic-json/54982379#54982379", "title": "How to make dynamic JSON", "body": "<p>Go is a statically typed language, unlike Javascript (which JS in JSON stands for).\nThis means that every variable has to have a specified type at the time of compilation which doesn't quite comply with how JSON works.</p>\n<p>However Go has provided a built-in <code>json</code> package which simplifies the process.</p>\n<p>You should know 3 things to get going with JSON in Go, and you can advance more...</p>\n<ol>\n<li>Go slices are translated to JSON arrays (<code>[]interface{}</code>)</li>\n<li>Go maps are translated to JSON objects (<code>map[string]interface{}</code>)</li>\n<li><code>json</code> package does it all (<code>json.Marshal</code> and <code>json.Unmarshal</code>)</li>\n</ol>\n<p>I find if you read this article you can get an understanding of how things work:</p>\n<p><a href=\"https://www.sohamkamani.com/blog/2017/10/18/parsing-json-in-golang/\" rel=\"nofollow noreferrer\">https://www.sohamkamani.com/blog/2017/10/18/parsing-json-in-golang/</a><br />\n<a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">https://blog.golang.org/json-and-go</a></p>\n"}], "owner": {"reputation": 778, "user_id": 7411243, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QmcMbmJJxBI/AAAAAAAAAAI/AAAAAAAAA-w/mD__UQoiNiQ/photo.jpg?sz=128", "display_name": "banoth ravinder", "link": "https://stackoverflow.com/users/7411243/banoth-ravinder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1307, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1610957272, "creation_date": 1551684483, "last_edit_date": 1610957272, "question_id": 54978456, "link": "https://stackoverflow.com/questions/54978456/how-to-make-dynamic-json", "title": "How to make dynamic JSON", "body": "<p>Suppose the JSON initially looks like:</p>\n\n<pre><code>jsonData := {\n  \"type\": \"text\",\n  \"contents\": []\n}\n</code></pre>\n\n<p>I want to use a loop in order to append the json below to the <code>contents</code> field of <code>jsonData</code> at runtime:</p>\n\n<pre><code>{\n      \"type\": \"bubble\",\n      \"hero\": {\n        \"size\": \"full\"\n      },\n      \"body\": {\n        \"spacing\": \"sm\",\n        \"contents\": [\n          {\n            \"size\": \"xl\"\n          },\n          {\n            \"type\": \"box\",\n            \"contents\": [\n              {\n                \"flex\": 0\n              },\n              {\n                \"flex\": 0\n              }\n            ]\n          }\n        ]\n      },\n      \"footer\": {\n        \"spacing\": \"sm\",\n        \"contents\": [\n          {\n            \"type\": \"button\",\n            \"action\": {\n              \"type\": \"uri\"\n            }\n          },\n          {\n            \"type\": \"button\",\n            \"action\": {\n              \"type\": \"uri\"\n            }\n          }\n        ]\n      }\n    },\n</code></pre>\n\n<p>Finally output looks like this : </p>\n\n<pre><code>jsonData := {\n      \"type\": \"text\",\n      \"contents\": [{......},{.......}]\n    }\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 10317705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e78e18a9478b3cffaba3a2a90f5d09fa?s=128&d=identicon&r=PG&f=1", "display_name": "Jacinth", "link": "https://stackoverflow.com/users/10317705/jacinth"}, "edited": false, "score": 0, "creation_date": 1552183506, "post_id": 55002420, "comment_id": 96913187, "body": "Thanks for your reply, it&#39;s almost close what I need and inspired me some ideas to keep move on."}], "tags": [], "owner": {"reputation": 258, "user_id": 2969272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95bc136055ef3028847d419f129f409d?s=128&d=identicon&r=PG", "display_name": "antham", "link": "https://stackoverflow.com/users/2969272/antham"}, "is_accepted": true, "score": 0, "last_activity_date": 1551787353, "creation_date": 1551787353, "answer_id": 55002420, "question_id": 54978042, "link": "https://stackoverflow.com/questions/54978042/how-to-do-multi-step-search-in-nested-json-with-go/55002420#55002420", "title": "How to do multi step search in nested JSON with Go", "body": "<p>I'm not sure I understood properly what you want, so I wrote a snippet :</p>\n\n\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\ntype Setting struct {\n    Code1 string\n    Code2 string\n    Seq   string\n}\n\ntype entry struct {\n    site string\n    code string\n    main string\n}\n\nfunc main() {\n    entries := []entry{\n        {\"\", \"0700-Shift\", \"010_A\"},\n        {\"\", \"2135-Packing\", \"030_C\"},\n        {\"\", \"3343-Check\", \"050_E\"},\n        {\"\", \"4355-Casting\", \"080_H\"},\n        {\"\", \"6903-ReDo Test\", \"020_B\"},\n        {\"\", \"2277-Scope chk\", \"080_H\"},\n    }\n\n    var jsonBlob = []byte(`[\n        {\"010_A\": [\n        {\n            \"Code1\": \"010_02\",\n            \"Code2\": \"010_0231\",\n            \"Seq\": \"000 Start\"\n        },\n        {\n            \"Code1\": \"010_08\",\n            \"OP_CODE\": \"010_0822\",\n            \"Seq\": \"010 Shift\"\n        }\n        ],\n         \"020_B\": [{\n            \"Code1\": \"020_69\",\n            \"Code2\": \"020_7011\",\n            \"Seq\": \"000 ReDo Test\"\n       },\n       {\n            \"Code1\": \"020_27\",\n            \"Code2\": \"\",\n            \"Seq\": \"000 Redo Combine\"\n       }\n       ],\n        \"080_H\": [\n       {\n            \"Code1\": \"080_06\",\n            \"Code2\": \"\",\n            \"Seq\": \"005 Merge\"\n       },\n       {\n            \"Code1\": \"080_43\",\n            \"Code2\": \"\",\n            \"Seq\": \"010 Casting\"\n       },\n       {\n            \"Code1\": \"080_66\",\n            \"Code2\": \"080_6621\",\n            \"Seq\": \"100 Cooling\"\n       },\n       {\n          \"Code1\": \"080_66\",\n          \"Code2\": \"2277\",\n          \"Seq\": \"Test\"\n       }\n       ]}\n       ]`)\n\n    datas := []map[string][]Setting{}\n\n    if err := json.Unmarshal(jsonBlob, &amp;datas); err != nil {\n        log.Fatal(err)\n    }\n\n    for key, settings := range datas[0] {\n        for _, setting := range settings {\n            for k, e := range entries {\n                if e.main == key &amp;&amp; setting.Code2 == e.code[:4] {\n                    entries[k].site = setting.Seq\n                }\n            }\n        }\n    }\n\n    fmt.Println(entries)\n}\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 10317705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e78e18a9478b3cffaba3a2a90f5d09fa?s=128&d=identicon&r=PG&f=1", "display_name": "Jacinth", "link": "https://stackoverflow.com/users/10317705/jacinth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 55002420, "answer_count": 1, "score": 0, "last_activity_date": 1551787353, "creation_date": 1551682652, "question_id": 54978042, "link": "https://stackoverflow.com/questions/54978042/how-to-do-multi-step-search-in-nested-json-with-go", "title": "How to do multi step search in nested JSON with Go", "body": "<p>I am developing a website using Go for back-end and Angular for front-end.\nIn Go, I fetch raw data from database and reference fixed setting table(JSON formatted) then overwrite to corresponding columns.</p>\n\n<p>Raw data look like this:</p>\n\n<pre><code> Site  Code           Main\n       0700-Shift     010_A\n       2135-Packing   030_C\n       3343-Check     050_E\n       4355-Casting   080_H\n       6903-ReDo Test 020_B\n       2277-Scope chk 040_D\n</code></pre>\n\n<p>I cut some part of setting table:</p>\n\n<pre><code>[{\"010_A\": [\n{\n  \"Code1\": \"010_01\",\n  \"Code2\": \"\",\n  \"Seq\": \"000 Start\",\n},\n{\n  \"Code1\": \"010_07\",\n  \"Code2\": \"010_0700\",\n  \"Seq\": \"010 Shift\"\n},\n],\n\"020_B\": [{\n  \"Code1\": \"020_69\",\n  \"Code2\": \"\",\n  \"Seq\": \"000 ReDo Test\"\n},\n{\n  \"Code1\": \"020_27\",\n  \"Code2\": \"\",\n  \"Seq\": \"000 Redo Combine\"\n}\n],\n\"080_H\": [\n{\n  \"Code1\": \"080_06\",\n  \"Code2\": \"\",\n  \"Seq\": \"005 Merge\"\n},\n{\n  \"Code1\": \"080_43\",\n  \"Code2\": \"\",\n  \"Seq\": \"010 Casting\"\n},\n{\n  \"Code1\": \"080_66\",\n  \"Code2\": \"080_6621\",\n  \"Seq\": \"100 Cooling\"\n}\n]}]\n</code></pre>\n\n<p>And the Go struct for setting table is: </p>\n\n<pre><code>type Settingtable struct {\n    Code1    string\n    Code2    string\n    Seq      string\n}\n</code></pre>\n\n<p>I using \"Main\" to check setting table \"010_A\" to \"080_H\" first, if match then use first 4 digits of \"Code\" to check \"Code2\" in setting table. If \"Main\" and \"Code2\" all match then return \"Seq\" and paste to \"Site\" column.</p>\n\n<p>The following is where I stuck in: </p>\n\n<pre><code>package main\n\nimport (\n\"encoding/json\"\n\"fmt\"\n)\n\nfunc main() {\n    var jsonBlob = []byte(`[\n        {\"010_A\": [\n        {\n            \"Code1\": \"010_02\",\n            \"Code2\": \"010_0231\",\n            \"Seq\": \"000 Start\"\n        },\n        {\n            \"Code1\": \"010_08\",\n            \"OP_CODE\": \"010_0822\",\n            \"Seq\": \"010 Shift\"\n        }\n        ],\n         \"020_B\": [{\n            \"Code1\": \"020_69\",\n            \"Code2\": \"020_7011\",\n            \"Seq\": \"000 ReDo Test\"\n       },\n       {\n            \"Code1\": \"020_27\",\n            \"Code2\": \"\",\n            \"Seq\": \"000 Redo Combine\"\n       }\n       ],\n        \"080_H\": [\n       {\n            \"Code1\": \"080_06\",\n            \"Code2\": \"\",\n            \"Seq\": \"005 Merge\"\n       },\n       {\n            \"Code1\": \"080_43\",\n            \"Code2\": \"\",\n            \"Seq\": \"010 Casting\"\n       },\n       {\n            \"Code1\": \"080_66\",\n            \"Code2\": \"080_6621\",\n            \"Seq\": \"100 Cooling\"\n       }\n       ]}\n       ]`)\n\ntype Record map[string][]map[string]string\nvar records []Record\n\nerr := json.Unmarshal(jsonBlob, &amp;records)\nif err != nil {\n    fmt.Println(\"error:\", err)\n}\nfmt.Printf(\"%+v\\n\", records)\n\nif v, s := records[0][\"020_B\"][0][\"Code2\"]; s {\n    fmt.Println(\"ok:\", v)\n    }\n}\n</code></pre>\n\n<p>It only return first result not to mention what the next function I want to do (loop input search condition, paste to raw data column..)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 4, "creation_date": 1551683045, "post_id": 54978013, "comment_id": 96714694, "body": "Your code waits for both the channels whereas select waits for either"}, {"owner": {"reputation": 2754, "user_id": 849632, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/NDhZK.jpg?s=128&g=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/849632/arun"}, "reply_to_user": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 1, "creation_date": 1551684889, "post_id": 54978013, "comment_id": 96715371, "body": "Gotchaa !! pretty clear now"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1551701421, "post_id": 54978013, "comment_id": 96723769, "body": "The <code>context</code> package documentation has an <a href=\"https://godoc.org/context#example-WithCancel\" rel=\"nofollow noreferrer\">interesting example involving a cancellation channel</a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551711771, "post_id": 54978013, "comment_id": 96729618, "body": "Most basic questions are answered within the <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">Tour of Go</a> which only takes a few minutes to finish."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 7, "last_activity_date": 1551683608, "creation_date": 1551683608, "answer_id": 54978260, "question_id": 54978013, "link": "https://stackoverflow.com/questions/54978013/why-select-statement-in-golang/54978260#54978260", "title": "Why select statement in GoLang", "body": "<blockquote>\n  <p>Do we really need a select statement ?</p>\n</blockquote>\n\n<p>Yes. No user code can select exactly one of several possible channel operations if several are able to execute or none (default) if no case is ready.</p>\n\n<p>(Your code does something completely different.)</p>\n"}], "owner": {"reputation": 2754, "user_id": 849632, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/NDhZK.jpg?s=128&g=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/849632/arun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 54978260, "answer_count": 1, "score": 1, "last_activity_date": 1551683608, "creation_date": 1551682515, "question_id": 54978013, "link": "https://stackoverflow.com/questions/54978013/why-select-statement-in-golang", "title": "Why select statement in GoLang", "body": "<p>Am learning <code>Go</code> and here in <a href=\"https://gobyexample.com/select\" rel=\"nofollow noreferrer\">this example</a>, i can see that <code>select</code> statement lets a goroutine wait on multiple communication operations</p>\n\n<p>Do we really need a <code>select</code> statement ? My below does the same without <code>select</code> statement </p>\n\n<pre><code>func runForChannel1(channel1 chan string) {\n    time.Sleep(1 * time.Second)\n    channel1 &lt;- \"Hi Arun ... I am Channel-1\"\n}\n\nfunc runForChannel2(channel2 chan string) {\n    time.Sleep(2 * time.Second)\n    channel2 &lt;- \"Hi Arun ... I am Channel-2\"\n}\n\nfunc testSelect() {\n    channel1 := make(chan string)\n    channel2 := make(chan string)\n\n    go runForChannel1(channel1)\n    go runForChannel2(channel2)\n\n    chval1, chval2 := &lt;-channel1, &lt;-channel2\n    fmt.Println(chval1, chval2)\n\n}\n\nfunc main() {\n    testSelect()\n}\n</code></pre>\n\n<p>Without the <code>select</code> statment, i was able to wait for both the channels to get their values... Why we would need <code>Select</code> statement ? Can someone educate me please ?</p>\n"}, {"tags": ["linux", "shell", "api", "go"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1551682053, "post_id": 54977878, "comment_id": 96714345, "body": "That is in general impossible (all web browsers protect the user from locally running programs). The web service is not running on your Linux laptop (but on a remote Linux server). You can find programs (such as libonion <a href=\"https://github.com/davidmoreno/onion/wiki/Oterm\" rel=\"nofollow noreferrer\">oterm</a>) doing what you want, and you could rewrite them in Go"}, {"owner": {"reputation": 6996, "user_id": 2210442, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/D0uB0.jpg?s=128&g=1", "display_name": "TechChain", "link": "https://stackoverflow.com/users/2210442/techchain"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1551682119, "post_id": 54977878, "comment_id": 96714368, "body": "But go is running that service. From go lang i want to launch the terminal"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1551682165, "post_id": 54977878, "comment_id": 96714387, "body": "Congratulations. Either reproduce what <code>oterm</code> is doing (and that may require complex things like WebSockets) or give up your goal. You certainly should take much more time in understanding <a href=\"https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol\" rel=\"nofollow noreferrer\">HTTP</a>, <a href=\"https://en.wikipedia.org/wiki/HTML5\" rel=\"nofollow noreferrer\">HTML5</a>, <a href=\"https://en.wikipedia.org/wiki/Ajax_(programming)\" rel=\"nofollow noreferrer\">AJAX</a>, <a href=\"https://en.wikipedia.org/wiki/WebSocket\" rel=\"nofollow noreferrer\">WebSockets</a> and combine them as <code>oterm</code> does"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1551682478, "post_id": 54977878, "comment_id": 96714486, "body": "Don&#39;t forget that in general the web server and the web browsers are running on different computers. The web is designed to make impossible for a web service to run programs on the browser&#39;s machine (that would be a huge security hole)"}], "answers": [{"tags": [], "owner": {"reputation": 4580, "user_id": 262748, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O0oj4.png?s=128&g=1", "display_name": "Benny Jobigan", "link": "https://stackoverflow.com/users/262748/benny-jobigan"}, "is_accepted": false, "score": 3, "last_activity_date": 1551687214, "creation_date": 1551687214, "answer_id": 54979080, "question_id": 54977878, "link": "https://stackoverflow.com/questions/54977878/launch-terminal-window-from-go-lang-program/54979080#54979080", "title": "Launch terminal window from go lang program?", "body": "<p>Have you looked at the Go standard library? Your best bet is <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow noreferrer\">os/exec</a>. I don't know how feasible it would be to open another terminal and launch the script in <em>it</em>, but you can pipe the output of the command launched by os/exec to the stdout of the terminal in which the go program was launched.</p>\n\n<p>From your question, it sounds like the go program downloading and running the script is already being run by the user on the local machine. If this is not the case, then the above will not work.</p>\n"}], "owner": {"reputation": 6996, "user_id": 2210442, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/D0uB0.jpg?s=128&g=1", "display_name": "TechChain", "link": "https://stackoverflow.com/users/2210442/techchain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1551687214, "creation_date": 1551681892, "last_edit_date": 1551682159, "question_id": 54977878, "link": "https://stackoverflow.com/questions/54977878/launch-terminal-window-from-go-lang-program", "title": "Launch terminal window from go lang program?", "body": "<p>I want to have a functionality in which i will create an go program running on linux system. When that program is running it will download a <code>zip folder</code> from server &amp; extract it to user <code>HOME</code> directory. That extracted folder will have a shell script file eg. <code>Update.sh</code>. \nNow i want once that file is extracted i want to open the terminal &amp; run the shell script automatically which resides inside extracted folder. Kindly gudie me can i do that ?</p>\n"}, {"tags": ["go", "closures", "goroutine"], "comments": [{"owner": {"reputation": 145, "user_id": 3117565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dddb7750fcb817db6fa82bad406e938d?s=128&d=identicon&r=PG", "display_name": "sgraham", "link": "https://stackoverflow.com/users/3117565/sgraham"}, "edited": false, "score": 1, "creation_date": 1551677530, "post_id": 54976927, "comment_id": 96712958, "body": "2 looks good. the context should be the same in both options so using the outer func seems fine"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1551683707, "post_id": 54976927, "comment_id": 96714946, "body": "In the first example: Context should be the first argument by convention. Aside from that: It does not matter."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1551681469, "creation_date": 1551681469, "answer_id": 54977796, "question_id": 54976927, "link": "https://stackoverflow.com/questions/54976927/best-way-to-pass-context-context-to-a-closure-executed-in-a-separate-goroutine/54977796#54977796", "title": "Best way to pass context.Context to a closure executed in a separate goroutine", "body": "<p>Both should be fine. The key to remember is that contexts are immutable. This means there's no risk of a race condition where some other goroutine is updating the context as you're trying to read it, so you don't need to worry about the normal synchronization methods.</p>\n\n<p>So in short, nothing special is needed so #2 is just fine. Since #1 isn't actually executing a closure, it's ideal in situations where you want to execute a named function, which takes a context argument</p>\n\n<hr>\n\n<p><strong>Note on terminology:</strong> Your original question (which I edited for clarity) asked about executing \"a goroutine in a closure.\" Technically speaking, this is non-sense. But it's a common confusion. Goroutines are light-weight threads of execution. Functions are bits of code. They are not the same thing, so referring to functions or closures as goroutines doesn't really make sense. See <a href=\"https://stackoverflow.com/a/53389196/13860\">this answer</a> for more details.</p>\n"}], "owner": {"reputation": 375, "user_id": 7586020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7579bdcac485b4049acfbd184604219?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7586020/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 361, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1551681785, "creation_date": 1551675874, "last_edit_date": 1551681785, "question_id": 54976927, "link": "https://stackoverflow.com/questions/54976927/best-way-to-pass-context-context-to-a-closure-executed-in-a-separate-goroutine", "title": "Best way to pass context.Context to a closure executed in a separate goroutine", "body": "<p>What is best way to pass <code>context.Context</code> to closure to be executed in a separate goroutine?</p>\n\n<p>Since I'm not mutating <code>context.Context</code> inside the closure, I assume both options are valid. 2nd option can save me tiny bit of memory by not copying the interface.</p>\n\n<p>1) pass as an argument</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func run(ctx context.Context) {\n  for i := 0; i &lt;= 5; i++ {\n    go func(id int, ictx context.Context) {\n      for {\n        select {\n          case &lt;- ictx.Done():\n            return\n          default:\n            // do something\n        }\n      }\n    }(i, ctx)\n  }\n}\n</code></pre>\n\n<p>2) expose outer context variable</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func run(ctx context.Context) {\n  for i := 0; i &lt;= 5; i++ {\n    go func(id int) {\n      for {\n        select {\n          case &lt;- ctx.Done():\n            return\n          default:\n            // do something\n        }\n      }\n    }(i)\n  }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1551688058, "post_id": 54976925, "comment_id": 96716681, "body": "Would you try using ts without the reference operator &quot;&amp;&quot;. I think you are writing the pointer, not the timestamp."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1551693249, "post_id": 54976925, "comment_id": 96719298, "body": "@Seaskyways: That is not the problem."}], "answers": [{"comments": [{"owner": {"reputation": 1043, "user_id": 1004478, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/297652ae3e1b4a5f82076b8826dbd35a?s=128&d=identicon&r=PG", "display_name": "Jim", "link": "https://stackoverflow.com/users/1004478/jim"}, "edited": false, "score": 0, "creation_date": 1551796349, "post_id": 54980436, "comment_id": 96765396, "body": "that is a great answer, thank you! but to extend that, I guess besides commenting out the []byte, there&#39;s no way that I can work with it, right? since I don&#39;t want to modify the original code (source code)?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1551693562, "last_edit_date": 1551693562, "creation_date": 1551692545, "answer_id": 54980436, "question_id": 54976925, "link": "https://stackoverflow.com/questions/54976925/need-more-input-or-information-regarding-binary-write-error-invalid-type-xxx/54980436#54980436", "title": "need more input or information regarding binary.write error invalid type xxx", "body": "<blockquote>\n  <p>can anyone point me to some direction?</p>\n</blockquote>\n\n<hr>\n\n<p>Read the error message.</p>\n\n<blockquote>\n<pre><code>binary.Write: invalid type *timestamp.Timestamp\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>Read the documentation for <code>binary.Write</code> and <code>timestamp.Timestamp</code>.</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow noreferrer\">Package binary</a></p>\n  \n  <p><code>import \"encoding/binary\"</code> </p>\n  \n  <p><a href=\"https://golang.org/pkg/encoding/binary/#Write\" rel=\"nofollow noreferrer\">func Write</a></p>\n\n<pre><code>func Write(w io.Writer, order ByteOrder, data interface{}) error\n</code></pre>\n  \n  <p>Write writes the binary representation of data into w. Data must be a\n  fixed-size value or a slice of fixed-size values, or a pointer to such\n  data. Boolean values encode as one byte: 1 for true, and 0 for false.\n  Bytes written to w are encoded using the specified byte order and read\n  from successive fields of the data. When writing structs, zero values\n  are written for fields with blank (_) field names.</p>\n  \n  <p><a href=\"https://godoc.org/github.com/golang/protobuf/ptypes/timestamp\" rel=\"nofollow noreferrer\">package\n  timestamp</a></p>\n\n<pre><code>import \"github.com/golang/protobuf/ptypes/timestamp\" \n</code></pre>\n  \n  <p><a href=\"https://godoc.org/github.com/golang/protobuf/ptypes/timestamp#Timestamp\" rel=\"nofollow noreferrer\">type\n  Timestamp</a></p>\n\n<pre><code>type Timestamp struct {\n    // Represents seconds of UTC time since Unix epoch\n    // 1970-01-01T00:00:00Z. Must be from 0001-01-01T00:00:00Z to\n    // 9999-12-31T23:59:59Z inclusive.\n    Seconds int64 `protobuf:\"varint,1,opt,name=seconds,proto3\" json:\"seconds,omitempty\"`\n    // Non-negative fractions of a second at nanosecond resolution. Negative\n    // second values with fractions must still have non-negative nanos values\n    // that count forward in time. Must be from 0 to 999,999,999\n    // inclusive.\n    Nanos                int32    `protobuf:\"varint,2,opt,name=nanos,proto3\" json:\"nanos,omitempty\"`\n    XXX_NoUnkeyedLiteral struct{} `json:\"-\"`\n    XXX_unrecognized     []byte   `json:\"-\"`\n    XXX_sizecache        int32    `json:\"-\"`\n}\n</code></pre>\n  \n  <p>A Timestamp represents a point in time independent of any time zone or\n  calendar, represented as seconds and fractions of seconds at\n  nanosecond resolution in UTC Epoch time. It is encoded using the\n  Proleptic Gregorian Calendar which extends the Gregorian calendar\n  backwards to year one. It is encoded assuming all minutes are 60\n  seconds long, i.e. leap seconds are \"smeared\" so that no leap second\n  table is needed for interpretation. Range is from 0001-01-01T00:00:00Z\n  to 9999-12-31T23:59:59.999999999Z. By restricting to that range, we\n  ensure that we can convert to and from RFC 3339 date strings. See\n  <a href=\"https://www.ietf.org/rfc/rfc3339.txt\" rel=\"nofollow noreferrer\">https://www.ietf.org/rfc/rfc3339.txt</a>.</p>\n</blockquote>\n\n<hr>\n\n<p>As the error message says: <code>*timestamp.Timestamp</code> is not a fixed-size value or a slice of fixed-size values, or a pointer to such data.</p>\n\n<p>To confirm that, comment out the <code>XXX_unrecognized</code> variable-sized field; there is no error.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/binary\"\n    \"fmt\"\n    \"time\"\n)\n\n// https://github.com/golang/protobuf/blob/master/ptypes/timestamp/timestamp.pb.go\ntype Timestamp struct {\n    // Represents seconds of UTC time since Unix epoch\n    // 1970-01-01T00:00:00Z. Must be from 0001-01-01T00:00:00Z to\n    // 9999-12-31T23:59:59Z inclusive.\n    Seconds int64 `protobuf:\"varint,1,opt,name=seconds,proto3\" json:\"seconds,omitempty\"`\n    // Non-negative fractions of a second at nanosecond resolution. Negative\n    // second values with fractions must still have non-negative nanos values\n    // that count forward in time. Must be from 0 to 999,999,999\n    // inclusive.\n    Nanos                int32    `protobuf:\"varint,2,opt,name=nanos,proto3\" json:\"nanos,omitempty\"`\n    XXX_NoUnkeyedLiteral struct{} `json:\"-\"`\n    // XXX_unrecognized     []byte   `json:\"-\"`\n    XXX_sizecache        int32    `json:\"-\"`\n}\n\nfunc main() {\n    buff := new(bytes.Buffer)\n\n    ts := &amp;Timestamp{\n        Seconds: time.Now().Unix(),\n        Nanos:   0,\n    }\n\n    err := binary.Write(buff, binary.LittleEndian, ts)\n\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(\"done\")\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Q5NGnO49Dsc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Q5NGnO49Dsc</a></p>\n\n<p>Output:</p>\n\n<pre><code>done\n</code></pre>\n"}], "owner": {"reputation": 1043, "user_id": 1004478, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/297652ae3e1b4a5f82076b8826dbd35a?s=128&d=identicon&r=PG", "display_name": "Jim", "link": "https://stackoverflow.com/users/1004478/jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 1, "accepted_answer_id": 54980436, "answer_count": 1, "score": 1, "last_activity_date": 1551693562, "creation_date": 1551675867, "question_id": 54976925, "link": "https://stackoverflow.com/questions/54976925/need-more-input-or-information-regarding-binary-write-error-invalid-type-xxx", "title": "need more input or information regarding binary.write error invalid type xxx", "body": "<p>I'm trying to write protobuf *Timestamp.timestamp to binary, and the error I got is <code>invalid type *Timestamp.timestamp</code> and I've tried to no avail, can anyone point me to some direction? thanks!</p>\n\n<pre><code>    package main\n\n    import (\n        \"bytes\"\n        \"encoding/binary\"\n        \"fmt\"\n        google_protobuf \"github.com/golang/protobuf/ptypes/timestamp\"\n        \"time\"\n    )\n\n    func main() {\n        buff := new(bytes.Buffer)\n\n        ts := &amp;google_protobuf.Timestamp{\n            Seconds: time.Now().Unix(),\n            Nanos:   0,\n        }\n\n        err := binary.Write(buff, binary.LittleEndian, ts)\n\n        if err != nil {\n            panic(err)\n        }\n        fmt.Println(\"done\")\n    }\n</code></pre>\n"}, {"tags": ["database", "go", "select"], "answers": [{"tags": [], "owner": {"reputation": 145, "user_id": 3117565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dddb7750fcb817db6fa82bad406e938d?s=128&d=identicon&r=PG", "display_name": "sgraham", "link": "https://stackoverflow.com/users/3117565/sgraham"}, "is_accepted": true, "score": 2, "last_activity_date": 1551678549, "creation_date": 1551678549, "answer_id": 54977305, "question_id": 54976903, "link": "https://stackoverflow.com/questions/54976903/strange-error-when-try-to-select-single-row-from-db/54977305#54977305", "title": "Strange error when try to select single row from db", "body": "<p><code>QueryRow</code> only returns <code>*Row</code>\n<a href=\"https://golang.org/pkg/database/sql/#DB.QueryRow\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/#DB.QueryRow</a></p>\n\n<p><code>rows, err := db.QueryRow(query, id1, id2)</code></p>\n\n<p>should be:</p>\n\n<p><code>rows := db.QueryRow(query, id1, id2)</code></p>\n"}], "owner": {"reputation": 575, "user_id": 7098465, "user_type": "registered", "accept_rate": 93, "profile_image": "https://graph.facebook.com/1208630015850926/picture?type=large", "display_name": "Vasilij Altunin", "link": "https://stackoverflow.com/users/7098465/vasilij-altunin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 54977305, "answer_count": 1, "score": 0, "last_activity_date": 1551678549, "creation_date": 1551675749, "question_id": 54976903, "link": "https://stackoverflow.com/questions/54976903/strange-error-when-try-to-select-single-row-from-db", "title": "Strange error when try to select single row from db", "body": "<p>I have query:</p>\n\n<pre><code>query := \"select id from atable where id1=$1 and id2=$2\"\n</code></pre>\n\n<p>and now i need to select single record so i try to use</p>\n\n<pre><code>id1 := \"1\" \nid2 := \"2\"\nrows, err := db.QueryRow(query, id1, id2)\n    if err != nil {\n        log.Println(\"SQL select error: \")\n        log.Println(err)\n    }\n</code></pre>\n\n<p>and i get error </p>\n\n<pre><code>assignment mismatch: 2 variables but 1 values(undefined)\n</code></pre>\n\n<p>in string </p>\n\n<pre><code>rows, err := db.QueryRow(query, id1, id2)\n</code></pre>\n\n<p>it very strange, i dont have ny problem with just <code>db.Query(query)</code></p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1551687770, "post_id": 54974821, "comment_id": 96716569, "body": "Just a quick remark, your comments &quot; // match&quot;, &quot; // group&quot;, are effectively useless since just below them the taken action is written. Unless you add some text to those comments describing what is happening, they are effectively useless."}, {"owner": {"reputation": 13, "user_id": 11145477, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UeaTnjPHqdc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdyCqz3rQ5_AnFIzI35E55xEzC4fA/mo/photo.jpg?sz=128", "display_name": "Jonh Smith", "link": "https://stackoverflow.com/users/11145477/jonh-smith"}, "reply_to_user": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1551691748, "post_id": 54974821, "comment_id": 96718516, "body": "Thanks! So insightful.. do you also know why it\u2019s not working?"}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1551696381, "post_id": 54974821, "comment_id": 96721138, "body": "Since the grouping keys are clearly present in the output I&#39;m suspect over possible type conversion from the original cursor. Pretty sure the <code>{ $sum: 1 }</code> gets internally treated as a <code>Double</code>, which means it&#39;s translation is probably coming through as floating point and possibly your numeric value in your struct is not lining up with that. So it&#39;s more likely happening there than the server suddenly deciding to send <code>0</code>."}, {"owner": {"reputation": 13, "user_id": 11145477, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UeaTnjPHqdc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdyCqz3rQ5_AnFIzI35E55xEzC4fA/mo/photo.jpg?sz=128", "display_name": "Jonh Smith", "link": "https://stackoverflow.com/users/11145477/jonh-smith"}, "edited": false, "score": 0, "creation_date": 1551713831, "post_id": 54974821, "comment_id": 96730825, "body": "Thanks Neil, I thought something in that direction too. So do you think var e struct{ type string, count float64} would work?"}, {"owner": {"reputation": 13, "user_id": 11145477, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UeaTnjPHqdc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdyCqz3rQ5_AnFIzI35E55xEzC4fA/mo/photo.jpg?sz=128", "display_name": "Jonh Smith", "link": "https://stackoverflow.com/users/11145477/jonh-smith"}, "edited": false, "score": 0, "creation_date": 1551738673, "post_id": 54974821, "comment_id": 96742485, "body": "no luck. It&#39;s only working if a define a map[string]interface{}. Which is not ideal. Any other suggestions?"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 11145477, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UeaTnjPHqdc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdyCqz3rQ5_AnFIzI35E55xEzC4fA/mo/photo.jpg?sz=128", "display_name": "Jonh Smith", "link": "https://stackoverflow.com/users/11145477/jonh-smith"}, "edited": false, "score": 0, "creation_date": 1551823486, "post_id": 54997274, "comment_id": 96779356, "body": "Thanks! it really helped. I&#39;ll be using bson.D from now on. Re the data type, it worked with the right bson tag. However, I couldn&#39;t replicate your second method. Even if I use consistent names in the projection phase, I still need the the right tag in myStruct to have the data returned into Total.  One more question, why do I need the extra brackets when I use bson.D? i.e. bson.D{ {&quot;type&quot;, &quot;$type} } rather than bson.D{&quot;type&quot;, &quot;$type&quot;} and {{&quot;$match&quot;, ..}} rather than {&quot;$match&quot;, ..}?"}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "reply_to_user": {"reputation": 13, "user_id": 11145477, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UeaTnjPHqdc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdyCqz3rQ5_AnFIzI35E55xEzC4fA/mo/photo.jpg?sz=128", "display_name": "Jonh Smith", "link": "https://stackoverflow.com/users/11145477/jonh-smith"}, "edited": false, "score": 0, "creation_date": 1551826786, "post_id": 54997274, "comment_id": 96780587, "body": "Without seeing your struct I can&#39;t really comment on why the second method doesn&#39;t work for you. <code>bson.D{}</code> is like an array it&#39;s using commas, so you need to have another brackets to group the key/value. i.e. <code>bson.D{ {key, value}, {key2, value2} }</code>"}], "tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 1, "last_activity_date": 1551769963, "creation_date": 1551769963, "answer_id": 54997274, "question_id": 54974821, "link": "https://stackoverflow.com/questions/54974821/aggregate-pipeline-returns-wrong-result-vs-cli/54997274#54997274", "title": "Aggregate pipeline returns wrong result vs CLI", "body": "<p>First, use <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson#D\" rel=\"nofollow noreferrer\">bson.D{}</a> instead of <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson#M\" rel=\"nofollow noreferrer\">bson.M{}</a>. This is because <code>bson.D{}</code> should be used in situations where order matters, such as MongoDB commands. </p>\n\n<p>You can also encapsulate the whole pipeline in <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo#Pipeline\" rel=\"nofollow noreferrer\">mongo.Pipeline</a>. For example: </p>\n\n<pre><code>pipeline := mongo.Pipeline{\n    {{\"$match\", bson.D{{\"createdata\", 10}}}},\n    {{\"$group\", bson.D{\n        {\"_id\",        bson.D{{\"type\", \"$type\"}}}, \n        {\"TotalFeeds\", bson.D{{\"$sum\", 1}}},\n    }}},\n    {{\"$project\", bson.D{\n        {\"type\", \"$_id.type\"}, \n        {\"TotalFeeds\", \"$TotalFeeds\"}, \n        {\"_id\", 0}},\n    }},          \n}\n</code></pre>\n\n<p>Check your <code>Feeds{}</code> struct mapping. Make sure, either you specify the <code>bson</code> mapping, i.e. : </p>\n\n<pre><code>type Feeds struct {\n    Type string `bson:\"type\"`\n    TotalFeeds int `bson:\"TotalFeeds\"`\n}\n</code></pre>\n\n<p>Or, in your projection stage <code>$project</code> you use consistent casing for the fields. For example, specify all lower case <code>type</code> and <code>totalfeeds</code> or all upper case <code>Type</code> and <code>TotalFeeds</code>. </p>\n\n<pre><code>pipeline := mongo.Pipeline{\n    {{\"$match\", bson.D{{\"createdata\", 10}}}},\n    {{\"$group\", bson.D{\n        {\"_id\",        bson.D{{\"type\", \"$type\"}}}, \n        {\"totalfeeds\", bson.D{{\"$sum\", 1}}},\n    }}},\n    {{\"$project\", bson.D{\n        {\"type\", \"$_id.type\"}, \n        {\"totalfeeds\", \"$totalfeeds\"}, \n        {\"_id\", 0}},\n    }},      \n}\n</code></pre>\n\n<p>Then you don't have to specify the <code>bson</code> mapping in the struct: </p>\n\n<pre><code>type MyStruct struct {\n    Type string \n    Total int\n}\n</code></pre>\n\n<p>So either use consistent field name cases in your struct, or explicitly provide the <code>bson</code> mapping.  </p>\n"}], "owner": {"reputation": 13, "user_id": 11145477, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UeaTnjPHqdc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdyCqz3rQ5_AnFIzI35E55xEzC4fA/mo/photo.jpg?sz=128", "display_name": "Jonh Smith", "link": "https://stackoverflow.com/users/11145477/jonh-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 54997274, "answer_count": 1, "score": 1, "last_activity_date": 1551769963, "creation_date": 1551655484, "last_edit_date": 1551692567, "question_id": 54974821, "link": "https://stackoverflow.com/questions/54974821/aggregate-pipeline-returns-wrong-result-vs-cli", "title": "Aggregate pipeline returns wrong result vs CLI", "body": "<p>I have a collection in mongo on which I run the following query </p>\n\n<pre><code>db.feeds.aggregate({\"$match\":{createdat:\"20190203\"}}, {\"$group\": {_id: {\"type\": \"$type\"}, total: {$sum: 1} }},{\"$project\":   {\"type\": \"$_id.type\", \"tot\": \"$total\", \"_id\": 0} }   )\n</code></pre>\n\n<p>It works as expected and returns, </p>\n\n<pre><code>{ \"type\" : \"f\", \"tot\" : 1 }\n{ \"type\" : \"ebm\", \"tot\" : 1 }\n{ \"type\" : \"b\", \"tot\" : 3 }\n</code></pre>\n\n<p>However, when I try replicating the pipeline in Golang, as follow: </p>\n\n<pre><code>    pipeline := []bson.M{\n    // match\n    {\"$match\": bson.M{\"createdat\": when}},\n    // group\n    {\"$group\": bson.M{\n        \"_id\":        bson.M{\"type\": \"$type\"}, // \"$fieldname\" - return the field\n        \"TotalFeeds\": bson.M{\"$sum\": 1}}},\n    // project\n    {\"$project\": bson.M{\"type\": \"$_id.type\", // project selects subset of fields\n        \"TotalFeeds\": \"$TotalFeeds\", // rename fiedls\n        \"_id\":        0}},           // 0 means not show _id\n}\n</code></pre>\n\n<p>The returned count is 0. </p>\n\n<pre><code>map[$match:map[createdat:20190203]] map[$group:map[TotalFeeds:map[$sum:1] _id:map[type:$type]]] map[$project:map[type:$_id.type TotalFeeds:$TotalFeeds _id:0]]]\n{f 0  }\n{ebm 0  }\n{b 0  }\n[{f 0  } {ebm 0  } {b 0  }]\n</code></pre>\n\n<p>Below the entire function I am using in Golang: </p>\n\n<pre><code>func CountFeeds(when string) Feeds {\n\n    ctx, _ := context.WithTimeout(context.Background(), 60*time.Second)\n\n    pipeline := []bson.M{\n        // match\n        {\"$match\": bson.M{\"createdat\": when}},\n        // group\n        {\"$group\": bson.M{\n            \"_id\":        bson.M{\"type\": \"$type\"}, // \"$fieldname\" - return the field\n            \"TotalFeeds\": bson.M{\"$sum\": 1}}},\n        // project\n        {\"$project\": bson.M{\"type\": \"$_id.type\", // project select subset of fields\n            \"TotalFeeds\": \"$TotalFeeds\", // rename fiedls\n            \"_id\":        0}},           // 0 means not show _id\n    }\n\n\n    fmt.Println(pipeline)\n    curs, err := db.Collection(\"feeds\").Aggregate(ctx, pipeline)\n    utilities.Catch(err)\n\n    defer curs.Close(ctx)\n\n    element := Feeds{}\n    e := []Feeds{}\n    for curs.Next(ctx) {\n        err := curs.Decode(&amp;element)\n        fmt.Println(element)\n        utilities.Catch(err)\n        e = append(e, element)\n    }\n\n    fmt.Println(e)\n    return element\n}\n</code></pre>\n"}, {"tags": ["pointers", "go", "copy", "slice"], "comments": [{"owner": {"reputation": 189, "user_id": 11139683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ad9fdf6151cd46c17790b74f245abef?s=128&d=identicon&r=PG&f=1", "display_name": "mori", "link": "https://stackoverflow.com/users/11139683/mori"}, "reply_to_user": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "edited": false, "score": 0, "creation_date": 1551647982, "post_id": 54973683, "comment_id": 96706792, "body": "Any new values."}, {"owner": {"reputation": 1611, "user_id": 877856, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/ytALd.jpg?s=128&g=1", "display_name": "tj-recess", "link": "https://stackoverflow.com/users/877856/tj-recess"}, "edited": false, "score": 0, "creation_date": 1551665634, "post_id": 54973683, "comment_id": 96710457, "body": "So IIUC, you want a slice of <code>len(s)</code> with pointers in it pointing to nil values? If yes, the only job of <code>copy</code> is to provide the length of <code>s</code>. You&#39;re better off just passing the len explicitly and create a new slice."}], "answers": [{"comments": [{"owner": {"reputation": 189, "user_id": 11139683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ad9fdf6151cd46c17790b74f245abef?s=128&d=identicon&r=PG&f=1", "display_name": "mori", "link": "https://stackoverflow.com/users/11139683/mori"}, "edited": false, "score": 0, "creation_date": 1551647541, "post_id": 54973735, "comment_id": 96706675, "body": "That&#39;s the shortest way if the pointers in the copy shall point to new values?"}, {"owner": {"reputation": 189, "user_id": 11139683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ad9fdf6151cd46c17790b74f245abef?s=128&d=identicon&r=PG&f=1", "display_name": "mori", "link": "https://stackoverflow.com/users/11139683/mori"}, "edited": false, "score": 0, "creation_date": 1551648118, "post_id": 54973735, "comment_id": 96706830, "body": "The pointers in <code>c</code> may point to zero values as well. Sorry that was missing in the original question."}, {"owner": {"reputation": 189, "user_id": 11139683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ad9fdf6151cd46c17790b74f245abef?s=128&d=identicon&r=PG&f=1", "display_name": "mori", "link": "https://stackoverflow.com/users/11139683/mori"}, "edited": false, "score": 0, "creation_date": 1551648866, "post_id": 54973735, "comment_id": 96707037, "body": "Sure. I thought maybe there&#39;s a way without <code>for</code> if all <code>c[i]</code> point to zero values (instead of <code>*s[i]</code>)."}, {"owner": {"reputation": 189, "user_id": 11139683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ad9fdf6151cd46c17790b74f245abef?s=128&d=identicon&r=PG&f=1", "display_name": "mori", "link": "https://stackoverflow.com/users/11139683/mori"}, "edited": false, "score": 0, "creation_date": 1551649644, "post_id": 54973735, "comment_id": 96707230, "body": "No. I need to modify <code>*c[i]</code> without affecting <code>*s[i]</code>. But that&#39;s not the case for builtin <code>copy</code> (see the answer linked in my question)."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1551766343, "last_edit_date": 1551766343, "creation_date": 1551647081, "answer_id": 54973735, "question_id": 54973683, "link": "https://stackoverflow.com/questions/54973683/copy-a-slice-of-pointers-pointing-to-new-values/54973735#54973735", "title": "Copy a slice of pointers (pointing to new values)", "body": "<p>Use the following code to copy the values:</p>\n\n<pre><code>c := make([]*T, len(s))\nfor i, p := range s {\n\n    if p == nil {\n        // Skip to next for nil source pointer\n        continue\n    }\n\n    // Create shallow copy of source element\n    v := *p\n\n    // Assign address of copy to destination.\n    c[i] = &amp;v\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/iGxblBMrgWY\" rel=\"nofollow noreferrer\">Run it in the playground</a>.</p>\n\n<p>This code creates a shallow copy of the value. Depending on application requirements, you may want to deeply copy the value, or if a struct type, one or more fields. The specifics depend on the actual type T and the application requirements.</p>\n"}], "owner": {"reputation": 189, "user_id": 11139683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ad9fdf6151cd46c17790b74f245abef?s=128&d=identicon&r=PG&f=1", "display_name": "mori", "link": "https://stackoverflow.com/users/11139683/mori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 539, "favorite_count": 0, "accepted_answer_id": 54973735, "answer_count": 1, "score": 2, "last_activity_date": 1551766343, "creation_date": 1551646716, "last_edit_date": 1551647766, "question_id": 54973683, "link": "https://stackoverflow.com/questions/54973683/copy-a-slice-of-pointers-pointing-to-new-values", "title": "Copy a slice of pointers (pointing to new values)", "body": "<p>I would like to make a copy of a slice containing pointers, such that the pointers in the new slice point to new values: Let's say <code>s</code> is the original slice and <code>c</code> is the copy. Then changing <code>*c[i]</code> should <em>not</em> affect <code>*s[i]</code>.</p>\n\n<p>According to <a href=\"https://stackoverflow.com/a/27056295/11139683\">this answer</a>, that's not what happens with the usual copy methods.</p>\n\n<p>What's the shortest way to do this?</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1551643439, "post_id": 54972955, "comment_id": 96705535, "body": "You call <code>free</code> if you call a C <code>alloc</code> function. You didn\u2019t <code>malloc</code> anything, therefor you don\u2019t call <code>free</code>"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 6889193, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CfynAB_ORek/AAAAAAAAAAI/AAAAAAAAADI/qNDzc3lQfB0/photo.jpg?sz=128", "display_name": "Grellyd", "link": "https://stackoverflow.com/users/6889193/grellyd"}, "edited": false, "score": 0, "creation_date": 1551742425, "post_id": 54973859, "comment_id": 96743605, "body": "Thanks, that clarifies it for me!"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1551655104, "last_edit_date": 1551655104, "creation_date": 1551648068, "answer_id": 54973859, "question_id": 54972955, "link": "https://stackoverflow.com/questions/54972955/freeing-go-structs-of-c-objects/54973859#54973859", "title": "Freeing Go Structs of C Objects", "body": "<p>It's not that complicated.</p>\n\n<p><code>cgo</code> generates a Go type <code>C.uchar</code> whose memory layout exactly matches <code>C</code> type <code>unsigned char</code>.</p>\n\n<p>The Go expression <code>make([]C.uchar, 40)</code>, as usual, allocates a Go slice with an underlying array of Go type <code>C.uchar</code>.</p>\n\n<p>Go has a garbage collector (GC). When there are no longer any Go references to the slice and its underlying array, it's eligible for Go garbage collection. </p>\n\n<p>The Go GC does not know or care about any C code.</p>\n\n<hr>\n\n<p>See <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">Go: Command cgo</a>.</p>\n"}], "owner": {"reputation": 23, "user_id": 6889193, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CfynAB_ORek/AAAAAAAAAAI/AAAAAAAAADI/qNDzc3lQfB0/photo.jpg?sz=128", "display_name": "Grellyd", "link": "https://stackoverflow.com/users/6889193/grellyd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1551655104, "creation_date": 1551642256, "question_id": 54972955, "link": "https://stackoverflow.com/questions/54972955/freeing-go-structs-of-c-objects", "title": "Freeing Go Structs of C Objects", "body": "<p>When allocating individual objects via the <code>C.malloc</code> based calls, we must free the new items as the Go garbage collector is unaware of them.</p>\n\n<p>EG:</p>\n\n<pre><code>s := C.CString(l)\ndefer C.free(unsafe.Pointer(s))\n</code></pre>\n\n<p>However when we create a slice of C objects, do we need to free them?</p>\n\n<p>EG:</p>\n\n<p><code>b := make([]C.uchar, C.int(40))</code></p>\n\n<p>I was trying to use something like <code>defer C.free(unsafe.Pointer(&amp;b[0]))</code> however that produces <code>free(): invalid pointer</code> and an abort signal.</p>\n\n<p>I see three possible answers:</p>\n\n<ol>\n<li>The Go garbage collector is aware of objects created via the <code>make</code> call, and so <code>b</code> will be garbage collected by the Go runtime.</li>\n<li>The Go garbage collector is aware of the slice, created via the <code>make</code> call, but not the <code>C.uchar</code>s contained within the slice. Therefore we need to walk through the the slice, and free each item</li>\n<li>I am calling the freeing of the slice <code>b</code> incorrectly.</li>\n</ol>\n\n<p>Which, if any, of my conclusions is correct? Otherwise what is actually happening?</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 21605, "user_id": 1142167, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/f9MAS.jpg?s=128&g=1", "display_name": "Joel Cornett", "link": "https://stackoverflow.com/users/1142167/joel-cornett"}, "edited": false, "score": 0, "creation_date": 1551635637, "post_id": 54971867, "comment_id": 96703038, "body": "Record also has a field name mismatch, so you\u2019ll also need to add struct tags to those fields in order to fix the problem."}], "tags": [], "owner": {"reputation": 1031, "user_id": 10521506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VFzDXDbprEk/AAAAAAAAAAI/AAAAAAAAG44/FgWgkq5p6O8/photo.jpg?sz=128", "display_name": "Reza Nasiri", "link": "https://stackoverflow.com/users/10521506/reza-nasiri"}, "is_accepted": true, "score": -2, "last_activity_date": 1551647646, "last_edit_date": 1551647646, "creation_date": 1551635426, "answer_id": 54971867, "question_id": 54971678, "link": "https://stackoverflow.com/questions/54971678/parsing-a-nested-json-file/54971867#54971867", "title": "Parsing a nested json file", "body": "<p>You can use this struct for your id type</p>\n\n<pre><code>type id struct {\n    record map[string]record\n}\n</code></pre>\n\n<p><strong>Edit</strong></p>\n\n<p>here is the working solution with some explanation:</p>\n\n<p>since you have a multi level json, you can parse it into nested structs.</p>\n\n<pre><code>{\n        \"student_name\": \"Daryl Jones\",\n        \"student_number\": 123884,\n        \"student_dob\": \"12/10/1982\",\n        \"student_email\": \"djones@school.ac.uk\"\n} \n</code></pre>\n\n<p>to parse this part of the json you need this struct</p>\n\n<pre><code>type record struct {\n    Name   string `json:\"student_name\"`\n    Number uint32 `json:\"student_number\"`\n    Dob    string `json:\"student_dob\"`\n    Email  string `json:\"student_email\"`\n}\n</code></pre>\n\n<p>the fields have to be exported(start with capital letter) and have a json tag that matches json properties.</p>\n\n<pre><code>{\n    \"record\": \n    {\n        \"student_name\": \"Daryl Jones\",\n        \"student_number\": 123884,\n        \"student_dob\": \"12/10/1982\",\n        \"student_email\": \"djones@school.ac.uk\"\n    }    \n}\n</code></pre>\n\n<p>for this part to work, you need a nested struct like this</p>\n\n<pre><code>type id struct {\n     Record record\n}\n</code></pre>\n\n<p>the filed name is exported again but since it matches your json property, you don't need the tag. </p>\n\n<pre><code>{\n\"394885\": \n  {\n    \"record\": \n    {\n        \"student_name\": \"Daryl Jones\",\n        \"student_number\": 123884,\n        \"student_dob\": \"12/10/1982\",\n        \"student_email\": \"djones@school.ac.uk\"\n    }    \n  }\n}\n</code></pre>\n\n<p>since the top level property name is the student id, you can use a map instead of a struct</p>\n\n<pre><code> var records map[string]id \n</code></pre>\n\n<p>and make sure you don't have trailing commas as that is not allowed in json specs</p>\n"}, {"tags": [], "owner": {"reputation": 3386, "user_id": 4158603, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/6A1qm.png?s=128&g=1", "display_name": "areller", "link": "https://stackoverflow.com/users/4158603/areller"}, "is_accepted": false, "score": 1, "last_activity_date": 1551639023, "creation_date": 1551639023, "answer_id": 54972455, "question_id": 54971678, "link": "https://stackoverflow.com/questions/54971678/parsing-a-nested-json-file/54972455#54972455", "title": "Parsing a nested json file", "body": "<p>First, your JSON is invalid.\nUnlike GoLang structs, you don't need to put <code>,</code> after your final object.</p>\n\n<p>{\n    \"394885\": \n    {\n        \"record\": \n        {\n            \"student_name\": \"Daryl Jones\",\n            \"student_number\": 123884,\n            \"student_dob\": \"12/10/1982\",\n            \"student_email\": \"djones@school.ac.uk\"\n        }<br>\n    }\n}</p>\n\n<p>Second, \n<code>var records</code> supposed to model your JSON exactly, either by naming the fields in your struct exactly as they are named in the JSON object, or by using attributes.</p>\n\n<p>The exterior of your JSON is not of type <code>id</code>, it is of type <code>map[string]id</code></p>\n\n<p><code>id</code> doesn't have a <code>recordid</code> field, it does however, has a <code>record</code> field, but, the field of your structs must be exported (start with capital case) if you want to serialise JSON into them.</p>\n\n<p>This is where attributes come in handy,</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type id struct {\n    Record []record `json:\"record\"`\n}\n</code></pre>\n\n<p>Same with the <code>record</code> struct,</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type record struct {\n    Name string `json:\"student_name\"`\n    Email string `json:\"student_email\"`\n    // You get the idea...\n}\n</code></pre>\n\n<p>Third,\nYou put the <code>defer</code> statement right after you open the file,\nputting it at the end of the block defeats the purpose.</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1551644182, "last_edit_date": 1551644182, "creation_date": 1551642764, "answer_id": 54973044, "question_id": 54971678, "link": "https://stackoverflow.com/questions/54971678/parsing-a-nested-json-file/54973044#54973044", "title": "Parsing a nested json file", "body": "<p>Declare Go types that match the structure of the data. The JSON data has three levels of objects.  Use a map to represent the top-level object in the JSON because the top-level object has arbitrary keys.  Use structs for the lower-level objects in the JSON.</p>\n\n<p>Use JSON field tags to map the snake case names used in the JSON to more idiomatic Go names.\n<a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">Export</a> the fields so they can be accessed by the JSON package.</p>\n\n<p>See the <a href=\"https://godoc.org/encoding/json#Marshal\" rel=\"nofollow noreferrer\">Marshal</a> function documentation for info on how the json/encoding package uses field tags and the requirement to export the fields.</p>\n\n<pre><code>type Record struct {\n    Name   string `json:\"student_name\"`\n    Number uint32 `json:\"student_number\"`\n    DOB    string `json:\"student_dob\"`\n    Email  string `json:\"student_email\"`\n}\n\ntype ID struct {\n    Record Record\n}\n\n...\n\nvar records map[string]ID\nerr := json.Unmarshal(jsonFile, &amp;records)\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Printf(\"%#v\\n\", records)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/whObcs84QK8\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1143, "user_id": 370213, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/PH4vL.jpg?s=128&g=1", "display_name": "zhengchun", "link": "https://stackoverflow.com/users/370213/zhengchun"}, "is_accepted": false, "score": 0, "last_activity_date": 1551765373, "creation_date": 1551765373, "answer_id": 54996284, "question_id": 54971678, "link": "https://stackoverflow.com/questions/54971678/parsing-a-nested-json-file/54996284#54996284", "title": "Parsing a nested json file", "body": "<p><a href=\"https://github.com/antchfx/jsonquery\" rel=\"nofollow noreferrer\">jsonquery</a> package can easy extract data from JSON document, and it does't dependent on defined struct object.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    s := `{\n        \"394885\": \n        {\n            \"record\": \n            {\n                \"student_name\": \"Daryl Jones\",\n                \"student_number\": 123884,\n                \"student_dob\": \"12/10/1982\",\n                \"student_email\": \"djones@school.ac.uk\"\n            }    \n        }\n    }`\n    doc, err := jsonquery.Parse(strings.NewReader(s))\n    if err != nil {\n        panic(err)\n    }\n    nodes := jsonquery.Find(doc, \"*\")\n    for _, n := range nodes {\n        fmt.Printf(\"id: %s \\n\", n.Data)\n        name := jsonquery.FindOne(n, \"//student_name\") // Find student name node\n        fmt.Printf(\"student name: %s\\n\", name.InnerText())\n        number := jsonquery.FindOne(n, \"//student_number\") // Find node for student number\n        fmt.Printf(\"student number: %s\\n\", number.InnerText())\n    }\n}\n\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user628985"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 0, "accepted_answer_id": 54971867, "answer_count": 4, "score": 1, "last_activity_date": 1551765373, "creation_date": 1551634164, "last_edit_date": 1551634774, "question_id": 54971678, "link": "https://stackoverflow.com/questions/54971678/parsing-a-nested-json-file", "title": "Parsing a nested json file", "body": "<p>I'm parsing a JSON file with an unusual structure which looks like this:</p>\n\n<pre><code>{\n    \"394885\": \n    {\n        \"record\": \n        {\n            \"student_name\": \"Daryl Jones\",\n            \"student_number\": 123884,\n            \"student_dob\": \"12/10/1982\",\n            \"student_email\": \"djones@school.ac.uk\",\n        }    \n    },\n}\n</code></pre>\n\n<p>I've been working through some code demos, but I would like to put it all in to a struct, which I then plan to search through by the number string that's the object name I would guess?</p>\n\n<p>I'm not strong on JSON or Go, and this is the code I've written so far:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n)\n\ntype id struct {\n    recordid string\n    record   []record\n}\n\ntype record struct {\n    name   string\n    number uint32\n    dob    string\n    email  string\n}\n\nfunc main() {\n    jsonFile, err := os.Open(\"/home/emyrw/development/go/src/json_processor/demo.json\")\n    if err != nil {\n        fmt.Println(err)\n    } else {\n        var records id\n\n        byteValue, _ := ioutil.ReadAll(jsonFile)\n        json.Unmarshal(byteValue, &amp;records)\n        fmt.Println(records)\n\n        fmt.Println(\"opened demo.json\")\n        defer jsonFile.Close()\n    }\n}\n</code></pre>\n\n<p>I'm not sure I've got it right, but would value any tips or advice anyone has to offer.  I've been googling, but none of the samples I find quite fit my scenario.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1, "user_id": 11144161, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PJ7Uxq-jXQg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfM2fUxvA1aAmDDTbR57nSDM4v29g/mo/photo.jpg?sz=128", "display_name": "T T", "link": "https://stackoverflow.com/users/11144161/t-t"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551629808, "post_id": 54970807, "comment_id": 96701105, "body": "like that it ends up writing the memory address of the variable, not the input"}, {"owner": {"reputation": 1, "user_id": 11144161, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PJ7Uxq-jXQg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfM2fUxvA1aAmDDTbR57nSDM4v29g/mo/photo.jpg?sz=128", "display_name": "T T", "link": "https://stackoverflow.com/users/11144161/t-t"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551630430, "post_id": 54970807, "comment_id": 96701279, "body": "<code>code</code>package main  import ( \t&quot;fmt&quot; )  func askstuff() { \tfmt.Println(&quot;Input to exit digit X:&quot;) \tvar input string \tfmt.Scanln(&amp;input) \tfmt.Println(input) \treturn }  func main() { \taskstuff() \tprintln(askstuff) }"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1551632043, "creation_date": 1551632043, "answer_id": 54971288, "question_id": 54970807, "link": "https://stackoverflow.com/questions/54970807/scanfl-declarative-variable-out-of-function/54971288#54971288", "title": "scanfl declarative variable out of function", "body": "<p>Return the string from <code>askstuff</code> and use as needed in the caller:</p>\n\n<pre><code>func askstuff() string {\n    fmt.Println(\"Input to exit digit X:\")\n    var input string\n    fmt.Scanln(&amp;input)\n    return input\n}\n\nfunc main() {\n    x := askstuff()\n    fmt.Println(x)\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11144161, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PJ7Uxq-jXQg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfM2fUxvA1aAmDDTbR57nSDM4v29g/mo/photo.jpg?sz=128", "display_name": "T T", "link": "https://stackoverflow.com/users/11144161/t-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 24, "favorite_count": 0, "accepted_answer_id": 54971288, "answer_count": 1, "score": -1, "last_activity_date": 1551632043, "creation_date": 1551629171, "last_edit_date": 1551630529, "question_id": 54970807, "link": "https://stackoverflow.com/questions/54970807/scanfl-declarative-variable-out-of-function", "title": "scanfl declarative variable out of function", "body": "<p>I need an help to get out of a corner, because I don't understand the logic behind a problem I am having.</p>\n\n<p>I need to ask multiple times a user input, so logically I am creating a function like:</p>\n\n<pre><code>func askstuff() {\n    fmt.Println(\"Write something:\")\n    var input string\n    fmt.Scanln(&amp;input)\n}\n</code></pre>\n\n<p>now I need to get the user input into a variable from the main() function, but I have a non-declarative matter and a brain issue....in fact I was expecting to do something like, but it is wrong</p>\n\n<pre><code>func main() {\n    askstuff()\n    println askstuff(input)\n}\n</code></pre>\n\n<p>I have been reading all posts and docs and I understood that instead of a function, I should use a declarative variable out of main(), in the body, before main(). It works like a charm only if there is an hard coded fixed value but it doesn't with Scanln interactive console input.</p>\n\n<p>I need to execute so many time askstuff(), that it will drive me nut without a separate class/function, but I also need to close the input into a variable within main() function, out of askstuff() function, to be able to work on it.</p>\n\n<p>I am 100% ok with an RTFM reply if you give me one example that doesn't use a fixed hard coded value but use a user console interaction by scanln.</p>\n\n<p>All book examples never use a scanln input, always a fixed declarative variable out of main () in the body. </p>\n\n<p>Am I running in a specific scanln limitation? is a design concept matter with my logic? or there are better ways?</p>\n\n<p>Please don't just give me just the snippet on how to fix the matter, explain me where and why my logic is wrong, so to understand it and don't repeat the error in the future.</p>\n"}, {"tags": ["go", "grpc", "google-cloud-bigtable"], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 3477206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d434863359909b34ef9e202eb318395f?s=128&d=identicon&r=PG&f=1", "display_name": "lyuxuan", "link": "https://stackoverflow.com/users/3477206/lyuxuan"}, "is_accepted": false, "score": 2, "last_activity_date": 1552511022, "creation_date": 1552511022, "answer_id": 55151160, "question_id": 54970446, "link": "https://stackoverflow.com/questions/54970446/how-to-handle-hourly-bigtable-connection-closes/55151160#55151160", "title": "How to handle hourly Bigtable connection closes?", "body": "<p>I suspect that this may be due to a <a href=\"https://github.com/grpc/grpc-go/issues/2663\" rel=\"nofollow noreferrer\">bug</a> that gets introduced in a recent grpc-go release, and just got <a href=\"https://github.com/grpc/grpc-go/pull/2669\" rel=\"nofollow noreferrer\">fixed</a>. Basically, instead of reconnecting immediately when a connection goes away, we incorrectly wait 1s before reconnecting. Please try again with grpc-go master head. Thanks!</p>\n"}, {"tags": [], "owner": {"reputation": 81, "user_id": 11132454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb68eeddcf6e094619962f570183a2d6?s=128&d=identicon&r=PG&f=1", "display_name": "Verma", "link": "https://stackoverflow.com/users/11132454/verma"}, "is_accepted": true, "score": 3, "last_activity_date": 1552919456, "creation_date": 1552919456, "answer_id": 55223714, "question_id": 54970446, "link": "https://stackoverflow.com/questions/54970446/how-to-handle-hourly-bigtable-connection-closes/55223714#55223714", "title": "How to handle hourly Bigtable connection closes?", "body": "<p>Cloud bigtable clients use a pool of gRPC connections to connect to bigtable. Java client uses a channel pool per HBase connection, each channel pool has multiple gRPC connections. gRPC connections are shut down every hour (or after 15 minute of inactivity) and the underlying gRPC infrastructure performs a reconnect. The first request on each new connection performs a number of setup tasks such as TLS handshakes and warming server side caches. These operations are fairly expensive and may cause the latency spikes.</p>\n\n<p>Bigtable is designed to be a high throughput system and the amortized cost of these reconnections with sustained query volume should be negligible. However, if the client application has very low QPS or long periods of idle time between queries and can not tolerate these latency spikes, it can create a new Hbase connection(java) or a new CBT client(golang) every 30-40 minutes and run no op calls (exist on hbase client or read a small row)  on the new connection/client to prime the underlying gRPC connections (one call per connection, for hbase default is twice the number of CPUs, go has 4 connections by default). Once primed you can swap out the new connection/client for the main operations in the client application. <a href=\"https://github.com/GoogleCloudPlatform/cloud-bigtable-examples/tree/master/go/connection-refresh\" rel=\"nofollow noreferrer\">Here</a> is sample go code for this workaround.</p>\n"}], "owner": {"reputation": 85, "user_id": 2852302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e11cb91569a707534154c0e59a42aa69?s=128&d=identicon&r=PG&f=1", "display_name": "bedervet", "link": "https://stackoverflow.com/users/2852302/bedervet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 661, "favorite_count": 0, "accepted_answer_id": 55223714, "answer_count": 2, "score": 5, "last_activity_date": 1552919456, "creation_date": 1551627114, "last_edit_date": 1551628124, "question_id": 54970446, "link": "https://stackoverflow.com/questions/54970446/how-to-handle-hourly-bigtable-connection-closes", "title": "How to handle hourly Bigtable connection closes?", "body": "<p>I have golang services with persistant Bigtable client.\nThe services are making hundred of read/write operation on Bigtable per sec.</p>\n\n<p>Every hours from the service boot, I experience hundred of errors like this one:</p>\n\n<pre><code>Retryable error: rpc error: code = Unavailable desc =\n the connection is draining, retrying in 74.49241ms\n</code></pre>\n\n<p>The error are followed by an increased processing time I can't allow when thoses errors occur.</p>\n\n<p>I was able to figure out that Bigtable client is using a pool of gRPC connections.</p>\n\n<p>It seems that Bigtable gRPC server have a connection maxAge of 1 hour which can explain the error above and the processing time increasing during reconnection.</p>\n\n<p>A maxAgeGrace configuration is supposed to give additional time to complete current operations and avoid all pool connections to terminate at the same time.</p>\n\n<p>I increased connection pool size from default 4 to 12 with no real benefit</p>\n\n<p>How do I prevent processing time to increase during reconnections and these error to happen, given my traffic will keep growing?</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 221394, "user_id": 366904, "user_type": "moderator", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/3f8912af19fe86b7b34a0b011a962460?s=128&d=identicon&r=PG", "display_name": "Cody Gray", "link": "https://stackoverflow.com/users/366904/cody-gray"}, "edited": false, "score": 2, "creation_date": 1552001280, "post_id": 54969813, "comment_id": 96858364, "body": "Please stop rolling back (rejecting) valid edits. The user who suggested these edits has already explained clearly that the [<a href=\"https://stackoverflow.com/questions/tagged/gorm\">gorm</a>] tag is used for the Rails library, and that is also quite obvious from reading the tag description. The [<a href=\"https://stackoverflow.com/questions/tagged/go-gorm\">go-gorm</a>] tag is the one you want, and that&#39;s exactly the one which was added to this question in the edits. Getting into an edit war serves no one. If you have a problem, either take it to Meta or flag for moderator attention."}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 204, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1552001195, "creation_date": 1551623049, "last_edit_date": 1552001195, "question_id": 54969813, "link": "https://stackoverflow.com/questions/54969813/how-to-make-many-to-many-relationship-in-golang-application-with-gorm-library", "title": "How to make many to many relationship in Golang application with GORM library?", "body": "<p>I use <a href=\"http://gorm.io/\" rel=\"nofollow noreferrer\">GORM</a> library in my <strong>Golang</strong> project and I need help. </p>\n\n<p>In my <strong>PostgreSQL</strong> database I have 4 table. They called: <code>surveys</code>, <code>questions</code>, <code>options</code> and <code>surveys_questions_options</code>. Thats how they looks like:</p>\n\n<p><strong>SURVEYS</strong> table:</p>\n\n<pre><code>| survey_id (uuid4)                    | survey_name (varchar) |\n|--------------------------------------|-----------------------|\n| 0cf1cf18-d5fd-474e-a8be-754fbdc89720 | April                 |\n| b9fg55d9-n5fy-s7fe-s5bh-856fbdc89720 | May                   |\n</code></pre>\n\n<p><strong>QUESTIONS</strong> table:</p>\n\n<pre><code>| question_id (int) | question_text (text)         |\n|-------------------|------------------------------|\n| 1                 | What is your favorite color? |\n</code></pre>\n\n<p><strong>OPTIONS</strong> table:</p>\n\n<pre><code>| option_id (int)   | option_text (text) |\n|-------------------|--------------------|\n| 1                 | red                |\n| 2                 | blue               |\n| 3                 | grey               |\n| 4                 | green              |\n| 5                 | brown              |\n</code></pre>\n\n<p><strong>SURVEYS_QUESTIONS_OPTIONS</strong> table combines all three previous tables:</p>\n\n<pre><code>| survey_id                            | question_id | option_id |\n|--------------------------------------|-------------|-----------|\n| 0cf1cf18-d5fd-474e-a8be-754fbdc89720 | 1           | 1         |\n| 0cf1cf18-d5fd-474e-a8be-754fbdc89720 | 1           | 2         |\n| 0cf1cf18-d5fd-474e-a8be-754fbdc89720 | 1           | 3         |\n| b9fg55d9-n5fy-s7fe-s5bh-856fbdc89720 | 1           | 3         |\n| b9fg55d9-n5fy-s7fe-s5bh-856fbdc89720 | 1           | 4         |\n| b9fg55d9-n5fy-s7fe-s5bh-856fbdc89720 | 1           | 5         |\n</code></pre>\n\n<p>I create struct to first 3 table and CRUD for each of table. Unfortunatly I don't know how correctly initialize many to many relationship in Golang application which you can notice in last <code>SURVEYS_QUESTIONS_OPTIONS</code> table. In fact I need to take tree JSON structure in response of REST service like:</p>\n\n<pre><code>[\n    {\n        \"survey_id\": \"0cf1cf18-d5fd-474e-a8be-754fbdc89720\",\n        \"survey_name\": \"April\",\n        \"questions\": [\n            {\n                \"question_id\": 1,\n                \"question_text\": \"What is your favorite color?\",\n                \"options\": [\n                    {\n                        \"option_id\": 1,\n                        \"option_text\": \"red\"\n                    },\n                    {\n                        \"option_id\": 2,\n                        \"option_text\": \"blue\"\n                    },\n                    {\n                        \"option_id\": 3,\n                        \"option_text\": \"grey\"\n                    },\n                ]\n            }\n        ]\n    },\n    {\n        \"survey_id\": \"b9fg55d9-n5fy-s7fe-s5bh-856fbdc89720\",\n        \"survey_name\": \"May\",\n        \"questions\": [\n            {\n                \"question_id\": 1,\n                \"question_text\": \"What is your favorite color?\",\n                \"options\": [\n                    {\n                        \"option_id\": 3,\n                        \"option_text\": \"grey\"\n                    },\n                    {\n                        \"option_id\": 4,\n                        \"option_text\": \"green\"\n                    },\n                    {\n                        \"option_id\": 5,\n                        \"option_text\": \"brown\"\n                    },\n                ]\n            }\n        ]\n    }\n]\n</code></pre>\n\n<p>Can someone show me how to make it by little example?</p>\n"}, {"tags": ["go", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1551630917, "post_id": 54966482, "comment_id": 96701430, "body": "Before you start reinventing the wheel, have you came across <a href=\"https://github.com/dominikh/go-tools/tree/master/staticcheck\" rel=\"nofollow noreferrer\">this</a>?"}, {"owner": {"reputation": 15, "user_id": 8865572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/053f731dfe592ac27b3124ddaaee3c12?s=128&d=identicon&r=PG&f=1", "display_name": "lwp007", "link": "https://stackoverflow.com/users/8865572/lwp007"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1551777077, "post_id": 54966482, "comment_id": 96753937, "body": "I want to customize my specific rules, but maybe I can use its skeleton. Thanks."}], "owner": {"reputation": 15, "user_id": 8865572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/053f731dfe592ac27b3124ddaaee3c12?s=128&d=identicon&r=PG&f=1", "display_name": "lwp007", "link": "https://stackoverflow.com/users/8865572/lwp007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1551597422, "creation_date": 1551597422, "question_id": 54966482, "link": "https://stackoverflow.com/questions/54966482/inspect-last-sibling-statement-in-go-ast", "title": "Inspect last sibling statement in Go AST?", "body": "<p>I am writing a static code analyzer in Go. And I have a logic rule that needs to check if resources are released before return, this rule need to audit last statement before return. I notice that the AST walks in depth first, can someone give a hint about my rule? Thanks a lot!</p>\n"}, {"tags": ["go", "raspberry-pi", "permission-denied"], "comments": [{"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1551595345, "post_id": 54966224, "comment_id": 96692869, "body": "0755 works for me on Debian"}, {"owner": {"reputation": 27, "user_id": 10659686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/add6e5ab370d32d627f3facd7cb3f003?s=128&d=identicon&r=PG&f=1", "display_name": "gbdavidx", "link": "https://stackoverflow.com/users/10659686/gbdavidx"}, "reply_to_user": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1551597344, "post_id": 54966224, "comment_id": 96693226, "body": "care to elaborate?"}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1551597672, "post_id": 54966224, "comment_id": 96693293, "body": "I am using webmin to admin the server. Just select the go executeable and set the permissions to 0755. And the executable will start. I guess this will apply on Raspian as well."}, {"owner": {"reputation": 27, "user_id": 10659686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/add6e5ab370d32d627f3facd7cb3f003?s=128&d=identicon&r=PG&f=1", "display_name": "gbdavidx", "link": "https://stackoverflow.com/users/10659686/gbdavidx"}, "reply_to_user": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1551598257, "post_id": 54966224, "comment_id": 96693382, "body": "how do i get rid of this? lrwxrwxrwx 1 david root    11 Mar  2 21:31 go -&gt; /usr/lib/go  i assume that is screwing up everything"}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 1, "creation_date": 1551600247, "post_id": 54966224, "comment_id": 96693767, "body": "Find the go executable and set chmod? <a href=\"https://www.pluralsight.com/blog/it-ops/linux-file-permissions\" rel=\"nofollow noreferrer\">pluralsight.com/blog/it-ops/linux-file-permissions</a>"}, {"owner": {"reputation": 1956, "user_id": 2147023, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aYgE3.jpg?s=128&g=1", "display_name": "theBuzzyCoder", "link": "https://stackoverflow.com/users/2147023/thebuzzycoder"}, "edited": false, "score": 0, "creation_date": 1551632500, "post_id": 54966224, "comment_id": 96701958, "body": "lrwxrwxrwx means it is a symbolic link. you can just run <code>unlink go</code> to get rid of it."}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 10659686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/add6e5ab370d32d627f3facd7cb3f003?s=128&d=identicon&r=PG&f=1", "display_name": "gbdavidx", "link": "https://stackoverflow.com/users/10659686/gbdavidx"}, "edited": false, "score": 0, "creation_date": 1551641956, "post_id": 54971322, "comment_id": 96705076, "body": "when i do sudo apt-get install golang, i get: golang is already the newest version (2:1.7~5)."}], "tags": [], "owner": {"reputation": 1956, "user_id": 2147023, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aYgE3.jpg?s=128&g=1", "display_name": "theBuzzyCoder", "link": "https://stackoverflow.com/users/2147023/thebuzzycoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1551632256, "creation_date": 1551632256, "answer_id": 54971322, "question_id": 54966224, "link": "https://stackoverflow.com/questions/54966224/cant-run-go-permission-denied/54971322#54971322", "title": "Can&#39;t run go permission denied?", "body": "<p>I am assuming that the user you're logged in as doesn't have permissions to run go.</p>\n\n<p>To find that out, run the following</p>\n\n<pre><code>$ which go\n/usr/local/go/bin/go\n\n$ ls -l $(which go)\n-rwxr-xr-x  1 root  wheel  12896684 Jan 24 01:28 /usr/local/go/bin/go\n</code></pre>\n\n<p>From the above we know that the owner is <code>root</code> and group owner is <code>wheel</code>.</p>\n\n<p>Now run <code>echo $USER</code> to see if who is logged in user.</p>\n\n<p>Since you're getting permission denied to run go as <code>$USER</code>, you may want to add the user into the group mentioned in <code>ls -l</code>. So, run the below. </p>\n\n<pre><code>$ usermod -aG $USER wheel\n</code></pre>\n\n<p>And reboot the system! Then try <code>go env</code> again to see if it works.</p>\n\n<p>-a is for append\n-G is for which groups to append</p>\n\n<p><a href=\"http://man7.org/linux/man-pages/man8/usermod.8.html\" rel=\"nofollow noreferrer\">usermod docs</a></p>\n\n<p>Remember wheel is the group owner that I got while running <code>ls -l</code>. Yours might be different.\nThis usermod command is for ubuntu. In your case, it is raspberry pi so raspbian OS. Find out the correct options as it changes from OS to OS.</p>\n"}], "owner": {"reputation": 27, "user_id": 10659686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/add6e5ab370d32d627f3facd7cb3f003?s=128&d=identicon&r=PG&f=1", "display_name": "gbdavidx", "link": "https://stackoverflow.com/users/10659686/gbdavidx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 8768, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1616178198, "creation_date": 1551594935, "last_edit_date": 1551631597, "question_id": 54966224, "link": "https://stackoverflow.com/questions/54966224/cant-run-go-permission-denied", "title": "Can&#39;t run go permission denied?", "body": "<pre><code>david@raspberrypi:~ $ go env\n\n-bash: /usr/bin/go: Permission denied\n</code></pre>\n\n<p>this is my bash.rc</p>\n\n<pre><code>export GOPATH=$HOME/go\n\n$HOME/.bashrc \n\nexport PATH=$PATH:$GOROOT/bin:$GOPATH/bin\n</code></pre>\n\n<p>if i run ls-lah in my david@raspberry pi, i get the following:</p>\n\n<pre><code>david@raspberrypi:~ $ ls -lah \ntotal 28K \ndrwxr-xr-x 3 david david 4.0K Mar  2 22:20 . \ndrwxr-xr-x 4 root  root  4.0K Mar  2 20:03 ..\n-rw------- 1 david david 3.1K Mar  2 21:48 .bash_history\n-rw-r--r-- 1 david david  220 Mar  2 20:03 .bash_logout\n-rw-r--r-- 1 david david 3.6K Mar  2 22:15 .bashrc \nlrwxrwxrwx 1 david root    11 Mar  2 21:31 go -&gt; /usr/lib/go \ndrwxr-xr-x 2 david david 4.0K Mar  2 20:25 .nano\n-rw-r--r-- 1 david david  675 Mar  2 20:03 .profile\n</code></pre>\n"}, {"tags": ["qt", "go"], "comments": [{"owner": {"reputation": 5378, "user_id": 2110683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33179a1918a5d90f47cde062fab10ff4?s=128&d=identicon&r=PG", "display_name": "Dimitry Ernot", "link": "https://stackoverflow.com/users/2110683/dimitry-ernot"}, "edited": false, "score": 1, "creation_date": 1551694603, "post_id": 54966064, "comment_id": 96720082, "body": "Perhaps, you widget doesn&#39;t see that this region needs to be updated.Try to call <code>update()</code> (without parameters) to force your whole widget to be repainted."}, {"owner": {"reputation": 43, "user_id": 9572800, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eLe5u.png?s=128&g=1", "display_name": "akiyosi", "link": "https://stackoverflow.com/users/9572800/akiyosi"}, "reply_to_user": {"reputation": 5378, "user_id": 2110683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33179a1918a5d90f47cde062fab10ff4?s=128&d=identicon&r=PG", "display_name": "Dimitry Ernot", "link": "https://stackoverflow.com/users/2110683/dimitry-ernot"}, "edited": false, "score": 0, "creation_date": 1551768603, "post_id": 54966064, "comment_id": 96749966, "body": "Even after <code>update()</code> debris will continue to remain. Also, I confirmed that this problem occurs only in MacOS. In WIndows problem does not occur."}], "answers": [{"tags": [], "owner": {"reputation": 43, "user_id": 9572800, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eLe5u.png?s=128&g=1", "display_name": "akiyosi", "link": "https://stackoverflow.com/users/9572800/akiyosi"}, "is_accepted": true, "score": 0, "last_activity_date": 1552479689, "creation_date": 1552479689, "answer_id": 55141794, "question_id": 54966064, "link": "https://stackoverflow.com/questions/54966064/text-debris-in-qt-frameless-transparent-window/55141794#55141794", "title": "Text debris in Qt frameless transparent window", "body": "<p>I solved this problem.</p>\n\n<p>This problem is caused by the shadow of the window in MacOS.\nI was able to work around this issue by setting <code>Qt::NoDropShadowWindowHint</code> to the window.</p>\n\n<p>Perhaps this problem is a bug of MacOS/Qt.</p>\n"}], "owner": {"reputation": 43, "user_id": 9572800, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eLe5u.png?s=128&g=1", "display_name": "akiyosi", "link": "https://stackoverflow.com/users/9572800/akiyosi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 55141794, "answer_count": 1, "score": 0, "last_activity_date": 1552479689, "creation_date": 1551593254, "question_id": 54966064, "link": "https://stackoverflow.com/questions/54966064/text-debris-in-qt-frameless-transparent-window", "title": "Text debris in Qt frameless transparent window", "body": "<p>I'm trying to create a frameless transparent window with Qt and its go-bind(<a href=\"https://github.com/therecipe/qt\" rel=\"nofollow noreferrer\">https://github.com/therecipe/qt</a>).</p>\n\n<p>The problem I have faced is that the debris of the text remains in the frameless transparent window. Please look at Gif(<a href=\"https://i.imgur.com/47OC7ps.gif\" rel=\"nofollow noreferrer\">https://i.imgur.com/47OC7ps.gif</a>).</p>\n\n<p>The characteristics of the problem I confirmed are the following.</p>\n\n<ul>\n<li>Problems only occur in resized windows. (But not 100%)</li>\n<li>Only the text initially\ndisplayed in the window will remain as debris.</li>\n</ul>\n\n<p>This problem can be avoided by explicitly calling <code>Hide()</code>, <code>Show()</code> in QMainWindow itself, but performance problems occur.</p>\n\n<p>I expect that there will be some consideration for resizing the application since the problem occurs only in resized window.</p>\n\n<p>Are there any ideas?</p>\n\n<hr>\n\n<p>My environment is the following:</p>\n\n<ul>\n<li>Qt: 5.12.0</li>\n<li>My app source code: <a href=\"https://github.com/akiyosi/goqtframelesswindow\" rel=\"nofollow noreferrer\">https://github.com/akiyosi/goqtframelesswindow</a> commit:8d7aa6e</li>\n</ul>\n"}, {"tags": ["go", "circular-dependency"], "comments": [{"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1551637216, "post_id": 54965993, "comment_id": 96703585, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/48221414/re-design-circular-dependency-flaw\">re-design circular dependency flaw</a>"}], "answers": [{"comments": [{"owner": {"reputation": 139, "user_id": 9269863, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/544ad9fcbac2917b8a5f57dbf4ef4b0d?s=128&d=identicon&r=PG&f=1", "display_name": "William M.", "link": "https://stackoverflow.com/users/9269863/william-m"}, "edited": false, "score": 0, "creation_date": 1551633425, "post_id": 54966154, "comment_id": 96702265, "body": "Thank you very much for your answer! You helped me a lot."}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1551634645, "post_id": 54966154, "comment_id": 96702711, "body": "This is a nice way to solve circular dependencies though for the specific config related circular dependencies see <a href=\"https://stackoverflow.com/q/48221414/5788720\">stackoverflow.com/q/48221414/5788720</a>"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 3, "last_activity_date": 1551594243, "creation_date": 1551594243, "answer_id": 54966154, "question_id": 54965993, "link": "https://stackoverflow.com/questions/54965993/best-practice-for-for-resolving-a-circular-dependency-in-go/54966154#54966154", "title": "Best practice for for resolving a circular dependency in Go", "body": "<p>In what format are you sending the configuration to the error reporting system? Maybe pass that to logging? Say, if it's json, then marshal the config before giving it to logging and then give logging the <code>[]byte</code> result only.</p>\n\n<p>But in general, if two packages depend on each other directly what you can do is have one of them declare an interface that matches the other one's behaviour and then have a separate package pass the concrete instance as the interface.</p>\n\n<p>For example:</p>\n\n<p><code>/myapp/config</code></p>\n\n<pre><code>import \"myapp/logging\"\n\ntype Config struct {\n     // ...\n}\n\nfunc NewConfig() *Config {\n    // ...\n    if err != nil {\n        logging.LogError(err)\n    }\n}\n</code></pre>\n\n<p><code>/myapp/logging</code></p>\n\n<pre><code>import \"myapp/config\"\n\nfunc LogConfig(c *config.Config) {\n    // ...\n}\n\nfunc LogError(err error) {\n    // ...\n}\n</code></pre>\n\n<p>So in this case you could declare an interface in the config package that matches the behaviour it needs from logging.</p>\n\n<p><code>/myapp/config</code></p>\n\n<pre><code>type Logging interface {\n    LogError(error)\n}\n\nvar logging Logging\n\nfunc SetLogging(l Logging) {\n    logging = l\n}\n\ntype Config struct {\n     // ...\n}\n\nfunc NewConfig() *Config {\n    // ...\n    if err != nil {\n        logging.LogError(err)\n    }\n}\n</code></pre>\n\n<p>And then have a type in the logging package implement that interface by simply delegating to the original functions.</p>\n\n<p><code>/myapp/logging</code></p>\n\n<pre><code>import \"myapp/config\"\n\nfunc LogConfig(c *config.Config) {\n    // ...\n}\n\nfunc LogError(err error) {\n    // ...\n}\n\ntype Logging struct{}\n\nfunc (Logging) LogError(err error) {\n    LogError(err)\n}\n</code></pre>\n\n<p>And lastly have a third package make it all work together.</p>\n\n<p><code>/myapp</code></p>\n\n<pre><code>import \"myapp/config\"\nimport \"myapp/logging\"\n\nfunc init() {\n    config.SetLogging(logging.Logging{})\n}\n</code></pre>\n"}], "owner": {"reputation": 139, "user_id": 9269863, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/544ad9fcbac2917b8a5f57dbf4ef4b0d?s=128&d=identicon&r=PG&f=1", "display_name": "William M.", "link": "https://stackoverflow.com/users/9269863/william-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 515, "favorite_count": 0, "accepted_answer_id": 54966154, "answer_count": 1, "score": 2, "last_activity_date": 1551646153, "creation_date": 1551592419, "last_edit_date": 1551646153, "question_id": 54965993, "link": "https://stackoverflow.com/questions/54965993/best-practice-for-for-resolving-a-circular-dependency-in-go", "title": "Best practice for for resolving a circular dependency in Go", "body": "<p>I have a Go project that contains both of these packages:</p>\n\n<ul>\n<li><code>logging</code><br>\nImports <code>config</code>, because I want to send the current configuration to my error reporting system</li>\n<li><code>config</code><br>\nImports <code>logging</code>, because I want to log if the program is unable to open the config files</li>\n</ul>\n\n<p>What is the best practice for resolving this dependency error?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 27, "user_id": 4902236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/577476e0a1e709d01d2f88660d6b69c0?s=128&d=identicon&r=PG", "display_name": "\u0421\u0435\u0440\u0433\u0435\u0439 \u041f\u0435\u0440\u0435\u043d\u0435\u0446", "link": "https://stackoverflow.com/users/4902236/%d0%a1%d0%b5%d1%80%d0%b3%d0%b5%d0%b9-%d0%9f%d0%b5%d1%80%d0%b5%d0%bd%d0%b5%d1%86"}, "edited": false, "score": 0, "creation_date": 1551595105, "post_id": 54965852, "comment_id": 96692826, "body": "Sorry, i placed wrong source example. Fixed in question."}, {"owner": {"reputation": 519, "user_id": 2581091, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/66f370089ac9ea8c0c90633420667a1a?s=128&d=identicon&r=PG", "display_name": "cgcgbcbc", "link": "https://stackoverflow.com/users/2581091/cgcgbcbc"}, "edited": false, "score": 0, "creation_date": 1551596190, "post_id": 54965852, "comment_id": 96693006, "body": "If I did not mistake what json.Unmarshal does, I think the unmarshal result should be contains key from the struct (i.e. what you received should not happens). The json tag specifies the key in the json string, so if your tag is <code>json:&quot;coefficient&quot;</code>, the key in the json should be &quot;coefficient&quot;"}, {"owner": {"reputation": 27, "user_id": 4902236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/577476e0a1e709d01d2f88660d6b69c0?s=128&d=identicon&r=PG", "display_name": "\u0421\u0435\u0440\u0433\u0435\u0439 \u041f\u0435\u0440\u0435\u043d\u0435\u0446", "link": "https://stackoverflow.com/users/4902236/%d0%a1%d0%b5%d1%80%d0%b3%d0%b5%d0%b9-%d0%9f%d0%b5%d1%80%d0%b5%d0%bd%d0%b5%d1%86"}, "edited": false, "score": 0, "creation_date": 1551596302, "post_id": 54965852, "comment_id": 96693028, "body": "So how then better to marshal unmarshaled string with needed tags?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1551602571, "post_id": 54965852, "comment_id": 96694261, "body": "Your target struct assumes an object called &#39;Value&#39; within an object. Your input data doesn&#39;t have this format. So, naturally, this doesn&#39;t work."}], "answers": [{"comments": [{"owner": {"reputation": 22751, "user_id": 2399879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UxMS5.jpg?s=128&g=1", "display_name": "Crowman", "link": "https://stackoverflow.com/users/2399879/crowman"}, "edited": false, "score": 1, "creation_date": 1551600057, "post_id": 54966378, "comment_id": 96693733, "body": "1) This answer doesn&#39;t make any sense; and 2) you can&#39;t unmarshal values into unexported fields."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1551603017, "post_id": 54966378, "comment_id": 96694355, "body": "It does make sense, and seems generally correct (although incomplete), if the unexported fields are corrected."}], "tags": [], "owner": {"reputation": 519, "user_id": 2581091, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/66f370089ac9ea8c0c90633420667a1a?s=128&d=identicon&r=PG", "display_name": "cgcgbcbc", "link": "https://stackoverflow.com/users/2581091/cgcgbcbc"}, "is_accepted": false, "score": 0, "last_activity_date": 1551603407, "last_edit_date": 1551603407, "creation_date": 1551596347, "answer_id": 54966378, "question_id": 54965852, "link": "https://stackoverflow.com/questions/54965852/json-unmarshal-replaces-properties-with-zero-if-its-structured-in-tags/54966378#54966378", "title": "json Unmarshal replaces properties with zero if it&#39;s structured in tags", "body": "<p>If you want to parse <code>{\"B\":false,\"C\":2.123,\"CE\":0,\"G\":1,\"P\":1000,\"T\":0}</code> to </p>\n\n<pre><code>{\n\"B\": false,\n\"coefficient\": 0,\n\"CE\": 0,\n\"group\": 0,\n\"period\": 0,\n\"type\": 0\n}\n</code></pre>\n\n<p>I think your struct should be declared as</p>\n\n<pre><code>struct {\n        B bool\n        coefficient float32 `json:\"C\"`\n        CE float32\n        group int `json:\"G\"`\n        period float32 `json:\"P\"`\n        type int `json:\"T\"`\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1551602973, "creation_date": 1551602973, "answer_id": 54967099, "question_id": 54965852, "link": "https://stackoverflow.com/questions/54965852/json-unmarshal-replaces-properties-with-zero-if-its-structured-in-tags/54967099#54967099", "title": "json Unmarshal replaces properties with zero if it&#39;s structured in tags", "body": "<p>You have two big problems:</p>\n\n<ol>\n<li><p>Your tags are completely wrong. Your input contains, for example <code>\"C\":2.123</code>, but your struct tags mean the Unmarshaler is looking for <code>\"coefficient\":2.123</code>, which it will never find. To correct this, set the tags to match your input:</p>\n\n<pre><code>type ParsedObjectType struct{\n    Value struct{\n        E []struct {\n            B  bool\n            C  float32 `json:\"C\"`\n            CE float32\n            G  int     `json:\"G\"`\n            P  float32 `json:\"P\"`\n            T  int     `json:\"T\"`\n        }\n    }\n}\n</code></pre>\n\n<p>Note that now your struct fields match your JSON keys exactly, so you could simply eliminate your JSON tags entirely for simplicity, if you wish:</p>\n\n<pre><code>type ParsedObjectType struct{\n    Value struct{\n        E []struct {\n            B  bool\n            C  float32\n            CE float32\n            G  int\n            P  float32\n            T  int\n        }\n    }\n}\n</code></pre></li>\n<li><p>Your data structure doesn't appear to match your input.  Your input appears to be a single object, but your input expects an object within an object.  To correct this, (assuming the input you provided in your question is complete), get rid of the extra layer in your data structure:</p>\n\n<pre><code>type ParsedObjectType struct{\n    B  bool\n    C  float32\n    CE float32\n    G  int\n    P  float32\n    T  int\n}\n</code></pre></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 27, "user_id": 4902236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/577476e0a1e709d01d2f88660d6b69c0?s=128&d=identicon&r=PG", "display_name": "\u0421\u0435\u0440\u0433\u0435\u0439 \u041f\u0435\u0440\u0435\u043d\u0435\u0446", "link": "https://stackoverflow.com/users/4902236/%d0%a1%d0%b5%d1%80%d0%b3%d0%b5%d0%b9-%d0%9f%d0%b5%d1%80%d0%b5%d0%bd%d0%b5%d1%86"}, "edited": false, "score": 1, "creation_date": 1551604300, "post_id": 54967226, "comment_id": 96694646, "body": "I understand. But there&#39;s other problem. After deserializing i put this object to map inside other object. And after that i want to marshal last object. In that case i want to change json keys into readable. That&#39;s my problem."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 27, "user_id": 4902236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/577476e0a1e709d01d2f88660d6b69c0?s=128&d=identicon&r=PG", "display_name": "\u0421\u0435\u0440\u0433\u0435\u0439 \u041f\u0435\u0440\u0435\u043d\u0435\u0446", "link": "https://stackoverflow.com/users/4902236/%d0%a1%d0%b5%d1%80%d0%b3%d0%b5%d0%b9-%d0%9f%d0%b5%d1%80%d0%b5%d0%bd%d0%b5%d1%86"}, "edited": false, "score": 2, "creation_date": 1551604945, "post_id": 54967226, "comment_id": 96694765, "body": "@\u0421\u0435\u0440\u0433\u0435\u0439\u041f\u0435\u0440\u0435\u043d\u0435\u0446 You need to explain that in your question, then. But the answer to that part is: You need two structs, which are the same, except for their json tags."}, {"owner": {"reputation": 739, "user_id": 1065759, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Nkh6.jpg?s=128&g=1", "display_name": "Alexey Mukas", "link": "https://stackoverflow.com/users/1065759/alexey-mukas"}, "edited": false, "score": 0, "creation_date": 1551605229, "post_id": 54967226, "comment_id": 96694807, "body": "@C\u0435\u0440\u0433\u0435\u0439 I don&#39;t see why this will not work, check this one: <a href=\"https://play.golang.org/p/C56e7ZrvxNE\" rel=\"nofollow noreferrer\">play.golang.org/p/C56e7ZrvxNE</a>"}], "tags": [], "owner": {"reputation": 739, "user_id": 1065759, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Nkh6.jpg?s=128&g=1", "display_name": "Alexey Mukas", "link": "https://stackoverflow.com/users/1065759/alexey-mukas"}, "is_accepted": true, "score": 0, "last_activity_date": 1551604006, "creation_date": 1551604006, "answer_id": 54967226, "question_id": 54965852, "link": "https://stackoverflow.com/questions/54965852/json-unmarshal-replaces-properties-with-zero-if-its-structured-in-tags/54967226#54967226", "title": "json Unmarshal replaces properties with zero if it&#39;s structured in tags", "body": "<p>As I understand in <code>json</code> you have compact names, but it should not force you to create cryptic names in structures.</p>\n\n<p>In the code, you should use meaningful names, but in a serialized format you can use synonyms.</p>\n\n<p>Adapted from your example:\nplayground: <a href=\"https://play.golang.org/p/gbWhV3FfHMr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/gbWhV3FfHMr</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n)\n\ntype ParsedObjectType struct {\n    Value struct {\n        Items []struct {\n            Coefficient float32 `json:\"C\"`\n            Group       int     `json:\"G\"`\n            Period      float32 `json:\"P\"`\n            TypeValue   int     `json:\"T\"`\n        } `json:\"E\"`\n    }\n}\n\nfunc main() {\n\n    str := `{\"Value\": {\n            \"E\": [\n              {\n                \"B\": false,\n                \"C\": 2.123,\n                \"CE\": 0,\n                \"G\": 1,\n                \"P\": 1000,\n                \"T\": 0\n              }\n            ]\n          }\n        }`\n\n    out := &amp;ParsedObjectType{}\n    if err := json.Unmarshal([]byte(str), out); err != nil {\n        log.Printf(\"failed unmarshal %s\", err)\n    }\n\n    log.Printf(\"Constructed: %#v\", out)\n}\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 4902236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/577476e0a1e709d01d2f88660d6b69c0?s=128&d=identicon&r=PG", "display_name": "\u0421\u0435\u0440\u0433\u0435\u0439 \u041f\u0435\u0440\u0435\u043d\u0435\u0446", "link": "https://stackoverflow.com/users/4902236/%d0%a1%d0%b5%d1%80%d0%b3%d0%b5%d0%b9-%d0%9f%d0%b5%d1%80%d0%b5%d0%bd%d0%b5%d1%86"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 0, "accepted_answer_id": 54967226, "answer_count": 3, "score": -1, "last_activity_date": 1551604006, "creation_date": 1551590746, "last_edit_date": 1551602489, "question_id": 54965852, "link": "https://stackoverflow.com/questions/54965852/json-unmarshal-replaces-properties-with-zero-if-its-structured-in-tags", "title": "json Unmarshal replaces properties with zero if it&#39;s structured in tags", "body": "<p>Here's struct of unmarshal target:</p>\n\n<pre><code>type ParsedObjectType struct{\n    Value struct{\n        E []struct {\n            B bool\n            C float32 `json:\"coefficient\"`\n            CE float32\n            G int `json:\"group\"`\n            P float32 `json:\"period\"`\n            T int `json:\"type\"`\n        }\n    }\n}\n</code></pre>\n\n<p>And soucre string looks like this:</p>\n\n<pre><code>{\"B\":false,\"C\":2.123,\"CE\":0,\"G\":1,\"P\":1000,\"T\":0}\n</code></pre>\n\n<p>After <code>json.Unmarshal([]byte(string), ParsedObjectType)</code> i receive </p>\n\n<pre><code>{\n    \"B\": false,\n    \"coefficient\": 0,\n    \"CE\": 0,\n    \"group\": 0,\n    \"period\": 0,\n    \"type\": 0\n}\n</code></pre>\n\n<p>with zeros instead of source data in properties</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "amazon-cognito"], "comments": [{"owner": {"reputation": 12118, "user_id": 663360, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d913eec72e7837bb2712a06ea5f25c5?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Stormacq", "link": "https://stackoverflow.com/users/663360/s%c3%a9bastien-stormacq"}, "edited": false, "score": 0, "creation_date": 1551614109, "post_id": 54965463, "comment_id": 96696868, "body": "To verify this is indeed an IAM permssion problem, TEMPORARLY give full admin access persmission to your Lambda function and try again.  If it works, this is indeed an IAM policy missing.  Reading the error message will mostly provide you with the name of the API call which is missing from the permission."}], "answers": [{"tags": [], "owner": {"reputation": 1185, "user_id": 1520421, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/5a4e98bb784ee939598e7b93705f3eaf?s=128&d=identicon&r=PG", "display_name": "Dattatray", "link": "https://stackoverflow.com/users/1520421/dattatray"}, "is_accepted": true, "score": 0, "last_activity_date": 1551686585, "creation_date": 1551686585, "answer_id": 54978930, "question_id": 54965463, "link": "https://stackoverflow.com/questions/54965463/aws-cognito-initiateauth-through-lambda-function-results-into-error/54978930#54978930", "title": "AWS Cognito InitiateAuth through Lambda function results into error", "body": "<p>When we create a new App client, by default it has an associated App client secret.</p>\n\n<p>I created one more app client, without \"Client Secret\". I used this new App client.</p>\n\n<p>I modified the code to use the API AdminInitiateAuth, instead of the InitiateAuth</p>\n\n<p>I was able to successfully login.</p>\n\n<p>Here is the reference link, which was useful - <a href=\"https://stackoverflow.com/questions/52487433/amplify-unable-to-verify-secret-hash-for-client\">Amplify &quot;Unable to verify secret hash for client&quot;</a></p>\n"}], "owner": {"reputation": 1185, "user_id": 1520421, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/5a4e98bb784ee939598e7b93705f3eaf?s=128&d=identicon&r=PG", "display_name": "Dattatray", "link": "https://stackoverflow.com/users/1520421/dattatray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 389, "favorite_count": 0, "accepted_answer_id": 54978930, "answer_count": 1, "score": 1, "last_activity_date": 1551686585, "creation_date": 1551585752, "question_id": 54965463, "link": "https://stackoverflow.com/questions/54965463/aws-cognito-initiateauth-through-lambda-function-results-into-error", "title": "AWS Cognito InitiateAuth through Lambda function results into error", "body": "<p>I am writing a Lambda function in Go to authenticate a user, the AccessToken/IdToken I want to use for subsequent API calls.</p>\n\n<p>When I execute the Go code from a standalone program, it works, the InitiateAuth was successful.</p>\n\n<p>When I tried to use the same code from the lambda function, I get an error  NotAuthorizedException: Unable to verify secret hash for client .......</p>\n\n<p>Here is the code snippet I am using</p>\n\n<pre><code>func AuthenticateUser(userName string, passWord string) (*cognitoidentityprovider.InitiateAuthOutput, error) {\n\n    username := aws.String(userName)\n    password := aws.String(passWord)\n    clientID := aws.String(constants.COGNITO_APP_CLIENT_ID)\n\n    params := &amp;cognitoidentityprovider.InitiateAuthInput{\n        AuthFlow: aws.String(\"USER_PASSWORD_AUTH\"),\n        AuthParameters: map[string]*string{\n            \"USERNAME\": username,\n            \"PASSWORD\": password,\n        },\n        ClientId: clientID,\n    }\n\n    authResponse, authError := cognitoClient.InitiateAuth(params)\n    if authError != nil {\n\n        fmt.Println(\"Error = \", authError)\n        return nil, authError\n    }\n\n    fmt.Println(authResponse)\n    fmt.Println(*authResponse.Session)\n\n    return authResponse, nil\n}\n</code></pre>\n\n<p>I have given sufficient permissions to the lambda user\n- cognito-idp:AdminCreateUser\n- cognito-idp:AdminDeleteUser\n- cognito-idp:InitiateAuth\n- cognito-idp:ChangePassword\n- cognito-idp:AdminRespondToAuthChallenge\n- cognito-idp:AdminInitiateAuth\n- cognito-idp:ConfirmForgotPassword</p>\n\n<p>Am I missing something here?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551769030, "post_id": 54965034, "comment_id": 96750164, "body": "If the searchDb argument does not escape, then the function as written is the best choice. The function will execute with no  heap allocations for the slice. If the argument does  escape, then the best choice will depend on the actual workload and the runtime&#39;s strategy for allocating extra capacity on append.  In this case you will need to measure to determine what&#39;s best.  If searchDb calls to a database, then performance difference between the choices will be in the noise."}, {"owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551784248, "post_id": 54965034, "comment_id": 96758229, "body": "@ThunderCat hi, thanks a lot for the reply. Sorry that I don&#39;t quite understand what <code>escape</code> means here. And yeah, searchDb will call a database from its name. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "edited": false, "score": 0, "creation_date": 1551581477, "post_id": 54965081, "comment_id": 96690911, "body": "Thank you very much for this tip. so you suggest to set it to <code>nil</code> first. OK, cheers. ^_^"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1551610928, "post_id": 54965081, "comment_id": 96696055, "body": "This does not answer the question."}], "tags": [], "owner": {"reputation": 38, "user_id": 11132444, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-o54ewJLJxmE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcNUUO7Z0PMbsvc8GEC70rnMdqC2A/mo/photo.jpg?sz=128", "display_name": "Ed Chan", "link": "https://stackoverflow.com/users/11132444/ed-chan"}, "is_accepted": false, "score": 0, "last_activity_date": 1551580789, "creation_date": 1551580789, "answer_id": 54965081, "question_id": 54965034, "link": "https://stackoverflow.com/questions/54965034/if-i-know-the-max-size-of-many-tmp-slices-should-i-set-capacity-when-creating-t/54965081#54965081", "title": "If I know the max size of many tmp slices, should I set capacity when creating them?", "body": "<p>I would do</p>\n\n<pre><code>var tmpSlice []string\n</code></pre>\n\n<p>This would give you an empty string slice and you can append as needed.\nUnless the slice range gets big and you know the dimension beforehand, otherwise I wouldn't pre-allocate memory for it</p>\n"}, {"comments": [{"owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "edited": false, "score": 1, "creation_date": 1551604032, "post_id": 54966545, "comment_id": 96694582, "body": "Thanks a lot for your reply. But sorry that I don&#39;t quite understand what you want to express. So what is your final suggestion on my question? Are you suggesting to use <code>var tmpSlice [10]string</code>? and then use tmpSlice[i] = assignment in the loop? and finally when accessing it,  loop again until the last non-empty string? Thanks a lot."}, {"owner": {"reputation": 739, "user_id": 1065759, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Nkh6.jpg?s=128&g=1", "display_name": "Alexey Mukas", "link": "https://stackoverflow.com/users/1065759/alexey-mukas"}, "reply_to_user": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "edited": false, "score": 1, "creation_date": 1551604803, "post_id": 54966545, "comment_id": 96694739, "body": "I suggest using slices without any premature optimization. After you identify that this method is really slow, you can apply what I have suggested. Imagine reader of the code seeing <code>make([]string, 0, 10)</code>, why 10? why not 42? Not to create questions better to avoid such an approach if there is no reason. The problem with arrays is that is it very easy to write code that makes them as slow as slices. If it answers your question pls accept the answer, so I can update it with details from the comment."}], "tags": [], "owner": {"reputation": 739, "user_id": 1065759, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Nkh6.jpg?s=128&g=1", "display_name": "Alexey Mukas", "link": "https://stackoverflow.com/users/1065759/alexey-mukas"}, "is_accepted": false, "score": 3, "last_activity_date": 1551598953, "last_edit_date": 1551598953, "creation_date": 1551598026, "answer_id": 54966545, "question_id": 54965034, "link": "https://stackoverflow.com/questions/54965034/if-i-know-the-max-size-of-many-tmp-slices-should-i-set-capacity-when-creating-t/54966545#54966545", "title": "If I know the max size of many tmp slices, should I set capacity when creating them?", "body": "<p>Fastest would be if code doesn't allocate on the heap.</p>\n\n<p>Create variables that allocate on the stack and do no escape (pass variables by value, otherwise they will escape). </p>\n\n<p>Escaping you can check by adding <code>-gcflags \"-m -l\"</code> on building.</p>\n\n<p>Here is an example that shows if we substitute <code>slice</code> with array and pass it by value, it results in fast code without allocation (on the heap).</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc BenchmarkAllocation(b *testing.B) {\n    b.Run(\"Slice\", func(b2 *testing.B) {\n        for i := 0; i &lt; b2.N; i++ {\n            _ = getDataFromDbSlice([]string{\"one\", \"two\"})\n        }\n    })\n    b.Run(\"Array\", func(b2 *testing.B) {\n        for i := 0; i &lt; b2.N; i++ {\n            _ = getDataFromDbArray([]string{\"one\", \"two\"})\n        }\n    })\n}\n\ntype DbQuery [10]string\ntype DbQueryResult [10]string\n\nfunc getDataFromDbArray(s []string) DbQueryResult {\n    q := DbQuery{}\n    return processQueryArray(q)\n}\n\nfunc processQueryArray(q DbQuery) DbQueryResult {\n    return (DbQueryResult)(q)\n}\n\nfunc getDataFromDbSlice(s []string) []string {\n    tmpArray := make([]string, 0, 10)\n    return processQuerySlice(tmpArray)\n}\n\nfunc processQuerySlice(q []string) []string {\n    return q\n}\n</code></pre>\n\n<p>Running benchmark with <code>benchmem</code> gives this results:</p>\n\n<pre><code>BenchmarkAllocation/Slice-6             30000000            51.8 ns/op       160 B/op          1 allocs/op\nBenchmarkAllocation/Array-6             100000000           15.7 ns/op         0 B/op          0 allocs/op\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1551830924, "last_edit_date": 1551830924, "creation_date": 1551810416, "answer_id": 55009304, "question_id": 54965034, "link": "https://stackoverflow.com/questions/54965034/if-i-know-the-max-size-of-many-tmp-slices-should-i-set-capacity-when-creating-t/55009304#55009304", "title": "If I know the max size of many tmp slices, should I set capacity when creating them?", "body": "<p>This answer assumes that <code>searchDB</code> does not retain a reference to the slice passed to it. It seems unlikely that the function retains a reference given the variable and function names.</p>\n\n<p>These options have the same memory and performance characteristics: </p>\n\n<pre><code> var tmpSlice []string\n tmpSlice := []string{}\n tmpSlice := make([]string, 0)\n tmpSlice := make([]string, 0, 0)\n</code></pre>\n\n<p>None of them allocate memory until the first append operation. If these are your only options, then pick one of the first two because they are easier to read.</p>\n\n<p>This option will have the best performance:</p>\n\n<pre><code>tmpSlice := make([]string, 0, 10)\n</code></pre>\n\n<p>This ensures that the backing array for the slice is allocated once. There will be no reallocations of the backing array as values are appended.</p>\n\n<p>If <code>searchDB</code>'s argument does not escape, then the one allocation for the backing array will be made on the stack.  This is the best possible performance. You can find out if the argument escapes by building with the <code>-gcflags \"-m -l\"</code> option.</p>\n\n<p>Given that <code>getDataFromDb</code> invokes a database operation, any performance difference between the options will be in the noise. It's more important is to write clear and simple code than to optimize this.</p>\n\n<p>I would probably go with the <code>var tmpSlice []string</code> over <code>tmpSlice := make([]string, 0, 10)</code> because there's no need to understand where the value 10 came from with the former.</p>\n"}], "owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1551830924, "creation_date": 1551580078, "last_edit_date": 1551606243, "question_id": 54965034, "link": "https://stackoverflow.com/questions/54965034/if-i-know-the-max-size-of-many-tmp-slices-should-i-set-capacity-when-creating-t", "title": "If I know the max size of many tmp slices, should I set capacity when creating them?", "body": "<p>If I need to use tmp slices in a function and the function will be called many times, their max capacity will not exceed 10. But the length of them are varied. Just for example, maybe 80% of them only have size of 1. 10% of them have size 3 and 10% of them have size 10.</p>\n\n<p>I can think of an example function like the following:</p>\n\n<pre><code>func getDataFromDb(s []string) []string {\n    tmpSlice := make([]string, 0, 10)\n    for _, v := range s {\n        if check(v) {\n            tmpSlice = append(tmpSlice, v)\n        }\n    }\n    ......\n    return searchDb(tmpSlice)\n}\n</code></pre>\n\n<p>So should I do <code>var tmpSlice []string</code>, <code>tmpSlice := make([]string, 0, 0)</code>, <code>tmpSlice := make([]string, 0, 5)</code>, or <code>tmpSlice := make([]string, 0, 10)</code>? or any other suggestions?</p>\n"}, {"tags": ["arrays", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 5061767, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-iZmLDdCYatQ/AAAAAAAAAAI/AAAAAAAAABY/pBoUXbSMNf8/photo.jpg?sz=128", "display_name": "Fatchul Amin", "link": "https://stackoverflow.com/users/5061767/fatchul-amin"}, "edited": false, "score": 2, "creation_date": 1551581309, "post_id": 54965062, "comment_id": 96690883, "body": "I try it but index not found in b , lets check <a href=\"https://play.golang.org/p/H-aaolvSDZt\" rel=\"nofollow noreferrer\">play.golang.org/p/H-aaolvSDZt</a>"}, {"owner": {"reputation": 69, "user_id": 11103630, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RDv7pXmuWiA/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMxYgjwyuWluSn_VmIWSlKtv4Aayw/mo/photo.jpg?sz=128", "display_name": "Redone R", "link": "https://stackoverflow.com/users/11103630/redone-r"}, "edited": false, "score": 1, "creation_date": 1551616321, "post_id": 54965062, "comment_id": 96697431, "body": "Note that the function compareReplace will panic if len(a) &gt; len(b)."}, {"owner": {"reputation": 145, "user_id": 3117565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dddb7750fcb817db6fa82bad406e938d?s=128&d=identicon&r=PG", "display_name": "sgraham", "link": "https://stackoverflow.com/users/3117565/sgraham"}, "edited": false, "score": 0, "creation_date": 1551671945, "post_id": 54965062, "comment_id": 96711701, "body": "this will always panic or not loop thru the entire slice unless both slices are of equal size"}], "tags": [], "owner": {"reputation": 38, "user_id": 11132444, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-o54ewJLJxmE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcNUUO7Z0PMbsvc8GEC70rnMdqC2A/mo/photo.jpg?sz=128", "display_name": "Ed Chan", "link": "https://stackoverflow.com/users/11132444/ed-chan"}, "is_accepted": false, "score": -1, "last_activity_date": 1551580555, "creation_date": 1551580555, "answer_id": 54965062, "question_id": 54964980, "link": "https://stackoverflow.com/questions/54964980/replace-data-in-array-struct-in-golang/54965062#54965062", "title": "Replace data in array struct in Golang", "body": "<p>First of all, I would consider declaring only one struct since the fields of <code>A</code>, <code>B</code> and <code>C</code> is the same. For example:</p>\n\n<pre><code>type FooBar struct {\n    TransactionDate  string \n    TotalAmount      string \n    TotalTransaction string \n}\n</code></pre>\n\n<p>Then for your function, you can try to rewrite it to:</p>\n\n<pre><code>func compareReplace(a []FooBar, b []FooBar) []FooBar{\n var c []foobar\n for i := 0; i &lt; len(a); i++ { \n  if a[i].TransactionDate == b[i].TransactionDate {\n        if b[i].TotalTransaction != \"0\" {\n            c = append(c, b[i])\n        }\n  }\n }\n return c\n}\n</code></pre>\n\n<p>Then at last you might want to fix your logic:</p>\n\n<pre><code>func compareReplace(a []FooBar, b []FooBar) []FooBar{\n var c []foobar\n for i := 0; i &lt; len(a); i++ { \n  if a[i].TransactionDate == b[i].TransactionDate {\n        if b[i].TotalTransaction != \"0\" {\n            c = append(c, b[i])\n        } \n  } else {\n    // You might want to append a[i] if the date is mismatching\n    c = append(c, b[i])\n  }\n }\n return c\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 145, "user_id": 3117565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dddb7750fcb817db6fa82bad406e938d?s=128&d=identicon&r=PG", "display_name": "sgraham", "link": "https://stackoverflow.com/users/3117565/sgraham"}, "is_accepted": true, "score": 0, "last_activity_date": 1551672134, "last_edit_date": 1551672134, "creation_date": 1551652080, "answer_id": 54974408, "question_id": 54964980, "link": "https://stackoverflow.com/questions/54964980/replace-data-in-array-struct-in-golang/54974408#54974408", "title": "Replace data in array struct in Golang", "body": "<p>Your logic assumes that the length of <code>a</code> is always the proper count to conditionally iterate through. The playground that @FatchulAmin shared in a comment on @EdChan answer exposed the issue when <code>a</code> is larger than <code>b</code> or vice versa, you will get the \"index out of range\" error because the smaller slice will no longer have indexes to match the larger. <code>a[i].TransactionDate == b[i].TransactionDate</code></p>\n\n<p>For sanity, in this case, you should do a check to find the smallest count to iterate with, however, this will not allow you to completely check all of the largest slice. </p>\n\n<p>I suggest merging the slices then finding the largest and smallest to range and loop to remove what you want from the merged. NOTE: @EdChan is right to use one struct since they are all the same. </p>\n\n<pre><code>type FooBar struct {\n    TransactionDate  string\n    TotalAmount      string\n    TotalTransaction string\n}\n\ntype FooBarSlice []FooBar // this is used as a receiver on func Remove\n\nfunc compareReplace(a []FooBar, b []FooBar) []FooBar {\n    var c FooBarSlice\n    c = append(a, b...)\n\n\n    var largerSlice []FooBar\n    var smallerSlice []FooBar\n    if len(a) &lt;= len(b) {\n        largerSlice = b\n        smallerSlice = a\n    } else {\n        largerSlice = a\n        smallerSlice = b\n    }\n\n    for _, v := range smallerSlice {\n\n        for j := 0; j &lt; len(largerSlice); j++ {\n            if largerSlice[j].TransactionDate == v.TransactionDate &amp;&amp; largerSlice[j].TotalTransaction == \"0\" {\n\n                c.Remove(j)\n\n            }\n        }\n    }\n\n    return c\n}\n</code></pre>\n\n<p>Full working example: <a href=\"https://play.golang.org/p/iyUYtXlDG54\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iyUYtXlDG54</a></p>\n"}], "owner": {"reputation": 109, "user_id": 5061767, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-iZmLDdCYatQ/AAAAAAAAAAI/AAAAAAAAABY/pBoUXbSMNf8/photo.jpg?sz=128", "display_name": "Fatchul Amin", "link": "https://stackoverflow.com/users/5061767/fatchul-amin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1235, "favorite_count": 0, "accepted_answer_id": 54974408, "answer_count": 2, "score": 0, "last_activity_date": 1551672134, "creation_date": 1551579262, "last_edit_date": 1551581469, "question_id": 54964980, "link": "https://stackoverflow.com/questions/54964980/replace-data-in-array-struct-in-golang", "title": "Replace data in array struct in Golang", "body": "<p>I have 3 struct data <strong>(GOLANG)</strong> that I call <strong>A</strong>, <strong>B</strong>, and <strong>C</strong>, struct C is result array replace between struct A and B when data is similar or more than 0  then I set all result to struct C using array.</p>\n\n<pre><code>Struct A, B, C {\n TransactionDate  string \n TotalAmount      string \n TotalTransaction string \n}\n\nA = [\n     {2019-02-01 0 0} \n     {2019-02-02 0 0} \n     {2019-02-03 0 0} \n     {2019-02-04 0 0} \n     {2019-02-05 0 0} \n     {2019-02-06 0 0} \n     {2019-02-07 0 0}\n   ]\n\nB = [\n     {2019-02-02 1000 2} \n     {2019-02-07 200 3}\n    ]\n</code></pre>\n\n<p>I expect the result is like </p>\n\n<pre><code>C = [\n     {2019-02-01 0 0} \n     {2019-02-02 1000 2} \n     {2019-02-03 0 0} \n     {2019-02-04 0 0} \n     {2019-02-05 0 0} \n     {2019-02-06 0 0} \n     {2019-02-07 200 3}\n  ]\n</code></pre>\n\n<p>I try using like this but I can't still like my expected result, can you help me to solve this?</p>\n\n<pre><code>func compareReplace() []C{\n var a []A\n var b []B\n var c []C   \n for i := 0; i &lt; len(a); i++ { \n  if a[i].TransactionDate == b[i].TransactionDate {\n        if b[i].TotalTransaction != \"0\" {\n            c = append(c, b[i])\n        }\n  }\n }\n\n return c\n}\n</code></pre>\n\n<p>Or we can collaborate at <a href=\"https://play.golang.org/p/H-aaolvSDZt\" rel=\"nofollow noreferrer\">https://play.golang.org/p/H-aaolvSDZt</a></p>\n"}, {"tags": ["dictionary", "go", "struct", "export-to-csv"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1551580980, "creation_date": 1551580980, "answer_id": 54965089, "question_id": 54964781, "link": "https://stackoverflow.com/questions/54964781/exporting-a-map-containing-a-struct-as-value-to-csv-with-golang/54965089#54965089", "title": "Exporting a map containing a struct as value to csv with Golang", "body": "<p>Your code has several problems. Try something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"os\"\n    \"strconv\"\n)\n\nfunc main() {\n    type Record struct {\n        ID   int\n        Type string\n        Year string\n    }\n\n    m := make(map[int]Record)\n    r := Record{ID: 1, Type: \"A\", Year: \"2019\"}\n    m[r.ID] = r\n\n    f, err := os.Create(\"export.csv\")\n    if err != nil {\n        // handle error\n    }\n    defer f.Close()\n    w := csv.NewWriter(f)\n    defer w.Flush()\n\n    for _, v := range m {\n        r := make([]string, 0, 3)\n        r = append(r, strconv.Itoa(v.ID))\n        r = append(r, v.Type)\n        r = append(r, v.Year)\n        err := w.Write(r)\n        if err != nil {\n            // handle error\n        }\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run export.go\n$ cat export.csv\n1,A,2019\n$ \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 199, "user_id": 1161712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/327027b3c0936d1ab3bd104a27e0f6db?s=128&d=identicon&r=PG", "display_name": "orestisf", "link": "https://stackoverflow.com/users/1161712/orestisf"}, "edited": false, "score": 0, "creation_date": 1551719089, "post_id": 54965092, "comment_id": 96733956, "body": "Thanks for the very detailed and friendly answer - your assumption was correct about the length of the <code>r</code> variable."}], "tags": [], "owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "is_accepted": true, "score": 2, "last_activity_date": 1551590143, "last_edit_date": 1551590143, "creation_date": 1551580994, "answer_id": 54965092, "question_id": 54964781, "link": "https://stackoverflow.com/questions/54964781/exporting-a-map-containing-a-struct-as-value-to-csv-with-golang/54965092#54965092", "title": "Exporting a map containing a struct as value to csv with Golang", "body": "<p>There are a few issues here:</p>\n\n<ol>\n<li><code>writer.Write</code> takes an argument of type <code>[]string</code> so trying to append anything other than a string to <code>r</code> (which I assume is a shorthand representation of <em>record</em>) will not work.</li>\n<li>You cannot get the length of a struct. See the <a href=\"https://golang.org/pkg/builtin/#len\" rel=\"nofollow noreferrer\">builtin</a> documentation for more info about the types you can pass in to <code>len</code>. </li>\n</ol>\n\n<p>I've made a few modifications to your code:</p>\n\n<ul>\n<li>provide headers for the csv for ease of readability</li>\n<li>update <code>r</code> to accept capacity of <code>len(headers)</code>, equals 4- I wasn't sure what you wanted the capacity to be but you can easily update this to be (probably 3, not 4).</li>\n<li>convert ID field to string in order to add to <code>[]string</code> for <code>writer.Write</code></li>\n</ul>\n\n<p>Test <a href=\"https://play.golang.org/p/ZPrPqFZ2sbN\" rel=\"nofollow noreferrer\">here</a> in Go Playground.</p>\n\n<p><em>Example:</em></p>\n\n<pre><code>type Record struct {\n    ID   int\n    Type string\n    Year string\n}\n\nm := make(map[int]Record)\n\n// populate this map with some records\n\nfile, err := os.Create(\"export.csv\")\ncheckError(\"Error:\", err)\ndefer file.Close()\nwriter := csv.NewWriter(file)\ndefer writer.Flush()\n\n// define column headers\nheaders := []string{\n    \"id\",\n    \"type\",\n    \"year\",\n}\n\n// write column headers\nwriter.Write(headers)\n\nvar idString string\n\nfor key := range m {\n\n    r := make([]string, 0, 1+len(headers)) // capacity of 4, 1 + the number of properties your struct has &amp; the number of column headers you are passing\n\n    // convert the Record.ID to a string in order to pass into []string\n    idString = strconv.Itoa(m[key].ID)\n\n    r = append(\n        r,\n        idString,\n        m[key].Type,\n        m[key].Year,\n    )\n\n    writer.Write(r)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 38, "user_id": 11132444, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-o54ewJLJxmE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcNUUO7Z0PMbsvc8GEC70rnMdqC2A/mo/photo.jpg?sz=128", "display_name": "Ed Chan", "link": "https://stackoverflow.com/users/11132444/ed-chan"}, "is_accepted": false, "score": -1, "last_activity_date": 1551581018, "creation_date": 1551581018, "answer_id": 54965094, "question_id": 54964781, "link": "https://stackoverflow.com/questions/54964781/exporting-a-map-containing-a-struct-as-value-to-csv-with-golang/54965094#54965094", "title": "Exporting a map containing a struct as value to csv with Golang", "body": "<p>You are trying to apply <code>len()</code> on the struct instead of the map\nTry the following:</p>\n\n<pre><code>file, err := os.Create(\"export.csv\")\ncheckError(\"Error:\", err)\ndefer file.Close()\nwriter := csv.NewWriter(file)\ndefer writer.Flush()\n\nr := make([]string, 0, 1+len(m))\nfor key, value := range m {\n    r = append(r, key)\n    r = append(r, value)\n}\nwriter.Flush()\n</code></pre>\n"}], "owner": {"reputation": 199, "user_id": 1161712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/327027b3c0936d1ab3bd104a27e0f6db?s=128&d=identicon&r=PG", "display_name": "orestisf", "link": "https://stackoverflow.com/users/1161712/orestisf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2450, "favorite_count": 1, "accepted_answer_id": 54965092, "answer_count": 3, "score": 1, "last_activity_date": 1551590143, "creation_date": 1551576821, "question_id": 54964781, "link": "https://stackoverflow.com/questions/54964781/exporting-a-map-containing-a-struct-as-value-to-csv-with-golang", "title": "Exporting a map containing a struct as value to csv with Golang", "body": "<p>I have a map which has a struct as value, as below:</p>\n\n<pre><code>type Record struct {\n    ID   int\n    Type string\n    Year string\n}\n\nm := make(map[int]Record)\n</code></pre>\n\n<p>Once I populate this map with some records, I'm trying to export them as a csv with:</p>\n\n<pre><code>file, err := os.Create(\"export.csv\")\ncheckError(\"Error:\", err)\ndefer file.Close()\nwriter := csv.NewWriter(file)\ndefer writer.Flush()\n\nfor key, value := range m {\n    r := make([]string, 0, 1+len(value))\n    r = append(r, key)\n    r = append(r, value)\n}\nwriter.Flush()\n</code></pre>\n\n<p>I'm getting the error <code>invalid argument value (type Record) for len</code>. How should I handle the struct here to? Do I have to convert it to string somehow?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1551564657, "post_id": 54963438, "comment_id": 96687845, "body": "Maybe that error message is part of <code>data&#47;srulz.tcl</code>? Or the error comes from other code you don&#39;t show us.."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1551564661, "post_id": 54963438, "comment_id": 96687846, "body": "Is that error message anything that your program actually prints? Is it possible that that text is in the file?"}, {"owner": {"reputation": 187, "user_id": 8913779, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6wMKr.png?s=128&g=1", "display_name": "systrigger", "link": "https://stackoverflow.com/users/8913779/systrigger"}, "edited": false, "score": 0, "creation_date": 1551564942, "post_id": 54963438, "comment_id": 96687922, "body": "The error message is not in the text file - the last line is just not empty."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1551686402, "post_id": 54963438, "comment_id": 96715995, "body": "Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. The info in the question is not enough to reproduce the error."}, {"owner": {"reputation": 187, "user_id": 8913779, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6wMKr.png?s=128&g=1", "display_name": "systrigger", "link": "https://stackoverflow.com/users/8913779/systrigger"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1551740584, "post_id": 54963438, "comment_id": 96743105, "body": "@icza I&#39;ve updated the code now, thanks"}], "answers": [{"tags": [], "owner": {"reputation": 123, "user_id": 3458295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/826e33c9b1bca10ce2a77d597f0e5a81?s=128&d=identicon&r=PG&f=1", "display_name": "ragrawal", "link": "https://stackoverflow.com/users/3458295/ragrawal"}, "is_accepted": false, "score": 1, "last_activity_date": 1551609528, "creation_date": 1551609528, "answer_id": 54967954, "question_id": 54963438, "link": "https://stackoverflow.com/questions/54963438/golang-file-name-too-long-error-when-reading-from-os-args1/54967954#54967954", "title": "golang file name too long error when reading from os.Args[1]", "body": "<p>In the first line, \nfilePath, err := ioutil.ReadFile(os.Args[1])</p>\n\n<p>Above step will read the whole file contents and return slice of byte and error. filePath variable will not store the file path instead its storing the content of file in bytes. I am wondering why are you not getting compile time error as filepath variable is slice of bytes whereas  os.Open(filepath) the argument to os.Open will be string.</p>\n"}], "owner": {"reputation": 187, "user_id": 8913779, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6wMKr.png?s=128&g=1", "display_name": "systrigger", "link": "https://stackoverflow.com/users/8913779/systrigger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 669, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1551740345, "creation_date": 1551564013, "last_edit_date": 1592644375, "question_id": 54963438, "link": "https://stackoverflow.com/questions/54963438/golang-file-name-too-long-error-when-reading-from-os-args1", "title": "golang file name too long error when reading from os.Args[1]", "body": "<p>I'm new to golang and using <code>ioutil.ReadFile(os.Args[1])</code> to fetch a file path from the cli and then processing each line using:</p>\n<pre><code>package main\n\nimport (\n    &quot;bufio&quot;\n    &quot;fmt&quot;\n    &quot;log&quot;\n    &quot;os&quot;\n)\n\nfunc main()  {\n    \n    file, err := os.Open(os.Args[1])\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() {\n        fmt.Println(scanner.Text())\n    }\n\n    if err := scanner.Err(); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n<p>Now I can get the output at stdout. But also get the following ERROR in the end:</p>\n<pre><code>msg:&quot;BRUMBRUM&quot;;reference:cve,CVE-2007-2810;reference:blah;\nmsg:&quot;WAKANDA&quot;;reference:cve,CVE-2007-2810;reference:blah; file name too long\nexit status 1\n</code></pre>\n<p>My file path input is <code>data/srulz.tcl</code>\n. FYI, the error message is not a part of the text file.</p>\n<p>I need to know where is this going wrong here and how can this be improved?</p>\n<blockquote>\n<p>UPDATE:</p>\n<p><b>Provided issue reproducible code.</b></p>\n<p>Go-ing with flag pkg for now until this mystery is solved</p>\n</blockquote>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 2584, "user_id": 4949684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7d220.jpg?s=128&g=1", "display_name": "Carlos Cavero", "link": "https://stackoverflow.com/users/4949684/carlos-cavero"}, "edited": false, "score": 0, "creation_date": 1551567753, "post_id": 54963232, "comment_id": 96688625, "body": "First of all, welcome to StackOverflow. Try <a href=\"https://github.com/mongodb/mongo-go-driver/blob/master/bson/primitive/objectid.go\" rel=\"nofollow noreferrer\">this</a>. I guess is the package you are looking for."}, {"owner": {"reputation": 331, "user_id": 8736962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4001e173255aea51e13a7e402ca236fe?s=128&d=identicon&r=PG", "display_name": "Serdar Kalayc\u0131", "link": "https://stackoverflow.com/users/8736962/serdar-kalayc%c4%b1"}, "reply_to_user": {"reputation": 2584, "user_id": 4949684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7d220.jpg?s=128&g=1", "display_name": "Carlos Cavero", "link": "https://stackoverflow.com/users/4949684/carlos-cavero"}, "edited": false, "score": 1, "creation_date": 1551610173, "post_id": 54963232, "comment_id": 96695891, "body": "Thanks @CarlosCavero, simply defining the objID as primitive.ObjectID solved both problems."}, {"owner": {"reputation": 2616, "user_id": 4992212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cul0O.png?s=128&g=1", "display_name": "Tobias Theel", "link": "https://stackoverflow.com/users/4992212/tobias-theel"}, "edited": false, "score": 0, "creation_date": 1551615368, "post_id": 54963232, "comment_id": 96697197, "body": "@Serdar Kalayci you could add the working code as answer and mark it as accepted instead of editing it in the question. That way people with a similar problem will directly see, that this is solved"}], "answers": [{"comments": [{"owner": {"reputation": 273, "user_id": 4256748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac027c2b12eb957c1eb0813bc6f4bd7d?s=128&d=identicon&r=PG&f=1", "display_name": "ZacSketches", "link": "https://stackoverflow.com/users/4256748/zacsketches"}, "edited": false, "score": 1, "creation_date": 1554659242, "post_id": 55117366, "comment_id": 97823657, "body": "using <code>value := collection.FindOne(ctx, bson.D{{&quot;_id&quot;: objID}})</code> also works with the bson.D type."}, {"owner": {"reputation": 606, "user_id": 3580789, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5b41bd2528cc72f32724ed4273babc33?s=128&d=identicon&r=PG&f=1", "display_name": "oglop", "link": "https://stackoverflow.com/users/3580789/oglop"}, "reply_to_user": {"reputation": 273, "user_id": 4256748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac027c2b12eb957c1eb0813bc6f4bd7d?s=128&d=identicon&r=PG&f=1", "display_name": "ZacSketches", "link": "https://stackoverflow.com/users/4256748/zacsketches"}, "edited": false, "score": 0, "creation_date": 1599725870, "post_id": 55117366, "comment_id": 112864190, "body": "@ZacSketches I&#39;m getting Invalid field name with <code>bson.D{{&quot;_id&quot;: objID}}</code> correct syntax is <code>bson.D{bson.E{Key: &quot;_id&quot;, Value: oid}},</code> you need to use E inside D (lol could not name it any better)"}], "tags": [], "owner": {"reputation": 331, "user_id": 8736962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4001e173255aea51e13a7e402ca236fe?s=128&d=identicon&r=PG", "display_name": "Serdar Kalayc\u0131", "link": "https://stackoverflow.com/users/8736962/serdar-kalayc%c4%b1"}, "is_accepted": false, "score": 23, "last_activity_date": 1552380638, "creation_date": 1552380638, "answer_id": 55117366, "question_id": 54963232, "link": "https://stackoverflow.com/questions/54963232/mongo-go-driver-find-a-document-by-id/55117366#55117366", "title": "mongo-go-driver find a document by _id", "body": "<p>As @Carlos mentioned, I changed my code as this and everything works well.</p>\n\n<pre><code>objID, _ := primitive.ObjectIDFromHex(\"5c7452c7aeb4c97e0cdb75bf\")\nvalue := collection.FindOne(ctx, bson.M{\"_id\": objID})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1501, "user_id": 4557946, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/Qtd3P.jpg?s=128&g=1", "display_name": "Tushar Saha", "link": "https://stackoverflow.com/users/4557946/tushar-saha"}, "is_accepted": false, "score": 5, "last_activity_date": 1558155232, "creation_date": 1558155232, "answer_id": 56196081, "question_id": 54963232, "link": "https://stackoverflow.com/questions/54963232/mongo-go-driver-find-a-document-by-id/56196081#56196081", "title": "mongo-go-driver find a document by _id", "body": "<p>You can use some thing like this:</p>\n\n<pre><code>var userDB user\nobjectIDS, _ := primitive.ObjectIDFromHex(userID)\ncollectionUser := dBClient.Database(\"MyDatabase\").Collection(\"Users\")\nfilter := bson.M{\"_id\": objectIDS}\nerr := collectionUser.FindOne(ctx, filter).Decode(&amp;userDB)\nif err != nil {\n    fmt.Println(\"errror retrieving user userid : \" + userID)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 47, "user_id": 8821437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cc46aa9952ed8530c6df592955204be?s=128&d=identicon&r=PG&f=1", "display_name": "quine9997", "link": "https://stackoverflow.com/users/8821437/quine9997"}, "is_accepted": false, "score": 0, "last_activity_date": 1614928633, "creation_date": 1614928633, "answer_id": 66488291, "question_id": 54963232, "link": "https://stackoverflow.com/questions/54963232/mongo-go-driver-find-a-document-by-id/66488291#66488291", "title": "mongo-go-driver find a document by _id", "body": "<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;go.mongodb.org/mongo-driver/bson&quot;\n    &quot;go.mongodb.org/mongo-driver/bson/primitive&quot;\n    &quot;context&quot;\n)\n\n\n\n\n\n// get collection &quot;users&quot; from db() which returns *mongo.Client\nvar userCollection = db().Database(&quot;goTest&quot;).Collection(&quot;users&quot;) \n\n\nfunc mongodriver_find_by_id() {\n    \n    \n    objectId, err1 := primitive.ObjectIDFromHex(&quot;6041c3a6cfcba2fb9c4a4fd2&quot;)\n    if err1 != nil {fmt.Println(err1)}\n\n\n    findone_result := userCollection.FindOne(context.TODO(), bson.M{&quot;_id&quot;:objectId})\n    var bson_obj bson.M\n    if err2 := findone_result.Decode(&amp;bson_obj); err2 != nil {fmt.Println(err2)}\n    fmt.Println(&quot;bson_obj:&quot;, bson_obj)\n\n\n}\n</code></pre>\n"}], "owner": {"reputation": 331, "user_id": 8736962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4001e173255aea51e13a7e402ca236fe?s=128&d=identicon&r=PG", "display_name": "Serdar Kalayc\u0131", "link": "https://stackoverflow.com/users/8736962/serdar-kalayc%c4%b1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7311, "favorite_count": 2, "answer_count": 3, "score": 8, "last_activity_date": 1614928633, "creation_date": 1551562377, "last_edit_date": 1552380655, "question_id": 54963232, "link": "https://stackoverflow.com/questions/54963232/mongo-go-driver-find-a-document-by-id", "title": "mongo-go-driver find a document by _id", "body": "<p>I'm trying to find a document by its auto generated _id field. Code below returns nothing:</p>\n\n<pre><code>var documentID bson.RawValue\ndocumentID.Type = 7\ndocumentID.Value = []byte(\"5c7452c7aeb4c97e0cdb75bf\")\nobjID := documentID.ObjectID()\nvalue := collection.FindOne(ctx, bson.M{\"_id\": objID})\n</code></pre>\n\n<p>The value I provided is a real document id I got from Mongo Express </p>\n\n<pre><code>\"_id\": ObjectID(\"5c7452c7aeb4c97e0cdb75bf\")\n</code></pre>\n\n<p>In case you're wondering why I bother with RawValue, I found examples using bson.EC.ObjectID but bson package doesn't seem to have EC type, also I found some examples mentioning github.com/mongodb/mongo-go-driver/bson/objectid package, but I could not find that package either. I previously developed with mgo but I'm new to mongo-go-driver, so if you can point an easy way to declare an ObjectID. </p>\n"}]